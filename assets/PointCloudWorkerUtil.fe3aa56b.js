import{r as v,t as C}from"./index.860f6be5.js";import{c as A,b as I,d as x}from"./PointCloudUniqueValueRenderer.72f411f6.js";import{I as O,w as R,l as S,c as V}from"./I3SBinaryReader.068d7429.js";function F(l,o,d,s){const{rendererJSON:u,isRGBRenderer:p}=l;let r=null,c=null;if(o&&p)r=o;else if(o&&(u==null?void 0:u.type)==="pointCloudUniqueValueRenderer"){c=A.fromJSON(u);const e=c.colorUniqueValueInfos;r=new Uint8Array(3*s);const i=m(c.fieldTransformType);for(let t=0;t<s;t++){const f=(i?i(o[t]):o[t])+"";for(let n=0;n<e.length;n++)if(e[n].values.includes(f)){r[3*t]=e[n].color.r,r[3*t+1]=e[n].color.g,r[3*t+2]=e[n].color.b;break}}}else if(o&&(u==null?void 0:u.type)==="pointCloudStretchRenderer"){c=I.fromJSON(u);const e=c.stops;r=new Uint8Array(3*s);const i=m(c.fieldTransformType);for(let t=0;t<s;t++){const f=i?i(o[t]):o[t],n=e.length-1;if(f<e[0].value)r[3*t]=e[0].color.r,r[3*t+1]=e[0].color.g,r[3*t+2]=e[0].color.b;else if(f>=e[n].value)r[3*t]=e[n].color.r,r[3*t+1]=e[n].color.g,r[3*t+2]=e[n].color.b;else for(let a=1;a<e.length;a++)if(f<e[a].value){const b=(f-e[a-1].value)/(e[a].value-e[a-1].value);r[3*t]=e[a].color.r*b+e[a-1].color.r*(1-b),r[3*t+1]=e[a].color.g*b+e[a-1].color.g*(1-b),r[3*t+2]=e[a].color.b*b+e[a-1].color.b*(1-b);break}}}else if(o&&(u==null?void 0:u.type)==="pointCloudClassBreaksRenderer"){c=x.fromJSON(u);const e=c.colorClassBreakInfos;r=new Uint8Array(3*s);const i=m(c.fieldTransformType);for(let t=0;t<s;t++){const f=i?i(o[t]):o[t];for(let n=0;n<e.length;n++)if(f>=e[n].minValue&&f<=e[n].maxValue){r[3*t]=e[n].color.r,r[3*t+1]=e[n].color.g,r[3*t+2]=e[n].color.b;break}}}else{r=new Uint8Array(3*s);for(let e=0;e<r.length;e++)r[e]=255}if(d&&c&&c.colorModulation){const e=c.colorModulation.minValue,i=c.colorModulation.maxValue,t=.3;for(let f=0;f<s;f++){const n=d[f],a=n>=i?1:n<=e?t:t+(1-t)*(n-e)/(i-e);r[3*f]=a*r[3*f],r[3*f+1]=a*r[3*f+1],r[3*f+2]=a*r[3*f+2]}}return r}function J(l,o){if(l.encoding==null||l.encoding===""){const d=R(o,l);if(C(d.vertexAttributes.position))return;const s=S(o,d.vertexAttributes.position),u=d.header.fields,p=[u.offsetX,u.offsetY,u.offsetZ],r=[u.scaleX,u.scaleY,u.scaleZ],c=s.length/3,e=new Float64Array(3*c);for(let i=0;i<c;i++)e[3*i]=s[3*i]*r[0]+p[0],e[3*i+1]=s[3*i+1]*r[1]+p[1],e[3*i+2]=s[3*i+2]*r[2]+p[2];return e}if(l.encoding==="lepcc-xyz")return V(o).result}function N(l,o,d){return v(l)&&l.attributeInfo.useElevation?o?B(o,d):null:v(l)&&l.attributeInfo.storageInfo?O(l.attributeInfo.storageInfo,l.buffer,d):null}function B(l,o){const d=new Float64Array(o);for(let s=0;s<o;s++)d[s]=l[3*s+2];return d}function $(l,o,d,s,u){const p=l.length/3;let r=0;for(let c=0;c<p;c++){let e=!0;for(let i=0;i<s.length&&e;i++){const{filterJSON:t}=s[i],f=u[i].values[c];switch(t.type){case"pointCloudValueFilter":{const n=t.mode==="exclude";t.values.includes(f)===n&&(e=!1);break}case"pointCloudBitfieldFilter":{const n=k(t.requiredSetBits),a=k(t.requiredClearBits);(f&n)===n&&(f&a)==0||(e=!1);break}case"pointCloudReturnFilter":{const n=15&f,a=f>>>4&15,b=a>1,w=n===1,y=n===a;let h=!1;for(const g of t.includedReturns)if(g==="last"&&y||g==="firstOfMany"&&w&&b||g==="lastOfMany"&&y&&b||g==="single"&&!b){h=!0;break}h||(e=!1);break}}}e&&(d[r]=c,l[3*r]=l[3*c],l[3*r+1]=l[3*c+1],l[3*r+2]=l[3*c+2],o[3*r]=o[3*c],o[3*r+1]=o[3*c+1],o[3*r+2]=o[3*c+2],r++)}return r}function m(l){return l==null||l==="none"?null:l==="low-four-bit"?o=>15&o:l==="high-four-bit"?o=>(240&o)>>4:l==="absolute-value"?o=>Math.abs(o):l==="modulo-ten"?o=>o%10:null}function k(l){let o=0;for(const d of l||[])o|=1<<d;return o}export{N as a,J as c,B as d,F as f,$ as m};
