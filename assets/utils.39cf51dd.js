import{a as z,d as I}from"./generateRendererUtils.663fbe5d.js";const N="<Null>",S="equal-interval",M=1,C=5,k=10,$=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,y=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),w=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function h(t){return t==null||typeof t=="string"&&!t?N:t}function E(t){const e=t.normalizationField!=null||t.normalizationType!=null,l=t.minValue!=null||t.maxValue!=null,n=!!t.sqlExpression&&t.supportsSQLExpression;return!e&&!l&&!n}function Q(t){const e=t.returnDistinct?[...new Set(t.values)]:t.values,l=e.filter(r=>r!=null).length,n={count:l};return t.supportsNullCount&&(n.nullcount=e.length-l),t.percentileParams&&(n.median=D(e,t.percentileParams)),n}function q(t){const{values:e,useSampleStdDev:l,supportsNullCount:n}=t;let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=null,s=null,u=null,c=null,o=0;const f=t.minValue==null?-1/0:t.minValue,p=t.maxValue==null?1/0:t.maxValue;for(const d of e)Number.isFinite(d)?d>=f&&d<=p&&(a=a===null?d:a+d,r=Math.min(r,d),i=Math.max(i,d),o++):typeof d=="string"&&o++;if(o&&a!=null){s=a/o;let d=0;for(const v of e)Number.isFinite(v)&&v>=f&&v<=p&&(d+=(v-s)**2);c=l?o>1?d/(o-1):0:o>0?d/o:0,u=Math.sqrt(c)}else r=null,i=null;const m={avg:s,count:o,max:i,min:r,stddev:u,sum:a,variance:c};return n&&(m.nullcount=e.length-o),t.percentileParams&&(m.median=D(e,t.percentileParams)),m}function D(t,e){const{fieldType:l,value:n,orderBy:r,isDiscrete:i}=e,a=G(l,r==="desc");if((t=[...t].filter(m=>m!=null).sort((m,d)=>a(m,d))).length===0)return null;if(n<=0)return t[0];if(n>=1)return t[t.length-1];const s=(t.length-1)*n,u=Math.floor(s),c=u+1,o=s%1,f=t[u],p=t[c];return c>=t.length||i||typeof f=="string"||typeof p=="string"?f:f*(1-o)+p*o}function G(t,e){const l=e?1:-1,n=P(e),r=F(e);if(!(!!t&&["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...y].includes(t)))return(i,a)=>typeof i=="number"&&typeof a=="number"?n(i,a):typeof i=="string"&&typeof a=="string"?r(i,a):l;if(t==="esriFieldTypeDate")return(i,a)=>{const s=new Date(i).getTime(),u=new Date(a).getTime();return isNaN(s)||isNaN(u)?l:n(s,u)};if(y.has(t))return(i,a)=>n(i,a);if(t==="esriFieldTypeString")return(i,a)=>r(i,a);if(t==="esriFieldTypeGUID"||t==="esriFieldTypeGlobalID"){const i=F(e);return(a,s)=>i(x(a),x(s))}return e?(i,a)=>1:(i,a)=>-1}function V(t,e,l){if(l){if(t==null)return e==null?0:1;if(e==null)return-1}else{if(t==null)return e==null?0:-1;if(e==null)return 1}return null}function F(t){return t?(e,l)=>{const n=V(e,l,!0);return n!=null?n:(e=e.toUpperCase())>(l=l.toUpperCase())?-1:e<l?1:0}:(e,l)=>{const n=V(e,l,!1);return n!=null?n:(e=e.toUpperCase())<(l=l.toUpperCase())?-1:e>l?1:0}}function P(t){return t?(e,l)=>{const n=V(e,l,!0);return n!=null?n:l-e}:(e,l)=>{const n=V(e,l,!1);return n!=null?n:e-l}}function x(t){return t.substr(24,12)+t.substr(19,4)+t.substr(16,2)+t.substr(14,2)+t.substr(11,2)+t.substr(9,2)+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)+t.substr(0,2)}function j(t,e){let l;for(l in t)w.includes(l)&&(Number.isFinite(t[l])||(t[l]=null));return e&&["avg","stddev","variance"].forEach(n=>{t[n]!=null&&(t[n]=Math.ceil(t[n]))}),t}function H(t){const e={};for(let l of t)(l==null||typeof l=="string"&&l.trim()==="")&&(l=null),e[l]==null?e[l]={count:1,data:l}:e[l].count++;return{count:e}}function g(t){return(t==null?void 0:t.type)!=="coded-value"?[]:t.codedValues.map(e=>e.code)}function J(t,e,l,n){const r=t.count,i=[];if(l&&e){const a=[],s=g(e[0]);for(const u of s)if(e[1]){const c=g(e[1]);for(const o of c)if(e[2]){const f=g(e[2]);for(const p of f)a.push(`${h(u)}${n}${h(o)}${n}${h(p)}`)}else a.push(`${h(u)}${n}${h(o)}`)}else a.push(u);for(const u of a)r.hasOwnProperty(u)||(r[u]={data:u,count:0})}for(const a in r){const s=r[a];i.push({value:s.data,count:s.count,label:s.label})}return{uniqueValueInfos:i}}function K(t,e,l,n){let r=null;switch(e){case"log":t!==0&&(r=Math.log(t)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(n)&&n!==0&&(r=t/n*100);break;case"field":Number.isFinite(l)&&l!==0&&(r=t/l);break;case"natural-log":t>0&&(r=Math.log(t));break;case"square-root":t>0&&(r=t**.5)}return r}function U(t,e){const l=O({field:e.field,normalizationType:e.normalizationType,normalizationField:e.normalizationField,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,breakCount:e.numClasses||C});return t=B(t,e.minValue,e.maxValue),z({definition:l,values:t,normalizationTotal:e.normalizationTotal})}function B(t,e,l){const n=e!=null?e:-1/0,r=l!=null?l:1/0;return t.filter(i=>Number.isFinite(i)&&i>=n&&i<=r)}function O(t){const{breakCount:e,field:l,normalizationField:n,normalizationType:r}=t,i=t.classificationMethod||S,a=i==="standard-deviation"?t.standardDeviationInterval||M:void 0;return new I({breakCount:e,classificationField:l,classificationMethod:i,normalizationField:r==="field"?n:void 0,normalizationType:r,standardDeviationInterval:a})}function R(t,e){let l=t.classBreaks;const n=l.length,r=l[0].minValue,i=l[n-1].maxValue,a=e==="standard-deviation",s=$;return l=l.map(u=>{var f,p;const c=u.label,o={minValue:u.minValue,maxValue:u.maxValue,label:c};if(a&&c){const m=(p=(f=c.match(s))==null?void 0:f.map(d=>+d.trim()))!=null?p:[];m.length===2?(o.minStdDev=m[0],o.maxStdDev=m[1],m[0]<0&&m[1]>0&&(o.hasAvg=!0)):m.length===1&&(c.includes("<")?(o.minStdDev=null,o.maxStdDev=m[0]):c.includes(">")&&(o.minStdDev=m[0],o.maxStdDev=null))}return o}),{minValue:r,maxValue:i,classBreakInfos:l,normalizationTotal:t.normalizationTotal}}function W(t,e){var s,u;const l=A(t,e),n=l.intervals,r=(s=l.min)!=null?s:0,i=(u=l.max)!=null?u:0,a=n.map((c,o)=>({minValue:n[o][0],maxValue:n[o][1],count:0}));for(const c of t)if(c!=null&&c>=r&&c<=i){const o=L(n,c);o>-1&&a[o].count++}return{bins:a,minValue:r,maxValue:i,normalizationTotal:e.normalizationTotal}}function A(t,e){var d,v;const{field:l,classificationMethod:n,standardDeviationInterval:r,normalizationType:i,normalizationField:a,normalizationTotal:s,minValue:u,maxValue:c}=e,o=e.numBins||k;let f=null,p=null,m=null;if((!n||n==="equal-interval")&&!i){if(u!=null&&c!=null)f=u,p=c;else{const b=q({values:t,minValue:u,maxValue:c,useSampleStdDev:!i,supportsNullCount:E({normalizationType:i,normalizationField:a,minValue:u,maxValue:c})});f=(d=b.min)!=null?d:null,p=(v=b.max)!=null?v:null}m=Y(f!=null?f:0,p!=null?p:0,o)}else{const{classBreaks:b}=U(t,{field:l,normalizationType:i,normalizationField:a,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:r,minValue:u,maxValue:c,numClasses:o});f=b[0].minValue,p=b[b.length-1].maxValue,m=b.map(T=>[T.minValue,T.maxValue])}return{min:f,max:p,intervals:m}}function L(t,e){let l=-1;for(let n=t.length-1;n>=0;n--)if(e>=t[n][0]){l=n;break}return l}function Y(t,e,l){const n=(e-t)/l,r=[];let i,a=t;for(let s=1;s<=l;s++)i=a+n,i=Number(i.toFixed(16)),r.push([a,s===l?e:i]),a=i;return r}export{K as D,W as M,R as S,j as T,h as c,q as d,Q as f,E as m,D as p,G as v,J as x,H as y,U as z};
