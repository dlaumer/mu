import{s as F,e as y,dj as I,y as M,a as S,cF as j,O as B}from"./index.f0143bd6.js";const w=new F({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),z=new F({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let v=class extends j{constructor(a){super(a),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(a){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",a)}set definedInterval(a){this.classificationMethod==="defined-interval"&&this._set("definedInterval",a)}};y([I({classBreaksDef:"class-breaks-definition"})],v.prototype,"type",void 0),y([M({json:{write:!0}})],v.prototype,"breakCount",void 0),y([M({json:{write:!0}})],v.prototype,"classificationField",void 0),y([M({type:String,json:{read:w.read,write:w.write}})],v.prototype,"classificationMethod",void 0),y([M({json:{write:!0}})],v.prototype,"normalizationField",void 0),y([M({json:{read:z.read,write:z.write}})],v.prototype,"normalizationType",void 0),y([M({value:null,json:{write:!0}})],v.prototype,"standardDeviationInterval",null),y([M({value:null,json:{write:!0}})],v.prototype,"definedInterval",null),v=y([S("esri.rest.support.ClassBreaksDefinition")],v);const A=v,N=B.getLogger("esri.rest.support.generateRendererUtils");function x(a,i){return Number(a.toFixed(i))}function P(a){const{normalizationTotal:i}=a;return{classBreaks:D(a),normalizationTotal:i}}function D(a){var b;const i=a.definition,{classificationMethod:n,normalizationType:s,definedInterval:d}=i,f=(b=i.breakCount)!=null?b:1,u=[];let l=a.values;if(l.length===0)return[];l=l.sort((o,t)=>o-t);const c=l[0],h=l[l.length-1];if(n==="equal-interval")if(l.length>=f){const o=(h-c)/f;let t=c;for(let e=1;e<f;e++){const r=x(c+e*o,6);u.push({minValue:t,maxValue:r,label:V(t,r,s)}),t=r}u.push({minValue:t,maxValue:h,label:V(t,h,s)})}else l.forEach(o=>{u.push({minValue:o,maxValue:o,label:V(o,o,s)})});else if(n==="natural-breaks"){const o=$(l),t=a.valueFrequency||o.valueFrequency,e=T(o.uniqueValues,t,f);let r=c;for(let m=1;m<f;m++)if(o.uniqueValues.length>m){const p=x(o.uniqueValues[e[m]],6);u.push({minValue:r,maxValue:p,label:V(r,p,s)}),r=p}u.push({minValue:r,maxValue:h,label:V(r,h,s)})}else if(n==="quantile")if(l.length>=f&&c!==h){let o=c,t=Math.ceil(l.length/f),e=0;for(let r=1;r<f;r++){let m=t+e-1;m>l.length&&(m=l.length-1),m<0&&(m=0),u.push({minValue:o,maxValue:l[m],label:V(o,l[m],s)}),o=l[m],e+=t,t=Math.ceil((l.length-e)/(f-r))}u.push({minValue:o,maxValue:h,label:V(o,h,s)})}else{let o=-1;for(let t=0;t<l.length;t++){const e=l[t];e!==o&&(o=e,u.push({minValue:o,maxValue:e,label:V(o,e,s)}),o=e)}}else if(n==="standard-deviation"){const o=_(l),t=O(l,o);if(t===0)u.push({minValue:l[0],maxValue:l[0],label:V(l[0],l[0],s)});else{const e=L(c,h,f,o,t)*t;let r=0,m=c;for(let g=f;g>=1;g--){const q=x(o-(g-.5)*e,6);u.push({minValue:m,maxValue:q,label:V(m,q,s)}),m=q,r++}let p=x(o+.5*e,6);u.push({minValue:m,maxValue:p,label:V(m,p,s)}),m=p,r++;for(let g=1;g<=f;g++)p=r===2*f?h:x(o+(g+.5)*e,6),u.push({minValue:m,maxValue:p,label:V(m,p,s)}),m=p,r++}}else if(n==="defined-interval"){if(!d)return u;const o=l[0],t=l[l.length-1],e=Math.ceil((t-o)/d);let r=o;for(let m=1;m<e;m++){const p=x(o+m*d,6);u.push({minValue:r,maxValue:p,label:V(r,p,s)}),r=p}u.push({minValue:r,maxValue:t,label:V(r,t,s)})}return u}function V(a,i,n){let s=null;return s=a===i?n&&n==="percent-of-total"?a+"%":a.toString():n&&n==="percent-of-total"?a+"% - "+i+"%":a+" - "+i,s}function $(a){const i=[],n=[];let s=Number.MIN_VALUE,d=1,f=-1;for(let u=0;u<a.length;u++){const l=a[u];l===s?(d++,n[f]=d):l!==null&&(i.push(l),s=l,d=1,n.push(d),f++)}return{uniqueValues:i,valueFrequency:n}}function T(a,i,n){const s=a.length,d=[];n>s&&(n=s);for(let u=0;u<n;u++)d.push(Math.round(u*s/n-1));d.push(s-1);let f=C(d,a,i,n);return E(f.mean,f.sdcm,d,a,i,n)&&(f=C(d,a,i,n)),d}function C(a,i,n,s){let d=[],f=[],u=[],l=0;const c=[],h=[];for(let e=0;e<s;e++){const r=k(e,a,i,n);c.push(r.sbMean),h.push(r.sbSdcm),l+=h[e]}let b,o=l,t=!0;for(;t||l<o;){t=!1,d=[];for(let e=0;e<s;e++)d.push(a[e]);for(let e=0;e<s;e++)for(let r=a[e]+1;r<=a[e+1];r++)if(b=i[r],e>0&&r!==a[e+1]&&Math.abs(b-c[e])>Math.abs(b-c[e-1]))a[e]=r;else if(e<s-1&&a[e]!==r-1&&Math.abs(b-c[e])>Math.abs(b-c[e+1])){a[e+1]=r-1;break}o=l,l=0,f=[],u=[];for(let e=0;e<s;e++){f.push(c[e]),u.push(h[e]);const r=k(e,a,i,n);c[e]=r.sbMean,h[e]=r.sbSdcm,l+=h[e]}}if(l>o){for(let e=0;e<s;e++)a[e]=d[e],c[e]=f[e],h[e]=u[e];l=o}return{mean:c,sdcm:h}}function E(a,i,n,s,d,f){let u=0,l=0,c=0,h=0,b=!0;for(let o=0;o<2&&b;o++){o===0&&(b=!1);for(let t=0;t<f-1;t++)for(;n[t+1]+1!==n[t+2];){n[t+1]=n[t+1]+1;const e=k(t,n,s,d);c=e.sbMean,u=e.sbSdcm;const r=k(t+1,n,s,d);if(h=r.sbMean,l=r.sbSdcm,!(u+l<i[t]+i[t+1])){n[t+1]=n[t+1]-1;break}i[t]=u,i[t+1]=l,a[t]=c,a[t+1]=h,b=!0}for(let t=f-1;t>0;t--)for(;n[t]!==n[t-1]+1;){n[t]=n[t]-1;const e=k(t-1,n,s,d);c=e.sbMean,u=e.sbSdcm;const r=k(t,n,s,d);if(h=r.sbMean,l=r.sbSdcm,!(u+l<i[t-1]+i[t])){n[t]=n[t]+1;break}i[t-1]=u,i[t]=l,a[t-1]=c,a[t]=h,b=!0}}return b}function L(a,i,n,s,d){let f=Math.max(s-a,i-s)/d/n;return f=f>=1?1:f>=.5?.5:.25,f}function _(a){let i=0;for(let n=0;n<a.length;n++)i+=a[n];return i/=a.length,i}function O(a,i){let n=0;for(let s=0;s<a.length;s++){const d=a[s];n+=(d-i)*(d-i)}return n/=a.length,Math.sqrt(n)}function k(a,i,n,s){let d=0,f=0;for(let c=i[a]+1;c<=i[a+1];c++){const h=s[c];d+=n[c]*h,f+=h}f<=0&&N.warn("Exception in Natural Breaks calculation");const u=d/f;let l=0;for(let c=i[a]+1;c<=i[a+1];c++)l+=s[c]*(n[c]-u)**2;return{sbMean:u,sbSdcm:l}}export{P as a,A as d};
