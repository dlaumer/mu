const y3e=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}};y3e();const i5={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Hfe(e){return i5[e]||i5[e.toLowerCase()]}function HY(e){var t;return(t=i5[e])!=null?t:i5[e.toLowerCase()]}function _3e(e){return[...HY(e)]}function qV(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function qfe(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(255*qV(o,n,s+1/3)),Math.round(255*qV(o,n,s)),Math.round(255*qV(o,n,s-1/3)),r]}function v3e(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}const dw=null;function v(e){return e!=null}function C(e){return e==null}function Mn(e,t){return v(e)?t(e):dw}function GCt(e){return e}function jCt(e){return e}function ba(e,t){return XT(e,t),e}function XT(e,t){if(C(e))throw new Error(t!=null?t:"value is None")}function Ft(e,t){return v(e)?e:typeof t=="function"?t():t}function Wte(e,t){return v(e)?e:t}function Be(e){return v(e)&&e.destroy(),null}function rt(e){return v(e)&&e.dispose(),null}function hs(e){return v(e)&&e.remove(),null}function ep(e){return v(e)&&e.abort(),null}function ls(e){return v(e)&&e.release(),null}function b3e(e,t,i){return v(e)&&v(t)?v(i)?i(e,t):e.equals(t):e===t}function sT(e){return null}function HCt(e,t){const i=new Array;return e.forEach(r=>{const s=t(r);v(s)&&i.push(s)}),i}function qCt(e,t){const i=new Array;for(const r of e)i.push(Sh(r,null,t));return i}function WCt(e,t){for(const i of e)Mn(i,t)}function Sh(e,t,i){return v(e)?i(e):t}function XCt(e){return e.filter(t=>v(t))}function oo(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}function YCt(e){return e}function O(){return[0,0,0]}function js(e){return[e[0],e[1],e[2]]}function Le(e,t,i){return[e,t,i]}function Rc(e){const t=O(),i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function qY(e,t){return new Float64Array(e,t,3)}function Wfe(){return O()}function Xfe(){return Le(1,1,1)}function Yfe(){return Le(1,0,0)}function Zfe(){return Le(0,1,0)}function WY(){return Le(0,0,1)}const dl=Wfe(),sg=Xfe(),w3e=Yfe(),x3e=Zfe(),Jfe=WY();Object.freeze(Object.defineProperty({__proto__:null,ONES:sg,UNIT_X:w3e,UNIT_Y:x3e,UNIT_Z:Jfe,ZEROS:dl,clone:js,create:O,createView:qY,fromArray:Rc,fromValues:Le,ones:Xfe,unitX:Yfe,unitY:Zfe,unitZ:WY,zeros:Wfe},Symbol.toStringTag,{value:"Module"}));let XY=1e-6;function vl(){return XY}function T3e(e){XY=e}const e$=Math.random,S3e=Math.PI/180,E3e=180/Math.PI;function M6(e){return e*S3e}function C3e(e){return e*E3e}function A3e(e,t){return Math.abs(e-t)<=XY*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:e$,equals:A3e,getEpsilon:vl,setEpsilon:T3e,toDegree:C3e,toRadian:M6},Symbol.toStringTag,{value:"Module"}));function Oe(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function le(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ue(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function fe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function me(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function R6(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function r5(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function M3e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Kfe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function yG(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function Qfe(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function eme(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function R3e(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function O3e(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function ae(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Rx(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function Vr(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function Ta(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function ll(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function pl(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function I3e(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function be(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function _e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function _t(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function On(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function P3e(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+s[0]*h,e[1]=t[1]*a+i[1]*l+r[1]*c+s[1]*h,e[2]=t[2]*a+i[2]*l+r[2]*c+s[2]*h,e}function $3e(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+i[0]*h+r[0]*p+s[0]*f,e[1]=t[1]*c+i[1]*h+r[1]*p+s[1]*f,e[2]=t[2]*c+i[2]*h+r[2]*p+s[2]*f,e}function L3e(e,t){t=t||1;const i=e$,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=s*t,e}function Ze(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function Eu(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function Cf(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-r*c,f=r*l-s*a,m=s*f-n*p,y=n*h-r*f,_=r*p-s*h;const b=2*o;return h*=b,p*=b,f*=b,m*=2,y*=2,_*=2,e[0]=a+h+m,e[1]=l+p+y,e[2]=c+f+_,e}function D3e(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function F3e(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function N3e(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function tme(e,t){le(oL,e),le(aL,t),be(oL,oL),be(aL,aL);const i=_e(oL,aL);return i>1?0:i<-1?Math.PI:Math.acos(i)}const oL=O(),aL=O();function k3e(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function ql(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function U1(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=t[0],o=t[1],a=t[2],l=vl();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function z0(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const Wo=me,U3e=R6,V3e=r5,t$=Vr,YY=Ta,pu=Oe,_G=ll,Xte=Object.freeze(Object.defineProperty({__proto__:null,abs:yG,add:fe,angle:tme,bezier:$3e,ceil:M3e,copy:le,cross:_t,direction:z0,dist:t$,distance:Vr,div:V3e,divide:r5,dot:_e,equals:U1,exactEquals:ql,floor:Kfe,hermite:P3e,inverse:I3e,len:pu,length:Oe,lerp:On,max:R3e,min:eme,mul:U3e,multiply:R6,negate:pl,normalize:be,random:L3e,rotateX:D3e,rotateY:F3e,rotateZ:N3e,round:O3e,scale:ae,scaleAndAdd:Rx,set:ue,sign:Qfe,sqrDist:YY,sqrLen:_G,squaredDistance:Ta,squaredLength:ll,str:k3e,sub:Wo,subtract:me,transformMat3:Eu,transformMat4:Ze,transformQuat:Cf},Symbol.toStringTag,{value:"Module"}));function gf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function mr(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function ZY(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function ime(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function rme(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function sme(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function B3e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function z3e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function G3e(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function j3e(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function H3e(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function YA(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function q3e(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function nme(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function s5(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function JY(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function KY(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function W3e(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function X3e(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ome(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function ame(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function O6(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function Y3e(e,t){const i=e$;let r,s,n,o,a,l;t=t||1;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return e[0]=t*r,e[1]=t*s,e[2]=t*n*c,e[3]=t*o*c,e}function Ph(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function Z3e(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,p=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return e[0]=h*c+m*-o+p*-l-f*-a,e[1]=p*c+m*-a+f*-o-h*-l,e[2]=f*c+m*-l+h*-a-p*-o,e[3]=t[3],e}function J3e(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function eC(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function QY(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3],h=vl();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const K3e=ime,Q3e=rme,eIe=sme,tIe=nme,iIe=s5,rIe=JY,sIe=KY,lme=Object.freeze(Object.defineProperty({__proto__:null,add:ZY,ceil:B3e,copy:gf,dist:tIe,distance:nme,div:eIe,divide:sme,dot:ame,equals:QY,exactEquals:eC,floor:z3e,inverse:X3e,len:rIe,length:JY,lerp:O6,max:j3e,min:G3e,mul:Q3e,multiply:rme,negate:W3e,normalize:ome,random:Y3e,round:H3e,scale:YA,scaleAndAdd:q3e,set:mr,sqrDist:iIe,sqrLen:sIe,squaredDistance:s5,squaredLength:KY,str:J3e,sub:K3e,subtract:ime,transformMat4:Ph,transformQuat:Z3e},Symbol.toStringTag,{value:"Module"})),Yte=new Float32Array(1);function kC(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function ye(e,t,i){return Math.min(Math.max(e,t),i)}function $f(e){return(e&e-1)==0}function ZCt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function JCt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function zt(e,t,i){return e+(t-e)*i}function Wt(e){return e*Math.PI/180}function Zl(e){return 180*e/Math.PI}function WV(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function uo(e){return Math.acos(ye(e,-1,1))}function tp(e){return Math.asin(ye(e,-1,1))}function tC(e,t,i=1e-6){return e===t?!0:!Number.isFinite(e)||!Number.isFinite(t)?!1:(e>t?e-t:t-e)<=i}const n5=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function nIe(e){return n5.setFloat64(0,e),n5.getBigInt64(0)}function oIe(e){return n5.setBigInt64(0,e),n5.getFloat64(0)}const XV=BigInt("1000000");aIe(1);function aIe(e){const t=nIe(e=Math.abs(e)),i=oIe(t<=XV?XV:t-XV);return Math.abs(e-i)}function lIe(e,t,i=1e-6){if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function cIe(e){return cme(Math.max(-vG,Math.min(e,vG)))}function cme(e){return Yte[0]=e,Yte[0]}function UC(e,t,i){const r=ye((i-e)/(t-e),0,1);return r*r*(3-2*r)}function Zte(e,t){const i=Oe(e),r=tp(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return ue(t,i,r,s),t}function KCt(e,t,i){return mr(e,t[0],t[1],t[2],t[3]*i)}function QCt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(tC(t,1)&&tC(i,1)&&tC(r,1))}const vG=cme(34028234663852886e22);let r1;function he(e){return typeof r1[e]=="function"?r1[e]=r1[e](globalThis):r1[e]}var Ffe,Nfe,kfe,Ufe;r1=((Ffe=globalThis.dojoConfig)==null?void 0:Ffe.has)||((Nfe=globalThis.esriConfig)==null?void 0:Nfe.has)?{...(kfe=globalThis.dojoConfig)==null?void 0:kfe.has,...(Ufe=globalThis.esriConfig)==null?void 0:Ufe.has}:{},he.add=(e,t,i,r)=>((r||r1[e]===void 0)&&(r1[e]=t),i&&he(e)),he.cache=r1,he.add("esri-deprecation-warnings",!0),(()=>{var t;he.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document;if(he.add("host-browser",e),he.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),he.add("dom",e),he("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(he.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),he.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),he.add("khtml",s.includes("Konqueror")?n:void 0),he.add("edge",parseFloat(r.split("Edge/")[1])||void 0),he.add("opr",parseFloat(r.split("OPR/")[1])||void 0),he.add("webkit",!he("wp")&&!he("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),he.add("chrome",!he("edge")&&!he("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),he.add("android",!he("wp")&&parseFloat(r.split("Android ")[1])||void 0),he.add("safari",!s.includes("Safari")||he("wp")||he("chrome")||he("android")||he("edge")||he("opr")?void 0:parseFloat(s.split("Version/")[1])),he.add("mac",s.includes("Macintosh")),!he("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));he.add(o,l),he.add("ios",l)}he("webkit")||(!r.includes("Gecko")||he("wp")||he("khtml")||he("edge")||he.add("mozilla",n),he("mozilla")&&he.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&he.add("esri-mobile",t),i&&he.add("esri-iPhone",i),he.add("esri-geolocation",!!navigator.geolocation)}he.add("esri-wasm","WebAssembly"in globalThis),he.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),he.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),he.add("esri-atomics","Atomics"in globalThis),he.add("esri-workers","Worker"in globalThis),he.add("web-feat:cache","caches"in globalThis),he.add("esri-workers-arraybuffer-transfer",!he("safari")||Number(he("safari"))>=12),he.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),he.add("featurelayer-simplify-payload-size-factors",[1,1,4]),he.add("featurelayer-snapshot-enabled",!0),he.add("featurelayer-snapshot-point-min-threshold",8e4),he.add("featurelayer-snapshot-point-max-threshold",4e5),he.add("featurelayer-snapshot-point-coverage",.1),he.add("featurelayer-advanced-symbols",!1),he.add("featurelayer-pbf",!0),he.add("featurelayer-pbf-statistics",!1),he.add("feature-layers-workers",!0),he.add("feature-polyline-generalization-factor",1),he.add("mapview-transitions-duration",200),he.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),he.add("mapserver-pbf-version-support",10.81),he.add("mapservice-popup-identify-max-tolerance",20),he.add("heatmap-allow-raster-fallback",!0),he.add("heatmap-force-raster",!1),he("host-webworker")||he("host-browser")&&(he.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),he.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{he.add("esri-image-decode",!0,!0,!0)}).catch(()=>{he.add("esri-image-decode",!1,!0,!0)})}return!1}),he.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();class Dd{constructor(t=1){this._seed=t}set seed(t){this._seed=t!=null?t:Math.random()*Dd._m}getInt(){return this._seed=(Dd._a*this._seed+Dd._c)%Dd._m,this._seed}getFloat(){return this.getInt()/(Dd._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/Dd._m*r}}Dd._m=2147483647,Dd._a=48271,Dd._c=0;function i$(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):e.filter((i,r,s)=>s.indexOf(i)===r)}function xg(e,t,i){if(C(e)&&C(t))return!0;if(C(e)||C(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function eZ(e,t){let i=e.length!==t.length;i&&(e.length=t.length);for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function uIe(e,t,i){let r,s;return i?(r=t.filter(n=>!e.some(o=>i(o,n))),s=e.filter(n=>!t.some(o=>i(o,n)))):(r=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:r,removed:s}}function hIe(e){return e&&typeof e.length=="number"}function eAt(e,t){const i=e.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const dIe=!!Array.prototype.fill;function tAt(e,t){if(dIe)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function pIe(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function fIe(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return i?t>=e[r-1]?-1:o===t?s:s-1:o===t?s:-1}class ume{constructor(){this.last=0}}const hme=new ume;function bG(e,t,i,r){r=r||hme;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(e[o]===t)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(e[o]===t)return r.last=o,o;return-1}function xI(e,t,i,r){const s=i!=null?i:e.length,n=bG(e,t,s,r);if(n!==-1)return e[n]=e[s-1],i==null&&e.pop(),t}const vp=new Set;function mIe(e,t,i=e.length,r=t.length,s,n){if(r===0||i===0)return i;vp.clear();for(let a=0;a<r;++a)vp.add(t[a]);s=s||hme;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(vp.has(e[a])&&(n&&n.push(e[a]),vp.delete(e[a]),e[a]=e[i-1],--i,--a,vp.size===0||i===0))return vp.clear(),i;for(let a=0;a<o;++a)if(vp.has(e[a])&&(n&&n.push(e[a]),vp.delete(e[a]),e[a]=e[i-1],--i,--a,vp.size===0||i===0))return vp.clear(),i;return vp.clear(),i}function gIe(e,t){let i=0;for(let r=0;r<e.length;++r){const s=e[r];t(s,r)&&(e[i]=s,i++)}e.length=i}function yIe(e){return e?(Jte.seed=e,()=>Jte.getFloat()):Math.random}function iAt(e,t){const i=yIe(t);for(let r=e.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}return e}const Jte=new Dd;function tZ(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}function rAt(e,t){const i=new Map,r=e.length;for(let s=0;s<r;s++){const n=e[s],o=t(n,s,e),a=i.get(o);a?a.push(n):i.set(o,[n])}return i}function IM(e){return e instanceof ArrayBuffer}function _Ie(e){return e&&e.constructor&&e.constructor.name==="Int8Array"}function ux(e){return e&&e.constructor&&e.constructor.name==="Uint8Array"}function vIe(e){return e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function bIe(e){return e&&e.constructor&&e.constructor.name==="Int16Array"}function iZ(e){return e&&e.constructor&&e.constructor.name==="Uint16Array"}function wIe(e){return e&&e.constructor&&e.constructor.name==="Int32Array"}function rZ(e){return e&&e.constructor&&e.constructor.name==="Uint32Array"}function sZ(e){return e&&e.constructor&&e.constructor.name==="Float32Array"}function nZ(e){return e&&e.constructor&&e.constructor.name==="Float64Array"}function lL(e){return v(e)?128+e.buffer.byteLength+64:0}const Tg=1024;function dme(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&dme(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function ne(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=gme(e);if(v(t))return t;if(pme(e))return e.clone();if(fme(e))return e.map(ne);if(mme(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=ne(e[r]);return i}function wG(e){if(!e||typeof e!="object"||typeof e=="function"||"HTMLElement"in globalThis&&e instanceof HTMLElement)return e;const t=gme(e);if(v(t))return t;if(fme(e)){let i=!0;const r=e.map(s=>{const n=wG(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(pme(e))return e.clone();if(!mme(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],n=wG(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function pme(e){return typeof e.clone=="function"}function fme(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function mme(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function Kte(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function gme(e){if(_Ie(e)||ux(e)||vIe(e)||bIe(e)||iZ(e)||wIe(e)||rZ(e)||sZ(e)||nZ(e))return e.slice();if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;for(const[i,r]of e)t.set(i,ne(r));return t}if(e instanceof Set){const t=new Set;for(const i of e)t.add(ne(i));return t}return null}function oZ(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function xIe(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&xg(e,t):e instanceof Set?t instanceof Set&&SIe(e,t):e instanceof Map?t instanceof Map&&EIe(e,t):!!Kte(e)&&Kte(t)&&TIe(e,t))}function TIe(e,t){if(e===null||t===null)return!1;const i=Object.keys(e);if(t===null||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}function SIe(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function EIe(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const s=t.get(i);if(s!==r||s===void 0&&!t.has(i))return!1}return!0}function yme(e,t,i=!1){return vme(e,t,i)}function r$(e,t){if(t!=null)return t[e]||_me(e.split("."),!1,t)}function Sa(e,t,i){const r=e.split("."),s=r.pop(),n=_me(r,!0,i);n&&s&&(n[s]=t)}function _me(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function vme(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=r[s],o=t[s];return n===o?r:n===void 0?(r[s]=ne(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=vme(n,o,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=o),r)},e||{}):e}var Vfe;const or={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(Vfe=globalThis.location)==null?void 0:Vfe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(yme(or,globalThis.esriConfig,!0),delete or.has),!or.assetsPath){{const e="4.26.5";or.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}or.defaultAssetsPath=or.assetsPath}const CIe=/\{([^\}]+)\}/g;function Qte(e){return e!=null?e:""}function Sg(e,t){return e.replace(CIe,typeof t=="object"?(i,r)=>Qte(r$(r,t)):(i,r)=>Qte(t(r)))}function AIe(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.includes(i)?i:`\\${i}`)}function aZ(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function sAt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const eie={info:0,warn:1,error:2,none:3};class se{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,se._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=se.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const i=se._loggers;return se._loggers=t,i},set throttlingDisabled(t){se._throttlingDisabled=t}}}static getLogger(t){let i=se._loggers[t];return i||(i=new se({module:t})),i}_log(t,i,...r){if(!!this._matchLevel(t)){if(i!=="always"&&!se._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[t].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=se._tickCounter)return;this._loggedMessages[t].set(s,se._tickCounter),se._scheduleTickCounterIncrement()}for(const s of or.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;v(r);){const s=r[t];if(v(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=or.log.level?or.log.level:"warn";return eie[this._parentWithMember("level",i)]<=eie[t]}_argsToKey(...t){const i=(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return aZ(JSON.stringify(t,i))}static _scheduleTickCounterIncrement(){se._tickCounterScheduled||(se._tickCounterScheduled=!0,Promise.resolve().then(()=>{se._tickCounter++,se._tickCounterScheduled=!1}))}}se._loggers={},se._tickCounter=0,se._tickCounterScheduled=!1,se._throttlingDisabled=!1;function za(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function nAt(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function lZ(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}const iC=se.getLogger("esri.core.accessorSupport.ensureTypes");function MIe(e){return e==null?e:new Date(e)}function RIe(e){return e==null?e:!!e}function s$(e){return e==null?e:e.toString()}function Fd(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function cZ(e){return e==null?e:Math.round(parseFloat(e))}function bme(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function o5(e,t){return t!=null&&e&&!(t instanceof e)}function wme(e){return e&&"isCollection"in e}function tie(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function OIe(e,t){if(!t||!t.constructor||!wme(t.constructor))return xG(e,t)?t:new e(t);const i=tie(e.prototype.itemType),r=tie(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(xG(e,t),t):new e(t):t}function xG(e,t){return!!bme(t)&&(iC.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+I6(e)+"'"),!0)}function VC(e,t){return t==null?t:wme(e)?OIe(e,t):o5(e,t)?xG(e,t)?t:new e(t):t}function I6(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const IIe=new WeakMap;function PIe(e){switch(e){case Number:return Fd;case us:return cZ;case Boolean:return RIe;case String:return s$;case Date:return MIe;default:return lZ(IIe,e,()=>VC.bind(null,e))}}function zr(e,t){const i=PIe(e);return arguments.length===1?i:i(t)}function TI(e,t,i){return arguments.length===1?TI.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function $Ie(e,t){return arguments.length===1?TI(zr.bind(null,e)):TI(zr.bind(null,e),t)}function xme(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>xme(e,t-1,r)):e(i)}function a5(e,t,i){if(arguments.length===2)return a5.bind(null,e,t);if(!i)return i;let r=t,s=i=xme(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function LIe(e,t,i){return arguments.length===2?a5(zr.bind(null,e),t):a5(zr.bind(null,e),t,i)}function Tme(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function TG(e,t){if(arguments.length===2)return TG(e).call(null,t);const i=new Set,r=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!o5(a,p))?a:(h&&r.length?(n||(n=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),iC.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>I6(p)).join(", ")),iC.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):iC.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Lf(e,t){if(arguments.length===2)return Lf(e).call(null,t);const i={},r=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];i[l]=zr(c),r.push(I6(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!o5(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=i[c];if(!h)return iC.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!o5(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!bme(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return h(p)}return h(l)}}class us{}const oAt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function DIe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function Sme(e){switch(e.type){case"native":return zr(e.value);case"array":return TI(Sme(e.value));case"one-of":return FIe(e);default:return null}}function FIe(e){let t=null;return(i,r)=>EG(i,e)?i:(t==null&&(t=SG(e)),iC.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function SG(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case us:return"integer";case Date:return"date";default:return I6(e.value)}case"array":return`array of ${SG(e.value)}`;case"one-of":{const t=e.values.map(i=>SG(i));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function EG(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case us:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!EG(i,t.value));case"one-of":return t.values.some(i=>EG(e,i))}}function cL(e){return ye(cZ(e),0,255)}function uL(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class go{static blendColors(t,i,r,s=new go){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),go.fromArray(a,i)}return go.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return go.fromArray(qfe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new go){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const r=t.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(t,i=new go){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=Hfe(t)?HY(t):null;return r&&go.fromArray(r,i)||go.fromRgb(t,i)||go.fromHex(t,i)}static fromJSON(t){return t&&new go([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return v(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return v(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var i,r,s,n;return typeof t=="string"?go.fromString(t,this):Array.isArray(t)?go.fromArray(t,this):(this._set((i=t.r)!=null?i:0,(r=t.g)!=null?r:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof go||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=go.AlphaMode.ALWAYS){const i=cL(this.r),r=cL(this.g),s=cL(this.b);return t===go.AlphaMode.ALWAYS||this.a!==1?[i,r,s,cL(255*this.a)]:[i,r,s]}clone(){return new go(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return v(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(uL(this.r,0,255)),this.g=Math.round(uL(this.g,0,255)),this.b=Math.round(uL(this.b,0,255)),this.a=uL(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}}go.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(go||(go={}));const De=go;function u(e,t,i,r){var s,n=arguments.length,o=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}function BC(e){return Df(()=>e.forEach(t=>v(t)&&t.remove()))}function Df(e){return{remove:()=>{e&&(e(),e=void 0)}}}function aAt(e){return Df(v(e)?()=>e.destroy():void 0)}function ml(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function NIe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function nN(e,t,i){return i?l5(e,t,{policy:i,path:""}):l5(e,t,null)}function l5(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace"||o==="replace-arrays"&&Array.isArray(r[s]))return r[s]=t[s],r;if(r[s]===void 0)return r[s]=ne(t[s]),r;let a=r[s],l=t[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=l5(a,l,i),i.path=c}else r[s]=l5(a,l,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=l);return r},e||{}):e}function Eme(e){return Array.isArray(e)?e:e.split(".")}function iie(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function kIe(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...iie(i));return t}return iie(e)}function Cme(e,t,i,r){const s=kIe(t);if(s.length!==1){const n=s.map(o=>r(e,o,i));return BC(n)}return r(e,s[0],i)}function uZ(e){let t=!1;return()=>{t||(t=!0,e())}}function Ame(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const r=ml(t);return NIe(r,i)?r.get(i):t[i]}function Mme(e,t,i){if(e==null)return e;const r=Ame(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:Mme(r,t,i+1)}function n$(e,t,i=0){return typeof t!="string"||t.includes(".")?Mme(e,Eme(t),i):Ame(t,e)}function c5(e,t){return n$(e,t)}function rie(e,t){return n$(t,e)!==void 0}function o$(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){t=Object.create(t);for(const r in t)t[r]=ne(t[r]);Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t={},Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function P6(e,t){const i=o$(e);let r=i[t];return r||(r=i[t]={}),r}function UIe(e,t){return nN(e,t,BIe)}const VIe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function BIe(e){return VIe.test(e)?"replace":"merge"}function zIe(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=r$(r,t),n=s!=null?s:"";if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}class $6{constructor(t,i,r){var s;this.name=t,this.details=r,this instanceof $6&&(this.message=(s=i&&zIe(i,r))!=null?s:"")}toString(){return"["+this.name+"]: "+this.message}}class H extends $6{constructor(t,i,r){if(super(t,i,r),!(this instanceof H))return new H(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ne(i)}catch{return"[object]"}}))}}catch(t){throw se.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new H(t.name,t.message,t.details)}}H.prototype.type="error";function u5(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))u5(e,r,t[r]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void u5(c5(e,s),n,i)}const r=e.__accessor__;r!=null&&GIe(t,r),e[t]=i}}function GIe(e,t){if(he("esri-unknown-property-errors")&&!jIe(e,t))throw new H("set:unknown-property",HIe(e,t))}function jIe(e,t){return t.metadatas[e]!=null}function HIe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}function d(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=P6(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&se.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=c5(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=c5(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){this._override(i,p)}:function(p){u5(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=qIe(o):a&&(Array.isArray(a)?s.cast=TI(Lf(a[0])):s.cast=Lf(a))),UIe(s,e),e.range&&(s.cast=WIe(s.cast,e.range))}}function Rme(e,t,i){const r=P6(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function qIe(e){let t=0,i=e;if(DIe(e))return Sme(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(Tme(r))return t===0?TG(r):a5(TG(r),t);if(t===1)return $Ie(r);if(t>1)return LIe(r,t);const s=e;return s.from?s.from:zr(s)}function WIe(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}const Ome=Symbol("Accessor-beforeDestroy");var r0;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(r0||(r0={}));var es;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(es||(es={}));const h5={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},qR=[];let v3=h5;function Ai(e){v3.onObservableAccessed(e)}let oN=!1,aN=!1;function A0(e,t,i){if(oN)return hZ(e,t,i);Ime(e);const r=t.call(i);return Pme(),r}function XIe(e,t){return A0(h5,e,t)}function hZ(e,t,i){const r=oN;oN=!0,Ime(e);let s=null;try{s=t.call(i)}catch(n){aN&&se.getLogger("esri.core.accessorSupport.tracking").error(n)}return Pme(),oN=r,s}function Ime(e){v3=e,qR.push(e)}function Pme(){const e=qR.length;if(e>1){const t=qR.pop();v3=qR[e-2],t.onTrackingEnd()}else if(e===1){const t=qR.pop();v3=h5,t.onTrackingEnd()}else v3=h5}function $me(e,t){const i=t.observerObject;if(i.flags&es.DepTrackingInitialized)return;const r=aN;aN=!1,i.flags&es.AutoTracked?hZ(t,t.metadata.get,e):Lme(e,t),aN=r}const YIe=[];function Lme(e,t){const i=t.observerObject;i.flags&es.ExplicitlyTracking||(i.flags|=es.ExplicitlyTracking,hZ(t,()=>{const r=t.metadata.dependsOn||YIe;for(const s of r)if(typeof s!="string"||s.includes(".")){const n=Eme(s);for(let o=0,a=e;o<n.length&&a!=null&&typeof a=="object";++o)a=sie(a,n[o],o!==n.length-1)}else sie(e,s,!1)}),i.flags&=~es.ExplicitlyTracking)}function sie(e,t,i){var n;const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=ml(e))==null?void 0:n.properties.get(r);return s&&(Ai(s.observerObject),$me(e,s)),i?e[r]:void 0}function ZIe(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(n=>{t[n]=s}),delete t[r]}}}class Bh extends $6{constructor(t,i,r){if(super(t,i,r),!(this instanceof Bh))return new Bh(t,i,r)}}Bh.prototype.type="warning";function Dme(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const CG=se.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function nie(e,t,i){var r,s;e&&(!i&&!t.read||((r=t.read)==null?void 0:r.reader)||((s=t.read)==null?void 0:s.enabled)===!1||QIe(e)&&Sa("read.reader",ub(e),t))}function ub(e){var i,r,s;const t=(i=e.ndimArray)!=null?i:0;if(t>1)return KIe(e);if(t===1)return oie(e);if("type"in e&&Nme(e.type)){const n=(s=(r=e.type.prototype)==null?void 0:r.itemType)==null?void 0:s.Type,o=oie(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return dZ(e)}function dZ(e){return"type"in e?JIe(e.type):ePe(e.types)}function JIe(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void CG.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}function Fme(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>Fme(e,s,i,r-1)):e(t,void 0,i)}function KIe(e){var s;const t=dZ(e),i=Fme.bind(null,t),r=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=i(n,a,r);let l=r,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function oie(e){const t=dZ(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(i,void 0,s);return n!==void 0?[n]:void 0}}function Nme(e){if(!Dme(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?pZ(t.Type):kme(t.Type))}function QIe(e){return"types"in e?kme(e.types):pZ(e.type)}function pZ(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||Nme(e))}function kme(e){for(const t in e.typeMap)if(!pZ(e.typeMap[t]))return!1;return!0}function ePe(e){var r;let t=null;const i=(r=e.errorContext)!=null?r:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void CG.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=tPe(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new Bh(`${i}:unsupported`,f,{definition:s,context:o})),void CG.error(f)}const p=new h;return p.read(s,o),p}}function tPe(e){var i,r;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=o$(n.prototype);if(typeof e.key=="function")continue;const a=o[e.key];if(!a)continue;((i=a.json)==null?void 0:i.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function iPe(e){if(e.json||(e.json={}),lie(e.json),cie(e.json),aie(e.json),e.json.origins)for(const t in e.json.origins)lie(e.json.origins[t]),cie(e.json.origins[t]),aie(e.json.origins[t]);return!0}function aie(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function lie(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function cie(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}function uie(e,t){var r;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const i=(r=e==null?void 0:e.ndimArray)!=null?r:0;e&&(i===1||"type"in e&&Dme(e.type))?t.write.writer=nPe:i>1?t.write.writer=oPe(i):t.types?Array.isArray(t.types)?t.write.writer=sPe(t.types[0]):t.write.writer=rPe(t.types):t.write.writer=SI}function rPe(e){return(t,i,r,s)=>t?Ume(t,e,s)?SI(t,i,r,s):void 0:SI(t,i,r,s)}function Ume(e,t,i){var r,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(i!=null&&i.messages){const n=(r=t.errorContext)!=null?r:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new H(`${n}:unsupported`,o,{definition:e,context:i})),se.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(o)}return!1}function sPe(e){return(t,i,r,s)=>!t||!Array.isArray(t)?SI(t,i,r,s):SI(t.filter(n=>Ume(n,e,s)),i,r,s)}function SI(e,t,i,r){Sa(i,d5(e,r),t)}function d5(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?p5(e):e}function p5(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function nPe(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>d5(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[d5(e,r)],Sa(i,s,t)}function Vme(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>Vme(r,t,i-1)):d5(e,t)}function oPe(e){return(t,i,r,s)=>{let n;if(t===null)n=null;else{n=Vme(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Sa(r,n,i)}}function AG(e,t){return fZ(e,"read",t)}function Bme(e,t){return fZ(e,"write",t)}function fZ(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=i.origin&&e.json.origins[i.origin];s&&(t==="any"||t in s)&&(r=s)}return r}function aPe(e){const t=lPe(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?cPe(r):t;nie(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write={...e.json.write}),uie(s,r)}nie(t,e.json,!0),uie(t,e.json)}function lPe(e){return e.json.types?MG(e.json):e.type?zme(e):MG(e)}function cPe(e){return e.type?zme(e):MG(e)}function zme(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!Tme(i);)i=i[0],t++;return{type:i,ndimArray:t}}function MG(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function uPe(e){iPe(e)&&(ZIe(e),aPe(e))}const YV=new Set,ZV=new Set;function P(e){return t=>{t.prototype.declaredClass=e,dPe(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!YV.has(s.initialize)&&(YV.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!ZV.has(s.destroy)&&(ZV.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);YV.clear(),ZV.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[Ome];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<r.length;h++)r[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=o$(t.prototype),n.prototype.declaredClass=e,n}}function hPe(e,t){return t.get==null?function(){const i=this.__accessor__.properties.get(e);if(i===void 0)return;Ai(i.observerObject);const r=this.__accessor__.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const i=this.__accessor__.properties.get(e);if(i!==void 0)return i.getComputed()}}function dPe(e){const t=e.prototype,i=o$(t),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];uPe(n),r[s]={enumerable:!0,configurable:!0,get:hPe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===r0.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,r)}function lAt(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function pPe(e,t){for(const i of e)if(i!=null&&t(i))return i}function RG(e){return e!=null&&typeof e[Symbol.iterator]=="function"}class Ii{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let t=0;return this._groups.forEach(i=>{t+=i.length}),t}add(t,i){if(RG(t)){const r=this._getOrCreateGroup(i);for(const s of t)this._isHandle(s)&&r.push(s)}else this._isHandle(t)&&this._getOrCreateGroup(i).push(t);return this}forEach(t,i){if(typeof t=="function")this._groups.forEach(r=>r.forEach(t));else{const r=this._getGroup(t);r&&i&&r.forEach(i)}}has(t){return this._groups.has(this._ensureGroupKey(t))}remove(t){if(typeof t!="string"&&RG(t)){for(const i of t)this.remove(i);return this}return this.has(t)?(this._removeAllFromGroup(this._getGroup(t)),this._groups.delete(this._ensureGroupKey(t)),this):this}removeAll(){return this._groups.forEach(t=>this._removeAllFromGroup(t)),this._groups.clear(),this}_isHandle(t){return t&&!!t.remove}_getOrCreateGroup(t){if(this.has(t))return this._getGroup(t);const i=[];return this._groups.set(this._ensureGroupKey(t),i),i}_getGroup(t){return this._groups.get(this._ensureGroupKey(t))}_ensureGroupKey(t){return t||"_default_"}_removeAllFromGroup(t){t.forEach(i=>i.remove())}}function fPe(e){return e&&e.release&&typeof e.release=="function"}function mPe(e){return e&&e.acquire&&typeof e.acquire=="function"}class ao{constructor(t,i,r,s=1,n=0){if(this._ctor=t,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(ao.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...t):mPe(i)&&i.acquire(...t),i}release(t){t&&!ao.test.disabled&&(this._releaseFunction?this._releaseFunction(t):fPe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}ao.test={disabled:!1};class gPe{constructor(t,i){this._observers=t,this._observer=i}remove(){tZ(this._observers,this._observer)}}class Gme{constructor(){this._observers=null,this.destroyed=!1}observe(t){if(this.destroyed||t.destroyed)return yPe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===t){r=!0;break}}return r||(i.push(t),s&&this._removeDestroyedObservers()),new gPe(i,t)}_removeDestroyedObservers(){const t=this._observers;if(!t||t.length===0)return;const i=t.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&t[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;t[s]=t[s+r]}}t.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const t=this._observers;if(t!=null){for(const i of t)i.onCommitted();this._observers=null}}}const yPe={remove:()=>{}};var ar;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(ar||(ar={}));const OG=ar.USER+1;function s1(e){switch(e){case"defaults":return ar.DEFAULTS;case"service":return ar.SERVICE;case"portal-item":return ar.PORTAL_ITEM;case"web-scene":return ar.WEB_SCENE;case"web-map":return ar.WEB_MAP;case"user":return ar.USER;default:return null}}function f5(e){switch(e){case ar.DEFAULTS:return"defaults";case ar.SERVICE:return"service";case ar.PORTAL_ITEM:return"portal-item";case ar.WEB_SCENE:return"web-scene";case ar.WEB_MAP:return"web-map";case ar.USER:return"user"}return void 0}function _Pe(e){return f5(e)}class hie{constructor(t,i,r){this.properties=t,this.propertyName=i,this.metadata=r,this.observerObject=new vPe,this._accessed=null,this._handles=null,this.observerObject.flags=es.Dirty|(r.nonNullable?es.NonNullable:0)|(r.hasOwnProperty("value")?es.HasDefaultValue:0)|(r.get===void 0?es.DepTrackingInitialized:0)|(r.dependsOn===void 0?es.AutoTracked:0),die.register(this,this.observerObject)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles(),die.unregister(this)}getComputed(){const t=this.observerObject;Ai(t);const i=this.properties.store,r=this.propertyName,s=t.flags,n=i.get(r);if(s&es.Computing||~s&es.Dirty&&i.has(r))return n;t.flags|=es.Computing;const o=this.properties.host;let a;s&es.AutoTracked?a=A0(this,this.metadata.get,o):(Lme(o,this),a=this.metadata.get.call(o)),i.set(r,a,ar.COMPUTED);const l=i.get(r);return l===n?t.flags&=~es.Dirty:XIe(this.commit,this),t.flags&=~es.Computing,l}onObservableAccessed(t){t!==this.observerObject&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles();const t=this.observerObject;t.flags|=es.DepTrackingInitialized;const i=this._accessed;if(i===null)return;let r=this._handles;r===null&&(r=this._handles=[]);for(let s=0;s<i.length;++s)r.push(i[s].observe(t));i.length=0}notifyChange(){const t=this.observerObject;t.onInvalidated(),t.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const t=this.observerObject;t.flags&=~es.Dirty,t.onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}}class vPe extends Gme{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&es.Overriden&&(this.flags|=es.Dirty);const t=this._observers;if(t&&t.length>0)for(const i of t)i.onInvalidated()}onCommitted(){const t=this._observers;if(t&&t.length>0){const i=t.slice();for(const r of i)r.onCommitted()}}destroy(){this.flags&es.Dirty&&this.onCommitted(),super.destroy()}}const die=new FinalizationRegistry(e=>{e.destroy()});class mZ{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new mZ;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,ne(r))}),i}get(t){return this._values.get(t)}originOf(){return ar.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function hL(e,t,i){return e!==void 0}function pie(e,t,i,r){return e!==void 0&&(!(i==null&&e.observerObject.flags&es.NonNullable)||(r.lifecycle,r0.INITIALIZING,!1))}function bPe(e){return e&&typeof e.destroy=="function"}se.getLogger("esri.core.accessorSupport.Properties");class wPe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=r0.INITIALIZING,this.store=new mZ,this._origin=ar.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new hie(this,r,i[r]);this.properties.set(r,s)}this.metadatas=i}initialize(){this.lifecycle=r0.CONSTRUCTING}constructed(){this.lifecycle=r0.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[t,i]of this.properties){if(i.metadata.autoDestroy){const r=this.internalGet(t);r&&bPe(r)&&(r.destroy(),~i.observerObject.flags&es.NonNullable&&this._internalSet(i,null))}i.destroy()}}get initialized(){return this.lifecycle!==r0.INITIALIZING}get(t){const i=this.properties.get(t);if(i.metadata.get)return i.getComputed();Ai(i.observerObject);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.properties.get(t);if(r!==void 0&&r.observerObject.flags&es.HasDefaultValue)return"defaults"}return f5(i)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const i=this.properties.get(t);if(hL(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.properties.get(t);hL(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.properties.get(i);if(!hL(s))return"";const n=new Set,o=A0({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${r}${t.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof hie))continue;const c=l.properties.host,h=l.propertyName,p=ml(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(t,i,r){const s=this.properties.get(t);if(hL(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.properties.get(t);return i!==void 0&&!!(i.observerObject.flags&es.Overriden)}clearOverride(t){const i=this.properties.get(t),r=i==null?void 0:i.observerObject;r&&r.flags&es.Overriden&&(r.flags&=~es.Overriden,i.notifyChange())}override(t,i){const r=this.properties.get(t);if(!pie(r,t,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(JV.release(n),!o)return;i=a}r.observerObject.flags|=es.Overriden,this._internalSet(r,i)}set(t,i){const r=this.properties.get(t);if(!pie(r,t,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(JV.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=s1(t)}getDefaultOrigin(){return f5(this._origin)}notifyChange(t){const i=this.properties.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.properties.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.properties.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==r0.INITIALIZING?this._origin:ar.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,n=t.propertyName;s.has(n,r)&&oZ(i,s.get(n))&&~t.observerObject.flags&es.Overriden&&r===s.originOf(n)||(t.invalidate(),s.set(n,i,r),t.commit(),$me(this.host,t))}_cast(t,i){const r=JV.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}}class xPe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const JV=new ao(xPe);function TPe(e){e.length=0}class vu{constructor(t=50,i=50){this._pool=new ao(Array,void 0,TPe,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return KV.acquire()}static release(t){return KV.release(t)}static prune(){KV.prune()}}const KV=new vu(100);class jme extends ao{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=sT(this._set)}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const dL=[];function zC(e){dL.push(e),dL.length===1&&queueMicrotask(()=>{const t=dL.slice();dL.length=0;for(const i of t)i()})}class l0{constructor(t,i=30){this.name=t,this._counter=0,this._samples=new Array(i)}record(t){v(t)&&(this._samples[++this._counter%this._samples.length]=t)}get median(){return this._samples.slice().sort((t,i)=>t-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((t,i)=>t+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}}var IG;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=r,e.iterableSort=s})(IG||(IG={}));const fie=IG,SPe=1.5,EPe=1.1;class ri{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new ume,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>mie(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,i){const r=this.data.indexOf(t,i);return r!==-1&&r<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,mie(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=bG(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){return this.removeUnorderedIndex(bG(this.data,t,this.length,this._hint))}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=mIe(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){if(t>=this.length||i>=this.length||t===i)return;const r=this.data[t];this.data[t]=this.data[i],this.data[i]=r}sort(t){fie.sort(this.data,0,this.length,t)}iterableSort(t){return fie.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}find(t,i){for(let r=0;r<this.length;++r){const s=this.data[r];if(t.call(i,s,r))return s}}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)t.call(i,s[n],n,s)}forEach(t,i){for(let r=0;r<this.length;++r)t.call(i,this.data[r],r,this.data)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}}function mie(e){e.data.length>SPe*e.length&&(e.data.length=Math.floor(e.length*EPe))}function CPe(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return{remove:()=>e.clearTimeout(r)}}}}const L6=CPe(globalThis),gie=new Set;function APe(e,t,i=!1){i&&gie.has(t)||(i&&gie.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function PG(e,t,i={}){if(he("esri-deprecation-warnings")){const{moduleName:r}=i;Hme(e,`Property: ${(r?r+"::":"")+t}`,i)}}function Hme(e,t,i={}){if(he("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=t;r&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${r}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),APe(e,a,o)}}function D6(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function a$(e,t,i){if(!D6(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const s of r)e.addEventListener(s,i);return{remove(){for(const s of r)e.removeEventListener(s,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function qme(e,t,i){if(!D6(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=a$(e,t,s=>{r.remove(),i.call(e,s)});return{remove(){r.remove()}}}const MPe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Pc({key:e}){return MPe[e]||e}function lr(e="Aborted"){return new H("AbortError",e)}function ii(e,t="Aborted"){if(So(e))throw lr(t)}function F6(e){return v(e)?"aborted"in e?e:e.signal:e}function So(e){const t=F6(e);return v(t)&&t.aborted}function bu(e){if(Ws(e))throw e}function $G(e){if(!Ws(e))throw e}function fl(e,t){const i=F6(e);if(!C(i)){if(!i.aborted)return qme(i,"abort",()=>t());t()}}function gZ(e,t){const i=F6(e);if(!C(i))return ii(i),qme(i,"abort",()=>t(lr()))}function yZ(e,t){const i=F6(t);return C(i)?e:new Promise((r,s)=>{let n=fl(t,()=>s(lr()));const o=()=>n=hs(n);e.then(o,o),e.then(r,s)})}function Ws(e){return(e==null?void 0:e.name)==="AbortError"}async function rC(e){try{return await e}catch(t){if(!Ws(t))throw t;return}}async function cAt(e,t=se.getLogger("esri")){try{return await e}catch(i){Ws(i)||t.error(i)}}function V1(){let e=null;const t=new Promise((i,r)=>{e={promise:void 0,resolve:i,reject:r}});return e.promise=t,e}async function Eo(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e),r=i.map(o=>e[o]),s=await Eo(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(i=>{const r=[];let s=t.length;s===0&&i(r),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function LG(e){return(await Eo(e)).filter(t=>!!t.value).map(t=>t.value)}function M0(e,t,i){const r=new AbortController;return fl(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);fl(r,()=>{o&&(clearTimeout(o),n(lr()))})})}function Yh(e){return e&&typeof e.then=="function"}function DG(e){return Yh(e)?e:Promise.resolve(e)}function Wme(e,t=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(lr()),n=V1();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||V1(),n=null,t>0){const f=new AbortController;i=DG(e(...l,f.signal));const m=i;M0(t).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=DG(e(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function B1(){let e,t;const i=new Promise((s,n)=>{e=s,t=n}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,n)=>L6.setTimeout(()=>r.reject(n),s),r.promise=i,r}function uAt(e,t){return e.then(t,t)}async function yie(e){await Promise.resolve(),ii(e)}function hAt(e){return e}function Xme(e){return 1e3*e}function _Z(e){return .001*e}class RPe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class OPe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let FG=0,NG=0;const PM={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},kG=["prepare","preRender","render","postRender","update","finish"],UG=[],nT=new ri;class IPe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const m5={frameTasks:nT,willDispatch:!1,clearFrameTasks:PPe,dispatch:Jme,executeFrameTasks:LPe};function ZA(e){const t=new OPe(e);return UG.push(t),m5.willDispatch||(m5.willDispatch=!0,zC(Jme)),t}function GC(e){const t=new RPe(e);return nT.push(t),g5==null&&(FG=performance.now(),g5=requestAnimationFrame(Yme)),new IPe(t)}let g5=null;function PPe(e=!1){nT.forAll(t=>{t.removed=!0}),e&&Zme()}function $Pe(e){NG=Math.max(0,e)}function Yme(){const e=performance.now();g5=null,g5=nT.length>0?requestAnimationFrame(Yme):null,m5.executeFrameTasks(e)}function LPe(e){const t=e-FG;FG=e;const i=NG>0?NG:1e3/60,r=Math.max(0,t-i);PM.time=e,PM.frameDuration=i-r;for(let s=0;s<kG.length;s++){const n=performance.now(),o=kG[s];nT.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(PM.elapsedFrameTime=performance.now()-e,PM.deltaTime=a.ticks===0?0:t,(l=a.phases[o])==null||l.call(a,PM)))}),DPe[s].record(performance.now()-n)}Zme(),FPe.record(performance.now()-e)}const pL=new ri;function Zme(){nT.forAll(e=>{e.removed&&pL.push(e)}),nT.removeUnorderedMany(pL.data,pL.length),pL.clear()}function Jme(){for(;UG.length;){const e=UG.shift();e.isActive&&e.callback()}m5.willDispatch=!1}function dAt(e=1,t){const i=B1(),r=()=>{So(t)?i.reject(lr()):e===0?i():(--e,zC(()=>r()))};return r(),i.promise}const DPe=kG.map(e=>new l0(e)),FPe=new l0("total");function lN(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}let NPe=0;const kPe=0;function Ru(){return++NPe}class N6{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._observerObject=new UPe(this._notify),_ie.register(this,this._observerObject)}destroy(){var t;this._accessed.length=0,(t=this._observerObject)==null||t.destroy(),this.clear(),_ie.unregister(this)}onObservableAccessed(t){const i=this._accessed;i.includes(t)||i.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed,r=this._observerObject;for(let s=0;s<i.length;++s)t.push(i[s].observe(r));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}class UPe{constructor(t){this._notify=t,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}destroy(){this.destroyed=!0,this._notify=VPe}}const _ie=new FinalizationRegistry(e=>{e.destroy()});function VPe(){}let sC=!1;const y5=[];function Kme(e,t){let i=new N6(n),r=null,s=!1;function n(){if(!i||s)return;if(sC)return void tge(n);const a=r;i.clear(),sC=!0,s=!0,r=A0(i,e),s=!1,sC=!1,t(r,a),ige()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=A0(i,e),s=!1,{remove:o}}function Qme(e,t){let i=new N6(s),r=null;function s(){t(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=A0(i,e),r):null}return o(),{remove:n}}function ege(e){let t=new N6(r),i=!1;function r(){t&&!i&&(sC?tge(r):(t.clear(),sC=!0,i=!0,A0(t,e),i=!1,sC=!1,ige()))}function s(){t&&(t.destroy(),t=null)}return i=!0,A0(t,e),i=!1,{remove:s}}function tge(e){y5.includes(e)||y5.unshift(e)}function ige(){for(;y5.length;)y5.pop()()}var b3;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(b3||(b3={}));class EI{constructor(){this.uid=Ru(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,n){return this.pool.acquire(b3.Untracked,t,i,r,s,n,oZ)}static acquireTracked(t,i,r,s){return this.pool.acquire(b3.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===b3.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i)}acquire(t,i,r,s,n,o,a){this.uid=Ru(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Ru(),this.removed=!0}}EI.pool=new jme(EI);const cN=new vu,d0=new Set;let _5;function v5(e){d0.delete(e),d0.add(e),_5||(_5=ZA(GPe))}function BPe(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function zPe(e){for(const t of d0.values())t.target===e&&(t.removed=!0)}function GPe(){let e=10;for(;_5&&e--;){_5=null;const t=jPe(),i=cN.acquire();for(const r of t){const s=r.uid;BPe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of d0)r.removed&&(i.push(r),d0.delete(r));for(const r of i)EI.pool.release(r);cN.release(i),cN.release(t),VG.forEach(r=>r())}}function jPe(){const e=cN.acquire();e.length=d0.size;let t=0;for(const i of d0)e[t]=i,++t;return d0.clear(),e}const VG=new Set;function rge(e){return VG.add(e),{remove(){VG.delete(e)}}}function HPe(e,t,i){let r=Cme(e,t,i,(s,n,o)=>{let a,l,c=Qme(()=>n$(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=EI.acquireUntracked(h,o,p,s,n),l=a.uid),v5(a))});return{remove:uZ(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,v5(a)),a=null),r=c=null})}});return r}function qPe(e,t,i){const r=Cme(e,t,i,(s,n,o)=>{let a=!1;return Kme(()=>n$(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,oZ(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function WPe(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?qPe(e,t,i):HPe(e,t,i)}function XPe(e,t,i){let r,s,n=Qme(e,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=EI.acquireTracked(o,t,a,i),s=r.uid),v5(r))});return{remove:uZ(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,v5(r)),r=null),n=null})}}function YPe(e,t,i){let r=!1;return Kme(e,(s,n)=>{r||(r=!0,i(n,s)||t(s,n),r=!1)})}function ZPe(e,t,i=!1,r=xIe){return i?YPe(e,t,r):XPe(e,t,r)}function vie(e){return lN(d0,t=>t.oldValue===e)}var sge,nge;function JPe(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const pw=Symbol("Accessor-Handles"),BG=Symbol("Accessor-Initialized");class Te{static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}o$(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:t[a]}for(const a in i){const l=JPe(i[a]);d(l)(o.prototype,a)}return P(r)(o)}constructor(...t){if(this[sge]=null,this[nge]=!1,this.constructor===Te)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new wPe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize(),this[BG]=!0}initialize(){}[Ome](){this[pw]=Be(this[pw])}destroy(){this.destroyed||(zPe(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[BG]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return c5(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return u5(this,t,i),this}watch(t,i,r){return WPe(this,t,i,r)}own(t){this.addHandles(t)}addHandles(t,i){let r=this[pw];C(r)&&(r=this[pw]=new Ii),r.add(t,i)}removeHandles(t){const i=this[pw];C(i)||i.remove(t)}hasHandles(t){const i=this[pw];return!!v(i)&&i.has(t)}_override(t,i){i===void 0?this.__accessor__.clearOverride(t):this.__accessor__.override(t,i)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_overrideIfSome(t,i){i==null?this.__accessor__.clearOverride(t):this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}}sge=pw,nge=BG;class vZ{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new vZ;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,ne(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i,r;return(r=(i=this._values.get(t))==null?void 0:i.origin)!=null?r:ar.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===ar.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(t,new KPe(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===ar.DEFAULTS?t:ar.USER}}class KPe{constructor(t,i){this.value=t,this.origin=i}}function oge(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),ar.DEFAULTS)});const r=e.metadatas;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),ar.DEFAULTS)})}function QPe(e,t,i){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.includes(".")&&r.indexOf(t)===0&&rie(r,i))return!0}else for(const s of r)if(s===t||s.includes(".")&&s.indexOf(t)===0&&rie(s,i))return!0;return!1}function e$e(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function t$e(e,t,i,r,s){let n=AG(t[i],s);e$e(n)&&(e[i]=!0);for(const o of Object.getOwnPropertyNames(t))n=AG(t[o],s),QPe(n,i,r)&&(e[o]=!0)}function i$e(e,t,i,r){const s=i.metadatas,n=fZ(s[t],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,r):o;a!==void 0&&i.set(t,a)}const age={origin:"service"};function lge(e,t,i=age){if(!t||typeof t!="object")return;const r=ml(e),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))t$e(n,s,o,t,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=AG(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?n$(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||i$e(e,o,r,i)}r.setDefaultOrigin("user")}function r$e(e,t,i,r=age){var n;const s={...r,messages:[]};i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?r&&r.messages&&r.messages.push(o):e.loadWarnings.push(o)})}function s$e(e,t,i,r,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,r,n,i,s),n}function cge(e,t,i,r,s,n){if(!r||!r.write)return!1;const o=e.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(e,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new H("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&se.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===ar.DEFAULTS)&&n$e(e,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<s1(n.origin))}function n$e(e,t,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,i);return xg(o,s)}return!1}return n===s}function o$e(e,t,i,r){const s=ml(e),n=s.metadatas,o=Bme(n[t],r);return!!o&&cge(e,s,t,o,i,r)}function uge(e,t,i){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return nN(t,e.toJSON(i));const r=ml(e),s=r.metadatas;for(const a in s){const l=Bme(s[a],i);if(!cge(e,r,a,l,void 0,i))continue;const c=e.get(a),h=s$e(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(t=nN(t,h),(o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>nN(t,h,()=>"replace-arrays"))),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:a,oldOrigin:_Pe(r.store.originOf(a)),newOrigin:i.origin}))}return t}const l$=e=>{let t=class extends e{constructor(...i){super(...i);const r=ml(this),s=r.store,n=new vZ;r.store=n,oge(r,s,n)}read(i,r){lge(this,i,r)}write(i={},r){return uge(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return a$e.call(this,i,r)}};return t=u([P("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function a$e(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let ge=class extends l$(Te){};ge=u([P("esri.core.JSONSupport")],ge);function Fe(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=Rme(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}class _i{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=t,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&Sa(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(t==null)return null;if(this._apiToJSON.hasOwnProperty(t)){const i=this._apiToJSON[t];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:t}fromJSON(t){return t!=null&&this._jsonToAPI.hasOwnProperty(t)?this._jsonToAPI[t]:this._options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}}function bl(){return function(e,t){return new _i(e,{ignoreUnknown:!0,...t})}}class bZ{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const Mi=new bZ(6378137,1/298.257223563,3e5,.006694379990137799),hg=new bZ(3396190,1/169.8944472236118,23e4),R0=new bZ(1737400,0,0);var Gd;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(Gd||(Gd={}));let g;const F={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)F[g]=0;for(g=2056;g<=2065;g++)F[g]=0;for(g=2067;g<=2135;g++)F[g]=0;for(g=2137;g<=2154;g++)F[g]=0;for(g=2161;g<=2170;g++)F[g]=0;for(g=2172;g<=2193;g++)F[g]=0;for(g=2195;g<=2198;g++)F[g]=0;for(g=2200;g<=2203;g++)F[g]=0;for(g=2205;g<=2217;g++)F[g]=0;for(g=2222;g<=2224;g++)F[g]=1;for(g=2225;g<=2250;g++)F[g]=2;for(g=2251;g<=2253;g++)F[g]=1;for(g=2257;g<=2264;g++)F[g]=2;for(g=2274;g<=2279;g++)F[g]=2;for(g=2280;g<=2282;g++)F[g]=1;for(g=2283;g<=2289;g++)F[g]=2;for(g=2290;g<=2292;g++)F[g]=0;for(g=2308;g<=2313;g++)F[g]=0;for(g=2315;g<=2491;g++)F[g]=0;for(g=2494;g<=2866;g++)F[g]=0;for(g=2867;g<=2869;g++)F[g]=1;for(g=2870;g<=2888;g++)F[g]=2;for(g=2891;g<=2895;g++)F[g]=2;for(g=2896;g<=2898;g++)F[g]=1;for(g=2902;g<=2908;g++)F[g]=2;for(g=2915;g<=2920;g++)F[g]=2;for(g=2921;g<=2923;g++)F[g]=1;for(g=2924;g<=2930;g++)F[g]=2;for(g=2931;g<=2962;g++)F[g]=0;for(g=2964;g<=2968;g++)F[g]=2;for(g=2969;g<=2973;g++)F[g]=0;for(g=2975;g<=2991;g++)F[g]=0;for(g=2995;g<=3051;g++)F[g]=0;for(g=3054;g<=3079;g++)F[g]=0;for(g=3081;g<=3088;g++)F[g]=0;for(g=3092;g<=3101;g++)F[g]=0;for(g=3106;g<=3138;g++)F[g]=0;for(g=3146;g<=3151;g++)F[g]=0;for(g=3153;g<=3166;g++)F[g]=0;for(g=3168;g<=3172;g++)F[g]=0;for(g=3174;g<=3203;g++)F[g]=0;for(g=3294;g<=3358;g++)F[g]=0;for(g=3367;g<=3403;g++)F[g]=0;for(g=3408;g<=3416;g++)F[g]=0;for(g=3417;g<=3438;g++)F[g]=2;for(g=3441;g<=3446;g++)F[g]=2;for(g=3447;g<=3450;g++)F[g]=0;for(g=3451;g<=3459;g++)F[g]=2;for(g=3460;g<=3478;g++)F[g]=0;for(g=3554;g<=3559;g++)F[g]=0;for(g=3560;g<=3570;g++)F[g]=2;for(g=3571;g<=3581;g++)F[g]=0;for(g=3594;g<=3597;g++)F[g]=0;for(g=3601;g<=3604;g++)F[g]=0;for(g=3637;g<=3639;g++)F[g]=0;for(g=3665;g<=3667;g++)F[g]=0;for(g=3693;g<=3695;g++)F[g]=0;for(g=3701;g<=3727;g++)F[g]=0;for(g=3728;g<=3739;g++)F[g]=2;for(g=3740;g<=3751;g++)F[g]=0;for(g=3753;g<=3760;g++)F[g]=2;for(g=3761;g<=3773;g++)F[g]=0;for(g=3775;g<=3777;g++)F[g]=0;for(g=3779;g<=3781;g++)F[g]=0;for(g=3783;g<=3785;g++)F[g]=0;for(g=3788;g<=3791;g++)F[g]=0;for(g=3797;g<=3802;g++)F[g]=0;for(g=3814;g<=3816;g++)F[g]=0;for(g=3825;g<=3829;g++)F[g]=0;for(g=3832;g<=3841;g++)F[g]=0;for(g=3844;g<=3852;g++)F[g]=0;for(g=3873;g<=3885;g++)F[g]=0;for(g=3890;g<=3893;g++)F[g]=0;for(g=3907;g<=3912;g++)F[g]=0;for(g=3942;g<=3950;g++)F[g]=0;for(g=3968;g<=3970;g++)F[g]=0;for(g=3973;g<=3976;g++)F[g]=0;for(g=3986;g<=3989;g++)F[g]=0;for(g=3994;g<=3997;g++)F[g]=0;for(g=4048;g<=4051;g++)F[g]=0;for(g=4056;g<=4063;g++)F[g]=0;for(g=4093;g<=4096;g++)F[g]=0;for(g=4390;g<=4398;g++)F[g]=0;for(g=4399;g<=4413;g++)F[g]=2;for(g=4418;g<=4433;g++)F[g]=2;for(g=4455;g<=4457;g++)F[g]=2;for(g=4484;g<=4489;g++)F[g]=0;for(g=4491;g<=4554;g++)F[g]=0;for(g=4568;g<=4589;g++)F[g]=0;for(g=4652;g<=4656;g++)F[g]=0;for(g=4766;g<=4800;g++)F[g]=0;for(g=5014;g<=5016;g++)F[g]=0;for(g=5069;g<=5072;g++)F[g]=0;for(g=5105;g<=5130;g++)F[g]=0;for(g=5173;g<=5188;g++)F[g]=0;for(g=5253;g<=5259;g++)F[g]=0;for(g=5269;g<=5275;g++)F[g]=0;for(g=5292;g<=5311;g++)F[g]=0;for(g=5329;g<=5331;g++)F[g]=0;for(g=5343;g<=5349;g++)F[g]=0;for(g=5355;g<=5357;g++)F[g]=0;for(g=5387;g<=5389;g++)F[g]=0;for(g=5459;g<=5463;g++)F[g]=0;for(g=5479;g<=5482;g++)F[g]=0;for(g=5518;g<=5520;g++)F[g]=0;for(g=5530;g<=5539;g++)F[g]=0;for(g=5550;g<=5552;g++)F[g]=0;for(g=5562;g<=5583;g++)F[g]=0;for(g=5623;g<=5625;g++)F[g]=2;for(g=5631;g<=5639;g++)F[g]=0;for(g=5649;g<=5653;g++)F[g]=0;for(g=5663;g<=5680;g++)F[g]=0;for(g=5682;g<=5685;g++)F[g]=0;for(g=5875;g<=5877;g++)F[g]=0;for(g=5896;g<=5899;g++)F[g]=0;for(g=5921;g<=5940;g++)F[g]=0;for(g=6050;g<=6125;g++)F[g]=0;for(g=6244;g<=6275;g++)F[g]=0;for(g=6328;g<=6348;g++)F[g]=0;for(g=6350;g<=6356;g++)F[g]=0;for(g=6366;g<=6372;g++)F[g]=0;for(g=6381;g<=6387;g++)F[g]=0;for(g=6393;g<=6404;g++)F[g]=0;for(g=6480;g<=6483;g++)F[g]=0;for(g=6511;g<=6514;g++)F[g]=0;for(g=6579;g<=6581;g++)F[g]=0;for(g=6619;g<=6624;g++)F[g]=0;for(g=6625;g<=6627;g++)F[g]=2;for(g=6628;g<=6632;g++)F[g]=0;for(g=6634;g<=6637;g++)F[g]=0;for(g=6669;g<=6692;g++)F[g]=0;for(g=6707;g<=6709;g++)F[g]=0;for(g=6720;g<=6723;g++)F[g]=0;for(g=6732;g<=6738;g++)F[g]=0;for(g=6931;g<=6933;g++)F[g]=0;for(g=6956;g<=6959;g++)F[g]=0;for(g=7005;g<=7007;g++)F[g]=0;for(g=7057;g<=7070;g++)F[g]=2;for(g=7074;g<=7082;g++)F[g]=0;for(g=7109;g<=7118;g++)F[g]=0;for(g=7119;g<=7127;g++)F[g]=1;for(g=7374;g<=7376;g++)F[g]=0;for(g=7528;g<=7586;g++)F[g]=0;for(g=7587;g<=7645;g++)F[g]=2;for(g=7692;g<=7696;g++)F[g]=0;for(g=7755;g<=7787;g++)F[g]=0;for(g=7791;g<=7795;g++)F[g]=0;for(g=7799;g<=7801;g++)F[g]=0;for(g=7803;g<=7805;g++)F[g]=0;for(g=7825;g<=7831;g++)F[g]=0;for(g=7845;g<=7859;g++)F[g]=0;for(g=8013;g<=8032;g++)F[g]=0;for(g=8065;g<=8068;g++)F[g]=1;for(g=8518;g<=8529;g++)F[g]=2;for(g=8533;g<=8536;g++)F[g]=2;for(g=8538;g<=8540;g++)F[g]=2;for(g=8677;g<=8679;g++)F[g]=0;for(g=8836;g<=8840;g++)F[g]=0;for(g=8857;g<=8859;g++)F[g]=0;for(g=8908;g<=8910;g++)F[g]=0;for(g=9154;g<=9159;g++)F[g]=0;for(g=9205;g<=9218;g++)F[g]=0;for(g=9271;g<=9273;g++)F[g]=0;for(g=9295;g<=9297;g++)F[g]=0;for(g=9356;g<=9360;g++)F[g]=0;for(g=9404;g<=9407;g++)F[g]=0;for(g=9476;g<=9482;g++)F[g]=0;for(g=9487;g<=9494;g++)F[g]=0;for(g=9697;g<=9699;g++)F[g]=0;for(g=9821;g<=9865;g++)F[g]=0;for(g=20002;g<=20032;g++)F[g]=0;for(g=20047;g<=20049;g++)F[g]=0;for(g=20062;g<=20092;g++)F[g]=0;for(g=20135;g<=20138;g++)F[g]=0;for(g=20248;g<=20258;g++)F[g]=0;for(g=20348;g<=20358;g++)F[g]=0;for(g=20436;g<=20440;g++)F[g]=0;for(g=20822;g<=20824;g++)F[g]=0;for(g=20904;g<=20932;g++)F[g]=0;for(g=20934;g<=20936;g++)F[g]=0;for(g=21004;g<=21032;g++)F[g]=0;for(g=21035;g<=21037;g++)F[g]=0;for(g=21095;g<=21097;g++)F[g]=0;for(g=21148;g<=21150;g++)F[g]=0;for(g=21207;g<=21264;g++)F[g]=0;for(g=21307;g<=21364;g++)F[g]=0;for(g=21413;g<=21423;g++)F[g]=0;for(g=21453;g<=21463;g++)F[g]=0;for(g=21473;g<=21483;g++)F[g]=0;for(g=21780;g<=21782;g++)F[g]=0;for(g=21891;g<=21894;g++)F[g]=0;for(g=21896;g<=21899;g++)F[g]=0;for(g=22171;g<=22177;g++)F[g]=0;for(g=22181;g<=22187;g++)F[g]=0;for(g=22191;g<=22197;g++)F[g]=0;for(g=22207;g<=22222;g++)F[g]=0;for(g=22234;g<=22236;g++)F[g]=0;for(g=22243;g<=22250;g++)F[g]=0;for(g=22262;g<=22265;g++)F[g]=0;for(g=22307;g<=22322;g++)F[g]=0;for(g=22348;g<=22357;g++)F[g]=0;for(g=22407;g<=22422;g++)F[g]=0;for(g=22462;g<=22465;g++)F[g]=0;for(g=22521;g<=22525;g++)F[g]=0;for(g=22607;g<=22622;g++)F[g]=0;for(g=22641;g<=22646;g++)F[g]=0;for(g=22648;g<=22657;g++)F[g]=0;for(g=22707;g<=22722;g++)F[g]=0;for(g=22762;g<=22765;g++)F[g]=0;for(g=22991;g<=22994;g++)F[g]=0;for(g=23028;g<=23038;g++)F[g]=0;for(g=23830;g<=23853;g++)F[g]=0;for(g=23866;g<=23872;g++)F[g]=0;for(g=23877;g<=23884;g++)F[g]=0;for(g=23886;g<=23894;g++)F[g]=0;for(g=23946;g<=23948;g++)F[g]=0;for(g=24311;g<=24313;g++)F[g]=0;for(g=24342;g<=24347;g++)F[g]=0;for(g=24370;g<=24374;g++)F[g]=10;for(g=24375;g<=24381;g++)F[g]=0;for(g=24718;g<=24721;g++)F[g]=0;for(g=24817;g<=24821;g++)F[g]=0;for(g=24877;g<=24882;g++)F[g]=0;for(g=24891;g<=24893;g++)F[g]=0;for(g=25391;g<=25395;g++)F[g]=0;for(g=25828;g<=25838;g++)F[g]=0;for(g=26191;g<=26195;g++)F[g]=0;for(g=26391;g<=26393;g++)F[g]=0;for(g=26701;g<=26722;g++)F[g]=0;for(g=26729;g<=26799;g++)F[g]=2;for(g=26801;g<=26803;g++)F[g]=2;for(g=26811;g<=26813;g++)F[g]=2;for(g=26847;g<=26870;g++)F[g]=2;for(g=26891;g<=26899;g++)F[g]=0;for(g=26901;g<=26923;g++)F[g]=0;for(g=26929;g<=26946;g++)F[g]=0;for(g=26948;g<=26998;g++)F[g]=0;for(g=27037;g<=27040;g++)F[g]=0;for(g=27205;g<=27232;g++)F[g]=0;for(g=27258;g<=27260;g++)F[g]=0;for(g=27391;g<=27398;g++)F[g]=0;for(g=27561;g<=27564;g++)F[g]=0;for(g=27571;g<=27574;g++)F[g]=0;for(g=27581;g<=27584;g++)F[g]=0;for(g=27591;g<=27594;g++)F[g]=0;for(g=28191;g<=28193;g++)F[g]=0;for(g=28348;g<=28358;g++)F[g]=0;for(g=28402;g<=28432;g++)F[g]=0;for(g=28462;g<=28492;g++)F[g]=0;for(g=29118;g<=29122;g++)F[g]=0;for(g=29168;g<=29172;g++)F[g]=0;for(g=29177;g<=29185;g++)F[g]=0;for(g=29187;g<=29195;g++)F[g]=0;for(g=29900;g<=29903;g++)F[g]=0;for(g=30161;g<=30179;g++)F[g]=0;for(g=30491;g<=30494;g++)F[g]=0;for(g=30729;g<=30732;g++)F[g]=0;for(g=31251;g<=31259;g++)F[g]=0;for(g=31265;g<=31268;g++)F[g]=0;for(g=31275;g<=31279;g++)F[g]=0;for(g=31281;g<=31297;g++)F[g]=0;for(g=31461;g<=31469;g++)F[g]=0;for(g=31491;g<=31495;g++)F[g]=0;for(g=31917;g<=31922;g++)F[g]=0;for(g=31965;g<=32e3;g++)F[g]=0;for(g=32001;g<=32003;g++)F[g]=2;for(g=32005;g<=32031;g++)F[g]=2;for(g=32033;g<=32060;g++)F[g]=2;for(g=32064;g<=32067;g++)F[g]=2;for(g=32074;g<=32077;g++)F[g]=2;for(g=32081;g<=32086;g++)F[g]=0;for(g=32107;g<=32130;g++)F[g]=0;for(g=32133;g<=32159;g++)F[g]=0;for(g=32164;g<=32167;g++)F[g]=2;for(g=32180;g<=32199;g++)F[g]=0;for(g=32201;g<=32260;g++)F[g]=0;for(g=32301;g<=32360;g++)F[g]=0;for(g=32601;g<=32662;g++)F[g]=0;for(g=32664;g<=32667;g++)F[g]=2;for(g=32701;g<=32761;g++)F[g]=0;for(g=53001;g<=53004;g++)F[g]=0;for(g=53008;g<=53019;g++)F[g]=0;for(g=53021;g<=53032;g++)F[g]=0;for(g=53034;g<=53037;g++)F[g]=0;for(g=53042;g<=53046;g++)F[g]=0;for(g=53074;g<=53080;g++)F[g]=0;for(g=54001;g<=54004;g++)F[g]=0;for(g=54008;g<=54019;g++)F[g]=0;for(g=54021;g<=54032;g++)F[g]=0;for(g=54034;g<=54037;g++)F[g]=0;for(g=54042;g<=54046;g++)F[g]=0;for(g=54048;g<=54053;g++)F[g]=0;for(g=54074;g<=54080;g++)F[g]=0;for(g=54098;g<=54101;g++)F[g]=0;for(g=102001;g<=102040;g++)F[g]=0;for(g=102042;g<=102063;g++)F[g]=0;for(g=102065;g<=102067;g++)F[g]=0;for(g=102070;g<=102117;g++)F[g]=0;for(g=102122;g<=102216;g++)F[g]=0;for(g=102221;g<=102377;g++)F[g]=0;for(g=102382;g<=102388;g++)F[g]=0;for(g=102389;g<=102398;g++)F[g]=2;for(g=102399;g<=102444;g++)F[g]=0;for(g=102445;g<=102447;g++)F[g]=2;for(g=102448;g<=102458;g++)F[g]=0;for(g=102459;g<=102468;g++)F[g]=2;for(g=102469;g<=102499;g++)F[g]=0;for(g=102500;g<=102519;g++)F[g]=1;for(g=102520;g<=102524;g++)F[g]=0;for(g=102525;g<=102529;g++)F[g]=2;for(g=102530;g<=102588;g++)F[g]=0;for(g=102590;g<=102598;g++)F[g]=0;for(g=102601;g<=102603;g++)F[g]=0;for(g=102605;g<=102628;g++)F[g]=0;for(g=102629;g<=102646;g++)F[g]=2;for(g=102648;g<=102700;g++)F[g]=2;for(g=102701;g<=102703;g++)F[g]=0;for(g=102707;g<=102730;g++)F[g]=2;for(g=102733;g<=102758;g++)F[g]=2;for(g=102767;g<=102900;g++)F[g]=0;for(g=102901;g<=102933;g++)F[g]=2;for(g=102934;g<=102950;g++)F[g]=13;for(g=102951;g<=102955;g++)F[g]=0;for(g=102961;g<=102963;g++)F[g]=0;for(g=102965;g<=102969;g++)F[g]=0;for(g=102971;g<=102973;g++)F[g]=0;for(g=102975;g<=102989;g++)F[g]=0;for(g=102990;g<=102992;g++)F[g]=1;for(g=102997;g<=103002;g++)F[g]=0;for(g=103003;g<=103008;g++)F[g]=2;for(g=103009;g<=103011;g++)F[g]=0;for(g=103012;g<=103014;g++)F[g]=2;for(g=103019;g<=103021;g++)F[g]=0;for(g=103022;g<=103024;g++)F[g]=2;for(g=103029;g<=103031;g++)F[g]=0;for(g=103032;g<=103034;g++)F[g]=2;for(g=103065;g<=103068;g++)F[g]=0;for(g=103074;g<=103076;g++)F[g]=0;for(g=103077;g<=103079;g++)F[g]=1;for(g=103080;g<=103082;g++)F[g]=0;for(g=103083;g<=103085;g++)F[g]=2;for(g=103090;g<=103093;g++)F[g]=0;for(g=103097;g<=103099;g++)F[g]=0;for(g=103100;g<=103102;g++)F[g]=2;for(g=103107;g<=103109;g++)F[g]=0;for(g=103110;g<=103112;g++)F[g]=2;for(g=103113;g<=103116;g++)F[g]=0;for(g=103117;g<=103120;g++)F[g]=2;for(g=103153;g<=103157;g++)F[g]=0;for(g=103158;g<=103162;g++)F[g]=2;for(g=103163;g<=103165;g++)F[g]=0;for(g=103166;g<=103168;g++)F[g]=1;for(g=103169;g<=103171;g++)F[g]=2;for(g=103186;g<=103188;g++)F[g]=0;for(g=103189;g<=103191;g++)F[g]=2;for(g=103192;g<=103195;g++)F[g]=0;for(g=103196;g<=103199;g++)F[g]=2;for(g=103200;g<=103224;g++)F[g]=0;for(g=103225;g<=103227;g++)F[g]=1;for(g=103232;g<=103237;g++)F[g]=0;for(g=103238;g<=103243;g++)F[g]=2;for(g=103244;g<=103246;g++)F[g]=0;for(g=103247;g<=103249;g++)F[g]=2;for(g=103254;g<=103256;g++)F[g]=0;for(g=103257;g<=103259;g++)F[g]=2;for(g=103264;g<=103266;g++)F[g]=0;for(g=103267;g<=103269;g++)F[g]=2;for(g=103300;g<=103375;g++)F[g]=0;for(g=103381;g<=103383;g++)F[g]=0;for(g=103384;g<=103386;g++)F[g]=1;for(g=103387;g<=103389;g++)F[g]=0;for(g=103390;g<=103392;g++)F[g]=2;for(g=103397;g<=103399;g++)F[g]=0;for(g=103400;g<=103471;g++)F[g]=2;for(g=103476;g<=103478;g++)F[g]=0;for(g=103479;g<=103481;g++)F[g]=2;for(g=103486;g<=103488;g++)F[g]=0;for(g=103489;g<=103491;g++)F[g]=2;for(g=103492;g<=103495;g++)F[g]=0;for(g=103496;g<=103499;g++)F[g]=2;for(g=103528;g<=103543;g++)F[g]=0;for(g=103544;g<=103548;g++)F[g]=2;for(g=103549;g<=103551;g++)F[g]=0;for(g=103552;g<=103554;g++)F[g]=1;for(g=103555;g<=103557;g++)F[g]=2;for(g=103558;g<=103560;g++)F[g]=0;for(g=103571;g<=103573;g++)F[g]=0;for(g=103574;g<=103576;g++)F[g]=2;for(g=103577;g<=103580;g++)F[g]=0;for(g=103581;g<=103583;g++)F[g]=2;for(g=103595;g<=103694;g++)F[g]=0;for(g=103696;g<=103699;g++)F[g]=0;for(g=103700;g<=103793;g++)F[g]=2;for(g=103794;g<=103890;g++)F[g]=0;for(g=103891;g<=103896;g++)F[g]=2;for(g=103900;g<=103971;g++)F[g]=2;for(g=103972;g<=103977;g++)F[g]=0;for(g=112e3;g<=112101;g++)F[g]=0;const l$e={102113:!0,102100:!0,3857:!0,3785:!0},c$e={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},bie='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',fL=[-20037508342788905e-9,20037508342788905e-9],mL=[-20037508342787e-6,20037508342787e-6],hge={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:fL,origin:mL,dx:1e-5},102100:{wkTemplate:bie,valid:fL,origin:mL,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:fL,origin:mL,dx:1e-5},3857:{wkTemplate:bie,valid:fL,origin:mL,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function kn(e,t){return e===t||!C(e)&&!C(t)&&(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||oT(e)&&oT(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase())}function E1(e){return hl(e)&&e.wkid&&hge[e.wkid]||null}function dge(e){return!!hl(e)&&(e.wkid?F[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function CI(e){return!(Fg(e)||Ng(e))}function AI(e){return hl(e)&&e.wkid===4326}function pge(e){return hl(e)&&e.wkid===Gd.CGCS2000}function oT(e){return hl(e)&&e.wkid!=null&&l$e[e.wkid]===!0}function wZ(e){return hl(e)&&e.wkid===32662}function xZ(e){return e===Gd.GCSMARS2000||e===Gd.GCSMARS2000_SPHERE}function Fg(e){return hl(e)&&e.wkid!=null&&xZ(e.wkid)}function TZ(e){return e===Gd.GCSMOON2000}function Ng(e){return hl(e)&&e.wkid!=null&&TZ(e.wkid)}function u$e(e){return hl(e)&&e.wkid!=null&&c$e[e.wkid]===!0}function hl(e){return v(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const h$e={wkid:4326,wkt:Sg(hge[4326].wkTemplate,{Central_Meridian:"0.0"})},d$e={wkid:102100,latestWkid:3857},p$e={wkid:32662};function SZ(e){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const fge=SZ(Mi),EZ=SZ(hg),CZ=SZ(R0),mge={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Mi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function dr(e){return v(e)&&(Fg(e)||kn(e,EZ))?hg:v(e)&&(Ng(e)||kn(e,CZ))?R0:Mi}function pAt(e){return xZ(e)?hg:TZ(e)?R0:Mi}const AZ=39.37,f$e=Mi.radius*Math.PI/200,gge=/UNIT\[([^\]]+)\]\]$/i,Gx=F,yge=/UNIT\[([^\]]+)\]/i,m$e=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),g$e=bl()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Zf=e=>e*e,d_=e=>e*e*e,MI={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Zf(.001)},"square-centimeters":{inBaseUnits:Zf(.01)},"square-decimeters":{inBaseUnits:Zf(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Zf(1e3)},"square-inches":{inBaseUnits:Zf(.0254)},"square-feet":{inBaseUnits:Zf(.3048)},"square-yards":{inBaseUnits:Zf(.9144)},"square-miles":{inBaseUnits:Zf(1609.344)},"square-us-feet":{inBaseUnits:Zf(1200/3937)},acres:{inBaseUnits:.0015625*Zf(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*d_(.001)},"cubic-centimeters":{inBaseUnits:1e3*d_(.01)},"cubic-decimeters":{inBaseUnits:1e3*d_(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*d_(1e3)},"cubic-inches":{inBaseUnits:1e3*d_(.0254)},"cubic-feet":{inBaseUnits:1e3*d_(.3048)},"cubic-yards":{inBaseUnits:1e3*d_(.9144)},"cubic-miles":{inBaseUnits:1e3*d_(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},y$e=(()=>{const e={};for(const t in MI)for(const i in MI[t].units)e[i]=t;return e})();function _$e(e,t,i){return e*MI[i].units[t].inBaseUnits}function v$e(e,t,i){return e/MI[i].units[t].inBaseUnits}const b$e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function zG(e){const t=y$e[e];if(!t)throw new Error("unknown type");return t}function wie(e,t=null){return t=t||zG(e),MI[t].baseUnit===e}function to(e,t,i){if(t===i)return e;const r=zG(t);if(r!==zG(i))throw new Error("incompatible units");const s=wie(t,r)?e:_$e(e,t,r);return wie(i,r)?s:v$e(s,i,r)}function fAt(e,t,i){switch(i){case"metric":return _ge(e,t);case"imperial":return bge(e,t);default:return i}}function mAt(e,t,i){switch(i){case"metric":return vge(e,t);case"imperial":return wge(e,t);default:return i}}function _ge(e,t){const i=to(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function vge(e,t){const i=to(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function bge(e,t){const i=to(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function wge(e,t){const i=to(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function gAt(e,t){const i=to(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function yAt(e,t){const i=to(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function w$e(e,t,i){return to(e,t,"meters")/(i*Math.PI/180)}function xge(e){return g$e.fromJSON(e.toLowerCase())||null}function aT(e){if(v(e)&&!CI(e))return 1;const t=wl(e);return t>1e5?1:t}function x$e(e){return wl(e)>=dr(e).metersPerDegree?"meters":k6(e)}function wl(e,t=Mi.metersPerDegree){return Ft(T$e(e,!0),t)}function T$e(e,t=!1){const i=v(e)?e.wkid:null,r=v(e)?e.wkt:null;let s=null;if(i){if(xZ(i))return hg.metersPerDegree;if(TZ(i))return R0.metersPerDegree;s=Gx.values[Gx[i]],!s&&t&&m$e.has(i)&&(s=f$e)}else r&&(Ege(r)?s=xie(gge.exec(r),s):Sge(r)&&(s=xie(yge.exec(r),s)));return s}function xie(e,t){return e&&e[1]?Tge(e[1]):t}function Tge(e){return parseFloat(e.split(",")[1])}function k6(e){const t=v(e)?e.wkid:null,i=v(e)?e.wkt:null;let r=null;if(t)r=Gx.units[Gx[t]];else if(i){const s=Ege(i)?gge:Sge(i)?yge:null;if(s){const n=s.exec(i);n&&n[1]&&(r=E$e(n[1]))}}return v(r)?xge(r):null}function _At(e){const t=k6(e);return C(t)||!b$e.includes(t)?null:t}function Sge(e){return/^GEOCCS/i.test(e)}function Ege(e){return/^PROJCS/i.test(e)}const S$e=1e-7;function E$e(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!Gx.units.includes(i)){const r=Tge(e);i=null;const s=Gx.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<S$e){i=Gx.units[n];break}}return i}function vAt(e){const t=k6(e);if(C(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const C$e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},A$e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},M$e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},R$e=bl()(C$e),O$e=bl()(A$e),bAt=bl()(M$e);function Ge(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=Rme(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}var mm;let Hr=mm=class extends ge{static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return mm.WebMercator;if(e.wkid===4326)return mm.WGS84}const t=new mm;return t.read(e),t}constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return AI(this)}get isWebMercator(){return oT(this)}get isGeographic(){return dge(this)}get isWrappable(){return u$e(this)}get metersPerUnit(){return wl(this)}get unit(){return k6(this)||(this.isGeographic?"degrees":null)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===mm.WGS84)return mm.WGS84;if(this===mm.WebMercator)return mm.WebMercator;const e=new mm;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=ne(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return kn(this,e)}toJSON(e){return this.write(void 0,e)}};Hr.GCS_NAD_1927=null,Hr.WGS84=null,Hr.WebMercator=null,Hr.PlateCarree=null,u([d({readOnly:!0})],Hr.prototype,"isWGS84",null),u([d({readOnly:!0})],Hr.prototype,"isWebMercator",null),u([d({readOnly:!0})],Hr.prototype,"isGeographic",null),u([d({readOnly:!0})],Hr.prototype,"isWrappable",null),u([d({type:us,json:{write:!0}})],Hr.prototype,"latestWkid",void 0),u([d({readOnly:!0})],Hr.prototype,"metersPerUnit",null),u([d({readOnly:!0})],Hr.prototype,"unit",null),u([d({type:us,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Hr.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Hr.prototype,"wkt",void 0),u([Ge("wkt"),Ge("web-scene","wkt")],Hr.prototype,"writeWkt",null),u([d({type:us,json:{write:!0}})],Hr.prototype,"vcsWkid",void 0),u([d({type:us,json:{write:!0}})],Hr.prototype,"latestVcsWkid",void 0),u([d()],Hr.prototype,"imageCoordinateSystem",void 0),Hr=mm=u([P("esri.geometry.SpatialReference")],Hr),Hr.prototype.toJSON.isDefaultToJSON=!0,Hr.GCS_NAD_1927=new Hr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Hr.WGS84=new Hr(h$e),Hr.WebMercator=new Hr(d$e),Hr.PlateCarree=new Hr(p$e),Object.freeze&&(Object.freeze(Hr.GCS_NAD_1927),Object.freeze(Hr.WGS84),Object.freeze(Hr.WebMercator));const et=Hr;let gm=class extends ge{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=et.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof et)return e;if(e!=null){const i=new et;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([d()],gm.prototype,"type",void 0),u([d({readOnly:!0})],gm.prototype,"cache",null),u([d({readOnly:!0})],gm.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],gm.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],gm.prototype,"hasZ",void 0),u([d({type:et,json:{write:!0},value:et.WGS84})],gm.prototype,"spatialReference",void 0),u([Fe("spatialReference")],gm.prototype,"readSpatialReference",null),gm=u([P("esri.geometry.Geometry")],gm);const hb=gm,I$e=Object.prototype.toString;function P$e(e){const t="__accessorMetadata__"in e?zr(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return $$e.apply(this,i)}}function $$e(e,t,i,r){P6(e,t).cast=r}function L$e(e){return(t,i)=>{P6(t,e).cast=t[i]}}function Zt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&I$e.call(e[0])==="[object Function]"?P$e(e[0]):e.length===1&&typeof e[0]=="string"?L$e(e[0]):void 0}function D$e(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}const F$e=57.29577951308232,N$e=.017453292519943;function Tie(e){return e*F$e}function Sie(e){return e*N$e}function Eie(e){return e/Mi.radius}function b5(e){return Math.PI/2-2*Math.atan(Math.exp(-e/Mi.radius))}function GG(e){return e.wkid!=null||e.wkt!=null}const QV=[0,0];function w5(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,QV,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,QV,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,QV,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function C1(e,t){const i=e&&(GG(e)?e:e.spatialReference),r=t&&(GG(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!kn(r,i)||oT(r)&&AI(i)||oT(i)&&AI(r))}function YT(e,t){if(C(e))return null;const i=e.spatialReference,r=t&&(GG(t)?t:t.spatialReference);return C1(i,r)?kn(i,r)?ne(e):oT(r)?w5(e,ME,et.WebMercator,!1,ne(e)):AI(r)?w5(e,w3,et.WGS84,!1,ne(e)):null:null}function ME(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=Sie(t);return i[0]=Sie(e)*Mi.radius,i[1]=Mi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function w3(e,t,i=[0,0],r=!1){const s=Tie(e/Mi.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=Tie(Math.PI/2-2*Math.atan(Math.exp(-t/Mi.radius))),i}function dg(e,t=!1,i=ne(e)){return w5(e,ME,et.WebMercator,t,i)}function RE(e,t=!1,i=ne(e)){return w5(e,w3,et.WGS84,t,i)}var uN;const $M=[0,0];function Cie(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let pc=uN=class extends hb{static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new et(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)se.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)se.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=ME(n.longitude,n.latitude,$M);e=a[0],t=a[1]}}}else Cie(i)?(s=i,i=null):Cie(r)&&(s=r,r=null);const o={x:e,y:t};return o.x==null&&o.y!=null?se.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&se.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return w3(t,i,$M)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;e!=null&&t&&(t.isWebMercator?this._set("y",ME(i,e,$M)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return w3(e,t,$M)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;e!=null&&i&&(i.isWebMercator?this._set("x",ME(e,t,$M)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new uN;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return uN.copy(e,this),this}equals(e){if(C(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=ME(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=w3(l,c),h=n}return t===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(e,t,i){var r;return this.x+=e,this.y+=t,i!=null&&(this.z=((r=this.z)!=null?r:0)+i),this}normalize(){if(!this.spatialReference)return this;const e=E1(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return D$e(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],pc.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],pc.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],pc.prototype,"hasZ",null),u([d({type:Number})],pc.prototype,"latitude",null),u([d({type:Number})],pc.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Zt(e=>isNaN(e)?e:Fd(e))],pc.prototype,"x",void 0),u([Ge("x")],pc.prototype,"writeX",null),u([Fe("x")],pc.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],pc.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],pc.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],pc.prototype,"m",void 0),pc=uN=u([P("esri.geometry.Point")],pc),pc.prototype.toJSON.isDefaultToJSON=!0;const ut=pc,e9=[0,0];function MZ(e,t){return!!v(t)&&Bl(e,t.x,t.y,t.z)}function wAt(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!jC(e,i))return!1;return!0}function k$e(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?Bl(e,i,r,s)&&Bl(e,i,o,s)&&Bl(e,n,o,s)&&Bl(e,n,r,s)&&Bl(e,i,r,a)&&Bl(e,i,o,a)&&Bl(e,n,o,a)&&Bl(e,n,r,a):Bl(e,i,r)&&Bl(e,i,o)&&Bl(e,n,o)&&Bl(e,n,r)}function jC(e,t){return Bl(e,t[0],t[1])}function U$e(e,t){return Bl(e,t[0],t[1],t[2])}function Bl(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function V$e(e,t){return e9[1]=t.y,e9[0]=t.x,B$e(e,e9)}function B$e(e,t){return Cge(e.rings,t)}function Cge(e,t){if(!e)return!1;if(z$e(e))return Aie(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=Aie(i,e[r],t);return i}function z$e(e){return!Array.isArray(e[0][0])}function Aie(e,t,i){const[r,s]=i;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,f]=t[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<r&&(n=!n)}return n}function G$e(e,t){return MZ(e,t)}function j$e(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function H$e(e,t){const{points:i,hasZ:r}=t,s=r?U$e:jC;for(const n of i)if(s(e,n))return!0;return!1}const lT=[0,0],cT=[0,0],uT=[0,0],hT=[0,0],q$e=[lT,cT,uT,hT],Age=[[uT,lT],[lT,cT],[cT,hT],[hT,uT]];function W$e(e,t){return X$e(e,t.rings)}function X$e(e,t){lT[0]=e.xmin,lT[1]=e.ymax,cT[0]=e.xmax,cT[1]=e.ymax,uT[0]=e.xmin,uT[1]=e.ymin,hT[0]=e.xmax,hT[1]=e.ymin;for(const i of q$e)if(Cge(t,i))return!0;for(const i of t){if(!i.length)continue;let r=i[0];if(jC(e,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(jC(e,n)||Mge(r,n,Age))return!0;r=n}}return!1}function Y$e(e,t){lT[0]=e.xmin,lT[1]=e.ymax,cT[0]=e.xmax,cT[1]=e.ymax,uT[0]=e.xmin,uT[1]=e.ymin,hT[0]=e.xmax,hT[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(jC(e,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(jC(e,o)||Mge(s,o,Age))return!0;s=o}}return!1}const $a=[0,0];function Z$e(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(jG(n,o,c,h,$a)&&!($a[0]===n[0]&&$a[1]===n[1]||$a[0]===c[0]&&$a[1]===c[1]||$a[0]===o[0]&&$a[1]===o[1]||$a[0]===h[0]&&$a[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(jG(o,a,c,h,$a)&&!($a[0]===o[0]&&$a[1]===o[1]||$a[0]===c[0]&&$a[1]===c[1]||$a[0]===a[0]&&$a[1]===a[1]||$a[0]===h[0]&&$a[1]===h[1]))return!0}}}return!1}function Mge(e,t,i){for(let r=0;r<i.length;r++)if(jG(e,t,i[r][0],i[r][1]))return!0;return!1}function jG(e,t,i,r,s){const[n,o]=e,[a,l]=t,[c,h]=i,[p,f]=r,m=p-c,y=n-c,_=a-n,b=f-h,w=o-h,T=l-o,S=b*_-m*T;if(S===0)return!1;const E=(m*w-b*y)/S,M=(_*w-T*y)/S;return E>=0&&E<=1&&M>=0&&M<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function J$e(e){switch(e){case"esriGeometryEnvelope":case"extent":return j$e;case"esriGeometryMultipoint":case"multipoint":return H$e;case"esriGeometryPoint":case"point":return G$e;case"esriGeometryPolygon":case"polygon":return W$e;case"esriGeometryPolyline":case"polyline":return Y$e}}var dd;function K$e(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function p_(e,t,i){return t==null?i:i==null?t:e(t,i)}let na=dd=class extends hb{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return K$e(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?et.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s!=null?s:et.WGS84}}static fromBounds(e,t){return new dd({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new dd({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new ut({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new dd;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&C1(t,i)&&(e=t.isWebMercator?dg(e):RE(e,!0)),e.type==="point"?MZ(this,e):e.type==="extent"&&k$e(this,e)}equals(e){if(this===e)return!0;if(C(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&C1(t,i)&&(e=t.isWebMercator?dg(e):RE(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(C(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!kn(t,i)&&C1(t,i)&&(e=t.isWebMercator?dg(e):RE(e,!0)),J$e(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=p_(Math.min,this.zmin,e.zmin),this.zmax=p_(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=p_(Math.min,this.mmin,e.mmin),this.mmax=p_(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:C(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=p_(Math.max,this.zmin,e.zmin),this.zmax=p_(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=p_(Math.max,this.mmin,e.mmin),this.mmax=p_(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=E1(this.spatialReference)){var r;if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const s=t.isWebMercator?RE(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(s.x=this._normalizeX(s.x,e).x),this.spatialReference=new et(Sg((r=t.isWGS84?e.altTemplate:null)!=null?r:e.wkTemplate,{Central_Meridian:s.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;const s=i!=null?i:E1(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return e?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(e)return this._shiftCM(s);if(t)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||E1(o);const[p,f]=e.valid;h=this._normalizeX(this.xmin,e);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,e);const _=h.x,b=h.frameId,w=m===_&&a>0;if(a>2*f){const T=new dd(l<c?m:_,s,f,n,o),S=new dd(p,s,l<c?_:m,n,o),E=new dd(0,s,f,n,o),M=new dd(p,s,0,n,o),A=[],$=[];T.contains(E)&&A.push(y),T.contains(M)&&$.push(y),S.contains(E)&&A.push(b),S.contains(M)&&$.push(b);for(let I=y+1;I<b;I++)A.push(I),$.push(I);t.push({extent:T,frameIds:[y]},{extent:S,frameIds:[b]},{extent:E,frameIds:A},{extent:M,frameIds:$})}else m>_||w?t.push({extent:new dd(m,s,f,n,o),frameIds:[y]},{extent:new dd(p,s,_,n,o),frameIds:[b]}):t.push({extent:new dd(m,s,_,n,o),frameIds:[y]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([d({readOnly:!0})],na.prototype,"cache",null),u([d({readOnly:!0})],na.prototype,"center",null),u([d({readOnly:!0})],na.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],na.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],na.prototype,"hasZ",null),u([d({readOnly:!0})],na.prototype,"height",null),u([d({readOnly:!0})],na.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],na.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],na.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],na.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],na.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],na.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],na.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],na.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],na.prototype,"zmax",void 0),na=dd=u([P("esri.geometry.Extent")],na),na.prototype.toJSON.isDefaultToJSON=!0;const Gi=na;function HC(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var HG;function Mie(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function Q$e(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let ev=HG=class extends hb{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return{};const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):Q$e(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new Gi,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=Mie(Math.min),a=Mie(Math.max);let l,c,h,p,[f,m]=n,[y,_]=n;for(let b=0,w=e.length;b<w;b++){const T=e[b],[S,E]=T;if(f=o(f,S),m=o(m,E),y=a(y,S),_=a(_,E),i&&T.length>2){const M=T[2];l=o(l,M),h=a(h,M)}if(r&&T.length>s){const M=T[s];c=o(c,M),p=a(p,M)}}return t.xmin=f,t.ymin=m,t.xmax=y,t.ymax=_,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=void 0,t.zmax=void 0),r?(t.mmin=c,t.mmax=p):(t.mmin=void 0,t.mmax=void 0),t}writePoints(e,t){t.points=ne(this.points)}addPoint(e){return HC(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:ne(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new HG(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new ut(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new ut(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(HC(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([d({readOnly:!0})],ev.prototype,"cache",null),u([d()],ev.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],ev.prototype,"points",void 0),u([Ge("points")],ev.prototype,"writePoints",null),ev=HG=u([P("esri.geometry.Multipoint")],ev),ev.prototype.toJSON.isDefaultToJSON=!0;const c$=ev;function RZ(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function Rge(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function xAt(e,t,i,r){const[s,n]=t,[o,a]=i[r],[l,c]=i[r+1],h=l-o,p=c-a,f=h*h+p*p,m=(s-o)*h+(n-a)*p,y=Math.min(1,Math.max(0,m/f));return e[0]=o+h*y,e[1]=a+p*y,e}function TAt(e,t,i){const r=i.rings;let s,n,o=!1,a=1/0;for(let l=0;l<r.length;l++){const c=r[l];for(let h=0,p=c.length-1;h<c.length;p=h++)s=c[h],n=c[p],s[1]>t!=n[1]>t&&e<(n[0]-s[0])*(t-s[1])/(n[1]-s[1])+s[0]&&(o=!o),a=Math.min(a,eLe(e,t,s,n))}return a===0?0:(o?1:-1)*Math.sqrt(a)}function eLe(e,t,i,r){let s=i[0],n=i[1],o=r[0]-s,a=r[1]-n;if(o!==0||a!==0){const l=((e-s)*o+(t-n)*a)/(o*o+a*a);l>1?(s=r[0],n=r[1]):l>0&&(s+=o*l,n+=a*l)}return o=e-s,a=t-n,o*o+a*a}function tLe(e,t){return Rge(e,t,.5)}function Oge(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=RZ(e[r],e[r+1]);return i}function Ige(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const n=RZ(e[s],e[s+1]);if(t-r<n){const o=(t-r)/n;return Rge(e[s],e[s+1],o)}r+=n}return e[i-1]}function Pge(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],c=e[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function iLe(e){const t=e.length;return t>2&&xg(e[0],e[t-1])}function SAt(e){if("rings"in e)for(const t of e.rings)iLe(t)||t.push(t[0].slice())}function $ge(e){if(!e||e.length<3)return 0;let t=0;const i=e.length-1;for(let r=0;r<i;r++)t+=(e[r][0]-e[r+1][0])*(e[r][1]+e[r+1][1]);return t+=(e[i][0]-e[0][0])*(e[i][1]+e[0][1]),-.5*t}function EAt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function rLe(e){var t;return e?OZ(e.rings,(t=e.hasZ)!=null?t:!1):null}function OZ(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=sLe(e[n],t,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=e[0]&&e[0].length?nLe(e[0],t):null;if(!n)return null;i[0]=n[0],i[1]=n[1],t&&n.length>2&&(i[2]=n[2])}return i}function sLe(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const m=e[f],y=e[(f+1)%e.length],[_,b,w]=m,T=_-l,S=b-c,[E,M,A]=y,$=E-l,I=M-c,k=T*I-$*S;if(o+=k,r+=(T+$)*k,s+=(S+I)*k,t&&m.length>2&&y.length>2){const V=w-h,B=A-h,G=T*B-$*V;n+=(V+B)*G,a+=G}_<i[0]&&(i[0]=_),_>i[1]&&(i[1]=_),b<i[2]&&(i[2]=b),b>i[3]&&(i[3]=b),t&&(w<i[4]&&(i[4]=w),w>i[5]&&(i[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,s/(6*o)+c,o];return t&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function nLe(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],t&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const f=RZ(i,r);if(f){s+=f;const m=tLe(h,p);n+=f*m[0],o+=f*m[1],t&&m.length>2&&(a+=f*m[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}const oLe=1e-6;function CAt(e){if(!e||!e.rings)return null;const{rings:t}=e;let i=0;for(let n=0;n<t.length;n++)i+=$ge(t[n]);if(i<oLe)return OZ(t,!1);const r=[0,0],s=t[0][0];for(let n=0;n<t.length;n++)lLe(r,s,t[n]);return r[0]*=1/i,r[1]*=1/i,r[0]+=s[0],r[1]+=s[1],r}const aLe=1/3;function lLe(e,t,i){if(!e||!i||i.length<3)return null;const r=i[0],s=[0,0],n=[i[1][0]-r[0],i[1][1]-r[1]];let o;for(let c=2;c<i.length;c++)s[0]=i[c][0]-r[0],s[1]=i[c][1]-r[1],o=.5*aLe*(s[0]*n[1]-s[1]*n[0]),e[0]+=o*(n[0]+s[0]),e[1]+=o*(n[1]+s[1]),n[0]=s[0],n[1]=s[1];const a=$ge(i),l=[r[0],r[1]];return l[0]-=t[0],l[1]-=t[1],l[0]*=a,l[1]*=a,e[0]+=l[0],e[1]+=l[1],e}function Lge(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Dge(e){return e.points!==void 0}function Fge(e){return e.x!==void 0&&e.y!==void 0}function Nge(e){return e.paths!==void 0}function kge(e){return e.rings!==void 0}function Uge(e){function t(i,r){return i==null?r:r==null?i:e(i,r)}return t}const n1=Uge(Math.min),o1=Uge(Math.max);function AAt(e,t){return Nge(t)?qC(e,t.paths,!1,!1):kge(t)?qC(e,t.rings,!1,!1):Dge(t)?IZ(e,t.points,!1,!1,!1,!1):Lge(t)?Vge(e,t):(Fge(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function MAt(e,t){return Nge(t)?qC(e,t.paths,!0,!1):kge(t)?qC(e,t.rings,!0,!1):Dge(t)?IZ(e,t.points,!0,!1,!0,!1):Lge(t)?Vge(e,t,!0,!1,!0,!1):(Fge(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function qC(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const y=t[m];for(let _=0;_<y.length;_++){const b=y[_],[w,T]=b;if(c=n1(c,w),h=n1(h,T),p=o1(p,w),f=o1(f,T),i&&b.length>2){const S=b[2];n=n1(n,S),o=o1(o,S)}if(r&&b.length>s){const S=b[s];a=n1(n,S),l=o1(o,S)}}}return i?r?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):r?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function Vge(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,f=t.mmin,m=t.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=h,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=m,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=m,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function IZ(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let c,h,p,f,[m,y]=t[0],[_,b]=t[0];for(let w=0;w<t.length;w++){const T=t[w],[S,E]=T;if(m=n1(m,S),y=n1(y,E),_=o1(_,S),b=o1(b,E),l&&T.length>2){const M=T[2];c=n1(c,M),h=o1(h,M)}if(a&&T.length>o){const M=T[o];p=n1(c,M),f=o1(h,M)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=c,e[3]=p,e[4]=_,e[5]=b,e[6]=h,e[7]=f,e):(e[0]=m,e[1]=y,e[2]=c,e[3]=_,e[4]=b,e[5]=h,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=p,e[3]=_,e[4]=b,e[5]=f,e):(e[0]=m,e[1]=y,e[2]=_,e[3]=b,e)}function cLe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function uLe(e){return e.points!==void 0}function hLe(e){return e.x!==void 0&&e.y!==void 0}function dLe(e){return e.paths!==void 0}function pLe(e){return e.rings!==void 0}const PZ=[];function Bge(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function zge(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function Gge(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function jge(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function $Z(e,t=!1,i=!1){return t?i?jge(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):zge(e[0],e[1],e[2],e[3],e[4],e[5]):i?Gge(e[0],e[1],e[2],e[3],e[4],e[5]):Bge(e[0],e[1],e[2],e[3])}function RAt(e){return e?cLe(e)?e:hLe(e)?mLe(e):pLe(e)?Hge(e):dLe(e)?qge(e):uLe(e)?fLe(e):null:null}function fLe(e){const{hasZ:t,hasM:i,points:r}=e;return $Z(IZ(PZ,r,t!=null?t:!1,i!=null?i:!1),t,i)}function mLe(e){const{x:t,y:i,z:r,m:s}=e,n=s!=null;return r!=null?n?jge(t,i,r,s,t,i,r,s):zge(t,i,r,t,i,r):n?Gge(t,i,s,t,i,s):Bge(t,i,t,i)}function Hge(e){const{hasZ:t,hasM:i,rings:r}=e,s=qC(PZ,r,t!=null?t:!1,i!=null?i:!1);return s?$Z(s,t,i):null}function qge(e){const{hasZ:t,hasM:i,paths:r}=e,s=qC(PZ,r,t!=null?t:!1,i!=null?i:!1);return s?$Z(s,t,i):null}var hN;function Rie(e){return!Array.isArray(e[0])}let ym=hN=class extends hb{static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const o of t)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new hN(n)}constructor(...e){super(...e),this.rings=[],this.type="polygon"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||et.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=rLe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new ut;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Hge(this);if(!t)return null;const i=new Gi(t);return i.spatialReference=e,i}get isSelfIntersecting(){return Z$e(this.rings)}writeRings(e,t){t.rings=ne(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(Rie(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new hN;return e.spatialReference=this.spatialReference,e.rings=ne(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(C(e))return!1;const t=this.spatialReference,i=e.spatialReference;if(v(t)!==v(i)||v(t)&&v(i)&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!xg(n,o,r))return!1}return!0}contains(e){if(!e)return!1;const t=YT(e,this.spatialReference);return V$e(this,v(t)?t:e)}isClockwise(e){let t;return t=Rie(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,Pge(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new ut(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new ut(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new ut(i[0],i[1],i[2],i[3],this.spatialReference):new ut(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(HC(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new ut(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new ut(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(HC(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],ym.prototype,"cache",null),u([d({readOnly:!0})],ym.prototype,"centroid",null),u([d({readOnly:!0})],ym.prototype,"extent",null),u([d({readOnly:!0})],ym.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],ym.prototype,"rings",void 0),u([Ge("rings")],ym.prototype,"writeRings",null),ym=hN=u([P("esri.geometry.Polygon")],ym),ym.prototype.toJSON.isDefaultToJSON=!0;const zh=ym;var qG;function gLe(e){return!Array.isArray(e[0])}let tv=qG=class extends hb{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||et.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=qge(this);if(!t)return null;const i=new Gi(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=ne(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(gLe(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new qG;return e.spatialReference=this.spatialReference,e.paths=ne(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new ut(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new ut(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new ut(i[0],i[1],i[2],i[3],this.spatialReference):new ut(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(HC(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new ut(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new ut(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(HC(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],tv.prototype,"cache",null),u([d({readOnly:!0})],tv.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],tv.prototype,"paths",void 0),u([Ge("paths")],tv.prototype,"writePaths",null),tv=qG=u([P("esri.geometry.Polyline")],tv),tv.prototype.toJSON.isDefaultToJSON=!0;const $h=tv,Wge=bl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Oie=bl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Xge(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function LZ(e){return e.points!==void 0}function DZ(e){return e.x!==void 0&&e.y!==void 0}function FZ(e){return e.paths!==void 0}function jx(e){return e.rings!==void 0}function Jl(e){return C(e)?null:e instanceof hb?e:DZ(e)?ut.fromJSON(e):FZ(e)?$h.fromJSON(e):jx(e)?zh.fromJSON(e):LZ(e)?c$.fromJSON(e):Xge(e)?Gi.fromJSON(e):null}function JA(e){return e?DZ(e)?"esriGeometryPoint":FZ(e)?"esriGeometryPolyline":jx(e)?"esriGeometryPolygon":Xge(e)?"esriGeometryEnvelope":LZ(e)?"esriGeometryMultipoint":null:null}const yLe={esriGeometryPoint:ut,esriGeometryPolyline:$h,esriGeometryPolygon:zh,esriGeometryEnvelope:Gi,esriGeometryMultipoint:c$};function _Le(e){return e&&yLe[e]||null}const ZT={base:hb,key:"type",typeMap:{extent:Gi,multipoint:c$,point:ut,polyline:$h,polygon:zh}};Lf(ZT);const vLe="modulepreload",Iie={},bLe="./",Q=function(t,i){return!i||i.length===0?t():Promise.all(i.map(r=>{if(r=`${bLe}${r}`,r in Iie)return;Iie[r]=!0;const s=r.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${n}`))return;const o=document.createElement("link");if(o.rel=s?"stylesheet":vLe,s||(o.as="script",o.crossOrigin=""),o.href=r,document.head.appendChild(o),s)return new Promise((a,l)=>{o.addEventListener("load",a),o.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t())},Ys=e=>{let t=class extends e{clone(){var l;const i=ba(ml(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==ar.USER&&p!==ar.DEFAULTS&&p!==ar.WEB_MAP&&p!==ar.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof f=="function"?f(m):f==="reference"?m:wG(m),m!=null&&y==null||(p===ar.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=ml(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,ar.DEFAULTS)}return a}};return t=u([P("esri.core.Clonable")],t),t};let Pie=class extends Ys(Te){};Pie=u([P("esri.core.Clonable")],Pie);class nC{constructor(){this._emitter=new nC.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return BC(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([P("esri.core.Evented")],s),s};let i=class extends Te{constructor(){super(...arguments),this._emitter=new nC.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([P("esri.core.Evented")],i),e.EventedAccessor=i})(nC||(nC={}));const ps=nC;var Ir;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Ir||(Ir={}));function NZ(e){return(t,i)=>{t[i]=e}}class kZ extends Gme{notify(){const t=this._observers;if(t&&t.length>0){const i=t.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}}var e0;class wLe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const Qh=new ao(wLe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),xLe=()=>{};function t9(e){return e?e instanceof hx?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function i9(e){if(e&&e.length)return e[0]}function TLe(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function Yge(e,t,i,r){t&&t.forEach((s,n,o)=>{e.push(s),Yge(e,i.call(r,s,n,o),i,r)})}const f_=new Set,m_=new Set,g_=new Set,r9=new Map;let SLe=0,hx=e0=class extends ps.EventedAccessor{static isCollection(e){return e!=null&&e instanceof e0}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new kZ,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:SLe++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof e0?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Ai(this._observable),this._items}set items(e){this._emitBeforeChanges(Ir.ADD)||(this._splice(0,this.length,t9(e)),this._emitAfterChanges(Ir.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=xLe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(Ai(this._observable),this._emitBeforeChanges(Ir.ADD))return this;const i=this.getNextIndex(t!=null?t:null);return this._splice(i,0,[e]),this._emitAfterChanges(Ir.ADD),this}addMany(e,t=this._items.length){if(Ai(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Ir.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,t9(e)),this._emitAfterChanges(Ir.ADD),this}at(e){if(Ai(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Ir.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(Ir.REMOVE),e}clone(){return Ai(this._observable),this._createNewInstance({items:this._items.map(ne)})}concat(...e){Ai(this._observable);const t=e.map(t9);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Ir.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(Ir.REMOVE)}every(e,t){return Ai(this._observable),this._items.every(e,t)}filter(e,t){let i;return Ai(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return Ai(this._observable),this._items.find(e,t)}findIndex(e,t){return Ai(this._observable),this._items.findIndex(e,t)}flatten(e,t){Ai(this._observable);const i=[];return Yge(i,this,e,t),new e0(i)}forEach(e,t){return Ai(this._observable),this._items.forEach(e,t)}getItemAt(e){return Ai(this._observable),this._items[e]}getNextIndex(e){Ai(this._observable);const t=this.length;return(e=e!=null?e:t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return Ai(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return Ai(this._observable),this._items.indexOf(e,t)}join(e=","){return Ai(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return Ai(this._observable),this._items.lastIndexOf(e,t)}map(e,t){Ai(this._observable);const i=this._items.map(e,t);return new e0({items:i})}reorder(e,t=this.length-1){Ai(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(Ir.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(Ir.MOVE)}return e}}pop(){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Ir.REMOVE))return;const e=i9(this._splice(this.length-1,1));return this._emitAfterChanges(Ir.REMOVE),e}push(...e){return Ai(this._observable),this._emitBeforeChanges(Ir.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Ir.ADD)),this.length}reduce(e,t){Ai(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){Ai(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return Ai(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(Ai(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Ir.REMOVE))return;const t=i9(this._splice(e,1));return this._emitAfterChanges(Ir.REMOVE),t}removeMany(e){if(Ai(this._observable),!e||!e.length||this._emitBeforeChanges(Ir.REMOVE))return[];const t=e instanceof e0?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=i.indexOf(o);if(a>-1){const l=1+TLe(t,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Ir.REMOVE),r}reverse(){if(Ai(this._observable),this._emitBeforeChanges(Ir.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Ir.MOVE),this}shift(){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Ir.REMOVE))return;const e=i9(this._splice(0,1));return this._emitAfterChanges(Ir.REMOVE),e}slice(e=0,t=this.length){return Ai(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return Ai(this._observable),this._items.some(e,t)}sort(e){if(Ai(this._observable),!this.length||this._emitBeforeChanges(Ir.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Ir.MOVE),this}splice(e,t,...i){Ai(this._observable);const r=(t?Ir.REMOVE:0)|(i.length?Ir.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return Ai(this._observable),this._items.slice()}toJSON(){return Ai(this._observable),this.toArray()}toLocaleString(){return Ai(this._observable),this._items.toLocaleString()}toString(){return Ai(this._observable),this._items.toString()}unshift(...e){return Ai(this._observable),!e.length||this._emitBeforeChanges(Ir.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Ir.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=ZA(()=>this._dispatchChange())),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const a=Qh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(e,0,n),e+=1,l-=1,c-=1);Qh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Qh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Qh.release(a)}}if(i&&i.length){if(s){const h=[];for(const p of i){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=Qh.acquire();h.target=this,h.cancellable=!0;const p=Qh.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));Qh.release(p),Qh.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=Qh.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,Qh.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=Qh.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),Qh.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;f_.clear(),m_.clear(),g_.clear();for(const{added:l,removed:c}of i){if(l)if(g_.size===0&&m_.size===0)for(const h of l)f_.add(h);else for(const h of l)m_.has(h)?(g_.add(h),m_.delete(h)):g_.has(h)||f_.add(h);if(c)if(g_.size===0&&f_.size===0)for(const h of c)m_.add(h);else for(const h of c)f_.has(h)?f_.delete(h):(g_.delete(h),m_.add(h))}const r=vu.acquire();f_.forEach(l=>{r.push(l)});const s=vu.acquire();m_.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=vu.acquire();if(g_.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}vu.release(r),vu.release(s),vu.release(a)}f_.clear(),m_.clear(),g_.clear()}};hx.ofType=e=>{if(!e)return e0;if(r9.has(e))return r9.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends e0{};return u([NZ({Type:e,ensureType:typeof e=="function"?zr(e):Lf(e)})],i.prototype,"itemType",void 0),i=u([P(`esri.core.Collection<${t}>`)],i),r9.set(e,i),i},u([d()],hx.prototype,"length",void 0),u([d()],hx.prototype,"items",null),hx=e0=u([P("esri.core.Collection")],hx);const Qe=hx;var WC;function ELe(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(i!=null&&+t<i||r!=null&&+t>r)return WC.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==t))return WC.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(WC||(WC={}));const CLe=se.getLogger("esri.support.arcadeOnDemand");let s9;function Eg(){return s9||(s9=(async()=>{const e=await Q(()=>import("./arcadeUtils.9a01b817.js").then(function(t){return t.ax}),["assets/arcadeUtils.9a01b817.js","assets/arcadeTimeUtils.68d88c0e.js","assets/executionError.c4c51b90.js","assets/number.96c248f8.js","assets/hash.079e8d2d.js"]);return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),s9}const ALe=(e,t,i)=>u$.create(e,t,i,null,["$feature"]),MLe=(e,t,i)=>u$.create(e,t,i,null,["$feature","$view"]),RLe=(e,t,i,r)=>u$.create(e,t,i,r,["$feature","$view"]);class u${constructor(t,i,r,s,n,o,a){this.script=t,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await Eg(),h=et.fromJSON(i);let p;try{p=a.parseScript(t,o)}catch(I){return CLe.error(new H("arcade-bad-expression","Failed to parse arcade script",{script:t,error:I})),null}const f=n.reduce((I,k)=>({...I,[k]:null}),{});let m=null;v(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p),_=y&&a.enableGeometrySupport(),b=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p),T=w&&a.enableAsyncSupport(),S={vars:f,spatialReference:h,useAsync:!!T};await Promise.all([_,b,T]);const E=new Set;await a.loadDependentModules(E,p,null,w,y);const M=new c;M.immutable=!1,M.setField("scale",0);const A=a.compileScript(p,S),$=I=>("$view"in I&&I.$view&&(M.setField("scale",typeof I.$view=="object"?I.$view.scale:void 0),I.$view=M),m&&(I.$config=m),A({vars:I,spatialReference:h}));return new u$(t,a,p,$,new l,r,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}}const OLe=/^([0-9])/,ILe=/[^a-z0-9_\u0080-\uffff]/gi,PLe=/_{2,}/g,$Le=/^_/,LLe=/_$/;function DLe(e){return e==null?null:e.trim().replace(ILe,"_").replace(PLe,"_").replace($Le,"").replace(LLe,"").replace(OLe,"F$1")||null}const FLe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],NLe=["field","normalizationField"];function $ie(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if(Lie(FLe,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)Lie(NLe,r,t)}}function Lie(e,t,i){if(e)for(const r of e){const s=r$(r,t),n=s&&typeof s!="function"&&i.get(s);n&&Sa(r,n.name,t)}}function Zge(e,t){var i,r,s,n,o;if(e!=null&&((i=t==null?void 0:t.fields)==null?void 0:i.length))if("startField"in e){const a=t.get(e.startField),l=t.get(e.endField);e.startField=(r=a==null?void 0:a.name)!=null?r:null,e.endField=(s=l==null?void 0:l.name)!=null?s:null}else{const a=t.get(e.startTimeField),l=t.get(e.endTimeField);e.startTimeField=(n=a==null?void 0:a.name)!=null?n:null,e.endTimeField=(o=l==null?void 0:l.name)!=null?o:null}}const n9=new Set;function Jge(e,t){return e&&t?(n9.clear(),RI(n9,e,t),Array.from(n9).sort()):[]}function RI(e,t,i){var r;if(i)if((r=t==null?void 0:t.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)Dh(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)s!=null&&e.add(s)}}function Dh(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function OAt(e,t){var i;return C(t)||C(e)?[]:t.includes("*")?((i=e.fields)!=null?i:[]).map(r=>r.name):t}async function Uc(e,t,i){var n;if(!i)return;const{arcadeUtils:r}=await Eg(),s=r.extractFieldNames(i,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Dh(e,t,o)}async function Kge(e,t,i){if(i&&i!=="1=1"){const r=(await Q(()=>import("./WhereClause.fb4e6ae7.js").then(function(s){return s.W}),["assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js"])).WhereClause.create(i,t);if(!r.isStandardized)throw new H("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});RI(e,t,r.fieldNames)}}function kLe({displayField:e,fields:t}){return e||(t&&t.length?o9(t,"name-or-title")||o9(t,"unique-identifier")||o9(t,"type-or-category")||ULe(t):null)}function ULe(e){for(const t of e){if(!t||!t.name)continue;const i=t.name.toLowerCase();if(i.includes("name")||i.includes("title"))return t.name}return null}function o9(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function IAt(e,t){var r;if(!t)return;const i=(r=t.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}function VLe(e,t,i){i.onStatisticExpression?Uc(e,t,i.onStatisticExpression.expression):e.add(i.onStatisticField)}async function PAt(e,t,i){if(!t||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(BLe(e,t,s)),i.fields&&r.push(...i.fields.map(async n=>VLe(e,t.fieldsIndex,n))),await Promise.all(r)}async function BLe(e,t,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(n=>Uc(e,t.fieldsIndex,n.expression)));const s=i==null?void 0:i.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(Uc(e,t.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function $At(e,t,i){t&&(t.timeInfo&&v(i)&&i.timeExtent&&RI(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&RI(e,t.fieldsIndex,[t.floorInfo.floorField]),v(i)&&v(i.where)&&await Kge(e,t.fieldsIndex,i.where))}async function LAt(e,t,i){t&&i&&await Promise.all(i.map(r=>zLe(e,t,r)))}async function zLe(e,t,i){t&&i&&(i.valueExpression?await Uc(e,t.fieldsIndex,i.valueExpression):i.field&&Dh(e,t.fieldsIndex,i.field))}function DAt(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?Jge(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function FAt(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map(s=>GLe(e,r,s)))}async function GLe(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Uc(e,t,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Dh(e,t,o.slice(1,-1))})}await Kge(e,t,s)}function jLe(e){const t=e.defaultValue;return t!==void 0&&tye(e,t)?t:e.nullable?null:void 0}function Qge(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function HLe(e){return e===null||Qge(e)}const UZ="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function qLe(e){return e===null||UZ(e)}function eye(e){return e!=null&&typeof e=="string"}function WLe(e){return e===null||eye(e)}function XLe(){return!0}function tye(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?qLe:UZ;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?HLe:Qge;break;case"string":case"esriFieldTypeString":i=e.nullable?WLe:eye;break;default:i=XLe}return arguments.length===1?i:i(t)}const YLe=["integer","small-integer","single","double"],ZLe=new Set([...YLe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function U6(e){return e!=null&&ZLe.has(e.type)}function NAt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function kAt(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}var x5,T5;function UAt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function VAt(e,t){return e==null||e.nullable&&t===null?null:U6(e)&&!JLe(e.type,Number(t))?x5.OUT_OF_RANGE:tye(e,t)?e.domain?ELe(e.domain,t):null:T5.INVALID_TYPE}function JLe(e,t){const i=typeof e=="string"?iye(e):e;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?UZ(t)&&t>=r&&t<=s:t>=r&&t<=s}function iye(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return KLe;case"esriFieldTypeInteger":case"integer":return QLe;case"esriFieldTypeSingle":case"single":return eDe;case"esriFieldTypeDouble":case"double":return tDe}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(x5||(x5={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(T5||(T5={}));const KLe={min:-32768,max:32767,isInteger:!0},QLe={min:-2147483648,max:2147483647,isInteger:!0},eDe={min:-34e37,max:12e37,isInteger:!1},tDe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function BAt(e,t,i){switch(e){case WC.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case WC.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case T5.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case x5.OUT_OF_RANGE:{const{min:r,max:s}=iye(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function iDe(e,t){return!rDe(e,t,null)}function rDe(e,t,i){if(!t||!t.attributes||!e){if(v(i))for(const n of e!=null?e:[])i.add(n);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!v(i))break;i.add(n)}return s}function rye(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let dN=class extends ge{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],dN.prototype,"type",void 0),dN=u([P("esri.popup.content.Content")],dN);const db=dN;var WG;let fw=WG=class extends db{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new WG({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],fw.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],fw.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],fw.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],fw.prototype,"type",void 0),fw=WG=u([P("esri.popup.content.AttachmentsContent")],fw);const OI=fw;var XG;let mw=XG=class extends db{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new XG({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ne(this.outFields):null})}};u([d()],mw.prototype,"creator",void 0),u([d()],mw.prototype,"destroyer",void 0),u([d()],mw.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],mw.prototype,"type",void 0),mw=XG=u([P("esri.popup.content.CustomContent")],mw);const sDe=mw;var YG;let M2=YG=class extends ge{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new YG({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],M2.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],M2.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],M2.prototype,"returnType",void 0),M2=YG=u([P("esri.popup.ElementExpressionInfo")],M2);const sye=M2;var ZG;let WR=ZG=class extends db{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new ZG({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([d({type:sye,json:{write:!0}})],WR.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],WR.prototype,"type",void 0),WR=ZG=u([P("esri.popup.content.ExpressionContent")],WR);const VZ=WR;function bt(e,t={}){var s;const i=e instanceof _i?e:new _i(e,t),r={type:(s=t==null?void 0:t.ignoreUnknown)==null||s?i.apiValues:String,json:{type:i.jsonValues,read:!(t!=null&&t.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(r.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(r.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(r.json.name=t.name),(t==null?void 0:t.nonNullable)!==void 0&&(r.nonNullable=t.nonNullable),d(r)}const II=bl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});II.toJSON.bind(II);II.fromJSON.bind(II);let x3;var Bfe,zfe,Gfe;const a9=(Gfe=(Bfe=globalThis.esriConfig)==null?void 0:Bfe.locale)!=null?Gfe:(zfe=globalThis.dojoConfig)==null?void 0:zfe.locale;function nye(){var e,t;return(t=a9!=null?a9:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function Xd(){return x3===void 0&&(x3=nye()),x3}const T3=[];function BZ(e){return T3.push(e),{remove(){T3.splice(T3.indexOf(e),1)}}}const JG=[];function zZ(e){return JG.push(e),{remove(){T3.splice(JG.indexOf(e),1)}}}function nDe(){const e=nye();x3!==e&&(x3=e,[...JG].forEach(t=>{t.call(null,e)}),[...T3].forEach(t=>{t.call(null,e)}))}var jfe;(jfe=globalThis.addEventListener)==null||jfe.call(globalThis,"languagechange",nDe);const Jf={year:"numeric",month:"numeric",day:"numeric"},LM={year:"numeric",month:"long",day:"numeric"},DM={year:"numeric",month:"short",day:"numeric"},FM={year:"numeric",month:"long",weekday:"long",day:"numeric"},pd={hour:"numeric",minute:"numeric"},bp={...pd,second:"numeric"},GZ={"short-date":Jf,"short-date-short-time":{...Jf,...pd},"short-date-short-time-24":{...Jf,...pd,hour12:!1},"short-date-long-time":{...Jf,...bp},"short-date-long-time-24":{...Jf,...bp,hour12:!1},"short-date-le":Jf,"short-date-le-short-time":{...Jf,...pd},"short-date-le-short-time-24":{...Jf,...pd,hour12:!1},"short-date-le-long-time":{...Jf,...bp},"short-date-le-long-time-24":{...Jf,...bp,hour12:!1},"long-month-day-year":LM,"long-month-day-year-short-time":{...LM,...pd},"long-month-day-year-short-time-24":{...LM,...pd,hour12:!1},"long-month-day-year-long-time":{...LM,...bp},"long-month-day-year-long-time-24":{...LM,...bp,hour12:!1},"day-short-month-year":DM,"day-short-month-year-short-time":{...DM,...pd},"day-short-month-year-short-time-24":{...DM,...pd,hour12:!1},"day-short-month-year-long-time":{...DM,...bp},"day-short-month-year-long-time-24":{...DM,...bp,hour12:!1},"long-date":FM,"long-date-short-time":{...FM,...pd},"long-date-short-time-24":{...FM,...pd,hour12:!1},"long-date-long-time":{...FM,...bp},"long-date-long-time-24":{...FM,...bp,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":pd,"long-time":bp},PI=bl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});PI.apiValues;PI.toJSON.bind(PI);PI.fromJSON.bind(PI);const oDe={ar:"ar-u-nu-latn-ca-gregory"};let KG=new WeakMap,oye=GZ["short-date-short-time"];function aDe(e){const t=e||oye;let i=KG.get(t);if(!i){const r=Xd(),s=oDe[Xd()]||r;i=new Intl.DateTimeFormat(s,t),KG.set(t,i)}return i}function XC(e){return e?GZ[e]:null}function Ou(e,t){return aDe(t).format(e)}zZ(()=>{KG=new WeakMap,oye=GZ["short-date-short-time"]});const lDe={ar:"ar-u-nu-latn"};let pN=new WeakMap,aye={};function cDe(e){const t=e||aye;if(!pN.has(t)){const i=Xd(),r=lDe[Xd()]||i;pN.set(t,new Intl.NumberFormat(r,e))}return pN.get(t)}function lye(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Cg(e,t){return e===-0&&(e=0),cDe(t).format(e)}zZ(()=>{pN=new WeakMap,aye={}});var QG;let gw=QG=class extends ge{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new QG({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Ou(e,{...XC(this.dateFormat),...this.dateTimeFormatOptions}):Cg(e,lye(this))}formatRasterPixelValue(e){if(e.includes("-"))return e;let t,i;return e.trim().includes(",")?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(";")?(t=";",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(" ")?(t=i=" ",this._formatDelimitedString(e,t,i,this)):this.format(Number(e))}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map(s=>this.format(Number(s))).join(i):e}};u([bt(II)],gw.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],gw.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],gw.prototype,"digitSeparator",void 0),u([d({type:us,json:{write:!0}})],gw.prototype,"places",void 0),gw=QG=u([P("esri.popup.support.FieldInfoFormat")],gw);const OE=gw;var ej;let $p=ej=class extends ge{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new ej({fieldName:this.fieldName,format:this.format?ne(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],$p.prototype,"fieldName",void 0),u([d({type:OE,json:{write:!0}})],$p.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],$p.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],$p.prototype,"label",void 0),u([bt(new _i({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],$p.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],$p.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],$p.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],$p.prototype,"visible",void 0),$p=ej=u([P("esri.popup.FieldInfo")],$p);const h$=$p;var tj;let xy=tj=class extends db{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new tj(ne({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],xy.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],xy.prototype,"description",void 0),u([d({type:[h$]})],xy.prototype,"fieldInfos",void 0),u([Ge("fieldInfos")],xy.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],xy.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],xy.prototype,"type",void 0),xy=tj=u([P("esri.popup.content.FieldsContent")],xy);const YC=xy;let yw=class extends ge{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],yw.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],yw.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],yw.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],yw.prototype,"type",void 0),yw=u([P("esri.popup.content.mixins.MediaInfo")],yw);const jZ=yw;var ij;let R2=ij=class extends Te{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new ij({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],R2.prototype,"fieldName",void 0),u([d()],R2.prototype,"tooltip",void 0),u([d()],R2.prototype,"value",void 0),R2=ij=u([P("esri.popup.content.support.ChartMediaInfoValueSeries")],R2);const cye=R2;var rj;let _w=rj=class extends ge{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new rj({fields:ne(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],_w.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],_w.prototype,"normalizeField",void 0),u([d({type:[cye],json:{read:!1}})],_w.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],_w.prototype,"tooltipField",void 0),_w=rj=u([P("esri.popup.content.support.ChartMediaInfoValue")],_w);const uDe=_w;let XR=class extends jZ{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],XR.prototype,"type",void 0),u([d({type:uDe,json:{write:!0}})],XR.prototype,"value",void 0),XR=u([P("esri.popup.content.mixins.ChartMediaInfo")],XR);const V6=XR,B6=bl()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var sj;let fN=sj=class extends V6{constructor(e){super(e),this.type="bar-chart"}clone(){return new sj({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:B6.write}})],fN.prototype,"type",void 0),fN=sj=u([P("esri.popup.content.BarChartMediaInfo")],fN);const uye=fN;var nj;let mN=nj=class extends V6{constructor(e){super(e),this.type="column-chart"}clone(){return new nj({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:B6.write}})],mN.prototype,"type",void 0),mN=nj=u([P("esri.popup.content.ColumnChartMediaInfo")],mN);const hye=mN;var oj;let YR=oj=class extends ge{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new oj({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],YR.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],YR.prototype,"sourceURL",void 0),YR=oj=u([P("esri.popup.content.support.ImageMediaInfoValue")],YR);const hDe=YR;var aj;let O2=aj=class extends jZ{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new aj({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],O2.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],O2.prototype,"type",void 0),u([d({type:hDe,json:{write:!0}})],O2.prototype,"value",void 0),O2=aj=u([P("esri.popup.content.ImageMediaInfo")],O2);const dye=O2;var lj;let gN=lj=class extends V6{constructor(e){super(e),this.type="line-chart"}clone(){return new lj({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:B6.write}})],gN.prototype,"type",void 0),gN=lj=u([P("esri.popup.content.LineChartMediaInfo")],gN);const pye=gN;var cj;let yN=cj=class extends V6{constructor(e){super(e),this.type="pie-chart"}clone(){return new cj({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:B6.write}})],yN.prototype,"type",void 0),yN=cj=u([P("esri.popup.content.PieChartMediaInfo")],yN);const fye=yN,mye={base:jZ,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":uye,"column-chart":hye,"line-chart":pye,"pie-chart":fye,image:dye}};var uj;let Lp=uj=class extends db{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?dye.fromJSON(t):t.type==="barchart"?uye.fromJSON(t):t.type==="columnchart"?hye.fromJSON(t):t.type==="linechart"?pye.fromJSON(t):t.type==="piechart"?fye.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new uj(ne({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],Lp.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],Lp.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Lp.prototype,"description",void 0),u([d({types:[mye]})],Lp.prototype,"mediaInfos",void 0),u([Fe("mediaInfos")],Lp.prototype,"readMediaInfos",null),u([Ge("mediaInfos")],Lp.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],Lp.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Lp.prototype,"type",void 0),Lp=uj=u([P("esri.popup.content.MediaContent")],Lp);const $I=Lp;var hj;let ZR=hj=class extends ge{constructor(e){super(e),this.field=null,this.order=null}clone(){return new hj({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],ZR.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],ZR.prototype,"order",void 0),ZR=hj=u([P("esri.popup.support.RelatedRecordsInfoFieldOrder")],ZR);const HZ=ZR;let _m=class extends Ys(db){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([d({type:String,json:{write:!0}})],_m.prototype,"description",void 0),u([d({type:Number,json:{type:us,write:!0}})],_m.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],_m.prototype,"displayType",void 0),u([d({type:[HZ],json:{write:!0}})],_m.prototype,"orderByFields",void 0),u([d({type:Number,json:{type:us,write:!0}})],_m.prototype,"relationshipId",void 0),u([d({type:String,json:{write:!0}})],_m.prototype,"title",void 0),u([d({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],_m.prototype,"type",void 0),_m=u([P("esri.popup.content.RelationshipContent")],_m);const S5=_m;var dj;let JR=dj=class extends db{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new dj({text:this.text})}};u([d({type:String,json:{write:!0}})],JR.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],JR.prototype,"type",void 0),JR=dj=u([P("esri.popup.content.TextContent")],JR);const ZC=JR,dDe={base:null,key:"type",typeMap:{attachment:OI,media:$I,text:ZC,expression:VZ,field:YC,relationship:S5}};var pj;let vw=pj=class extends ge{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new pj({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],vw.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],vw.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],vw.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],vw.prototype,"returnType",void 0),vw=pj=u([P("esri.popup.ExpressionInfo")],vw);const gye=vw;var fj;let KR=fj=class extends ge{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new fj({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],KR.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],KR.prototype,"showNoDataRecords",void 0),KR=fj=u([P("esri.popup.LayerOptions")],KR);const pDe=KR;var mj;let QR=mj=class extends ge{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new mj({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ne(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],QR.prototype,"showRelatedRecords",void 0),u([d({type:[HZ],json:{write:!0}})],QR.prototype,"orderByFields",void 0),QR=mj=u([P("esri.popup.RelatedRecordsInfo")],QR);const fDe=QR;let yye=0;const G0=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+yye++})}};return t=u([P("esri.core.Identifiable")],t),t},zAt=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:yye++})}};return t=u([P("esri.core.NumericIdentifiable")],t),t};let Die=class extends G0(class{}){};Die=u([P("esri.core.Identifiable")],Die);var gj;let Dp=gj=class extends G0(Te){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new gj({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],Dp.prototype,"active",void 0),u([d()],Dp.prototype,"className",void 0),u([d()],Dp.prototype,"disabled",void 0),u([d()],Dp.prototype,"id",void 0),u([d()],Dp.prototype,"indicator",void 0),u([d()],Dp.prototype,"title",void 0),u([d()],Dp.prototype,"type",void 0),u([d()],Dp.prototype,"visible",void 0),Dp=gj=u([P("esri.support.actions.ActionBase")],Dp);const KA=Dp;var yj;let _N=yj=class extends KA{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new yj({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],_N.prototype,"image",void 0),_N=yj=u([P("esri.support.Action.ActionButton")],_N);const JT=_N;var _j;let eO=_j=class extends KA{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new _j({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],eO.prototype,"image",void 0),u([d()],eO.prototype,"value",void 0),eO=_j=u([P("esri.support.Action.ActionToggle")],eO);const qZ=eO,mDe="esri.PopupTemplate",gDe=se.getLogger(mDe),NM="relationships/",Fie="expression/",yDe=Qe.ofType({key:"type",defaultKeyValue:"button",base:KA,typeMap:{button:JT,toggle:qZ}}),_De={base:db,key:"type",typeMap:{media:$I,custom:sDe,text:ZC,attachments:OI,fields:YC,expression:VZ,relationship:S5}},vDe=["attachments","fields","media","text","expression","relationship"];let oa=class extends Ys(ge){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(t=>Lf(_De,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Yh(e)?e:(gDe.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t.description,t.mediaInfos,i):this._readPopupInfo(t)}writeContent(e,t,i,r){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>vDe.includes(s.type)).map(s=>s&&s.toJSON(r)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"?this._writeTextContent(s,t):s.type==="relationship"&&this._writeRelationshipContent(s,t)})):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(r);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,i,r){t[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),RI(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ne(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach(r=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===r.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(r)}):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,t){var s,n;const i=((s=e.orderByFields)==null?void 0:s.map(o=>this._toFieldOrderJSON(o,e.relationshipId)))||[],r=[...((n=t.relatedRecordsInfo)==null?void 0:n.orderByFields)||[],...i];t.relatedRecordsInfo={showRelatedRecords:!0,...(r==null?void 0:r.length)&&{orderByFields:r}}}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ne(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements(e,t,i){const r={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!t||r.mediaInfos||(s.mediaInfos=t,r.mediaInfos=!0),$I.fromJSON(s)):s.type==="text"?(s.text||!e||r.description||(s.text=e,r.description=!0),ZC.fromJSON(s)):s.type==="attachments"?OI.fromJSON(s):s.type==="fields"?YC.fromJSON(s):s.type==="expression"?VZ.fromJSON(s):s.type==="relationship"?S5.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:t,order:i}=e;if(!(t!=null&&t.startsWith(NM)))return null;const r=t.replace(NM,"").split("/");if(r.length!==2)return null;const s=parseInt(r[0],10),n=r[1];return typeof s=="number"&&n?S5.fromJSON({relationshipId:s,orderByFields:[{field:n,order:i}]}):null}_toFieldOrderJSON(e,t){const{order:i,field:r}=e;return{field:`${NM}${t}/${r}`,order:i}}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i,relatedRecordsInfo:r={showRelatedRecords:!1}}){const s=[];e?s.push(new ZC({text:e})):s.push(new YC),Array.isArray(t)&&t.length&&s.push($I.fromJSON({mediaInfos:t})),i&&s.push(OI.fromJSON({displayType:"auto"}));const{showRelatedRecords:n,orderByFields:o}=r;return n&&(o==null?void 0:o.length)&&o.forEach(a=>{const l=this._toRelationshipContent(a);l&&s.push(l)}),s.length?s:e}_getContentElementFields(e){var i;const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields((i=e.fieldInfos)!=null?i:this.fieldInfos)];if(t==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n,normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n!=null?n:[]];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((i,r)=>[...i,...r.type==="expression"&&r.expressionInfo?[r.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,i)=>[...t,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map(r=>Uc(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.startsWith(NM)&&!t.startsWith(Fie)):[]}_getActionsFields(e){return e?e.toArray().reduce((t,i)=>[...t,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s=r==="button"||r==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,i=e.match(t);if(!i)return[];const r=/\{(\w+):.+\}/,s=i.filter(n=>!(n.indexOf(`{${NM}`)===0||n.indexOf(`{${Fie}`)===0)).map(n=>n.replace(r,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([d({type:yDe})],oa.prototype,"actions",void 0),u([d()],oa.prototype,"content",void 0),u([Zt("content")],oa.prototype,"castContent",null),u([Fe("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],oa.prototype,"readContent",null),u([Ge("content",{popupElements:{type:Qe.ofType(dDe)},showAttachments:{type:Boolean},mediaInfos:{type:Qe.ofType(mye)},description:{type:String},relatedRecordsInfo:{type:fDe}})],oa.prototype,"writeContent",null),u([d({type:[gye],json:{write:!0}})],oa.prototype,"expressionInfos",void 0),u([d({type:[h$]})],oa.prototype,"fieldInfos",void 0),u([Ge("fieldInfos")],oa.prototype,"writeFieldInfos",null),u([d({type:pDe})],oa.prototype,"layerOptions",void 0),u([Ge("layerOptions")],oa.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],oa.prototype,"lastEditInfoEnabled",void 0),u([d()],oa.prototype,"outFields",void 0),u([d()],oa.prototype,"overwriteActions",void 0),u([d()],oa.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],oa.prototype,"title",void 0),u([Ge("title")],oa.prototype,"writeTitle",null),oa=u([P("esri.PopupTemplate")],oa);const KT=oa,Nie=new _i({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let bDe=0,I2=class extends ge{constructor(e){super(e),this.id="sym"+bDe++,this.type=null,this.color=new De([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:Nie.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Nie.write}}})],I2.prototype,"type",void 0),u([d({type:De,json:{write:{allowNull:!0}}})],I2.prototype,"color",void 0),u([Fe("color")],I2.prototype,"readColor",null),I2=u([P("esri.symbols.Symbol")],I2);const Fu=I2;var vj;let iv=vj=class extends Fu{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const s=r.map(n=>{const o=n.valueExpressionInfo;return Uc(e,t,o.expression)});await Promise.all(s)}}}clone(){return new vj({data:ne(this.data)})}hash(){return aZ(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],iv.prototype,"color",void 0),u([d({json:{write:!0}})],iv.prototype,"data",void 0),u([Fe("data",["symbol"])],iv.prototype,"readData",null),u([Ge("data",{})],iv.prototype,"writeData",null),u([bt({CIMSymbolReference:"cim"},{readOnly:!0})],iv.prototype,"type",void 0),iv=vj=u([P("esri.symbols.CIMSymbol")],iv);const QA=iv;let P2=class extends ge{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],P2.prototype,"enabled",void 0),u([Ge("enabled")],P2.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],P2.prototype,"type",void 0),P2=u([P("esri.symbols.Symbol3DLayer")],P2);const kg=P2,wDe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,xDe="screenUtils.toPt: input not recognized!",_ye=96;function $r(e){return e?e/72*_ye:0}function Gh(e){return e?72*e/_ye:0}function Cr(e){if(typeof e=="string"){const t=e.match(wDe);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=r==="px"?Gh(i):i;return s?-n:n}return console.warn(xDe),null}return e}function ip(e=0,t=0){return{x:e,y:t}}function $s(e=0,t=0){return[e,t]}function vye(e=0,t=0){return[e,t]}function Ga(e=0,t=0,i=0){return[e,t,i]}function GAt(e){return e}function jAt(e){return e}function HAt(e){return e}function Km(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function z6(e){const t=cZ(100*(1-e));return Math.max(0,Math.min(t,100))}function LI(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function TDe(e,t){const i=t.transparency!=null?LI(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new De([r[0]||0,r[1]||0,r[2]||0,i]):null}function SDe(e,t){t.color=e.toJSON().slice(0,3);const i=z6(e.a);i!==0&&(t.transparency=i)}const j0={type:De,json:{type:[us],default:null,read:{source:["color","transparency"],reader:TDe},write:{target:{color:{type:[us]},transparency:{type:us}},writer:SDe}}},Ag={type:Number,cast:Cr,json:{write:!0}};let bw=class extends ge{constructor(e){super(e),this.color=new De([0,0,0,1]),this.extensionLength=0,this.size=Gh(1)}clone(){}cloneProperties(){return{color:ne(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],bw.prototype,"type",void 0),u([d(j0)],bw.prototype,"color",void 0),u([d({...Ag,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],bw.prototype,"extensionLength",void 0),u([d(Ag)],bw.prototype,"size",void 0),bw=u([P("esri.symbols.edges.Edges3D")],bw);const WZ=bw;var bj;let vN=bj=class extends WZ{constructor(e){super(e),this.type="sketch"}clone(){return new bj(this.cloneProperties())}};u([bt({sketch:"sketch"},{readOnly:!0})],vN.prototype,"type",void 0),vN=bj=u([P("esri.symbols.edges.SketchEdges3D")],vN);const EDe=vN;var wj;let bN=wj=class extends WZ{constructor(e){super(e),this.type="solid"}clone(){return new wj(this.cloneProperties())}};u([bt({solid:"solid"},{readOnly:!0})],bN.prototype,"type",void 0),bN=wj=u([P("esri.symbols.support.SolidEdges3D")],bN);const CDe=bN,bye={types:{key:"type",base:WZ,typeMap:{solid:CDe,sketch:EDe}},json:{write:!0}};var xj;let Fh=xj=class extends ge{constructor(e){super(e),this.color=null}clone(){const e={color:v(this.color)?this.color.clone():null};return new xj(e)}};u([d(j0)],Fh.prototype,"color",void 0),Fh=xj=u([P("esri.symbols.support.Symbol3DMaterial")],Fh);var Tj;let rv=Tj=class extends kg{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new Tj({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([bt({Extrude:"extrude"},{readOnly:!0})],rv.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],rv.prototype,"size",void 0),u([d({type:Fh,json:{write:!0}})],rv.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],rv.prototype,"castShadows",void 0),u([d(bye)],rv.prototype,"edges",void 0),rv=Tj=u([P("esri.symbols.ExtrudeSymbol3DLayer")],rv);const wye=rv;let tO=class extends Fu{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([bt({esriSLS:"simple-line"},{readOnly:!0})],tO.prototype,"type",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],tO.prototype,"width",void 0),tO=u([P("esri.symbols.LineSymbol")],tO);const ADe=tO,MDe=["begin","end","begin-end"],xye=["arrow","circle","square","diamond","cross","x"];var Sj;let vm=Sj=class extends ge{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new Sj({color:ne(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],vm.prototype,"placement",void 0),u([bt({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],vm.prototype,"type",void 0),u([d({type:xye})],vm.prototype,"style",void 0),u([Ge("style")],vm.prototype,"writeStyle",null),u([d({type:De,value:null,json:{write:{allowNull:!0}}})],vm.prototype,"color",null),u([Fe("color")],vm.prototype,"readColor",null),u([Ge("color")],vm.prototype,"writeColor",null),vm=Sj=u([P("esri.symbols.LineSymbolMarker")],vm);const RDe=vm;var Ej;const l9=new _i({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Ty=Ej=class extends ADe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),i!=null&&(o.width=Cr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Cr(n)),o}clone(){var e;return new Ej({color:ne(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([bt({esriSLS:"simple-line"},{readOnly:!0})],Ty.prototype,"type",void 0),u([d({type:l9.apiValues,json:{read:l9.read,write:l9.write}})],Ty.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],Ty.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],Ty.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":RDe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ty.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],Ty.prototype,"miterLimit",void 0),Ty=Ej=u([P("esri.symbols.SimpleLineSymbol")],Ty);const Nu=Ty;let iO=class extends Fu{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Nu}},json:{default:null,write:!0}})],iO.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],iO.prototype,"type",void 0),iO=u([P("esri.symbols.FillSymbol")],iO);const Tye=iO;let wN=class extends ge{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],wN.prototype,"type",void 0),wN=u([P("esri.symbols.patterns.LinePattern3D")],wN);const Sye=wN,ODe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var Cj;const IDe=bl()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let rO=Cj=class extends Sye{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new Cj(e)}};u([d({type:["style"]})],rO.prototype,"type",void 0),u([bt(IDe),d({type:ODe})],rO.prototype,"style",void 0),rO=Cj=u([P("esri.symbols.patterns.LineStylePattern3D")],rO);const XZ=rO;let xN=class extends ge{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],xN.prototype,"type",void 0),xN=u([P("esri.symbols.patterns.Pattern3D")],xN);const Eye=xN,PDe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var Aj;let sO=Aj=class extends Eye{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new Aj(e)}};u([d({type:["style"]})],sO.prototype,"type",void 0),u([d({type:PDe,json:{read:!0,write:!0}})],sO.prototype,"style",void 0),sO=Aj=u([P("esri.symbols.patterns.StylePattern3D")],sO);const Cye=sO,$De={types:{key:"type",base:Eye,typeMap:{style:Cye}},json:{write:!0}},Aye={types:{key:"type",base:Sye,typeMap:{style:XZ}},json:{write:!0}},S3=new De("white");new De("black");const LDe=new De([255,255,255,0]);function DDe(e){return e.r===0&&e.g===0&&e.b===0}var Mj;let E3=Mj=class extends Fh{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:v(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new Mj(e)}};u([bt({multiply:"multiply",replace:"replace",tint:"tint"})],E3.prototype,"colorMixMode",void 0),E3=Mj=u([P("esri.symbols.support.Symbol3DFillMaterial")],E3);function yi(e=UDe){return[e[0],e[1],e[2],e[3]]}function qAt(e){return[e[0],e[1],e[2],e[3]]}function O0(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function YZ(e,t,i,r,s=yi()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Mye(e,t=yi()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function G6(e,t){return new Gi({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function ZZ(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function A1(e,t,i){if(C(t))O0(i,e);else if("length"in t)Ij(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function c9(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<r;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function Rj(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function Mh(e){return C(e)||e[0]>=e[2]?0:e[2]-e[0]}function Ff(e){return e[1]>=e[3]?0:e[3]-e[1]}function Rye(e){return Mh(e)*Ff(e)}function JZ(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Oye(e,t){return j6(e,t[0],t[1])}function kie(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function WAt(e,t,i){const r=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=i,p=(b,w)=>(h-l)*b+(a-c)*w+(c*l-a*h)<0,f=p(r,o),m=p(n,o),y=p(n,s),_=p(r,s);return!(f===m&&m===y&&y===_&&_===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function XAt(e,t){return j6(e,t.x,t.y)}function j6(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function FDe(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function H6(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function Uie(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function Oj(e,t,i){if(C(t))return O0(i,e);const r=t[0],s=t[1],n=t[2],o=t[3];return i[0]=ye(e[0],r,n),i[1]=ye(e[1],s,o),i[2]=ye(e[2],r,n),i[3]=ye(e[3],s,o),i}function NDe(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-Mh(e)/2,0),n=Math.max(Math.abs(t[1]-r)-Ff(e)/2,0);return Math.sqrt(s*s+n*n)}function E5(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function rp(e){return e?O0(e,Pj):yi(Pj)}function Ij(e){return e!=null&&e.length===4}function kDe(e){return!(Mh(e)!==0&&isFinite(e[0])||Ff(e)!==0&&isFinite(e[1]))}function Hx(e,t){return Ij(e)&&Ij(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const YAt=[-1/0,-1/0,1/0,1/0],Pj=[1/0,1/0,-1/0,-1/0],UDe=[0,0,0,0];function ho(e=Dye){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function dT(e,t,i,r,s,n,o=ho()){return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function ZAt(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new Gi(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function JC(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function VDe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function Mg(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Lh(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<r;h++)s=Math.min(s,t[i+3*h]),n=Math.min(n,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),l=Math.max(l,t[i+3*h+1]),c=Math.max(c,t[i+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function u9(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function BDe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function QT(e){return e[0]>=e[3]?0:e[3]-e[0]}function eS(e){return e[1]>=e[4]?0:e[4]-e[1]}function pb(e){return e[2]>=e[5]?0:e[5]-e[2]}function Iye(e){const t=QT(e),i=pb(e),r=eS(e);return Math.sqrt(t*t+i*i+r*r)}function yf(e,t=[0,0,0]){return t[0]=e[0]+QT(e)/2,t[1]=e[1]+eS(e)/2,t[2]=e[2]+pb(e)/2,t}function gL(e,t=[0,0,0]){return t[0]=QT(e),t[1]=eS(e),t[2]=pb(e),t}function KZ(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function JAt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function zDe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function _f(e,t){return!!C(t)||zDe(e,t)}function Pye(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function KAt(e,t,i=e){const r=e[0]+QT(e)/2,s=e[1]+eS(e)/2,n=e[2]+pb(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function $ye(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function Lye(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function q6(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Xr(e){return e?q6(e,Vie):ho(Vie)}function QZ(e,t){return t||(t=yi()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function QAt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function GDe(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=Number.NEGATIVE_INFINITY,e[3]=r,e[4]=s,e[5]=Number.POSITIVE_INFINITY,e}function $j(e){return e.length===6}function eJ(e){return QT(e)===0&&eS(e)===0&&pb(e)===0}function eMt(e,t,i){if(C(e)||C(t))return e===t;if(!$j(e)||!$j(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function jDe(e,t,i,r,s,n){return dT(e,t,i,r,s,n,HDe)}const tMt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Vie=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Dye=[0,0,0,0,0,0],HDe=ho();function h9(e,{isPrimitive:t,width:i,depth:r,height:s}){const n=t?10:1;if(i==null&&s==null&&r==null)return[n*e[0],n*e[1],n*e[2]];const o=Le(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const qDe=dT(-.5,-.5,-.5,.5,.5,.5),WDe=dT(-.5,-.5,0,.5,.5,1),XDe=dT(-.5,-.5,0,.5,.5,.5);function YDe(e){switch(e){case"sphere":case"cube":case"diamond":return qDe;case"cylinder":case"cone":case"inverted-cone":return WDe;case"tetrahedron":return XDe;default:return}}const tJ=["butt","square","round"],ZDe=[...tJ,"none"],Fye=["miter","bevel","round"];var Lj;let ww=Lj=class extends ge{constructor(e){super(e),this.color=new De([0,0,0,1]),this.size=Gh(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:v(this.color)?this.color.clone():null,size:this.size,pattern:v(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new Lj(e)}};u([d(j0)],ww.prototype,"color",void 0),u([d(Ag)],ww.prototype,"size",void 0),u([d(Aye)],ww.prototype,"pattern",void 0),u([d({type:tJ,json:{default:"butt",write:{overridePolicy(){return{enabled:v(this.pattern)}}}}})],ww.prototype,"patternCap",void 0),ww=Lj=u([P("esri.symbols.support.Symbol3DOutline")],ww);var TN;let Sy=TN=class extends kg{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:v(this.edges)?this.edges.clone():null,enabled:this.enabled,material:v(this.material)?this.material.clone():null,pattern:v(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:v(this.outline)?this.outline.clone():null};return new TN(e)}static fromSimpleFillSymbol(e){var r,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new XZ({style:e.outline.style}):null,i={size:(s=(r=e.outline)==null?void 0:r.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:S3).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(i.patternCap=e.outline.cap),new TN({material:new E3({color:((l=e.color)!=null?l:LDe).clone()}),pattern:e.style&&e.style!=="solid"?new Cye({style:e.style}):null,outline:i})}};u([bt({Fill:"fill"},{readOnly:!0})],Sy.prototype,"type",void 0),u([d({type:E3,json:{write:!0}})],Sy.prototype,"material",void 0),u([d($De)],Sy.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Sy.prototype,"castShadows",void 0),u([d({type:ww,json:{write:!0}})],Sy.prototype,"outline",void 0),u([d(bye)],Sy.prototype,"edges",void 0),Sy=TN=u([P("esri.symbols.FillSymbol3DLayer")],Sy);const eM=Sy,JDe=["none","underline","line-through"],KDe=["normal","italic","oblique"],QDe=["normal","lighter","bold","bolder"],Nye={type:Number,cast:e=>{const t=Fd(e);return t===0?1:ye(t,.1,4)},nonNullable:!0},eFe=["left","right","center"],tFe=["baseline","top","middle","bottom"],kye={type:eFe,nonNullable:!0},Uye={type:tFe,nonNullable:!0};var Dj;let Ey=Dj=class extends ge{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return Cr(e)}clone(){return new Dj({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:JDe,json:{default:"none",write:!0}})],Ey.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Ey.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],Ey.prototype,"size",void 0),u([Zt("size")],Ey.prototype,"castSize",null),u([d({type:KDe,json:{default:"normal",write:!0}})],Ey.prototype,"style",void 0),u([d({type:QDe,json:{default:"normal",write:!0}})],Ey.prototype,"weight",void 0),Ey=Dj=u([P("esri.symbols.Font")],Ey);const W6=Ey,iFe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,rFe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Bie(e){const t=e==null?void 0:e.match(iFe);if(!t)return null;const[,i,r,s]=t;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=rFe;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function sFe(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}const nFe=se.getLogger("esri.core.urlUtils"),tM=or.request,zie="esri/config: esriConfig.request.proxyUrl is not set.",Vye=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Bye=/^\s*http:/i,oFe=/^\s*https:/i,aFe=/^\s*file:/i,lFe=/:\d+$/,cFe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,uFe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),hFe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class oC{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(uFe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(hFe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}}const yL={},dFe=new oC(or.applicationUrl);let Gl=dFe;const pFe=fFe();let iJ=pFe;const rJ=()=>Gl,iMt=()=>iJ;function fFe(){const e=Gl.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${Gl.scheme}://${Gl.host}${Gl.port!=null?`:${Gl.port}`:""}`}${t}`}function Ma(e){if(!e)return null;const t={path:null,query:null},i=new oC(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=zye(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function zye(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function Gie(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function DI(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>Gie(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):Gie(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function mFe(e=!1){let t,i=tM.proxyUrl;if(typeof e=="string"){t=xFe(e);const r=X6(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw nFe.warn(zie),new H("urlutils:proxy-not-set",zie);return t&&Fj()&&(i=cJ(i)),Ma(i)}function rMt(e){const t=X6(e);let i,r;if(t){const s=sJ(t.proxyUrl);i=s.path,r=s.query?zye(s.query):null}if(i){const s=Ma(e);e=i+"?"+s.path;const n=DI({...r,...s.query});n&&(e=`${e}?${n}`)}return e}const kM={path:"",query:""};function sJ(e){const t=e.indexOf("?");return t!==-1?(kM.path=e.slice(0,t),kM.query=e.slice(t+1)):(kM.path=e,kM.query=null),kM}function Gye(e){return e=(e=A5(e=AFe(e=sJ(e).path),!0)).toLowerCase()}function gFe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:Gye(e.urlPrefix)},i=tM.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,t),s}function X6(e){const t=tM.proxyRules,i=Gye(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function yFe(e,t){if(!e||!t)return!1;e=C5(e),t=C5(t);const i=Bie(e),r=Bie(t);return v(i)&&v(r)?i.portalHostname===r.portalHostname:!v(i)&&!v(r)&&KC(e,t,!0)}function jye(e,t){return e=C5(e),t=C5(t),A5(e)===A5(t)}function C5(e){const t=(e=Yd(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function Hye(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=tM.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function KC(e,t,i=!1){if(!e||!t)return!1;const r=kj(e),s=kj(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function nJ(e){if(typeof e=="string"){if(!Nh(e))return!0;e=kj(e)}if(KC(e,Gl))return!0;const t=tM.trustedServers||[];for(let i=0;i<t.length;i++){const r=_Fe(t[i]);for(let s=0;s<r.length;s++)if(KC(e,r[s]))return!0}return!1}function _Fe(e){return yL[e]||(lJ(e)||Rg(e)?yL[e]=[new oC(Rh(e))]:yL[e]=[new oC(`http://${e}`),new oC(`https://${e}`)]),yL[e]}function Rh(e,t=iJ,i){return Rg(e)?i&&i.preserveProtocolRelative?e:Gl.scheme==="http"&&Gl.authority===Af(e).slice(2)?`http:${e}`:`https:${e}`:lJ(e)?e:pT(e[0]==="/"?CFe(t):t,e)}function oJ(e,t=iJ,i){if(e==null||!Nh(e))return e;const r=Yd(e),s=r.toLowerCase(),n=Yd(t).toLowerCase().replace(/\/+$/,""),o=i?Yd(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function Yd(e){return e=OFe(e=RFe(e=MFe(e=Rh(e=e.trim()))))}function pT(...e){const t=e.filter(v);if(!t||!t.length)return;const i=[];if(Nh(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),SFe(t[0])&&(i[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Af(e,t=!1){if(e==null||QC(e)||Ug(e))return null;let i=e.indexOf("://");if(i===-1&&Rg(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=A5(e,!0)),e}function Nh(e){return Rg(e)||lJ(e)}function QC(e){return e!=null&&e.slice(0,5)==="blob:"}function Ug(e){return e!=null&&e.slice(0,5)==="data:"}function aJ(e){const t=d$(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function sMt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const vFe=/^data:(.*?)(;base64)?,(.*)$/;function d$(e){const t=e.match(vFe);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function qye(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function nMt(e){const t=aJ(e);if(!t)return null;const i=d$(e);return new Blob([t],{type:i.mediaType})}function oMt(e,t){bFe(e,t)||wFe(e,t)}function bFe(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function wFe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function Rg(e){return e!=null&&e[0]==="/"&&e[1]==="/"}function lJ(e){return e!=null&&Vye.test(e)}function xFe(e){return e!=null&&oFe.test(e)||Gl.scheme==="https"&&Rg(e)}function TFe(e){return e!=null&&Bye.test(e)||Gl.scheme==="http"&&Rg(e)}function SFe(e){return e!=null&&aFe.test(e)}function cJ(e){return Rg(e)?`https:${e}`:e.replace(Bye,"https:")}function EFe(){return Gl.scheme==="http"}function Fj(){return Gl.scheme==="https"}function A5(e,t=!1){return Rg(e)?e.slice(2):(e=e.replace(Vye,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function CFe(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function uJ(e){let t=0;if(Nh(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function aMt(e,t){if(!e)return"";const i=Ma(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(t!=null&&t.length))return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function AFe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function Wye(e){return e.replace(/\/+$/,"")}function MFe(e){if(/^https?:\/\//i.test(e)){const t=sJ(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function RFe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function OFe(e){const t=tM.httpsDomains;if(!TFe(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),lFe.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return EFe()&&r===Gl.authority&&!cFe.test(e)||(Fj()&&r===Gl.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||Fj()&&!X6(e))&&(e=cJ(e)),e}function Nj(e,t,i){if(!(t&&i&&e&&Nh(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function kj(e){return typeof e=="string"?new oC(Rh(e)):(e.scheme||(e.scheme=Gl.scheme),e)}function Xye(e){return IFe.test(e)}function Yye(e,t){const i=Ma(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function Zye(e,t,i){const r=Ma(e),s=r.query||{};return s[t]=String(i),`${r.path}?${DI(s)}`}function d9(e,t){const i=Ma(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=DI(r);return s?`${i.path}?${s}`:i.path}function lMt(e){if(C(e))return null;const t=e.match(Jye);return t?t[2]:null}function jie(e){if(C(e))return null;const t=e.match(Jye);return t?{path:t[1],extension:t[2]}:{path:e,extension:null}}const Jye=/([^.]*)\.([^\/]*)$/,IFe=/(^data:image\/svg|\.svg$)/i;function z1(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=Rh(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=oJ(e,t.portalItem.itemUrl);r!=null&&PFe.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return Uj(e,t&&t.portal)}function fT(e,t,i=FI.YES){if(e==null)return e;!Nh(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=Rh(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=Uj(s,t.portal),o=Uj(r,t.portal);r=oJ(o,n,n),r!=null&&r!==o&&r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=Qye(r,t==null?void 0:t.portal),Nh(r)&&(r=Yd(r)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!Nh(r)&&!Ug(r)&&i===FI.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),r}function hJ(e,t,i){return z1(e,i)}function G1(e,t,i,r){const s=fT(e,r);s!==void 0&&(t[i]=s)}const Kye=/\/items\/([^\/]+)\/resources\/(.*)/,PFe=/^\.\/resources\//;function $Fe(e){var t,i,r;return(r=(i=(t=e==null?void 0:e.match(Kye))!=null?t:null)==null?void 0:i[1])!=null?r:null}function LFe(e){var o;const t=(o=e==null?void 0:e.match(Kye))!=null?o:null;if(t==null)return null;const i=t[2],r=i.lastIndexOf("/");if(r===-1){const{path:a,extension:l}=jie(i);return{prefix:null,filename:a,extension:l}}const{path:s,extension:n}=jie(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function Qye(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?Nj(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function Uj(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=rJ();return KC(r,`${r.scheme}://${i}`)?Nj(e,t.portalHostname,i):Nj(e,i,t.portalHostname)}var FI;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(FI||(FI={}));const cMt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return FI},ensureMainOnlineDomain:Qye,fromJSON:z1,itemIdFromResourceUrl:$Fe,prefixAndFilenameFromResourceUrl:LFe,read:hJ,toJSON:fT,write:G1},Symbol.toStringTag,{value:"Module"}));var Vj;const DFe=bl()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let xw=Vj=class extends ge{constructor(e){super(e)}readHref(e,t,i){return e?z1(e,i):t.dataURI}writeHref(e,t,i,r){e&&(Ug(e)?t.dataURI=e:(t.href=fT(e,r),Nh(t.href)&&(t.href=Yd(t.href))))}clone(){return new Vj({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],xw.prototype,"href",void 0),u([Fe("href")],xw.prototype,"readHref",null),u([Ge("href",{href:{type:String},dataURI:{type:String}})],xw.prototype,"writeHref",null),u([bt(DFe)],xw.prototype,"primitive",void 0),xw=Vj=u([P("esri.symbols.support.IconSymbol3DLayerResource")],xw);const e0e="circle";var Bj;let IE=Bj=class extends Te{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new Bj({x:this.x,y:this.y})}};u([d({type:Number})],IE.prototype,"x",void 0),u([d({type:Number})],IE.prototype,"y",void 0),IE=Bj=u([P("esri.symbols.support.Symbol3DAnchorPosition2D")],IE);var zj;let nO=zj=class extends ge{constructor(e){super(e),this.color=new De([0,0,0,1]),this.size=Gh(1)}clone(){const e={color:v(this.color)?this.color.clone():null,size:this.size};return new zj(e)}};u([d(j0)],nO.prototype,"color",void 0),u([d(Ag)],nO.prototype,"size",void 0),nO=zj=u([P("esri.symbols.support.Symbol3DIconOutline")],nO);var $2;const t0e="esri.symbols.IconSymbol3DLayer";let bm=$2=class extends kg{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new $2({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,outline:v(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||S3,i=Hie(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||S3).clone()}:null;return new $2({size:e.size,resource:{primitive:NFe(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||DDe(e.color)?S3:e.color,i=Hie(e);return new $2({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new $2({resource:{href:qye({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function Hie(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=qie(e.xoffset),s=qie(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function qie(e){return isFinite(e)?e:0}u([d({type:Fh,json:{write:!0}})],bm.prototype,"material",void 0),u([d({type:xw,json:{write:!0}})],bm.prototype,"resource",void 0),u([bt({Icon:"icon"},{readOnly:!0})],bm.prototype,"type",void 0),u([d(Ag)],bm.prototype,"size",void 0),u([bt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],bm.prototype,"anchor",void 0),u([d({type:IE,json:{type:[Number],read:{reader:e=>new IE({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],bm.prototype,"anchorPosition",void 0),u([d({type:nO,json:{write:!0}})],bm.prototype,"outline",void 0),bm=$2=u([P(t0e)],bm);const FFe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function NFe(e){return FFe[e]||(se.getLogger(t0e).warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const a1=bm;function mT(e,t,i=Qe){return t||(t=new i),t===e||(t.removeAll(),kFe(e)?t.addMany(e):e&&t.add(e)),t}function i0e(e){return e}function kFe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const r0e="20230301",s0e="2657e728c1857e6d94c324181c0788310bb0958a",n0e="4.26",UFe={async request(e,t){var a,l;const{default:i}=await Q(()=>Promise.resolve().then(function(){return tNe}),void 0),r=e.options,s=r.responseType;r.signal=t==null?void 0:t.signal,r.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&((a=Hye(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await i(e.url,r),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((l=n.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Sr;function uMt(e){Sr=e}function hMt(e){const t=Sr&&Sr.findCredential(e);return t&&t.token?Zye(e,"token",t.token):e}he("host-webworker");const VFe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function o0e(e){const t=Af(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!VFe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function a0e(e,t,i=!1,r){return new Promise((s,n)=>{if(So(r))return void n(Wie());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n(Wie())};const c=()=>{he("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,v(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(t)};v(r)&&r.addEventListener("abort",l),he("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function Wie(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function BFe(e){var i,r,s;or.request.crossOriginNoCorsDomains||(or.request.crossOriginNoCorsDomains={});const t=or.request.crossOriginNoCorsDomains;for(let n of e)n=n.toLowerCase(),/^https?:\/\//.test(n)?t[(i=Af(n))!=null?i:""]=0:(t[(r=Af("http://"+n))!=null?r:""]=0,t[(s=Af("https://"+n))!=null?s:""]=0)}function zFe(e){const t=or.request.crossOriginNoCorsDomains;if(t){let i=Af(e);if(i)return i=i.toLowerCase(),!KC(i,rJ())&&t[i]<Date.now()-36e5}return!1}async function GFe(e){var s;const t=or.request.crossOriginNoCorsDomains,i=Af(e);t&&i&&(t[i.toLowerCase()]=Date.now());const r=Ma(e);e=r.path,((s=r.query)==null?void 0:s.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function _r(e,t){var c;const i=Ug(e),r=QC(e);r||i||(e=Yd(e));const s={url:e,requestOptions:{...t}};let n=Hye(e);if(n){const h=await JFe(n,s);if(h!=null)return{data:h,getHeader:dJ,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(he("host-webworker")||he("host-node"))throw vf("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw vf("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw vf("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw vf("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await XFe(),M5)return M5.execute(e,t);const o=new AbortController;fl(t,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:nf.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await QFe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let M5;const nf=or.request,l0e="FormData"in globalThis,jFe=[499,498,403,401],HFe=["COM_0056","COM_0057","SB_0008"],qFe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],dJ=()=>null,R5=Symbol();function WFe(e){const t=Af(e);t&&!_r._corsServers.includes(t)&&_r._corsServers.push(t)}function Xie(e){const t=Af(e);return!t||t.endsWith(".arcgis.com")||_r._corsServers.includes(t)||nJ(t)}function vf(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:dJ,ssl:!1};if(t instanceof H)return t.details?(t.details=ne(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=R5 in t?t[R5]:t}return Ws(t)?lr():new H(e,s,n)}async function XFe(){he("host-webworker")?M5||(M5=await Q(()=>import("./request.4de3bcc9.js"),[])):_r._abortableFetch||(_r._abortableFetch=globalThis.fetch.bind(globalThis))}async function Gj(){Sr||await Q(()=>import("./IdentityManager.686f341c.js"),[])}async function YFe(e){var a;const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,o=null;if(l0e&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:i.cacheBust&&!_r._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:nf.priority,redirect:"follow",signal:r},(n||o)&&(e.fetchOptions.body=n||o),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=i.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&or.apiKey&&o0e(t)&&(i.query||(i.query={}),i.query.token=or.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!c0e(t)&&!So(r)){let l;i.authMode==="immediate"?(await Gj(),l=await Sr.getCredential(t,{signal:r}),e.credential=l):i.authMode==="no-prompt"?(await Gj(),l=await Sr.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=l):Sr&&(l=Sr.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function c0e(e){return qFe.some(t=>t.test(e))}async function ZFe(e){var f,m;let t=e.params.url;const i=e.params.requestOptions,r=(f=e.fetchOptions)!=null?f:{},s=QC(t)||Ug(t),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:nf.timeout;let a=!1;if(!s){e.useSSL&&(t=cJ(t)),i.cacheBust&&r.cache==="default"&&(t=Zye(t,"request.preventCache",Date.now()));let y={...i.query};e.credentialToken&&(y.token=e.credentialToken);let _=DI(y);he("esri-url-encodes-apostrophe")&&(_=_.replace(/'/g,"%27"));const b=t.length+1+_.length;let w;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||b>nf.maxUrlLength;const T=i.useProxy||!!X6(t);if(T){const S=mFe(t);w=S.path,!a&&w.length+1+b>nf.maxUrlLength&&(a=!0),S.query&&(y={...S.query,...y})}if(r.method==="HEAD"&&(a||T)){if(a)throw b>nf.maxUrlLength?vf("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):vf("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(T)throw vf("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=d9(t,y):(r.body=DI(y),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=d9(t,y),T&&(e.useProxy=!0,t=`${w}?${t}`),y.token&&l0e&&r.body instanceof FormData&&!sFe(t)&&r.body.set("token",y.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!KC(t,rJ())){if(nJ(t))e.withCredentials=!0;else if(Sr){const S=Sr.findServerInfo(t);S&&S.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include",zFe(t)&&await GFe(a?d9(t,y):t))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||KFe(i.headers)||!s&&!e.useProxy&&nf.proxyUrl&&!Xie(t)){if(l=await _r._abortableFetch(t,r),e.useProxy||WFe(t),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Yie(c,"application/xml");break;case"document":c=Yie(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const y=l.headers.get("Content-Type");if(y&&/application\/json|text\/plain/i.test(y)&&c[n==="blob"?"size":"byteLength"]<=750)try{const _=await new Response(c).json();_.error&&(c=_)}catch{}}n==="image"&&c instanceof Blob&&(c=await Zie(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await Zie(t,e)}catch(y){if(y.name==="AbortError")throw p?new Error("Timeout exceeded"):lr("Request canceled");if(!(!l&&y instanceof TypeError&&nf.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||Xie(t))throw y;e.redoRequest=!0,gFe({proxyUrl:nf.proxyUrl,urlPrefix:(m=Af(t))!=null?m:""})}finally{h&&clearTimeout(h)}return[l,c]}async function JFe(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let i,r;try{r=await e.before(t)}catch(s){i=vf("request:interceptor",s,t)}if((r instanceof Error||r instanceof H)&&(i=vf("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function KFe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function Yie(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function QFe(e){var n,o;let t,i;await YFe(e);try{do[t,i]=await ZFe(e);while(!await eNe(e,t,i))}catch(a){const l=vf("request:server",a,e.params,t);throw l.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(l),l}const r=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!e.hasToken&&!e.credentialToken&&((n=i.user)==null?void 0:n.username)&&!nJ(r)){const a=Af(r,!0);a&&nf.trustedServers.push(a)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&BFe(i.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&Sr){const a=Sr.findServerInfo(s.server);let l=a&&a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Sr.findCredential(l,s.userId);c&&Sr._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:i,getHeader:t?a=>t==null?void 0:t.headers.get(a):dJ,httpStatus:(o=t==null?void 0:t.status)!=null?o:200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function eNe(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[R5]=i,s;i&&(i.error?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[R5]=i,s.details=i.messages));let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o&&o.toUpperCase());const l=r.authMode;if(n===403&&(a===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&jFe.includes(n)&&!c0e(e.params.url)&&(n!==403||o&&!HFe.includes(o)&&(a==null||a===2&&e.credentialToken))){await Gj();try{const c=await Sr.getCredential(e.params.url,{error:vf("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=void 0,e.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function Zie(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=nf.priority,s.src=e,a0e(s,e,i,r)}_r._abortableFetch=null,_r._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var tNe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:_r}),Fv;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(Fv||(Fv={}));class iNe{constructor(t){this.instance=t,this._resolver=V1(),this._status=Fv.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Fv.RESOLVED,this._cleanUp()},()=>{this._status=Fv.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===Fv.RESOLVED}isRejected(){return this._status===Fv.REJECTED}isFulfilled(){return this._status!==Fv.PENDING}abort(){this._resolver.reject(lr())}when(t,i){return this._resolver.promise.then(t,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=V1(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||Ws(s)||this._resolver.reject(s)}),t.resolve()}}const p$=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new iNe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=u([P("esri.core.Promise")],t),t};let O5=class extends p$(Te){};O5=u([P("esri.core.Promise")],O5);const rNe="not-loaded",sNe="loading",nNe="failed",Jie="loaded",u0e=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=gZ(n,l);this.destroyed&&l(new H("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===rNe){this._set("loadStatus",sNe);const a=this._loadController=new AbortController;s({signal:a.signal}),fl(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",Jie),this._loadController=null},r=>{this._set("loadStatus",nNe),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===Jie}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new H("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([d({readOnly:!0})],t.prototype,"loaded",null),u([d({readOnly:!0})],t.prototype,"loadError",void 0),u([d({clonable:!1})],t.prototype,"loadStatus",void 0),u([d({type:[Bh],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([P("esri.core.Loadable")],t),t};let oO=class extends u0e(O5){};oO=u([P("esri.core.Loadable")],oO),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=u0e,e.isLoadable=t}(oO||(oO={}));const sp=oO;var jj;const oNe=new _i({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let fd=jj=class extends Te{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new jj({categories:this.categories?ne(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=YT(this.extent,et.WGS84);v(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>oNe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...t,...n}}}};u([d()],fd.prototype,"categories",void 0),u([d()],fd.prototype,"disableExtraQuery",void 0),u([d({type:Gi})],fd.prototype,"extent",void 0),u([d()],fd.prototype,"filter",void 0),u([d()],fd.prototype,"num",void 0),u([d()],fd.prototype,"query",void 0),u([d()],fd.prototype,"sortField",void 0),u([d()],fd.prototype,"sortOrder",null),u([d()],fd.prototype,"start",void 0),fd=jj=u([P("esri.portal.PortalQueryParams")],fd);const s0=fd;let Tw=class extends Te{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],Tw.prototype,"nextQueryParams",void 0),u([d()],Tw.prototype,"queryParams",void 0),u([d()],Tw.prototype,"results",void 0),u([d()],Tw.prototype,"total",void 0),Tw=u([P("esri.portal.PortalQueryResult")],Tw);const aNe=Tw;let Cy=class extends ge{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new H("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],Cy.prototype,"created",void 0),u([d()],Cy.prototype,"id",void 0),u([d()],Cy.prototype,"portal",void 0),u([d()],Cy.prototype,"title",void 0),u([d({readOnly:!0})],Cy.prototype,"url",null),u([d()],Cy.prototype,"username",void 0),Cy=u([P("esri.portal.PortalFolder")],Cy);const lNe=Cy;let aa=class extends ge{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,t=this.thumbnail;return e&&t&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return ba(this.portal).request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return ba(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=zr(s0,e);const r=ba(this.portal);return parseFloat(r.currentVersion)>5?(i=i||new s0,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new s0,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,t))}_fetchCategorySchemaSet(e,t){const i=ba(this.portal);return i.fetchSelf(i.authMode,!0,t).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new s0;return n.disableExtraQuery=!0,n.num=1,n.query=s,i.queryGroups(n,t)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new s0;return n.num=1,n.query=`typekeywords:"${e}"`,s.queryItems(n,t)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",t).then(s=>{const n=s&&s.categorySchema;return n&&n.length?n:[]}):[])}};u([d()],aa.prototype,"access",void 0),u([d({type:Date})],aa.prototype,"created",void 0),u([d()],aa.prototype,"description",void 0),u([d()],aa.prototype,"id",void 0),u([d()],aa.prototype,"isInvitationOnly",void 0),u([d({type:Date})],aa.prototype,"modified",void 0),u([d()],aa.prototype,"owner",void 0),u([d()],aa.prototype,"portal",void 0),u([d()],aa.prototype,"snippet",void 0),u([d()],aa.prototype,"sortField",void 0),u([d()],aa.prototype,"sortOrder",void 0),u([d()],aa.prototype,"tags",void 0),u([d()],aa.prototype,"thumbnail",void 0),u([d({readOnly:!0})],aa.prototype,"thumbnailUrl",null),u([d()],aa.prototype,"title",void 0),u([d({readOnly:!0})],aa.prototype,"url",null),aa=u([P("esri.portal.PortalGroup")],aa);const Hj=aa;var cNe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Hj}),qj;let en=qj=class extends ge{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal.normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal.request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal.request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){var t;const e={query:{num:1}};return this.portal.request((t=this.userContentUrl)!=null?t:"",e).then(i=>{let r;return r=i&&i.folders?i.folders.map(s=>{const n=lNe.fromJSON(s);return n.portal=this.portal,n}):[],r})}fetchGroups(){var e;return this.portal.request((e=this.url)!=null?e:"").then(t=>{let i;return i=t&&t.groups?t.groups.map(r=>{const s=Hj.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchItems(e){var s;const t=e!=null?e:{};let i,r=(s=this.userContentUrl)!=null?s:"";return t.folder&&(r+="/"+t.folder.id),Q(()=>Promise.resolve().then(function(){return p1e}),void 0).then(({default:n})=>{i=n;const o={folders:!1,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"};return this.portal.request(r,{query:o})}).then(n=>{let o;return n&&n.items?(o=n.items.map(a=>{const l=i.fromJSON(a);return l.portal=this.portal,l}),Promise.all(o.map(a=>a.load())).catch(a=>a).then(()=>({items:o,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new Hj({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new H("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new qj;return t.sourceJSON=e,t.read(e),t}};u([d()],en.prototype,"access",void 0),u([d({type:Date})],en.prototype,"created",void 0),u([d()],en.prototype,"culture",void 0),u([d()],en.prototype,"description",void 0),u([d()],en.prototype,"email",void 0),u([d()],en.prototype,"favGroupId",void 0),u([d()],en.prototype,"fullName",void 0),u([d({type:Date})],en.prototype,"modified",void 0),u([d()],en.prototype,"orgId",void 0),u([d()],en.prototype,"portal",void 0),u([d()],en.prototype,"preferredView",void 0),u([d()],en.prototype,"privileges",void 0),u([d()],en.prototype,"region",void 0),u([d()],en.prototype,"role",void 0),u([d()],en.prototype,"roleId",void 0),u([d()],en.prototype,"sourceJSON",void 0),u([d()],en.prototype,"thumbnail",void 0),u([d({readOnly:!0})],en.prototype,"thumbnailUrl",null),u([d()],en.prototype,"units",void 0),u([d({readOnly:!0})],en.prototype,"userContentUrl",null),u([d({readOnly:!0})],en.prototype,"url",null),u([d()],en.prototype,"username",void 0),u([d()],en.prototype,"userType",void 0),en=qj=u([P("esri.portal.PortalUser")],en);const pJ=en;var uNe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:pJ}),Ku;let p9;const Kie={PortalGroup:()=>Q(()=>Promise.resolve().then(function(){return cNe}),void 0),PortalItem:()=>Q(()=>Promise.resolve().then(function(){return p1e}),void 0),PortalUser:()=>Q(()=>Promise.resolve().then(function(){return uNe}),void 0)};let He=Ku=class extends l$(sp){constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=or.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriIdCredentialCreateHandle=hs(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)or.request.trustedServers.includes(t)||or.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=pJ.fromJSON(e),t.portal=this),t}load(e){const t=Q(()=>Promise.resolve().then(function(){return DBe}),void 0).then(({default:i})=>{ii(e),p9=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,e)).then(i=>{if(Sr){const r=Sr;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==Ku.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this.signIn().catch(()=>{})}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await Q(()=>import("./ElevationLayer.c097a187.js"),["assets/ElevationLayer.c097a187.js","assets/ArcGISCachedService.3429d90e.js","assets/TilemapCache.c51d4c38.js"])).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}fetchBasemaps(e,t){const i=new s0;return i.query=e||(or.apiKey&&o0e(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,t)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new p9({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):So(e)?Promise.reject(lr()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new s0;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return So(e)?Promise.reject(lr()):Promise.resolve([])}fetchRegions(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Xd();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Xd();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return Ku._default&&!Ku._default.destroyed||(Ku._default=new Ku),Ku._default}queryGroups(e,t){return this.queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this.queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",t)}fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s={authMode:e,query:{culture:Xd().toLowerCase()},...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this.request(r,s)}queryPortal(e,t,i,r){const s=zr(s0,t),n=o=>this.request(this.restUrl+e,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new aNe({nextQueryParams:l,queryParams:s,total:a.total,results:Ku._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(bu(l),a)));return i&&Kie[i]?Kie[i]().then(({default:o})=>(ii(r),n(o))):n()}signIn(){if(this.authMode===Ku.AUTH_MODE_ANONYMOUS)return Promise.reject(new H("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this.fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Sr?Sr.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}requestToTypedArray(e,t,i){return this.request(e,t).then(r=>{const s=Ku._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(e,t={}){const i={f:"json",...t.query},{authMode:r=this.authMode===Ku.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return _r(this._normalizeSSL(e),c).then(h=>h.data)}toJSON(){throw new H("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Ku({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new H("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const t=p9.fromJSON(e);return t.portalItem={portal:this},t}return null}static _resultsToTypedArray(e,t,i,r){let s=[];if(i){const n=v(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};He.AUTH_MODE_ANONYMOUS="anonymous",He.AUTH_MODE_AUTO="auto",He.AUTH_MODE_IMMEDIATE="immediate",u([d()],He.prototype,"access",void 0),u([d()],He.prototype,"allSSL",void 0),u([d()],He.prototype,"authMode",void 0),u([d()],He.prototype,"authorizedCrossOriginDomains",void 0),u([Fe("authorizedCrossOriginDomains")],He.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],He.prototype,"basemapGalleryGroupQuery",void 0),u([d()],He.prototype,"bingKey",void 0),u([d()],He.prototype,"canListApps",void 0),u([d()],He.prototype,"canListData",void 0),u([d()],He.prototype,"canListPreProvisionedItems",void 0),u([d()],He.prototype,"canProvisionDirectPurchase",void 0),u([d()],He.prototype,"canSearchPublic",void 0),u([d()],He.prototype,"canShareBingPublic",void 0),u([d()],He.prototype,"canSharePublic",void 0),u([d()],He.prototype,"canSignInArcGIS",void 0),u([d()],He.prototype,"canSignInIDP",void 0),u([d()],He.prototype,"colorSetsGroupQuery",void 0),u([d()],He.prototype,"commentsEnabled",void 0),u([d({type:Date})],He.prototype,"created",void 0),u([d()],He.prototype,"credential",void 0),u([d()],He.prototype,"culture",void 0),u([d()],He.prototype,"currentVersion",void 0),u([d()],He.prototype,"customBaseUrl",void 0),u([d()],He.prototype,"defaultBasemap",void 0),u([Fe("defaultBasemap")],He.prototype,"readDefaultBasemap",null),u([d()],He.prototype,"defaultDevBasemap",void 0),u([Fe("defaultDevBasemap")],He.prototype,"readDefaultDevBasemap",null),u([d({type:Gi})],He.prototype,"defaultExtent",void 0),u([d()],He.prototype,"defaultVectorBasemap",void 0),u([Fe("defaultVectorBasemap")],He.prototype,"readDefaultVectorBasemap",null),u([d()],He.prototype,"description",void 0),u([d()],He.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],He.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],He.prototype,"extraQuery",null),u([d()],He.prototype,"featuredGroups",void 0),u([d()],He.prototype,"featuredItemsGroupQuery",void 0),u([d()],He.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],He.prototype,"livingAtlasGroupQuery",void 0),u([d()],He.prototype,"hasCategorySchema",void 0),u([d()],He.prototype,"helpBase",void 0),u([d()],He.prototype,"helperServices",void 0),u([d()],He.prototype,"helpMap",void 0),u([d()],He.prototype,"homePageFeaturedContent",void 0),u([d()],He.prototype,"homePageFeaturedContentCount",void 0),u([d()],He.prototype,"httpPort",void 0),u([d()],He.prototype,"httpsPort",void 0),u([d()],He.prototype,"id",void 0),u([d()],He.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],He.prototype,"isOrganization",null),u([d()],He.prototype,"isPortal",void 0),u([d()],He.prototype,"isReadOnly",void 0),u([d({readOnly:!0})],He.prototype,"itemPageUrl",null),u([d()],He.prototype,"layerTemplatesGroupQuery",void 0),u([d()],He.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],He.prototype,"modified",void 0),u([d()],He.prototype,"name",void 0),u([d()],He.prototype,"portalHostname",void 0),u([d()],He.prototype,"portalMode",void 0),u([d()],He.prototype,"portalProperties",void 0),u([d()],He.prototype,"region",void 0),u([d({readOnly:!0})],He.prototype,"restUrl",null),u([d()],He.prototype,"rotatorPanels",void 0),u([d()],He.prototype,"showHomePageDescription",void 0),u([d()],He.prototype,"sourceJSON",void 0),u([d()],He.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],He.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],He.prototype,"stylesGroupQuery3d",void 0),u([d()],He.prototype,"supportsHostedServices",void 0),u([d()],He.prototype,"symbolSetsGroupQuery",void 0),u([d()],He.prototype,"templatesGroupQuery",void 0),u([d()],He.prototype,"thumbnail",void 0),u([d({readOnly:!0})],He.prototype,"thumbnailUrl",null),u([d()],He.prototype,"units",void 0),u([d()],He.prototype,"url",void 0),u([d()],He.prototype,"urlKey",void 0),u([Fe("urlKey")],He.prototype,"readUrlKey",null),u([d()],He.prototype,"user",void 0),u([Fe("user")],He.prototype,"readUser",null),u([d()],He.prototype,"useStandardizedQuery",void 0),u([d()],He.prototype,"useVectorBasemaps",void 0),u([d()],He.prototype,"vectorBasemapGalleryGroupQuery",void 0),He=Ku=u([P("esri.portal.Portal")],He);const po=He;let Sw=class extends Ys(ge){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return v(e)&&e.placement===this.placement&&e.style===this.style&&(C(this.color)&&C(e.color)||v(this.color)&&v(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Sw.prototype,"type",void 0),u([d({type:MDe,json:{default:"begin-end",write:!0}})],Sw.prototype,"placement",void 0),u([d({type:xye,json:{default:"arrow",write:!0}})],Sw.prototype,"style",void 0),u([d({type:De,json:{type:[us],default:null,write:!0}})],Sw.prototype,"color",void 0),Sw=u([P("esri.symbols.LineStyleMarker3D")],Sw);const Wj=Sw;var SN;let wm=SN=class extends kg{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Gh(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:v(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:v(this.pattern)?this.pattern.clone():null,marker:v(this.marker)?this.marker.clone():null};return new SN(e)}static fromSimpleLineSymbol(e){var i,r,s;const t={enabled:!0,size:(i=e.width)!=null?i:Gh(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new XZ({style:e.style}):null,material:new Fh({color:(e.color||S3).clone()}),marker:e.marker?new Wj({placement:e.marker.placement,style:e.marker.style,color:(s=(r=e.marker.color)==null?void 0:r.clone())!=null?s:null}):null};return new SN(t)}};u([d({type:Fh,json:{write:!0}})],wm.prototype,"material",void 0),u([bt({Line:"line"},{readOnly:!0})],wm.prototype,"type",void 0),u([d({type:Fye,json:{write:!0,default:"miter"}})],wm.prototype,"join",void 0),u([d({type:tJ,json:{write:!0,default:"butt"}})],wm.prototype,"cap",void 0),u([d(Ag)],wm.prototype,"size",void 0),u([d(Aye)],wm.prototype,"pattern",void 0),u([d({types:{key:"type",base:Wj,typeMap:{style:Wj}},json:{write:!0}})],wm.prototype,"marker",void 0),wm=SN=u([P("esri.symbols.LineSymbol3DLayer")],wm);const f$=wm;var Xj;const hNe=bl()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let aO=Xj=class extends ge{clone(){return new Xj({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:hJ,write:G1}})],aO.prototype,"href",void 0),u([bt(hNe)],aO.prototype,"primitive",void 0),aO=Xj=u([P("esri.symbols.support.ObjectSymbol3DLayerResource")],aO);const fJ="sphere";var Yj;let dx=Yj=class extends Te{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new Yj({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],dx.prototype,"x",void 0),u([d({type:Number})],dx.prototype,"y",void 0),u([d({type:Number})],dx.prototype,"z",void 0),dx=Yj=u([P("esri.symbols.support.Symbol3DAnchorPosition3D")],dx);var Zj;let Pl=Zj=class extends kg{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new Zj({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:Fh,json:{write:!0}})],Pl.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Pl.prototype,"castShadows",void 0),u([d({type:aO,json:{write:!0}})],Pl.prototype,"resource",void 0),u([bt({Object:"object"},{readOnly:!0})],Pl.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Pl.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],Pl.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],Pl.prototype,"depth",void 0),u([bt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],Pl.prototype,"anchor",void 0),u([d({type:dx,json:{type:[Number],read:{reader:e=>new dx({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Pl.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],Pl.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],Pl.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],Pl.prototype,"roll",void 0),u([d({readOnly:!0})],Pl.prototype,"isPrimitive",null),Pl=Zj=u([P("esri.symbols.ObjectSymbol3DLayer")],Pl);const mJ=Pl;var Jj;let fc=Jj=class extends kg{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new Jj({enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:Fh,json:{write:!0}})],fc.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],fc.prototype,"castShadows",void 0),u([bt({Path:"path"},{readOnly:!0})],fc.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],fc.prototype,"profile",void 0),u([d({type:Fye,json:{write:!0,default:"miter"}})],fc.prototype,"join",void 0),u([d({type:ZDe,json:{write:!0,default:"butt"}})],fc.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],fc.prototype,"width",void 0),u([Fe("width",["width","size","height"])],fc.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],fc.prototype,"height",void 0),u([Fe("height",["height","size","width"])],fc.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],fc.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],fc.prototype,"profileRotation",void 0),fc=Jj=u([P("esri.symbols.PathSymbol3DLayer")],fc);const gJ=fc;var Kj;let PE=Kj=class extends ge{constructor(){super(...arguments),this.color=new De([0,0,0,1]),this.size=0}clone(){const e={color:ne(this.color),size:this.size};return new Kj(e)}};u([d(j0)],PE.prototype,"color",void 0),u([d(Ag)],PE.prototype,"size",void 0),PE=Kj=u([P("esri.symbols.support.Symbol3DHalo")],PE);let C3=class extends Ys(ge){constructor(e){super(e),this.color=null}};u([d(j0)],C3.prototype,"color",void 0),C3=u([P("esri.symbols.support.Symbol3DTextBackground")],C3);var EN;let Qc=EN=class extends kg{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){v(e)&&v(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s={...r,textSymbol3D:!0};t.font=e.write({},s),delete t.font.size}get size(){return v(this._userSize)?this._userSize:v(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,v(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new EN({enabled:this.enabled,font:this.font&&ne(this.font),halo:this.halo&&ne(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:v(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ne(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new EN({font:v(e.font)?e.font.clone():new W6,halo:dNe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Fh({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new C3({color:e.backgroundColor.clone()}):null})}};function dNe(e,t){return e&&t!=null&&t>0?new PE({color:ne(e),size:t}):null}u([d({type:W6,json:{write:!0}})],Qc.prototype,"font",null),u([Ge("font")],Qc.prototype,"writeFont",null),u([d({type:PE,json:{write:!0}})],Qc.prototype,"halo",void 0),u([d({...kye,json:{default:"center",write:!0}})],Qc.prototype,"horizontalAlignment",void 0),u([d({...Nye,json:{default:1,write:!0}})],Qc.prototype,"lineHeight",void 0),u([d({type:Fh,json:{write:!0}})],Qc.prototype,"material",void 0),u([d({type:C3,json:{write:!0}})],Qc.prototype,"background",void 0),u([d(Ag)],Qc.prototype,"size",null),u([d({type:String,json:{write:!0}})],Qc.prototype,"text",void 0),u([bt({Text:"text"},{readOnly:!0})],Qc.prototype,"type",void 0),u([d({...Uye,json:{default:"baseline",write:!0}})],Qc.prototype,"verticalAlignment",void 0),Qc=EN=u([P("esri.symbols.TextSymbol3DLayer")],Qc);const tS=Qc;var Qj;let sv=Qj=class extends kg{constructor(e){super(e),this.color=eH.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new Qj({color:ne(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:De,nonNullable:!0,json:{type:[us],write:(e,t,i)=>t[i]=e.toArray(De.AlphaMode.UNLESS_OPAQUE),default:()=>eH.clone(),defaultEquals:e=>e.toCss(!0)===eH.toCss(!0)}})],sv.prototype,"color",void 0),u([bt({Water:"water"},{readOnly:!0})],sv.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],sv.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],sv.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],sv.prototype,"waveStrength",void 0),sv=Qj=u([P("esri.symbols.WaterSymbol3DLayer")],sv);const eH=new De([0,119,190]),h0e=sv;var tH;let Ew=tH=class extends Te{constructor(e){super(e),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new tH({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],Ew.prototype,"name",void 0),u([d({type:String})],Ew.prototype,"styleUrl",void 0),u([d({type:String})],Ew.prototype,"styleName",void 0),u([d({type:po})],Ew.prototype,"portal",void 0),Ew=tH=u([P("esri.symbols.support.StyleOrigin")],Ew);const NI=Ew;var iH;let qx=iH=class extends Te{constructor(){super(...arguments),this.url=""}clone(){return new iH({url:this.url})}};u([d({type:String})],qx.prototype,"url",void 0),qx=iH=u([P("esri.symbols.support.Thumbnail")],qx);const d0e={icon:a1,object:mJ,line:f$,path:gJ,fill:eM,extrude:wye,text:tS,water:h0e},pNe=Qe.ofType({base:kg,key:"type",typeMap:d0e,errorContext:"symbol-layer"});let xm=class extends Fu{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||Qe;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&se.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){mT(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const r=z1(e.styleUrl,i);return new NI({styleUrl:r,name:e.name})}if(e.styleName&&e.name)return new NI({portal:i&&i.portal||po.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Bh("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let s=fT(e.styleUrl,r);Nh(s)&&(s=Yd(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!jye(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new Bh("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof kg||e&&d0e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],xm.prototype,"color",null),u([d({type:pNe,nonNullable:!0,json:{write:!0}}),Zt(i0e)],xm.prototype,"symbolLayers",null),u([d({type:NI})],xm.prototype,"styleOrigin",void 0),u([Fe("styleOrigin")],xm.prototype,"readStyleOrigin",null),u([Ge("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],xm.prototype,"writeStyleOrigin",null),u([d({type:qx,json:{read:!1}})],xm.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],xm.prototype,"type",void 0),xm=u([P("esri.symbols.Symbol3D")],xm);const iM=xm;let lO=class extends ge{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],lO.prototype,"type",void 0),u([d({readOnly:!0})],lO.prototype,"visible",void 0),lO=u([P("esri.symbols.callouts.Callout3D")],lO);const p0e=lO;var rH;let CN=rH=class extends ge{constructor(){super(...arguments),this.color=new De("white")}clone(){return new rH({color:ne(this.color)})}};u([d(j0)],CN.prototype,"color",void 0),CN=rH=u([P("esri.symbols.callouts.LineCallout3DBorder")],CN);const f0e=CN;Object.freeze(Object.defineProperty({__proto__:null,default:f0e},Symbol.toStringTag,{value:"Module"}));var sH;let nv=sH=class extends p0e{constructor(e){super(e),this.type="line",this.color=new De([0,0,0,1]),this.size=Gh(1),this.border=null}get visible(){return this.size>0&&v(this.color)&&this.color.a>0}clone(){return new sH({color:ne(this.color),size:this.size,border:ne(this.border)})}};u([bt({line:"line"},{readOnly:!0})],nv.prototype,"type",void 0),u([d(j0)],nv.prototype,"color",void 0),u([d(Ag)],nv.prototype,"size",void 0),u([d({type:f0e,json:{write:!0}})],nv.prototype,"border",void 0),u([d({readOnly:!0})],nv.prototype,"visible",null),nv=sH=u([P("esri.symbols.callouts.LineCallout3D")],nv);const fNe=nv;function yJ(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||v(t.maxWorldLength)&&t.maxWorldLength<=0)}function m0e(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!yJ(e)}function _J(e){return e.type==="point-3d"||e.type==="label-3d"}function g0e(e){return e.horizontalAlignment==="center"}const y0e={types:{key:"type",base:p0e,typeMap:{line:fNe}},json:{write:!0}};var nH;let L2=nH=class extends ge{constructor(e){super(e),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new nH({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Ag)],L2.prototype,"screenLength",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0,default:0}})],L2.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],L2.prototype,"maxWorldLength",void 0),L2=nH=u([P("esri.symbols.support.Symbol3DVerticalOffset")],L2);const _0e=L2;var AN;const v0e=Qe.ofType({base:null,key:"type",typeMap:{text:tS}});let ov=AN=class extends iM{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new v0e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return m0e(this)}hasVisibleVerticalOffset(){return yJ(this)}clone(){return new AN({styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail),callout:ne(this.callout),verticalOffset:ne(this.verticalOffset)})}static fromTextSymbol(e){return new AN({symbolLayers:[tS.fromTextSymbol(e)]})}};u([d({type:_0e,json:{write:!0}})],ov.prototype,"verticalOffset",void 0),u([d(y0e)],ov.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],ov.prototype,"styleOrigin",void 0),u([d({type:v0e})],ov.prototype,"symbolLayers",void 0),u([bt({LabelSymbol3D:"label-3d"},{readOnly:!0})],ov.prototype,"type",void 0),ov=AN=u([P("esri.symbols.LabelSymbol3D")],ov);const Y6=ov;var MN;const b0e=Qe.ofType({base:null,key:"type",typeMap:{line:f$,path:gJ}}),mNe=Qe.ofType({base:null,key:"type",typeMap:{line:f$,path:gJ}});let cO=MN=class extends iM{constructor(e){super(e),this.symbolLayers=new b0e,this.type="line-3d"}clone(){return new MN({styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail)})}static fromSimpleLineSymbol(e){return new MN({symbolLayers:[f$.fromSimpleLineSymbol(e)]})}};u([d({type:b0e,json:{type:mNe}})],cO.prototype,"symbolLayers",void 0),u([bt({LineSymbol3D:"line-3d"},{readOnly:!0})],cO.prototype,"type",void 0),cO=MN=u([P("esri.symbols.LineSymbol3D")],cO);const Z6=cO;let av=class extends Fu{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],av.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],av.prototype,"type",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],av.prototype,"xoffset",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],av.prototype,"yoffset",void 0),u([d({type:Number,cast:e=>e==="auto"?e:Cr(e),json:{write:!0}})],av.prototype,"size",void 0),av=u([P("esri.symbols.MarkerSymbol")],av);const w0e=av;var RN;const x0e=Qe.ofType({base:null,key:"type",typeMap:{fill:eM}});let uO=RN=class extends iM{constructor(e){super(e),this.symbolLayers=new x0e,this.type="mesh-3d"}clone(){return new RN({styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail)})}static fromSimpleFillSymbol(e){return new RN({symbolLayers:[eM.fromSimpleFillSymbol(e)]})}};u([d({type:x0e})],uO.prototype,"symbolLayers",void 0),u([bt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],uO.prototype,"type",void 0),uO=RN=u([P("esri.symbols.MeshSymbol3D")],uO);const J6=uO;function gNe(e,t,i){return t.imageData?qye({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):T0e(t.url,i)}function T0e(e,t){var i;return _Ne(t)&&!Nh(e)&&((i=t==null?void 0:t.layer)==null?void 0:i.parsedUrl)?pT(t.layer.parsedUrl.path,"images",e):z1(e,t)}function yNe(e,t,i,r){if(Ug(e)){const s=d$(e);if(!s)return;t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&G1(i.url,t,"url",r)}else G1(e,t,"url",r)}const S0e={json:{read:{source:["imageData","url"],reader:gNe},write:{writer(e,t,i,r){yNe(e,t,this.source,r)}}}},E0e={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=T0e(t.url,i)),r}}}};function _Ne(e){var t,i;return!(e==null||e.origin!=="service"&&e.origin!=="portal-item"||((t=e.layer)==null?void 0:t.type)!=="feature"&&((i=e.layer)==null?void 0:i.type)!=="stream")}var oH;let md=oH=class extends Tye{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=Cr(i)),r!=null&&(s.height=Cr(r)),s}clone(){const e=new oH({color:ne(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",ne(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([bt({esriPFS:"picture-fill"},{readOnly:!0})],md.prototype,"type",void 0),u([d(S0e)],md.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],md.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],md.prototype,"yscale",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],md.prototype,"width",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],md.prototype,"height",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],md.prototype,"xoffset",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],md.prototype,"yoffset",void 0),u([d(E0e)],md.prototype,"source",void 0),md=oH=u([P("esri.symbols.PictureFillSymbol")],md);const C0e=md;var aH;let Fp=aH=class extends w0e{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=Cr(t)),i!=null&&(r.height=Cr(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new aH({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",ne(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],Fp.prototype,"color",void 0),u([bt({esriPMS:"picture-marker"},{readOnly:!0})],Fp.prototype,"type",void 0),u([d(S0e)],Fp.prototype,"url",void 0),u([d(E0e)],Fp.prototype,"source",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],Fp.prototype,"height",void 0),u([Fe("height",["height","size"])],Fp.prototype,"readHeight",null),u([d({type:Number,cast:Cr,json:{write:!0}})],Fp.prototype,"width",void 0),u([d({json:{write:!1}})],Fp.prototype,"size",void 0),Fp=aH=u([P("esri.symbols.PictureMarkerSymbol")],Fp);const m$=Fp;var Cw;const A0e=Qe.ofType({base:null,key:"type",typeMap:{icon:a1,object:mJ,text:tS}});let Aw=Cw=class extends iM{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new A0e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return m0e(this)}hasVisibleVerticalOffset(){return yJ(this)}clone(){return new Cw({verticalOffset:ne(this.verticalOffset),callout:ne(this.callout),styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new Cw({symbolLayers:[a1.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new Cw({symbolLayers:[a1.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var r,s;if(((s=(r=e.data)==null?void 0:r.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const i=e.data.symbol;return new Cw(i!=null&&i.callout?{symbolLayers:[a1.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[a1.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new Cw({symbolLayers:[tS.fromTextSymbol(e)]})}};u([d({type:_0e,json:{write:!0}})],Aw.prototype,"verticalOffset",void 0),u([d(y0e)],Aw.prototype,"callout",void 0),u([d({type:A0e,json:{origins:{"web-scene":{write:!0}}}})],Aw.prototype,"symbolLayers",void 0),u([bt({PointSymbol3D:"point-3d"},{readOnly:!0})],Aw.prototype,"type",void 0),Aw=Cw=u([P("esri.symbols.PointSymbol3D")],Aw);const l1=Aw;var hO;const M0e=Qe.ofType({base:null,key:"type",typeMap:{extrude:wye,fill:eM,icon:a1,line:f$,object:mJ,text:tS,water:h0e}});let dO=hO=class extends iM{constructor(e){super(e),this.symbolLayers=new M0e,this.type="polygon-3d"}clone(){return new hO({styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail)})}static fromJSON(e){const t=new hO;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:v(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new hO({symbolLayers:[eM.fromSimpleFillSymbol(e)]})}};u([d({type:M0e,json:{write:!0}})],dO.prototype,"symbolLayers",void 0),u([bt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],dO.prototype,"type",void 0),dO=hO=u([P("esri.symbols.PolygonSymbol3D")],dO);const M1=dO;var lH;const f9=new _i({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Mw=lH=class extends Tye{constructor(...e){super(...e),this.color=new De([0,0,0,.25]),this.outline=new Nu,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new lH({color:ne(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],Mw.prototype,"color",void 0),u([d()],Mw.prototype,"outline",void 0),u([bt({esriSFS:"simple-fill"},{readOnly:!0})],Mw.prototype,"type",void 0),u([d({type:f9.apiValues,json:{read:f9.read,write:f9.write}})],Mw.prototype,"style",void 0),Mw=lH=u([P("esri.symbols.SimpleFillSymbol")],Mw);const H0=Mw;var cH;const m9=new _i({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Tm=cH=class extends w0e{constructor(...e){super(...e),this.color=new De([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Nu}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=Cr(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new cH({angle:this.angle,color:ne(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([d()],Tm.prototype,"color",void 0),u([Ge("color")],Tm.prototype,"writeColor",null),u([bt({esriSMS:"simple-marker"},{readOnly:!0})],Tm.prototype,"type",void 0),u([d()],Tm.prototype,"size",void 0),u([d({type:m9.apiValues,json:{read:m9.read,write:m9.write}})],Tm.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],Tm.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Nu}},json:{default:null,write:!0}})],Tm.prototype,"outline",void 0),Tm=cH=u([P("esri.symbols.SimpleMarkerSymbol")],Tm);const fb=Tm;var uH;let gn=uH=class extends Fu{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new W6,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return Cr(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new uH({angle:this.angle,backgroundColor:ne(this.backgroundColor),borderLineColor:ne(this.borderLineColor),borderLineSize:this.borderLineSize,color:ne(this.color),font:this.font&&this.font.clone(),haloColor:ne(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:De,json:{write:!0}})],gn.prototype,"backgroundColor",void 0),u([d({type:De,json:{write:!0}})],gn.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0},cast:Cr})],gn.prototype,"borderLineSize",void 0),u([d({type:W6,json:{write:!0}})],gn.prototype,"font",void 0),u([d({...kye,json:{write:!0}})],gn.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],gn.prototype,"kerning",void 0),u([d({type:De,json:{write:!0}})],gn.prototype,"haloColor",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],gn.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],gn.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],gn.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],gn.prototype,"text",void 0),u([bt({esriTS:"text"},{readOnly:!0})],gn.prototype,"type",void 0),u([d({...Uye,json:{write:!0}})],gn.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],gn.prototype,"xoffset",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],gn.prototype,"yoffset",void 0),u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],gn.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],gn.prototype,"width",void 0),u([d({type:Number})],gn.prototype,"lineWidth",void 0),u([Ge("lineWidth")],gn.prototype,"writeLineWidth",null),u([Zt("lineWidth")],gn.prototype,"castLineWidth",null),u([d(Nye)],gn.prototype,"lineHeight",void 0),u([Ge("lineHeight")],gn.prototype,"writeLineHeight",null),gn=uH=u([P("esri.symbols.TextSymbol")],gn);const iS=gn;var hH;let Np=hH=class extends Fu{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=v(this.portal)?this.portal:po.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t==null?void 0:t.portal,super.read(e,t)}clone(){return new hH({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=v(t)?t.cache:null,r=i?this._fetchCacheKey:null;if(v(i)){const a=r&&i.get(r);if(a)return a.clone()}const s=await vNe();ii(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{se.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(v(i)&&i.set(r,o.clone()),o):null}};function vNe(){return Q(()=>Promise.resolve().then(function(){return eZe}),void 0)}u([d({json:{write:!1}})],Np.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Np.prototype,"styleName",void 0),u([d({type:po,json:{write:!1}})],Np.prototype,"portal",void 0),u([d({type:String,json:{read:hJ,write:G1}})],Np.prototype,"styleUrl",void 0),u([d({type:qx,json:{read:!1}})],Np.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],Np.prototype,"name",void 0),u([bt({styleSymbolReference:"web-style"},{readOnly:!0})],Np.prototype,"type",void 0),u([d()],Np.prototype,"_fetchCacheKey",null),Np=hH=u([P("esri.symbols.WebStyleSymbol")],Np);const rS=Np;function K6(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function j1(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const Wx={base:Fu,key:"type",typeMap:{"simple-fill":H0,"picture-fill":C0e,"picture-marker":m$,"simple-line":Nu,"simple-marker":fb,text:iS,"label-3d":Y6,"line-3d":Z6,"mesh-3d":J6,"point-3d":l1,"polygon-3d":M1,"web-style":rS,cim:QA},errorContext:"symbol"},bNe={base:Fu,key:"type",typeMap:{"picture-marker":m$,"simple-marker":fb,text:iS,"web-style":rS,cim:QA},errorContext:"symbol"},wNe=ub({types:Wx}),Q6={base:Fu,key:"type",typeMap:{"simple-fill":H0,"picture-fill":C0e,"picture-marker":m$,"simple-line":Nu,"simple-marker":fb,text:iS,"line-3d":Z6,"mesh-3d":J6,"point-3d":l1,"polygon-3d":M1,"web-style":rS,cim:QA},errorContext:"symbol"},xNe={base:Fu,key:"type",typeMap:{text:iS,"label-3d":Y6},errorContext:"symbol"},Qie={base:Fu,key:"type",typeMap:{"line-3d":Z6,"mesh-3d":J6,"point-3d":l1,"polygon-3d":M1,"web-style":rS,cim:QA},errorContext:"symbol"},TNe={base:Fu,key:"type",typeMap:{"label-3d":Y6},errorContext:"symbol"},R0e=Lf(Wx);var dH;let pO=dH=class extends ge{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new dH({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],pO.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],pO.prototype,"maxValue",void 0),pO=dH=u([P("esri.renderer.support.AuthoringInfoClassBreakInfo")],pO);var pH;let Nv=pH=class extends ge{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new pH({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ne(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],Nv.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],Nv.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],Nv.prototype,"label",void 0),u([d({type:[pO],json:{write:!0}})],Nv.prototype,"classBreakInfos",void 0),Nv=pH=u([P("esri.renderers.support.AuthoringInfoFieldInfo")],Nv);var fH;const _L=new _i({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),vL=new _i({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),ere={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},tre=["high-to-low","above-and-below","centered-on","extremes"],ire=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],rre=["seconds","minutes","hours","days","months","years"];let eu=fH=class extends ge{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new fH({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:ere,json:{write:!0}})],eu.prototype,"endTime",void 0),u([Zt("endTime")],eu.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],eu.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],eu.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],eu.prototype,"minSliderValue",void 0),u([d({types:ere,json:{write:!0}})],eu.prototype,"startTime",void 0),u([Zt("startTime")],eu.prototype,"castStartTime",null),u([d({type:_L.apiValues,value:null,json:{type:_L.jsonValues,read:_L.read,write:_L.write}})],eu.prototype,"style",null),u([d({type:ire,value:null,json:{type:ire,origins:{"web-scene":{type:tre,write:{writer:(e,t)=>{tre.includes(e)&&(t.theme=e)}}}},write:!0}})],eu.prototype,"theme",null),u([d({type:vL.apiValues,json:{type:vL.jsonValues,read:vL.read,write:vL.write}})],eu.prototype,"type",void 0),u([d({type:rre,json:{type:rre,write:!0}})],eu.prototype,"units",void 0),eu=fH=u([P("esri.renderers.support.AuthoringInfoVisualVariable")],eu);const SNe=eu;let ON=class extends ge{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],ON.prototype,"type",void 0),ON=u([P("esri.rest.support.ColorRamp")],ON);const vJ=ON;var mH;let Rw=mH=class extends vJ{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new mH({fromColor:ne(this.fromColor),toColor:ne(this.toColor),algorithm:this.algorithm})}};u([bt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Rw.prototype,"algorithm",void 0),u([d({type:De,json:{type:[us],write:!0}})],Rw.prototype,"fromColor",void 0),u([d({type:De,json:{type:[us],write:!0}})],Rw.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],Rw.prototype,"type",void 0),Rw=mH=u([P("esri.rest.support.AlgorithmicColorRamp")],Rw);const bJ=Rw;var gH;let fO=gH=class extends vJ{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new gH({colorRamps:ne(this.colorRamps)})}};u([d({type:[bJ],json:{write:!0}})],fO.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],fO.prototype,"type",void 0),fO=gH=u([P("esri.rest.support.MultipartColorRamp")],fO);const O0e=fO,ENe={key:"type",base:vJ,typeMap:{algorithmic:bJ,multipart:O0e}};function CNe(e){return e&&e.type?e.type==="algorithmic"?bJ.fromJSON(e):e.type==="multipart"?O0e.fromJSON(e):null:null}var yH;const Sb=new _i({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),bL=new _i({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),sre=new _i({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),nre=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],ANe=["high-to-low","above-and-below","above","below","90-10"],MNe=["flow-line","wave-front"],RNe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Vn=yH=class extends ge{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?CNe(e):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new yH({classificationMethod:this.classificationMethod,colorRamp:ne(this.colorRamp),fadeRatio:ne(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:ne(this.field1),field2:ne(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:Sb.apiValues,value:null,json:{type:Sb.jsonValues,read:Sb.read,write:Sb.write,origins:{"web-document":{default:"manual",type:Sb.jsonValues,read:Sb.read,write:Sb.write}}}})],Vn.prototype,"classificationMethod",null),u([d({types:ENe,json:{write:!0}})],Vn.prototype,"colorRamp",void 0),u([Fe("colorRamp")],Vn.prototype,"readColorRamp",null),u([d({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Vn.prototype,"fadeRatio",void 0),u([d({type:[String],value:null,json:{write:!0}})],Vn.prototype,"fields",null),u([d({type:Nv,value:null,json:{write:!0}})],Vn.prototype,"field1",null),u([d({type:Nv,value:null,json:{write:!0}})],Vn.prototype,"field2",null),u([d({type:MNe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Vn.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Vn.prototype,"focus",null),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Vn.prototype,"isAutoGenerated",void 0),u([d({type:Number,value:null,json:{type:us,write:!0}})],Vn.prototype,"numClasses",null),u([d({type:nre,json:{type:nre,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Vn.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Vn.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Vn.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Vn.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Vn.prototype,"standardDeviationInterval",null),u([d({type:bL.apiValues,value:null,json:{type:bL.jsonValues,read:bL.read,write:bL.write,origins:{"web-scene":{type:sre.jsonValues,write:{writer:sre.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],Vn.prototype,"type",null),u([d({type:[SNe],json:{write:!0}})],Vn.prototype,"visualVariables",void 0),u([d({type:RNe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Vn.prototype,"univariateSymbolStyle",null),u([d({type:ANe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Vn.prototype,"univariateTheme",null),Vn=yH=u([P("esri.renderers.support.AuthoringInfo")],Vn);const wJ=Vn,g9=new _i({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let mO=class extends ge{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:wJ,json:{write:!0}})],mO.prototype,"authoringInfo",void 0),u([d({type:g9.apiValues,readOnly:!0,json:{type:g9.jsonValues,read:!1,write:{writer:g9.write,ignoreOrigin:!0}}})],mO.prototype,"type",void 0),mO=u([P("esri.renderers.Renderer")],mO);const q0=mO;function ONe(e){var t,i,r;return(r=(i=(t=e.match(INe))==null?void 0:t[1])==null?void 0:i.replace(/\\'/g,"'"))!=null?r:null}const INe=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var _H;let aC=_H=class extends ge{constructor(){super(...arguments),this.title=null}clone(){return new _H({title:this.title})}};u([d({type:String,json:{write:!0}})],aC.prototype,"title",void 0),aC=_H=u([P("esri.renderers.support.LegendOptions")],aC);var vH;let IN=vH=class extends aC{constructor(){super(...arguments),this.showLegend=null}clone(){return new vH({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],IN.prototype,"showLegend",void 0),IN=vH=u([P("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],IN);const I0e=IN,y9=new _i({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let kp=class extends ge{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(se.getLogger(this.declaredClass).error(".field: field must be a string value"),null):s$(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],kp.prototype,"index",void 0),u([d({type:y9.apiValues,readOnly:!0,json:{read:y9.read,write:y9.write}})],kp.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],kp.prototype,"field",void 0),u([Zt("field")],kp.prototype,"castField",null),u([d({type:String,json:{write:!0}})],kp.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],kp.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],kp.prototype,"arcadeRequired",null),u([d({type:I0e,json:{write:!0}})],kp.prototype,"legendOptions",void 0),kp=u([P("esri.renderers.visualVariables.VisualVariable")],kp);const g$=kp;var bH;let Ow=bH=class extends ge{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e!=null?e:0}clone(){return new bH({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:De,json:{type:[us],write:!0}})],Ow.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Ow.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Ow.prototype,"value",void 0),u([Ge("value")],Ow.prototype,"writeValue",null),Ow=bH=u([P("esri.renderers.visualVariables.support.ColorStop")],Ow);const PNe=Ow;var wH;let Iw=wH=class extends g${constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new wH({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],Iw.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],Iw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Iw.prototype,"normalizationField",void 0),u([d({type:[PNe],json:{write:!0}})],Iw.prototype,"stops",null),Iw=wH=u([P("esri.renderers.visualVariables.ColorVariable")],Iw);const P0e=Iw;var xH;let lv=xH=class extends ge{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return LI(t.transparency)}writeOpacity(e,t,i){t[i]=z6(e)}clone(){return new xH({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],lv.prototype,"label",void 0),u([d({type:Number,json:{type:us,write:{target:"transparency"}}})],lv.prototype,"opacity",void 0),u([Fe("opacity",["transparency"])],lv.prototype,"readOpacity",null),u([Ge("opacity")],lv.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],lv.prototype,"value",void 0),lv=xH=u([P("esri.renderers.visualVariables.support.OpacityStop")],lv);const $Ne=lv;var TH;let Pw=TH=class extends g${constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new TH({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],Pw.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],Pw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Pw.prototype,"normalizationField",void 0),u([d({type:[$Ne],json:{write:!0}})],Pw.prototype,"stops",null),Pw=TH=u([P("esri.renderers.visualVariables.OpacityVariable")],Pw);const $0e=Pw;var SH;let Ay=SH=class extends g${constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new SH({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],Ay.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Ay.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],Ay.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Ay.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],Ay.prototype,"valueExpressionTitle",void 0),u([Ge("web-scene","valueExpressionTitle")],Ay.prototype,"writeValueExpressionTitleWebScene",null),Ay=SH=u([P("esri.renderers.visualVariables.RotationVariable")],Ay);const L0e=Ay;var EH;let D2=EH=class extends ge{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new EH({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],D2.prototype,"label",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],D2.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],D2.prototype,"value",void 0),D2=EH=u([P("esri.renderers.visualVariables.support.SizeStop")],D2);const F2=D2;var CH;let PN=CH=class extends I0e{constructor(){super(...arguments),this.customValues=null}clone(){return new CH({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],PN.prototype,"customValues",void 0),PN=CH=u([P("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],PN);const LNe=PN;var p0,_a;function c1(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function kI(e){return e!=null&&!isNaN(e)&&isFinite(e)}function D0e(e){return e.valueExpression?p0.Expression:e.field&&typeof e.field=="string"?p0.Field:p0.Unknown}function DNe(e,t){const i=t||D0e(e),r=e.valueUnit||"unknown";return i===p0.Unknown?_a.Constant:e.stops?_a.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?_a.ClampedLinear:r==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?_a.Proportional:_a.Additive:_a.Identity:_a.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(p0||(p0={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(_a||(_a={}));function FNe(e){if(!e)return null;const t={};for(const i in e){const r=Jl(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function NNe(e){if(!v(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let tu=class extends Ys(ge){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Ru(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&v(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){var t;return(t=this.attributes)==null?void 0:t[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:NNe(this.aggregateGeometries),geometry:v(this.geometry)?this.geometry.toJSON():null,symbol:v(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){v(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:FNe}})],tu.prototype,"aggregateGeometries",null),u([d({value:null})],tu.prototype,"attributes",null),u([d({value:null,types:ZT,json:{read:Jl}})],tu.prototype,"geometry",null),u([d({type:Boolean})],tu.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],tu.prototype,"layer",void 0),u([d({type:KT})],tu.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],tu.prototype,"sourceLayer",void 0),u([d({value:null,types:Wx})],tu.prototype,"symbol",null),u([d({type:Boolean,value:!0})],tu.prototype,"visible",null),tu=u([P("esri.Graphic")],tu),function(e){e.generateUID=Ru}(tu||(tu={}));const Ko=tu;function dMt(e){}function kNe(e){return()=>e}const eA={inches:to(1,"meters","inches"),feet:to(1,"meters","feet"),"us-feet":to(1,"meters","us-feet"),yards:to(1,"meters","yards"),miles:to(1,"meters","miles"),"nautical-miles":to(1,"meters","nautical-miles"),millimeters:to(1,"meters","millimeters"),centimeters:to(1,"meters","centimeters"),decimeters:to(1,"meters","decimeters"),meters:to(1,"meters","meters"),kilometers:to(1,"meters","kilometers"),"decimal-degrees":1/w$e(1,"meters",Mi.radius)},H1=se.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),ore=new Ko,$N=Math.PI,F0e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function N0e(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="color"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void H1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(C(i)||C(i.arcade))return void H1.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,b=_.getViewInfo(y),w=_.createExecContext(n,b);if(!p){const T=_.createSyntaxTree(r.valueExpression);p=_.createFunction(T),r.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=TJ(a,c);if(y){const _=y[0],b=y[1],w=_===b?r.stops[_].color:De.blendColors(r.stops[_].color,r.stops[b].color,y[2],v(i)?i.color:void 0);return new De(w)}}}function k0e(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="opacity"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void H1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(C(i)||C(i.arcade))return void H1.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},_=i.arcade.arcadeUtils,b=_.getViewInfo(y),w=_.createExecContext(n,b);if(!p){const T=_.createSyntaxTree(r.valueExpression);p=_.createFunction(T),r.cache.compiledFunc=p}a=_.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=TJ(a,c);if(y){const _=y[0],b=y[1];if(_===b)return r.stops[_].opacity;{const w=r.stops[_].opacity;return w+(r.stops[b].opacity-w)*y[2]}}}}function U0e(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void H1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(C(i)||C(i.arcade))return void H1.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,_=y.getViewInfo(m),b=y.createExecContext(a,_);if(!p){const w=y.createSyntaxTree(r.valueExpression);p=y.createFunction(w),r.cache.compiledFunc=p}f=y.executeFunction(p,b)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function UNe(e,t,i){const r=typeof t=="number",s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=v(i)?i.scale:void 0,p=v(i)?i.view:void 0;o=h==null||p==="3d"?VNe(e):h}else if(!r)switch(e.inputValueType){case p0.Expression:{if(C(i)||C(i.arcade))return void H1.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(e.valueExpression);l=p.createFunction(y),e.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case p0.Field:n&&(o=n[e.field]);break;case p0.Unknown:o=null}if(!kI(o))return null;if(r||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return kI(c)&&c!==0?o/c:null}function VNe(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function eU(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void H1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=B0e(UNe(r,t,i),r,t,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Iu(e,t,i){return e==null?null:c1(e)?eU(e,t,i):kI(e)?e:null}function V0e(e,t,i){return kI(i)&&e>i?i:kI(t)&&e<t?t:e}function BNe(e,t,i,r){var s;return e+((s=Iu(t.minSize,i,r)||t.minDataValue)!=null?s:0)}function zNe(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=e.minSize),Iu(s,t,i)}function GNe(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Iu(t.minSize,i,r),o=Iu(t.maxSize,i,r),a=v(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(n==null||o==null)return null;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?$N*(n/2)**2:n*n,h=c+s*((l?$N*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/$N):Math.sqrt(h)}return n+s*(o-n)}function jNe(e,t,i,r){const s=v(r)?r.shape:void 0,n=e/t.minDataValue,o=Iu(t.minSize,i,r),a=Iu(t.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,V0e(l,o,a)}function HNe(e,t,i,r,s){var l,c,h;const[n,o,a]=TJ(e,s);if(n===o)return Iu((l=t.stops)==null?void 0:l[n].size,i,r);{const p=Iu((c=t.stops)==null?void 0:c[n].size,i,r);return p+(Iu((h=t.stops)==null?void 0:h[o].size,i,r)-p)*a}}function qNe(e,t,i,r){const s=(v(r)&&r.resolution?r.resolution:1)*eA[t.valueUnit],n=Iu(t.minSize,i,r),o=Iu(t.maxSize,i,r),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/$N)/s:a==="radius"||a==="distance"?2*e/s:e/s,V0e(l,n,o)}function B0e(e,t,i,r,s){switch(t.transformationType){case _a.Additive:return BNe(e,t,i,r);case _a.Constant:return zNe(t,i,r);case _a.ClampedLinear:return GNe(e,t,i,r);case _a.Proportional:return jNe(e,t,i,r);case _a.Stops:return HNe(e,t,i,r,s);case _a.RealWorldSize:return qNe(e,t,i,r);case _a.Identity:return e;case _a.Unknown:return null}}function WNe(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&i==="3d"||t))return null;const s={scale:t,view:i};let n=Iu(e.minSize,ore,s),o=Iu(e.maxSize,ore,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function xJ(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=N0e(l,t,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=k0e(l,t,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=U0e(l,t,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=eU(l,t,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function TJ(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((s,n)=>e<s?(r=n,!0):(i=n,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function XNe(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":eU(s,t,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}var tU=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getAllSizes:XNe,getColor:N0e,getOpacity:k0e,getRotationAngle:U0e,getSize:eU,getSizeForValue:B0e,getSizeFromNumberOrVariable:Iu,getSizeRangeAtScale:WNe,getVisualVariableValues:xJ,viewScaleRE:F0e}),AH;const wL=new _i({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),MH=new _i({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function are(e){if(e!=null)return typeof e=="string"||typeof e=="number"?Cr(e):e.type==="size"?c1(e)?e:(delete(e={...e}).type,new Dr(e)):void 0}function lre(e,t,i){if(typeof e!="object")return e;const r=new Dr;return r.read(e,i),r}let Dr=AH=class extends g${constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&F0e.test(this.valueExpression)}}set expression(e){se.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){c1(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),c1(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return D0e(this)}set maxDataValue(e){e&&this.stops&&(se.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(se.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return are(e)}readMaxSize(e,t,i){return lre(e,t,i)}set minDataValue(e){e&&this.stops&&(se.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(se.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return are(e)}readMinSize(e,t,i){return lre(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(se.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return DNe(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if(e==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?MH.read(e):null}clone(){return new AH({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:c1(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:c1(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===_a.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===_a.Stops){const e=this.stops;if(!e)return this;const t=e.map(r=>r.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],Dr.prototype,"cache",null),u([d({type:wL.apiValues,json:{type:wL.jsonValues,origins:{"web-map":{read:!1}},read:wL.read,write:wL.write}})],Dr.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],Dr.prototype,"expression",null),u([d()],Dr.prototype,"index",null),u([d({type:String,readOnly:!0})],Dr.prototype,"inputValueType",null),u([d({type:LNe,json:{write:!0}})],Dr.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],Dr.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Dr.prototype,"maxSize",null),u([Zt("maxSize")],Dr.prototype,"castMaxSize",null),u([Fe("maxSize")],Dr.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],Dr.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Dr.prototype,"minSize",null),u([Zt("minSize")],Dr.prototype,"castMinSize",null),u([Fe("minSize")],Dr.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],Dr.prototype,"normalizationField",void 0),u([d({readOnly:!0})],Dr.prototype,"arcadeRequired",null),u([d({type:String})],Dr.prototype,"scaleBy",void 0),u([d({type:[F2],value:null,json:{write:!0}})],Dr.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],Dr.prototype,"target",void 0),u([d({type:String,readOnly:!0})],Dr.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],Dr.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Dr.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],Dr.prototype,"valueExpression",void 0),u([Fe("valueExpression",["valueExpression","expression"])],Dr.prototype,"readValueExpression",null),u([Ge("web-scene","valueExpression")],Dr.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Dr.prototype,"valueRepresentation",void 0),u([d({type:MH.apiValues,json:{write:MH.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Dr.prototype,"valueUnit",void 0),u([Fe("valueUnit")],Dr.prototype,"readValueUnit",null),Dr=AH=u([P("esri.renderers.visualVariables.SizeVariable")],Dr);const iU=Dr,YNe={color:P0e,size:iU,opacity:$0e,rotation:L0e},ZNe=new _i({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),JNe=/^\[([^\]]+)\]$/i;let LN=class extends Te{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,i)=>{let r=null;return r=t.target===i.target?0:t.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(JNe),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=ZNe.read(a.type),c=YNe[l];c||(se.getLogger(this.declaredClass).warn(`Unknown variable type: ${l}`),i&&i.messages&&i.messages.push(new Bh("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:i})));const h=new c;return h.read(a,i),h})}writeVariables(e,t){const i=[];for(const r of e){const s=r.toJSON(t);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],LN.prototype,"visualVariables",null),LN=u([P("esri.renderers.visualVariables.VisualVariableFactory")],LN);const KNe=LN,QNe={base:g$,key:"type",typeMap:{opacity:$0e,color:P0e,rotation:L0e,size:iU}},rM=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new KNe}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Dh(i,r,n.field),n.normalizationField&&Dh(i,r,n.normalizationField),n.valueExpression&&(e4e(n.valueExpression,i,r)||await Uc(i,r,n.valueExpression)))}};return u([d({types:[QNe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([Fe("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([Ge("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([P("esri.renderers.mixins.VisualVariablesMixin")],t),t};function e4e(e,t,i){const r=ONe(e);return!!v(r)&&(Dh(t,i,r),!0)}function cre(e){const t=e==null?void 0:e.type;return t==="imagery-tile"||t==="tile"||t==="open-street-map"||t==="vector-tile"||t==="web-tile"||t==="wmts"}function lC(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function tA(e){return e!=null&&"type"in e&&e.type==="group"}const pMt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function z0e(e){const t=e==null?void 0:e.type;return t==="building-scene"||t==="integrated-mesh"||t==="point-cloud"||t==="scene"}function ure(e){return(e==null?void 0:e.type)==="voxel"}function hre(e){return(e==null?void 0:e.type)==="imagery-tile"}function G0e(e){return e!=null&&e.parent!=null&&"declaredClass"in e.parent&&e.parent.declaredClass==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function SJ(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function fMt(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function t4e(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}async function j0e(e,t){const i=Sr==null?void 0:Sr.findServerInfo(e);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=e.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${e.substring(0,r)}/rest/info`,n=v(t)?t.signal:null,{data:o}=await _r(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function i4e(e){if(!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function H0e(e){return i4e(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null}function r4e(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function s4e(e){return!!r4e(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)}const UM={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function n4e(e,t=UM){var a,l;if(!e)return{symbol:null};const{retainId:i=UM.retainId,ignoreDrivers:r=UM.ignoreDrivers,hasLabelingContext:s=UM.hasLabelingContext,retainCIM:n=UM.retainCIM}=t;let o=null;if(j1(e)||e instanceof rS)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new H("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():l1.fromCIMSymbol(e)}else if(e instanceof Nu)o=Z6.fromSimpleLineSymbol(e);else if(e instanceof fb)o=l1.fromSimpleMarkerSymbol(e);else if(e instanceof m$)o=l1.fromPictureMarkerSymbol(e);else if(e instanceof H0)o=t.geometryType&&t.geometryType==="mesh"?J6.fromSimpleFillSymbol(e):M1.fromSimpleFillSymbol(e);else{if(!(e instanceof iS))return{error:new H("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?Y6.fromTextSymbol(e):l1.fromTextSymbol(e)}if(i&&o&&o.type!=="cim"&&(o.id=e.id),r&&j1(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}function I5(e,t,i,r){const s=q0e(e,{},{context:r,isLabelSymbol:!1});v(s)&&(t[i]=s)}function dre(e,t,i,r){const s=q0e(e,{},{context:r,isLabelSymbol:!0});v(s)&&(t[i]=s)}function pre(e){return e instanceof iM||e instanceof rS}function q0e(e,t,i){if(C(e))return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!pre(e)){const a=n4e(e,{retainCIM:!0,hasLabelingContext:s});return v(a.symbol)?a.symbol.write(t,r):(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!z0e(r==null?void 0:r.layer))&&pre(e)?(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:r})),null):e.write(t,r)}function W0e(e,t){return wNe(e,null,t)}const sM={types:Q6,json:{write:{writer:I5},origins:{"web-scene":{types:Qie,write:{writer:I5},read:{reader:ub({types:Qie})}}}}},X0e={types:{base:Fu,key:"type",typeMap:{"simple-fill":Wx.typeMap["simple-fill"],"picture-fill":Wx.typeMap["picture-fill"],"polygon-3d":Wx.typeMap["polygon-3d"]}},json:{write:{writer:I5},origins:{"web-scene":{type:M1,write:{writer:I5}}}}},DN={cast:e=>e==null||typeof e=="string"||typeof e=="number"?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}};var RH;let cv=RH=class extends ge{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new RH({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([d({type:String,json:{write:!0}})],cv.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],cv.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],cv.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],cv.prototype,"maxValue",void 0),u([d(sM)],cv.prototype,"symbol",void 0),cv=RH=u([P("esri.renderers.support.ClassBreakInfo")],cv);const P5=cv;var OH;const Y0e="log",FN="percent-of-total",NN="field",xL=new _i({esriNormalizeByLog:Y0e,esriNormalizeByPercentOfTotal:FN,esriNormalizeByField:NN}),o4e=zr(P5);let $o=OH=class extends rM(q0){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map(s=>{const n=new P5;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(e,t,i,r){const s=e.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[i]=s}castField(e){return e==null?e:typeof e=="function"?(se.getLogger(this.declaredClass).error(".field: field must be a string value"),null):s$(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&NN||i&&FN||null,t&&i&&se.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):e!==NN&&e!==FN||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r=typeof e=="number"?new P5({minValue:e,maxValue:t,symbol:R0e(i)}):o4e(ne(e)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(C(t)||C(t.arcade))&&se.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(C(t)||C(t.arcade))&&(i={...i,arcade:await Eg()});const r=this.getBreakIndex(e,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(C(t)||C(t.arcade)))return void se.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(C(t)||C(t.arcade))){const s=await Eg(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new OH({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ne(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ne(this.visualVariables),legendOptions:ne(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Uc(e,t,this.valueExpression)];Dh(e,t,this.field),Dh(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Ft(t,{}),{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===Y0e)s=Math.log(s)*Math.LOG10E;else if(r!==FN||n==null||isNaN(n)){if(r===NN&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};u([d(X0e)],$o.prototype,"backgroundFillSymbol",void 0),u([d({type:[P5]})],$o.prototype,"classBreakInfos",void 0),u([Fe("classBreakInfos")],$o.prototype,"readClassBreakInfos",null),u([Ge("classBreakInfos")],$o.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],$o.prototype,"defaultLabel",void 0),u([d(sM)],$o.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],$o.prototype,"field",void 0),u([Zt("field")],$o.prototype,"castField",null),u([d({type:Boolean})],$o.prototype,"isMaxInclusive",void 0),u([d({type:aC,json:{write:!0}})],$o.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],$o.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],$o.prototype,"normalizationField",void 0),u([d({type:Number,cast:e=>Fd(e),json:{write:!0}})],$o.prototype,"normalizationTotal",void 0),u([d({type:xL.apiValues,value:null,json:{type:xL.jsonValues,read:xL.read,write:xL.write}})],$o.prototype,"normalizationType",null),u([bt({classBreaks:"class-breaks"})],$o.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],$o.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],$o.prototype,"valueExpressionTitle",void 0),$o=OH=u([P("esri.renderers.ClassBreaksRenderer")],$o);const Z0e=$o,kN=-3;var t0;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(t0||(t0={}));class a4e{constructor(t,i,r){this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,i,r,s=0){this._storage.put(this._namespace+t,i,r,s)}get(t){const i=this._storage.get(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}pop(t){const i=this._storage.pop(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}updateSize(t,i,r){this._storage.updateSize(this._namespace+t,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class EJ{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new ri,this._users=new ri}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,i){this._removeFuncs.push([t,i])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(i=>i[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,i,r,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,t0.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,t0.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,kN)-kN;this._db.set(t,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(t,i,r){const s=this._db.get(t);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(t,i,t0.SOME);if(!(v(n)&&n>0))return void this._db.delete(t);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const i=this._db.get(t);if(i)return this._size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(t){const i=this._db.get(t);if(i!==void 0)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>t[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(t["Priority "+(o+kN-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((i,r)=>{r.startsWith(t)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,t0.ALL))})}clearAll(){this._db.forEach((t,i)=>this._notifyRemove(i,t.entry,t0.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,r){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,i]of this._db){if(this._db.delete(t),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(t,i.entry,t0.SOME);v(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(t,i))}else--i.lives,this._db.set(t,i);if(this._size<=.9*this.maxSize)return}}}class l4e{constructor(t,i){this._storage=new EJ,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i,r){this._storage.put(t,i,r,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const fre="esri.renderers.support.DictionaryLoader",c4e={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class CJ{constructor(t,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new l4e(100),this._dictionaryPromise=null,this.url=t,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(m){if(Ws(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m];if(y&&t.attributes[y]!=null){const _=""+t.attributes[y];s[m]=_}else s[m]=""}const n=r==null?void 0:r(s,i);if(!n||typeof n!="string")return null;const o=aZ(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const y=m.substr(3).split("|");if(y.length===3){const _=y[0],b=y[1];let w=y[2];if(b==="DashTemplate")w=w.split(" ").map(T=>Number(T));else if(b==="Color"){const T=new De(w).toRgba();w=[T[0],T[1],T[2],255*T[3]]}else w=Number(w);h.push({primitiveName:_,propertyName:b,value:w})}}else if(m.includes("|")){for(const y of m.split("|"))if(this._itemNames.has(y)){c.push(y);break}}else this._itemNames.has(m)&&c.push(m);const p=!v(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void se.getLogger(fre).error("no valid URL!");const i=_r(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:v(t)?t.signal:null}),[{data:r}]=await Promise.all([i,Eg()]);if(!r)throw this._dictionaryPromise=null,new H("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const c=this.config;for(const h in c)o[h]=c[h]}if(n.configuration)for(const c of n.configuration)o.hasOwnProperty(c.name)||(o[c.name]=c.value);const a=[];if(v(t)&&t.fields&&this.fieldMap)for(const c of this._symbolFields){const h=this.fieldMap[c],p=t.fields.filter(f=>f.name===h);p.length>0&&a.push({...p[0],name:c})}const l=RLe(s,v(t)?t.spatialReference:null,a,o).then(c=>{const h={scale:0};return(p,f)=>{var y;if(C(c))return null;const m=c.repurposeFeature({geometry:null,attributes:p});return h.scale=v(f)&&(y=f.scale)!=null?y:void 0,c.evaluate({$feature:m,$view:h})}}).catch(c=>(se.getLogger(fre).error("Creating dictinoary expression failed:",c),null));return this._dictionaryPromise=l,l}async _cimPartsToCIMSymbol(t,i,r,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)J0e(l,a);return new QA({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(t,i){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=_r(r,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,i,r){if(!t||t.length===0)return null;const s={...t[0]};if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=c4e),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}}function J0e(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&u4e(s,t)}}function u4e(e,t){const i=e.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":J0e(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}var mMt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DictionaryLoader:CJ}),IH;let Up=IH=class extends rM(q0){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new CJ(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){r!=null&&r.origin||super.writeVisualVariables(e,t,i,r)}clone(){return new IH({config:ne(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ne(this.fieldMap),url:ne(this.url),visualVariables:ne(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Uc(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:CJ})],Up.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Up.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],Up.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Up.prototype,"scaleExpression",void 0),u([Ge("scaleExpression")],Up.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],Up.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],Up.prototype,"url",void 0),u([Ge("visualVariables")],Up.prototype,"writeVisualVariables",null),Up=IH=u([P("esri.renderers.DictionaryRenderer")],Up);const h4e=Up;var PH;let My=PH=class extends ge{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(se.getLogger(this.declaredClass).error(".field: field must be a string value"),null):s$(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new PH({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:De,json:{type:[Number],write:!0}})],My.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],My.prototype,"field",void 0),u([Zt("field")],My.prototype,"castField",null),u([d({type:String,json:{write:!0}})],My.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],My.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],My.prototype,"valueExpressionTitle",void 0),My=PH=u([P("esri.renderers.support.AttributeColorInfo")],My);const K0e=My;var $H;let UN=$H=class extends ge{constructor(){super(...arguments),this.unit=null}clone(){return new $H({unit:this.unit})}};u([d({type:String,json:{write:!0}})],UN.prototype,"unit",void 0),UN=$H=u([P("esri.renderers.support.DotDensityLegendOptions")],UN);const d4e=UN;var LH;let iu=LH=class extends rM(q0){constructor(e){super(e),this.attributes=null,this.backgroundColor=new De([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Nu,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new H0({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var e,t;return(t=(e=this.attributes)==null?void 0:e.reduce((i,r)=>i+r.getAttributeHash(),""))!=null?t:""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new LH({attributes:ne(this.attributes),backgroundColor:ne(this.backgroundColor),dotBlendingEnabled:ne(this.dotBlendingEnabled),dotShape:ne(this.dotShape),dotSize:ne(this.dotSize),dotValue:ne(this.dotValue),legendOptions:ne(this.legendOptions),outline:ne(this.outline),referenceScale:ne(this.referenceScale),visualVariables:ne(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var t;return`${(t=this.attributes)==null?void 0:t.map(i=>i.field||i.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){var i;await this.collectVVRequiredFields(e,t);for(const r of(i=this.attributes)!=null?i:[])r.valueExpression&&await Uc(e,t,r.valueExpression),r.field&&e.add(r.field)}};u([d({type:[K0e],json:{write:!0}})],iu.prototype,"attributes",void 0),u([d({type:De,json:{write:!0}})],iu.prototype,"backgroundColor",void 0),u([d({type:Boolean,json:{write:!0}})],iu.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],iu.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0}})],iu.prototype,"dotSize",void 0),u([d({type:d4e,json:{write:!0}})],iu.prototype,"legendOptions",void 0),u([d({type:Nu,json:{default:null,write:!0}})],iu.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],iu.prototype,"dotValue",void 0),u([d({type:Number,json:{write:!0}})],iu.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],iu.prototype,"seed",void 0),u([bt({dotDensity:"dot-density"})],iu.prototype,"type",void 0),iu=LH=u([P("esri.renderers.DotDensityRenderer")],iu);const p4e=iu;var DH;let gO=DH=class extends ge{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new DH({color:this.color,ratio:this.ratio})}};u([d({type:De,json:{type:[us],default:null,write:!0}})],gO.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],gO.prototype,"ratio",void 0),gO=DH=u([P("esri.renderers.support.HeatmapColorStop")],gO);const A3=gO;let N2=class extends Ys(ge){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],N2.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],N2.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],N2.prototype,"title",void 0),N2=u([P("esri.renderers.support.HeatmapLegendOptions")],N2);function ui(){return[0,0,0,0]}function y$(e){return[e[0],e[1],e[2],e[3]]}function Yt(e,t,i,r){return[e,t,i,r]}function AJ(e){const t=ui(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function Q0e(e,t){return new Float64Array(e,t,4)}function e_e(){return ui()}function t_e(){return Yt(1,1,1,1)}function i_e(){return Yt(1,0,0,0)}function r_e(){return Yt(0,1,0,0)}function s_e(){return Yt(0,0,1,0)}function n_e(){return Yt(0,0,0,1)}const pg=e_e(),jd=t_e(),f4e=i_e(),m4e=r_e(),g4e=s_e(),y4e=n_e();Object.freeze(Object.defineProperty({__proto__:null,ONES:jd,UNIT_W:y4e,UNIT_X:f4e,UNIT_Y:m4e,UNIT_Z:g4e,ZEROS:pg,clone:y$,create:ui,createView:Q0e,fromArray:AJ,fromValues:Yt,ones:t_e,unitW:n_e,unitX:i_e,unitY:r_e,unitZ:s_e,zeros:e_e},Symbol.toStringTag,{value:"Module"}));const MJ=2.4;function _4e(e){return Gh(e*MJ)}function v4e(e){return $r(e)/MJ}function b4e(e,t,i,r){let{color:s,ratio:n}=t,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=ye((r-n)/(a-n),0,1);O6(e,s.toArray(),o.toArray(),l)}function gMt(e){const i=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return i;let r=e[0],s=e[0],n=1;const o=ui();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)r=s,s=e[n++];b4e(o,r,s,l),i.set(o,4*a)}return i}function yMt(e,t,i,r){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round($r(s)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const p=x4e(o,n),f=new Set;for(const m of e){const y=m.getCursor();for(;y.next();){const _=y.getObjectId();if(f.has(_))continue;f.add(_);const b=y.readLegacyPointGeometry(),w=128;if(b.x<-w||b.x>=i+w||b.y<-w||b.y>r+w)continue;const T=+p(y),S=Math.max(0,Math.round(b.x)-a),E=Math.max(0,Math.round(b.y)-a),M=Math.min(r,Math.round(b.y)+a),A=Math.min(i,Math.round(b.x)+a);for(let $=E;$<M;$++)for(let I=S;I<A;I++){const k=$*i+I,V=w4e(b.x-I,b.y-$,a);c=l[k]+=V*T,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function w4e(e,t,i){const r=Math.sqrt(e**2+t**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function _Mt(e,t){return typeof e=="function"?e:e?typeof t=="string"?i=>-1*+i[e]:i=>+i[e]+t:()=>1}function x4e(e,t){return e!=null?typeof t=="string"?i=>-1*+i.readAttribute(e):i=>+i.readAttribute(e)+t:i=>1}var FH;const o_e="esri.renderers.HeatmapRenderer",T4e=se.getLogger(o_e);function mre(e){if(e!=null){const{maxDensity:t,minDensity:i,radius:r}=e;if(t!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=e;return a}}return e}let la=FH=class extends q0{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new A3({ratio:0,color:new De("rgba(255, 140, 0, 0)")}),new A3({ratio:.75,color:new De("rgba(255, 140, 0, 1)")}),new A3({ratio:.9,color:new De("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return mre(e)}get blurRadius(){return v4e(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",_4e(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(MJ**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||ml(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,ZA(()=>{PG(T4e,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=mre(e),super.read(e,t)}getSymbol(){return new fb}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await Dh(e,t,i),r&&typeof r=="string"&&await Uc(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new FH({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:ne(this.colorStops),field:this.field,legendOptions:ne(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:wJ,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],la.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],la.prototype,"blurRadius",null),u([d({type:[A3],json:{write:!0}})],la.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],la.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],la.prototype,"fieldOffset",void 0),u([d({type:N2,json:{write:!0}})],la.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],la.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],la.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],la.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],la.prototype,"minPixelIntensity",null),u([d({type:Number,cast:Cr,json:{write:!0}})],la.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],la.prototype,"referenceScale",void 0),u([bt({heatmap:"heatmap"})],la.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],la.prototype,"valueExpression",void 0),u([d({type:String})],la.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],la.prototype,"_pixelIntensityToDensity",null),la=FH=u([P(o_e)],la);const a_e=la;let px=class extends Ys(ge){constructor(){super(...arguments),this.color=new De([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:De,json:{write:!0}})],px.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],px.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],px.prototype,"threshold",void 0),px=u([P("esri.renderers.support.OthersCategory")],px);let VN=class extends Ys(ge){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],VN.prototype,"title",void 0),VN=u([P("esri.renderers.support.PieChartLegendOptions")],VN);let Qu=class extends rM(Ys(q0)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new De([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new px,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new fb({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(v)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Uc(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[K0e],json:{write:!0}})],Qu.prototype,"attributes",void 0),u([d({type:H0,json:{default:null,write:!0}})],Qu.prototype,"backgroundFillSymbol",void 0),u([d({type:De,json:{write:!0}})],Qu.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],Qu.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Qu.prototype,"holePercentage",void 0),u([d({type:px,json:{write:!0}})],Qu.prototype,"othersCategory",void 0),u([d({type:VN,json:{write:!0}})],Qu.prototype,"legendOptions",void 0),u([d({type:Nu,json:{default:null,write:!0}})],Qu.prototype,"outline",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],Qu.prototype,"size",void 0),u([bt({pieChart:"pie-chart"})],Qu.prototype,"type",void 0),Qu=u([P("esri.renderers.PieChartRenderer")],Qu);const S4e=Qu;var NH;let $w=NH=class extends rM(q0){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new NH({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ne(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],$w.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],$w.prototype,"label",void 0),u([d(sM)],$w.prototype,"symbol",void 0),u([bt({simple:"simple"})],$w.prototype,"type",void 0),$w=NH=u([P("esri.renderers.SimpleRenderer")],$w);const f0=$w;function te(e,t,i={}){return RJ(e,t,i,l_e)}function Qo(e,t,i={}){return RJ(e,t,i,c_e)}function RJ(e,t,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(hs(s),t(o,a))}:(o,a)=>{r(o)&&t(o,a)};if(s=ZPe(e,n,i.sync,i.equals),i.initial){const o=e();n(o,o)}return s}function Fs(e,t,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&hs(o),i(h)}const c=te(e,(h,p)=>{var f;a(),D6(h)&&(s=h,n=a$(h,t,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=Df(()=>{c.remove(),a()}),o}function I0(e,t){return E4e(e,c_e,t)}function E4e(e,t,i){if(So(i))return Promise.reject(lr());const r=e();if(t!=null&&t(r))return Promise.resolve(r);let s=null;function n(){s=hs(s)}return new Promise((o,a)=>{s=BC([fl(i,()=>{n(),a(lr())}),RJ(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:l_e)])})}function l_e(e){return!0}function c_e(e){return!!e}function C4e(e,t,i={}){let r=!1;const s=te(e,(n,o)=>{r||t(n,o)},i);return{remove(){s.remove()},pause(){r=!0},resume(){r=!1}}}const hr={sync:!0},st={initial:!0},Gs={sync:!0,initial:!0},A4e=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function kH(e){return e instanceof Te}function gre(e){return e instanceof Qe?Object.keys(e.items):kH(e)?ml(e).keys():e?Object.keys(e):[]}function TL(e,t){return e instanceof Qe?e.items[t]:e[t]}function M4e(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function M3(e){return e?e.declaredClass:null}function u_e(e,t){const i=e.diff;if(i&&typeof i=="function")return i(e,t);const r=gre(e),s=gre(t);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||M4e(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&TL(e,p)!==TL(t,p)).concat(n,o).sort(),l=M3(e);if(l&&A4e.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=kH(e)&&kH(t);for(const p of a){const f=TL(e,p),m=TL(t,p);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[p]&&typeof i[p]=="function")y=i[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&M3(f)===M3(m)?u_e(f,m):{type:"complete",oldValue:f,newValue:m};v(y)&&(v(c)?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function R4e(e,t){if(C(e))return!1;const i=t.split(".");let r=e;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function vMt(e,t){for(const i of t)if(R4e(e,i))return!0;return!1}function O4e(e,t){if(!(typeof e=="function"||typeof t=="function"||C(e)&&C(t)))return C(e)||C(t)||typeof e=="object"&&typeof t=="object"&&M3(e)!==M3(t)?{type:"complete",oldValue:e,newValue:t}:u_e(e,t)}function SL(e){if(C(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const i of t.added)if(!SL(i))return!1;for(const i of t.removed)if(!SL(i))return!1;for(const i of t.changed)if(!SL(i))return!1;return!0}case"partial":for(const t in e.diff)if(!SL(e.diff[t]))return!1;return!0}}let k2=class extends Ys(ge){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([d(DN)],k2.prototype,"value",void 0),u([d(DN)],k2.prototype,"value2",void 0),u([d(DN)],k2.prototype,"value3",void 0),k2=u([P("esri.renderers.support.UniqueValue")],k2);const cC=k2;let uv=class extends Ys(ge){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return t==="string"||t==="number"?e.map(i=>new cC({value:i})):t==="object"?e[0]instanceof cC?e:e.map(i=>new cC(i)):null}};u([d({type:String,json:{write:!0}})],uv.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],uv.prototype,"label",void 0),u([d(sM)],uv.prototype,"symbol",void 0),u([d({type:[cC],json:{type:[[String]],read:{reader:e=>e?e.map(t=>new cC({value:t[0],value2:t[1],value3:t[2]})):null},write:{writer:(e,t)=>{const i=[];for(const r of e){const s=[r.value,r.value2,r.value3].filter(v).map(n=>n.toString());i.push(s)}t.values=i}}}})],uv.prototype,"values",void 0),u([Zt("values")],uv.prototype,"castValues",null),uv=u([P("esri.renderers.support.UniqueValueClass")],uv);const h_e=uv;let yO=class extends Ys(ge){constructor(e){super(e),this.heading=null,this.classes=null}};u([d({type:String,json:{write:!0}})],yO.prototype,"heading",void 0),u([d({type:[h_e],json:{write:!0}})],yO.prototype,"classes",void 0),yO=u([P("esri.renderers.support.UniqueValueGroup")],yO);const UH=yO;var VH;let Lw=VH=class extends ge{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new VH({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([d({type:String,json:{write:!0}})],Lw.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],Lw.prototype,"label",void 0),u([d(sM)],Lw.prototype,"symbol",void 0),u([d(DN)],Lw.prototype,"value",void 0),Lw=VH=u([P("esri.renderers.support.UniqueValueInfo")],Lw);const R3=Lw,I4e=()=>!!he("enable-feature:force-wosr"),bMt=()=>!!he("enable-feature:direct-3d-object-feature-layer-display"),wMt=()=>!!he("enable-feature:SceneLayer-editing");let _9={};async function P4e(e,t){try{return{data:(await OJ(e,t)).data,baseUrl:uJ(e),styleUrl:e}}catch(i){return bu(i),null}}function $4e(e,t,i){const r=v(t.portal)?t.portal:po.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return _9[n]||(_9[n]=L4e(e,r,i).then(o=>(s=o,o.fetchData())).then(o=>{var a;return{data:o,baseUrl:(a=s.itemUrl)!=null?a:"",styleName:e}})),_9[n]}function L4e(e,t,i){return t.load(i).then(()=>{const r=new s0({disableExtraQuery:!0,query:`owner:${yre} AND type:${_re} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:r})=>{var o;let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===_re&&a.owner===yre){s=a;break}}if(!s)throw new H("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(i)})}function d_e(e,t,i){return e&&v(e.styleUrl)?P4e(e.styleUrl,i):e&&v(e.styleName)?$4e(e.styleName,t,i):Promise.reject(new H("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function p_e(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function D4e(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!I4e()){for(const i of e.formatInfos)if(i.type==="gltf")return i.href}return e.webRef}function OJ(e,t){const i={responseType:"json",query:{f:"json"},...t};return _r(Yd(e),i)}const yre="esri_en",_re="Style",F4e="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var _O;const f_e="esri.renderers.UniqueValueRenderer",y_=se.getLogger(f_e),vre="uvInfos-watcher",bre="uvGroups-watcher",N4e=",",k4e=zr(R3);function U4e(e){const{field1:t,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=e,a=!(!t||!i);return[{classes:(n!=null?n:[]).map(l=>{var w;const{symbol:c,label:h,value:p,description:f}=l,[m,y,_]=a?((w=p==null?void 0:p.toString())==null?void 0:w.split(s||""))||[]:[p],b=[];return(t||o)&&b.push(m),i&&b.push(y),r&&b.push(_),{symbol:c,label:h,values:[b],description:f}})}]}let yn=_O=class extends rM(q0){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=t.find(a=>a.value===i[n].value);o?O4e(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<t.length;n++)i.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return e==null||typeof e=="function"?e:s$(e)}writeField(e,t,i,r){typeof e=="string"?t[i]=e:r&&r.messages?r.messages.push(new H("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):y_.error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,i){return i.portal||po.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const r=z1(t.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=fT(e.styleUrl,r))}set uniqueValueGroups(e){this.styleOrigin?y_.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?y_.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){var r;if(this.styleOrigin)return void y_.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?k4e(e):new R3({value:e,symbol:R0e(t)}),(r=this.uniqueValueInfos)==null||r.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void y_.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t){for(let i=0;i<t.length;i++)if(t[i].value===e+""){delete this._valueInfoMap[e],t.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(C(t)||C(t.arcade))&&(i={...i,arcade:await Eg()}),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(C(t)||C(t.arcade)))return void y_.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(C(i)||C(i.arcade))){const s=await Eg(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){var t;const e=[];for(const i of(t=this.uniqueValueInfos)!=null?t:[])i.symbol&&e.push(i.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){var r;const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=(r=this.uniqueValueInfos)==null?void 0:r.reduce((s,n)=>s+n.getMeshHash(),"");return`${e}.${t}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new _O({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ne(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ne(this.visualVariables),legendOptions:ne(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ne(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=ne(this.uniqueValueInfos),i=ne(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(ne(this.styleOrigin))),Object.freeze(t),Object.freeze(i)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",i),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Uc(e,t,this.valueExpression)];Dh(e,t,this.field),Dh(e,t,this.field2),Dh(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return d_e(this.styleOrigin,{portal:this.portal}).then(e=>{var i;const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(r=>{const s=new rS({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==e.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new R3({value:r.name,symbol:s});t.push(n),this._valueInfoMap[r.name]=n}),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((i=this.uniqueValueInfos)==null?void 0:i.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",N4e)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[t.value+""]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(vre);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const i of e)t.push(te(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(t,vre)}}_watchUniqueValueGroups(){var t;this.removeHandles(bre);const{uniqueValueGroups:e}=this;if(e){const i=[];for(const r of e){i.push(te(()=>({classes:r.classes}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const s of(t=r.classes)!=null?t:[])i.push(te(()=>({symbol:s.symbol,values:s.values,label:s.label,description:s.description}),(n,o)=>{n!==o&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(i,bre)}}_updateInfosFromGroups(){var l;if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!t&&!o)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!i);for(const c of n)for(const h of(l=c.classes)!=null?l:[]){const{symbol:p,label:f,values:m,description:y}=h;for(const _ of m!=null?m:[]){const{value:b,value2:w,value3:T}=_,S=[b];i&&S.push(w),r&&S.push(T);const E=a?S.join(s||""):S[0];e.push(new R3({symbol:p,label:f,value:E,description:y}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!t&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!t||!i),a=n.map(c=>{var w;const{symbol:h,label:p,value:f,description:m}=c,[y,_,b]=o?((w=f==null?void 0:f.toString())==null?void 0:w.split(s||""))||[]:[f];return new h_e({symbol:h,label:p,description:m,values:[new cC({value:y,value2:_,value3:b})]})}),l=[new UH({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Ft(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(i[t]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof t=="function"?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new _O(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||po.getDefault());const r=i.populateFromStyle();return r.catch(s=>{y_.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(e,t){const i=new _O(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch(s=>{y_.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([d({readOnly:!0})],yn.prototype,"_cache",null),u([bt({uniqueValue:"unique-value"})],yn.prototype,"type",void 0),u([d(X0e)],yn.prototype,"backgroundFillSymbol",void 0),u([d({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],yn.prototype,"field",null),u([Zt("field")],yn.prototype,"castField",null),u([Ge("field")],yn.prototype,"writeField",null),u([d({type:String,value:null,json:{write:!0}})],yn.prototype,"field2",null),u([d({type:String,value:null,json:{write:!0}})],yn.prototype,"field3",null),u([d({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],yn.prototype,"orderByClassesEnabled",void 0),u([d({type:String,value:null,json:{write:!0}})],yn.prototype,"valueExpression",null),u([d({type:String,json:{write:!0}})],yn.prototype,"valueExpressionTitle",void 0),u([d({type:aC,json:{write:!0}})],yn.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],yn.prototype,"defaultLabel",void 0),u([d(yme({...sM},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],yn.prototype,"defaultSymbol",null),u([d({type:String,value:null,json:{write:!0}})],yn.prototype,"fieldDelimiter",null),u([d({type:po,readOnly:!0})],yn.prototype,"portal",void 0),u([Fe("portal",["styleName"])],yn.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],yn.prototype,"styleOrigin",void 0),u([Fe("styleOrigin",["styleName","styleUrl"])],yn.prototype,"readStyleOrigin",null),u([Ge("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],yn.prototype,"writeStyleOrigin",null),u([d({type:[UH],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,i)=>(t.uniqueValueGroups||U4e(t)).map(r=>UH.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],yn.prototype,"uniqueValueGroups",null),u([d({type:[R3],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],yn.prototype,"uniqueValueInfos",null),yn=_O=u([P(f_e)],yn);const _$=yn,rU={key:"type",base:q0,typeMap:{heatmap:a_e,simple:f0,"unique-value":_$,"class-breaks":Z0e,"dot-density":p4e,dictionary:h4e,"pie-chart":S4e},errorContext:"renderer"},V4e={key:"type",base:q0,typeMap:{simple:f0,"unique-value":_$,"class-breaks":Z0e,heatmap:a_e},errorContext:"renderer"};function xMt(e,t){return UI(e,null,t)}const B4e=ub({types:rU});function UI(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Bh("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):B4e(e,t,i):null}class IJ{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(OG),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const i=new IJ,r=this._originStores[ar.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,ne(s),ar.DEFAULTS)});for(let s=ar.SERVICE;s<OG;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||i.set(a,ne(o),s)})}return i}get(t,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(t):void 0}keys(t){const i=t==null?this._values:this._originStores[t];return i?[...i.keys()]:[]}set(t,i,r=ar.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(t,i),!this._values.has(t)||this._propertyOriginMap.get(t)<=r){const n=this._values.get(t);return this._values.set(t,i),this._propertyOriginMap.set(t,r),n!==i}return!1}delete(t,i=ar.USER){const r=this._originStores[i];if(!r)return;const s=r.get(t);if(r.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===i){this._values.delete(t);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(t)}revert(t,i){for(;i>0&&!this.has(t,i);)--i;const r=this._originStores[i],s=r&&r.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,i),n!==s}originOf(t){return this._propertyOriginMap.get(t)||ar.DEFAULTS}forEach(t){this._values.forEach(t)}}const m_e=e=>{let t=class extends e{constructor(...i){super(...i);const r=ml(this),s=r.store,n=new IJ;r.store=n,oge(r,s,n)}read(i,r){lge(this,i,r)}getAtOrigin(i,r){const s=v9(this),n=s1(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return f5(this.originIdOf(i))}originIdOf(i){return v9(this).originOf(i)}revert(i,r){const s=v9(this),n=s1(r),o=ml(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function v9(e){return ml(e).store}let wre=class extends m_e(Te){};wre=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],wre);const z4e=e=>{let t=class extends e{constructor(...i){super(...i)}clear(i,r="user"){return b9(this).delete(i,s1(r))}write(i={},r){return uge(this,i=i||{},r),i}setAtOrigin(i,r,s){ml(this).setAtOrigin(i,r,s1(s))}removeOrigin(i){const r=b9(this),s=s1(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),ar.USER)}updateOrigin(i,r){const s=b9(this),n=s1(r),o=this.get(i);for(let a=n+1;a<OG;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return t=u([P("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function b9(e){return ml(e).store}const PJ=e=>{let t=class extends z4e(m_e(e)){constructor(...i){super(...i)}};return t=u([P("esri.core.MultiOriginJSONSupport")],t),t};let xre=class extends PJ(Te){};xre=u([P("esri.core.MultiOriginJSONSupport")],xre);async function G4e(e,t){const{WhereClause:i}=await Q(()=>import("./WhereClause.fb4e6ae7.js").then(function(r){return r.W}),["assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js"]);return i.create(e,t)}function j4e(e,t){return v(e)?v(t)?`(${e}) AND (${t})`:e:t}var BH;let Dw=BH=class extends ge{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new BH({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],Dw.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],Dw.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],Dw.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],Dw.prototype,"title",void 0),Dw=BH=u([P("esri.form.ExpressionInfo")],Dw);const H4e=Dw;let Fw=class extends ge{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],Fw.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],Fw.prototype,"label",void 0),u([d()],Fw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Fw.prototype,"visibilityExpression",void 0),Fw=u([P("esri.form.elements.Element")],Fw);const iA=Fw;var zH;let BN=zH=class extends ge{constructor(e){super(e),this.type=null}clone(){return new zH({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],BN.prototype,"type",void 0),BN=zH=u([P("esri.form.elements.inputs.AttachmentInput")],BN);const q4e=BN;var GH;let Nw=GH=class extends iA{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new GH({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],Nw.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],Nw.prototype,"editable",void 0),u([d({type:q4e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Nw.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],Nw.prototype,"type",void 0),Nw=GH=u([P("esri.form.elements.AttachmentElement")],Nw);const Tre=Nw;let zN=class extends ge{constructor(e){super(e),this.type=null}};u([d()],zN.prototype,"type",void 0),zN=u([P("esri.form.elements.inputs.Input")],zN);const nM=zN;let vO=class extends nM{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],vO.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],vO.prototype,"minLength",void 0),vO=u([P("esri.form.elements.inputs.TextInput")],vO);const $J=vO;var jH;let GN=jH=class extends $J{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new jH({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],GN.prototype,"type",void 0),GN=jH=u([P("esri.form.elements.inputs.BarcodeScannerInput")],GN);const W4e=GN;var HH;let U2=HH=class extends nM{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new HH({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],U2.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],U2.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],U2.prototype,"type",void 0),U2=HH=u([P("esri.form.elements.inputs.ComboBoxInput")],U2);const X4e=U2;var qH;function Sre(e){return e!=null?new Date(e):null}function Ere(e){return e?e.getTime():null}let Vp=qH=class extends nM{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return Sre(t.max)}writeMax(e,t){t.max=Ere(e)}readMin(e,t){return Sre(t.min)}writeMin(e,t){t.min=Ere(e)}clone(){return new qH({includeTime:this.includeTime,max:this.max,min:this.min})}};u([d({type:Boolean,json:{write:!0}})],Vp.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],Vp.prototype,"max",void 0),u([Fe("max")],Vp.prototype,"readMax",null),u([Ge("max")],Vp.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],Vp.prototype,"min",void 0),u([Fe("min")],Vp.prototype,"readMin",null),u([Ge("min")],Vp.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],Vp.prototype,"type",void 0),Vp=qH=u([P("esri.form.elements.inputs.DateTimePickerInput")],Vp);const Y4e=Vp;var WH;let V2=WH=class extends nM{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new WH({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],V2.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],V2.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],V2.prototype,"type",void 0),V2=WH=u([P("esri.form.elements.inputs.RadioButtonsInput")],V2);const Z4e=V2;var XH;let B2=XH=class extends nM{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new XH({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],B2.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],B2.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],B2.prototype,"type",void 0),B2=XH=u([P("esri.form.elements.inputs.SwitchInput")],B2);const J4e=B2;var YH;let jN=YH=class extends $J{constructor(e){super(e),this.type="text-area"}clone(){return new YH({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],jN.prototype,"type",void 0),jN=YH=u([P("esri.form.elements.inputs.TextAreaInput")],jN);const K4e=jN;var ZH;let HN=ZH=class extends $J{constructor(e){super(e),this.type="text-box"}clone(){return new ZH({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],HN.prototype,"type",void 0),HN=ZH=u([P("esri.form.elements.inputs.TextBoxInput")],HN);const Q4e=HN,e5e={base:nM,key:"type",typeMap:{"barcode-scanner":W4e,"combo-box":X4e,"datetime-picker":Y4e,"radio-buttons":Z4e,switch:J4e,"text-area":K4e,"text-box":Q4e}};var JH;let bO=JH=class extends ge{constructor(e){super(e),this.name=null,this.code=null}clone(){return new JH({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],bO.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],bO.prototype,"code",void 0),bO=JH=u([P("esri.layers.support.CodedValue")],bO);const t5e=new _i({inherited:"inherited",codedValue:"coded-value",range:"range"});let wO=class extends ge{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],wO.prototype,"name",void 0),u([bt(t5e)],wO.prototype,"type",void 0),wO=u([P("esri.layers.support.Domain")],wO);const sU=wO;var KH;let xO=KH=class extends sU{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new KH({codedValues:ne(this.codedValues),name:this.name})}};u([d({type:[bO],json:{write:!0}})],xO.prototype,"codedValues",void 0),u([bt({codedValue:"coded-value"})],xO.prototype,"type",void 0),xO=KH=u([P("esri.layers.support.CodedValueDomain")],xO);const g_e=xO;var QH;let qN=QH=class extends sU{constructor(e){super(e),this.type="inherited"}clone(){return new QH}};u([bt({inherited:"inherited"})],qN.prototype,"type",void 0),qN=QH=u([P("esri.layers.support.InheritedDomain")],qN);const y_e=qN;var eq;let z2=eq=class extends sU{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new eq({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],z2.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],z2.prototype,"minValue",void 0),u([bt({range:"range"})],z2.prototype,"type",void 0),z2=eq=u([P("esri.layers.support.RangeDomain")],z2);const __e=z2,v_e={key:"type",base:sU,typeMap:{range:__e,"coded-value":g_e,inherited:y_e}};function LJ(e){if(!e||!e.type)return null;switch(e.type){case"range":return __e.fromJSON(e);case"codedValue":return g_e.fromJSON(e);case"inherited":return y_e.fromJSON(e)}return null}var tq;const b_e="esri.form.elements.FieldElement",Cre=se.getLogger(b_e);let gd=tq=class extends iA{constructor(e){super(e),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){var e;return PG(Cre,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),(e=this._get("editable"))!=null?e:!0}set editable(e){PG(Cre,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",e)}clone(){return new tq({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:v_e,json:{read:{reader:LJ},write:!0}})],gd.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],gd.prototype,"editable",null),u([d({type:String,json:{write:!0}})],gd.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],gd.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],gd.prototype,"hint",void 0),u([d({types:e5e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],gd.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],gd.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],gd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],gd.prototype,"valueExpression",void 0),gd=tq=u([P(b_e)],gd);const Are=gd;var iq;let Ry=iq=class extends iA{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new iq({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:ne(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],Ry.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Ry.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],Ry.prototype,"editable",void 0),u([d({type:[HZ],json:{write:!0}})],Ry.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],Ry.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],Ry.prototype,"type",void 0),Ry=iq=u([P("esri.form.elements.RelationshipElement")],Ry);const Mre=Ry;function w_e(e){return{typesWithGroup:{base:iA,key:"type",typeMap:{attachment:Tre,field:Are,group:e,relationship:Mre}},typesWithoutGroup:{base:iA,key:"type",typeMap:{attachment:Tre,field:Are,relationship:Mre}}}}function x_e(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function T_e(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>s.toJSON())}function S_e(e,t,i=!0){return e?e.map(r=>Lf(i?t.typesWithGroup:t.typesWithoutGroup,r)):null}var rq;let Gm=rq=class extends iA{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return S_e(e,w9,!1)}readElements(e,t){return x_e(t.formElements,w9,!1)}writeElements(e,t){t.formElements=T_e(e,w9,!1)}clone(){return new rq({description:this.description,elements:ne(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],Gm.prototype,"elements",void 0),u([Zt("elements")],Gm.prototype,"castElements",null),u([Fe("elements",["formElements"])],Gm.prototype,"readElements",null),u([Ge("elements")],Gm.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],Gm.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],Gm.prototype,"type",void 0),Gm=rq=u([P("esri.form.elements.GroupElement")],Gm);const w9=w_e(Gm),i5e=Gm;var sq;const x9=w_e(i5e);let Bp=sq=class extends ge{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(e){return S_e(e,x9)}readElements(e,t){return x_e(t.formElements,x9)}writeElements(e,t){t.formElements=T_e(e,x9)}clone(){return new sq({description:this.description,expressionInfos:ne(this.expressionInfos),elements:ne(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([d({type:String,json:{write:!0}})],Bp.prototype,"description",void 0),u([d({json:{write:!0}})],Bp.prototype,"elements",void 0),u([Zt("elements")],Bp.prototype,"castElements",null),u([Fe("elements",["formElements"])],Bp.prototype,"readElements",null),u([Ge("elements")],Bp.prototype,"writeElements",null),u([d({type:[H4e],json:{write:!0}})],Bp.prototype,"expressionInfos",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bp.prototype,"preserveFieldValuesWhenHidden",void 0),u([d({type:String,json:{write:!0}})],Bp.prototype,"title",void 0),Bp=sq=u([P("esri.form.FormTemplate")],Bp);const r5e=Bp;async function s5e(e){const t="portalItem"in e?e:{portalItem:e},i=await Q(()=>import("./portalLayers.2cf8d543.js"),["assets/portalLayers.2cf8d543.js","assets/layersLoader.e48a79d9.js","assets/fetchService.ef2e52b5.js","assets/jsonContext.1eaa7625.js"]);try{return await i.fromItem(t)}catch(r){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||or.portalUrl;throw se.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let n5e=0,ca=class extends ps.EventedMixin(G0(sp)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Gi(-180,-90,180,90,et.WGS84),this.id=Date.now().toString(16)+"-layer-"+n5e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=et.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await Q(()=>import("./arcgisLayers.3dd733be.js"),["assets/arcgisLayers.3dd733be.js","assets/fetchService.ef2e52b5.js"])).fromUrl(t)}static fromPortalItem(e){return s5e(e)}initialize(){this.when().catch(e=>{var t,i;Ws(e)||se.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(i=this.id)!=null?i:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Ma(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await _r(e,{query:{f:"json"},responseType:"json"})).data;throw new H("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],ca.prototype,"attributionDataUrl",void 0),u([d({type:Gi})],ca.prototype,"fullExtent",void 0),u([d({readOnly:!0})],ca.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],ca.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],ca.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],ca.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],ca.prototype,"opacity",void 0),u([d({clonable:!1})],ca.prototype,"parent",void 0),u([d({readOnly:!0})],ca.prototype,"parsedUrl",null),u([d({type:Boolean})],ca.prototype,"popupEnabled",void 0),u([d({type:Boolean})],ca.prototype,"attributionVisible",void 0),u([d({type:et})],ca.prototype,"spatialReference",void 0),u([d({type:String})],ca.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],ca.prototype,"type",void 0),u([d()],ca.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],ca.prototype,"visible",void 0),ca=u([P("esri.layers.Layer")],ca);const VI=ca;let fg=class extends Te{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Ii,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,te)}addWhen(e,t,i={}){return this._installWatch(e,t,i,Qo)}addOnCollectionChange(e,t,{initial:i=!1,final:r=!1}={}){const s=++this._handleId;return this._handles.add([Fs(e,"after-changes",this._createSyncUpdatingCallback(),hr),Fs(e,"change",t,{onListenerAdd:i?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:r?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this._handles.remove(s)}}addPromise(e){if(C(e))return e;const t=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(EL)||this._set("updating",!1))}},t),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(t);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this._handles.add(n,s),{remove:()=>this._handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=te(e,i,{sync:!0,equals:()=>!1});return this._handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this._handles.remove(EL),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(ZA(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(EL))}),EL)}}};u([d({readOnly:!0})],fg.prototype,"updating",void 0),fg=u([P("esri.core.support.WatchUpdatingTracking")],fg);const EL=-42,jf=e=>{let t=class extends e{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new Ii}get updatingHandles(){return this._get("updatingHandles")||new fg}};return u([d({readOnly:!0})],t.prototype,"handles",null),u([d({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([P("esri.core.HandleOwner")],t),t};let BI=class extends jf(Te){};BI=u([P("esri.core.HandleOwner")],BI);class nq{constructor(t=i=>i.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(i=>{t(i)||this._items.delete(i)}),this}}var Ba;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(Ba||(Ba={}));let o5e=0;function E_e(){return o5e++}function a5e(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function zI(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function DJ(e,t,i,r){if(t.type===Ba.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==Ba.INVOKE&&t.type!==Ba.RESPONSE)return void e.postMessage(t);let s;if(a5e(i)?(s=Rre(i.transferList),t.data=i.result):(s=Rre(r),t.data=i),s){if(he("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case Ba.INVOKE:throw o;case Ba.RESPONSE:return void DJ(e,{type:Ba.RESPONSE,jobId:t.jobId,error:zI(o)})}}}e.postMessage(t,s)}else e.postMessage(t)}function GI(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function Rre(e){if(!e||!e.length)return null;if(he("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!l5e(i));return t.length?t:null}function l5e(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const c5e={statsWorker:()=>Q(()=>import("./statsWorker.a721fe3d.js"),["assets/statsWorker.a721fe3d.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js"]),geometryEngineWorker:()=>Q(()=>import("./geometryEngineWorker.0d874716.js"),["assets/geometryEngineWorker.0d874716.js","assets/geometryEngineJSON.7d40f72f.js","assets/geometryEngineBase.871c2f6a.js","assets/json.5152e73f.js"]),CSVSourceWorker:()=>Q(()=>import("./CSVSourceWorker.d6dd717c.js"),["assets/CSVSourceWorker.d6dd717c.js","assets/json.5152e73f.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineCapabilities.ea616409.js","assets/number.96c248f8.js","assets/clientSideDefaults.a92d19ee.js"]),EdgeProcessingWorker:()=>Q(()=>import("./EdgeProcessingWorker.f4365616.js"),[]),ElevationSamplerWorker:()=>Q(()=>import("./ElevationSamplerWorker.2d6fe9c2.js"),["assets/ElevationSamplerWorker.2d6fe9c2.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/georeference.e81b1ed1.js"]),FeatureServiceSnappingSourceWorker:()=>Q(()=>import("./FeatureServiceSnappingSourceWorker.541427e5.js"),["assets/FeatureServiceSnappingSourceWorker.541427e5.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineCapabilities.ea616409.js","assets/symbologySnappingCandidates.3a7b3f55.js"]),GeoJSONSourceWorker:()=>Q(()=>import("./GeoJSONSourceWorker.97b1a465.js"),["assets/GeoJSONSourceWorker.97b1a465.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineCapabilities.ea616409.js","assets/geojson.c27e4a17.js","assets/clientSideDefaults.a92d19ee.js","assets/sourceUtils.a2706ece.js"]),LercWorker:()=>Q(()=>import("./LercWorker.c933e9ef.js"),[]),MemorySourceWorker:()=>Q(()=>import("./MemorySourceWorker.e0c1bed9.js"),["assets/MemorySourceWorker.e0c1bed9.js","assets/objectIdUtils.e2ddfb9a.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineCapabilities.ea616409.js","assets/clientSideDefaults.a92d19ee.js","assets/sourceUtils.a2706ece.js"]),PBFDecoderWorker:()=>Q(()=>import("./PBFDecoderWorker.e17b55d8.js"),[]),Pipeline:()=>Q(()=>import("./Pipeline.ae3beed6.js").then(function(e){return e.P}),["assets/Pipeline.ae3beed6.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/StreamFeatureManager.8704d56a.js","assets/quickselect.2c5f2780.js","assets/arcadeTimeUtils.68d88c0e.js","assets/centroid.bfde938e.js","assets/ogcFeatureUtils.082e00d1.js","assets/geojson.c27e4a17.js","assets/clientSideDefaults.a92d19ee.js","assets/createConnection.bb77c9ac.js","assets/enums.89506096.js","assets/TileInfoView.dbee1229.js","assets/number.dcd3e86c.js"]),PointCloudWorker:()=>Q(()=>import("./PointCloudWorker.0e0da674.js"),["assets/PointCloudWorker.0e0da674.js","assets/PointCloudWorkerUtil.c0b97c18.js","assets/PointCloudUniqueValueRenderer.edd5a5a2.js","assets/I3SBinaryReader.79df5733.js"]),RasterWorker:()=>Q(()=>import("./RasterWorker.652c159a.js"),["assets/RasterWorker.652c159a.js","assets/dataUtils.08ed60c6.js","assets/pixelRangeUtils.eec66021.js","assets/utils.f5c989f0.js","assets/rasterProjectionHelper.3ee8a0a7.js"]),SceneLayerSnappingSourceWorker:()=>Q(()=>import("./SceneLayerSnappingSourceWorker.0fcaa16d.js"),["assets/SceneLayerSnappingSourceWorker.0fcaa16d.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js"]),SceneLayerWorker:()=>Q(()=>import("./SceneLayerWorker.caa7fdf8.js").then(function(e){return e.S}),["assets/SceneLayerWorker.caa7fdf8.js","assets/I3SNode.332c5ead.js"]),WFSSourceWorker:()=>Q(()=>import("./WFSSourceWorker.f9f58fb6.js"),["assets/WFSSourceWorker.f9f58fb6.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineCapabilities.ea616409.js","assets/geojson.c27e4a17.js","assets/sourceUtils.a2706ece.js","assets/wfsUtils.a25e8dc2.js","assets/xmlUtils.e4562140.js"]),WorkerTileHandler:()=>Q(()=>import("./WorkerTileHandler.57aa945a.js"),["assets/WorkerTileHandler.57aa945a.js","assets/TileClipper.7b9dd3ce.js","assets/StyleRepository.29dbb147.js","assets/enums.89506096.js","assets/Rect.e8e4d18d.js","assets/TurboLine.c0d75d8b.js","assets/BidiEngine.f5b8c89f.js"])},{CLOSE:Ore,ABORT:Ire,INVOKE:Pre,RESPONSE:VM,OPEN_PORT:$re,ON:u5e}=Ba,h5e=2;class d5e{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===Ba.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class wu{static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new wu(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),wu.clients.set(s,r),i.port2}static loadWorker(t){const i=c5e[t];return i?i():Promise.resolve(null)}constructor(t,i,r){this._port=t,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new d5e(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Ore}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new H("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const o=E_e();return new Promise((a,l)=>{if(So(s))return this._processWork(),void l(lr());const c=fl(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),hs(p.abortHandle),this._post({type:Ire,jobId:o}),l(lr()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:Pre,jobId:o,methodName:t,abortable:s!=null},i,n)})}on(t,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:Ba.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:Ba.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:$re,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=h5e)return;const t=this._getNextJob();if(!t)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=t;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{hs(t.abortHandle),t.reject(lr(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){v(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=GI(t);if(i)switch(i.type){case VM:this._onResponseMessage(i);break;case Pre:this._invokeQueue.push(i);break;case Ire:this._onAbortMessage(i);break;case Ore:this._onCloseMessage();break;case $re:this._onOpenPortMessage(i);break;case u5e:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&wu.clients.get(this)===t&&t.destroy(),wu.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:VM,jobId:r,error:zI(p)})}Yh(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:VM,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),Ws(p)||this._post({type:VM,jobId:r,error:zI(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:VM,jobId:r},l)}_onOpenPortMessage(t){new wu(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,n=>{i.postMessage(n)}),s=a$(t.port,"message",n=>{var o;((o=GI(n))==null?void 0:o.type)===Ba.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),hs(o.abortHandle),r?o.reject(H.fromJSON(JSON.parse(r))):o.resolve(s)}_post(t,i,r){return DJ(this._port,t,i,r)}}wu.kernelInfo={revision:s0e,version:n0e,buildDate:r0e},wu.clients=new Map;class p5e{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new nq}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,i){return new Promise((r,s)=>{let n=!0;const o=a=>{ii(i.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];Yh(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new wu(c,i,()=>{var h;return(h=this._ongoingJobsQueue.pop())!=null?h:null}),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new wu(l,i,()=>{var c;return(c=this._ongoingJobsQueue.pop())!=null?c:null}),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(t,i,r))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(lr(`Worker closing, aborting job calling '${t.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,i,r){let s;Array.isArray(r)?(se.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=V1();this._ongoingJobsQueue.push({methodName:t,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(t,i){return Promise.all(this._clientPromises).then(()=>BC(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}}const f5e=se.getLogger("esri.assets");function m5e(e,t){return _r(Vi(e),t)}function Vi(e){if(!or.assetsPath)throw f5e.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new H("assets:path-not-set","config.assetsPath is not set");return pT(or.assetsPath,e)}const C_e=se.getLogger("esri.intl.substitute");function gh(e,t,i={}){const{format:r={}}=i;return Sg(e,s=>g5e(s,t,r))}function g5e(e,t,i){var l;let r,s;const n=e.indexOf(":");if(n===-1?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const o=r$(r,t);if(o==null)return"";const a=(l=s?i==null?void 0:i[s]:null)!=null?l:i==null?void 0:i[r];return a?y5e(o,a):s?_5e(o,s):FJ(o)}function y5e(e,t){switch(t.type){case"date":return Ou(e,t.intlOptions);case"number":return Cg(e,t.intlOptions);default:return C_e.warn("missing format descriptor for key {key}"),FJ(e)}}function _5e(e,t){switch(t.toLowerCase()){case"dateformat":return Ou(e);case"numberformat":return Cg(e);default:return C_e.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Ou(e):/^numberformat/i.test(t)?Cg(e):FJ(e)}}function FJ(e){switch(typeof e){case"string":return e;case"number":return Cg(e);case"boolean":return""+e;default:return e instanceof Date?Ou(e):""}}const Lre=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,v5e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Dre(e){var t;return(t=v5e[e])!=null?t:!1}const TO=[],uC=new Map;function Fre(e){for(const t of uC.keys())A_e(e.pattern,t)&&uC.delete(t)}function b5e(e){return TO.includes(e)||(Fre(e),TO.unshift(e)),{remove(){const t=TO.indexOf(e);t>-1&&(TO.splice(t,1),Fre(e))}}}async function NJ(e){const t=Xd();uC.has(e)||uC.set(e,x5e(e,t));const i=uC.get(e);return i&&await T5e.add(i),i}function w5e(e){if(!Lre.test(e))return null;const t=Lre.exec(e);if(t===null)return null;const[,i,r]=t,s=i+(r?"-"+r.toUpperCase():"");return Dre(s)?s:Dre(i)?i:null}async function x5e(e,t){const i=[];for(const r of TO)if(A_e(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new H("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new H("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function A_e(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}zZ(()=>{uC.clear()});const T5e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=V1())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function S5e(e,t,i,r){const s=t.exec(i);if(!s)throw new H("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=w5e(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await Nre(e(c))}catch(p){if(c===l)throw new H("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await Nre(e(l))}catch(f){throw new H("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function Nre(e){if(v(kre.fetchBundleAsset))return kre.fetchBundleAsset(e);const t=await _r(e,{responseType:"text"});return JSON.parse(t.data)}class E5e{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return S5e(this.getAssetUrl,this.matcher,t,i)}}function C5e(e){return new E5e(e)}const kre={};b5e(C5e({pattern:"esri/",location:Vi}));const A5e={};function M5e(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=A5e.baseUrl),t}class R5e{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}}class WN{constructor(){this._dispatcher=new R5e,this._workerPostMessage({type:Ba.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){zC(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){zC(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=GI(t);if(i&&i.type===Ba.OPEN){const{modulePath:r,jobId:s}=i;let n=await wu.loadWorker(r);n||(n=await Q(()=>import(r),[]));const o=wu.connect(n);this._workerPostMessage({type:Ba.OPENED,jobId:s,data:o})}}}const oq=se.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:O5e}=Ba,I5e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let CL,AL;const Ure="Failed to create Worker. Fallback to execute module in main thread";async function P5e(){if(!he("esri-workers")||(he("mozilla"),0))return Vre(new WN);if(!CL&&!AL)try{const t=I5e.split('"{CONFIGURATION}"').join(`'${$5e()}'`);CL=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){AL=t||{}}let e;if(CL)try{e=new Worker(CL,{name:"esri-worker-"+L5e++})}catch{oq.warn(Ure,AL),e=new WN}else oq.warn(Ure,AL),e=new WN;return Vre(e)}async function Vre(e){return new Promise(t=>{function i(s){const n=GI(s);n&&n.type===O5e&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),oq.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new WN).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function $5e(){let e;if(or.default!=null){const s={...or};delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(or));e.assetsPath=Rh(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?Rh(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=Xd(),e.has={"esri-csp-restrictions":he("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":he("esri-2d-update-debug"),"featurelayer-pbf":he("featurelayer-pbf"),"featurelayer-simplify-thresholds":he("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":he("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":he("featurelayer-simplify-mobile-factor"),"esri-atomics":he("esri-atomics"),"esri-shared-array-buffer":he("esri-shared-array-buffer"),"esri-tiles-debug":he("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":he("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":he("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":he("polylabel-placement-enabled")},e.workers.loaderUrl&&(e.workers.loaderUrl=Rh(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=Rh(e.workers.workerPath):e.workers.workerPath=Rh(Vi("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=or.workers.loaderConfig,i=M5e({baseUrl:t==null?void 0:t.baseUrl,locale:Xd(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t==null?void 0:t.has},map:{...t==null?void 0:t.map},paths:{...t==null?void 0:t.paths},packages:(t==null?void 0:t.packages)||[]}),r={version:n0e,buildDate:r0e,revision:s0e};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}let L5e=0;const{ABORT:Bre,INVOKE:D5e,OPEN:F5e,OPENED:N5e,RESPONSE:BM}=Ba;class kJ{static async create(t){const i=await P5e();return new kJ(i,t)}constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),se.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=E_e();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:gZ(r,()=>{this._outJobs.delete(s),this._post({type:Bre,jobId:s})})};this._outJobs.set(s,a),this._post({type:F5e,jobId:s,modulePath:t})})}_onMessage(t){const i=GI(t);if(i)switch(i.type){case N5e:this._onOpenedMessage(i);break;case BM:this._onResponseMessage(i);break;case Bre:this._onAbortMessage(i);break;case D5e:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=UFe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:BM,jobId:r,error:zI(h)})}Yh(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:BM,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),Ws(h)||this._post({type:BM,jobId:r,error:zI(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:BM,jobId:r},c)}_onOpenedMessage(t){const{jobId:i,data:r}=t,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),hs(s.abortHandle),s.resolve(r))}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),hs(n.abortHandle),r?n.reject(H.fromJSON(JSON.parse(r))):n.resolve(s))}_post(t,i,r){return DJ(this.worker,t,i,r)}}let Ox=he("esri-workers-debug")?1:he("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):he("host-browser")?navigator.hardwareConcurrency-1:0;Ox||(Ox=he("safari")&&he("mac")?7:2);let zre=0;const XN=[];function k5e(){R_e()}async function ML(e,t){const i=new p5e;return await i.open(e,t),i}async function M_e(e,t={}){if(typeof e!="string")throw new H("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(he("host-webworker")&&!he("esri-workers")&&(i="local"),i==="local"){let r=await wu.loadWorker(e);r||(r=await Q(()=>import(e),[])),ii(t.signal);const s=t.client||r;return ML([wu.connect(r)],{...t,client:s})}if(await R_e(),ii(t.signal),i==="dedicated"){const r=zre++%Ox;return ML([await XN[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,Ox);if(r<Ox){const s=new Array(r);for(let n=0;n<r;++n){const o=zre++%Ox;s[n]=XN[o].open(e,t)}return ML(s,t)}}return ML(XN.map(r=>r.open(e,t)),t)}let RL=null;async function R_e(){if(RL)return RL;new AbortController;const e=[];for(let t=0;t<Ox;t++){const i=kJ.create(t).then(r=>(XN[t]=r,r));e.push(i)}return RL=Promise.all(e),RL}function Gre(e,t,i){if(e.hasM==null||e.hasZ)for(const r of t)for(const s of r)s.length>2&&(s[2]*=i)}function U5e(e,t,i){if(!e&&!t||!i)return;const r=aT(i);jre(e,i,r),jre(t,i,r)}function jre(e,t,i){if(e)for(const r of e)V5e(r.geometry,t,i)}function V5e(e,t,i){if(C(e)||!e.spatialReference||kn(e.spatialReference,t))return;const r=aT(e.spatialReference)/i;if(r!==1){if("x"in e)e.z!=null&&(e.z*=r);else if("rings"in e)Gre(e,e.rings,r);else if("paths"in e)Gre(e,e.paths,r);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}}function O_e(e,t,i){if(C(t)||C(i)||i.vcsWkid||kn(t,i))return null;const r=aT(t)/aT(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>B5e(s,r);case"polyline":case"esriGeometryPolyline":return s=>G5e(s,r);case"polygon":case"esriGeometryPolygon":return s=>z5e(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>j5e(s,r);case"extent":case"esriGeometryExtent":return s=>H5e(s,r);default:return null}}function B5e(e,t){e&&e.z!=null&&(e.z*=t)}function z5e(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function G5e(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function j5e(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function H5e(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}function aq(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=O_e(i.geometryType,t,e.outSpatialReference);if(!C(r))for(const s of i.features)r(s.geometry)}const q5e=new _i({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var lq;const W5e=new _i({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let $l=lq=class extends ge{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:t}){var r;let i=null;try{i=t?JSON.parse(t):null}catch{}return(r=i==null?void 0:i.value)!=null?r:null}readValueType(e,{description:t}){let i=null;try{i=t?JSON.parse(t):null}catch{}return i?W5e.fromJSON(i.fieldValueType):null}clone(){return new lq({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([d({type:String,json:{write:!0}})],$l.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],$l.prototype,"defaultValue",void 0),u([d()],$l.prototype,"description",void 0),u([Fe("description")],$l.prototype,"readDescription",null),u([d({types:v_e,json:{read:{reader:LJ},write:!0}})],$l.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],$l.prototype,"editable",void 0),u([d({type:us,json:{write:!0}})],$l.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],$l.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],$l.prototype,"nullable",void 0),u([bt(q5e)],$l.prototype,"type",void 0),u([d()],$l.prototype,"valueType",void 0),u([Fe("valueType",["description"])],$l.prototype,"readValueType",null),u([d({type:Boolean,json:{read:!1}})],$l.prototype,"visible",void 0),$l=lq=u([P("esri.layers.support.Field")],$l);const nU=$l;var cq;const uq=new _i({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Fa=cq=class extends ge{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const i=et.fromJSON(t.spatialReference),r=[];for(let n=0;n<e.length;n++){const o=e[n],a=Ko.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;v(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&v(h))for(const p in h){const f=h[p],m=(s=c[p])==null?void 0:s.spatialReference;v(f)&&!m&&(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(e,t,i,r){if(e)return void uq.write(e,t,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&v(n.geometry))return void uq.write(n.geometry.type,t,i,r)}}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=Jl(e);return r&&!i&&t.spatialReference&&(r.spatialReference=et.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&v(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new cq(this.cloneProperties())}cloneProperties(){return ne({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const s=e&&e[i];r.geometry=s&&s.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=c=>Math.round((c-r)/t),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)v(h)&&c&&c(h);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=t(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return e==="point"?r=>(r.x=t(r.x),r.y=i(r.y),r):e==="polyline"||e==="polygon"?r=>{const s=jx(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,i);c&&n.push(c)}return n.length>0?(jx(r)?r.rings=n:r.paths=n,r):null}:e==="multipoint"?r=>{const s=this._quantizePoints(r.points,t,i);return s&&s.length>0?(r.points=s,r):null}:e==="extent"?r=>r:null}_getHydrationFunction(e,t,i){return e==="point"?r=>{r.x=t(r.x),r.y=i(r.y)}:e==="polyline"||e==="polygon"?r=>{const s=jx(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=i(o)}}}:e==="extent"?r=>{r.xmin=t(r.xmin),r.ymin=i(r.ymin),r.xmax=t(r.xmax),r.ymax=i(r.ymax)}:e==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=i(o)}}:null}};u([d({type:String,json:{write:!0}})],Fa.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Fa.prototype,"exceededTransferLimit",void 0),u([d({type:[Ko],json:{write:!0}})],Fa.prototype,"features",void 0),u([Fe("features")],Fa.prototype,"readFeatures",null),u([d({type:[nU],json:{write:!0}})],Fa.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:uq.read}}})],Fa.prototype,"geometryType",void 0),u([Ge("geometryType")],Fa.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Fa.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Fa.prototype,"hasZ",void 0),u([d({types:ZT,json:{write:!0}})],Fa.prototype,"queryGeometry",void 0),u([Fe("queryGeometry")],Fa.prototype,"readQueryGeometry",null),u([d({type:et,json:{write:!0}})],Fa.prototype,"spatialReference",void 0),u([Ge("spatialReference")],Fa.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Fa.prototype,"transform",void 0),Fa=cq=u([P("esri.rest.support.FeatureSet")],Fa),Fa.prototype.toJSON.isDefaultToJSON=!0;const UJ=Fa;let X5e=0;const I_e="esri.layers.graphics.sources.MemorySource",T9=se.getLogger(I_e);let Yy=class extends sp.LoadableMixin(p$(jf(Qe))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=v(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);aq(e,this.layer.spatialReference,i);const r=UJ.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new H("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return aq(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(i=>({count:i.count,extent:Gi.fromJSON(i.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new H("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&r.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}U5e(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this._layerOrSourceGeometryType!=="mesh"||C(e))return;const i=[];for(const{geometry:r}of e)!v(r)||r.type!=="mesh"||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const r=e.get(i.objectId);r!=null&&this._addIdToClientGraphic(r)}for(const i of t.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new H("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!r&&v(o.geometry)&&(r=o.geometry.type),i[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:i,inferredGeometryType:r,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){var e,t,i;return(i=(e=this.layer)==null?void 0:e.geometryType)!=null?i:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(X5e++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return C(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?zh.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await M_e("MemorySourceWorker",{strategy:he("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{T9.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:Oie.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&s,hasZ:this._layerOrSourceGeometryType==="mesh"||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const f of h.warnings)T9.warn(f.message,{layer:this.layer,warning:f});h.featureErrors.length&&T9.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=Oie.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([NZ({Type:Ko,ensureType:zr(Ko)})],Yy.prototype,"itemType",void 0),u([d()],Yy.prototype,"type",void 0),u([d({constructOnly:!0})],Yy.prototype,"layer",void 0),u([d({readOnly:!0})],Yy.prototype,"_workerGeometryType",null),u([d()],Yy.prototype,"sourceJSON",void 0),Yy=u([P(I_e)],Yy);function Y5e(e){return"portalItem"in e}const Z5e=e=>{let t=class extends e{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):Y5e(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],t.prototype,"apiKey",null),t=u([P("esri.layers.mixins.APIKeyMixin")],t),t},P_e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},$_e=Object.values(P_e),L_e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${$_e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),J5e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${$_e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),K5e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function TMt(e){return!!L_e.test(e)}function oM(e){if(C(e))return null;const t=Ma(e),i=t.path.match(L_e)||t.path.match(J5e);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:VJ(a!==-1?s.slice(a+1):s),serverType:P_e[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function Q5e(e){const t=Ma(e).path.match(K5e);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function VJ(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function eke(e,t){const i=[];if(e){const r=oM(e);v(r)&&r.title&&i.push(r.title)}if(t){const r=VJ(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function D_e(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(i)||e.includes(r)||e.includes(s);return n&&o}function tke(e,t){return e&&Wye(Yye(e,t))}function ike(e){let{url:t}=e;if(!t)return{url:t};t=Yye(t,e.logger);const i=Ma(t),r=oM(i.path);let s;if(v(r))r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const n=Q5e(i.path);v(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:Wye(t),layerId:s}}function rke(e,t,i,r,s){G1(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=pT(r.url,i,e.layerId.toString()))}function SMt(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(r||s||n)}const ske=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=oM(this.url);if(v(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",tke(i,se.getLogger(this.declaredClass)))}};return u([d()],t.prototype,"title",null),u([d({type:String})],t.prototype,"url",null),t=u([P("esri.layers.mixins.ArcGISService")],t),t};function v$(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function nke(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function oke(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,_){const b=new Float32Array(16);return b[0]=e,b[1]=t,b[2]=i,b[3]=r,b[4]=s,b[5]=n,b[6]=o,b[7]=a,b[8]=l,b[9]=c,b[10]=h,b[11]=p,b[12]=f,b[13]=m,b[14]=y,b[15]=_,b}function ake(e,t){return new Float32Array(e,t,16)}const lke=v$();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:lke,clone:nke,create:v$,createView:ake,fromValues:oke},Symbol.toStringTag,{value:"Module"}));function Ao(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Vg(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,_,b){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=f,e[12]=m,e[13]=y,e[14]=_,e[15]=b,e}function np(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lu(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function aM(e,t){return Ea(e,t)||np(e),e}function Ea(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],b=t[14],w=t[15],T=i*a-r*o,S=i*l-s*o,E=i*c-n*o,M=r*l-s*a,A=r*c-n*a,$=s*c-n*l,I=h*_-p*y,k=h*b-f*y,V=h*w-m*y,B=p*b-f*_,G=p*w-m*_,X=f*w-m*b;let K=T*X-S*G+E*B+M*V-A*k+$*I;return K?(K=1/K,e[0]=(a*X-l*G+c*B)*K,e[1]=(s*G-r*X-n*B)*K,e[2]=(_*$-b*A+w*M)*K,e[3]=(f*A-p*$-m*M)*K,e[4]=(l*V-o*X-c*k)*K,e[5]=(i*X-s*V+n*k)*K,e[6]=(b*E-y*$-w*S)*K,e[7]=(h*$-f*E+m*S)*K,e[8]=(o*G-a*V+c*I)*K,e[9]=(r*V-i*G-n*I)*K,e[10]=(y*A-_*E+w*T)*K,e[11]=(p*E-h*A-m*T)*K,e[12]=(a*k-o*B-l*I)*K,e[13]=(i*B-r*k+s*I)*K,e[14]=(_*S-y*M-b*T)*K,e[15]=(h*M-p*S+f*T)*K,e):null}function cke(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],b=t[14],w=t[15];return e[0]=a*(f*w-m*b)-p*(l*w-c*b)+_*(l*m-c*f),e[1]=-(r*(f*w-m*b)-p*(s*w-n*b)+_*(s*m-n*f)),e[2]=r*(l*w-c*b)-a*(s*w-n*b)+_*(s*c-n*l),e[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*w-m*b)-h*(l*w-c*b)+y*(l*m-c*f)),e[5]=i*(f*w-m*b)-h*(s*w-n*b)+y*(s*m-n*f),e[6]=-(i*(l*w-c*b)-o*(s*w-n*b)+y*(s*c-n*l)),e[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),e[8]=o*(p*w-m*_)-h*(a*w-c*_)+y*(a*m-c*p),e[9]=-(i*(p*w-m*_)-h*(r*w-n*_)+y*(r*m-n*p)),e[10]=i*(a*w-c*_)-o*(r*w-n*_)+y*(r*c-n*a),e[11]=-(i*(a*m-c*p)-o*(r*m-n*p)+h*(r*c-n*a)),e[12]=-(o*(p*b-f*_)-h*(a*b-l*_)+y*(a*f-l*p)),e[13]=i*(p*b-f*_)-h*(r*b-s*_)+y*(r*f-s*p),e[14]=-(i*(a*b-l*_)-o*(r*b-s*_)+y*(r*l-s*a)),e[15]=i*(a*f-l*p)-o*(r*f-s*p)+h*(r*l-s*a),e}function uke(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],m=e[12],y=e[13],_=e[14],b=e[15];return(t*o-i*n)*(p*b-f*_)-(t*a-r*n)*(h*b-f*y)+(t*l-s*n)*(h*_-p*y)+(i*a-r*o)*(c*b-f*m)-(i*l-s*o)*(c*_-p*m)+(r*l-s*a)*(c*y-h*m)}function Hs(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=t[9],m=t[10],y=t[11],_=t[12],b=t[13],w=t[14],T=t[15];let S=i[0],E=i[1],M=i[2],A=i[3];return e[0]=S*r+E*a+M*p+A*_,e[1]=S*s+E*l+M*f+A*b,e[2]=S*n+E*c+M*m+A*w,e[3]=S*o+E*h+M*y+A*T,S=i[4],E=i[5],M=i[6],A=i[7],e[4]=S*r+E*a+M*p+A*_,e[5]=S*s+E*l+M*f+A*b,e[6]=S*n+E*c+M*m+A*w,e[7]=S*o+E*h+M*y+A*T,S=i[8],E=i[9],M=i[10],A=i[11],e[8]=S*r+E*a+M*p+A*_,e[9]=S*s+E*l+M*f+A*b,e[10]=S*n+E*c+M*m+A*w,e[11]=S*o+E*h+M*y+A*T,S=i[12],E=i[13],M=i[14],A=i[15],e[12]=S*r+E*a+M*p+A*_,e[13]=S*s+E*l+M*f+A*b,e[14]=S*n+E*c+M*m+A*w,e[15]=S*o+E*h+M*y+A*T,e}function Vc(e,t,i){const r=i[0],s=i[1],n=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],m=t[7],y=t[8],_=t[9],b=t[10],w=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=f,e[7]=m,e[8]=y,e[9]=_,e[10]=b,e[11]=w,e[12]=o*r+h*s+y*n+t[12],e[13]=a*r+p*s+_*n+t[13],e[14]=l*r+f*s+b*n+t[14],e[15]=c*r+m*s+w*n+t[15]}return e}function oU(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Cu(e,t,i,r){let s,n,o,a,l,c,h,p,f,m,y,_,b,w,T,S,E,M,A,$,I,k,V,B,G=r[0],X=r[1],K=r[2],re=Math.sqrt(G*G+X*X+K*K);return re<vl()?null:(re=1/re,G*=re,X*=re,K*=re,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],f=t[5],m=t[6],y=t[7],_=t[8],b=t[9],w=t[10],T=t[11],S=G*G*o+n,E=X*G*o+K*s,M=K*G*o-X*s,A=G*X*o-K*s,$=X*X*o+n,I=K*X*o+G*s,k=G*K*o+X*s,V=X*K*o-G*s,B=K*K*o+n,e[0]=a*S+p*E+_*M,e[1]=l*S+f*E+b*M,e[2]=c*S+m*E+w*M,e[3]=h*S+y*E+T*M,e[4]=a*A+p*$+_*I,e[5]=l*A+f*$+b*I,e[6]=c*A+m*$+w*I,e[7]=h*A+y*$+T*I,e[8]=a*k+p*V+_*B,e[9]=l*k+f*V+b*B,e[10]=c*k+m*V+w*B,e[11]=h*k+y*V+T*B,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function rA(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*r,e[5]=o*s+h*r,e[6]=a*s+p*r,e[7]=l*s+f*r,e[8]=c*s-n*r,e[9]=h*s-o*r,e[10]=p*s-a*r,e[11]=f*s-l*r,e}function aU(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*r,e[1]=o*s-h*r,e[2]=a*s-p*r,e[3]=l*s-f*r,e[8]=n*r+c*s,e[9]=o*r+h*s,e[10]=a*r+p*s,e[11]=l*r+f*s,e}function sA(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*r,e[1]=o*s+h*r,e[2]=a*s+p*r,e[3]=l*s+f*r,e[4]=c*s-n*r,e[5]=h*s-o*r,e[6]=p*s-a*r,e[7]=f*s-l*r,e}function lU(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function hke(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function jh(e,t,i){if(t===0)return np(e);let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<vl()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*r,e[2]=l*o*n-a*r,e[3]=0,e[4]=o*a*n-l*r,e[5]=a*a*n+s,e[6]=l*a*n+o*r,e[7]=0,e[8]=o*l*n+a*r,e[9]=a*l*n-o*r,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function F_e(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dke(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N_e(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function k_e(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,c=n+n,h=r*a,p=r*l,f=r*c,m=s*l,y=s*c,_=n*c,b=o*a,w=o*l,T=o*c;return e[0]=1-(m+_),e[1]=p+T,e[2]=f-w,e[3]=0,e[4]=p-T,e[5]=1-(h+_),e[6]=y+b,e[7]=0,e[8]=f+w,e[9]=y-b,e[10]=1-(h+m),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function pke(e,t){const i=fke,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=r*r+s*s+n*n+o*o;return p>0?(i[0]=2*(a*o+h*r+l*n-c*s)/p,i[1]=2*(l*o+h*s+c*r-a*n)/p,i[2]=2*(c*o+h*n+a*s-l*r)/p):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),k_e(e,t,i),e}const fke=O();function mke(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function U_e(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function gke(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function yke(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,_=n*h,b=o*h,w=a*l,T=a*c,S=a*h,E=r[0],M=r[1],A=r[2];return e[0]=(1-(y+b))*E,e[1]=(f+S)*E,e[2]=(m-T)*E,e[3]=0,e[4]=(f-S)*M,e[5]=(1-(p+b))*M,e[6]=(_+w)*M,e[7]=0,e[8]=(m+T)*A,e[9]=(_-w)*A,e[10]=(1-(p+y))*A,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function _ke(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,_=o*h,b=o*p,w=a*p,T=l*c,S=l*h,E=l*p,M=r[0],A=r[1],$=r[2],I=s[0],k=s[1],V=s[2],B=(1-(_+w))*M,G=(m+E)*M,X=(y-S)*M,K=(m-E)*A,re=(1-(f+w))*A,q=(b+T)*A,L=(y+S)*$,N=(b-T)*$,U=(1-(f+_))*$;return e[0]=B,e[1]=G,e[2]=X,e[3]=0,e[4]=K,e[5]=re,e[6]=q,e[7]=0,e[8]=L,e[9]=N,e[10]=U,e[11]=0,e[12]=i[0]+I-(B*I+K*k+L*V),e[13]=i[1]+k-(G*I+re*k+N*V),e[14]=i[2]+V-(X*I+q*k+U*V),e[15]=1,e}function vke(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,_=n*o,b=n*a,w=n*l;return e[0]=1-p-y,e[1]=h+w,e[2]=f-b,e[3]=0,e[4]=h-w,e[5]=1-c-y,e[6]=m+_,e[7]=0,e[8]=f+b,e[9]=m-_,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function V_e(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function bke(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e}function wke(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function B_e(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*c,e[15]=1,e}function cU(e,t,i,r){let s,n,o,a,l,c,h,p,f,m;const y=t[0],_=t[1],b=t[2],w=r[0],T=r[1],S=r[2],E=i[0],M=i[1],A=i[2],$=vl();return Math.abs(y-E)<$&&Math.abs(_-M)<$&&Math.abs(b-A)<$?np(e):(h=y-E,p=_-M,f=b-A,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,s=T*f-S*p,n=S*h-w*f,o=w*p-T*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*y+n*_+o*b),e[13]=-(a*y+l*_+c*b),e[14]=-(h*y+p*_+f*b),e[15]=1,e)}function z_e(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],p=n-i[1],f=o-i[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,_=c*h-a*f,b=a*p-l*h;return m=y*y+_*_+b*b,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,b*=m),e[0]=y,e[1]=_,e[2]=b,e[3]=0,e[4]=p*b-f*_,e[5]=f*y-h*b,e[6]=h*_-p*y,e[7]=0,e[8]=h,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function xke(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Tke(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function Ske(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function G_e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function Eke(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function Cke(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function j_e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function BJ(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],b=e[14],w=e[15],T=t[0],S=t[1],E=t[2],M=t[3],A=t[4],$=t[5],I=t[6],k=t[7],V=t[8],B=t[9],G=t[10],X=t[11],K=t[12],re=t[13],q=t[14],L=t[15],N=vl();return Math.abs(i-T)<=N*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(r-S)<=N*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(s-E)<=N*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-M)<=N*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(o-A)<=N*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-$)<=N*Math.max(1,Math.abs(a),Math.abs($))&&Math.abs(l-I)<=N*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-k)<=N*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(h-V)<=N*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(p-B)<=N*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(f-G)<=N*Math.max(1,Math.abs(f),Math.abs(G))&&Math.abs(m-X)<=N*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(y-K)<=N*Math.max(1,Math.abs(y),Math.abs(K))&&Math.abs(_-re)<=N*Math.max(1,Math.abs(_),Math.abs(re))&&Math.abs(b-q)<=N*Math.max(1,Math.abs(b),Math.abs(q))&&Math.abs(w-L)<=N*Math.max(1,Math.abs(w),Math.abs(L))}function zJ(e){const t=vl(),i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}function uU(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[8]===0&&e[9]===0&&e[10]===1}const Ake=Hs,Mke=G_e;Object.freeze(Object.defineProperty({__proto__:null,add:Ske,adjoint:cke,copy:Ao,determinant:uke,equals:BJ,exactEquals:j_e,frob:Tke,fromQuat:vke,fromQuat2:pke,fromRotation:jh,fromRotationTranslation:k_e,fromRotationTranslationScale:yke,fromRotationTranslationScaleOrigin:_ke,fromScaling:hke,fromTranslation:lU,fromXRotation:F_e,fromYRotation:dke,fromZRotation:N_e,frustum:V_e,getRotation:gke,getScaling:U_e,getTranslation:mke,hasIdentityRotation:uU,identity:np,invert:Ea,invertOrIdentity:aM,isOrthoNormal:zJ,lookAt:cU,mul:Ake,multiply:Hs,multiplyScalar:Eke,multiplyScalarAndAdd:Cke,ortho:B_e,perspective:bke,perspectiveFromFieldOfView:wke,rotate:Cu,rotateX:rA,rotateY:aU,rotateZ:sA,scale:oU,set:Vg,str:xke,sub:Mke,subtract:G_e,targetTo:z_e,translate:Vc,transpose:Lu},Symbol.toStringTag,{value:"Module"}));const Rke=(e,t)=>{const i=Vg(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return Lu(i,i)},Oke=(e,t)=>{const i=Vg(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return Lu(i,i)},Ike=(e,t)=>{const i=1-t,r=Vg(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Lu(r,r)},Pke=(e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=Vg(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Lu(s,s)},$ke=(e,t)=>{const i=1-2*t,r=Vg(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return Lu(r,r)},Lke=(e,t)=>{const i=Vg(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return Lu(i,i)},Dke=(e,t)=>{const i=1-t,r=Vg(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Lu(r,r)};class hU{constructor(t,i,r){this.strength=t,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(t,i,r){this.strength=gu(t.strength,i.strength,r),this.radius=gu(t.radius,i.radius,r),this.threshold=gu(t.threshold,i.threshold,r)}clone(){return new hU(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:O3(this.radius),strength:this.strength,threshold:this.threshold}}}class dU{constructor(t){this.radius=t,this.type="blur"}interpolate(t,i,r){this.radius=Math.round(gu(t.radius,i.radius,r))}clone(){return new dU(this.radius)}toJSON(){return{type:"blur",radius:O3(this.radius)}}}class jI{constructor(t,i){this.type=t,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.amount=gu(t.amount,i.amount,r),this._updateMatrix()}clone(){return new jI(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||v$();switch(this.type){case"brightness":this._colorMatrix=Rke(t,this.amount);break;case"contrast":this._colorMatrix=Oke(t,this.amount);break;case"grayscale":this._colorMatrix=Ike(t,this.amount);break;case"invert":this._colorMatrix=$ke(t,this.amount);break;case"saturate":this._colorMatrix=Lke(t,this.amount);break;case"sepia":this._colorMatrix=Dke(t,this.amount)}}}class pU{constructor(t,i,r,s){this.offsetX=t,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(t,i,r){this.offsetX=gu(t.offsetX,i.offsetX,r),this.offsetY=gu(t.offsetY,i.offsetY,r),this.blurRadius=gu(t.blurRadius,i.blurRadius,r),this.color[0]=Math.round(gu(t.color[0],i.color[0],r)),this.color[1]=Math.round(gu(t.color[1],i.color[1],r)),this.color[2]=Math.round(gu(t.color[2],i.color[2],r)),this.color[3]=gu(t.color[3],i.color[3],r)}clone(){return new pU(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:O3(this.offsetX),yoffset:O3(this.offsetY),blurRadius:O3(this.blurRadius),color:t}}}class fU{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.angle=gu(t.angle,i.angle,r),this._updateMatrix()}clone(){return new fU(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||v$();this._colorMatrix=Pke(t,this.angle)}}class mU{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,i,r){this.amount=gu(t.amount,i.amount,r)}clone(){return new mU(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function gu(e,t,i){return e+(t-e)*i}function O3(e){return Math.round(1e3*Gh(e))/1e3}function Fke(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new jI(e.type,0);case"saturate":case"brightness":case"contrast":return new jI(e.type,1);case"opacity":return new mU(1);case"hue-rotate":return new fU(0);case"blur":return new dU(0);case"drop-shadow":return new pU(0,0,0,[...HY("transparent")]);case"bloom":return new hU(0,0,1)}}function Nke(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every((r,s)=>r.type===i[s].type)}function kke(e,t){const i=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let s=r.length;s<i.length;s++)r.push(Fke(i[s]))}function Uke(e){const t=e[0];return!!t&&"type"in t}var Hre,qre,hq={};function H_e(e){if(!e||e.length===0)return null;if(typeof e=="string"){const i=Wre(e);return i&&i.length!==0?i:null}const t=e.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new H("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Wre(i.value)}});t.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<t.length-1;i++){if(!Nke(t[i].effects,t[i+1].effects))throw new H("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[i].effects,b:t[i+1].effects});kke(t[i].effects,t[i+1].effects)}return t.sort((i,r)=>r.scale-i.scale),t}function Wre(e){let t;if(!e)return[];try{t=hq.parse(e)}catch(i){throw new H("effect:invalid-syntax","Invalid effect syntax",{value:e,error:i})}return t.map(i=>Vke(i))}function Vke(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Bke(e);case"opacity":return zke(e);case"hue-rotate":return Gke(e);case"blur":return jke(e);case"drop-shadow":return Hke(e);case"bloom":return qke(e)}}catch(t){throw t.details.filter=e,t}throw new H("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function Bke(e){let t=1;return lM(e.parameters,1),e.parameters.length===1&&(t=of(e.parameters[0])),new jI(e.name,t)}function zke(e){let t=1;return lM(e.parameters,1),e.parameters.length===1&&(t=of(e.parameters[0])),new mU(t)}function Gke(e){let t=0;return lM(e.parameters,1),e.parameters.length===1&&(t=Kke(e.parameters[0])),new fU(t)}function jke(e){let t=0;return lM(e.parameters,1),e.parameters.length===1&&(t=HJ(e.parameters[0]),b$(t,e.parameters[0])),new dU(t)}function Hke(e){const t=[];let i=null;for(const r of e.parameters)if(r.type==="color"){if(t.length&&Object.freeze(t),i)throw new H("effect:type-error","Accepts only one color",{});i=Qke(r)}else{const s=HJ(r);if(Object.isFrozen(t))throw new H("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&b$(s,r)}if(t.length<2||t.length>3)throw new H("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new pU(t[0],t[1],t[2]||0,i||q_e("black"))}function qke(e){let t=1,i=0,r=0;return lM(e.parameters,3),e.parameters[0]&&(t=of(e.parameters[0])),e.parameters[1]&&(i=HJ(e.parameters[1]),b$(i,e.parameters[1])),e.parameters[2]&&(r=of(e.parameters[2])),new hU(t,i,r)}function lM(e,t){if(e.length>t)throw new H("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function gU(e){if(e.type==="color")return"<color>";if(e.unit){if(jJ[e.unit])return"<length>";if(GJ[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function b$(e,t){if(e<0)throw new H("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function Wke(e){if(e.type!=="quantity"||e.unit!==null)throw new H("effect:type-error",`Expected <double>, Actual: ${gU(e)}`,{term:e})}function Xke(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new H("effect:type-error",`Expected <double> or <percentage>, Actual: ${gU(e)}`,{term:e})}qre=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:Xg},h=Xg,p="none",f=")",m=",",y="(",_="%",b="px",w="cm",T="mm",S="in",E="pt",M="pc",A="deg",$="rad",I="grad",k="turn",V="#",B=".",G="e",X=/^[ \t\n\r]/,K=/^[a-z\-]/,re=/^[0-9a-fA-F]/,q=/^[+\-]/,L=/^[0-9]/,N=Ql("none"),U=Ms("none",!1),W=Ms(")",!1),Z=Ms(",",!1),ie=Ql("whitespace"),Y=wb([" ","	",`
`,"\r"],!1,!1),ce=Ql("function"),pe=Ms("(",!1),ve=Ql("identifier"),Se=wb([["a","z"],"-"],!1,!1),We=Ql("percentage"),Ne=Ms("%",!1),xe=Ql("length"),ke=Ms("px",!1),Ve=Ms("cm",!1),Et=Ms("mm",!1),it=Ms("in",!1),Gt=Ms("pt",!1),Kt=Ms("pc",!1),ni=Ql("angle"),Qt=Ms("deg",!1),Ti=Ms("rad",!1),pr=Ms("grad",!1),Fi=Ms("turn",!1),Pi=Ql("number"),Ki=Ql("color"),$e=Ms("#",!1),qe=wb([["0","9"],["a","f"],["A","F"]],!1,!1),ft=wb(["+","-"],!1,!1),At=wb([["0","9"]],!1,!1),Xt=Ms(".",!1),rr=Ms("e",!1),$i=function(){return[]},Hi=function(J,we){return{type:"function",name:J,parameters:we||[]}},qi=function(J,we){return we.length>0?OM(J,we,3):[J]},Gr=function(J){return{type:"quantity",value:J.value,unit:J.unit}},oi=function(J){return{type:"color",colorType:J.type,value:J.value}},Si=function(J){return J},vi=function(){return Gc()},Ns=function(J){return{value:J,unit:"%"}},vr=function(J){return{value:J,unit:"px"}},fs=function(J){return{value:J,unit:"cm"}},Or=function(J){return{value:J,unit:"mm"}},rs=function(J){return{value:J,unit:"in"}},ks=function(J){return{value:J,unit:"pt"}},fn=function(J){return{value:J,unit:"pc"}},ia=function(J){return{value:J,unit:"deg"}},Oo=function(J){return{value:J,unit:"rad"}},Js=function(J){return{value:J,unit:"grad"}},ms=function(J){return{value:J,unit:"turn"}},gs=function(J){return{value:J,unit:null}},Ks=function(){return{type:"hex",value:Gc()}},br=function(J){return{type:"function",value:J}},Ia=function(){return{type:"named",value:Gc()}},Kl=function(){return parseFloat(Gc())},de=0,Lr=0,_p=[{line:1,column:1}],Ya=0,Vu=[],mt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function Gc(){return s.substring(Lr,de)}function Ms(J,we){return{type:"literal",text:J,ignoreCase:we}}function wb(J,we,Re){return{type:"class",parts:J,inverted:we,ignoreCase:Re}}function jV(){return{type:"end"}}function Ql(J){return{type:"other",description:J}}function a_(J){var we,Re=_p[J];if(Re)return Re;for(we=J-1;!_p[we];)we--;for(Re={line:(Re=_p[we]).line,column:Re.column};we<J;)s.charCodeAt(we)===10?(Re.line++,Re.column=1):Re.column++,we++;return _p[J]=Re,Re}function Wg(J,we){var Re=a_(J),bi=a_(we);return{source:l,start:{offset:J,line:Re.line,column:Re.column},end:{offset:we,line:bi.line,column:bi.column}}}function ai(J){de<Ya||(de>Ya&&(Ya=de,Vu=[]),Vu.push(J))}function sL(J,we,Re){return new t(t.buildMessage(J,we),J,we,Re)}function Xg(){var J;return(J=l_())===a&&(J=c_()),J}function l_(){var J,we;return mt++,J=de,wr(),s.substr(de,4)===p?(we=p,de+=4):(we=a,mt===0&&ai(U)),we!==a?(wr(),Lr=J,J=$i()):(de=J,J=a),mt--,J===a&&mt===0&&ai(N),J}function c_(){var J,we;if(J=[],(we=Pa())!==a)for(;we!==a;)J.push(we),we=Pa();else J=a;return J}function Pa(){var J,we,Re,bi;return J=de,wr(),(we=Yf())!==a?(wr(),(Re=Jh())===a&&(Re=null),wr(),s.charCodeAt(de)===41?(bi=f,de++):(bi=a,mt===0&&ai(W)),bi!==a?(wr(),Lr=J,J=Hi(we,Re)):(de=J,J=a)):(de=J,J=a),J}function Jh(){var J,we,Re,bi,Io,Qs,tc,h_;if(J=de,(we=Kh())!==a){for(Re=[],bi=de,Io=wr(),s.charCodeAt(de)===44?(Qs=m,de++):(Qs=a,mt===0&&ai(Z)),Qs===a&&(Qs=null),tc=wr(),(h_=Kh())!==a?bi=Io=[Io,Qs,tc,h_]:(de=bi,bi=a);bi!==a;)Re.push(bi),bi=de,Io=wr(),s.charCodeAt(de)===44?(Qs=m,de++):(Qs=a,mt===0&&ai(Z)),Qs===a&&(Qs=null),tc=wr(),(h_=Kh())!==a?bi=Io=[Io,Qs,tc,h_]:(de=bi,bi=a);Lr=J,J=qi(we,Re)}else de=J,J=a;return J}function Kh(){var J,we;return J=de,(we=dS())===a&&(we=xb())===a&&(we=pS())===a&&(we=Tb()),we!==a&&(Lr=J,we=Gr(we)),(J=we)===a&&(J=de,(we=u_())!==a&&(Lr=J,we=oi(we)),J=we),J}function wr(){var J,we;for(mt++,J=[],X.test(s.charAt(de))?(we=s.charAt(de),de++):(we=a,mt===0&&ai(Y));we!==a;)J.push(we),X.test(s.charAt(de))?(we=s.charAt(de),de++):(we=a,mt===0&&ai(Y));return mt--,we=a,mt===0&&ai(ie),J}function Yf(){var J,we,Re;return mt++,J=de,(we=Yg())!==a?(s.charCodeAt(de)===40?(Re=y,de++):(Re=a,mt===0&&ai(pe)),Re!==a?(Lr=J,J=Si(we)):(de=J,J=a)):(de=J,J=a),mt--,J===a&&(we=a,mt===0&&ai(ce)),J}function Yg(){var J,we,Re;if(mt++,J=de,we=[],K.test(s.charAt(de))?(Re=s.charAt(de),de++):(Re=a,mt===0&&ai(Se)),Re!==a)for(;Re!==a;)we.push(Re),K.test(s.charAt(de))?(Re=s.charAt(de),de++):(Re=a,mt===0&&ai(Se));else we=a;return we!==a&&(Lr=J,we=vi()),mt--,(J=we)===a&&(we=a,mt===0&&ai(ve)),J}function dS(){var J,we,Re;return mt++,J=de,wr(),(we=ec())!==a?(s.charCodeAt(de)===37?(Re=_,de++):(Re=a,mt===0&&ai(Ne)),Re!==a?(Lr=J,J=Ns(we)):(de=J,J=a)):(de=J,J=a),mt--,J===a&&mt===0&&ai(We),J}function xb(){var J,we,Re;return mt++,J=de,wr(),(we=ec())!==a?(s.substr(de,2)===b?(Re=b,de+=2):(Re=a,mt===0&&ai(ke)),Re!==a?(Lr=J,J=vr(we)):(de=J,J=a)):(de=J,J=a),J===a&&(J=de,wr(),(we=ec())!==a?(s.substr(de,2)===w?(Re=w,de+=2):(Re=a,mt===0&&ai(Ve)),Re!==a?(Lr=J,J=fs(we)):(de=J,J=a)):(de=J,J=a),J===a&&(J=de,wr(),(we=ec())!==a?(s.substr(de,2)===T?(Re=T,de+=2):(Re=a,mt===0&&ai(Et)),Re!==a?(Lr=J,J=Or(we)):(de=J,J=a)):(de=J,J=a),J===a&&(J=de,wr(),(we=ec())!==a?(s.substr(de,2)===S?(Re=S,de+=2):(Re=a,mt===0&&ai(it)),Re!==a?(Lr=J,J=rs(we)):(de=J,J=a)):(de=J,J=a),J===a&&(J=de,wr(),(we=ec())!==a?(s.substr(de,2)===E?(Re=E,de+=2):(Re=a,mt===0&&ai(Gt)),Re!==a?(Lr=J,J=ks(we)):(de=J,J=a)):(de=J,J=a),J===a&&(J=de,wr(),(we=ec())!==a?(s.substr(de,2)===M?(Re=M,de+=2):(Re=a,mt===0&&ai(Kt)),Re!==a?(Lr=J,J=fn(we)):(de=J,J=a)):(de=J,J=a)))))),mt--,J===a&&mt===0&&ai(xe),J}function pS(){var J,we,Re;return mt++,J=de,(we=ec())!==a?(s.substr(de,3)===A?(Re=A,de+=3):(Re=a,mt===0&&ai(Qt)),Re!==a?(Lr=J,J=ia(we)):(de=J,J=a)):(de=J,J=a),J===a&&(J=de,(we=ec())!==a?(s.substr(de,3)===$?(Re=$,de+=3):(Re=a,mt===0&&ai(Ti)),Re!==a?(Lr=J,J=Oo(we)):(de=J,J=a)):(de=J,J=a),J===a&&(J=de,(we=ec())!==a?(s.substr(de,4)===I?(Re=I,de+=4):(Re=a,mt===0&&ai(pr)),Re!==a?(Lr=J,J=Js(we)):(de=J,J=a)):(de=J,J=a),J===a&&(J=de,(we=ec())!==a?(s.substr(de,4)===k?(Re=k,de+=4):(Re=a,mt===0&&ai(Fi)),Re!==a?(Lr=J,J=ms(we)):(de=J,J=a)):(de=J,J=a)))),mt--,J===a&&(we=a,mt===0&&ai(ni)),J}function Tb(){var J,we;return mt++,J=de,wr(),(we=ec())!==a?(Lr=J,J=gs(we)):(de=J,J=a),mt--,J===a&&mt===0&&ai(Pi),J}function u_(){var J,we,Re,bi;if(mt++,J=de,s.charCodeAt(de)===35?(we=V,de++):(we=a,mt===0&&ai($e)),we!==a){if(Re=[],re.test(s.charAt(de))?(bi=s.charAt(de),de++):(bi=a,mt===0&&ai(qe)),bi!==a)for(;bi!==a;)Re.push(bi),re.test(s.charAt(de))?(bi=s.charAt(de),de++):(bi=a,mt===0&&ai(qe));else Re=a;Re!==a?(Lr=J,J=Ks()):(de=J,J=a)}else de=J,J=a;return J===a&&(J=de,(we=Pa())!==a&&(Lr=J,we=br(we)),(J=we)===a&&(J=de,(we=Yg())!==a&&(Lr=J,we=Ia()),J=we)),mt--,J===a&&(we=a,mt===0&&ai(Ki)),J}function ec(){var J,we,Re,bi,Io,Qs,tc;for(J=de,q.test(s.charAt(de))?(s.charAt(de),de++):mt===0&&ai(ft),we=de,Re=[],L.test(s.charAt(de))?(bi=s.charAt(de),de++):(bi=a,mt===0&&ai(At));bi!==a;)Re.push(bi),L.test(s.charAt(de))?(bi=s.charAt(de),de++):(bi=a,mt===0&&ai(At));if(s.charCodeAt(de)===46?(bi=B,de++):(bi=a,mt===0&&ai(Xt)),bi!==a){if(Io=[],L.test(s.charAt(de))?(Qs=s.charAt(de),de++):(Qs=a,mt===0&&ai(At)),Qs!==a)for(;Qs!==a;)Io.push(Qs),L.test(s.charAt(de))?(Qs=s.charAt(de),de++):(Qs=a,mt===0&&ai(At));else Io=a;Io!==a?we=Re=[Re,bi,Io]:(de=we,we=a)}else de=we,we=a;if(we===a)if(we=[],L.test(s.charAt(de))?(Re=s.charAt(de),de++):(Re=a,mt===0&&ai(At)),Re!==a)for(;Re!==a;)we.push(Re),L.test(s.charAt(de))?(Re=s.charAt(de),de++):(Re=a,mt===0&&ai(At));else we=a;if(we!==a){if(Re=de,s.charCodeAt(de)===101?(bi=G,de++):(bi=a,mt===0&&ai(rr)),bi!==a){if(q.test(s.charAt(de))?(Io=s.charAt(de),de++):(Io=a,mt===0&&ai(ft)),Io===a&&(Io=null),Qs=[],L.test(s.charAt(de))?(tc=s.charAt(de),de++):(tc=a,mt===0&&ai(At)),tc!==a)for(;tc!==a;)Qs.push(tc),L.test(s.charAt(de))?(tc=s.charAt(de),de++):(tc=a,mt===0&&ai(At));else Qs=a;Qs!==a?Re=bi=[bi,Io,Qs]:(de=Re,Re=a)}else de=Re,Re=a;Re===a&&(Re=null),Lr=J,J=Kl()}else de=J,J=a;return J}function nL(J,we){return J.map(function(Re){return Re[we]})}function OM(J,we,Re){return[J].concat(nL(we,Re))}if((o=h())!==a&&de===s.length)return o;throw o!==a&&de<s.length&&ai(jV()),sL(Vu,Ya<s.length?s.charAt(Ya):null,Ya<s.length?Wg(Ya,Ya+1):Wg(Ya,Ya))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length," "),f=a[l.line-1],m=(l.line===h.line?h.column:f.length+1)-l.column||1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1," ")+i("",m,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,_,b=m.map(h);if(b.sort(),b.length>0){for(y=1,_=1;y<b.length;y++)b[y-1]!==b[y]&&(b[_]=b[y],_++);b.length=_}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:r}},(Hre={get exports(){return hq},set exports(e){hq=e}}).exports&&(Hre.exports=qre());const GJ={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Yke(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&GJ[e.unit]!=null))throw new H("effect:type-error",`Expected <angle>, Actual: ${gU(e)}`,{term:e})}const jJ={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Zke(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&jJ[e.unit]!=null))throw new H("effect:type-error",`Expected <length>, Actual: ${gU(e)}`,{term:e})}function of(e){Xke(e);const t=e.value;return b$(t,e),e.unit==="%"?.01*t:t}function Jke(e){return Wke(e),b$(e.value,e),e.value}function Kke(e){return Yke(e),e.value*GJ[e.unit]||0}function HJ(e){return Zke(e),e.value*jJ[e.unit]||0}function Qke(e){switch(e.colorType){case"hex":return v3e(e.value);case"named":return q_e(e.value);case"function":return i6e(e.value)}}function q_e(e){if(!Hfe(e))throw new H("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return _3e(e)}const e6e=/^rgba?/i,t6e=/^hsla?/i;function i6e(e){if(lM(e.parameters,4),e6e.test(e.name))return[of(e.parameters[0]),of(e.parameters[1]),of(e.parameters[2]),e.parameters[3]?of(e.parameters[3]):1];if(t6e.test(e.name))return qfe(Jke(e.parameters[0]),of(e.parameters[1]),of(e.parameters[2]),e.parameters[3]?of(e.parameters[3]):1);throw new H("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function qJ(e,t,i){var r;try{return s6e(e)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function WJ(e,t,i,r){try{const s=r6e(e);Sa(i,s,t)}catch(s){r.messages&&r.messages.push(s)}}function r6e(e){const t=H_e(e);return t?Uke(t)?t.map(i=>i.toJSON()):t.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function s6e(e){if(!e||e.length===0)return null;if(n6e(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:dq(i.value)});return t}return dq(e)}function n6e(e){const t=e[0];return!!t&&"scale"in t}function dq(e){if(!e||!e.length)return"";const t=[];for(const i of e){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Zg(i,"amount")];break;case"blur":r=[Zg(i,"radius","pt")];break;case"hue-rotate":r=[Zg(i,"angle","deg")];break;case"drop-shadow":r=[Zg(i,"xoffset","pt"),Zg(i,"yoffset","pt"),Zg(i,"blurRadius","pt"),o6e(i,"color")];break;case"bloom":r=[Zg(i,"strength"),Zg(i,"radius","pt"),Zg(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;H_e(s),t.push(s)}return t.join(" ")}function Zg(e,t,i){if(e[t]==null)throw new H("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function o6e(e,t){if(e[t]==null)throw new H("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const Xre={read:{reader:qJ},write:{allowNull:!0,writer:WJ}},W_e=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":Xre,"portal-item":Xre}}})],t.prototype,"effect",void 0),t=u([P("esri.layers.mixins.BlendLayer")],t),t},a6e=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([P("esri.layers.mixins.CustomParametersMixin")],t),t},l6e=new ps.EventEmitter,X_e="esri.layers.mixins.EditBusLayer",Y_e=Symbol(X_e);function EMt(e){return e!=null&&typeof e=="object"&&Y_e in e}const c6e=e=>{var t;let i=class extends e{constructor(...r){super(...r),this[t]=!0,this.when().then(()=>{this.own([l6e.on("edits",s=>{var h,p,f;const n="layer"in s?s.layer:null,o="layer"in s?(h=s.layer)==null?void 0:h.url:s.serviceUrl,a="layer"in s?(p=s.layer)==null?void 0:p.layerId:s.layerId,l=s.event;if(n===this||o!==this.url)return;if(a!=null&&this.layerId!=null&&a===this.layerId)return void this.emit("edits",ne(l));const c=(f=l.editedFeatures)==null?void 0:f.find(({layerId:m})=>m===this.layerId);if(c){const{adds:m,updates:y,deletes:_}=c.editedFeatures,b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:m?m.map(({attributes:w})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],deletedFeatures:_?_.map(({attributes:w})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],updatedFeatures:y?y.map(({current:{attributes:w}})=>({objectId:this.objectIdField&&w[this.objectIdField],globalId:this.globalIdField&&w[this.globalIdField]})):[],editedFeatures:ne(l.editedFeatures),exceededTransferLimit:!1};this.emit("edits",b)}})])},()=>{})}};return t=Y_e,i=u([P(X_e)],i),i},Yre={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},u6e={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function h6e(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}function m0(e,t,i){const r=new Date(e.getTime());if(t&&i){const s=u6e[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=h6e(r.getFullYear(),r.getMonth()+t);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+t*a)}return r}function pq(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function d6e(e,t,i){return e===0?0:e*Yre[t]/Yre[i]}var zp;let ph=zp=class extends ge{static get allTime(){return Zre}static get empty(){return p6e}constructor(e){super(e),this.end=null,this.start=null}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(zp.allTime)}get isEmpty(){return this.equals(zp.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new zp({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=v(this.start)?this.start.getTime():this.start,i=v(this.end)?this.end.getTime():this.end,r=v(e.start)?e.start.getTime():e.start,s=v(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=Mn(this.start,r=>pq(r,e)),i=Mn(this.end,r=>{const s=pq(r,e);return r.getTime()===s.getTime()?s:m0(s,1,e)});return new zp({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return zp.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=Sh(this.start,-1/0,a=>a.getTime()),i=Sh(this.end,1/0,a=>a.getTime()),r=Sh(e.start,-1/0,a=>a.getTime()),s=Sh(e.end,1/0,a=>a.getTime());let n,o;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?o=i:s>=t&&s<=i&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new zp;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return zp.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new zp,{start:r,end:s}=this;return v(r)&&(i.start=m0(r,e,t)),v(s)&&(i.end=m0(s,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return Zre.clone();const t=v(this.start)&&v(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=v(this.end)&&v(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new zp({start:t,end:i})}};u([d({type:Date,json:{write:{allowNull:!0}}})],ph.prototype,"end",void 0),u([Fe("end")],ph.prototype,"readEnd",null),u([Ge("end")],ph.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],ph.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],ph.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],ph.prototype,"start",void 0),u([Fe("start")],ph.prototype,"readStart",null),u([Ge("start")],ph.prototype,"writeStart",null),ph=zp=u([P("esri.TimeExtent")],ph);const Zre=new ph,p6e=new ph({start:void 0,end:void 0}),Ts=ph;var fq;let G2=fq=class extends ge{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new fq({mapLayerId:e,gdbVersion:t})}};u([bt({mapLayer:"map-layer"})],G2.prototype,"type",void 0),u([d({type:us,json:{write:!0}})],G2.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],G2.prototype,"gdbVersion",void 0),G2=fq=u([P("esri.layers.support.source.MapLayerSource")],G2);var mq;let Oy=mq=class extends ge{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:i,spatialReference:(o=r==null?void 0:r.clone())!=null?o:void 0,geometryType:s};return new mq(n)}};u([bt({queryTable:"query-table"})],Oy.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Oy.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Oy.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],Oy.prototype,"oidFields",void 0),u([d({type:et,json:{write:!0}})],Oy.prototype,"spatialReference",void 0),u([bt(Wge)],Oy.prototype,"geometryType",void 0),Oy=mq=u([P("esri.layers.support.source.QueryTableDataSource")],Oy);var gq;let j2=gq=class extends ge{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new gq({workspaceId:e,dataSourceName:t})}};u([bt({raster:"raster"})],j2.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],j2.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],j2.prototype,"workspaceId",void 0),j2=gq=u([P("esri.layers.support.source.RasterDataSource")],j2);var yq;let kw=yq=class extends ge{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new yq({workspaceId:e,gdbVersion:t,dataSourceName:i})}};u([bt({table:"table"})],kw.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],kw.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],kw.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],kw.prototype,"dataSourceName",void 0),kw=yq=u([P("esri.layers.support.source.TableDataSource")],kw);var _q,vq;const f6e=bl()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let eh=_q=class extends ge{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return Jre()(e,t,i)}castLeftTableSource(e){return Lf(bq(),e)}readRightTableSource(e,t,i){return Jre()(e,t,i)}castRightTableSource(e){return Lf(bq(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=i==null?void 0:i.clone())!=null?o:void 0,rightTableSource:(a=r==null?void 0:r.clone())!=null?a:void 0,joinType:s};return new _q(n)}};u([bt({joinTable:"join-table"})],eh.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],eh.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],eh.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],eh.prototype,"leftTableSource",void 0),u([Fe("leftTableSource")],eh.prototype,"readLeftTableSource",null),u([Zt("leftTableSource")],eh.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],eh.prototype,"rightTableSource",void 0),u([Fe("rightTableSource")],eh.prototype,"readRightTableSource",null),u([Zt("rightTableSource")],eh.prototype,"castRightTableSource",null),u([bt(f6e)],eh.prototype,"joinType",void 0),eh=_q=u([P("esri.layers.support.source.JoinTableDataSource")],eh);let S9=null;function Jre(){return S9||(S9=ub({types:bq()})),S9}let E9=null;function bq(){return E9||(E9={key:"type",base:null,typeMap:{"data-layer":af,"map-layer":G2}}),E9}const m6e={key:"type",base:null,typeMap:{"join-table":eh,"query-table":Oy,raster:j2,table:kw}};let af=vq=class extends ge{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new vq({fields:e,dataSource:t})}};u([bt({dataLayer:"data-layer"})],af.prototype,"type",void 0),u([d({type:[nU],json:{write:!0}})],af.prototype,"fields",void 0),u([d({types:m6e,json:{write:!0}})],af.prototype,"dataSource",void 0),af=vq=u([P("esri.layers.support.source.DataLayerSource")],af),af.from=zr(af);let Uw=class extends Ys(ge){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([d({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.onFields)&&this.onFields.length>0}}}}})],Uw.prototype,"onFields",void 0),u([d({type:String,json:{write:!0}})],Uw.prototype,"operator",void 0),u([d({type:String,json:{write:!0}})],Uw.prototype,"searchTerm",void 0),u([d({type:String,json:{write:!0}})],Uw.prototype,"searchType",void 0),Uw=u([P("esri.rest.support.FullTextSearch")],Uw);const Z_e=Uw;var wq;const Kre=new _i({upperLeft:"upper-left",lowerLeft:"lower-left"});let Vw=wq=class extends ge{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new wq(ne({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:Gi,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Vw.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],Vw.prototype,"mode",void 0),u([d({type:String,json:{read:Kre.read,write:Kre.write}})],Vw.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Vw.prototype,"tolerance",void 0),Vw=wq=u([P("esri.rest.support.QuantizationParameters")],Vw);const g6e=Vw;var xq;const Qre=new _i({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Gp=xq=class extends ge{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=ne(e))}clone(){return new xq({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ne(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],Gp.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],Gp.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],Gp.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],Gp.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],Gp.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:Qre.read},write:{target:"statisticType",writer:Qre.write}}})],Gp.prototype,"statisticType",void 0),u([d({type:Object})],Gp.prototype,"statisticParameters",void 0),u([Ge("statisticParameters")],Gp.prototype,"writeStatisticParameters",null),Gp=xq=u([P("esri.rest.support.StatisticDefinition")],Gp);const J_e=Gp;var hC;const y6e=new _i({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),_6e=new _i({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let qt=hC=class extends ge{static from(e){return VC(hC,e)}constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new hC(ne({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:v(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};qt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],qt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],qt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],qt.prototype,"datumTransformation",void 0),u([Zt("datumTransformation")],qt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],qt.prototype,"distance",void 0),u([d({type:af,json:{write:!0}})],qt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"formatOf3DObjects",void 0),u([d({type:[Z_e],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.fullText)&&this.fullText.length>0}}}}})],qt.prototype,"fullText",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"gdbVersion",void 0),u([d({types:ZT,json:{read:Jl,write:!0}})],qt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],qt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],qt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"having",void 0),u([d({type:Date})],qt.prototype,"historicMoment",void 0),u([Ge("historicMoment")],qt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],qt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:e=>e<1?1:e>hC.MAX_MAX_RECORD_COUNT_FACTOR?hC.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],qt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],qt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],qt.prototype,"num",void 0),u([d({json:{write:!0}})],qt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],qt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],qt.prototype,"outFields",void 0),u([d({type:et,json:{name:"outSR",write:!0}})],qt.prototype,"outSpatialReference",void 0),u([d({type:[J_e],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.outStatistics)&&this.outStatistics.length>0}}}}})],qt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],qt.prototype,"parameterValues",void 0),u([Ge("parameterValues")],qt.prototype,"writeParameterValues",null),u([d({type:ut,json:{write:!0}})],qt.prototype,"pixelSize",void 0),u([d({type:g6e,json:{write:!0}})],qt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],qt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],qt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],qt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],qt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],qt.prototype,"returnZ",void 0),u([d({type:et,json:{write:!0}})],qt.prototype,"sourceSpatialReference",void 0),u([bt(y6e,{ignoreUnknown:!1,name:"spatialRel"})],qt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],qt.prototype,"start",void 0),u([Ge("start"),Ge("num")],qt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],qt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],qt.prototype,"text",void 0),u([d({type:Ts,json:{write:!0}})],qt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"timeReferenceUnknownClient",void 0),u([bt(_6e,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(e){return{enabled:!!e&&this.distance!=null&&this.distance>0}}}}})],qt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start!=null&&this.start>0}}}}})],qt.prototype,"where",void 0),u([Ge("where")],qt.prototype,"writeWhere",null),qt=hC=u([P("esri.rest.support.Query")],qt);const mg=qt;var Tq;const C9=new _i({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),A9=new _i({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Sm=Tq=class extends ge{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new mg({geometry:ne(i),objectIds:ne(n),spatialRelationship:r,timeExtent:ne(s),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new Tq({geometry:ne(t),objectIds:ne(s),spatialRelationship:i,timeExtent:ne(r),where:e,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],Sm.prototype,"where",void 0),u([d({types:ZT,json:{write:!0}})],Sm.prototype,"geometry",void 0),u([d({type:C9.apiValues,json:{name:"spatialRel",read:{reader:C9.read},write:{allowNull:!1,writer:C9.write,overridePolicy(){return{enabled:v(this.geometry)}}}}})],Sm.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Sm.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],Sm.prototype,"objectIds",void 0),u([d({type:A9.apiValues,json:{read:A9.read,write:{writer:A9.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Sm.prototype,"units",void 0),u([d({type:Ts,json:{write:!0}})],Sm.prototype,"timeExtent",void 0),Sm=Tq=u([P("esri.layers.support.FeatureFilter")],Sm);const v6e=Sm;var Sq;const ese={read:{reader:qJ},write:{writer:WJ,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},tse={read:{reader:qJ},write:{writer:WJ,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},ise={name:"showExcludedLabels",default:!0};let Bw=Sq=class extends ge{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var r,s;const i=super.write(e,t);if(t!=null&&t.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=t.messages)==null||r.push(new H("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=t.messages)==null||s.push(new H("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new Sq({filter:v(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:v6e,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e==null?void 0:e.write({},r);s&&Object.keys(s).length!==0?Sa(i,s,t):Sa(i,null,t)}}}})],Bw.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":ese,"portal-item":ese}}})],Bw.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":tse,"portal-item":tse}}})],Bw.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":ise,"portal-item":ise}}})],Bw.prototype,"excludedLabelsVisible",void 0),Bw=Sq=u([P("esri.layers.support.FeatureEffect")],Bw);const b6e=Bw,rse={write:{allowNull:!0}},w6e=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:b6e,json:{origins:{"web-map":rse,"portal-item":rse}}})],t.prototype,"featureEffect",void 0),t=u([P("esri.layers.mixins.FeatureEffectLayer")],t),t};var SO;const $5=bl()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),K_e=$5.jsonValues.slice();xI(K_e,"orthometric");const I3=bl()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let jp=SO=class extends ge{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return $5.write(e,t,i)}readHeightModel(e,t,i){return $5.read(e)||(i&&i.messages&&i.messages.push(x6e(e,{context:i})),null)}readHeightUnit(e,t,i){return I3.read(e)||(i&&i.messages&&i.messages.push(sse(e,{context:i})),null)}readHeightUnitService(e,t,i){return xge(e)||I3.read(e)||(i&&i.messages&&i.messages.push(sse(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new SO({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=x$e(t);return new SO({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new SO;return t.read(e,{origin:"web-scene"}),t}};function sse(e,t){return new Bh("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function x6e(e,t){return new Bh("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([d({type:$5.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:K_e,default:"ellipsoidal"}}}})],jp.prototype,"heightModel",void 0),u([Ge("web-scene","heightModel")],jp.prototype,"writeHeightModel",null),u([Fe(["web-scene","service"],"heightModel")],jp.prototype,"readHeightModel",null),u([d({type:I3.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:I3.jsonValues,write:I3.write}}}})],jp.prototype,"heightUnit",void 0),u([Fe("web-scene","heightUnit")],jp.prototype,"readHeightUnit",null),u([Fe("service","heightUnit")],jp.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],jp.prototype,"vertCRS",void 0),u([Fe("service","vertCRS",["vertCRS","ellipsoid","geoid"])],jp.prototype,"readVertCRS",null),jp=SO=u([P("esri.geometry.HeightModelInfo")],jp);const cM=jp;function T6e(e){return e.timeInfo!==void 0}async function CMt(e,t){var c;if(e.length===0)return Ts.allTime;const i=e.filter(T6e);await Promise.all(i.map(h=>h.load({signal:t})));const r=[],s=[];for(const h of i)(h==null?void 0:h.type)!=="feature"&&(h==null?void 0:h.type)!=="map-image"||!((c=h.timeInfo)!=null&&c.hasLiveData)?s.push(h):r.push(h);const n=h=>C(h)||h.isAllTime,o=s.map(h=>{var p;return(p=h.timeInfo)==null?void 0:p.fullTimeExtent});if(o.some(n))return Ts.allTime;const a=r.map(async h=>{var f;const{timeExtent:p}=await h.fetchRecomputedExtents({signal:t});return p||((f=h.timeInfo)==null?void 0:f.fullTimeExtent)}),l=(await Eo(a)).map(h=>h.value);return l.some(n)?Ts.allTime:[...l,...o].filter(v).reduce((h,p)=>h.union(p))}function S6e(e){if(!e)return e;const{start:t,end:i}=e;return new Ts({start:v(t)?m0(t,-t.getTimezoneOffset(),"minutes"):t,end:v(i)?m0(i,-i.getTimezoneOffset(),"minutes"):i})}function E6e(e){if(!e)return e;const{start:t,end:i}=e;return new Ts({start:v(t)?m0(t,t.getTimezoneOffset(),"minutes"):t,end:v(i)?m0(i,i.getTimezoneOffset(),"minutes"):i})}var Eq;let EO=Eq=class extends ge{constructor(e){super(e)}async collectRequiredFields(e,t){return Uc(e,t,this.expression)}clone(){return new Eq({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([d({type:String,json:{write:!0}})],EO.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],EO.prototype,"title",void 0),EO=Eq=u([P("esri.layers.support.FeatureExpressionInfo")],EO);const nse=EO;function C6e(e){return!!e&&eA[e]!=null}function A6e(e){return 1/(eA[e]||1)}function M6e(){const e=Object.keys(eA);return e.sort(),e}const R6e=M6e();var Cq;const OL=bl()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),ose=new _i({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Iy=Cq=class extends ge{constructor(e){super(e),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):v(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new Cq({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&b3e(this.featureExpressionInfo,e.featureExpressionInfo)}};u([d({type:nse,json:{write:!0}})],Iy.prototype,"featureExpressionInfo",void 0),u([Fe("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Iy.prototype,"readFeatureExpressionInfo",null),u([Ge("featureExpressionInfo",{featureExpressionInfo:{type:nse},"featureExpression.value":{type:[0]}})],Iy.prototype,"writeFeatureExpressionInfo",null),u([d({type:OL.apiValues,nonNullable:!0,json:{type:OL.jsonValues,read:OL.read,write:{writer:OL.write,isRequired:!0}}})],Iy.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],Iy.prototype,"offset",void 0),u([d({type:R6e,json:{type:String,read:ose.read,write:ose.write}})],Iy.prototype,"unit",null),Iy=Cq=u([P("esri.layers.support.ElevationInfo")],Iy);const O6e=Iy,I6e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},XJ={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},YJ={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},P6e={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:G1}}},$6e={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},L6e={value:null,type:O6e,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function AMt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const Q_e={write:!0,read:!0},Aq={type:Number,json:{origins:{"web-document":Q_e,"portal-item":{write:!0}}}},D6e={...Aq,json:{...Aq.json,origins:{"web-document":{...Q_e,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&i.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?LI(t.layerDefinition.drawingInfo.transparency):void 0:LI(t.drawingInfo.transparency)}}},MMt={type:Ts,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=E6e(s));let n=i?r&&s?r.intersection(s):r||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=S6e(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},RMt={type:Gi,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=Gi.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(i.spatialReference=et.fromJSON(t.spatialReference)),i}}}},read:!1}},F6e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},N6e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},k6e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},eve={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},ase=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Chihuahua"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class sS extends Error{}class U6e extends sS{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class V6e extends sS{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class B6e extends sS{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class CO extends sS{}class tve extends sS{constructor(t){super(`Invalid unit ${t}`)}}class Nd extends sS{}class __ extends sS{constructor(){super("Zone is an abstract class")}}const ot="numeric",Nf="short",kh="long",L5={year:ot,month:ot,day:ot},ive={year:ot,month:Nf,day:ot},z6e={year:ot,month:Nf,day:ot,weekday:Nf},rve={year:ot,month:kh,day:ot},sve={year:ot,month:kh,day:ot,weekday:kh},nve={hour:ot,minute:ot},ove={hour:ot,minute:ot,second:ot},ave={hour:ot,minute:ot,second:ot,timeZoneName:Nf},lve={hour:ot,minute:ot,second:ot,timeZoneName:kh},cve={hour:ot,minute:ot,hourCycle:"h23"},uve={hour:ot,minute:ot,second:ot,hourCycle:"h23"},hve={hour:ot,minute:ot,second:ot,hourCycle:"h23",timeZoneName:Nf},dve={hour:ot,minute:ot,second:ot,hourCycle:"h23",timeZoneName:kh},pve={year:ot,month:ot,day:ot,hour:ot,minute:ot},fve={year:ot,month:ot,day:ot,hour:ot,minute:ot,second:ot},mve={year:ot,month:Nf,day:ot,hour:ot,minute:ot},gve={year:ot,month:Nf,day:ot,hour:ot,minute:ot,second:ot},G6e={year:ot,month:Nf,day:ot,weekday:Nf,hour:ot,minute:ot},yve={year:ot,month:kh,day:ot,hour:ot,minute:ot,timeZoneName:Nf},_ve={year:ot,month:kh,day:ot,hour:ot,minute:ot,second:ot,timeZoneName:Nf},vve={year:ot,month:kh,day:ot,weekday:kh,hour:ot,minute:ot,timeZoneName:kh},bve={year:ot,month:kh,day:ot,weekday:kh,hour:ot,minute:ot,second:ot,timeZoneName:kh};class w${get type(){throw new __}get name(){throw new __}get ianaName(){return this.name}get isUniversal(){throw new __}offsetName(t,i){throw new __}formatOffset(t,i){throw new __}offset(t){throw new __}equals(t){throw new __}get isValid(){throw new __}}let M9=null;class yU extends w${static get instance(){return M9===null&&(M9=new yU),M9}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return xve(t,i,r)}formatOffset(t,i){return $3(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let YN={};function j6e(e){return YN[e]||(YN[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),YN[e]}const H6e={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function q6e(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function W6e(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=H6e[n];n==="era"?r[a]=o:Pr(a)||(r[a]=parseInt(o,10))}return r}let IL={};class P0 extends w${static create(t){return IL[t]||(IL[t]=new P0(t)),IL[t]}static resetCache(){IL={},YN={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=P0.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return xve(t,i,r,this.name)}formatOffset(t,i){return $3(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=j6e(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?W6e(r,i):q6e(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=KJ({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let lse={};function X6e(e,t={}){const i=JSON.stringify([e,t]);let r=lse[i];return r||(r=new Intl.ListFormat(e,t),lse[i]=r),r}let Mq={};function Rq(e,t={}){const i=JSON.stringify([e,t]);let r=Mq[i];return r||(r=new Intl.DateTimeFormat(e,t),Mq[i]=r),r}let Oq={};function Y6e(e,t={}){const i=JSON.stringify([e,t]);let r=Oq[i];return r||(r=new Intl.NumberFormat(e,t),Oq[i]=r),r}let Iq={};function Z6e(e,t={}){const{base:i,...r}=t,s=JSON.stringify([e,r]);let n=Iq[s];return n||(n=new Intl.RelativeTimeFormat(e,t),Iq[s]=n),n}let AO=null;function J6e(){return AO||(AO=new Intl.DateTimeFormat().resolvedOptions().locale,AO)}function K6e(e){const t=e.indexOf("-x-");t!==-1&&(e=e.substring(0,t));const i=e.indexOf("-u-");if(i===-1)return[e];{let r,s;try{r=Rq(e).resolvedOptions(),s=e}catch{const l=e.substring(0,i);r=Rq(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function Q6e(e,t,i){return(i||t)&&(e.includes("-u-")||(e+="-u"),i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function eUe(e){const t=[];for(let i=1;i<=12;i++){const r=Bi.utc(2016,i,1);t.push(e(r))}return t}function tUe(e){const t=[];for(let i=1;i<=7;i++){const r=Bi.utc(2016,11,13+i);t.push(e(r))}return t}function PL(e,t,i,r,s){const n=e.listingMode(i);return n==="error"?null:n==="en"?r(t):s(t)}function iUe(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class rUe{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=Y6e(t,a)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):JJ(t,3);return Ho(i,this.padTo)}}}class sUe{constructor(t,i,r){this.opts=r;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&P0.create(a).valid?(s=a,this.dt=t):(s="UTC",r.timeZoneName?this.dt=t:this.dt=t.offset===0?t:Bi.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=Rq(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class nUe{constructor(t,i,r){this.opts={style:"long",...r},!i&&wve()&&(this.rtf=Z6e(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):xUe(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}class xn{static fromOpts(t){return xn.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,i,r,s=!1){const n=t||Go.defaultLocale,o=n||(s?"en-US":J6e()),a=i||Go.defaultNumberingSystem,l=r||Go.defaultOutputCalendar;return new xn(o,a,l,n)}static resetCache(){AO=null,Mq={},Oq={},Iq={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r}={}){return xn.create(t,i,r)}constructor(t,i,r,s){const[n,o,a]=K6e(t);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=Q6e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=iUe(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:xn.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,i=!1,r=!0){return PL(this,t,r,Eve,()=>{const s=i?{month:t,day:"numeric"}:{month:t},n=i?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=eUe(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,i=!1,r=!0){return PL(this,t,r,Mve,()=>{const s=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=i?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=tUe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return PL(this,void 0,t,()=>Rve,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Bi.utc(2016,11,13,9),Bi.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(t,i=!0){return PL(this,t,i,Ove,()=>{const r={era:t};return this.eraCache[t]||(this.eraCache[t]=[Bi.utc(-40,1,1),Bi.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(t={}){return new rUe(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new sUe(t,this.intl,i)}relFormatter(t={}){return new nUe(this.intl,this.isEnglish(),t)}listFormatter(t={}){return X6e(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}let R9=null;class Wl extends w${static get utcInstance(){return R9===null&&(R9=new Wl(0)),R9}static instance(t){return t===0?Wl.utcInstance:new Wl(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Wl(vU(i[1],i[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${$3(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${$3(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return $3(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class oUe extends w${constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Xv(e,t){if(Pr(e)||e===null)return t;if(e instanceof w$)return e;if(aUe(e)){const i=e.toLowerCase();return i==="default"?t:i==="local"||i==="system"?yU.instance:i==="utc"||i==="gmt"?Wl.utcInstance:Wl.parseSpecifier(i)||P0.create(e)}else return Xx(e)?Wl.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new oUe(e)}let cse=()=>Date.now(),use="system",hse=null,dse=null,pse=null,fse=60,mse;class Go{static get now(){return cse}static set now(t){cse=t}static set defaultZone(t){use=t}static get defaultZone(){return Xv(use,yU.instance)}static get defaultLocale(){return hse}static set defaultLocale(t){hse=t}static get defaultNumberingSystem(){return dse}static set defaultNumberingSystem(t){dse=t}static get defaultOutputCalendar(){return pse}static set defaultOutputCalendar(t){pse=t}static get twoDigitCutoffYear(){return fse}static set twoDigitCutoffYear(t){fse=t%100}static get throwOnInvalid(){return mse}static set throwOnInvalid(t){mse=t}static resetCaches(){xn.resetCache(),P0.resetCache()}}function Pr(e){return typeof e=="undefined"}function Xx(e){return typeof e=="number"}function _U(e){return typeof e=="number"&&e%1===0}function aUe(e){return typeof e=="string"}function lUe(e){return Object.prototype.toString.call(e)==="[object Date]"}function wve(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch{return!1}}function cUe(e){return Array.isArray(e)?e:[e]}function gse(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const n=[t(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function uUe(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function nA(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c0(e,t,i){return _U(e)&&e>=t&&e<=i}function hUe(e,t){return e-t*Math.floor(e/t)}function Ho(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function kv(e){if(!(Pr(e)||e===null||e===""))return parseInt(e,10)}function Eb(e){if(!(Pr(e)||e===null||e===""))return parseFloat(e)}function ZJ(e){if(!(Pr(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function JJ(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function x$(e){return e%4===0&&(e%100!==0||e%400===0)}function P3(e){return x$(e)?366:365}function D5(e,t){const i=hUe(t-1,12)+1,r=e+(t-i)/12;return i===2?x$(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function KJ(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function F5(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return t===4||r===3?53:52}function Pq(e){return e>99?e:e>Go.twoDigitCutoffYear?1900+e:2e3+e}function xve(e,t,i,r=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:t,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function vU(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function Tve(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new Nd(`Invalid unit value ${e}`);return t}function N5(e,t){const i={};for(const r in e)if(nA(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=Tve(s)}return i}function $3(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${Ho(i,2)}:${Ho(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${Ho(i,2)}${Ho(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function bU(e){return uUe(e,["hour","minute","second","millisecond"])}const dUe=["January","February","March","April","May","June","July","August","September","October","November","December"],Sve=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],pUe=["J","F","M","A","M","J","J","A","S","O","N","D"];function Eve(e){switch(e){case"narrow":return[...pUe];case"short":return[...Sve];case"long":return[...dUe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Cve=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ave=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],fUe=["M","T","W","T","F","S","S"];function Mve(e){switch(e){case"narrow":return[...fUe];case"short":return[...Ave];case"long":return[...Cve];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Rve=["AM","PM"],mUe=["Before Christ","Anno Domini"],gUe=["BC","AD"],yUe=["B","A"];function Ove(e){switch(e){case"narrow":return[...yUe];case"short":return[...gUe];case"long":return[...mUe];default:return null}}function _Ue(e){return Rve[e.hour<12?0:1]}function vUe(e,t){return Mve(t)[e.weekday-1]}function bUe(e,t){return Eve(t)[e.month-1]}function wUe(e,t){return Ove(t)[e.year<0?0:1]}function xUe(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=r?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function yse(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const TUe={D:L5,DD:ive,DDD:rve,DDDD:sve,t:nve,tt:ove,ttt:ave,tttt:lve,T:cve,TT:uve,TTT:hve,TTTT:dve,f:pve,ff:mve,fff:yve,ffff:vve,F:fve,FF:gve,FFF:_ve,FFFF:bve};class jl{static create(t,i={}){return new jl(t,i)}static parseFormat(t){let i=null,r="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(t){return TUe[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,{...this.opts,...i}).format()}formatDateTime(t,i={}){return this.loc.dtFormatter(t,{...this.opts,...i}).format()}formatDateTimeParts(t,i={}){return this.loc.dtFormatter(t,{...this.opts,...i}).formatToParts()}formatInterval(t,i={}){return this.loc.dtFormatter(t.start,{...this.opts,...i}).dtf.formatRange(t.start.toJSDate(),t.end.toJSDate())}resolvedOptions(t,i={}){return this.loc.dtFormatter(t,{...this.opts,...i}).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return Ho(t,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(t,m,y),o=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",a=()=>r?_Ue(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>r?bUe(t,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>r?vUe(t,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=jl.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(t,y):m},p=m=>r?wUe(t,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(m)}};return yse(jl.parseFormat(i),f)}formatDurationFromString(t,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=jl.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(r).filter(l=>l));return yse(n,s(a))}}class bf{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Ive=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function uM(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function hM(...e){return t=>e.reduce(([i,r,s],n)=>{const[o,a,l]=n(t,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function dM(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function Pve(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=kv(t[i+s]);return[r,null,i+s]}}const $ve=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,SUe=`(?:${$ve.source}?(?:\\[(${Ive.source})\\])?)?`,QJ=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Lve=RegExp(`${QJ.source}${SUe}`),eK=RegExp(`(?:T${Lve.source})?`),EUe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,CUe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,AUe=/(\d{4})-?(\d{3})/,MUe=Pve("weekYear","weekNumber","weekDay"),RUe=Pve("year","ordinal"),OUe=/(\d{4})-(\d\d)-(\d\d)/,Dve=RegExp(`${QJ.source} ?(?:${$ve.source}|(${Ive.source}))?`),IUe=RegExp(`(?: ${Dve.source})?`);function dC(e,t,i){const r=e[t];return Pr(r)?i:kv(r)}function PUe(e,t){return[{year:dC(e,t),month:dC(e,t+1,1),day:dC(e,t+2,1)},null,t+3]}function pM(e,t){return[{hours:dC(e,t,0),minutes:dC(e,t+1,0),seconds:dC(e,t+2,0),milliseconds:ZJ(e[t+3])},null,t+4]}function T$(e,t){const i=!e[t]&&!e[t+1],r=vU(e[t+1],e[t+2]),s=i?null:Wl.instance(r);return[{},s,t+3]}function S$(e,t){const i=e[t]?P0.create(e[t]):null;return[{},i,t+1]}const $Ue=RegExp(`^T?${QJ.source}$`),LUe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function DUe(e){const[t,i,r,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(Eb(i)),months:f(Eb(r)),weeks:f(Eb(s)),days:f(Eb(n)),hours:f(Eb(o)),minutes:f(Eb(a)),seconds:f(Eb(l),l==="-0"),milliseconds:f(ZJ(c),p)}]}const FUe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function tK(e,t,i,r,s,n,o){const a={year:t.length===2?Pq(kv(t)):kv(t),month:Sve.indexOf(i)+1,day:kv(r),hour:kv(s),minute:kv(n)};return o&&(a.second=kv(o)),e&&(a.weekday=e.length>3?Cve.indexOf(e)+1:Ave.indexOf(e)+1),a}const NUe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function kUe(e){const[,t,i,r,s,n,o,a,l,c,h,p]=e,f=tK(t,s,r,i,n,o,a);let m;return l?m=FUe[l]:c?m=0:m=vU(h,p),[f,new Wl(m)]}function UUe(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const VUe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,BUe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,zUe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function _se(e){const[,t,i,r,s,n,o,a]=e;return[tK(t,s,r,i,n,o,a),Wl.utcInstance]}function GUe(e){const[,t,i,r,s,n,o,a]=e;return[tK(t,a,i,r,s,n,o),Wl.utcInstance]}const jUe=uM(EUe,eK),HUe=uM(CUe,eK),qUe=uM(AUe,eK),WUe=uM(Lve),Fve=hM(PUe,pM,T$,S$),XUe=hM(MUe,pM,T$,S$),YUe=hM(RUe,pM,T$,S$),ZUe=hM(pM,T$,S$);function JUe(e){return dM(e,[jUe,Fve],[HUe,XUe],[qUe,YUe],[WUe,ZUe])}function KUe(e){return dM(UUe(e),[NUe,kUe])}function QUe(e){return dM(e,[VUe,_se],[BUe,_se],[zUe,GUe])}function e8e(e){return dM(e,[LUe,DUe])}const t8e=hM(pM);function i8e(e){return dM(e,[$Ue,t8e])}const r8e=uM(OUe,IUe),s8e=uM(Dve),n8e=hM(pM,T$,S$);function o8e(e){return dM(e,[r8e,Fve],[s8e,n8e])}const a8e="Invalid Duration",Nve={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},l8e={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Nve},ed=146097/400,fS=146097/4800,c8e={years:{quarters:4,months:12,weeks:ed/7,days:ed,hours:ed*24,minutes:ed*24*60,seconds:ed*24*60*60,milliseconds:ed*24*60*60*1e3},quarters:{months:3,weeks:ed/28,days:ed/4,hours:ed*24/4,minutes:ed*24*60/4,seconds:ed*24*60*60/4,milliseconds:ed*24*60*60*1e3/4},months:{weeks:fS/7,days:fS,hours:fS*24,minutes:fS*24*60,seconds:fS*24*60*60,milliseconds:fS*24*60*60*1e3},...Nve},zw=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],u8e=zw.slice(0).reverse();function v_(e,t,i=!1){const r={values:i?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new Nr(r)}function h8e(e){return e<0?Math.floor(e):Math.ceil(e)}function kve(e,t,i,r,s){const n=e[s][i],o=t[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?h8e(o):Math.trunc(o);r[s]+=l,t[i]-=l*n}function d8e(e,t){u8e.reduce((i,r)=>Pr(t[r])?i:(i&&kve(e,t,i,t,r),r),null)}function p8e(e){const t={};for(const[i,r]of Object.entries(e))r!==0&&(t[i]=r);return t}class Nr{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;let r=i?c8e:l8e;t.matrix&&(r=t.matrix),this.values=t.values,this.loc=t.loc||xn.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(t,i){return Nr.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new Nd(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new Nr({values:N5(t,Nr.normalizeUnit),loc:xn.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(t){if(Xx(t))return Nr.fromMillis(t);if(Nr.isDuration(t))return t;if(typeof t=="object")return Nr.fromObject(t);throw new Nd(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=e8e(t);return r?Nr.fromObject(r,i):Nr.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=i8e(t);return r?Nr.fromObject(r,i):Nr.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new Nd("need to specify a reason the Duration is invalid");const r=t instanceof bf?t:new bf(t,i);if(Go.throwOnInvalid)throw new B6e(r);return new Nr({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new tve(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?jl.create(this.loc,r).formatDurationFromString(this,t):a8e}toHuman(t={}){const i=zw.map(r=>{const s=this.values[r];return Pr(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=JJ(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t};const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=Nr.fromDurationLike(t),r={};for(const s of zw)(nA(i.values,s)||nA(this.values,s))&&(r[s]=i.get(s)+this.get(s));return v_(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=Nr.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=Tve(t(this.values[r],r));return v_(this,{values:i},!0)}get(t){return this[Nr.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i={...this.values,...N5(t,Nr.normalizeUnit)};return v_(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:t,numberingSystem:i}),matrix:s,conversionAccuracy:r};return v_(this,o)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return d8e(this.matrix,t),v_(this,{values:t},!0)}rescale(){if(!this.isValid)return this;const t=p8e(this.normalize().shiftToAll().toObject());return v_(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>Nr.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of zw)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;Xx(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)zw.indexOf(c)>zw.indexOf(o)&&kve(this.matrix,s,c,i,o)}else Xx(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return v_(this,{values:i},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return v_(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of zw)if(!i(this.values[r],t.values[r]))return!1;return!0}}const mS="Invalid Interval";function f8e(e,t){return!e||!e.isValid?Jn.invalid("missing or invalid start"):!t||!t.isValid?Jn.invalid("missing or invalid end"):t<e?Jn.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class Jn{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new Nd("need to specify a reason the Interval is invalid");const r=t instanceof bf?t:new bf(t,i);if(Go.throwOnInvalid)throw new V6e(r);return new Jn({invalid:r})}static fromDateTimes(t,i){const r=jM(t),s=jM(i),n=f8e(r,s);return n==null?new Jn({start:r,end:s}):n}static after(t,i){const r=Nr.fromDurationLike(i),s=jM(t);return Jn.fromDateTimes(s,s.plus(r))}static before(t,i){const r=Nr.fromDurationLike(i),s=jM(t);return Jn.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let n,o;try{n=Bi.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=Bi.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return Jn.fromDateTimes(n,a);if(o){const c=Nr.fromISO(s,i);if(c.isValid)return Jn.after(n,c)}else if(l){const c=Nr.fromISO(r,i);if(c.isValid)return Jn.before(a,c)}}return Jn.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(i,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?Jn.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(jM).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(Jn.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(t){const i=Nr.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Jn.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:Jn.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return Jn.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Jn.fromDateTimes(i,l.time)),i=null);return Jn.merge(s)}difference(...t){return Jn.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:mS}toLocaleString(t=L5,i={}){return this.isValid?jl.create(this.s.loc.clone(i),t).formatInterval(this):mS}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:mS}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:mS}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:mS}toFormat(t,{separator:i=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:mS}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):Nr.invalid(this.invalidReason)}mapEndpoints(t){return Jn.fromDateTimes(t(this.s),t(this.e))}}class $L{static hasDST(t=Go.defaultZone){const i=Bi.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return P0.isValidZone(t)}static normalizeZone(t){return Xv(t,Go.defaultZone)}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||xn.create(i,r,n)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||xn.create(i,r,n)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||xn.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||xn.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return xn.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return xn.create(i,null,"gregory").eras(t)}static features(){return{relative:wve()}}}function vse(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(Nr.fromMillis(r).as("days"))}function m8e(e,t,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=vse(l,c);return(h-h%7)/7}],["days",vse]],s={},n=e;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(e,t),a=n.plus(s),a>t?(s[l]--,e=n.plus(s)):e=a);return[e,s,a,o]}function g8e(e,t,i,r){let[s,n,o,a]=m8e(e,t,i);const l=t-s,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=Nr.fromObject(n,r);return c.length>0?Nr.fromMillis(l,r).shiftTo(...c).plus(h):h}const iK={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},bse={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},y8e=iK.hanidec.replace(/[\[|\]]/g,"").split("");function _8e(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(iK.hanidec)!==-1)t+=y8e.indexOf(e[i]);else for(const s in bse){const[n,o]=bse[s];r>=n&&r<=o&&(t+=r-n)}}return parseInt(t,10)}else return t}function wp({numberingSystem:e},t=""){return new RegExp(`${iK[e||"latn"]}${t}`)}const v8e="missing Intl.DateTimeFormat.formatToParts support";function Jr(e,t=i=>i){return{regex:e,deser:([i])=>t(_8e(i))}}const b8e=String.fromCharCode(160),Uve=`[ ${b8e}]`,Vve=new RegExp(Uve,"g");function w8e(e){return e.replace(/\./g,"\\.?").replace(Vve,Uve)}function wse(e){return e.replace(/\./g,"").replace(Vve," ").toLowerCase()}function xp(e,t){return e===null?null:{regex:RegExp(e.map(w8e).join("|")),deser:([i])=>e.findIndex(r=>wse(i)===wse(r))+t}}function xse(e,t){return{regex:e,deser:([,i,r])=>vU(i,r),groups:t}}function O9(e){return{regex:e,deser:([t])=>t}}function x8e(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function T8e(e,t){const i=wp(t),r=wp(t,"{2}"),s=wp(t,"{3}"),n=wp(t,"{4}"),o=wp(t,"{6}"),a=wp(t,"{1,2}"),l=wp(t,"{1,3}"),c=wp(t,"{1,6}"),h=wp(t,"{1,9}"),p=wp(t,"{2,4}"),f=wp(t,"{4,6}"),m=b=>({regex:RegExp(x8e(b.val)),deser:([w])=>w,literal:!0}),_=(b=>{if(e.literal)return m(b);switch(b.val){case"G":return xp(t.eras("short",!1),0);case"GG":return xp(t.eras("long",!1),0);case"y":return Jr(c);case"yy":return Jr(p,Pq);case"yyyy":return Jr(n);case"yyyyy":return Jr(f);case"yyyyyy":return Jr(o);case"M":return Jr(a);case"MM":return Jr(r);case"MMM":return xp(t.months("short",!0,!1),1);case"MMMM":return xp(t.months("long",!0,!1),1);case"L":return Jr(a);case"LL":return Jr(r);case"LLL":return xp(t.months("short",!1,!1),1);case"LLLL":return xp(t.months("long",!1,!1),1);case"d":return Jr(a);case"dd":return Jr(r);case"o":return Jr(l);case"ooo":return Jr(s);case"HH":return Jr(r);case"H":return Jr(a);case"hh":return Jr(r);case"h":return Jr(a);case"mm":return Jr(r);case"m":return Jr(a);case"q":return Jr(a);case"qq":return Jr(r);case"s":return Jr(a);case"ss":return Jr(r);case"S":return Jr(l);case"SSS":return Jr(s);case"u":return O9(h);case"uu":return O9(a);case"uuu":return Jr(i);case"a":return xp(t.meridiems(),0);case"kkkk":return Jr(n);case"kk":return Jr(p,Pq);case"W":return Jr(a);case"WW":return Jr(r);case"E":case"c":return Jr(i);case"EEE":return xp(t.weekdays("short",!1,!1),1);case"EEEE":return xp(t.weekdays("long",!1,!1),1);case"ccc":return xp(t.weekdays("short",!0,!1),1);case"cccc":return xp(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return xse(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return xse(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return O9(/[a-z_+-/]{1,256}?/i);default:return m(b)}})(e)||{invalidReason:v8e};return _.token=e,_}const S8e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function E8e(e,t){const{type:i,value:r}=e;if(i==="literal")return{literal:!0,val:r};const s=t[i];let n=S8e[i];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function C8e(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function A8e(e,t,i){const r=e.match(t);if(r){const s={};let n=1;for(const o in i)if(nA(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function M8e(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Pr(e.z)||(i=P0.create(e.z)),Pr(e.Z)||(i||(i=new Wl(e.Z)),r=e.Z),Pr(e.q)||(e.M=(e.q-1)*3+1),Pr(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Pr(e.u)||(e.S=ZJ(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),i,r]}let I9=null;function R8e(){return I9||(I9=Bi.fromMillis(1555555555555)),I9}function O8e(e,t){if(e.literal)return e;const i=jl.macroTokenToFormatOpts(e.val),r=Gve(i,t);return r==null||r.includes(void 0)?e:r}function Bve(e,t){return Array.prototype.concat(...e.map(i=>O8e(i,t)))}function zve(e,t,i){const r=Bve(jl.parseFormat(i),e),s=r.map(o=>T8e(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};{const[o,a]=C8e(s),l=RegExp(o,"i"),[c,h]=A8e(t,l,a),[p,f,m]=h?M8e(h):[null,null,void 0];if(nA(h,"a")&&nA(h,"H"))throw new CO("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function I8e(e,t,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=zve(e,t,i);return[r,s,n,o]}function Gve(e,t){return e?jl.create(t,e).formatDateTimeParts(R8e()).map(s=>E8e(s,e)):null}const jve=[0,31,59,90,120,151,181,212,243,273,304,334],Hve=[0,31,60,91,121,152,182,213,244,274,305,335];function qd(e,t){return new bf("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function qve(e,t,i){const r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function Wve(e,t,i){return i+(x$(e)?Hve:jve)[t-1]}function Xve(e,t){const i=x$(e)?Hve:jve,r=i.findIndex(n=>n<t),s=t-i[r];return{month:r+1,day:s}}function $q(e){const{year:t,month:i,day:r}=e,s=Wve(t,i,r),n=qve(t,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=F5(a)):o>F5(t)?(a=t+1,o=1):a=t,{weekYear:a,weekNumber:o,weekday:n,...bU(e)}}function Tse(e){const{weekYear:t,weekNumber:i,weekday:r}=e,s=qve(t,1,4),n=P3(t);let o=i*7+r-s-3,a;o<1?(a=t-1,o+=P3(a)):o>n?(a=t+1,o-=P3(t)):a=t;const{month:l,day:c}=Xve(a,o);return{year:a,month:l,day:c,...bU(e)}}function P9(e){const{year:t,month:i,day:r}=e,s=Wve(t,i,r);return{year:t,ordinal:s,...bU(e)}}function Sse(e){const{year:t,ordinal:i}=e,{month:r,day:s}=Xve(t,i);return{year:t,month:r,day:s,...bU(e)}}function P8e(e){const t=_U(e.weekYear),i=c0(e.weekNumber,1,F5(e.weekYear)),r=c0(e.weekday,1,7);return t?i?r?!1:qd("weekday",e.weekday):qd("week",e.week):qd("weekYear",e.weekYear)}function $8e(e){const t=_U(e.year),i=c0(e.ordinal,1,P3(e.year));return t?i?!1:qd("ordinal",e.ordinal):qd("year",e.year)}function Yve(e){const t=_U(e.year),i=c0(e.month,1,12),r=c0(e.day,1,D5(e.year,e.month));return t?i?r?!1:qd("day",e.day):qd("month",e.month):qd("year",e.year)}function Zve(e){const{hour:t,minute:i,second:r,millisecond:s}=e,n=c0(t,0,23)||t===24&&i===0&&r===0&&s===0,o=c0(i,0,59),a=c0(r,0,59),l=c0(s,0,999);return n?o?a?l?!1:qd("millisecond",s):qd("second",r):qd("minute",i):qd("hour",t)}const $9="Invalid DateTime",Ese=864e13;function LL(e){return new bf("unsupported zone",`the zone "${e.name}" is not supported`)}function L9(e){return e.weekData===null&&(e.weekData=$q(e.c)),e.weekData}function zM(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new Bi({...i,...t,old:i})}function Jve(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function Cse(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function ZN(e,t,i){return Jve(KJ(e),t,i)}function Ase(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n={...e.c,year:r,month:s,day:Math.min(e.c.day,D5(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7},o=Nr.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=KJ(n);let[l,c]=Jve(a,i,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function GM(e,t,i,r,s,n){const{setZone:o,zone:a}=i;if(e&&Object.keys(e).length!==0){const l=t||a,c=Bi.fromObject(e,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return Bi.invalid(new bf("unparsable",`the input "${s}" can't be parsed as ${r}`))}function DL(e,t,i=!0){return e.isValid?jl.create(xn.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function D9(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=Ho(e.c.year,i?6:4),t?(r+="-",r+=Ho(e.c.month),r+="-",r+=Ho(e.c.day)):(r+=Ho(e.c.month),r+=Ho(e.c.day)),r}function Mse(e,t,i,r,s,n){let o=Ho(e.c.hour);return t?(o+=":",o+=Ho(e.c.minute),(e.c.second!==0||!i)&&(o+=":")):o+=Ho(e.c.minute),(e.c.second!==0||!i)&&(o+=Ho(e.c.second),(e.c.millisecond!==0||!r)&&(o+=".",o+=Ho(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=Ho(Math.trunc(-e.o/60)),o+=":",o+=Ho(Math.trunc(-e.o%60))):(o+="+",o+=Ho(Math.trunc(e.o/60)),o+=":",o+=Ho(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const Kve={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},L8e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},D8e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Qve=["year","month","day","hour","minute","second","millisecond"],F8e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],N8e=["year","ordinal","hour","minute","second","millisecond"];function Rse(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new tve(e);return t}function Ose(e,t){const i=Xv(t.zone,Go.defaultZone),r=xn.fromObject(t),s=Go.now();let n,o;if(Pr(e.year))n=s;else{for(const c of Qve)Pr(e[c])&&(e[c]=Kve[c]);const a=Yve(e)||Zve(e);if(a)return Bi.invalid(a);const l=i.offset(s);[n,o]=ZN(e,l,i)}return new Bi({ts:n,zone:i,loc:r,o})}function Ise(e,t,i){const r=Pr(i.round)?!0:i.round,s=(o,a)=>(o=JJ(o,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,i.units[i.units.length-1])}function Pse(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class Bi{constructor(t){const i=t.zone||Go.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new bf("invalid input"):null)||(i.isValid?null:LL(i));this.ts=Pr(t.ts)?Go.now():t.ts;let s=null,n=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,n]=[t.old.c,t.old.o];else{const a=i.offset(this.ts);s=Cse(this.ts,a),r=Number.isNaN(s.year)?new bf("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=t.loc||xn.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Bi({})}static local(){const[t,i]=Pse(arguments),[r,s,n,o,a,l,c]=i;return Ose({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,i]=Pse(arguments),[r,s,n,o,a,l,c]=i;return t.zone=Wl.utcInstance,Ose({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,i={}){const r=lUe(t)?t.valueOf():NaN;if(Number.isNaN(r))return Bi.invalid("invalid input");const s=Xv(i.zone,Go.defaultZone);return s.isValid?new Bi({ts:r,zone:s,loc:xn.fromObject(i)}):Bi.invalid(LL(s))}static fromMillis(t,i={}){if(Xx(t))return t<-Ese||t>Ese?Bi.invalid("Timestamp out of range"):new Bi({ts:t,zone:Xv(i.zone,Go.defaultZone),loc:xn.fromObject(i)});throw new Nd(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(Xx(t))return new Bi({ts:t*1e3,zone:Xv(i.zone,Go.defaultZone),loc:xn.fromObject(i)});throw new Nd("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=Xv(i.zone,Go.defaultZone);if(!r.isValid)return Bi.invalid(LL(r));const s=Go.now(),n=Pr(i.specificOffset)?r.offset(s):i.specificOffset,o=N5(t,Rse),a=!Pr(o.ordinal),l=!Pr(o.year),c=!Pr(o.month)||!Pr(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=xn.fromObject(i);if((h||a)&&p)throw new CO("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new CO("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,_,b=Cse(s,n);m?(y=F8e,_=L8e,b=$q(b)):a?(y=N8e,_=D8e,b=P9(b)):(y=Qve,_=Kve);let w=!1;for(const I of y){const k=o[I];Pr(k)?w?o[I]=_[I]:o[I]=b[I]:w=!0}const T=m?P8e(o):a?$8e(o):Yve(o),S=T||Zve(o);if(S)return Bi.invalid(S);const E=m?Tse(o):a?Sse(o):o,[M,A]=ZN(E,n,r),$=new Bi({ts:M,zone:r,o:A,loc:f});return o.weekday&&h&&t.weekday!==$.weekday?Bi.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${$.toISO()}`):$}static fromISO(t,i={}){const[r,s]=JUe(t);return GM(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=KUe(t);return GM(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=QUe(t);return GM(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(Pr(t)||Pr(i))throw new Nd("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=xn.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=I8e(o,t,i);return h?Bi.invalid(h):GM(a,l,r,`format ${i}`,t,c)}static fromString(t,i,r={}){return Bi.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=o8e(t);return GM(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new Nd("need to specify a reason the DateTime is invalid");const r=t instanceof bf?t:new bf(t,i);if(Go.throwOnInvalid)throw new U6e(r);return new Bi({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}static parseFormatForOpts(t,i={}){const r=Gve(t,xn.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(t,i={}){return Bve(jl.parseFormat(t),xn.fromObject(i)).map(s=>s.val).join("")}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?L9(this).weekYear:NaN}get weekNumber(){return this.isValid?L9(this).weekNumber:NaN}get weekday(){return this.isValid?L9(this).weekday:NaN}get ordinal(){return this.isValid?P9(this.c).ordinal:NaN}get monthShort(){return this.isValid?$L.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?$L.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?$L.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?$L.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return x$(this.year)}get daysInMonth(){return D5(this.year,this.month)}get daysInYear(){return this.isValid?P3(this.year):NaN}get weeksInWeekYear(){return this.isValid?F5(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=jl.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone(Wl.instance(t),i)}toLocal(){return this.setZone(Go.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=Xv(t,Go.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const n=t.offset(this.ts),o=this.toObject();[s]=ZN(o,n,t)}return zM(this,{ts:s,zone:t})}else return Bi.invalid(LL(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return zM(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=N5(t,Rse),r=!Pr(i.weekYear)||!Pr(i.weekNumber)||!Pr(i.weekday),s=!Pr(i.ordinal),n=!Pr(i.year),o=!Pr(i.month)||!Pr(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new CO("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new CO("Can't mix ordinal dates with month/day");let c;r?c=Tse({...$q(this.c),...i}):Pr(i.ordinal)?(c={...this.toObject(),...i},Pr(i.day)&&(c.day=Math.min(D5(c.year,c.month),c.day))):c=Sse({...P9(this.c),...i});const[h,p]=ZN(c,this.o,this.zone);return zM(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const i=Nr.fromDurationLike(t);return zM(this,Ase(this,i))}minus(t){if(!this.isValid)return this;const i=Nr.fromDurationLike(t).negate();return zM(this,Ase(this,i))}startOf(t){if(!this.isValid)return this;const i={},r=Nr.normalizeUnit(t);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,i={}){return this.isValid?jl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):$9}toLocaleString(t=L5,i={}){return this.isValid?jl.create(this.loc.clone(i),t).formatDateTime(this):$9}toLocaleParts(t={}){return this.isValid?jl.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=D9(this,o);return a+="T",a+=Mse(this,o,i,r,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?D9(this,t==="extended"):null}toISOWeekDate(){return DL(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Mse(this,o==="extended",i,t,r,n):null}toRFC2822(){return DL(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return DL(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?D9(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),DL(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():$9}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i={...this.c};return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return Nr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=cUe(i).map(Nr.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=g8e(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",i={}){return this.diff(Bi.now(),t,i)}until(t){return this.isValid?Jn.fromDateTimes(this,t):this}hasSame(t,i){if(!this.isValid)return!1;const r=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||Bi.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),Ise(i,this.plus(r),{...t,numeric:"always",units:s,unit:n})}toRelativeCalendar(t={}){return this.isValid?Ise(t.base||Bi.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(Bi.isDateTime))throw new Nd("min requires all arguments be DateTimes");return gse(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(Bi.isDateTime))throw new Nd("max requires all arguments be DateTimes");return gse(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=xn.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return zve(o,t,i)}static fromStringExplain(t,i,r={}){return Bi.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return L5}static get DATE_MED(){return ive}static get DATE_MED_WITH_WEEKDAY(){return z6e}static get DATE_FULL(){return rve}static get DATE_HUGE(){return sve}static get TIME_SIMPLE(){return nve}static get TIME_WITH_SECONDS(){return ove}static get TIME_WITH_SHORT_OFFSET(){return ave}static get TIME_WITH_LONG_OFFSET(){return lve}static get TIME_24_SIMPLE(){return cve}static get TIME_24_WITH_SECONDS(){return uve}static get TIME_24_WITH_SHORT_OFFSET(){return hve}static get TIME_24_WITH_LONG_OFFSET(){return dve}static get DATETIME_SHORT(){return pve}static get DATETIME_SHORT_WITH_SECONDS(){return fve}static get DATETIME_MED(){return mve}static get DATETIME_MED_WITH_SECONDS(){return gve}static get DATETIME_MED_WITH_WEEKDAY(){return G6e}static get DATETIME_FULL(){return yve}static get DATETIME_FULL_WITH_SECONDS(){return _ve}static get DATETIME_HUGE(){return vve}static get DATETIME_HUGE_WITH_SECONDS(){return bve}}function jM(e){if(Bi.isDateTime(e))return e;if(e&&e.valueOf&&Xx(e.valueOf()))return Bi.fromJSDate(e);if(e&&typeof e=="object")return Bi.fromObject(e);throw new Nd(`Unknown datetime argument: ${e}, of type ${typeof e}`)}function k8e(e,t="system"){if(!e||!ase.has(e.timeZone))return t;const i=ase.get(e.timeZone);return V8e(e.timeZone)||e.respectsDaylightSaving?i:U8e(i)}function U8e(e){const t=Bi.local().setZone(e),i=Math.min(t.set({month:1,day:1}).offset,t.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${Wl.instance(-i).formatOffset(0,"narrow")}`}function V8e(e){return e.startsWith("UTC")}let hv=class extends Ys(ge){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,t){const{timeZone:i,respectsDaylightSaving:r}=t;return{timeZone:i,respectsDaylightSaving:r}}readTimeZone(e,t){return"timeZoneIANA"in t?t.timeZoneIANA:k8e(t)}writeTimeZone(e,t){t.timeZoneIANA=e}equals(e){return!(C(e)||C(this.timeZone)||C(e.timeZone))&&this.timeZone===e.timeZone}};u([d()],hv.prototype,"legacy",void 0),u([Fe("legacy",["timeZone"])],hv.prototype,"readLegacy",null),u([d({type:String,nonNullable:!0})],hv.prototype,"timeZone",void 0),u([Fe("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],hv.prototype,"readTimeZone",null),u([Ge("timeZone")],hv.prototype,"writeTimeZone",null),hv=u([P("esri.time.TimeReference")],hv);const oA=hv;let Py=class extends Ys(ge){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([d()],Py.prototype,"creatorField",void 0),u([d()],Py.prototype,"creationDateField",void 0),u([d()],Py.prototype,"editorField",void 0),u([d()],Py.prototype,"editDateField",void 0),u([d()],Py.prototype,"realm",void 0),u([d({type:oA})],Py.prototype,"dateFieldsTimeReference",void 0),Py=u([P("esri.layers.support.EditFieldsInfo")],Py);const B8e=Py;let jm=class extends Ys(ge){constructor(e){super(e)}};u([d({constructOnly:!0,json:{write:!0}})],jm.prototype,"name",void 0),u([d({constructOnly:!0,json:{write:!0}})],jm.prototype,"fields",void 0),u([d({constructOnly:!0,json:{write:!0}})],jm.prototype,"isAscending",void 0),u([d({constructOnly:!0,json:{write:!0}})],jm.prototype,"indexType",void 0),u([d({constructOnly:!0,json:{write:!0}})],jm.prototype,"isUnique",void 0),u([d({constructOnly:!0,json:{write:!0}})],jm.prototype,"description",void 0),jm=u([P("esri.layers.support.FeatureIndex")],jm);var Lq;let Na=Lq=class extends ge{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new Lq(ne({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Na.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Na.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Na.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Na.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Na.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Na.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Na.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Na.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Na.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Na.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Na.prototype,"start",void 0),u([Ge("start"),Ge("num")],Na.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Na.prototype,"where",void 0),Na=Lq=u([P("esri.rest.support.AttachmentQuery")],Na),Na.from=zr(Na);const Dq=Na;var Fq;let Pn=Fq=class extends ge{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new Fq(ne({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],Pn.prototype,"cacheHint",void 0),u([d({type:af,json:{write:!0}})],Pn.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Pn.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],Pn.prototype,"geometryPrecision",void 0),u([d({type:Date})],Pn.prototype,"historicMoment",void 0),u([Ge("historicMoment")],Pn.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Pn.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],Pn.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Pn.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Pn.prototype,"outFields",void 0),u([d({type:et,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Pn.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],Pn.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Pn.prototype,"start",void 0),u([Ge("start"),Ge("num")],Pn.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Pn.prototype,"num",void 0),u([d({json:{write:!0}})],Pn.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Pn.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Pn.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Pn.prototype,"where",void 0),Pn=Fq=u([P("esri.rest.support.RelationshipQuery")],Pn),Pn.from=zr(Pn);const aA=Pn;var OMt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:aA});const Nq=new _i({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function z8e(e,t,i,r){const s=await mb(e);if(await rK(e,t,r),!s.addAttachment)throw new H(r,"Layer source does not support addAttachment capability");return s.addAttachment(t,i)}function rK(e,t,i){const{attributes:r}=t,{objectIdField:s}=e;return e.get("capabilities.data.supportsAttachment")?t?r?s&&r[s]?Promise.resolve():Promise.reject(new H(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new H(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new H(i,"A feature is required to add/delete/update attachments")):Promise.reject(new H(i,"this layer doesn't support attachments"))}async function G8e(e,t,i,r,s){const n=await mb(e);if(await rK(e,t,s),!n.updateAttachment)throw new H(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(t,i,r)}async function j8e(e,t,i){const r=await Q(()=>import("./editingSupport.c72852f9.js"),["assets/editingSupport.c72852f9.js","assets/assetEditingSupport.240adbda.js"]),s=await e.load();return r.applyEdits(s,s.source,t,i)}async function H8e(e,t,i,r){const s=await mb(e);if(await rK(e,t,r),!s.deleteAttachments)throw new H(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(t,i)}async function q8e(e,t,i){const r=(await e.load({signal:t==null?void 0:t.signal})).source;if(!r.fetchRecomputedExtents)throw new H(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(t)}async function W8e(e,t,i,r){var m,y;t=Dq.from(t),await e.load();const s=e.source,n=e.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new H(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:f}=t;if(!((y=n==null?void 0:n.operations)!=null&&y.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||p||f))throw new H(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!((a==null?void 0:a.length)||(l==null?void 0:l.length)||f))throw new H(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!s.queryAttachments)throw new H(r,"Layer source does not support queryAttachments capability",t);return s.queryAttachments(t)}async function X8e(e,t,i,r){var n;const s=await mb(e);if(!s.queryObjectIds)throw new H(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds((n=mg.from(t))!=null?n:e.createQuery(),i)}async function Y8e(e,t,i,r){var n;const s=await mb(e);if(!s.queryFeatureCount)throw new H(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount((n=mg.from(t))!=null?n:e.createQuery(),i)}async function Z8e(e,t,i,r){var n;const s=await mb(e);if(!s.queryExtent)throw new H(r,"Layer source does not support queryExtent capability");return s.queryExtent((n=mg.from(t))!=null?n:e.createQuery(),i)}async function J8e(e,t,i,r){const s=await mb(e);if(!s.queryRelatedFeatures)throw new H(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(aA.from(t),i)}async function K8e(e,t,i,r){const s=await mb(e);if(!s.queryRelatedFeaturesCount)throw new H(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(aA.from(t),i)}async function Q8e(e){const t=e.source;if(t!=null&&t.refresh)try{const{dataChanged:i,updates:r}=await t.refresh();if(v(r)&&(e.sourceJSON={...e.sourceJSON,...r},e.read(r,{origin:"service",url:e.parsedUrl})),i)return!0}catch{}if(e.definitionExpression)try{return(await G4e(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function eVe(e){const t=new mg,i=e.get("capabilities.data"),r=e.get("capabilities.query");t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),i.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:s,timeExtent:n}=e;return t.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function e1e(e){const{globalIdField:t,fields:i}=e;if(t)return t;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function t1e(e){const{objectIdField:t,fields:i}=e;if(t)return t;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function tVe(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}async function mb(e){return(await e.load()).source}async function iVe(e,t){if(!Sr||Sr.findCredential(e))return;let i;try{const r=await j0e(e,t);r&&(i=await Sr.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=v(t)?t.signal:null;await Sr.getCredential(e,{signal:r})}catch{}}async function rVe(e,t){var s;const i=(s=e.parsedUrl)==null?void 0:s.path;if(!i)return;const r=e.editFieldsInfo;(e.userHasUpdateItemPrivileges||e.userHasFullEditingPrivileges&&e.capabilities.operations.supportsEditing||(r==null?void 0:r.creatorField)||(r==null?void 0:r.editorField))&&await iVe(i,t)}function sVe(e){var t;return!((t=e.sourceJSON)!=null&&t.isMultiServicesView)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}let H2=class extends Ys(ge){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],H2.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],H2.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:e=>R$e.read(e)||O$e.read(e)}})],H2.prototype,"units",void 0),H2=u([P("esri.layers.support.GeometryFieldsInfo")],H2);const nVe=H2;var kq;let q2=kq=class extends ge{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Qe}clone(){return new kq({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],q2.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],q2.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],q2.prototype,"viewAllLevelIds",void 0),q2=kq=u([P("esri.layers.support.LayerFloorInfo")],q2);const oVe=q2,$se=new _i({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Lse=new _i({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let yd=class extends Ys(ge){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:$se.read,write:$se.write}})],yd.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],yd.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],yd.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],yd.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],yd.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],yd.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],yd.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],yd.prototype,"relationshipTableId",void 0),u([d({json:{read:Lse.read,write:Lse.write}})],yd.prototype,"role",void 0),yd=u([P("esri.layers.support.Relationship")],yd);const aVe=yd,lVe={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function ti(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function FL(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function cVe(e){var i;const t=(i=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(t!=null&&t.includes("envelopeaggregate")),centroid:!!(t!=null&&t.includes("centroidaggregate")),convexHull:!!(t!=null&&t.includes("convexhullaggregate"))}}function E$(e,t){var r;const i=(r=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i!=null&&i.includes(t.toLowerCase()))}function i1e(e,t){return{analytics:uVe(e),attachment:hVe(e),data:dVe(e),metadata:pVe(e),operations:fVe(e.capabilities,e,t),query:mVe(e,t),queryRelated:gVe(e),queryTopFeatures:yVe(e),editing:_Ve(e)}}function uVe(e){return{supportsCacheHint:E$(e.advancedQueryCapabilities,"queryAnalytics")}}function hVe(e){const t=e.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:E$(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:ti(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(r=>{const s=lVe[r.name];s&&(i[s]=!!r.isEnabled)}),i}function dVe(e){return{isVersioned:ti(e,"isDataVersioned",!1),supportsAttachment:ti(e,"hasAttachments",!1),supportsM:ti(e,"hasM",!1),supportsZ:ti(e,"hasZ",!1)}}function pVe(e){return{supportsAdvancedFieldProperties:ti(e,"supportsFieldDescriptionProperty",!1)}}function fVe(e,t,i){const r=e?e.toLowerCase().split(",").map(f=>f.trim()):[],s=i?oM(i):null,n=r.includes(v(s)&&s.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!t.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const h=r.includes("changetracking"),p=t.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:ti(t,"supportsCalculate",!1),supportsTruncate:ti(t,"supportsTruncate",!1),supportsValidateSql:ti(t,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:ti(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:ti(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:ti(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:ti(t,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:ti(t,"supportsExceedsLimitStatistics",!1)}}function mVe(e,t){var h;const i=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,s=e.archivingInfo,n=e.currentVersion,o=t==null?void 0:t.includes("MapServer"),a=!o||n>=he("mapserver-pbf-version-support"),l=D_e(t),c=new Set(((h=e.supportedQueryFormats)!=null?h:"").split(",").map(p=>p.toLowerCase().trim()));return{supportsStatistics:ti(i,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:ti(i,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:ti(i,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:cVe(i),supportsCentroid:ti(i,"supportsReturningGeometryCentroid",!1),supportsDistance:ti(i,"supportsQueryWithDistance",!1),supportsDistinct:ti(i,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:ti(i,"supportsReturningQueryExtent",!1),supportsGeometryProperties:ti(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:ti(i,"supportsHavingClause",!1),supportsOrderBy:ti(i,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:ti(i,"supportsPagination",!1),supportsQuantization:ti(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:ti(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:ti(e,"supportsReturningQueryGeometry",!1),supportsResultType:ti(i,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:ti(i,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:ti(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:ti(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:ti(i,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:ti(r,"allowOthersToQuery",!0),supportsHistoricMoment:ti(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:ti(i,"supportsDisjointSpatialRel",!1),supportsCacheHint:ti(i,"supportsQueryWithCacheHint",!1)||E$(i,"query"),supportsDefaultSpatialReference:ti(i,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:ti(i,"supportsFullTextSearch",!1),maxRecordCountFactor:FL(e,"maxRecordCountFactor",void 0),maxRecordCount:FL(e,"maxRecordCount",void 0),standardMaxRecordCount:FL(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:FL(e,"tileMaxRecordCount",void 0)}}function gVe(e){const t=e.advancedQueryCapabilities,i=ti(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:ti(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:E$(t,"queryRelated")}}function yVe(e){return{supportsCacheHint:E$(e.advancedQueryCapabilities,"queryTopFilter")}}function _Ve(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:ti(e,"allowGeometryUpdates",!0),supportsGlobalId:ti(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:ti(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:ti(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:ti(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:ti(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:ti(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:ti(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:ti(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:ti(t,"allowOthersToUpdate",!0)}}const vVe=e=>{let t=class extends e{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=et.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(Qe.ofType(jm)),this.version=void 0}readCapabilitiesFromService(i,r){return i1e(r,this.url)}get effectiveCapabilities(){var o;const i=this.capabilities;if(!i)return null;const r=ne(i),{operations:s,editing:n}=r;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),r)}readEditingInfo(i,r){const{editingInfo:s}=r;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(i,r){return r.type==="Table"}readMinScale(i,r){return r.effectiveMinScale||i||0}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readGlobalIdFieldFromService(i,r){return e1e(r)}readObjectIdFieldFromService(i,r){return t1e(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){const r=ike({layer:this,url:i,nonStandardUrlAllowed:!0,logger:se.getLogger(this.declaredClass)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){rke(this,i,null,r,n)}readVersion(i,r){return tVe(r)}};return u([d({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],t.prototype,"capabilities",void 0),u([Fe("service","capabilities")],t.prototype,"readCapabilitiesFromService",null),u([d({readOnly:!0})],t.prototype,"effectiveCapabilities",null),u([d({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),u([d({type:oA})],t.prototype,"dateFieldsTimeReference",void 0),u([d({type:Boolean})],t.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],t.prototype,"definitionExpression",void 0),u([d({readOnly:!0,type:B8e})],t.prototype,"editFieldsInfo",void 0),u([d({readOnly:!0})],t.prototype,"editingInfo",void 0),u([Fe("editingInfo")],t.prototype,"readEditingInfo",null),u([d((()=>{const i=ne(L6e),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],t.prototype,"elevationInfo",void 0),u([d({type:oVe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],t.prototype,"floorInfo",void 0),u([d({type:Gi,json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0),u([d()],t.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:nVe,json:{read:{source:"geometryProperties"}}})],t.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Nq.read}}}})],t.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasZ",void 0),u([d({readOnly:!0,type:cM})],t.prototype,"heightModelInfo",void 0),u([d({type:Date})],t.prototype,"historicMoment",void 0),u([d({readOnly:!0})],t.prototype,"isTable",void 0),u([Fe("service","isTable",["type"])],t.prototype,"readIsTableFromService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],t.prototype,"layerId",void 0),u([d(N6e)],t.prototype,"minScale",void 0),u([Fe("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),u([d(k6e)],t.prototype,"maxScale",void 0),u([Fe("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),u([d({type:String})],t.prototype,"globalIdField",void 0),u([Fe("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),u([d({type:String})],t.prototype,"objectIdField",void 0),u([Fe("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),u([d({type:oA})],t.prototype,"preferredTimeReference",void 0),u([d({type:[aVe],readOnly:!0})],t.prototype,"relationships",void 0),u([d()],t.prototype,"sourceJSON",void 0),u([d({type:Boolean})],t.prototype,"returnM",void 0),u([d({type:Boolean})],t.prototype,"returnZ",void 0),u([d({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),u([Fe("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),u([d({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"serviceItemId",void 0),u([d({type:et,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],t.prototype,"spatialReference",void 0),u([d({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],t.prototype,"subtypeField",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),u([d({readOnly:!0,json:{write:!1}})],t.prototype,"serverGens",void 0),u([d({type:Qe.ofType(jm),readOnly:!0})],t.prototype,"indexes",void 0),u([d(P6e)],t.prototype,"url",null),u([Ge("url")],t.prototype,"writeUrl",null),u([d({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),u([Fe("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),t=u([P("esri.layers.mixins.FeatureLayerBase")],t),t};let W2=class extends Ys(ge){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([d({type:String,json:{write:!0}})],W2.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],W2.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],W2.prototype,"returnType",void 0),W2=u([P("esri.layers.support.ExpressionInfo")],W2);const sK=W2;var Uq;let $y=Uq=class extends ge{constructor(e){super(e),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new Uq({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:ne(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([d({type:Boolean,json:{write:!0}})],$y.prototype,"isAutoGenerated",void 0),u([d({type:String,json:{write:!0}})],$y.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],$y.prototype,"alias",void 0),u([d({type:String,json:{write:!0}})],$y.prototype,"onStatisticField",void 0),u([d({type:sK,json:{write:!0}})],$y.prototype,"onStatisticExpression",void 0),u([d({type:String,json:{write:!0}})],$y.prototype,"statisticType",void 0),$y=Uq=u([P("esri.layers.support.AggregateField")],$y);const gT=$y;let R1=class extends ge{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],R1.prototype,"type",void 0),R1=u([P("esri.layers.support.FeatureReduction")],R1);const nK="__begin__",oK="__end__",bVe=new RegExp(nK,"ig"),wVe=new RegExp(oK,"ig"),Dse=new RegExp("^"+nK,"i"),Fse=new RegExp(oK+"$","i"),k5='"',xVe=k5+" + ",TVe=" + "+k5;function SVe(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function EVe(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function wU(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=SVe(e.labelExpression),t.type="conventional"),t}function CVe(e){const t=wU(e);if(!t)return null;switch(t.type){case"conventional":return Vq(t.expression);case"arcade":return t.expression}return null}function AVe(e){const t=wU(e);if(!t)return null;switch(t.type){case"conventional":return RVe(t.expression);case"arcade":return aK(t.expression)}return null}function Vq(e){let t;return e?(t=Sg(e,i=>nK+'$feature["'+i+'"]'+oK),t=Dse.test(t)?t.replace(Dse,""):k5+t,t=Fse.test(t)?t.replace(Fse,""):t+k5,t=t.replace(bVe,xVe).replace(wVe,TVe)):t='""',t}const MVe=/^\s*\{([^}]+)\}\s*$/i;function RVe(e){const t=e==null?void 0:e.match(MVe);return t&&t[1].trim()||null}const OVe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,IVe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,PVe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function aK(e){if(!e)return null;let t=OVe.exec(e)||IVe.exec(e);return t?t[1]||t[3]:(t=PVe.exec(e),t?t[2]:null)}var Bq;let dv=Bq=class extends ge{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?Vq(t.value):e}writeExpression(e,t,i){this.value!=null&&(e=Vq(this.value)),e!=null&&(t[i]=e)}clone(){return new Bq({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],dv.prototype,"expression",void 0),u([Fe("expression",["expression","value"])],dv.prototype,"readExpression",null),u([Ge("expression")],dv.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],dv.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],dv.prototype,"value",void 0),dv=Bq=u([P("esri.layers.support.LabelExpressionInfo")],dv);const r1e=dv,s1e=[252,146,31,255],IMt=[153,153,153,255],$Ve={type:"esriSMS",style:"esriSMSCircle",size:6,color:s1e,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},LVe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:s1e},DVe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},FVe={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},NVe={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},kVe={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},UVe={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},PMt=fb.fromJSON($Ve),$Mt=Nu.fromJSON(LVe),LMt=H0.fromJSON(DVe),VVe=iS.fromJSON(FVe);fb.fromJSON(NVe);Nu.fromJSON(kVe);H0.fromJSON(UVe);var zq;const NL=new _i({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function kL(e,t,i){return{enabled:!z0e(i==null?void 0:i.layer)}}function n1e(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function BVe(e){return(e==null?void 0:e.type)==="map-image"}function o1e(e){var t,i;return!!BVe(e)&&!!((i=(t=e.capabilities)==null?void 0:t.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function zVe(e){return n1e(e)||o1e(e==null?void 0:e.layer)}let Hn=zq=class extends ge{static evaluateWhere(e,t){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return i(t[r[0]],r[1],r[2]);if(r.length===7){const s=i(t[r[0]],r[1],r[2]),n=r[3],o=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=VVe,this.useCodedValues=void 0,this.where=null}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=EVe(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=aK(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(e==null&&this.labelExpression!=null&&n1e(r))e=new r1e({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return wU(this)}getLabelExpressionArcade(){return CVe(this)}getLabelExpressionSingleField(){return AVe(this)}hash(){return JSON.stringify(this)}clone(){return new zq({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ne(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ne(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],Hn.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:kL}}}}})],Hn.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:kL}}}}})],Hn.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&o1e(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],Hn.prototype,"labelExpression",void 0),u([Fe("labelExpression")],Hn.prototype,"readLabelExpression",null),u([Ge("labelExpression")],Hn.prototype,"writeLabelExpression",null),u([d({type:r1e,json:{write:{overridePolicy:(e,t,i)=>zVe(i)?{allowNull:!0}:{enabled:!1}}}})],Hn.prototype,"labelExpressionInfo",void 0),u([Ge("labelExpressionInfo")],Hn.prototype,"writeLabelExpressionInfo",null),u([d({type:NL.apiValues,json:{type:NL.jsonValues,read:NL.read,write:NL.write}})],Hn.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Hn.prototype,"labelPosition",void 0),u([d({type:Number})],Hn.prototype,"maxScale",void 0),u([Ge("maxScale")],Hn.prototype,"writeMaxScale",null),u([d({type:Number})],Hn.prototype,"minScale",void 0),u([Ge("minScale")],Hn.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:kL}}}}})],Hn.prototype,"repeatLabel",void 0),u([d({type:Number,cast:Cr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:kL}}}}})],Hn.prototype,"repeatLabelDistance",void 0),u([d({types:xNe,json:{origins:{"web-scene":{types:TNe,write:dre,default:null}},write:dre,default:null}})],Hn.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],Hn.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],Hn.prototype,"where",void 0),Hn=zq=u([P("esri.layers.support.LabelClass")],Hn);const xU=Hn;var Gq;const F9=ub({types:Q6}),GVe="esri.layers.support.FeatureReductionBinning";let mc=Gq=class extends R1{constructor(e){super(e),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(e,t,i){const r=e.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Sa(i,r,t)}readRenderer(e,t,i){var s,n;const r=(s=t.drawingInfo)==null?void 0:s.renderer;return r?(n=UI(r,t,i))!=null?n:void 0:t.defaultSymbol?t.types&&t.types.length?new _$({defaultSymbol:F9(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(o=>({id:o.id,symbol:F9(o.symbol,o,i)}))}):new f0({symbol:F9(t.defaultSymbol,t,i)}):null}clone(){return new Gq({fields:ne(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ne(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:ne(this.popupTemplate),renderer:ne(this.renderer)})}};u([bt({binning:"binning"})],mc.prototype,"type",void 0),u([bt({geohash:"geohash"})],mc.prototype,"binType",void 0),u([d({type:Number,range:{min:1,max:9},json:{write:!0}})],mc.prototype,"fixedBinLevel",void 0),u([d({type:[xU],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],mc.prototype,"labelingInfo",void 0),u([d(YJ)],mc.prototype,"labelsVisible",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],mc.prototype,"maxScale",void 0),u([d(XJ)],mc.prototype,"popupEnabled",void 0),u([d({type:KT,json:{name:"popupInfo",write:!0}})],mc.prototype,"popupTemplate",void 0),u([d({type:[gT],json:{write:!0}})],mc.prototype,"fields",void 0),u([Ge("fields")],mc.prototype,"writeFields",null),u([d({types:rU,json:{write:{target:"drawingInfo.renderer"}}})],mc.prototype,"renderer",void 0),u([Fe("renderer",["drawingInfo.renderer"])],mc.prototype,"readRenderer",null),mc=Gq=u([P(GVe)],mc);const a1e=mc;var jq;const N9=ub({types:Q6}),jVe="esri.layers.support.FeatureReductionCluster";function Nse(e){var t;return e.type==="simple"&&!((t=e.visualVariables)!=null&&t.length)}let Lo=jq=class extends ge{constructor(e){super(e),this.type="cluster",this.clusterRadius=Cr("80px"),this.clusterMinSize=Cr("12px"),this.clusterMaxSize=Cr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(e,t,i){var s,n,o;const r=(s=t.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r?Nse(r)?null:(o=UI(r,t,i))!=null?o:void 0:t.defaultSymbol?t.types&&t.types.length?new _$({defaultSymbol:N9(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(a=>({id:a.id,symbol:N9(a.symbol,a,i)}))}):new f0({symbol:N9(t.defaultSymbol,t,i)}):null}readSymbol(e,t,i){var s,n,o;const r=(s=t.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r&&Nse(r)?(o=UI(r,t,i))==null?void 0:o.symbol:null}writeSymbol(e,t,i,r){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new f0({symbol:e});t.drawingInfo={renderer:a.write({},r)}}}writeFields(e,t,i){const r=e.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Sa(i,r,t)}readFields(e,t,i){return e.filter(r=>!r.isAutoGenerated).map(r=>gT.fromJSON(r))}clone(){return new jq({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ne(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ne(this.fields),maxScale:this.maxScale,renderer:ne(this.renderer),symbol:ne(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:ne(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Lo.prototype,"type",void 0),u([d({type:Number,cast:e=>e==="auto"?e:Cr(e),json:{write:!0}})],Lo.prototype,"clusterRadius",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],Lo.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:Cr,json:{write:!0}})],Lo.prototype,"clusterMaxSize",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Lo.prototype,"maxScale",void 0),u([d(XJ)],Lo.prototype,"popupEnabled",void 0),u([d({type:KT,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Lo.prototype,"popupTemplate",void 0),u([d({types:rU,json:{write:{target:"drawingInfo.renderer"}}})],Lo.prototype,"renderer",void 0),u([Fe("renderer",["drawingInfo.renderer"])],Lo.prototype,"readRenderer",null),u([d({types:bNe})],Lo.prototype,"symbol",void 0),u([Fe("symbol",["drawingInfo.renderer"])],Lo.prototype,"readSymbol",null),u([Ge("symbol")],Lo.prototype,"writeSymbol",null),u([d({type:[xU],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Lo.prototype,"labelingInfo",void 0),u([d(YJ)],Lo.prototype,"labelsVisible",void 0),u([d({type:[gT],json:{write:!0}})],Lo.prototype,"fields",void 0),u([Ge("fields")],Lo.prototype,"writeFields",null),u([Fe("fields")],Lo.prototype,"readFields",null),Lo=jq=u([P(jVe)],Lo);const l1e=Lo;var Hq;let JN=Hq=class extends R1{constructor(e){super(e),this.type="selection"}clone(){return new Hq}};u([d({type:["selection"]})],JN.prototype,"type",void 0),JN=Hq=u([P("esri.layers.support.FeatureReductionSelection")],JN);const kse=JN,Use={key:"type",base:R1,typeMap:{cluster:l1e,binning:a1e}},HVe={types:{key:"type",base:R1,typeMap:{selection:kse,cluster:l1e,binning:a1e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Use},"portal-item":{types:Use},"web-scene":{types:{key:"type",base:R1,typeMap:{selection:kse}}}}}},gS={Base64:0,Hex:1,String:2,Raw:3},pC=8,c1e=(1<<pC)-1;function u1(e,t){const i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function qVe(e){const t=[];for(let i=0,r=e.length*pC;i<r;i+=pC)t[i>>5]|=(e.charCodeAt(i/pC)&c1e)<<i%32;return t}function WVe(e){const t=[];for(let i=0,r=32*e.length;i<r;i+=pC)t.push(String.fromCharCode(e[i>>5]>>>i%32&c1e));return t.join("")}function XVe(e){const t="0123456789abcdef",i=[];for(let r=0,s=4*e.length;r<s;r++)i.push(t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15));return i.join("")}function YVe(e){const t="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*e.length;s<n;s+=3){const o=(e[s>>2]>>s%4*8&255)<<16|(e[s+1>>2]>>(s+1)%4*8&255)<<8|e[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*e.length?r.push(t):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function ZVe(e,t){return e<<t|e>>>32-t}function TU(e,t,i,r,s,n){return u1(ZVe(u1(u1(t,e),u1(r,n)),s),i)}function Sl(e,t,i,r,s,n,o){return TU(t&i|~t&r,e,t,s,n,o)}function El(e,t,i,r,s,n,o){return TU(t&r|i&~r,e,t,s,n,o)}function Cl(e,t,i,r,s,n,o){return TU(t^i^r,e,t,s,n,o)}function Al(e,t,i,r,s,n,o){return TU(i^(t|~r),e,t,s,n,o)}function JVe(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let o=0;o<e.length;o+=16){const a=i,l=r,c=s,h=n;i=Sl(i,r,s,n,e[o+0],7,-680876936),n=Sl(n,i,r,s,e[o+1],12,-389564586),s=Sl(s,n,i,r,e[o+2],17,606105819),r=Sl(r,s,n,i,e[o+3],22,-1044525330),i=Sl(i,r,s,n,e[o+4],7,-176418897),n=Sl(n,i,r,s,e[o+5],12,1200080426),s=Sl(s,n,i,r,e[o+6],17,-1473231341),r=Sl(r,s,n,i,e[o+7],22,-45705983),i=Sl(i,r,s,n,e[o+8],7,1770035416),n=Sl(n,i,r,s,e[o+9],12,-1958414417),s=Sl(s,n,i,r,e[o+10],17,-42063),r=Sl(r,s,n,i,e[o+11],22,-1990404162),i=Sl(i,r,s,n,e[o+12],7,1804603682),n=Sl(n,i,r,s,e[o+13],12,-40341101),s=Sl(s,n,i,r,e[o+14],17,-1502002290),r=Sl(r,s,n,i,e[o+15],22,1236535329),i=El(i,r,s,n,e[o+1],5,-165796510),n=El(n,i,r,s,e[o+6],9,-1069501632),s=El(s,n,i,r,e[o+11],14,643717713),r=El(r,s,n,i,e[o+0],20,-373897302),i=El(i,r,s,n,e[o+5],5,-701558691),n=El(n,i,r,s,e[o+10],9,38016083),s=El(s,n,i,r,e[o+15],14,-660478335),r=El(r,s,n,i,e[o+4],20,-405537848),i=El(i,r,s,n,e[o+9],5,568446438),n=El(n,i,r,s,e[o+14],9,-1019803690),s=El(s,n,i,r,e[o+3],14,-187363961),r=El(r,s,n,i,e[o+8],20,1163531501),i=El(i,r,s,n,e[o+13],5,-1444681467),n=El(n,i,r,s,e[o+2],9,-51403784),s=El(s,n,i,r,e[o+7],14,1735328473),r=El(r,s,n,i,e[o+12],20,-1926607734),i=Cl(i,r,s,n,e[o+5],4,-378558),n=Cl(n,i,r,s,e[o+8],11,-2022574463),s=Cl(s,n,i,r,e[o+11],16,1839030562),r=Cl(r,s,n,i,e[o+14],23,-35309556),i=Cl(i,r,s,n,e[o+1],4,-1530992060),n=Cl(n,i,r,s,e[o+4],11,1272893353),s=Cl(s,n,i,r,e[o+7],16,-155497632),r=Cl(r,s,n,i,e[o+10],23,-1094730640),i=Cl(i,r,s,n,e[o+13],4,681279174),n=Cl(n,i,r,s,e[o+0],11,-358537222),s=Cl(s,n,i,r,e[o+3],16,-722521979),r=Cl(r,s,n,i,e[o+6],23,76029189),i=Cl(i,r,s,n,e[o+9],4,-640364487),n=Cl(n,i,r,s,e[o+12],11,-421815835),s=Cl(s,n,i,r,e[o+15],16,530742520),r=Cl(r,s,n,i,e[o+2],23,-995338651),i=Al(i,r,s,n,e[o+0],6,-198630844),n=Al(n,i,r,s,e[o+7],10,1126891415),s=Al(s,n,i,r,e[o+14],15,-1416354905),r=Al(r,s,n,i,e[o+5],21,-57434055),i=Al(i,r,s,n,e[o+12],6,1700485571),n=Al(n,i,r,s,e[o+3],10,-1894986606),s=Al(s,n,i,r,e[o+10],15,-1051523),r=Al(r,s,n,i,e[o+1],21,-2054922799),i=Al(i,r,s,n,e[o+8],6,1873313359),n=Al(n,i,r,s,e[o+15],10,-30611744),s=Al(s,n,i,r,e[o+6],15,-1560198380),r=Al(r,s,n,i,e[o+13],21,1309151649),i=Al(i,r,s,n,e[o+4],6,-145523070),n=Al(n,i,r,s,e[o+11],10,-1120210379),s=Al(s,n,i,r,e[o+2],15,718787259),r=Al(r,s,n,i,e[o+9],21,-343485551),i=u1(i,a),r=u1(r,l),s=u1(s,c),n=u1(n,h)}return[i,r,s,n]}function u1e(e,t=gS.Hex){const i=t||gS.Base64,r=JVe(qVe(e),e.length*pC);switch(i){case gS.Raw:return r;case gS.Hex:return XVe(r);case gS.String:return WVe(r);case gS.Base64:return YVe(r)}}var qq;let MO=qq=class extends iU{writeLevels(e,t,i){for(const r in e){const s=this.levels[r];return void(t.stops=s)}}clone(){return new qq({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:c1(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:c1(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:ne(this.levels)})}};u([d()],MO.prototype,"levels",void 0),u([Ge("levels")],MO.prototype,"writeLevels",null),MO=qq=u([P("esri.views.2d.engine.LevelDependentSizeVariable")],MO);const KVe=se.getLogger("esri.views.2d.layers.support.clusterUtils");he.add("esri-cluster-arcade-enabled",!0);const QVe=he("esri-cluster-arcade-enabled"),e9e=(e,t,i,r,s)=>{const n=t.clone();if(!s9e(n))return n;if(n.authoringInfo||(n.authoringInfo=new wJ),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=t9e(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=Cb(e,l.field,"avg_angle","number"):l.valueExpression&&(l.field=HM(e,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=Cb(e,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=Cb(e,l.field,"avg","number"):l.valueExpression&&(l.field=HM(e,l.valueExpression,"avg","number"),l.valueExpression=null)}),C(a)&&!i9e(o)&&s&&(o.push(r9e(i,r)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=Cb(e,o.field,"sum","number"):o.valueExpression&&(o.field=HM(e,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=Cb(e,n.field,"mode","string"):n.valueExpression&&(n.field=HM(e,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=Cb(e,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=Cb(e,n.field,"avg","number"):n.valueExpression&&(n.field=HM(e,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},t9e=e=>{for(const t of e)if(t.type==="size")return t;return null},i9e=e=>{for(const t of e)if(t.field==="cluster_count")return!0;return!1},r9e=(e,t)=>{const i=[new F2({value:0,size:0}),new F2({value:1})];if(C(t))return new iU({field:"cluster_count",stops:[...i,new F2({value:2,size:0})]});const r=Object.keys(t).reduce((s,n)=>({...s,[n]:[...i,new F2({value:Math.max(2,t[n].minValue),size:e.clusterMinSize}),new F2({value:Math.max(3,t[n].maxValue),size:e.clusterMaxSize})]}),{});return new MO({field:"cluster_count",levels:r})},s9e=e=>{const t=i=>KVe.error(new H("Unsupported-renderer",i,{renderer:e}));switch(e.type){case"unique-value":if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(e.normalizationField){const i=e.normalizationType;if(i!=="field")return t(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return t(`FeatureReductionCluster does not support renderers of type ${e.type}`),!1}if(!QVe){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function n9e(e,t,i){switch(e){case"sum":return`cluster_sum_${t}`;case"avg":case"avg_angle":return`cluster_avg_${t}`;case"mode":return`cluster_type_${t}`;case"avg_norm":{const r=i,s="field",n=t.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+u1e(n)}}}function HM(e,t,i,r){const s=u1e(t),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return e.some(o=>o.name===n)||e.push(new gT({name:n,isAutoGenerated:!0,onStatisticExpression:new sK({expression:t,returnType:r}),statisticType:i})),n}function Cb(e,t,i,r,s){if(t==="cluster_count"||e.some(o=>o.name===t))return t;const n=n9e(i,t,s);return e.some(o=>o.name===n)||(i==="avg_norm"?e.push(new gT({name:n,isAutoGenerated:!0,onStatisticExpression:new sK({expression:`$feature.${t} / $feature.${s}`,returnType:r}),statisticType:"avg"})):e.push(new gT({name:n,isAutoGenerated:!0,onStatisticField:t,statisticType:i}))),n}const o9e=e=>{let t=class extends e{constructor(...i){super(...i),this.own(this.watch("renderer",()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},!0))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_normalizeFeatureReduction(i){var a,l;if((i==null?void 0:i.type)!=="cluster")return i;const r=i.clone(),s=[new gT({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=((a=r.fields)!=null?a:[]).filter(c=>!c.isAutoGenerated);if(i.renderer&&!((l=i.renderer.authoringInfo)!=null&&l.isAutoGenerated))return r.fields=[...s,...n],r;if(i.symbol)return r.fields=[...s,...n],r.renderer=null,r;if(!this.renderer)return i;const o=e9e(s,this.renderer,i,null,!1);return r.fields=[...s,...n],r.renderer=o,r}};return u([d(HVe)],t.prototype,"featureReduction",null),t=u([P("esri.layers.mixins.FeatureReductionLayer")],t),t},a9e={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},h1e=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&o$e(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i!=null?i:"Layer"}read(i,r){r&&(r.layer=this),r$e(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=a9e[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new H("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof H&&l.name==="web-document-write:property-required").length;return QC(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new H("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([d(eve)],t.prototype,"listMode",void 0),u([Ge("listMode")],t.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([Ge("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([d(Aq)],t.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([Ge("title"),Ge(["web-scene"],"title")],t.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([P("esri.layers.mixins.OperationalLayer")],t),t};var Wq;const k9=new _i({asc:"ascending",desc:"descending"});let X2=Wq=class extends ge{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Wq({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],X2.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],X2.prototype,"valueExpression",void 0),u([d({type:k9.apiValues,json:{read:k9.read,write:k9.write}})],X2.prototype,"order",void 0),X2=Wq=u([P("esri.layers.support.OrderByInfo")],X2);const d1e=X2;function l9e(e,t,i){if(!e)return null;const r=e.find(n=>!!n.field);if(!r)return null;const s=new d1e;return s.read(r,i),[s]}function c9e(e,t,i,r){const s=e.find(n=>!!n.field);s&&Sa(i,[s.toJSON()],t)}const u9e=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[d1e],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:l9e},write:{target:"layerDefinition.orderBy",writer:c9e}}})],t.prototype,"orderBy",void 0),t=u([P("esri.layers.mixins.OrderedLayer")],t),t};function SU(e,t,i){return Eo(e.map((r,s)=>t.apply(i,[r,s])))}async function h9e(e,t,i){return(await Eo(e.map((r,s)=>t.apply(i,[r,s])))).map(r=>r.value)}function lK(e){return{ok:!0,value:e}}function cK(e){return{ok:!1,error:e}}function d9e(e){return v(e)&&e.ok===!0?e.value:null}function p9e(e){return v(e)&&e.ok===!1?e.error:null}async function kf(e){if(C(e))return{ok:!1,error:new Error("no promise provided")};try{return lK(await e)}catch(t){return cK(t)}}async function DMt(e){try{return lK(await e)}catch(t){return bu(t),cK(t)}}function FMt(e){if(e.ok===!0)return e.value;throw e.error}function C$(e,t){return new pv(e,t)}let pv=class extends Te{get value(){return d9e(this._result)}get error(){return p9e(this._result)}get finished(){return v(this._result)}constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=ep(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(r=>{this._result=lK(r),this._cleanup()},r=>{this._result=cK(r),this._cleanup()}),this._abortHandle=fl(t,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=hs(this._abortHandle),this._abortController=null}};u([d()],pv.prototype,"value",null),u([d()],pv.prototype,"error",null),u([d()],pv.prototype,"finished",null),u([d()],pv.prototype,"promise",void 0),u([d()],pv.prototype,"_result",void 0),pv=u([P("esri.core.asyncUtils.ReactiveTask")],pv);let fv=class extends Te{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){v(e)&&Nh(e)?se.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(C(i))throw new H("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:oo(t,"signal")})}async update(e,t){return(await Q(()=>import("./resourceUtils.8a74c93f.js"),[])).addOrUpdateResource(this,"update",e,t)}hasPath(){return v(this.path)}_normalizePath(e,t){return C(e)?e:(e=e.replace(/^\/+/,""),v(t)&&Nh(e)&&(e=oJ(e,t.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],fv.prototype,"portalItem",void 0),u([d({type:String,value:null})],fv.prototype,"path",null),u([Zt("path")],fv.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],fv.prototype,"url",null),u([d({type:String,readOnly:!0})],fv.prototype,"itemRelativeUrl",null),fv=u([P("esri.portal.PortalItemResource")],fv);const f9e=fv;let RO=class extends Te{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],RO.prototype,"created",void 0),u([d()],RO.prototype,"rating",void 0),RO=u([P("esri.portal.PortalRating")],RO);const U9=RO;var Gw;const m9e=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),g9e=new Set(["KML","GeoJson","CSV"]);let Ei=Gw=class extends l$(sp){static from(e){return VC(Gw,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Video Service"?i="Video Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?i="Locator":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")?i="Instant App":e==="Insights Page"&&(i="Insights Report"),i}readExtent(e){return e&&e.length?new Gi(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="pro report template"?"proreporttemplate":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"||e==="notebook code snippet library"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":e==="discussion"?"discussion":e==="allsource project"?"allsourceproject":e==="api key"?"apikey":"maps",s?Vi(i+s+r+".png"):null}get isLayer(){return this.type!=null&&m9e.has(this.type)}get itemPageUrl(){var t;const e=(t=this.portal)==null?void 0:t.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){var t;const e=(t=this.portal)==null?void 0:t.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){var i,r;const e=this.itemUrl,t=this.thumbnail;return e&&t&&(r=(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${t}?f=json`))!=null?r:null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){var r;const t=(r=this.portal)!=null?r:this.portal=po.getDefault(),i=t.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:v(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(s=>{this.sourceJSON=s,this.read(s)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof U9&&(e=e.rating),e==null||isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new U9({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:ne(this.applicationProxies),avgRating:this.avgRating,categories:ne(this.categories),created:ne(this.created),culture:this.culture,description:this.description,extent:ne(this.extent),groupCategories:ne(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ne(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ne(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ne(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ne(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new Gw({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const i of["tags","typeKeywords","categories"])e[i]&&(e[i]=e[i].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}async deleteRating(){await ba(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return ba(this.portal).request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await ba(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return t.rating!=null?(t.created=new Date(t.created),new U9(t)):null}fetchRelatedItems(e,t){return ba(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},Gw)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){var e;return ba(this.portal).request((e=this.itemUrl)!=null?e:"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(e){return this.id?this.load().then(()=>ba(this.portal).signIn()).then(()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new H("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:i}=this;await ba(t).signIn();const{copyResources:r,folder:s,tags:n,title:o}=e||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!r,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await t.request(`${i}/copy`,a);return new Gw({id:l,portal:t})}updateThumbnail(e){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")Ug(t)?r.query={data:t}:r.query={url:Rh(t)},v(i)&&(r.query.filename=i);else{const s=new FormData;v(i)?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await Q(()=>import("./resourceUtils.8a74c93f.js"),[])).fetchResources(this,e,t)}async addResource(e,t,i){const r=await Q(()=>import("./resourceUtils.8a74c93f.js"),[]);return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await Q(()=>import("./resourceUtils.8a74c93f.js"),[]);if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new H("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await Q(()=>import("./resourceUtils.8a74c93f.js"),[])).removeAllResources(this,e)}resourceFromPath(e){return new f9e({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:ne(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ne(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ne(this.typeKeywords),url:this.url};return dme(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Gw({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([d({type:["private","shared","org","public"]})],Ei.prototype,"access",void 0),u([d()],Ei.prototype,"accessInformation",void 0),u([d({type:String})],Ei.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],Ei.prototype,"applicationProxies",void 0),u([d()],Ei.prototype,"avgRating",void 0),u([d()],Ei.prototype,"categories",void 0),u([d({type:Date})],Ei.prototype,"created",void 0),u([d()],Ei.prototype,"culture",void 0),u([d()],Ei.prototype,"description",void 0),u([d({readOnly:!0})],Ei.prototype,"displayName",null),u([d({type:Gi})],Ei.prototype,"extent",void 0),u([Fe("extent")],Ei.prototype,"readExtent",null),u([d()],Ei.prototype,"groupCategories",void 0),u([d({readOnly:!0})],Ei.prototype,"iconUrl",null),u([d()],Ei.prototype,"id",void 0),u([d({readOnly:!0})],Ei.prototype,"isLayer",null),u([d({type:Boolean,readOnly:!0})],Ei.prototype,"isOrgItem",void 0),u([d()],Ei.prototype,"itemControl",void 0),u([d({readOnly:!0})],Ei.prototype,"itemPageUrl",null),u([d({readOnly:!0})],Ei.prototype,"itemUrl",null),u([d()],Ei.prototype,"licenseInfo",void 0),u([d({type:Date})],Ei.prototype,"modified",void 0),u([d()],Ei.prototype,"name",void 0),u([d()],Ei.prototype,"numComments",void 0),u([d()],Ei.prototype,"numRatings",void 0),u([d()],Ei.prototype,"numViews",void 0),u([d()],Ei.prototype,"owner",void 0),u([d()],Ei.prototype,"ownerFolder",void 0),u([d({type:po})],Ei.prototype,"portal",void 0),u([d()],Ei.prototype,"screenshots",void 0),u([d()],Ei.prototype,"size",void 0),u([d()],Ei.prototype,"snippet",void 0),u([d()],Ei.prototype,"sourceJSON",void 0),u([d({type:String})],Ei.prototype,"sourceUrl",void 0),u([d({type:String})],Ei.prototype,"spatialReference",void 0),u([d()],Ei.prototype,"tags",void 0),u([d()],Ei.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Ei.prototype,"thumbnailUrl",null),u([d()],Ei.prototype,"title",void 0),u([d()],Ei.prototype,"type",void 0),u([d()],Ei.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(e,t){var i;if(g9e.has(t.type)){const r=(i=this.portal)==null?void 0:i.restUrl;e||(e=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return e}}})],Ei.prototype,"url",void 0),u([d({readOnly:!0})],Ei.prototype,"userItemUrl",null),Ei=Gw=u([P("esri.portal.PortalItem")],Ei);const L3=Ei;var p1e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:L3});let V9,oe=null;function f1e(){return!!oe}function y9e(){return!!he("esri-wasm")}function m1e(){return V9||(V9=Q(()=>import("./pe-wasm.c681b595.js"),[]).then(e=>e.p).then(({default:e})=>e({locateFile:t=>Vi(`esri/geometry/support/${t}`)})).then(e=>{y1e(e)}),V9)}var Xq,bn,Yq;(function(e){function t(n,o,a){oe.ensureCache.prepare();const l=fx(a),c=a===l,h=oe.ensureFloat64(l),p=oe._pe_geog_to_proj(oe.getPointer(n),o,h);return p&&Yv(a,o,h,c),p}function i(n,o,a,l){switch(l){case bn.PE_TRANSFORM_P_TO_G:return r(n,o,a);case bn.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){oe.ensureCache.prepare();const c=fx(a),h=a===c,p=oe.ensureFloat64(c),f=oe._pe_proj_to_geog_center(oe.getPointer(n),o,p,l);return f&&Yv(a,o,p,h),f}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(Xq||(Xq={})),function(e){function t(){e.PE_BUFFER_MAX=oe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=oe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=oe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=oe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=oe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=oe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=oe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=oe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=oe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=oe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=oe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=oe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=oe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=oe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=oe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=oe.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=oe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=oe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=oe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=oe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=oe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=oe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=oe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=oe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=oe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=oe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=oe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=oe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=oe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=oe.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(bn||(bn={})),function(e){const t={},i={},r=m=>{if(m){const y=m.getType();switch(y){case bn.PE_TYPE_GEOGCS:m=oe.castObject(m,oe.PeGeogcs);break;case bn.PE_TYPE_PROJCS:m=oe.castObject(m,oe.PeProjcs);break;case bn.PE_TYPE_GEOGTRAN:m=oe.castObject(m,oe.PeGeogtran);break;default:y&bn.PE_TYPE_UNIT&&(m=oe.castObject(m,oe.PeUnit))}}return m};function s(){oe.PeFactory.prototype.initialize(null)}function n(m){return o(bn.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,b=t[m];if(b||(b={},t[m]=b),b.hasOwnProperty(String(y)))_=b[y];else{const w=oe.PeFactory.prototype.factoryByType(m,y);oe.compare(w,oe.NULL)||(_=w,b[y]=_)}return _=r(_),_}function a(m,y){let _=null,b=i[m];if(b||(b={},i[m]=b),b.hasOwnProperty(y))_=b[y];else{const w=oe.PeFactory.prototype.fromString(m,y);oe.compare(w,oe.NULL)||(_=w,b[y]=_)}return _=r(_),_}function l(m){return o(bn.PE_TYPE_GEOGCS,m)}function c(m){return o(bn.PE_TYPE_GEOGTRAN,m)}function h(m){return oe.PeFactory.prototype.getCode(m)}function p(m){return o(bn.PE_TYPE_PROJCS,m)}function f(m){return o(bn.PE_TYPE_UNIT,m)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=f}(Yq||(Yq={}));let g1e=null;var U5,Zq,Jq,Kq,V5,Qq,B5,z5,eW;function y1e(e){function t(n,o,a){n[o]=a(n[o])}oe=e,bn.init(),U5.init(),V5.init(),B5.init(),z5.init(),g1e=class extends oe.PeGCSExtent{destroy(){oe.destroy(this)}};const i=[oe.PeDatum,oe.PeGeogcs,oe.PeGeogtran,oe.PeObject,oe.PeParameter,oe.PePrimem,oe.PeProjcs,oe.PeSpheroid,oe.PeUnit];for(const n of i)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(bn.PE_NAME_MAX))});for(const n of[oe.PeGeogtran,oe.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(bn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=oe.getValue(l,"*");a[c]=h?oe.wrapPointer(h,oe.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(oe.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return Yv(a,o,n.call(this)),a}),t(oe.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=oe._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=oe.getPointer(l);for(let p=1;p<c;p++)a.push(oe.wrapPointer(h+o*p,oe.PeGTlistExtendedGTs))}}return a}});const r=oe._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=l.getNump();if(c>1){const h=oe.getPointer(l);for(let p=1;p<c;p++)a.push(oe.wrapPointer(h+r*p,oe.PeHorizon))}}return o.set(n,a),a};t(oe.PeProjcs.prototype,"horizonGcsGenerate",s),t(oe.PeProjcs.prototype,"horizonPcsGenerate",s),oe.PeObject.prototype.toString=function(n=bn.PE_STR_OPTS_NONE){oe.ensureCache.prepare();const o=oe.getPointer(this),a=oe.ensureInt8(new Array(bn.PE_BUFFER_MAX));return oe.UTF8ToString(oe._pe_object_to_string_ext(o,n,a))}}function Jg(e){if(!e)return;const t=oe.getClass(e);if(!t)return;const i=oe.getCache(t);if(!i)return;const r=oe.getPointer(e);r&&delete i[r]}function UL(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(oe.ensureInt8(r));return i}function fx(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function Yv(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=oe.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=oe.getValue(i,"double"),e[n][1]=oe.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=oe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=oe._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const p=new oe.PeInteger(c);try{const f=oe.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=oe.getPointer(f);for(let y=1;y<c;y++)h.push(oe.wrapPointer(m+t*y,oe.PeGTlistExtendedEntry))}}finally{oe.destroy(p)}return h}e.init=i,e.getGTlist=r})(U5||(U5={})),function(e){function t(i){if(i&&i.length){for(const r of i)Jg(r),r.getEntries().forEach(s=>{Jg(s);const n=s.getGeogtran();Jg(n),n.getParameters().forEach(Jg),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Jg(o);const a=o.getDatum();Jg(a),Jg(a.getSpheroid()),Jg(o.getPrimem()),Jg(o.getUnit())})});oe.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(Zq||(Zq={})),function(e){function t(i,r,s,n,o){oe.ensureCache.prepare();const a=fx(s),l=s===a,c=oe.ensureFloat64(a);let h=0;n&&(h=oe.ensureFloat64(n));const p=oe._pe_geog_to_geog(oe.getPointer(i),r,c,h,o);return p&&Yv(s,r,c,l),p}e.geogToGeog=t}(Jq||(Jq={})),function(e){const t=(c,h,p,f,m,y)=>{let _,b;switch(oe.ensureCache.prepare(),c){case"dd":_=oe._pe_geog_to_dd,b=bn.PE_DD_MAX;break;case"ddm":_=oe._pe_geog_to_ddm,b=bn.PE_DDM_MAX;break;case"dms":_=oe._pe_geog_to_dms,b=bn.PE_DMS_MAX}let w=0;h&&(w=oe.getPointer(h));const T=fx(f),S=oe.ensureFloat64(T),E=UL(p,b),M=_(w,p,S,m,oe.ensureInt32(E));if(M)for(let A=0;A<p;A++)y[A]=oe.UTF8ToString(E[A]);return M},i=(c,h,p,f,m)=>{let y;switch(oe.ensureCache.prepare(),c){case"dd":y=oe._pe_dd_to_geog;break;case"ddm":y=oe._pe_ddm_to_geog;break;case"dms":y=oe._pe_dms_to_geog}let _=0;h&&(_=oe.getPointer(h));const b=f.map(E=>oe.ensureString(E)),w=oe.ensureInt32(b),T=oe.ensureFloat64(new Array(2*p)),S=y(_,p,w,T);return S&&Yv(m,p,T),S};function r(c,h,p,f,m){return t("dms",c,h,p,f,m)}function s(c,h,p,f){return i("dms",c,h,p,f)}function n(c,h,p,f,m){return t("ddm",c,h,p,f,m)}function o(c,h,p,f){return i("ddm",c,h,p,f)}function a(c,h,p,f,m){return t("dd",c,h,p,f,m)}function l(c,h,p,f){return i("dd",c,h,p,f)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(Kq||(Kq={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=oe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=oe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){oe.ensureCache.prepare();let p=0;s&&(p=oe.getPointer(s));const f=fx(o),m=oe.ensureFloat64(f),y=UL(n,bn.PE_MGRS_MAX),_=oe.ensureInt32(y),b=oe._pe_geog_to_mgrs_extended(p,n,m,a,l,c,_);if(b)for(let w=0;w<n;w++)h[w]=oe.UTF8ToString(y[w]);return b}function r(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=o.map(y=>oe.ensureString(y)),p=oe.ensureInt32(h),f=oe.ensureFloat64(new Array(2*n)),m=oe._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&Yv(l,n,f),m}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(V5||(V5={})),function(e){function t(r,s,n,o,a,l,c){oe.ensureCache.prepare();let h=0;r&&(h=oe.getPointer(r));const p=fx(n),f=oe.ensureFloat64(p),m=UL(s,bn.PE_MGRS_MAX),y=oe.ensureInt32(m),_=oe._pe_geog_to_usng(h,s,f,o,a,l,y);if(_)for(let b=0;b<s;b++)c[b]=oe.UTF8ToString(m[b]);return _}function i(r,s,n,o){oe.ensureCache.prepare();let a=0;r&&(a=oe.getPointer(r));const l=n.map(f=>oe.ensureString(f)),c=oe.ensureInt32(l),h=oe.ensureFloat64(new Array(2*s)),p=oe._pe_usng_to_geog(a,s,c,h);return p&&Yv(o,s,h),p}e.geogToUsng=t,e.usngToGeog=i}(Qq||(Qq={})),function(e){function t(){e.PE_UTM_OPTS_NONE=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=oe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=fx(o),p=oe.ensureFloat64(h),f=UL(n,bn.PE_UTM_MAX),m=oe.ensureInt32(f),y=oe._pe_geog_to_utm(c,n,p,a,m);if(y)for(let _=0;_<n;_++)l[_]=oe.UTF8ToString(f[_]);return y}function r(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=o.map(y=>oe.ensureString(y)),p=oe.ensureInt32(h),f=oe.ensureFloat64(new Array(2*n)),m=oe._pe_utm_to_geog(c,n,p,a,f);return m&&Yv(l,n,f),m}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(B5||(B5={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=oe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=oe.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=oe.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=i,e.generate=r}(z5||(z5={})),function(e){function t(){return oe.PeVersion.prototype.version_string()}e.versionString=t}(eW||(eW={}));const _9e=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return Xq},get PeDefs(){return bn},get PeFactory(){return Yq},get PeGCSExtent(){return g1e},get PeGTTransformations(){return Jq},get PeGTlistExtended(){return U5},get PeGTlistExtendedEntry(){return Zq},get PeNotationDms(){return Kq},get PeNotationMgrs(){return V5},get PeNotationUsng(){return Qq},get PeNotationUtm(){return B5},get PePCSInfo(){return z5},get PeVersion(){return eW},_init:y1e,get _pe(){return oe},isLoaded:f1e,isSupported:y9e,load:m1e},Symbol.toStringTag,{value:"Module"})),NMt=Math.PI/180,kMt=/SPHEROID\[([^\]]+)]/i,b_=Mi.radius,Tp=Mi.eccentricitySquared,v9e={a1:b_*Tp,a2:b_*Tp*b_*Tp,a3:b_*Tp*Tp/2,a4:b_*Tp*b_*Tp*2.5,a5:b_*Tp+b_*Tp*Tp/2,a6:1-Tp},UMt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Mi.radius,f:Mi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:R0.radius,f:R0.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:hg.radius,f:hg.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:hg.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let VL=0;class fC{static fromGE(t){const i=new fC;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}constructor(t){this.uid=VL++,t?(this._wkt=t.wkt!=null?t.wkt:null,this._wkid=t.wkid!=null?t.wkid:-1,this._isInverse=t.isInverse!=null&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=VL++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=VL++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=VL++}getInverse(){const t=new fC;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class h1{static cacheKey(t,i){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(t){const i=new h1;let r="";for(const s of t.steps){const n=fC.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(t){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const i of t.steps)i instanceof fC?this.steps.push(i):this.steps.push(new fC({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const t=new h1;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cachedProjection[h1.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[h1.cacheKey(t,i)];return s===void 0?null:s}}let O1=null,HI=null,B9=null,z9={};const _1e=new kZ;function EU(){return!!O1&&f1e()}function qI(e){return C(B9)&&(B9=Promise.all([m1e(),Q(()=>import("./geometryEngineBase.871c2f6a.js"),[]).then(t=>t.g),Q(()=>import("./hydrated.1e222081.js"),[])])),B9.then(([,t,{hydratedAdapter:i}])=>{ii(e),HI=i,O1=t.default,O1._enableProjection(_9e),_1e.notify()})}function fM(e,t,i=null,r=null){return Array.isArray(e)?e.length===0?[]:Vse(HI,e,e[0].spatialReference,t,i,r):Vse(HI,[e],e.spatialReference,t,i,r)[0]}function Vse(e,t,i,r,s=null,n=null){if(C(i)||C(r))return t;if(q1(i,r,s))return t.map(o=>v1e(o,i,r));if(C(s)){const o=h1.cacheKey(i,r);z9[o]!==void 0?s=z9[o]:(s=w9e(i,r,void 0),C(s)&&(s=new h1),z9[o]=s)}if(C(O1)||C(e))throw new uK;return v(n)?O1._project(e,t,i,r,s,n):O1._project(e,t,i,r,s)}function VMt(e,t){const i=b9e([e],t);return v(i.pending)?{pending:i.pending,geometry:null}:v(i.geometries)?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function b9e(e,t){if(!EU()){for(const i of e)if(v(i)&&!kn(i.spatialReference,t)&&hl(i.spatialReference)&&hl(t)&&!q1(i.spatialReference,t))return Ai(_1e),{pending:qI(),geometries:null}}return{pending:null,geometries:e.map(i=>C(i)?null:kn(i.spatialReference,t)?i:hl(i.spatialReference)&&hl(t)?x9e(i,t):null)}}function w9e(e,t,i=null){if(C(e)||C(t))return null;if(C(O1)||C(HI))throw new uK;const r=O1._getTransformation(HI,e,t,i,i==null?void 0:i.spatialReference);return r!==null?h1.fromGE(r):null}class uK extends H{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var ee;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(ee||(ee={}));function x9e(e,t){try{const i=fM(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=O_e(i.type,e.spatialReference,t);return v(r)&&r(i),i}catch(i){if(!(i instanceof uK))throw i;return null}}function q1(e,t,i){return!i&&(!!kn(e,t)||hl(e)&&hl(t)&&!!fK(e,t,gK))}async function T9e(e,t,i,r){if(EU())return yie(r);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!q1(s,n,o))return qI(r)}else if(!q1(e,t,i))return qI(r);return yie(r)}function BMt(e,t){switch(fK(e,t,gK)){case Kr:return"copy3";case p1:return"wgs84ToSphericalECEF";case yT:return"wgs84ToWebMercator";case d1:return"wgs84ToPlateCarree";case m1:return"wgs84ToWGS84ECEF";case Yx:return"webMercatorToWGS84";case E1e:return"webMercatorToSphericalECEF";case C1e:return"webMercatorToWGS84ECEF";case A1e:return"webMercatorToPlateCarree";case g1:return"wgs84ECEFToWGS84";case O1e:return"wgs84ECEFToSphericalECEF";case I1e:return"wgs84ECEFToWebMercator";case f1:return"sphericalECEFToWGS84";case M1e:return"sphericalECEFToWebMercator";case sW:return"sphericalMarsPCPFToMars2000";case rW:return"sphericalMoonPCPFToMoon2000";case R1e:return"sphericalECEFToWGS84ECEF";case iW:return"mars2000ToSphericalPCPF";case tW:return"moon2000ToSphericalPCPF";default:return null}}function v1e(e,t,i){return e?"x"in e?b1e(e,t,new ut,i,0):"xmin"in e?A9e(e,t,new Gi,i,0):"rings"in e?w1e(e,t,new zh,i,0):"paths"in e?C9e(e,t,new $h,i,0):"points"in e?E9e(e,t,new c$,i,0):null:null}function S9e(e,t,i=t.spatialReference,r=0){return v(i)&&v(e.spatialReference)&&v(b1e(e,e.spatialReference,t,i,r))}function b1e(e,t,i,r,s){gr[0]=e.x,gr[1]=e.y;const n=e.z;return gr[2]=n!==void 0?n:s,Xs(gr,t,0,gr,r,0,1)?(i.x=gr[0],i.y=gr[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=gr[2],i.hasZ=!0),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function E9e(e,t,i,r,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!Xs(h,t,0,h,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function C9e(e,t,i,r,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return T1e(n,o!=null?o:!1,a!=null?a:!1,t,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function zMt(e,t,i=t.spatialReference,r=0){return v(e.spatialReference)&&v(i)&&v(w1e(e,e.spatialReference,t,i,r))}function w1e(e,t,i,r,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return T1e(n,o!=null?o:!1,a!=null?a:!1,t,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function A9e(e,t,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return Bse(n,o,c?e.zmin:s,t,gr,r)?(i.xmin=gr[0],i.ymin=gr[1],c&&(i.zmin=gr[2]),Bse(a,l,c?e.zmax:s,t,gr,r)?(i.xmax=gr[0],i.ymax=gr[1],c&&(i.zmax=gr[2]),h&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}function W1(e,t,i){if(C(t)||C(i))return null;const r=new ut({spatialReference:i});return Xs(e,t,0,gr,i,0,1)?(r.x=gr[0],r.y=gr[1],r.z=gr[2],r):null}function x1e(e,t,i){return Xs(e,t,0,gr,i.spatialReference,0,1)?(i.x=gr[0],i.y=gr[1],i.z=gr[2],i):null}function Xa(e,t,i,r=0){gr[0]=e.x,gr[1]=e.y;const s=e.z;return gr[2]=s!==void 0?s:r,Xs(gr,e.spatialReference,0,t,i,0,1)}function Bse(e,t,i,r,s,n){return Bs[0]=e,Bs[1]=t,Bs[2]=i,Xs(Bs,r,0,s,n,0,1)}function Zo(e,t,i,r){return!(C(t)||C(r)||e.length<2)&&(e.length===2&&(Bs[0]=e[0],Bs[1]=e[1],Bs[2]=0,e=Bs),Xs(e,t,0,i,r,0,1))}function M9e(e,t){gr[0]=e.x,gr[1]=e.y;const i=e.z;return gr[2]=i!==void 0?i:0,R9e(gr,e.spatialReference,t)}function R9e(e,t,i){return O9e(e,t,i)}function O9e(e,t,i){if(C(t))return!1;const r=X1(t,AU),s=ng[r][ee.WGS84_COMPARABLE_LON_LAT];return!C(s)&&(s(e,0,Bs,0),i!==Bs&&(i[0]=Bs[0],i[1]=Bs[1],i.length>2&&(i[2]=Bs[2])),!0)}function Xs(e,t,i,r,s,n,o=1){const a=fK(t,s,gK);if(C(a))return!1;if(a===Kr){if(e===r&&i===n)return!0;const c=i+3*o;for(let h=i,p=n;h<c;h++,p++)r[p]=e[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(e,c,r,h);return!0}function GMt(e,t,i,r,s){le(gr,e),fe(BL,e,t),Zo(gr,i,gr,s),Zo(BL,i,BL,s),me(r,BL,gr),be(r,r)}function T1e(e,t,i,r,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!Xs(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&i?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function jMt(e,t,i,r){var a,l;if(C(t)||C(r))return!1;const s=P1e(t,r,U9e);if(s.projector===Kr)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if(C(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===ee.WEB_MERCATOR){const c=ng[n.spatialReferenceId][ee.WGS84];return!C(c)&&(c(e,0,rf,0),yT(rf,0,i,0),i[3]=zse(rf[1],e[2],e[3],Mi.radius),!0)}if(n.spatialReferenceId!==ee.WGS84&&n.spatialReferenceId!==ee.CGCS2000||o.spatialReferenceId!==ee.PLATE_CARREE){s.projector(e,0,i,0);const c=(a=n.metersPerUnit)!=null?a:1,h=(l=o.metersPerUnit)!=null?l:1;i[3]=e[3]*c/h}else{const c=ng[n.spatialReferenceId][ee.SPHERICAL_ECEF],h=ng[ee.SPHERICAL_ECEF][ee.PLATE_CARREE];let p=e[3];v(c)&&v(h)&&(p=zse(e[1],e[2],e[3],Mi.radius)),s.projector(e,0,i,0),i[3]=p}return!0}function zse(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(wf*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function CU(e,t,i,r){return e!=null&&(kn(t,r)?(O0(i,e),!0):(Bs[0]=e[0],Bs[1]=e[1],Bs[2]=0,!!Xs(Bs,t,0,Bs,r,0,1)&&(i[0]=Bs[0],i[1]=Bs[1],Bs[0]=e[2],Bs[1]=e[3],Bs[2]=0,!!Xs(Bs,t,0,Bs,r,0,1)&&(i[2]=Bs[0],i[3]=Bs[1],!0))))}function HMt(e,t,i,r){if(C(t)||C(r))return!1;const s=X1(t,AU),n=X1(r,$1e);if(s===n&&s!==ee.UNKNOWN||kn(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===ee.SPHERICAL_ECEF){const o=Oe(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/Mi.radius;if(n===ee.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===ee.WGS84||n===ee.CGCS2000){const c=D3;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===ee.PLATE_CARREE){if(n===ee.WGS84||n===ee.CGCS2000)return i[0]=D3,i[1]=D3,i[2]=1,!0;if(n===ee.WEB_MERCATOR){const o=e[1]/Mi.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function Uf(e,t,i,r){if(C(e)||C(r))return!1;const s=X1(e,AU),n=X1(r,$1e);if(s===n&&!Gse(n)&&(s!==ee.UNKNOWN||kn(e,r)))return lU(i,t),!0;if(Gse(n)){const o=ng[s][ee.LON_LAT],a=ng[ee.LON_LAT][n];return!C(o)&&!C(a)&&(o(t,0,rf,0),a(rf,0,w_,0),S1e(wf*rf[0],wf*rf[1],i),i[12]=w_[0],i[13]=w_[1],i[14]=w_[2],!0)}if((n===ee.WEB_MERCATOR||n===ee.PLATE_CARREE)&&(s===ee.WGS84||s===ee.CGCS2000&&n===ee.PLATE_CARREE||s===ee.SPHERICAL_ECEF||s===ee.WEB_MERCATOR)){const o=ng[s][ee.LON_LAT],a=ng[ee.LON_LAT][n];return!C(o)&&!C(a)&&(o(t,0,rf,0),a(rf,0,w_,0),s===ee.SPHERICAL_ECEF?I9e(wf*rf[0],wf*rf[1],i):np(i),i[12]=w_[0],i[13]=w_[1],i[14]=w_[2],!0)}return!1}function Gse(e){return e===ee.SPHERICAL_ECEF||e===ee.SPHERICAL_MARS_PCPF||e===ee.SPHERICAL_MOON_PCPF}function S1e(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function I9e(e,t,i){return S1e(e,t,i),Lu(i,i),i}function X1(e,t){return e?t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=wl(e,1)),e.wkt===fge.wkt?t.spatialReferenceId=ee.SPHERICAL_ECEF:AI(e)?t.spatialReferenceId=ee.WGS84:oT(e)?t.spatialReferenceId=ee.WEB_MERCATOR:wZ(e)?t.spatialReferenceId=ee.PLATE_CARREE:e.wkt===mge.wkt?t.spatialReferenceId=ee.WGS84_ECEF:e.wkid===Gd.CGCS2000?t.spatialReferenceId=ee.CGCS2000:e.wkt===EZ.wkt?t.spatialReferenceId=ee.SPHERICAL_MARS_PCPF:e.wkt===CZ.wkt?t.spatialReferenceId=ee.SPHERICAL_MOON_PCPF:Fg(e)?t.spatialReferenceId=ee.GCSMARS2000:Ng(e)?t.spatialReferenceId=ee.GCSMOON2000:t.spatialReferenceId=ee.UNKNOWN):ee.UNKNOWN}function Kr(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function Yx(e,t,i,r){i[r++]=lA*(e[t++]/Mi.radius),i[r++]=lA*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/Mi.radius))),i[r]=e[t]}function E1e(e,t,i,r){Yx(e,t,i,r),p1(i,r,i,r)}function C1e(e,t,i,r){Yx(e,t,i,r),m1(i,r,i,r)}function hK(e,t,i,r,s){const n=.4999999*Math.PI,o=ye(wf*e[t+1],-n,n),a=Math.sin(o);i[r++]=wf*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=e[t+2]}function yT(e,t,i,r){hK(e,t,i,r,Mi)}const jse=Mi.radius*Math.PI/180,D3=180/(Mi.radius*Math.PI);function d1(e,t,i,r){i[r]=e[t]*jse,i[r+1]=e[t+1]*jse,i[r+2]=e[t+2]}function Ix(e,t,i,r){i[r]=e[t]*D3,i[r+1]=e[t+1]*D3,i[r+2]=e[t+2]}function A1e(e,t,i,r){Yx(e,t,i,r),d1(i,r,i,r)}function P9e(e,t,i,r){g1(e,t,i,r),d1(i,r,i,r)}function $9e(e,t,i,r){f1(e,t,i,r),d1(i,r,i,r)}function L9e(e,t,i,r){Ix(e,t,i,r),p1(i,r,i,r)}function D9e(e,t,i,r){Ix(e,t,i,r),yT(i,r,i,r)}function F9e(e,t,i,r){Ix(e,t,i,r),m1(i,r,i,r)}function _T(e){if(C(e))return!1;const t=X1(e,AU);return!!ng[t][ee.WGS84_COMPARABLE_LON_LAT]}function N9e(e,t,i,r){const s=Math.cos(i);e[0]=Math.cos(t)*s*r,e[1]=Math.sin(t)*s*r,e[2]=Math.sin(i)*r}function dK(e,t,i,r,s){const n=s+e[t+2],o=wf*e[t+1],a=wf*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function tW(e,t,i,r){dK(e,t,i,r,R0.radius)}function iW(e,t,i,r){dK(e,t,i,r,hg.radius)}function p1(e,t,i,r){dK(e,t,i,r,Mi.radius)}function pK(e,t,i,r,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=tp(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=lA*h,i[r++]=lA*c,i[r]=l-s}function rW(e,t,i,r){pK(e,t,i,r,R0.radius)}function sW(e,t,i,r){pK(e,t,i,r,hg.radius)}function f1(e,t,i,r){pK(e,t,i,r,Mi.radius)}function M1e(e,t,i,r){f1(e,t,i,r),yT(i,r,i,r)}function R1e(e,t,i,r){f1(e,t,i,r),m1(i,r,i,r)}function k9e(e,t,i,r,s){const n=wf*e[t],o=wf*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function m1(e,t,i,r){k9e(e,t,i,r,Mi)}function g1(e,t,i,r){const s=v9e,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,f,m,y,_,b,w,T,S,E,M,A,$,I,k,V,B,G;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),B=Math.atan2(o,n),m=a*a/p,y=c/p,M=s.a2/f,A=s.a3-s.a4/f,y>.3?(_=l/f*(1+y*(s.a1+M+m*A)/f),V=Math.asin(_),w=_*_,b=Math.sqrt(1-w)):(b=h/f*(1-m*(s.a5-M-y*A)/f),V=Math.acos(b),w=1-b*b,_=Math.sqrt(w)),T=1-Mi.eccentricitySquared*w,S=Mi.radius/Math.sqrt(T),E=s.a6*S,M=h-S*b,A=l-E*_,I=b*M+_*A,$=b*A-_*M,k=$/(E/T+I),V+=k,G=I+$*k/2,a<0&&(V=-V),i[r++]=lA*B,i[r++]=lA*V,i[r]=G}function O1e(e,t,i,r){g1(e,t,i,r),p1(i,r,i,r)}function I1e(e,t,i,r){g1(e,t,i,r),yT(i,r,i,r)}const ng={[ee.WGS84]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:Kr,[ee.WGS84_COMPARABLE_LON_LAT]:Kr,[ee.SPHERICAL_ECEF]:p1,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:yT,[ee.PLATE_CARREE]:d1,[ee.WGS84]:Kr,[ee.WGS84_ECEF]:m1},[ee.CGCS2000]:{[ee.CGCS2000]:Kr,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:Kr,[ee.WGS84_COMPARABLE_LON_LAT]:Kr,[ee.SPHERICAL_ECEF]:p1,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:d1,[ee.WGS84]:null,[ee.WGS84_ECEF]:m1},[ee.GCSMARS2000]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:Kr,[ee.GCSMOON2000]:null,[ee.LON_LAT]:Kr,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:iW,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.GCSMOON2000]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:Kr,[ee.LON_LAT]:Kr,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:tW,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.WEB_MERCATOR]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:Yx,[ee.WGS84_COMPARABLE_LON_LAT]:Yx,[ee.SPHERICAL_ECEF]:E1e,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:Kr,[ee.PLATE_CARREE]:A1e,[ee.WGS84]:Yx,[ee.WGS84_ECEF]:C1e},[ee.WGS84_ECEF]:{[ee.CGCS2000]:g1,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:g1,[ee.WGS84_COMPARABLE_LON_LAT]:g1,[ee.SPHERICAL_ECEF]:O1e,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:I1e,[ee.PLATE_CARREE]:P9e,[ee.WGS84]:g1,[ee.WGS84_ECEF]:Kr},[ee.SPHERICAL_ECEF]:{[ee.CGCS2000]:f1,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:f1,[ee.WGS84_COMPARABLE_LON_LAT]:f1,[ee.SPHERICAL_ECEF]:Kr,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:M1e,[ee.PLATE_CARREE]:$9e,[ee.WGS84]:f1,[ee.WGS84_ECEF]:R1e},[ee.SPHERICAL_MARS_PCPF]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:sW,[ee.GCSMOON2000]:null,[ee.LON_LAT]:sW,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:Kr,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.SPHERICAL_MOON_PCPF]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:rW,[ee.LON_LAT]:rW,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:Kr,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.UNKNOWN]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:null,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:Kr,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.LON_LAT]:{[ee.CGCS2000]:Kr,[ee.GCSMARS2000]:Kr,[ee.GCSMOON2000]:Kr,[ee.LON_LAT]:Kr,[ee.WGS84_COMPARABLE_LON_LAT]:Kr,[ee.SPHERICAL_ECEF]:p1,[ee.SPHERICAL_MARS_PCPF]:iW,[ee.SPHERICAL_MOON_PCPF]:tW,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:yT,[ee.PLATE_CARREE]:d1,[ee.WGS84]:Kr,[ee.WGS84_ECEF]:m1},[ee.WGS84_COMPARABLE_LON_LAT]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:Kr,[ee.WGS84_COMPARABLE_LON_LAT]:Kr,[ee.SPHERICAL_ECEF]:p1,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:d1,[ee.WGS84]:Kr,[ee.WGS84_ECEF]:m1},[ee.PLATE_CARREE]:{[ee.CGCS2000]:Ix,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:Ix,[ee.WGS84_COMPARABLE_LON_LAT]:Ix,[ee.SPHERICAL_ECEF]:L9e,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:D9e,[ee.PLATE_CARREE]:Kr,[ee.WGS84]:Ix,[ee.WGS84_ECEF]:F9e}};function fK(e,t,i=mK()){return C(e)||C(t)?null:P1e(e,t,i).projector}function P1e(e,t,i){if(C(e)||C(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=X1(e,i.source),s=X1(t,i.dest);return r===ee.UNKNOWN&&s===ee.UNKNOWN?kn(e,t)?i.projector=Kr:i.projector=null:i.projector=ng[r][s],i}function mK(){return{source:{spatialReference:null,spatialReferenceId:ee.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:ee.UNKNOWN,metersPerUnit:1},projector:Kr}}const AU={spatialReference:null,spatialReferenceId:ee.UNKNOWN},$1e={spatialReference:null,spatialReferenceId:ee.UNKNOWN},gK=mK(),U9e=mK(),wf=Wt(1),lA=Zl(1),Bs=O(),rf=O(),w_=O(),gr=O(),BL=O();async function V9e(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return RE(e);const i=et.WGS84;return await T9e(t,i),fM(e,i)}function qMt(e,t){if(!B9e(e,t)){const i=e.typeKeywords;i?i.push(t):e.typeKeywords=[t]}}function B9e(e,t){var i;return!!((i=e.typeKeywords)!=null&&i.includes(t))}function WMt(e,t){const i=e.typeKeywords;if(i){const r=i.indexOf(t);r>-1&&i.splice(r,1)}}async function XMt(e){const t=e.clone().normalize();let i;if(t.length>1)for(const r of t)i?r.width>i.width&&(i=r):i=r;else i=t[0];return V9e(i)}const YMt={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"};function Hse(e){var l;const{portal:t,isOrgItem:i,itemControl:r}=e,s=(l=t.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const L1e=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Be(this.portalItem)}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new L3({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await Q(()=>import("./layersLoader.e48a79d9.js"),["assets/layersLoader.e48a79d9.js","assets/fetchService.ef2e52b5.js","assets/jsonContext.1eaa7625.js"]);return ii(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(s){throw Ws(s)||se.getLogger(this.declaredClass).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(bu(r),!0)))}async _setUserPrivileges(i,r){if(!or.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){bu(s)}}async _fetchUserPrivileges(i,r){let s=this.portalItem;if(!i||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(r);const n=i===s.id;if(n&&s.portal.user)return Hse(s);let o,a;if(n)o=s.portal.url;else try{o=await j0e(this.url,r)}catch(p){bu(p)}if(!o||!yFe(o,s.portal.url))return this._fetchFallbackUserPrivileges(r);try{const p=v(r)?r.signal:null;a=await(Sr==null?void 0:Sr.getCredential(`${o}/sharing`,{prompt:!1,signal:p}))}catch(p){bu(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new L3({id:i,portal:{url:o}}),await s.load(r)),s.portal.user)return Hse(s)}catch(p){bu(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(s){bu(s)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?Sr==null?void 0:Sr.findCredential(this.url):null;if(!r)return!0;const s=zL.credential===r?zL.user:await this._fetchEditingUser(i);return zL.credential=r,zL.user=s,C(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p,f;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const s=Sr.findServerInfo((f=this.url)!=null?f:"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=po.getDefault();if(o&&o.loaded&&Yd(o.restUrl)===Yd(n))return o.user;const a=`${n}/community/self`,l=v(i)?i.signal:null,c=await kf(_r(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?pJ.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||po.getDefault());return s&&n&&!jye(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new H("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return u([d({type:L3})],t.prototype,"portalItem",null),u([Fe("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([Ge("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([d({clonable:!1})],t.prototype,"resourceReferences",void 0),u([d({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=u([P("esri.layers.mixins.PortalLayer")],t),t},zL={credential:null,user:null};let OO=class extends Te{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([d()],OO.prototype,"updating",void 0),u([d()],OO.prototype,"status",void 0),OO=u([P("esri.layers.support.PublishingInfo")],OO);const z9e=OO,D1e="esri.layers.mixins.PublishableLayer",G9e=Symbol(D1e),j9e=e=>{var t;let i=class extends e{constructor(){super(...arguments),this[t]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const s=new z9e;return this._checkPublishingStatus(s),s}_checkPublishingStatus(r){let o=0;const a=async c=>{let h;r.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=h,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return t=G9e,u([d({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=u([P(D1e)],i),i},WI=new Qe,F3=new WeakMap;function H9e(e){F1e(e)&&WI.push(e)}function q9e(e){F1e(e)&&WI.includes(e)&&WI.remove(e)}function F1e(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function N1e(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:N1e(t,e%t):0}let G9=0,GL=0;function W9e(){var t;const e=Date.now();for(const i of WI)i.refreshInterval&&e-((t=F3.get(i))!=null?t:0)+5>=6e4*i.refreshInterval&&(F3.set(i,e),i.refresh(e))}ege(()=>{const e=Date.now();let t=0;for(const i of WI)t=N1e(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?F3.get(i)||F3.set(i,e):F3.delete(i);if(t!==GL){if(GL=t,clearInterval(G9),GL===0)return void(G9=0);G9=setInterval(W9e,GL)}});function X9e(e){return e!=null&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const Y9e=e=>{let t=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=Wme(()=>this.hasDataChanged()),this.when().then(()=>{H9e(this)},()=>{})}destroy(){q9e(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){rC(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{se.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([d()],t.prototype,"refreshParameters",null),t=u([P("esri.layers.mixins.RefreshableLayer")],t),t},k1e=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&Z9e(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([P("esri.layers.mixins.ScaleRangeLayer")],t),t};function Z9e(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const U1e=bl()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let IO=class extends Ys(ge){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return d6e(this.value,this.unit,"milliseconds")}};u([bt(U1e,{nonNullable:!0})],IO.prototype,"unit",void 0),u([d({type:Number,json:{write:!0},nonNullable:!0})],IO.prototype,"value",void 0),IO=u([P("esri.TimeInterval")],IO);const yt=IO;function qse(e,t){return yt.fromJSON({value:e,unit:t})}let Ll=class extends Ys(ge){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new Ts({start:i,end:r})}writeFullTimeExtent(e,t){e&&v(e.start)&&v(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?qse(t.timeInterval,t.timeIntervalUnits):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?qse(t.defaultTimeInterval,t.defaultTimeIntervalUnits):null}writeInterval(e,t){var i,r;t.timeInterval=(i=e==null?void 0:e.toJSON().value)!=null?i:null,t.timeIntervalUnits=(r=e==null?void 0:e.toJSON().unit)!=null?r:null}};u([d({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Ll.prototype,"cumulative",void 0),u([d({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Ll.prototype,"endField",void 0),u([d({type:Ts,json:{write:{enabled:!0,allowNull:!0}}})],Ll.prototype,"fullTimeExtent",void 0),u([Fe("fullTimeExtent",["timeExtent"])],Ll.prototype,"readFullTimeExtent",null),u([Ge("fullTimeExtent")],Ll.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Ll.prototype,"hasLiveData",void 0),u([d({type:yt,json:{write:{enabled:!0,allowNull:!0}}})],Ll.prototype,"interval",void 0),u([Fe("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Ll.prototype,"readInterval",null),u([Ge("interval")],Ll.prototype,"writeInterval",null),u([d({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Ll.prototype,"startField",void 0),u([d({type:oA,json:{write:{enabled:!0,allowNull:!0}}})],Ll.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Ll.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Ll.prototype,"useTime",void 0),Ll=u([P("esri.layers.support.TimeInfo")],Ll);const V1e=Ll,J9e=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=U1e.fromJSON(s.timeOffsetUnits);return n&&o?new yt({value:n,unit:o}):null}set timeInfo(i){Zge(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([d({type:Ts,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([d({type:yt})],t.prototype,"timeOffset",void 0),u([Fe("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([d({value:null,type:V1e,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([P("esri.layers.mixins.TemporalLayer")],t),t},Wse=new _i({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let mv=class extends Ys(ge){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],mv.prototype,"name",void 0),u([d({json:{write:!0}})],mv.prototype,"description",void 0),u([d({json:{read:Wse.read,write:Wse.write}})],mv.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],mv.prototype,"prototype",void 0),u([d({json:{write:!0}})],mv.prototype,"thumbnail",void 0),mv=u([P("esri.layers.support.FeatureTemplate")],mv);const yK=mv;let Ly=class extends Ys(ge){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=LJ(e[i]);return t}writeDomains(e,t){var r;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(r=e[s])==null?void 0:r.toJSON());t.domains=i}};u([d({json:{write:!0}})],Ly.prototype,"id",void 0),u([d({json:{write:!0}})],Ly.prototype,"name",void 0),u([d({json:{write:!0}})],Ly.prototype,"domains",void 0),u([Fe("domains")],Ly.prototype,"readDomains",null),u([Ge("domains")],Ly.prototype,"writeDomains",null),u([d({type:[yK],json:{write:!0}})],Ly.prototype,"templates",void 0),Ly=u([P("esri.layers.support.FeatureType")],Ly);const B1e=Ly;function K9e(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function Xse(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function Yse(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class Q9e{constructor(t=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;this.fields=t;const i=[];for(const r of t){const s=r==null?void 0:r.name,n=Jse(r==null?void 0:r.name);if(s&&n){const o=Zse(s);this._fieldsMap.set(s,r),this._fieldsMap.set(o,r),this._normalizedFieldsMap.set(n,r),i.push(o),K9e(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):U6(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),Xse(r)||Yse(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)Xse(t)||Yse(t)||t.nullable||jLe(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){var r;if(!t)return;let i=this._fieldsMap.get(t);return i||(i=(r=this._fieldsMap.get(Zse(t)))!=null?r:this._normalizedFieldsMap.get(Jse(t)),i&&this._fieldsMap.set(t,i),i)}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){var r;const i=this.get(t);if(i)return(r=i.name)!=null?r:void 0}}function Zse(e){return e.trim().toLowerCase()}function Jse(e){var t,i;return(i=(t=DLe(e))==null?void 0:t.toLowerCase())!=null?i:""}function eBe(){return{fields:{type:[nU],value:null},fieldsIndex:{readOnly:!0,get(){return new Q9e(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){var t;const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const i of e)((t=this.fieldsIndex)==null?void 0:t.has(i))||se.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${i} found in outFields`,{layer:this,outFields:e});return Jge(this.fieldsIndex,e)}}}}const j9=se.getLogger("esri.layers.support.labelingInfo"),tBe=/\[([^\[\]]+)\]/gi;function Kse(e,t,i){return e?e.map(r=>{const s=new xU;if(s.read(r,i),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(tBe,(o,a)=>`[${iBe(a,n)}]`)}return s}):null}function iBe(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const s=t[r].name;if(s.toLowerCase()===i)return s}return e}const rBe={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function ZMt(e,t){const i=ne(e);return i.some(r=>sBe(r,t))?[]:i}function sBe(e,t){const i=e.labelPlacement,r=rBe[t];if(!e.symbol)return j9.warn("No ILabelClass symbol specified."),!0;if(!r)return j9.error(new H("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${t}' is not supported`)),!0;if(!r.includes(i)){const s=r[0];i&&j9.warn(`Found invalid label placement type ${i} for ${t}. Defaulting to ${s}`),e.labelPlacement=s}return!1}const Hp=[];function nBe(e,t){var r,s;if(D_e((r=e.url)!=null?r:""))return!0;const{wkid:i}=t;for(const n of Hp){if(((s=e.version)!=null?s:0)>=n[0])return!0;if(typeof n[1]=="function"&&(n[1]=n[1]()),n[1].has(i))return!1}return!0}Hp.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),Hp.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),Hp.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),Hp.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),Hp.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=22619;t<=22621;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);return e}]),Hp.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),Hp.push([10.61,()=>new Set([102497])]),Hp.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),Hp.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),Hp.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function oBe(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await kf(r.populateFromStyle());if(ii(i),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Bh("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t==null?void 0:t.origin)}}}var nW;let Y2=nW=class extends ge{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new nW({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],Y2.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],Y2.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],Y2.prototype,"orderByFields",void 0),Y2=nW=u([P("esri.rest.support.TopFilter")],Y2);const aBe=Y2;var oW;const Qse=new _i({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),ene=new _i({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let tn=oW=class extends ge{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new oW(ne({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],tn.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],tn.prototype,"distance",void 0),u([d({types:ZT,json:{read:Jl,write:!0}})],tn.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],tn.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],tn.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],tn.prototype,"num",void 0),u([d({json:{write:!0}})],tn.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],tn.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],tn.prototype,"outFields",void 0),u([d({type:et,json:{read:{source:"outSR"},write:{target:"outSR"}}})],tn.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],tn.prototype,"resultType",void 0),u([d({json:{write:!0}})],tn.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],tn.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],tn.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],tn.prototype,"start",void 0),u([Ge("start"),Ge("num")],tn.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:Qse.read},write:{target:"spatialRel",writer:Qse.write}}})],tn.prototype,"spatialRelationship",void 0),u([d({type:Ts,json:{write:!0}})],tn.prototype,"timeExtent",void 0),u([d({type:aBe,json:{write:!0}})],tn.prototype,"topFilter",void 0),u([d({type:String,json:{read:ene.read,write:{writer:ene.write,overridePolicy(e){return{enabled:v(e)&&v(this.distance)&&this.distance>0}}}}})],tn.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],tn.prototype,"where",void 0),tn=oW=u([P("esri.rest.support.TopFeaturesQuery")],tn),tn.from=zr(tn);const jL=tn,lBe=["oid","global-id"],cBe=["oid","global-id","guid"];function uBe({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=gBe({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!o.length)return null;const a=vBe({titleBase:s,fields:i,displayField:e}),l=_Be();return new KT({title:a,content:l,fieldInfos:o})}const hBe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],dBe=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!z1e(e.name,t)&&(!i||e.name!==i)&&!lBe.includes(e.type)&&!hBe.some(s=>s.test(e.name));function pBe(e,t){const i=e;return t&&(e=e.filter(r=>!t.includes(r.type))),e===i&&(e=e.slice()),e.sort(fBe),e}function fBe(e,t){return e.type==="oid"?-1:t.type==="oid"?1:tne(e)?-1:tne(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function z1e(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function mBe(e,t){return e.editable&&!cBe.includes(e.type)&&!z1e(e.name,t)}function gBe({editFieldsInfo:e,fields:t,objectIdField:i},r){return pBe(t!=null?t:[],(r==null?void 0:r.ignoreFieldTypes)||bBe).map(s=>new h$({fieldName:s.name,isEditable:mBe(s,e),label:s.alias,format:yBe(s),visible:dBe(s,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function yBe(e){switch(e.type){case"small-integer":case"integer":case"single":return new OE({digitSeparator:!0,places:0});case"double":return new OE({digitSeparator:!0,places:2});case"date":return new OE({dateFormat:"long-month-day-year"});default:return e.type==="string"&&rye(e.name)?new OE({digitSeparator:!0,places:0}):null}}function _Be(){return[new YC,new OI]}function vBe(e){const t=kLe(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i!=null?i:""}function tne(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"}const bBe=["geometry","blob","raster","guid","xml"],ic="FeatureLayer",G1e="esri.layers.FeatureLayer",wBe=se.getLogger(G1e);function HL(e,t){return new H("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function ine(e){return e&&e instanceof Qe}const H9=eBe();function q9(e,t,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let wt=class extends vVe(o9e(w6e(j9e(c6e(W_e(u9e(J9e(k1e(Y9e(ske(h1e(L1e(PJ(a6e(Z5e(Ys(VI))))))))))))))))){constructor(...e){super(...e),this._handles=new Ii,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=et.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=Be(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}load(e){var r;const t=v(e)?e.signal:null;if(((r=this.portalItem)==null?void 0:r.loaded)&&this.source)return this.addResolvingPromise(this.createGraphicsSource(t).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(bu).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(t);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new H("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>rVe(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,i1e(t,this.url)}get createQueryVersion(){var e;return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),((e=this._get("createQueryVersion"))!=null?e:0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}get effectiveEditingEnabled(){return sVe(this)}readIsTable(e,t){var i;return(t=(i=t==null?void 0:t.layerDefinition)!=null?i:t).type==="Table"||!t.geometryType}writeIsTable(e,t,i,r){r!=null&&r.writeLayerSchema&&Sa(i,e?"Table":"Feature Layer",t)}readGlobalIdField(e,t){return e1e(t.layerDefinition||t)}readObjectIdField(e,t){return t1e(t.layerDefinition||t)}get parsedUrl(){const e=Ma(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=pT(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=pT(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){$ie(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){var s,n;const r=(s=(t=t.layerDefinition||t).drawingInfo)==null?void 0:s.renderer;if(r){const o=(n=UI(r,t,i))!=null?n:void 0;return o||wBe.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),o}if(t.defaultSymbol)return t.types&&t.types.length?new _$({defaultSymbol:W9(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(o=>({id:o.id,symbol:W9(o.symbol,o,i)}))}):new f0({symbol:W9(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(ine(t)&&this._resetMemorySource(t),ine(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof Qe?new Yy({layer:this,items:e}):e:null}readSource(e,t){var r;const i=UJ.fromJSON(t.featureSet);return new Yy({layer:this,items:(r=i==null?void 0:i.features)!=null?r:[]})}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(n=>yK.fromJSON(n)),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){var s,n;const i=(n=(s=t.layerDefinition)==null?void 0:s.name)!=null?n:t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?eke(this.url,i):i;let a=i;if(!a&&this.url){const l=oM(this.url);v(l)&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),VJ(a)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(n=>(n=B1e.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}async addAttachment(e,t){return z8e(this,e,t,ic)}async updateAttachment(e,t,i){return G8e(this,e,t,i,ic)}async applyEdits(e,t){return j8e(this,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return uBe(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:t}=await yZ(Q(()=>import("./FeatureLayerSource.98ec073d.js"),["assets/FeatureLayerSource.98ec073d.js","assets/assetEditingSupport.240adbda.js","assets/clientSideDefaults.a92d19ee.js","assets/QueryEngineCapabilities.ea616409.js","assets/QueryTask.7b024924.js","assets/executeForIds.e65e9cbb.js"]),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=eVe(this);e.dynamicDataSource=this.dynamicDataSource;const t=v(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,i=j4e(this.definitionExpression,t);return e.where=i||"1=1",e}async deleteAttachments(e,t){return H8e(this,e,t,ic)}async fetchRecomputedExtents(e){return q8e(this,e,ic)}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i==null||i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,t){return W8e(this,e,t,ic)}async queryFeatures(e,t){var s;const i=await this.load(),r=await i.source.queryFeatures((s=mg.from(e))!=null?s:i.createQuery(),t);if(r!=null&&r.features)for(const n of r.features)n.layer=n.sourceLayer=i;return r}async queryObjectIds(e,t){return X8e(this,e,t,ic)}async queryFeatureCount(e,t){return Y8e(this,e,t,ic)}async queryExtent(e,t){return Z8e(this,e,t,ic)}async queryRelatedFeatures(e,t){return J8e(this,e,t,ic)}async queryRelatedFeaturesCount(e,t){return K8e(this,e,t,ic)}async queryTopFeatures(e,t){var n;const{source:i,capabilities:r}=await this.load();if(!i.queryTopFeatures||!((n=r==null?void 0:r.query)!=null&&n.supportsTopFeaturesQuery))throw new H(ic,"Layer source does not support queryTopFeatures capability");const s=await i.queryTopFeatures(jL.from(e),t);if(s!=null&&s.features)for(const o of s.features)o.layer=o.sourceLayer=this;return s}async queryTopObjectIds(e,t){const{source:i,capabilities:r}=await this.load();if(!i.queryTopObjectIds||!(r!=null&&r.query.supportsTopFeaturesQuery))throw new H(ic,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(jL.from(e),t)}async queryTopFeaturesExtent(e,t){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopExtents||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new H(ic,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(jL.from(e),t)}async queryTopFeatureCount(e,t){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopCount||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new H(ic,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(jL.from(e),t)}read(e,t){const i=e.featureCollection;if(i){const r=i.layers;r&&r.length===1&&(super.read(r[0],t),i.showLegend!=null&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,t){var n,o;t={...t,origin:(n=t==null?void 0:t.origin)!=null?n:void 0,writeLayerSchema:(o=t==null?void 0:t.writeLayerSchema)!=null?o:this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push(HL(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&r!=="tables")return s==null||s.push(HL(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(HL(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&r==="tables")return s==null||s.push(HL(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new H(ic,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var t;return!!this.loaded&&(((t=this.source)==null?void 0:t.type)==="memory"||nBe(this,e))}async save(e){return(await Q(()=>import("./featureLayerUtils.2772573c.js"),["assets/featureLayerUtils.2772573c.js","assets/originUtils.5c585c3a.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/fetchService.ef2e52b5.js","assets/jsonContext.1eaa7625.js"])).save(this,e)}async saveAs(e,t){return(await Q(()=>import("./featureLayerUtils.2772573c.js"),["assets/featureLayerUtils.2772573c.js","assets/originUtils.5c585c3a.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/fetchService.ef2e52b5.js","assets/jsonContext.1eaa7625.js"])).saveAs(this,e,t)}_readEditingEnabled(e,t,i){var s;let r=(s=e.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=e.capabilities,t&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,i,r){var s,n;if(!e){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";Sa("layerDefinition.capabilities",o,t),i&&!(r!=null&&r.writeLayerSchema)&&(t.capabilities=o)}}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return _r(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(t=>{const i=t.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){var t;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(t=this.portalItem)==null?void 0:t.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),$ie(this.renderer,this.fieldsIndex),Zge(this.timeInfo,this.fieldsIndex),oBe(this,{origin:"service"})}async hasDataChanged(){return Q8e(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var t,i,r;const e=(i=(t=this.parsedUrl)==null?void 0:t.path)!=null?i:"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((r=this.fields)==null?void 0:r.some(s=>s.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(i=>{const r=i.prototype&&i.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new H("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new H("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([Fe("service","capabilities")],wt.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],wt.prototype,"charts",void 0),u([d({readOnly:!0})],wt.prototype,"createQueryVersion",null),u([d({json:{read:{source:"layerDefinition.copyrightText"}}})],wt.prototype,"copyright",void 0),u([d({json:{read:{source:"layerDefinition.displayField"}}})],wt.prototype,"displayField",void 0),u([d({types:Wx,readOnly:!0})],wt.prototype,"defaultSymbol",void 0),u([d({type:af})],wt.prototype,"dynamicDataSource",void 0),u([d({type:Boolean})],wt.prototype,"editingEnabled",null),u([Fe(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],wt.prototype,"readEditingEnabled",null),u([Fe("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],wt.prototype,"readEditingEnabledFromWebMap",null),u([Ge(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],wt.prototype,"writeEditingEnabled",null),u([Ge("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],wt.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],wt.prototype,"effectiveEditingEnabled",null),u([d({...H9.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:q9}}}}})],wt.prototype,"fields",void 0),u([d(H9.fieldsIndex)],wt.prototype,"fieldsIndex",void 0),u([d({type:r5e,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],wt.prototype,"formTemplate",void 0),u([d({json:{read:{source:"layerDefinition.extent"}}})],wt.prototype,"fullExtent",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:q9,writer(e,t,i){const r=e?Nq.toJSON(e):null;r&&Sa(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:Nq.read}}})],wt.prototype,"geometryType",void 0),u([d({json:{read:{source:"layerDefinition.hasM"}}})],wt.prototype,"hasM",void 0),u([d({json:{read:{source:"layerDefinition.hasZ"}}})],wt.prototype,"hasZ",void 0),u([d(F6e)],wt.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],wt.prototype,"infoFor3D",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],wt.prototype,"isTable",void 0),u([Fe("service","isTable",["type","geometryType"]),Fe("isTable",["layerDefinition.type","layerDefinition.geometryType"])],wt.prototype,"readIsTable",null),u([Ge("web-map","isTable")],wt.prototype,"writeIsTable",null),u([d(YJ)],wt.prototype,"labelsVisible",void 0),u([d({type:[xU],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:Kse},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Kse},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],wt.prototype,"labelingInfo",void 0),u([d((()=>{const e=ne(D6e);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,i,r){Sa(r,z6(t),i)}}},e})())],wt.prototype,"opacity",void 0),u([d($6e)],wt.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const e=ne(eve.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],wt.prototype,"listMode",void 0),u([Fe("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],wt.prototype,"readGlobalIdField",null),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:q9}}}}})],wt.prototype,"objectIdField",void 0),u([Fe("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],wt.prototype,"readObjectIdField",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],wt.prototype,"operationalLayerType",void 0),u([d(H9.outFields)],wt.prototype,"outFields",void 0),u([d({readOnly:!0})],wt.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],wt.prototype,"path",void 0),u([d(XJ)],wt.prototype,"popupEnabled",void 0),u([d({type:KT,json:{name:"popupInfo",write:!0}})],wt.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],wt.prototype,"defaultPopupTemplate",null),u([d({types:rU,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:V4e,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],wt.prototype,"renderer",null),u([Fe("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Fe("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],wt.prototype,"readRenderer",null),u([d((()=>{const e=ne(I6e);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],wt.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],wt.prototype,"source",null),u([Zt("source")],wt.prototype,"castSource",null),u([Fe("portal-item","source",["featureSet"]),Fe("web-map","source",["featureSet"])],wt.prototype,"readSource",null),u([d({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],wt.prototype,"spatialReference",void 0),u([d({type:Number})],wt.prototype,"subtypeCode",void 0),u([d({type:[yK]})],wt.prototype,"templates",void 0),u([Fe("templates",["editFieldsInfo","creatorField","editorField","templates"])],wt.prototype,"readTemplates",null),u([d({type:V1e})],wt.prototype,"timeInfo",void 0),u([d()],wt.prototype,"title",void 0),u([Fe("service","title",["name"]),Fe("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],wt.prototype,"readTitle",null),u([Fe("web-map","title",["layerDefinition.name","title"])],wt.prototype,"readTitleFromWebMap",null),u([d({type:String})],wt.prototype,"sublayerTitleMode",void 0),u([d({json:{read:!1}})],wt.prototype,"type",void 0),u([d({type:String})],wt.prototype,"typeIdField",void 0),u([Fe("service","typeIdField"),Fe("typeIdField",["layerDefinition.typeIdField"])],wt.prototype,"readTypeIdField",null),u([d({type:[B1e]})],wt.prototype,"types",void 0),u([Fe("service","types",["types"]),Fe("types",["layerDefinition.types"])],wt.prototype,"readTypes",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],wt.prototype,"visible",void 0),u([Fe("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],wt.prototype,"readVisible",null),wt=u([P(G1e)],wt);const W9=ub({types:Q6}),N3=wt;var xBe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:N3});let Z2=class extends Qe{constructor(e){super(e),this.getCollections=null}initialize(){this.own(ege(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=v(this.getCollections)?this.getCollections():null;if(C(e))return void this.removeAll();let t=0;for(const i of e)v(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new Qe(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:r=>!!r;for(const r of t)if(r){if(i(r)){const s=this.indexOf(r,e);s>=0?s!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(r);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([d()],Z2.prototype,"getCollections",void 0),u([d()],Z2.prototype,"getChildrenFunction",void 0),u([d()],Z2.prototype,"itemFilterFunction",void 0),Z2=u([P("esri.core.CollectionFlattener")],Z2);const cA=Z2;async function _K(e,t){return await e.load(),TBe(e,t)}async function TBe(e,t){const i=[],r=(...n)=>{for(const o of n)C(o)||(Array.isArray(o)?r(...o):Qe.isCollection(o)?o.forEach(a=>r(a)):sp.isLoadable(o)&&i.push(o))};t(r);let s=null;if(await h9e(i,async n=>{const o=await kf(SBe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return e}function SBe(e){return"loadAll"in e&&typeof e.loadAll=="function"}const EBe={BingMapsLayer:async()=>(await Q(()=>import("./BingMapsLayer.62816832.js"),["assets/BingMapsLayer.62816832.js","assets/imageBitmapUtils.9388147a.js"])).default,BuildingSceneLayer:async()=>(await Q(()=>import("./BuildingSceneLayer.cb51597c.js"),["assets/BuildingSceneLayer.cb51597c.js","assets/BuildingComponentSublayer.b5aff654.js","assets/capabilities.26cf9b42.js","assets/I3SIndexInfo.827c76ac.js","assets/I3SLayerDefinitions.a18219e8.js","assets/I3SUtil.1e58a9c4.js","assets/I3SBinaryReader.79df5733.js","assets/popupUtils.1c2a1560.js","assets/BuildingGroupSublayer.d828d7bf.js","assets/SceneService.f97afb0c.js","assets/originUtils.5c585c3a.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceUtils.8a74c93f.js","assets/FetchAssociatedFeatureLayer.65bbdcf5.js"])).default,CSVLayer:async()=>(await Q(()=>import("./CSVLayer.fd8ff16e.js"),["assets/CSVLayer.fd8ff16e.js","assets/clientSideDefaults.a92d19ee.js","assets/QueryEngineCapabilities.ea616409.js"])).default,DimensionLayer:async()=>(await Q(()=>import("./DimensionLayer.756dc000.js"),["assets/DimensionLayer.756dc000.js","assets/Analysis.5b06c0b9.js","assets/LengthDimension.b6aff86b.js"])).default,ElevationLayer:async()=>(await Q(()=>import("./ElevationLayer.c097a187.js"),["assets/ElevationLayer.c097a187.js","assets/ArcGISCachedService.3429d90e.js","assets/TilemapCache.c51d4c38.js"])).default,FeatureLayer:async()=>(await Q(()=>Promise.resolve().then(function(){return xBe}),void 0)).default,GeoJSONLayer:async()=>(await Q(()=>import("./GeoJSONLayer.8f8234f6.js"),["assets/GeoJSONLayer.8f8234f6.js","assets/clientSideDefaults.a92d19ee.js","assets/QueryEngineCapabilities.ea616409.js"])).default,GeoRSSLayer:async()=>(await Q(()=>import("./GeoRSSLayer.7baa6cee.js"),[])).default,GroupLayer:async()=>(await Q(()=>Promise.resolve().then(function(){return PBe}),void 0)).default,ImageryLayer:async()=>(await Q(()=>import("./ImageryLayer.73c5b2e1.js"),["assets/ImageryLayer.73c5b2e1.js","assets/fetchRasterInfo.e95ed0bc.js","assets/dataUtils.08ed60c6.js","assets/pixelRangeUtils.eec66021.js","assets/generateRendererUtils.935a3285.js","assets/imageBitmapUtils.9388147a.js","assets/executeForIds.e65e9cbb.js"])).default,ImageryTileLayer:async()=>(await Q(()=>import("./ImageryTileLayer.fd12cf4e.js"),["assets/ImageryTileLayer.fd12cf4e.js","assets/fetchRasterInfo.e95ed0bc.js","assets/dataUtils.08ed60c6.js","assets/pixelRangeUtils.eec66021.js","assets/generateRendererUtils.935a3285.js","assets/rasterProjectionHelper.3ee8a0a7.js","assets/utils.f5c989f0.js","assets/TilemapCache.c51d4c38.js"])).default,IntegratedMeshLayer:async()=>(await Q(()=>import("./IntegratedMeshLayer.d9c826ea.js"),["assets/IntegratedMeshLayer.d9c826ea.js","assets/persistable.758b5afb.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.2d9abca0.js","assets/SceneService.f97afb0c.js","assets/originUtils.5c585c3a.js","assets/I3SIndexInfo.827c76ac.js","assets/resourceUtils.8a74c93f.js","assets/I3SLayerDefinitions.a18219e8.js","assets/SceneModification.8c38e9b3.js"])).default,KMLLayer:async()=>(await Q(()=>import("./KMLLayer.91b940a8.js"),[])).default,LineOfSightLayer:async()=>(await Q(()=>import("./LineOfSightLayer.69312df5.js"),["assets/LineOfSightLayer.69312df5.js","assets/Analysis.5b06c0b9.js","assets/LineOfSightAnalysisTarget.e53b7123.js","assets/persistable.758b5afb.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.2d9abca0.js","assets/elevationInfoUtils.61d72552.js"])).default,MapImageLayer:async()=>(await Q(()=>import("./MapImageLayer.a703bb64.js"),["assets/MapImageLayer.a703bb64.js","assets/SublayersOwner.92a92dd9.js","assets/QueryTask.7b024924.js","assets/executeForIds.e65e9cbb.js","assets/sublayerUtils.f556487c.js","assets/ExportImageParameters.23657883.js","assets/floorFilterUtils.4de71259.js","assets/imageBitmapUtils.9388147a.js"])).default,MapNotesLayer:async()=>(await Q(()=>import("./MapNotesLayer.ebcee119.js"),["assets/MapNotesLayer.ebcee119.js","assets/objectIdUtils.e2ddfb9a.js"])).default,MediaLayer:async()=>(await Q(()=>import("./MediaLayer.a380e1bd.js"),["assets/MediaLayer.a380e1bd.js","assets/resourceExtension.2d9abca0.js","assets/BoundsStore.7be3138e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/MediaElementView.1aa9b5f7.js","assets/normalizeUtilsSync.af0c844c.js"])).default,OGCFeatureLayer:async()=>(await Q(()=>import("./OGCFeatureLayer.f14a3e06.js"),["assets/OGCFeatureLayer.f14a3e06.js","assets/ogcFeatureUtils.082e00d1.js","assets/geojson.c27e4a17.js","assets/clientSideDefaults.a92d19ee.js","assets/QueryEngineCapabilities.ea616409.js"])).default,OpenStreetMapLayer:async()=>(await Q(()=>import("./OpenStreetMapLayer.d6bf1a04.js"),["assets/OpenStreetMapLayer.d6bf1a04.js","assets/WebTileLayer.410fc5f4.js","assets/imageBitmapUtils.9388147a.js"])).default,OrientedImageryLayer:async()=>(await Q(()=>import("./OrientedImageryLayer.d44b6663.js"),[])).default,PointCloudLayer:async()=>(await Q(()=>import("./PointCloudLayer.c3305910.js"),["assets/PointCloudLayer.c3305910.js","assets/SceneService.f97afb0c.js","assets/originUtils.5c585c3a.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/I3SIndexInfo.827c76ac.js","assets/resourceUtils.8a74c93f.js","assets/PointCloudUniqueValueRenderer.edd5a5a2.js"])).default,RouteLayer:async()=>(await Q(()=>import("./RouteLayer.d9c9395e.js"),["assets/RouteLayer.d9c9395e.js","assets/originUtils.5c585c3a.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/Stop.d94a9ad1.js"])).default,SceneLayer:async()=>(await Q(()=>import("./SceneLayer.1792de85.js"),["assets/SceneLayer.1792de85.js","assets/SceneService.f97afb0c.js","assets/originUtils.5c585c3a.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/I3SIndexInfo.827c76ac.js","assets/resourceUtils.8a74c93f.js","assets/capabilities.26cf9b42.js","assets/FetchAssociatedFeatureLayer.65bbdcf5.js","assets/I3SLayerDefinitions.a18219e8.js","assets/persistable.758b5afb.js","assets/resourceExtension.2d9abca0.js","assets/I3SUtil.1e58a9c4.js","assets/I3SBinaryReader.79df5733.js","assets/popupUtils.1c2a1560.js"])).default,StreamLayer:async()=>(await Q(()=>import("./StreamLayer.04d6207d.js"),[])).default,SubtypeGroupLayer:async()=>(await Q(()=>import("./SubtypeGroupLayer.f6b1d598.js"),[])).default,TileLayer:async()=>(await Q(()=>import("./TileLayer.3aafd23d.js"),["assets/TileLayer.3aafd23d.js","assets/ArcGISCachedService.3429d90e.js","assets/TilemapCache.c51d4c38.js","assets/SublayersOwner.92a92dd9.js","assets/QueryTask.7b024924.js","assets/executeForIds.e65e9cbb.js","assets/sublayerUtils.f556487c.js","assets/imageBitmapUtils.9388147a.js"])).default,UnknownLayer:async()=>(await Q(()=>import("./UnknownLayer.75351a00.js"),[])).default,UnsupportedLayer:async()=>(await Q(()=>import("./UnsupportedLayer.70f669d5.js"),[])).default,VectorTileLayer:async()=>(await Q(()=>import("./VectorTileLayer.d204706f.js"),["assets/VectorTileLayer.d204706f.js","assets/ArcGISCachedService.3429d90e.js","assets/TilemapCache.c51d4c38.js","assets/jsonContext.1eaa7625.js","assets/StyleRepository.29dbb147.js","assets/enums.89506096.js","assets/TileClipper.7b9dd3ce.js"])).default,VoxelLayer:async()=>(await Q(()=>import("./VoxelLayer.ef68c8a1.js"),["assets/VoxelLayer.ef68c8a1.js","assets/SceneService.f97afb0c.js","assets/originUtils.5c585c3a.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/I3SIndexInfo.827c76ac.js","assets/resourceUtils.8a74c93f.js","assets/persistable.758b5afb.js","assets/resourceExtension.2d9abca0.js"])).default,WFSLayer:async()=>(await Q(()=>import("./WFSLayer.7fa54105.js"),["assets/WFSLayer.7fa54105.js","assets/clientSideDefaults.a92d19ee.js","assets/QueryEngineCapabilities.ea616409.js","assets/wfsUtils.a25e8dc2.js","assets/geojson.c27e4a17.js","assets/xmlUtils.e4562140.js"])).default,WMSLayer:async()=>(await Q(()=>import("./WMSLayer.54ec3ea0.js"),["assets/WMSLayer.54ec3ea0.js","assets/crsUtils.5da2e8ef.js","assets/ExportWMSImageParameters.9437c158.js","assets/imageBitmapUtils.9388147a.js"])).default,WMTSLayer:async()=>(await Q(()=>import("./WMTSLayer.5decd3f8.js"),["assets/WMTSLayer.5decd3f8.js","assets/WebTileLayer.410fc5f4.js","assets/imageBitmapUtils.9388147a.js","assets/crsUtils.5da2e8ef.js","assets/xmlUtils.e4562140.js"])).default,WebTileLayer:async()=>(await Q(()=>import("./WebTileLayer.410fc5f4.js").then(function(e){return e.W}),["assets/WebTileLayer.410fc5f4.js","assets/imageBitmapUtils.9388147a.js"])).default};function j1e(e){return new cA({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return!!i&&"tables"in i&&i.tables.includes(t)}})}function aW(e,t,i){let r,s;if(e)for(let n=0,o=e.length;n<o;n++){if(r=e.getItemAt(n),r[t]===i)return r;if((r==null?void 0:r.type)==="group"&&(s=aW(r.layers,t,i),s))return s}}const H1e=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new Qe;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||se.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",mT(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof VI){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Yh(i)?i.then(n=>{this.destroyed||this.add(n,r)}):se.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return aW(this.layers,"id",i)}findLayerByUid(i){return aW(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([d()],t.prototype,"layers",null),t=u([P("esri.support.LayersMixin")],t),t};function lW(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const n=e.getItemAt(r);if(n[t]===i)return n;if((n==null?void 0:n.type)==="group"){const o=lW(n.tables,t,i);if(o)return o}}}const q1e=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new Qe,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&se.getLogger(this.declaredClass).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",mT(i,this._get("tables")))}findTableById(i){return lW(this.tables,"id",i)}findTableByUid(i){return lW(this.tables,"uid",i)}};return u([d()],t.prototype,"tables",null),t=u([P("esri.support.TablesMixin")],t),t},CBe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),ABe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function MBe(e){return e.layerContainerType==="basemap"?CBe:e.layerContainerType==="operational-layers"?ABe:null}function RBe(e,t){if(t.restrictedWebMapWriting){const i=MBe(t);return!v(i)||i.has(e.type)&&!SJ(e)}return!0}function OBe(e,t){if(t)if(SJ(e)){const i=r$("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&X9(e,r)}else e.type==="stream"?X9(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&X9(e,t)}function X9(e,t){var i,r;"maxScale"in e&&(t.maxScale=(i=p5(e.maxScale))!=null?i:void 0),"minScale"in e&&(t.minScale=(r=p5(e.minScale))!=null?r:void 0)}function IBe(e,t){var i;if(OBe(e,t),t&&("blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=(i=p5(e.opacity))!=null?i:void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts"))if(SJ(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function cW(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new H("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(RBe(e,i)){const r={};return e.write(r,i)?r:null}return v(t)&&IBe(e,t=ne(t)),t}let ru=class extends W_e(k1e(h1e(L1e(q1e(H1e(PJ(VI))))))){constructor(e){super(e),this._visibilityHandles={},this.allLayers=new cA({getCollections:()=>[this.layers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=j1e(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group"}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles(te(()=>this.visible,this._onVisibilityChange.bind(this),hr))}_writeLayers(e,t,i,r){const s=[];if(!e)return s;e.forEach(n=>{const o=cW(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);v(o)&&o.layerType&&s.push(o)}),t.layers=s}set portalItem(e){this._set("portalItem",e)}set visibilityMode(e){const t=this._get("visibilityMode")!==e;this._set("visibilityMode",e),t&&this._enforceVisibility(e,this.visible)}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"],layerModuleTypeMap:EBe},e)),Promise.resolve(this)}async loadAll(){return _K(this,e=>{e(this.layers,this.tables)})}layerAdded(e){e.visible&&this.visibilityMode==="exclusive"?this._turnOffOtherLayers(e):this.visibilityMode==="inherited"&&(e.visible=this.visible),this._visibilityHandles[e.uid]=te(()=>e.visible,t=>this._onChildVisibilityChange(e,t),hr)}layerRemoved(e){const t=this._visibilityHandles[e.uid];t&&(t.remove(),delete this._visibilityHandles[e.uid]),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(t=>{t!==e&&(t.visible=!1)})}_enforceVisibility(e,t){if(!ml(this).initialized)return;const i=this.layers;let r=i.find(s=>s.visible);switch(e){case"exclusive":i.length&&!r&&(r=i.getItemAt(0),r.visible=!0),this._turnOffOtherLayers(r);break;case"inherited":i.forEach(s=>{s.visible=t})}}_onVisibilityChange(e){this.visibilityMode==="inherited"&&this.layers.forEach(t=>{t.visible=e})}_onChildVisibilityChange(e,t){switch(this.visibilityMode){case"exclusive":t?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case"inherited":e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};u([d({readOnly:!0,dependsOn:[]})],ru.prototype,"allLayers",void 0),u([d({readOnly:!0})],ru.prototype,"allTables",void 0),u([d()],ru.prototype,"fullExtent",void 0),u([d({json:{read:!0,write:!0}})],ru.prototype,"blendMode",void 0),u([d({json:{read:!1,write:{ignoreOrigin:!0}}})],ru.prototype,"layers",void 0),u([Ge("layers")],ru.prototype,"_writeLayers",null),u([d({type:["GroupLayer"]})],ru.prototype,"operationalLayerType",void 0),u([d({json:{origins:{"web-document":{read:!1,write:!1}}}})],ru.prototype,"portalItem",null),u([d()],ru.prototype,"spatialReference",void 0),u([d({json:{read:!1},readOnly:!0,value:"group"})],ru.prototype,"type",void 0),u([d({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{read:!1,write:!1}}}})],ru.prototype,"visibilityMode",null),ru=u([P("esri.layers.GroupLayer")],ru);const W1e=ru;var PBe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:W1e});async function $Be(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,i=await NJ("esri/t9n/basemaps");return i[e]||i[t]}const uW={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Vi("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Vi("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Vi("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Vi("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Vi("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Vi("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Vi("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Vi("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Vi("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Vi("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Vi("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Vi("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Vi("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Vi("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Vi("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Vi("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};var KN;let LBe=0;const X1e="esri.Basemap";let _d=KN=class extends l$(sp){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+LBe++,this.baseLayers=new Qe,this.referenceLayers=new Qe;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&se.getLogger(this.declaredClass).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{se.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const e=this.baseLayers.removeAll();for(const r of e)r.destroy();const t=this.referenceLayers.removeAll();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",mT(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=cW(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);v(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=cW(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);v(n)&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",mT(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return _K(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new KN({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=ne(i);return r.url&&Rg(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Rg(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;ii(e);const r=[];if(t){const s=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;r.push($Be(n).then(o=>{o&&this.read({title:o},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await Q(()=>import("./layersCreator.5ed02220.js"),["assets/layersCreator.5ed02220.js","assets/portalLayers.2cf8d543.js","assets/layersLoader.e48a79d9.js","assets/fetchService.ef2e52b5.js","assets/jsonContext.1eaa7625.js"]),a=[];if(ii(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,e.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const p=o(this.referenceLayers,e.baseMapLayers.filter(c),l);a.push(p)}await Eo(a)}async _loadFromItem(e,t){var n,o;const i=await e.load(t),r=await i.fetchData("json",t),s=Ma((n=e.itemUrl)!=null?n:"");return this._set("resourceInfo",{data:(o=r.baseMap)!=null?o:{},context:{origin:e.type==="Web Scene"?"web-scene":"web-map",portal:e.portal||po.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||po.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=uW[e];if(t){if(t.deprecated){let i=null;e==="dark-gray"?i="dark-gray-vector":e==="gray"?i="gray-vector":e==="streets"?i="streets-vector":e==="topo"&&(i="topo-vector"),Hme(se.getLogger(X1e),`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return KN.fromJSON(t)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Qe}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],_d.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],_d.prototype,"id",void 0),u([d({type:L3})],_d.prototype,"portalItem",void 0),u([d()],_d.prototype,"referenceLayers",null),u([d({readOnly:!0})],_d.prototype,"resourceInfo",void 0),u([d({type:et})],_d.prototype,"spatialReference",void 0),u([d()],_d.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],_d.prototype,"title",void 0),u([Ge("title")],_d.prototype,"writeTitle",null),_d=KN=u([P(X1e)],_d);const vT=_d;var DBe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:vT}),hW;let QN=hW=class extends ge{constructor(e){super(e),this.type="none"}clone(){return new hW({type:this.type})}};u([bt({none:"none",stayAbove:"stay-above"})],QN.prototype,"type",void 0),QN=hW=u([P("esri.ground.NavigationConstraint")],QN);let rn=class extends Te{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};u([d()],rn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],rn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],rn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],rn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],rn.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],rn.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],rn.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],rn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],rn.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],rn.prototype,"SHOW_POI",void 0),u([d()],rn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],rn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],rn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],rn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],rn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],rn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],rn.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],rn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],rn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],rn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],rn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],rn.prototype,"LINE_WIREFRAMES",void 0),u([d()],rn.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),rn=u([P("esri.views.3d.support.DebugFlags")],rn);const cr=new rn;var dW;let Em=dW=class extends l$(sp){constructor(e){super(e),this.opacity=1,this.shading=!cr.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Qe;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&se.getLogger(this.declaredClass).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{se.getLogger(this.declaredClass).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",mT(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r={...r,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const o={};kNe(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new H("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return _K(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await Q(()=>import("./ElevationQuery.b9aff1cf.js"),[]);ii(t);const r=new i,s=this.layers.filter(rne).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await Q(()=>import("./ElevationQuery.b9aff1cf.js"),[]);ii(t);const r=new i,s=this.layers.filter(rne).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:ne(this.surfaceColor),navigationConstraint:ne(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new dW({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return Q(()=>import("./layersCreator.5ed02220.js"),["assets/layersCreator.5ed02220.js","assets/portalLayers.2cf8d543.js","assets/layersLoader.e48a79d9.js","assets/fetchService.ef2e52b5.js","assets/jsonContext.1eaa7625.js"]).then(({populateOperationalLayers:o})=>{ii(i);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return Eo(a)}).then(()=>{})}};function FBe(e){return e&&"createElevationSampler"in e}function rne(e){return e.type==="elevation"||FBe(e)}u([d({json:{read:!1}})],Em.prototype,"layers",null),u([Ge("layers")],Em.prototype,"writeLayers",null),u([d({readOnly:!0})],Em.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:us,read:{reader:LI,source:"transparency"},write:{writer:(e,t)=>{t.transparency=z6(e)},target:"transparency"}}})],Em.prototype,"opacity",void 0),u([d({type:Boolean,nonNullable:!0,json:{read:!1}})],Em.prototype,"shading",void 0),u([d({type:De,json:{type:[us],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],Em.prototype,"surfaceColor",void 0),u([d({type:QN,json:{write:!0}})],Em.prototype,"navigationConstraint",void 0),Em=dW=u([P("esri.Ground")],Em);const G5=Em;function NBe(e){var t,i;return!(!(e!=null&&e.loaded)||!((i=(t=H0e(e))==null?void 0:t.operations)!=null&&i.supportsEditing)||"editingEnabled"in e&&!s4e(e))}const sne=se.getLogger("esri.support.basemapUtils");function kBe(){return{}}function UBe(e){for(const t in e){const i=e[t];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete e[t]}}function VBe(e,t){let i;if(typeof e=="string"){if(!(e in uW)){const r=Object.entries(uW).filter(([s,n])=>or.apiKey&&!n.classic||!or.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return sne.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${r}`),null}t&&(i=t[e]),i||(i=vT.fromId(e),t&&(t[e]=i))}else i=zr(vT,e);return i!=null&&i.destroyed&&(sne.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function BBe(e,t){return e===t?!0:qBe(nne(e),nne(t),{mustMatchReferences:!0})==="equal"}function zBe(e,t){var n,o,a;if(C(t)||C(e))return{spatialReference:null,updating:!1};if(t.loadStatus==="not-loaded")return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(t.baseLayers.length===0)return{spatialReference:null,updating:!1};const i=t.baseLayers.getItemAt(0);switch(i.loadStatus){case"not-loaded":i.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const r=(("supportedSpatialReferences"in i?i.supportedSpatialReferences:null)||["tileInfo"in i?(n=i.tileInfo)==null?void 0:n.spatialReference:i.spatialReference]).filter(Boolean),s=e.spatialReference;return s?{spatialReference:(a=(o=r.find(l=>s.equals(l)))!=null?o:r[0])!=null?a:null,updating:!1}:{spatialReference:r[0],updating:!1}}function nne(e){return e?!e.loaded&&e.resourceInfo?jBe(e.resourceInfo.data):{baseLayers:one(e.baseLayers),referenceLayers:one(e.referenceLayers)}:null}function one(e){return(Qe.isCollection(e)?e.toArray():e).map(GBe)}function GBe(e){var t,i;return{type:e.type,url:Y1e("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||!v(e.sublayers)||(t=e.sublayers)==null?void 0:t.map(r=>({id:r.id,visible:r.visible})),activeLayerId:e.type==="wmts"?(i=e.activeLayer)==null?void 0:i.id:void 0}}function jBe(e){var t,i;return e?{baseLayers:ane(((t=e.baseMapLayers)!=null?t:[]).filter(r=>!r.isReference)),referenceLayers:ane(((i=e.baseMapLayers)!=null?i:[]).filter(r=>r.isReference))}:null}function ane(e){return e.map(t=>HBe(t))}function HBe(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;default:t="unknown"}return{type:t,url:Y1e(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale!=null?e.minScale:0,maxScale:e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function qBe(e,t,i){return e!=null!=(t!=null)?"not-equal":!e||!t?"equal":lne(e.baseLayers,t.baseLayers)?lne(e.referenceLayers,t.referenceLayers)?"equal":i.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function lne(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!WBe(e[i],t[i]))return!1;return!0}function WBe(e,t){if(e.type!==t.type||e.type==="scene"||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(v(e.activeLayerId)||v(t.activeLayerId))return e.activeLayerId===t.activeLayerId;if(v(e.sublayers)||v(t.sublayers)){if(C(e.sublayers)||C(t.sublayers)||e.sublayers.length!==t.sublayers.length)return!1;for(let i=0;i<e.sublayers.length;i++){const r=e.sublayers.at(i),s=t.sublayers.at(i);if((r==null?void 0:r.id)!==(s==null?void 0:s.id)||(r==null?void 0:r.visible)!==(s==null?void 0:s.visible))return!1}}return!0}function Y1e(e){return e?Yd(e).replace(/^\s*https?:/i,"").toLowerCase():""}const cne={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function XBe(e){let t=null;if(typeof e=="string")if(e in cne){const i=cne[e];t=new G5({resourceInfo:{data:{layers:[i]}}})}else se.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=zr(G5,e);return t}let Cm=class extends q1e(H1e(ps.EventedMixin(Te))){constructor(e){super(e),this.allLayers=new cA({getCollections:()=>{var t,i,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=j1e(this),this.basemap=null,this.editableLayers=new cA({getCollections:()=>[this.allLayers],itemFilterFunction:NBe}),this.ground=new G5,this._basemapCache=kBe()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),UBe(this._basemapCache),this._basemapCache=null}castBasemap(e){return VBe(e,this._basemapCache)}castGround(e){const t=XBe(e);return C(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],Cm.prototype,"allLayers",void 0),u([d({readOnly:!0})],Cm.prototype,"allTables",void 0),u([d({type:vT})],Cm.prototype,"basemap",void 0),u([Zt("basemap")],Cm.prototype,"castBasemap",null),u([d({readOnly:!0})],Cm.prototype,"editableLayers",void 0),u([d({type:G5,nonNullable:!0})],Cm.prototype,"ground",void 0),u([Zt("ground")],Cm.prototype,"castGround",null),Cm=u([P("esri.Map")],Cm);const Z1e=Cm;class Y1{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,n=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return ye(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}}function vK(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const YBe=vK(new Y1(0,2*Math.PI)),Z1=vK(new Y1(-Math.PI,Math.PI)),bK=vK(new Y1(0,360));let Dy=class extends Ys(ge){constructor(...e){super(...e),this.position=new ut([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=Fd(e.x||0),s.y=Fd(e.y||0),s.z=e.hasZ?Fd(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new ut;return i.read(e,t),i.x=Fd(i.x||0),i.y=Fd(i.y||0),i.z=i.hasZ?Fd(i.z||0):i.z,i}equals(e){return!C(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:ut,json:{write:{isRequired:!0}}})],Dy.prototype,"position",void 0),u([Ge("position")],Dy.prototype,"writePosition",null),u([Fe("position")],Dy.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Zt(e=>bK.normalize(Fd(e)))],Dy.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Zt(e=>ye(Fd(e),-180,180))],Dy.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Dy.prototype,"fov",void 0),Dy=u([P("esri.Camera")],Dy);const op=Dy;var pW;let gv=pW=class extends ge{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new pW({rotation:this.rotation,scale:this.scale,targetGeometry:v(this.targetGeometry)?this.targetGeometry.clone():null,camera:v(this.camera)?this.camera.clone():null})}};function Y9(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Y9}}}}})],gv.prototype,"rotation",void 0),u([Zt("rotation")],gv.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Y9}}}}})],gv.prototype,"scale",void 0),u([d({types:ZT,json:{read:Jl,write:!0,origins:{"web-scene":{read:Jl,write:{overridePolicy:Y9}}}}})],gv.prototype,"targetGeometry",void 0),u([d({type:op,json:{write:!0}})],gv.prototype,"camera",void 0),gv=pW=u([P("esri.Viewpoint")],gv);const ap=gv;function MU(e){return typeof e=="string"?document.getElementById(e):e!=null?e:null}function J1e(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function une(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function hne(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}let k3=class extends jf(Qe){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{C(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Qe.ofType(this.itemType.Type))(e):new Qe(e)}};function fW(e,t){return{type:e,cast:i0e,set(i){const r=mT(i,this._get(t),e);r.owner=this,this._set(t,r)}}}u([d()],k3.prototype,"owner",null),k3=u([P("esri.core.support.OwningCollection")],k3);class W0{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&zC(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*dne);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,dne));t++)this._items.push(this._allocator())}}const dne=1024;function Pe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function uA(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function wK(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,_){return[e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,_]}function K1e(e,t){return new Float64Array(e,t,16)}const Hh=Pe();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Hh,clone:uA,create:Pe,createView:K1e,fromValues:wK},Symbol.toStringTag,{value:"Module"}));var Au;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Au||(Au={}));function Q1e(e){return 32+e.length}function ebe(e){return 16}function tbe(e){if(!e)return 0;let t=sbe;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=Q1e(r);break;case"number":t+=ebe();break;case"boolean":t+=4}}return t}function ibe(e){if(!e)return 0;if(Array.isArray(e))return ZBe(e);let t=sbe;for(const i in e)e.hasOwnProperty(i)&&(t+=rbe(e[i]));return t}function ZBe(e){const t=e.length;if(t===0||typeof e[0]=="number")return 32+8*t;let i=nbe;for(let r=0;r<t;r++)i+=rbe(e[r]);return i}function rbe(e){switch(typeof e){case"object":return ibe(e);case"string":return Q1e(e);case"number":return ebe();case"boolean":return 4;default:return 8}}function JMt(e,t){return nbe+e.length*t}const sbe=32,nbe=32;var hA;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(hA||(hA={}));function Cs(){return[1,0,0,0,1,0,0,0,1]}function JBe(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function KBe(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]}function obe(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:JBe,create:Cs,createView:obe,fromValues:KBe},Symbol.toStringTag,{value:"Module"}));function fp(){return[0,0,0,1]}function QBe(e){return[e[0],e[1],e[2],e[3]]}function eze(e,t,i,r){return[e,t,i,r]}function abe(e,t){return new Float64Array(e,t,4)}const tze=fp();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:tze,clone:QBe,create:fp,createView:abe,fromValues:eze},Symbol.toStringTag,{value:"Module"}));function tt(){return[0,0]}function PO(e){return[e[0],e[1]]}function er(e,t){return[e,t]}function lbe(e){const t=tt(),i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function cbe(e,t){return new Float64Array(e,t,2)}function ube(){return tt()}function hbe(){return er(1,1)}function dbe(){return er(1,0)}function pbe(){return er(0,1)}const Bc=ube(),fbe=hbe(),ize=dbe(),rze=pbe();Object.freeze(Object.defineProperty({__proto__:null,ONES:fbe,UNIT_X:ize,UNIT_Y:rze,ZEROS:Bc,clone:PO,create:tt,createView:cbe,fromArray:lbe,fromValues:er,ones:hbe,unitX:dbe,unitY:pbe,zeros:ube},Symbol.toStringTag,{value:"Module"}));class Eh{constructor(t,i,r){this._itemByteSize=t,this._itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this._itemByteSize)}get(){this._itemsPtr===0&&zC(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const i=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this._itemCreate(i,r*this._itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=yS){return new Eh(16,cbe,t)}static createVec3f64(t=yS){return new Eh(24,qY,t)}static createVec4f64(t=yS){return new Eh(32,Q0e,t)}static createMat3f64(t=yS){return new Eh(72,obe,t)}static createMat4f64(t=yS){return new Eh(128,K1e,t)}static createQuatf64(t=yS){return new Eh(32,abe,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const yS=4*hA.KILOBYTES,KMt=Eh.createVec2f64(),Xe=Eh.createVec3f64(),xK=Eh.createVec4f64();Eh.createMat3f64();const TK=Eh.createMat4f64(),QMt=Eh.createQuatf64();function Hf(e){return e?{origin:js(e.origin),vector:js(e.vector)}:{origin:O(),vector:O()}}function sze(e,t){const i=oze.get();return i.origin=e,i.vector=t,i}function eRt(e,t=Hf()){return nze(e.origin,e.vector,t)}function nze(e,t,i=Hf()){return le(i.origin,e),le(i.vector,t),i}function Zx(e,t,i=Hf()){return le(i.origin,e),me(i.vector,t,e),i}function SK(e,t){const i=me(Xe.get(),t,e.origin),r=_e(e.vector,i),s=_e(e.vector,e.vector),n=ye(r/s,0,1),o=me(Xe.get(),ae(Xe.get(),e.vector,n),i);return _e(o,o)}function tRt(e,t,i){return mW(e,t,0,1,i)}function iRt(e,t,i){return fe(i,e.origin,ae(i,e.vector,t))}function mW(e,t,i,r,s){const{vector:n,origin:o}=e,a=me(Xe.get(),t,o),l=_e(n,a)/ll(n);return ae(s,n,ye(l,i,r)),fe(s,s,e.origin)}function rRt(e,t){if(gbe(e,sze(t.origin,t.direction),!1,j5)){const{tA:i,pB:r,distance2:s}=j5;if(i>=0&&i<=1)return s;if(i<0)return Ta(e.origin,r);if(i>1)return Ta(fe(Xe.get(),e.origin,e.vector),r)}return null}function mbe(e,t,i){return!!gbe(e,t,!0,j5)&&(le(i,j5.pA),!0)}function gbe(e,t,i,r){const n=e.origin,o=fe(Xe.get(),n,e.vector),a=t.origin,l=fe(Xe.get(),a,t.vector),c=Xe.get(),h=Xe.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=Xe.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],b=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-m*m;if(Math.abs(b)<1e-6)return!1;let w=(f*m-y*_)/b,T=(f+m*w)/_;i&&(w=ye(w,0,1),T=ye(T,0,1));const S=Xe.get(),E=Xe.get();return S[0]=n[0]+w*p[0],S[1]=n[1]+w*p[1],S[2]=n[2]+w*p[2],E[0]=a[0]+T*h[0],E[1]=a[1]+T*h[1],E[2]=a[2]+T*h[2],r.tA=w,r.tB=T,r.pA=S,r.pB=E,r.distance2=Ta(S,E),!0}const j5={tA:0,tB:0,pA:O(),pB:O(),distance2:0},oze=new W0(()=>Hf());function Xo(e){return e?pne(js(e.origin),js(e.direction)):pne(O(),O())}function pne(e,t){return{origin:e,direction:t}}function sRt(e,t){return xg(e.origin,t.origin)&&xg(e.direction,t.direction)}function qh(e,t){const i=uze.get();return i.origin=e,i.direction=t,i}function H5(e,t=Xo()){return ybe(e.origin,e.direction,t)}function aze(e,t,i=Xo()){return le(i.origin,e),me(i.direction,t,e),i}function ybe(e,t,i=Xo()){return le(i.origin,e),le(i.direction,t),i}function lze(e,t){const i=_t(Xe.get(),be(Xe.get(),e.direction),me(Xe.get(),t,e.origin));return _e(i,i)}function cze(e,t,i){const r=_e(e.direction,me(i,t,e.origin));return fe(i,e.origin,ae(i,e.direction,r)),i}const uze=new W0(()=>Xo());function U3(e,t){return _e(e,t)/Oe(e)}function EK(e,t){const i=_e(e,t)/(Oe(e)*Oe(t));return-uo(i)}function _be(e,t,i){be(qL,e),be(Z9,t);const r=_e(qL,Z9),s=uo(r),n=_t(qL,qL,Z9);return _e(n,i)<0?2*Math.PI-s:s}const qL=O(),Z9=O();function Gn(){return ui()}function dA(e,t=Gn()){return gf(t,e)}function vbe(e,t){return Yt(e[0],e[1],e[2],t)}function hze(e){return e}function bbe(e){e[0]=e[1]=e[2]=e[3]=0}function RU(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function g0(e){return e[3]}function dze(e){return e}function wbe(e,t,i,r){return Yt(e,t,i,r)}function pze(e,t,i){return e!==i&&le(i,e),i[3]=e[3]+t,i}function fze(e,t,i){return se.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),e===i?i:dA(e,i)}function gb(e,t,i){if(C(t))return!1;const{origin:r,direction:s}=t,n=mze;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const mze=O();function gW(e,t){return gb(e,t,null)}function gze(e,t,i){if(gb(e,t,i))return i;const r=mM(e,t,Xe.get());return fe(i,t.origin,ae(Xe.get(),t.direction,Vr(t.origin,r)/Oe(t.direction))),i}function mM(e,t,i){const r=Xe.get(),s=TK.get();_t(r,t.origin,t.direction);const n=g0(e);_t(i,r,t.origin),ae(i,i,1/Oe(i)*n);const o=Sbe(e,t.origin),a=EK(t.origin,i);return jh(s,a+o,r),Ze(i,i,s),i}function yze(e,t,i){return gb(e,t,i)?i:(cze(t,e,i),xbe(e,i,i))}function xbe(e,t,i){const r=me(Xe.get(),t,e),s=ae(Xe.get(),r,e[3]/Oe(r));return fe(i,s,e)}function Tbe(e,t){const i=me(Xe.get(),t,e),r=ll(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function Sbe(e,t){const i=me(Xe.get(),t,e),r=Oe(i),s=g0(e),n=s+Math.abs(s-r);return uo(s/n)}const J9=O();function Ebe(e,t,i,r){const s=me(J9,t,e);switch(i){case Au.X:{const n=Zte(s,J9)[2];return ue(r,-Math.sin(n),Math.cos(n),0)}case Au.Y:{const n=Zte(s,J9),o=n[1],a=n[2],l=Math.sin(o);return ue(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Au.Z:return be(r,s);default:return}}function Cbe(e,t){const i=me(yW,t,e);return Oe(i)-e[3]}function _ze(e,t,i,r){const s=Cbe(e,t),n=Ebe(e,t,Au.Z,yW),o=ae(yW,n,i-s);return fe(r,t,o)}function vze(e,t){const i=Ta(e,t),r=g0(e);return i<=r*r}const yW=O(),OU=Gn(),bze=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:Cbe,angleToSilhouette:Sbe,axisAt:Ebe,clear:bbe,closestPoint:yze,closestPointOnSilhouette:mM,containsPoint:vze,copy:dA,create:Gn,distanceToSilhouette:Tbe,elevate:pze,fromCenterAndRadius:vbe,fromRadius:RU,fromValues:wbe,getCenter:dze,getRadius:g0,intersectRay:gb,intersectRayClosestSilhouette:gze,intersectsRay:gW,projectPoint:xbe,setAltitudeAt:_ze,setExtent:fze,tmpSphere:OU,wrap:hze},Symbol.toStringTag,{value:"Module"}));function bT(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function wze(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return ue(e,i,r,s),e}function nRt(e,t,i){i=i||e;const r=_e(e,t);ue(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),be(i,i)}function oRt(e,t,i){Math.abs(e[0])>Math.abs(e[1])?ue(t,0,1,0):ue(t,1,0,0),_t(i,e,t),be(t,t),_t(t,i,e),be(i,i)}function WL(e,t,i,r,s,n){const o=e+(t-e)*s;return o+(i+(r-i)*s-o)*n}function xze(e,t,i,r=O()){const s=Oe(e),n=Oe(t),o=_e(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return ae(Px,e,c),ae($x,t,h),fe(r,Px,$x)}return On(r,e,t,i)}function aRt(e,t,i,r=O(),s=O()){const n=Oe(e),o=Oe(t),a=_e(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,y=m/o*h;ae(Px,e,m/n*p),ae($x,t,y),fe(r,Px,$x)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+p*(-n+o));ae(Px,e,m);const y=1/o*(Math.cos(i*l)*l*f+h*(-n+o));ae($x,t,y),fe(s,Px,$x),ae(s,s,1/c)}return s}return On(r,e,t,i),me(s,t,e),be(s,s),s}function e4(e,t,i){e=be(Px,e),t=be($x,t);const r=uo(_e(e,t));if(i){const s=_t(Tze,e,t);if(_e(s,i)<0)return-r}return r}function t4(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],o=(n-i)/(n-s);return o*e[r-1][1]+(1-o)*e[r][1]}}function lRt(e,t,i,r){me(fne,t,e),me(mne,i,e),_t(r,fne,mne),be(r,r),r[3]=-_e(e,r)}const fne=O(),mne=O(),Tze=O(),Px=O(),$x=O();function nr(e=$O){return[e[0],e[1],e[2],e[3]]}function Sze(e=$O[0],t=$O[1],i=$O[2],r=$O[3]){return CK(e,t,i,r,xK.get())}function IU(e,t){return CK(t[0],t[1],t[2],t[3],e)}function CK(e,t,i,r,s=nr()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Abe(e,t,i){return le(i,e),i[3]=t,i}function A$(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function ol(e,t,i,r=nr()){const s=i[0]-t[0],n=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*y,r[1]=p*y,r[2]=f*y,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function Mbe(e,t,i,r,s){const n=e.length/3;if(n<3)return!1;ue(qM,e[3*i],e[3*i+1],e[3*i+2]);let o=r,a=!1;for(;o<n-1&&!a;){const l=3*o;ue(_S,e[l],e[l+1],e[l+2]),o++,a=!ql(qM,_S)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;ue(mx,e[l],e[l+1],e[l+2]),o++,me(XL,qM,_S),be(XL,XL),me(YL,_S,mx),be(YL,YL),a=!ql(qM,mx)&&!ql(_S,mx)&&Math.abs(_e(XL,YL))<Eze}return a?(ol(qM,_S,mx,t),!0):(i!==0||r!==1||s!==2)&&Mbe(e,t,0,1,2)}const Eze=.99619469809,qM=O(),_S=O(),mx=O(),XL=O(),YL=O();function _W(e,t,i){return t!==e&&IU(e,t),e[3]=-_e(e,i),e}function vW(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function XI(e,t,i,r){return _t(mx,t,e),A$(i,mx,r)}function cRt(e,t,i,r){return PU(e,t,me(Xe.get(),i,t),Ize,r)}function nS(e,t,i){return!!v(t)&&PU(e,t.origin,t.direction,Pze,i)}function Cze(e,t,i){return PU(e,t.origin,t.vector,gg.NONE,i)}function Aze(e,t,i){return PU(e,t.origin,t.vector,gg.CLAMP,i)}function Rbe(e,t){return Ur(e,t)>=0}function Mze(e,t){const i=_e(e,t.ray.direction),r=-Ur(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function Rze(e,t){const i=_e(e,t.ray.direction),r=-Ur(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function Oze(e,t,i){const r=ae(Xe.get(),e,-e[3]),s=bW(e,me(Xe.get(),t,r),Xe.get());return fe(i,s,r),i}function bW(e,t,i){const r=ae(Xe.get(),e,_e(e,t));return me(i,t,r),i}function Ur(e,t){return _e(e,t)+e[3]}function PU(e,t,i,r,s){const n=_e(e,i);if(n===0)return!1;let o=-(_e(e,t)+e[3])/n;return r&gg.CLAMP&&(o=ye(o,0,1)),!(!(r&gg.INFINITE_MIN)&&o<0||!(r&gg.INFINITE_MAX)&&o>1)&&(fe(s,t,ae(s,i,o)),!0)}function uRt(e){return e}const $O=[0,0,1,0];var gg;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(gg||(gg={}));const Ize=gg.INFINITE_MIN|gg.INFINITE_MAX,Pze=gg.INFINITE_MAX,K9=se.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class $ze{constructor(){this.plane=nr(),this.origin=O(),this.basis1=O(),this.basis2=O()}}const Obe=$ze;function X0(e=Bbe){return{plane:nr(e.plane),origin:js(e.origin),basis1:js(e.basis1),basis2:js(e.basis2)}}function Lze(e,t,i){const r=qze.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=Sze(0,0,0,0),$U(r),r}function oS(e,t=X0()){return AK(e.origin,e.basis1,e.basis2,t)}function Dze(e,t){le(t.origin,e.origin),le(t.basis1,e.basis1),le(t.basis2,e.basis2),IU(t.plane,e.plane)}function AK(e,t,i,r=X0()){return le(r.origin,e),le(r.basis1,t),le(r.basis2,i),$U(r),jze(r,"fromValues()"),r}function $U(e){XI(e.basis2,e.basis1,e.origin,e.plane)}function Ibe(e,t,i){e!==i&&oS(e,i);const r=ae(Xe.get(),$0(e),t);return fe(i.origin,i.origin,r),i.plane[3]-=t,i}function Fze(e,t,i){return Pbe(t,i),Ibe(i,IK(e,e.origin),i),i}function Pbe(e,t=X0()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return ue(t.origin,e[0]+i,e[1]+r,0),ue(t.basis1,i,0,0),ue(t.basis2,0,r,0),CK(0,0,1,0,t.plane),t}function MK(e,t,i){return!!nS(e.plane,t,i)&&Ube(e,i)}function Nze(e,t,i){if(MK(e,t,i))return i;const r=$be(e,t,Xe.get());return fe(i,t.origin,ae(Xe.get(),t.direction,Vr(t.origin,r)/Oe(t.direction))),i}function $be(e,t,i){const r=q5.get();Vbe(e,t,r,q5.get());let s=Number.POSITIVE_INFINITY;for(const n of $K){const o=PK(e,n,LU.get()),a=Xe.get();if(Cze(r,o,a)){const l=z0(Xe.get(),t.origin,a),c=Math.abs(uo(_e(t.direction,l)));c<s&&(s=c,le(i,a))}}return s===Number.POSITIVE_INFINITY?Lbe(e,t,i):i}function Lbe(e,t,i){if(MK(e,t,i))return i;const r=q5.get(),s=q5.get();Vbe(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of $K){const a=PK(e,o,LU.get()),l=Xe.get();if(Aze(r,a,l)){const c=lze(t,l);if(!Rbe(s,l))continue;c<n&&(n=c,le(i,l))}}return RK(e,t.origin)<n&&Dbe(e,t.origin,i),i}function Dbe(e,t,i){const r=Oze(e.plane,t,Xe.get()),s=mW(gne(e,e.basis1),r,-1,1,Xe.get()),n=mW(gne(e,e.basis2),r,-1,1,Xe.get());return me(i,fe(Xe.get(),s,n),e.origin),i}function Fbe(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=me(Xe.get(),t,r),a=U3(s,o),l=U3(n,o),c=U3($0(e),o);return ue(i,a,l,c)}function RK(e,t){const i=Fbe(e,t,Xe.get()),{basis1:r,basis2:s}=e,n=Oe(r),o=Oe(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function kze(e,t){return Math.sqrt(RK(e,t))}function Uze(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of $K){const s=PK(e,r,LU.get()),n=SK(s,t);n>i&&(i=n)}return Math.sqrt(i)}function OK(e,t){return Rbe(e.plane,t)&&Ube(e,t)}function Vze(e,t,i,r){return Gze(e,i,r)}function IK(e,t){const i=-e.plane[3];return U3($0(e),t)-i}function Bze(e,t,i,r){const s=IK(e,t),n=ae(Hze,$0(e),i-s);return fe(r,t,n),r}function Nbe(e,t){return ql(e.basis1,t.basis1)&&ql(e.basis2,t.basis2)&&ql(e.origin,t.origin)}function kbe(e,t,i){return e!==i&&oS(e,i),Ea(vS,t),Lu(vS,vS),Ze(i.basis1,e.basis1,vS),Ze(i.basis2,e.basis2,vS),Ze(i.plane,e.plane,vS),Ze(i.origin,e.origin,t),_W(i.plane,i.plane,i.origin),i}function zze(e,t,i,r){return e!==r&&oS(e,r),jh(Q9,t,i),Ze(r.basis1,e.basis1,Q9),Ze(r.basis2,e.basis2,Q9),$U(r),r}function $0(e){return e.plane}function Gze(e,t,i){switch(t){case Au.X:le(i,e.basis1),be(i,i);break;case Au.Y:le(i,e.basis2),be(i,i);break;case Au.Z:le(i,$0(e))}return i}function Ube(e,t){const i=me(Xe.get(),t,e.origin),r=ll(e.basis1),s=ll(e.basis2),n=_e(e.basis1,i),o=_e(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function gne(e,t){const i=LU.get();return le(i.origin,e.origin),le(i.vector,t),i}function PK(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=ae(Xe.get(),r,t.origin[0]),a=ae(Xe.get(),s,t.origin[1]);fe(i.origin,o,a),fe(i.origin,i.origin,n);const l=ae(Xe.get(),r,t.direction[0]),c=ae(Xe.get(),s,t.direction[1]);return ae(i.vector,fe(l,l,c),2),i}function jze(e,t){Math.abs(_e(e.basis1,e.basis2)/(Oe(e.basis1)*Oe(e.basis2)))>1e-6&&K9.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(_e(e.basis1,$0(e)))>1e-6&&K9.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-_e($0(e),e.origin)-e.plane[3])>1e-6&&K9.warn(t,"Plane offset is not consistent with plane origin")}function Vbe(e,t,i,r){const s=$0(e);XI(s,t.direction,t.origin,i),XI(i,s,t.origin,r)}const Bbe={plane:nr(),origin:Le(0,0,0),basis1:Le(1,0,0),basis2:Le(0,1,0)},q5=new W0(nr),LU=new W0(Hf),Hze=O(),qze=new W0(()=>X0()),$K=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],vS=Pe(),Q9=Pe(),Wze=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Obe,UP:Bbe,altitudeAt:IK,axisAt:Vze,closestPoint:Lbe,closestPointOnSilhouette:$be,copy:oS,copyWithoutVerify:Dze,create:X0,distance:kze,distance2:RK,distanceToSilhouette:Uze,elevate:Ibe,equals:Nbe,extrusionContainsPoint:OK,fromAABoundingRect:Pbe,fromValues:AK,intersectRay:MK,intersectRayClosestSilhouette:Nze,normal:$0,projectPoint:Dbe,projectPointLocal:Fbe,rotate:zze,setAltitudeAt:Bze,setExtent:Fze,transform:kbe,updateUnboundedPlane:$U,wrap:Lze},Symbol.toStringTag,{value:"Module"})),Xze=new et(fge),yne=new et(EZ),_ne=new et(CZ),hRt=new et(mge);function DU(e){return e&&(Fg(e)||kn(e,yne))?yne:e&&(Ng(e)||kn(e,_ne))?_ne:Xze}function Yze(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function Zze(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function Jze(e){return{operations:e,value:e.create()}}function zbe(e,t,i=Jze(e)){return i.operations=e,e.copy(t,i.value),i}function Kze(e){return zbe(bze,wbe(0,0,0,dr(e).radius))}const vne=2**50;function Qze(){return zbe(Wze,AK([0,0,0],[vne,0,0],[0,vne,0]))}function e7e(e,t,i){return e.operations.axisAt(e.value,t,Au.Z,i)}function t7e(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function i7e(e,t,i){return e.operations.intersectRay(e.value,t,i)}function r7e(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function s7e(e,t){return e.operations.altitudeAt(e.value,t)}function Gbe(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function n7e(e,t,i,r){return t!==r&&Ao(r,t),ue(bS,r[12],r[13],r[14]),Gbe(e,bS,i,bS),r[12]=bS[0],r[13]=bS[1],r[14]=bS[2],r}function eB(e,t,i){return e.operations.elevate(e.value,t,i.value)}const bS=O();function bne(e,t,i,r,s){return s[0]=_e(e,t),s[1]=_e(e,i),s[2]=_e(e,r),s}function wW(e,t,i,r,s){le(i,e),le(ZL,t),be(ZL,ZL),_t(r,ZL,i),_t(s,r,i)}function jbe(e,t){return e?DU(t):t.isGeographic?et.PlateCarree:t}const ZL=O(),LK=96;function dRt(e,t){const i=t||e.extent,r=e.width,s=wl(i&&i.spatialReference);return i&&r?i.width/r*s*AZ*LK:0}function Hbe(e,t){return e/(wl(t)*AZ*LK)}function o7e(e){return e/(AZ*LK)}function a7e(e,t){const i=e.extent,r=e.width-(e.padding?e.padding.left+e.padding.right:0),s=Hbe(t,i.spatialReference);return i.clone().expand(s*r/i.width)}const qbe="OBJECTID";let pA=class extends k3{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{C(t.item)||t.item.parent===this.owner&&(se.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};pA=u([P("esri.support.AnalysesCollection")],pA);const i4={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},tB={xsmall:544,small:768,medium:992,large:1200};function l7e(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function iB(e,t){return t?i4[e].valueToClassName[t].split(" "):[]}const c7e=e=>{let t=class extends e{constructor(...i){super(...i),this._breakpointsHandles=new Ii,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=tB}initialize(){this._breakpointsHandles.add(te(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),st))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Be(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=l7e(i);if(!r){const s=JSON.stringify(tB,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:tB,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=vu.acquire(),r=vu.acquire();let s,n=!1;for(s in i4){const o=this[s],a=i4[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,iB(s,o).forEach(l=>r.push(l)),iB(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),vu.release(i),vu.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in i4)iB(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([P("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var u7e=function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},gx={exports:{}},jn={},YI={exports:{}},aS={};function Wbe(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function h7e(e,t,i){}function d7e(e,t,i){}var p7e=/javascript\s*\:/img;function f7e(e,t){return p7e.test(t)?"":t}aS.whiteList=Wbe();aS.getDefaultWhiteList=Wbe;aS.onAttr=h7e;aS.onIgnoreAttr=d7e;aS.safeAttrValue=f7e;var m7e={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},WM=m7e;function g7e(e,t){e=WM.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=WM.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=WM.trim(h.slice(0,p)),m=WM.trim(h.slice(p+1));if(f){var y=t(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return WM.trim(o)}var y7e=g7e,JL=aS,_7e=y7e;function wne(e){return e==null}function v7e(e){var t={};for(var i in e)t[i]=e[i];return t}function Xbe(e){e=v7e(e||{}),e.whiteList=e.whiteList||JL.whiteList,e.onAttr=e.onAttr||JL.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||JL.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||JL.safeAttrValue,this.options=e}Xbe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=_7e(e,function(l,c,h,p,f){var m=r[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var _={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var b=s(h,p,_);return wne(b)?h+":"+p:b}else{var b=n(h,p,_);if(!wne(b))return b}}});return a};var b7e=Xbe;(function(e,t){var i=aS,r=b7e;function s(o,a){var l=new r(a);return l.process(o)}t=e.exports=s,t.FilterCSS=r;for(var n in i)t[n]=i[n]})(YI,YI.exports);var DK={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},w7e=YI.exports.FilterCSS,x7e=YI.exports.getDefaultWhiteList,W5=DK;function Ybe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Zbe=new w7e;function T7e(e,t,i){}function S7e(e,t,i){}function E7e(e,t,i){}function C7e(e,t,i){}function Jbe(e){return e.replace(M7e,"&lt;").replace(R7e,"&gt;")}function A7e(e,t,i,r){if(i=rwe(i),t==="href"||t==="src"){if(i=W5.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(KL.lastIndex=0,KL.test(i))return""}else if(t==="style"){if(xne.lastIndex=0,xne.test(i)||(Tne.lastIndex=0,Tne.test(i)&&(KL.lastIndex=0,KL.test(i))))return"";r!==!1&&(r=r||Zbe,i=r.process(i))}return i=swe(i),i}var M7e=/</g,R7e=/>/g,O7e=/"/g,I7e=/&quot;/g,P7e=/&#([a-zA-Z0-9]*);?/gim,$7e=/&colon;?/gim,L7e=/&newline;?/gim,KL=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,xne=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Tne=/u\s*r\s*l\s*\(.*/gi;function Kbe(e){return e.replace(O7e,"&quot;")}function Qbe(e){return e.replace(I7e,'"')}function ewe(e){return e.replace(P7e,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function twe(e){return e.replace($7e,":").replace(L7e," ")}function iwe(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return W5.trim(t)}function rwe(e){return e=Qbe(e),e=ewe(e),e=twe(e),e=iwe(e),e}function swe(e){return e=Kbe(e),e=Jbe(e),e}function D7e(){return""}function F7e(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(o){return i?!0:W5.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return W5.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function N7e(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function k7e(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}jn.whiteList=Ybe();jn.getDefaultWhiteList=Ybe;jn.onTag=T7e;jn.onIgnoreTag=S7e;jn.onTagAttr=E7e;jn.onIgnoreTagAttr=C7e;jn.safeAttrValue=A7e;jn.escapeHtml=Jbe;jn.escapeQuote=Kbe;jn.unescapeQuote=Qbe;jn.escapeHtmlEntities=ewe;jn.escapeDangerHtml5Entities=twe;jn.clearNonPrintableCharacter=iwe;jn.friendlyAttrValue=rwe;jn.escapeAttrValue=swe;jn.onIgnoreTagStripAll=D7e;jn.StripTagBody=F7e;jn.stripCommentTag=N7e;jn.stripBlankChar=k7e;jn.cssFilter=Zbe;jn.getDefaultCSSWhiteList=x7e;var FU={},Uv=DK;function U7e(e){var t=Uv.spaceIndex(e),i;return t===-1?i=e.slice(1,-1):i=e.slice(1,t+1),i=Uv.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function V7e(e){return e.slice(0,2)==="</"}function B7e(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){r+=i(e.slice(s,a)),n=a,s=a;continue}if(p===">"){r+=i(e.slice(s,n)),h=e.slice(n,a+1),c=U7e(h),r+=t(n,r.length,c,h,V7e(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=e.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var z7e=/[^a-zA-Z0-9\\_:.-]/gim;function G7e(e,t){var i=0,r=0,s=[],n=!1,o=e.length;function a(f,m){if(f=Uv.trim(f),f=f.replace(z7e,"").toLowerCase(),!(f.length<1)){var y=t(f,m||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=e.charAt(l),h,p;if(n===!1&&c==="="){n=e.slice(i,l),i=l+1,r=e.charAt(i)==='"'||e.charAt(i)==="'"?i:H7e(e,l+1);continue}if(n!==!1&&l===r){if(p=e.indexOf(c,l+1),p===-1)break;h=Uv.trim(e.slice(r+1,p)),a(n,h),n=!1,l=p,i=l+1;continue}if(/\s|\n|\t/.test(c))if(e=e.replace(/\s|\n|\t/g," "),n===!1)if(p=j7e(e,l),p===-1){h=Uv.trim(e.slice(i,l)),a(h),n=!1,i=l+1;continue}else{l=p-1;continue}else if(p=q7e(e,l-1),p===-1){h=Uv.trim(e.slice(i,l)),h=Sne(h),a(n,h),n=!1,i=l+1;continue}else continue}return i<e.length&&(n===!1?a(e.slice(i)):a(n,Sne(Uv.trim(e.slice(i))))),Uv.trim(s.join(" "))}function j7e(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function H7e(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="'"||i==='"'?t:-1}}function q7e(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function W7e(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function Sne(e){return W7e(e)?e.substr(1,e.length-2):e}FU.parseTag=B7e;FU.parseAttr=G7e;var X7e=YI.exports.FilterCSS,sf=jn,nwe=FU,Y7e=nwe.parseTag,Z7e=nwe.parseAttr,r4=DK;function QL(e){return e==null}function J7e(e){var t=r4.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=r4.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=r4.trim(e.slice(0,-1))),{html:e,closing:i}}function K7e(e){var t={};for(var i in e)t[i]=e[i];return t}function Q7e(e){var t={};for(var i in e)Array.isArray(e[i])?t[i.toLowerCase()]=e[i].map(function(r){return r.toLowerCase()}):t[i.toLowerCase()]=e[i];return t}function owe(e){e=K7e(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=sf.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=Q7e(e.whiteList||e.allowList):e.whiteList=sf.whiteList,e.onTag=e.onTag||sf.onTag,e.onTagAttr=e.onTagAttr||sf.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||sf.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||sf.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||sf.safeAttrValue,e.escapeHtml=e.escapeHtml||sf.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new X7e(e.css))}owe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=t.cssFilter;i.stripBlankChar&&(e=sf.stripBlankChar(e)),i.allowCommentTag||(e=sf.stripCommentTag(e));var p=!1;i.stripIgnoreTagBody&&(p=sf.StripTagBody(i.stripIgnoreTagBody,n),n=p.onIgnoreTag);var f=Y7e(e,function(m,y,_,b,w){var T={sourcePosition:m,position:y,isClosing:w,isWhite:Object.prototype.hasOwnProperty.call(r,_)},S=s(_,b,T);if(!QL(S))return S;if(T.isWhite){if(T.isClosing)return"</"+_+">";var E=J7e(b),M=r[_],A=Z7e(E.html,function($,I){var k=r4.indexOf(M,$)!==-1,V=o(_,$,I,k);return QL(V)?k?(I=l(_,$,I,h),I?$+'="'+I+'"':$):(V=a(_,$,I,k),QL(V)?void 0:V):V});return b="<"+_,A&&(b+=" "+A),E.closing&&(b+=" /"),b+=">",b}else return S=n(_,b,T),QL(S)?c(b):S},c);return p&&(f=p.remove(f)),f};var eGe=owe;(function(e,t){var i=jn,r=FU,s=eGe;function n(a,l){var c=new s(l);return c.process(a)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s,function(){for(var a in i)t[a]=i[a];for(var l in r)t[l]=r[l]}();function o(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=e.exports)})(gx,gx.exports);var tGe=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):gx.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new gx.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t,i){var r=(i!=null?i:{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?gx.exports.escapeAttrValue(t):!n&&!s?gx.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):gx.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype.encodeHTML=function(t){var i=this;return String(t).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},e.prototype.encodeAttrValue=function(t){var i=/^[a-zA-Z0-9]$/;return String(t).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(t.charCodeAt(s)).toString(16),";")})},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(u7e(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof t=="undefined"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const NU=new Map;function awe(){NU.clear()}function iGe(e){return NU.get(e)}function rGe(e,t){NU.set(e,t)}function rB(e){NU.delete(e)}var wT,fA,sGe=function(e){if("WebkitTransition"in e.style)wT="webkitTransitionEnd",fA="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");wT="transitionend",fA="animationend"}},lwe=function(e){wT||sGe(e)},nGe=function(e,t){return t===void 0&&(t=e+"-active"),function(i){lwe(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(wT,s),i.removeEventListener(fA,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(wT,s),i.addEventListener(fA,s),requestAnimationFrame(function(){i.classList.add(t)})}},oGe=function(e,t){return t===void 0&&(t=e+"-active"),function(i,r){lwe(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(wT,n),i.removeEventListener(fA,n),r())};i.classList.add(e),i.addEventListener(wT,n),i.addEventListener(fA,n),requestAnimationFrame(function(){i.classList.add(t)})}};const aGe=se.getLogger("esri.widgets.support.widgetUtils");function cwe(e){const t=vu.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const i=t.join(" ");return vu.release(t),i}const uwe=(()=>{const e=new Map,t=new ResizeObserver(i=>{var r;awe();for(const s of i)(r=e.get(s.target))==null||r(s)});return(i,r,s)=>(e.has(i)&&aGe.error("Already observing element",i),e.set(i,r),t.observe(i,s),Df(()=>{t.unobserve(i),e.delete(i)}))})();function og(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function Ene(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function y1(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function lGe(e,t){return(e==="enter"?nGe:oGe)(t)}const cGe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],uGe=cGe.reduce((e,t)=>(e[t]=[],e),{}),hGe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],hwe=new tGe({whiteList:uGe,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(hGe.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function dGe(e,t){const i=e.getBoundingClientRect(),r=t.getBoundingClientRect(),s=i.top+i.height,n=r.top+r.height,o=i.top,a=r.top;(s>n||o<a)&&e.scrollIntoView({block:"end"})}function dwe(e){return e==="Enter"||e===" "}const pwe="http://www.w3.org/",kU=`${pwe}2000/svg`,fwe=`${pwe}1999/xlink`;let Cne=[],FK=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},NK=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),mwe=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},pGe=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if(NK(e[r],t))return r}return-1},sB=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(NK(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},fGe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},xW=[],TW=!1,gwe=e=>{(e.children||[]).forEach(gwe),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},Ane=()=>{TW=!1,xW.forEach(gwe),xW.length=0},Mne=e=>{xW.push(e),TW||(TW=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(Ane,{timeout:16}):setTimeout(Ane,16))},Rne=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),Mne(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),Mne(e))},mGe=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")SW(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(mwe(m),i.styleApplyer(e,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):i.namespace===kU?a==="href"?e.setAttributeNS(fwe,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=hwe.sanitize(l):ywe(e)&&a in e?e[a]=l:e.setAttribute(a,l):e[a]=l}}};function ywe(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let X5,gGe=(e,t,i)=>{if(t)for(let r of t)$E(r,e,void 0,i)},_we=(e,t,i)=>{gGe(e,t.children,i),t.text&&(e.textContent=t.text),mGe(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},$E=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(r=FK(r,{namespace:kU})),r.namespace!==void 0?s=e.domNode=a.createElementNS(r.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=l+1}}_we(s,e,r)}},SW=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},yGe=(e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=t[l];if(l==="class")h!==c&&(SW(e,h,!1),SW(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let _=f[y],b=!!c[_];b!==!!h[_]&&(s=!0,b?p.add(_):p.remove(_))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],_=c[y];_!==h[y]&&(s=!0,_?(mwe(_),r.styleApplyer(e,y,_)):r.styleApplyer(e,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===kU?l==="href"?e.setAttributeNS(fwe,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=hwe.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):ywe(e)&&l in e?e[l]=c:e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},_Ge=(e,t,i,r,s)=>{if(i===r)return!1;r=r||Cne;let n,o=(i=i||Cne).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&NK(p,f))h=X5(p,f,s)||h,l++;else{let m=pGe(i,f,l+1);if(m>=0){for(n=l;n<m;n++)Rne(i[n]),sB(i,n,e,"removed");h=X5(i[m],f,s)||h,l=m+1}else $E(f,t,l<o?i[l].domNode:void 0,s),fGe(f),sB(r,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)Rne(i[n]),sB(i,n,e,"removed");return h};X5=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(o,r),t.domNode=o,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=FK(i,{namespace:kU})),e.text!==t.text&&(n=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=_Ge(t,r,e.children,t.children,i)||n,n=yGe(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let XM=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,X5(r,i,t)},domNode:e.domNode});const vGe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let J2=e=>FK(vGe,e),_1={create:(e,t)=>(t=J2(t),$E(e,document.createElement("div"),void 0,t),XM(e,t)),append:(e,t,i)=>(i=J2(i),$E(t,e,void 0,i),XM(t,i)),insertBefore:(e,t,i)=>(i=J2(i),$E(t,e.parentNode,e,i),XM(t,i)),merge:(e,t,i)=>(i=J2(i),t.domNode=e,_we(e,t,i),XM(t,i)),replace:(e,t,i)=>(i=J2(i),$E(t,e.parentNode,e,i),e.parentNode.removeChild(e),XM(t,i))},vwe,bGe=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};vwe=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let wGe=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?vwe(i.children,s=>s.domNode===r):void 0}),i},xGe=(e,t,i)=>{let r=function(s){i("domEvent",s);let n=t(),o=bGe(s.currentTarget,n.domNode);o.reverse();let a,l=wGe(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},EW=e=>{let t,i,r=J2(e),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,_=()=>y;r.eventHandlerInterceptor=xGe(t,_,s),y=p(f,m(),r),a.push(y),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(_1.append,p,f)},insertBefore:(p,f)=>{c(_1.insertBefore,p,f)},merge:(p,f)=>{c(_1.merge,p,f)},replace:(p,f)=>{c(_1.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t},yv=class extends Te{constructor(){super(...arguments),this.items=new Qe,this._watchUpdatingTracking=new fg,this._callbacks=new Map,this._projector=EW(),this._hiddenProjector=EW()}get needsRender(){return this.items.length>0}get updating(){var e,t;return(t=(e=this._watchUpdatingTracking)==null?void 0:e.updating)!=null?t:!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(const i of t.removed){const r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const o=r.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const t=e.getContext("2d");t.save(),t.font=this._fontString(),this.items.forEach(i=>{t.save(),i.renderCanvas(t),t.restore()}),t.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],yv.prototype,"surface",void 0),u([d({readOnly:!0})],yv.prototype,"items",void 0),u([d({readOnly:!0})],yv.prototype,"needsRender",null),u([d({readOnly:!0})],yv.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],yv.prototype,"updating",null),yv=u([P("esri.views.overlay.ViewOverlay")],yv);const One=yv;function mC(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t!=null?t:null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const TGe="randomUUID"in crypto;function SGe(){if(TGe)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const EGe={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},CGe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},AGe=e=>({...CGe,...e}),MGe=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},RGe=(e,t)=>e.find(t),Ine=(e,t,i=!1)=>{let r=e;return t.forEach((s,n)=>{const o=r!=null&&r.children?RGe(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==t.length-1||(r=o)}),r},OGe=e=>{let t;const i={...EGe,...e},r=AGe(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{var w;let _;r.eventHandlerInterceptor=(T,S,E,M)=>function(A){let $;s("domEvent",A);const I=MGe(A.currentTarget,_.domNode),k=I.some(B=>{var G;return customElements.get((G=B==null?void 0:B.tagName)==null?void 0:G.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!k)I.reverse(),$=Ine(_.getLastRender(),I);else{const B=A.composedPath(),G=B.slice(B.indexOf(A.currentTarget),B.indexOf(_.domNode)).filter(X=>X.getRootNode()===X.ownerDocument).reverse();$=Ine(_.getLastRender(),G,!0)}let V;return $&&(V=i.handleInterceptedEvent(t,$,this,A)),s("domEventProcessed",A),V},(w=i.postProcessProjectionOptions)==null||w.call(i,r);const b=y();_=f(m,b,r),l.push(_),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(_,b)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,m)=>{h(_1.append,f,m)},insertBefore:(f,m)=>{h(_1.insertBefore,f,m)},merge:(f,m)=>{h(_1.merge,f,m)},replace:(f,m)=>{h(_1.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},zi={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let K2,bwe,UU,wwe=!1,Y5=!1,kK=!1,yh=!1,Pne=null,CW=!1;const pRt={isDev:!!zi.isDev,isBrowser:!0,isServer:!1,isTesting:!!zi.isTesting},fRt=e=>{const t=new URL(e,gl.$resourcesUrl$);return t.origin!==yM.location.origin?t.href:t.pathname},IGe=e=>gl.$resourcesUrl$=e,xT=(e,t="")=>()=>{},$ne="http://www.w3.org/1999/xlink",Lne={},PGe="http://www.w3.org/2000/svg",$Ge="http://www.w3.org/1999/xhtml",LGe=e=>e!=null,UK=e=>(e=typeof e,e==="object"||e==="function"),xwe=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!UK(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?Z5(null,r):r),a=o)};if(c(i),t&&(zi.isDev&&e==="input"&&kGe(t),zi.vdomKey&&t.key&&(s=t.key),zi.slotRelocation&&t.name&&(n=t.name),zi.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(zi.isDev&&l.some(Twe)&&dje(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),zi.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,FGe);const h=Z5(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),zi.vdomKey&&(h.$key$=s),zi.slotRelocation&&(h.$name$=n),h},Z5=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return zi.vdomAttribute&&(i.$attrs$=null),zi.vdomKey&&(i.$key$=null),zi.slotRelocation&&(i.$name$=null),i},DGe={},Twe=e=>e&&e.$tag$===DGe,FGe={forEach:(e,t)=>e.map(Dne).forEach(t),map:(e,t)=>e.map(Dne).map(t).map(NGe)},Dne=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),NGe=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),xwe(e.vtag,i,...e.vchildren||[])}const t=Z5(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},kGe=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&Dwe('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},UGe=e=>pje.map(t=>t(e)).find(t=>!!t),VGe=(e,t)=>e!=null&&!UK(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,BGe=e=>zi.lazyLoad?gM(e).$hostElement$:e,mRt=(e,t,i)=>{const r=BGe(e);return{emit:s=>(zi.isDev&&!r.isConnected&&Dwe(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),zGe(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s}))}},zGe=(e,t,i)=>{const r=gl.ce(t,i);return e.dispatchEvent(r),r},Fne=new WeakMap,GGe=(e,t,i)=>{let r=K5.get(e);gje&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=t:r.replaceSync(t)):r=t,K5.set(e,r)},jGe=(e,t,i,r)=>{let s=Swe(t,i);const n=K5.get(s);if(e=e.nodeType===11?e:Mf,n)if(typeof n=="string"){e=e.head||e;let o=Fne.get(e),a;o||Fne.set(e,o=new Set),o.has(s)||(a=Mf.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},HGe=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=xT("attachStyles",t.$tagName$),n=jGe(Q5&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},Swe=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),Nne=(e,t,i,r,s,n)=>{if(i!==r){let o=Bne(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=kne(i),h=kne(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Bne(yM,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&gl.rel(e,t,i,!1),r&&gl.ael(e,t,r,!1);else{const l=UK(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{const h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS($ne,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS($ne,t,r):e.setAttribute(t,r))}}},qGe=/\s/,kne=e=>e?e.split(qGe):[],Ewe=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||Lne,o=t.$attrs$||Lne;for(r in n)r in o||Nne(s,r,n[r],void 0,i,t.$flags$);for(r in o)Nne(s,r,n[r],o[r],i,t.$flags$)},J5=(e,t,i,r)=>{const s=t.$children$[i];let n=0,o,a,l;if(wwe||(kK=!0,s.$tag$==="slot"&&(K2&&r.classList.add(K2+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Mf.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Mf.createTextNode("");else{if(yh||(yh=s.$tag$==="svg"),o=s.$elm$=Mf.createElementNS(yh?PGe:$Ge,s.$flags$&2?"slot-fb":s.$tag$),yh&&s.$tag$==="foreignObject"&&(yh=!1),Ewe(null,s,yh),LGe(K2)&&o["s-si"]!==K2&&o.classList.add(o["s-si"]=K2),s.$children$)for(n=0;n<s.$children$.length;++n)a=J5(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?yh=!1:o.tagName==="foreignObject"&&(yh=!0)}return o["s-hn"]=UU,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=bwe,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&ZI(e.$elm$,!1)),o},ZI=(e,t)=>{gl.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==UU&&s["s-ol"]&&(Mwe(s).insertBefore(s,VK(s)),s["s-ol"].remove(),s["s-ol"]=void 0,kK=!0),t&&ZI(s,t)}gl.$flags$&=-2},Cwe=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===UU&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=J5(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,VK(t))))},Awe=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,Iwe(r),Y5=!0,s["s-ol"]?s["s-ol"].remove():ZI(s,!0),s.remove())},WGe=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],m=r[p],y,_;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(eD(c,f))Q2(c,f),c=t[++s],f=r[++n];else if(eD(h,m))Q2(h,m),h=t[--l],m=r[--p];else if(eD(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&ZI(c.$elm$.parentNode,!1),Q2(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=r[--p];else if(eD(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&ZI(h.$elm$.parentNode,!1),Q2(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(_=t[o],_.$tag$!==f.$tag$?y=J5(t&&t[n],i,o,e):(Q2(_,f),t[o]=void 0,y=_.$elm$),f=r[++n]):(y=J5(t&&t[n],i,n,e),f=r[++n]),y&&Mwe(c.$elm$).insertBefore(y,VK(c.$elm$))}s>l?Cwe(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&Awe(t,s,l)},eD=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,VK=e=>e&&e["s-ol"]||e,Mwe=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,Q2=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(yh=n==="svg"?!0:n==="foreignObject"?!1:yh,n==="slot"||Ewe(e,t,yh),r!==null&&s!==null?WGe(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),Cwe(i,null,t,s,0,s.length-1)):r!==null&&Awe(r,0,r.length-1),yh&&n==="svg"&&(yh=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},Rwe=e=>{const t=e.childNodes;let i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}Rwe(i)}},uf=[],Owe=e=>{let t,i,r,s,n,o,a=0;const l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&(Une(i,s)?(n=uf.find(h=>h.$nodeToRelocate$===i),Y5=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:uf.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&uf.map(h=>{Une(h.$nodeToRelocate$,i["s-sn"])&&(n=uf.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):uf.some(h=>h.$nodeToRelocate$===i)||uf.push({$nodeToRelocate$:i}));t.nodeType===1&&Owe(t)}},Une=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Iwe=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Iwe)},XGe=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||Z5(null,null),n=Twe(t)?t:xwe(null,null,t);UU=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,K2=i["s-sc"],bwe=i["s-cr"],wwe=Q5&&(r.$flags$&1)!==0,Y5=!1,Q2(s,n);{if(gl.$flags$|=1,kK){Owe(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<uf.length;f++)o=uf[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Mf.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<uf.length;f++)if(o=uf[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}Y5&&Rwe(n.$elm$),gl.$flags$&=-2,uf.length=0}},YGe=(e,t)=>{},BK=(e,t)=>{zi.taskQueue&&zi.updatable&&(e.$flags$|=16),YGe(e,e.$ancestorComponent$);const i=()=>ZGe(e,t);return zi.taskQueue?vje(i):i()},ZGe=(e,t)=>{const i=e.$hostElement$,r=xT("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=gC(s,"componentWillLoad"):n=gC(s,"componentWillUpdate"),n=Vne(n,()=>gC(s,"componentWillRender")),r(),Vne(n,()=>JGe(e,s,t))},JGe=async(e,t,i)=>{const r=e.$hostElement$,s=xT("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&HGe(e);const n=xT("render",e.$cmpMeta$.$tagName$);KGe(e,t,r),n(),s(),QGe(e)},KGe=(e,t,i)=>{try{Pne=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(zi.hasRenderFn||zi.reflect)&&(zi.vdomRender||zi.reflect)&&(zi.hydrateServerSide||XGe(e,t))}catch(a){M$(a,e.$hostElement$)}return Pne=null,null},QGe=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=xT("postUpdate",t),s=i;e.$ancestorComponent$,gC(s,"componentDidRender"),e.$flags$&64?(gC(s,"componentDidUpdate"),r()):(e.$flags$|=64,gC(s,"componentDidLoad"),r())},gRt=e=>{if(zi.updatable){const t=gM(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&BK(t,!1),i}return!1},gC=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){M$(r)}},Vne=(e,t)=>e&&e.then?e.then(t):t(),eje=(e,t)=>gM(e).$instanceValues$.get(t),tje=(e,t,i,r)=>{const s=gM(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=VGe(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(f=>{try{l[f](i,o,t)}catch(m){M$(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;BK(s,!1)}}}},ije=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return eje(this,n)},set(a){tje(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){gl.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},rje=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=UGe(e)]);const a=Swe(i,t.$modeName$);if(!K5.has(a)){const l=xT("registerStyles",i.$tagName$);GGe(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>BK(t,!0))()},sje=e=>{},nje=e=>{if((gl.$flags$&1)===0){const t=gM(e),i=t.$cmpMeta$,r=xT("connectedCallback",i.$tagName$);t.$flags$&1?(Pwe(e,t,i.$listeners$),sje(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&oje(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),rje(e,t,i)),r()}},oje=e=>{const t=e["s-cr"]=Mf.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},aje=e=>{if((gl.$flags$&1)===0){const t=gM(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},yRt=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};zi.member&&(i.$members$=t[2]),zi.hostListener&&(i.$listeners$=t[3]),zi.watchCallback&&(i.$watchers$=e.$watchers$),zi.reflect&&(i.$attrsToReflect$=[]),zi.shadowDom&&!Q5&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){hje(this,i)},connectedCallback(){nje(this),zi.connectedCallback&&r&&r.call(this)},disconnectedCallback(){aje(this),zi.disconnectedCallback&&s&&s.call(this)},__attachShadow(){Q5?zi.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,ije(e,i)},_Rt=(e,t)=>t,Pwe=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=cje(e,s),l=lje(t,o),c=uje(s);gl.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>gl.rel(a,n,l,c))})},lje=(e,t)=>i=>{try{zi.lazyLoad||e.$hostElement$[t](i)}catch(r){M$(r)}},cje=(e,t)=>t&4?Mf:t&8?yM:t&16?Mf.body:e,uje=e=>fje?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,$we=new WeakMap,gM=e=>$we.get(e),hje=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return zi.isDev&&(i.$renderCount$=0),zi.method&&zi.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),zi.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),Pwe(e,i,t.$listeners$),$we.set(e,i)},Bne=(e,t)=>t in e,M$=(e,t)=>(0,console.error)(e,t),Lwe=zi.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],dje=(...e)=>console.error(...Lwe,...e),Dwe=(...e)=>console.warn(...Lwe,...e),K5=new Map,pje=[],yM=typeof window!="undefined"?window:{};zi.cssVarShim&&yM.CSS;const Mf=yM.document||{head:{}},vRt=yM.HTMLElement||class{},gl={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},Q5=zi.shadowDomShim&&zi.shadowDom?(()=>(Mf.head.attachShadow+"").indexOf("[native")>-1)():!0,fje=(()=>{let e=!1;try{Mf.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),mje=e=>Promise.resolve(e),gje=zi.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})():!1,zne=[],Fwe=[],yje=(e,t)=>i=>{e.push(i),CW||(CW=!0,t&&gl.$flags$&4?_je(AW):gl.raf(AW))},Gne=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){M$(i)}e.length=0},AW=()=>{Gne(zne),Gne(Fwe),(CW=zne.length>0)&&gl.raf(AW)},_je=e=>mje().then(e),vje=yje(Fwe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */const Nwe="calcite-mode-auto",kwe="calcite-mode-dark",bje="calcite-mode-light",bRt={autoMode:Nwe,darkMode:kwe,lightMode:bje,rtl:"calcite--rtl"};/*!
* tabbable 6.0.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var Uwe=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],ek=Uwe.join(","),Vwe=typeof Element=="undefined",TT=Vwe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,tk=!Vwe&&Element.prototype.getRootNode?function(e){return e.getRootNode()}:function(e){return e.ownerDocument},Bwe=function(t,i,r){var s=Array.prototype.slice.apply(t.querySelectorAll(ek));return i&&TT.call(t,ek)&&s.unshift(t),s=s.filter(r),s},zwe=function e(t,i,r){for(var s=[],n=Array.from(t);n.length;){var o=n.shift();if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=e(l,!0,r);r.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=TT.call(o,ek);h&&r.filter(o)&&(i||!t.includes(o))&&s.push(o);var p=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!r.shadowRootFilter||r.shadowRootFilter(o);if(p&&f){var m=e(p===!0?o.children:p.children,!0,r);r.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},Gwe=function(t,i){return t.tabIndex<0&&(i||/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||t.isContentEditable)&&isNaN(parseInt(t.getAttribute("tabindex"),10))?0:t.tabIndex},wje=function(t,i){return t.tabIndex===i.tabIndex?t.documentOrder-i.documentOrder:t.tabIndex-i.tabIndex},jwe=function(t){return t.tagName==="INPUT"},xje=function(t){return jwe(t)&&t.type==="hidden"},Tje=function(t){var i=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(r){return r.tagName==="SUMMARY"});return i},Sje=function(t,i){for(var r=0;r<t.length;r++)if(t[r].checked&&t[r].form===i)return t[r]},Eje=function(t){if(!t.name)return!0;var i=t.form||tk(t),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window!="undefined"&&typeof window.CSS!="undefined"&&typeof window.CSS.escape=="function")s=r(window.CSS.escape(t.name));else try{s=r(t.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=Sje(s,t.form);return!n||n===t},Cje=function(t){return jwe(t)&&t.type==="radio"},Aje=function(t){return Cje(t)&&!Eje(t)},Mje=function(t){for(var i,r=tk(t).host,s=!!((i=r)!==null&&i!==void 0&&i.ownerDocument.contains(r)||t.ownerDocument.contains(t));!s&&r;){var n;r=tk(r).host,s=!!((n=r)!==null&&n!==void 0&&n.ownerDocument.contains(r))}return s},jne=function(t){var i=t.getBoundingClientRect(),r=i.width,s=i.height;return r===0&&s===0},Rje=function(t,i){var r=i.displayCheck,s=i.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var n=TT.call(t,"details>summary:first-of-type"),o=n?t.parentElement:t;if(TT.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof s=="function"){for(var a=t;t;){var l=t.parentElement,c=tk(t);if(l&&!l.shadowRoot&&s(l)===!0)return jne(t);t.assignedSlot?t=t.assignedSlot:!l&&c!==t.ownerDocument?t=c.host:t=l}t=a}if(Mje(t))return!t.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return jne(t);return!1},Oje=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var i=t.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var s=i.children.item(r);if(s.tagName==="LEGEND")return TT.call(i,"fieldset[disabled] *")?!0:!s.contains(t)}return!0}i=i.parentElement}return!1},ik=function(t,i){return!(i.disabled||xje(i)||Rje(i,t)||Tje(i)||Oje(i))},MW=function(t,i){return!(Aje(i)||Gwe(i)<0||!ik(t,i))},Ije=function(t){var i=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},Pje=function e(t){var i=[],r=[];return t.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=Gwe(a,o),c=o?e(s.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),r.sort(wje).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(i)},$je=function(t,i){i=i||{};var r;return i.getShadowRoot?r=zwe([t],i.includeContainer,{filter:MW.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:Ije}):r=Bwe(t,i.includeContainer,MW.bind(null,i)),Pje(r)},wRt=function(t,i){i=i||{};var r;return i.getShadowRoot?r=zwe([t],i.includeContainer,{filter:ik.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=Bwe(t,i.includeContainer,ik.bind(null,i)),r},xRt=function(t,i){if(i=i||{},!t)throw new Error("No node provided");return TT.call(t,ek)===!1?!1:MW(i,t)},Lje=Uwe.concat("iframe").join(","),TRt=function(t,i){if(i=i||{},!t)throw new Error("No node provided");return TT.call(t,Lje)===!1?!1:ik(i,t)};const Dje={getShadowRoot:!0};function SRt(e){const t="dir",i=`[${t}]`,r=Fje(e,i);return r?r.getAttribute(t):"ltr"}function ERt(e,t,i){const r=`[${t}]`,s=e.closest(r);return s?s.getAttribute(t):i}function Hwe(e){return e.getRootNode()}function qwe(e){return e.host||null}function CRt(e,{selector:t,id:i}){function r(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=Hwe(s),o=i?"getElementById"in n?n.getElementById(i):null:t?n.querySelector(t):null,a=qwe(n);return o||(a?r(a):null)}return r(e)}function Fje(e,t){function i(r){return r?r.closest(t)||i(qwe(Hwe(r))):null}return i(e)}function Nje(e,t){return Wwe(e,t)}function Wwe(e,t){if(!e)return;const i=t(e);if(i!==void 0)return i;const{parentNode:r}=e;return Wwe(r instanceof ShadowRoot?r.host:r,t)}function ARt(e,t){return!!Nje(t,i=>i===e?!0:void 0)}function kje(e){return typeof(e==null?void 0:e.setFocus)=="function"}async function MRt(e){if(!!e)return kje(e)?e.setFocus():e.focus()}function RRt(e){($je(e,Dje)[0]||e).focus()}const JI=":not([slot])";function ORt(e,t,i){t&&!Array.isArray(t)&&typeof t!="string"&&(i=t,t=null);const r=t?Array.isArray(t)?t.map(s=>`[slot="${s}"]`).join(","):`[slot="${t}"]`:JI;return i!=null&&i.all?Uje(e,r,i):Vje(e,r,i)}function Xwe(e,t){return e?Array.from(e.children||[]).filter(i=>i==null?void 0:i.matches(t)):[]}function Uje(e,t,i){let r=t===JI?Xwe(e,JI):Array.from(e.querySelectorAll(t));r=i&&i.direct===!1?r:r.filter(n=>n.parentElement===e),r=i!=null&&i.matches?r.filter(n=>n==null?void 0:n.matches(i.matches)):r;const s=i==null?void 0:i.selector;return s?r.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):r}function Vje(e,t,i){let r=t===JI?Xwe(e,JI)[0]||null:e.querySelector(t);r=i&&i.direct===!1||(r==null?void 0:r.parentElement)===e?r:null,r=i!=null&&i.matches?r!=null&&r.matches(i.matches)?r:null:r;const s=i==null?void 0:i.selector;return s?r==null?void 0:r.querySelector(s):r}function IRt(e,t,i){if(typeof t=="string"&&t!=="")return t;if(t==="")return e[i]}function PRt(e){return Boolean(e).toString()}function $Rt(e){return!!Bje(e).length}function Bje(e){return e.target.assignedElements({flatten:!0})}function LRt(e){return!!(e.isPrimary&&e.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */function Hne(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>e.contains(kwe)||e.contains(Nwe)&&t?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function zje(){typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?Hne():document.addEventListener("DOMContentLoaded",()=>Hne(),{once:!0}))}const Gje=zje;Gje();let Ywe;function jje(){IGe(Rh(Vi(Ywe)))}Ywe="components/assets";const Zwe=Symbol("widget"),Hje=Symbol("widget-test-data"),qje=[],Wje={},rk=new WeakMap;function Jwe(e,t){let i=t.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=Jwe(e,i[s]);else i=qje;const r=t.vnodeSelector;if(zK(r)){const s=t.properties||Wje,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:Xje,afterUpdate:Yje,afterRemoved:Kwe,parentWidget:e,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return t}function Xje(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,rk.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),r._internalHandles.add(Df(()=>Kwe(e)))}function Yje(e,t,i,{widgetProperties:r}){var n;const s=rk.get(e);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,e))}function Kwe(e){var i;const t=rk.get(e);t&&((i=t.afterRemoved)==null||i.call(t,t,e),t.destroy(),rk.delete(e))}function zK(e){return typeof e=="function"&&e[Zwe]}const qne=new Set;function Zje(e){qne.add(e),e.finally(()=>qne.delete(e))}var Qwe;const Jje="esri.widgets.Widget";let Kje=0;const Qje={widgetIcon:"esri-icon-checkbox-unchecked"};function exe(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?exe(e[i],t==null?void 0:t[i]):e[i]=t[i]);return e}const eHe=OGe({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,n,o)=>{const a=t==null?void 0:t(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(awe(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let nB=!1,ua=class extends p$(ps.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Ii,this._projector=eHe,this._readyForTrueRender=!1,this.iconClass=Qje.widgetIcon,this.key=this,this._loadLocale=Wme(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await Eo(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await NJ(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=exe(ne(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&se.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),jje();const i="esri-widget-uid-"+SGe(),r=this.render.bind(this);this._trackingTarget=new N6(()=>this.scheduleRender());const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const n=r();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=i),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(h=n.children)==null||h.forEach(p=>{if(zK(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),Jwe(this,n)};this.render=()=>{var o;if(nB)return s();let n=(o=iGe(this))!=null?o:null;if(n)return n;this._trackingTarget.clear(),nB=!0;try{n=A0(this._trackingTarget,s)}catch(a){throw console.error(a),a}finally{nB=!1}return n&&rGe(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),Zje(this._resourcesFetch)}normalizeCtorArgs(e,t){const i={...e};return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch($G)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Be(this._trackingTarget),Be(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,rB(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return MU(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+Kje++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(Qwe=Zwe,Hje)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(rB(this),this._projector.scheduleRender())}classes(...e){return cwe.apply(this,e)}renderNow(){rB(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this._internalHandles.add(te(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&D6(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>a$(i,s,n=>{this.emit(s,n)})),"delegated-events")},st)),this.postInitialize();const e=async()=>{await this._loadLocale().catch($G),this.scheduleRender()};this._internalHandles.add([BZ(e),te(()=>this.uiStrings,e),Qo(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var t;this._attached&&(this._projector.detach(this.render),this._attached=!1),(t=e==null?void 0:e.parentNode)==null||t.removeChild(e)}};ua[Qwe]=!0,u([d()],ua.prototype,"_readyForTrueRender",void 0),u([d({value:null})],ua.prototype,"container",null),u([Zt("container")],ua.prototype,"castContainer",null),u([d()],ua.prototype,"iconClass",void 0),u([d()],ua.prototype,"id",null),u([d()],ua.prototype,"label",null),u([d()],ua.prototype,"renderable",null),u([d()],ua.prototype,"uiStrings",void 0),u([d()],ua.prototype,"viewModel",void 0),u([d({value:!0})],ua.prototype,"visible",null),u([d()],ua.prototype,"key",void 0),u([d()],ua.prototype,"children",void 0),u([d()],ua.prototype,"afterCreate",void 0),u([d()],ua.prototype,"afterUpdate",void 0),u([d()],ua.prototype,"afterRemoved",void 0),ua=u([P(Jje)],ua);const pn=ua;function tHe(e,t,i){return e.units[t][i]}function VU(e,t,i,r=2,s="abbr"){return`${Cg(t,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:t>0?"never":"exceptZero"})} ${tHe(e,i,s)}`}function DRt(e,t,i,r=2,s="abbr"){const n=_ge(t,i);return VU(e,to(t,i,n),n,r,s)}function FRt(e,t,i,r=2,s="abbr"){const n=vge(t,i);return VU(e,to(t,i,n),n,r,s)}function NRt(e,t,i,r=2,s="abbr"){const n=bge(t,i);return VU(e,to(t,i,n),n,r,s)}function kRt(e,t,i,r=2,s="abbr"){const n=wge(t,i);return VU(e,to(t,i,n),n,r,s)}const Wne=["B","kB","MB","GB","TB"];function iHe(e,t){let i=t===0?0:Math.floor(Math.log(t)/Math.log(hA.KILOBYTES));i=ye(i,0,Wne.length-1);const r=Cg(t/hA.KILOBYTES**i,{maximumFractionDigits:2});return Sg(e.units.bytes[Wne[i]],{fileSize:r})}function rHe(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find(n=>n.name===i);return s?sHe({tagName:r,tags:s.tags}):null}function sHe(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find(s=>s.name===t);return r&&r.value||null}var RW;const nHe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let su=RW=class extends ge{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=rHe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return nHe[t]||null}clone(){return new RW({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],su.prototype,"contentType",void 0),u([d()],su.prototype,"exifInfo",void 0),u([d({readOnly:!0})],su.prototype,"orientationInfo",null),u([d({type:us})],su.prototype,"id",void 0),u([d({type:String})],su.prototype,"globalId",void 0),u([d({type:String})],su.prototype,"keywords",void 0),u([d({type:String})],su.prototype,"name",void 0),u([d({json:{read:!1}})],su.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],su.prototype,"parentObjectId",void 0),u([d({type:us})],su.prototype,"size",void 0),u([d({json:{read:!1}})],su.prototype,"url",void 0),su=RW=u([P("esri.layers.support.AttachmentInfo")],su);const oHe=su,aHe="esri.widgets.Feature.support.featureUtils",Xne=se.getLogger(aHe),lHe=/href=(""|'')/gi,cHe=/(\{([^\{\r\n]+)\})/g,uHe=/\'/g,txe=/^\s*expression\//i,hHe=/(\n)/gi,dHe=/[\u00A0-\u9999<>\&]/gim,pHe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,fHe=/^(?:mailto:|tel:)/,ixe="relationships/",OW=XC("short-date-short-time");function rxe(e){if(!C(e))return e.get("sourceLayer")||e.get("layer")}async function sk(e,t){return typeof e=="function"?e.call(null,t):e}function sxe(e=""){if(e)return!fHe.test(e.trim().toLowerCase())}function GK(e){return!!e&&txe.test(e)}function mHe(e,t){if(!GK(t)||!e)return null;const i=t.replace(txe,"").toLowerCase();let r=null;return e.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function nxe(e,t){const i=mHe(t,e==null?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function gHe(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}function yHe(e){return e.replace(lHe,"")}function KI(e,t){const i=jK(t,e);return i?i.name:e}function _He(e,t){return e&&e.map(i=>KI(i,t))}function jK(e,t){var i;return e&&typeof e.getField=="function"&&t&&(i=e.getField(t))!=null?i:null}function oxe(e){return`${e}`.trim()}function Lx({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?IW({formattedAttributes:t,template:xHe(r,{...t,...s,...e},i),fieldInfoMap:n}):""}function IW({formattedAttributes:e,template:t,fieldInfoMap:i}){return oxe(yHe(Sg(Sg(t,r=>gHe(r,i)),e)))}function vHe(e,t,i=!1){const r=t[e];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(uHe,s);t[e]=n}}function bHe(e,t=!1){const i={...e};return Object.keys(i).forEach(r=>vHe(r,i,t)),i}function wHe(e,t,i){const r=(t=oxe(t))&&t[0]!=="{";return Sg(e,bHe(i,r||!1))}function PW(e,t){return e.replace(cHe,(i,r,s)=>{const n=jK(t,s);return n?`{${n.name}}`:r})}function xHe(e,t,i){const r=PW(e,i);return r&&r.replace(pHe,(s,n,o)=>wHe(s,n||o,t))}function THe(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const i=Number(e);if(!isNaN(i))return i}return e}function SHe(e){return(e==null?void 0:e.type)==="feature"}function Yne(e){return!!(e!=null&&e.layer)}function EHe(e){return(e==null?void 0:e.type)==="map-image"}function CHe(e,t){var c;const i=t.fieldInfos,r=t.fieldName,s=(c=axe(i,r))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=jK(o,r);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new OE;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!Yne(o)&&SHe(o)&&o.datesInUnknownTimezone||Yne(o)&&EHe(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof e=="string"&&rye(r)&&l?l.formatRasterPixelValue(e):typeof(e=THe(e,l))=="string"||e==null||l==null?R$(e):n?Cg(e,{...lye(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function axe(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function AHe({fieldName:e,graphic:t,layer:i}){if(u0(e)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}function MHe({fieldName:e,value:t,graphic:i,layer:r}){if(u0(e)||!r||typeof r.getFieldDomain!="function")return null;const s=i&&r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function RHe(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:Ou(o,OW),user:l}}const a=t[r];if(typeof a=="number"){const l=t[i];return{type:"create",date:Ou(a,OW),user:l}}return null}function OHe(e,t){const i=new Map;return e&&e.forEach(r=>{const s=KI(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function Zne(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function HK(e){return e.replace(dHe,t=>`&#${t.charCodeAt(0)};`)}function R$(e){return typeof e=="string"?e.replace(hHe,'<br class="esri-text-new-line" />'):e}function lxe(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=MHe({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=AHe({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return CHe(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?Ou(t,OW):R$(t)}function oB({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>LHe({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:i})),t&&Object.keys(t).forEach(a=>{const l=t[a];o[a]=lxe({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function cxe(e,t){var h,p;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return Xne.warn(f,m),null}if(!((p=(h=H0e(i))==null?void 0:h.operations)!=null&&p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return Xne.warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,t)).features[0]}async function IHe(e){var r;if(!((r=e.expressionInfos)!=null&&r.length))return!1;const t=await Eg(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}async function PHe({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&await i.load(s),!e.attributes))return;const n=e.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(i.fieldsIndex),l=iDe(a,e),c=l?[]:a,h=t.returnGeometry||await IHe(t);if(l&&!h)return;const p=await cxe({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes={...e.attributes,...p.attributes}))}function u0(e=""){return!!e&&e.includes(ixe)}function $He(e){return e?`${ixe}${e.layerId}/${e.fieldName}`:""}function Jne({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){e&&t&&i&&Object.keys(t.attributes).forEach(o=>{const a=$He({layerId:i.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=lxe({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function LHe({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>Jne({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>Jne({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})))}const Kne=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},uxe=({layer:e,method:t,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||t==="attachments")return;const s=v(i.where)?i.where:null,n=v(i.geometry)?i.geometry:null;Kne(r)||Kne(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},DHe=({query:e,layer:t,method:i})=>{uxe({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},FHe=({queryPayload:e,layer:t,method:i})=>{uxe({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})};function NHe(e,t,i){return e&&t&&i?Qne(e.allLayers,t,i)||Qne(e.allTables,t,i):null}function Qne(e,t,i){return e.find(r=>r!==t&&r.type==="feature"&&r.url===t.url&&r.layerId===i.relatedTableId)}const eoe={editing:!1,operations:{add:!0,update:!0,delete:!0}},hxe=Qe.ofType(oHe);let nu=class extends Te{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...eoe},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new hxe,this.fileInfos=new Qe,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(te(()=>this.graphic,()=>this._graphicChanged(),st))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...eoe,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return(t==null?void 0:t.loaded)&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new H("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getObjectId(),r=new Dq({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(a=>a[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e,t=this.graphic){var a;const{_attachmentLayer:i,attachmentInfos:r,abilities:s}=this;if(!t)throw new H("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new H("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((a=s.operations)!=null&&a.add))throw new H("invalid-abilities","addAttachment(): add abilities are required.");if(!i||typeof i.addAttachment!="function")throw new H("invalid-layer","addAttachment(): A valid layer is required.");const n=i.addAttachment(t,e).then(l=>this._queryAttachment(l.objectId,t)),o=await n;return r.add(o),o}async deleteAttachment(e){var a;const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new H("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((a=s.operations)!=null&&a.delete))throw new H("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new H("invalid-layer","deleteAttachment(): A valid layer is required.");if(!r)throw new H("invalid-graphic","deleteAttachment(): A graphic is required.");const n=t.deleteAttachments(r,[e.id]).then(()=>e),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){var c;const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new H("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new H("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!((c=n.operations)!=null&&c.update))throw new H("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex(h=>h===t);if(!i||typeof i.updateAttachment!="function")throw new H("invalid-layer","updateAttachment(): A valid layer is required.");if(!s)throw new H("invalid-graphic","updateAttachment(): A graphic is required.");const a=i.updateAttachment(s,t.id,e).then(h=>this._queryAttachment(h.objectId)),l=await a;return r.splice(o,1,l),l}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t,i=this.activeFileInfo){if(!e||!t||!i)return null;const r=this.fileInfos.findIndex(s=>i===s);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}deleteFile(e){const t=this.fileInfos.find(i=>i.file===e);return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:i}=this;if(!e||!(i!=null&&i.queryAttachments))throw new H("invalid-attachment-id","Could not query attachment.");const r=this._getObjectId(t),s=new Dq({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(s).then(n=>n[r][0])}_getObjectId(e=this.graphic){var t;return(t=e==null?void 0:e.getObjectId())!=null?t:null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=rxe(e);this._attachmentLayer=t?t.type==="scene"&&v(t.associatedLayer)?t.associatedLayer:t:null}};u([d()],nu.prototype,"abilities",void 0),u([Zt("abilities")],nu.prototype,"castAbilities",null),u([d()],nu.prototype,"activeAttachmentInfo",void 0),u([d()],nu.prototype,"activeFileInfo",void 0),u([d({readOnly:!0,type:hxe})],nu.prototype,"attachmentInfos",void 0),u([d()],nu.prototype,"fileInfos",void 0),u([d({type:Ko})],nu.prototype,"graphic",void 0),u([d()],nu.prototype,"mode",void 0),u([d({readOnly:!0})],nu.prototype,"state",null),u([d()],nu.prototype,"filesEnabled",void 0),u([d({readOnly:!0})],nu.prototype,"supportsResizeAttachments",null),nu=u([P("esri.widgets.Attachments.AttachmentsViewModel")],nu);const qK=nu;function toe(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function kHe(e){const t=Vi("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function Es(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}var UHe=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},dxe=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?dxe(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=UHe(s)),t.push(s))}},VHe=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return dxe(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function D(e,t,...i){return typeof e!="function"||zK(e)?VHe(e,t,...i):e(t,...i)}const ioe={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},xr="esri-attachments",Ab="esri-button",Ye={base:xr,loaderContainer:`${xr}__loader-container`,loader:`${xr}__loader`,fadeIn:`${xr}--fade-in`,container:`${xr}__container`,containerList:`${xr}__container--list`,containerPreview:`${xr}__container--preview`,actions:`${xr}__actions`,deleteButton:`${xr}__delete-button`,addAttachmentButton:`${xr}__add-attachment-button`,errorMessage:`${xr}__error-message`,items:`${xr}__items`,item:`${xr}__item`,itemButton:`${xr}__item-button`,itemMask:`${xr}__item-mask`,itemMaskIcon:`${xr}__item-mask--icon`,itemImage:`${xr}__image`,itemImageResizable:`${xr}__image--resizable`,itemLabel:`${xr}__label`,itemFilename:`${xr}__filename`,itemChevronIcon:`${xr}__item-chevron-icon`,itemLink:`${xr}__item-link`,itemLinkOverlay:`${xr}__item-link-overlay`,itemLinkOverlayIcon:`${xr}__item-link-overlay-icon`,itemEditIcon:`${xr}__item-edit-icon`,itemAddIcon:`${xr}__item-add-icon`,itemAddButton:`${xr}__item-add-button`,formNode:`${xr}__form-node`,fileFieldset:`${xr}__file-fieldset`,fileLabel:`${xr}__file-label`,fileName:`${xr}__file-name`,fileInput:`${xr}__file-input`,metadata:`${xr}__metadata`,metadataFieldset:`${xr}__metadata-fieldset`,progressBar:`${xr}__progress-bar`,esriWidget:"esri-widget",esriButton:Ab,buttonDisabled:`${Ab}--disabled`,esriButtonSecondary:`${Ab}--secondary`,esriButtonTertiary:`${Ab}--tertiary`,esriButtonThird:`${Ab}--third`,esriButtonSmall:`${Ab}--small`,esriButtonHalf:`${Ab}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},aB=window.CSS;let Dl=class extends pn{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...ioe},this._supportsImageOrientation=aB&&aB.supports&&aB.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new qK),this.addHandles([Fs(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),Fs(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),te(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),st)])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-icon.cd430452.js"),["assets/calcite-icon.cd430452.js","assets/icon.2acbc95d.js","assets/observers.0143061c.js"])])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...ioe,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new H("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new H("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new H("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){var i;const t=this.viewModel.deleteFile(e||((i=this.viewModel.activeFileInfo)==null?void 0:i.file));return this.viewModel.mode="view",t}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return D("div",{class:this.classes(Ye.base,Ye.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?D("div",{key:"error-message",class:Ye.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:t,activeAttachmentInfo:i}=this.viewModel;return t==="add"?this.renderAddForm():t==="edit"?this.renderDetailsForm(i||e):this.renderAttachmentContainer()}renderLoading(){return D("div",{class:Ye.loaderContainer,key:"loader"},D("div",{class:Ye.loader}))}renderProgressBar(){return this.visibleElements.progressBar?D("div",{class:Ye.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?D("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Ye.esriButton,Ye.esriButtonTertiary,Ye.esriButtonSmall,Ye.esriButtonHalf,e&&Ye.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?D("button",{type:"submit",disabled:i,class:this.classes(Ye.esriButton,Ye.esriButtonSecondary,Ye.esriButtonSmall,Ye.esriButtonHalf,{[Ye.buttonDisabled]:i})},this.messages.add):null,n=t?D("span",{key:"file-name",class:Ye.fileName},t.name):null,o=D("form",{bind:this,afterCreate:y1,afterRemoved:Ene,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},D("fieldset",{class:Ye.fileFieldset},n,D("label",{class:this.classes(Ye.fileLabel,Ye.esriButton,Ye.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,D("input",{class:Ye.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return D("div",{key:"add-form-container",class:Ye.formNode},o)}renderDetailsForm(e){var S,E,M;const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{abilities:n}=i,o=s||!r;let a,l,c,h;r?(a=r.type,l=r.name,c=r.size):e&&"file"in e?(a=e.file.type,l=e.file.name,c=e.file.size):e&&"contentType"in e&&(a=e.contentType,l=e.name,c=e.size,h=e.url);const p=n.editing&&((S=n.operations)==null?void 0:S.delete)&&t.deleteButton?D("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:A=>this._submitDeleteAttachment(A,e),class:this.classes(Ye.esriButton,Ye.esriButtonSmall,Ye.esriButtonTertiary,Ye.deleteButton,{[Ye.buttonDisabled]:s})},this.messages.delete):void 0,f=n.editing&&((E=n.operations)==null?void 0:E.update)&&t.updateButton?D("button",{disabled:o,key:"update-button",type:"submit",class:this.classes(Ye.esriButton,Ye.esriButtonSmall,Ye.esriButtonThird,{[Ye.buttonDisabled]:o})},this.messages.update):void 0,m=this.visibleElements.cancelUpdateButton?D("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Ye.esriButton,Ye.esriButtonSmall,Ye.esriButtonTertiary,Ye.esriButtonThird,{[Ye.buttonDisabled]:s})},this.messages.cancel):void 0,y=n.editing&&((M=n.operations)==null?void 0:M.update)?D("fieldset",{key:"file",class:Ye.fileFieldset},D("span",{key:"file-name",class:Ye.fileName},l),D("label",{class:this.classes(Ye.fileLabel,Ye.esriButton,Ye.esriButtonSecondary)},this.messages.changeFile,D("input",{class:Ye.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,_=D("fieldset",{key:"size",class:Ye.metadataFieldset},D("label",null,iHe(this.messagesUnits,c!=null?c:0))),b=D("fieldset",{key:"content-type",class:Ye.metadataFieldset},D("label",null,a)),w=v(h)?D("a",{class:Ye.itemLink,href:h,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),D("div",{class:Ye.itemLinkOverlay},D("span",{class:Ye.itemLinkOverlayIcon},D("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),T=D("form",{bind:this,afterCreate:y1,afterRemoved:Ene,"data-node-ref":"_updateAttachmentForm",onsubmit:A=>this._submitUpdateAttachment(A,e)},D("div",{class:Ye.metadata},_,b),y,D("div",{class:Ye.actions},p,m,f));return D("div",{key:"edit-form-container",class:Ye.formNode},w,T)}renderImageMask(e,t){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,t):null}renderGenericImageMask(e,t){const{supportsResizeAttachments:i}=this.viewModel,r=kHe(t),s={[Ye.itemImageResizable]:i};return D("div",{class:this.classes(Ye.itemMaskIcon,Ye.itemMask)},D("img",{title:e,alt:e,src:r,class:this.classes(s,Ye.itemImage)}))}renderImageMaskForAttachment(e,t){const{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;const{contentType:r,name:s,url:n}=e;if(!i||!toe(r))return this.renderGenericImageMask(s,r);const o=this._getCSSTransform(e),a=o?{transform:o,"image-orientation":"none"}:{},l=`${n}${n!=null&&n.includes("?")?"&":"?"}w=${t}`,c={[Ye.itemImageResizable]:i};return D("div",{class:this.classes(Ye.itemMask)},D("img",{styles:a,alt:s,title:s,src:l,class:this.classes(c,Ye.itemImage)}))}renderFile(e){const{file:t}=e;return D("li",{class:Ye.item,key:t},D("button",{key:"details-button",bind:this,class:Ye.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),D("label",{class:Ye.itemLabel},D("span",{class:Ye.itemFilename},t.name||this.messages.noTitle),D("span",{"aria-hidden":"true",class:this.classes(Ye.itemChevronIcon,og(this.container)?Ye.iconLeft:Ye.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i,effectiveDisplayType:r}=this,{abilities:s,supportsResizeAttachments:n}=i,{contentType:o,name:a,url:l}=e,c=this.renderImageMask(e,t==="list"?48:400),h=s.editing?D("span",{"aria-hidden":"true",class:this.classes(Ye.itemChevronIcon,og(this.container)?Ye.iconLeft:Ye.iconRight)}):null,p=[c,r==="preview"&&n&&toe(o)?null:D("label",{class:Ye.itemLabel},D("span",{class:Ye.itemFilename},a||this.messages.noTitle),h)],f=s.editing?D("button",{key:"details-button",bind:this,class:Ye.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},p):D("a",{key:"details-link",class:Ye.itemButton,href:l!=null?l:void 0,target:"_blank"},p);return D("li",{class:Ye.item,key:e},f)}renderAttachmentContainer(){var m;const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s,fileInfos:n}=t,o=!!(r!=null&&r.length),a=!!(n!=null&&n.length),l={[Ye.containerList]:e!=="preview",[Ye.containerPreview]:e==="preview"},c=s.editing&&((m=s.operations)==null?void 0:m.add)&&i.addButton?D("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Ye.esriButton,Ye.esriButtonTertiary,Ye.addAttachmentButton),type:"button"},D("span",{"aria-hidden":"true",class:this.classes(Ye.itemAddIcon,Ye.iconPlus)}),this.messages.add):void 0,h=o?D("ul",{key:"attachments-list",class:Ye.items},r.toArray().map(y=>this.renderAttachmentInfo({attachmentInfo:y,displayType:e}))):void 0,p=a?D("ul",{key:"file-list",class:Ye.items},n.toArray().map(y=>this.renderFile(y))):void 0,f=a||o?void 0:D("div",{class:Ye.empty},this.messages.noAttachments);return D("div",{key:"attachments-container",class:this.classes(Ye.container,l)},h,p,f,c)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){const{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};u([d()],Dl.prototype,"abilities",null),u([d()],Dl.prototype,"displayType",void 0),u([d({readOnly:!0})],Dl.prototype,"effectiveDisplayType",null),u([d()],Dl.prototype,"graphic",null),u([d()],Dl.prototype,"label",null),u([d(),Es("esri/widgets/Attachments/t9n/Attachments")],Dl.prototype,"messages",void 0),u([d(),Es("esri/core/t9n/Units")],Dl.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],Dl.prototype,"selectedFile",void 0),u([d({readOnly:!0})],Dl.prototype,"submitting",void 0),u([d({readOnly:!0})],Dl.prototype,"error",void 0),u([d({type:qK})],Dl.prototype,"viewModel",void 0),u([d()],Dl.prototype,"visibleElements",void 0),u([Zt("visibleElements")],Dl.prototype,"castVisibleElements",null),Dl=u([P("esri.widgets.Attachments")],Dl);const BHe=Dl;let LO=class extends qK{constructor(e){super(e),this.description=null,this.title=null}};u([d()],LO.prototype,"description",void 0),u([d()],LO.prototype,"title",void 0),LO=u([P("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],LO);const WK=LO,zHe={heading:"esri-widget__heading"};function BU({level:e,class:t,...i},r){const s=pxe(e);return D(`h${s}`,{...i,class:cwe(zHe.heading,t),role:"heading","aria-level":String(s)},r)}function pxe(e){return ye(Math.ceil(e),1,6)}function URt(e,t=1){return pxe(e+t)}const lB="esri-feature-element-info",cB={base:lB,title:`${lB}__title`,description:`${lB}__description`};let eE=class extends pn{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return D("div",{class:cB.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?D(BU,{level:this.headingLevel,class:cB.title},e):null}renderDescription(){const{description:e}=this;return e?D("div",{key:"description",class:cB.description},e):null}};u([d()],eE.prototype,"description",void 0),u([d()],eE.prototype,"headingLevel",void 0),u([d()],eE.prototype,"title",void 0),eE=u([P("esri.widgets.Feature.support.FeatureElementInfo")],eE);const zU=eE,GHe={base:"esri-feature-attachments"};let Am=class extends pn{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new BHe,this.headingLevel=2,this.viewModel=new WK}initialize(){this._featureElementInfo=new zU,this.addHandles([te(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),st),te(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,st)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var t;const{attachmentsWidget:e}=this;return D("div",{class:GHe.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var r;const{description:e,title:t,headingLevel:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:t,headingLevel:i})}};u([d({readOnly:!0})],Am.prototype,"attachmentsWidget",void 0),u([d()],Am.prototype,"description",null),u([d()],Am.prototype,"displayType",null),u([d()],Am.prototype,"graphic",null),u([d()],Am.prototype,"headingLevel",void 0),u([d()],Am.prototype,"title",null),u([d({type:WK})],Am.prototype,"viewModel",void 0),Am=u([P("esri.widgets.Feature.FeatureAttachments")],Am);const jHe=Am;let _v=class extends jf(Te){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(te(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},st))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&t&&(sk(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const t=this.graphic;if(!t||!e)return;const i=sk(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};u([d({readOnly:!0})],_v.prototype,"created",void 0),u([d()],_v.prototype,"creator",void 0),u([d()],_v.prototype,"destroyer",void 0),u([d({type:Ko})],_v.prototype,"graphic",void 0),u([d({readOnly:!0})],_v.prototype,"state",null),_v=u([P("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],_v);const nk=_v;function ln(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:qHe(e[t])}}}function HHe(e){const t=e==null?void 0:e.type;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function qHe(e){return function(t,...i){HHe(t)?dwe(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function O$(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:WHe(e);i.push(...r)}}function WHe(e){return e.split(",").map(t=>t.trim())}const fxe="calcite-mode-";function XHe(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replace(/\s|'|"/g,"")}function ok(){return XHe().startsWith("dark")}function mxe(){return`${fxe}${ok()?"dark":"light"}`}function YHe(e){ZHe(e),e.classList.add(mxe())}function ZHe(e){Array.from(e.classList).forEach(t=>{t.startsWith(fxe)&&e.classList.remove(t)})}function mA(e){return e&&typeof e.render=="function"}function gxe(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const uB="esri-feature-content",hB={base:uB,loaderContainer:`${uB}__loader-container`,loader:`${uB}__loader`};let tE=class extends pn{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{sxe(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return D("div",{class:hB.loaderContainer,key:"loader"},D("div",{class:hB.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?D("div",{key:e,bind:e,afterCreate:this._attachToNode}):mA(e)?D("div",{key:e},!e.destroyed&&e.render()):D("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return D("div",{class:hB.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([d()],tE.prototype,"creator",null),u([d()],tE.prototype,"graphic",null),u([d({type:nk})],tE.prototype,"viewModel",void 0),tE=u([P("esri.widgets.Feature.FeatureContent")],tE);const s4=tE;let Fy=class extends Te{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t==null||t.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const s=r.clone();s.label=nxe(s,e),i.push(s)}),i}};u([d()],Fy.prototype,"attributes",void 0),u([d({type:[gye]})],Fy.prototype,"expressionInfos",void 0),u([d()],Fy.prototype,"description",void 0),u([d({type:[h$]})],Fy.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],Fy.prototype,"formattedFieldInfos",null),u([d()],Fy.prototype,"title",void 0),Fy=u([P("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Fy);const GU=Fy,JHe=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function KHe(e){let t=null;return JHe.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function QHe(e,t){if(typeof t!="string"||!t)return t;const i=KHe(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=Sg(Sg(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const tD="esri-feature-fields",YM={base:tD,fieldHeader:`${tD}__field-header`,fieldData:`${tD}__field-data`,fieldDataDate:`${tD}__field-data--date`,esriTable:"esri-widget__table"};let qp=class extends pn{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new GU,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new zU,this.addHandles(te(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),st))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?i[r]==null?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):QHe(this.messagesURIUtils,n),l={[YM.fieldDataDate]:o};return D("tr",{key:`fields-element-info-row-${r}-${t}`},D("th",{key:`fields-element-info-row-header-${r}-${t}`,class:YM.fieldHeader,innerHTML:s}),D("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(YM.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?D("table",{class:YM.esriTable,summary:this.messages.fieldsSummary},D("tbody",null,e.map((t,i)=>this.renderFieldInfo(t,i)))):null}render(){var e;return D("div",{class:YM.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var i;const{description:e,title:t}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([d()],qp.prototype,"attributes",null),u([d()],qp.prototype,"description",null),u([d()],qp.prototype,"expressionInfos",null),u([d()],qp.prototype,"fieldInfos",null),u([d()],qp.prototype,"title",null),u([d({type:GU,nonNullable:!0})],qp.prototype,"viewModel",void 0),u([d(),Es("esri/widgets/Feature/t9n/Feature")],qp.prototype,"messages",void 0),u([d(),Es("esri/widgets/support/t9n/uriUtils")],qp.prototype,"messagesURIUtils",void 0),qp=u([P("esri.widgets.Feature.FeatureFields")],qp);const yxe=qp,eqe=/^-?(\d+)(\.(\d+))?$/i;function tqe(e,t){return e-t}function iqe(e,t){let i,r;return i=Number(e.toFixed(t)),i<e?r=i+1/10**t:(r=i,i-=1/10**t),i=Number(i.toFixed(t)),r=Number(r.toFixed(t)),[i,r]}function rqe(e,t,i,r,s){const n=sqe(e,t,i,r),o=n.previous==null||n.previous<=s,a=n.next==null||n.next<=s;return o&&a||n.previous+n.next<=2*s}function _xe(e){const t=String(e),i=t.match(eqe);if(i&&i[1])return{integer:i[1].split("").length,fractional:i[3]?i[3].split("").length:0};if(t.toLowerCase().includes("e")){const r=t.split("e"),s=r[0],n=r[1];if(s&&n){const o=Number(s);let a=Number(n);const l=a>0;l||(a=Math.abs(a));const c=_xe(o);return l?(c.integer+=a,a>c.fractional?c.fractional=0:c.fractional-=a):(c.fractional+=a,a>c.integer?c.integer=1:c.integer-=a),c}}return{integer:0,fractional:0}}function sqe(e,t,i,r){const s={previous:null,next:null};if(i!=null){const n=e-i,o=t-i-n;s.previous=Math.floor(Math.abs(100*o/n))}if(r!=null){const n=r-e,o=r-t-n;s.next=Math.floor(Math.abs(100*o/n))}return s}function VRt(e,t={}){const i=e.slice(0),{tolerance:r=2,strictBounds:s=!1,indexes:n=i.map((o,a)=>a)}=t;n.sort(tqe);for(let o=0;o<n.length;o++){const a=n[o],l=i[a],c=a===0?null:i[a-1],h=a===i.length-1?null:i[a+1],p=_xe(l).fractional;if(p){let f,m=0,y=!1;for(;m<=p&&!y;){const _=iqe(l,m);f=s&&o===0?_[1]:_[0],y=rqe(l,f,c,h,r),m++}y&&(i[a]=f)}}return i}const nqe={maximumFractionDigits:20};function oqe(e){return Cg(e,nqe)}class aqe{constructor(t,i){this._storage=new EJ,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i){this._storage.put(t,i,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function lqe(e){return typeof e=="function"}function BRt(e,t,i,r){return lqe(e)?e(t,i,r):e}function zRt(e){return[e.r,e.g,e.b,e.a]}const cqe=` /-,
`;function roe(e){let t=e.length;for(;t--;)if(!cqe.includes(e.charAt(t)))return!1;return!0}function uqe(e,t){const i=[];let r=0,s=-1;do if(s=e.indexOf("[",r),s>=r){if(s>r){const n=e.substr(r,s-r);i.push([n,null,roe(n)])}if(r=s+1,s=e.indexOf("]",r),s>=r){if(s>r){const n=t[e.substr(r,s-r)];n&&i.push([null,n,!1])}r=s+1}}while(s!==-1);if(r<e.length-1){const n=e.substr(r);i.push([n,null,roe(n)])}return i}function hqe(e,t,i){let r="",s=null;for(const n of t){const[o,a,l]=n;if(o)l?s=o:(s&&(r+=s,s=null),r+=o);else{const c=e.attributes[a];c&&(s&&(r+=s,s=null),r+=c)}}return dqe(r,i)}function GRt(e,t,i){const r=uqe(t,e);return s=>hqe(s,r,i)}function dqe(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function jRt(e,t,i,r,s,n,o=!0){const a=t/s,l=i/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let y=0,_=0,b=0,w=0,T=0,S=0,E=0;const M=(p+.5)*l;for(let A=Math.floor(p*l);A<(p+1)*l;A++){const $=Math.abs(M-(A+.5))/h,I=(f+.5)*a,k=$*$;for(let V=Math.floor(f*a);V<(f+1)*a;V++){let B=Math.abs(I-(V+.5))/c;const G=Math.sqrt(k+B*B);G>=-1&&G<=1&&(y=2*G*G*G-3*G*G+1,y>0&&(B=4*(V+A*t),E+=y*e[B+3],b+=y,e[B+3]<255&&(y=y*e[B+3]/250),w+=y*e[B],T+=y*e[B+1],S+=y*e[B+2],_+=y))}}r[m]=w/_,r[m+1]=T/_,r[m+2]=S/_,r[m+3]=E/b}}function vxe(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function bxe(e){var t,i;return(i=(t=e.data)==null?void 0:t.symbol)!=null?i:null}function $W(e){return e.type==="CIMVectorMarker"||e.type==="CIMPictureMarker"||e.type==="CIMBarChartMarker"||e.type==="CIMCharacterMarker"||e.type==="CIMPieChartMarker"||e.type==="CIMStackedBarChartMarker"}function LW(e){return e.type==="CIMGradientStroke"||e.type==="CIMPictureStroke"||e.type==="CIMSolidStroke"}function pqe(e){return e!=null&&(e.type==="CIMGradientFill"||e.type==="CIMHatchFill"||e.type==="CIMPictureFill"||e.type==="CIMSolidFill"||e.type==="CIMWaterFill")}function ak(e){return e!=null&&(e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices")}const HRt=(e,t=0)=>e==null||isNaN(e)?t:e,qRt=e=>e.tintColor?vxe(e.tintColor):{r:255,g:255,b:255,a:1},WRt=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function XRt(){return Q(()=>import("./geometryEngineJSON.7ef32ff7.js"),["assets/geometryEngineJSON.7ef32ff7.js","assets/geometryEngineBase.871c2f6a.js","assets/geometryEngineJSON.7d40f72f.js","assets/json.5152e73f.js"])}function YRt(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function ZRt(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function JRt(e){let t="",i="";if(e){const r=e.toLowerCase();r.includes("italic")?t="italic":r.includes("oblique")&&(t="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:t,weight:i}}function KRt(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function soe(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const i=soe(t);if(i!=null)return i}break;case"CIMTextSymbol":return soe(e.symbol);case"CIMSolidFill":return e.color}}function noe(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const i of t){const r=noe(i);if(r!=null)return r}break}case"CIMTextSymbol":return noe(e.symbol);case"CIMSolidStroke":case"CIMSolidFill":return e.color}}function ooe(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const i=ooe(t);if(i!==void 0)return i}break;case"CIMTextSymbol":return ooe(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function QRt(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function eOt(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function tOt(e){return(e?Object.keys(e):[]).map(t=>({name:t,alias:t,type:typeof e[t]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const iOt=e=>e.includes("data:image/svg+xml");function rOt(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function wxe(e,t,i,r){if(e)if(e.type!=="CIMTextSymbol"){if(i&&e.effects)for(const s of e.effects)gqe(s,t);if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":fqe(s,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r!=null&&r.preserveOutlineWidth)&&s.width&&(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":wxe(s.lineSymbol,t,!0,{...r,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}}else e.height!=null&&(e.height*=t)}function fqe(e,t,i){if(e&&(e.markerPlacement&&mqe(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=e.size!=null?e.size*t:0,e.type==="CIMVectorMarker"&&e.markerGraphics))for(const r of e.markerGraphics)e.scaleSymbolsProportionally||wxe(r.symbol,t,!0,i)}function mqe(e,t){switch(ak(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function gqe(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map(r=>r*t);e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function yqe(e){const t=[];return DW(bxe(e),t),t.length?new De(vxe(t[0])):null}function DW(e,t){var s;if(!e)return;let i;i=e.type==="CIMTextSymbol"?e.symbol:e;const r=e.type==="CIMPolygonSymbol";if(i!=null&&i.symbolLayers){for(const n of i.symbolLayers)if(!(n.colorLocked||r&&(LW(n)||$W(n)&&n.markerPlacement&&ak(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&aoe(t,n.tintColor);break;case"CIMVectorMarker":(s=n.markerGraphics)==null||s.forEach(o=>{DW(o.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":aoe(t,n.color);break;case"CIMHatchFill":DW(n.lineSymbol,t)}}}function aoe(e,t){for(const i of e)if(i.join(".")===t.join("."))return;e.push(t)}function sOt(e,t,i){t instanceof De||(t=new De(t));const r=bxe(e);r&&FW(r,t,i)}function FW(e,t,i){var n;if(!e)return;let r;r=e.type==="CIMTextSymbol"?e.symbol:e;const s=(r==null?void 0:r.type)==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers)for(const o of r.symbolLayers){if(o.colorLocked)continue;if(s){if(i){const{layersToColor:l}=i;if((LW(o)||$W(o)&&o.markerPlacement&&ak(o.markerPlacement))&&l==="fill"||pqe(o)&&l==="outline")continue}else if(LW(o)||$W(o)&&o.markerPlacement&&ak(o.markerPlacement))continue}const a=t.toArray();switch(o.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":o.tintColor=a;break;case"CIMVectorMarker":(n=o.markerGraphics)==null||n.forEach(l=>{FW(l.symbol,t,i)});break;case"CIMSolidStroke":case"CIMSolidFill":o.color=a;break;case"CIMHatchFill":FW(o.lineSymbol,t,i)}}}const xxe="picture-fill",Txe="simple-fill",_qe="simple-line",Sxe="simple-marker",vqe="text",bqe="cim",dB=new aqe(1e3);function nOt(e){const t=e.style;let i=null;if(e)switch(e.type){case Sxe:t!=="cross"&&t!=="x"&&(i=e.color);break;case Txe:t==="solid"?i=e.color:t!=="none"&&(i={type:"pattern",x:0,y:0,src:Vi(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case xxe:i={type:"pattern",src:e.url,width:$r(e.width)*e.xscale,height:$r(e.height)*e.yscale,x:$r(e.xoffset),y:$r(e.yoffset)};break;case vqe:i=e.color;break;case bqe:i=yqe(e)}return i}function wqe(e,t){const i=e+"-"+t;return dB.get(i)!==void 0?Promise.resolve(dB.get(i)):_r(e,{responseType:"image"}).then(r=>{const s=r.data,n=s.naturalWidth,o=s.naturalHeight,a=document.createElement("canvas");a.width=n,a.height=o;const l=a.getContext("2d");l.fillStyle=t,l.fillRect(0,0,n,o),l.globalCompositeOperation="destination-in",l.drawImage(s,0,0);const c=a.toDataURL();return dB.put(i,c),c})}function XK(e){if(!e)return null;let t=null;switch(e.type){case Txe:case xxe:case Sxe:t=XK(e.outline);break;case _qe:{const i=$r(e.width);e.style!=null&&e.style!=="none"&&i!==0&&(t={color:e.color,style:YK(e.style),width:i,cap:e.cap,join:e.join==="miter"?$r(e.miterLimit):e.join});break}default:t=null}return t}const YK=(()=>{const e={};return t=>{if(e[t])return e[t];const i=t.replace(/-/g,"");return e[t]=i,i}})(),xqe=new De([128,128,128]),Tqe=new De("white");function Sqe(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1);return"outline"in i?oo(i,"outline","size"):void 0}function oOt(e){var t;if(!e)return 0;if(j1(e)){const i=Sqe(e);return v(i)?i:0}return Gh((t=XK(e))==null?void 0:t.width)}function Eqe(e){if(C(e)||!("symbolLayers"in e)||C(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(t=>t.type==="object");case"line-3d":return e.symbolLayers.some(t=>t.type==="path");case"polygon-3d":return e.symbolLayers.some(t=>t.type==="object"||t.type==="extrude");default:return!1}}function Exe(e){return ba(e.resource).href}function wS(e,t){if(!e)return null;let i=null;return j1(e)?i=Cqe(e):K6(e)&&(i=e.color?new De(e.color):null),i?QI(i,t):null}function Cqe(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach(r=>{var s;r.type==="object"&&((s=r.resource)==null?void 0:s.href)!=null||(i=r.type==="water"?r.color:v(r.material)?r.material.color:null)}),i?new De(i):null}function QI(e,t){if(t==null||e==null)return e;const i=e.toRgba();return i[3]=i[3]*t,new De(i)}function Aqe(e,t,i){const r=e.symbolLayers;if(!r)return;const s=n=>{var a;const o=v(n)?n:null;return QI(t=(a=t!=null?t:o)!=null?a:i!=null?Tqe:null,i)};r.forEach(n=>{var o;if(n.type!=="object"||((o=n.resource)==null?void 0:o.href)==null||t)if(n.type==="water")n.color=s(n.color);else{const a=v(n.material)?n.material.color:null,l=s(a);C(n.material)?n.material=new Fh({color:l}):n.material.color=l,i!=null&&"outline"in n&&v(n.outline)&&v(n.outline.color)&&(n.outline.color=QI(n.outline.color,i))}})}function Mqe(e,t,i){(t=t!=null?t:e.color)&&(e.color=QI(t,i)),i!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=QI(e.outline.color,i))}function pB(e,t,i){e&&(t||i!=null)&&(t&&(t=new De(t)),j1(e)?Aqe(e,t,i):K6(e)&&Mqe(e,t,i))}async function Rqe(e,t){const i=e.symbolLayers;i&&await SU(i,async r=>Oqe(r,t))}async function Oqe(e,t){switch(e.type){case"extrude":Pqe(e,t);break;case"icon":case"line":case"text":Iqe(e,t);break;case"path":Lqe(e,t);break;case"object":await $qe(e,t)}}function Iqe(e,t){const i=Cxe(t);v(i)&&(e.size=i)}function Cxe(e){for(const t of e)if(typeof t=="number")return t;return null}function Pqe(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function $qe(e,t){const{resourceSize:i,symbolSize:r}=await Dqe(e),s=Axe(t,i,r);e.width=V3(t[0],r[0],i[0],s),e.depth=V3(t[1],r[1],i[1],s),e.height=V3(t[2],r[2],i[2],s)}function Lqe(e,t){const i=Axe(t,sg,[e.width,void 0,e.height]);e.width=V3(t[0],e.width,1,i),e.height=V3(t[2],e.height,1,i)}function Axe(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":{const n=i[r];return n!=null?n/t[r]:1}case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}async function Dqe(e){const t=await Q(()=>import("./symbolLayerUtils.2a82f3e9.js"),[]),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,o=[r,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function V3(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return t!=null?t:i;default:return e}}function Fqe(e,t){const i=Cxe(t);if(!C(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=i,e.height=i*r):(e.width=i*r,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}async function Nqe(e,t){if(e&&t)return j1(e)?Rqe(e,t):void(K6(e)&&Fqe(e,t))}function kqe(e,t,i){if(e&&t!=null)if(j1(e)){const r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else K6(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function Mxe(e){if(!e)return null;const t=e.effects.filter(i=>i.type!=="bloom").map(i=>i.toJSON());return dq(t)}function aOt(e){return v(e)&&e.type==="polygon-3d"&&e.symbolLayers.some(t=>t.type==="extrude")}async function Uqe(e,t){return await e.fetchSymbol(t)||e.fetchCIMSymbol(t)}const Vqe="<",Bqe=">",zqe=XC("short-date");function Gqe(e,t,i,r){let s="";t===0?s=`${Vqe} `:t===i&&(s=`${Bqe} `);let n=null;return n=r?Ou(e,zqe):oqe(e),s+n}const lOt=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function jqe(e){var o;if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find(a=>a.type==="color");if(!t)return null;let i=null,r=null;if(t.stops){if(t.stops.length===1)return t.stops[0].color;i=t.stops[0].value,r=t.stops[t.stops.length-1].value}const s=i!=null&&r!=null?i+(r-i)/2:0,{getColor:n}=await Q(()=>Promise.resolve().then(function(){return tU}),void 0);return(o=n(t,s))!=null?o:null}async function cOt(e,t){const i=e.trailCap,r=e.trailWidth||1,s=t||await jqe(e)||e.color;return new Nu({cap:i,color:s,width:r})}const Hqe=new De([64,64,64]);function Rxe(e,t){const i=[],r=e.length-1;return e.length===5?i.push(0,2,4):i.push(0,r),e.map((s,n)=>i.includes(n)?Gqe(s,n,r,t):null)}async function qqe(e,t,i){let r=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:Rxe(s,i!=null?i:!1);return(await Promise.all(s.map(async(c,h)=>{var p;return{value:c,color:e.type==="opacity"?await Wqe(c,e,t):(await Q(()=>Promise.resolve().then(function(){return tU}),void 0)).getColor(e,c),label:r?n[h]:(p=l==null?void 0:l[h])!=null?p:""}}))).reverse()}async function Wqe(e,t,i=Hqe){const r=new De(i),s=(await Q(()=>Promise.resolve().then(function(){return tU}),void 0)).getOpacity(t,e);return s!=null&&(r.a=s),r}function uOt(e){let t=!1,i=[],r=[];i=e.map(a=>a.value),t=e.some(a=>!!a.label),t&&(r=e.map(a=>{var l;return(l=a.label)!=null?l:""}));const s=i[0],n=i[i.length-1];if(s==null&&n==null)return null;const o=t?null:Rxe(i,!1);return i.map((a,l)=>{var c;return{value:a,color:Xqe(a,e),label:t?r[l]:(c=o==null?void 0:o[l])!=null?c:""}}).reverse()}function Xqe(e,t){const{startIndex:i,endIndex:r,weight:s}=Yqe(e,t);if(i===r)return t[i].color;const n=De.blendColors(t[i].color,t[r].color,s);return new De(n)}function Yqe(e,t){let i=0,r=t.length-1;return t.some((s,n)=>e<s.value?(r=n,!0):(i=n,!1)),{startIndex:i,endIndex:r,weight:(e-t[i].value)/(t[r].value-t[i].value)}}function hOt(e,t){let i=[];if(e&&e.type==="multipart")e.colorRamps.reverse().forEach((r,s)=>{s===0?i.push({value:t.max,color:new De(r.toColor),label:"high"}):i.push({value:null,color:new De(r.toColor),label:""}),s===e.colorRamps.length-1?i.push({value:t.min,color:new De(r.fromColor),label:"low"}):i.push({value:null,color:new De(r.fromColor),label:""})});else{let r,s;e&&e.type==="algorithmic"?(r=e.fromColor,s=e.toColor):(r=[0,0,0,1],s=[255,255,255,1]),i=[{value:t.max,color:new De(s),label:"high"},{value:t.min,color:new De(r),label:"low"}]}return i}function Zqe(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=t.length-1;if(t&&t[0]){const r=t[i];r&&r.ratio!==1&&(t.push(new A3({ratio:1,color:r.color})),i++)}return t.map((r,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}se.getLogger("esri.renderers.support.utils");async function Bu(e,t,i){lZ(e,t,()=>[]).push(...i)}async function Jqe(e){var i,r,s,n,o;const t=new Map;if(!e)return t;if("visualVariables"in e&&e.visualVariables){const a=e.visualVariables.filter(l=>l.type==="color");for(const l of a){const c=((i=await qqe(l))!=null?i:[]).map(h=>h.color);await Bu(t,l.field||l.valueExpression,c)}}if(e.type==="heatmap"){const a=Zqe(e).map(l=>l.color);await Bu(t,e.field||e.valueExpression,a)}else if(e.type==="pie-chart"){for(const a of e.attributes)await Bu(t,a.field||a.valueExpression,[a.color]);await Bu(t,"default",[(r=e==null?void 0:e.othersCategory)==null?void 0:r.color,wS(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const a of e.attributes)await Bu(t,a.field||a.valueExpression,[a.color]);await Bu(t,"default",[e.backgroundColor])}else if(e.type==="unique-value")if(((s=e.authoringInfo)==null?void 0:s.type)==="predominance")for(const a of(n=e.uniqueValueInfos)!=null?n:[])await Bu(t,a.value.toString(),[wS(a.symbol,null)]);else{const a=((o=e.uniqueValueInfos)!=null?o:[]).map(f=>wS(f.symbol,null)),{field:l,field2:c,field3:h,valueExpression:p}=e;(l||p)&&await Bu(t,l||p,a),c&&await Bu(t,c,a),h&&await Bu(t,h,a)}else if(e.type==="class-breaks"){const a=e.classBreakInfos.map(h=>wS(h.symbol,null)),{field:l,valueExpression:c}=e;await Bu(t,l!=null?l:c,a)}else e.type==="simple"&&await Bu(t,"default",[wS(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&await Bu(t,"default",[wS(e.defaultSymbol,null)]),t.forEach((a,l)=>{const c=i$(a.filter(Boolean),(h,p)=>JSON.stringify(h)===JSON.stringify(p));t.set(l,c)}),t}function jU(e,t){return t?{...t,query:{...e!=null?e:{},...t.query}}:{query:e}}function _M(e){return typeof e=="string"?Ma(e):ne(e)}function HU(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=HU(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=t?o:JSON.stringify(o)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}const iD={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new $h({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:et.WebMercator}),minus180Line:new $h({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:et.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new $h({paths:[[[180,-180],[180,180]]],spatialReference:et.WGS84}),minus180Line:new $h({paths:[[[-180,-180],[-180,180]]],spatialReference:et.WGS84})}};function Dx(e,t){return Math.ceil((e-t)/(2*t))}function Oxe(e,t){const i=B3(e);for(const r of i)for(const s of r)s[0]+=t;return e}function B3(e){return jx(e)?e.rings:e.paths}async function Kqe(e,t,i,r){const s=_M(e),n=t[0].spatialReference,o={...r,query:{...s.query,f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:JA(t[0]),geometries:t}),cutter:JSON.stringify(i)}},a=await _r(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=Jl(h);return p.spatialReference=n,p})}}function Qqe(e){return{geometryType:JA(e[0]),geometries:e.map(t=>t.toJSON())}}function Ixe(e,t,i){const r=_Le(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}async function eWe(e,t,i){const r=typeof e=="string"?Ma(e):e,s=t[0].spatialReference,n=JA(t[0]),o={...i,query:{...r.query,f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(Qqe(t))}},{data:a}=await _r(r.path+"/simplify",o);return Ixe(a.geometries,n,s)}const Pxe=se.getLogger("esri.geometry.support.normalizeUtils");function tWe(e){return e.type==="polygon"}function iWe(e){return e[0].type==="polygon"}function rWe(e){return e[0].type==="polyline"}function sWe(e,t){if(!(e instanceof $h||e instanceof zh)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw Pxe.error(s),new H(s)}const i=B3(e),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,y=p/t;if(y>1){for(let T=1;T<=y-1;T++){const S=T*t,E=m*S+a,M=f*S+l;n.push([E,M])}const _=(p+Math.floor(y-1)*t)/2,b=m*_+a,w=f*_+l;n.push([b,w])}n.push([c,h])}}return tWe(e)?new zh({rings:r,spatialReference:e.spatialReference}):new $h({paths:r,spatialReference:e.spatialReference})}function loe(e,t,i){if(t){const r=sWe(e,1e6);e=RE(r,!0)}return i&&(e=Oxe(e,i)),e}function coe(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=Dx(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=Dx(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=Dx(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=Dx(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function nWe(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=B3(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*Dx(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===i){if(iWe(e))for(const a of B3(n))e[s]=e[s].addRing(a);else if(rWe(e))for(const a of B3(n))e[s]=e[s].addPath(a)}else i=s,e[s]=n}return e}async function $xe(e,t,i){var E;if(!Array.isArray(e))return $xe([e],t);t&&typeof t!="string"&&Pxe.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof t=="string"?t:(E=t==null?void 0:t.url)!=null?E:or.geometryServiceUrl;let s,n,o,a,l,c,h,p,f=0;const m=[],y=[];for(const M of e)if(C(M))y.push(M);else if(s||(s=M.spatialReference,n=E1(s),o=s.isWebMercator,c=o?102100:4326,a=iD[c].maxX,l=iD[c].minX,h=iD[c].plus180Line,p=iD[c].minus180Line),n)if(M.type==="mesh")y.push(M);else if(M.type==="point")y.push(coe(M.clone(),a,l));else if(M.type==="multipoint"){const A=M.clone();A.points=A.points.map($=>coe($,a,l)),y.push(A)}else if(M.type==="extent"){const A=M.clone()._normalize(!1,!1,n);y.push(A.rings?new zh(A):A)}else if(M.extent){const A=M.extent,$=Dx(A.xmin,l)*(2*a);let I=$===0?M.clone():Oxe(M.clone(),$);A.offset($,0),A.intersects(h)&&A.xmax!==a?(f=A.xmax>f?A.xmax:f,I=loe(I,o),m.push(I),y.push("cut")):A.intersects(p)&&A.xmin!==l?(f=A.xmax*(2*a)>f?A.xmax*(2*a):f,I=loe(I,o,360),m.push(I),y.push("cut")):y.push(I)}else y.push(M.clone());else y.push(M);let _=Dx(f,a),b=-90;const w=_,T=new $h;for(;_>0;){const M=360*_-180;T.addPath([[M,b],[M,-1*b]]),b*=-1,_--}if(m.length>0&&w>0){const M=nWe(m,await Kqe(r,m,T,i)),A=[],$=[];for(let V=0;V<y.length;V++){const B=y[V];if(B!=="cut")$.push(B);else{const G=M.shift(),X=e[V];v(X)&&X.type==="polygon"&&X.rings&&X.rings.length>1&&G.rings.length>=X.rings.length?(A.push(G),$.push("simplify")):$.push(o?dg(G):G)}}if(!A.length)return $;const I=await eWe(r,A,i),k=[];for(let V=0;V<$.length;V++){const B=$[V];B!=="simplify"?k.push(B):k.push(o?dg(I.shift()):I.shift())}return k}const S=[];for(let M=0;M<y.length;M++){const A=y[M];if(A!=="cut")S.push(A);else{const $=m.shift();S.push(o===!0?dg($):$)}}return S}function Lxe(e){const t={};for(const i in e){if(i==="declaredClass")continue;const r=e[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){t[i]=[];for(let s=0;s<r.length;s++)t[i][s]=Lxe(r[s])}else typeof r=="object"?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}var Vv;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(Vv||(Vv={}));const uoe=4294967296,oWe=new TextDecoder("utf-8"),aWe=he("safari")||he("ios")?6:he("ff")?12:32;class Jx{constructor(t,i,r=0,s=t?t.byteLength:0){this._tag=0,this._dataType=Vv.unknown,this._init(t,i,r,s)}_init(t,i,r,s){this._data=t,this._dataView=i,this._pos=r,this._end=s}asUnsafe(){return this}clone(){return new Jx(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();if(t!==void 0)return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getUint32(i+4,!0)*uoe;return this._skip(8),r}getSFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getInt32(i+4,!0)*uoe;return this._skip(8),r}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+t);return this._skip(t),r}getBytes(){const t=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+t);return this._skip(t),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,i,r,s){const n=this.getMessage(),o=t(n,i,r,s);return n.release(),o}processMessage(t){const i=this.getMessage(),r=t(i);return i.release(),r}getMessage(){const t=this._getLength(),i=Jx.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}release(){Jx.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case Vv.varint:this._decodeVarint();break;case Vv.fixed64:this._skip(8);break;case Vv.delimited:this._skip(this._getLength());break;case Vv.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let i=this._pos,r=0,s=0;if(this._end-i>=10)do{if(s=t[i++],r|=127&s,(128&s)==0||(s=t[i++],r|=(127&s)<<7,(128&s)==0)||(s=t[i++],r|=(127&s)<<14,(128&s)==0)||(s=t[i++],r|=(127&s)<<21,(128&s)==0)||(s=t[i++],r+=268435456*(127&s),(128&s)==0)||(s=t[i++],r+=34359738368*(127&s),(128&s)==0)||(s=t[i++],r+=4398046511104*(127&s),(128&s)==0)||(s=t[i++],r+=562949953421312*(127&s),(128&s)==0)||(s=t[i++],r+=72057594037927940*(127&s),(128&s)==0)||(s=t[i++],r+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;i!==this._end&&(s=t[i],(128&s)!=0);)++i,r+=(127&s)*n,n*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=s*n}return this._pos=i,r}_decodeSVarint(){const t=this._data;let i=this._pos,r=0,s=0;const n=1&t[i];if(this._end-i>=10)do{if(s=t[i++],r|=127&s,(128&s)==0||(s=t[i++],r|=(127&s)<<7,(128&s)==0)||(s=t[i++],r|=(127&s)<<14,(128&s)==0)||(s=t[i++],r|=(127&s)<<21,(128&s)==0)||(s=t[i++],r+=268435456*(127&s),(128&s)==0)||(s=t[i++],r+=34359738368*(127&s),(128&s)==0)||(s=t[i++],r+=4398046511104*(127&s),(128&s)==0)||(s=t[i++],r+=562949953421312*(127&s),(128&s)==0)||(s=t[i++],r+=72057594037927940*(127&s),(128&s)==0)||(s=t[i++],r+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let o=1;for(;i!==this._end&&(s=t[i],(128&s)!=0);)++i,r+=(127&s)*o,o*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=s*o}return this._pos=i,n?-(r+1)/2:r/2}_getLength(){if(this._dataType!==Vv.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,i,r){if((r=Math.min(this._end,r))-i>aWe){const o=t.subarray(i,r);return oWe.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,i,r){return r=Math.min(this._end,r),new Uint8Array(t.buffer,i,r-i)}}Jx.pool=new ao(Jx,void 0,e=>{e._data=null,e._dataView=null});class Fc{constructor(t=[],i=[],r=!1){this.lengths=t!=null?t:[],this.coords=i!=null?i:[],this.hasIndeterminateRingOrder=r}static fromRect(t){const[i,r,s,n]=t,o=s-i,a=n-r;return new Fc([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,i)=>t+i)}forEachVertex(t){let i=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)t(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(t){return t?(t.set(this.coords),new Fc(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new Fc(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class Og{constructor(t=null,i={},r,s){this.geometry=t,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new Og(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function lWe(e){return!(C(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class dOt extends Og{}class qU{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new qU;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const Dxe=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class pOt{constructor(t){this._options=t,this.geometryTypes=Dxe,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new qU}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this._options.sourceSpatialReference||!t.spatialReference||kn(t.spatialReference,this._options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const i=aT(this._options.sourceSpatialReference)/aT(t.spatialReference);if(i!==1)for(const r of t.features){if(!lWe(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(t,i){t.features.push(i)}createFeature(){return new Og}createSpatialReference(){return{wkid:0}}createGeometry(){return new Fc}addField(t,i){t.fields.push(i)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,i){t.coords[this._coordinatePtr++]=i}addCoordinatePoint(t,i){t.coords.push(i)}addLength(t,i){t.lengths.push(i)}addQueryGeometry(t,i){t.queryGeometry=i.queryGeometry,t.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new Fc}}const hoe=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],doe=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],poe=["upperLeft","lowerLeft"];function foe(e){return e>=hoe.length?null:hoe[e]}function cWe(e){return e>=doe.length?null:doe[e]}function moe(e){return e>=poe.length?null:poe[e]}function goe(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function uWe(e,t,i){const s=e.asUnsafe(),n=t.createPointGeometry(i);for(;s.next();)switch(s.tag()){case 3:{const o=s.getUInt32(),a=s.pos()+o;let l=0;for(;s.pos()<a;)t.addCoordinatePoint(n,s.getSInt64(),l++);break}default:s.skip()}return n}function hWe(e,t,i){const n=e.asUnsafe(),o=t.createGeometry(i),a=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(;n.pos()<c;)t.addLength(o,n.getUInt32(),h++);break}case 3:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(t.allocateCoordinates(o);n.pos()<c;)t.addCoordinate(o,n.getSInt64(),h),h++,h===a&&(h=0);break}default:n.skip()}return o}function dWe(e){const s=e.asUnsafe(),n=new Fc;let o="esriGeometryPoint";for(;s.next();)switch(s.tag()){case 2:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.lengths.push(s.getUInt32());break}case 3:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.coords.push(s.getSInt64());break}case 1:o=Dxe[s.getEnum()];break;default:s.skip()}return{queryGeometry:n,queryGeometryType:o}}function pWe(e){const h=e.asUnsafe();for(;h.next();)switch(h.tag()){case 1:return h.getString();case 2:return h.getFloat();case 3:return h.getDouble();case 4:return h.getSInt32();case 5:return h.getUInt32();case 6:return h.getInt64();case 7:return h.getUInt64();case 8:return h.getSInt64();case 9:return h.getBool();default:return h.skip(),null}return null}function fWe(e){const a=e.asUnsafe(),l={type:foe(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=foe(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=cWe(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function mWe(e){const r={},s=e.asUnsafe();for(;s.next();)switch(s.tag()){case 1:r.name=s.getString();break;case 2:r.isSystemMaintained=s.getBool();break;default:s.skip()}return r}function gWe(e,t,i,r){const a=t.createFeature(i);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=r[l++].name;a.attributes[c]=e.processMessage(pWe);break}case 2:a.geometry=e.processMessageWithArgs(hWe,t,i);break;case 4:a.centroid=e.processMessageWithArgs(uWe,t,i);break;default:e.skip()}return a}function yWe(e){const n=[1,1,1,1],o=e.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function _We(e){const n=[0,0,0,0],o=e.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function vWe(e){const s={originPosition:moe(0)},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.originPosition=moe(n.getEnum());break;case 2:s.scale=n.processMessage(yWe);break;case 3:s.translate=n.processMessage(_We);break;default:n.skip()}return s}function bWe(e){const s={},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.shapeAreaFieldName=n.getString();break;case 2:s.shapeLengthFieldName=n.getString();break;case 3:s.units=n.getString();break;default:n.skip()}return s}function wWe(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function xWe(e,t){const _=t.createFeatureResult(),b=e.asUnsafe();_.geometryType=goe(t,0);let w=!1;for(;b.next();)switch(b.tag()){case 1:_.objectIdFieldName=b.getString();break;case 3:_.globalIdFieldName=b.getString();break;case 4:_.geohashFieldName=b.getString();break;case 5:_.geometryProperties=b.processMessage(bWe);break;case 7:_.geometryType=goe(t,b.getEnum());break;case 8:_.spatialReference=b.processMessageWithArgs(wWe,t);break;case 10:_.hasZ=b.getBool();break;case 11:_.hasM=b.getBool();break;case 12:_.transform=b.processMessage(vWe);break;case 9:{const T=b.getBool();_.exceededTransferLimit=T;break}case 13:t.addField(_,b.processMessage(fWe));break;case 15:w||(t.prepareFeatures(_),w=!0),t.addFeature(_,b.processMessageWithArgs(gWe,t,_,_.fields));break;case 2:_.uniqueIdField=b.processMessage(mWe);break;default:b.skip()}return t.finishFeatureResult(_),_}function TWe(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(dWe);break;case 1:s.featureResult=e.processMessageWithArgs(xWe,t);break;default:e.skip()}return v(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function SWe(e,t){try{const r=new Jx(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(TWe,t):r.skip();return s}catch(i){throw new H("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function EWe(e,t){const i=SWe(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}const yoe="Layer does not support extent calculation.";function CWe(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function AWe(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(v(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=JA(i),s.geometry=CWe(i,e.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=r.outSR.wkid||JSON.stringify(r.outSR),n=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(s.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&v(o)&&v(e.quantizationParameters)&&v(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c!=null?c:"null"},${h!=null?h:"null"}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&v(o)&&v(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function MWe(e,t,i,r){const s=v(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await I$(e,t,"json",r);return aq(t,i,s.data),s}async function fOt(e,t,i,r){if(v(t.timeExtent)&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await RWe(e,t,r),n=s;return n.data=EWe(s.data,i),n}function RWe(e,t,i){return I$(e,t,"pbf",i)}function mOt(e,t,i){return v(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):I$(e,t,"json",i,{returnIdsOnly:!0})}function gOt(e,t,i){return v(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):I$(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function yOt(e,t,i){return v(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):I$(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(yoe);if(s.hasOwnProperty("count"))throw new Error(yoe);return r})}function I$(e,t,i,r={},s={}){const n=typeof e=="string"?Ma(e):e,o=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",$xe(o,null,r).then(a=>{const l=a&&a[0];v(l)&&((t=t.clone()).geometry=l);const c=Lxe({...n.query,f:i,...s,...AWe(t,s)});return _r(pT(n.path,"query"),{...r,query:{...c,...r.query}})})}async function fB(e,t,i){const r=await OWe(e,t,i);return UJ.fromJSON(r)}async function OWe(e,t,i){const r=_M(e),s={...i},n=mg.from(t),{data:o}=await MWe(r,n,n.sourceSpatialReference,s);return o}function yl(e,t){return e?t?4:3:t?3:2}const P$=se.getLogger("esri.layers.graphics.featureConversionUtils"),Fxe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},IWe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},_oe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},PWe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},$We=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function ZK(e,t,i,r){if(e){if(i)return t&&r?$We:_oe;if(t&&r)return PWe}else if(t&&r)return _oe;return IWe}function mB({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function gB({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function yB({scale:e,translate:t},i,r){return i*e[r]+t[r]}function _Ot(e,t,i){return e?t?i?QK(e):JK(e):i?KK(e):WU(e):null}function WU(e){const t=e.coords;return{x:t[0],y:t[1]}}function Nxe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function JK(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function LWe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function KK(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function DWe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function QK(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function FWe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function NWe(e,t,i,r){let s=WU;i&&r?s=QK:i?s=JK:r&&(s=KK);for(const n of t){const{geometry:o,attributes:a}=n,l=v(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function eQ(e,t){return e&&t?FWe:e?LWe:t?DWe:Nxe}function kWe(e,t,i,r,s){const n=eQ(i,r);for(const{geometry:o,attributes:a}of t){const l=v(o)?n(new Fc,o):null;e.push(new Og(l,a,null,s?a[s]:void 0))}return e}function vOt(e,t,i=eQ(t.z!=null,t.m!=null)){return i(e,t)}function UWe(e,t,i,r){for(const{geometry:s,attributes:n}of t)e.push({attributes:n,geometry:v(s)?kxe(s,i,r):null});return e}function kxe(e,t,i){if(C(e))return null;const r=yl(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(e.coords[n+a]);s.push(o)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function VWe(e,t,i,r,s){const n=yl(i,r);for(const{geometry:o,attributes:a}of t){const l=v(o)?Uxe(new Fc,o,n):null;e.push(new Og(l,a,null,s?a[s]:void 0))}return e}function Uxe(e,t,i=yl(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let o=0;o<i;o++)r[s++]=n[o];return e}function BWe(e,t,i,r){for(const{geometry:s,attributes:n}of t)e.push({attributes:n,geometry:v(s)?Vxe(s,i,r):null});return e}function Vxe(e,t,i){if(!e)return null;const r=yl(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function zWe(e,t,i,r,s){const n=yl(i,r);for(const{geometry:o,attributes:a}of t){const l=v(o)?Bxe(new Fc,o,n):null;e.push(new Og(l,a,null,s?a[s]:void 0))}return e}function Bxe(e,t,i=yl(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return e}function GWe(e,t,i,r){for(const{geometry:s,attributes:n,centroid:o}of t){const a=v(s)?zxe(s,i,r):null;if(v(o)){const l=WU(o);e.push({attributes:n,centroid:l,geometry:a})}else e.push({attributes:n,geometry:a})}return e}function zxe(e,t,i){if(!e)return null;const r=yl(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function jWe(e,t,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of t){const l=v(n)?Gxe(new Fc,n,i,r):null,c=s?a[s]:void 0;v(o)?e.push(new Og(l,a,Nxe(new Fc,o),c)):e.push(new Og(l,a,null,c))}return e}function Gxe(e,t,i=t.hasZ,r=t.hasM){return HWe(e,t.rings,i,r),e}function HWe(e,t,i,r){const s=yl(i,r),{lengths:n,coords:o}=e;let a=0;y0(e);for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const yC=[],z3=[];function bOt(e,t,i,r,s){yC[0]=e;const[n]=jxe(z3,yC,t,i,r,s);return Vf(yC),Vf(z3),n}function jxe(e,t,i,r,s,n){if(Vf(e),!i){for(const o of t){const a=n?o.attributes[n]:void 0;e.push(new Og(null,o.attributes,null,a))}return e}switch(i){case"esriGeometryPoint":return kWe(e,t,r,s,n);case"esriGeometryMultipoint":return VWe(e,t,r,s,n);case"esriGeometryPolyline":return zWe(e,t,r,s,n);case"esriGeometryPolygon":return jWe(e,t,r,s,n);default:P$.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${i}'`)),Vf(e)}return e}function wOt(e,t,i,r){z3[0]=e,Hxe(yC,z3,t,i,r);const s=yC[0];return Vf(yC),Vf(z3),s}function qWe(e,t,i){if(C(e))return null;const r=new Fc;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&i==null&&(i=e.hasM),DZ(e)?eQ(t!=null?t:e.z!=null,i!=null?i:e.m!=null)(r,e):jx(e)?Gxe(r,e,t,i):FZ(e)?Bxe(r,e,yl(t,i)):LZ(e)?Uxe(r,e,yl(t,i)):void P$.error("convertFromGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${e}'`))}function WWe(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(C(s))return null;switch(t){case"esriGeometryPoint":{let n=WU;return i&&r?n=QK:i?n=JK:r&&(n=KK),n(s)}case"esriGeometryMultipoint":return kxe(s,i,r);case"esriGeometryPolyline":return Vxe(s,i,r);case"esriGeometryPolygon":return zxe(s,i,r);default:return P$.error("convertToGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${t}'`)),null}}function XWe(e,t){for(const i of t)e.push({attributes:i.attributes});return e}function Hxe(e,t,i,r,s){if(Vf(e),C(i))return XWe(e,t);switch(i){case"esriGeometryPoint":return NWe(e,t,r,s);case"esriGeometryMultipoint":return UWe(e,t,r,s);case"esriGeometryPolyline":return BWe(e,t,r,s);case"esriGeometryPolygon":return GWe(e,t,r,s);default:P$.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${i}'`))}return e}function xOt(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=e,m={features:Hxe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:h,queryGeometry:WWe(p,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function TOt(e,t){var f;const i=new qU,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(i.fields=p),i.geometryType=l!=null?l:null,i.objectIdFieldName=(f=o!=null?o:t)!=null?f:null,i.spatialReference=a!=null?a:null,i.objectIdFieldName?(n&&jxe(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(P$.error(new H("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function SOt(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)v(n.geometry)&&boe(n.geometry,n.geometry,r,s,t),v(n.centroid)&&boe(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function EOt(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new Fc,voe(l.geometry,a.geometry,s,n,i,e),a.centroid&&(l.centroid=new Fc,voe(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),r[o]=l}return t.transform=e,t}function voe(e,t,i,r,s,n,o=i,a=r){if(y0(e),C(t)||!t.coords.length)return null;const l=Fxe[s],{coords:c,lengths:h}=t,p=yl(i,r),f=yl(i&&o,r&&a),m=ZK(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,mB(n,c[0]),gB(n,c[1])),y0(e,p,0),e;let y,_,b,w,T=0,S=0,E=S;for(const M of h){if(M<l)continue;let A=0;S=E,b=y=mB(n,c[T]),w=_=gB(n,c[T+1]),m(e.coords,c,S,T,b,w),A++,T+=p,S+=f;for(let $=1;$<M;$++,T+=p)b=mB(n,c[T]),w=gB(n,c[T+1]),b===y&&w===_||(m(e.coords,c,S,T,b-y,w-_),S+=f,A++,y=b,_=w);A>=l&&(e.lengths.push(A),E=S)}return Vf(e.coords,E),e.coords.length?e:null}function COt(e,t,i,r,s,n,o=i,a=r){if(y0(e),!t||!t.coords.length)return null;const l=Fxe[s],{coords:c,lengths:h}=t,p=yl(i,r),f=yl(i&&o,r&&a),m=ZK(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,c[0],c[1]),y0(e,p,0),e;let y=0;const _=n*n;for(const b of h){if(b<l){y+=b*p;continue}const w=e.coords.length/f,T=y,S=y+(b-1)*p;m(e.coords,c,e.coords.length,T,c[T],c[T+1]),NW(e.coords,c,p,_,m,T,S),m(e.coords,c,e.coords.length,S,c[S],c[S+1]);const E=e.coords.length/f-w;E>=l?e.lengths.push(E):Vf(e.coords,w*f),y+=b*p}return e.coords.length?e:null}function YWe(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function NW(e,t,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=YWe(t,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&NW(e,t,i,r,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>i&&NW(e,t,i,r,s,c,o))}function AOt(e,t,i,r){if(C(t)||!t.coords||!t.coords.length)return null;const s=yl(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return $j(e)?GDe(e,n,o,a,l):YZ(n,o,a,l,e),e}function boe(e,t,i,r,s){var _,b,w,T,S,E,M,A;const{coords:n,lengths:o}=t,a=yl(i,r);if(!n.length)return e!==t&&y0(e),e;XT(s);const{originPosition:l,scale:c,translate:h}=s,p=JWe;p.originPosition=l;const f=p.scale;f[0]=(_=c[0])!=null?_:1,f[1]=-((b=c[1])!=null?b:1),f[2]=(w=c[2])!=null?w:1,f[3]=(T=c[3])!=null?T:1;const m=p.translate;if(m[0]=(S=h[0])!=null?S:0,m[1]=(E=h[1])!=null?E:0,m[2]=(M=h[2])!=null?M:0,m[3]=(A=h[3])!=null?A:0,!o.length){for(let $=0;$<a;++$)e.coords[$]=yB(p,n[$],$);return e!==t&&y0(e,a,0),e}let y=0;for(let $=0;$<o.length;$++){const I=o[$];e.lengths[$]=I;for(let B=0;B<a;++B)e.coords[y+B]=yB(p,n[y+B],B);let k=e.coords[y],V=e.coords[y+1];y+=a;for(let B=1;B<I;B++,y+=a){k+=n[y]*f[0],V+=n[y+1]*f[1],e.coords[y]=k,e.coords[y+1]=V;for(let G=2;G<a;++G)e.coords[y+G]=yB(p,n[y+G],G)}}return e!==t&&y0(e,n.length,o.length),e}function MOt(e,t,i,r,s,n){if(y0(e),e.lengths.push(...t.lengths),i===s&&r===n)for(let o=0;o<t.coords.length;o++)e.coords.push(t.coords[o]);else{const o=yl(i,r),a=ZK(i,r,s,n),l=t.coords;for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1])}return e}function ZWe(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const l=n+e[r*(t+a)],c=o+e[r*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function ROt(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=ZWe(i,s,a,t),s+=a}return Math.abs(n)}function OOt(e,t){if(C(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[t*n],c=r[t*n+1];for(let h=1;h<a;h++){const p=l+r[t*(n+h)],f=c+r[t*(n+h)+1];i.coords[t*(n+h)]=p,i.coords[t*(n+h)+1]=f,l=p,c=f}n+=a}return i}function y0(e,t=0,i=0){Vf(e.lengths,i),Vf(e.coords,t)}function Vf(e,t=0){e.length!==t&&(e.length=t)}const JWe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},KWe="esri.widgets.Feature.support.relatedFeatureUtils",woe=se.getLogger(KWe),xoe=new Map;function n4(e){if(!u0(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function QWe(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function eXe({originRelationship:e,relationships:t,layerId:i}){let r=null;return t&&t.some(s=>(`${s.relatedTableId}`===i&&s.id===(e==null?void 0:e.id)&&(r=s),!!r)),r}function tXe(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}function iXe(e,t){const i=QWe(e,t);if(!!i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function rXe(e,t){if(!t||!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}function sXe(e,t,i,r){var n,o;const s=new aA;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],(o=(n=i.queryRelatedFeatures)==null?void 0:n.call(i,s,r))!=null?o:Promise.resolve({})}function nXe(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function oXe(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t;if(!n||!o)return null;const p=eXe({originRelationship:o,relationships:n.relationships,layerId:s});if((p==null?void 0:p.relationshipTableId)&&p.keyFieldInRelationshipTable){const m=(await sXe(e,p,i,r))[e.attributes[i.objectIdField]];if(!m)return null;const y=m.features.map(_=>_.attributes[n.objectIdField]);if((l==null?void 0:l.length)&&n.supportsStatistics){const _=new mg;_.where=nXe(n.objectIdField,y,1e3),_.outFields=a,_.outStatistics=l,_.sourceSpatialReference=h;const b={features:Promise.resolve(m),statsFeatures:fB(c,_)};return Eo(b)}}const f=p==null?void 0:p.keyField;if(f){const m=U6(hXe(n.fields,f)),y=tXe(e.attributes,o.keyField),_=m?`${f}=${y}`:`${f}='${y}'`,b=fB(c,new mg({where:_,outFields:t.relatedFields,sourceSpatialReference:h}),r),w=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?fB(c,new mg({where:_,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),r):null,T={features:b};return w&&(T.statsFeatures=w),Eo(T)}return null}function aXe(e,t){return _r(e,{query:{f:"json"},signal:t&&t.signal})}function lXe({relatedInfos:e,layer:t},i){const r={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new H("relation-required","A relation is required on a layer to retrieve related records.");throw woe.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new H("A related table ID is required on a layer to retrieve related records.");throw woe.error(p),p}const l=`${t.url}/${a}`,c=xoe.get(l),h=c||aXe(l);c||xoe.set(l,h),r[n]=h}),yZ(Eo(r),i)}function cXe({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=oXe(e,n,i,r))}),Eo(s)}function uXe({relatedInfo:e,fieldName:t,fieldInfo:i}){var r,s;if((r=e.relatedFields)==null||r.push(t),i.statisticType){const n=new J_e({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});(s=e.outStatistics)==null||s.push(n)}}function hXe(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const Toe={chartAnimation:!0};let Do=class extends Te{constructor(e){super(e),this.abilities={...Toe},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Toe,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){var o,a,l,c,h;const{mediaInfos:e,layer:t}=this,i=(o=this.attributes)!=null?o:{},r=(a=this.formattedAttributes)!=null?a:{},s=(l=this.expressionAttributes)!=null?l:{},n=(c=this.fieldInfoMap)!=null?c:new Map;return(h=e==null?void 0:e.map(p=>{const f=p==null?void 0:p.clone();if(!f)return null;if(f.title=Lx({attributes:i,fieldInfoMap:n,globalAttributes:r,expressionAttributes:s,layer:t,text:f.title}),f.caption=Lx({attributes:i,fieldInfoMap:n,globalAttributes:r,expressionAttributes:s,layer:t,text:f.caption}),f.altText=Lx({attributes:i,fieldInfoMap:n,globalAttributes:r,expressionAttributes:s,layer:t,text:f.altText}),f.type==="image"){const{value:m}=f;return this._setImageValue({value:m,formattedAttributes:r,layer:t}),f.value.sourceURL?f:void 0}if(f.type==="pie-chart"||f.type==="line-chart"||f.type==="column-chart"||f.type==="bar-chart"){const{value:m}=f;return this._setChartValue({value:m,chartType:f.type,attributes:i,formattedAttributes:r,layer:t,expressionAttributes:s}),f}return null}).filter(v))!=null?h:[]}_setImageValue(e){var a;const t=(a=this.fieldInfoMap)!=null?a:new Map,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const l=PW(o,s);i.sourceURL=IW({formattedAttributes:r,template:l,fieldInfoMap:t})}if(n){const l=PW(n,s);i.linkURL=IW({formattedAttributes:r,template:l,fieldInfoMap:t})}}_setChartValue(e){var m;const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n,expressionAttributes:o}=e,{popupTemplate:a,relatedInfos:l}=this,{fields:c,normalizeField:h}=t,p=n;if(t.fields=_He(c,p),h&&(t.normalizeField=KI(h,p)),!c.some(y=>!!(r[y]!=null||u0(y)&&(l==null?void 0:l.size))))return;const f=(m=a==null?void 0:a.fieldInfos)!=null?m:[];c.forEach(y=>{if(u0(y))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:y,formattedAttributes:r,chartType:s,value:t})]);const _=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,expressionAttributes:o,fieldName:y,fieldInfos:f});t.series.push(_)})}_getRelatedChartInfos(e){var f;const{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n}=e,o=[],a=n4(i),l=a&&((f=this.relatedInfos)==null?void 0:f.get(a.layerId.toString()));if(!l)return o;const{relatedFeatures:c,relation:h}=l;if(!h||!c)return o;const{cardinality:p}=h;return c.forEach(m=>{const{attributes:y}=m;y&&Object.keys(y).forEach(_=>{_===a.fieldName&&o.push(this._getChartOption({value:n,attributes:y,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:_,hasMultipleRelatedFeatures:(c==null?void 0:c.length)>1,fieldInfos:t}))})}),p==="one-to-many"||p==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var M,A,$,I,k,V,B;const{value:t,attributes:i,formattedAttributes:r,expressionAttributes:s,fieldName:n,relatedFieldName:o,fieldInfos:a,chartType:l,hasMultipleRelatedFeatures:c}=e,h=this.layer,p=(M=this.fieldInfoMap)!=null?M:new Map,{normalizeField:f,tooltipField:m}=t,y=f?u0(f)?i[n4(f).fieldName]:i[f]:null,_=GK(n)&&s&&s[n]!==void 0?s[n]:o&&i[o]!==void 0?i[o]:i[n]!==void 0?i[n]:r[n],b=new cye({fieldName:n,value:_===void 0?null:_&&y?_/y:_});if(u0(n)){const G=p.get(n.toLowerCase()),X=m&&p.get(m.toLowerCase()),K=(A=G==null?void 0:G.fieldName)!=null?A:n,re=c&&m?n4(m).fieldName:($=X==null?void 0:X.fieldName)!=null?$:m,q=c&&re?i[re]:(V=(k=(I=r[re])!=null?I:G==null?void 0:G.label)!=null?k:G==null?void 0:G.fieldName)!=null?V:o,L=c&&o?i[o]:r[K];return b.tooltip=this._getTooltip({label:q,value:L,chartType:l}),b}const w=axe(a,n),T=KI(n,h),S=m&&r[m]!==void 0?r[m]:nxe(w||new h$({fieldName:T}),(B=this.popupTemplate)==null?void 0:B.expressionInfos),E=r[T];return b.tooltip=this._getTooltip({label:S,value:E,chartType:l}),b}};u([d()],Do.prototype,"abilities",void 0),u([Zt("abilities")],Do.prototype,"castAbilities",null),u([d()],Do.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],Do.prototype,"activeMediaInfo",null),u([d()],Do.prototype,"attributes",void 0),u([d()],Do.prototype,"description",void 0),u([d()],Do.prototype,"fieldInfoMap",void 0),u([d()],Do.prototype,"formattedAttributes",void 0),u([d()],Do.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],Do.prototype,"formattedMediaInfos",null),u([d()],Do.prototype,"isAggregate",void 0),u([d()],Do.prototype,"layer",void 0),u([d({readOnly:!0})],Do.prototype,"formattedMediaInfoCount",null),u([d()],Do.prototype,"mediaInfos",void 0),u([d()],Do.prototype,"popupTemplate",void 0),u([d()],Do.prototype,"relatedInfos",void 0),u([d()],Do.prototype,"title",void 0),Do=u([P("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Do);const Fx=Do;var Soe=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],dXe=[].concat(Soe.slice(30,39),Soe.slice(28,30).reverse()),pXe=[{name:"default",colors:dXe},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Eoe="en-us",tQ=new Map([["ar",()=>Q(()=>import("./ar.64bdae33.js"),["assets/ar.64bdae33.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.a)],["bg-bg",()=>Q(()=>import("./bg_BG.8070db04.js"),["assets/bg_BG.8070db04.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.b)],["bs-ba",()=>Q(()=>import("./bs_BA.e94fced0.js"),["assets/bs_BA.e94fced0.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.b)],["ca-es",()=>Q(()=>import("./ca_ES.fa1fb6d4.js"),["assets/ca_ES.fa1fb6d4.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.c)],["cs-cz",()=>Q(()=>import("./cs_CZ.26d7de29.js"),["assets/cs_CZ.26d7de29.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.c)],["da-dk",()=>Q(()=>import("./da_DK.120f7f3f.js"),["assets/da_DK.120f7f3f.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.d)],["de-de",()=>Q(()=>import("./de_DE.05454bea.js"),["assets/de_DE.05454bea.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.d)],["de-ch",()=>Q(()=>import("./de_CH.354b0f69.js"),["assets/de_CH.354b0f69.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.d)],["el-gr",()=>Q(()=>import("./el_GR.6e9d996c.js"),["assets/el_GR.6e9d996c.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["en-us",()=>Q(()=>import("./en_US.aa05200a.js"),["assets/en_US.aa05200a.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["en-ca",()=>Q(()=>import("./en_CA.ff5961af.js"),["assets/en_CA.ff5961af.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["es-es",()=>Q(()=>import("./es_ES.b6c9470c.js"),["assets/es_ES.b6c9470c.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["et-ee",()=>Q(()=>import("./et_EE.43d8819e.js"),["assets/et_EE.43d8819e.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["fi-fi",()=>Q(()=>import("./fi_FI.3aabcb85.js"),["assets/fi_FI.3aabcb85.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.f)],["fr-fr",()=>Q(()=>import("./fr_FR.8416be11.js"),["assets/fr_FR.8416be11.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.f)],["he-il",()=>Q(()=>import("./he_IL.e0d274e8.js"),["assets/he_IL.e0d274e8.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.h)],["hr-hr",()=>Q(()=>import("./hr_HR.d7fe48fb.js"),["assets/hr_HR.d7fe48fb.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.h)],["hu-hu",()=>Q(()=>import("./hu_HU.806bf1a2.js"),["assets/hu_HU.806bf1a2.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.h)],["id-id",()=>Q(()=>import("./id_ID.85c2ee17.js"),["assets/id_ID.85c2ee17.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.i)],["it-it",()=>Q(()=>import("./it_IT.b038d1ce.js"),["assets/it_IT.b038d1ce.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.i)],["ja-jp",()=>Q(()=>import("./ja_JP.f97218a7.js"),["assets/ja_JP.f97218a7.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.j)],["ko-kr",()=>Q(()=>import("./ko_KR.bf13fd77.js"),["assets/ko_KR.bf13fd77.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.k)],["lt-lt",()=>Q(()=>import("./lt_LT.6a79f2eb.js"),["assets/lt_LT.6a79f2eb.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.l)],["lv-lv",()=>Q(()=>import("./lv_LV.79bc32a5.js"),["assets/lv_LV.79bc32a5.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.l)],["nb-no",()=>Q(()=>import("./nb_NO.4305bd9b.js"),["assets/nb_NO.4305bd9b.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.n)],["nl-nl",()=>Q(()=>import("./nl_NL.f0879c32.js"),["assets/nl_NL.f0879c32.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.n)],["pl-pl",()=>Q(()=>import("./pl_PL.b8fb6a8c.js"),["assets/pl_PL.b8fb6a8c.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.p)],["pt-br",()=>Q(()=>import("./pt_BR.08b07c11.js"),["assets/pt_BR.08b07c11.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.p)],["pt-pt",()=>Q(()=>import("./pt_PT.d28f3862.js"),["assets/pt_PT.d28f3862.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.p)],["ro-ro",()=>Q(()=>import("./ro_RO.39f3d641.js"),["assets/ro_RO.39f3d641.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.r)],["ru-ru",()=>Q(()=>import("./ru_RU.d88da93b.js"),["assets/ru_RU.d88da93b.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.r)],["sk-sk",()=>Q(()=>import("./sk_SK.9da3725b.js"),["assets/sk_SK.9da3725b.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.s)],["sl-sl",()=>Q(()=>import("./sl_SL.f070a09a.js"),["assets/sl_SL.f070a09a.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.s)],["sr-rs",()=>Q(()=>import("./sr_RS.819b319a.js"),["assets/sr_RS.819b319a.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.s)],["sv-se",()=>Q(()=>import("./sv_SE.21930b6e.js"),["assets/sv_SE.21930b6e.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.s)],["th-th",()=>Q(()=>import("./th_TH.e79ffca7.js"),["assets/th_TH.e79ffca7.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.t)],["tr-tr",()=>Q(()=>import("./tr_TR.83778020.js"),["assets/tr_TR.83778020.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.t)],["uk-ua",()=>Q(()=>import("./uk_UA.349126cc.js"),["assets/uk_UA.349126cc.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.u)],["vi-vn",()=>Q(()=>import("./vi_VN.dfae26af.js"),["assets/vi_VN.dfae26af.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.v)],["zh-cn",()=>Q(()=>import("./zh_Hans.b2367cdd.js"),["assets/zh_Hans.b2367cdd.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.z)],["zh-hk",()=>Q(()=>import("./zh_Hant.8c4a1b8d.js"),["assets/zh_Hant.8c4a1b8d.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.z)],["zh-tw",()=>Q(()=>import("./zh_Hant.8c4a1b8d.js"),["assets/zh_Hant.8c4a1b8d.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.z)]]);function fXe(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of tQ.keys())if(r.startsWith(t)){i=r;break}return i}function mXe(e){return e?tQ.has(e.toLowerCase())?e.toLowerCase():fXe(e)||Eoe:Eoe}let xS=null,ZM=null;async function gXe(e=Xd()){if(e=mXe(e),xS&&e===ZM)return xS;xS=Q(()=>import("./index.9fddb7c2.js"),["assets/index.9fddb7c2.js","assets/_commonjsHelpers.4421ccc9.js"]).then(t=>t.i),ZM=e;try{const[t,i]=await Promise.all([xS,tQ.get(ZM)()]);ZM===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return xS=null,ZM=null,null}return xS}function yXe(e,t="default"){const i=pXe.find(r=>r.name===t);return i?i.colors.map(r=>e.color(r)):null}const rc="esri-feature-media",Un={base:rc,mediaContainer:`${rc}__container`,mediaItemContainer:`${rc}__item-container`,mediaItem:`${rc}__item`,mediaItemTitle:`${rc}__item-title`,mediaItemCaption:`${rc}__item-caption`,mediaPrevious:`${rc}__previous`,mediaPreviousIconLTR:`${rc}__previous-icon`,mediaPreviousIconRTL:`${rc}__previous-icon--rtl`,mediaNext:`${rc}__next`,mediaNextIconLTR:`${rc}__next-icon`,mediaNextIconRTL:`${rc}__next-icon--rtl`,mediaChart:`${rc}__chart`,mediaButton:`${rc}__button`,mediaIcon:`${rc}__icon`,iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},_B=.05,vB=.95,bB=15,Kg="color",x_="tooltip",JM="value",Coe="default-line-value";let ou=class extends pn{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new Fx,this.messages=null,this._getChartDependencies=async i=>{const r=await gXe(),{destroyed:s,viewModel:n}=this;if(s||!n||!i)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(r);this._renderChart({chartDiv:i,mediaInfo:o,chartsModule:r,colorMap:a})}}initialize(){this._featureElementInfo=new zU,this.addHandles([te(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),st),te(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),st)])}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return D("div",{bind:this,class:Un.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?D("div",{key:"media-element-container",class:Un.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=sxe(h!=null?h:void 0)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",m=n?t:null,y=m?m.timestamp:0,_=m?m.sourceURL:c,b=D("img",{alt:o||a,key:`media-${l}-${i}-${r}-${y}`,src:_!=null?_:void 0});return(h?D("a",{title:a,href:h,rel:f,target:p},b):null)||b}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return D("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:Un.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?D("div",{key:"media-title",class:Un.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?D("div",{key:"media-caption",class:Un.mediaItemCaption,innerHTML:e.caption}):null;return D("div",{key:"media-container",class:Un.mediaItemContainer},D("div",{key:"media-item-container",class:Un.mediaItem},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?this.classes(Un.mediaButton,Un.mediaPrevious):this.classes(Un.mediaButton,Un.mediaNext),s=t?this.classes(Un.mediaIcon,Un.mediaPreviousIconLTR,Un.iconLeftTriangleArrow):this.classes(Un.mediaIcon,Un.mediaNextIconLTR,Un.iconRightTriangleArrow),n=t?this.classes(Un.mediaIcon,Un.mediaPreviousIconRTL,Un.iconRightTriangleArrow):this.classes(Un.mediaIcon,Un.mediaNextIconRTL,Un.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return D("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:a},D("span",{"aria-hidden":"true",class:s}),D("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){var i;const{description:e,title:t}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:e,layer:t}=this.viewModel;return e&&(t==null?void 0:t.featureReduction)&&"renderer"in t.featureReduction?t.featureReduction.renderer:t==null?void 0:t.renderer}async _getRendererColors(e){const{am4core:t}=e,i=new Map,r=this._getRenderer(),s="default";if(!r)return i;const n=await Jqe(r);return n.delete(s),Array.from(n.values()).every(o=>(o==null?void 0:o.length)===1)&&(i.set(Coe,t.color({r:50,g:50,b:50,a:1})),Array.from(n.keys()).forEach(o=>{var a;o&&i.set(o,t.color((a=n.get(o))==null?void 0:a[0].toCss(!0)))})),i}_handleMediaKeyup(e){const t=Pc(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=i,c=yXe(l);function h(m){m instanceof l.ColorSet&&c&&(m.list=c)}ok()&&l.useTheme(i.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(i.am4themes_animated):l.unuseTheme(i.am4themes_animated),l.useTheme(h);const f=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),f.data=o.series.map(m=>({[x_]:m.tooltip,[JM]:m.value,[Kg]:n.get(m.fieldName)})).filter(m=>a!=="pie-chart"||m.value!=null&&m.value>0)}_customizeChartTooltip(e,t){e&&(e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7}))}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=og(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=JM,o.dataFields.category=x_,this._customizeChartTooltip(o.tooltip,r),o.slices.template.propertyFields.fill=Kg,o.slices.template.propertyFields.stroke=Kg,n}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=x_,a.renderer.labels.template.disabled=!0;const l=a.tooltip;this._customizeChartTooltip(l,n),l.events.on("sizechanged",()=>{l.dy=-l.contentHeight});const c=e.yAxes.push(new o.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=_B,c.renderer.maxLabelPosition=vB,c.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(c.tooltip,n),h.wrap=!0;const p=e.series.push(new o.ColumnSeries);p.dataFields.valueY=JM,p.dataFields.categoryX=x_,p.columns.template.propertyFields.fill=Kg,p.columns.template.propertyFields.stroke=Kg,e.cursor=new o.XYCursor,s.series.length>bB&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=x_,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0;const l=a.tooltip;this._customizeChartTooltip(l,n),l.events.on("sizechanged",()=>{l.dx=l.contentWidth});const c=e.xAxes.push(new o.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=_B,c.renderer.maxLabelPosition=vB,c.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(c.tooltip,n),h.wrap=!0;const p=e.series.push(new o.ColumnSeries);p.dataFields.valueX=JM,p.dataFields.categoryY=x_,p.columns.template.propertyFields.fill=Kg,p.columns.template.propertyFields.stroke=Kg,e.cursor=new o.XYCursor,s.series.length>bB&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r,colorMap:s}=t,{value:n}=r,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=x_,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const h=e.yAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=_B,h.renderer.maxLabelPosition=vB,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const f=e.series.push(new a.LineSeries);f.dataFields.categoryX=x_,f.dataFields.valueY=JM,f.strokeWidth=1;const m=s.get(Coe);m&&(f.stroke=m);const y=f.bullets.push(new a.CircleBullet);y.propertyFields.fill=Kg,y.propertyFields.stroke=Kg,e.cursor=new a.XYCursor,n.series.length>bB&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=og(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};u([d()],ou.prototype,"attributes",null),u([d()],ou.prototype,"activeMediaInfoIndex",null),u([d()],ou.prototype,"description",null),u([d()],ou.prototype,"fieldInfoMap",null),u([d()],ou.prototype,"layer",null),u([d()],ou.prototype,"mediaInfos",null),u([d()],ou.prototype,"popupTemplate",null),u([d()],ou.prototype,"relatedInfos",null),u([d()],ou.prototype,"title",null),u([d({type:Fx})],ou.prototype,"viewModel",void 0),u([d(),Es("esri/widgets/Feature/t9n/Feature")],ou.prototype,"messages",void 0),ou=u([P("esri.widgets.Feature.FeatureMedia")],ou);const qxe=ou,_Xe=["$datastore","$map","$layer","$aggregatedfeatures"],vXe="esri.widgets.Feature.support.arcadeFeatureUtils",bXe=se.getLogger(vXe);function wXe(e){return typeof e=="string"?R$(HK(e)):Array.isArray(e)?xXe(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?TXe(e):e}function xXe(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?R$(HK(t)):t}</li>`).join("")}</ul>`}function TXe(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?R$(HK(i)):i}</td></tr>`}).join("")}</table>`}function SXe({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h=s.sr,p={map:n,spatialReference:h,interceptor:a};if(c==="$map"&&(r.vars[c]=t.convertMapToFeatureSetCollection(p)),c==="$layer"&&(r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:h,interceptor:a})),c==="$datastore"&&(r.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:h,interceptor:a})),c==="$aggregatedfeatures"){const f=o.layer,{fields:m,objectIdField:y,geometryType:_,spatialReference:b,displayField:w}=f,T=new N3({fields:m,objectIdField:y,geometryType:_,spatialReference:b,displayField:w,...f.type==="feature"?{templates:f.templates,typeIdField:f.typeIdField,types:f.types}:null,source:e});r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:T,spatialReference:b,interceptor:a})}})}function Wxe(){return Q(()=>import("./arcadeUtils.9a01b817.js").then(function(e){return e.ax}),["assets/arcadeUtils.9a01b817.js","assets/arcadeTimeUtils.68d88c0e.js","assets/executionError.c4c51b90.js","assets/number.96c248f8.js","assets/hash.079e8d2d.js"])}function EXe(e){return"createQuery"in e&&"queryFeatures"in e}async function CXe({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(r);if(!EXe(s))return[];const n=s.createQuery(),o=e.getObjectId();n.aggregateIds=o!=null?[o]:[];const{features:a}=await s.queryFeatures(n);return a}async function Xxe({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=_Xe.filter(m=>t.hasVariable(a,m)),[c]=await Promise.all([CXe({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:r}),p=t.createExecContext(n,h);p.interceptor=i,p.useAsync=!0,SXe({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:i});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(m=>bXe.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:e}))}async function AXe({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const o=await Wxe(),a={};for(const h of e)a[`expression/${h.name}`]=Xxe({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const l=await Eo(a),c={};for(const h in l)c[h]=wXe(l[h].value);return c}const MXe=1;let th=class extends jf(Te){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var r,s;const t=(r=this.contentElement)==null?void 0:r.type;(s=this.contentElementViewModel)==null||s.destroy();const i=t==="fields"?new GU:t==="media"?new Fx:t==="text"?new nk:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=mC(this._compile,MXe,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&i&&s&&n))return void this._set("contentElement",null);const l=await Wxe();if(a!==this._abortController)return;const c=await Xxe({arcadeUtils:l,expressionInfo:t,graphic:i,interceptor:r,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await c.castAsJsonAsync(a==null?void 0:a.signal),p=h==null?void 0:h.type,f=p==="media"?$I.fromJSON(h):p==="text"?ZC.fromJSON(h):p==="fields"?YC.fromJSON(h):null;this._set("contentElement",f)},this.handles.add([te(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),st),te(()=>[this.contentElement],()=>this._createVM(),st)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.spatialReference)!=null?t:null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e,t;return(t=(e=this.view)==null?void 0:e.map)!=null?t:null}set map(e){this._override("map",e)}};u([d()],th.prototype,"_abortController",void 0),u([d({type:sye})],th.prototype,"expressionInfo",void 0),u([d({type:Ko})],th.prototype,"graphic",void 0),u([d({readOnly:!0})],th.prototype,"contentElement",void 0),u([d({readOnly:!0})],th.prototype,"contentElementViewModel",void 0),u([d()],th.prototype,"interceptor",void 0),u([d()],th.prototype,"spatialReference",null),u([d({readOnly:!0})],th.prototype,"state",null),u([d()],th.prototype,"map",null),u([d()],th.prototype,"view",void 0),th=u([P("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],th);const iQ=th,rD={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let o4=class extends pn{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new iQ}initialize(){this.addHandles(te(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),st))}destroy(){this._destroyContentWidget()}renderLoading(){return D("div",{key:"loading-container",class:rD.loadingSpinnerContainer},D("span",{class:this.classes(rD.iconLoading,rD.spinner)}))}render(){var t;const{state:e}=this.viewModel;return D("div",{class:rD.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const r=e?i==="fields"?new yxe({viewModel:e}):i==="media"?new qxe({viewModel:e}):i==="text"?new s4({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};u([d({type:iQ})],o4.prototype,"viewModel",void 0),o4=u([P("esri.widgets.Feature.FeatureExpression")],o4);const RXe=o4,wB=100;let _s=class extends Ys(G0(jf(Te))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const t=new AbortController;this._queryAbortController=t,await rC(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const t=new AbortController;this._queryFeatureCountAbortController=t,await rC(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const t=new AbortController;this._queryPageAbortController=t,await rC(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)},this._queryThrottled=mC(this._queryController,wB,this),this._queryFeatureCountThrottled=mC(this._queryFeatureCountController,wB,this),this._queryPageThrottled=mC(this._queryPageController,wB,this),this._query=async()=>{const{_queryAbortController:t,relatedFeatures:i}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.removeAll(),i.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:t==null?void 0:t.signal})))},this.handles.add([te(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),st),te(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),te(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:i}=this,r=1,s=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,r),s))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&(t==null?void 0:t.loaded)?e.map(i=>{const r=i.clone(),s=KI(i.field,t);return r.field=s,r}):e!=null?e:[]}get supportsCacheHint(){var e,t,i;return!!((i=(t=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:t.queryRelated)!=null&&i.supportsCacheHint)}get canQuery(){var t,i;const e=(i=(t=this.layer)==null?void 0:t.capabilities)==null?void 0:i.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e==null?void 0:e.supportsCount)&&(e==null?void 0:e.supportsPagination))}get itemDescriptionFieldName(){var e,t;return((t=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:t.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,t,i;return(i=this.objectIdField&&((t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.objectIdField]))!=null?i:null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new Qe}get relatedLayer(){var r;const{layer:e,map:t,relationship:i}=this;return(e==null?void 0:e.loaded)&&t&&i&&(r=NHe(t,e,i))!=null?r:null}get relationship(){var i,r;const{relationshipId:e,layer:t}=this;return typeof e=="number"&&(r=(i=t==null?void 0:t.relationships)==null?void 0:i.find(({id:s})=>s===e))!=null?r:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new Qe}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:r}=this;return t?"loading":e||i?"querying":r?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(t=>!t.destroyed&&t.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:t,relationshipId:i,objectId:r,_queryFeatureCountAbortController:s,canQuery:n,supportsCacheHint:o}=this;if(await(e==null?void 0:e.load()),await(t==null?void 0:t.load()),!n||!e||!t)return void this._set("featureCount",0);const a=t.createQuery(),l=new aA({cacheHint:o,relationshipId:i,returnGeometry:!1,objectIds:[r],where:Wte(a.where,void 0)}),c=await e.queryRelatedFeaturesCount(l,{signal:s==null?void 0:s.signal});this._set("featureCount",c[r]||0)}_sliceFeatures(e){const{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}async _queryPage(){const{relatedFeatures:e,featurePage:t,showAllEnabled:i,_queryPageAbortController:r}=this;!i||t<2||e.addMany(await this._queryRelatedFeatures({signal:r==null?void 0:r.signal}))}async _queryRelatedFeatures(e){var M;const{orderByFieldsFixedCasing:t,showAllEnabled:i,featuresPerPage:r,displayCount:s,layer:n,relationshipId:o,featurePage:a,featureCount:l,relatedLayer:c,supportsCacheHint:h}=this,{canQuery:p,objectId:f}=this;if(!p||!n||!c)return[];const m=i?((a-1)*r+l)%l:0,y=i?r:s,_=c.objectIdField,b=[...t==null?void 0:t.map(A=>A.field),_].filter(v),w=t==null?void 0:t.map(A=>`${A.field} ${A.order}`),T=c.createQuery(),S=new aA({orderByFields:w,start:m,num:y,outFields:b,cacheHint:h,relationshipId:o,returnGeometry:!1,objectIds:[f],where:Wte(T.where,void 0)}),E=((M=(await n.queryRelatedFeatures(S,{signal:e==null?void 0:e.signal}))[f])==null?void 0:M.features)||[];return E.forEach(A=>{A.sourceLayer=c,A.layer=c}),E}};u([d()],_s.prototype,"_queryAbortController",void 0),u([d()],_s.prototype,"_queryPageAbortController",void 0),u([d()],_s.prototype,"_queryFeatureCountAbortController",void 0),u([d({value:1})],_s.prototype,"featurePage",null),u([d()],_s.prototype,"featuresPerPage",void 0),u([d({readOnly:!0})],_s.prototype,"orderByFieldsFixedCasing",null),u([d({readOnly:!0})],_s.prototype,"supportsCacheHint",null),u([d({readOnly:!0})],_s.prototype,"canQuery",null),u([d()],_s.prototype,"description",void 0),u([d({readOnly:!0})],_s.prototype,"itemDescriptionFieldName",null),u([d({value:3})],_s.prototype,"displayCount",null),u([d({type:Ko})],_s.prototype,"graphic",void 0),u([d()],_s.prototype,"layer",void 0),u([d()],_s.prototype,"map",void 0),u([d({readOnly:!0})],_s.prototype,"objectId",null),u([d({readOnly:!0})],_s.prototype,"objectIdField",null),u([d()],_s.prototype,"orderByFields",void 0),u([d({readOnly:!0})],_s.prototype,"relatedFeatures",null),u([d({readOnly:!0})],_s.prototype,"relatedLayer",null),u([d({readOnly:!0})],_s.prototype,"relationship",null),u([d()],_s.prototype,"featureCount",void 0),u([d({readOnly:!0})],_s.prototype,"relatedFeatureViewModels",null),u([d()],_s.prototype,"relationshipId",void 0),u([d()],_s.prototype,"showAllEnabled",void 0),u([d()],_s.prototype,"state",null),u([d()],_s.prototype,"title",void 0),_s=u([P("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],_s);const rQ=_s,DO="esri-feature",xB=`${DO}-relationship`,Qg={base:xB,esriWidget:"esri-widget",listContainer:`${xB}__list`,listContainerQuerying:`${xB}__list--querying`,featureObserver:`${DO}__feature-observer`,stickySpinnerContainer:`${DO}__sticky-loading-container`,loadingSpinnerContainer:`${DO}__loading-container`,spinner:`${DO}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},Aoe={title:!0,description:!0};let gc=class extends pn{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i!=null&&i.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new rQ,this.messages=null,this.messagesCommon=null,this.visibleElements={...Aoe},this._increaseFeaturePage=()=>{const{state:i,showAllEnabled:r,relatedFeatures:s,featuresPerPage:n,featurePage:o}=this.viewModel;i==="ready"&&r&&s.length>=n*o&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new zU,this.addHandles([te(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),st),te(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Fs(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-list.14d63146.js"),["assets/calcite-list.14d63146.js","assets/interactive.5b40332c.js","assets/observers.0143061c.js","assets/utils3.a96d14d4.js","assets/loadable.f81dc576.js","assets/debounce.aad9914a.js","assets/t9n.6be6d1c5.js","assets/icon.2acbc95d.js","assets/loader.5c70f655.js","assets/guid.ba2965fd.js","assets/scrim.a5ee631c.js"]),Q(()=>import("./calcite-list-item.5385296b.js"),["assets/calcite-list-item.5385296b.js","assets/interactive.5b40332c.js","assets/utils3.a96d14d4.js","assets/loadable.f81dc576.js","assets/icon.2acbc95d.js","assets/observers.0143061c.js"]),Q(()=>import("./calcite-icon.cd430452.js"),["assets/calcite-icon.cd430452.js","assets/icon.2acbc95d.js","assets/observers.0143061c.js"]),Q(()=>import("./calcite-notice.db25d590.js"),["assets/calcite-notice.db25d590.js","assets/observers.0143061c.js","assets/loadable.f81dc576.js","assets/t9n.6be6d1c5.js","assets/icon.2acbc95d.js"])])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Be(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:i}=this.viewModel;return!e&&!!t&&(t>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:t}=this.viewModel;return gh(t===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...Aoe,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?D("div",{key:"sticky-loader",class:Qg.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return D("span",{class:this.classes(Qg.iconLoading,Qg.spinner)})}renderLoading(){return D("div",{key:"loading-container",class:Qg.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return D("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=og(this.container)?"chevron-left":"chevron-right";return D("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var s,n,o;const{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&((s=e.formattedAttributes)==null?void 0:s.global[t]);const r=e.state==="loading";return D("calcite-list-item",{key:e.uid,label:r?`${(n=this.messagesCommon)==null?void 0:n.loading}\u2026`:i,description:r?"\u2026":(o=e.description)!=null?o:"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?D("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return D("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},D("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return D("div",{key:"feature-observer",class:Qg.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return D("calcite-list",null,e.toArray().map(t=>this.renderRelatedFeature(t)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this.viewModel;return D("div",{key:"list-container",class:this.classes(Qg.listContainer,{[Qg.listContainerQuerying]:t==="querying"})},e?this.renderList():t==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return D("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},D("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var t;const{state:e}=this.viewModel;return D("div",{class:this.classes(Qg.base,Qg.esriWidget)},(t=this._featureElementInfo)==null?void 0:t.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e==null||e.forEach(i=>{this.addHandles(te(()=>[i.title,i.state],()=>this.scheduleRender(),st),t)}),this.scheduleRender()}_setupFeatureElementInfo(){var s;const{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,r=t.title&&this.title;(s=this._featureElementInfo)==null||s.set({description:i,title:r,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this.viewModel;await M0(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};u([d()],gc.prototype,"_relatedFeatureIntersectionObserverNode",void 0),u([d({readOnly:!0})],gc.prototype,"displayShowAllButton",null),u([d({readOnly:!0})],gc.prototype,"displayListItems",null),u([d()],gc.prototype,"description",null),u([d({readOnly:!0})],gc.prototype,"featureCountDescription",null),u([d()],gc.prototype,"headingLevel",void 0),u([d()],gc.prototype,"title",null),u([d({type:rQ})],gc.prototype,"viewModel",void 0),u([d(),Es("esri/widgets/Feature/t9n/Feature")],gc.prototype,"messages",void 0),u([d(),Es("esri/t9n/common")],gc.prototype,"messagesCommon",void 0),u([d()],gc.prototype,"visibleElements",void 0),u([Zt("visibleElements")],gc.prototype,"castVisibleElements",null),gc=u([P("esri.widgets.Feature.FeatureRelationship")],gc);const Moe=gc;class OXe{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}}var FO;const IXe=1,Roe="content-view-models",Ooe="relationship-view-models",Ioe={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let sn=FO=class extends G0(Te){constructor(e){super(e),this._handles=new Ii,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=mC(this._graphicChanged,IXe,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Ioe},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent},this._handles.add(te(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),st))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return v(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return OHe(Zne(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return rxe(this.graphic)}castAbilities(e){return{...Ioe,...e}}get isTable(){var e;return((e=this._sourceLayer)==null?void 0:e.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.spatialReference)!=null?t:null}set spatialReference(e){this._override("spatialReference",e)}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof Fx&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Fx&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Fx&&t.previous()}async updateGeometry(){var o,a;const{graphic:e,spatialReference:t,_sourceLayer:i}=this;await(i==null?void 0:i.load());const r=i==null?void 0:i.objectIdField;if(!r||!e||!i)return;const s=(o=e==null?void 0:e.attributes)==null?void 0:o[r];if(s==null)return;const n=[s];if(!e.geometry){const l=(a=await cxe({layer:i,graphic:e,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:t}))==null?void 0:a.geometry;l&&(e.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){Ws(i)||(this._error=i,se.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(v):typeof e=="string"?this._compileText(new ZC({text:e}),0).text:e}_destroyContentViewModels(){var e,t;(e=this._handles)==null||e.remove(Ooe),(t=this._handles)==null||t.remove(Roe),this.contentViewModels.forEach(i=>i&&!i.destroyed&&i.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){var s;const i=(s=e==null?void 0:e.graphic)==null?void 0:s.getObjectId(),r=t==null?void 0:t.getObjectId();return v(i)&&v(r)&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){const{view:r,spatialReference:s}=this;t==null||t.filter(Boolean).forEach(n=>{e.find(o=>this._matchesFeature(o,n))||e.add(new FO({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:s,graphic:n}))}),e.forEach(n=>{(t==null?void 0:t.find(a=>this._matchesFeature(n,a)))||e.remove(n)})}_setExpressionContentVM(e,t){const i=this.formattedAttributes,{contentElement:r,contentElementViewModel:s}=e,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileRelationship(e,t){const{displayCount:i,orderByFields:r,relationshipId:s,title:n,description:o}=e,{_sourceLayer:a,graphic:l,map:c}=this,h=new rQ({displayCount:i,graphic:l,orderByFields:r,relationshipId:s,layer:a,map:c,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[t]=h,this._handles.add(Fs(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),Ooe),e}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new iQ({expressionInfo:i,graphic:r,interceptor:FO.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(te(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),st),Roe),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new WK({graphic:i,...this._compileTitleAndDesc({title:s,description:r})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new nk({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n}=this,o=s==null?void 0:s.attributes,a=this._expressionAttributes,l=n.global;return{title:Lx({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:e}),description:Lx({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:t})}}_createFieldsVMParams(e,t){var c;const i=this._effectivePopupTemplate,r=this.formattedAttributes,s={...r==null?void 0:r.global,...r==null?void 0:r.content[t]},n=(c=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>GK(h)||u0(h)||s.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=e;return{attributes:s,expressionInfos:o,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(e,t){const i=e.clone(),r=new GU(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){var y;const{abilities:i,graphic:r,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,h=(y=r==null?void 0:r.attributes)!=null?y:{},{description:p,mediaInfos:f,title:m}=e;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,isAggregate:r==null?void 0:r.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[t]},expressionAttributes:l,mediaInfos:f,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:m,description:p})}}_compileMedia(e,t){const i=e.clone(),r=new Fx(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){var n,o,a;const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const l=(n=t==null?void 0:t.attributes)!=null?n:{},c=(a=(o=this.formattedAttributes)==null?void 0:o.global)!=null?a:{};e.text=Lx({attributes:l,fieldInfoMap:i,globalAttributes:c,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new nk(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t==null?void 0:t.editFieldsInfo;return r&&s?RHe(s,i==null?void 0:i.attributes):void 0}_compileTitle(e){var a,l,c;const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,n=(a=r==null?void 0:r.attributes)!=null?a:{},o=(c=(l=this.formattedAttributes)==null?void 0:l.global)!=null?c:{};return Lx({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;if(!t)return null;const i=e==null?void 0:e.title;return sk(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;if(!t)return null;const i=e==null?void 0:e.content;return sk(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s}=this,n=this.map,o=this.view,a=this.spatialReference;if(t!==this._featureAbortController||!r)return;await PHe({graphic:r,popupTemplate:s,layer:i,spatialReference:a},e);const{content:{value:l},title:{value:c}}=await Eo({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=await Eo({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:AXe({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:a,graphic:r,map:n,interceptor:FO.interceptor,view:o})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...r.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=oB({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:{...l,...e.attributes},layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[t]=oB({fieldInfos:e.fieldInfos,graphic:r,attributes:{...a,...e.attributes},layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:oB({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,Zne(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=v(s==null?void 0:s.associatedLayer)?await(s==null?void 0:s.associatedLayer.load(i)):s;if(!n||!e)return;const o=t.filter(c=>c&&u0(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await lXe({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const h=r.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await cXe({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;rXe((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=n4(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||iXe(s,t);o&&(uXe({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};sn.interceptor=new OXe(DHe,FHe),u([d()],sn.prototype,"_error",void 0),u([d()],sn.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],sn.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],sn.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],sn.prototype,"_sourceLayer",null),u([d()],sn.prototype,"abilities",void 0),u([Zt("abilities")],sn.prototype,"castAbilities",null),u([d({readOnly:!0})],sn.prototype,"content",void 0),u([d({readOnly:!0})],sn.prototype,"contentViewModels",void 0),u([d()],sn.prototype,"description",void 0),u([d({type:Boolean})],sn.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],sn.prototype,"isTable",null),u([d({readOnly:!0})],sn.prototype,"state",null),u([d({readOnly:!0})],sn.prototype,"formattedAttributes",void 0),u([d({type:Ko,value:null})],sn.prototype,"graphic",null),u([d({readOnly:!0})],sn.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],sn.prototype,"relatedInfos",void 0),u([d()],sn.prototype,"spatialReference",null),u([d({readOnly:!0})],sn.prototype,"title",void 0),u([d()],sn.prototype,"map",null),u([d({readOnly:!0})],sn.prototype,"waitingForContent",null),u([d()],sn.prototype,"view",void 0),sn=FO=u([P("esri.widgets.FeatureViewModel")],sn);const sQ=sn,Za="esri-feature",Dn={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:Za,container:`${Za}__size-container`,title:`${Za}__title`,main:`${Za}__main-container`,btn:`${Za}__button`,icon:`${Za}__icon`,content:`${Za}__content`,contentNode:`${Za}__content-node`,contentElement:`${Za}__content-element`,text:`${Za}__text`,lastEditedInfo:`${Za}__last-edited-info`,fields:`${Za}__fields`,fieldHeader:`${Za}__field-header`,fieldData:`${Za}__field-data`,fieldDataDate:`${Za}__field-data--date`,loadingSpinnerContainer:`${Za}__loading-container`,spinner:`${Za}__loading-spinner`},Yxe=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>mA(i)&&!i.destroyed?D("div",{class:Dn.contentNode,key:i},i.render()):i instanceof HTMLElement?D("div",{class:Dn.contentNode,key:i,bind:i,afterCreate:this._attachToNode}):gxe(i)?D("div",{class:Dn.contentNode,key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return t=u([P("esri.widgets.Feature.ContentMixin")],t),t};var kW;const Poe={title:!0,content:!0,lastEditedInfo:!0},$oe="relationship-handles";let ha=kW=class extends Yxe(pn){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...Poe},this.viewModel=new sQ}initialize(){this.addHandles(te(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),st))}loadDependencies(){return Q(()=>import("./calcite-notice.db25d590.js"),["assets/calcite-notice.db25d590.js","assets/observers.0143061c.js","assets/loadable.f81dc576.js","assets/t9n.6be6d1c5.js","assets/icon.2acbc95d.js"])}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...Poe,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{state:e}=this.viewModel,t=D("div",{class:Dn.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return D("div",{class:this.classes(Dn.base,Dn.esriWidget)},t)}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return D("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},i.title?D("div",{key:"error-title",slot:"title"},e.errorMessage):null,D("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return D("div",{key:"loading-container",class:Dn.loadingSpinnerContainer},D("span",{class:this.classes(Dn.iconLoading,Dn.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?D("div",{class:Dn.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?D(BU,{level:this.headingLevel,class:Dn.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?D("div",{class:Dn.contentNode,key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:D("div",{class:Dn.contentNode,key:`${t}-content`},i.render())}return this.renderNodeContent(e)}renderContentElement(e,t){var r;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((r=i.content)!=null&&r[e.type]))return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);case"relationship":return this.renderRelationship(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?D("div",{key:this._buildKey("attachments-element",e),class:this.classes(Dn.contentElement)},t.render()):null}renderRelationship(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?D("div",{key:this._buildKey("relationship-element",e),class:Dn.contentElement},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:D("div",{key:this._buildKey("expression-element",e),class:Dn.contentElement},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?D("div",{key:this._buildKey("custom-element",t),class:Dn.contentElement},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:D("div",{key:this._buildKey("fields-element",e),class:Dn.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:D("div",{key:this._buildKey("media-element",e),class:Dn.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=gh(n,{date:r,user:s});return D("div",{key:"edit-info-element",class:this.classes(Dn.lastEditedInfo,Dn.contentElement)},o)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?D("div",{key:this._buildKey("text-element",t),class:this.classes(Dn.contentElement,Dn.text)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles($oe),this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){const{flowItems:t,visibleElements:i}=this;this.addHandles([Fs(()=>e,"select-record",({featureViewModel:r})=>{t&&(r.abilities={relationshipContent:!0},t.push(new kW({flowItems:t,viewModel:r,visibleElements:i})))}),Fs(()=>e,"show-all-records",()=>{if(!t)return;const{viewModel:r}=e;r.showAllEnabled=!0;const s=new Moe({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(s),t.push(s)})],$oe)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{if(s.type==="attachments"&&(this._contentWidgets[n]=new jHe({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new yxe({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new qxe({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new s4({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new s4({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new RXe({viewModel:r[n]})),s.type==="relationship"){const o=new Moe({viewModel:r[n]});this._addFeatureRelationshipHandles(o),this._contentWidgets[n]=o}},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new s4({viewModel:s}))}this.scheduleRender()}};u([d()],ha.prototype,"graphic",null),u([d()],ha.prototype,"defaultPopupTemplateEnabled",null),u([d()],ha.prototype,"flowItems",void 0),u([d()],ha.prototype,"headingLevel",void 0),u([d({readOnly:!0})],ha.prototype,"isTable",null),u([d()],ha.prototype,"label",null),u([d(),Es("esri/widgets/Feature/t9n/Feature")],ha.prototype,"messages",void 0),u([d(),Es("esri/t9n/common")],ha.prototype,"messagesCommon",void 0),u([d(),Es("esri/widgets/support/t9n/uriUtils")],ha.prototype,"messagesURIUtils",void 0),u([d()],ha.prototype,"spatialReference",null),u([d({readOnly:!0})],ha.prototype,"title",null),u([d()],ha.prototype,"visibleElements",void 0),u([Zt("visibleElements")],ha.prototype,"castVisibleElements",null),u([d()],ha.prototype,"map",null),u([d()],ha.prototype,"view",null),u([d({type:sQ})],ha.prototype,"viewModel",void 0),ha=kW=u([P("esri.widgets.Feature")],ha);const PXe=ha;var Zxe;const a4=Symbol("anchorHandles");let jw=class extends ps.EventedAccessor{constructor(e){super(e),this[Zxe]=new Ii,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[a4].add([Qo(()=>Mn(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),te(()=>this.screenLocation,(t,i)=>{v(t)&&v(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[a4]=Be(this[a4])}get screenLocation(){var r;const{location:e,view:t,screenLocationEnabled:i}=this;return i&&v(e)&&v(t)&&t.ready?(r=t.toScreen)==null?void 0:r.call(t,e):null}};Zxe=a4,u([d()],jw.prototype,"location",void 0),u([d()],jw.prototype,"screenLocation",null),u([d()],jw.prototype,"screenLocationEnabled",void 0),u([d()],jw.prototype,"view",void 0),jw=u([P("esri.widgets.support.AnchorElementViewModel")],jw);const Jxe=jw,$Xe="esri.widgets.CompassViewModel";let l4=class extends Jxe{constructor(e){super(e),this.visible=!1}};u([d()],l4.prototype,"visible",void 0),l4=u([P($Xe)],l4);const Kxe=l4,TB="esri-spinner",SB={base:TB,spinnerStart:`${TB}--start`,spinnerFinish:`${TB}--finish`};let Hw=class extends pn{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Kxe}initialize(){this.addHandles(te(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:t,promise:i}=e!=null?e:{};t&&(this.viewModel.location=t),this.visible=!0;const r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,n={[SB.spinnerStart]:r,[SB.spinnerFinish]:s},o=this._getPositionStyles();return D("div",{class:this.classes(SB.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=M0(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(C(t)||C(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([d()],Hw.prototype,"location",null),u([d()],Hw.prototype,"view",null),u([d({type:Kxe})],Hw.prototype,"viewModel",void 0),u([d()],Hw.prototype,"visible",null),Hw=u([P("esri.widgets.Spinner")],Hw);const LXe=Hw,XU={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},Nx=new JT({id:"zoom-to-feature",title:"{messages.zoom}",className:XU.iconZoom}),Loe=new JT({id:"remove-selected-feature",title:"{messages.remove}",className:XU.iconTrash}),LE=new JT({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:XU.iconZoom}),DE=new JT({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:XU.iconBrowseClusteredFeatures}),DXe="esri.widgets.Popup.PopupViewModel",lk=se.getLogger(DXe),FXe=e=>{const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new H("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new H("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new H("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new H("trigger-action:invalid-action","Action is disabled"));if(o===Nx.id)return kXe(s.viewModel).catch($G);if(o===LE.id)return UXe(s.viewModel);if(o===DE.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===Loe.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new H(`trigger-action:${Loe.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function Qxe(e){var s;const{selectedFeature:t,location:i,view:r}=e;return r?r.type==="3d"?(s=t!=null?t:i)!=null?s:null:e.get("selectedFeature.geometry")||i:null}function yx(e){var t,i;return!!e&&e.isAggregate&&((i=(t=e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:i.type)==="cluster"}async function NXe(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r;try{r=await i.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0}async function kXe(e){var h;const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=Qxe(e);if(!r||!n){const p=new H("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw lk.error(p),p}const o=r.scale/s,a=(h=e.selectedFeature)==null?void 0:h.geometry,l=a!=null?a:t,c=v(l)&&l.type==="point"&&await NXe(i,r);Nx.active=!0,Nx.disabled=!0;try{await e.zoomTo({target:{target:n,scale:c?o:void 0}})}catch{const f=new H("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});lk.error(f)}finally{Nx.active=!1,Nx.disabled=!1,e.zoomToLocation=null,c&&(e.location=l)}}async function UXe(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const o=new H("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw lk.error(o),o}if(!t||!yx(t)){const o=new H("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw lk.error(o),o}const[r,s]=await nQ(i,t);LE.active=!0,LE.disabled=!0;const{extent:n}=await r.queryExtent(s);await e.zoomTo({target:n}),LE.active=!1,LE.disabled=!1}async function VXe(e){const{view:t,selectedFeature:i}=e;if(!t||!i)return;const[r,s]=await nQ(t,i),{extent:n}=await r.queryExtent(s);e.selectedClusterBoundaryFeature.geometry=n,t.graphics.add(e.selectedClusterBoundaryFeature)}async function BXe(e){var o;const{selectedFeature:t,view:i}=e;if(!i||!t)return;const[r,s]=await nQ(i,t);DE.active=!0,DE.disabled=!0;const{features:n}=await r.queryFeatures(s);DE.active=!1,DE.disabled=!1,(o=i.popup)==null||o.open({features:[t].concat(n),featureMenuOpen:!0})}async function nQ(e,t){const i=await e.whenLayerView(t.sourceLayer),r=i.createQuery(),s=t.getObjectId();return r.aggregateIds=s!=null?[s]:[],[i,r]}function zXe(e){const t=e.features.filter(i=>yx(i));t.length&&(e.features=t)}function eTe(e){var t;if(C(e))return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return(t=e.extent)==null?void 0:t.center;default:return null}}const Bt="esri-popup",KM=`${Bt}__header`,Mb=`${Bt}--is-docked`,Ae={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:Bt,widget:"esri-widget",main:`${Bt}__main-container`,loadingContainer:`${Bt}__loading-container`,isCollapsible:`${Bt}--is-collapsible`,isCollapsed:`${Bt}--is-collapsed`,shadow:`${Bt}--shadow`,isDocked:Mb,isDockedTopLeft:`${Mb}-top-left`,isDockedTopCenter:`${Mb}-top-center`,isDockedTopRight:`${Mb}-top-right`,isDockedBottomLeft:`${Mb}-bottom-left`,isDockedBottomCenter:`${Mb}-bottom-center`,isDockedBottomRight:`${Mb}-bottom-right`,alignTopCenter:`${Bt}--aligned-top-center`,alignBottomCenter:`${Bt}--aligned-bottom-center`,alignTopLeft:`${Bt}--aligned-top-left`,alignBottomLeft:`${Bt}--aligned-bottom-left`,alignTopRight:`${Bt}--aligned-top-right`,alignBottomRight:`${Bt}--aligned-bottom-right`,isFeatureMenuOpen:`${Bt}--feature-menu-open`,isActionsMenuOpen:`${Bt}--actions-menu-open`,hasFeatureUpdated:`${Bt}--feature-updated`,header:KM,headerButtons:`${KM}-buttons`,headerContainer:`${KM}-container`,headerContainerButton:`${KM}-container--button`,headerTitle:`${KM}-title`,content:`${Bt}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${Bt}__footer`,footerHasPagination:`${Bt}__footer--has-pagination`,footerHasActions:`${Bt}__footer--has-actions`,footerHasActionsMenu:`${Bt}__footer--has-actions-menu`,button:`${Bt}__button`,buttonDisabled:`${Bt}__button--disabled`,buttonDock:`${Bt}__button--dock`,icon:`${Bt}__icon`,iconDock:`${Bt}__icon--dock-icon`,inlineActionsContainer:`${Bt}__inline-actions-container`,actionsMenuButton:`${Bt}__actions-menu-button`,actions:`${Bt}__actions`,action:`${Bt}__action`,actionImage:`${Bt}__action-image`,actionText:`${Bt}__action-text`,actionToggle:`${Bt}__action-toggle`,actionToggleOn:`${Bt}__action-toggle--on`,actionExit:`${Bt}__action--exit`,actionSelectFeature:`${Bt}__action--select-feature`,pointer:`${Bt}__pointer`,pointerDirection:`${Bt}__pointer-direction`,navigation:`${Bt}__navigation`,paginationPrevious:`${Bt}__pagination-previous`,paginationNext:`${Bt}__pagination-next`,paginationPreviousIconLTR:`${Bt}__pagination-previous-icon`,paginationPreviousIconRTL:`${Bt}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${Bt}__pagination-next-icon`,paginationNextIconRTL:`${Bt}__pagination-next-icon--rtl`,featureMenu:`${Bt}__feature-menu`,featureMenuList:`${Bt}__feature-menu-list`,featureMenuItem:`${Bt}__feature-menu-item`,featureMenuViewport:`${Bt}__feature-menu-viewport`,featureMenuHeader:`${Bt}__feature-menu-header`,featureMenuNote:`${Bt}__feature-menu-note`,featureMenuSelected:`${Bt}__feature-menu-item--selected`,featureMenuButton:`${Bt}__feature-menu-button`,featureMenuTitle:`${Bt}__feature-menu-title`,featureMenuObserver:`${Bt}__feature-menu-observer`,featureMenuLoader:`${Bt}__feature-menu-loader`,collapseButton:`${Bt}__collapse-button`,collapseIcon:`${Bt}__collapse-icon`};var Ra;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(Ra||(Ra={}));const UW={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function GXe(e,t,i){const r=Ra.size;let s=r,n=r;e<1?s*=.75:e>1&&(n*=1.25);const o=0,a=0;let l=r,c=r;return t&&i&&(s=n=l=c=0),[{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[i?l:.875*l,o]},{command:"L",values:[i?s-.5*l:a,n-.5*c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[l,t?o:.125*c]},{command:"L",values:[s-.5*l,t?n-.5*c:c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[s-.5*l,n-.5*c]},{command:"L",values:[i?s-.5*l:a,n-.5*c]},{command:"L",values:[i?s-.5*l:a,t?n-.5*c:c]},{command:"L",values:[s-.5*l,t?n-.5*c:c]},{command:"Z",values:[]}]}]}function jXe(e){const t=Ra.size,i=.5*e,r=0,s=0;return[{type:"path",path:[{command:"M",values:[s,.7*t*.5]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+i]},{command:"L",values:[s,.7*t+i-.7*t*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+i]},{command:"L",values:[t,i]},{command:"L",values:[t,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,r]},{command:"L",values:[t,r]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[s,.7*t*.5]},{command:"Z",values:[]}]}]}function HXe(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function qXe(e,t){let i=t?Ra.tallSymbolWidth:e;const r=e,s=t?4:6;i<=Ra.size?i-=.5*s:i-=s;const n=0,o=0,a=t?.35*i:.5*i;return[{type:"path",path:[{command:"M",values:[.5*i,n]},{command:"L",values:[i,.5*a]},{command:"L",values:[.5*i,a]},{command:"L",values:[o,.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a]},{command:"L",values:[.5*i,a]},{command:"L",values:[.5*i,r]},{command:"L",values:[o,r-.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*i,a]},{command:"L",values:[.5*i,r]},{command:"L",values:[i,r-.5*a]},{command:"L",values:[i,.5*a]},{command:"Z",values:[]}]}]}function WXe(e,t){let i=t?Ra.tallSymbolWidth:e;const r=e,s=t?4:6;i<=Ra.size?i-=.5*s:i-=s;const n=.5*i,o=.15*i,a=0,l=r-o;return[{type:"ellipse",cx:.5*i,cy:l,rx:n,ry:o},{type:"path",path:[{command:"M",values:[a,o]},{command:"L",values:[a,l]},{command:"L",values:[i,l]},{command:"L",values:[i,o]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*i,cy:o,rx:n,ry:o}]}function XXe(e,t){let i=t?Ra.tallSymbolWidth:e;const r=e,s=t?4:6;i<=Ra.size?i-=.5*s:i-=s;const n=.15*i,o=r-n;return[{type:"ellipse",cx:.5*i,cy:o,rx:.5*i,ry:n},{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]}]}function YXe(e){let t=e;const i=e,r=6;t<Ra.size?t-=.5*r:t-=r;const s=.15*t,n=0;return[{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[t,n]},{command:"L",values:[.5*t,i-s]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:n,rx:.5*t,ry:s}]}function ZXe(e){let t=e;const i=e,r=4;t<Ra.size?t-=.5*r:t-=r;const s=0,n=0,o=t,a=i,l=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[n,.5*a-l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[.45*o,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,i]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]}]}function JXe(e){const t=e,i=2;let r=e;r<Ra.size?r-=.5*i:r-=i;const s=0,n=0;return[{type:"path",path:[{command:"M",values:[.45*t,s]},{command:"L",values:[t,r]},{command:"L",values:[.45*t,.6*r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*t,s]},{command:"L",values:[.45*t,.6*r]},{command:"L",values:[n,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,r]},{command:"L",values:[.45*t,.6*r]},{command:"L",values:[t,r]},{command:"Z",values:[]}]}]}function I1(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function IOt(e,t){if(e==null)return new De;if("type"in e&&(e.type==="linear"||e.type==="pattern"))return e;const i=new De(e);return new De([I1(i.r,t),I1(i.g,t),I1(i.b,t),i.a])}function KXe(e){return"r"in e&&"g"in e&&"b"in e}function tTe(e){return"h"in e&&"s"in e&&"v"in e}function iTe(e){return"l"in e&&"a"in e&&"b"in e}function rTe(e){return"l"in e&&"c"in e&&"h"in e}function QXe(e){return"x"in e&&"y"in e&&"z"in e}const eYe=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],tYe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function sTe(e,t){const i=[];let r,s;if(e[0].length!==t.length)throw new Error("dimensions do not match");const n=e.length,o=e[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=e[r][s]*t[s];i.push(a)}return i}function nTe(e){const t=[e.r/255,e.g/255,e.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=sTe(eYe,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function oQ(e){const t=sTe(tYe,[e.x/100,e.y/100,e.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function oTe(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function aTe(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function iYe(e){const t=e.l,i=e.a,r=e.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}function rYe(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}function sYe(e){return oTe(nTe(e))}function nYe(e){return oQ(aTe(e))}function oYe(e){return iYe(oTe(nTe(e)))}function aYe(e){return oQ(aTe(rYe(e)))}function lYe(e){const t=e.r,i=e.g,r=e.b,s=Math.max(t,i,r),n=s-Math.min(t,i,r);let o=s,a=n===0?0:s===t?(i-r)/n%6:s===i?(r-t)/n+2:(t-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function cYe(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,s=r*i,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function $$(e){return KXe(e)?e:rTe(e)?aYe(e):iTe(e)?nYe(e):QXe(e)?oQ(e):tTe(e)?cYe(e):e}function aQ(e){return tTe(e)?e:lYe($$(e))}function POt(e){return iTe(e)?e:sYe($$(e))}function $Ot(e){return rTe(e)?e:oYe($$(e))}function ck(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function uYe(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function hYe(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function dYe(e,t){return new Float32Array(e,t,6)}function lTe(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function pYe(e,t,i,r=0,s=0,n=2){const o=s||t.length/n;for(let a=r;a<o;a++)lTe(e,t,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:uYe,create:ck,createView:dYe,fromValues:hYe,transform:lTe,transformMany:pYe},Symbol.toStringTag,{value:"Module"}));function fYe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function YU(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function mYe(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e}function cTe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function gYe(e){return e[0]*e[3]-e[1]*e[2]}function _x(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],p=i[2],f=i[3],m=i[4],y=i[5];return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*p+n*f,e[3]=s*p+o*f,e[4]=r*m+n*y+a,e[5]=s*m+o*y+l,e}function ZU(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function lQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function JU(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*h+a,e[5]=s*c+o*h+l,e}function yYe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function _Ye(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function cQ(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function vYe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function bYe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function wYe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function uTe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function xYe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function TYe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function SYe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function EYe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],f=t[4],m=t[5],y=vl();return Math.abs(i-l)<=y*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=y*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=y*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=y*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const CYe=_x,AYe=uTe;Object.freeze(Object.defineProperty({__proto__:null,add:wYe,copy:fYe,determinant:gYe,equals:EYe,exactEquals:SYe,frob:bYe,fromRotation:yYe,fromScaling:_Ye,fromTranslation:cQ,identity:YU,invert:cTe,mul:CYe,multiply:_x,multiplyScalar:xYe,multiplyScalarAndAdd:TYe,rotate:ZU,scale:lQ,set:mYe,str:vYe,sub:AYe,subtract:uTe,translate:JU},Symbol.toStringTag,{value:"Module"}));const MYe="http://www.w3.org/2000/svg";let RYe=0,OYe=0;const Doe=he("android"),IYe=he("chrome")||Doe&&Doe>=4?"auto":"optimizeLegibility",PYe={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},$Ye=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let Fn={},qr={};const Foe={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},LYe=Math.PI;let DYe=1;function FE(e,t){const i=e*(LYe/180);return Math.abs(t*Math.sin(i))+Math.abs(t*Math.cos(i))}function hTe(e){return e.map(t=>`${t.command} ${t.values.join(" ")}`).join(" ").trim()}function dTe(e,t,i,r){if(e){if(e.type==="circle")return D("circle",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-dashoffset":i.dashOffset,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if(e.type==="ellipse")return D("ellipse",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if(e.type==="rect")return D("rect",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if(e.type==="image")return D("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if(e.type==="path"){const s=typeof e.path!="string"?hTe(e.path):e.path;return D("path",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:s})}if(e.type==="text")return XT(r),D("text",{"dominant-baseline":r.dominantBaseline,fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":r.align,"text-decoration":r.decoration,kerning:r.kerning,rotate:r.rotate,"text-rendering":IYe,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,"font-size":r.font.size,"font-family":r.font.family,x:e.x,y:e.y},e.text)}return null}function pTe(e){const t={fill:"none",pattern:null,linearGradient:null};if(e){if("type"in e&&e.type==="pattern"){const i="patternId-"+ ++RYe;t.fill=`url(#${i})`,t.pattern={id:i,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&e.type==="linear"){const i="linearGradientId-"+ ++OYe;t.fill=`url(#${i})`,t.linearGradient={id:i,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map(r=>({offset:r.offset,color:r.color&&new De(r.color).toString()}))}}else if(e){const i=new De(e);t.fill=i.toString()}}return t}function fTe(e){var i;const t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(e&&(e.width!=null&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new De(e.color).toString()),e.dashArray&&(t.dashArray=e.dashArray),e.dashArray&&(t.dashOffset=e.dashoffset),e.style)){let r=null;if(e.style in Foe&&(r=Foe[e.style]),Array.isArray(r)){r=r.slice(0);const s=(i=e.width)!=null?i:0;for(let n=0;n<r.length;++n)r[n]*=s;if(e.cap!=="butt"){for(let n=0;n<r.length;n+=2)r[n]-=s,r[n]<1&&(r[n]=1);for(let n=1;n<r.length;n+=2)r[n]+=s}r=r.join(",")}t.dashArray=r}return t}function mTe(e,t){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(e){const r=e.alignBaseline,s=r==="baseline"?"auto":r==="top"?"text-top":r==="bottom"?"hanging":r;i.align=e.align,i.dominantBaseline=s,i.decoration=e.decoration,i.kerning=e.kerning?"auto":"0",i.rotate=e.rotated?"90":"0",XT(t),i.font.style=t.style||"normal",i.font.variant=t.variant||"normal",i.font.weight=t.weight||"normal",i.font.size=t.size&&t.size.toString()||"10pt",i.font.family=t.family||"serif"}return i}function FYe(e){const{pattern:t,linearGradient:i}=e;if(t)return D("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},D("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(i){const r=i.stops.map((s,n)=>D("stop",{key:`${n}-stop`,offset:s.offset,"stop-color":s.color}));return D("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},r)}return null}function NYe(e,t){if(!e)return null;const i=[];for(const r of e){const{shape:s,fill:n,stroke:o,font:a}=r,l=pTe(n),c=fTe(o),h=s.type==="text"?mTe(s,a):null,p=dTe(s,l.fill,c,h);p&&i.push(p)}return D("mask",{id:t,maskUnits:"userSpaceOnUse"},D("g",null,i))}function Noe(e,t,i){return JU(e,YU(e),[t,i])}function koe(e,t,i,r,s){return lQ(e,YU(e),[t,i]),e[4]=e[4]*t-r*t+r,e[5]=e[5]*i-s*i+s,e}function kYe(e,t,i,r){const s=t%360*Math.PI/180;ZU(e,YU(e),s);const n=Math.cos(s),o=Math.sin(s),a=e[4],l=e[5];return e[4]=a*n-l*o+r*o-i*n+i,e[5]=l*n+a*o-i*o-r*n+r,e}function sc(e,t){Fn&&"left"in Fn?(Fn.left!=null&&Fn.left>e&&(Fn.left=e),(Fn.right==null||Fn.right<e)&&(Fn.right=e),(Fn.top==null||Fn.top>t)&&(Fn.top=t),(Fn.bottom==null||Fn.bottom<t)&&(Fn.bottom=t)):Fn={left:e,bottom:t,right:e,top:t}}function Uoe(e){const t=e.args,i=t.length;let r;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)sc(t[r],t[r+1]);qr.x=t[i-2],qr.y=t[i-1];break;case"H":for(r=0;r<i;++r)sc(t[r],qr.y);qr.x=t[i-1];break;case"V":for(r=0;r<i;++r)sc(qr.x,t[r]);qr.y=t[i-1];break;case"m":{let s=0;for(("x"in qr)||(sc(qr.x=t[0],qr.y=t[1]),s=2),r=s;r<i;r+=2)sc(qr.x+=t[r],qr.y+=t[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)sc(qr.x+=t[r],qr.y+=t[r+1]);break;case"h":for(r=0;r<i;++r)sc(qr.x+=t[r],qr.y);break;case"v":for(r=0;r<i;++r)sc(qr.x,qr.y+=t[r]);break;case"c":for(r=0;r<i;r+=6)sc(qr.x+t[r],qr.y+t[r+1]),sc(qr.x+t[r+2],qr.y+t[r+3]),sc(qr.x+=t[r+4],qr.y+=t[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)sc(qr.x+t[r],qr.y+t[r+1]),sc(qr.x+=t[r+2],qr.y+=t[r+3]);break;case"A":for(r=0;r<i;r+=7)sc(t[r+5],t[r+6]);qr.x=t[i-2],qr.y=t[i-1];break;case"a":for(r=0;r<i;r+=7)sc(qr.x+=t[r+5],qr.y+=t[r+6])}}function Voe(e,t,i){const r=PYe[e.toLowerCase()];let s;typeof r=="number"&&(r?t.length>=r&&(s={action:e,args:t.slice(0,t.length-t.length%r)},i.push(s),Uoe(s)):(s={action:e,args:[]},i.push(s),Uoe(s)))}function UYe(e){const t=(typeof e.path!="string"?hTe(e.path):e.path).match($Ye),i=[];if(Fn={},qr={},!t)return null;let r="",s=[];const n=t.length;for(let a=0;a<n;++a){const l=t[a],c=parseFloat(l);isNaN(c)?(r&&Voe(r,s,i),s=[],r=l):s.push(c)}Voe(r,s,i);const o={x:0,y:0,width:0,height:0};return Fn&&"left"in Fn&&(o.x=Fn.left,o.y=Fn.top,o.width=Fn.right-Fn.left,o.height=Fn.bottom-Fn.top),o}function VYe(e){const t={x:0,y:0,width:0,height:0};if(e.type==="circle")t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if(e.type==="ellipse")t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if(e.type==="image"||e.type==="rect")t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if(e.type==="path"){const i=ba(UYe(e));t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height}return t}function BYe(e){const t={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const n of e)i?(i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),r=Math.max(r,n.x+n.width),s=Math.max(s,n.y+n.height)):(i=t,i.x=n.x,i.y=n.y,r=n.x+n.width,s=n.y+n.height);return i&&(i.width=r-i.x,i.height=s-i.y),i}function zYe(e,t,i,r,s,n,o,a,l){let c=(o&&n?FE(n,t):t)/2,h=(o&&n?FE(n,i):i)/2;if(l){const T=l[0],S=l[1];c=(o&&n?FE(n,T):T)/2,h=(o&&n?FE(n,S):S)/2}const p=e.width+r,f=e.height+r,m=ck(),y=ck();let _=!1;if(s&&p!==0&&f!==0){const T=t!==i?t/i:p/f,S=t>i?t:i;let E=1,M=1;isNaN(S)||(T>1?(E=S/p,M=S/T/f):(M=S/f,E=S*T/p)),_x(y,y,koe(m,E,M,c,h)),_=!0}const b=e.x+(p-r)/2,w=e.y+(f-r)/2;if(_x(y,y,Noe(m,c-b,h-w)),!_&&(p>t||f>i)){const T=p/t>f/i,S=(T?t:i)/(T?p:f);_x(y,y,koe(m,S,S,b,w))}return n&&_x(y,y,kYe(m,n,b,w)),a&&_x(y,y,Noe(m,a[0],a[1])),`matrix(${y[0]},${y[1]},${y[2]},${y[3]},${y[4]},${y[5]})`}function GYe(e,t,i){const r=e==null?void 0:e.effects.find(c=>c.type==="bloom");if(!r)return null;const{strength:s,radius:n}=r,o=s>0?n:0,a=(s+o)*t,l=4*s+1;return D("filter",{id:`bloom${i}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},D("feMorphology",{operator:"dilate",radius:(s+.5*o)*(5**(t/100)*(.4+t/100)),in:"SourceGraphic",result:"dilate"}),D("feGaussianBlur",{in:"dilate",stdDeviation:a/25,result:"blur"}),D("feGaussianBlur",{in:"blur",stdDeviation:a/50,result:"intensityBlur"}),D("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},D("feFuncR",{type:"linear",slope:l}),D("feFuncG",{type:"linear",slope:l}),D("feFuncB",{type:"linear",slope:l})),D("feMerge",null,D("feMergeNode",{in:"intensityBlur"}),D("feMergeNode",{in:"intensityBrightness"}),D("feGaussianBlur",{stdDeviation:s/10})))}function jYe(e,t,i,r={}){var c,h,p;const s=[],n=[],o=++DYe,a=GYe(r.effectView,t,o);let l=null;if(a){const f=(c=r.effectView)==null?void 0:c.effects.find(b=>b.type==="bloom"),m=(f.strength?f.strength+f.radius/2:0)/3,y=t+t*m,_=i+i*m;l=[Math.max(y,10),Math.max(_,10)]}for(let f=0;f<e.length;f++){const m=e[f],y=[],_=[];let b=0,w=0,T=0;for(const M of m){const{shape:A,fill:$,stroke:I,font:k,offset:V}=M;r.ignoreStrokeWidth||(b+=I&&I.width||0);const B=pTe($),G=fTe(I),X=A.type==="text"?mTe(A,k):null;s.push(FYe(B)),y.push(dTe(A,B.fill,G,X)),_.push(VYe(A)),V&&(w+=V[0],T+=V[1])}const S=zYe(ba(BYe(_)),t,i,b,(h=r.scale)!=null?h:!1,r.rotation,(p=r.useRotationSize)!=null?p:!1,[w,T],l);let E=null;if(r.masking){const M=`mask-${f}`,A=r.masking[f];s.push(NYe(A,M)),E=`url(#${M})`}n.push(E?D("g",{mask:E},D("g",{transform:S},y)):D("g",{transform:S},y))}return r.useRotationSize&&r.rotation&&(t=FE(r.rotation,t),i=FE(r.rotation,i)),a&&(XT(l),t=l[0],i=l[1]),D("svg",{xmlns:MYe,width:t,height:i,style:"display: block;"},a,D("defs",null,s),a?D("g",{filter:`url(#bloom${o})`},n):n)}const Boe=EW();function HYe(e,t){Boe.append(e,t),Boe.detach(t)}function KU(e,t,i){const r=Math.ceil(t[0]),s=Math.ceil(t[1]);if(!e.some(o=>!!o.length))return null;const n=i&&i.node||document.createElement("div");return i.opacity!=null&&(n.style.opacity=i.opacity.toString()),i.effectView!=null&&(n.style.filter=Mxe(i.effectView)),HYe(n,()=>jYe(e,r,s,i)),n}function qYe(e,t){e=Math.ceil(e),t=Math.ceil(t);const i=document.createElement("canvas");i.width=e,i.height=t,i.style.width=e+"px",i.style.height=t+"px";const r=i.getContext("2d");return r.clearRect(0,0,e,t),r}function WYe(e,t,i){return e?_r(e,{responseType:"image"}).then(r=>{const s=r.data,n=s.width,o=s.height,a=n/o;let l=t;if(i){const c=Math.max(n,o);l=Math.min(l,c)}return{image:s,width:a<=1?Math.ceil(l*a):l,height:a<=1?l:Math.ceil(l/a)}}):Promise.reject(new H("renderUtils: imageDataSize","href not provided."))}function XYe(e,t){return!(!e||t==="ignore")&&(t!=="multiply"||e.r!==255||e.g!==255||e.b!==255||e.a!==1)}function YYe(e,t,i,r,s){switch(s){case"multiply":e[t+0]*=i[0],e[t+1]*=i[1],e[t+2]*=i[2],e[t+3]*=i[3];break;default:{const n=aQ({r:e[t+0],g:e[t+1],b:e[t+2]});n.h=r.h,n.s=r.s,n.v=n.v/100*r.v;const o=$$(n);e[t+0]=o.r,e[t+1]=o.g,e[t+2]=o.b,e[t+3]*=i[3];break}}}function ZYe(e,t,i,r,s){return WYe(e,t,s).then(n=>{const o=n.width?n.width:t,a=n.height?n.height:t;if(n.image&&XYe(i,r)){let l=n.image.width,c=n.image.height;he("edge")&&/\.svg$/i.test(e)&&(l-=1,c-=1);const h=qYe(o,a);h.drawImage(n.image,0,0,l,c,0,0,o,a);const p=h.getImageData(0,0,o,a),f=[i.r/255,i.g/255,i.b/255,i.a],m=aQ(i);for(let y=0;y<p.data.length;y+=4)YYe(p.data,y,f,m,r);h.putImageData(p,0,0),e=h.canvas.toDataURL("image/png")}else{const l=Sr&&Sr.findCredential(e);if(l&&l.token){const c=e.includes("?")?"&":"?";e=`${e}${c}token=${l.token}`}}return{url:e,width:o,height:a}}).catch(()=>({url:e,width:t,height:t}))}function JYe(e){return e=e||globalThis.location.hostname,KYe.some(t=>(e==null?void 0:e.match(t))!=null)}function VW(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(gTe)!=null||t.match(_Te)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(yTe)!=null||t.match(vTe)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const gTe=/^devext.arcgis.com$/,yTe=/^qaext.arcgis.com$/,_Te=/^[\w-]*\.mapsdevext.arcgis.com$/,vTe=/^[\w-]*\.mapsqa.arcgis.com$/,KYe=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,gTe,yTe,/^jsapps.esri.com$/,_Te,vTe];function bTe(e,t,i,r){return e.name?e.styleName&&e.styleName==="Esri2DPointSymbolsStyle"?QYe(e,t,r):d_e(e,t,r).then(s=>wTe(ba(s),e.name,t,i,r)):Promise.reject(new H("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function wTe(e,t,i,r,s){var m,y,_;const n=e.data,o=i&&v(i.portal)?i.portal:po.getDefault(),a={portal:o,url:Ma(e.baseUrl),origin:"portal-item"},l=n.items.find(b=>b.name===t);if(!l){const b=`The symbol name '${t}' could not be found`;return Promise.reject(new H("symbolstyleutils:symbol-name-not-found",b,{symbolName:t}))}let c=z1(D4e(l,r),a),h=(y=(m=l.thumbnail)==null?void 0:m.href)!=null?y:null;const p=l.thumbnail&&l.thumbnail.imageData;JYe()&&(c=(_=VW(c))!=null?_:"",h=VW(h));const f={portal:o,url:Ma(uJ(c)),origin:"portal-item"};return OJ(c,s).then(b=>{const w=r==="cimRef"?p_e(b.data):b.data,T=W0e(w,f);if(T&&j1(T)){if(h){const S=z1(h,a);T.thumbnail=new qx({url:S})}else p&&(T.thumbnail=new qx({url:`data:image/png;base64,${p}`}));e.styleUrl?T.styleOrigin=new NI({portal:i.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(T.styleOrigin=new NI({portal:i.portal,styleName:e.styleName,name:t}))}return T})}function QYe(e,t,i){const r=F4e.replace(/\{SymbolName\}/gi,e.name),s=v(t.portal)?t.portal:po.getDefault();return OJ(r,i).then(n=>{const o=p_e(n.data);return W0e(o,{portal:s,url:Ma(uJ(r)),origin:"portal-item"})})}var eZe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetchSymbolFromStyle:wTe,resolveWebStyleSymbol:bTe});const vx=Ra.size,c4=Ra.maxSize,uQ=Ra.maxOutlineSize,zoe=Ra.lineWidth,BW=Ra.tallSymbolWidth;function NE(e){const t=e.outline,i=v(e.material)?e.material.color:null,r=v(i)?i.toHex():null;if(C(t)||"pattern"in t&&v(t.pattern)&&t.pattern.type==="style"&&t.pattern.style==="none")return e.type==="fill"&&r==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const s=$r(t.size)||0;return{color:"rgba("+(v(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(s,uQ),style:"pattern"in t&&v(t.pattern)&&t.pattern.type==="style"?YK(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function tZe(e,t){const i=t&&t.resource,r=i&&i.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(r&&t.type!=="object")return Promise.resolve(Exe(t));const s=Vi("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?bTe(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var o;return((o=n==null?void 0:n.thumbnail)==null?void 0:o.url)||s}):Promise.resolve(s)}function EB(e,t=1){const i=e.a,r=aQ(e),s=r.h,n=r.s/t,o=100-(100-r.v)/t,{r:a,g:l,b:c}=$$({h:s,s:n,v:o});return[a,l,c,i]}function uk(e){return e.type==="water"?C(e.color)?null:e.color:C(e.material)||C(e.material.color)?null:e.material.color}function ws(e,t=0){const i=uk(e);if(!i){if(e.type==="fill")return null;const s=xqe.r,n=I1(s,t);return[n,n,n,100]}const r=i.toRgba();for(let s=0;s<3;s++)r[s]=I1(r[s],t);return r}async function xTe(e,t){const i=e.style;return i==="none"?null:{type:"pattern",x:0,y:0,src:await wqe(Vi(`esri/symbols/patterns/${i}.png`),t.toCss(!0)),width:5,height:5}}function Goe(e){return e.outline?NE(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function TTe(e,t){const i=uk(e);if(!i)return null;let r="rgba(";return r+=I1(i.r,t)+",",r+=I1(i.g,t)+",",r+=I1(i.b,t)+",",r+i.a+");"}function zW(e,t){const i=TTe(e,t);return i?"pattern"in e&&v(e.pattern)&&e.pattern.type==="style"&&e.pattern.style==="none"?null:{color:i,width:Math.min(e.size?$r(e.size):.75,uQ),style:"pattern"in e&&v(e.pattern)&&e.pattern.type==="style"?YK(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?e.join==="miter"?$r(2):e.join:null}:{}}function sD(e,t,i){const r=i!=null?.75*i:0;return{type:"linear",x1:r?.25*r:0,y1:r?.5*r:0,x2:r||4,y2:r?.5*r:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function iZe(e){const t=e.depth,i=e.height,r=e.width;return r!==0&&t!==0&&i!==0&&r===t&&r!=null&&i!=null&&r<i}function rZe(e,t,i){const r=[];if(!e)return r;switch(e.type){case"icon":{const o=t,a=t;switch(e.resource&&e.resource.primitive||e0e){case"circle":r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:ws(e,0),stroke:NE(e)});break;case"square":r.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,a]},{command:"Z",values:[]}]},fill:ws(e,0),stroke:NE(e)});break;case"triangle":r.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,a]},{command:"Z",values:[]}]},fill:ws(e,0),stroke:NE(e)});break;case"cross":r.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,a]},{command:"M",values:[0,.5*a]},{command:"L",values:[o,.5*a]}]},stroke:Goe(e)});break;case"x":r.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,a]},{command:"M",values:[o,0]},{command:"L",values:[0,a]}]},stroke:Goe(e)});break;case"kite":r.push({shape:{type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*a]},{command:"L",values:[.5*o,a]},{command:"Z",values:[]}]},fill:ws(e,0),stroke:NE(e)})}break}case"object":switch(e.resource&&e.resource.primitive||fJ){case"cone":{const s=sD(ws(e,0),ws(e,-.6),i?BW:t),n=XXe(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s});break}case"inverted-cone":{const s=ws(e,0),n=sD(s,ws(e,-.6),t),o=YXe(t);r.push({shape:o[0],fill:n}),r.push({shape:o[1],fill:s});break}case"cube":{const s=qXe(t,i);r.push({shape:s[0],fill:ws(e,0)}),r.push({shape:s[1],fill:ws(e,-.3)}),r.push({shape:s[2],fill:ws(e,-.5)});break}case"cylinder":{const s=sD(ws(e,0),ws(e,-.6),i?BW:t),n=WXe(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s}),r.push({shape:n[2],fill:ws(e,0)});break}case"diamond":{const s=ZXe(t);r.push({shape:s[0],fill:ws(e,-.3)}),r.push({shape:s[1],fill:ws(e,0)}),r.push({shape:s[2],fill:ws(e,-.3)}),r.push({shape:s[3],fill:ws(e,-.7)});break}case"sphere":{const s=sD(ws(e,0),ws(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=JXe(t);r.push({shape:s[0],fill:ws(e,-.3)}),r.push({shape:s[1],fill:ws(e,0)}),r.push({shape:s[2],fill:ws(e,-.6)});break}}break}return r}function QU(e){const t=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null;return t?$r(t):null}function sZe(e){return e.type==="icon"?"multiply":"tint"}function nZe(e,t){var p;const i=QU(t),r=t!=null&&t.maxSize?$r(t.maxSize):null,s=(p=t==null?void 0:t.disableUpsampling)!=null?p:!1,n=e.symbolLayers,o=[];let a=0,l=0;const c=n.getItemAt(n.length-1);let h;return c&&c.type==="icon"&&(h=c.size&&$r(c.size)),n.forEach(f=>{var _;if(f.type!=="icon"&&f.type!=="object")return;const m=f.type==="icon"?f.size&&$r(f.size):0,y=i||m?Math.ceil(Math.min(i||m,r||c4)):vx;if(f&&f.resource&&f.resource.href){const b=tZe(e,f).then(w=>{const T=f.get("material.color"),S=sZe(f);return ZYe(w,y,T,S,s)}).then(w=>{const T=w.width,S=w.height;return a=Math.max(a,T),l=Math.max(l,S),[{shape:{type:"image",x:0,y:0,width:T,height:S,src:w.url},fill:null,stroke:null}]});o.push(b)}else{let b=y;f.type==="icon"&&h&&i&&(b=y*(m/h));const w=(t==null?void 0:t.symbolConfig)==="tall"||((_=t==null?void 0:t.symbolConfig)==null?void 0:_.isTall)||f.type==="object"&&iZe(f);a=Math.max(a,w?BW:b),l=Math.max(l,b),o.push(Promise.resolve(rZe(f,b,w)))}}),Eo(o).then(f=>{const m=[];return f.forEach(y=>{y.value?m.push(y.value):y.error&&se.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",y.error)}),KU(m,[a,l],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})})}function oZe(e,t){const i=e.symbolLayers,r=[],s=Eqe(e),n=QU(t),o=(t&&t.maxSize?$r(t.maxSize):null)||uQ;let a,l=0,c=0;return i.forEach((h,p)=>{if(!h||h.type!=="line"&&h.type!=="path")return;const f=[];switch(h.type){case"line":{const m=zW(h,0);if(C(m))break;const y=m&&m.width||0;p===0&&(a=y);const _=Math.min(n||y,o),b=p===0?_:n?_*(y/a):_,w=b>zoe/2?2*b:zoe;c=Math.max(c,b),l=Math.max(l,w),m.width=b,f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[l,.5*c]}]},stroke:m});break}case"path":{const m=Math.min(n||vx,o),y=ws(h,0),_=ws(h,-.2),b=TTe(h,-.4),w=b?{color:b,width:1}:{};if(h.profile==="quad"){const T=h.width,S=h.height,E=GXe(T&&S?T/S:1,S===0,T===0),M={...w,join:"bevel"};f.push({shape:E[0],fill:_,stroke:M}),f.push({shape:E[1],fill:_,stroke:M}),f.push({shape:E[2],fill:y,stroke:M})}else f.push({shape:UW.pathSymbol3DLayer[0],fill:_,stroke:w}),f.push({shape:UW.pathSymbol3DLayer[1],fill:y,stroke:w});c=Math.max(c,m),l=c}}r.push(f)}),Promise.resolve(KU(r,[l,c],{node:t&&t.node,scale:s,opacity:t&&t.opacity}))}async function aZe(e,t){const i=e.type==="mesh-3d",r=e.symbolLayers,s=QU(t),n=t&&t.maxSize?$r(t.maxSize):null,o=s||vx,a=[];let l=0,c=0,h=!1;for(let p=0;p<r.length;p++){const f=r.getItemAt(p),m=[];if(i&&f.type!=="fill")continue;const y=UW.fill[0];switch(f.type){case"fill":{const _=NE(f),b=Math.min(o,n||c4);l=Math.max(l,b),c=Math.max(c,b),h=!0;let w=ws(f,0);const T="pattern"in f?f.pattern:null,S=uk(f);!i&&v(T)&&T.type==="style"&&T.style!=="solid"&&S&&(w=await xTe(T,S)),m.push({shape:y,fill:w,stroke:_});break}case"line":{const _=zW(f,0);if(C(_))break;const b={stroke:_,shape:y};l=Math.max(l,vx),c=Math.max(c,vx),m.push(b);break}case"extrude":{const _={join:"round",width:1,...zW(f,-.4)},b=ws(f,0),w=ws(f,-.2),T=Math.min(o,n||c4),S=jXe(T);_.width=1,m.push({shape:S[0],fill:w,stroke:_}),m.push({shape:S[1],fill:w,stroke:_}),m.push({shape:S[2],fill:b,stroke:_});const E=vx,M=.7*vx+.5*T;l=Math.max(l,E),c=Math.max(c,M);break}case"water":{const _=ba(uk(f)),b=EB(_),w=EB(_,2),T=EB(_,3),S=HXe();h=!0,m.push({shape:S[0],fill:b}),m.push({shape:S[1],fill:w}),m.push({shape:S[2],fill:T});const E=Math.min(o,n||c4);l=Math.max(l,E),c=Math.max(c,E);break}}a.push(m)}return KU(a,[l,c],{node:t&&t.node,scale:h,opacity:t&&t.opacity})}function lZe(e,t){if(e.symbolLayers.length===0)return Promise.reject(new H("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return nZe(e,t);case"line-3d":return oZe(e,t);case"polygon-3d":case"mesh-3d":return aZe(e,t)}return Promise.reject(new H("symbolPreview: swatchInfo3D","symbol not supported."))}var cZe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getPatternDescriptor:xTe,getSizeFromOptions:QU,getSymbolLayerFill:ws,previewSymbol3D:lZe});let TS=null;const joe=[255,255,255];function Hoe(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function LOt(e,t,i){const{backgroundColor:r,outline:s,dotSize:n}=e,o=i&&i.swatchSize||Ra.size,a=.8,l=Math.round(o*o/n**2*a),c=window.devicePixelRatio,h=document.createElement("canvas"),p=o*c;h.width=p,h.height=p,h.style.width=h.width/c+"px",h.style.height=h.height/c+"px";const f=h.getContext("2d");if(r&&(f.fillStyle=r.toCss(!0),f.fillRect(0,0,p,p),f.fill()),f.fillStyle=t.toCss(!0),TS&&TS.length/2===l)for(let y=0;y<2*l;y+=2){const _=TS[y],b=TS[y+1];f.fillRect(_,b,n*c,n*c),f.fill()}else{TS=[];for(let y=0;y<2*l;y+=2){const _=Hoe(0,p),b=Hoe(0,p);TS.push(_,b),f.fillRect(_,b,n*c,n*c),f.fill()}}s&&(s.color&&(f.strokeStyle=s.color.toCss(!0)),f.lineWidth=s.width,f.strokeRect(0,0,p,p));const m=new Image(o,o);return m.src=h.toDataURL(),m}function DOt(e,t={}){const i=t.radius||40,r=2*Math.PI*i,s=e.length,n=r/s,o=[],a=XK(t.outline);(a==null?void 0:a.width)!=null&&(a.width*=2),(a||t.backgroundColor)&&o.push({shape:{type:"circle",cx:i,cy:i,r:i},fill:t.backgroundColor,stroke:a,offset:[0,0]});const l=t.values,c=l&&l.length===s&&l.reduce((y,_)=>y+_,0)===100,h=[0];for(let y=0;y<s;y++){let _=null;c&&(_=l[y]*r/100,h.push(_+h[y])),o.push({shape:{type:"circle",cx:i,cy:i,r:i/2},fill:[0,0,0,0],stroke:{width:i,dashArray:`${(_!=null?_:n)/2} ${r}`,dashoffset:"-"+(c?h[y]/2:y*(n/2)),color:e[y]},offset:[0,0]})}let p=null;const f=2*i+((a==null?void 0:a.width)||0),m=t.holePercentage;if(m){a&&o.push({shape:{type:"circle",cx:i,cy:i,r:i*m},fill:null,stroke:a,offset:[0,0]});const y=f/2;p=[[{shape:{type:"circle",cx:y,cy:y,r:y},fill:joe,stroke:a?{...a,color:joe}:null,offset:[0,0]},{shape:{type:"circle",cx:y,cy:y,r:i*m},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return KU([o],[f,f],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:p,rotation:-90})}function FOt(e,t={}){const s=t.align==="horizontal",n=s?75:24,o=s?24:75,{width:a=n,height:l=o,gradient:c=!0}=t,h=window.devicePixelRatio,p=a*h,f=l*h,m=document.createElement("canvas");m.width=p,m.height=f,m.style.width=`${a}px`,m.style.height=`${l}px`;const y=m.getContext("2d"),_=s?p:0,b=s?0:f;if(c){const T=y.createLinearGradient(0,0,_,b),S=e.length,E=S===1?0:1/(S-1);e.forEach((M,A)=>T.addColorStop(A*E,M.toString())),y.fillStyle=T,y.fillRect(0,0,p,f)}else{const T=s?p/e.length:p,S=s?f:f/e.length;let E=0,M=0;for(const A of e)y.fillStyle=A.toString(),y.fillRect(E,M,T,S),E=s?E+T:0,M=s?0:M+S}const w=document.createElement("div");return w.style.width=`${a}px`,w.style.height=`${l}px`,uZe(w,t==null?void 0:t.effectList),w.appendChild(m),w}function uZe(e,t){if(!t)return;e.style.filter=Mxe(t);const i=t.effects;if(i){for(const r of i)if((r==null?void 0:r.type)==="drop-shadow"){r.offsetX<0?e.style.marginLeft=`${Math.abs(r.offsetX)}px`:e.style.marginRight=`${r.offsetX}px`;break}}}async function hZe(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:i}=await Q(()=>import("./previewWebStyleSymbol.865dc8fc.js"),[]);return i(e,hZe,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:i}=await Q(()=>Promise.resolve().then(function(){return cZe}),void 0);return i(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:i}=await Q(()=>import("./previewSymbol2D.189014a3.js"),["assets/previewSymbol2D.189014a3.js","assets/fontUtils.17892b3a.js","assets/colorUtils.2b15a02f.js"]);return i(e,t)}case"cim":{const{previewCIMSymbol:i}=await Q(()=>import("./previewCIMSymbol.62d46f5d.js"),["assets/previewCIMSymbol.62d46f5d.js","assets/cimAnalyzer.9efd79b7.js","assets/fontUtils.17892b3a.js","assets/BidiEngine.f5b8c89f.js","assets/TileClipper.7b9dd3ce.js","assets/enums.89506096.js","assets/number.dcd3e86c.js","assets/CIMSymbolRasterizer.07ef2d83.js","assets/_commonjsHelpers.4421ccc9.js","assets/imageutils.e44a6f33.js","assets/rasterizingUtils.eebd054f.js"]);return i(e,t)}default:return}}function STe(e){return e&&"opacity"in e?e.opacity*STe(e.parent):1}async function dZe(e,t){var b,w;if(!e)return;const i=e.sourceLayer,r=(b=v(t)&&t.useSourceLayer?i:e.layer)!=null?b:i,s=STe(r);if(v(e.symbol)&&(!v(t)||t.ignoreGraphicSymbol!==!0)){const T=e.symbol.type==="web-style"?await Uqe(e.symbol,{...t,cache:v(t)?t.webStyleCache:null}):e.symbol.clone();return pB(T,null,s),T}const n=(w=v(t)?t.renderer:null)!=null?w:r&&"renderer"in r?r.renderer:null;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...t,cache:v(t)?t.webStyleCache:null}):o.clone(),!(n&&"visualVariables"in n&&n.visualVariables&&n.visualVariables.length))return pB(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(C(t)||C(t.arcade))){const T={...t};T.arcade=await Eg(),t=T}const a=await Q(()=>Promise.resolve().then(function(){return tU}),void 0),l=[],c=[],h=[],p=[];for(const T of n.visualVariables)switch(T.type){case"color":l.push(T);break;case"opacity":c.push(T);break;case"rotation":p.push(T);break;case"size":T.target||h.push(T)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,e,t):null,y=!!c.length&&c[c.length-1];let _=y?a.getOpacity(y,e,t):null;if(s!=null&&(_=_!=null?_*s:s),pB(o,m,_),h.length){const T=a.getAllSizes(h,e,t);await Nqe(o,T)}for(const T of p)kqe(o,a.getRotationAngle(T,e,t),T.axis);return o}class L0{constructor(t,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in t){const s=t[r],n=new jme(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=rge(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const t in this._properties){const i=this._properties[t];for(const r of i.acquired)vie(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(t){const i=this._owner._get(t),r=this._properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this._properties){const i=this._properties[t];let r=0;for(const s of i.acquired)vie(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}}const pZe=he("mac")?"Meta":"Ctrl",e8={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)e8[e]=String.fromCharCode(e);for(let e=1;e<25;e++)e8[111+e]=`F${e}`;for(let e=65;e<91;e++)e8[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function fZe(e){if(e.key!==void 0)return Pc(e);const t=e8[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function mZe(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class gZe{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}}const qoe=se.getLogger("esri.views.input.InputHandler");class Oa{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?qoe.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof t=="string"?new gZe(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new yZe(n,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw new Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new _Ze(t,{onEmit:(r,s,n,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,s,n,o)},onRemove:r=>{var s;delete this._outgoing[r.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){var i;(i=this._manager)==null||i.setPointerCapture(t,!0)}stopCapturingPointer(t){var i;(i=this._manager)==null||i.setPointerCapture(t,!1)}refreshHasPendingInputs(){var t;(t=this._manager)==null||t.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):qoe.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){var r;const i=this._incoming[t.type];if(i){for(const s of i)if(s.match.matches(t)&&((r=s.callback)==null||r.call(s,t),t.shouldStopPropagation()))break}}}class yZe{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class _Ze{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class vZe extends Oa{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(t){const i=t.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=t;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}}class hk{constructor(t){this._observable=new kZ,this._value=t}get(){return Ai(this._observable),this._value}set(t){t!==this._value&&(this._value=t,this._observable.notify())}}class bZe extends Oa{get multiTouchActive(){return this._multiTouchActive.get()}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new hk(!1),this._onPointerAdd=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.add(t.native.pointerId),this._update())},this._onPointerRemove=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.delete(t.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}}let Mm=class extends Te{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=pZe,this._latestPointerType="mouse",this._propertiesPool=new L0({latestPointerLocation:TZe},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,t,i=P1.INTERNAL){if(this._nameToGroup[e])return void se.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void se.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const n=r.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(r,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{var r;i.removed=!0,(r=i.uninstallCallback)==null||r.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):se.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const r=this._handlers[i];r.priorityIndex=i,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s){for(const n of r.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of r.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)mZe(o)||t.add(o)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._latestPointerType=e;const r=this._get("latestPointerLocation");if(C(r)||r.x!==t||r.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,i=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(r(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(r(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new vZe((e,t,i)=>this._setLatestPointer(e,t,i)),this._multiTouchHandler=new bZe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],P1.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,P1.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=r!==void 0?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new wZe(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new nq,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var t,i;const e=ba(this._currentPropagation);for(;e.events.length>0;){const{event:r,priorityIndex:s}=e.events.pop(),n=r.data&&r.data.eventId;if(!(n!=null&&this._stoppedPropagationEventIds.has(n)))for(e.currentHandler=this._handlersPriority[s];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!r.shouldStopPropagation()&&((i=(t=e.currentHandler).eventCallback)==null||i.call(t,r)),r.shouldStopPropagation()){n!=null&&this._stoppedPropagationEventIds.add(n);break}if(r.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:r,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const t=new nq;t.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)t.push(i.events.pop());i.events=t,i.currentHandler=null}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const r of t.handler.incomingEventMatches){if(i.eventType!==r.eventType)continue;const s=i.keyModifiers.filter(n=>r.keyModifiers.includes(n));if(s.length===i.keyModifiers.length!=(s.length===r.keyModifiers.length))return i.keyModifiers.length>r.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let r=0;for(;r<t.length&&this._compareHandlerPriority(i,t[r])>=0;)r++;t.splice(r,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],Mm.prototype,"hasPendingInputs",null),u([d({constructOnly:!0})],Mm.prototype,"eventSource",void 0),u([d({constructOnly:!0})],Mm.prototype,"recognizers",void 0),u([d()],Mm.prototype,"_latestPointerType",void 0),u([d()],Mm.prototype,"latestPointerType",null),u([d()],Mm.prototype,"multiTouchActive",null),u([d({readOnly:!0})],Mm.prototype,"latestPointerLocation",void 0),Mm=u([P("esri.views.input.InputManager")],Mm);class wZe{constructor(t,i,r,s,n){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=Bv.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Bv.STOPPED}shouldStopPropagation(){return(this._propagationState&Bv.STOPPED)!=0}async(t){this._propagationState|=Bv.PAUSED;const i=(r,s)=>{this._propagationState&=~Bv.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&Bv.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var Bv;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(Bv||(Bv={}));const P1={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class xZe{}const TZe=xZe;function GW(e){return e&&typeof e.highlight=="function"}function SZe(e){return e&&typeof e.maskOccludee=="function"}function NOt(e,t,i){return C(e)||e>i&&(t===0||e<t)}function kOt(e,t){return v(e)&&e>0||v(t)&&t>0}function UOt(e){var i,r;const t=e.effectiveScaleRange;return{minScale:(i=t==null?void 0:t.minScale)!=null?i:0,maxScale:(r=t==null?void 0:t.maxScale)!=null?r:0}}const t8=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return XT(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([d()],t.prototype,"goToOverride",void 0),u([d()],t.prototype,"view",void 0),t=u([P("esri.widgets.support.GoTo")],t),t},G3=Qe.ofType({key:"type",defaultKeyValue:"button",base:KA,typeMap:{button:JT,toggle:qZ}}),EZe=()=>[Nx.clone()],CZe=()=>[LE.clone(),DE.clone()];let sr=class extends t8(Jxe){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new Ii,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new G3,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Ko({symbol:new H0({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([te(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),te(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),te(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),te(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),te(()=>this.location,e=>this._locationChange(e)),te(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),te(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),te(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),te(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>FXe({event:e,view:this.view})),Qo(()=>!this.waitingForResult,()=>this._waitingForResultChange(),hr),te(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),te(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),Qo(()=>!this.visible,()=>this.browseClusterEnabled=!1),te(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new G3;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){const e=this._get("defaultActions")||new G3;return e.removeAll(),e.addMany(yx(this.selectedFeature)?CZe():EZe()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){var r,s,n;let t=e;const i=(s=(r=this.view)==null?void 0:r.spatialReference)==null?void 0:s.isWebMercator;e&&((n=e==null?void 0:e.spatialReference)==null?void 0:n.isWGS84)&&i&&(t=dg(e)),this._set("location",t)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const i=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=Qxe(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new H("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e)throw new H("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of r)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){zXe(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?yx(t)?(await VXe(this),await BXe(this)):se.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):se.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(Nx.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(yx(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){const{location:t,updateLocationEnabled:i,view:r}=this;if(e&&r){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),yx(e)?void 0:(e.symbol=await dZe(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{var n;const s=(n=r.center)==null?void 0:n.clone();s&&(this.location=s)}):this.location=eTe(e.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:i,promisesPerLayerView:r}=t,s=Promise.resolve(i),n=r.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(yx(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(r.some((h,p)=>(h&&h.graphic===n&&(a=h,r.splice(p,1)),!!a)),a)s[o]=a;else{const h=new sQ({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),r.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const r=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},P1.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(s=>{var c;const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(h=>h.promise)];return(c=r==null?void 0:r.popup)==null||c.open({location:a||i,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:t}_getHighlightTarget(e,t){const i=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||qbe:null,r=e.attributes;return r&&i&&r[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&t&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof VI))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&GW(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof VI))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&GW(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(r=>!t.includes(r));this.features=t.concat(i)}};u([d()],sr.prototype,"featurePage",void 0),u([d()],sr.prototype,"isLoadingFeature",null),u([d({type:G3})],sr.prototype,"actions",void 0),u([d({readOnly:!0})],sr.prototype,"active",null),u([d()],sr.prototype,"activeFeature",void 0),u([d({readOnly:!0})],sr.prototype,"allActions",null),u([d({type:Boolean})],sr.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],sr.prototype,"autoCloseEnabled",void 0),u([d()],sr.prototype,"autoOpenEnabled",void 0),u([d()],sr.prototype,"browseClusterEnabled",void 0),u([d()],sr.prototype,"content",void 0),u([d({type:G3,readOnly:!0})],sr.prototype,"defaultActions",null),u([d({readOnly:!0})],sr.prototype,"featureCount",null),u([d()],sr.prototype,"features",null),u([d()],sr.prototype,"featuresPerPage",void 0),u([d()],sr.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],sr.prototype,"featureViewModels",void 0),u([d()],sr.prototype,"highlightEnabled",void 0),u([d()],sr.prototype,"includeDefaultActions",void 0),u([d({type:ut})],sr.prototype,"location",null),u([d({readOnly:!0})],sr.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],sr.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],sr.prototype,"waitingForResult",null),u([d({readOnly:!0})],sr.prototype,"promiseCount",null),u([d()],sr.prototype,"promises",null),u([d({value:null,readOnly:!0})],sr.prototype,"selectedFeature",null),u([d({value:-1})],sr.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],sr.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],sr.prototype,"state",null),u([d()],sr.prototype,"title",void 0),u([d()],sr.prototype,"updateLocationEnabled",void 0),u([d()],sr.prototype,"view",void 0),u([d()],sr.prototype,"visible",void 0),u([d()],sr.prototype,"zoomFactor",void 0),u([d()],sr.prototype,"zoomToLocation",void 0),u([d()],sr.prototype,"centerAtLocation",null),sr=u([P("esri.widgets.Popup.PopupViewModel")],sr);const ETe=sr,Woe="selected-index",AZe=0,Xoe="popup-spinner",Yoe={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Zoe="esri-popup";function ey(e,t){return t===void 0?`${Zoe}__${e}`:`${Zoe}__${e}-${t}`}const Joe={closeButton:!0,featureNavigation:!0};let Vt=class extends Yxe(pn){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Ii,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([i])=>{(i==null?void 0:i.isIntersecting)&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=mC(()=>this._displaySpinner(),AZe),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new Qe,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new ETe,this.visibleElements={...Joe},this._handleOpenRelatedFeature=i=>{this._openRelatedFeature(i)},this._addSelectedFeatureIndexHandle(),this.addHandles([te(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),te(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),te(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,r)=>{!!i!=!!r&&this.reposition()}),te(()=>{var i,r,s,n,o,a;return[(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),te(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),te(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.size},(i,r)=>this._updateDockEnabledForViewSize(i,r)),te(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,r)=>this._viewChange(i,r)),te(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.ready},(i,r)=>this._viewReadyChange(i!=null?i:!1,r!=null?r:!1)),te(()=>{var i,r;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(r=this.viewModel)==null?void 0:r.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),te(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),te(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),te(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),Qo(()=>!this.collapsed,()=>{var i,r;((r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),Fs(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),te(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),st),te(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop()),Fs(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),te(()=>{var i,r,s,n;return[(r=(i=this._activeFlowItemWidget)==null?void 0:i.viewModel)==null?void 0:r.state,(n=(s=this._activeFlowItemWidget)==null?void 0:s.viewModel)==null?void 0:n.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-flow.268ea01d.js"),["assets/calcite-flow.268ea01d.js","assets/observers.0143061c.js"]),Q(()=>import("./calcite-flow-item.575bd1fb.js"),["assets/calcite-flow-item.575bd1fb.js","assets/interactive.5b40332c.js","assets/loadable.f81dc576.js","assets/t9n.6be6d1c5.js","assets/observers.0143061c.js","assets/action-menu.6a4dc6a9.js","assets/guid.ba2965fd.js","assets/action.4ad29f2f.js","assets/icon.2acbc95d.js","assets/loader.5c70f655.js","assets/openCloseComponent.79fe4357.js","assets/debounce.aad9914a.js","assets/scrim.a5ee631c.js","assets/tooltip.ef998d8f.js"]),Q(()=>import("./calcite-action.0466daf5.js"),["assets/calcite-action.0466daf5.js","assets/action.4ad29f2f.js","assets/guid.ba2965fd.js","assets/interactive.5b40332c.js","assets/loadable.f81dc576.js","assets/t9n.6be6d1c5.js","assets/observers.0143061c.js","assets/icon.2acbc95d.js","assets/loader.5c70f655.js"]),Q(()=>import("./calcite-tooltip.02366f89.js"),["assets/calcite-tooltip.02366f89.js","assets/tooltip.ef998d8f.js","assets/openCloseComponent.79fe4357.js","assets/debounce.aad9914a.js","assets/guid.ba2965fd.js"]),Q(()=>import("./calcite-icon.cd430452.js"),["assets/calcite-icon.cd430452.js","assets/icon.2acbc95d.js","assets/observers.0143061c.js"])])}destroy(){var e,t;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:t}=this;if(!e)return!!(t!=null&&t.content);const i=e.viewModel;if((i==null?void 0:i.waitingForContent)||(i==null?void 0:i.state)==="error")return!0;const r=i==null?void 0:i.content;return Array.isArray(r)?!!r.length:!!r}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Yoe}set dockOptions(e){var a,l;const t={...Yoe},i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.breakpoints,r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s={...t,...e},n={...t.breakpoint,...r},{breakpoint:o}=s;typeof o=="object"?s.breakpoint={...n,...o}:o&&(s.breakpoint=n),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i,_flowItems:r}=this,{selectedFeatureViewModel:s}=this.viewModel,n={...t,title:!1};return s?(e?(e.viewModel=s,e.visibleElements=n):this._feature=new PXe({flowItems:r,headingLevel:i+1,viewModel:s,visibleElements:n}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...Joe,...e}}blur(){const{active:e}=this.viewModel;e||se.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||se.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(Woe);const t=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var y,_,b,w;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:i,dividedActions:r,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=r,l=o&&a.length>1&&e,c=o&&t,h=o&&!t,p=(_=(y=this.selectedFeature)==null?void 0:y.layer)==null?void 0:_.title,f=(w=(b=this.selectedFeature)==null?void 0:b.layer)==null?void 0:w.id,m={[Ae.alignTopCenter]:s==="top-center",[Ae.alignBottomCenter]:s==="bottom-center",[Ae.alignTopLeft]:s==="top-left",[Ae.alignBottomLeft]:s==="bottom-left",[Ae.alignTopRight]:s==="top-right",[Ae.alignBottomRight]:s==="bottom-right",[Ae.isDocked]:c,[Ae.shadow]:h,[Ae.isDockedTopLeft]:n==="top-left",[Ae.isDockedTopCenter]:n==="top-center",[Ae.isDockedTopRight]:n==="top-right",[Ae.isDockedBottomLeft]:n==="bottom-left",[Ae.isDockedBottomCenter]:n==="bottom-center",[Ae.isDockedBottomRight]:n==="bottom-right",[Ae.isFeatureMenuOpen]:i,[Ae.isActionsMenuOpen]:l};return D("div",{class:this.classes(Ae.base,m),role:"presentation","data-layer-title":p,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return D("span",{"aria-hidden":"true",class:this.classes(Ae.icon,Ae.iconLoading,Ae.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?D("div",{key:ey("loading-container"),role:"presentation",class:Ae.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=og(this.container),t={[Ae.iconRightTriangleArrow]:e,[Ae.paginationPreviousIconRTL]:e,[Ae.iconLeftTriangleArrow]:!e,[Ae.paginationPreviousIconLTR]:!e};return D("span",{"aria-hidden":"true",class:this.classes(Ae.icon,t)})}renderPreviousButton(){const{messages:e}=this;return D("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ae.button,Ae.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=og(this.container),t={[Ae.iconLeftTriangleArrow]:e,[Ae.paginationNextIconRTL]:e,[Ae.iconRightTriangleArrow]:!e,[Ae.paginationNextIconLTR]:!e};return D("span",{"aria-hidden":"true",class:this.classes(Ae.icon,t)})}renderNextButton(){const{messages:e}=this;return D("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ae.button,Ae.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return D("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ae.button,Ae.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[Ae.iconUndock]:e,[Ae.iconDock]:!e,[Ae.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[Ae.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[Ae.iconDockToTop]:!e&&t==="top-center",[Ae.iconDockToBottom]:!e&&t==="bottom-center"};return D("span",{"aria-hidden":"true",class:this.classes(i,Ae.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,i=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,r=e?t.undock:t.dock;return i!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?D("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ae.button,Ae.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[Ae.headerContainerButton]:i},o=D(BU,{level:this.headingLevel,class:Ae.headerTitle,innerHTML:e!=null?e:""}),a=i?D("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ae.headerContainer,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},o,D("calcite-icon",{class:Ae.collapseIcon,key:"collapse-icon",icon:r?"chevron-down":"chevron-up",scale:"m"})):D("div",{key:e!=null?e:"title",id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ae.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return D("span",{"aria-hidden":"true",class:this.classes(Ae.icon,Ae.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?D("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ae.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return D("header",{class:Ae.header},this.renderTitle(),D("div",{class:Ae.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i,_flowItems:r}=this,{content:s}=this.viewModel,n=r.toArray(),o={[Ae.contentHasFlows]:!!n.length};return t&&!i?D("div",{key:s!=null?s:"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(Ae.content,o)},D("calcite-flow",{bind:this},D("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:y1,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),n.map(a=>this.renderFlowItem(a))),n.map(a=>this.renderFlowItemTooltips(a))):null}renderFlowItem(e){var s;const{messages:t}=this,i=ok(),r="graphic"in e&&!e.isTable;return D("calcite-flow-item",{bind:this,class:this.classes({[Ae.calciteThemeDark]:!i,[Ae.calciteThemeLight]:i}),heading:(s=e.title)!=null?s:"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},D("calcite-action",{class:Ae.actionExit,icon:"move-up",label:t==null?void 0:t.exitRelatedRecords,text:t==null?void 0:t.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:n=>this._storeExitRelatedRecordsAction(e,n),onclick:this._destroyFlowItemWidgets}),r?D("calcite-action",{class:Ae.actionSelectFeature,icon:"zoom-to-object",label:t==null?void 0:t.selectFeature,text:t==null?void 0:t.selectFeature,slot:"header-actions-end",bind:this,afterCreate:n=>this._storeFeatureSelectionAction(e,n),onclick:()=>this._handleOpenRelatedFeature(e)}):null,D("div",{class:this.classes(Ae.contentFlowItem,{[Ae.calciteThemeDark]:i,[Ae.calciteThemeLight]:!i})},e.render()))}renderFlowItemTooltips(e){const{messages:t,_exitRelatedRecordsActions:i,_featureSelectionActions:r}=this,s=ok(),n=r.get(e);return[D("calcite-tooltip",{class:this.classes({[Ae.calciteThemeDark]:!s,[Ae.calciteThemeLight]:s}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:t==null?void 0:t.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:i.get(e),placement:"top"},t==null?void 0:t.exitRelatedRecords),n?D("calcite-tooltip",{class:this.classes({[Ae.calciteThemeDark]:!s,[Ae.calciteThemeLight]:s}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:t==null?void 0:t.selectFeature,overlayPositioning:"fixed",referenceElement:n,placement:"top"},t==null?void 0:t.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?D("div",{key:ey("actions-menu-button"),class:this.classes(Ae.button,Ae.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},D("span",{"aria-hidden":"true",class:Ae.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?D("ul",{id:e,role:"menu","aria-labelledby":t,key:ey("actions"),class:Ae.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map(t=>this.renderAction({action:t,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?D("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:Ae.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?D("section",{key:ey("navigation"),class:this.classes(Ae.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,o={[Ae.footerHasPagination]:e,[Ae.footerHasActions]:s,[Ae.footerHasActionsMenu]:n};return e||s?D("div",{key:ey("feature-buttons"),class:this.classes(Ae.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=gh(e.selectedFeatures,{total:t.length});return D("section",{key:ey("menu"),class:Ae.featureMenu},D("strong",{class:Ae.featureMenuHeader},r),D("nav",{bind:this,class:Ae.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:y1},this.renderFeatureMenu(),D("div",{class:Ae.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?D("div",{class:Ae.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:D("div",{key:ey("pointer"),class:Ae.pointer,role:"presentation"},D("div",{class:this.classes(Ae.pointerDirection,Ae.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",f={[Ae.shadow]:e,[Ae.isCollapsible]:n,[Ae.isCollapsed]:a};return D("div",{class:this.classes(Ae.main,Ae.widget,f),tabIndex:l.closeButton?void 0:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?D("div",{class:Dn.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return D("span",{key:"text",class:Ae.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[Ae.iconLoading]:e.active,[Ae.rotating]:e.active,[Ae.icon]:!!t,[Ae.actionImage]:!e.active&&!!i};return t&&(r[t]=!e.active),D("span",{key:"icon","aria-hidden":"true",class:this.classes(Ae.icon,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={[Ae.action]:t.type!=="toggle",[Ae.actionToggle]:t.type==="toggle",[Ae.actionToggleOn]:t.type==="toggle"&&t.value,[Ae.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],o=i==="menu-item"?D("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(Ae.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):D("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(Ae.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[Ae.featureMenuSelected]:o},l=o?D("span",{key:ey(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:Ae.iconCheckMark}):null,c=D("span",{innerHTML:e.title||r.untitled});return D("li",{role:"menuitem",tabIndex:-1,key:ey(`feature-menu-feature-${s}`),class:this.classes(a,Ae.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},D("span",{class:Ae.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?D("ol",{class:Ae.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(i=>!!i.graphic).map((i,r)=>this.renderFeatureMenuItem(i,r))):null}_storeFeatureSelectionAction(e,t){this._featureSelectionActions.set(e,t),this.scheduleRender()}_storeExitRelatedRecordsAction(e,t){this._exitRelatedRecordsActions.set(e,t),this.scheduleRender()}_getFlowItemDescription(e){var t;return"featureCountDescription"in e?e.featureCountDescription:(t=e.viewModel.description)!=null?t:""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,i=t==null?void 0:t.geometry;if(C(i)||C(t))return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:i});const r=eTe(i);this.open({features:[t],location:v(r)?r:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){var l;const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i==null?void 0:i.attributes,o=(l=e.title)!=null?l:"",a=s==="zoom-to-feature"?gh(o,{messages:t}):s==="remove-selected-feature"?gh(o,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?gh(o,{messages:t}):e.title;return a&&n?gh(a,n):a!=null?a:""}_getActionClass(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:Ae.iconDefaultAction;return n&&i?gh(n,i):n!=null?n:""}_getActionImage(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{image:r}=e;return r&&i?gh(r,i):r!=null?r:""}_createFeatureUpdatedAnimation(){return lGe("enter",Ae.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(i=>{this._handles.add(te(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),i=this._getInlineActionCount(),r=i===null,s=i===0;return{inlineActions:r?t.slice(0):s?new Qe:t.slice(0,i),menuActions:r?new Qe:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,r;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?t.errorMessage:((r=e.viewModel)==null?void 0:r.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){Pc(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){Pc(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=Pc(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=Pc(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===r);if(!i)return;const o=i.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=Pc(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e!=null&&e.shouldFocus&&(await I0(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=te(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,i)=>this._selectedFeatureIndexUpdated(t,i));this._handles.add(e,Woe)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-t<o.top||s==="bottom"&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(C(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(S){return parseInt(S.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=i.getBoundingClientRect(),m=f+t,y=Math.max(p,c,h)+t,_=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"right",view:o}),b=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"left",view:o}),w=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"top",view:o}),T=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"bottom",view:o});return b?w?"bottom-right":"top-right":_?w?"bottom-left":"top-left":w?T?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return og(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,i=og(this.container)?"top-left":"top-right";if(!t)return i;const r=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-r.left-r.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&Object.assign(this._containerNode.style,r)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this;if(!i)return;const{padding:o}=i,a=r/2,l=i.height-t,c=i.width-e;return s==="bottom-center"?{top:t+n-o.top,left:e-a-o.left}:s==="top-left"?{bottom:l+n-o.bottom,right:c+n-o.right}:s==="bottom-left"?{top:t+n-o.top,right:c+n-o.right}:s==="top-right"?{bottom:l+n-o.bottom,left:e+n-o.left}:s==="bottom-right"?{top:t+n-o.top,left:e+n-o.left}:s==="top-center"?{bottom:l+n-o.bottom,left:e-a-o.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(C(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a=0,height:l=0}=i!=null?i:{};return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var a,l,c,h;const t=e.breakpoint,i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s)||!t)return!1;const n=t.hasOwnProperty("width")&&r<=((c=t.width)!=null?c:0),o=t.hasOwnProperty("height")&&s<=((h=t.height)!=null?h:0);return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?gh(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(e,Xoe),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new LXe({view:e}),e.ui.add(this._spinner,{key:Xoe,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex(n=>n.uid===t),s=i.getItemAt(r);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],Vt.prototype,"actionsMenuId",null),u([d({readOnly:!0})],Vt.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],Vt.prototype,"featureMenuId",null),u([d({readOnly:!0})],Vt.prototype,"titleId",null),u([d({readOnly:!0})],Vt.prototype,"contentId",null),u([d({readOnly:!0})],Vt.prototype,"hasContent",null),u([d({readOnly:!0})],Vt.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],Vt.prototype,"collapsible",null),u([d({readOnly:!0})],Vt.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],Vt.prototype,"contentCollapsed",null),u([d({readOnly:!0})],Vt.prototype,"dividedActions",null),u([d({readOnly:!0,dependsOn:["_flowItems.length"]})],Vt.prototype,"_activeFlowItemWidget",null),u([d()],Vt.prototype,"actions",null),u([d()],Vt.prototype,"actionsMenuOpen",null),u([d()],Vt.prototype,"alignment",void 0),u([d()],Vt.prototype,"autoCloseEnabled",null),u([d()],Vt.prototype,"autoOpenEnabled",null),u([d()],Vt.prototype,"defaultPopupTemplateEnabled",null),u([d()],Vt.prototype,"content",null),u([d()],Vt.prototype,"collapsed",void 0),u([d()],Vt.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],Vt.prototype,"currentAlignment",null),u([d({readOnly:!0})],Vt.prototype,"currentDockPosition",null),u([d()],Vt.prototype,"dockOptions",null),u([d()],Vt.prototype,"dockEnabled",void 0),u([d({readOnly:!0})],Vt.prototype,"featureCount",null),u([d()],Vt.prototype,"featureMenuOpen",void 0),u([d()],Vt.prototype,"features",null),u([d()],Vt.prototype,"goToOverride",null),u([d()],Vt.prototype,"headingLevel",void 0),u([d()],Vt.prototype,"highlightEnabled",null),u([d()],Vt.prototype,"location",null),u([d()],Vt.prototype,"label",null),u([d()],Vt.prototype,"maxInlineActions",void 0),u([d(),Es("esri/widgets/Popup/t9n/Popup")],Vt.prototype,"messages",void 0),u([d(),Es("esri/t9n/common")],Vt.prototype,"messagesCommon",void 0),u([d()],Vt.prototype,"promises",null),u([d({readOnly:!0})],Vt.prototype,"selectedFeature",null),u([d()],Vt.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Vt.prototype,"selectedFeatureWidget",null),u([d()],Vt.prototype,"spinnerEnabled",void 0),u([d()],Vt.prototype,"title",null),u([d()],Vt.prototype,"updateLocationEnabled",null),u([d()],Vt.prototype,"view",null),u([d({type:ETe}),O$(["triggerAction","trigger-action"])],Vt.prototype,"viewModel",void 0),u([d()],Vt.prototype,"visible",null),u([d()],Vt.prototype,"visibleElements",void 0),u([Zt("visibleElements")],Vt.prototype,"castVisibleElements",null),u([ln()],Vt.prototype,"_close",null),u([ln()],Vt.prototype,"_toggleDockEnabled",null),u([ln()],Vt.prototype,"_toggleFeatureMenu",null),u([ln()],Vt.prototype,"_toggleActionsMenu",null),u([ln()],Vt.prototype,"_triggerAction",null),u([ln()],Vt.prototype,"_selectFeature",null),u([ln()],Vt.prototype,"_next",null),u([ln()],Vt.prototype,"_previous",null),Vt=u([P("esri.widgets.Popup")],Vt);const Koe=Vt,CB=[0,0];function MZe(e){var r,s;const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return CB[0]=i.left+((r=t==null?void 0:t.pageXOffset)!=null?r:0),CB[1]=i.top+((s=t==null?void 0:t.pageYOffset)!=null?s:0),CB}function Qoe(e){e&&(J1e(e),e.parentNode&&e.parentNode.removeChild(e))}function RZe(e){const t=document.createElement("div");return e.appendChild(t),t}const QM=16,nD=750,OZe=512,IZe=2,PZe=e=>{let t=class extends e{constructor(...i){var r;super(...i),this._freqInfo={freq:QM,time:nD},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,i.length!==0&&((r=i[0])==null?void 0:r.popup)!==void 0||(this.popup=new Koe({view:this})),this.handles.add([te(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),te(()=>this.interacting,s=>{const{surface:n}=this;n&&n.setAttribute("data-interacting",s.toString())})])}initialize(){this.handles.add(te(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Be(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){var i;return(i=this._get("container"))!=null?i:null}set container(i){const r=this._get("container"),s=MU(i);if(s||typeof i!="string"||se.getLogger(this.declaredClass).error("#container",`element with id '${i}' not found`),r===s)return;const n="dom-size";if(this.handles.remove(n),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Qoe(this.root),this._set("root",null)),this.userContent&&(hne(this.userContent,r),Qoe(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",hne(s,o),s.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",s.insertBefore(a,s.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new One;a.appendChild(c.surface),this._set("overlay",c),te(()=>c.needsRender,h=>{h&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=GC({render:()=>{var p;return(p=this.overlay)==null?void 0:p.render()}}):this._overlayRenderTaskHandle=hs(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(te(()=>this.size,h=>{const[p,f]=h,m="esri-view-surface--inset-outline";p>=document.body.clientWidth||f>=document.body.clientHeight?l.classList.add(m):l.classList.remove(m)},st),n),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([te(()=>this.root,r=>{i.container=r?RZe(r):null},st),te(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},st)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=QM,i.time=nD,this.handles.add([(()=>{const r=()=>{i.freq=QM,i.time=nD};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),GC({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=QM,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?QM:Math.min(nD,n.freq*IZe),!s&&n.freq>=OZe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&MZe(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d({type:Koe})],t.prototype,"popup",null),u([d({type:One})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d()],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([P("esri.views.DOMContainer")],t),t},hQ=se.getLogger("esri.layers.support.ElevationSampler");class CTe{queryElevation(t){return ATe(t.clone(),this)}on(){return NZe}projectIfRequired(t,i){return MTe(t,i)}}class $Ze extends CTe{get spatialReference(){return this.extent.spatialReference}constructor(t,i,r){super(),this.tile=t,this.noDataValue=r;const s=t.tile.extent;this.extent=G6(s,i.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this._aaExtent=s;const n=wl(i.spatialReference),o=i.lodAt(t.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(t){const i=this.projectIfRequired(t,this.spatialReference);return!C(i)&&this.containsAt(i.x,i.y)}containsAt(t,i){return j6(this._aaExtent,t,i)}elevationAt(t,i){if(!this.containsAt(t,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return hQ.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return Ft(this.tile.sample(t,i),this.noDataValue)}}class VOt extends CTe{get spatialReference(){return this.extent.spatialReference}constructor(t,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?t.map(o=>new $Ze(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=G6(yi(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(t,i){for(const r of this.samplers)if(r.containsAt(t,i))return r.elevationAt(t,i);return hQ.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler`),this.noDataValue}}function ATe(e,t){const i=MTe(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":LZe(e,i,t);break;case"polyline":DZe(e,i,t);break;case"multipoint":FZe(e,i,t)}return e}function MTe(e,t){if(C(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=YT(e,t);return r||hQ.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function LZe(e,t,i){e.z=i.elevationAt(t.x,t.y)}function DZe(e,t,i){Qm.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Qm.x=c[0],Qm.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Qm.x,Qm.y)}}e.hasZ=!0}function FZe(e,t,i){Qm.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];Qm.x=o[0],Qm.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Qm.x,Qm.y)}e.hasZ=!0}const Qm=new ut,NZe={remove(){}};var jW;let Rm=jW=class extends ge{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new jW({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Rm.prototype,"cols",void 0),u([d({type:us,json:{write:!0}})],Rm.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],Rm.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Rm.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],Rm.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Rm.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],Rm.prototype,"scale",void 0),Rm=jW=u([P("esri.layers.support.LOD")],Rm);const hf=Rm;class kZe{constructor(t,i,r,s,n){this.id=t,this.level=i,this.row=r,this.col=s,this.extent=n}}var vv;const eae=new _i({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let da=vv=class extends ge{static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=et.WebMercator,numLODs:n=24}=e;if(!hl(s)){const p=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];p.push(new hf({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift(new hf({level:m,scale:f,resolution:f})),f*=2}return new vv({dpi:96,lods:p,origin:new ut(0,0,s),size:[r,r],spatialReference:s})}const o=E1(s),a=e.origin?new ut({x:e.origin.x,y:e.origin.y,spatialReference:s}):new ut(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(wl(s)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],m=f*c;h.push(new hf({level:p,scale:f,resolution:m}))}else{let p=dge(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/t);h.push(new hf({level:0,scale:p,resolution:p*c}));for(let m=1;m<f;m++){const y=p/2**t,_=y*c;h.push(new hf({level:m,scale:y,resolution:_})),p=y}}return new vv({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=E1(e);return e.isWrappable&&!!i&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return ut.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,i=0;const r=[],s=this._levelToLOD={};e&&(t=-1/0,i=1/0,e.forEach(n=>{r.push(n.scale),t=n.scale>t?n.scale:t,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+Math.log(s/e)/Math.log(s/n)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=i;else if(kn(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const c=YT(t,this.spatialReference);if(C(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new kZe(null,0,0,0,yi())),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=vv.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===vv.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(i=o)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=yi()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const i=this.lodAt(t.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return e[0]=this.origin.x+t.col*s,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+s,e[3]=e[1]+n,e}lodAt(e){var t,i;return(i=(t=this._levelToLOD)==null?void 0:t[e])!=null?i:null}clone(){return vv.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*t;i.push(new hf({level:n.level,scale:n.scale,resolution:o}))}return new vv({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};u([d({type:Number,json:{write:!0}})],da.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],da.prototype,"dpi",void 0),u([d({type:String,json:{read:eae.read,write:eae.write,origins:{"web-scene":{read:!1,write:!1}}}})],da.prototype,"format",void 0),u([d({readOnly:!0})],da.prototype,"isWrappable",null),u([d({type:ut,json:{write:!0}})],da.prototype,"origin",void 0),u([Fe("origin")],da.prototype,"readOrigin",null),u([d({type:[hf],value:null,json:{write:!0}})],da.prototype,"lods",null),u([d({readOnly:!0})],da.prototype,"minScale",void 0),u([d({readOnly:!0})],da.prototype,"maxScale",void 0),u([d({readOnly:!0})],da.prototype,"scales",void 0),u([d({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],da.prototype,"size",void 0),u([Fe("size",["rows","cols"])],da.prototype,"readSize",null),u([Ge("size",{cols:{type:us},rows:{type:us}})],da.prototype,"writeSize",null),u([d({type:et,json:{write:!0}})],da.prototype,"spatialReference",void 0),da=vv=u([P("esri.layers.support.TileInfo")],da),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(da||(da={}));const u4=da,UZe=12;class os{constructor(t){const i=os.checkUnsupported(t);if(v(i))throw i;const r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=_T(this.spatialReference)||Fg(this.spatialReference)||Ng(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new os(this.toTileInfo())}toTileInfo(){return new u4({dpi:this.dpi,origin:new ut({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>new hf({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=Eie(t[0]),i[1]=b5(t[1]),i[2]=Eie(t[2]),i[3]=b5(t[3])):this._isGCS&&(i[0]=Wt(t[0]),i[1]=Wt(t[1]),i[2]=Wt(t[2]),i[3]=Wt(t[3]))}getExtentGeometry(t,i,r,s=new Gi){return this.getExtent(t,i,r,Kf),s.spatialReference=this.spatialReference,s.xmin=Kf[0],s.ymin=Kf[1],s.xmax=Kf[2],s.ymax=Kf[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof os)){if(os.checkUnsupported(t))return!1;t=new os(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!tC(t.origin[0],this.origin[0],s)||!tC(t.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*UZe,tC(r,t.levels[i].resolution,s))}rootTilesInExtent(t,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(C(t)||n[0]===0||n[1]===0)return s;os.computeRowColExtent(t,n,this.origin,Kf);let o=Kf[1],a=Kf[3],l=Kf[0],c=Kf[2];const h=c-l,p=a-o;if(h*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return v(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,i,r,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-t[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!lIe(s.resolution,r/2**s.level))}static hasGapInLevels(t){const i=t.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return C(t)?dQ():t.lods.length<1?new H("tilingscheme:generic","Tiling scheme must have at least one level"):os.isPowerOfTwo(t)?os.hasGapInLevels(t)?new H("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):os.tileSizeSupported(t)?os.hasOriginPerLODs(t)?new H("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new H("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new H("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const r=t[2]-t[0],s=t[3]-t[1],n=wl(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new os(new u4({size:[a,a],origin:new ut({x:t[0]-.5*(o-r),y:t[3]+.5*(o-s)}),lods:[new hf({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const i=new os(os.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){const s=256/i,n=new os(new u4({size:[i,i],origin:new ut({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new hf({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function dQ(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}os.WebMercatorAuxiliarySphereTileInfo=new u4({size:[256,256],origin:new ut({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:et.WebMercator}),spatialReference:et.WebMercator,lods:[new hf({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),os.WebMercatorAuxiliarySphere=os.makeWebMercatorAuxiliarySphere(19);const Kf=yi(),kE=64,NO=512,VZe=2.5,eP=cIe(vG/10),RTe=2,OTe=yi();os.WebMercatorAuxiliarySphere.getExtent(0,0,0,OTe);const BZe=yi([-180,-90,180,90]),zZe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",GZe="Surface extent is too large for tile resolution at level 0.",jZe=3;let HZe=jZe;function HW(e){return e<4?3:HZe}let bv=class extends ps.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=eP}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||C(e.extent)||C(e.spatialReference))return null;const t=G6(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){var e;return Ft((e=this.view.basemapTerrain)==null?void 0:e.spatialReference,et.WGS84)}elevationAt(e,t){var i;if(C(this.extent)||!Bl(this.extent,e,t)){const r=v(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return se.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${r})`),this.noDataValue}return Ft((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return ATe(e.clone(),this)}};u([d({readOnly:!0})],bv.prototype,"demResolution",void 0),u([d({readOnly:!0})],bv.prototype,"extent",null),u([d({readOnly:!0})],bv.prototype,"noDataValue",void 0),u([d()],bv.prototype,"spatialReference",null),u([d({constructOnly:!0})],bv.prototype,"view",void 0),bv=u([P("esri.views.support.GroundViewElevationSampler")],bv);const qZe=bv;let wv=class extends Te{constructor(e){super(e),this._handles=new Ii,this.view=null,this.layerViews=new Qe}initialize(){this._handles.add(Qo(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new qZe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>te(()=>e.updating,()=>this._updateUpdating(),hr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],wv.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],wv.prototype,"updating",null),u([d({constructOnly:!0})],wv.prototype,"view",void 0),u([d({type:Qe,readOnly:!0})],wv.prototype,"layerViews",void 0),u([d({readOnly:!0})],wv.prototype,"suspended",null),wv=u([P("esri.views.GroundView")],wv);const WZe=wv,XZe=e=>{let t=class extends e{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:LG([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:v(s)?s.event:void 0,signal:v(s)?s.signal:void 0,defaultPopupTemplateEnabled:!!v(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(v(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const s=await this.popupHitTest(i),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,r)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),v(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return v(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([P("esri.views.PopupView")],t),t};let j3=class extends k3{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([NZ({Type:Ko,ensureType:zr(Ko)})],j3.prototype,"itemType",void 0),j3=u([P("esri.support.GraphicsCollection")],j3);let xv=class extends Te{constructor(e){super(e),this.view=null,this.baseLayerViews=new Qe,this.referenceLayerViews=new Qe,this._loadingHandle=te(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap},t=>{t&&t.load().catch(()=>{})},st)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,i;if(this.view&&this.view.suspended)return!1;const e=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([d({constructOnly:!0})],xv.prototype,"view",void 0),u([d({readOnly:!0})],xv.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],xv.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],xv.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],xv.prototype,"updating",null),xv=u([P("esri.views.BasemapView")],xv);function YZe(e){return"tryRecycleWith"in e}class ZZe{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=V1(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,fl(this._controller.signal,()=>{const s=new H("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}tryRecycle(t){if(!this.done||!this.layerView||!YZe(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<t.length;s++){const n=t[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){t.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(ii(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>fl(this._controller.signal,()=>h(lr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n,o;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let a,l;if(await i.load({signal:t}),"prefetchResources"in i&&await((s=i.prefetchResources)==null?void 0:s.call(i,{signal:t})),KZe(i))a=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new H("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(i);ii(t),a="default"in p?new p.default({layer:i,view:r}):new p({layer:i,view:r})}const c=()=>{l=hs(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=fl(t,c),ii(t);try{await a.when()}catch(p){throw c(),p}if(!((o=(n=this._map)==null?void 0:n.allLayers)==null?void 0:o.includes(i)))return c(),void this._deferred.reject(new H("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=a,i.emit("layerview-create",{view:r,layerView:a}),r.emit("layerview-create",{layer:i,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){i.emit("layerview-create-error",{view:r,error:a}),r.emit("layerview-create-error",{layer:i,error:a}),this.done=!0,this._deferred.reject(new H("layerview:create-error","layerview creation failed",{layer:i,error:a}))}}}let vd=class extends Te{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new fg,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const t=(i=this.view.map)==null?void 0:i.allLayers;if(t)for(const r of t)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(C(this._workPromise)&&(this._workPromise=V1(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(ZA(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var a,l,c;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),C(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,r=[],s=this.view.ready,n=h=>{if(!C(h)){for(const p of h)if(p){i.add(p);const f=this._layerLayerViewInfoMap.get(p);f&&s?f.start():f||this._recyclingInfoMap.has(p)||r.push(p),"layers"in p&&p.layers&&n(p.layers)}}};for(const h of this._rootCollectionNames)n(this.get(h));for(const[h,p]of this._layerLayerViewInfoMap)if(!i.has(h)){this._layerLayerViewInfoMap.delete(p.layer);const f=p.tryRecycle(r);f?(this._recyclingInfoMap.set(p.layer,p),f.then(()=>{this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[h,p]of this._recyclingInfoMap)i.has(h)||(this._recyclingInfoMap.delete(p.layer),p.destroy());for(const h of r)this._createLayerView(h);this._refreshCollections();const o=[(a=t==null?void 0:t.ground)==null?void 0:a.layers,(l=t==null?void 0:t.basemap)==null?void 0:l.baseLayers,(c=t==null?void 0:t.basemap)==null?void 0:c.referenceLayers,t==null?void 0:t.layers].filter(h=>!!h);i.forEach(h=>"layers"in h&&o.push(h.layers)),this.addHandles(o.map(h=>this._watchUpdatingTracking.addOnCollectionChange(()=>h,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Fs(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),te(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Gs)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,v(this._workPromise)&&(this._workPromise.reject(lr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return v(this._workPromise)||this._watchUpdatingTracking.updating||za(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new H("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=i,t.getItemAt(r)!==o&&t.splice(r,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new ZZe(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{var r,s;i&&(Ws(i)||i.name==="cancelled:layerview-create")||se.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${(r=e.title)!=null?r:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],vd.prototype,"_workPromise",void 0),u([d({readOnly:!0})],vd.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],vd.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],vd.prototype,"_rootCollectionNames",null),u([d()],vd.prototype,"layerViewImporter",void 0),u([d()],vd.prototype,"supportsGround",void 0),u([d({readOnly:!0})],vd.prototype,"updating",null),u([d({readOnly:!0})],vd.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],vd.prototype,"view",void 0),vd=u([P("esri.views.LayerViewManager")],vd);const JZe=vd;function KZe(e){return"createLayerView"in e&&e.createLayerView!=null}let ih=class extends Te{constructor(e){super(e),this.factor=1.5,this.offset=ip(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],ih.prototype,"factor",void 0),u([d({nonNullable:!0})],ih.prototype,"offset",void 0),u([d()],ih.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],ih.prototype,"size",void 0),u([d()],ih.prototype,"maskUrl",void 0),u([d()],ih.prototype,"maskEnabled",void 0),u([d()],ih.prototype,"overlayUrl",void 0),u([d()],ih.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],ih.prototype,"version",null),u([d({type:Boolean})],ih.prototype,"visible",void 0),ih=u([P("esri.views.Magnifier")],ih);const ITe=ih;class QZe{constructor(){this._tasks=new Array,this._running=new hk(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask(t){for(;!t.done&&this._process(t);)t.madeProgress()}push(t,i,r){return this._running.set(!0),new Promise((s,n)=>this._tasks.push(new tae(s,n,t,i,r)))}unshift(t,i,r){return this._running.set(!0),new Promise((s,n)=>this._tasks.unshift(new tae(s,n,t,i,r)))}_process(t){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const s=So(i.signal);if(s&&!i.abortCallback)i.reject(lr());else{const n=s?(r=i.abortCallback)==null?void 0:r.call(i,lr()):i.callback(t);Yh(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(s){i.reject(s)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const t=lr();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(t);i.resolve(r)}else i.reject(t);this._tasks.length=0,this._running.set(!1)}}class tae{constructor(t,i,r,s,n){this.resolve=t,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}}let kO=class extends Te{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],kO.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],kO.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),kO=u([P("esri.views.support.DebugFlags")],kO);const eJe=new kO;var Di;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Di||(Di={}));function tJe(){return new dk.Scheduler}var Wa,xt;(function(e){e[e.YIELD=1]="YIELD"})(Wa||(Wa={})),function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e[e.TEST_PRIO=1]="TEST_PRIO"}(xt||(xt={}));const qm=0,iae=new Map([[xt.RESOURCE_CONTROLLER_IMMEDIATE,qm],[xt.RESOURCE_CONTROLLER,4],[xt.SLIDE,qm],[xt.STREAM_DATA_LOADER,qm],[xt.ELEVATION_QUERY,qm],[xt.TERRAIN_SURFACE,1],[xt.SURFACE_GEOMETRY_UPDATES,1],[xt.LOD_RENDERER,2],[xt.GRAPHICS_CORE,2],[xt.I3S_CONTROLLER,2],[xt.POINT_CLOUD_LAYER,2],[xt.FEATURE_TILE_FETCHER,2],[xt.OVERLAY,4],[xt.STAGE,4],[xt.GRAPHICS_DECONFLICTOR,4],[xt.FILTER_VISIBILITY,4],[xt.SCALE_VISIBILITY,4],[xt.FRUSTUM_VISIBILITY,4],[xt.CLOUDS_GENERATOR,4],[xt.POINT_OF_INTEREST_FREQUENT,6],[xt.POINT_OF_INTEREST_INFREQUENT,30],[xt.LABELER,8],[xt.FEATURE_QUERY_ENGINE,8],[xt.FEATURE_TILE_TREE,16],[xt.FEATURE_TILE_TREE_ACTIVE,qm],[xt.ELEVATION_ALIGNMENT,12],[xt.TEXT_TEXTURE_ATLAS,12],[xt.TEXTURE_UNLOAD,12],[xt.LINE_OF_SIGHT_TOOL,16],[xt.LINE_OF_SIGHT_TOOL_INTERACTIVE,qm],[xt.SNAPPING,qm],[xt.SHADOW_ACCUMULATOR,30]]);function rae(e){return iae.has(e)?iae.get(e):typeof e=="number"?e:1}const sae=6.5,nae=1,iJe=30,oae=1e3/30,aae=100,lae=.9;var dk,Rb;(function(e){class t{get updating(){return this._updating.get()}_updatingChanged(){this._updating.set(this._tasks.some(n=>n.needsUpdate))}constructor(){this._updating=new hk(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new l0("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Di.INTERACTING,this._tasks=new ri,this._runQueue=new ri,this._load=0,this._idleStateCallbacks=new ri,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=te(()=>eJe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,st);for(const o of Object.keys(xt))this.performanceInfo.tasks.set(xt[o],new l0(xt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:sae,INTERACTING_BUDGET:oae,IDLE_BUDGET:aae,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),hs(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=rae(n),l=new i(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new l0(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Di.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Di.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Di.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=sae,a=n.frameDuration,l=nae;switch(this.state){case Di.IDLE:o=0,a=Math.max(aae,n.frameDuration),l=iJe;break;case Di.INTERACTING:a=Math.max(oae,n.frameDuration);case Di.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Di.IDLE&&a<nae&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Di.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Di.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return Rb.SCHEDULED;let o=Rb.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=Rb.READY:o!==Rb.READY&&(o=Rb.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*lae+n*(1-lae)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===qm&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==qm&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Wa.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){se.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,xt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(xt))this._frameTaskTimes.set(xt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}e.Scheduler=t;class i{get task(){return this._task.get()}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new QZe,this._handles=new Ii,this.schedulePriority=this._basePriority,this._task=new hk(v(a)?a:this._queue),this._handles.add(Qo(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(Hl),this._scheduler.removeTask(this),this.schedule=gA.schedule,this.reschedule=gA.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=rae(n);this._basePriority!==qm&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance!="undefined"?performance.now():0,this._budget=0,this._state=Di.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=r})(dk||(dk={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(Rb||(Rb={}));const Hl=(()=>{const e=new dk.Budget;return e.enabled=!1,e})();class rJe{remove(){}processQueue(){}schedule(t,i,r){try{if(So(i)){const s=lr();return r?Promise.resolve(r(s)):Promise.reject(s)}return DG(t(Hl))}catch(s){return Promise.reject(s)}}reschedule(t,i,r){return this.schedule(t,i,r)}}const gA=new rJe;let UE=class extends Te{constructor(e,t){var i;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i=t==null?void 0:t.registerTask(xt.TEXTURE_UNLOAD))!=null?i:gA}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=t();s={referenceCount:0,texture:n,textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(n),this._stage.loadImmediate(n)),this._textureRequests.set(r,s)}return s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return v(t)?`${e}.${t}px`:e}};u([d()],UE.prototype,"_frameTask",void 0),u([d()],UE.prototype,"updating",null),UE=u([P("esri.views.3d.support.TextureCollection")],UE);var cae;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(cae||(cae={}));const PTe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],$Te={};function LTe(e){return!!$Te[e]}function sJe(e){for(const t of e)if(!LTe(t))return!1;return!0}PTe.forEach(e=>{$Te[e]=!0});class nJe{constructor(t){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this._handlers.forEach(({handler:i,priority:r},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((t,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(t,i,r,s){const n=Array.isArray(t)?t:t.split(",");if(!sJe(n))return n.some(LTe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s!=null?s:P1.DEFAULT;const l=this._createUniqueGroupName(),c=new oJe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this._handlerCounts.get(t)}_removeHandler(t,i){if(this._handlers.has(t)){this._handlers.delete(t);for(const r of i){const s=this._handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}}class oJe extends Oa{constructor(t,i,r,s){super(!0),this._latestDragStart=void 0,this.view=t;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:ip(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(ip(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=t,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:Zl(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:m}=t;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var tP,uae,hae;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(tP||(tP={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(uae||(uae={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(hae||(hae={}));function aJe(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return se.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function qW(e){return e.visible&&e.getEditableFlag!=null&&e.getEditableFlag(tP.USER)&&e.getEditableFlag(tP.MANAGER)}function Om(e){return ip(e.x,e.y)}function BOt(e){return $s(e.x,e.y)}function DTe(e,t){var r;const i=(r=e instanceof HTMLElement?e:e.surface)==null?void 0:r.getBoundingClientRect();return i?ip(t.clientX-i.left,t.clientY-i.top):ip(0,0)}function dae(e,t){return t instanceof Event?DTe(e,t):Om(t)}function pae(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class lJe{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":fae(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!mae(t))break;const s=Om(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(C(n))break;const o=n.manipulator,a=n.tool;!(v(o)&&v(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(t)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,t,i),v(o)&&v(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(t)&&!o.grabbing&&(this._grabbedManipulators.set(t.pointerId,{manipulator:o,tool:a,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&C(i.activeTool)&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(t.pointerId)||this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!mae(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=Mn(s,({manipulator:h})=>h),o=Mn(s,({tool:h})=>h);if(C(n)||C(o))break;const a=Om(t);a.x=ye(a.x,0,i.view.width),a.y=ye(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(t.pointerId);switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=Om(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(cJe(t)||i.forEachTool(c=>{if((!v(n)||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),C(n))break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=t.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:r});break}case"click":{const s=Om(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=v(n)?n.manipulator:null;if(C(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{const s=Om(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=v(n)?n.manipulator:null;if(C(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=Om(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=v(n)?n.manipulator:null;if(C(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Om(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===t&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(r.setActiveTool)}_handlePointerEnd(t,i){const r=Mn(this._grabbedManipulators.get(t.pointerId),({manipulator:s})=>s);C(r)||r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:Om(t)}),this._grabbedManipulators.delete(t.pointerId),this._afterManipulatorUngrab(i.setActiveTool))}_cursorFromMap(t){let i=null;return za(t,({manipulator:r})=>!(C(r)||!r.interactive)&&(r.grabbing&&r.grabCursor?(i=r.grabCursor,!0):!!r.cursor&&(i=r.cursor,!0))),i}_onFocusChange(t){this._updateCursor(),this._updateFocusedManipulatorTools(t)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),t(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=pPe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=v(o)?o.manipulator:null})}clearPointers(t,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===t&&(C(n)||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(r),this._onFocusChange(i)}_intersect(t,i,r){let s=null;return r(n=>{if(n.manipulators==null||!qW(n))return!1;const o=n.manipulators.intersect(t,i);return!C(o)&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(ip(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!fae(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Om(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){let n=this._intersect(t,r,s);const o=Mn(this._hoveredManipulators.get(i),({manipulator:a})=>a);v(n)&&!n.manipulator.interactive&&(n=null),v(n)&&o===n.manipulator||(v(o)&&(o.hovering=!1),v(n)?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorUngrab(t){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(t(null),this._revertToNullActiveTool=!1)}}function fae(e){return e==="mouse"}function mae(e){return e.pointerType!=="mouse"||e.button===0}function cJe(e){return!!e.native.shiftKey}const gae="attached",AB="tools";let Ny=class extends BI{constructor(e){super(e),this._manipulatorState=new lJe,this.tools=new Qe,this.cursor=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.handles.add([this.view.on(PTe,e=>{this._handleInputEvent(e)},P1.TOOL),...aJe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(v(e)&&!this.view.ready)return void se.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),v(t)&&t.deactivate(),v(e)&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const r=qW(i);!C(this.activeTool)&&r||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!r)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){var e;this.view.type==="3d"?(this._set("textures",new UE(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([te(()=>{const{state:t}=this.view;return"camera"in t&&t.camera},()=>this._forEachManipulator(t=>t.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",t=>this._forEachManipulator(i=>i.onElevationChange(t))),Df(()=>this._set("textures",Be(this.textures)))],gae)):this.handles.add(te(()=>this.view.extent,()=>this._forEachManipulator(t=>t.onViewChange())))}detach(){v(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(gae)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};v(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),!t&&v(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(AB),this._forEachTool(e=>{if(e instanceof Te){const t=te(()=>[e.cursor,e.visible,e.editable],()=>{qW(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(t,AB)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],AB)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var t;(t=e.setEditableFlag)==null||t.call(e,tP.MANAGER,C(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;C(e)&&this._forEachTool(t=>!(!v(t.cursor)||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(C(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([d({constructOnly:!0,nonNullable:!0})],Ny.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],Ny.prototype,"textures",void 0),u([d({value:null})],Ny.prototype,"activeTool",null),u([d({readOnly:!0,type:Qe})],Ny.prototype,"tools",void 0),u([d({readOnly:!0})],Ny.prototype,"cursor",void 0),u([d({readOnly:!0})],Ny.prototype,"updating",null),Ny=u([P("esri.views.ToolViewManager")],Ny);const uJe=Ny;let iE=class extends Te{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":hJe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return dJe[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],iE.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],iE.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],iE.prototype,"axisThreshold",null),iE=u([P("esri.views.input.gamepad.GamepadInputDevice")],iE);const hJe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),dJe={standard:.15,spacemouse:.025,unknown:0},pQ=iE;let UO=class extends Te{constructor(...e){super(...e),this.devices=new Qe,this.enabledFocusMode="document"}};u([d({type:Qe.ofType(pQ),readOnly:!0})],UO.prototype,"devices",void 0),u([d({type:["document","view","none"]})],UO.prototype,"enabledFocusMode",void 0),UO=u([P("esri.views.input.gamepad.GamepadSettings")],UO);const pJe=UO;let h4=class extends Te{constructor(){super(...arguments),this.gamepad=new pJe}};u([d({readOnly:!0})],h4.prototype,"gamepad",void 0),h4=u([P("esri.views.input.Input")],h4);const fJe=h4;let Tv=class extends Te{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],Tv.prototype,"enabled",void 0),u([d({type:pQ})],Tv.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],Tv.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],Tv.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],Tv.prototype,"velocityFactor",void 0),Tv=u([P("esri.views.navigation.gamepad.GamepadSettings")],Tv);const FTe=Tv;let qw=class extends Te{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new FTe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],qw.prototype,"browserTouchPanEnabled",void 0),u([d({type:FTe,nonNullable:!0})],qw.prototype,"gamepad",void 0),u([d({type:Boolean})],qw.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],qw.prototype,"mouseWheelZoomEnabled",void 0),qw=u([P("esri.views.navigation.Navigation")],qw);const NTe=qw;function zOt(e,t,i){const r=kTe(e),s=t,n=mJe(r,s,i);if(r){const o=cM.deriveUnitFromSR(r,e.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new H("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!gJe(e)||n===fu.Unsupported)return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case fu.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new H("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case fu.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new H("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case fu.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new H("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function mJe(e,t,i){if(!yae(e)||!yae(t))return fu.Unsupported;if(e==null||t==null)return fu.Ok;if(!i&&e.heightUnit!==t.heightUnit)return fu.Units;if(e.heightModel!==t.heightModel)return fu.HeightModel;switch(e.heightModel){case"gravity-related-height":return fu.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?fu.Ok:fu.CRS;default:return fu.Unsupported}}var fu;function yae(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function gJe(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!BTe(e)}function kTe(e){var r;const t=e.url?oM(e.url):void 0;return!(((r=e.spatialReference)==null?void 0:r.vcsWkid)==null&&v(t)&&t.serverType==="ImageServer")&&UTe(e)&&e.heightModelInfo?e.heightModelInfo:BTe(e)?cM.deriveUnitFromSR(_Je,e.spatialReference):null}function UTe(e){return"heightModelInfo"in e}function VTe(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function BTe(e){return VTe(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):zTe(e)}function yJe(e){return e.layers!=null||zTe(e)||VTe(e)||UTe(e)}function zTe(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(fu||(fu={}));const _Je=new cM({heightModel:"gravity-related-height"});var je;function _ae(e){return e==="global"?je.Global:je.Local}function H3(e){return e===je.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(je||(je={}));let WW,MB=null;async function vJe(e){MB||(MB=Q(()=>Promise.resolve().then(function(){return Dyt}),void 0).then(t=>WW=t)),await MB,ii(e)}async function GTe(e,t,i,r){if(!e)return null;const s=e.spatialReference;return EU()||q1(s,t)?fM(e,t):WW?WW.projectGeometry(e,t,i,r):(await Promise.race([vJe(r),qI(r)]),GTe(e,t,i,r))}let vs=class extends Te{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=ep(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return v(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return C(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,r,s,n;const e=(i=this.map)==null?void 0:i.call(this),t=[];return v(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(r=e==null?void 0:e.basemap)==null?void 0:r.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);v(a)&&(i=a)}if(v(i)&&i.length===1)break}if(t&&(C(i)||i.length!==1))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:v(r)?r.spatialReference:null,viewingMode:v(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,r,s,n,o,a,l,c;if(!this.required.tileInfo)return(i=this._get("_tileInfoTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var i,r,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))==null?void 0:i.heightModelInfo))return(r=this._get("_heightModelInfoTask"))!=null?r:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(yJe(o)){const a=kTe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var r,s;if(this.suspended||!this.required.extent)return(r=this._get("_extentCandidatesTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(v(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)i.push({extent:c,layer:n})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(C(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:v(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(v(this._projectExtentTask.task)&&(this._projectExtentTask.task=ep(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:C$(async s=>{try{const n=await GTe(i.extent,r,i.layer.portalItem,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:n}}catch{if(So(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(C(e))return t;const i=[],r=(s,n)=>v(s)?v(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=r(s.viewingMode,n.viewingMode);if(o!==!1){i.push({spatialReference:s.spatialReference,viewingMode:o});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return C(e)||e.length<1?v(t)?{spatialReference:t,viewingMode:null}:null:(v(t)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==je.Local)&&(e=e.filter(({viewingMode:i})=>i!==je.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const r of t){const s=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(v(s)){const n=v(s.constraints)?s.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||C(this.userSpatialReference)||o.equals(this.userSpatialReference))&&i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const r of e)if(this._collectCollection(r,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};u([d()],vs.prototype,"required",void 0),u([d({constructOnly:!0})],vs.prototype,"map",void 0),u([d({constructOnly:!0})],vs.prototype,"getSpatialReferenceSupport",void 0),u([d()],vs.prototype,"defaultSpatialReference",void 0),u([d()],vs.prototype,"userSpatialReference",void 0),u([d()],vs.prototype,"sourcePreloadCount",void 0),u([d()],vs.prototype,"priorityCollection",void 0),u([d()],vs.prototype,"requiresExtentInSpatialReference",void 0),u([d()],vs.prototype,"suspended",void 0),u([d({readOnly:!0})],vs.prototype,"ready",null),u([d({readOnly:!0})],vs.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],vs.prototype,"spatialReference",null),u([d({readOnly:!0})],vs.prototype,"extent",null),u([d({readOnly:!0})],vs.prototype,"heightModelInfo",null),u([d({readOnly:!0})],vs.prototype,"vcsWkid",null),u([d({readOnly:!0})],vs.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],vs.prototype,"viewingMode",null),u([d({readOnly:!0})],vs.prototype,"tileInfo",null),u([d({readOnly:!0})],vs.prototype,"mapCollections",null),u([d({readOnly:!0})],vs.prototype,"_allLayers",null),u([d({readOnly:!0})],vs.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],vs.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],vs.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],vs.prototype,"_extentCandidatesTask",null),u([d()],vs.prototype,"_extentTask",null),u([d()],vs.prototype,"_projectExtentTask",void 0),vs=u([P("esri.views.support.DefaultsFromMap")],vs);var d4;let jt=d4=class extends jf(ps.EventedMixin(p$(Te))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new cA({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new j3,this.analyses=new pA,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Qe,this.magnifier=new ITe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new oA,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new fJe,this.navigation=new NTe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new nJe(this),this.persistableViewModels=new Qe,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(te(()=>this.preconditionsReady,t=>{var i,r;t?(this._currentSpatialReference=this.spatialReference,d4.views.add(this)):(this._currentSpatialReference=null,d4.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((i=this.toolViewManager)==null||i.detach(),v(this.analysisViewManager)&&this.analysisViewManager.detach(),(r=this.layerViewManager)==null||r.clear(),this._teardown()):t&&!this.ready&&(this._startup(),v(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},hr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,I0(()=>this.ready)))),this.basemapView=new xv({view:this}),this.layerViewManager=new JZe({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new uJe({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([te(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},{sync:!0,initial:!0}),te(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),te(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([te(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(t&&!this.spatialReference&&i){if(v(e))return;const s=Df(()=>e=ep(e));e=C$(async n=>{try{await M0(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}se.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Be(this.graphics),this.analyses=Be(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Be(this.analysisViewManager),this.toolViewManager=Be(this.toolViewManager),this.layerViewManager=Be(this.layerViewManager),this.basemapView=Be(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return se.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var e;return(e=this.toolViewManager)==null?void 0:e.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new vs({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||sp.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e!=null&&e.destroyed&&(se.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:e}),e=null),sp.isLoadable(e)&&e.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,i;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((i=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:i.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!kn(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var e;return(e=this.toolViewManager)==null?void 0:e.tools}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return v(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,i;return(i=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?i:null}importLayerView(e){throw new H("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return v(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&se.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(Qo(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};jt.views=new Qe,u([d()],jt.prototype,"_userSpatialReference",void 0),u([d()],jt.prototype,"activeTool",null),u([d({readOnly:!0})],jt.prototype,"allLayerViews",void 0),u([d()],jt.prototype,"groundView",void 0),u([d()],jt.prototype,"animation",null),u([d()],jt.prototype,"basemapView",void 0),u([d()],jt.prototype,"center",null),u([d({readOnly:!0})],jt.prototype,"_defaultsFromMapSettings",null),u([d()],jt.prototype,"defaultsFromMap",null),u([d()],jt.prototype,"fatalError",void 0),u([d({type:Gi})],jt.prototype,"extent",null),u([d(fW(j3,"graphics"))],jt.prototype,"graphics",void 0),u([d(fW(pA,"analyses"))],jt.prototype,"analyses",void 0),u([d({readOnly:!0,type:cM})],jt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],jt.prototype,"interacting",null),u([d({readOnly:!0})],jt.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],jt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],jt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:Qe,readOnly:!0})],jt.prototype,"layerViews",void 0),u([d()],jt.prototype,"resolution",null),u([d({type:ITe})],jt.prototype,"magnifier",void 0),u([d({value:null,type:Z1e})],jt.prototype,"map",null),u([d()],jt.prototype,"padding",void 0),u([d({readOnly:!0})],jt.prototype,"ready",void 0),u([d({type:et})],jt.prototype,"spatialReference",null),u([d()],jt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],jt.prototype,"stationary",null),u([d({readOnly:!0})],jt.prototype,"supportsGround",void 0),u([d({type:Ts})],jt.prototype,"timeExtent",void 0),u([d({type:oA,nonNullable:!0})],jt.prototype,"timeReference",void 0),u([d()],jt.prototype,"tools",null),u([d()],jt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],jt.prototype,"type",void 0),u([d({type:Number})],jt.prototype,"scale",void 0),u([d({readOnly:!0})],jt.prototype,"updating",void 0),u([d({readOnly:!0})],jt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],jt.prototype,"initialExtent",null),u([d()],jt.prototype,"cursor",null),u([d({readOnly:!0})],jt.prototype,"input",void 0),u([d({type:NTe,nonNullable:!0})],jt.prototype,"navigation",void 0),u([d()],jt.prototype,"layerViewManager",void 0),u([d()],jt.prototype,"analysisViewManager",void 0),u([d()],jt.prototype,"width",void 0),u([d()],jt.prototype,"height",void 0),u([d({readOnly:!0})],jt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],jt.prototype,"size",null),u([d({readOnly:!0})],jt.prototype,"suspended",void 0),u([d({readOnly:!0})],jt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],jt.prototype,"persistableViewModels",void 0),u([d()],jt.prototype,"_isValid",void 0),u([d()],jt.prototype,"_readyCycleForced",void 0),u([d()],jt.prototype,"_currentSpatialReference",void 0),jt=d4=u([P("esri.views.View")],jt);const bJe=jt;let Sv=class extends O5{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new H("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,t){t||(t=Yh(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],Sv.prototype,"done",null),u([d({readOnly:!0,type:String})],Sv.prototype,"state",void 0),u([d()],Sv.prototype,"target",void 0),Sv=u([P("esri.views.ViewAnimation")],Sv),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Sv||(Sv={}));const yA=Sv,eR=()=>Q(()=>import("./TileLayerView3D.119d1a0a.js"),["assets/TileLayerView3D.119d1a0a.js","assets/LayerView3D.22fe02a7.js","assets/TiledLayerView3D.f08d70b8.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/MapServiceLayerViewHelper.127f6359.js","assets/floorFilterUtils.4de71259.js","assets/sublayerUtils.f556487c.js","assets/popupUtils.1c2a1560.js","assets/drapedUtils.05665b86.js"]),vae=()=>Q(()=>import("./ElevationLayerView3D.7e2a70ef.js"),["assets/ElevationLayerView3D.7e2a70ef.js","assets/LayerView3D.22fe02a7.js","assets/TiledLayerView3D.f08d70b8.js","assets/LayerView.e649b0cd.js"]),bae={"base-dynamic":()=>Q(()=>import("./BaseDynamicLayerView3D.eaadd9c5.js"),["assets/BaseDynamicLayerView3D.eaadd9c5.js","assets/DynamicLayerView3D.eca102f4.js","assets/LayerView3D.22fe02a7.js","assets/projectExtentUtils.85b203bb.js","assets/ImageMaterial.e7dff857.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js"]),"base-elevation":vae,"base-tile":eR,"bing-maps":eR,"building-scene":()=>Q(()=>import("./BuildingSceneLayerView3D.8f1857d6.js"),["assets/BuildingSceneLayerView3D.8f1857d6.js","assets/BuildingGroupSublayer.d828d7bf.js","assets/BuildingComponentSublayer.b5aff654.js","assets/capabilities.26cf9b42.js","assets/I3SIndexInfo.827c76ac.js","assets/I3SLayerDefinitions.a18219e8.js","assets/I3SUtil.1e58a9c4.js","assets/I3SBinaryReader.79df5733.js","assets/popupUtils.1c2a1560.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/I3SMeshView3D.08bfe523.js","assets/I3SOverrides.2698062a.js","assets/I3SNode.332c5ead.js","assets/RenderTexture.a0a012a6.js","assets/FeatureLayerView3D.7a3df420.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/SceneModification.8c38e9b3.js","assets/persistable.758b5afb.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.2d9abca0.js","assets/SceneLayerWorker.caa7fdf8.js","assets/I3SQueryFeatureStore.e8919216.js","assets/DefinitionExpressionSceneLayerView.d0adfacd.js"]),csv:()=>Q(()=>import("./CSVLayerView3D.b4491b09.js"),["assets/CSVLayerView3D.b4491b09.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js"]),dimension:()=>Q(()=>import("./DimensionLayerView3D.7da6af13.js"),["assets/DimensionLayerView3D.7da6af13.js","assets/LayerView3D.22fe02a7.js","assets/LayerView.e649b0cd.js"]),elevation:vae,feature:()=>Q(()=>import("./FeatureLayerView3D.7a3df420.js"),["assets/FeatureLayerView3D.7a3df420.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js"]),geojson:()=>Q(()=>import("./GeoJSONLayerView3D.072e9d5a.js"),["assets/GeoJSONLayerView3D.072e9d5a.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js"]),graphics:()=>Q(()=>import("./GraphicsLayerView3D.975ceba4.js"),["assets/GraphicsLayerView3D.975ceba4.js","assets/LayerView3D.22fe02a7.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/GraphicsProcessor.dcdbca5b.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView.e649b0cd.js"]),group:()=>Q(()=>import("./GroupLayerView.5375e6c9.js"),["assets/GroupLayerView.5375e6c9.js","assets/LayerView.e649b0cd.js"]),imagery:()=>Q(()=>import("./ImageryLayerView3D.e6629c25.js"),["assets/ImageryLayerView3D.e6629c25.js","assets/DynamicLayerView3D.eca102f4.js","assets/LayerView3D.22fe02a7.js","assets/projectExtentUtils.85b203bb.js","assets/ImageMaterial.e7dff857.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/popupUtils.1c2a1560.js"]),"integrated-mesh":()=>Q(()=>import("./IntegratedMeshLayerView3D.927c7c43.js"),["assets/IntegratedMeshLayerView3D.927c7c43.js","assets/I3SMeshView3D.08bfe523.js","assets/I3SOverrides.2698062a.js","assets/I3SNode.332c5ead.js","assets/I3SUtil.1e58a9c4.js","assets/I3SBinaryReader.79df5733.js","assets/RenderTexture.a0a012a6.js","assets/FeatureLayerView3D.7a3df420.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/SceneModification.8c38e9b3.js","assets/persistable.758b5afb.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.2d9abca0.js","assets/SceneLayerWorker.caa7fdf8.js"]),"line-of-sight":()=>Q(()=>import("./LineOfSightLayerView3D.e3beae9c.js"),["assets/LineOfSightLayerView3D.e3beae9c.js","assets/LayerView3D.22fe02a7.js","assets/LayerView.e649b0cd.js"]),"map-image":()=>Q(()=>import("./MapImageLayerView3D.a60989b6.js"),["assets/MapImageLayerView3D.a60989b6.js","assets/DynamicLayerView3D.eca102f4.js","assets/LayerView3D.22fe02a7.js","assets/projectExtentUtils.85b203bb.js","assets/ImageMaterial.e7dff857.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/ExportImageParameters.23657883.js","assets/floorFilterUtils.4de71259.js","assets/sublayerUtils.f556487c.js","assets/MapServiceLayerViewHelper.127f6359.js","assets/popupUtils.1c2a1560.js","assets/drapedUtils.05665b86.js"]),media:()=>Q(()=>import("./MediaLayerView3D.0d328653.js"),["assets/MediaLayerView3D.0d328653.js","assets/MediaElementView.1aa9b5f7.js","assets/normalizeUtilsSync.af0c844c.js","assets/LayerView3D.22fe02a7.js","assets/ImageMaterial.e7dff857.js","assets/LayerView.e649b0cd.js"]),"ogc-feature":()=>Q(()=>import("./OGCFeatureLayerView3D.fcee4f43.js"),["assets/OGCFeatureLayerView3D.fcee4f43.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js"]),"open-street-map":eR,"oriented-imagery":()=>Q(()=>import("./FeatureLayerView3D.7a3df420.js"),["assets/FeatureLayerView3D.7a3df420.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js"]),"point-cloud":()=>Q(()=>import("./PointCloudLayerView3D.19360174.js").then(function(e){return e.P}),["assets/PointCloudLayerView3D.19360174.js","assets/LayerView3D.22fe02a7.js","assets/I3SUtil.1e58a9c4.js","assets/I3SBinaryReader.79df5733.js","assets/PointCloudWorkerUtil.c0b97c18.js","assets/PointCloudUniqueValueRenderer.edd5a5a2.js","assets/PopupSceneLayerView.f62f4c42.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js"]),voxel:()=>Q(()=>import("./VoxelLayerView3D.18ae0f82.js"),["assets/VoxelLayerView3D.18ae0f82.js","assets/LayerView3D.22fe02a7.js","assets/PopupSceneLayerView.f62f4c42.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js"]),route:()=>Q(()=>import("./RouteLayerView3D.b49ac362.js"),["assets/RouteLayerView3D.b49ac362.js","assets/Stop.d94a9ad1.js","assets/LayerView3D.22fe02a7.js","assets/GraphicsProcessor.dcdbca5b.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/projectExtentUtils.85b203bb.js","assets/EventedSet.6d14d441.js","assets/LayerView.e649b0cd.js"]),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?Q(()=>import("./SceneLayerView3D.4a177bbb.js"),["assets/SceneLayerView3D.4a177bbb.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/floorFilterUtils.4de71259.js","assets/I3SMeshView3D.08bfe523.js","assets/I3SOverrides.2698062a.js","assets/I3SNode.332c5ead.js","assets/I3SUtil.1e58a9c4.js","assets/I3SBinaryReader.79df5733.js","assets/RenderTexture.a0a012a6.js","assets/FeatureLayerView3D.7a3df420.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/SceneModification.8c38e9b3.js","assets/persistable.758b5afb.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.2d9abca0.js","assets/SceneLayerWorker.caa7fdf8.js","assets/SceneLayerView.93f9ca30.js","assets/DefinitionExpressionSceneLayerView.d0adfacd.js","assets/I3SQueryFeatureStore.e8919216.js","assets/PopupSceneLayerView.f62f4c42.js"]):Q(()=>import("./SceneLayerGraphicsView3D.28306ff6.js"),["assets/SceneLayerGraphicsView3D.28306ff6.js","assets/I3SOverrides.2698062a.js","assets/I3SNode.332c5ead.js","assets/I3SUtil.1e58a9c4.js","assets/I3SBinaryReader.79df5733.js","assets/RenderTexture.a0a012a6.js","assets/FeatureLayerView3D.7a3df420.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/SceneLayerView.93f9ca30.js","assets/DefinitionExpressionSceneLayerView.d0adfacd.js","assets/PopupSceneLayerView.f62f4c42.js"]),stream:()=>Q(()=>import("./StreamLayerView3D.beb54997.js"),["assets/StreamLayerView3D.beb54997.js","assets/StreamFeatureManager.8704d56a.js","assets/createConnection.bb77c9ac.js","assets/EventedSet.6d14d441.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/LayerView.e649b0cd.js"]),tile:eR,"imagery-tile":()=>Q(()=>import("./ImageryTileLayerView3D.c52a887d.js"),["assets/ImageryTileLayerView3D.c52a887d.js","assets/LayerView3D.22fe02a7.js","assets/TiledLayerView3D.f08d70b8.js","assets/rasterProjectionHelper.3ee8a0a7.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/drapedUtils.05665b86.js"]),"vector-tile":()=>Q(()=>import("./VectorTileLayerView3D.933dcec5.js"),["assets/VectorTileLayerView3D.933dcec5.js","assets/Rect.e8e4d18d.js","assets/rasterizingUtils.eebd054f.js","assets/StyleRepository.29dbb147.js","assets/enums.89506096.js","assets/TileClipper.7b9dd3ce.js","assets/TileInfoView.dbee1229.js","assets/number.dcd3e86c.js","assets/GeometryUtils.6a2e733c.js","assets/LayerView3D.22fe02a7.js","assets/TiledLayerView3D.f08d70b8.js","assets/LayerView.e649b0cd.js"]),wcs:()=>Q(()=>import("./ImageryTileLayerView3D.c52a887d.js"),["assets/ImageryTileLayerView3D.c52a887d.js","assets/LayerView3D.22fe02a7.js","assets/TiledLayerView3D.f08d70b8.js","assets/rasterProjectionHelper.3ee8a0a7.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/drapedUtils.05665b86.js"]),"web-tile":eR,wfs:()=>Q(()=>import("./WFSLayerView3D.09baae1e.js"),["assets/WFSLayerView3D.09baae1e.js","assets/FeatureLayerViewBase3D.57c2d4e1.js","assets/FeatureLikeLayerView3D.84003d2d.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/queryForSymbologySnapping.372db265.js","assets/elevationInfoUtils.61d72552.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.0d9a56b3.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.4b890201.js","assets/BoundsStore.7be3138e.js","assets/projectExtentUtils.85b203bb.js","assets/LayerView3D.22fe02a7.js","assets/EventedSet.6d14d441.js","assets/popupUtils.1c2a1560.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js"]),wms:()=>Q(()=>import("./WMSLayerView3D.5c8cd533.js"),["assets/WMSLayerView3D.5c8cd533.js","assets/DynamicLayerView3D.eca102f4.js","assets/LayerView3D.22fe02a7.js","assets/projectExtentUtils.85b203bb.js","assets/ImageMaterial.e7dff857.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js","assets/ExportWMSImageParameters.9437c158.js"]),wmts:()=>Q(()=>import("./WMTSLayerView3D.3198ba6f.js"),["assets/WMTSLayerView3D.3198ba6f.js","assets/LayerView3D.22fe02a7.js","assets/TiledLayerView3D.f08d70b8.js","assets/LayerView.e649b0cd.js","assets/RefreshableLayerView.5fe5f7c4.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function wJe(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new H(`${i}:view-not-supported`,`${t} is not supported in 3D`)}const wae={hasLayerViewModule:e=>v(bae[e.type]),importLayerView:e=>{const t=bae[e.type];if(C(t))throw wJe(e);return t(e)}},xae="analyses-owner-handles";var VE,bx;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(VE||(VE={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(bx||(bx={}));let Ww=class extends BI{constructor(e){super(e),this._allAnalysisViews=new Qe,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Tae(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(lr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(lr()),this._attachedToViewResolver=Tae()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(C(t)||t.state.list===bx.REMOVED)throw new H("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),xae)}_disconnectOwners(){this.handles.remove(xae),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return{remove:()=>{t.remove(),i.remove();for(const r of e)this._removeAnalysis(r)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const i={state:{view:VE.PENDING,list:bx.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=C$(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=bx.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=bx.REMOVED,this._scheduleUpdate()):se.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){v(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=ZA(()=>this._update()))}_update(){this._scheduledUpdateHandle=hs(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===bx.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case VE.PENDING:e.createAnalysisViewTask=ep(e.createAnalysisViewTask);break;case VE.CREATED:v(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=Be(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,C(s.module))try{s.module=await this._loadAnalysisModule(r)}catch(o){throw this._creatingViewCount-=1,o}if(So(t))throw this._creatingViewCount-=1,lr("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(So(t))throw this._creatingViewCount-=1,n.destroy(),lr("AnalysisView creation aborted");return e.view=n,e.state.view=VE.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return Q(()=>import("./AreaMeasurementAnalysisView3D.272e16dc.js").then(function(t){return t.A}),["assets/AreaMeasurementAnalysisView3D.272e16dc.js","assets/analysisThemeUtils.194b8bb1.js","assets/Segment.f1d4c876.js","assets/LineVisualElement.27f295b3.js","assets/elevationInfoUtils.61d72552.js","assets/colorUtils.2b15a02f.js","assets/geometryEngine.b0a7fece.js","assets/geometryEngineBase.871c2f6a.js","assets/hydrated.1e222081.js","assets/EditGeometryOperations.890b1071.js"]);case"dimension":return Q(()=>import("./DimensionAnalysisView3D.54c15f5c.js").then(function(t){return t.D}),["assets/DimensionAnalysisView3D.54c15f5c.js","assets/LineVisualElement.27f295b3.js","assets/LengthDimension.b6aff86b.js","assets/Segment.f1d4c876.js","assets/elevationInfoUtils.61d72552.js","assets/analysisViewUtils.81d36165.js","assets/ImageMaterial.e7dff857.js","assets/Factory.3ecbd3ef.js","assets/RightAngleQuadVisualElement.23b79210.js","assets/VisualElementResources.c2c3e4cd.js","assets/PointVisualElement.cac38b96.js","assets/EditGeometryOperations.890b1071.js","assets/QueryEngineResult.2ac072d4.js","assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js","assets/utils.51e2592f.js","assets/generateRendererUtils.935a3285.js","assets/json.5152e73f.js","assets/dehydratedFeatureComparison.baf40dde.js","assets/RenderTexture.a0a012a6.js"]);case"direct-line-measurement":return Q(()=>import("./DirectLineMeasurementAnalysisView3D.0ac6675d.js").then(function(t){return t.D}),["assets/DirectLineMeasurementAnalysisView3D.0ac6675d.js","assets/analysisThemeUtils.194b8bb1.js","assets/Segment.f1d4c876.js","assets/LineVisualElement.27f295b3.js","assets/elevationInfoUtils.61d72552.js","assets/colorUtils.2b15a02f.js","assets/geometryEngine.b0a7fece.js","assets/geometryEngineBase.871c2f6a.js","assets/hydrated.1e222081.js","assets/RightAngleQuadVisualElement.23b79210.js","assets/VisualElementResources.c2c3e4cd.js"]);case"line-of-sight":return Q(()=>import("./LineOfSightAnalysisView3D.34a114e9.js"),["assets/LineOfSightAnalysisView3D.34a114e9.js","assets/LineVisualElement.27f295b3.js","assets/LineOfSightAnalysisTarget.e53b7123.js","assets/persistable.758b5afb.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.2d9abca0.js","assets/elevationInfoUtils.61d72552.js","assets/analysisViewUtils.81d36165.js","assets/ImageMaterial.e7dff857.js","assets/PointVisualElement.cac38b96.js","assets/VisualElementResources.c2c3e4cd.js"]);case"slice":return Q(()=>import("./SliceAnalysisView3D.8f17d1c3.js").then(function(t){return t.S}),["assets/SliceAnalysisView3D.8f17d1c3.js","assets/LineVisualElement.27f295b3.js","assets/persistable.758b5afb.js","assets/multiOriginJSONSupportUtils.6105c957.js","assets/resourceExtension.2d9abca0.js","assets/BuildingComponentSublayer.b5aff654.js","assets/capabilities.26cf9b42.js","assets/I3SIndexInfo.827c76ac.js","assets/I3SLayerDefinitions.a18219e8.js","assets/I3SUtil.1e58a9c4.js","assets/I3SBinaryReader.79df5733.js","assets/popupUtils.1c2a1560.js","assets/analysisViewUtils.81d36165.js","assets/ImageMaterial.e7dff857.js","assets/Factory.3ecbd3ef.js"])}}};function Tae(){const e=B1();return e.promise.catch(()=>{}),e}u([d()],Ww.prototype,"updating",null),u([d({constructOnly:!0})],Ww.prototype,"view",void 0),u([d()],Ww.prototype,"_allAnalysisViews",void 0),u([d()],Ww.prototype,"_creatingViewCount",void 0),Ww=u([P("esri.views.3d.analysis.AnalysisViewManager3D")],Ww);const xJe=Ww;let ky=class extends Te{constructor(e){super(e),this.collision=new VO,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===je.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==je.Local?this._set("altitude",e):se.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?ye(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return ye(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===je.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=RB)=>(i.min=Va.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?t4([[4e3,Va.max],[1e4,Wt(88)],[6e6,Wt(88)]]):()=>Va.max;return(t,i=RB)=>(i.min=Va.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?t4([[4e3,Va.max],[5e4,Wt(88)],[6e6,Wt(88)],[2e7,Va.min]]):t4([[3e5,Va.max],[3e6,Wt(88)],[6e6,Wt(88)],[2e7,Va.min]]);return(t,i=RB)=>(i.min=Va.min,i.max=e(t),i)}};function TJe(e){return{min:-2e5,max:4*e.radius}}u([d()],ky.prototype,"altitude",null),u([d({readOnly:!0})],ky.prototype,"collision",void 0),u([d()],ky.prototype,"distance",void 0),u([d({readOnly:!0})],ky.prototype,"minimumPoiDistance",void 0),u([d()],ky.prototype,"tilt",void 0),u([d({constructOnly:!0})],ky.prototype,"mode",void 0),ky=u([P("esri.views.3d.state.Constraints")],ky);const Sae=TJe(Mi),Va={min:Wt(.5),max:Wt(179.5)},RB={min:0,max:0};let VO=class extends Te{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],VO.prototype,"enabled",void 0),u([d({type:Number})],VO.prototype,"elevationMargin",void 0),VO=u([P("esri.views.3d.state.Constraints.CollisionConstraint")],VO);let BE=class extends Te{constructor(){super(...arguments),this.min=Sae.min,this.max=Sae.max}};u([d({type:Number})],BE.prototype,"min",void 0),u([d({type:Number})],BE.prototype,"max",void 0),BE=u([P("esri.views.3d.constraints.AltitudeConstraint")],BE);let Zy=class extends Te{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],Zy.prototype,"near",null),u([Zt("near")],Zy.prototype,"castNear",null),u([d({type:Number,value:1e-8})],Zy.prototype,"far",null),u([Zt("far")],Zy.prototype,"castFar",null),u([d({type:["auto","manual"]})],Zy.prototype,"mode",void 0),Zy=u([P("esri.views.3d.constraints.ClipDistanceConstraint")],Zy);const XW={min:Zl(Va.min),max:Zl(Va.max)};let wx=class extends Te{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ye(e,XW.min,XW.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],wx.prototype,"mode",void 0),u([d({type:Number,value:XW.max})],wx.prototype,"max",null),u([Zt("max")],wx.prototype,"castMax",null),wx=u([P("esri.views.3d.constraints.TiltConstraint")],wx);let xx=class extends Te{constructor(){super(...arguments),this.tilt=new wx,this.altitude=new BE,this.clipDistance=new Zy}};u([d({type:wx})],xx.prototype,"tilt",void 0),u([d({type:BE})],xx.prototype,"altitude",void 0),u([d({type:Zy})],xx.prototype,"clipDistance",void 0),xx=u([P("esri.views.3d.constraints.Constraints")],xx);var YW;let bd=YW=class extends ge{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new YW(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],bd.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],bd.prototype,"date",void 0),u([Fe("date",["datetime"])],bd.prototype,"readDate",null),u([Ge("date")],bd.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],bd.prototype,"directShadowsEnabled",void 0),u([Fe("directShadowsEnabled",["directShadows"])],bd.prototype,"readDirectShadowsEnabled",null),u([Ge("directShadowsEnabled")],bd.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],bd.prototype,"displayUTCOffset",void 0),u([Ge("displayUTCOffset")],bd.prototype,"writeDisplayUTCOffset",null),bd=YW=u([P("esri.webscene.SunLighting")],bd);const iP=bd;var rE;let Im=rE=class extends ps.EventedMixin(iP){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new rE(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=rE.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;v(e)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(e.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime()))));const s=rE.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(OB.target=this,OB.timezoneOffset=s,this.emit("timezone-will-change",OB)),v(e))return!!isNaN(e.getTime())||r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new rE({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],Im.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],Im.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],Im.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],Im.prototype,"defaultDate",null),u([d({type:Date})],Im.prototype,"date",null),Im=rE=u([P("esri.views.3d.environment.SunLighting")],Im),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(Im||(Im={}));const OB={target:null,timezoneOffset:0},Ev=Im;var ZW;let BO=ZW=class extends ge{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new ZW(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],BO.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],BO.prototype,"directShadowsEnabled",void 0),BO=ZW=u([P("esri.webscene.VirtualLighting")],BO);const i8=BO;var p4;let sE=p4=class extends ps.EventedMixin(i8){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new p4({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(e){return new p4(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],sE.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],sE.prototype,"waterReflectionEnabled",void 0),u([d({type:Boolean})],sE.prototype,"cameraTrackingEnabled",void 0),sE=p4=u([P("esri.views.3d.environment.VirtualLighting")],sE);const zO=sE,SJe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Ev,virtual:zO}};var JW;let q3=JW=class extends Te{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new JW({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],q3.prototype,"quality",null),q3=JW=u([P("esri.views.3d.environment.SceneViewAtmosphere")],q3);var KW;let GO=KW=class extends ge{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new KW({cloudCover:this.cloudCover})}};u([bt({sunny:"sunny"})],GO.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],GO.prototype,"cloudCover",void 0),GO=KW=u([P("esri.views.3d.environment.SunnyWeather")],GO);const QW=GO;var eX;let jO=eX=class extends ge{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new eX({cloudCover:this.cloudCover})}};u([bt({cloudy:"cloudy"})],jO.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],jO.prototype,"cloudCover",void 0),jO=eX=u([P("esri.views.3d.environment.CloudyWeather")],jO);const EJe=jO;var tX;let HO=tX=class extends ge{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new tX({fogStrength:this.fogStrength})}};u([bt({foggy:"foggy"})],HO.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],HO.prototype,"fogStrength",void 0),HO=tX=u([P("esri.views.3d.environment.FoggyWeather")],HO);const CJe=HO;var iX;let nE=iX=class extends ge{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new iX({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([bt({rainy:"rainy"})],nE.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],nE.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],nE.prototype,"precipitation",void 0),nE=iX=u([P("esri.views.3d.environment.RainyWeather")],nE);const AJe=nE;var rX;let Xw=rX=class extends ge{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new rX({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([bt({snowy:"snowy"})],Xw.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Xw.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Xw.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Xw.prototype,"snowCover",void 0),Xw=rX=u([P("esri.views.3d.environment.SnowyWeather")],Xw);const MJe=Xw,jTe={key:"type",base:QW,typeMap:{sunny:QW,cloudy:EJe,rainy:AJe,snowy:MJe,foggy:CJe}},RJe=Object.keys(jTe.typeMap);function OJe(e,t){return!!RJe.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const $d=1e4,IJe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:iP,virtual:i8}};let f4=class extends ge{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],f4.prototype,"type",void 0),f4=u([P("esri.webscene.background.Background")],f4);const HTe=f4;var sX;const PJe={...j0,nonNullable:!0};let qO=sX=class extends HTe{constructor(e){super(e),this.type="color",this.color=new De([0,0,0,1])}clone(){return new sX(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([bt({color:"color"},{readOnly:!0})],qO.prototype,"type",void 0),u([d(PJe)],qO.prototype,"color",void 0),qO=sX=u([P("esri.webscene.background.ColorBackground")],qO);const qTe=qO,Eae={base:HTe,key:"type",typeMap:{color:qTe}};function $Je(e){return(t,i,r)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,r),n}}}const LJe={types:Eae,json:{read:$Je(Eae),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var nX;const WTe="esri.webscene.Environment",DJe=se.getLogger(WTe),Cae=(e,t,i)=>({enabled:!i||!i.isPresentation});let Cv=nX=class extends ge{constructor(e){super(e),this.lighting=new iP,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){OJe(e==null?void 0:e.type,DJe)&&this._set("weather",e)}clone(){return new nX(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?i8.prototype.clone.call(this.lighting):iP.prototype.clone.call(this.lighting),background:ne(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:IJe,nonNullable:!0,json:{write:!0}})],Cv.prototype,"lighting",void 0),u([d(LJe)],Cv.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Cae}}})],Cv.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Cae}}})],Cv.prototype,"starsEnabled",void 0),u([d({types:jTe,nonNullable:!0,json:{write:!0},value:new QW})],Cv.prototype,"weather",null),Cv=nX=u([P(WTe)],Cv);const XTe=Cv;var WO;let oE=WO=class extends XTe{constructor(e){super(e),this.atmosphere=new q3,this.lighting=new Ev,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new WO({...t,lighting:t.lighting?t.lighting.type==="virtual"?zO.fromWebsceneLighting(t.lighting):Ev.fromWebsceneLighting(t.lighting):void 0})}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){var t,i;return e?e instanceof Ev||e instanceof zO?e:e instanceof iP?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(e):new Ev({...e.cloneConstructProperties(),...(t=this.lighting)==null?void 0:t.cloneNonPersistentConstructProperties()}):e instanceof i8?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new zO({...e.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):Lf(SJe,e):new Ev}clone(){return new WO({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ne(this.background)})}cloneWithWebsceneEnvironment(e){return new WO({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ne(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):Ev.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):zO.fromWebsceneLighting(e.lighting);default:return e.lighting,Ev.fromWebsceneLighting(e.lighting)}}};u([d({type:q3,json:{read:!1},nonNullable:!0})],oE.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],oE.prototype,"lighting",void 0),u([Zt("lighting")],oE.prototype,"castLighting",null),oE=WO=u([P("esri.views.3d.environment.SceneViewEnvironment")],oE);const aE=oE;var yo;(function(e){e[e.Simple=0]="Simple",e[e.Realistic=1]="Realistic",e[e.Panoramic=2]="Panoramic",e[e.None=3]="None"})(yo||(yo={}));function Mo(e,t){return e[0]=t[0],e[1]=t[1],e}function di(e,t,i){return e[0]=t,e[1]=i,e}function lf(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function eg(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function YTe(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function ZTe(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function FJe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function NJe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function kJe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function UJe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function VJe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function xu(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function BJe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function ST(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function pk(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function fQ(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function JTe(e){const t=e[0],i=e[1];return t*t+i*i}function mQ(e,t){return e[0]=-t[0],e[1]=-t[1],e}function zJe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function rP(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function Kn(e,t){return e[0]*t[0]+e[1]*t[1]}function GJe(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function lE(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function jJe(e,t){t=t||1;const i=2*e$()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function oX(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function Yw(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function HJe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function qJe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function WJe(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function XJe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function YJe(e){return"vec2("+e[0]+", "+e[1]+")"}function KTe(e,t){return e[0]===t[0]&&e[1]===t[1]}function QTe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1],o=vl();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function ZJe(e,t,i,r,s){let n=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const JJe=fQ,KJe=eg,QJe=YTe,eKe=ZTe,eSe=ST,tKe=pk,iKe=JTe;Object.freeze(Object.defineProperty({__proto__:null,add:lf,angle:XJe,ceil:FJe,copy:Mo,cross:GJe,dist:eSe,distance:ST,div:eKe,divide:ZTe,dot:Kn,equals:QTe,exactEquals:KTe,floor:NJe,inverse:zJe,len:JJe,length:fQ,lerp:lE,max:UJe,min:kJe,mul:QJe,multiply:YTe,negate:mQ,normalize:rP,projectAndScale:ZJe,random:jJe,rotate:WJe,round:VJe,scale:xu,scaleAndAdd:BJe,set:di,sqrDist:tKe,sqrLen:iKe,squaredDistance:pk,squaredLength:JTe,str:YJe,sub:KJe,subtract:eg,transformMat2:oX,transformMat2d:Yw,transformMat3:HJe,transformMat4:qJe},Symbol.toStringTag,{value:"Module"}));function gQ(e){return ye((e-1e5)/(1e6-1e5),0,1)}const aX=1e4,rKe=.085,sP=1e5;class sKe{}const Rr=sKe;function x(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}(function(e){function t(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}e.int=t,e.float=i})(x||(x={}));var R;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"})(R||(R={}));var En;function yg(e,t){switch(t.textureCoordinateType){case En.Default:return e.attributes.add(R.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case En.Compressed:return e.attributes.add(R.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(x`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case En.Atlas:return e.attributes.add(R.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(R.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:t.textureCoordinateType;case En.None:return void e.vertex.code.add(x`void forwardTextureCoordinates() {}`);case En.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.Compressed=3]="Compressed",e[e.COUNT=4]="COUNT"})(En||(En={}));function ku(e){e.code.add(x`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Wh(e){e.include(ku),e.code.add(x`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function r8(e){e.fragment.code.add(x`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Ar;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(Ar||(Ar={}));class Zs{constructor(t,i,r,s,n=null){this.name=t,this.type=i,this.arraySize=n,this.bind={[Ar.Pass]:null,[Ar.Draw]:null},v(r)&&v(s)&&(this.bind[r]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class Jt extends Zs{constructor(t,i){super(t,"vec3",Ar.Pass,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class Ie extends Zs{constructor(t,i){super(t,"float",Ar.Pass,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function Y0(e){e.uniforms.add(new Jt("mainLightDirection",(t,i)=>i.lighting.mainLight.direction))}function Bg(e){e.uniforms.add(new Jt("mainLightIntensity",(t,i)=>i.lighting.mainLight.intensity))}function nKe(e,t){t.useLegacyTerrainShading?e.uniforms.add(new Ie("lightingFixedFactor",(i,r)=>r.lighting.noonFactor*(1-r.lighting.globalFactor))):e.constants.add("lightingFixedFactor","float",0)}function fk(e,t){const i=e.fragment;Y0(i),Bg(i),nKe(i,t),i.code.add(x`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}class tr extends Zs{constructor(t,i){super(t,"vec2",Ar.Pass,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class xi extends Zs{constructor(t,i){super(t,"vec4",Ar.Pass,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}class ds extends Zs{constructor(t,i){super(t,"mat4",Ar.Pass,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}const tSe=se.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class iSe{constructor(){this._includedModules=new Map}include(t,i){if(this._includedModules.has(t)){const r=this._includedModules.get(t);if(r!==i){tSe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))r[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${t[n]}`))}}else this._includedModules.set(t,i),t(this.builder,i)}}class Yi extends iSe{constructor(){super(...arguments),this.vertex=new Aae,this.fragment=new Aae,this.attributes=new lKe,this.varyings=new cKe,this.extensions=new _A,this.constants=new Ln}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const i=this.extensions.generateSource(t),r=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?hKe:uKe,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];v(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];v(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](i,o,a,l)}}}class oKe{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const i of t)this._add(i)}get(t){return this._entries.get(t)}_add(t){if(C(t))tSe.error(`Trying to add null Uniform from ${new Error().stack}.`);else{if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new H(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}}generateSource(){return Array.from(this._entries.values()).map(t=>v(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class aKe{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class Aae extends iSe{constructor(){super(...arguments),this.uniforms=new oKe,this.code=new aKe,this.constants=new Ln}get builder(){return this}}class lKe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(t){return t==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}}class cKe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class _A{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const i=t==="vertex"?_A.ALLOWLIST_VERTEX:_A.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}}_A.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],_A.ALLOWLIST_VERTEX=[];class Ln{constructor(){this._entries=new Set}add(t,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=Ln._numberToFloatStr(r);break;case"int":s=Ln._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${Ln._numberToFloatStr(r[0])},                            ${Ln._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${Ln._numberToFloatStr(r[0])},                            ${Ln._numberToFloatStr(r[1])},                            ${Ln._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${Ln._numberToFloatStr(r[0])},                            ${Ln._numberToFloatStr(r[1])},                            ${Ln._numberToFloatStr(r[2])},                            ${Ln._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${Ln._numberToIntStr(r[0])},                             ${Ln._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${Ln._numberToIntStr(r[0])},                             ${Ln._numberToIntStr(r[1])},                             ${Ln._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${Ln._numberToIntStr(r[0])},                             ${Ln._numberToIntStr(r[1])},                             ${Ln._numberToIntStr(r[2])},                             ${Ln._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>Ln._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const uKe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,hKe=`precision highp float;
precision highp sampler2D;`,yQ="Size",s8="InvSize";function Zd(e,t,i=!1,r=0){if(e.hasWebGL2Context){const s=x`vec2(textureSize(${t}, ${x.int(r)}))`;return i?"(1.0 / "+s+")":s}return i?t+s8:t+yQ}function Xl(e,t,i,r=null,s=0){if(e.hasWebGL2Context)return x`texelFetch(${t}, ivec2(${i}), ${x.int(s)})`;let n=x`texture2D(${t}, ${i} * `;return n+=r?x`(${r}))`:x`${t+s8})`,n}var fr;(function(e){e[e.None=0]="None",e[e.Size=1]="Size",e[e.InvSize=2]="InvSize"})(fr||(fr={}));class Lt extends Zs{constructor(t,i){super(t,"sampler2D",Ar.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function Rf(e,t,i=fr.None){const r=[new Lt(e,t)];if(i&fr.Size){const s=e+yQ;r.push(new tr(s,(n,o)=>{const a=t(n,o);return v(a)?di(Mae,a.descriptor.width,a.descriptor.height):Bc}))}if(i&fr.InvSize){const s=e+s8;r.push(new tr(s,(n,o)=>{const a=t(n,o);return v(a)?di(Mae,1/a.descriptor.width,1/a.descriptor.height):Bc}))}return r}const Mae=tt(),W3=Le(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),IB=3,PB=Le(IB*parseFloat(Number(65e-8).toFixed(6)),IB*parseFloat(Number(1881e-9).toFixed(6)),IB*parseFloat(Number(85e-9).toFixed(6))),dKe=3996e-9,pKe=Le(parseFloat(Number(W3[0]+PB[0]).toFixed(6)),parseFloat(Number(W3[1]+PB[1]).toFixed(6)),parseFloat(Number(W3[2]+PB[2]).toFixed(6)));function fKe(e){const t=new Yi;t.attributes.add(R.POSITION,"vec2"),t.include(yg,{textureCoordinateType:En.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new ds("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new ds("inverseViewMatrix",(s,n)=>aM(mKe,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new tr("radii",s=>s.radii),new Jt("cameraPosition",(s,n)=>n.camera.eye),new xi("heightParameters",s=>s.heightParameters),new Ie("innerFadeDistance",s=>s.innerFadeDistance),new Ie("altitudeFade",s=>s.altitudeFade),new Lt("depthTex",s=>s.depthTex),new Ie("hazeStrength",s=>s.hazeStrength)]),r.constants.add("betaRayleigh","vec3",W3),r.constants.add("betaCombined","vec3",pKe),r.constants.add("betaMie","float",dKe),r.constants.add("scaleHeight","float",rKe*sP),Y0(r),t.include(r8),e.haze&&(r.include(Wh),r.uniforms.add(new tr("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(x`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(x`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?x`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?x``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":x`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${e.haze?x`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?x`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:x`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?x`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:x`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":x`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),t}const mKe=Pe(),gKe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:W3,build:fKe},Symbol.toStringTag,{value:"Module"}));class Zi{constructor(t,i){this._module=t,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var ts,Nt,Ce,Ig,$t,xf,vA,dt,Zr,dn,nt,Pt,St,ze,Mt,kt,zl,Xi,Ch,zo,Ls,Wi;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(ts||(ts={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Nt||(Nt={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ce||(Ce={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Ig||(Ig={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}($t||($t={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(xf||(xf={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(vA||(vA={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(dt||(dt={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(Zr||(Zr={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(dn||(dn={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(nt||(nt={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Pt||(Pt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(St||(St={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ze||(ze={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(Mt||(Mt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(kt||(kt={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(zl||(zl={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(Xi||(Xi={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Ch||(Ch={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(zo||(zo={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(Ls||(Ls={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Wi||(Wi={}));const $B=33984;var Co,fh;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(Co||(Co={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(fh||(fh={}));const Rae=33306;var an,Oae,Iae,Pae,mk,lX,$ae;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(an||(an={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Oae||(Oae={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Iae||(Iae={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(Pae||(Pae={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(mk||(mk={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(lX||(lX={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}($ae||($ae={}));class ir{constructor(t,i,r){this.release=r,this.initializeConfiguration(t,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=rt(this._program),this._pipeline=this._configuration=null}reload(t){rt(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(t,i=null,r){t.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return Nt.TRIANGLES}getPipelineState(t,i){return this._pipeline}initializeConfiguration(t,i){}}const ji=new Map([[R.POSITION,0],[R.NORMAL,1],[R.UV0,2],[R.COLOR,3],[R.SIZE,4],[R.TANGENT,4],[R.AUXPOS1,5],[R.SYMBOLCOLOR,5],[R.AUXPOS2,6],[R.FEATUREATTRIBUTE,6],[R.INSTANCEFEATUREATTRIBUTE,6],[R.INSTANCECOLOR,7],[R.OBJECTANDLAYERIDCOLOR,7],[R.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[R.MODEL,8],[R.MODELNORMAL,12],[R.MODELORIGINHI,11],[R.MODELORIGINLO,15]]),yKe=se.getLogger("esri.views.webgl.checkWebGLError");function _Ke(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const rSe=!!he("enable-feature:webgl-debug");function _h(){return rSe}function cX(){return rSe}function Zv(e){if(_h()){const t=e.getError();if(t){const i=_Ke(e,t),r=new Error().stack;yKe.error(new H("webgl-error","WebGL error occured",{message:i,stack:r}))}}}class Ji{constructor(t,i,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new ri({deallocator:null}),this._glProgram=t.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(Ar.Pass,this),this.bindDraw=i.generateBind(Ar.Draw,this),this._fragmentUniforms=_h()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(t,i){this._glProgram.setUniform1i(t,i?1:0)}setUniform1i(t,i){this._glProgram.setUniform1i(t,i)}setUniform1f(t,i){this._glProgram.setUniform1f(t,i)}setUniform2fv(t,i){this._glProgram.setUniform2fv(t,i)}setUniform3fv(t,i){this._glProgram.setUniform3fv(t,i)}setUniform4fv(t,i){this._glProgram.setUniform4fv(t,i)}setUniformMatrix3fv(t,i){this._glProgram.setUniformMatrix3fv(t,i)}setUniformMatrix4fv(t,i){this._glProgram.setUniformMatrix4fv(t,i)}setUniform1fv(t,i){this._glProgram.setUniform1fv(t,i)}setUniform1iv(t,i){this._glProgram.setUniform1iv(t,i)}setUniform2iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform3iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform4iv(t,i){this._glProgram.setUniform4iv(t,i)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,i){if(C(i)||i.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let r=this._textures.get(t);return r==null?(r=this._allocTextureUnit(i),this._textures.set(t,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,i)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(i,t.unit)}),v(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var Br,ET,cn,_0,Nc,D0,$1,bA,Er,CT,n0;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(Br||(Br={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(ET||(ET={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(cn||(cn={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(_0||(_0={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Nc||(Nc={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(D0||(D0={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}($1||($1={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(bA||(bA={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(Er||(Er={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(CT||(CT={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(n0||(n0={}));function qf(e,t,i=Ig.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Ro(e,t,i,r,s=Ig.ADD,n=Ig.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const _Q={face:xf.BACK,mode:vA.CCW},sSe={face:xf.FRONT,mode:vA.CCW},n8=e=>e===Br.Back?_Q:e===Br.Front?sSe:null,zc={zNear:0,zFar:1},si={r:!0,g:!0,b:!0,a:!0};function vKe(e){return AKe.intern(e)}function bKe(e){return MKe.intern(e)}function wKe(e){return RKe.intern(e)}function xKe(e){return OKe.intern(e)}function TKe(e){return IKe.intern(e)}function SKe(e){return PKe.intern(e)}function EKe(e){return $Ke.intern(e)}function CKe(e){return LKe.intern(e)}function Ht(e){return DKe.intern(e)}class Z0{constructor(t,i){this._makeKey=t,this._makeRef=i,this._interns=new Map}intern(t){var s;if(!t)return null;const i=this._makeKey(t),r=this._interns;return r.has(i)||r.set(i,this._makeRef(t)),(s=r.get(i))!=null?s:null}}function J0(e){return"["+e.join(",")+"]"}const AKe=new Z0(nSe,e=>({__tag:"Blending",...e}));function nSe(e){return e?J0([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const MKe=new Z0(oSe,e=>({__tag:"Culling",...e}));function oSe(e){return e?J0([e.face,e.mode]):null}const RKe=new Z0(aSe,e=>({__tag:"PolygonOffset",...e}));function aSe(e){return e?J0([e.factor,e.units]):null}const OKe=new Z0(lSe,e=>({__tag:"DepthTest",...e}));function lSe(e){return e?J0([e.func]):null}const IKe=new Z0(cSe,e=>({__tag:"StencilTest",...e}));function cSe(e){return e?J0([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const PKe=new Z0(uSe,e=>({__tag:"DepthWrite",...e}));function uSe(e){return e?J0([e.zNear,e.zFar]):null}const $Ke=new Z0(hSe,e=>({__tag:"ColorWrite",...e}));function hSe(e){return e?J0([e.r,e.g,e.b,e.a]):null}const LKe=new Z0(dSe,e=>({__tag:"StencilWrite",...e}));function dSe(e){return e?J0([e.mask]):null}const DKe=new Z0(FKe,e=>({blending:vKe(e.blending),culling:bKe(e.culling),polygonOffset:wKe(e.polygonOffset),depthTest:xKe(e.depthTest),stencilTest:TKe(e.stencilTest),depthWrite:SKe(e.depthWrite),colorWrite:EKe(e.colorWrite),stencilWrite:CKe(e.stencilWrite)}));function FKe(e){return e?J0([nSe(e.blending),oSe(e.culling),aSe(e.polygonOffset),lSe(e.depthTest),cSe(e.stencilTest),uSe(e.depthWrite),hSe(e.colorWrite),dSe(e.stencilWrite)]):null}class NKe{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,i,r,s){return(r||t!==i)&&(s(t),this._pipelineInvalid=!0),t}}class kKe extends Rr{constructor(){super(...arguments),this.heightParameters=ui(),this.radii=tt(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}}class nP extends ir{initializeProgram(t){return new Ji(t.rctx,nP.shader.get().build(this.configuration),ji)}initializePipeline(){return this.configuration.haze?Ht({blending:Ro(Ce.ONE,Ce.ZERO,Ce.ONE_MINUS_SRC_COLOR,Ce.ONE),colorWrite:si}):Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:Zr.LEQUAL},colorWrite:si})}}nP.shader=new Zi(gKe,()=>Q(()=>import("./ChapmanAtmosphere.glsl.e0d6d324.js"),[]));class xl extends Rr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,i={key:this.key};for(const r of t)i[r]=this[r];return i}}function j(e={}){return(t,i)=>{var r,s;if(t._parameterNames=(r=t._parameterNames)!=null?r:[],t._parameterNames.push(i),e.constValue!=null)Object.defineProperty(t,i,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,i,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<h&p,typeof f!="number"&&typeof f!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof f)}})}}}class pSe extends xl{constructor(){super(...arguments),this.haze=!1}}u([j()],pSe.prototype,"haze",void 0);class Ca{constructor(t,i,r,s,n,o=!1,a=0){this.name=t,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new Ca(R.POSITION,3,dt.FLOAT,0,12);new Ca(R.POSITION,3,dt.FLOAT,0,20),new Ca(R.UV0,2,dt.FLOAT,12,20);new Ca(R.POSITION,3,dt.FLOAT,0,32),new Ca(R.NORMAL,3,dt.FLOAT,12,32),new Ca(R.UV0,2,dt.FLOAT,24,32);new Ca(R.POSITION,3,dt.FLOAT,0,16),new Ca(R.COLOR,4,dt.UNSIGNED_BYTE,12,16);const vQ=[new Ca(R.POSITION,2,dt.FLOAT,0,8)],vM=[new Ca(R.POSITION,2,dt.FLOAT,0,16),new Ca(R.UV0,2,dt.FLOAT,8,16)];function Lae(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function ja(e,t){return e.vertexBuffers[t].size/UKe(e.layout[t])}function UKe(e){return e[0].stride}function bQ(e,t,i,r,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function wQ(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const o of r){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer($t.ARRAY_BUFFER)}function fSe(e){switch(e){case ze.ALPHA:case ze.LUMINANCE:case ze.RED:case ze.RED_INTEGER:case Mt.R8:case Mt.R8I:case Mt.R8UI:case Mt.R8_SNORM:case zl.STENCIL_INDEX8:return 1;case ze.LUMINANCE_ALPHA:case ze.RG:case ze.RG_INTEGER:case Mt.RGBA4:case Mt.R16F:case Mt.R16I:case Mt.R16UI:case Mt.RG8:case Mt.RG8I:case Mt.RG8UI:case Mt.RG8_SNORM:case Mt.RGB565:case Mt.RGB5_A1:case zl.DEPTH_COMPONENT16:return 2;case ze.DEPTH_COMPONENT:case ze.RGB:case ze.RGB_INTEGER:case Mt.RGB8:case Mt.RGB8I:case Mt.RGB8UI:case Mt.RGB8_SNORM:case Mt.SRGB8:case zl.DEPTH_COMPONENT24:return 3;case ze.DEPTH_STENCIL:case ze.RGBA:case ze.RGBA_INTEGER:case Mt.RGBA8:case Mt.R32F:case Mt.R11F_G11F_B10F:case Mt.RG16F:case Mt.R32I:case Mt.R32UI:case Mt.RG16I:case Mt.RG16UI:case Mt.RGBA8I:case Mt.RGBA8UI:case Mt.RGBA8_SNORM:case Mt.SRGB8_ALPHA8:case Mt.RGB9_E5:case Mt.RGB10_A2UI:case Mt.RGB10_A2:case zl.DEPTH_STENCIL:case zl.DEPTH_COMPONENT32F:case zl.DEPTH24_STENCIL8:return 4;case zl.DEPTH32F_STENCIL8:return 5;case Mt.RGB16F:case Mt.RGB16I:case Mt.RGB16UI:return 6;case Mt.RG32F:case Mt.RG32I:case Mt.RG32UI:case Mt.RGBA16F:case Mt.RGBA16I:case Mt.RGBA16UI:return 8;case Mt.RGB32F:case Mt.RGB32I:case Mt.RGB32UI:return 12;case Mt.RGBA32F:case Mt.RGBA32I:case Mt.RGBA32UI:return 16;case an.COMPRESSED_RGB_S3TC_DXT1_EXT:case an.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case an.COMPRESSED_RGBA_S3TC_DXT3_EXT:case an.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case an.COMPRESSED_R11_EAC:case an.COMPRESSED_SIGNED_R11_EAC:case an.COMPRESSED_RGB8_ETC2:case an.COMPRESSED_SRGB8_ETC2:case an.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case an.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case an.COMPRESSED_RG11_EAC:case an.COMPRESSED_SIGNED_RG11_EAC:case an.COMPRESSED_RGBA8_ETC2_EAC:case an.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function AT(e){if(C(e))return 0;if("descriptor"in e)return e.glName?AT(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return fSe(t)*r*i}const Ob=se.getLogger("esri.views.webgl.VertexArrayObject");let lp=class{constructor(e,t,i,r,s=null){this._context=e,this._locations=t,this._layout=i,this._buffers=r,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(Co.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,t)=>e+this._buffers[t].size,v(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){var t,i,r;if(!this._context)return void((this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&Ob.warn("Leaked WebGL VAO"));if(this._glName){const s=(i=(t=this._context)==null?void 0:t.capabilities)==null?void 0:i.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):Ob.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const s in this._buffers)(r=this._buffers[s])==null||r.dispose(),delete this._buffers[s];this._indexBuffer=rt(this._indexBuffer)}this._context.instanceCounter.decrement(Co.VertexArrayObject,this),this._context=sT(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:i}=this;e||Ob.error("Vertex buffer dictionary is empty!");const r=this._context.gl;for(const s in e){const n=e[s];n||Ob.error("Vertex buffer is uninitialized!");const o=t[s];o||Ob.error("Vertex element descriptor is empty!"),bQ(this._context,this._locations,n,o)}v(i)&&(this._context.capabilities.vao?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:t}=this;e||Ob.error("Vertex buffer dictionary is empty!");for(const i in e){const r=e[i];r||Ob.error("Vertex buffer is uninitialized!");const s=t[i];wQ(this._context,this._locations,r,s)}v(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}};class Wf extends lp{}var Tt;function VKe(e,t,i={}){const r=mSe(e);for(;r.length>1;){const s=gk(t,r.shift(),i);if(v(s))return s}return BKe(t,r.shift(),i)}function mSe(e){const t=he("esri-force-webgl");if(t===Tt.WEBGL1||t===Tt.WEBGL2)return[t];switch(e){case"2d":return he("mac")&&he("chrome")?[Tt.WEBGL1,Tt.WEBGL2]:[Tt.WEBGL2,Tt.WEBGL1];case"3d":return[Tt.WEBGL2,Tt.WEBGL1]}}function BKe(e,t,i={}){if(!window.WebGLRenderingContext)return Dae(e,zKe),null;const r=gk(e,t,i);return C(r)&&Dae(e,GKe),r}function gk(e,t,i={}){const r=t===Tt.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=e.getContext(n,i)}catch{}if(s)break}return s}function Dae(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(Tt||(Tt={}));const zKe='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',GKe=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,Qf=se.getLogger("esri.views.webgl.BufferObject");class Oi{static createIndex(t,i,r){return new Oi(t,$t.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(t,i,r){return new Oi(t,$t.ARRAY_BUFFER,i,r)}static createUniform(t,i,r){if(t.type!==Tt.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new Oi(t,$t.UNIFORM_BUFFER,i,r)}static createPixelPack(t,i=Xi.STREAM_READ,r){if(t.type!==Tt.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new Oi(t,$t.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(t,i=Xi.STREAM_DRAW,r){if(t.type!==Tt.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new Oi(t,$t.PIXEL_UNPACK_BUFFER,i,r)}constructor(t,i,r,s){this._context=t,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(Co.BufferObject,this),this._glName=this._context.gl.createBuffer(),Zv(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===$t.ELEMENT_ARRAY_BUFFER?this._indexType===dt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===$t.ELEMENT_ARRAY_BUFFER||this.bufferType===$t.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Co.BufferObject,this),this._context=sT(this._context)):this._glName&&Qf.warn("Leaked WebGL buffer object")}setSize(t,i=null){if(t<=0&&Qf.error("Buffer size needs to be positive!"),this.bufferType===$t.ELEMENT_ARRAY_BUFFER&&v(i))switch(this._indexType=i,i){case dt.UNSIGNED_SHORT:t*=2;break;case dt.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let i=t.byteLength;this.bufferType===$t.ELEMENT_ARRAY_BUFFER&&(iZ(t)&&(i/=2,this._indexType=dt.UNSIGNED_SHORT),rZ(t)&&(i/=4,this._indexType=dt.UNSIGNED_INT)),this._setBufferData(i,t)}_setBufferData(t,i=null){this._size=t;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;v(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,t,this.usage),Zv(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(t,i,r,s){if(!t)return;(i<0||i*t.BYTES_PER_ELEMENT>=this.byteSize)&&Qf.error("offset is out of range!"),r>=s&&Qf.error("end must be bigger than start!"),(i+(s-r))*t.BYTES_PER_ELEMENT>this.byteSize&&Qf.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===Tt.WEBGL2)o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,t,r,s-r);else{const a=r===0&&s===t.length?t:t.subarray(r,s);o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,a)}Zv(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,i=0,r,s){if(this._context.type!==Tt.WEBGL2)return void Qf.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void Qf.error("Problem getting subdata: offset and length were less than zero!");const n=jKe(t)?t.BYTES_PER_ELEMENT:1;if(n*((r!=null?r:0)+(s!=null?s:0))>t.byteLength)return void Qf.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s!=null?s:0)>this.byteSize&&Qf.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,$t.COPY_READ_BUFFER),o.getBufferSubData($t.COPY_READ_BUFFER,i,t,r,s),this._context.unbindBuffer($t.COPY_READ_BUFFER)}async getSubDataAsync(t,i=0,r,s){this._context.type===Tt.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,i,r,s)):Qf.error("Get buffer subdata is supported in WebGL2 only!")}}function jKe(e){return hIe(e)}const LB={target:St.TEXTURE_2D,samplingMode:nt.LINEAR,wrapMode:Pt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},Fae=4;let pt=class{constructor(e,t,i=null){this._context=e,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,e.instanceCounter.increment(Co.Texture,this),this._descriptor={...LB,...t};for(const r in LB)this._descriptor[r]===void 0&&(this._descriptor[r]=LB[r]);if(e.type!==Tt.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),Ib(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===St.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Co.Texture,this))}release(){this.dispose()}resize(e,t){const i=this._descriptor;if(i.width!==e||i.height!==t){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");i.width=e,i.height=t,this._descriptor.target===St.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let t=St.TEXTURE_CUBE_MAP_POSITIVE_X;t<=St.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(e,t){var c,h;if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const r=this._descriptor,s=t!=null?t:r.target,n=Ib(s);e===null&&(r.width=r.width||Fae,r.height=r.height||Fae,n&&(r.depth=(c=r.depth)!=null?c:1));const o=this._context.bindTexture(this,pt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(pt.TEXTURE_UNIT_FOR_UPDATES),pt._validateTexture(this._context,r),this._configurePixelStorage(),Zv(i);const a=r.pixelFormat;let l=(h=r.internalFormat)!=null?h:this._deriveInternalFormat(a,r.dataType);if(DB(e)){let p=e.width,f=e.height;const m=1;e instanceof HTMLVideoElement&&(p=e.videoWidth,f=e.videoHeight),r.width&&r.height,n&&r.depth,r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,r.hasMipmap,p,f,m),this._texImage(s,0,l,p,f,m,e),Zv(i),r.hasMipmap&&this.generateMipmap(),r.width===void 0&&(r.width=p),r.height===void 0&&(r.height=f),n&&r.depth===void 0&&(r.depth=m)}else{const{width:p,height:f,depth:m}=r;if(p==null||f==null)throw new Error("Width and height must be specified!");if(n&&m==null)throw new Error("Depth must be specified!");if(r.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,r.hasMipmap,p,f,m),i.DEPTH24_STENCIL8&&l===i.DEPTH_STENCIL&&(l=i.DEPTH24_STENCIL8),m4(e)){const y=e.levels,_=Nae(s,p,f,m),b=Math.min(_-1,y.length-1);v(this._context.gl2)?i.texParameteri(r.target,this._context.gl2.TEXTURE_MAX_LEVEL,b):r.hasMipmap=r.hasMipmap&&_===y.length;const w=l;if(!qKe(w))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((T,S,E,M)=>{const A=y[Math.min(T,y.length-1)];this._compressedTexImage(s,T,w,S,E,M,A)},b)}else v(e)?(this._texImage(s,0,l,p,f,m,e),Zv(i),r.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((y,_,b,w)=>{this._texImage(s,y,l,_,b,w,null),Zv(i)})}pt._applySamplingMode(i,this._descriptor),pt._applyWrapMode(i,this._descriptor),pt._applyAnisotropicFilteringParameters(this._context,this._descriptor),Zv(i),this._context.bindTexture(o,pt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,i,r,s,n,o=0){var _;n||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,dataType:h,target:p,isImmutable:f}=l,m=(_=l.internalFormat)!=null?_:this._deriveInternalFormat(c,h);if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const y=this._context.bindTexture(this,pt.TEXTURE_UNIT_FOR_UPDATES,!0);if((t<0||i<0||r>l.width||s>l.height||t+r>l.width||i+s>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),o){if(C(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");a.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,o)}if(DB(n)?v(this._context.gl2)?this._context.gl2.texSubImage2D(p,e,t,i,r,s,c,h,n):a.texSubImage2D(p,e,t,i,c,h,n):m4(n)?a.compressedTexSubImage2D(p,e,t,i,r,s,m,n.levels[e]):a.texSubImage2D(p,e,t,i,r,s,c,h,n),o){if(C(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");a.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(y,pt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,t,i,r,s,n,o,a){var b;a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl2;if(C(l))throw new Error("3D textures are not supported in WebGL1");const c=this._descriptor,{pixelFormat:h,dataType:p,isImmutable:f,target:m}=c,y=(b=c.internalFormat)!=null?b:this._deriveInternalFormat(h,p);if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");Ib(m)||console.warn("Attempting to set 3D texture data on a non-3D texture");const _=this._context.bindTexture(this,pt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(pt.TEXTURE_UNIT_FOR_UPDATES),(t<0||i<0||r<0||s>c.width||n>c.height||o>c.depth||t+s>c.width||i+n>c.height||r+o>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),m4(a))a=a.levels[e],l.compressedTexSubImage3D(m,e,t,i,r,s,n,o,y,a);else{const w=a;l.texSubImage3D(m,e,t,i,r,s,n,o,h,p,w)}this._context.bindTexture(_,pt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,pt._validateTexture(this._context,e)}e.samplingMode===nt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=nt.LINEAR_MIPMAP_NEAREST):e.samplingMode===nt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=nt.NEAREST_MIPMAP_NEAREST);const t=this._context.bindTexture(this,pt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(pt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(e.target),this._context.bindTexture(t,pt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,pt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(pt._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(pt._applyWrapMode(e,t),this._wrapModeDirty=!1)}_deriveInternalFormat(e,t){if(this._context.type===Tt.WEBGL1)return e;switch(t){case kt.FLOAT:switch(e){case ze.RGBA:return Mt.RGBA32F;case ze.RGB:return Mt.RGB32F;default:throw new Error("Unable to derive format")}case kt.UNSIGNED_BYTE:switch(e){case ze.RGBA:return Mt.RGBA8;case ze.RGB:return Mt.RGB8}default:return e}}_configurePixelStorage(){const e=this._context.gl,{unpackAlignment:t,flipped:i,preMultiplyAlpha:r}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r?1:0)}_texStorage(e,t,i,r,s,n){const o=this._context.gl2;if(C(o))throw new Error("Immutable textures are not supported in WebGL1");if(!HKe(t))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const a=i?Nae(e,r,s,n):1;if(Ib(e)){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");o.texStorage3D(e,a,t,r,s,n)}else o.texStorage2D(e,a,t,r,s);this._wasImmutablyAllocated=!0}_texImage(e,t,i,r,s,n,o){const a=this._context.gl;let l=null;const c=this._context.type===Tt.WEBGL2,h=Ib(e),{isImmutable:p,pixelFormat:f,dataType:m}=this._descriptor;if(c&&(l=a),c||!DB(o))if(p){if(v(o)){const y=o;if(h){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,t,0,0,0,r,s,n,f,m,y)}else a.texSubImage2D(e,t,0,0,r,s,f,m,y)}}else{const y=o;if(h){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");l.texImage3D(e,t,i,r,s,n,0,f,m,y)}else a.texImage2D(e,t,i,r,s,0,f,m,y)}else a.texImage2D(e,0,i,f,m,o)}_compressedTexImage(e,t,i,r,s,n,o){const a=this._context.gl;let l=null;const c=Ib(e),h=this._descriptor.isImmutable;if(c){if(this._context.type!==Tt.WEBGL2)throw new Error("3D textures are not supported in WebGL1");l=a}if(h){if(v(o))if(c){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,r,s,n,i,o)}else a.compressedTexSubImage2D(e,t,0,0,r,s,i,o)}else if(c){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,i,r,s,n,0,o)}else a.compressedTexImage2D(e,t,i,r,s,0,o)}_forEachMipmapLevel(e,t=1/0){let{width:i,height:r,depth:s,hasMipmap:n,target:o}=this._descriptor;const a=o===St.TEXTURE_3D;if(i==null||r==null||a&&s==null)throw new Error("Missing texture dimensions for mipmap calculation");for(let l=0;e(l,i,r,s),n&&(i!==1||r!==1||a&&s!==1)&&!(l>=t);++l)i=Math.max(1,i>>1),r=Math.max(1,r>>1),a&&(s=Math.max(1,s>>1))}static _validateTexture(e,t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=e.type===Tt.WEBGL2,r=t.width!=null&&$f(t.width)&&t.height!=null&&$f(t.height);i||!t.isImmutable&&!Ib(t.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),i||r||(typeof t.wrapMode=="number"?t.wrapMode!==Pt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):t.wrapMode.s===Pt.CLAMP_TO_EDGE&&t.wrapMode.t===Pt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let i=t.samplingMode,r=t.samplingMode;i===nt.LINEAR_MIPMAP_NEAREST||i===nt.LINEAR_MIPMAP_LINEAR?(i=nt.LINEAR,t.hasMipmap||(r=nt.LINEAR)):i!==nt.NEAREST_MIPMAP_NEAREST&&i!==nt.NEAREST_MIPMAP_LINEAR||(i=nt.NEAREST,t.hasMipmap||(r=nt.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,i),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,r)}static _applyWrapMode(e,t){typeof t.wrapMode=="number"?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){var r;const i=e.capabilities.textureFilterAnisotropic;!i||e.gl.texParameterf(t.target,i.TEXTURE_MAX_ANISOTROPY,(r=t.maxAnisotropy)!=null?r:1)}};function HKe(e){return e in Mt}function qKe(e){return e in an}function m4(e){return v(e)&&"type"in e&&e.type==="compressed"}function WKe(e){return v(e)&&"byteLength"in e}function DB(e){return v(e)&&!m4(e)&&!WKe(e)}function Ib(e){return e===St.TEXTURE_3D||e===St.TEXTURE_2D_ARRAY}function Nae(e,t,i,r=1){let s=Math.max(t,i);return e===St.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}pt.TEXTURE_UNIT_FOR_UPDATES=0;function Tl(e,t=vQ,i=ji,r=-1,s=1){let n=null;return t===vM?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new Wf(e,i,{geometry:t},{geometry:Oi.createVertex(e,Xi.STATIC_DRAW,n)})}function XKe(e,t=vQ,i=ji){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Wf(e,i,{geometry:t},{geometry:Oi.createVertex(e,Xi.STATIC_DRAW,r)})}const gSe=4;function ySe(e,t=gSe){return new pt(e,{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:t,height:t})}function YKe(e,t,i=gSe){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*t[0],r[s+1]=255*t[1],r[s+2]=255*t[2],r[s+3]=255*t[3];return new pt(e,{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:i,height:i},r)}function _Se(e){return new pt(e,{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class FB{constructor(t,i){this._view=t,this.type=yo.Realistic,this._handles=new Ii,this._passParameters=new kKe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Mi.radius,this._fadeHaze=0,this._updateRadius(Mi.radius);const r=i.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([te(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),te(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const s=new pSe;s.haze=!1,this._atmosphereTechnique=i.techniqueRepository.acquire(nP,s),s.haze=!0,this._atmosphereHazeTechnique=i.techniqueRepository.acquire(nP,s),this._vao=Tl(r,vM)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,i){this._fadeHaze=i,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,i,r){if(C(r))return;this._update(t.bindParameters.camera),this._passParameters.depthTex=r;const s=t.rctx.bindTechnique(i,this._passParameters,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>this._renderCommon(s,t))}_renderCommon(t,i){C(this._vao)||(i.rctx.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(Nt.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const t=this._view.basemapTerrain.rootTileElevationBounds.min;t!==this._rootTileElevationMin&&(this._rootTileElevationMin=t,this._lowerBoundEarthRadius=Mi.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(Mi.radius+this._view.basemapTerrain.visibleElevationBounds.min);t<this._lowerBoundEarthRadius&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,di(this._passParameters.radii,t,t+sP),this._passParameters.innerFadeDistance=2*Math.sqrt((2*t-aX)*aX)}_update(t){if(C(t))return;const i=ll(t.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=ye((r-this._passParameters.radii[0])/sP,0,1);mr(this._passParameters.heightParameters,r,i,s,n),this._passParameters.altitudeFade=gQ(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=zt(zt(.6,1,UC(9500,10500,r-Mi.radius)),1,this._fadeHaze)}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}function as(){return new Float32Array(3)}function yk(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ur(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function vSe(e,t){return new Float32Array(e,t,3)}function xQ(){return as()}function bSe(){return ur(1,1,1)}function wSe(){return ur(1,0,0)}function xSe(){return ur(0,1,0)}function TSe(){return ur(0,0,1)}const ZKe=xQ(),JKe=bSe(),KKe=wSe(),QKe=xSe(),eQe=TSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:JKe,UNIT_X:KKe,UNIT_Y:QKe,UNIT_Z:eQe,ZEROS:ZKe,clone:yk,create:as,createView:vSe,fromValues:ur,ones:bSe,unitX:wSe,unitY:xSe,unitZ:TSe,zeros:xQ},Symbol.toStringTag,{value:"Module"}));function SSe(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function TQ(e,t){switch(e.include(yg,t),e.fragment.code.add(x`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case En.Default:case En.Compressed:return void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case En.Atlas:return e.include(SSe),void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case En.None:case En.COUNT:return}}class Uh extends Zs{constructor(t,i){super(t,"vec3",Ar.Draw,(r,s,n,o)=>r.setUniform3fv(t,i(s,n,o)))}}class oP extends Zs{constructor(t,i){super(t,"vec2",Ar.Draw,(r,s,n,o)=>r.setUniform2fv(t,i(s,n,o)))}}class L$ extends Zs{constructor(t,i){super(t,"sampler2D",Ar.Draw,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function L1(e,t,i=fr.None){const r=[new L$(e,t)];if(i&fr.Size){const s=e+yQ;r.push(new oP(s,(n,o)=>{const a=t(n,o);return v(a)?di(kae,a.descriptor.width,a.descriptor.height):Bc}))}if(i&fr.InvSize){const s=e+s8;r.push(new oP(s,(n,o)=>{const a=t(n,o);return v(a)?di(kae,1/a.descriptor.width,1/a.descriptor.height):Bc}))}return r}const kae=tt();class yb{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(t,i){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(t){return _0.LOADED}}class SQ extends yb{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,i=>this._texture=i),this._acquire(t.normalTextureId,i=>this._textureNormal=i),this._acquire(t.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(t.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(t.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=ls(this._texture),this._textureNormal=ls(this._textureNormal),this._textureEmissive=ls(this._textureEmissive),this._textureOcclusion=ls(this._textureOcclusion),this._textureMetallicRoughness=ls(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?_0.LOADED:_0.LOADING}get textureBindParameters(){return new ESe(v(this._texture)?this._texture.glTexture:null,v(this._textureNormal)?this._textureNormal.glTexture:null,v(this._textureEmissive)?this._textureEmissive.glTexture:null,v(this._textureOcclusion)?this._textureOcclusion.glTexture:null,v(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(C(this._texture)||t!==this._texture.id)&&(this._texture=ls(this._texture),this._textureId=t,this._acquire(this._textureId,i=>this._texture=i))}_acquire(t,i){if(C(t))return void i(null);const r=this._textureRepository.acquire(t);if(Yh(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return ls(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}}class ESe extends Rr{constructor(t=null,i=null,r=null,s=null,n=null){super(),this.texture=t,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const GOt=ur(0,.6,.2);var gt;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.Terrain=5]="Terrain",e[e.TerrainWithWater=6]="TerrainWithWater",e[e.COUNT=7]="COUNT"})(gt||(gt={}));function EQ(e,t){const i=e.fragment,r=t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===gt.Normal&&r&&e.include(TQ,t),t.pbrMode!==gt.Schematic)if(t.pbrMode!==gt.Disabled){if(t.pbrMode===gt.Normal){i.code.add(x`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas?t.hasWebGL2Context?fr.None:fr.Size:fr.None,n=t.pbrTextureBindType;t.hasMetallicRoughnessTexture&&(i.uniforms.add(n===Ar.Pass?Rf("texMetallicRoughness",o=>o.textureMetallicRoughness,s):L1("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),i.code.add(x`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(n===Ar.Pass?Rf("texEmission",o=>o.textureEmissive,s):L1("texEmission",o=>o.textureEmissive,s)),i.code.add(x`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(n===Ar.Pass?Rf("texOcclusion",o=>o.textureOcclusion,s):L1("texOcclusion",o=>o.textureOcclusion,s)),i.code.add(x`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(x`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===Ar.Pass?[new Jt("emissionFactor",o=>o.emissiveFactor),new Jt("mrrFactors",o=>o.mrrFactors)]:[new Uh("emissionFactor",o=>o.emissiveFactor),new Uh("mrrFactors",o=>o.mrrFactors)]),i.code.add(x`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?x`vtc.uv = vuv0;`:""}
      ${t.hasMetallicRoughnessTextureTransform?x`vtc.uv = metallicRoughnessUV;`:""}
      ${t.hasMetallicRoughnessTexture?t.supportsTextureAtlas?x`
                vtc.size = ${Zd(t,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:x`applyMetallnessAndRoughness(vtc);`:""}
      ${t.hasEmissiveTextureTransform?x`vtc.uv = emissiveUV;`:""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?x`
                vtc.size = ${Zd(t,"texEmission")};
                applyEmission(vtc);`:x`applyEmission(vtc);`:""}
      ${t.hasOcclusionTextureTransform?x`vtc.uv = occlusionUV;`:""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?x`
                vtc.size = ${Zd(t,"texOcclusion")};
                applyOcclusion(vtc);`:x`applyOcclusion(vtc);`:""}
    }
  `)}}else i.code.add(x`float getBakedOcclusion() { return 1.0; }`);else i.code.add(x`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function CQ(e,t){const i=e.fragment,r=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Jt("lightingAmbientSH0",(s,n)=>ue(Uae,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new xi("lightingAmbientSH_R",(s,n)=>mr(ty,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new xi("lightingAmbientSH_G",(s,n)=>mr(ty,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new xi("lightingAmbientSH_B",(s,n)=>mr(ty,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new Jt("lightingAmbientSH0",(s,n)=>ue(Uae,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new xi("lightingAmbientSH_R1",(s,n)=>mr(ty,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new xi("lightingAmbientSH_G1",(s,n)=>mr(ty,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new xi("lightingAmbientSH_B1",(s,n)=>mr(ty,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new xi("lightingAmbientSH_R2",(s,n)=>mr(ty,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new xi("lightingAmbientSH_G2",(s,n)=>mr(ty,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new xi("lightingAmbientSH_B2",(s,n)=>mr(ty,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==gt.Normal&&t.pbrMode!==gt.Schematic||i.code.add(x`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Uae=O(),ty=ui();function D$(e){e.vertex.code.add(x`const float PI = 3.141592653589793;`),e.fragment.code.add(x`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var un,MT;function tQe(e){return v(e)&&v(e.cubeMap)}function AQ(e){return v(e)&&!e.running}(function(e){e[e.RENDERING=0]="RENDERING",e[e.FINISHED_RENDERING=1]="FINISHED_RENDERING",e[e.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",e[e.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",e[e.FINISHED=4]="FINISHED"})(un||(un={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(MT||(MT={}));class iQe{constructor(){this.readChannels=MT.RG,this.renderingStage=un.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=O(),this.isCameraPositionFinal=!0,this.parallax=new Vae,this.parallaxNew=new Vae,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:_o.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:yu.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:J1.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===_o.FADE_OUT||this.fadeInOut.stage===_o.FADE_IN||this.fadeIn.stage===yu.FADE_IN||this.fadeInOutHeight.stage!==J1.FINISHED||this.renderingStage===un.FADING_TEXTURE_CHANNELS}}var yu,_o,J1;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(yu||(yu={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(_o||(_o={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(J1||(J1={}));class Vae{constructor(){this.anchorPointClouds=O(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=Pe()}}class v0 extends Zs{constructor(t,i){super(t,"bool",Ar.Pass,(r,s,n)=>r.setUniform1b(t,i(s,n)))}}class rQe extends Zs{constructor(t,i){super(t,"samplerCube",Ar.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function CSe(e){const t=e.fragment;t.uniforms.add([new ds("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new ds("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new Jt("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new Jt("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new Ie("cloudsHeight",(i,r)=>r.cloudsFade.parallax.cloudsHeight),new Ie("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ie("totalFadeInOut",(i,r)=>r.cloudsFade.fadeInOut.stage===_o.FINISHED?r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeIn.factor:r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeInOut.factor),new Ie("crossFadeAnchorFactor",(i,r)=>ye(r.cloudsFade.crossFade.factor,0,1)),new rQe("cubeMap",(i,r)=>v(r.cloudsFade.data)&&v(r.cloudsFade.data.cubeMap)?r.cloudsFade.data.cubeMap.colorTexture:null),new v0("crossFade",(i,r)=>r.cloudsFade.crossFade.enabled),new v0("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===MT.RG),new v0("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===un.FADING_TEXTURE_CHANNELS)]),t.constants.add("planetRadius","float",Mi.radius),t.code.add(x`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(x`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(x`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Y0(t),Bg(t),t.code.add(x`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(x`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),t.code.add(x`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(x`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(x`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function zg(e){e.code.add(x`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function sQe(){const e=new Yi;e.attributes.add(R.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:i}=e;return t.uniforms.add([new ds("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new ds("inverseViewMatrix",(r,s)=>aM(nQe,s.camera.viewMatrix))]),t.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(zg),i.include(ku),e.include(CQ,{pbrMode:gt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(D$),e.include(r8),e.include(fk,{useLegacyTerrainShading:!1}),e.include(CSe,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),i.uniforms.add([new Jt("cameraPosition",(r,s)=>s.camera.eye)]),i.code.add(x`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const nQe=Pe(),oQe=Object.freeze(Object.defineProperty({__proto__:null,build:sQe},Symbol.toStringTag,{value:"Module"}));class o8 extends ir{constructor(t){super(t,new xl,()=>this.destroy())}initializeProgram(t){return new Ji(t.rctx,o8.shader.get().build(),ji)}initializePipeline(){return Ht({blending:Ro(Ce.ONE,Ce.ZERO,Ce.SRC_ALPHA,Ce.ONE),depthTest:{func:Zr.LEQUAL},colorWrite:si})}}o8.shader=new Zi(oQe,()=>Q(()=>import("./CloudsComposition.glsl.b9106ae0.js"),[]));let Zw=class extends Te{constructor(e){super(e),this._technique=new o8(e),this._vao=Tl(e.rctx)}destroy(){this._technique=ls(this._technique),this._vao=rt(this._vao)}render(e){const t=e.bindParameters.cloudsFade;if(C(this._vao)||C(t.data))return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,aQe,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Nt.TRIANGLE_STRIP,0,4)}};u([d({constructOnly:!0})],Zw.prototype,"rctx",void 0),u([d({constructOnly:!0})],Zw.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Zw.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],Zw.prototype,"requestRender",void 0),Zw=u([P("esri.views.3d.environment.CloudsComposition")],Zw);const aQe=new Rr;function cp(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function lQe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function MQ(e,t,i,r,s,n,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function RQ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function up(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function lS(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=i*p+r*f+s*m;return y?(y=1/y,e[0]=p*y,e[1]=(-h*r+s*c)*y,e[2]=(a*r-s*o)*y,e[3]=f*y,e[4]=(h*i-s*l)*y,e[5]=(-a*i+s*n)*y,e[6]=m*y,e[7]=(-c*i+r*l)*y,e[8]=(o*i-r*n)*y,e):null}function cQe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-r*h,e[2]=r*a-s*o,e[3]=a*l-n*h,e[4]=i*h-s*l,e[5]=s*n-i*a,e[6]=n*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*n,e}function uQe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function wA(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1],y=i[2],_=i[3],b=i[4],w=i[5],T=i[6],S=i[7],E=i[8];return e[0]=f*r+m*o+y*c,e[1]=f*s+m*a+y*h,e[2]=f*n+m*l+y*p,e[3]=_*r+b*o+w*c,e[4]=_*s+b*a+w*h,e[5]=_*n+b*l+w*p,e[6]=T*r+S*o+E*c,e[7]=T*s+S*a+E*h,e[8]=T*n+S*l+E*p,e}function _k(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*r+m*o+c,e[7]=f*s+m*a+h,e[8]=f*n+m*l+p,e}function OQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=Math.sin(i),m=Math.cos(i);return e[0]=m*r+f*o,e[1]=m*s+f*a,e[2]=m*n+f*l,e[3]=m*o-f*r,e[4]=m*a-f*s,e[5]=m*l-f*n,e[6]=c,e[7]=h,e[8]=p,e}function IQ(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function hQe(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function dQe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function pQe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function fQe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function mQe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function PQ(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,_=n*o,b=n*a,w=n*l;return e[0]=1-p-y,e[3]=h-w,e[6]=f+b,e[1]=h+w,e[4]=1-c-y,e[7]=m-_,e[2]=f-b,e[5]=m+_,e[8]=1-c-p,e}function ASe(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=i*p+r*f+s*m;if(!y)return null;const _=1/y;return e[0]=p*_,e[1]=(-h*r+s*c)*_,e[2]=(a*r-s*o)*_,e[3]=f*_,e[4]=(h*i-s*l)*_,e[5]=(-a*i+s*n)*_,e[6]=m*_,e[7]=(-c*i+r*l)*_,e[8]=(o*i-r*n)*_,e}function xA(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],b=t[14],w=t[15],T=i*a-r*o,S=i*l-s*o,E=i*c-n*o,M=r*l-s*a,A=r*c-n*a,$=s*c-n*l,I=h*_-p*y,k=h*b-f*y,V=h*w-m*y,B=p*b-f*_,G=p*w-m*_,X=f*w-m*b;let K=T*X-S*G+E*B+M*V-A*k+$*I;return K?(K=1/K,e[0]=(a*X-l*G+c*B)*K,e[1]=(l*V-o*X-c*k)*K,e[2]=(o*G-a*V+c*I)*K,e[3]=(s*G-r*X-n*B)*K,e[4]=(i*X-s*V+n*k)*K,e[5]=(r*V-i*G-n*I)*K,e[6]=(_*$-b*A+w*M)*K,e[7]=(b*E-y*$-w*S)*K,e[8]=(y*A-_*E+w*T)*K,e):null}function gQe(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function yQe(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function _Qe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function vQe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function MSe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function bQe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function wQe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function xQe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function TQe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],f=t[1],m=t[2],y=t[3],_=t[4],b=t[5],w=t[6],T=t[7],S=t[8],E=vl();return Math.abs(i-p)<=E*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=E*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=E*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=E*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=E*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-b)<=E*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-w)<=E*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-T)<=E*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-S)<=E*Math.max(1,Math.abs(h),Math.abs(S))}function $Q(e){const t=vl(),i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const SQe=wA,EQe=MSe;Object.freeze(Object.defineProperty({__proto__:null,add:vQe,adjoint:cQe,copy:lQe,determinant:uQe,equals:TQe,exactEquals:xQe,frob:_Qe,fromMat2d:mQe,fromMat4:cp,fromQuat:PQ,fromRotation:pQe,fromScaling:fQe,fromTranslation:dQe,identity:RQ,invert:lS,isOrthoNormal:$Q,mul:SQe,multiply:wA,multiplyScalar:bQe,multiplyScalarAndAdd:wQe,normalFromMat4:xA,normalFromMat4Legacy:ASe,projection:gQe,rotate:OQ,scale:IQ,scaleByVec2:hQe,set:MQ,str:yQe,sub:EQe,subtract:MSe,translate:_k,transpose:up},Symbol.toStringTag,{value:"Module"}));var Lc;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(Lc||(Lc={}));class g4 extends xl{constructor(){super(...arguments),this.steps=Lc.SIXTEEN,this.writeTextureChannels=MT.RG}}u([j({count:Lc.COUNT})],g4.prototype,"steps",void 0),u([j({constValue:he("esri-mobile")?1024:2048})],g4.prototype,"cubeMapSize",void 0),u([j()],g4.prototype,"writeTextureChannels",void 0);class XO{constructor(t,i,r,s,n,o,a,l,c=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}}const Bae=new XO([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Lc.SIXTEEN),il={sunny:Bae,cloudy:new XO([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Lc.TWOHUNDRED,.6),rainy:new XO([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Lc.TWOHUNDRED,.4),snowy:new XO([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Lc.HUNDRED,.65),foggy:new XO([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Lc.SIXTEEN),default:Bae},Ld=he("esri-mobile")?64:128,CQe=Ld/128,ef=Math.ceil(Math.sqrt(Ld)),df=(Ld+2)*ef,AQe=1e5,NB=128,MQe=df/1560;function mp(e,t=!0){e.attributes.add(R.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(x`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?x`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class aP extends Zs{constructor(t,i){super(t,"mat3",Ar.Draw,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class RSe extends Rr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=il.default.raymarchingSteps,this.weatherTile=tt()}}class OSe extends Rr{constructor(){super(...arguments),this.viewMatrix=Cs()}}function RQe(e){const t=new Yi;t.include(mp,!1);const i=t.fragment;return i.uniforms.add([new Ie("cloudRadius",r=>r.cloudRadius),new Ie("power",r=>zt(35,120,r.absorption)),new Ie("sigmaE",r=>1+r.absorption),new Ie("density",r=>zt(0,.3,r.density)),new Ie("cloudSize",r=>zt(0,.02,Math.max(.01,1-r.cloudSize))),new Ie("detailSize",r=>zt(0,.2,Math.max(.01,1-r.detailSize))),new Ie("smoothness",r=>zt(0,.5,1-r.smoothness)),new Ie("cloudHeight",r=>zt(0,1500,r.cloudHeight)),new Ie("coverage",r=>r.coverage),new aP("view",r=>r.viewMatrix),new Lt("cloudShapeTexture",r=>v(r.noiseTexture)?r.noiseTexture.textureAtlas:null),new tr("cloudVariables",r=>di(OQe,r.coverage,r.absorption))]),i.constants.add("halfCubeMapSize","float",.5*e.cubeMapSize),i.code.add(x`
    const int STEPS = ${e.steps===Lc.SIXTEEN?x`16`:e.steps===Lc.HUNDRED?x`100`:x`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(x`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${x.float(df)};
      const float dataWidth = ${x.float(df)};
      const float tileRows = ${x.float(ef)};
      const vec3 atlasDimensions = vec3(${x.float(Ld)}, ${x.float(Ld)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${x.float(CQe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${x.float(MQe)} * p) / ${x.float(df)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),i.code.add(x`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(x`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(x`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(x`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(x`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),t}const OQe=tt(),IQe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:OSe,CloudsPassParameters:RSe,build:RQe},Symbol.toStringTag,{value:"Module"}));class a8 extends ir{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){return new Ji(t.rctx,a8.shader.get().build(this.configuration),ji)}initializePipeline(){return Ht({blending:qf(Ce.CONSTANT_COLOR,Ce.ONE_MINUS_CONSTANT_COLOR,Ig.ADD,this.configuration.writeTextureChannels===MT.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Zr.LEQUAL},colorWrite:si})}}a8.shader=new Zi(IQe,()=>Q(()=>import("./Clouds.glsl.139054ee.js"),[]));var Oh;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(Oh||(Oh={}));class uX extends xl{constructor(){super(...arguments),this.mode=Oh.Full}}u([j({count:Oh.COUNT})],uX.prototype,"mode",void 0);class ISe extends Rr{constructor(){super(...arguments),this.weatherTile=er(0,0)}}function PQe(e){const t=new Yi;return t.include(mp,!1),t.fragment.code.add(x`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),e.mode===Oh.Full&&t.fragment.code.add(x`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${x.float(ef)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${x.float(8)});

      float worley0 = worley(p, ${x.float(2)} * 2.0);
      float worley1 = worley(p, ${x.float(2)} * 8.0);
      float worley2 = worley(p, ${x.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${x.float(2)});
      float worley1 = worley(p, ${x.float(2)} * 2.0);
      float worley2 = worley(p, ${x.float(2)} * 4.0);
      float worley3 = worley(p, ${x.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.uniforms.add(new tr("weatherTile",i=>i.weatherTile)),t.fragment.code.add(x`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${x.float(NB)});

      // Get global coordinates of p
      p += weatherTile * ${x.float(NB)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${x.float(AQe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(x`void main() {`),e.mode===Oh.Full&&t.fragment.code.add(x`
        float padWidth = 1.0;
        float paddedSize = ${x.float(Ld)} + 2.0 * padWidth;
        float tileCount = ${x.float(ef)} * ${x.float(ef)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${x.float(Ld)};
          }

          if (startPadY) {
            pixel.y += ${x.float(Ld)};
          }

          if (endPadX) {
            pixel.x -= ${x.float(Ld)};
          }

          if (endPadY) {
            pixel.y -= ${x.float(Ld)};
          }

          uv = vec2(pixel.xy / ${x.float(Ld)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${x.float(Ld)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${x.float(ef)} * ${x.float(ef)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${x.float(ef)} * ${x.float(ef)});
        p = p_;
        p.z /= (${x.float(ef)} * ${x.float(ef)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(x`
      vec2 mapUV = ${x.float(NB)} * (gl_FragCoord.xy / ${x.float(df)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===Oh.Full?x`gl_FragColor.ba = vec2(0.0, map);`:x`gl_FragColor = vec4(map);`};
    }
  `),t}const $Qe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:ISe,build:PQe},Symbol.toStringTag,{value:"Module"}));class lP extends ir{initializeProgram(t){return new Ji(t.rctx,lP.shader.get().build(this.configuration),ji)}initializePipeline(){return Ht({blending:this.configuration.mode===Oh.Full?qf(Ce.ONE,Ce.ZERO):Ro(Ce.ZERO,Ce.ONE,Ce.ONE,Ce.ZERO),depthTest:{func:Zr.ALWAYS},colorWrite:si})}}lP.shader=new Zi($Qe,()=>Q(()=>import("./NoiseTextureAtlas.glsl.78ba0deb.js"),[]));class cE{constructor(t,i){this._context=t,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(Co.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==Tt.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,i=this._context.parameters.maxSamples;return t?Math.min(t,i):i}resize(t,i){const r=this._desc;if(r.width===t&&r.height===i)return;r.width=t,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Co.Renderbuffer,this),this._context=sT(this._context))}}class Yr{constructor(t,i,r=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...i},t.instanceCounter.increment(Co.FramebufferObject,this),v(r)){Array.isArray(r)||(r=[r]);for(let o=0;o<r.length;++o){const a=r[o],l=fh.COLOR_ATTACHMENT0+o;let c;Gae(a)?(Uy(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new pt(this._context,c))),oD(c,this._desc)):(zae(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new cE(this._context,c))),kB(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(v(s)){let o,a;if(Gae(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),Uy(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new pt(this._context,a)),oD(a,this._desc);else{zae(s)?(a=s.descriptor,o=s):(a=s,o=new cE(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:Wi.DEPTH_STENCIL_RENDER_BUFFER;l===Wi.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===Wi.DEPTH_RENDER_BUFFER||l===Wi.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=l,kB(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(Co.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(fh.COLOR_ATTACHMENT0);return t&&Uy(t)?t:null}get colorAttachment(){return this._colorAttachments.get(fh.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){var t;return(t=this._desc.width)!=null?t:0}get height(){var t;return(t=this._desc.height)!=null?t:0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[i,r])=>t+AT(r),0)+AT(this.depthStencilAttachment)}getColorTexture(t){const i=this._colorAttachments.get(t);return i&&Uy(i)?i:null}attachColorTexture(t,i=fh.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(i),oD(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,i)),this._colorAttachments.set(i,t))}detachColorTexture(t=fh.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);if(Uy(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}}setColorTextureTarget(t,i=fh.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);Uy(r)&&this._framebufferTexture2D(r.glName,i,t)}attachDepthStencilTexture(t){if(C(t))return;const i=t.descriptor;i.pixelFormat!==ze.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==kt.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),oD(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Wi.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Wi.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,Rae)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Rae)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(C(t))return;const i=t.descriptor;if(i.internalFormat!==zl.DEPTH_STENCIL&&i.internalFormat!==zl.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),kB(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===zl.DEPTH_STENCIL?Wi.DEPTH_STENCIL_RENDER_BUFFER:Wi.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===Wi.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(zo.FRAMEBUFFER,s,r.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Wi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(zo.FRAMEBUFFER,r,t.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((t,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,i,r,s,n,o,a){(t<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==St.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||(c==null?void 0:c.width)==null||(c==null?void 0:c.height)==null||t+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,pt.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(pt.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(St.TEXTURE_2D,0,n,o,t,i,r,s),h.bindTexture(p,pt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,i,r,s,n,o,a)}async readPixelsAsync(t,i,r,s,n,o,a){if(this._context.type!==Tt.WEBGL2)return _h()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,i,r,s,n,o,a);const l=this._context.gl,c=Oi.createPixelPack(this._context,Xi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,i,r,s,n,o,0),this._context.unbindBuffer($t.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,i){const r=this._desc;if(r.width!==t||r.height!==i){if(r.width=t,r.height=i,!this._initialized)return this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,i));this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,i),this._stencilAttachment&&this._stencilAttachment.resize(t,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=zo.FRAMEBUFFER){var h,p,f,m;const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(t,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,s=i.createFramebuffer(),n=this._desc,o=(h=n.colorTarget)!=null?h:Ls.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(f=n.height)!=null?f:1;if(i.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===Ls.TEXTURE||o===Ls.CUBEMAP)this._colorAttachments.set(fh.COLOR_ATTACHMENT0,LQe(r,n,this.descriptor.colorTarget===Ls.CUBEMAP?St.TEXTURE_CUBE_MAP:St.TEXTURE_2D));else{const y=new cE(r,{internalFormat:Mt.RGBA4,width:a,height:l});this._colorAttachments.set(fh.COLOR_ATTACHMENT0,y)}this._colorAttachments.forEach((y,_)=>{y&&(Uy(y)?this._framebufferTexture2D(y.glName,_,jae(y),t):i.framebufferRenderbuffer(t,_,i.RENDERBUFFER,y.glName))});const c=(m=n.depthStencilTarget)!=null?m:Wi.NONE;switch(c){case Wi.DEPTH_RENDER_BUFFER:case Wi.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new cE(r,{internalFormat:n.depthStencilTarget===Wi.DEPTH_RENDER_BUFFER?zl.DEPTH_COMPONENT16:zl.DEPTH_STENCIL,width:a,height:l}));const y=c===Wi.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(t,y,i.RENDERBUFFER,this._depthAttachment.glName);break}case Wi.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new cE(r,{internalFormat:zl.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(t,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case Wi.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const y={target:St.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:kt.UNSIGNED_INT_24_8,samplingMode:nt.NEAREST,wrapMode:Pt.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new pt(r,y)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,jae(this._depthStencilTexture),t)}_h()&&i.checkFramebufferStatus(t)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,i=fh.COLOR_ATTACHMENT0,r=St.TEXTURE_2D,s=zo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,t,n)}_detachColorAttachment(t){_h()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(t);return Uy(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(zo.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._colorAttachments.delete(t),r}_disposeColorAttachments(){this._colorAttachments.forEach((t,i)=>{this._detachColorAttachment(i),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Wi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(zo.FRAMEBUFFER,i,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(zo.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(Yr._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;Yr._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else Yr._MAX_COLOR_ATTACHMENTS=1}const i=t-fh.COLOR_ATTACHMENT0;i+1>Yr._MAX_COLOR_ATTACHMENTS&&se.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${Yr._MAX_COLOR_ATTACHMENTS} color attachments`)}}function Uy(e){return e!=null&&"type"in e&&e.type==="texture"}function zae(e){return e!=null&&"type"in e&&e.type==="renderbuffer"}function Gae(e){return Uy(e)||e!=null&&"pixelFormat"in e}function LQe(e,t,i){return new pt(e,{target:i,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,wrapMode:Pt.CLAMP_TO_EDGE,width:t.width,height:t.height})}function oD(e,t){e.target!==St.TEXTURE_2D&&e.target!==St.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function kB(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function jae(e){return e.descriptor.target===St.TEXTURE_CUBE_MAP?St.TEXTURE_CUBE_MAP_POSITIVE_X:St.TEXTURE_2D}Yr._MAX_COLOR_ATTACHMENTS=-1;let YO=class extends Te{constructor(e){super(e),this._needsRender=!0,this._passParameters=new ISe,this._frameBuffer=new Yr(e.context.renderContext.rctx,{colorTarget:Ls.TEXTURE,width:df,height:df},{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,hasMipmap:!1,width:df,height:df}),this._vao=Tl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return v(this._texture)?v(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Oh.WeatherMap)):v(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(Oh.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Mo(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=ls(this._fullTechniqueCached),this._weatherMapTechniqueCached=ls(this._weatherMapTechniqueCached),this._frameBuffer=rt(this._frameBuffer),this._vao=rt(this._vao)}get _fullTechnique(){if(C(this._fullTechniqueCached)){const e=new uX;e.mode=Oh.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(lP,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(C(this._weatherMapTechniqueCached)){const e=new uX;e.mode=Oh.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(lP,e)}return this._weatherMapTechniqueCached}_render(e){if(C(this._vao)||C(this._frameBuffer))return null;const t=e===Oh.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,r=i.getViewport();i.setViewport(0,0,df,df),i.bindFramebuffer(this._frameBuffer);const s=i.bindTechnique(t,this._passParameters,null);return i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(r.x,r.y,r.width,r.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([d({constructOnly:!0})],YO.prototype,"context",void 0),u([d({readOnly:!0})],YO.prototype,"_techniqueRepository",null),YO=u([P("esri.views.3d.environment.NoiseTextureAtlas")],YO);function PSe(e){e.include(Wh),e.uniforms.add([new Lt("geometryDepthTexture",(t,i)=>i.multipassGeometry.linearDepthTexture),new tr("nearFar",(t,i)=>i.camera.nearFar)]),e.code.add(x`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class DQe{constructor(){this.enabled=!1}}function Xh(e,t){t.hasMultipassTerrain&&(e.fragment.include(Wh),e.fragment.uniforms.add(new Lt("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new tr("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.uniforms.add(new tr("inverseViewport",(i,r)=>r.inverseViewport)),e.fragment.code.add(x`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class FQe{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function NQe(e,t){const i=e.fragment;i.include(Wh),i.uniforms.add(new tr("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new Lt("depthMap",(r,s)=>s.linearDepthTexture)),i.uniforms.add(new ds("proj",(r,s)=>s.ssr.camera.projectionMatrix)),i.uniforms.add(new Ie("invResolutionHeight",(r,s)=>1/s.ssr.camera.height)),i.uniforms.add(new ds("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),i.code.add(x`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class kQe{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=Pe()}}function l8(e){return e?{ray:Xo(e.ray),c0:e.c0,c1:e.c1}:{ray:Xo(),c0:0,c1:Number.MAX_VALUE}}function UQe(e,t=l8()){return H5(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function VQe(e,t,i=l8()){const r=Oe(e.vector);return ybe(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function jOt(e,t){return $Se(e,e.c0,t)}function HOt(e,t){return $Se(e,e.c1,t)}function $Se(e,t,i){return fe(i,e.ray.origin,ae(i,e.ray.direction,t))}new W0(()=>l8());function cP(e){return e?[nr(e[0]),nr(e[1]),nr(e[2]),nr(e[3]),nr(e[4]),nr(e[5])]:[nr(),nr(),nr(),nr(),nr(),nr()]}function LSe(){return[O(),O(),O(),O(),O(),O(),O(),O()]}function vk(e,t){for(let i=0;i<K1.NUM;i++)IU(e[i],t[i])}function DSe(e,t,i,r=HQe){const s=Hs(TK.get(),t,e);Ea(s,s);for(let n=0;n<hX.NUM;++n){const o=Ph(xK.get(),jQe[n],s);ue(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}FSe(i,r)}function FSe(e,t){ol(t[ct.FAR_BOTTOM_LEFT],t[ct.NEAR_BOTTOM_LEFT],t[ct.NEAR_TOP_LEFT],e[kr.LEFT]),ol(t[ct.NEAR_BOTTOM_RIGHT],t[ct.FAR_BOTTOM_RIGHT],t[ct.FAR_TOP_RIGHT],e[kr.RIGHT]),ol(t[ct.FAR_BOTTOM_LEFT],t[ct.FAR_BOTTOM_RIGHT],t[ct.NEAR_BOTTOM_RIGHT],e[kr.BOTTOM]),ol(t[ct.NEAR_TOP_LEFT],t[ct.NEAR_TOP_RIGHT],t[ct.FAR_TOP_RIGHT],e[kr.TOP]),ol(t[ct.NEAR_BOTTOM_LEFT],t[ct.NEAR_BOTTOM_RIGHT],t[ct.NEAR_TOP_RIGHT],e[kr.NEAR]),ol(t[ct.FAR_BOTTOM_RIGHT],t[ct.FAR_BOTTOM_LEFT],t[ct.FAR_TOP_LEFT],e[kr.FAR])}function v1(e,t){for(let i=0;i<K1.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function BQe(e,t){return kSe(e,UQe(t,USe.get()))}function qOt(e,t){for(let i=0;i<K1.NUM;i++){const r=e[i];if(!Rze(r,t))return!1}return!0}function zQe(e,t,i){return kSe(e,VQe(t,i,USe.get()))}function NSe(e,t){for(let i=0;i<K1.NUM;i++)if(Ur(e[i],t)>0)return!1;return!0}function kSe(e,t){for(let i=0;i<K1.NUM;i++)if(!Mze(e[i],t))return!1;return!0}var kr,ct;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(kr||(kr={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(ct||(ct={}));const GQe={bottom:[ct.FAR_BOTTOM_RIGHT,ct.NEAR_BOTTOM_RIGHT,ct.NEAR_BOTTOM_LEFT,ct.FAR_BOTTOM_LEFT],near:[ct.NEAR_BOTTOM_LEFT,ct.NEAR_BOTTOM_RIGHT,ct.NEAR_TOP_RIGHT,ct.NEAR_TOP_LEFT],far:[ct.FAR_BOTTOM_RIGHT,ct.FAR_BOTTOM_LEFT,ct.FAR_TOP_LEFT,ct.FAR_TOP_RIGHT],right:[ct.NEAR_BOTTOM_RIGHT,ct.FAR_BOTTOM_RIGHT,ct.FAR_TOP_RIGHT,ct.NEAR_TOP_RIGHT],left:[ct.FAR_BOTTOM_LEFT,ct.NEAR_BOTTOM_LEFT,ct.NEAR_TOP_LEFT,ct.FAR_TOP_LEFT],top:[ct.FAR_TOP_LEFT,ct.NEAR_TOP_LEFT,ct.NEAR_TOP_RIGHT,ct.FAR_TOP_RIGHT]};var K1,hX;(function(e){e[e.NUM=6]="NUM"})(K1||(K1={})),function(e){e[e.NUM=8]="NUM"}(hX||(hX={}));const jQe=[Yt(-1,-1,-1,1),Yt(1,-1,-1,1),Yt(1,1,-1,1),Yt(-1,1,-1,1),Yt(-1,-1,1,1),Yt(1,-1,1,1),Yt(1,1,1,1),Yt(-1,1,1,1)],USe=new W0(l8),HQe=LSe();function qQe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function WQe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function XQe(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function YQe(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}var dX;let Ot=dX=class extends Te{constructor(e={}){super(e),this._center=O(),this._up=O(),this._viewUp=O(),this._viewForward=O(),this._viewRight=O(),this._ray=Xo(),this._viewport=Yt(0,0,1,1),this._padding=Yt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=er(1,1e3),this._viewDirty=!0,this._viewMatrix=Pe(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Pe(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Pe(),this._frustumDirty=!0,this._frustum=cP(),this._fullViewport=ui(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return me(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Ao(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const e=YA(ui(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&QY(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[fi.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[fi.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[fi.RIGHT]+this._padding[fi.LEFT]}set fullWidth(e){this.width=e-(this._padding[fi.RIGHT]+this._padding[fi.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[fi.TOP]+this._padding[fi.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[fi.TOP]+this._padding[fi.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[fi.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[fi.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){eC(this._padding,e)||(this._viewport[0]+=e[fi.LEFT]-this._padding[fi.LEFT],this._viewport[1]+=e[fi.BOTTOM]-this._padding[fi.BOTTOM],this._viewport[2]-=e[fi.RIGHT]+e[fi.LEFT]-(this._padding[fi.RIGHT]+this._padding[fi.LEFT]),this._viewport[3]-=e[fi.TOP]+e[fi.BOTTOM]-(this._padding[fi.TOP]+this._padding[fi.BOTTOM]),gf(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Hs(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,s=V_e(Pe(),-r*(1+2*this._padding[fi.LEFT]/e),r*(1+2*this._padding[fi.RIGHT]/e),-i*(1+2*this._padding[fi.BOTTOM]/t),i*(1+2*this._padding[fi.TOP]/t),this.near,this.far),n=this._get("projectionMatrix");return n&&BJ(n,s)?n:s}get inverseProjectionMatrix(){return Ea(Pe(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||Pe()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return XQe(this._fov,this.width,this.height)}set fovX(e){this._fov=qQe(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return YQe(this._fov,this.width,this.height)}set fovY(e){this._fov=WQe(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Vr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Ea(this._viewInverseTransposeMatrix,this.viewMatrix),Lu(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(e){le(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,gf(this._viewport,e.viewport),this.notifyChange("_viewport"),gf(this._padding,e.padding),this.notifyChange("_padding"),Mo(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Ao(this._viewMatrix,e.viewMatrix),le(this._viewRight,e.viewRight),le(this._viewUp,e.viewUp),le(this._viewForward,e.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(vk(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Ao(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),gf(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return new dX().copyFrom(this)}equals(e){return ql(this.eye,e.eye)&&ql(this.center,e.center)&&ql(this.up,e.up)&&eC(this._viewport,e.viewport)&&eC(this._padding,e.padding)&&KTe(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(Math.abs(e.fov-this._fov)>=.001||s5(e.padding,this._padding)>=.5||s5(this.screenViewport,e.screenViewport)>=.5)return!1;Wo(Ja,e.eye,e.center),Wo(UB,this.eye,this.center);const t=_e(Ja,UB),i=_G(Ja),r=_G(UB),s=5e-4;return t*t>=(1-1e-10)*i*r&&YY(e.eye,this.eye)<Math.max(i,r)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs(U3(this.viewForward,me(Ja,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=$s()){return e[0]=(this.padding[fi.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[fi.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[fi.LEFT]+this.width*t,e[1]=this.padding[fi.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t){e!==pi&&le(pi,e),pi[3]=1,Ph(pi,pi,this.projectionMatrix);const i=Math.abs(pi[3]);ae(pi,pi,1/i);const r=this.fullViewport;t[0]=zt(0,r[0]+r[2],.5+.5*pi[0]),t[1]=zt(0,r[1]+r[3],.5+.5*pi[1]),t[2]=.5*(pi[2]+1),t[3]=i}unapplyProjection(e,t){const i=this.fullViewport;pi[0]=(e[0]/(i[0]+i[2])*2-1)*e[3],pi[1]=(e[1]/(i[1]+i[3])*2-1)*e[3],pi[2]=(2*e[2]-1)*e[3],pi[3]=e[3],this.inverseProjectionMatrix!=null&&(Ph(pi,pi,this.inverseProjectionMatrix),t[0]=pi[0],t[1]=pi[1],t[2]=pi[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,VB),this.renderToScreen(VB,t),t}projectToRenderScreen(e,t){if(pi[0]=e[0],pi[1]=e[1],pi[2]=e[2],pi[3]=1,Ph(pi,pi,this.viewProjectionMatrix),pi[3]===0)return null;ae(pi,pi,1/Math.abs(pi[3]));const i=this.fullViewport;return"x"in t?(t.x=zt(0,i[0]+i[2],.5+.5*pi[0]),t.y=zt(0,i[1]+i[3],.5+.5*pi[1])):(t[0]=zt(0,i[0]+i[2],.5+.5*pi[0]),t[1]=zt(0,i[1]+i[3],.5+.5*pi[1]),t.length>2&&(t[2]=.5*(pi[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,VB),t)}unprojectFromRenderScreen(e,t){if(Hs(aD,this.projectionMatrix,this.viewMatrix),!Ea(aD,aD))return null;const i=this.fullViewport;return pi[0]=2*(e[0]-i[0])/i[2]-1,pi[1]=2*(e[1]-i[1])/i[3]-1,pi[2]=2*e[2]-1,pi[3]=1,Ph(pi,pi,aD),pi[3]===0?null:(t[0]=pi[0]/pi[3],t[1]=pi[1]/pi[3],t[2]=pi[2]/pi[3],t)}constrainWindowSize(e,t,i,r){const s=e*this.pixelRatio,n=t*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0);return[o,a,i-l- -Math.min(this.fullWidth-s-i/2,0),r-c- -Math.min(n-r/2,0)]}computeUp(e){e===je.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){me(Ja,this.center,this.eye);const e=Oe(this.center);e<1?(ue(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(_e(Ja,this.center))>.9999*Oe(Ja)*e||(_t(this._up,Ja,this.center),_t(this._up,this._up,Ja),be(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){z0(Ja,this.eye,this.center),Math.abs(Ja[2])<=.9999&&(ae(Ja,Ja,Ja[2]),ue(this._up,-Ja[0],-Ja[1],1-Ja[2]),be(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,i=""){typeof e[0]=="number"&&isFinite(e[0])&&typeof e[1]=="number"&&isFinite(e[1])&&typeof e[2]=="number"&&isFinite(e[2])?ql(e,t)||(le(t,e),this._markViewDirty(),i.length&&this.notifyChange(i)):se.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(DSe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(cU(this._viewMatrix,this.eye,this.center,this.up),ue(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ue(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ue(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([d()],Ot.prototype,"_center",void 0),u([d()],Ot.prototype,"_up",void 0),u([d()],Ot.prototype,"_viewport",void 0),u([d()],Ot.prototype,"_padding",void 0),u([d()],Ot.prototype,"_fov",void 0),u([d()],Ot.prototype,"_nearFar",void 0),u([d()],Ot.prototype,"_pixelRatio",void 0),u([d()],Ot.prototype,"pixelRatio",null),u([d()],Ot.prototype,"eye",null),u([d()],Ot.prototype,"center",null),u([d()],Ot.prototype,"up",null),u([d({readOnly:!0})],Ot.prototype,"nearFar",null),u([d()],Ot.prototype,"near",null),u([d()],Ot.prototype,"far",null),u([d()],Ot.prototype,"viewport",null),u([d({readOnly:!0})],Ot.prototype,"screenViewport",null),u([d()],Ot.prototype,"x",null),u([d()],Ot.prototype,"y",null),u([d()],Ot.prototype,"width",null),u([d()],Ot.prototype,"height",null),u([d()],Ot.prototype,"fullWidth",null),u([d()],Ot.prototype,"fullHeight",null),u([d({readOnly:!0})],Ot.prototype,"_aspect",null),u([d()],Ot.prototype,"padding",null),u([d({readOnly:!0})],Ot.prototype,"projectionMatrix",null),u([d({readOnly:!0})],Ot.prototype,"inverseProjectionMatrix",null),u([d()],Ot.prototype,"fov",null),u([d()],Ot.prototype,"fovX",null),u([d()],Ot.prototype,"fovY",null),Ot=dX=u([P("esri.views.3d.webgl-engine.lib.Camera")],Ot);const pi=ui(),aD=Pe(),Ja=O(),UB=O(),VB=Ga();var fi;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(fi||(fi={}));var Ee;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Ee||(Ee={}));var Ct;(function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"})(Ct||(Ct={}));class LQ{constructor(t=O()){this.intensity=t}}class VSe{constructor(t=O(),i=Le(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class bk{constructor(t=O(),i=Le(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=t,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}class BSe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function ZQe(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function BB(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function _C(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function zSe(e){return(e+1)*(e+1)}function JQe(e){return ye(Math.floor(Math.sqrt(e)-1),0,2)}function GSe(e,t,i){const r=e[0],s=e[1],n=e[2],o=i||[];return o.length=zSe(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function KQe(e,t){const i=zSe(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function QQe(e,t){const i=JQe(t.r.length);for(const r of e)pl(pX,r.direction),GSe(pX,i,o0),ZQe(o0,y4),BB(o0,r.intensity[0],SS),_C(t.r,SS),BB(o0,r.intensity[1],SS),_C(t.g,SS),BB(o0,r.intensity[2],SS),_C(t.b,SS);return t}function eet(e,t){GSe(pX,0,o0);for(const i of e)t.r[0]+=o0[0]*y4[0]*i.intensity[0]*4*Math.PI,t.g[0]+=o0[0]*y4[0]*i.intensity[1]*4*Math.PI,t.b[0]+=o0[0]*y4[0]*i.intensity[2]*4*Math.PI;return t}function tet(e,t,i,r){KQe(t,r),ue(i.intensity,0,0,0);let s=!1;const n=iet,o=ret,a=set;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof bk&&!s?(le(i.direction,l.direction),le(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof bk||l instanceof VSe?n.push(l):l instanceof LQ?o.push(l):l instanceof BSe&&a.push(l);QQe(n,r),eet(o,r);for(const l of a)_C(r.r,l.r),_C(r.g,l.g),_C(r.b,l.b)}const iet=[],ret=[],set=[],o0=[0],SS=[0],pX=O(),y4=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class Hae{constructor(){this.color=O(),this.intensity=1}}class net{constructor(){this.direction=O(),this.ambient=new Hae,this.diffuse=new Hae}}const jSe=.4;class zB{constructor(){this._shOrder=2,this._legacy=new net,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new BSe,this._mainLight=new bk(O(),Le(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(t){tet(t,this._shOrder,this._mainLight,this._sphericalHarmonics),le(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,ae(this._legacy.diffuse.color,this._mainLight.intensity,i),le(lD,this._legacy.diffuse.color),ae(lD,lD,jSe*this.globalFactor),fe(this._legacy.ambient.color,this._legacy.ambient.color,lD)}copyFrom(t){this._sphericalHarmonics.r=Array.from(t.sh.r),this._sphericalHarmonics.g=Array.from(t.sh.g),this._sphericalHarmonics.b=Array.from(t.sh.b),this._mainLight.direction=js(t.mainLight.direction),this._mainLight.intensity=js(t.mainLight.intensity),this._mainLight.castShadows=t.mainLight.castShadows,this._mainLight.specularStrength=t.mainLight.specularStrength,this._mainLight.environmentStrength=t.mainLight.environmentStrength,this.globalFactor=t.globalFactor,this.noonFactor=t.noonFactor}lerpLighting(t,i,r){if(On(this._mainLight.intensity,t.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=zt(t.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=zt(t.mainLight.specularStrength,i.mainLight.specularStrength,r),le(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=zt(t.globalFactor,i.globalFactor,r),this.noonFactor=zt(t.noonFactor,i.noonFactor,r),t.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=zt(t.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=zt(t.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=zt(t.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}}const lD=O();class c8{constructor(t,i,r){this.shadowMap=t,this.ssaoHelper=i,this.slicePlane=r,this.slot=Ee.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=Ct.NONE,this._camera=new Ot,this._inverseViewport=tt(),this.oldLighting=new zB,this.newLighting=new zB,this._fadedLighting=new zB,this._lighting=this.newLighting,this.ssr=new kQe,this.multipassTerrain=new FQe,this.multipassGeometry=new DQe,this.overlays=[],this.cloudsFade=new iQe}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(t){const{oldLighting:i,newLighting:r}=this;t>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,t),this._lighting=this._fadedLighting)}}let yc=class extends Te{constructor(e){super(e),this._handles=new Ii,this._techniques=new Array,this._techniqueConfiguration=new g4,this._bindParameters=new c8(null,null,null),this._passParameters=new RSe,this._drawParameters=new OSe,this._weatherTile=tt(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=zt(il.default.coverage[0],il.default.coverage[1],.5),this.density=zt(il.default.density[0],il.default.density[1],.5),this.absorption=zt(il.default.absorption[0],il.default.absorption[1],.5),this.cloudSize=zt(il.default.cloudSize[0],il.default.cloudSize[1],.5),this.detailSize=zt(il.default.detailSize[0],il.default.detailSize[1],.5),this.smoothness=zt(il.default.smoothness[0],il.default.smoothness[1],.5),this.cloudHeight=zt(il.default.cloudHeight[0],il.default.cloudHeight[1],.5),this.raymarchingSteps=il.default.raymarchingSteps,this._viewMatrix=Pe(),this._dirty=!1,this.running=!1}_getTechnique(e){const t=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=t===MT.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=t,this._techniqueConfiguration.steps=e,this._techniques[i]=new a8({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){var n;const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;if(e==null||t==null)return;di(this._weatherTile,(e+90)/180,(t+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let r=0,s=0;if(v(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&v(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+((n=this.view.environment.lighting.displayUTCOffset)!=null?n:0)),r=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+r)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),QTe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=Tl(this.context.renderContext.rctx);const e=dr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(xt.CLOUDS_GENERATOR,this),te(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),st)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>ls(e)),this._frameBufferCube=rt(this._frameBufferCube),this._techniques.length=0,this._vao=rt(this._vao),this._passParameters.noiseTexture=Be(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Lc.SIXTEEN:return 1;case Lc.HUNDRED:return 4;case Lc.COUNT:case Lc.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(v(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new YO({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return v(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(C(this._frameBufferCube)){const t={target:St.TEXTURE_CUBE_MAP,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new Yr(this.context.renderContext.rctx,{colorTarget:Ls.CUBEMAP,width:e,height:e},t)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=rt(this._frameBufferCube)}applyPreset(e,t){const i=e.median,r=s=>{const n=zt(s[0],s[1],i);return t<.5?zt(s[0],n,2*t):zt(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(C(this._vao))return this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=un.FINISHED_RENDERING,void e.madeProgress();this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Mo(this._passParameters.weatherTile,this._weatherTile));const t=this._getTechnique(this._passParameters.raymarchingSteps);if(!t.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return Wa.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=un.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,r=i.bindTechnique(t,this._passParameters,this._bindParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao);const s=i.getViewport(),n=t.configuration.cubeMapSize,o=n/this._tilesPerFace,a=this._tileIndex*o;i.setViewport(0,a,n,o);const l=this._ensureFrameBufferCube(n);i.bindFramebuffer(l);const c=oet[this._faceIndex],h=aet[this._faceIndex];z_e(this._viewMatrix,cet,c,h),cp(this._drawParameters.viewMatrix,this._viewMatrix);const p=St.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return l.setColorTextureTarget(p),r.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=un.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Wa.YIELD}};u([d({constructOnly:!0})],yc.prototype,"context",void 0),u([d({constructOnly:!0})],yc.prototype,"view",void 0),u([d({constructOnly:!0})],yc.prototype,"requestRender",void 0),u([d()],yc.prototype,"coverage",void 0),u([d()],yc.prototype,"density",void 0),u([d()],yc.prototype,"absorption",void 0),u([d()],yc.prototype,"cloudSize",void 0),u([d()],yc.prototype,"detailSize",void 0),u([d()],yc.prototype,"smoothness",void 0),u([d()],yc.prototype,"cloudHeight",void 0),u([d()],yc.prototype,"raymarchingSteps",void 0),u([d()],yc.prototype,"running",void 0),yc=u([P("esri.views.3d.environment.CloudsGenerator")],yc);const oet=[ur(1,0,0),ur(-1,0,0),ur(0,1,0),ur(0,-1,0),ur(0,0,1)],aet=[ur(0,1,0),ur(0,1,0),ur(0,0,-1),ur(0,0,1),ur(0,1,0)],cet=xQ();class DQ extends Rr{constructor(){super(...arguments),this.fogColor=O(),this.hazeColor=O(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1,this.fogAmount=0,this.hazeAmount=0}}function uet(e){const t=new Yi;t.attributes.add(R.POSITION,"vec2"),t.include(yg,{textureCoordinateType:En.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new ds("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new ds("inverseViewMatrix",(s,n)=>aM(het,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ie("atmosphereC",s=>s.atmosphereC)),r.uniforms.add(new Jt("cameraPosition",(s,n)=>n.camera.eye)),r.uniforms.add(new tr("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new Lt("depthTex",s=>s.depthTexture)),r.uniforms.add(new Ie("fogStrength",s=>e.haze?s.hazeStrength:s.fogStrength)),r.uniforms.add(new Ie("fogAmount",s=>e.haze?s.hazeAmount:s.fogAmount)),r.uniforms.add(new Jt("fogColor",s=>e.haze?s.hazeColor:s.fogColor)),t.include(r8),r.include(Wh),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(x`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?x`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const het=Pe(),HSe=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:DQ,build:uet},Symbol.toStringTag,{value:"Module"}));class u8 extends ir{initializeProgram(t){return new Ji(t.rctx,u8.shader.get().build(this.configuration),ji)}initializePipeline(){return this.configuration.haze?Ht({blending:Ro(Ce.ONE,Ce.ZERO,Ce.ONE_MINUS_SRC_COLOR,Ce.ONE),colorWrite:si}):Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ZERO,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE),colorWrite:si})}}u8.shader=new Zi(HSe,()=>Q(()=>import("./FogHaze.glsl.7defe1a2.js"),[]));class FQ extends xl{constructor(){super(...arguments),this.haze=!1}}u([j()],FQ.prototype,"haze",void 0);const det=.95,pet=1;let ZO=class extends Te{constructor(e){super(e),this._passParameters=new DQ;const t=e.context.renderContext.rctx;this._vao=Tl(t,vM),this._technique=e.context.techniqueRepository.acquire(u8,new FQ);const i=dr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+sP}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,t){if(this._update(e,t),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const r=e.offscreenRenderingHelper;r.renderDepthDetached(()=>{this._passParameters.depthTexture=r.depthTexture;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,t){const i=t.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Nt.TRIANGLE_STRIP,0,4)}_update(e,t){const i=e.bindParameters.camera;be(qae,i.eye);const r=Math.max(0,_e(qae,e.bindParameters.lighting.mainLight.direction)),s=t.color;ae(Wae,s,.1),On(this._passParameters.fogColor,Wae,s,r);const n=Oe(i.eye),o=n*n;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-UC(det*$d,pet*$d,Math.abs(n-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],ZO.prototype,"context",void 0),u([d({constructOnly:!0})],ZO.prototype,"view",void 0),ZO=u([P("esri.views.3d.environment.Fog")],ZO);class fet{constructor(){this.color=O(),this.strength=0,this.amount=0}}const qae=O(),Wae=O();class qo extends xl{constructor(){super(...arguments),this.hasWebGL2Context=!1}}u([j({constValue:!0})],qo.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],qo.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],qo.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!1})],qo.prototype,"useLegacyTerrainShading",void 0),u([j({constValue:!1})],qo.prototype,"hasModelTransformation",void 0),u([j({constValue:Ar.Pass})],qo.prototype,"pbrTextureBindType",void 0),u([j()],qo.prototype,"hasWebGL2Context",void 0);var Pg;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(Pg||(Pg={}));class NQ extends qo{constructor(){super(...arguments),this.geometry=Pg.Cone}}u([j({count:Pg.COUNT})],NQ.prototype,"geometry",void 0);var z;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.ShadowHighlight=4]="ShadowHighlight",e[e.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",e[e.Highlight=6]="Highlight",e[e.Alpha=7]="Alpha",e[e.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",e[e.COUNT=9]="COUNT"})(z||(z={}));function F$(e){e.attributes.add(R.POSITION,"vec3"),e.vertex.code.add(x`vec3 positionModel() { return position; }`)}function wk({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(x`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(x`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}class Gg extends Zs{constructor(t,i){super(t,"mat3",Ar.Pass,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}function vC(e,t){e.include(F$);const i=e.vertex;i.include(wk,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new Jt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Jt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Gg("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new ds("transformProjFromView",r=>r.transformProjFromView),new aP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Uh("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Uh("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(x`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(x`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?x`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:x`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new Jt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class qSe extends Rr{constructor(){super(...arguments),this.transformWorldFromViewTH=O(),this.transformWorldFromViewTL=O(),this.transformViewFromCameraRelativeRS=Cs(),this.transformProjFromView=Pe()}}class WSe extends Rr{constructor(){super(...arguments),this.transformWorldFromModelRS=Cs(),this.transformWorldFromModelTH=as(),this.transformWorldFromModelTL=as()}}function Q1(e){e.varyings.add("linearDepth","float")}function RT(e){e.vertex.uniforms.add(new tr("nearFar",(t,i)=>i.camera.nearFar))}function h8(e){e.vertex.code.add(x`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function bM(e,t){const{vertex:i}=e;switch(t.output){case z.Color:if(t.receiveShadows)return Q1(e),void i.code.add(x`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case z.Depth:case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:return e.include(vC,t),Q1(e),RT(e),h8(e),void i.code.add(x`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(x`void forwardLinearDepth() {}`)}function Dc(e,t){if(h8(e),t.hasModelTransformation)return e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class kQ extends Rr{constructor(){super(...arguments),this.texV=tt(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new XSe}}class XSe{constructor(){this.center=O(),this.v1=O(),this.v2=O()}}function met(e){const t=new Yi,{vertex:i,fragment:r}=t;if(Y0(i),e.geometry===Pg.Underground)t.attributes.add(R.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add([new Jt("cameraPosition",(s,n)=>n.camera.eye),new Ie("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)]),i.code.add(x`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(x`void main() {
gl_FragColor = color;
}`);else{t.include(Dc,e),t.attributes.add(R.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===Pg.Cylinder;i.uniforms.add([new ds("proj",(a,l)=>l.camera.projectionMatrix),new ds("view",(a,l)=>l.camera.viewMatrix)]),s||(t.varyings.add("innerFactor","float"),i.uniforms.add(new Jt("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new Jt("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new Jt("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new tr("texV",a=>a.texV)),i.uniforms.add(new Ie("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.code.add(x`
		void main(void) {
      ${s?x`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:x`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${x.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${x.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new Lt("tex",a=>a.texture)),s||r.uniforms.add(new Ie("altitudeFade",a=>a.altitudeFade)),r.code.add(x`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?x`gl_FragColor = atmosphereColor;`:x`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const get=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:XSe,SimpleAtmospherePassParameters:kQ,build:met},Symbol.toStringTag,{value:"Module"}));class TA extends ir{initializeProgram(t){return new Ji(t.rctx,TA.shader.get().build(this.configuration),ji)}initializePipeline(){return this.configuration.geometry===Pg.Cylinder?Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),culling:_Q,depthTest:{func:Zr.LEQUAL},colorWrite:si}):Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:Zr.LEQUAL},colorWrite:si})}}TA.shader=new Zi(get,()=>Q(()=>import("./SimpleAtmosphere.glsl.202226a8.js"),[]));const YSe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Uu(e,t=0){const i=e.stride;return e.fieldNames.filter(r=>{const s=e.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,o=yet(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new Ca(r,n,o,a,i,l,t)})}function yet(e){const t=_et[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const _et={u8:dt.UNSIGNED_BYTE,u16:dt.UNSIGNED_SHORT,u32:dt.UNSIGNED_INT,i8:dt.BYTE,i16:dt.SHORT,i32:dt.INT,f32:dt.FLOAT};class UQ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}UQ.ElementCount=9;class VQ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}VQ.ElementCount=16;class K0{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,i){this.typedBuffer[t*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}}K0.ElementCount=1;class Q0{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,di(i,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t]=i[1]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Q0.ElementCount=2;class e_{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,ue(i,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t]=i[2]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t]=s}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}e_.ElementCount=3;class t_{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,mr(i,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t++]=i[2],this.typedBuffer[t]=i[3]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}t_.ElementCount=4;class N$ extends K0{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}static fromTypedArray(t,i){return new N$(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}N$.ElementType="f32";class hp extends Q0{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(hp,t,i)}static fromTypedArray(t,i){return new hp(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}hp.ElementType="f32";class Mr extends e_{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Mr,t,i)}static fromTypedArray(t,i){return new Mr(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Mr.ElementType="f32";class _l extends t_{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(_l,t,i)}static fromTypedArray(t,i){return new _l(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}_l.ElementType="f32";class Bf extends UQ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Bf,t,i)}static fromTypedArray(t,i){return new Bf(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Bf.ElementType="f32";class SA extends UQ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(SA,t,i)}static fromTypedArray(t,i){return new SA(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}SA.ElementType="f64";class EA extends VQ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(EA,t,i)}static fromTypedArray(t,i){return new EA(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}EA.ElementType="f32";class eb extends VQ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(eb,t,i)}static fromTypedArray(t,i){return new eb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}eb.ElementType="f64";class CA extends K0{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(CA,t,i)}static fromTypedArray(t,i){return new CA(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}CA.ElementType="f64";class AA extends Q0{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(AA,t,i)}static fromTypedArray(t,i){return new AA(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}AA.ElementType="f64";class ea extends e_{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(ea,t,i)}static fromTypedArray(t,i){return new ea(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ea.ElementType="f64";class OT extends t_{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(OT,t,i)}static fromTypedArray(t,i){return new OT(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}OT.ElementType="f64";class F0 extends K0{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(F0,t,i)}static fromTypedArray(t,i){return new F0(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}F0.ElementType="u8";class IT extends Q0{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(IT,t,i)}static fromTypedArray(t,i){return new IT(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}IT.ElementType="u8";class tb extends e_{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(tb,t,i)}static fromTypedArray(t,i){return new tb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}tb.ElementType="u8";class ta extends t_{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(ta,t,i)}static fromTypedArray(t,i){return new ta(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ta.ElementType="u8";class PT extends K0{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(PT,t,i)}static fromTypedArray(t,i){return new PT(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}PT.ElementType="u16";class MA extends Q0{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(MA,t,i)}static fromTypedArray(t,i){return new MA(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}MA.ElementType="u16";class $T extends e_{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer($T,t,i)}static fromTypedArray(t,i){return new $T(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}$T.ElementType="u16";class ib extends t_{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(ib,t,i)}static fromTypedArray(t,i){return new ib(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ib.ElementType="u16";class LT extends K0{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(LT,t,i)}static fromTypedArray(t,i){return new LT(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}LT.ElementType="u32";class RA extends Q0{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(RA,t,i)}static fromTypedArray(t,i){return new RA(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}RA.ElementType="u32";class uP extends e_{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(uP,t,i)}static fromTypedArray(t,i){return new uP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}uP.ElementType="u32";class hP extends t_{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(hP,t,i)}static fromTypedArray(t,i){return new hP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}hP.ElementType="u32";class OA extends K0{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(OA,t,i)}static fromTypedArray(t,i){return new OA(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}OA.ElementType="i8";class DT extends Q0{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(DT,t,i)}static fromTypedArray(t,i){return new DT(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}DT.ElementType="i8";class dP extends e_{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(dP,t,i)}static fromTypedArray(t,i){return new dP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}dP.ElementType="i8";class pP extends t_{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(pP,t,i)}static fromTypedArray(t,i){return new pP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}pP.ElementType="i8";class fP extends K0{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(fP,t,i)}static fromTypedArray(t,i){return new fP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}fP.ElementType="i16";class FT extends Q0{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(FT,t,i)}static fromTypedArray(t,i){return new FT(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}FT.ElementType="i16";class mP extends e_{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(mP,t,i)}static fromTypedArray(t,i){return new mP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}mP.ElementType="i16";class gP extends t_{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(gP,t,i)}static fromTypedArray(t,i){return new gP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}gP.ElementType="i16";class yP extends K0{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(yP,t,i)}static fromTypedArray(t,i){return new yP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}yP.ElementType="i32";class _P extends Q0{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(_P,t,i)}static fromTypedArray(t,i){return new _P(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}_P.ElementType="i32";class vP extends e_{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(vP,t,i)}static fromTypedArray(t,i){return new vP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}vP.ElementType="i32";class bP extends t_{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(bP,t,i)}static fromTypedArray(t,i){return new bP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}bP.ElementType="i32";function ZSe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function vet(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function bet(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function wet(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}class xk{constructor(t,i){this.layout=t,this.buffer=typeof i=="number"?new ArrayBuffer(i*t.stride):i;for(const r of t.fieldNames){const s=t.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,i){const r=this[t];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(t,i){return new xk(this.layout,this.buffer.slice(t*this.stride,i*this.stride))}copyFrom(t,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}}class BQ{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,i){return this._appendField(t,hp,i),this}vec2f64(t,i){return this._appendField(t,AA,i),this}vec3f(t,i){return this._appendField(t,Mr,i),this}vec3f64(t,i){return this._appendField(t,ea,i),this}vec4f(t,i){return this._appendField(t,_l,i),this}vec4f64(t,i){return this._appendField(t,OT,i),this}mat3f(t,i){return this._appendField(t,Bf,i),this}mat3f64(t,i){return this._appendField(t,SA,i),this}mat4f(t,i){return this._appendField(t,EA,i),this}mat4f64(t,i){return this._appendField(t,eb,i),this}vec4u8(t,i){return this._appendField(t,ta,i),this}f32(t,i){return this._appendField(t,N$,i),this}f64(t,i){return this._appendField(t,CA,i),this}u8(t,i){return this._appendField(t,F0,i),this}u16(t,i){return this._appendField(t,PT,i),this}i8(t,i){return this._appendField(t,OA,i),this}vec2i8(t,i){return this._appendField(t,DT,i),this}vec2i16(t,i){return this._appendField(t,FT,i),this}vec2u8(t,i){return this._appendField(t,IT,i),this}vec4u16(t,i){return this._appendField(t,ib,i),this}u32(t,i){return this._appendField(t,LT,i),this}_appendField(t,i,r){const s=i.ElementCount*ZSe(i.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new xk(this,t)}createView(t){return new xk(this,t)}clone(){const t=new BQ;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((i,r)=>t.fields.set(r,i)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function As(){return new BQ}class Ke{constructor(t,i,r=!1,s=i){this.data=t,this.size=i,this.exclusive=r,this.stride=s}}var fX;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=i,e.scale=r,e.add=s,e.subtract=n})(fX||(fX={}));var hn;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"})(hn||(hn={}));function Du(e,t=!1){return e<=Tg?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function xet(e){return length<=Tg?Array.from(e):new Float64Array(e)}function Jd(e,t,i){return Array.isArray(e)?e.slice(t,t+i):e.subarray(t,t+i)}function Cn(e,t=!1){return e<=Tg?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function Xae(e){return length<=Tg?Array.from(e):new Float32Array(e)}function Yae(e,t,i){return Array.isArray(e)?e.slice(t,t+i):e.subarray(t,t+i)}function Tet(e){if(e.length<Tg)return Array.from(e);if(Array.isArray(e))return Float64Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return Uint16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}const Ml=ui();class Eet{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function vt(e,t){if(!e){t=t||"Assertion";const i=new Error(t).stack;throw new Eet(`${t} at ${i}`)}}function ES(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function Zae(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],h=(r[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function cD(e,t,i,r,s,n=tt()){const o=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),a=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function Jae(e,t,i,r,s){Ml[0]=e[0],Ml[1]=e[1],Ml[2]=e[2],Ml[3]=1,Ph(Ml,Ml,t),s.length>2&&(s[2]=-Ml[2]),Ph(Ml,Ml,i),vt(Ml[3]!==0),s[0]=Ml[0]/Ml[3],s[1]=Ml[1]/Ml[3],s[2]=Ml[2]/Ml[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function Cet(e,t){return Math.log(e)/Math.log(t)}function Aet(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function JSe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}class d8{constructor(t,i,r,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this._children=void 0,vt(t.length>=1),vt(r.length%this._numIndexPerPrimitive==0),vt(r.length>=t.length*this._numIndexPerPrimitive),vt(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*r[this._numIndexPerPrimitive*t[0]];Pb.clear(),Pb.push(l);const c=Le(n[l],n[l+1],n[l+2]),h=js(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*t[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*r[y+_],Pb.push(l);let b=n[l];c[0]=Math.min(b,c[0]),h[0]=Math.max(b,h[0]),b=n[l+1],c[1]=Math.min(b,c[1]),h[1]=Math.max(b,h[1]),b=n[l+2],c[2]=Math.min(b,c[2]),h[2]=Math.max(b,h[2])}}this.bbMin=c,this.bbMax=h;const p=On(O(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<Pb.length;++m){l=Pb.getItemAt(m);const y=n[l]-p[0],_=n[l+1]-p[1],b=n[l+2]-p[2],w=y*y+_*_+b*b;if(w<=f)continue;const T=Math.sqrt(w),S=.5*(T-this.radius);this.radius=this.radius+S,f=this.radius*this.radius;const E=S/T;p[0]+=y*E,p[1]+=_*E,p[2]+=b*E}this.center=p,Pb.clear()}getChildren(){if(this._children||Ta(this.bbMin,this.bbMax)<=1)return this._children;const t=On(O(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],_=n[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*this.indices[p+b];const w=n[f],T=n[f+1],S=n[f+2];w<m&&(m=w),T<y&&(y=T),S<_&&(_=S)}m<t[0]&&(h|=1),y<t[1]&&(h|=2),_<t[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new d8(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Pb.prune()}}const Pb=new ri({deallocator:null});class k${constructor(){this.id=Ru()}unload(){}}function Met(e){return e?{p0:js(e.p0),p1:js(e.p1),p2:js(e.p2)}:{p0:O(),p1:O(),p2:O()}}function Kae(e,t,i){const r=t[0]-e[0],s=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return .5*Math.abs(r*o-s*n)}function Ret(e,t,i){return me(GB,t,e),me(Qae,i,e),Oe(_t(GB,GB,Qae))/2}new W0(Hf);new W0(()=>Met());const GB=O(),Qae=O();function Oet(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;ue(i,0,0,0),ue(Od,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*r,c=t[a+1]*r,h=t[a+2]*r;ue(jo,s[l+0],s[l+1],s[l+2]),ue(a0,s[c+0],s[c+1],s[c+2]),ue(uD,s[h+0],s[h+1],s[h+2]);const p=Ret(jo,a0,uD);p?(fe(jo,jo,a0),fe(jo,jo,uD),ae(jo,jo,1/3*p),fe(i,i,jo),n+=p):(fe(Od,Od,jo),fe(Od,Od,a0),fe(Od,Od,uD),o+=3)}return(o!==0||n!==0)&&(n!==0?(ae(i,i,1/n),!0):o!==0&&(ae(i,Od,1/o),!0))}function Iet(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;ue(i,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&ae(i,i,1/o),o>0}function Pet(e,t,i,r){if(!e)return!1;ue(r,0,0,0),ue(Od,0,0,0);let s=0,n=0;const{size:o,data:a}=e,l=t?t.length-1:a.length/o-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(t?t[p]:p)*o,y=(t?t[f]:f)*o;jo[0]=a[m],jo[1]=a[m+1],jo[2]=a[m+2],a0[0]=a[y],a0[1]=a[y+1],a0[2]=a[y+2],ae(jo,fe(jo,jo,a0),.5);const _=t$(jo,a0);_>0?(fe(r,r,ae(jo,jo,_)),s+=_):s===0&&(fe(Od,Od,jo),n++)}return s!==0?(ae(r,r,1/s),!0):n!==0&&(ae(r,Od,1/n),!0)}const jo=O(),a0=O(),uD=O(),Od=O();function bC(e){if(Array.isArray(e)){if(e.length<Tg)return e;for(const t of e)if(t>=65536)return new Uint32Array(e);return new Uint16Array(e)}if(e.length<Tg)return Array.from(e);if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}function KSe(e){const t=3*e;return t<=Tg?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}let zv=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const QSe=[0],wC=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function IA(e){if(e===1)return QSe;if(e<Tg)return Array.from(new Uint16Array(wC.buffer,0,e));if(e<wC.length)return new Uint16Array(wC.buffer,0,e);if(e>zv.length){const t=Math.max(2*zv.length,e);zv=new Uint32Array(t);for(let i=0;i<zv.length;i++)zv[i]=i}return new Uint32Array(zv.buffer,0,e)}function WOt(e){if(e===1)return QSe;if(e<Tg)return Array.from(new Uint16Array(wC.buffer,0,e));if(e<wC.length)return new Uint16Array(wC.slice(0,e));if(e>zv.length){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}return new Uint32Array(zv.slice(0,e))}class Tk{constructor(t){this.channel=t,this.id=Ru()}}function mX(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function $et(e,t){const i=e.length;for(let r=0;r<i;++r)zE[0]=e[r],t[r]=zE[0];return t}function Let(e,t){const i=e.length;for(let r=0;r<i;++r)zE[0]=e[r],zE[1]=e[r]-zE[0],t[r]=zE[1];return t}const zE=new Float32Array(2);function gX(e,t){return C(e)&&(e=[]),e.push(t),e}function yX(e,t){if(C(e))return null;const i=e.filter(r=>r!==t);return i.length===0?null:i}function Det(e,t,i,r,s){hD[0]=e.get(t,0),hD[1]=e.get(t,1),hD[2]=e.get(t,2),mX(hD,$b,3),i.set(s,0,$b[0]),r.set(s,0,$b[1]),i.set(s,1,$b[2]),r.set(s,1,$b[3]),i.set(s,2,$b[4]),r.set(s,2,$b[5])}const hD=O(),$b=new Float32Array(6);class Rn extends k${constructor(t,i,r=[],s=null,n=hn.Mesh,o=null,a=-1){super(),this.material=t,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of i)c&&this._vertexAttributes.set(l,{...c});if(r==null||r.length===0){const l=Fet(this._vertexAttributes),c=IA(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of r)c&&(this._indices.set(l,bC(c)),l===R.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(t={}){const i=new Rn(t.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((r,s)=>{r.exclusive=!1,i._vertexAttributes.set(s,r)}),this._indices.forEach((r,s)=>i._indices.set(s,r)),i._boundingInfo=this._boundingInfo,i.transformation=t.transformation||this.transformation,i}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){let i=this._vertexAttributes.get(t);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:Tet(i.data)},this._vertexAttributes.set(t,i)),i}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return C(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===hn.Mesh?this._computeAttachmentOriginTriangles(t):this.type===hn.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(v(this._transformation)&&Ze(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){const i=this.indices.get(R.POSITION),r=this.vertexAttributes.get(R.POSITION);return Oet(r,i,t)}_computeAttachmentOriginLines(t){const i=this.vertexAttributes.get(R.POSITION),r=this.indices.get(R.POSITION);return Pet(i,r,r&&Net(this.material.parameters,i,r),t)}_computeAttachmentOriginPoints(t){const i=this.indices.get(R.POSITION),r=this.vertexAttributes.get(R.POSITION);return Iet(r,i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(R.POSITION),i=this.vertexAttributes.get(R.POSITION);if(!t||t.length===0||!i)return null;const r=this.type===hn.Mesh?3:1;vt(t.length%r==0,"Indexing error: "+t.length+" not divisible by "+r);const s=IA(t.length/r);return new d8(s,r,t,i)}get transformation(){return Ft(this._transformation,Hh)}set transformation(t){this._transformation=t&&t!==Hh?uA(t):null}get shaderTransformation(){return v(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(t){this._shaderTransformer=t}get hasVolatileTransformation(){return v(this._shaderTransformer)}addHighlight(){const t=new Tk(D0.Highlight);return this.highlights=gX(this.highlights,t),t}removeHighlight(t){this.highlights=yX(this.highlights,t)}}function Fet(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function Net(e,t,i){return!(!("isClosed"in e)||!e.isClosed)&&(i?i.length>2:t.data.length>6)}const CS=fX,jB=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],ket=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],Uet=[0,0,1,0,1,1,0,1],Vet=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],e2e=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)e2e[6*e+t]=e;const Jw=new Array(36);for(let e=0;e<6;e++)Jw[6*e+0]=0,Jw[6*e+1]=1,Jw[6*e+2]=2,Jw[6*e+3]=2,Jw[6*e+4]=3,Jw[6*e+5]=0;function Bet(e,t){Array.isArray(t)||(t=[t,t,t]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=jB[r][0]*t[0],i[3*r+1]=jB[r][1]*t[1],i[3*r+2]=jB[r][2]*t[2];return new Rn(e,[[R.POSITION,new Ke(i,3,!0)],[R.NORMAL,new Ke(ket,3)],[R.UV0,new Ke(Uet,2)]],[[R.POSITION,Vet],[R.NORMAL,e2e],[R.UV0,Jw]])}const HB=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],zet=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Get=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],jet=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function Het(e,t){Array.isArray(t)||(t=[t,t,t]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=HB[r][0]*t[0],i[3*r+1]=HB[r][1]*t[1],i[3*r+2]=HB[r][2]*t[2];return new Rn(e,[[R.POSITION,new Ke(i,3,!0)],[R.NORMAL,new Ke(zet,3)]],[[R.POSITION,Get],[R.NORMAL,jet]])}const _4=ur(-.5,0,-.5),v4=ur(.5,0,-.5),b4=ur(0,0,.5),w4=ur(0,.5,0),AS=as(),MS=as(),xC=as(),TC=as(),SC=as();me(AS,_4,w4),me(MS,_4,v4),_t(xC,AS,MS),be(xC,xC),me(AS,v4,w4),me(MS,v4,b4),_t(TC,AS,MS),be(TC,TC),me(AS,b4,w4),me(MS,b4,_4),_t(SC,AS,MS),be(SC,SC);const qB=[_4,v4,b4,w4],qet=[0,-1,0,xC[0],xC[1],xC[2],TC[0],TC[1],TC[2],SC[0],SC[1],SC[2]],Wet=[0,1,2,3,1,0,3,2,1,3,0,2],Xet=[0,0,0,1,1,1,2,2,2,3,3,3];function Yet(e,t){Array.isArray(t)||(t=[t,t,t]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=qB[r][0]*t[0],i[3*r+1]=qB[r][1]*t[1],i[3*r+2]=qB[r][2]*t[2];return new Rn(e,[[R.POSITION,new Ke(i,3,!0)],[R.NORMAL,new Ke(qet,3)]],[[R.POSITION,Wet],[R.NORMAL,Xet]])}function XOt(e,t,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),h=Math.max(2,Math.floor(r)),p=(c+1)*(h+1),f=Cn(3*p),m=Cn(3*p),y=Cn(2*p),_=[];let b=0;for(let E=0;E<=h;E++){const M=[],A=E/h,$=a+A*l,I=Math.cos($);for(let k=0;k<=c;k++){const V=k/c,B=n+V*o,G=Math.cos(B)*I,X=Math.sin($),K=-Math.sin(B)*I;f[3*b]=G*t,f[3*b+1]=X*t,f[3*b+2]=K*t,m[3*b]=G,m[3*b+1]=X,m[3*b+2]=K,y[2*b]=V,y[2*b+1]=A,M.push(b),++b}_.push(M)}const w=new Array;for(let E=0;E<h;E++)for(let M=0;M<c;M++){const A=_[E][M],$=_[E][M+1],I=_[E+1][M+1],k=_[E+1][M];E===0?(w.push(A),w.push(I),w.push(k)):E===h-1?(w.push(A),w.push($),w.push(I)):(w.push(A),w.push($),w.push(I),w.push(I),w.push(k),w.push(A))}const T=[[R.POSITION,w],[R.NORMAL,w]],S=[[R.POSITION,new Ke(f,3,!0)],[R.NORMAL,new Ke(m,3,!0)]];return s.uv&&(S.push([R.UV0,new Ke(y,2,!0)]),T.push([R.UV0,w])),s.offset&&(T[0][0]=R.OFFSET,S[0][0]=R.OFFSET,T.push([R.POSITION,new Array(w.length).fill(0)]),S.push([R.POSITION,new Ke(Float64Array.from(s.offset),3,!0)])),new Rn(e,S,T)}function Zet(e,t,i,r){const{vertexAttributes:s,indices:n}=t2e(t,i,r);return new Rn(e,s,n)}function t2e(e,t,i){const r=e;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=r*(1+Math.sqrt(5))/2;s=[-r,h,0,r,h,0,-r,-h,0,r,-h,0,0,-r,h,0,r,h,0,-r,-h,0,r,-h,h,0,-r,h,0,r,-h,0,-r,-h,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)CS.scale(s,h,e/CS.length(s,h));let o={};function a(h,p){h>p&&([h,p]=[p,h]);const f=h.toString()+"."+p.toString();if(o[f])return o[f];let m=s.length;return s.length+=3,CS.add(s,3*h,s,3*p,s,m),CS.scale(s,m,e/CS.length(s,m)),m/=3,o[f]=m,m}for(let h=0;h<t;h++){const p=n.length,f=new Array(4*p);for(let m=0;m<p;m+=3){const y=n[m],_=n[m+1],b=n[m+2],w=a(y,_),T=a(_,b),S=a(b,y),E=4*m;f[E]=y,f[E+1]=w,f[E+2]=S,f[E+3]=_,f[E+4]=T,f[E+5]=w,f[E+6]=b,f[E+7]=S,f[E+8]=T,f[E+9]=w,f[E+10]=T,f[E+11]=S}n=f,o={}}const l=Xae(s);for(let h=0;h<l.length;h+=3)CS.normalize(l,h);const c=[[R.POSITION,n],[R.NORMAL,n]];return{vertexAttributes:[[R.POSITION,new Ke(Xae(s),3,!0)],[R.NORMAL,new Ke(l,3,!0)]],indices:c}}function _X(e,t,i,r,s,n,o,a,l=null){const c=i?[i[0],i[1],i[2]]:[0,0,0],h=t?[t[0],t[1],t[2]]:[0,0,1];o=o||[0,0];const p=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],f=v(s)&&s.length===2?s:[1,1],m=[[R.POSITION,new Ke(c,3,!0)],[R.NORMAL,new Ke(h,3,!0)],[R.UV0,new Ke(o,o.length)],[R.COLOR,new Ke(p,4,!0)],[R.SIZE,new Ke(f,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];m.push([R.AUXPOS1,new Ke(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];m.push([R.AUXPOS2,new Ke(y,4)])}return new Rn(e,m,null,null,hn.Point,l)}const Jet=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function YOt(e,t=Jet){const i=new Array(12);for(let h=0;h<4;h++)for(let p=0;p<3;p++)i[3*h+p]=t[h][p];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[R.POSITION,r],[R.NORMAL,n],[R.UV0,r],[R.COLOR,n]],c=[[R.POSITION,new Ke(i,3,!0)],[R.NORMAL,new Ke(s,3,!0)],[R.UV0,new Ke(o,2,!0)],[R.COLOR,new Ke(a,4,!0)]];return new Rn(e,c,l)}function ele(e,t,i,r,s,n=!0,o=!0){let a=0;const l=i,c=t;let h=ur(0,a,0),p=ur(0,a+c,0),f=ur(0,-1,0),m=ur(0,1,0);s&&(a=c,p=ur(0,0,0),h=ur(0,a,0),f=ur(0,1,0),m=ur(0,-1,0));const y=[p,h],_=[f,m],b=r+2,w=Math.sqrt(c*c+l*l);if(s)for(let I=r-1;I>=0;I--){const k=I*(2*Math.PI/r),V=ur(Math.cos(k)*l,a,Math.sin(k)*l);y.push(V);const B=ur(c*Math.cos(k)/w,-l/w,c*Math.sin(k)/w);_.push(B)}else for(let I=0;I<r;I++){const k=I*(2*Math.PI/r),V=ur(Math.cos(k)*l,a,Math.sin(k)*l);y.push(V);const B=ur(c*Math.cos(k)/w,l/w,c*Math.sin(k)/w);_.push(B)}const T=new Array,S=new Array;if(n){for(let I=3;I<y.length;I++)T.push(1),T.push(I-1),T.push(I),S.push(0),S.push(0),S.push(0);T.push(y.length-1),T.push(2),T.push(1),S.push(0),S.push(0),S.push(0)}if(o){for(let I=3;I<y.length;I++)T.push(I),T.push(I-1),T.push(0),S.push(I),S.push(I-1),S.push(1);T.push(0),T.push(2),T.push(y.length-1),S.push(1),S.push(2),S.push(_.length-1)}const E=Cn(3*b);for(let I=0;I<b;I++)E[3*I]=y[I][0],E[3*I+1]=y[I][1],E[3*I+2]=y[I][2];const M=Cn(3*b);for(let I=0;I<b;I++)M[3*I]=_[I][0],M[3*I+1]=_[I][1],M[3*I+2]=_[I][2];const A=[[R.POSITION,T],[R.NORMAL,S]],$=[[R.POSITION,new Ke(E,3,!0)],[R.NORMAL,new Ke(M,3,!0)]];return new Rn(e,$,A)}function Ket(e,t,i,r,s,n,o){const a=s?yk(s):ur(1,0,0),l=n?yk(n):ur(0,0,0);o=o!=null?o:!0;const c=as();be(c,a);const h=as();ae(h,c,Math.abs(t));const p=as();ae(p,h,-.5),fe(p,p,l);const f=ur(0,1,0);Math.abs(1-_e(c,f))<.2&&ue(f,0,0,1);const m=as();_t(m,c,f),be(m,m),_t(f,m,c);const y=2*r+(o?2:0),_=r+(o?2:0),b=Cn(3*y),w=Cn(3*_),T=Cn(2*y),S=new Array(3*r*(o?4:2)),E=new Array(3*r*(o?4:2));o&&(b[3*(y-2)+0]=p[0],b[3*(y-2)+1]=p[1],b[3*(y-2)+2]=p[2],T[2*(y-2)]=0,T[2*(y-2)+1]=0,b[3*(y-1)+0]=b[3*(y-2)+0]+h[0],b[3*(y-1)+1]=b[3*(y-2)+1]+h[1],b[3*(y-1)+2]=b[3*(y-2)+2]+h[2],T[2*(y-1)]=1,T[2*(y-1)+1]=1,w[3*(_-2)+0]=-c[0],w[3*(_-2)+1]=-c[1],w[3*(_-2)+2]=-c[2],w[3*(_-1)+0]=c[0],w[3*(_-1)+1]=c[1],w[3*(_-1)+2]=c[2]);const M=(B,G,X)=>{S[B]=G,E[B]=X};let A=0;const $=as(),I=as();for(let B=0;B<r;B++){const G=B*(2*Math.PI/r);ae($,f,Math.sin(G)),ae(I,m,Math.cos(G)),fe($,$,I),w[3*B+0]=$[0],w[3*B+1]=$[1],w[3*B+2]=$[2],ae($,$,i),fe($,$,p),b[3*B+0]=$[0],b[3*B+1]=$[1],b[3*B+2]=$[2],T[2*B+0]=B/r,T[2*B+1]=0,b[3*(B+r)+0]=b[3*B+0]+h[0],b[3*(B+r)+1]=b[3*B+1]+h[1],b[3*(B+r)+2]=b[3*B+2]+h[2],T[2*(B+r)+0]=B/r,T[2*B+1]=1;const X=(B+1)%r;M(A++,B,B),M(A++,B+r,B),M(A++,X,X),M(A++,X,X),M(A++,B+r,B),M(A++,X+r,X)}if(o){for(let B=0;B<r;B++){const G=(B+1)%r;M(A++,y-2,_-2),M(A++,B,_-2),M(A++,G,_-2)}for(let B=0;B<r;B++){const G=(B+1)%r;M(A++,B+r,_-1),M(A++,y-1,_-1),M(A++,G+r,_-1)}}const k=[[R.POSITION,S],[R.NORMAL,E],[R.UV0,S]],V=[[R.POSITION,new Ke(b,3,!0)],[R.NORMAL,new Ke(w,3,!0)],[R.UV0,new Ke(T,2,!0)]];return new Rn(e,V,k)}function ZOt(e,t,i,r,s,n,o=ur(0,0,0)){const a=t.length,l=Cn(i.length*a*3+(6*r.length||0)),c=Cn(i.length*a*3+(r?6:0)),h=new Array,p=new Array;let f=0,m=0;const y=as(),_=as(),b=as(),w=as(),T=as(),S=as(),E=as(),M=O(),A=as(),$=as(),I=as(),k=as(),V=as(),B=nr();ue(A,0,1,0),me(_,i[1],i[0]),be(_,_),n?(fe(M,i[0],o),be(b,M)):ue(b,0,0,1),Sk(_,b,A,A,T,b,tle),le(w,b),le(k,T);for(let U=0;U<r.length;U++)ae(S,T,r[U][0]),ae(M,b,r[U][2]),fe(S,S,M),fe(S,S,i[0]),l[f++]=S[0],l[f++]=S[1],l[f++]=S[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let U=0;U<s.length;U++)h.push(s[U][0]>0?s[U][0]:-s[U][0]-1+r.length),h.push(s[U][1]>0?s[U][1]:-s[U][1]-1+r.length),h.push(s[U][2]>0?s[U][2]:-s[U][2]-1+r.length),p.push(0),p.push(0),p.push(0);let G=r.length;const X=r.length-1;for(let U=0;U<i.length;U++){let W=!1;U>0&&(le(y,_),U<i.length-1?(me(_,i[U+1],i[U]),be(_,_)):W=!0,fe($,y,_),be($,$),fe(I,i[U-1],w),A$(i[U],$,B),nS(B,qh(I,y),M)?(me(M,M,i[U]),be(b,M),_t(T,$,b),be(T,T)):Sk($,w,k,A,T,b,tle),le(w,b),le(k,T)),n&&(fe(M,i[U],o),be(V,M));for(let Z=0;Z<a;Z++)if(ae(S,T,t[Z][0]),ae(M,b,t[Z][1]),fe(S,S,M),be(E,S),c[m++]=E[0],c[m++]=E[1],c[m++]=E[2],fe(S,S,i[U]),l[f++]=S[0],l[f++]=S[1],l[f++]=S[2],!W){const ie=(Z+1)%a;h.push(G+Z),h.push(G+a+Z),h.push(G+ie),h.push(G+ie),h.push(G+a+Z),h.push(G+a+ie);for(let Y=0;Y<6;Y++){const ce=h.length-6;p.push(h[ce+Y]-X)}}G+=a}const K=i[i.length-1];for(let U=0;U<r.length;U++)ae(S,T,r[U][0]),ae(M,b,r[U][1]),fe(S,S,M),fe(S,S,K),l[f++]=S[0],l[f++]=S[1],l[f++]=S[2];const re=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const q=G-a;for(let U=0;U<s.length;U++)h.push(s[U][0]>=0?G+s[U][0]:-s[U][0]-1+q),h.push(s[U][2]>=0?G+s[U][2]:-s[U][2]-1+q),h.push(s[U][1]>=0?G+s[U][1]:-s[U][1]-1+q),p.push(re),p.push(re),p.push(re);const L=[[R.POSITION,h],[R.NORMAL,p]],N=[[R.POSITION,new Ke(l,3,!0)],[R.NORMAL,new Ke(c,3,!0)]];return new Rn(e,N,L)}function JOt(e,t,i,r){vt(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),vt(t[0].length===3,"createPolylineGeometry(): malformed vertex"),vt(i==null||i.length===t.length,"createPolylineGeometry: need same number of points and normals"),vt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=Du(3*t.length),n=new Array(2*(t.length-1));let o=0,a=0;for(let h=0;h<t.length;h++){for(let p=0;p<3;p++)s[o++]=t[h][p];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([R.POSITION,n]),c.push([R.POSITION,new Ke(s,3,!0)]),i){const h=Cn(3*i.length);let p=0;for(let f=0;f<t.length;f++)for(let m=0;m<3;m++)h[p++]=i[f][m];l.push([R.NORMAL,n]),c.push([R.NORMAL,new Ke(h,3,!0)])}return r&&(c.push([R.COLOR,new Ke(r,4)]),l.push([R.COLOR,IA(r.length/4)])),new Rn(e,c,l,null,hn.Line)}function Qet(e,t=e){const i=e.vertexAttributes,r=i.get(R.POSITION).data,s=i.get(R.NORMAL).data;if(s){const n=t.getMutableAttribute(R.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=t.getMutableAttribute(R.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function WB(e,t,i,r,s){return!(Math.abs(_e(t,e))>s)&&(_t(i,e,t),be(i,i),_t(r,i,e),be(r,r),!0)}function Sk(e,t,i,r,s,n,o){return WB(e,t,s,n,o)||WB(e,i,s,n,o)||WB(e,r,s,n,o)}const tle=.99619469809;class ett{constructor(t,i){this.type=yo.Panoramic,this._configuration=new NQ,this._passParameters=new kQ,this._configuration.geometry=Pg.Cylinder,this._technique=i.techniqueRepository.acquire(TA,this._configuration);const r=i.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=ja(this._vao,"geometry"),this._passParameters.texture=new pt(r,{pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!0,width:1,height:512},YSe)}destroy(){this._passParameters.texture=rt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(t){const i=t.rctx,r=i.bindTechnique(this._technique,this._passParameters,t.bindParameters);ttt(ile,t.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",ile),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Nt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const i=t2e(1,2,!1),r=i.indices[0][1],s=i.vertexAttributes[0][1];for(let l=0;l<r.length;l+=3){const c=r[l];r[l]=r[l+2],r[l+2]=c}const n=s.data,o=rle.createBuffer(r.length),a=o.position;for(let l=0;l<r.length;++l){const c=3*r[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new Wf(t,ji,{geometry:Uu(rle)},{geometry:Oi.createVertex(t,Xi.STATIC_DRAW,o.buffer)})}}function ttt(e,t){Ao(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const ile=Pe(),rle=As().vec3f(R.POSITION);var N0;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(N0||(N0={}));class vX extends xl{constructor(){super(...arguments),this.type=N0.Rain}}u([j({count:N0.COUNT})],vX.prototype,"type",void 0);function itt(e){const t=new Yi;return t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new Jt("cameraPosition",(i,r)=>r.camera.eye)),t.vertex.uniforms.add(new Jt("offset",(i,r)=>rtt(i,r))),t.vertex.uniforms.add(new Ie("width",i=>i.width)),t.vertex.uniforms.add(new ds("proj",(i,r)=>r.camera.projectionMatrix)),t.vertex.uniforms.add(new ds("view",(i,r)=>r.camera.viewMatrix)),t.vertex.uniforms.add(new Ie("time",i=>i.time)),t.varyings.add("vUv","vec2"),t.vertex.code.add(x`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===N0.Rain?x`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:x`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add([new Ie("opacity",i=>i.opacity),new Jt("particleColor",(i,r)=>stt(r,e))]),t.fragment.code.add(x`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===N0.Rain?x`d = 0.35 * smoothstep(0.5, 0.0, d);`:x`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}function rtt(e,t){const i=t.camera.eye,r=.5*e.width,s=1/e.width,n=Kfe(bX,ue(bX,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return Wo(n,i,ae(n,n,e.width))}function stt(e,t){const i=t.type===N0.Rain?ott:ntt,r=ae(bX,i,att),s=e.camera.eye;be(sle,s);const n=Math.max(0,_e(sle,e.lighting.mainLight.direction));return On(r,r,i,n)}const bX=O(),sle=O(),ntt=Le(1,1,1),ott=Le(.85,.85,.85),att=.7,ltt=Object.freeze(Object.defineProperty({__proto__:null,build:itt},Symbol.toStringTag,{value:"Module"}));class ctt extends Rr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}}class wP extends ir{initializeProgram(t){return new Ji(t.rctx,wP.shader.get().build(this.configuration),x4)}initializePipeline(){return Ht({blending:Ro(Ce.ONE,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:Zr.LEQUAL},colorWrite:si})}}wP.shader=new Zi(ltt,()=>Q(()=>import("./Precipitation.glsl.e22ee2a1.js"),[]));const x4=new Map([[R.POSITION,0],[R.INSTANCEFEATUREATTRIBUTE,1]]);class i2e{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:t,fixedTime:i}){return v(i)?this._time!==i&&(this._time=i,!0):(this._time=this._time+t,t!==0)}}class utt{constructor(t,i){this.deltaTime=t,this.fixedTime=i}}let Kw=class extends Te{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new ctt,this._animation=new i2e,this._updatingTracking=new fg,this._passParameters.time=0,this._passParameters.radius=dr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=ls(this._snowTechniqueCached),this._rainTechniqueCached=ls(this._rainTechniqueCached),this._vao=rt(this._vao),this._instanceIdBuffer=rt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(C(this._rainTechniqueCached)){const e=new vX;e.type=N0.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(wP,e)}return this._rainTechniqueCached}get _snowTechnique(){if(C(this._snowTechniqueCached)){const e=new vX;e.type=N0.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(wP,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,t,i){var a;const r=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),C(r)||C(this._vao)||C(this._instanceIdBuffer)||(v(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const n=.35;t=t<.5?zt(0,n,2*t):zt(n,1,2*(t-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*_Z(this._animation.time)%1e5;const o=s.bindTechnique(r,this._passParameters,e.bindParameters);s.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),bQ(s,x4,this._instanceIdBuffer,nle,0),(a=s.capabilities.instancing)==null||a.drawArraysInstanced(Nt.TRIANGLES,0,3,this._numParticles*t),wQ(s,x4,this._instanceIdBuffer,nle)}_ensureResources(e){C(this._vao)&&(this._vao=this._createVertexArrayObject(e)),C(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let i=0;i<this._numParticles;i++)t.push(i);return Oi.createVertex(e,Xi.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Wf(e,x4,{geometry:Uu(htt)},{geometry:Oi.createVertex(e,Xi.STATIC_DRAW,t)})}};u([d({constructOnly:!0})],Kw.prototype,"context",void 0),u([d({constructOnly:!0})],Kw.prototype,"view",void 0),u([d({readOnly:!0})],Kw.prototype,"updating",null),u([d()],Kw.prototype,"_updatingTracking",void 0),Kw=u([P("esri.views.3d.environment.Precipitation")],Kw);const htt=As().vec3f(R.POSITION),nle=Uu(As().f32(R.INSTANCEFEATUREATTRIBUTE),1),dtt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),dD=128,ole=-aX,ale=0,XB=50,ptt=()=>1-511/512,ftt=t4([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class mtt{constructor(t,i){this.view=t,this.type=yo.Simple,this._passParameters=new kQ,this._vaoCount=0,this._texV1=1,this._isMars=Fg(t.spatialReference);const r=dr(t.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+ole)/this._planetRadius,this._middleRimFactor=(this._planetRadius+ale)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=ale/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=i.techniqueRepository;const s=i.renderContext.rctx;this._cameraChangeHandle=te(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>i.requestRender(),Gs),this._vao=this._createRibbon(s),this._vaoCount=ja(this._vao,"geometry"),this._fadeVao=Tl(s),this._fadeVaoCount=ja(this._fadeVao,"geometry");const n=this._isMars?dtt:YSe;this._passParameters.texture=new pt(s,{pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!0,width:1,height:512},n);const o=new NQ;o.geometry=Pg.Cone,this._coneTechnique=this._techniqueRepository.acquire(TA,o),o.geometry=Pg.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(TA,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=rt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(t){const i=t.bindParameters.camera;this._update(i);const r=t.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,t.bindParameters),r.bindVAO(this._vao),r.drawArrays(Nt.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,t.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(Nt.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(t){const i=O(),r=this._planetRadius,s=Oe(t.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(XB,n),a=r+ole;this._passParameters.innerScale=gtt(r+o,r,a)-1,this._passParameters.altitudeFade=gQ(n),ae(i,t.eye,(r+XB)/s),lle(i,t.center,t.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(t,i,t.up,this._passParameters.silhouette),c=ptt(),h=ftt(n);let p=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>XB){lle(t.eye,t.center,t.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._passParameters.silhouette),y=ye((m-1.5)/(l-1.5),0,1);p=this._texV0+y*c*this._texVScale,f=this._texV0+zt(this._texV1,l*h,y)*this._texVScale}di(this._passParameters.texV,p,f)}_createRibbon(t){const i=Cn(3+3*dD*3),r=new Uint32Array(3*dD*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<dD;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===dD-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=cle.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Wf(t,ji,{geometry:Uu(cle)},{geometry:Oi.createVertex(t,Xi.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,i,r,s){return fe(RS,s.center,s.v2),ae(pD,RS,this._outerRimFactor),cU(YB,i,RS,r),Jae(RS,YB,t.projectionMatrix,t.viewport,RS),Jae(pD,YB,t.projectionMatrix,t.viewport,pD),Vr(RS,pD)/t.height}}function lle(e,t,i,r,s){const n=Oe(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return ae(s.center,e,a/n),_t(l,e,t),ll(l)<1&&_t(l,e,i),ae(l,l,o/Oe(l)),_t(c,l,e),ae(c,c,o/Oe(c)),o}const YB=Pe(),RS=O(),pD=O();function gtt(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const cle=As().vec3f(R.POSITION);class p8 extends ir{initializeProgram(t){return new Ji(t.rctx,p8.shader.get().build(this.configuration),ji)}initializePipeline(){return Ht({blending:Ro(Ce.ONE,Ce.ZERO,Ce.ONE_MINUS_SRC_COLOR,Ce.ONE),colorWrite:si})}}p8.shader=new Zi(HSe,()=>Q(()=>import("./FogHaze.glsl.7defe1a2.js"),[]));const ytt=.7,_tt=1;let JO=class extends Te{constructor(e){super(e),this._passParameters=new DQ;const t=e.context.renderContext.rctx;this._vao=Tl(t,vM);const i=dr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+sP;const r=new FQ;r.haze=!0,this._hazeTechnique=e.context.techniqueRepository.acquire(p8,r)}destroy(){this._hazeTechnique.release(),this._vao.dispose()}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}render(e,t){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,t),this._passParameters.hazeAmount<=0))return;const i=this._hazeTechnique;if(!i.compiled)return void this.context.requestRender();const r=e.offscreenRenderingHelper;r.renderDepthDetached(()=>{this._passParameters.depthTexture=r.depthTexture;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderSimpleHaze(s,e)})}_renderSimpleHaze(e,t){const i=t.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Nt.TRIANGLE_STRIP,0,4)}_update(e,t){const i=e.bindParameters.camera;be(ule,i.eye);const r=Math.max(0,_e(ule,e.bindParameters.lighting.mainLight.direction)),s=btt;ae(hle,s,0),On(this._passParameters.hazeColor,hle,s,r);const n=Oe(i.eye),o=n*n;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-UC(ytt*$d,_tt*$d,Math.abs(n-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],JO.prototype,"context",void 0),u([d({constructOnly:!0})],JO.prototype,"view",void 0),JO=u([P("esri.views.3d.environment.SimpleHaze")],JO);class vtt{constructor(){this.strength=0,this.amount=0}}const btt=Le(.24,.44,.8),ule=O(),hle=O();function zQ(e){const t=x`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=x`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function wtt(){const e=new Yi;return e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.COLOR,"vec4"),e.attributes.add(R.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new ds("transform",(t,i)=>xtt(t,i)),new xi("viewport",(t,i)=>i.camera.fullViewport),new Ie("pixelRatio",(t,i)=>i.camera.pixelRatio)]),e.include(zQ),e.vertex.code.add(x`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(x`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function xtt(e,t){return Ao(T_,t.camera.projectionMatrix),T_[10]=24e-8-1,T_[11]=-1,T_[14]=(24e-8-2)*t.camera.near,Hs(T_,T_,t.camera.viewMatrix),Hs(T_,T_,e.modelMatrix)}const T_=Pe(),Ttt=Object.freeze(Object.defineProperty({__proto__:null,build:wtt},Symbol.toStringTag,{value:"Module"}));class Stt extends Rr{constructor(){super(...arguments),this.modelMatrix=Pe()}}class f8 extends ir{constructor(t){super(t,new xl,()=>this.destroy())}initializeProgram(t){return new Ji(t.rctx,f8.shader.get().build(),ji)}initializePipeline(){return Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:Zr.LEQUAL},colorWrite:si})}}f8.shader=new Zi(Ttt,()=>Q(()=>import("./Stars.glsl.7ba3a7bf.js"),[]));let Av=class extends Te{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return v(this._loadDataTask)&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new Stt,this._updatingTracking=new fg}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=ep(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=ls(this._technique),this._vao=rt(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),C(this._technique)||C(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Nt.POINTS,0,this._numPoints)}_ensureResources(e){if(v(this._technique)||C(OS))return;this._technique=new f8({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=OS.byteLength/dle;const t=new Float32Array(OS,0,2*this._numPoints),i=new Uint8Array(OS,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,r=>this._update(r),st)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=Ao(this._renderParameter.modelMatrix,Att);sA(r,r,-i*Math.PI),Hs(r,Ctt,r),sA(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=ple.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[l]),f=this._hexToRGB(Ett[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new Wf(e,ji,{geometry:Uu(ple)},{geometry:Oi.createVertex(e,Xi.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(v(OS))return null;const e=C$(async t=>{const{data:i}=await m5e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(i),OS=i});return e.promise.catch(t=>{Ws(t)||se.getLogger(this.declaredClass).error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new H("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/dle;if(t%1!=0||t>5e4||t<5e3)throw new H("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],Av.prototype,"view",void 0),u([d({constructOnly:!0})],Av.prototype,"requestRender",void 0),u([d({readOnly:!0})],Av.prototype,"updating",null),u([d()],Av.prototype,"_loadDataTask",void 0),u([d()],Av.prototype,"_updatingTracking",void 0),Av=u([P("esri.views.3d.environment.Stars")],Av);const Ett=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Ctt=wK(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Att=wK(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),dle=9,ple=As().vec3f(R.POSITION).vec4u8(R.COLOR).f32(R.SIZE);let OS=null;function Mtt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ek(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function GQ(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>vl()?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function jQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-r*c,e[2]=n*h+o*c+r*l-s*a,e[3]=o*h-r*a-s*l-n*c,e}function Rtt(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e}function Ott(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e}function Itt(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function Ptt(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e}function T4(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,f,m=i[0],y=i[1],_=i[2],b=i[3];return c=s*m+n*y+o*_+a*b,c<0&&(c=-c,m=-m,y=-y,_=-_,b=-b),1-c>vl()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(p=1-r,f=r),e[0]=p*s+f*m,e[1]=p*n+f*y,e[2]=p*o+f*_,e[3]=p*a+f*b,e}function $tt(e){const t=e$,i=t(),r=t(),s=t(),n=Math.sqrt(1-i),o=Math.sqrt(i);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=o*Math.sin(2*Math.PI*s),e[3]=o*Math.cos(2*Math.PI*s),e}function Ltt(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e}function NT(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function r2e(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*n+o]-t[3*o+n])*r,e[n]=(t[3*n+s]+t[3*s+n])*r,e[o]=(t[3*o+s]+t[3*s+o])*r}return e}function Dtt(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function Ftt(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const HQ=gf,Ntt=mr,ktt=ZY,Utt=jQ,Vtt=YA,Btt=ame,ztt=O6,s2e=JY,Gtt=s2e,n2e=KY,jtt=n2e,qQ=ome,Htt=eC,qtt=QY;function Wtt(e,t,i){const r=_e(t,i);return r<-.999999?(_t(em,Xtt,t),pu(em)<1e-6&&_t(em,Ytt,t),be(em,em),Ek(e,em,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(_t(em,t,i),e[0]=em[0],e[1]=em[1],e[2]=em[2],e[3]=1+r,qQ(e,e))}const em=O(),Xtt=Le(1,0,0),Ytt=Le(0,1,0);function Ztt(e,t,i,r,s,n){return T4(fle,t,s,n),T4(mle,i,r,n),T4(e,fle,mle,2*n*(1-n)),e}const fle=fp(),mle=fp();function Jtt(e,t,i,r){const s=Ktt;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],qQ(e,r2e(e,s))}const Ktt=Cs();Object.freeze(Object.defineProperty({__proto__:null,add:ktt,calculateW:Ptt,conjugate:NT,copy:HQ,dot:Btt,equals:qtt,exactEquals:Htt,fromEuler:Dtt,fromMat3:r2e,getAxisAngle:GQ,identity:Mtt,invert:Ltt,len:Gtt,length:s2e,lerp:ztt,mul:Utt,multiply:jQ,normalize:qQ,random:$tt,rotateX:Rtt,rotateY:Ott,rotateZ:Itt,rotationTo:Wtt,scale:Vtt,set:Ntt,setAxes:Jtt,setAxisAngle:Ek,slerp:T4,sqlerp:Ztt,sqrLen:jtt,squaredLength:n2e,str:Ftt},Symbol.toStringTag,{value:"Module"}));function U$(e=eit){return[e[0],e[1],e[2],e[3]]}function KOt(e,t,i=U$()){return le(i,e),i[3]=t,i}function gle(e,t,i=U$()){return _t(i,e,t),be(i,i),i[3]=-tme(e,t),i}function QOt(e,t,i=U$()){return Ek(fD,e,yle(e)),Ek(_le,t,yle(t)),jQ(fD,_le,fD),Qtt(i,Zl(GQ(i,fD)))}function e3t(e){return e}function yle(e){return Wt(e[3])}function Qtt(e,t){return e[3]=t,e}const eit=[0,0,1,0],fD=fp(),_le=fp();U$();function tit(e,t,i){const r=e.parallax.anchorPointClouds;e.fadeIn.stage===yu.FINISHED&&(e.fadeIn.factor=0,le(r,tg),e.fadeIn.stage=yu.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=_o.FINISHED),e.fadeIn.stage===yu.CHANGE_ANCHOR&&e.isCameraPositionFinal&&(AQ(e.data)&&e.renderingStage!==un.RENDERING||e.renderingStage===un.FADING_TEXTURE_CHANNELS)&&(le(r,tg),e.fadeIn.stage=yu.FADE_IN,e.startTime=t,e.renderingStage===un.FADING_TEXTURE_CHANNELS&&(e.renderingStage=un.SWITCH_CHANNELS)),e.fadeIn.factor<1&&e.fadeIn.stage===yu.FADE_IN?e.fadeIn.factor=i?ye((t-e.startTime)/(o2e*i),0,1):1:e.fadeIn.factor>=1&&e.fadeIn.stage===yu.FADE_IN&&(e.fadeIn.stage=yu.FINISHED,e.fadeIn.factor=1)}function iit(e,t,i){const{fadeInOut:r,crossFade:s}=e;r.stage===_o.FINISHED&&(e.startTime=t,r.factor=1,r.stage=_o.FADE_OUT),r.factor>0&&r.stage===_o.FADE_OUT?r.factor=i?1-ye((t-e.startTime)/(ait*i),0,1):0:(r.factor<=0&&r.stage===_o.FADE_OUT&&(r.factor=0,le(e.parallax.anchorPointClouds,tg)),r.factor<=0&&r.stage===_o.FADE_OUT&&e.isCameraPositionFinal&&(r.factor=0,r.stage=_o.SWITCH,e.crossFade.enabled=!1,s.factor=1),r.stage===_o.SWITCH&&(AQ(e.data)&&e.renderingStage!==un.RENDERING||e.renderingStage===un.FADING_TEXTURE_CHANNELS)&&(e.startTime=t,r.factor=0,r.stage=_o.FADE_IN,le(e.parallax.anchorPointClouds,tg),e.crossFade.enabled=!1,s.factor=1,e.renderingStage===un.FADING_TEXTURE_CHANNELS&&(e.renderingStage=un.SWITCH_CHANNELS)),r.factor<1&&r.stage===_o.FADE_IN?r.factor=i?ye((t-e.startTime)/(o2e*i),0,1):1:r.factor>=1&&r.stage===_o.FADE_IN&&(r.stage=_o.FINISHED,r.factor=1))}function rit(e,t,i,r){const{crossFade:s}=e,n=e.parallax.anchorPointClouds;e.crossFade.enabled&&!r||(le(e.parallaxNew.anchorPointClouds,tg),e.startTime=t,s.factor=0,e.crossFade.enabled=!0),s.factor<1&&e.crossFade.enabled?s.factor=i?ye((t-e.startTime)/(lit*i),0,1):1:s.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,s.factor=1,le(n,e.parallaxNew.anchorPointClouds),e.renderingStage===un.FADING_TEXTURE_CHANNELS&&(e.renderingStage=un.SWITCH_CHANNELS))}function vle(e,t,i,r){const s=e.fadeInOutHeight,n=s.stage===J1.FINISHED?i:e.startTimeHeightFade;if(r!==0){const o=(i-n)/(cit*r);s.factor+=t?-o:o}else s.factor=t?0:1;e.startTimeHeightFade=i,s.factor=ye(s.factor,0,1),s.stage=J1.HEIGHT_FADE}function sit(e,t,i,r,s){e.renderingStage===un.FINISHED_RENDERING&&(e.renderingStage=un.FADING_TEXTURE_CHANNELS);const n=Oe(t.eye);e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=n-Mi.radius>$d?1:0),e.isCameraPositionFinal=U1(e.cameraPositionLastFrame,t.eye),be(tg,t.eye),ae(tg,tg,Mi.radius);const o=e.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&le(o.anchorPointClouds,tg);const a=Oe(me(oit,o.anchorPointClouds,tg));let l=!0;a>e.fadeIn.distanceThresholdFactor*o.cloudsHeight||e.fadeIn.stage!==yu.FINISHED?tit(e,r,s):a>e.fadeInOut.distanceThresholdFactor*o.cloudsHeight||e.fadeInOut.stage!==_o.FINISHED?iit(e,r,s):a>e.crossFade.distanceThresholdFactor*o.cloudsHeight||e.crossFade.enabled||e.renderingStage===un.FADING_TEXTURE_CHANNELS?rit(e,r,s,(i!==Di.IDLE||!AQ(e.data))&&e.renderingStage!==un.FADING_TEXTURE_CHANNELS):l=!1;const c=n-Mi.radius;if((c>1.7*$d||c<-$d)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(c>$d||c<-.35*$d)&&e.fadeInOutHeight.factor<1?vle(e,!1,r,s):c<$d&&c>-.35*$d&&e.fadeInOutHeight.factor>0?vle(e,!0,r,s):e.fadeInOutHeight.stage=J1.FINISHED,e.renderingStage===un.SWITCH_CHANNELS&&(e.readChannels=1-e.readChannels,e.renderingStage=un.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-Mi.radius*Mi.radius,0))/n,gle(ble,o.anchorPointClouds,IS),Cu(o.transform,Hh,IS[3],IS),l){const{parallaxNew:h}=e;gle(ble,h.anchorPointClouds,IS),Cu(h.transform,Hh,IS[3],IS)}le(e.cameraPositionLastFrame,t.eye)}function nit(e){return e.crossFade.enabled||e.fadeInOut.stage!==_o.FINISHED||e.fadeIn.stage!==yu.FINISHED||e.fadeInOutHeight.stage!==J1.FINISHED||e.renderingStage!==un.FINISHED}const ble=Le(0,0,1),IS=U$(),tg=O(),oit=O(),o2e=1,ait=.5,lit=1.3,cit=1;class wM{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,i){var r;return(r=this._outer.get(t))==null?void 0:r.get(i)}set(t,i,r){const s=this._outer.get(t);s?s.set(i,r):this._outer.set(t,new Map([[i,r]]))}delete(t,i){const r=this._outer.get(t);r&&(r.delete(i),r.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((i,r)=>t(i,r))}}var wn;function wle(e=he("enable-feature:high-quality-idle")){const t=new wM;return e&&(t.set(Di.INTERACTING,wn.Antialiasing,!0),t.set(Di.IDLE,wn.Antialiasing,!0),t.set(Di.INTERACTING,wn.HighQualityTransparency,!0),t.set(Di.IDLE,wn.HighQualityTransparency,!0),t.set(Di.INTERACTING,wn.RealisticAtmosphere,!0),t.set(Di.IDLE,wn.RealisticAtmosphere,!0),t.set(Di.IDLE,wn.SSAO,!0),t.set(Di.IDLE,wn.WaterReflection,!0),t.set(Di.IDLE,wn.PhysicalPixelRendering,!0)),t.set(Di.ANIMATING,wn.ShadowMapUpdate,!0),t.set(Di.INTERACTING,wn.ShadowMapUpdate,!0),t.set(Di.IDLE,wn.ShadowMapUpdate,!0),t.set(Di.IDLE,wn.HighQualityVoxel,!0),t}(function(e){e[e.Antialiasing=0]="Antialiasing",e[e.HighQualityTransparency=1]="HighQualityTransparency",e[e.HighQualityVoxel=2]="HighQualityVoxel",e[e.RealisticAtmosphere=3]="RealisticAtmosphere",e[e.SSAO=4]="SSAO",e[e.WaterReflection=5]="WaterReflection",e[e.ShadowMapUpdate=6]="ShadowMapUpdate",e[e.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(wn||(wn={}));var EC;(function(e){e[e.Immediate=0]="Immediate",e[e.Faded=1]="Faded"})(EC||(EC={}));var KO;const uit=[Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE,Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Fo=KO=class extends Te{constructor(e){super(e),this._context=null,this._atmosphere=null,this._hqAtmosphere=null,this._oldWeatherParameters=new ZB,this._newWeatherParameters=new ZB,this._fadedWeatherParameters=new ZB,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(uit,this)}destroy(){var e;this.removeHandles(),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return v(this._hqAtmosphere)&&this.view._stage.renderer.isFeatureEnabled(wn.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}get _atmosphereType(){return v(this.atmosphere)?this.atmosphere.type:yo.None}get canRender(){var e;return!!((e=this.view.basemapTerrain)!=null&&e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._atmosphereType===yo.Realistic}updateAnimation(e){return!!v(this._precipitation)&&this._precipitation.update(e)}get updating(){return v(this._stars)&&this._stars.updating||v(this._clouds)&&this._clouds.running}get weatherVisible(){return Oe(this.view.state.camera.eye)-dr(this.view.spatialReference).radius<=$d}get _stars(){var r,s;const e=this.view,t=(s=(r=e.environment)==null?void 0:r.starsEnabled)!=null?s:!1,i=this._get("_stars");return!t||C(this._context)?(Be(i),null):v(i)?i:new Av({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||C(this._context))return Be(e),null;const t=this.view,i=this._context;return v(e)&&e.context===i?e:(Be(e),new Kw({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||C(this._context))return Be(e),null;if(v(e))return e;const t=this.view,i=this._context;return Be(e),new yc({context:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||C(this._context))return Be(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=dr(this.view.spatialReference).radius;return v(e)&&e.viewingMode===t&&e.planetRadius===r?e:(Be(e),new Zw({rctx:i,viewingMode:t,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||C(this._context))return Be(e),null;if(v(e))return e;const t=this.view,i=this._context;return new ZO({context:i,view:t})}get _simpleHaze(){const e=this._get("_simpleHaze");if(!this.weatherEnabled||C(this._context))return Be(e),null;if(v(e))return e;const t=this.view,i=this._context;return new JO({context:i,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)!=null&&t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e;const t=()=>this._setNeedsRender();this.addHandles([Qo(()=>{var i;return(i=this.view)==null?void 0:i.basemapTerrain},()=>this._updateBasemapTerrain(),Gs),te(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),i=>this._updateAtmosphere(i),Gs),te(()=>this._stars,t),te(()=>this._precipitation,t),te(()=>this._clouds,()=>this._updateWeather(),st),te(()=>this._fog,()=>this._updateFogHaze(),st),te(()=>this._simpleHaze,()=>this._updateFogHaze(),st),te(()=>this.view.state.mode,()=>{this._setNeedsRender()},hr),te(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),Gs),te(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Gs)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Be(this._atmosphere),this._hqAtmosphere=Be(this._hqAtmosphere),this._set("_stars",Be(this._stars)),this._set("_precipitation",Be(this._precipitation)),this._set("_clouds",Be(this._clouds)),this._set("_cloudsComposition",Be(this._cloudsComposition)),this._set("_fog",Be(this._fog)),this._set("_simpleHaze",Be(this._simpleHaze))}prepareRender(e){e.bindParameters.cloudsFade.data=tQe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(sit(e.bindParameters.cloudsFade,e.bindParameters.camera,this.view.state.mode,e.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(e.bindParameters),e.bindParameters.cloudsFade.renderingStage===un.FINISHED&&v(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),e.bindParameters.cloudsFade.data=null))}render(e){if(e.output===z.Color)switch(e.bindParameters.slot){case Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE:v(this._stars)&&this._stars.render(e),v(this.atmosphere)&&(this.atmosphere.render(e),v(this._cloudsComposition)&&v(e.bindParameters.cloudsFade.data)&&(this.weatherVisible&&v(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),nit(e.bindParameters.cloudsFade)&&v(this._context)&&this._context.requestRender());break;case Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(v(this.atmosphere)&&(this.atmosphere.renderHaze(e,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._atmosphereType!==yo.Realistic&&v(this._simpleHaze)&&this._simpleHaze.render(e,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&v(this._fog)&&this._fog.render(e,this._weatherParameters.fog),v(this._precipitation))){const t=this.view.environment.weather;t.type!=="rainy"&&t.type!=="snowy"||this._precipitation.render(e,t.precipitation,t.type)}}}updateLightSources(e,t,i,r){if(v(this._context)){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=t,s.bindParameters.newLighting.globalFactor=i,s.bindParameters.newLighting.set(e),r===EC.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return C(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeatherFading(e){if(!e.weatherFading)return;const t=e.cloudsFade;return t.fadeIn.stage===yu.FADE_IN?(e.fadeLighting(t.fadeIn.factor),void this._fadeWeather(t.fadeIn.factor)):t.fadeInOut.stage===_o.FADE_IN?(e.fadeLighting(t.fadeInOut.factor),void this._fadeWeather(t.fadeInOut.factor)):t.crossFade.enabled?(e.fadeLighting(t.crossFade.factor),void this._fadeWeather(t.crossFade.factor)):(e.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(e){const{_newWeatherParameters:t,_oldWeatherParameters:i}=this;e>=1?this._weatherParameters=t:(this._fadedWeatherParameters.lerp(i,t,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;C(e)||C(this._clouds)||(this._clouds.applyPreset(il[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){v(this._context)&&this._context.requestRender()}_updateFogHaze(){var i,r;const e=this._weatherUpdateParameters;if(C(this._fog)||C(this._simpleHaze)||C(e)||C(this._context))return;const t=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=zt(3e-5,.005,e.weatherAdjustment**3),le(this._newWeatherParameters.fog.color,xle),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===yo.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=zt(4e-6,2e-4,((i=e.effect)!=null?i:0)**3),le(this._newWeatherParameters.fog.color,hit),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=zt(4e-6,2e-4,((r=e.effect)!=null?r:0)**3),le(this._newWeatherParameters.fog.color,xle),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===yo.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}t.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(e){const t=this._selectAtmosphereType(e);if(v(this._atmosphere)?this._atmosphere.type===t:t===yo.None)return;this._atmosphere=Be(this._atmosphere),this._hqAtmosphere=Be(this._hqAtmosphere);const i=this._getAtmosphereClass(t);i&&v(this._context)&&(this._atmosphere=new i(this.view,this._context),t===yo.Simple&&(this._hqAtmosphere=new FB(this.view,this._context))),this._setNeedsRender(),this._updateBasemapTerrain()}_getAtmosphereClass(e){switch(e){case yo.Realistic:return FB;case yo.Panoramic:return ett;case yo.Simple:return mtt;default:case yo.None:return null}}_selectAtmosphereType(e){const{enabled:t,quality:i,viewingMode:r}=e;return!t||Ng(this.view.spatialReference)?yo.None:r===je.Local?yo.Panoramic:v(this._context)&&i==="high"&&FB.isSupported(this._context)&&CI(this.view.spatialReference)?yo.Realistic:yo.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===yo.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:e=>{Tle=KO.prototype._getAtmosphereClass,KO.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{KO.prototype._getAtmosphereClass=Tle}}}};u([d({constructOnly:!0})],Fo.prototype,"view",void 0),u([d({readOnly:!0})],Fo.prototype,"atmosphere",null),u([d({readOnly:!0})],Fo.prototype,"_atmosphereType",null),u([d({type:Boolean,readOnly:!0})],Fo.prototype,"updating",null),u([d({readOnly:!0})],Fo.prototype,"weatherVisible",null),u([d()],Fo.prototype,"_context",void 0),u([d()],Fo.prototype,"_atmosphere",void 0),u([d()],Fo.prototype,"_hqAtmosphere",void 0),u([d({readOnly:!0})],Fo.prototype,"_stars",null),u([d({readOnly:!0})],Fo.prototype,"_precipitation",null),u([d({readOnly:!0})],Fo.prototype,"_clouds",null),u([d({readOnly:!0})],Fo.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Fo.prototype,"_fog",null),u([d({readOnly:!0})],Fo.prototype,"_simpleHaze",null),u([d({readOnly:!0})],Fo.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Fo.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Fo.prototype,"_weatherUpdateParameters",null),Fo=KO=u([P("esri.views.3d.environment.EnvironmentRenderer")],Fo);class ZB{constructor(){this.fog=new fet,this.haze=new vtt}copyFrom(t){this.fog.amount=t.fog.amount,this.haze.amount=t.haze.amount,this.fog.strength=t.fog.strength,this.haze.strength=t.haze.strength,le(this.fog.color,t.fog.color)}lerp(t,i,r){this.fog.amount=zt(t.fog.amount,i.fog.amount,r),this.haze.amount=zt(t.haze.amount,i.haze.amount,r),this.fog.strength=zt(t.fog.strength,i.fog.strength,r),this.haze.strength=zt(t.haze.strength,i.haze.strength,r),On(this.fog.color,t.fog.color,i.fog.color,r)}}const hit=Le(.5,.5,.5),xle=Le(1.5,1.5,1.5);let Tle;function Sle(e,t,i){if(C(t.longitude)||C(t.latitude)||C(i.longitude)||C(i.latitude))throw new Error("Invalid points: no lon/lat");return dit(e,t.longitude,t.latitude,i.longitude,i.latitude)}function dit(e,t,i,r,s){const n=Wt(i),o=Wt(s),a=n-o,l=Wt(t)-Wt(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*tp(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function pit(e,t,i){const r=t.spatialReference,s=dr(r),n=new ut(t.x,e.y,r),o=new ut(i.x,e.y,r),a=new ut(e.x,t.y,r),l=new ut(e.x,i.y,r);return{lon:Sle(s.radius,n,o),lat:Sle(s.radius,a,l)}}function fit(e,t,i){const r=t/i,s=Wt(e),n=Math.sin(r/2),o=Math.cos(s),a=2*tp(Math.sqrt(n*n/(o*o)));return Zl(a)}function mit(e,t){let i=e/15;return t||(i=Math.round(i)),i}function Ele(e,t){const i=e==null?void 0:e[0];if(i==null)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=mit(i,!0);const r=t.hours%1;t.hours-=r,t.minutes=60*r;const s=t.minutes%1;return t.minutes-=s,t.seconds=Math.round(60*s),t}var Cle,Ale,Mle,wX={},git={get exports(){return wX},set exports(e){wX=e}};Cle=git,Ale=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f(L){return L.valueOf()/l-.5+c}function m(L){return new Date((L+.5-c)*l)}function y(L){return f(L)-h}var _=23.4397*a;function b(L,N){return n(t(L)*i(_)-r(N)*t(_),i(L))}function w(L,N){return s(t(N)*i(_)+i(N)*t(_)*t(L))}function T(L,N,U){return n(t(L),i(L)*t(N)-r(U)*i(N))}function S(L,N,U){return s(t(N)*t(U)+i(N)*i(U)*i(L))}function E(L,N){return a*(280.16+360.9856235*L)-N}function M(L){return a*(357.5291+.98560028*L)}function A(L){return a*(1.9148*t(L)+.02*t(2*L)+3e-4*t(3*L))}function $(L,N){return L+N+102.9372*a+e}function I(L,N){var U=M(L),W=$(U,A(U));return N||(N={dec:0,ra:0}),N.dec=w(W,0),N.ra=b(W,0),N}var k={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(L,N,U,W){var Z=a*-U,ie=a*N,Y=y(L),ce=I(Y,p),pe=E(Y,Z)-ce.ra;return W||(W={azimuth:0,altitude:0}),W.azimuth=T(pe,ie,ce.dec),W.altitude=S(pe,ie,ce.dec),W}},V=[[-.83,"sunrise","sunset"]];k.addTime=function(L,N,U){V.push([L,N,U])};var B=9e-4;function G(L,N){return Math.round(L-B-N/(2*e))}function X(L,N,U){return B+(L+N)/(2*e)+U}function K(L,N,U){return h+L+.0053*t(N)-.0069*t(2*U)}function re(L,N,U){return o((t(L)-t(N)*t(U))/(i(N)*i(U)))}function q(L){var N=a*(134.963+13.064993*L),U=a*(93.272+13.22935*L),W=a*(218.316+13.176396*L)+6.289*a*t(N),Z=5.128*a*t(U),ie=385001-20905*i(N);return{ra:b(W,Z),dec:w(W,Z),dist:ie}}return k.getTimes=function(L,N,U){var W=a*-U,Z=a*N,ie=G(y(L),W),Y=X(0,W,ie),ce=M(Y),pe=A(ce),ve=$(ce,pe),Se=w(ve,0),We=K(Y,ce,ve);function Ne(ni){return K(X(re(ni,Z,Se),W,ie),ce,ve)}function xe(ni){var Qt=(t(ni)-t(Z)*t(Se))/(i(Z)*i(Se));return Qt<-1?k.PolarException.MIDNIGHT_SUN:Qt>1?k.PolarException.POLAR_NIGHT:k.PolarException.NORMAL}var ke,Ve,Et,it,Gt,Kt={solarNoon:m(We),nadir:m(We-.5),polarException:k.PolarException.NORMAL};for(ke=0,Ve=V.length;ke<Ve;ke+=1)Gt=We-((it=Ne((Et=V[ke])[0]*a))-We),Kt[Et[1]]=m(Gt),Kt[Et[2]]=m(it);return Kt.polarException=xe(V[0][0]*a),Kt},k.getMoonPosition=function(L,N,U){var W=a*-U,Z=a*N,ie=y(L),Y=q(ie),ce=E(ie,W)-Y.ra,pe=S(ce,Z,Y.dec);return pe+=.017*a/r(pe+10.26*a/(pe+5.1*a)),{azimuth:T(ce,Z,Y.dec),altitude:pe,distance:Y.dist}},k.getMoonFraction=function(L){var N=y(L),U=I(N),W=q(N),Z=149598e3,ie=o(t(U.dec)*t(W.dec)+i(U.dec)*i(W.dec)*i(U.ra-W.ra)),Y=n(Z*t(ie),W.dist-Z*i(ie));return(1+i(Y))/2},k},(Mle=Ale())!==void 0&&(Cle.exports=Mle);const kT=wX,Wm={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function yit(e,t,i,r,s,n){ue(n.ambient.color,1,1,1),n.ambient.intensity=Wm.global.ambient,ue(n.direct.color,1,1,1),n.direct.intensity=Wm.global.direct;const o=t[2],a=ye((Math.abs(o)-Wm.local.altitude)/(Wm.global.altitude-Wm.local.altitude),0,1);let l;if(n.globalFactor=a,v(e)&&(l=kT.getTimes(e,t[1],t[0])),a<1){let c;if(v(e))c=Sit(e,l,r);else{const h=c2e(r);c={direct:{intensity:Wm.local.directAtNoon*h.direct,color:Le(1,1,1)},ambient:{intensity:Wm.local.ambientAtNoon*h.ambient,color:Le(1,1,1)},timeOfDay:"early afternoon"}}On(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=zt(c.ambient.intensity,n.ambient.intensity,a),On(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=zt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=v(e)?Tit(e,l):1,v(e)?_it(e,t,i,n.direct.directionToLightSource):a2e(s,i,n.direct.directionToLightSource)}function a2e(e,t,i){t===je.Global?be(JB,e.eye):ue(JB,0,0,1),ae(KB,e.viewForward,-1);const r=e4(KB,JB),s=Math.max(r-2*QB,0),n=.85*s/(s+1),o=Math.max(QB,r-QB-n);jh(Ole,-o,e.viewRight),Ze(i,KB,Ole),fe(i,i,ae(Eit,e.viewRight,Cit)),be(i,i)}function _it(e,t,i,r){const s=xit,n=np(wit);if(i===je.Global)kT.getPosition(e,0,0,s),ue(r,0,0,-1),rA(n,n,-s.azimuth),aU(n,n,-s.altitude),Ze(r,r,n);else{const o=Wm.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ye(c,0,1),c<1?(kT.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),ue(r,0,-1,0),sA(n,n,-s.azimuth),rA(n,n,-s.altitude),Ze(r,r,n)}}function vit(e,t){if(t===je.Global)return!0;const i=Wm.planarDirection;return Math.abs(e)<i.localAltitude}const bit=Le(.5773502691896258,-.5773502691896258,.5773502691896258);class l2e{constructor(){this.ambient={color:Le(1,1,1),intensity:.55},this.direct={color:Le(1,1,1),intensity:.55,directionToLightSource:js(bit)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const wit=Pe(),xit={azimuth:0,altitude:0};function Tit(e,t){const i=e.valueOf();let r,s;t.polarException===kT.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===kT.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-ye(Math.abs(i-n)/432e5,0,1)}function c2e(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function Rle(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function Sit(e,t,i){const r=e.valueOf();let s,n;t.polarException===kT.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===kT.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,_=n+p/2,b=Wm.local,w=[.01,b.ambientAtNight],T=[.8,.8,1],S=[.01,.01,.01],E=[b.directAtTwilight,b.ambientAtTwilight],M=[1,.6,.5],A=[.8,.8,1],$=[.9*b.directAtNoon,b.ambientAtNoon],I=[1,.98,.98],k=[.98,.98,1],V=[b.directAtNoon,b.ambientAtNoon],B=[1,1,1],G=[1,1,1],X=$,K=I,re=k,q=E,L=M,N=A;let U,W,Z=[0,0],ie=[0,0,0],Y=[0,0,0];r<f||r>_?(Z=w,ie=S,Y=T,W="night"):r<m?(U=m-f,Z=La(r-f,U,w,E),ie=La(r-f,U,S,M),Y=La(r-f,U,T,A),W="sun rising"):r<c?(U=c-m,Z=La(r-m,U,E,$),ie=La(r-m,U,M,I),Y=La(r-m,U,A,k),W="early morning"):r<a?(U=a-c,Z=La(r-c,U,$,V),ie=La(r-c,U,I,B),Y=La(r-c,U,k,G),W="late morning"):r<h?(U=h-a,Z=La(r-a,U,V,X),ie=La(r-a,U,B,K),Y=La(r-a,U,G,re),W="early afternoon"):r<y?(U=y-h,Z=La(r-h,U,X,q),ie=La(r-h,U,K,L),Y=La(r-h,U,re,N),W="late afternoon"):r<_&&(U=_-y,Z=La(r-y,U,q,w),ie=La(r-y,U,L,S),Y=La(r-y,U,N,T),W="sun setting");let ce=0;switch(i){case"rainy":case"foggy":case"snowy":ce=.5}ce>0&&(ie=Rle(ie,ce),Y=Rle(Y,ce));const pe=Le(ie[0],ie[1],ie[2]),ve=Le(Y[0],Y[1],Y[2]),Se=c2e(i);return{direct:{intensity:Z[0]*Se.direct,color:pe},ambient:{intensity:Z[1]*Se.ambient,color:ve},timeOfDay:W}}function La(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}const Ole=Pe(),JB=O(),KB=O(),Eit=O(),QB=.25,Cit=.2;let Wp=class extends ps.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Ii,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new bk,this._ambientLight=new LQ,this._moonLight=new VSe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,t,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(t=this._view)==null?void 0:t.state)==null?void 0:i.viewingMode)===je.Global&&CI(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Fo({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([te(()=>e.environment.lighting,r=>this._updateLightingHandler(r),hr),te(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,r=>this._lightingDateHandler(r),hr),te(()=>e.stationary,()=>this._interactingStationaryHandler()),te(()=>e.environment.lighting.directShadowsEnabled,t,hr),te(()=>e.environment.lighting.ambientOcclusionEnabled,t,hr),te(()=>e.environment.lighting.waterReflectionEnabled,t,hr),te(()=>{var r;return(r=e.environment.background)==null?void 0:r.color},t,hr),te(()=>e.spatialReference,()=>this._resetReferencePosition(!0),hr),te(()=>e.environment.weather.type,()=>this._updateLighting(null,EC.Faded),hr),te(()=>this.weatherEnabled,()=>this._updateLighting(null,EC.Faded),hr),te(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Gs),te(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,r=>this._updateCameraTracking(r),Gs),te(()=>e.state.camera,i,Gs),te(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Be(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)!=="virtual"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!_T(i)){const r=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(r))return void this._requestReferencePositionUpdate(r)}if(this._preupdateTracking(e),v(this._referencePosWGS84Comparable)){const r=Ele(this._referencePosWGS84Comparable,Ile);v(r)&&(t.autoUpdate(null,r),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){var s,n,o;const i=CI(this._view.spatialReference);if(i&&!_T(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const r=e.position;return C(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=O()),i?M9e(r,this._referencePosWGS84Comparable):ue(this._referencePosWGS84Comparable,(s=r.longitude)!=null?s:0,(n=r.latitude)!=null?n:0,(o=r.z)!=null?o:0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){var i;const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=((i=t.z)!=null?i:0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,t=EC.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const r=this._referencePosWGS84Comparable,s=v(r)?Ait:Mit,n=this.weatherVisible?i.environment.weather.type:"disabled";v(r)?yit(e,r,i.state.viewingMode,n,i.state.camera,s):i.environment.lighting.type==="virtual"&&a2e(i.state.camera,i.state.viewingMode,s.direct.directionToLightSource);const o=this._mainLight,a=s.direct;ae(o.intensity,a.color,a.intensity*Math.PI),le(o.direction,a.directionToLightSource),o.specularStrength=s.specularStrength,o.environmentStrength=s.environmentStrength;const l=this._ambientLight;ae(l.intensity,s.ambient.color,s.ambient.intensity);const c=this._moonLight;On(c.intensity,Oit,Iit,s.globalFactor);const h=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));ae(c.intensity,c.intensity,h),le(c.direction,a.directionToLightSource),this._renderer.updateLightSources([o,l,c],s.noonFactor,s.globalFactor,t),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||C(e))return!1;const i=Rit;i.setTime((t||this._view.environment.lighting.date).getTime());const r=Ele(e,Ile);if(C(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=Sh(this._referencePosWGS84Comparable,!0,s=>vit(s[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof qTe?{type:"color",color:AJ(De.toUnitRGBA(i.color))}:{type:"color",color:Yt(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=M0(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),r=this._referencePosUpdateTimer=M0(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===r&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){var i;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const r=((i=this._referencePosMapCoords.z)!=null?i:0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[t[0],t[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([d({type:Boolean,readOnly:!0})],Wp.prototype,"updating",null),u([d()],Wp.prototype,"disableQueries",void 0),u([d()],Wp.prototype,"_disableWeather",void 0),u([d()],Wp.prototype,"weatherEnabled",null),u([d()],Wp.prototype,"weatherVisible",null),u([d()],Wp.prototype,"referencePositionWGS84Comparable",null),u([d()],Wp.prototype,"_renderer",void 0),u([d()],Wp.prototype,"_referencePosWGS84Comparable",void 0),Wp=u([P("esri.views.3d.environment.SceneViewEnvironmentManager")],Wp);const Ait=new l2e,Mit=new l2e,Rit=new Date,Ile={hours:0,minutes:0,seconds:0},Oit=Le(.22,.22,.33),Iit=Le(.22,.22,.22);var is;(function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(is||(is={}));var hi;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(hi||(hi={}));var Jo;(function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"})(Jo||(Jo={}));function xP(e,t){return(e&t)!=0}function Ck(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}const rb={selection:is.NONE,interactionType:hi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Jo.TUMBLE};function u2e(e,t,i,r){return t=t||e.viewForward,le(r,t),ae(r,r,Math.sign(_e(t,i))),r}function Pit(e,t,i,r){return Nit(e,t,i,Dit(r,t,i,!0))}function $it(e,t,i,r){const s=_e(i,me(e,r,t));return fe(e,t,ae(e,i,s))}const Lit={dir:O(),len:0,clip:tt()};function Dit(e,t,i,r){const s=Lit;return e?(i&&r&&(s.len=Vr(t,i)),le(s.dir,e)):r?(s.len=Vr(t,i),me(s.dir,i,t),ae(s.dir,s.dir,1/s.len)):(me(s.dir,i,t),be(s.dir,s.dir)),s}function Fit(e,t,i){const r=_e(e,i.dir),s=-Ur(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function Nit(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!Fit(e[s],t,r))return!1;return!0}function kit(e,t,i=rb){const r=WQ(e,t,i);if(r===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=u2e(t,i.interactionDirection,Bit(e,t,Math.sign(r),Hit),jit),a=le(qit,t.viewForward),l=s.intersectInfiniteManifold(qh(t.eye,o),n,ez);return t.eye=v(l)?l:s.setAltitude(ez,n,t.eye),t.center=$it(ez,t.eye,a,t.center),!0}function WQ(e,t,i=rb){if(!Uit(e,i)||!e.state.constraints.altitude)return 0;const r=zit(e.state.constraints.altitude,Git);Vit(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=ye(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function Uit(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==hi.TUMBLE||!xP(t.selection,is.TILT))}function Vit(e,t,i){const r=t.interactionType;if(r===hi.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=r===hi.TUMBLE||r===hi.ZOOM,c=WQ(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,Ck(c,h,l,a,.05*h,i)}function Bit(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),ae(r,r,i),r}function zit(e,t){return t.min=e.min,t.max=e.max,t}const Git={min:0,max:0},jit=O(),Hit=O(),qit=O(),ez=O();function XQ(e,t,i=rb){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;mD.min=0,mD.max=r,Xit(e,i,mD);const s=YQ(e,t),n=mD.max-s;return n>=-1e-6?0:n}function Wit(e,t,i=rb){const r=XQ(e,t,i);if(r===0)return!1;const s=e.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=YQ(e,t)+r,o=le(Zit,t.eye),a=u2e(t,i.interactionDirection,Yit(t,s.renderLocation,Qit),Kit);if(!gb(vbe(s.renderLocation,n),qh(t.eye,a),gD))return!1;t.eye=gD;const l=me(Jit,t.eye,o);t.center=fe(gD,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,gD);return v(h)&&(t.center=h),!0}function Xit(e,t,i){const r=t.interactionType;if(r===hi.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=r===hi.ZOOM||r===hi.PAN,c=XQ(e,o),h=c===0?0:YQ(e,o);i.min=s,i.max=n,Ck(c,h,l,a,.05*h,i)}function YQ(e,t){const i=e.pointsOfInterest.surfaceOrigin;return i.renderLocation?Vr(t.eye,i.renderLocation):0}function Yit(e,t,i){return z0(i,e.eye,t)}const mD={min:0,max:0},Zit=O(),Jit=O(),Kit=O(),Qit=O(),gD=O();var Ss,Aa;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(Ss||(Ss={}));class ert{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Aa.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(Aa||(Aa={}));class trt{constructor(t,i,r){this.object=t,this.geometryId=i,this.triangleNr=r}}class irt extends trt{constructor(t,i,r,s){super(t,i,r),this.center=v(s)?js(s):null}}class h2e{constructor(t){this.layerUid=t}}class m8 extends h2e{constructor(t,i){super(t),this.graphicUid=i}}function Xf(e){return v(e)&&v(e.dist)}function Ple(e){return(t,i,r)=>(On($le,t,i,r),!OK(e,$le))}function g8(e){return Xf(e)&&e.intersector===Ss.OBJECT&&!!e.target}function y8(e){return Xf(e)&&e.intersector===Ss.HUD&&!!e.target&&"center"in e.target&&v(e.target.center)}const $le=O();class rrt{constructor(){this._transform=Pe(),this._transformInverse=new yD({value:this._transform},Ea,Pe),this._transformInverseTranspose=new yD(this._transformInverse,Lu,Pe),this._transformTranspose=new yD({value:this._transform},Lu,Pe),this._transformInverseRotation=new yD({value:this._transform},ASe,Cs)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Ao(this._transform,t)}multiplyTransform(t){Hs(this._transform,this._transform,t)}set(t){Ao(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}}class yD{constructor(t,i,r){this._original=t,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}class srt{constructor(t=0){this.offset=t,this.tmpVertex=O()}applyToVertex(t,i,r){const s=t+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)S_[n]=t[0+n]+this.localOrigin[n],_D[n]=t[3+n]+this.localOrigin[n],PS[n]=S_[n];const i=this.applyToVertex(S_[0],S_[1],S_[2]);for(let n=0;n<3;++n)t[n]=i[n],t[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)PS[o]=(n&1<<o)==0?S_[o]:_D[o];r(PS)}let s=0;for(let n=0;n<3;++n)S_[n]*_D[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?PS[o]=0:PS[o]=(n&1<<o)!=0?S_[o]:_D[o];r(PS)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const S_=O(),_D=O(),PS=O();class nrt{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=O(),this._mbs=Gn(),this._obb={center:O(),halfSize:as(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,i,r){const s=t,n=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=i+n*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(t){const i=t[0],r=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return t[0]-=i<0?this._totalOffset:0,t[1]-=r<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const f=Math.max(Math.abs(i),Math.abs(n)),m=Math.max(Math.abs(r),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(f*f+m*m+y*y),b=this._totalOffset/_,w=this._totalOffset/p;return t[0]+=i*(i>0?b:w),t[1]+=r*(r>0?b:w),t[2]+=s*(s>0?b:w),t[3]+=n*(n<0?b:w),t[4]+=o*(o<0?b:w),t[5]+=a*(a<0?b:w),t}applyToMbs(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this._totalOffset/i;return this._mbs[0]=t[0]+t[0]*r,this._mbs[1]=t[1]+t[1]*r,this._mbs[2]=t[2]+t[2]*r,this._mbs[3]=t[3]+t[3]*this._totalOffset/i,this._mbs}applyToObb(t){const i=t.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,Cf(this._obb.halfSize,t.halfSize,t.quaternion),fe(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,me(this._obb.halfSize,this._obb.halfSize,t.center),NT(Nle,t.quaternion),Cf(this._obb.halfSize,this._obb.halfSize,Nle),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class ort{constructor(t=0){this.offset=t,this.sphere=Gn(),this.tmpVertex=O()}applyToVertex(t,i,r){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*i+s[8]*r+s[12],o=s[1]*t+s[5]*i+s[9]*r+s[13],a=s[2]*t+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,i){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(t){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}}const Lle=new ort;function xX(e){return v(e)?(Lle.offset=e,Lle):null}const Dle=new nrt;function art(e){return v(e)?(Dle.offset=e,Dle):null}const Fle=new srt;function lrt(e){return v(e)?(Fle.offset=e,Fle):null}const Jv="terrain",Nle=fp(),PA=1e-5;class crt{constructor(t){this.options=new ert,this._results=new urt,this.transform=new rrt,this.tolerance=PA,this.verticalOffset=null,this._ray=Xo(),this._rayEnd=O(),this._rayBeginTransformed=O(),this._rayEndTransformed=O(),this.viewingMode=t!=null?t:je.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,i,r){this.resetWithRay(aze(t,i,this._ray),r)}resetWithRay(t,i){this.camera=i,t!==this._ray&&H5(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===je.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,fe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r!=null?r:PA;const o=xX(this.verticalOffset);if(v(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();v(c)?(v(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const i=t.geometries;if(!i)return;const r=t.transformation,s=xX(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(r,n.shaderTransformation),Ze(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ze(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;v(s)&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,f,m,y)=>{if(c>=0){if(v(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,b=f?w=>{const T=new irt(t,a,p,y);w.set(Ss.HUD,T,c,h,Hh,m)}:w=>w.set(Ss.OBJECT,{object:t,geometryId:a,triangleNr:p},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&b(_.min),this.options.store!==Aa.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&b(_.max),this.options.store===Aa.ALL)if(f){const w=new TX(this._ray);b(w),this._results.hud.all.push(w)}else{const w=new CC(this._ray);b(w),this._results.all.push(w)}}})}}sortResults(t=this._results.all){t.sort((i,r)=>i.dist!==r.dist?Ft(i.dist,0)-Ft(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?Ft(i.drapedLayerOrder,Number.MAX_VALUE)-Ft(r.drapedLayerOrder,Number.MAX_VALUE):Ft(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-Ft(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function dp(e){return new crt(e)}class urt{constructor(){this.min=new CC(Xo()),this.max=new CC(Xo()),this.hud={min:new TX(Xo()),max:new TX(Xo()),all:new Array},this.ground=new CC(Xo()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class CC{get ray(){return this._ray}get distanceInRenderSpace(){return v(this.dist)?(ae(vD,this.ray.direction,this.dist),Oe(vD)):null}getIntersectionPoint(t){return!!Xf(this)&&(ae(vD,this.ray.direction,this.dist),fe(t,this.ray.origin,vD),!0)}getTransformedNormal(t){return le(tR,this.normal),tR[3]=0,Ph(tR,tR,this.transformation),le(t,tR),be(t,t)}constructor(t){this.intersector=Ss.OBJECT,this.normal=O(),this.transformation=Pe(),this._ray=Xo(),this.init(t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Ss.OBJECT,H5(t,this._ray)}set(t,i,r,s,n,o,a){this.intersector=t,this.dist=r,le(this.normal,Ft(s,Jfe)),Ao(this.transformation,Ft(n,Hh)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){H5(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,le(this.normal,t.normal),Ao(this.transformation,t.transformation)}}class TX extends CC{constructor(){super(...arguments),this.intersector=Ss.HUD}}function ZQ(e){return new CC(e)}const vD=O(),tR=ui();function d2e(e,t,i,r){return v(e.renderCoordsHelper.fromRenderCoords(t.eye,Ak,r))&&Oye(i,Ak)}function _8(e,t){return e.elevationProvider?Ft(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function cS(e,t,i,r){const s=e.state.camera.clone();t&&i&&r&&(s.eye=t,s.center=i,s.up=r),hrt(e,s.ray,E_)||le(E_,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(Ta(s.eye,E_)<o){const a=n.collision.enabled;le(Lb,s.viewForward),ae(Lb,Lb,o),a?s.eye=me(Ak,E_,Lb):fe(E_,s.eye,Lb);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(me(Lb,E_,s.eye),s.eye=l.setAltitude(Ak,h,s.eye),fe(E_,s.eye,Lb))}return s.center=E_,s}function kle(e,t,i){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const r=_8(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,prt),o=n*n;return Ta(t,i)>o}function hrt(e,t,i){let r=Ule[e.viewingMode];r||(r=dp(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Ule[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||kle(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||kle(e,t.origin,i))||!!s&&drt(t,i,dr(e.spatialReference).radius)}function drt(e,t,i){const r=_e(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return ae(t,e.direction,s/Oe(e.direction)),fe(t,t,e.origin),!0}const Ule={},Ak=O(),E_=O(),Lb=O(),prt={near:0,far:0};function xM(e,t,i=Wd.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=_8(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Oe(t.eye);if(me(bD,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(frt,o,t.eye),i===Wd.EYE_AND_CENTER)t.center=fe(bD,t.eye,bD);else if(i===Wd.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=ae(bD,t.center,l)}return!0}var Wd;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Wd||(Wd={}));const bD=O(),frt=O();function sb(e,t,i){e.worldUpAtPosition(t,Vle),me(tz,i,t);const r=Oe(tz);return r===0?0:uo(_e(tz,Vle)/r)}const Vle=O(),tz=O();function p2e(e,t,i=rb,r=!0){iR.eyeCenterDistance=0,iR.requiresTwoSteps=!1;const s=JQ(e,t,i,void 0,iR);if(s===0)return!1;switch(jh(wD,-s,t.viewRight),i.tiltMode){case Jo.LOOK_AROUND:Ze(C_,t.viewForward,wD),ae(C_,C_,iR.eyeCenterDistance),t.center=fe(Kv,t.eye,C_);break;case Jo.TUMBLE:me(C_,t.center,t.eye),Ze(C_,C_,wD),t.eye=me(Kv,t.center,C_);break;default:i.tiltMode}return t.up=Ze(Kv,t.up,wD),!iR.requiresTwoSteps||!r||p2e(e,t,i,!1)}function JQ(e,t,i=rb,r=rb,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,Srt);return Trt(e,i,o),r.interactionType===hi.TUMBLE&&xP(r.selection,is.ALTITUDE)&&f2e(e,r.interactionStartCamera,o),i.tiltMode===Jo.LOOK_AROUND||r.tiltMode===Jo.LOOK_AROUND?grt(e,t,o,s):mrt(e,t,o)}function mrt(e,t,i){const r=sb(e.renderCoordsHelper,t.center,t.eye),s=r-ye(r,i.min,i.max);return TP(s)?s:0}function grt(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return _rt(e,t,i,r);case"local":return yrt(e,t,i,r)}}function yrt(e,t,i,r){const s=sb(e.renderCoordsHelper,t.center,t.eye),n=ye(s,i.min,i.max),o=s-n;if(!TP(o))return 0;if(r){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=t.distance}return o}function _rt(e,t,i,r){const s=vrt(e,t,Ert),n=ye(s.tiltAtCenter,i.min,i.max);if(!TP(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=brt(s),a=wrt(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=xrt(s,o)),r&&(r.eyeCenterDistance=SX(s,o)),a}function vrt(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+dr(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,Kv);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,v(n)?(i.eyeCenterDistance=Vr(t.eye,n),i.tiltAtCenter=sb(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=sb(e.renderCoordsHelper,t.center,t.eye):(mM(RU(OU,s),t.ray,Kv),i.eyeCenterDistance=Vr(t.eye,Kv),i.tiltAtCenter=uo(-_e(t.viewForward,be(Kv,Kv)))),i.radius=s,i.eyeRadius=Oe(t.eye),i.constraints=e.state.constraints,i}function TP(e){return Math.abs(e)>1e-9}function brt(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const o=SX(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&TP(n-s);){const l=(s+n)/2,c=SX(e,l);TP(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function SX(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-ye(t,0,Math.PI),r=tp(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function wrt(e,t){const i=tp(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=tp(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function xrt(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function Trt(e,t,i){if(t.interactionType===hi.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t;if(!r)return;const{min:n,max:o}=i,a=JQ(e,r,rb,t),l=a===0?0:sb(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===hi.TUMBLE?(xP(t.selection,is.ALTITUDE)&&f2e(e,r,i),Ck(a,l,!0,s,Ble,i)):Ck(a,l,!1,s,Ble,i)}function f2e(e,t,i){const r=e.state.constraints;if(e.state.isLocal||!r.altitude||!t)return;const s=ll(t.center),n=Math.sqrt(s),o=t.distance,a=dr(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-uo(p),i.max)),i.max=Math.min(i.max,Math.PI-uo(h))}const C_=O(),wD=Pe(),Kv=O(),Ble=Wt(5),Srt={min:0,max:0},Ert={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},iR={eyeCenterDistance:0,requiresTwoSteps:!1};function Crt(e){return e}const v8=e=>e*e,KQ=e=>1-v8(1-e),Art=e=>e<.5?v8(2*e)/2:(KQ(2*(e-.5))+1)/2,QQ=e=>e*e*e,m2e=e=>1-QQ(1-e),g2e=e=>e<.5?QQ(2*e)/2:(m2e(2*(e-.5))+1)/2,eee=e=>e*e*e*e,y2e=e=>1-eee(1-e),Mrt=e=>e<.5?eee(2*e)/2:(y2e(2*(e-.5))+1)/2,tee=e=>e*e*e*e*e,_2e=e=>1-tee(1-e),Rrt=e=>e<.5?tee(2*e)/2:(_2e(2*(e-.5))+1)/2,iee=e=>1-Math.cos(e*Math.PI/2),v2e=e=>1-iee(1-e),Ort=e=>e<.5?iee(2*e)/2:(v2e(2*(e-.5))+1)/2,ree=e=>2**(10*(e-1)),V$=e=>1-ree(1-e),Irt=e=>e<.5?ree(2*e)/2:(V$(2*(e-.5))+1)/2,see=e=>-(Math.sqrt(1-e*e)-1),b2e=e=>1-see(1-e),Prt=e=>e<.5?see(2*e)/2:(b2e(2*(e-.5))+1)/2;function gp(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function yp(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const $rt=yp(gp(1),1),Lrt=yp(gp(1),0),w2e=yp(gp(1),.5),Drt=yp(gp(2),1),Frt=yp(gp(2),0),Nrt=yp(gp(2),.5),krt=yp(gp(3),1),Urt=yp(gp(3),0),Vrt=yp(gp(3),.5),Brt=yp(gp(4),1),zrt=yp(gp(4),0),Grt=yp(gp(4),.5),jrt={linear:Crt,"in-quad":v8,"out-quad":KQ,"in-out-quad":Art,"in-coast-quad":$rt,"out-coast-quad":Lrt,"in-out-coast-quad":w2e,"in-cubic":QQ,"out-cubic":m2e,"in-out-cubic":g2e,"in-coast-cubic":Drt,"out-coast-cubic":Frt,"in-out-coast-cubic":Nrt,"in-quart":eee,"out-quart":y2e,"in-out-quart":Mrt,"in-coast-quart":krt,"out-coast-quart":Urt,"in-out-coast-quart":Vrt,"in-quint":tee,"out-quint":_2e,"in-out-quint":Rrt,"in-coast-quint":Brt,"out-coast-quint":zrt,"in-out-coast-quint":Grt,"in-sine":iee,"out-sine":v2e,"in-out-sine":Ort,"in-expo":ree,"out-expo":V$,"in-out-expo":Irt,"in-circ":see,"out-circ":b2e,"in-out-circ":Prt};function Sn(e,t,i=Xrt,r=t){r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);let s=!1;for(let a=0;a<Yrt;a++){let l=0;for(const c of Wrt)if(xP(i.selection,c.type)){const h=Math.abs(c.error(e,r,i));c.apply(e,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=xP(i.selection,is.COLLISION),o=Hrt(i.interactionType,e);return n&&xM(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function Hrt(e,t){switch(e){case hi.PAN:return Wd.EYE_AND_CENTER;case hi.ASCEND:return t.state.isGlobal?Wd.EYE_AND_CENTER_SCALE:Wd.EYE_AND_CENTER;default:return Wd.EYE}}function pf(e){const t=Math.min(1,e/150);return g2e(t)}function qrt(e,t,i){return JQ(e,t,i)*t.distance}const Wrt=[{type:is.TILT,error:qrt,apply:p2e},{type:is.ALTITUDE,error:WQ,apply:kit},{type:is.DISTANCE,error:XQ,apply:Wit}],Xrt={selection:is.ALL,interactionType:hi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Jo.TUMBLE},Yrt=5,zu=O(),jc=O(),A_=O(),Ka=O(),Db=O(),Zrt=O(),Gu={upward:Le(0,0,1),forward:Le(0,1,0),sideway:Le(1,0,0)},zle=Cs();class Gle{constructor(t=je.Global){this.viewingMode=t,this.center=O(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=js(Gu.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===je.Global){const n=(Oe(this.center)+Oe(t.center))/2;i.pan=e4(this.center,t.center)*n}else i.pan=Vr(this.center,t.center);let r=Math.abs(t.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(t,i,r){this.viewingMode===je.Global?xze(t.center,i.center,r.pan,this.center):On(this.center,t.center,i.center,r.pan),this.distance=isFinite(i.distance)?zt(t.distance,i.distance,r.zoom):t.distance,this.pitch=zt(t.pitch,i.pitch,r.rotate);let s=t.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=zt(s,n,r.rotate)}copyFrom(t){le(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,le(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,zle);le(this.center,t.center),me(Ka,t.center,t.eye),Eu(Ka,Ka,i),Eu(Db,t.up,i),this.distance=Oe(Ka),this.distance!==0&&(Ka[0]/=this.distance,Ka[1]/=this.distance,Ka[2]/=this.distance),this.pitch=this._eyeUpToPitch(Ka),this.yaw=this._eyeUpToYaw(Ka,Db),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,zle);up(i,i),this._axisAngleVec3(Gu.sideway,this.pitch-Math.PI/2,Gu.forward,Ka),this._axisAngleVec3(Gu.upward,this.yaw,Ka),this._axisAngleVec3(Gu.sideway,this.pitch-Math.PI/2,Gu.upward,Db),this._axisAngleVec3(Gu.upward,this.yaw,Db),ae(Ka,Ka,this.distance),Eu(Ka,Ka,i),Eu(Db,Db,i),t.center=this.center,t.eye=me(Ka,this.center,Ka),t.up=Db}_axisAngleVec3(t,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return ae(zu,r,n),_t(jc,t,r),ae(jc,jc,o),ae(A_,t,(1-n)*_e(t,r)),fe(s,fe(s,zu,jc),A_)}_lookAtOrientation(t,i=Cs()){return this._upAtLookAt(t,A_),_t(zu,this.lookAtDirection,A_),be(zu,zu),zu[0]===0&&zu[1]===0&&zu[2]===0&&le(zu,Gu.sideway),_t(jc,A_,zu),be(jc,jc),i[0]=zu[0],i[1]=jc[0],i[2]=A_[0],i[3]=zu[1],i[4]=jc[1],i[5]=A_[1],i[6]=zu[2],i[7]=jc[2],i[8]=A_[2],i}_upAtLookAt(t,i){return this.viewingMode===je.Local?le(i,Gu.upward):be(i,t)}_eyeUpToPitch(t){return Math.PI-e4(Gu.upward,t)}_eyeUpToYaw(t,i){const r=Zrt;return Math.abs(i[2])<.5?(le(r,i),t[2]>0&&ae(r,r,-1)):le(r,t),_t(jc,r,Gu.upward),be(jc,jc),e4(Gu.sideway,jc,Gu.upward)}}const Mk={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class nee{constructor(t){this._createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:Mk.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new nee(this._createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:Mk.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}let Jrt=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,t)=>e+t.time,0)}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,r=0;const s=this.definition;for(let n=0;n<this.segments.length;n++){const o=this.segments[n],a=o.definition;if(e<=o.time||n===this.segments.length-1){if(t=this.segmentInterpolateComponentsAt(o,o.time===0?0:e/o.time,t),s.hasPan&&!isNaN(t.pan)&&isFinite(s.compared.pan)?t.pan=(i+a.compared.pan*t.pan)/s.compared.pan:t.pan=1,s.hasRotate&&!isNaN(t.rotate)&&isFinite(s.compared.rotate)?t.rotate=(r+a.compared.rotate*t.rotate)/s.compared.rotate:t.rotate=1,s.hasZoom&&!isNaN(t.zoom)&&isFinite(a.compared.targetZoom)){const l=t.zoom*(a.compared.targetZoom-a.compared.sourceZoom)+a.compared.sourceZoom,c=this.segments[0].definition.compared.sourceZoom,h=this.segments[this.segments.length-1].definition.compared.targetZoom;t.zoom=(l-c)/(h-c)}else t.zoom=1;return t}e-=o.time,i+=a.compared.pan,r+=a.compared.rotate}}segmentInterpolateComponentsAt(e,t,i){return e.interpolateComponentsAt(t,i)}};class iz{get time(){return this._time}constructor(t){t&&this.update(t)}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);const n=(t.source.pixelsPerRotateAtZoom(r)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const r=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}}function Krt(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function Qrt(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function est(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function tst(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function ist(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function rst(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function sst(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function nst(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function ost(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function ast(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function lst(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function cst(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function ust(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function hst(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function dst(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function pst(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}function fst(e,t){let i=mst(e,t);const r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?tst:Krt,a=s?ist:Qrt,l=s?rst:est,c=n?ust:ast,h=n?hst:lst,p=n?dst:cst,f=E=>o(e,E,r)+sst(e,E,r)+c(e,E,r),m=E=>a(e,E,r)+nst(e,E,r)+h(e,E,r),y=E=>l(e,E,r)+ost(e,E,r)+p(e,E,r);let _=f(i);const b=pst(e);let w;const T=t.maximumIterations||20,S=t.maximumDistance!=null?t.maximumDistance:1/0;for(w=0;w<T;w++){const M=(m(i)+1e-6)/y(i);if(isNaN(M)||i>=S&&M<0){if(!isFinite(S))return null;i=S,_=f(i);break}if(i-=M,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const A=f(i);if(Math.abs(A-_)/_<=.005)break;_=A}return _>b*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function mst(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class gst extends Jrt{constructor(t,i){super(),this._preallocSegments=[new iz,new iz,new iz],this._ascensionSegment=null,this._descensionSegment=null,this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=null;i&&i.apex&&(r=fst(t,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i==null?void 0:i.apex)}segmentInterpolateComponentsAt(t,i,r){return r=t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=KQ(r.zoom):t===this._descensionSegment&&(r.zoom=v8(r.zoom)),r}_updateWithApex(t,i){var c;const[r,s,n]=this._preallocSegments,o=(c=i==null?void 0:i.ascensionFactor)!=null?c:.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const yst={zoom:0,pan:0,rotate:0};let _st=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new nee(e),this.path=new gst}update(e,t,i){this.definition.update(e,t,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Xme(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing?i.easing:this._time>=1e3?w2e:V$}cameraAt(e,t){t=t||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,yst);return t.interpolate(this.definition.source,this.definition.target,i),t}_normalizedEasing(e){const t=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(i-t)}_applyTimeSettings(e,t){const i=t.speedFactor!=null?t.speedFactor:1;t.duration!=null?e=t.duration:t.speedFactor!=null&&(e=e/i);const r=t.minDuration!=null?t.minDuration:Mk.minDuration/i,s=t.maxDuration!=null?t.maxDuration:Mk.maxDuration/i;return Math.min(Math.max(r,e),s)}};const vst=O();class bst{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(t){this.currentTime=0,this._animation=new _st(()=>new Gle(t)),this._current=new Gle(t)}update(t,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=me(vst,i.center,t.center),a=Oe(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),le(s.lookAtDirection,o),le(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new Ot,this._current.copyToRenderCamera(i),i}step(t,i){return this.finished||(this.currentTime=this.currentTime+Xme(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}}var Ps;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(Ps||(Ps={}));let i0=class extends Te{constructor(e){super(e),this.state=Ps.Ready}get active(){return this.state===Ps.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Ps.Stopped,!0)}finishController(){this.state=Ps.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],i0.prototype,"view",void 0),u([d({readOnly:!0})],i0.prototype,"active",null),u([d()],i0.prototype,"state",void 0),u([d({readOnly:!0})],i0.prototype,"isInteractive",null),i0=u([P("esri.views.3d.state.controllers.CameraController")],i0);let SP=class extends i0{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(lr()),this._asyncResult=null),this.state===Ps.Finished||this.state===Ps.Stopped?(XT(e),this.state===Ps.Finished?e.resolve():e.reject(lr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Ps.Running,v(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!v(this.viewAnimation)||this.state!==Ps.Ready&&this.state!==Ps.Running||(this.viewAnimation.state===yA.State.FINISHED?this.finish():this.viewAnimation.state===yA.State.STOPPED&&(this.state=Ps.Stopped))}onControllerEnd(){v(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Ps.Finished?this.viewAnimation.finish():this.state===Ps.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Ps.Finished?this._asyncResult.resolve():this._asyncResult.reject(lr()))}finish(){this.finishController()}};SP=u([P("esri.views.3d.state.controllers.AnimationController")],SP);let h0=class extends SP{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new bst(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new yA}get isInteractive(){return this.mode==="interaction"}begin(e,t){this._hasTarget=!0;const i=this.animationSettings(t);xD.copyFrom(this.view.state.camera);const r=dp(this.view.state.viewingMode);this.intersectionHelper.intersectRay(xD.ray,r,jle)&&(xD.center=jle),this.animation.update(xD,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?jrt[e.easing]:e.easing}}};u([d({constructOnly:!0})],h0.prototype,"mode",void 0),u([d({readOnly:!0})],h0.prototype,"isInteractive",null),h0=u([P("esri.views.3d.state.controllers.PointToPointAnimationController")],h0);const xD=new Ot,jle=O();function b8(e=xst){return[e[0],e[1],e[2],e[3]]}function EP(e,t){return wst(e[0],e[1],e[2],t,xK.get())}function wst(e,t,i,r,s=b8()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function oee(e,t,i){return _t(i,e,t),be(i,i),i[3]=EK(e,t),i}const xst=[0,0,1,0];function x2e(e,t,i){return Tst(e,e.screenToRender(t,Xe.get()),i)}function Tst(e,t,i){const r=Mo(Xe.get(),t);if(r[2]=0,!e.unprojectFromRenderScreen(r,i.origin))return null;const s=Mo(Xe.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,Xe.get());return C(n)?null:(me(i.direction,n,i.origin),i)}function TM(e,t,i){return aee(e,e.screenToRender(t,Xe.get()),i)}function aee(e,t,i){le(i.origin,e.eye);const r=ue(Xe.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(r,Xe.get());return C(s)?null:(me(i.direction,s,i.origin),i)}function lee(e,t,i,r){const s=TM(t,i,Sst);return gb(e,s,r)}const Sst=Xo();var $A;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})($A||($A={}));const T2e=30,Rk=[1,3e8],w8=80,S2e=8,E2e=200,C2e=1508e5,A2e=5,M2e=50,Est=5,Cst=10,rz=90,uS={exclude:new Set([Jv])};function Kx(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function EX(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function nb(e,t,i){const r=jh(TK.get(),i[3],i);C(r)||j_e(r,Hh)||(me(Tr,e.eye,t),Ze(Tr,Tr,r),e.eye=fe(Tr,Tr,t),me(Tr,e.center,t),Ze(Tr,Tr,r),e.center=fe(Tr,Tr,t),e.up=Ze(Tr,e.up,r))}function Ast(e,t,i,r){return nS(e,x2e(t,i,hee),r)}function CX(e,t,i,r){return nS(e,TM(t,i,hee),r)}function cee(e,t,i,r){const s=Xe.get();let n=1-i;me(s,t,e.eye);const o=Oe(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ae(s,s,n),e.eye=fe(Tr,e.eye,s),e.center=On(Tr,e.center,t,n))}function R2e(e,t,i){t.getScreenCenter(Hle),lee(e,t,Hle,Tr)&&(t.center=Tr);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=ae(Xe.get(),t.viewForward,s);t.eye=me(Tr,t.center,n)}const Hle=$s();function sz(e,t){ue(t,0,0,0);for(const i of e)fe(t,t,i);ae(t,t,1/e.length)}function S4(e,t,i,r){return Math.sin(e/Oe(t))*(i+r.radius)}function qle(e,t,i,r){return S4(Math.PI/2,t,i,r)+(e-Math.PI/2)}var Yo;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(Yo||(Yo={}));const Wle={Elevation:3e4,Angle:Wt(16)},TD={Pole:.95,Angle:Wt(18),Tilt:45},O2e=Wt(80);function I2e(e,t,i,r,s,n){const o=O(),a=Gn();let l=!0,c=!0;return e.intersectScreen(i,o,n)?a[3]=Oe(o):(c=!1,t.aboveGround&&s!==$A.Ellipsoid?a[3]=Math.max(Oe(t.center),.9*r.radius):a[3]=Oe(t.eye)-t.relativeElevation,s===$A.Silhouette?CP(a,t,i,o):l=lee(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function x8(e,t,i){return Oe(e.eye)-i.radius>Wle.Elevation?Yo.Horizontal:(TM(e,t,tce),-Math.sign(e.relativeElevation)*(.5*Math.PI+EK(e.eye,tce.direction))<Wle.Angle?Yo.Vertical:Yo.Horizontal)}function P2e(e,t,i){me(nz,i,t),e.eye=me(Tr,e.eye,nz),e.center=me(Tr,e.center,nz)}const nz=O();function CP(e,t,i,r){const s=TM(t,i,hee);return!C(s)&&(mM(e,s,SD),gb(e,s,r)?!(Ta(SD,s.origin)<Ta(r,s.origin))||(le(r,SD),!1):(me($S,t.eye,t.center),be($S,$S),Abe($S,-_e(be($S,$S),SD),Xle),nS(Xle,s,r),!1))}const SD=O(),$S=O(),Xle=nr();function $2e(e,t,i,r,s,n){let o=0;if(_t(Pk,e,t),me(MD,e,t),Oe(e)<=s||!r.aboveGround){_t(i,MD,r.eye);const a=_e(e,t)/(Oe(e)*Oe(t));if(a<.9999)o=uo(a);else{const c=Oe(_t(O(),e,t))/(Oe(e)*Oe(t));o=tp(c)}const l=Math.cos(ye(Z1.normalize(Wt(n)),0,O2e));o=-o-Math.max(0,Oe(t)-s)/(l*s)}else me(Yle,r.eye,r.center),_t(i,MD,Yle),o=-Oe(MD)/s;return be(i,i),ae(i,i,Oe(Pk)),o}const Yle=O();function Zle(e,t,i,r){let s,n;const o=Math.cos(ye(Z1.normalize(Wt(r)),0,O2e));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):uo(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):uo(e/i),(n-s)*i}function Mst(e,t,i,r,s,n,o,a,l,c){const h=Zle(e[2],t[2],n[3],a),p=l?Zle(e[0],t[0],n[3],180):t[0]-e[0],f=Math.sin(o)*p-Math.cos(o)*h,m=Math.cos(o)*p+Math.sin(o)*h;be(Tr,s);const y=l?f/Math.sqrt(Math.abs(n[3]**2-_e(i,Tr)**2)):f/n[3],_=m/Math.sqrt(Math.abs(n[3]**2-_e(i,r)**2));di(c,y,_)}function L2e(e,t,i,r,s,n,o,a,l,c){_t(Pk,e,t),wW(n.up,n.eye,ED,CD,AD),wW([0,0,1],n.eye,b0,D1,k2e),le(i,D1),le(r,b0),be(i,i),ae(i,i,Oe(Pk)),bne(e,be(CD,CD),be(AD,AD),be(ED,ED),Jle),bne(t,CD,AD,ED,Kle),Mst(Jle,Kle,e,b0,D1,o,a,l,c,s)}function Rst(e,t,i,r,s,n,o){jh(Ok,s,r),jh(Ik,o,n),Hs(GE,Ok,Ik),me(t,e,i),Ze(t,t,GE),fe(t,t,i)}function D2e(e,t,i,r,s,n){jh(Ok,r,i),jh(Ik,n,s),Hs(GE,Ok,Ik),me(Tr,e.eye,t),Ze(Tr,Tr,GE),e.eye=fe(Tr,Tr,t),me(Tr,e.center,t),Ze(Tr,Tr,GE),e.center=fe(Tr,Tr,t),me(Tr,e.up,t),Ze(Tr,Tr,GE),e.up=fe(Tr,Tr,t)}function uee(e,t,i,r,s,n){return(Math.abs(r)>Math.PI-TD.Angle||Math.abs(r)<TD.Angle)&&(Math.abs(e[2])<i*TD.Pole||Math.abs(t)>i)&&n.aboveGround&&s<TD.Tilt}function F2e(e,t,i,r,s,n){if(n)oee(i,r,Qle),nb(t,e,Qle);else{const o=$2e(i,r,ece,t,e[3],s);nb(t,e,EP(ece,o))}}function N2e(e,t,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;le(Fb,r),RD.copyFrom(t);for(let p=0;p<a&&Ta(i,Fb)>l&&(c=Ta(i,Fb),L2e(i,Fb,D1,b0,rR,RD,e,s,n,o),D2e(RD,e,b0,rR[1],D1,rR[0]),Rst(Fb,Fb,e,b0,rR[1],D1,rR[0]),h=Ta(i,Fb),h<c||p===0);p++)t.copyFrom(RD)}function Ost(e,t,i,r,s,n,o){uee(i,_e(t.up,i),e[3],-Z1.normalize(Wt(s)),n,t)?N2e(e,t,i,r,-Z1.normalize(Wt(s)),n,o):F2e(e,t,i,r,n,o)}function Ist(e,t,i,r,s,n){const{eye:o}=e;wW([0,0,1],o,b0,D1,k2e);const a=t.translation[0]*i.pan,l=s.mode==="zoom"?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-_e(e.center,b0)**2/Oe(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(Cu(r.pan.matrix,r.pan.matrix,h,b0),r.pan.enabled=!0,s.mode){case"pan":Cu(r.pan.matrix,r.pan.matrix,p,D1),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function Pst(e,t,i,r,s){const{eye:n,viewRight:o}=e,a=_t(Xe.get(),o,n),l=t.translation[0]*i.pan;switch(l!==0&&(Cu(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*i.pan;c!==0&&(Cu(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function $st(e,t,i,r,s,n,o,a,l){uee(e.center,_e(e.up,e.center),Oe(e.center),-Z1.normalize(Wt(n)),o,t)?Ist(t,i,r,a,l,-Z1.normalize(Wt(s))):Pst(t,i,r,a,l)}const b0=O(),D1=O(),k2e=O(),ED=O(),CD=O(),AD=O(),Jle=O(),Kle=O(),rR=tt(),Qle=b8(),Ok=Pe(),Ik=Pe(),GE=Pe(),Fb=O(),Tr=O(),MD=O(),RD=new Ot,Pk=O(),ece=O(),hee={origin:O(),direction:O()},tce={origin:O(),direction:O()},ice=.6,oz=4,Lst=60;let $k=class extends h0{constructor(){super(...arguments),this._zoomLocation=O(),this._tmpCamera=new Ot,this._tmpViewDir=O(),this._tmpRayDir={origin:O(),direction:O()},this._targetOnSphere=O(),this._tmpCenter=O(),this._constraintOptions={selection:is.ALL_EXCEPT_COLLISION,interactionType:hi.ZOOM,interactionFactor:null,interactionStartCamera:new Ot,interactionDirection:null,tiltMode:Jo.TUMBLE},this._sphere=Gn()}initialize(){this._intersector=dp(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this._constraintOptions;r&&(this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r));let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this._zoomLocation,this.view.map.ground.opacity===0?uS:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:le(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,t,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:V$}}_updateCamera(e,t,i,r,s){const n=dr(this.view.spatialReference),o=x8(e,r,n),a=Math.abs(this.view.camera.position.z);be(ID,e.eye),ae(ID,ID,-1),TM(e,r,this._tmpRayDir),be(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=ye(Math.min(S2e,1/Math.abs(_e(ID,this._tmpRayDir.direction)))*a,E2e,C2e);if(o===Yo.Horizontal){let c=ice**t;this._sphere[3]=Oe(i),me(this._tmpViewDir,e.center,e.eye);const h=Math.min(Oe(this._tmpViewDir),l);let p=h*c;if(c<=1&&p<oz&&(p=oz,c=p/h),Math.abs(h-p)<1e-6)return;const f=Oe(e.center);if(this._sphere[3]!==f){const m=this._sphere[3]+c*(f-this._sphere[3]);e.center=ae(OD,e.center,m/f)}ae(this._tmpViewDir,this._tmpViewDir,-c),e.eye=fe(OD,e.center,this._tmpViewDir),Sn(this.view,e,this._constraintOptions),Ta(i,e.center)>1e-12&&lee(this._sphere,e,r,this._targetOnSphere)&&Ost(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=ice**Math.abs(t);const h=t>0?1:-1;me(this._tmpViewDir,i,e.eye);const p=Oe(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,Lst);let m=v(f)?f:l;m=s&&t>0?Math.min(m,p):m,ae(this._tmpRayDir.direction,this._tmpRayDir.direction,m),fe(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let y=m*c;const _=Math.max(oz,1.01*e.nearFar[0]);if(t>0&&y<_&&(y=_,c=y/m),Math.abs(m-y)<1e-6)return;ae(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-c)),e.eye=fe(OD,e.eye,this._tmpRayDir.direction),e.center=fe(OD,e.center,this._tmpRayDir.direction)}xM(this.view,e)}};$k=u([P("esri.views.3d.state.controllers.global.ZoomStepController")],$k);const OD=O(),ID=O(),Dst=.6,Fst=4,Nst=60;let Lk=class extends h0{constructor(){super(...arguments),this._zoomLocation=O(),this._tmpCamera=new Ot,this._tmpRayDir=O(),this._tmpCenter=O(),this._constraintOptions={selection:is.ALL,interactionType:hi.ZOOM,interactionFactor:null,interactionStartCamera:new Ot,interactionDirection:null,tiltMode:Jo.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this._constraintOptions;r&&(this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r)),this._tmpCamera.copyFrom(i.camera);const s=dp(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,this.view.map.ground.opacity===0?uS:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:le(this._zoomLocation,this._tmpCamera.center);const o=Dst**e;let a=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,Nst);me(PD,this._tmpCamera.eye,this._zoomLocation),be(PD,PD);const l=ye(Math.min(S2e,1/Math.abs(_e(kst,PD)))*Math.abs(this.view.camera.position.z),E2e,C2e);if(a=v(a)?a:l,a){const c=O();me(c,this._zoomLocation,this._tmpCamera.eye),(a<Oe(c)||!n)&&(be(c,c),fe(this._zoomLocation,this._tmpCamera.eye,ae(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:V$}}_updateCamera(e,t,i){me(this._tmpRayDir,i,e.eye);const r=Oe(this._tmpRayDir);let s=r*t;const n=t<=1,o=Math.max(Fst,1.01*e.nearFar[0]);s!==0&&(n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||(ae(this._tmpRayDir,this._tmpRayDir,t),e.eye=me(rce,i,this._tmpRayDir),e.center=On(rce,e.center,i,1-t),Sn(this.view,e,this._constraintOptions)))}};Lk=u([P("esri.views.3d.state.controllers.local.ZoomStepController")],Lk);const rce=O(),kst=Le(0,0,1),PD=O();function Ust(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function dee(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class Vst extends Oa{constructor(t,i){super(!0),this._view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){const i=t.data;if(Ust(i,"primary")){const r=this._view.state.isGlobal?new $k({view:this._view,mode:"animation"}):new Lk({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),$s(i.x,i.y)),t.stopPropagation()}}}function Bst(e,t,i){return e===je.Global?new Gst(i):new zst(t,i)}class zst{constructor(t,i){this._elevationProvider=t,this._referenceEllipsoid=dr(i),this._unitInMeters=wl(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){var S;n||(n={near:0,far:0});let o=t[2]*this._unitInMeters;const a=o,l=o-s,c=(S=this._elevationProvider)==null?void 0:S.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(r=v(r)?r:new Gi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);me(Nb,i,t),LS[0]=Nb[0]>0?r.xmax:r.xmin,LS[1]=Nb[1]>0?r.ymax:r.ymin,LS[2]=Nb[2]>0?p/2:-p/2,me(LS,LS,t),be(Nb,Nb);const f=1.1*_e(LS,Nb)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),_=y*qst*this._unitInMeters,b=y*Wst*this._unitInMeters,w=ye((o-b)/(_-b),0,1)**3,T=Math.min(zt(m,f,w),m)*Math.max(Math.log(Math.abs(l)),1);return U2e(Math.min(T,Math.max(34064e4,p))/this._unitInMeters,jst,this._unitInMeters,n)}}class Gst{constructor(t){this._referenceEllipsoid=dr(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});const o=Oe(t),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return U2e(1.2*zt(p,f,gQ(h)),ye(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function U2e(e,t,i,r){const s=Hst/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const jst=2e4,Hst=2,qst=.001,Wst=1e-4,LS=O(),Nb=O();let E4=class extends Te{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;v(e.spatialReference)&&d2e(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>xM(this.view,e,Wd.EYE_AND_CENTER))}};u([d({constructOnly:!0})],E4.prototype,"view",void 0),E4=u([P("esri.views.3d.state.ElevationCollisionConstraint")],E4);let QO=class extends Te{constructor(e){super(e),this.nearFarHeuristic=Bst(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([te(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(r=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:r.far]},()=>this._clipDistanceNearFarChanged()),te(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),te(()=>this.view.renderDataExtent,()=>this._updateNearFar(),hr),te(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(r=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:r.max]},()=>this._updateAltitude(),hr),te(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),hr),te(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),hr),te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),hr),te(()=>{var e,t,i,r,s,n;return[(i=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:i.type,(n=(s=(r=this.view.state)==null?void 0:r.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),hr)]),this.view.state.isLocal&&this.addHandles(te(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),st)),this._updateNearFar(),this.view.state.viewingMode!==je.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new E4({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,_8(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var r,s,n;const e=(n=(s=(r=this.view.map)==null?void 0:r.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(is.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==je.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Wt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Zl(i))}}_updateLocalSurfaceDistance(e){if(C(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.zmax!=null&&e.zmin!=null&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=is.ALL){this.view.state.updateCamera(t=>Sn(this.view,t,{selection:e,interactionType:hi.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Jo.TUMBLE}))}};u([d({constructOnly:!0})],QO.prototype,"view",void 0),u([d({readOnly:!0})],QO.prototype,"surfaceCollisionConstraint",void 0),QO=u([P("esri.views.3d.state.ConstraintsManager")],QO);class Qv{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(t){this.renderCoordsHelper=t,this.frustum=cP(),this._points=LSe(),this.lines=new Array(12),this._origin=O(),this._direction=O(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:O(),endpoint:null}}update(t){DSe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),le(this._origin,t.eye),le(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let i=0;i<this._points.length;i++)le(this._points[i],t[i]);FSe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return v1(this.frustum,t)}intersectsRay(t){return BQe(this.frustum,t)}intersectsLineSegment(t,i){return zQe(this.frustum,t,i)}intersectsPoint(t){return NSe(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const r=i+4;az(this.lines[i],t[i],t[r]),az(this.lines[i+4],t[i],i===3?t[0]:t[i+1]),az(this.lines[i+8],t[r],i===3?t[4]:t[r+1])}}}function az(e,t,i){e.origin=t,e.endpoint=i,z0(e.direction,t,i)}Qv.planePointIndices=GQe,Qv.nearFarLineIndices=[[ct.NEAR_BOTTOM_LEFT,ct.FAR_BOTTOM_LEFT],[ct.NEAR_BOTTOM_RIGHT,ct.FAR_BOTTOM_RIGHT],[ct.NEAR_TOP_RIGHT,ct.FAR_TOP_RIGHT],[ct.NEAR_TOP_LEFT,ct.FAR_TOP_LEFT]];let X3=class extends i0{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e),this._handles=new Ii}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Ps.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){v(e.spatialReference)&&!d2e(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),xM(this.view,e,Wd.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Ps.Stopped)})}};u([d({constructOnly:!0})],X3.prototype,"desiredCamera",null),X3=u([P("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],X3);const Xst=O(),$D=O();function pee(){return{direction:O(),up:O()}}function V2e(e,t,i,r,s){let n=be(Xst,e),o=_e(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(_e(t,r)),o<.99?(le(n,t),a&&ae(n,n,-1)):n=null);let l=0;if(n){ae($D,r,_e(r,n)),me(n,n,$D);const h=_e(n,s)/(Oe(n)*Oe(s));_t($D,n,s),l=(_e($D,r)>0?1:-1)*Zl(uo(h))}const c=Zl(uo(-_e(r,e)/Oe(e)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const B2e=Le(0,1,0),z2e=Le(0,0,1),sR=Pe(),iy=O(),ry=O();function G2e(e,t,i,r=pee()){const{direction:s,up:n}=r;return N_e(sR,-Wt(t)),rA(sR,sR,Wt(i)),Ze(s,z2e,sR),ae(s,s,-1),Ze(n,B2e,sR),r}function Yst(e,t,i,r){return V2e(t,i,r,z2e,B2e)}function Zst(e,t,i,r){const s=G2e(e,i,r),n=O();return ae(n,s.direction,-t),fe(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}}function Jst(e){return Zl(e)}function Kst(e){return Wt(e)}function j2e(e,t,i,r,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return Xa(t,iy,n),Xa(t,ry,n),iy[0]-=i/2,ry[0]+=i/2,iy[1]-=r/2,ry[1]+=r/2,Zo(iy,n,iy,o),Zo(ry,n,ry,o),s?(s.xmin=iy[0],s.ymin=iy[1],s.xmax=ry[0],s.ymax=ry[1],s.spatialReference=o):s=new Gi(iy[0],iy[1],ry[0],ry[1],o),s}const Qst=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Yst,eyeForCenterWithHeadingTilt:Zst,eyeTiltToLookAtTilt:Kst,headingTiltToDirectionUp:G2e,lookAtTiltToEyeTilt:Jst,toExtent:j2e},Symbol.toStringTag,{value:"Module"})),H2e=Le(0,0,1),q2e=be(O(),Le(1,1,1)),ent=new Y1(-180,180),nR=Pe(),Gv=O(),DS=O();function W2e(e,t,i,r=pee()){_t(Gv,e,H2e),_e(Gv,Gv)===0&&_t(Gv,e,q2e),jh(nR,-Wt(t),e),Cu(nR,nR,-Wt(i),Gv);const{up:s,direction:n}=r;return _t(s,Gv,e),be(s,s),Ze(s,s,nR),be(n,e),pl(n,n),Ze(n,n,nR),r}function tnt(e,t,i,r){const s=Gv,n=DS;return be(s,e),_t(DS,s,H2e),_e(DS,DS)===0&&_t(DS,s,q2e),_t(n,DS,s),V2e(t,i,r,s,n)}function int(e,t,i,r){const s={eye:O(),up:null,tilt:r,heading:i},n=Gv;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Wt(i),l=Wt(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Oe(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const q=m/p,L=tp(o/q),N=Math.PI-l-L;y=q*Math.sin(N)}const _=f*o,b=o*o*(p*p),w=h*h*b,T=y-_,S=T*T,E=w*(w+S-n[1]*n[1]);if(E<0)return ae(s.eye,n,y/m),s.tilt=0,LD(s,e);const M=Math.sqrt(E),A=n[1]*T,$=w+S;let I;if(I=h>0?-M+A:M+A,Math.abs($)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ae(s.eye,n,y/m),s.tilt=0,lz(s.eye),LD(s,e);s.eye[1]=I/$;const k=c*c*b,V=p*o,B=h*V*s.eye[1],G=s.eye[1]*s.eye[1],X=1-G,K=Math.sqrt(X),re=w*G+k-2*B*K*T+X*S;return Math.abs(re)<1e-8?(ae(s.eye,n,y/m),s.tilt=0,lz(s.eye),LD(s,e)):(s.eye[0]=(X*(y*n[0]-_*n[0])-V*K*(n[0]*s.eye[1]*h+n[2]*c))/re,s.eye[2]=(X*(y*n[2]-_*n[2])-V*K*(n[2]*s.eye[1]*h-n[0]*c))/re,ae(s.eye,s.eye,y),lz(s.eye),LD(s,e))}function lz(e){const t=e[1];e[1]=-e[2],e[2]=t}function LD(e,t){const i=W2e(t,e.heading,e.tilt);return e.up=i.up,e}function rnt(e,t,i){const r=Oe(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=tp(i/(s/Math.sin(e)));return Zl(e-n)}function snt(e,t,i){const r=Wt(e),s=Oe(t);return tp(i/(s/Math.sin(r)))+r}function X2e(e,t,i,r,s){let n,o,a,l;const c=t.latitude,h=dr(e.spatialReference).radius,p=t.longitude,f=fit(c,i,h)/2;n=p-f,o=p+f;const m=Wt(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(r/h/2),b=_*_;function w(S){const E=Math.PI/2;return(S=YBe.normalize(S,-E))>E&&(S=Math.PI-S),S}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+b))),l=a+r/h,a=w(a),l=w(l),l<a){const S=l;l=a,a=S}if(a=Math.max(Zl(a),-90),l=Math.min(Zl(l),90),o=ent.monotonic(n,o),o-n>180){const S=(o-n-180)/2;n+=S,o-=S}const T=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:et.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=T):s=new Gi(n,a,o,l,T),e.spatialReference&&e.spatialReference.isWebMercator&&dg(s,!1,s),s}const nnt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:tnt,eyeForCenterWithHeadingTilt:int,eyeTiltToLookAtTilt:snt,headingTiltToDirectionUp:W2e,lookAtTiltToEyeTilt:rnt,toExtent:X2e},Symbol.toStringTag,{value:"Module"}));function Dk(e){return e.type==="point"}class Y2e{constructor(t,i=null,r=0){this.array=t,this.spatialReference=i,this.offset=r}}function Z2e(e){return"array"in e}function ag(e,t,i="ground"){if(Dk(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(Z2e(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,Ft(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}function AP(e,t){return e!=null&&(t==null||(t===je.Local?!e.isGeographic||e.isWGS84||e.wkid===Gd.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===Gd.CGCS2000||e.wkid===Gd.GCSMARS2000||e.wkid===Gd.GCSMARS2000_SPHERE||e.wkid===Gd.GCSMOON2000))}const J2e=se.getLogger("esri.views.3d.support.cameraUtils"),K2e=39.37,Q2e=96,AX=1,ont=8,ant=5,eEe=1,sce=O(),lnt={heading:0,tilt:0},e1=new ut,cnt=new Y1(-20037508342788905e-9,20037508342788905e-9),unt=new Y1(-180,180);var Ha;function B$(e){return e.spatialReference||et.WGS84}function SM(e){return e.viewingMode==="global"?nnt:Qst}function hnt(e,t,i,r,s){return SM(e).headingTiltToDirectionUp(t,i,r,s)}function Jy(e,t){if(C(t))return null;const i=e.renderSpatialReference,r=SM(e).headingTiltToDirectionUp,s=O();if(!Xa(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);ae(n.direction,n.direction,e.state.camera.distance),fe(n.direction,n.direction,s);const o=cS(e,s,n.direction,n.up);return o.fov=Wt(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(Ha||(Ha={}));const FS=O();function LA(e,t,i){const r=e.renderSpatialReference,s=T8(e,t.eye,t.viewForward,t.up,lnt);let n=B$(e);return Zo(t.eye,r,FS,n)||(n=et.WGS84,Zo(t.eye,r,FS,n)),C(i)?new op(new ut(FS,n),s.heading,s.tilt,Zl(t.fov)):(i.position.x=FS[0],i.position.y=FS[1],i.position.z=FS[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Zl(t.fov),i)}function fee(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===je.Global&&i!=null&&(t*=Math.cos(Wt(i))),t/=e.renderCoordsHelper.unitInMeters,s/(Q2e*K2e/t)/Math.tan(r.fovX/2)}function UT(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=Q2e*K2e/(n/s);return e.renderCoordsHelper.viewingMode===je.Global&&i!=null&&(o/=Math.cos(Wt(i))),o*=e.renderCoordsHelper.unitInMeters,o}function tEe(e,t,i,r,s,n){return iEe(e,t,fee(e,i,t.latitude),r,s,n)}function iEe(e,t,i,r,s,n){if(Qx(n)){const a=new EM(n.signal);return MP(e,r.heading,r.tilt,t,i,s,a),void a.resolver.promise.then(l=>{const c=Nk(e,l,r.fov);if(!C(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=MP(e,r.heading,r.tilt,t,i,s);return Nk(e,o,r.fov,n)}function T8(e,t,i,r,s){return SM(e).directionToHeadingTilt(t,i,r,s)}function dnt(e,t){var i;return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,e1,e.spatialReference)&&e.elevationProvider&&Ft(ag(e.elevationProvider,e1),0)>((i=e1.z)!=null?i:0)-eEe)}async function pnt(e,t,i){var n;if(!e.renderCoordsHelper.fromRenderCoords(t,e1,e.spatialReference)||!e.elevationProvider)return!1;const r=(n=e1.z)!=null?n:0,s=await e.elevationProvider.queryElevation(e1.x,e1.y,r,e1.spatialReference,"ground",i);return Ft(s,0)>r-eEe}async function fnt(e,t,i){var s;const r=O();if(t)if(t instanceof ut){if(Xa(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null&&e.elevationProvider!=null){const n=await e.elevationProvider.queryElevation(t.x,t.y,(s=t.z)!=null?s:0,t.spatialReference,"ground",i);return v(n)&&e.renderCoordsHelper.setAltitude(r,n),r}}else le(r,t);else le(r,e.state.camera.center);return r}function mnt(e,t){const i=O();if(t&&t instanceof ut){if(Xa(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null&&e.elevationProvider!=null){const r=ag(e.elevationProvider,t);v(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else le(i,t||e.state.camera.center);return i}function MP(e,t,i,r,s,n,o){const a=r&&r instanceof ut?r:null;if(Qx(o))return fnt(e,r,o.signal).then(c=>{MX(e,t,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=mnt(e,r);return MX(e,t,i,a,l,s,n,o)}function MX(e,t,i,r,s,n,o,a){if(C(r)){const p=e.renderSpatialReference;if(r=W1(s,p,B$(e)),C(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=_nt(e,t,i,s,n,o),c=(0,SM(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===Ha.ADJUST&&e.viewingMode==="global"&&i>0){const p=()=>{const m=rEe(e,s,n,bnt(e,n,i,s));return o=i-m<1?Ha.LOCKED:Ha.ADJUST,MX(e,t,m,r,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(dnt(e,c.eye))return p();if(Qx(a))return pnt(e,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:js(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||Qx(a)?{center:O(),eye:O(),up:O(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=js(s),h.heading=c.heading,h.tilt=c.tilt,Qx(a)&&a.resolver.resolve(h),h}function Y3(e,t,i,r,s,n=null){let o,a,l;if(e.state.isGlobal){if(!AP(t.spatialReference,je.Global))return Qx(n)&&n.resolver.reject(),null;const b=new ut(t.xmin,t.ymin,t.spatialReference),w=new ut(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?unt:cnt;o=new ut({x:T.center(b.x,w.x),y:(w.y+b.y)/2,z:t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});const S=dr(t.spatialReference),E=pit(o,b,w);a=E.lon,l=E.lat,T.diff(b.x,w.x)>T.range/2&&(a+=S.halfCircumference),a=Math.min(a,S.halfCircumference),l=Math.min(l,S.halfCircumference)}else{const b=Ft(e.renderSpatialReference,t.spatialReference);b.equals(t.spatialReference)||(t=fM(t,b)),a=t.xmax-t.xmin,l=t.ymax-t.ymin;const w=t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0;o=new ut({x:t.xmin+.5*a,y:t.ymin+.5*l,z:w,spatialReference:b})}const c=t.zmax!=null&&t.zmin!=null?t.zmax-t.zmin:0,h=e.state.camera,p=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),y=Math.max(.5*a*p,.5*l*f,.5*c*m)/AX;if(Qx(n)){const b=new EM(n.signal);return MP(e,i,r,o,y,s,b),void b.resolver.promise.then(w=>{const T=Nk(e,w,e.camera.fov);if(!C(T))return n.resolver.resolve(T);n.resolver.reject()},w=>n.resolver.reject(w))}const _=MP(e,i,r,o,y,s);return Nk(e,_,e.camera.fov,n)}function gnt(e,t,i){const r=e.renderSpatialReference,s=W1(i,r,B$(e));if(C(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=t$(t.eye,i),l=2*a*n*AX,c=2*a*o*AX;return e.viewingMode==="global"?X2e(e,s,l,c):j2e(e,s,l,c)}function ynt(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>ont)return!0;const s=e.renderSpatialReference,n=B$(e),o=W1(t,s,n),a=W1(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(C(o)||C(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return a.distance(o)/l>ant}function _nt(e,t,i,r,s,n){let o=0;return n===Ha.ADJUST&&ynt(e,r,s)?(t=0,o=vnt(e,s,i,r)):o=mee(e,r,s,i),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:i=rEe(e,r,s,o)}}const Fk=.7;function vnt(e,t,i,r){const s=mee(e,r,t,i);if(!e.state.constraints.tilt)return s;const n=e.state.constraints.tilt(t);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-Fk)+n.max*Fk;return Math.min(s,o)}function bnt(e,t,i,r){let s=mee(e,r,t,i);if(!e.state.constraints.tilt)return s;const n=e.state.constraints.tilt(t);return s=Math.min(s,.5*Math.PI),n.min*(1-Fk)+s*Fk}function rEe(e,t,i,r){return SM(e).lookAtTiltToEyeTilt(r,t,i)}function mee(e,t,i,r){return SM(e).eyeTiltToLookAtTilt(r,t,i)}function Nk(e,t,i,r){if(C(t))return null;const s=e.renderSpatialReference,n=W1(t.eye,s,B$(e));return C(n)?null:v(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new op(n,t.heading,t.tilt,i)}function wnt(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(t);J2e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function sEe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(t);J2e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function nEe(e,t){return Zo(t.center,e.renderSpatialReference,sce,et.WGS84),UT(e,t.distance,sce[1])}class EM{constructor(t){this.signal=t,this.resolver=B1()}}function Qx(e){return e&&"resolver"in e}const xnt=.66;function oEe(e){return 360-bK.normalize(e)}function S8(e){return bK.normalize(360-e)}function oR(e){return v(e)&&e.resolver&&e.resolver.reject(),null}function Tnt(e,t){return v(e)&&e.resolver&&e.resolver.resolve(t),t}function aEe(e,t,i,r=null){if(!t)return oR(r);const s=e.spatialReference||et.WGS84;if(v(t.camera)){const c=YT(t.camera.position,s);if(C(c))return oR(r);const h=t.camera.clone();return h.position=c,Tnt(r,h)}if(C(t.targetGeometry))return oR(r);const n=t.get("targetGeometry.spatialReference");if(n&&!C1(n,s))return oR(r);const o=LA(e,e.state.camera);let a=Ha.ADJUST;if(t.rotation!=null&&(o.heading=oEe(t.rotation),a=Ha.LOCKED),i!=null&&(o.tilt=i),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?fee(e,t.scale,c.latitude):e.state.camera.distance,iEe(e,p,h,o,a,r)}const l=t.targetGeometry.extent;return l?Y3(e,l,o.heading,o.tilt,a,r):oR(r)}function Snt(e,t,i=null){return C(i)&&(i=new ap),_ee(e,null,t.clone(),i)}async function Ent(e,t,i){const r=Dnt(e,t);if(!r)throw new H("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new op({fov:e.camera.fov}),n=new ap({camera:s});if(r.target instanceof ap)return kb(await Mnt(e,r.target,r,i,n));if(r.target instanceof op)return kb(cEe(e,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof Gi){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return kb(o||c?await RX(e,r,r.target.center,s,i,n):await Pnt(e,r,r.target,s,i,n))}const a={boundingBox:Xr(),hasZ:!1,screenSpaceObjects:[]},l=o?Cnt(e,r):void 0;if(await lEe(e,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(yf(a.boundingBox,Tn),vh.x=Tn[0],vh.y=Tn[1],vh.z=Tn[2],vh.spatialReference=e.spatialReference,isFinite(vh.z)&&a.hasZ?c=eJ(a.boundingBox):(vh.z=void 0,c=kDe(QZ(a.boundingBox,Nnt))),o||c)return kb(await RX(e,r,vh,s,i,n));const h=Fnt(e,a.screenSpaceObjects);return kb(await Lnt(e,r,vh,a.boundingBox,h,s,i,n))}return r.position?kb(Ont(e,r,s,n)):kb(await Int(e,r,s,i,n))}function gee(e,t){return t.scale==null&&t.zoom!=null?sEe(e,t.zoom):t.scale}function Cnt(e,t){const i=gee(e,t);return i?o7e(i):void 0}function yee(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=oEe(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function _ee(e,t,i,r){const s=e.spatialReference||et.WGS84;return t=v(t)?t:Jy(e,i),C(t)||(r.targetGeometry=W1(t.center,e.renderSpatialReference,s),r.scale=nEe(e,t),r.rotation=S8(i.heading),r.camera=i),r}function kk(e,t,i){var a,l;const r=()=>new H("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!t)throw r();if(!C1(t.spatialReference,e.spatialReference))throw new H("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=e.spatialReference)==null?void 0:a.wkid})`,{geometry:t});const s=[];if(!t.hasZ&&e.basemapTerrain){let c;switch(t.type){case"point":c=t;break;case"multipoint":case"polyline":c=(l=t.extent)==null?void 0:l.center;break;case"mesh":c=t.origin;break;case"extent":c=t.center;break;case"polygon":c=t.centroid}c&&v(e.basemapTerrain.spatialReference)&&C1(c,e.basemapTerrain.spatialReference)&&e.elevationProvider?Tn[2]=Ft(ag(e.elevationProvider,c),0):Tn[2]=0}(0,knt[t.type])(t,c=>{s.push(c[0],c[1],c[2])},Tn);const n=s.length/3;if(n===0)throw r();const o=new Array(s.length);if(Xs(s,t.spatialReference,0,o,e.spatialReference,0,n)){t.hasZ&&(i.hasZ=!0);for(let c=0;c<o.length;c+=3)t.hasZ?(Tn[0]=o[c+0],Tn[1]=o[c+1],Tn[2]=o[c+2]):(Tn[0]=o[c+0],Tn[1]=o[c+1]),Mg(i.boundingBox,Tn)}}async function Ant(e,t,i,r){const s=await kf(e.whenViewForGraphic(t));if(s.ok===!1||C(s.value)||!("whenGraphicBounds"in s.value))return void kk(e,t.geometry,r);const n=s.value,o=await kf(n.whenGraphicBounds(t,{minDemResolution:i}));if(o.ok===!1)return void kk(e,t.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;JC(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function lEe(e,t,i,r){var s;if(Array.isArray(t)&&t.length===2){const n=t[0],o=t[1];if(typeof n=="number"&&typeof o=="number")return vh.x=n,vh.y=o,vh.z=void 0,vh.spatialReference=(s=e.spatialReference)!=null&&s.isGeographic?e.spatialReference:et.WGS84,void kk(e,vh,r)}t&&typeof t.map=="function"?await Eo(t.map(n=>lEe(e,n,i,r))):t instanceof hb?kk(e,t,r):t instanceof Ko&&await Ant(e,t,i,r)}async function Mnt(e,t,i,r,s){if(v(t.camera))return cEe(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=v(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=S8(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=gee(e,i);n!=null&&(s.scale=n);const o=new EM(r);return aEe(e,s,i.tilt,o),s.camera=await o.resolver.promise,s}function cEe(e,t,i){const r=e.spatialReference,s=YT(t.position,r);return C(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,_ee(e,null,t,i))}function Rnt(e,t,i,r,s,n){const o=e.renderSpatialReference;return Xa(i,FD,o),Xa(t,cz,o),n.targetGeometry=new ut(t),s.position=new ut(i),me(Uk,cz,FD),T8(e,FD,Uk,r.up,s),n.scale=UT(e,Vr(FD,cz),n.targetGeometry.latitude),n.rotation=S8(s.heading),n.camera=s,n}async function RX(e,t,i,r,s,n){if(C(i))throw new H("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=cS(e);if(t.position)return Rnt(e,n.targetGeometry,t.position,o,r,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=ae(Tn,o.viewForward,-l);o.eye=fe(Tn,o.center,c),n.scale=UT(e,l,i.latitude)}LA(e,o,r);const a=yee(r,t)?Ha.LOCKED:Ha.ADJUST;if(!t.zoomFactor){const l=gee(e,t);l==null?(Xa(i,Tn,e.renderSpatialReference),NSe(o.frustum,Tn)?n.scale=UT(e,Vr(o.eye,Tn),i.latitude):n.scale=nEe(e,o)):n.scale=l;const c=new EM(s);tEe(e,n.targetGeometry,n.scale,r,a,c),n.camera=await c.resolver.promise}return n}function Ont(e,t,i,r){const s=cS(e);return le(Uk,s.viewForward),T8(e,s.eye,Uk,s.up,uz),i.position=new ut(t.position),i.heading=t.heading!=null?t.heading:uz.heading,i.tilt=t.tilt!=null?t.tilt:uz.tilt,_ee(e,null,i,r)}async function Int(e,t,i,r,s){const n=cS(e);return RX(e,t,W1(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}async function Pnt(e,t,i,r,s,n){n.targetGeometry=i.clone();const o=cS(e);LA(e,o,r);const a=yee(r,t)?Ha.LOCKED:Ha.ADJUST,l=new EM(s);return Y3(e,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function $nt(e,t,i,r,s){let n=0;i.z!=null?n=i.z:e.basemapTerrain&&e.elevationProvider&&(n=ag(e.elevationProvider,i)),ue(Tn,i.x,i.y,n),Uf(e.spatialReference,Tn,nce,e.renderSpatialReference),cp(DD,nce),up(DD,DD),Xr(aR);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let b=r[_[2]];isFinite(b)||(b=n),ue(Tn,r[_[0]],r[_[1]],b),Zo(Tn,e.spatialReference,Tn,e.renderSpatialReference),Mg(aR,Eu(Tn,Tn,DD))}const a=QT(aR),l=pb(aR),c=eS(aR),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function Lnt(e,t,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=cS(e),c=$nt(e,l,i,r,s);LA(e,l,n);const h=yee(n,t)?Ha.LOCKED:Ha.ADJUST;a.scale=UT(e,c,a.targetGeometry.latitude);const p=new EM(o);return tEe(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function Dnt(e,t){if(!t||!e.spatialReference)return null;const i={target:void 0};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const r in t)i[r]=t[r];t.center&&!i.target&&(i.target=t.center)}return i}function kb(e){return e&&v(e.camera)&&(e.rotation=S8(e.camera.heading)),e}function Fnt(e,t){const i=xnt;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}const Tn=O(),nce=Pe(),DD=Cs(),aR=ho(),Nnt=yi(),Uk=O(),FD=O(),cz=O(),uz={heading:0,tilt:0},vh=new ut,knt={point(e,t,i){i[0]=e.x,i[1]=e.y,e.z!=null&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.zmin!=null&&e.zmax!=null?(t(ue(i,e.xmin,e.ymin,e.zmin)),t(ue(i,e.xmax,e.ymin,e.zmin)),t(ue(i,e.xmin,e.ymax,e.zmin)),t(ue(i,e.xmax,e.ymax,e.zmin)),t(ue(i,e.xmin,e.ymin,e.zmax)),t(ue(i,e.xmax,e.ymin,e.zmax)),t(ue(i,e.xmin,e.ymax,e.zmax)),t(ue(i,e.xmax,e.ymax,e.zmax))):(t(ue(i,e.xmin,e.ymin,i[2])),t(ue(i,e.xmax,e.ymin,i[2])),t(ue(i,e.xmin,e.ymax,i[2])),t(ue(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)t(ue(i,r[s+0],r[s+1],r[s+2]))}};class Unt{constructor(t,i,r){this.target=t,this.options=i,this.view=r,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;v(this.options.signal)&&fl(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(t,i){return this._promise.then(t,i)}catch(t){return this._promise.catch(t)}resolve(t){if(this.state!=="finished")return this.state="finished",this._resolveCallback(t)}reject(t){if(this.state!=="finished")return this.state="finished",this._rejectCallback(t)}abort(t=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!t&&v(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(lr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await I0(()=>this.view.ready,this._abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,Ent(this.view,this.target,this._abortController.signal).then(t=>{if(this.state==="finished")return;const i=t?this._getCameraFromViewpoint(t):null;if(!C(i))if(this.options.animate){if(C(this._animationController))return;this.startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){var n;const i=!!(this.target instanceof ap&&this.target.camera||this.target instanceof op),r=t.camera;if(C(r))return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new H("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const s=Jy(this.view,r);return C(s)?(this.reject(new H("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}startAnimation(t,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(C(r))return void this.reject(new H("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.active||C(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new X3({view:this.view,desiredCamera:t.camera}),xM(this.view,t.camera,Wd.EYE_AND_CENTER)):Sn(this.view,t.camera),i.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof h0&&v(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):v(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!C(this.view.state))switch(i.state){case Ps.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Ps.Ready:case Ps.Rejected:case Ps.Running:case Ps.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t=null,i=null;const r=this.view.state.cameraController;return r instanceof h0&&(r.updateStateFromViewAnimation(),r.active&&(t=r,i=t.viewAnimation)),t!=null||(t=new h0({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(v(i)&&i.stop(),this.reject(new H("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}let qn=class extends Te{get camera(){const e=this._get("camera");if(!this.ready)return e;const t=LA(this.view,this.view.state.camera,hz);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){var t,i;this._updatePropertyBeforeReady("camera",e)||((t=this.view.elevationProvider)==null||t.enableElevationCache(!0),this.setStateCamera(Jy(this.view,e),{applyConstraints:!1})||se.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=LA(this.view,this.view.state.contentCamera,hz);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=Jy(this.view,e);C(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.removeHandles(dz),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=Rc(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([te(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(dz),this.test.contentCameraResetState.clear())}),te(()=>this.zoom,n=>{n!==void 0&&t!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),te(()=>this.view.state.camera,n=>{const o=Ta(r,n.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],dz),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var t;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():se.getLogger(this.declaredClass).error("#center=","Invalid center",e):se.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e):se.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=gnt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return v(t)?t:this._get("extent")}set extent(e){var t;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||se.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):se.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e):se.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return UT(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||se.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[fi.TOP]/i),n=Math.round(t[fi.RIGHT]/i),o=Math.round(t[fi.BOTTOM]/i),a=Math.round(t[fi.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,ND),this.view.state.updateCamera(t=>t.padding=ND))}_paddingToArray(e,t,i){e?mr(i,e.top||0,e.right||0,e.bottom||0,e.left||0):mr(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return ip((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Snt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var t;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||se.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const i=v(e.camera)?e.camera.position:e.targetGeometry,r=v(i)&&i.spatialReference;se.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e)}else se.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?wnt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||se.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get _pixelRatio(){var e;return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,(e=this.view)==null?void 0:e.qualitySettings.maximumPixelRatio)}get _rasterPixelRatio(){return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,t,i;return(i=(t=(e=this.view)==null?void 0:e._stage)==null?void 0:t.renderer.isFeatureEnabled(wn.PhysicalPixelRendering))!=null?i:!1}get _usePhysicalPixelRenderingAny(){var t,i;const e=(i=(t=this.view)==null?void 0:t._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(wn.PhysicalPixelRendering,Di.IDLE)||e.isFeatureEnabled(wn.PhysicalPixelRendering,Di.INTERACTING)||e.isFeatureEnabled(wn.PhysicalPixelRendering,Di.ANIMATING))}constructor(e){super(e),this._propertiesPool=new L0({frustum:Qv},this),this._cameraSetByUser=!1,this._gotoOperation=null,this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._cameraChangeTime=0,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(t){this.viewStateManager._updatingIgnoreRenderState=t},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||v(this.renderState)}}}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Fs(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,t)=>this._cameraChangedHandler(e,t),hr)]),Qo(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([GC({prepare:()=>this._prepareFrame()}),te(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(kD)}),Fs(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Be(this._propertiesPool)}init(){this.constraintsManager=new QO({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===je.Local&&this.addHandles(Qo(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(kD),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),kD)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(kD),this.constraintsManager=Be(this.constraintsManager))}async goTo(e,t){const i={animate:!0,...t};return v(this._gotoOperation)&&this._gotoOperation.abort(i.animate),this._gotoOperation=new Unt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(cS(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t==null?void 0:t.cameraController;i&&(t.updateCamera(r=>i.stepController(e,r)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){v(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of Bnt){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(C(e)||this._cameraSetByUser)return;if(e instanceof op)return void this.setStateCamera(Jy(this.view,e),{applyConstraints:!1});if(e instanceof ap){if(e.targetGeometry instanceof Gi){const s=Y3(this.view,e.targetGeometry,0,.5,Ha.LOCKED);return void(v(s)&&this.setStateCamera(Jy(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}const t=Y3(this.view,e,0,.5,Ha.LOCKED);v(t)&&this.setStateCamera(Jy(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&Vnt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!C(e)&&(e instanceof ap?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof op?this.isCompatible(e.position):e.spatialReference&&C1(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=znt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=M_){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=MP(this.view,r,s,e,t,Ha.ADJUST);return C(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=Y3(this.view,e,t,i,Ha.ADJUST,hz);return r?Jy(this.view,r):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude;if(r==null)return null;const s=fee(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(sEe(this.view,e))}_viewpointToCamera(e){return Jy(this.view,aEe(this.view,e))}setStateCamera(e,t){return!(C(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&Sn(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new X3({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._pixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(r!==0&&s!==0&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===r&&n.fullHeight===s&&n.pixelRatio===i||(M_.copyFrom(n),M_.pixelRatio!==i&&(this._paddingToArray(this.padding,i,ND),M_.padding=ND),M_.fullWidth=r,M_.fullHeight=s,M_.pixelRatio=i,this.view.state.camera=M_),this._updateViewState()}}_updateElevation(e){var s,n;const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=(n=(s=this.view.renderCoordsHelper)==null?void 0:s.getAltitude(e.eye))!=null?n:0,r=t?_8(this.view,e.eye):0;e.relativeElevation=i-r}_updateViewState(){v(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Di.ANIMATING:this.view.interacting?this.view.state.mode=Di.INTERACTING:(this.view.state.mode===Di.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=Gnt?this.view.state.mode=Di.INTERACTING:this.view.state.mode=Di.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio,this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:op,dependsOn:["view.state.camera","ready"]})],qn.prototype,"camera",null),u([d({type:op,dependsOn:["view.state.contentCamera","ready"]})],qn.prototype,"contentCamera",null),u([d({type:ut})],qn.prototype,"center",null),u([d({type:Gi})],qn.prototype,"extent",null),u([d({readOnly:!0})],qn.prototype,"frustum",null),u([d({readOnly:!0})],qn.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],qn.prototype,"ready",void 0),u([d({type:Number})],qn.prototype,"scale",null),u([d()],qn.prototype,"padding",null),u([d({readOnly:!0})],qn.prototype,"screenCenter",null),u([d({constructOnly:!0})],qn.prototype,"view",void 0),u([d({type:ap})],qn.prototype,"viewpoint",null),u([d({type:Number})],qn.prototype,"zoom",null),u([d({readOnly:!0})],qn.prototype,"_pixelRatio",null),u([d({readOnly:!0})],qn.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],qn.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],qn.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],qn.prototype,"_windowDevicePixelRatio",void 0),u([d()],qn.prototype,"_devicePixelRatioOverride",void 0),qn=u([P("esri.views.3d.state.ViewStateManager")],qn);const Vnt=["camera","viewpoint","extent","scale","center","zoom"],Bnt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],znt={heading:0,tilt:0},hz=new op,M_=new Ot,ND=ui(),kD="pending-initial-view",dz="content-camera-reset",Gnt=300,oce=100;let lg=class extends i0{constructor(){super(...arguments),this.startCamera=new Ot,this.currentCamera=new Ot,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<oce}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Ps.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),oce),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],lg.prototype,"isInteractive",null),u([d()],lg.prototype,"_lastInteraction",void 0),lg=u([P("esri.views.3d.state.controllers.InteractiveController")],lg);var mu;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(mu||(mu={}));let Z3=class extends lg{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=mu.CENTER,this._rotScale=0,this._lastPoint=tt(),this._tmpWorldUp=O(),this._tmpViewDir=O(),this._tmpRotCurPoint=tt(),this._tmpTransf=Pe(),this._tmpAxis=O(),this._tmpPivotPoint=O(),this._pivotPos=O(),this._constraintOptions={selection:is.ALL,interactionType:hi.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Jo.TUMBLE}}initialize(){this._rotScale=this.pivot===mu.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case mu.EYE:le(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=hi.LOOK_AROUND,this._constraintOptions.tiltMode=Jo.LOOK_AROUND,this._constraintOptions.selection=is.NONE;break;case mu.CENTER:{const t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?uS:{});t||le(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=hi.TUMBLE,this._constraintOptions.tiltMode=Jo.TUMBLE,this._constraintOptions.selection=is.ALL&~is.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,Kx(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=O();me(r,this._pivotPos,i.eye);const s=Oe(r),n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,ace);let o=Math.max(Math.min(Est,1/Math.abs(_e(ace,i.viewForward)))*n,Cst);t&&(o=Math.min(s,o));const a=dr(this.view.spatialReference),l=$s(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),c=x8(this.startCamera,l,a);let h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*rz,rz),p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,rz);(v(h)||v(p))&&(h=Ft(h,p),p=C(p)||c===Yo.Horizontal?h:p,o=h>p?p:h,o=t?Math.min(o,s):o),be(r,r),le(this._pivotPos,fe(this._tmpPivotPoint,i.eye,ae(this._tmpPivotPoint,r,o)))}update(e){if(this.active){switch(this.pivot){case mu.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case mu.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Sn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this._tmpWorldUp),Kx(e,t,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,n=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;me(this._tmpViewDir,i,r);const o=Oe(this._tmpViewDir),a=uo(_e(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===mu.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=ye(s+a,Va.min,Va.max)-a,_t(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===mu.CENTER&&(n=-n),jh(this._tmpTransf,n,this._tmpWorldUp),Cu(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),Ze(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ze(pz,e.up,this._tmpTransf),fe(pz,r,this._tmpViewDir),Mo(this._lastPoint,this._tmpRotCurPoint),pz}};u([d()],Z3.prototype,"pivot",void 0),Z3=u([P("esri.views.3d.state.controllers.RotateController")],Z3);const pz=O(),ace=O();class fz extends Oa{constructor(t,i,r,s){super(!0),this._view=t,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!dee(t.data,this.pointerAction))return;const r=$s(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new Z3({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}}let OX=class extends lg{constructor(){super(...arguments),this._pickPoint=O(),this._tmpP0=tt(),this._panAxisAngle=b8(),this._tmpRayDir=O(),this._tmpRayDirPick=O(),this._targetOnSphere=O(),this._navMode=Yo.Horizontal,this._tmpRay={origin:O(),direction:O()},this.dragBeginPoint=$s(),this._normalizedAnchorPoint=tt(),this._constraintOptions={selection:is.ALL_EXCEPT_COLLISION,interactionType:hi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Jo.TUMBLE},this._sphere=Gn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Mo(this.dragBeginPoint,e),Kx(this.startCamera,e,this._normalizedAnchorPoint);const t=dr(this.view.spatialReference),i=I2e(this._intersectionHelper,this.startCamera,e,t,$A.Ellipsoid,this.view.map.ground.opacity===0?uS:{});if(this._navMode=x8(this.startCamera,e,t),this._navMode===Yo.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=Ft(i.scenePickPoint,this._pickPoint),this._sphere=i.sphere;else{let r;TM(this.startCamera,e,this._tmpRay),be(this._tmpRay.direction,this._tmpRay.direction),v(i.scenePickPoint)&&(me(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),r=Oe(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,lce);let n=ye(Math.min(T2e,1/Math.abs(_e(lce,this._tmpRay.direction)))*s,Rk[0],Rk[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,w8);n=v(o)?o:n,n=r!=null?Math.min(n,r):n,this._hasPickPoint=!0,ae(this._tmpRay.direction,this._tmpRay.direction,n),fe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Yo.Horizontal){me(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Oe(this._tmpRayDir);Kx(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this._hasPickPoint&&r<t){const n=1-(1-r/t)*(1-this._sphere[3]/Oe(this.currentCamera.center));this.currentCamera.center=ae(UD,this.currentCamera.center,n)}ae(this._tmpRayDir,this._tmpRayDir,-r/t),this.currentCamera.eye=fe(UD,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=pf(ST(this.dragBeginPoint,e)),Sn(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(CP(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),oee(this._pickPoint,this._targetOnSphere,this._panAxisAngle),nb(this.currentCamera,this._sphere,this._panAxisAngle))}else{const t=Oe(this._tmpRay.direction);Kx(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;ae(this._tmpRayDir,this._tmpRay.direction,1-r/t),this.currentCamera.eye=fe(UD,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=fe(UD,this.currentCamera.center,this._tmpRayDir)}xM(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};OX=u([P("esri.views.3d.state.controllers.global.ZoomController")],OX);const UD=O(),lce=O();let IX=class extends lg{constructor(){super(...arguments),this._tmpP=O(),this._tmpDir=O(),this._tmpN=O(),this._tmpP0=tt(),this._tmpPoi=O(),this._tmpRayDir=O(),this.dragBeginPoint=$s(),this._normalizedAnchorPoint=tt(),this._constraintOptions={selection:is.ALL,interactionType:hi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:O(),tiltMode:Jo.TUMBLE},this._plane=nr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Mo(this.dragBeginPoint,e),Kx(this.startCamera,e,this._normalizedAnchorPoint);const t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?uS:{});me(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Oe(this._tmpDir);be(this._tmpDir,this._tmpDir);const r=Math.abs(this.view.camera.position.z);let s=ye(Math.min(T2e,1/Math.abs(_e(jnt,this._tmpDir)))*r,Rk[0],Rk[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,w8);s=v(n)?n:s,s=t?Math.min(s,i):s,ae(this._tmpDir,this._tmpDir,s),fe(this._tmpP,this.startCamera.eye,this._tmpDir),me(this._tmpN,this.startCamera.eye,this.startCamera.center),be(this._tmpN,this._tmpN),this._tmpN[1]<0&&pl(this._tmpN,this._tmpN),A$(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Ast(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||le(this._tmpPoi,this.currentCamera.center),Kx(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Mo(this._normalizedAnchorPoint,this._tmpP0),me(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Oe(this._tmpRayDir);let r=i*(1-t);this._constraintOptions.interactionDirection&&(le(this._constraintOptions.interactionDirection,this._tmpRayDir),ae(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/i));const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(ae(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=fe(Ub,this.currentCamera.eye,this._tmpRayDir),On(Ub,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?Ub[2]=Math.max(this.startCamera.center[2],Ub[2]):Ub[2]=Math.min(this.startCamera.center[2],Ub[2]),this.currentCamera.center=Ub,this._constraintOptions.interactionFactor=pf(ST(this.dragBeginPoint,e)),Sn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};IX=u([P("esri.views.3d.state.controllers.local.ZoomController")],IX);const Ub=O(),jnt=Le(0,0,1);class Hnt extends Oa{constructor(t,i,r){super(!0),this._view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!dee(t.data,this.pointerAction))return;const r=$s(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new OX({view:this._view}):this._cameraController=new IX({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}}function Sp(e){let t=e*e;return e<0&&(t*=-1),t}function cce(e,t,i){const r=i,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=Sp(s.axes[0]),r.translation[1]=Sp(s.axes[1]),r.translation[2]=Sp(s.buttons[7])-Sp(s.buttons[6]),r.heading=Sp(s.axes[2]),r.tilt=Sp(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Sp(s.axes[0]),r.translation[1]=1.2*Sp(s.axes[1]),r.translation[2]=2*-Sp(s.axes[2]),r.heading=1.2*Sp(s.axes[5]),r.tilt=1.2*Sp(s.axes[3])),r.tilt*=o,ae(r.translation,r.translation,a),r}function uce(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function mz(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let kx=class extends lg{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Ot,this._headingStart=0,this._constraintOptions={selection:is.ALL,interactionType:hi.NONE,interactionStartCamera:new Ot,interactionFactor:0,interactionDirection:null,tiltMode:Jo.LOOK_AROUND}}handleEventGamepad(e){const t=cce(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||mz(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,uce(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const t=uce(this._keysButtonState,this._transformation);mz(t)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(t-this._filteredSurfaceElevation)*e}stepController(e,t){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Vb),this._applyDisabledMovementTypes(Vb),this._applyPan(Vb.pan),this._applyRotate(Vb.rotate),this._applyZoom(Vb.zoom),this._applyAscend(Vb.ascend),this._constraintOptions.interactionType=hi.NONE,this._constraintOptions.selection=is.COLLISION,Sn(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;me(nc,t.center,t.eye),Ze(nc,nc,e.matrix),t.center=fe(nc,nc,t.eye),t.up=Ze(nc,t.up,e.matrix),this._constraintOptions.interactionType=hi.LOOK_AROUND,this._constraintOptions.selection=is.ALL_EXCEPT_COLLISION,Sn(this.view,t,this._constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=Ze(nc,t.eye,e.matrix),t.center=Ze(nc,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Ze(nc,t.up,e.matrix)),this._constraintOptions.interactionType=hi.PAN,this._constraintOptions.selection=is.ALL,Sn(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=fe(nc,this.currentCamera.eye,ae(Xe.get(),t,e)),le(lR,t),pl(lR,lR),this._constraintOptions.interactionDirection=lR,this._constraintOptions.interactionType=hi.ZOOM,this._constraintOptions.selection=is.ALL_EXCEPT_COLLISION,Sn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Xe.get());if(this._constraintOptions.interactionDirection=le(lR,t),this.view.state.isGlobal){const i=Oe(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=ae(nc,this.currentCamera.eye,r),this.currentCamera.center=ae(nc,this.currentCamera.center,r)}else{const i=ae(Xe.get(),t,e);this.currentCamera.eye=fe(nc,this.currentCamera.eye,i),this.currentCamera.center=fe(nc,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=hi.ASCEND,this._constraintOptions.selection=is.COLLISION,Sn(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=is.ALL_EXCEPT_COLLISION,Sn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){Knt(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,nc)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=ue(Xe.get(),s[0],s[1],0);be(a,a);const l=n.translation[0]*e.pan;if(l!==0){const y=ae(Xe.get(),r,l);Vc(i.pan.matrix,i.pan.matrix,y),i.pan.enabled=!0}switch(o.mode){case"pan":{const y=-n.translation[1]*e.pan;if(y!==0){const _=ae(Xe.get(),a,y);Vc(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Cu(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Xe.get())),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=sb(this.view.renderCoordsHelper,t.center,t.eye),m=ye(f+p,Va.min,Va.max)-f;m&&(Cu(i.rotate.matrix,i.rotate.matrix,m,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=_t(Xe.get(),s,r);be(a,a),pl(a,a),$st(this.startCamera,t,n,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Vb.pan,this._tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Cu(i.rotate.matrix,i.rotate.matrix,h,this._tmpCamera.eye),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(Cu(i.rotate.matrix,i.rotate.matrix,f,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=dr(this.view.spatialReference),s=S4(Va.min,t.origin,i,r);let n=0,o=0;const a=Xe.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){const l=sb(this.view.renderCoordsHelper,a,t.origin);n=S4(l,t.origin,i,r),o=S4(Va.max,t.origin,i,r)}else{mM(RU(OU,i+r.radius),t,a);const l=uo(-_e(t.direction,be(a,a)));n=qle(l,t.origin,i,r),o=qle(Va.max,t.origin,i,r)}return ye(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=hnt(this.view,t,0,uEe,Jnt),n=i.intersectManifoldClosestSilhouette(qh(t,s),e,Xe.get()),o=Vr(t,n),a=i.intersectManifoldClosestSilhouette(qh(t,z0(Xe.get(),t,r.center)),e,Xe.get()),l=Vr(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this._filteredSurfaceElevation,Xe.get());if(s){const o=me(Xe.get(),e,n),a=Oe(o);ae(o,o,1/a);const l=be(Xe.get(),e),c=uo(_e(l,o));return a*Math.sin(Math.min(Wnt,c))}{const o=le(Xe.get(),e);return t.setAltitude(o,this._filteredSurfaceElevation),Vr(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Xnt}_computeVelocities(e){const t=this._filteredSurfaceElevation,i=t+dr(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=Xe.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,c=hce*r.width,h=hce*r.width,p=a*Math.tan(.5*r.fovX)/l,f=p/i,m=p/this._computeHeadingRotateRadius(n),y=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*y-y),zoom:2**(c*e/l)*a-a,rotate:ye(m*h,Ynt,Znt)*e}}_applyDisabledMovementTypes(e){!v(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&np(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&np(e.rotate.matrix))}static activatesFor(e,t){const i=cce(t,e.navigation.gamepad,qnt);return!(t.action==="end"||mz(i))}};u([d({constructOnly:!0})],kx.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],kx.prototype,"disableMovements",void 0),kx=u([P("esri.views.3d.state.controllers.GamepadKeyboardController")],kx);const qnt={translation:[0,0,0],heading:0,tilt:0,zoom:0},uEe=80,Wnt=Wt(uEe),hce=.75,Xnt=5,Ynt=Wt(30),Znt=Wt(80),Vb={zoom:0,ascend:0,pan:{enabled:!1,matrix:Pe()},rotate:{enabled:!1,matrix:Pe()}},nc=O(),lR=O(),Jnt=pee();function Knt(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,np(e.pan.matrix),e.rotate.enabled=!1,np(e.rotate.matrix)}class Qnt extends Oa{constructor(t){super(!0),this._view=t,this._watchHandles=new Ii,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([te(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},st),te(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const i=this._view.navigation.gamepad.device;if(i&&t.data.device!==i)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||kx.activatesFor(this._view,t.data)){if(!r){const s=new kx({view:this._view,gamepadDevice:t.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===t.data.device&&this._cameraControllerGamepad.handleEventGamepad(t.data)}}}var uu;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(uu||(uu={}));class eot extends Oa{constructor(t,i){super(!0),this._view=t,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:je.Local},this._keyToNumber={[i.left]:uu.LEFT,[i.right]:uu.RIGHT,[i.forward]:uu.FORWARD,[i.backward]:uu.BACKWARD,[i.up]:uu.UP,[i.down]:uu.DOWN,[i.headingLeft]:uu.HEADINGLEFT,[i.headingRight]:uu.HEADINGRIGHT,[i.tiltUp]:uu.TILTUP,[i.tiltDown]:uu.TILTDOWN,[i.zoomIn]:uu.ZOOMIN,[i.zoomOut]:uu.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this._keyToNumber[t.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new kx({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),t.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this._keyToNumber[t.data.key];i!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(i),t.stopPropagation())}}class tot extends Oa{constructor(t,i){super(!0),this._view=t,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=t.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new $k({view:this._view,mode:"interaction"}):new Lk({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,$s(i.x,i.y)),t.preventDefault(),t.stopPropagation()}}class Vk{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let VT=class extends SP{constructor(){super(...arguments),this._beginCamera=new Ot,this._elapsedTimeSec=0,this.constraintOptions={selection:is.ALL,interactionType:hi.PAN,interactionFactor:0,interactionStartCamera:new Ot,interactionDirection:null,tiltMode:Jo.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new yA}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),Sn(this.view,t,this.constraintOptions)}};VT=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],VT);let J3=class extends VT{constructor(e){super(e),this.interactionType=hi.PAN,this._tmpPan=O()}momentumStep(e,t){const i=this.momentum.value(e);ae(this._tmpPan,this.momentum.direction,i),t.eye=me(dce,t.eye,this._tmpPan),t.center=me(dce,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],J3.prototype,"momentum",void 0),J3=u([P("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],J3);const dce=O(),iot=O(),VD=O();let C4=class extends VT{constructor(e){super(e),this.interactionType=hi.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);le(VD,t.eye),be(VD,VD),_t(this.momentum.axis2,VD,this.momentum.axis1),D2e(t,iot,this.momentum.axis1,i,this.momentum.axis2,r)}};u([d({constructOnly:!0})],C4.prototype,"momentum",void 0),C4=u([P("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],C4);let Tx=class extends VT{set center(e){this._set("center",js(e))}set axis(e){this._set("axis",js(e))}constructor(e){super(e),this.interactionType=hi.TUMBLE}momentumStep(e,t){const i=this.momentum.value(e);nb(t,this.center,EP(this.axis,i))}};u([d({constructOnly:!0})],Tx.prototype,"momentum",void 0),u([d({constructOnly:!0})],Tx.prototype,"center",null),u([d({constructOnly:!0})],Tx.prototype,"axis",null),Tx=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Tx);let jE=class extends VT{set zoomCenter(e){this._set("zoomCenter",js(e))}constructor(e){super(e),this.interactionType=hi.ZOOM,this.constraintOptions.interactionDirection=O()}momentumStep(e,t){const{interactionDirection:i}=this.constraintOptions;if(!i)return;le(i,t.eye);const r=this.momentum.valueDelta(0,e);cee(t,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),z0(i,t.eye,i)}};u([d({constructOnly:!0})],jE.prototype,"momentum",void 0),u([d({constructOnly:!0})],jE.prototype,"zoomCenter",null),jE=u([P("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],jE);let Qw=class extends VT{set screenCenter(e){this._set("screenCenter",$s(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",js(e))}constructor(e){super(e),this.interactionType=hi.ZOOM,this.radius=0,this._tmpSceneCenter=O(),this._tmpZoomAxisAngle=b8(),this._sphere=Gn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);R2e(this._sphere,t,i),this.constraintOptions.interactionType=hi.ZOOM,Sn(this.view,t,this.constraintOptions),CP(this._sphere,t,this.screenCenter,this._tmpSceneCenter),oee(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),nb(t,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=hi.PAN}};u([d({constructOnly:!0})],Qw.prototype,"momentum",void 0),u([d({constructOnly:!0})],Qw.prototype,"screenCenter",null),u([d({constructOnly:!0})],Qw.prototype,"sceneCenter",null),u([d({constructOnly:!0})],Qw.prototype,"radius",void 0),Qw=u([P("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Qw);class ff{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return this.lastValue===void 0?NaN:t-this.lastValue}_updateDelta(t){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}class E8{constructor(t,i,r){this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const r=this.value(t);return this.value(t+i)-r}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const r=1-this.friction;return t*(r**i-1)/Math.log(r)}}class rot extends E8{constructor(t,i,r,s,n){super(t,i,r),this._sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class hEe{constructor(t=300,i=12,r=.84){this._minimumInitialVelocity=t,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new ff(.6),this._screen=[new ff(.4),new ff(.4)],this._scene=[new ff(.6),new ff(.6),new ff(.6)],this._tmpDirection=O()}add(t,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=t==null||i==null?0:Math.sqrt(t*t+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,i,r){var o,a,l;ue(this._tmpDirection,(o=this._scene[0].filteredDelta)!=null?o:0,(a=this._scene[1].filteredDelta)!=null?a:0,(l=this._scene[2].filteredDelta)!=null?l:0);const s=Oe(this._tmpDirection);s>0&&ae(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new rot(t,i,r,n==null?0:s/n,this._tmpDirection)}}class pce{constructor(t){this._gain=t}update(t){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const fce=1e-5;class sot extends E8{constructor(t,i,r,s,n,o=0,a){super(t,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this._angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class not{constructor(t=300,i=12,r=.84){this._minimumInitialVelocity=t,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=O(),this._tmpAxis2=O(),this._tmpAngles=tt(),this._time=new ff(.3),this._screen=[new ff(.4),new ff(.4)],this._angle1=new pce(.6),this._angle2=new pce(.6),this._axis1=O(),this._axis2=O(),this._lastScene=O()}addMomentumDirectRotation(t,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=$2e(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),ll(this._tmpAxis2)<fce?a=0:be(this._axis1,this._tmpAxis2),this._angle1.update(a),le(this._lastScene,i)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;L2e(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),ll(this._tmpAxis2)<fce?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),be(this._axis1,this._tmpAxis1),be(this._axis2,this._tmpAxis2)),le(this._lastScene,i)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=t==null||i==null?null:Math.sqrt(t*t+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new sot(t,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}}class dEe{constructor(t=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=t,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new ff(.8),this.time=new ff(.3)}add(t,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=ye(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,i,r){return new E8(t,i,r)}}class pEe extends dEe{constructor(t=3,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){const r=this.value.lastValue;if(r!=null){let s=t-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=r+s}super.add(t,i)}}class oot extends E8{constructor(t,i,r){super(t,i,r)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const r=super.value(t),s=super.value(t+i)-r;return Math.exp(s)}}class fEe extends dEe{constructor(t=2.5,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,r){return new oot(t,i,r)}}let PX=class extends lg{constructor(){super(...arguments),this._smoothRotation=new Vk(.05),this._rotationAxis=O(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=nr(),this._beginRadius=0,this._smoothScaling=new Vk(.05),this._zoomCenterScreen=$s(),this._zoomMomentumEstimator=new fEe,this._rotationMomentumEstimator=new pEe,this._panSphericalMomentumEstimator=new not,this._panPlanarMomentumEstimator=new hEe,this._adjustedSphere=Gn(),this._tmp3d=O(),this._tmpScreenPointArray=$s(),this._beginScreenPoint=$s(),this._beginScenePoint=O(),this._screenPickPoint=$s(),this._scenePickPoint=O(),this._mode=Yo.Horizontal,this._sphere=Gn(),this._pointerCount=0,this._tmpInteractionDirection=O(),this._constraintOptions={selection:is.ALL,interactionType:hi.NONE,interactionFactor:0,interactionStartCamera:new Ot,interactionDirection:null,tiltMode:Jo.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var s;if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panPlanarMomentumEstimator.enabled=t,this._panSphericalMomentumEstimator.enabled=t,this._beginHeading=-Z1.normalize(Wt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Km(e.center,this._screenPickPoint),Mo(this._beginScreenPoint,this._screenPickPoint);const i=dr(this.view.spatialReference),r=I2e(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,$A.Silhouette,this.view.map.ground.opacity===0?uS:{});C(r.scenePickPoint)||(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,le(this._beginScenePoint,this._scenePickPoint),this._mode=x8(this.startCamera,this._screenPickPoint,i),this._mode===Yo.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),(s=this._constraintOptions.interactionStartCamera)==null||s.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this._mode===Yo.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._mode===Yo.Horizontal?new Qw({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new jE({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Tx({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===Yo.Horizontal){const r=this._panSphericalMomentumEstimator.evaluateMomentum();if(r)return new C4({view:this.view,momentum:r})}else{const r=this._panPlanarMomentumEstimator.evaluateMomentum();if(r)return new J3({view:this.view,momentum:r})}return null}_preparePlanarPanMode(e,t){const i=pl(this._tmp3d,this.startCamera.viewForward);A$(this._scenePickPoint,i,this._panningPlane);const r=$s(this._screenPickPoint[0],0),s=O(),n=Oe(this.startCamera.eye);this._adjustedSphere[3]=n<this._sphere[3]?n-100:this._sphere[3],CP(this._adjustedSphere,this.startCamera,r,s);const o=Ga();this.startCamera.projectToRenderScreen(s,o);const a=O(),l=O(),c=O();me(a,this._scenePickPoint,this.currentCamera.eye);const h=Oe(a);be(a,a);const p=A2e*Math.max(Math.abs(this.view.camera.position.z),M2e),f=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,w8);let m=v(f)?f:p;m=t?Math.min(m,h):m,le(c,fe(l,this.currentCamera.eye,ae(l,a,m))),this._panningPlane[3]=-_e(this._panningPlane,c),this.startCamera.center=fe(l,this.startCamera.eye,ae(l,this.startCamera.viewForward,m));const y=Km(e.center,this._tmpScreenPointArray);CX(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const t=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(t),R2e(this._sphere,this.currentCamera,this._smoothScaling.value),Km(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=hi.ZOOM,this._constraintOptions.interactionFactor=pf(e.radius-this._beginRadius),Sn(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const t=Km(e.center,this._tmpScreenPointArray);CP(this._sphere,this.currentCamera,t,this._tmp3d),uee(this._beginScenePoint,_e(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(N2e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(F2e(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=hi.PAN,this._constraintOptions.interactionFactor=pf(ST(this._screenPickPoint,t)),Sn(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){be(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||pl(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value,i=t+EX(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=r,this._smoothRotation.update(i);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),nb(this.currentCamera,this._sphere,EP(this._rotationAxis,s)),this._constraintOptions.interactionType=hi.TUMBLE,this._constraintOptions.interactionFactor=pf(e.radius*i),Sn(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const t=Km(e.center,this._tmpScreenPointArray);CX(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(P2e(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=hi.PAN,this._constraintOptions.interactionFactor=pf(ST(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Sn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),cee(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=hi.ZOOM,this._constraintOptions.interactionFactor=pf(e.radius-this._beginRadius),Sn(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){le(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||pl(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value;let i=e.angle-t;i=EX(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),nb(this.currentCamera,this._sphere,EP(this._rotationAxis,n)),this._constraintOptions.interactionType=hi.TUMBLE,this._constraintOptions.interactionFactor=pf(e.radius*n),Sn(this.view,this.currentCamera,this._constraintOptions)}};PX=u([P("esri.views.3d.state.controllers.global.PinchAndPanController")],PX);const mce=Le(0,0,1),aot={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let $X=class extends lg{constructor(){super(...arguments),this._rotationValueSmooth=new Vk(.05),this._scalingValueSmooth=new Vk(.05),this._planeHorizontal=nr(),this._planeVertical=nr(),this._rotationMomentumEstimator=new pEe,this._panMomentumEstimator=new hEe(300,12,.9),this._zoomMomentumEstimator=new fEe,this._beginRadius=0,this._beginCenter=O(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Yo.Horizontal,this._beginCenterScreen=$s(),this._tmpCentroid3d=O(),this._tmpCentroid2d=$s(),this._tmp2d=$s(),this._pointerCount=0,this._constraintOptions={selection:is.ALL,interactionType:hi.NONE,interactionFactor:0,interactionStartCamera:new Ot,interactionDirection:null,tiltMode:Jo.TUMBLE}}begin(e){var m;if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Km(e.center,this._beginCenterScreen),Abe(mce,0,this._planeHorizontal);const i=O(),r=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?uS:{}),s=O();pl(s,this.startCamera.viewForward);const n=O();le(n,mce);const o=_e(s,n),a=tp(o<0?-o:o);this._panMode=a>=aot.ANGLE_THRESHOLD?Yo.Horizontal:Yo.Vertical;const l=Math.min(A2e,1/Math.abs(_e(n,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),M2e);_W(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||vW(this._planeHorizontal,this._planeHorizontal);const c=O(),h=O(),p=O();me(c,i,this.currentCamera.eye);const f=Oe(c);if(be(c,c),this._panMode===Yo.Vertical){ae(n,n,o),me(this._planeVertical,s,n),be(this._planeVertical,this._planeVertical),_W(this._planeVertical,this._planeVertical,i);const y=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,w8);let _=v(y)?y:l;_=r?Math.min(_,f):_,le(p,fe(h,this.currentCamera.eye,ae(h,c,_))),this._planeVertical[3]=-_e(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),sz(this._tmpPoints,this._beginCenter)}else{const y=r?f:l;le(p,fe(h,this.currentCamera.eye,ae(h,c,y))),this._planeHorizontal[3]=-_e(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),sz(this._tmpPoints,this._beginCenter)}(m=this._constraintOptions.interactionStartCamera)==null||m.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this._panMode===Yo.Horizontal?this._planeHorizontal:this._planeVertical,r=this._beginCenter;if(t){const s=this._beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=n,this._scalingValueSmooth.update(s),cee(this.currentCamera,r,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=hi.ZOOM,this._constraintOptions.interactionFactor=pf(Math.abs(e.radius-this._beginRadius)),Sn(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),sz(this._tmpPoints,this._tmpCentroid3d),Km(e.center,this._tmpCentroid2d),P2e(this.currentCamera,r,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=hi.PAN,this._constraintOptions.interactionFactor=pf(ST(this._beginCenterScreen,this._tmpCentroid2d)),Sn(this.view,this.currentCamera,this._constraintOptions),t){const s=this._planeHorizontal,n=r,o=this._rotationValueSmooth.value,a=o+EX(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp),nb(this.currentCamera,n,EP(s,c)),this._constraintOptions.interactionType=hi.TUMBLE,this._constraintOptions.interactionFactor=pf(Math.abs(e.radius*c)),Sn(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new jE({view:this.view,momentum:t,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Tx({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const r=this._panMomentumEstimator.evaluateMomentum();return r?new J3({view:this.view,momentum:r}):null}_computePlanePoints(e,t,i,r){r.length=e.size;const s=this._tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,r[n]===void 0&&(r[n]=O()),CX(t,i,s,r[n]),n+=1}),r}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};$X=u([P("esri.views.3d.state.controllers.local.PinchAndPanController")],$X);class gce extends Oa{constructor(t,i,r){super(!0),this._view=t,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!dee(t.data,this.pointerAction))return;const i=t.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?t.data.timestamp-this._lastTimestamp>2&&(this._controller.update(t.data),this._lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this._controller&&this._controller.active){this._lastEndTimestamp=t.timestamp;const r=this._controller.end(t.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(t){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(t.data),this._lastTimestamp=t.timestamp}_createController(){return this._view.state.isGlobal?new PX({view:this._view}):new $X({view:this._view})}}class lot extends Oa{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}}class mEe extends Oa{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class cot extends mEe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class uot extends mEe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class hot extends Oa{constructor(t,i=!1){super(!0),this._view=t,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){var s,n,o;const i=this._invert?-1:1,r=$s(0,t.data.delta*i);switch(t.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new Z3({view:this._view,pivot:mu.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(n=this._cameraController)==null||n.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}}function yce(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:t.axes.map(i=>fot(i,e.axisThreshold))}:{buttons:[],axes:[]}}function dot(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function pot(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function fot(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}class mot{constructor(t,i){this._element=t,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,yce(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this._callback=t}_connectGamepad(t){const i=new pQ(t);i.deviceType!=="unknown"&&(this._inputDevices[t.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=GC({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!t||this._input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=yce(n),l=r||pot(a);o&&(o.timestamp===s.timestamp||!o.active&&l||dot(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this._latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[t.index],state:i,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}}const _ce=he("edge"),got=he("chrome"),yot=he("ff"),_ot=he("safari"),vce="esri-view-surface",NS={touchNone:`${vce}--touch-none`,touchPan:`${vce}--touch-pan`};class C8{constructor(t,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new mot(t,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource=Be(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){var i;for(const r in this._active)if(!t||!t.has(r)){const s=this._active[r];this._element.removeEventListener(gz[r],s),delete this._active[r]}t&&t.forEach(r=>{if(!this._active[r]&&gz[r]){const s=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(gz[r],s),this._active[r]=s}}),this._gamepadSource.hasEventListeners=(i=t==null?void 0:t.has("gamepad"))!=null?i:!1}setPointerCapture(t,i){i?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?NS.touchNone:NS.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?NS.touchPan:NS.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(NS.touchNone),this._element.classList.remove(NS.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=DTe(this._element,t);return C8.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const r=fZe(i);r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:_ce&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}_ce?r*=.7:got||_ot?r*=.6:yot&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,o)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}C8.test={disableSubpixelCoordinates:!1};const gz={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class vot extends Oa{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function gEe(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function bot(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function wot(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:ip()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[S,E]=e,[M,A]=[E.x-S.x,E.y-S.y];return t.radius=Math.sqrt(M*M+A*A)/2,t.center.x=(S.x+E.x)/2,t.center.y=(S.y+E.y)/2,t}let i=0,r=0;for(let S=0;S<e.length;S++)i+=e[S].x,r+=e[S].y;i/=e.length,r/=e.length;const s=e.map(S=>S.x-i),n=e.map(S=>S.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let S=0;S<s.length;S++){const E=s[S],M=n[S],A=E*E,$=M*M;o+=A,a+=$,l+=E*M,c+=A*E,h+=$*M,p+=E*$,f+=M*A}const m=.5*(c+p),y=.5*(h+f),_=o*a-l*l,b=(m*a-y*l)/_,w=(o*y-l*m)/_,T=ip(b+i,w+r);return{radius:Math.sqrt(b*b+w*w+(o+a)/e.length),center:T}}function K3(e){const{native:t}=e,{pointerId:i,button:r,pointerType:s}=t;return s==="mouse"?`${i}:${r}`:`${s}`}class xot extends Oa{constructor(t){super(!1),this._navigationTouch=t,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:Tot(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=BD(this._activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=A4(s,yEe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this._activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=BD(this._activePointerMap).angle;this._activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=BD(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=A4(r,i)-t,r.lastAngle=A4(r,i)-t})}_emitEvent(t,i,r){const s=BD(this._activePointerMap);this._drag.emit(this._createPayload(t,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(t.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=t.data.startEvent.pointerType,this._mouseButton=t.data.startEvent.button,this._startStateModifiers=t.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}}function yEe(e){const t=[];return e.forEach(i=>{t.push(ip(i.event.x,i.event.y))}),wot(t)}function BD(e){const t=yEe(e);let i=0;return e.forEach(r=>{let s=A4(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s,i+=s-r.initialAngle}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function Tot(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function A4(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var bce;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(bce||(bce={}));const b1={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class Sot extends Oa{constructor(t=b1.maximumDoubleClickDelay,i=b1.maximumDoubleClickDistance,r=b1.maximumDoubleTouchDelay,s=b1.maximumDoubleTouchDistance,n=L6){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimer=hs(t.doubleClickTimer))}get hasPendingInputs(){return za(this._pointerState,t=>t.doubleClickTimer!=null)}_clearDoubleClickTimer(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimer=hs(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}_getPointerId(t){const{pointerId:i,pointerType:r,button:s}=t.native;return r==="mouse"?`${i}:${s}`:`${r}`}_handleImmediateClick(t){const i=t.data,{pointerType:r}=i.native,s=this._getPointerId(i);if(!this._pointerState.has(s))return void this._startClick(t);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;gEe(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(t)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(t){const i=K3(t.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(t){const{data:i}=t,{native:{pointerType:r}}=i,s=K3(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:t,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}}class Eot extends Oa{constructor(t=b1.maximumDoubleClickDelay,i=b1.maximumDoubleClickDistance,r=b1.maximumDoubleTouchDelay,s=b1.maximumDoubleTouchDistance,n=L6){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=K3(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(t){const i=t.data,r=K3(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;gEe(n,t.data)>o?this._startImmediateDoubleClick(t,s):(this._immediateDoubleClick.emit(t.data,void 0,n.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(t,s)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_removeState(t){const i=K3(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const cR={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class Cot extends Oa{constructor(t=cR.maximumClickDelay,i=cR.movementUntilMouseDrag,r=cR.movementUntilPenDrag,s=cR.movementUntilTouchDrag,n=cR.holdDelay,o=L6){super(!1),this._maximumClickDelay=t,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout=hs(t.holdTimeout)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):bot(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}}class Aot{constructor(t){this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this._currentCount=0}this._previousEvent=t}_emitStart(t){var i,r;this._startEvent=t,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,t)&&this._callbacks.start(this._currentCount,t,this._startEvent)}_emitUpdate(t){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,t)&&this._callbacks.update(this._currentCount,t,this._startEvent)}_emitEnd(t){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,t)&&this._callbacks.end(this._currentCount,t,this._startEvent),this._startEvent=null}}class Mot extends Oa{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Aot({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(t,i){t===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this._state!=="failed"&&t===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(t){this._state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:b}of i.pointers.values())r=Math.max(r,_),s=Math.min(s,_),n=Math.max(n,b),o=Math.min(o,b);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:b}of t.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,b),h=Math.min(h,b);const p=r-s,f=n-o,m=a-l,y=c-h;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}}let Xp=class extends Te{constructor(){super(...arguments),this._handles=new Ii}destroy(){this._handles=Be(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return!!((e=this._inputManager)!=null&&e.hasPendingInputs)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e,t;return(t=(e=this._inputManager)==null?void 0:e.multiTouchActive)!=null?t:!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Be(this._inputManager)}connect(){const e=this.view;this._source=new C8(this.view.surface,e.input);const t=[new Eot,new Cot,new Sot,new xot(this.view.navigation),new Mot],i=new Mm({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new vot],P1.INTERNAL),this._modeDragPan=new gce(e,"primary"),this._modeDragRotate=new fz(e,"secondary",mu.CENTER),this._modeDragZoom=new Hnt(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new lot(e),new Vst(e),new Qnt(e),new eot(e,r.pan),new tot(e),new uot(e,r.resetTilt),new cot(e,r.resetHeading),new fz(e,"primary",mu.EYE,[r.lookAround]),new fz(e,"secondary",mu.CENTER,[r.lookAround]),new gce(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new hot(e)],P1.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(te(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},st))}_updateMode(){var r;const e=this.mode,t=this.primaryDragAction,i=(r=LX.get(e))==null?void 0:r.get(t);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],Xp.prototype,"view",void 0),u([d({value:"pan"})],Xp.prototype,"primaryDragAction",null),u([d({value:"default"})],Xp.prototype,"mode",null),u([d({readOnly:!0})],Xp.prototype,"hasPendingInputs",null),u([d()],Xp.prototype,"latestPointerType",null),u([d()],Xp.prototype,"latestPointerLocation",null),u([d()],Xp.prototype,"multiTouchActive",null),u([d()],Xp.prototype,"_inputManager",void 0),Xp=u([P("esri.views.3d.input.SceneInputManager")],Xp);const LX=new Map,yz=new Map,_z=new Map;yz.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),yz.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),_z.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),_z.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),LX.set("default",yz),LX.set("pro",_z);const Rot=Xp;let bh,AC,DX=!1,FX=!1,NX=!1,kX=!1,Q3=null;function Oot(e,t){if(!FX||!AC)return;_Ee();const i=AC;let r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];r+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),vEe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function Iot(e){NX=cr.DECONFLICTOR_SHOW_VISIBLE,kX=cr.DECONFLICTOR_SHOW_INVISIBLE,DX=NX||kX,FX=cr.DECONFLICTOR_SHOW_GRID,Q3=null,DX||FX?Q3=()=>Pot(e):bh&&(bh.parentElement.removeChild(bh),bh=null)}function _Ee(){Q3&&(Q3(),Q3=null)}function Pot(e){bh==null&&(bh=document.createElement("canvas"),bh.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(bh));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;bh.setAttribute("width",`${o}px`),bh.setAttribute("height",`${a}px`),bh.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),AC=bh.getContext("2d"),AC.clearRect(0,0,s,n),AC.font="12px Arial"}function vEe(e,t,i,r,s){_Ee();const n=bh.height,o=AC;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function $ot(e,t){DX&&(t&&NX||!t&&kX)&&vEe(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var wa,Tu;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(wa||(wa={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(Tu||(Tu={}));function bEe(e,t){return new A8(e,SEe,t)}function Lot(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=SEe;return new A8(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:vz.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:vz.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:vz.minPixelSize},t)}function Dot(e){return Math.abs(e*e*e)}function wEe(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return uR.scale=Math.min(r.divisor/(t-r.offset),1),uR.factor=Dot(e),uR.minPixelSize=r.minPixelSize,uR.paddingPixels=s,uR}function xEe(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function vee(e,t){return Math.max(zt(e*t.scale,e,t.factor),xEe(e,t))}function Fot(e,t,i){const r=wEe(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,vee(1,r)}function wce(e,t,i,r){r.scale=Fot(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function TEe(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,xEe(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function Not(e,t,i,r){return vee(e,wEe(t,i,r))}class A8{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(t,i,r,s=kot(),n){this._viewingMode=t,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===je.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this._ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new A8(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=t,c=this._calculateCurvatureDependentParameters(t,i),h=this._coverageCompensation(t,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),_=m/Math.cos(y),b=y+a*n*h,w=(_-f*(m/Math.cos(b)))/(1-f);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=w,r.divisor=_-w,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(t,i,r=xce){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,i,r=xce){const s=this._description.curvatureDependent,n=1+t.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=ye((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return r.tiltAngle=zt(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=zt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(t,i,r){return(t.fovY-r.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}}const SEe={curvatureDependent:{min:{curvature:Wt(10),tiltAngle:Wt(12),scaleFallOffFactor:.5},max:{curvature:Wt(70),tiltAngle:Wt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},vz={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function kot(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const uR={scale:0,factor:0,minPixelSize:0,paddingPixels:0},xce={tiltAngle:0,scaleFallOffFactor:0};function Uot(e){return e instanceof Float32Array&&e.length>=16}function Vot(e){return Array.isArray(e)&&e.length>=16}function Bot(e){return Uot(e)||Vot(e)}function bee(e){e.vertex.code.add(x`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(x`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(x`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(x`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(x`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(x`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(x`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function zot(e){e.uniforms.add(new xi("screenSizePerspective",t=>EEe(t.screenSizePerspective)))}function M8(e){e.uniforms.add(new xi("screenSizePerspectiveAlignment",t=>EEe(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function EEe(e){return mr(Got,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const Got=ui();class CEe extends Zs{constructor(t,i){super(t,"mat4",Ar.Draw,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}function zf(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",dl):e.uniforms.add(new Uh("cameraPosition",(i,r)=>ue(AEe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Pu(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add([new ds("proj",(r,s)=>s.camera.projectionMatrix),new CEe("view",(r,s)=>Vc(Tce,s.camera.viewMatrix,r.origin)),new Uh("localOrigin",r=>r.origin)]);const i=r=>ue(AEe,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);e.uniforms.add([new ds("proj",(r,s)=>s.camera.projectionMatrix),new ds("view",(r,s)=>Vc(Tce,s.camera.viewMatrix,i(s))),new Jt("localOrigin",(r,s)=>i(s))])}const Tce=v$(),AEe=O();function DA(e){e.uniforms.add(new ds("viewNormal",(t,i)=>i.camera.viewInverseTransposeMatrix))}function MEe(e,t){const i=e.vertex;t.hasVerticalOffset?(REe(i),t.hasScreenSizePerspective&&(e.include(bee),M8(i),zf(e.vertex,t)),i.code.add(x`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?x`vec3 worldNormal = normalize(worldPos + localOrigin);`:x`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?x`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:x`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(x`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const jot=ui();function REe(e){e.uniforms.add(new xi("verticalOffset",(t,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return mr(jot,n*a,o,r,s)}))}var mh;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(mh||(mh={}));var $c;function OEe(e,t){e.include(bee),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.NORMAL,"vec3"),e.attributes.add(R.AUXPOS1,"vec4");const i=e.vertex;Pu(i,t),zf(i,t),i.uniforms.add([new xi("viewport",(r,s)=>s.camera.fullViewport),new Ie("polygonOffset",r=>r.shaderPolygonOffset),new Ie("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1),new Ie("renderTransparentlyOccludedHUD",(r,s)=>s.renderTransparentlyOccludedHUD===mh.Occluded?1:s.renderTransparentlyOccludedHUD===mh.NotOccluded?0:.75),new Lt("hudVisibilityTexture",(r,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&REe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(x`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(x`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||DA(i),t.isDraped||(i.uniforms.add(new Ie("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(x`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===$c.Screen&&i.uniforms.add(new Ie("pixelRatio",(r,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&M8(i),i.code.add(x`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===$c.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?x`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==$c.Screen?x`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===$c.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===$c.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(x`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})($c||($c={}));const zD=ho();function IEe(e,t,i,r,s,n){if(e.visible)if(e.boundingInfo){vt(e.type===hn.Mesh);const o=t.tolerance;PEe(e.boundingInfo,i,r,o,s,n)}else{const o=e.indices.get(R.POSITION),a=e.vertexAttributes.get(R.POSITION);z$(i,r,0,o.length/3,o,a,void 0,s,n)}}const Hot=O();function PEe(e,t,i,r,s,n){if(C(e))return;const o=LEe(t,i,Hot);if($ye(zD,e.bbMin),Lye(zD,e.bbMax),v(s)&&s.applyToAabb(zD),xee(zD,t,o,r)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>Yot){const p=e.getChildren();if(p!==void 0){for(const f of p)PEe(f,t,i,r,s,n);return}}z$(t,i,0,h,l,c,a,s,n)}}const $Ee=O();function z$(e,t,i,r,s,n,o,a,l){if(o)return qot(e,t,i,r,s,n,o,a,l);const{data:c,stride:h}=n,p=e[0],f=e[1],m=e[2],y=t[0]-p,_=t[1]-f,b=t[2]-m;for(let w=i,T=3*i;w<r;++w){let S=h*s[T++],E=c[S++],M=c[S++],A=c[S];S=h*s[T++];let $=c[S++],I=c[S++],k=c[S];S=h*s[T++];let V=c[S++],B=c[S++],G=c[S];v(a)&&([E,M,A]=a.applyToVertex(E,M,A,w),[$,I,k]=a.applyToVertex($,I,k,w),[V,B,G]=a.applyToVertex(V,B,G,w));const X=$-E,K=I-M,re=k-A,q=V-E,L=B-M,N=G-A,U=_*N-L*b,W=b*q-N*y,Z=y*L-q*_,ie=X*U+K*W+re*Z;if(Math.abs(ie)<=Number.EPSILON)continue;const Y=p-E,ce=f-M,pe=m-A,ve=Y*U+ce*W+pe*Z;if(ie>0){if(ve<0||ve>ie)continue}else if(ve>0||ve<ie)continue;const Se=ce*re-K*pe,We=pe*X-re*Y,Ne=Y*K-X*ce,xe=y*Se+_*We+b*Ne;if(ie>0){if(xe<0||ve+xe>ie)continue}else if(xe>0||ve+xe<ie)continue;const ke=(q*Se+L*We+N*Ne)/ie;ke>=0&&l(ke,wee(X,K,re,q,L,N,$Ee),w,!1)}}function qot(e,t,i,r,s,n,o,a,l){const{data:c,stride:h}=n,p=e[0],f=e[1],m=e[2],y=t[0]-p,_=t[1]-f,b=t[2]-m;for(let w=i;w<r;++w){const T=o[w];let S=3*T,E=h*s[S++],M=c[E++],A=c[E++],$=c[E];E=h*s[S++];let I=c[E++],k=c[E++],V=c[E];E=h*s[S];let B=c[E++],G=c[E++],X=c[E];v(a)&&([M,A,$]=a.applyToVertex(M,A,$,w),[I,k,V]=a.applyToVertex(I,k,V,w),[B,G,X]=a.applyToVertex(B,G,X,w));const K=I-M,re=k-A,q=V-$,L=B-M,N=G-A,U=X-$,W=_*U-N*b,Z=b*L-U*y,ie=y*N-L*_,Y=K*W+re*Z+q*ie;if(Math.abs(Y)<=Number.EPSILON)continue;const ce=p-M,pe=f-A,ve=m-$,Se=ce*W+pe*Z+ve*ie;if(Y>0){if(Se<0||Se>Y)continue}else if(Se>0||Se<Y)continue;const We=pe*q-re*ve,Ne=ve*K-q*ce,xe=ce*re-K*pe,ke=y*We+_*Ne+b*xe;if(Y>0){if(ke<0||Se+ke>Y)continue}else if(ke>0||Se+ke<Y)continue;const Ve=(L*We+N*Ne+U*xe)/Y;Ve>=0&&l(Ve,wee(K,re,q,L,N,U,$Ee),T,!1)}}const Sce=O(),Ece=O();function wee(e,t,i,r,s,n,o){return ue(Sce,e,t,i),ue(Ece,r,s,n),_t(o,Sce,Ece),be(o,o),o}function LEe(e,t,i){return ue(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function xee(e,t,i,r){return Tee(e,t,i,r,1/0)}function Tee(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-r-t[2])*i[2],f=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function DEe(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;v(s)&&(n=Not(n,r,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return ye(o*t,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function FEe(e,t){const i=t?FEe(t):{};for(const r in e){let s=e[r];s&&s.forEach&&(s=Xot(s)),s==null&&r in i||(i[r]=s)}return i}function Wot(e,t){let i=!1;for(const r in t){const s=t[r];s!==void 0&&(Array.isArray(s)?e[r]===null?(e[r]=s.slice(),i=!0):eZ(e[r],s)&&(i=!0):e[r]!==s&&(i=!0,e[r]=s))}return i}function Xot(e){const t=[];return e.forEach(i=>t.push(i)),t}const NEe={multiply:1,ignore:2,replace:3,tint:4},Yot=1e3;class _b extends k${constructor(t,i){super(),this.type=hn.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=ji,this._pp0=Le(0,0,1),this._pp1=Le(0,0,0),this._parameters=FEe(t,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,i=!0){Wot(this._parameters,t)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleForOutput(t.output)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleForOutput(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){v(this.repository)&&this.repository.materialChanged(this)}intersectDraped(t,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(t,i,r,this._pp0,this._pp1,n)}}class kEe extends utt{constructor(t,i,r){super(i,r),this.camera=t}}var Is;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(Is||(Is={}));class CM extends Rr{constructor(){super(...arguments),this.renderOccluded=Is.Occlude}}class UEe{constructor(){this.factor=new Cce,this.factorAlignment=new Cce}}class Cce{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}}function t3t(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=t[e[l]],r+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function Zot(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let a=0;a<o;++a){const l=2*e[a];s[r]=t[l],s[r+1]=t[l+1],r+=n}}function VEe(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}}function FA(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}}function Ace(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride;t*=s;for(let n=0;n<i;++n)r[t]=0,r[t+1]=0,r[t+2]=0,r[t+3]=0,t+=s}function R8(e,t,i,r,s,n=1){if(!i)return void VEe(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,c=i[0],h=i[1],p=i[2],f=i[4],m=i[5],y=i[6],_=i[8],b=i[9],w=i[10],T=i[12],S=i[13],E=i[14];s*=a;let M=0,A=0,$=0;const I=uU(i)?k=>{M=t[k]+T,A=t[k+1]+S,$=t[k+2]+E}:k=>{const V=t[k],B=t[k+1],G=t[k+2];M=c*V+f*B+_*G+T,A=h*V+m*B+b*G+S,$=p*V+y*B+w*G+E};if(n===1)for(let k=0;k<l;++k)I(3*e[k]),o[s]=M,o[s+1]=A,o[s+2]=$,s+=a;else for(let k=0;k<l;++k){I(3*e[k]);for(let V=0;V<n;++V)o[s]=M,o[s+1]=A,o[s+2]=$,s+=a}}function See(e,t,i,r,s,n=1){if(!i)return void VEe(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],b=o[8],w=o[9],T=o[10],S=!zJ(o),E=1e-6,M=1-E;s*=l;let A=0,$=0,I=0;const k=uU(o)?V=>{A=t[V],$=t[V+1],I=t[V+2]}:V=>{const B=t[V],G=t[V+1],X=t[V+2];A=h*B+m*G+b*X,$=p*B+y*G+w*X,I=f*B+_*G+T*X};if(n===1)if(S)for(let V=0;V<c;++V){k(3*e[V]);const B=A*A+$*$+I*I;if(B<M&&B>E){const G=1/Math.sqrt(B);a[s]=A*G,a[s+1]=$*G,a[s+2]=I*G}else a[s]=A,a[s+1]=$,a[s+2]=I;s+=l}else for(let V=0;V<c;++V)k(3*e[V]),a[s]=A,a[s+1]=$,a[s+2]=I,s+=l;else for(let V=0;V<c;++V){if(k(3*e[V]),S){const B=A*A+$*$+I*I;if(B<M&&B>E){const G=1/Math.sqrt(B);A*=G,$*=G,I*=G}}for(let B=0;B<n;++B)a[s]=A,a[s+1]=$,a[s+2]=I,s+=l}}function Jot(e,t,i,r,s,n=1){if(!i)return void FA(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],b=o[8],w=o[9],T=o[10],S=!zJ(o),E=1e-6,M=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const $=4*e[A],I=t[$],k=t[$+1],V=t[$+2],B=t[$+3];let G=h*I+m*k+b*V,X=p*I+y*k+w*V,K=f*I+_*k+T*V;if(S){const re=G*G+X*X+K*K;if(re<M&&re>E){const q=1/Math.sqrt(re);G*=q,X*=q,K*=q}}a[s]=G,a[s+1]=X,a[s+2]=K,a[s+3]=B,s+=l}else for(let A=0;A<c;++A){const $=4*e[A],I=t[$],k=t[$+1],V=t[$+2],B=t[$+3];let G=h*I+m*k+b*V,X=p*I+y*k+w*V,K=f*I+_*k+T*V;if(S){const re=G*G+X*X+K*K;if(re<M&&re>E){const q=1/Math.sqrt(re);G*=q,X*=q,K*=q}}for(let re=0;re<n;++re)a[s]=G,a[s+1]=X,a[s+2]=K,a[s+3]=B,s+=l}}function Eee(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,i!==t.length||i!==4)if(n!==1)if(i!==4)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else{if(i===4){for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else{o[s]=t[0],o[s+1]=t[1],o[s+2]=t[2],o[s+3]=t[3];const c=new Uint32Array(r.typedBuffer.buffer,r.start),h=a/4,p=c[s/=4];s+=h;const f=l*n;for(let m=1;m<f;++m)c[s]=p,s+=h}}function BEe(e,t,i,r,s=1){const n=t.typedBuffer,o=t.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=e[0],n[r+1]=e[1],n[r+2]=e[2],n[r+3]=e[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=e[0],n[r+1]=e[1],n[r+2]=e[2],n[r+3]=e[3],r+=o}function zEe(e,t,i,r,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case R.POSITION:{vt(a.size===3);const c=s.getField(o,Mr);vt(!!c,`No buffer view for ${o}`),c&&R8(l,a.data,i,c,n);break}case R.NORMAL:{vt(a.size===3);const c=s.getField(o,Mr);vt(!!c,`No buffer view for ${o}`),c&&See(l,a.data,r,c,n);break}case R.UV0:{vt(a.size===2);const c=s.getField(o,hp);vt(!!c,`No buffer view for ${o}`),c&&Zot(l,a.data,c,n);break}case R.COLOR:case R.SYMBOLCOLOR:{vt(a.size===3||a.size===4);const c=s.getField(o,ta);vt(!!c,`No buffer view for ${o}`),c&&Eee(l,a.data,a.size,c,n);break}case R.TANGENT:{vt(a.size===4);const c=s.getField(o,_l);vt(!!c,`No buffer view for ${o}`),c&&Jot(l,a.data,r,c,n);break}case R.PROFILERIGHT:case R.PROFILEUP:case R.PROFILEVERTEXANDNORMAL:case R.FEATUREVALUE:{vt(a.size===4);const c=s.getField(o,_l);vt(!!c,`No buffer view for ${o}`),c&&FA(l,a.data,c,n)}}else if(o===R.OBJECTANDLAYERIDCOLOR&&v(e.objectAndLayerIdColor)){const c=e.indices.get(R.POSITION);if(vt(!!c,`No buffer view for ${o}`),c){const h=c.length,p=s.getField(o,ta);BEe(e.objectAndLayerIdColor,p,h,n)}}}}function RP(e,t,i=0){const r=ye(e,0,eat);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*tat(r*Kot[s]))}function Cee(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*Qot[r];return i}const Kot=[1,256,65536,16777216],Qot=[1/256,1/65536,1/16777216,1/4294967296],eat=Cee(new Uint8ClampedArray([255,255,255,255]));function tat(e){return e-Math.floor(e)}async function k0(e,t){const{data:i}=await _r(e,{responseType:"image",...t});return i}class Aee extends Rr{constructor(){super(...arguments),this.color=Yt(1,1,1,1)}}function iat(){const e=new Yi;return e.include(mp),e.fragment.uniforms.add([new Lt("tex",t=>t.texture),new xi("uColor",t=>t.color)]),e.fragment.code.add(x`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const rat=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Aee,build:iat},Symbol.toStringTag,{value:"Module"}));function sat(){if(C(bz)){const e=t=>Vi(`esri/libs/basisu/${t}`);bz=Q(()=>import("./basis_transcoder.73b61ed2.js"),["assets/basis_transcoder.73b61ed2.js","assets/_commonjsHelpers.4421ccc9.js"]).then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(i=>(i.initializeBasis(),delete i.then,i)))}return bz}let bz;var Sx;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(Sx||(Sx={}));let Of=null,GD=null;async function GEe(){return C(GD)&&(GD=sat(),Of=await GD),GD}function nat(e,t){if(C(Of))return e.byteLength;const i=new Of.BasisFile(new Uint8Array(e)),r=HEe(i)?jEe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function oat(e,t){if(C(Of))return e.byteLength;const i=new Of.KTX2File(new Uint8Array(e)),r=qEe(i)?jEe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function jEe(e,t,i,r,s){const n=fSe(t?an.COMPRESSED_RGBA8_ETC2_EAC:an.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function HEe(e){return e.getNumImages()>=1&&!e.isUASTC()}function qEe(e){return e.getFaces()>=1&&e.isETC1S()}async function aat(e,t,i){C(Of)&&(Of=await GEe());const r=new Of.BasisFile(new Uint8Array(i));if(!HEe(r))return null;r.startTranscoding();const s=WEe(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function lat(e,t,i){C(Of)&&(Of=await GEe());const r=new Of.KTX2File(new Uint8Array(i));if(!qEe(r))return null;r.startTranscoding();const s=WEe(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function WEe(e,t,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?r?[Sx.ETC2_RGBA,an.COMPRESSED_RGBA8_ETC2_EAC]:[Sx.ETC1_RGB,an.COMPRESSED_RGB8_ETC2]:c?r?[Sx.BC3_RGBA,an.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Sx.BC1_RGB,an.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Sx.RGBA32,ze.RGBA],f=t.hasMipmap?i:Math.min(1,i),m=[];for(let w=0;w<f;w++)m.push(new Uint8Array(o(w,h))),a(w,h,m[w]);const y=m.length>1,_=y?nt.LINEAR_MIPMAP_LINEAR:nt.LINEAR,b={...t,samplingMode:_,hasMipmap:y,internalFormat:p,width:s,height:n};return new pt(e,b,{type:"compressed",levels:m})}const hR=se.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),cat=542327876,uat=131072,hat=4;function Mee(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function dat(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const pat=Mee("DXT1"),fat=Mee("DXT3"),mat=Mee("DXT5"),gat=31,yat=0,_at=1,vat=2,bat=3,wat=4,xat=7,Tat=20,Sat=21;function Eat(e,t,i){var a;const{textureData:r,internalFormat:s,width:n,height:o}=ba(Cat(i,(a=t.hasMipmap)!=null?a:!1));return t.samplingMode=r.levels.length>1?nt.LINEAR_MIPMAP_LINEAR:nt.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new pt(e,t,r)}function Cat(e,t){const i=new Int32Array(e,0,gat);if(i[yat]!==cat)return hR.error("Invalid magic number in DDS header"),null;if(!(i[Tat]&hat))return hR.error("Unsupported format, must contain a FourCC code"),null;const r=i[Sat];let s,n;switch(r){case pat:s=8,n=an.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case fat:s=16,n=an.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case mat:s=16,n=an.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return hR.error("Unsupported FourCC code:",dat(r)),null}let o=1,a=i[wat],l=i[bat];(3&a)==0&&(3&l)==0||(hR.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;i[vat]&uat&&t!==!1&&(o=Math.max(1,i[xat])),o===1||$f(a)&&$f(l)||(hR.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=i[_at]+4;const y=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}class If extends k${constructor(t,i){super(),this._data=t,this.type=hn.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new ps,this._passParameters=new Aee,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:Pt.REPEAT,t:Pt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||$1.STRETCH,this.estimatedTexMemRequired=If._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const t=this._data;C(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(QC(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const i=!t.paused;if(t.src=t.src,i&&t.autoplay){const r=()=>{t.removeEventListener("canplay",r),t.play()};t.addEventListener("canplay",r)}}}_startPreloadImageElement(t){Ug(t.src)||QC(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,i){if(C(t))return 0;if(IM(t)||ux(t))return i.encoding===n0.KTX2_ENCODING?oat(t,!!i.mipmap):i.encoding===n0.BASIS_ENCODING?nat(t,!!i.mipmap):t.byteLength;const{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?If._getDataDimensions(t):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var i;return{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?nt.LINEAR_MIPMAP_LINEAR:nt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(i=this.params.maxAnisotropy)!=null?i:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,i){if(v(this._glTexture))return this._glTexture;if(v(this._loadingPromise))return this._loadingPromise;const r=this._data;return C(r)?(this._glTexture=new pt(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,i,r):r instanceof Image?this._loadFromImageElement(t,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,i):(IM(r)||ux(r))&&this.params.encoding===n0.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(t,r)):(IM(r)||ux(r))&&this.params.encoding===n0.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(t,r)):(IM(r)||ux(r))&&this.params.encoding===n0.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(t,r)):ux(r)?this._loadFromPixelData(t,r):IM(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(t,i,r){if(!(this._data instanceof HTMLVideoElement)||C(this._glTexture)||this._data.readyState<eI.HAVE_CURRENT_DATA||r===this._data.currentTime)return r;if(v(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this._data),this._drawStretchedTexture(t,i,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this._data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(t,i){return this._glTexture=Eat(t,this._createDescriptor(t),i),this._glTexture}_loadFromKTX2(t,i){return this._loadAsync(()=>lat(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(t,i){return this._loadAsync(()=>aat(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(t,i){vt(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=this.params.components===1?ze.LUMINANCE:this.params.components===3?ze.RGB:ze.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new pt(t,r,i),this._glTexture}_loadFromURL(t,i,r){return this._loadAsync(async s=>{const n=await k0(r,{signal:s});return ii(s),this._loadFromImage(t,n,i)})}_loadFromImageElement(t,i,r){return r.complete?this._loadFromImage(t,r,i):this._loadAsync(async s=>{const n=await a0e(r,r.src,!1,s);return ii(s),this._loadFromImage(t,n,i)})}_loadFromVideoElement(t,i,r){return r.readyState>=eI.HAVE_CURRENT_DATA?this._loadFromImage(t,r,i):this._loadFromVideoElementAsync(t,i,r)}_loadFromVideoElementAsync(t,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),hs(h)},l=()=>{r.readyState>=eI.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,r,i)))},c=p=>{a(),o(p||new H("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=fl(s,()=>c(lr()))}))}_loadFromImage(t,i,r){const s=If._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?ze.RGB:ze.RGBA,!this._requiresPowerOfTwo(t,n)||$f(s.width)&&$f(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new pt(t,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,i,s,n,r),this._glTexture)}_loadAsync(t){const i=new AbortController;this._loadingController=i;const r=t(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(t,i){const r=Pt.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return t.type===Tt.WEBGL1&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(t,i,r,s,n){const{width:o,height:a}=r,l=kC(o),c=kC(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case $1.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new pt(t,s),h.updateData(0,0,0,o,a,i);break;case $1.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,i,r,s){const n=new pt(t,r),o=new Yr(t,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},n),a=new pt(t,{target:St.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=Tl(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,i,r,s,n,o){this._passParameters.texture=n,t.bindFramebuffer(r);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height),t.bindTechnique(i,this._passParameters,null),t.bindVAO(s),t.drawArrays(Nt.TRIANGLE_STRIP,0,ja(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height),this._passParameters.texture=null}unload(){if(v(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(v(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),v(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var eI;(function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(eI||(eI={}));const OP=128,Ree=.5;function XEe(e,t=OP,i=t*Ree,r=0){const s=Aat(e,t,i,r);return new If(s,{mipmap:!1,wrap:{s:Pt.CLAMP_TO_EDGE,t:Pt.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function Aat(e,t=OP,i=t*Ree,r=0){switch(e){case"circle":default:return Mat(t,i);case"square":return Rat(t,i);case"cross":return Iat(t,i,r);case"x":return Pat(t,i,r);case"kite":return Oat(t,i);case"triangle":return $at(t,i);case"arrow":return Lat(t,i)}}function Mat(e,t){const i=e/2-.5;return G$(e,JEe(i,i,t/2))}function Rat(e,t){return YEe(e,t,!1)}function Oat(e,t){return YEe(e,t,!0)}function Iat(e,t,i=0){return ZEe(e,t,!1,i)}function Pat(e,t,i=0){return ZEe(e,t,!0,i)}function $at(e,t){return G$(e,KEe(e/2,t,t/2))}function Lat(e,t){const i=t,r=t/2,s=e/2,n=.8*i,o=JEe(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),a=KEe(s,i,r);return G$(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function YEe(e,t,i){return i&&(t/=Math.SQRT2),G$(e,(r,s)=>{let n=r-.5*e+.25,o=.5*e-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function ZEe(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return G$(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function JEe(e,t,i){return(r,s)=>{const n=r-e,o=s-t;return Math.sqrt(n*n+o*o)-i}}function KEe(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const o=Math.abs(s-e)-i,a=n-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function G$(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const n=s+e*r;let o=t(s,r);o=o/e+.5,RP(o,i,4*n)}return i}class i3t extends Rr{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function Dat(e,t){QEe(e,t,[new Jt("slicePlaneOrigin",(i,r)=>rCe(t,i,r)),new Jt("slicePlaneBasis1",(i,r)=>{var s;return Bk(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Jt("slicePlaneBasis2",(i,r)=>{var s;return Bk(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function An(e,t){QEe(e,t,[new Uh("slicePlaneOrigin",(i,r)=>rCe(t,i,r)),new Uh("slicePlaneBasis1",(i,r)=>{var s;return Bk(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Uh("slicePlaneBasis2",(i,r)=>{var s;return Bk(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function QEe(e,t,i){if(!t.hasSlicePlane){const o=x`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=x`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=x`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?x`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:x`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function eCe(e,t,i){return e.instancedDoublePrecision?ue(Fat,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function tCe(e,t){return v(e)?me(zk,t.origin,e):t.origin}function iCe(e,t,i){return e.hasSliceTranslatedView?v(t)?Vc(Nat,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function rCe(e,t,i){if(C(i.slicePlane))return dl;const r=eCe(e,t,i),s=tCe(r,i.slicePlane),n=iCe(e,r,i);return v(n)?Ze(zk,s,n):s}function Bk(e,t,i,r){if(C(r)||C(i.slicePlane))return dl;const s=eCe(e,t,i),n=tCe(s,i.slicePlane),o=iCe(e,s,i);return v(o)?(fe(dR,r,n),Ze(zk,n,o),Ze(dR,dR,o),me(dR,dR,zk)):r}const Fat=O(),zk=O(),dR=O(),Nat=Pe();function O8(e,t){const i=t.output===z.ObjectAndLayerIdColor,r=t.objectAndLayerIdColorInstanced;i&&(e.varyings.add("objectAndLayerIdColorVarying","vec4"),r?e.attributes.add(R.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):e.attributes.add(R.OBJECTANDLAYERIDCOLOR,"vec4")),e.vertex.code.add(x`
     void forwardObjectAndLayerIdColor() {
      ${i?r?x`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:x`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:x``} }`),e.fragment.code.add(x`
      void outputObjectAndLayerIdColor() {
        ${i?x`gl_FragColor = objectAndLayerIdColorVarying;`:x``} }`)}function kat(e,t){const{vertex:i,fragment:r}=e;t.hasMultipassGeometry&&i.include(PSe),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(x`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?x`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&r.include(Wh),t.hasMultipassTerrain&&r.uniforms.add([...Rf("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture,t.hasWebGL2Context?fr.None:fr.InvSize),new tr("nearFar",(s,n)=>n.camera.nearFar)]),r.include(ku),r.code.add(x`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?x`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${Xl(t,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const Uat=Yt(1,1,0,1),sCe=Yt(1,0,1,1);function i_(e,t){e.fragment.uniforms.add(Rf("depthTex",(i,r)=>r.highlightDepthTexture,t.hasWebGL2Context?fr.None:fr.InvSize)),e.fragment.constants.add("occludedHighlightFlag","vec4",Uat).add("unoccludedHighlightFlag","vec4",sCe),e.fragment.code.add(x`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${Xl(t,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}class I8 extends Zs{constructor(t,i,r){super(t,"vec4",Ar.Pass,(s,n,o)=>s.setUniform4fv(t,i(n,o)),r)}}class cl extends Zs{constructor(t,i,r){super(t,"float",Ar.Pass,(s,n,o)=>s.setUniform1fv(t,i(n,o)),r)}}class Oee extends CM{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Le(1,1,1),this.vvSizeMaxSize=Le(100,100,100),this.vvSizeOffset=Le(0,0,0),this.vvSizeFactor=Le(1,1,1),this.vvSizeValue=Le(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Cs()}}const Pf=8;function MC(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(R.INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new Jt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Jt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Jt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Jt("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new Gg("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new Jt("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(x`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(x`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?x`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(x`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",Pf),t.hasVvInstancing&&i.uniforms.add([new cl("vvColorValues",r=>r.vvColorValues,Pf),new I8("vvColorColors",r=>r.vvColorColors,Pf)]),i.code.add(x`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?x`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(x`vec4 vvColor() { return vec4(1.0); }`)}const Gk=.1,qa=.001;function Vat(e){const t=new Yi,i=e.signedDistanceFieldEnabled;if(t.include(zQ),t.include(OEe,e),t.include(An,e),e.occlusionPass)return t.include(kat,e),t;const{vertex:r,fragment:s}=t;t.include(bee),s.include(ku),s.include(zg),t.include(MC,e),t.include(O8,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),r.uniforms.add([new xi("viewport",(c,h)=>h.camera.fullViewport),new tr("screenOffset",(c,h)=>di(nCe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new tr("anchorPosition",c=>jk(c)),new xi("materialColor",c=>c.color),new Ie("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new xi("outlineColor",c=>c.outlineColor)),s.uniforms.add([new xi("outlineColor",c=>Mce(c)?c.outlineColor:pg),new Ie("outlineSize",c=>Mce(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(zot(r),M8(r)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(R.UV0,"vec2"),t.attributes.add(R.COLOR,"vec4"),t.attributes.add(R.SIZE,"vec2"),t.attributes.add(R.AUXPOS2,"vec4"),r.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?x`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=x`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?i?x`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x`posProj += quadOffset;`;e.vvColor&&r.uniforms.add([new I8("vvColorColors",c=>c.vvColorColors,Pf),new cl("vvColorValues",c=>c.vvColorValues,Pf)]),r.uniforms.add(new tr("textureCoordinateScaleFactor",c=>v(c.texture)&&v(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:fbe)),r.code.add(x`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${e.output===z.ObjectAndLayerIdColor?x`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${x.float(qa)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.float(qa)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?x`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Lt("tex",c=>c.texture));const a=e.debugDrawLabelBorder?x`(isBorder > 0.0 ? 0.0 : ${x.float(Gk)})`:x.float(Gk),l=x`
    ${e.debugDrawLabelBorder?x`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?x`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${x.float(OP)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.float(qa)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?x`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===z.Alpha&&s.code.add(x`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===z.ObjectAndLayerIdColor&&s.code.add(x`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),e.output===z.Color&&s.code.add(x`
    void main() {
      ${l}
      ${e.transparencyPassType===Ct.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===z.Highlight&&(t.include(i_,e),s.code.add(x`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?x`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function Mce(e){return e.outlineColor[3]>0&&e.outlineSize>0}function jk(e,t=nCe){return e.textureIsSignedDistanceField?Bat(e.anchorPosition,e.distanceFieldBoundingBox,t):Mo(t,e.anchorPosition),t}function Bat(e,t,i){v(t)?di(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):di(i,0,0)}const nCe=tt(),zat=Object.freeze(Object.defineProperty({__proto__:null,build:Vat,calculateAnchorPosForRendering:jk},Symbol.toStringTag,{value:"Module"})),Vh=Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),Gat=qf(Ce.ONE,Ce.ONE),oCe=qf(Ce.ZERO,Ce.ONE_MINUS_SRC_ALPHA);function r_(e){return e===Ct.FrontFace?null:e===Ct.Alpha?oCe:Gat}function P8(e){return e===Ct.FrontFace?zc:null}const $8=5e5,L8={factor:-1,units:-2};function D8(e){return e?L8:null}function vb(e,t=Zr.LESS){return e===Ct.NONE||e===Ct.FrontFace?t:Zr.LEQUAL}class F8 extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2,i.spherical=t.viewingMode===je.Global}initializeProgram(t){return new Ji(t.rctx,F8.shader.get().build(this.configuration),ji)}_setPipelineState(t){const i=this.configuration,r=t===Ct.NONE,s=t===Ct.FrontFace,n=this.configuration.hasPolygonOffset?jat:null,o=(r||s)&&i.output!==z.Highlight&&(i.depthEnabled||i.occlusionPass)?zc:null;return Ht({blending:i.output===z.Color||i.output===z.Alpha||i.output===z.Highlight?r?Hat:r_(t):null,depthTest:{func:Zr.LEQUAL},depthWrite:o,colorWrite:si,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Nt.POINTS:Nt.TRIANGLES}}F8.shader=new Zi(zat,()=>Q(()=>import("./HUDMaterial.glsl.3ca5b71c.js"),[]));const jat={factor:0,units:-4},Hat=qf(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA);class _n extends qo{constructor(){super(...arguments),this.output=z.Color,this.screenCenterOffsetUnitsEnabled=$c.World,this.transparencyPassType=Ct.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}u([j({count:z.COUNT})],_n.prototype,"output",void 0),u([j({count:$c.COUNT})],_n.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j({count:Ct.COUNT})],_n.prototype,"transparencyPassType",void 0),u([j()],_n.prototype,"spherical",void 0),u([j()],_n.prototype,"occlusionTestEnabled",void 0),u([j()],_n.prototype,"signedDistanceFieldEnabled",void 0),u([j()],_n.prototype,"vvSize",void 0),u([j()],_n.prototype,"vvColor",void 0),u([j()],_n.prototype,"hasVerticalOffset",void 0),u([j()],_n.prototype,"hasScreenSizePerspective",void 0),u([j()],_n.prototype,"debugDrawLabelBorder",void 0),u([j()],_n.prototype,"binaryHighlightOcclusionEnabled",void 0),u([j()],_n.prototype,"hasSlicePlane",void 0),u([j()],_n.prototype,"hasPolygonOffset",void 0),u([j()],_n.prototype,"depthEnabled",void 0),u([j()],_n.prototype,"pixelSnappingEnabled",void 0),u([j()],_n.prototype,"isDraped",void 0),u([j()],_n.prototype,"hasMultipassGeometry",void 0),u([j()],_n.prototype,"hasMultipassTerrain",void 0),u([j()],_n.prototype,"cullAboveGround",void 0),u([j()],_n.prototype,"occlusionPass",void 0),u([j()],_n.prototype,"objectAndLayerIdColorInstanced",void 0),u([j({constValue:!0})],_n.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],_n.prototype,"hasVvInstancing",void 0);class NA extends _b{constructor(t){super(t,new tlt),this._configuration=new _n}getConfiguration(t,i){return this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?$c.Screen:$c.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=i.slot===Ee.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(t===z.Color||t===z.Alpha),t===z.Color&&(this._configuration.debugDrawLabelBorder=!!cr.LABELS_SHOW_BORDER),t===z.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(t,i,r,s,n,o){if(!r.options.selectionMode||!r.options.hud||!t.visible)return;const a=this.parameters;let l=1,c=1;if(cp(xz,i),v(t.shaderTransformer)){const T=t.shaderTransformer(Ice);l=T[0],c=T[5],Xat(xz)}const h=t.vertexAttributes.get(R.POSITION),p=t.vertexAttributes.get(R.SIZE),f=t.vertexAttributes.get(R.NORMAL),m=t.vertexAttributes.get(R.AUXPOS1);vt(h.size>=3);const y=r.point,_=r.camera,b=jk(a);l*=_.pixelRatio,c*=_.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<h.data.length/h.size;T++){const S=T*h.size;ue(Qa,h.data[S],h.data[S+1],h.data[S+2]),Ze(Qa,Qa,i);const E=T*p.size;R_[0]=p.data[E]*l,R_[1]=p.data[E+1]*c,Ze(Qa,Qa,_.viewMatrix);const M=T*m.size;if(ue(ju,m.data[M+0],m.data[M+1],m.data[M+2]),!w&&(Qa[0]+=ju[0],Qa[1]+=ju[1],ju[2]!==0)){const $=ju[2];be(ju,Qa),me(Qa,Qa,ae(ju,ju,$))}const A=T*f.size;if(ue(pR,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(pR,xz,_,Tz),this._applyVerticalOffsetTransformationView(Qa,Tz,_,wz),_.applyProjection(Qa,Rl),Rl[0]>-1){Rl[0]=Math.floor(Rl[0]),Rl[1]=Math.floor(Rl[1]),w&&(ju[0]||ju[1])&&(Rl[0]+=ju[0],ju[1]!==0&&(Rl[1]+=vee(ju[1],wz.factorAlignment)),_.unapplyProjection(Rl,Qa)),Rl[0]+=this.parameters.screenOffset[0],Rl[1]+=this.parameters.screenOffset[1],TEe(R_,wz.factor,R_);const $=Kat*_.pixelRatio;let I=0;if(a.textureIsSignedDistanceField&&(I=a.outlineSize*_.pixelRatio/2),y&&Rce(y,Rl[0],Rl[1],R_,$,I,a,b)){const k=r.ray;if(Ze(Oce,Qa,Ea(Jat,_.viewMatrix)),Rl[0]=y[0],Rl[1]=y[1],_.unprojectFromRenderScreen(Rl,Qa)){const V=O();le(V,k.direction);const B=1/Oe(V);ae(V,V,B),o(Vr(k.origin,Qa)*B,V,-1,!0,1,Oce)}}}}}intersectDraped(t,i,r,s,n,o){const a=t.vertexAttributes.get(R.POSITION),l=t.vertexAttributes.get(R.SIZE),c=this.parameters,h=jk(c);let p=1,f=1;if(v(t.shaderTransformer)){const y=t.shaderTransformer(Ice);p=y[0],f=y[5]}p*=t.screenToWorldRatio,f*=t.screenToWorldRatio;const m=Qat*t.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,b=a.data[_],w=a.data[_+1],T=y*l.size;R_[0]=l.data[T]*p,R_[1]=l.data[T+1]*f;let S=0;c.textureIsSignedDistanceField&&(S=c.outlineSize*t.screenToWorldRatio/2),Rce(s,b,w,R_,m,S,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new rlt(this)}_normalAndViewAngle(t,i,r,s){return Bot(i)&&(i=cp(Zat,i)),Eu(s.normal,t,i),Ze(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=_e(aCe,elt),s}_updateScaleInfo(t,i,r){const s=this.parameters;v(s.screenSizePerspective)?wce(r,i,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),v(s.screenSizePerspectiveAlignment)?wce(r,i,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,Tz);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,i,r,s,n){return this._applyCenterOffsetNDC(t,i,r,s),v(n)&&le(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(t,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return le(n,t);const c=ye(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ae(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,i,r,s){const n=Oe(t),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=ae(Qa,i.normal,o*a);return fe(s,t,l),s}_applyVerticalOffsetTransformationView(t,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Oe(t);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Oe(t),a=Ft(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=DEe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),ae(i.normal,i.normal,l),fe(t,t,i.normal)}_applyCenterOffsetView(t,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==t&&le(r,t),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(be(pR,r),fe(r,r,ae(pR,pR,i[2])))),r}_applyCenterOffsetNDC(t,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&le(s,t),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(t,i,r,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&le(s,t),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(t,i){if(i===z.Color||i===z.Alpha||i===z.Highlight||i===z.ObjectAndLayerIdColor){if(t===Ee.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:s}=this.parameters;return t===(r?Ee.LABEL_MATERIAL:Ee.HUD_MATERIAL)||s&&t===Ee.OCCLUSION_PIXELS}return!1}createGLMaterial(t){return new qat(t)}calculateRelativeScreenBounds(t,i,r=yi()){return Wat(this.parameters,t,i,r),r[2]=r[0]+t[0],r[3]=r[1]+t[1],r}}class qat extends SQ{constructor(t){super({...t,...t.material.parameters})}selectProgram(t){return this.ensureTechnique(F8,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}function Wat(e,t,i,r=Yat){return Mo(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function Xat(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function Rce(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&v(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const wz=new UEe,Yat=tt(),Qa=O(),pR=O(),Rl=ui(),aCe=O(),Oce=O(),xz=Cs(),Zat=Cs(),Jat=Pe(),ju=O(),Tz={normal:aCe,cosAngle:0},Ice=Pe(),Kat=1,Qat=2,R_=[0,0],elt=Le(0,0,1);class tlt extends ESe{constructor(){super(...arguments),this.renderOccluded=Is.Occlude,this.color=Yt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=er(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Yt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const lCe=As().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4u8(R.COLOR).vec2f(R.SIZE).vec4f(R.AUXPOS1).vec4f(R.AUXPOS2),ilt=lCe.clone().vec4u8(R.OBJECTANDLAYERIDCOLOR);class rlt{constructor(t){this._material=t,this.vertexBufferLayout=he("enable-feature:objectAndLayerId-rendering")?ilt:lCe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(R.POSITION).length}write(t,i,r,s,n){R8(r.indices.get(R.POSITION),r.vertexAttributes.get(R.POSITION).data,t,s.position,n,6),See(r.indices.get(R.NORMAL),r.vertexAttributes.get(R.NORMAL).data,i,s.normal,n,6);const o=r.vertexAttributes.get(R.UV0).data;let a,l,c,h;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],h=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let p=r.indices.get(R.POSITION).length,f=n;const m=s.uv0;for(let w=0;w<p;++w)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;Eee(r.indices.get(R.COLOR),r.vertexAttributes.get(R.COLOR).data,4,s.color,n,6);const y=r.indices.get(R.SIZE),_=r.vertexAttributes.get(R.SIZE).data;p=y.length;const b=s.size;f=n;for(let w=0;w<p;++w){const T=_[2*y[w]],S=_[2*y[w]+1];for(let E=0;E<6;++E)b.set(f,0,T),b.set(f,1,S),f+=1}if(r.indices.get(R.AUXPOS1)&&r.vertexAttributes.get(R.AUXPOS1)?FA(r.indices.get(R.AUXPOS1),r.vertexAttributes.get(R.AUXPOS1).data,s.auxpos1,n,6):Ace(s.auxpos1,n,6*p),r.indices.get(R.AUXPOS2)&&r.vertexAttributes.get(R.AUXPOS2)?FA(r.indices.get(R.AUXPOS2),r.vertexAttributes.get(R.AUXPOS2).data,s.auxpos2,n,6):Ace(s.auxpos2,n,6*p),v(r.objectAndLayerIdColor)&&r.indices.get(R.POSITION)){const w=r.indices.get(R.POSITION).length,T=s.getField(R.OBJECTANDLAYERIDCOLOR,ta);BEe(r.objectAndLayerIdColor,T,w,n,6)}}}const tm=O(),kS=ui(),fR=ui(),Sz=O(),slt=Pe(),nlt=Gn(),Ez=Xo(),olt=O(),alt=yi();class llt{constructor(){this.aabr=yi(),this.distance=0,this.culled=!1,this.visible=!1}}class clt{constructor(t,i){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info={}}}var du;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(du||(du={}));class cCe{constructor(){this.camera=new Ot,this.slicePlane=X0(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),oS(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let HE=class extends Te{get dirty(){return this._dirty}get state(){return this._state}constructor(e){super(e),this._dirty=!1,this._runningViewState=new cCe,this._state=du.Idle,this._active=new Map,this._visible=new Map,this._iterators=new plt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==du.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/du.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case du.Idle:this._startUpdate(),e.madeProgress();case du.Process:if(this._state=du.Process,!this._processActiveGraphics(e))return;case du.Sort:if(this._state=du.Sort,!this._sortVisibleGraphics(e))return;case du.Deconflict:if(this._state=du.Deconflict,!this._deconflictVisibleGraphics(e))return;default:Oot(this,this._visible),this._state=du.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(C(e)||e.type!=="object3d")return!1;const t=e.stageObject;if((t?t.geometries.length:0)!==1)return!1;const i=t==null?void 0:t.geometries[0];return(i==null?void 0:i.material)instanceof NA}_startUpdate(){Iot(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new llt,this._active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._visible.delete(e.graphics3DGraphic.graphic.uid),ult(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this._active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=aM(slt,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?nlt:null;let s=0;for(v(r)&&(Ze(r,dl,this._runningViewState.camera.viewMatrix),r[3]=dr(this.view.spatialReference).radius,s=Tbe(r,dl));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===wa.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),$ot(n,a)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Pce(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Pce(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=hlt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(wa.GRAPHIC,Tu.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);rp(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(C(a)){if(a=glt,this._getProjectionInfo(l,t,a),a.isOutsideScreen||this._isCulledBySlice(e,tm)||v(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!cr.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}C(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;Ze(tm,a,r.viewMatrix);const l=n.vertexAttributes,c=l.get(R.NORMAL).data,h=l.get(R.AUXPOS1).data;o.applyShaderOffsetsView(tm,c,s.transformation,h,r,i.scaleInfo,tm),mr(kS,tm[0],tm[1],tm[2],1),Ph(fR,kS,r.projectionMatrix),ae(i.positionNDC,fR,1/fR[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,Sz),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(Sz[2]),i.distance=Sz[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),mr(fR,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Ph(kS,fR,t),YA(kS,kS,1/kS[3]),ue(i.positionView,tm[0],tm[1],tm[2])}_isCulledByHorizon(e,t,i){return le(Ez.direction,e.positionView),ue(Ez.origin,0,0,0),!!gb(t,Ez,olt)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&OK(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(flt);TEe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=E5(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,alt),zt(0,n.fullWidth,.5+.5*r[0]),zt(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Mh(a),Ff(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}A1(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this._accBinsSizeX);r<=Math.floor(i.aabr[2]/this._accBinsSizeX);r++)if(!(r<0||r>=this._accBinsNumX))for(let s=Math.floor(i.aabr[1]/this._accBinsSizeY);s<=Math.floor(i.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,H6(l.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new ri)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=t/this._accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this._accBinsSizeX),r=Math.floor(t.aabr[2]/this._accBinsSizeX),s=Math.floor(t.aabr[1]/this._accBinsSizeY),n=Math.floor(t.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(Tu.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===wa.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function ult(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(Tu.DECONFLICTION,t)}function*Pce(e){if(Map.prototype.entries){const t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*hlt(e,t,i){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.visible=s.graphics3DGraphic.hasVisibilityFlag(Tu.DECONFLICTION,i),o.prio=s.info?s.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((s,n)=>s.visible!==n.visible?s.visible?-1:1:s.prio!==n.prio?s.prio-n.prio:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([d({constructOnly:!0})],HE.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],HE.prototype,"updating",null),HE=u([P("esri.views.3d.layers.graphics.Deconflictor")],HE);class dlt{}class plt{constructor(t=null,i=null,r=null){this.active=t,this.visible=i,this.sort=r,this.sortArray=new ri({allocator:s=>s||new dlt})}}const flt=tt();class mlt{constructor(){this.positionView=O(),this.positionNDC=O(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new UEe}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const glt=new mlt,ylt=2e3;let M4=class extends HE{constructor(e){super(e),this.visibilityGroup=wa.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Wa.YIELD;const t=performance.now();if(e.state!==Di.IDLE&&t-this._lastDeconfliction<ylt)return Wa.YIELD;super.runTask(e),this.state===du.Idle&&(this._lastDeconfliction=t)}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],M4.prototype,"parent",void 0),M4=u([P("esri.views.3d.layers.graphics.LabelDeconflictor")],M4);let UX=class extends HE{constructor(){super(...arguments),this._handles=new Ii,this._contexts=new Map,this._viewState=new cCe,this.visibilityGroup=wa.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([te(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),te(()=>{var e,t,i;return(i=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:i.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),te(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},st)]),this._frameTask=this.view.resourceController.scheduler.registerTask(xt.GRAPHICS_DECONFLICTOR,this),this._labels=new M4({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&Cz(e));t.setVisibilityFlag(Tu.DECONFLICTION,i,wa.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;v(e)&&kbe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=v(e)}_slicePlaneChanged(){za(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const t=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new clt(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),Cz(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=Cz(e);i||_lt(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.layers;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const t=this._contexts.get(e);if(t)return t;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function Cz(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function _lt(e){const t=e.graphics3DGraphics;t&&t.forEach(i=>i.clearVisibilityFlag(Tu.DECONFLICTION))}UX=u([P("esri.views.3d.layers.graphics.GraphicsDeconflictor")],UX);const Iee=(e,t,i)=>[t,i],kA=(e,t,i)=>[t,i,e[2]],Pee=(e,t,i)=>[t,i,e[2],e[3]];function r3t(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:v(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function vlt({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function blt({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function uCe({scale:e,translate:t},i){return i*e[0]+t[0]}function hCe({scale:e,translate:t},i){return t[1]-i*e[1]}function dCe(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=uCe(e,i[0][0]),a=hCe(e,i[0][1]);r[0]=t(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=t(c,o,a)}return r}function pCe(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=dCe(e,t,i[s]);return r}function wlt(e,t,i,r){return dCe(e,i?r?Pee:kA:r?kA:Iee,t)}function xlt(e,t,i,r){return pCe(e,i?r?Pee:kA:r?kA:Iee,t)}function Tlt(e,t,i,r){return pCe(e,i?r?Pee:kA:r?kA:Iee,t)}function s3t(e,t,i,r,s){return t.x=vlt(e,i.x),t.y=blt(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function fCe(e,t,i,r,s){return v(i)&&(t.points=wlt(e,i.points,r,s)),t}function mCe(e,t,i,r,s){return C(i)||(t.x=uCe(e,i.x),t.y=hCe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m))),t}function gCe(e,t,i,r,s){return v(i)&&(t.rings=Tlt(e,i.rings,r,s)),t}function yCe(e,t,i,r,s){return v(i)&&(t.paths=xlt(e,i.paths,r,s)),t}class n3t{constructor(t,i,r){this.uid=t,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function o3t(e){return v(e.geometry)}class a3t{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function l3t(e){var n,o;const t=Wge.fromJSON(e.geometryType),i=et.fromJSON(e.spatialReference),r=e.transform,s=e.features.map(a=>{const l=Slt(a,t,i,e.objectIdFieldName),c=l.geometry;if(v(c)&&r)switch(c.type){case"point":l.geometry=mCe(r,c,c,c.hasZ,c.hasM);break;case"multipoint":l.geometry=fCe(r,c,c,!!c.hasZ,!!c.hasM);break;case"polygon":l.geometry=gCe(r,c,c,!!c.hasZ,!!c.hasM);break;case"polyline":l.geometry=yCe(r,c,c,!!c.hasZ,!!c.hasM);break;case"extent":case"mesh":l.geometry=c}return l});return{geometryType:t,features:s,spatialReference:i,fields:(o=(n=e.fields)==null?void 0:n.map(a=>nU.fromJSON(a)))!=null?o:[],objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function Slt(e,t,i,r){return{uid:Ru(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:Elt(e.geometry,t,i),visible:!0}}function Elt(e,t,i){if(C(e))return null;switch(t){case"point":{const r=e;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=e;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=e;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=e;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function s_(e,t,i,r){return{x:e,y:t,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function Clt(e){if(C(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)i+=n.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=lL(e.vertexAttributes.position),t+=lL(e.vertexAttributes.normal),t+=lL(e.vertexAttributes.uv),t+=lL(e.vertexAttributes.tangent)}return t}function c3t(e){let t=32;return t+=tbe(e.attributes),t+=3,t+=8+Clt(e.geometry),t}function Alt(e){if(C(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function u3t(e){if(C(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function h3t(e,t){switch(Xr(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)u9(t,e.paths[i],!!e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)u9(t,e.rings[i],!!e.hasZ);break;case"multipoint":u9(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function Mlt(e,t){switch(rp(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)c9(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)c9(t,e.rings[i]);break;case"multipoint":c9(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function d3t(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}function _Ce(e){return"declaredClass"in e}function $ce(e){return"declaredClass"in e}function Rlt(e){return"declaredClass"in e}function Olt(e,t){return e?Rlt(e)?e:new Ko({layer:t,sourceLayer:t,visible:e.visible,symbol:ne(e.symbol),attributes:ne(e.attributes),geometry:vCe(e.geometry)}):null}function vCe(e){return C(e)?null:_Ce(e)?e:Jl(Ilt(e))}function Ilt(e){const{wkid:t,wkt:i,latestWkid:r}=e.spatialReference,s={wkid:t,wkt:i,latestWkid:r};switch(e.type){case"point":{const{x:n,y:o,z:a,m:l}=e;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=e;return{rings:Lce(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=e;return{paths:Lce(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y}=e;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=e;return{points:wCe(n)?bCe(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function Lce(e){return Plt(e)?e.map(t=>bCe(t)):e}function bCe(e){return e.map(t=>Array.from(t))}function Plt(e){for(const t of e)if(t.length!==0)return wCe(t);return!1}function wCe(e){return e.length>0&&(sZ(e[0])||nZ(e[0]))}function $lt(e,t){if(!e)return null;let i;if($ce(e)){if(t==null)return e.clone();if($ce(t))return t.copy(e)}return t!=null?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=void 0,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=s_(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}function p3t(e){const{wkid:t,wkt:i,latestWkid:r}=e,s={wkid:t,wkt:i,latestWkid:r};return et.fromJSON(s)}const Az=se.getLogger("esri.layers.support.labelFormatUtils"),Mz={type:"simple",evaluate:()=>null},Llt={getAttribute:(e,t)=>e.field(t)};async function xCe(e,t,i){if(!e||!e.symbol||!t)return Mz;const r=e.where,s=wU(e),n=r?await Q(()=>import("./WhereClause.fb4e6ae7.js").then(function(a){return a.W}),["assets/WhereClause.fb4e6ae7.js","assets/executionError.c4c51b90.js"]):null;let o;if(s.type==="arcade"){const a=await ALe(s.expression,i,t);if(C(a))return Mz;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{Az.error(new H("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>aK(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":TCe(p,h)})};if(r){let a;try{a=n.WhereClause.create(r,t)}catch(c){return Az.error(new H("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),Mz}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:Llt;try{if(a.testFeature(c,h))return l(c)}catch(p){Az.error(new H("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function TCe(e,t){if(e==null)return"";const i=t.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=e;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+e,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=e;return t.type==="date"||t.type==="esriFieldTypeDate"?r=Ou(r,XC("short-date")):U6(t)&&(r=Cg(+r)),r||""}var f3t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createLabelFunction:xCe,formatField:TCe});class SCe{constructor(t=null,i="center",r="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,p=0){this.verticalOffset=t,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=p}}function $ee(e,t){if(e.type==="point")return O_(e,t,!1);if(_Ce(e))switch(e.type){case"extent":return O_(e.center,t,!1);case"polygon":return O_(e.centroid,t,!1);case"polyline":return O_(Dce(e),t,!0);case"mesh":return O_(e.origin,t,!1)}else switch(e.type){case"extent":return O_(Dlt(e),t,!0);case"polygon":return O_(Flt(e),t,!0);case"polyline":return O_(Dce(e),t,!0)}}function Dce(e){const t=e.paths[0];if(!t||t.length===0)return null;const i=Ige(t,Oge(t)/2);return s_(i[0],i[1],i[2],e.spatialReference)}function Dlt(e){return s_(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),e.zmin!=null&&e.zmax!=null&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function Flt(e){const t=e.rings[0];if(!t||t.length===0)return null;const i=OZ(e.rings,!!e.hasZ);return s_(i[0],i[1],i[2],e.spatialReference)}function O_(e,t,i){const r=i?e:$lt(e);return t&&e?S9e(e,r,t)?r:null:r}function m3t(e,t,i,r=0){if(e){t||(t=yi());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),mr(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function ECe(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(R.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometries[i]))}}function tI(e,t){const i=y$(jd);return v(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),v(t)?i[3]=t:v(e)&&e.length>3&&(i[3]=e[3]),i}function g3t(e,t,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)v(e)&&e[o]!=null?n[o]=e[o]:v(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return v(t)?n[3]=t:v(r)?n[3]=r:n[3]=s[3],n}function Fce(e=sg,t,i,r=1){const s=new Array(3);if(C(t)||C(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=i[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return Rc(s)}function Nlt(e){return e.isPrimitive!=null}function N8(e){return Hk(Nlt(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function Hk(e){if(Array.isArray(e)){for(const t of e)if(!Hk(t))return!1;return!0}return e==null||e>=0}function klt(e,t,i,r=Pe()){const s=e||0,n=t||0,o=i||0;return s!==0&&sA(r,r,-s/180*Math.PI),n!==0&&rA(r,r,n/180*Math.PI),o!==0&&aU(r,r,o/180*Math.PI),r}function Lee(e,t,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=wl(t),s=QT(e)*r,n=eS(e)*r,o=pb(e)*(t.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}function CCe(e,t,i,r,s,n,o,a,l,c,h){const p=qlt[h.mode];let f,m,y=0;if(Xs(e,t,i,r,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),Xs(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function AM(e,t,i,r,s){const n=(Dk(e)?e.z:Z2e(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const o=Ft(ag(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Ft(ag(t,e,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Ft(ag(t,e,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Ft(ag(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function Ult(e,t,i,r){return AM(e,t,i,r,qE),qE.z}function j$(e,t,i){return t==null||i==null?e.definedChanged:t==="on-the-ground"&&i==="on-the-ground"?e.staysOnTheGround:t===i||t!=="on-the-ground"&&i!=="on-the-ground"?qs.UPDATE:e.onTheGroundChanged}function pp(e){return e==="relative-to-ground"||e==="relative-to-scene"}function ob(e){return e!=="absolute-height"}function Vlt(e,t,i,r,s){AM(t,i,s,r,qE),ECe(e,qE.verticalDistanceToGround);const n=qE.sampledElevation,o=Ao(Wlt,e.transformation);return jD[0]=t.x,jD[1]=t.y,jD[2]=qE.z,Uf(t.spatialReference,jD,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function Blt(e,t,i,r,s,n){let o=0;const a=n.spatialReference;t*=3,r*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],f=Ft(n.getElevation(c,h,p,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,t+=3,r+=3}return o/s}function zlt(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],_=e[t+2],b=Ft(n.getElevation(m,y,_,p,"ground"),0);l+=b,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?_+b+c:b+c,t+=3,r+=3}return l/s}function Glt(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],_=e[t+2],b=Ft(n.getElevation(m,y,_,p,"scene"),0);l+=b,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?_+b+c:b+c,t+=3,r+=3}return l/s}function jlt(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return t!==0||i!=null}function Hlt(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<s;++h){const p=e[t+0],f=e[t+1],m=e[t+2];i[r+0]=p,i[r+1]=f,i[r+2]=c==null?m+l:l,t+=3,r+=3}return 0}class H${constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var qs;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(qs||(qs={}));const qlt={"absolute-height":{applyElevationAlignmentBuffer:Hlt,requiresAlignment:jlt},"on-the-ground":{applyElevationAlignmentBuffer:Blt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:zlt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Glt,requiresAlignment:()=>!0}},Wlt=Pe(),qE=new H$,jD=O();function Dee(e){return v(e.mapPositions)}function ACe(e,t,i,r,s){const n=e.stageObject,o=n.geometries;let a=0;for(const l of o){if(!Dee(l))continue;const{update:c,averageGeometrySampledElevation:h}=RCe(l,t,i,r,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function IP(e,t,i,r,s){var p;const n=e.stageObject,o=t.centerPointInElevationSR;let a=0;(p=n.metadata)!=null&&p.usesVerticalDistanceToGround?(r(o,Ic),ECe(n,Ic.verticalDistanceToGround),a=Ic.sampledElevation):(r(o,Ic),t.mode!=="absolute-height"&&(a=Ic.sampledElevation));const l=Ao(Xlt,n.transformation),c=ue(MCe,l[12],l[13],l[14]);cr.TESTS_DISABLE_OPTIMIZATIONS?(Oc[0]=o.x,Oc[1]=o.y,Oc[2]=Ic.z,Uf(o.spatialReference,Oc,l,s.spatialReference)&&(n.transformation=l)):s.setAltitudeOfTransformation(Ic.z,l);const h=Fee/s.unitInMeters;return(Math.abs(l[12]-c[0])>=h||Math.abs(l[13]-c[1])>=h||Math.abs(l[14]-c[2])>=h)&&(n.transformation=l),a}const Xlt=Pe();function Ylt(e,t,i,r,s){const n=e.graphics3DSymbolLayer.lodRenderer;if(C(n))return 0;const o=t.centerPointInElevationSR;r(o,Ic);const a=t.mode!=="absolute-height"?Ic.sampledElevation:0,l=n.instanceData,c=e.instanceIndex,h=Jlt;l.getGlobalTransform(c,h);const p=ue(MCe,h[12],h[13],h[14]);cr.TESTS_DISABLE_OPTIMIZATIONS?(Oc[0]=o.x,Oc[1]=o.y,Oc[2]=Ic.z,Uf(o.spatialReference,Oc,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(Ic.z,h);const f=Fee/s.unitInMeters;return(cr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=f||Math.abs(h[13]-p[1])>=f||Math.abs(h[14]-p[2])>=f)&&l.setGlobalTransform(c,h),a}function Zlt(e,t,i,r,s){const n=e.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!Dee(p))continue;const f=p.vertexAttributes.get(R.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:y}=RCe(p,t,i,r,s);c=y,l=f,h=m}h&&n.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const Fee=.01,Oc=O(),td=O(),US=O(),Jlt=Pe(),MCe=O(),Ic=new H$;function RCe(e,t,i,r,s){let n=!1;const o=e.shaderTransformation,a=t.requiresSampledElevationInfo;td[0]=o[12],td[1]=o[13],td[2]=o[14],e.invalidateBoundingInfo();const l=e.getMutableAttribute(R.POSITION),c=l.data,h=l.size,p=c.length/h,f=new Y2e(e.mapPositions,i);let m=0,y=0;for(let _=0;_<p;_++){if(US[0]=c[m],US[1]=c[m+1],US[2]=c[m+2],r(f,Ic),a&&(y+=Ic.sampledElevation),cr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Ic.z,Xs(c,i,m,c,s.spatialReference,m,1),c[m]-=td[0],c[m+1]-=td[1],c[m+2]-=td[2],n=!0;else{Oc[0]=c[m]+td[0],Oc[1]=c[m+1]+td[1],Oc[2]=c[m+2]+td[2],s.setAltitude(Oc,Ic.z),c[m]=Oc[0]-td[0],c[m+1]=Oc[1]-td[1],c[m+2]=Oc[2]-td[2];const b=Fee/s.unitInMeters;(Math.abs(US[0]-c[m])>=b||Math.abs(US[1]-c[m+1])>=b||Math.abs(US[2]-c[m+2])>=b)&&(n=!0)}m+=h,f.offset+=3}return y/=p,{update:n,averageGeometrySampledElevation:y}}const Klt=se.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Qlt(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function y3t(e){const t=e&&e.expression;if(typeof t=="string"){const i=PCe(t);if(i!=null)return{cachedResult:i}}return null}async function _3t(e,t,i,r){const s=e&&e.expression;if(typeof s!="string")return null;const n=PCe(s);if(n!=null)return{cachedResult:n};const o=await Eg();ii(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:t}),modules:o}}}function OCe(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function Nee(e,t){if(e!=null&&!ICe(e)){if(!t||!e.arcade)return void Klt.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=vCe(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function ect(e){if(e!=null){if(ICe(e))return e.cachedResult;const t=e.arcade;let i=t==null?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof i!="number"&&(e.cachedResult=0,i=0),i}return 0}function v3t(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||r==="0"||(i=null),i!=null?i:null}const tct={cachedResult:0};function ICe(e){return e.cachedResult!=null}function PCe(e){return e==="0"?0:null}class Zh{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=A6e(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:t+r}calculateOffsetRenderUnits(t){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=ect(r)*this._metersPerElevationInfoUnit),i/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=C6e(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=Ft(t.offset,0)}updateFeatureExpressionInfoContext(t,i,r){if(C(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&v(i)&&v(r)?(this._featureExpressionInfoContext=Qlt(t),Nee(this._featureExpressionInfoContext,OCe(s.modules,i,r))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const i=new Zh;return v(t)&&i.setFromElevationInfo(t),i}}class ict{constructor(t,i,r){this.graphic=t,this.renderingInfo=i,this.layer=r}}var ci;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(ci||(ci={}));class rct{constructor(t,i,r){this.baseMaterial=t,this.edgeMaterials=i,this.properties=r}}class jg{get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}constructor(t,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(t,i){this._stageLayer=i,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),v(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,i){if(C(this._edgeState))return;const r=Nce(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,i){C(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!i),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this.stageObject.visible=t,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),v(this._edgeState))){const i=this._stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(t,i,r,s){if(this.elevationAligner==null)return;v(r)&&Nee(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>AM(o,t,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t.spatialReference,n,i),this._resetEdgeObject(s)}alignWithAbsoluteElevation(t,i,r){const s=(n,o)=>{o.sampledElevation=t,o.verticalDistanceToGround=0,o.z=t};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this._resetEdgeObject(r)}getCenterObjectSpace(t=O()){return le(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=ho()){const i=this.stageObject.boundingVolumeObjectSpace;return $ye(t,i.min),Lye(t,i.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;t.render.origin[0]+=i[12],t.render.origin[1]+=i[13],t.render.origin[2]+=i[14],t.render.num++}else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(sy)&&(Ze(sy,sy,this.stageObject.transformation),fe(t.render.origin,t.render.origin,sy),t.render.num++)}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=sct,l=eJ(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];I_[0]=o[p[0]],I_[1]=o[p[1]],I_[2]=o[p[2]],Ze(I_,I_,this.stageObject.transformation),Bb[3*h+0]=I_[0],Bb[3*h+1]=I_[1],Bb[3*h+2]=I_[2]}if(!t(Bb,0,l))return null;Xr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Bb[h+p]),o[p+3]=Math.max(o[p+3],Bb[h+p]);c&&r.push({location:Bb.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){yf(o,sy);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=Ft(i.service.getElevation(sy[0],sy[1],h),0);else try{const f=Lee(o,i.service.spatialReference,i);p=Ft(await i.service.queryElevation(sy[0],sy[1],s,f,h),0)}catch{}Pye(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,i){t===D0.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),t===D0.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(C(this._edgeState))return;const i=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,t):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,i){const r=this._edgeState;if(C(r))return;const s=Nce(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function Nce(e){return e.isVisible()?e.parameters.transparent?ci.TRANSPARENT:ci.OPAQUE:ci.INVISIBLE}const Bb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],I_=O(),sy=O(),sct=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];class $Ce{constructor(t,i=null){this.labelText=i,this.elevationOffset=Ft(t,0)}}var lo;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(lo||(lo={}));class kee{constructor(t){this.schedule=t,this._abortController=null,this._loadStatus=Th.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,i){return this._loadStatus===Th.LOADED?(t&&t(),Ft(this._loader,Promise.resolve())):this._loadStatus===Th.FAILED?(i&&i(this._loadError),Ft(this._loader,Promise.resolve())):(C(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Th.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Th.FAILED,!Ws(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(t,i).catch(()=>{}),this._loader)}abortLoad(){v(this._abortController)?this._abortController=ep(this._abortController):this._loadStatus===Th.LOADING&&(this._loadStatus=Th.FAILED),this._loader=null}}var Th;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(Th||(Th={}));const LCe=3,VX=3,DCe=10;class FCe{constructor(t,i=null){this.geometry=t,this.textures=i}}function HD(e){const t=[];return e.levels.forEach(i=>i.components.forEach(r=>t.push(r.geometry.material))),i$(t)}function kce(e){const t=new Array;return e.levels.forEach(i=>{i.components.forEach(r=>{v(r.textures)&&t.push(...r.textures)})}),i$(t)}function NCe(e){const t=e.components.map(i=>i.geometry);return i$(t)}function Uce(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.geometry)})}),i$(t)}function nct(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function kCe(e,t){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&Qet(a),{components:[new FCe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Zet(t,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Bet(t,1));case"cone":return i(Rz,r=>ele(t,1,.5,r,!1),!0);case"inverted-cone":return i(Rz,r=>ele(t,1,.5,r,!0),!0);case"cylinder":return i(Rz,r=>Ket(t,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Yet(t,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Het(t,1),!0);default:return}}const Rz=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function oct(e){return e.type==="fill"}function act(e){return e.type==="extrude"}function lct(e){return e&&e.enabled&&(act(e)||oct(e))&&v(e.edges)}function cct(e){return e&&e.enabled&&e.edges||null}function UCe(e,t){return uct(cct(e),t)}function uct(e,t){if(C(e))return null;const i=v(e.color)?AJ(De.toUnitRGBA(e.color)):Yt(0,0,0,0),r=$r(e.size),s=$r(e.extensionLength);switch(e.type){case"solid":return hct({color:i,size:r,extensionLength:s,...t});case"sketch":return dct({color:i,size:r,extensionLength:s,...t});default:return}}function hct(e){return{...pct,...e,type:"solid"}}function dct(e){return{...fct,...e,type:"sketch"}}const pct={color:Yt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ci.OPAQUE,hasSlicePlane:!1},fct={color:Yt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ci.OPAQUE,hasSlicePlane:!1},Uee={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function b3t(e){return e.type==="web-style"?Uee:Vee(e.symbolLayers.toArray().map(t=>VCe(e,t)))}function Vee(e){let t=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)C(a)||(t+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function w3t(e){const t=Vee(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Vce={};function VCe(e,t){var s;const i=BCe(e,t),r=lct(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:v(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:{...mct(t.resource&&t.resource.primitive||fJ),memory:i};case"path":{let n=0,o=0;switch(t.profile){case"circle":n=DCe;break;case"quad":n=4;break;default:return void(t.profile,void 0)}switch((s=t.join)!=null?s:"simple"){case"round":o=LCe;break;case"miter":case"bevel":o=1;break;default:return}const a=2*n,l=n*o*2;let c=-2*l-a;switch(t.cap){case"none":break;case"butt":case"square":c+=2*(n-1);break;case"round":c+=2*(n*(VX-1)*2+n);break;default:return}return{primitivesPerFeature:c,primitivesPerCoordinate:l+a,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function BCe(e,t){const i=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?oc.EXTRUDE_EDGES:oc.EXTRUDE;case"fill":return v(t.outline)&&t.outline.size>0?oc.FILL_OUTLINE:oc.FILL;case"water":return oc.FILL;case"line":return t.join==="round"?oc.LINE_ROUND:oc.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return oc.PATH_ROUND_CIRCLE;case"quad":return oc.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return oc.PATH_MITER_CIRCLE;case"quad":return oc.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return}case"object":return i?oc.OBJECT_POINT:oc.OBJECT_POLYGON;case"icon":case"text":return i?oc.ICON_POINT:oc.ICON_POLYGON;default:return}}function mct(e){let t=Vce[e];if(t)return t;const i=kCe(e,null);return t={primitivesPerFeature:NCe(i.levels[0]).reduce((r,s)=>r+s.indices.get(R.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Vce[e]=t,t}const oc={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}},VS=se.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class Hg extends kee{constructor(t,i,r,s){super(r.schedule),this.symbol=t,this.symbolLayer=i,this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=VS,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Zh,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Bce(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=Bce(t);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,i,r,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&VS.warnOncePerTick(l)}_logGeometryValidationWarnings(t,i,r){const s=`${r} geometry failed to be created`;return!t.length||t.length===1&&!t[0].length?(VS.warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(t)||!Array.isArray(t[0]))&&(VS.warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(t,i=null,r=null){if(v(i)&&!i.includes(t.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return VS.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return gct}_defaultElevationInfoZ(){return yct}_updateElevationContext(){v(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,i=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,i){const r=t.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=Ft(this._elevationContext.meterUnitOffset,Ft(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?tct:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,t,this._context.layer),i}prepareSymbolLayerPatch(t){}updateGeometry(t,i){return!1}onRemoveGraphic(t){}_getLayerOpacity(){var i;if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return(i=this._context.graphicsCoreOwner.fullOpacity)!=null?i:0;const t=this._context.layer.opacity;return t!=null?t:1}_getCombinedOpacity(t,i=zce){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(v(t)?r*=t.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(t,i=zce){const r=this._getCombinedOpacity(t,i);if(this._drivenProperties.color)return tI(null,r);const s=v(t)?De.toUnitRGB(t):sg;return tI(s,r)}_getVertexOpacityAndColor(t,i=null){const r=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=tI(r,s);return v(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return VCe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,i,r){switch(t){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==qs.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,i,r){let s=qs.UPDATE;return t.forEach(n=>{const o=i(n);if(v(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=qs.RECREATE}),s}applyRendererDiff(t,i){return lo.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?w0(i.size.field,t):0,s=i.color?w0(i.color.field,t):0,n=i.opacity?w0(i.opacity.field,t):0;return Yt(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&VS.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var i,r,s,n,o,a,l,c,h,p,f,m,y,_,b,w;return{size:(n=(s=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(f=(p=(h=this._fastUpdates)==null?void 0:h.visualVariables)==null?void 0:p.opacity)==null?void 0:f.field)!=null?m:null,rotation:(w=(b=(_=(y=this._fastUpdates)==null?void 0:y.visualVariables)==null?void 0:_.rotation)==null?void 0:b.field)!=null?w:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function w0(e,t){const i=e!=null?t.attributes[e]:0;return i!=null&&isFinite(i)?i:0}function Bce(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(i=>{switch(i.type){case"color":if(t.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const gct={mode:"on-the-ground",offset:0,unit:"meters"},yct={mode:"absolute-height",offset:0,unit:"meters"},zce={hasIntrinsicColor:!1};class n_ extends k${get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(t){Ao(this._transformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(t={}){super(),this.type=hn.Object,this._geometries=new Array,this._transformation=Pe(),this._bvObjectSpace=new Gce,this._bvWorldSpace=new Gce,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new zCe);const i=t.geometries;v(i)&&(this._geometries=Array.from(i))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){vt(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t){t.visible=this._visible,this._geometries.push(t),this._hasVolatileTransformation=this._hasVolatileTransformation||t.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:t}),this._invalidateBoundingVolume()}removeGeometry(t){const i=this._geometries.splice(t,1)[0];i&&(this._emit("objectGeometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("objectGeometryUpdated",{object:this,geometry:t}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(t){if(this._visible!==t){this._visible=t;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new Tk(D0.MaskOccludee);for(const i of this._geometries)i.occludees=gX(i.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const i of this._geometries)i.occludees=yX(i.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new Tk(D0.Highlight);for(const i of this._geometries)i.highlights=gX(i.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const i of this._geometries)i.highlights=yX(i.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,i){return Hs(i,this.transformation,t.transformation)}_getCombinedShaderTransformation(t){return Hs(Pe(),this.transformation,t.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const s of this._geometries){const n=s.boundingInfo;v(n)&&(jce(n,this._bvObjectSpace,s.shaderTransformation),jce(n,this._bvWorldSpace,this._getCombinedShaderTransformation(s)))}On(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),On(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=O(),i=O(),r=bT(this.transformation);for(const s of this._geometries){const n=s.boundingInfo;if(C(n))continue;const o=s.shaderTransformation,a=bT(o);Ze(t,n.center,o);const l=Vr(t,this._bvObjectSpace.bounds),c=n.radius*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Ze(i,t,this.transformation);const h=Vr(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,v(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,i){v(this._parentLayer)&&this._parentLayer.events.emit(t,i)}get test(){const t=this;return{hasGeometry:i=>t._geometries.includes(i),getGeometryIndex:i=>t._geometries.indexOf(i)}}}class zCe{constructor(){this.min=Le(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Le(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Gce extends zCe{constructor(){super(...arguments),this.bounds=Gn()}init(){ue(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ue(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),bbe(this.bounds)}}function jce(e,t,i){const r=e.bbMin,s=e.bbMax;if(uU(i)){const n=ue(_ct,i[12],i[13],i[14]);fe(Hu,r,n),fe(Ep,s,n);for(let o=0;o<3;++o)t.min[o]=Math.min(t.min[o],Hu[o]),t.max[o]=Math.max(t.max[o],Ep[o])}else if(Ze(Hu,r,i),ql(r,s))for(let n=0;n<3;++n)t.min[n]=Math.min(t.min[n],Hu[n]),t.max[n]=Math.max(t.max[n],Hu[n]);else{Ze(Ep,s,i);for(let n=0;n<3;++n)t.min[n]=Math.min(t.min[n],Hu[n],Ep[n]),t.max[n]=Math.max(t.max[n],Hu[n],Ep[n]);for(let n=0;n<3;++n){le(Hu,r),le(Ep,s),Hu[n]=s[n],Ep[n]=r[n],Ze(Hu,Hu,i),Ze(Ep,Ep,i);for(let o=0;o<3;++o)t.min[o]=Math.min(t.min[o],Hu[o],Ep[o]),t.max[o]=Math.max(t.max[o],Hu[o],Ep[o])}}}const _ct=O(),Hu=O(),Ep=O();function Bee(e,t,i,r,s,n){const o=e.clippingExtent;if(Xa(t,w1,e.elevationProvider.spatialReference),v(o)&&!KZ(o,w1))return null;Xa(t,w1,e.renderCoordsHelper.spatialReference);const a=e.localOriginFactory.getOrigin(w1),l=new n_({castShadow:!1,metadata:{layerUid:e.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0}});return i.shaderTransformer=n,i.localOrigin=a,l.addGeometry(i),{object:l,sampledElevation:Vlt(l,t,e.elevationProvider,e.renderCoordsHelper,r)}}function PP(e,t,i){const r=e.elevationContext,s=i.spatialReference;Xa(t,w1,s),r.centerPointInElevationSR=s_(w1[0],w1[1],t.hasZ?w1[2]:0,v(s)?s:null)}function $P(e){switch(e.type){case"point":return e;case"polygon":case"extent":return $ee(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const i=Ige(t,Oge(t)/2);return s_(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}const w1=O();function zee(){return new Float32Array(2)}function vct(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function kd(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function bct(e,t){return new Float32Array(e,t,2)}function GCe(){return zee()}function jCe(){return kd(1,1)}function HCe(){return kd(1,0)}function qCe(){return kd(0,1)}const WCe=GCe(),XCe=jCe(),wct=HCe(),xct=qCe();Object.freeze(Object.defineProperty({__proto__:null,ONES:XCe,UNIT_X:wct,UNIT_Y:xct,ZEROS:WCe,clone:vct,create:zee,createView:bct,fromValues:kd,ones:jCe,unitX:HCe,unitY:qCe,zeros:GCe},Symbol.toStringTag,{value:"Module"}));function Tct(e){const t=new Yi;t.include(zQ),t.include(OEe,e),t.include(An,e),t.attributes.add(R.UV0,"vec2");const{vertex:i,fragment:r}=t;return i.uniforms.add([new xi("viewport",(s,n)=>n.camera.fullViewport),new Ie("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new tr("pixelToNDC",(s,n)=>di(qce,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Ie("borderSize",(s,n)=>v(s.borderColor)?n.camera.pixelRatio:0),new tr("screenOffset",(s,n)=>di(qce,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&M8(i),i.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?x`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?x`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?x`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?x`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new xi("uColor",s=>Hce(s.color)),new xi("borderColor",s=>Hce(s.borderColor))]),e.hasMultipassGeometry&&(r.include(PSe,e),r.uniforms.add(new tr("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(x`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?x`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function Hce(e){return v(e)?e:pg}const qce=tt(),Sct=Object.freeze(Object.defineProperty({__proto__:null,build:Tct},Symbol.toStringTag,{value:"Module"}));class k8 extends ir{initializeConfiguration(t,i){i.spherical=t.viewingMode===je.Global}initializeProgram(t){return new Ji(t.rctx,k8.shader.get().build(this.configuration),ji)}setPipelineState(t){const i=t?Zr.ALWAYS:Zr.LESS;return this.configuration.depthHudEnabled?Ht({depthTest:{func:i},depthWrite:zc}):Ht({blending:Ro(Ce.ONE,Ce.SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:si})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}k8.shader=new Zi(Sct,()=>Q(()=>import("./LineCallout.glsl.f8f4ba6c.js"),[]));class wd extends qo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=$c.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([j({count:$c.COUNT})],wd.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j()],wd.prototype,"spherical",void 0),u([j()],wd.prototype,"occlusionTestEnabled",void 0),u([j()],wd.prototype,"hasVerticalOffset",void 0),u([j()],wd.prototype,"hasScreenSizePerspective",void 0),u([j()],wd.prototype,"depthHudEnabled",void 0),u([j()],wd.prototype,"depthHudAlignStartEnabled",void 0),u([j()],wd.prototype,"hasSlicePlane",void 0),u([j()],wd.prototype,"hasMultipassGeometry",void 0),u([j({constValue:!0})],wd.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],wd.prototype,"isDraped",void 0);class Ux extends _b{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(t){super(t,new YCe),this._configuration=new wd,this._uniqueMaterialIdentifier=Ux.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(t,i){const r=(i==null?void 0:i.slot)!==Ee.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?$c.Screen:$c.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(t,i){if(i===z.Color)switch(t){case Ee.LINE_CALLOUTS:case Ee.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return new Ect(t)}createBufferWriter(){return new Act}validateParameters(t){const i=Ux.uniqueMaterialIdentifier(t);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class Ect extends yb{beginSlot(t){return this.ensureTechnique(k8,t)}}class YCe extends CM{constructor(){super(...arguments),this.screenOffset=Bc,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Cct=As().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4f(R.AUXPOS1),Wce=[kd(0,0),kd(1,0),kd(0,1),kd(1,0),kd(1,1),kd(0,1)];class Act{constructor(){this.vertexBufferLayout=Cct}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(R.POSITION).length}write(t,i,r,s,n){R8(r.indices.get(R.POSITION),r.vertexAttributes.get(R.POSITION).data,t,s.position,n,6),See(r.indices.get(R.NORMAL),r.vertexAttributes.get(R.NORMAL).data,i,s.normal,n,6),FA(r.indices.get(R.AUXPOS1),r.vertexAttributes.get(R.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<Wce.length;++o)s.uv0.setVec(n+o,Wce[o])}}class U8 extends Hg{constructor(t,i){super(t,null,i,Oct),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new Ux(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const i=this._materialParameters;return i.screenOffset=t.screenOffset||Bc,i.centerOffsetUnits=t.centerOffsetUnits||"world",i}get _materialParameters(){const t=new YCe,i=this.symbol,r=i.callout;if(t.color=v(r.color)?De.toUnitRGBA(r.color):[0,0,0,0],t.color[3]*=this._getLayerOpacity(),t.size=$r(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;t.verticalOffset={screenLength:$r(o),minWorldLength:a||0,maxWorldLength:v(l)?l:1/0}}t.borderColor=v(r.border)&&v(r.border.color)?De.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.getItemAt(0).type==="object",n=i.type==="label-3d";return t.occlusionTest=!s,t.shaderPolygonOffset=s?0:void 0,t.depthHUDAlignStart=n,t.hasSlicePlane=this._context.slicePlaneEnabled,t.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,t}_defaultElevationInfoNoZ(){return Rct}createGraphics3DGraphic(t){const i=t.renderingInfo,r=t.graphic,s=this.setGraphicElevationContext(r,new Zh,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!g0e(l)))return null;const a=$ee(r.geometry);return C(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){v(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j$(U8.elevationModeChangeTypes,r,s);return n!==qs.UPDATE||t.forEach(o=>{const a=i(o);v(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return C(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,v(i.metadata)?i.metadata.elevationOffset:0),i.needsElevationUpdates=pp(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Uee.memory}}_createVertexData(t){const{translation:i,centerOffset:r}=t,s=new Ke(i?[i[0],i[1],i[2]]:[0,0,0],3,!0),n=new Ke(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],4,!0);return[[R.POSITION,s],[R.NORMAL,new Ke([0,0,1],3,!0)],[R.AUXPOS1,n]]}_getOrCreateMaterial(t){const i=this._perInstanceMaterialParameters(t),r=Ux.uniqueMaterialIdentifier(i);if(v(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(v(t.materialCollection)){let s=t.materialCollection.get(r);return C(s)&&(s=new Ux(i),t.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new Ux(i),isUnique:!0}}_createAs3DShape(t,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new Rn(a.material,this._createVertexData(r),Mct,null,hn.Point,o),c=Bee(this._context,t,l,i,s);if(C(c))return null;const h=new jg(this,c.object,[l],a.isUnique?[a.material]:null,null,IP,i);return h.metadata=new $Ce(r.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=pp(i.mode),PP(h,t,this._context.elevationProvider),h}}U8.elevationModeChangeTypes={definedChanged:qs.UPDATE,staysOnTheGround:qs.UPDATE,onTheGroundChanged:qs.RECREATE};const Oz=[0],Mct=[[R.POSITION,Oz],[R.NORMAL,Oz],[R.AUXPOS1,Oz]],Rct={mode:"relative-to-ground",offset:0},Oct={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class Ict{constructor(t,i,r=O(),s=ui(),n=tt(),o="world",a=0,l=null){this.renderer=t,this.symbol=i,this.translation=r,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}}class Pct extends ict{}const Xce=se.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function $ct(e,t){if(!_J(e))return Xce.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=Lct[e.callout.type];return i?new i(e,t):(Xce.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const Lct={line:U8},Yce=new ao(Array,e=>q6(e,Dye),null,10,5),Dct=yi();class Fct{get labelLayers(){return this._labelLayers}get extent(){return this._extent}constructor(t,i,r,s,n){this.graphic=t,this.graphics3DSymbol=i,this.layers=r,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=Nct(wa._COUNT,Tu._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?OCe(n,t,s):null;for(const o of r)v(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}initialize(t,i){this._layer=i,this._stage=t,this._forEachSymbolLayerGraphic(r=>{r.initialize(t,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelLayers.length=0}addLabelGraphic(t,i,r){this._labelLayers.push(t),t.initialize(i,r),t.setVisibility(this.isVisible(wa.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryLayers.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(t=!0)}),t}isVisible(t=wa.GRAPHIC,i){for(let r=0;r<=t;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(t,i){return this._visibilityFlags[i][t]!=null}setVisibilityFlag(t,i,r){const s=this.isVisible(r);this._visibilityFlags[r][t]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===wa.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(wa.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,i=wa.GRAPHIC){return this.setVisibilityFlag(t,void 0,i)}computeExtent(t){if(!this._extent){const i=this.graphic.geometry;if(C(i))return!1;this._extent=yi(),Mlt(i,this._extent);const r=i.spatialReference;if(!kn(r,t)&&!CU(this._extent,r,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,i){return v(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,i),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,i,r){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=zh.fromExtent(s.type==="mesh"?s.extent:s)),qWe(s,i,r)}get usedMemory(){let t=tbe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(C(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=Alt(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:O(),num:0},draped:{origin:tt(),num:0}};for(const i of this.layers)C(i)||i.computeAttachmentOrigin(t);return t.render.num>1&&ae(t.render.origin,t.render.origin,1/t.render.num),t.draped.num>1&&xu(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Xr(n.boundingBox):n.boundingBox=Xr(),n.requiresDrapedElevation=!1,await SU(this.layers,async o=>{if(C(o))return;const a=o.type==="draped"?i:t,l=Yce.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&JC(n.boundingBox,l),Yce.release(l)}),BDe(n.boundingBox)||Rj(QZ(n.boundingBox,Dct))?n:null}needsElevationUpdates(){for(const t of this.layers)if(v(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelLayers)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(t,i,r)})}addObjectStateSet(t,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(t,i))}removeObjectState(t){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(t))}_forEachGraphicList(t,i){t.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.layers,t),this._forEachGraphicList(this._auxiliaryLayers,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelLayers,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function Nct(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var Zce,Jce,Kce,ab={},kct={get exports(){return ab},set exports(e){ab=e}};Zce=kct,Jce=function(){function e(L,N,U){U=U||2;var W,Z,ie,Y,ce,pe,ve,Se=N&&N.length,We=Se?N[0]*U:L.length,Ne=t(L,0,We,U,!0),xe=[];if(!Ne||Ne.next===Ne.prev)return xe;if(Se&&(Ne=l(L,N,Ne,U)),L.length>80*U){W=ie=L[0],Z=Y=L[1];for(var ke=U;ke<We;ke+=U)(ce=L[ke])<W&&(W=ce),(pe=L[ke+1])<Z&&(Z=pe),ce>ie&&(ie=ce),pe>Y&&(Y=pe);ve=(ve=Math.max(ie-W,Y-Z))!==0?1/ve:0}return r(Ne,xe,U,W,Z,ve),xe}function t(L,N,U,W,Z){var ie,Y;if(Z===q(L,N,U,W)>0)for(ie=N;ie<U;ie+=W)Y=X(ie,L[ie],L[ie+1],Y);else for(ie=U-W;ie>=N;ie-=W)Y=X(ie,L[ie],L[ie+1],Y);if(Y&&M(Y,Y.next)){var ce=Y.next;K(Y),Y=ce}return Y}function i(L,N){if(!L)return L;N||(N=L);var U,W=L;do if(U=!1,W.steiner||!M(W,W.next)&&E(W.prev,W,W.next)!==0)W=W.next;else{var Z=W.prev;if(K(W),(W=N=Z)===W.next)break;U=!0}while(U||W!==N);return N}function r(L,N,U,W,Z,ie,Y){if(L){!Y&&ie&&y(L,W,Z,ie);for(var ce,pe,ve=L;L.prev!==L.next;)if(ce=L.prev,pe=L.next,ie?n(L,W,Z,ie):s(L))N.push(ce.i/U),N.push(L.i/U),N.push(pe.i/U),K(L),L=pe.next,ve=pe.next;else if((L=pe)===ve){Y?Y===1?r(L=o(i(L),N,U),N,U,W,Z,ie,2):Y===2&&a(L,N,U,W,Z,ie):r(i(L),N,U,W,Z,ie,1);break}}}function s(L){var N=L.prev,U=L,W=L.next;if(E(N,U,W)>=0)return!1;for(var Z=L.next.next;Z!==L.prev;){if(T(N.x,N.y,U.x,U.y,W.x,W.y,Z.x,Z.y)&&E(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function n(L,N,U,W){var Z=L.prev,ie=L,Y=L.next;if(E(Z,ie,Y)>=0)return!1;for(var ce=Z.x<ie.x?Z.x<Y.x?Z.x:Y.x:ie.x<Y.x?ie.x:Y.x,pe=Z.y<ie.y?Z.y<Y.y?Z.y:Y.y:ie.y<Y.y?ie.y:Y.y,ve=Z.x>ie.x?Z.x>Y.x?Z.x:Y.x:ie.x>Y.x?ie.x:Y.x,Se=Z.y>ie.y?Z.y>Y.y?Z.y:Y.y:ie.y>Y.y?ie.y:Y.y,We=b(ce,pe,N,U,W),Ne=b(ve,Se,N,U,W),xe=L.prevZ,ke=L.nextZ;xe&&xe.z>=We&&ke&&ke.z<=Ne;){if(xe!==L.prev&&xe!==L.next&&T(Z.x,Z.y,ie.x,ie.y,Y.x,Y.y,xe.x,xe.y)&&E(xe.prev,xe,xe.next)>=0||(xe=xe.prevZ,ke!==L.prev&&ke!==L.next&&T(Z.x,Z.y,ie.x,ie.y,Y.x,Y.y,ke.x,ke.y)&&E(ke.prev,ke,ke.next)>=0))return!1;ke=ke.nextZ}for(;xe&&xe.z>=We;){if(xe!==L.prev&&xe!==L.next&&T(Z.x,Z.y,ie.x,ie.y,Y.x,Y.y,xe.x,xe.y)&&E(xe.prev,xe,xe.next)>=0)return!1;xe=xe.prevZ}for(;ke&&ke.z<=Ne;){if(ke!==L.prev&&ke!==L.next&&T(Z.x,Z.y,ie.x,ie.y,Y.x,Y.y,ke.x,ke.y)&&E(ke.prev,ke,ke.next)>=0)return!1;ke=ke.nextZ}return!0}function o(L,N,U){var W=L;do{var Z=W.prev,ie=W.next.next;!M(Z,ie)&&A(Z,W,W.next,ie)&&V(Z,ie)&&V(ie,Z)&&(N.push(Z.i/U),N.push(W.i/U),N.push(ie.i/U),K(W),K(W.next),W=L=ie),W=W.next}while(W!==L);return i(W)}function a(L,N,U,W,Z,ie){var Y=L;do{for(var ce=Y.next.next;ce!==Y.prev;){if(Y.i!==ce.i&&S(Y,ce)){var pe=G(Y,ce);return Y=i(Y,Y.next),pe=i(pe,pe.next),r(Y,N,U,W,Z,ie),void r(pe,N,U,W,Z,ie)}ce=ce.next}Y=Y.next}while(Y!==L)}function l(L,N,U,W){var Z,ie,Y,ce=[];for(Z=0,ie=N.length;Z<ie;Z++)(Y=t(L,N[Z]*W,Z<ie-1?N[Z+1]*W:L.length,W,!1))===Y.next&&(Y.steiner=!0),ce.push(w(Y));for(ce.sort(c),Z=0;Z<ce.length;Z++)U=i(U=p(ce[Z],U),U.next);return U}function c(L,N){return L.x-N.x}function h(L){if(L.next.prev===L)return L;let N=L;for(;;){const U=N.next;if(U.prev===N||U===N||U===L)break;N=U}return N}function p(L,N){var U=f(L,N);if(!U)return N;var W=G(U,L),Z=i(U,U.next);let ie=h(W);return i(ie,ie.next),Z=h(Z),h(N===U?Z:N)}function f(L,N){var U,W=N,Z=L.x,ie=L.y,Y=-1/0;do{if(ie<=W.y&&ie>=W.next.y&&W.next.y!==W.y){var ce=W.x+(ie-W.y)*(W.next.x-W.x)/(W.next.y-W.y);if(ce<=Z&&ce>Y){if(Y=ce,ce===Z){if(ie===W.y)return W;if(ie===W.next.y)return W.next}U=W.x<W.next.x?W:W.next}}W=W.next}while(W!==N);if(!U)return null;if(Z===Y)return U;var pe,ve=U,Se=U.x,We=U.y,Ne=1/0;W=U;do Z>=W.x&&W.x>=Se&&Z!==W.x&&T(ie<We?Z:Y,ie,Se,We,ie<We?Y:Z,ie,W.x,W.y)&&(pe=Math.abs(ie-W.y)/(Z-W.x),V(W,L)&&(pe<Ne||pe===Ne&&(W.x>U.x||W.x===U.x&&m(U,W)))&&(U=W,Ne=pe)),W=W.next;while(W!==ve);return U}function m(L,N){return E(L.prev,L,N.prev)<0&&E(N.next,L,L.next)<0}function y(L,N,U,W){var Z=L;do Z.z===null&&(Z.z=b(Z.x,Z.y,N,U,W)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==L);Z.prevZ.nextZ=null,Z.prevZ=null,_(Z)}function _(L){var N,U,W,Z,ie,Y,ce,pe,ve=1;do{for(U=L,L=null,ie=null,Y=0;U;){for(Y++,W=U,ce=0,N=0;N<ve&&(ce++,W=W.nextZ);N++);for(pe=ve;ce>0||pe>0&&W;)ce!==0&&(pe===0||!W||U.z<=W.z)?(Z=U,U=U.nextZ,ce--):(Z=W,W=W.nextZ,pe--),ie?ie.nextZ=Z:L=Z,Z.prevZ=ie,ie=Z;U=W}ie.nextZ=null,ve*=2}while(Y>1);return L}function b(L,N,U,W,Z){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=32767*(L-U)*Z)|L<<8))|L<<4))|L<<2))|L<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-W)*Z)|N<<8))|N<<4))|N<<2))|N<<1))<<1}function w(L){var N=L,U=L;do(N.x<U.x||N.x===U.x&&N.y<U.y)&&(U=N),N=N.next;while(N!==L);return U}function T(L,N,U,W,Z,ie,Y,ce){return(Z-Y)*(N-ce)-(L-Y)*(ie-ce)>=0&&(L-Y)*(W-ce)-(U-Y)*(N-ce)>=0&&(U-Y)*(ie-ce)-(Z-Y)*(W-ce)>=0}function S(L,N){return L.next.i!==N.i&&L.prev.i!==N.i&&!k(L,N)&&(V(L,N)&&V(N,L)&&B(L,N)&&(E(L.prev,L,N.prev)||E(L,N.prev,N))||M(L,N)&&E(L.prev,L,L.next)>0&&E(N.prev,N,N.next)>0)}function E(L,N,U){return(N.y-L.y)*(U.x-N.x)-(N.x-L.x)*(U.y-N.y)}function M(L,N){return L.x===N.x&&L.y===N.y}function A(L,N,U,W){var Z=I(E(L,N,U)),ie=I(E(L,N,W)),Y=I(E(U,W,L)),ce=I(E(U,W,N));return Z!==ie&&Y!==ce||!(Z!==0||!$(L,U,N))||!(ie!==0||!$(L,W,N))||!(Y!==0||!$(U,L,W))||!(ce!==0||!$(U,N,W))}function $(L,N,U){return N.x<=Math.max(L.x,U.x)&&N.x>=Math.min(L.x,U.x)&&N.y<=Math.max(L.y,U.y)&&N.y>=Math.min(L.y,U.y)}function I(L){return L>0?1:L<0?-1:0}function k(L,N){var U=L;do{if(U.i!==L.i&&U.next.i!==L.i&&U.i!==N.i&&U.next.i!==N.i&&A(U,U.next,L,N))return!0;U=U.next}while(U!==L);return!1}function V(L,N){return E(L.prev,L,L.next)<0?E(L,N,L.next)>=0&&E(L,L.prev,N)>=0:E(L,N,L.prev)<0||E(L,L.next,N)<0}function B(L,N){var U=L,W=!1,Z=(L.x+N.x)/2,ie=(L.y+N.y)/2;do U.y>ie!=U.next.y>ie&&U.next.y!==U.y&&Z<(U.next.x-U.x)*(ie-U.y)/(U.next.y-U.y)+U.x&&(W=!W),U=U.next;while(U!==L);return W}function G(L,N){var U=new re(L.i,L.x,L.y),W=new re(N.i,N.x,N.y),Z=L.next,ie=N.prev;return L.next=N,N.prev=L,U.next=Z,Z.prev=U,W.next=U,U.prev=W,ie.next=W,W.prev=ie,W}function X(L,N,U,W){var Z=new re(L,N,U);return W?(Z.next=W.next,Z.prev=W,W.next.prev=Z,W.next=Z):(Z.prev=Z,Z.next=Z),Z}function K(L){L.next.prev=L.prev,L.prev.next=L.next,L.prevZ&&(L.prevZ.nextZ=L.nextZ),L.nextZ&&(L.nextZ.prevZ=L.prevZ)}function re(L,N,U){this.i=L,this.x=N,this.y=U,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q(L,N,U,W){for(var Z=0,ie=N,Y=U-W;ie<U;ie+=W)Z+=(L[Y]-L[ie])*(L[ie+1]+L[Y+1]),Y=ie;return Z}return e.deviation=function(L,N,U,W){var Z=N&&N.length,ie=Z?N[0]*U:L.length,Y=Math.abs(q(L,0,ie,U));if(Z)for(var ce=0,pe=N.length;ce<pe;ce++){var ve=N[ce]*U,Se=ce<pe-1?N[ce+1]*U:L.length;Y-=Math.abs(q(L,ve,Se,U))}var We=0;for(ce=0;ce<W.length;ce+=3){var Ne=W[ce]*U,xe=W[ce+1]*U,ke=W[ce+2]*U;We+=Math.abs((L[Ne]-L[ke])*(L[xe+1]-L[Ne+1])-(L[Ne]-L[xe])*(L[ke+1]-L[Ne+1]))}return Y===0&&We===0?0:Math.abs((We-Y)/Y)},e.flatten=function(L){for(var N=L[0][0].length,U={vertices:[],holes:[],dimensions:N},W=0,Z=0;Z<L.length;Z++){for(var ie=0;ie<L[Z].length;ie++)for(var Y=0;Y<N;Y++)U.vertices.push(L[Z][ie][Y]);Z>0&&(W+=L[Z-1].length,U.holes.push(W))}return U},e},(Kce=Jce())!==void 0&&(Zce.exports=Kce);const V8=se.getLogger("esri.views.3d.support.buffer.math");function q$(e,t,i){if(e.count!==t.count)return void V8.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],f=i[10],m=i[12],y=i[13],_=i[14],b=e.typedBuffer,w=e.typedBufferStride,T=t.typedBuffer,S=t.typedBufferStride;for(let E=0;E<r;E++){const M=E*w,A=E*S,$=T[A],I=T[A+1],k=T[A+2];b[M]=s*$+a*I+h*k+m,b[M+1]=n*$+l*I+p*k+y,b[M+2]=o*$+c*I+f*k+_}}function lb(e,t,i){if(e.count!==t.count)return void V8.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,_=t.typedBuffer,b=t.typedBufferStride;for(let w=0;w<r;w++){const T=w*y,S=w*b,E=_[S],M=_[S+1],A=_[S+2];m[T]=s*E+a*M+h*A,m[T+1]=n*E+l*M+p*A,m[T+2]=o*E+c*M+f*A}}function BX(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function Gee(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function Uct(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,normalize:Gee,scale:BX,shiftRight:Uct,transformMat3:lb,transformMat4:q$},Symbol.toStringTag,{value:"Module"}));function Vct(e,t,i){return{objectId:e,target:t,distance:i,type:"vertex"}}function Qce(e,t,i,r,s,n=!1){return{objectId:e,target:t,distance:i,type:"edge",start:r,end:s,draped:n}}function B8(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&v(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function Bct(e,t){if(v(e.symbol))return e.symbol;const i=B8(e,t);return v(i)&&i.type!=="dot-density"?i.getSymbol(e,t):null}function x3t(e,t){var a;const i=B8(e,t),r=Bct(e,t);if(C(r))return null;const s={renderer:i,symbol:r};if(C(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=(a=xJ(i,e,t))!=null?a:[],o=["proportional","proportional","proportional"];for(const{variable:l,value:c}of n)switch(l.type){case"color":s.color=c.toRgba();break;case"size":if(l.target==="outline")s.outlineSize=c;else{const h=l.axis,p=l.useSymbolValue?"symbol-value":c;switch(h){case"width":o[0]=p;break;case"depth":o[1]=p;break;case"height":o[2]=p;break;case"width-and-depth":o[0]=o[1]=p;break;default:o[0]=o[1]=o[2]=p}}break;case"opacity":s.opacity=c;break;case"rotation":switch(l.axis){case"tilt":s.tilt=c;break;case"roll":s.roll=c;break;default:s.heading=c}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function zct(e,t){if(v(e.symbol))return e.symbol;const i=B8(e,t);return v(i)?i.getSymbolAsync(e,t):null}async function T3t(e,t){var a;const i=B8(e,t),r=await zct(e,t);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=(a=xJ(i,e,t))!=null?a:[],o=["proportional","proportional","proportional"];for(const{variable:l,value:c}of n)if(l.type==="color")s.color=De.toUnitRGBA(c);else if(l.type==="size")if(l.target==="outline")s.outlineSize=c;else{const h=l.axis,p=l.useSymbolValue?"symbol-value":c;h==="width"?o[0]=p:h==="depth"?o[1]=p:h==="height"?o[2]=p:o[0]=o[1]=h==="width-and-depth"?p:o[2]=p}else l.type==="opacity"?s.opacity=c:l.type==="rotation"&&l.axis==="tilt"?s.tilt=c:l.type==="rotation"&&l.axis==="roll"?s.roll=c:l.type==="rotation"&&(s.heading=c);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Gct(e,t=0){const i=e[t];return typeof i=="number"&&isFinite(i)?i:null}function jct(e){for(let t=0;t<3;t++){const i=e[t];if(typeof i=="number")return isFinite(i)?i:0}return 0}function eue(e){const t=[[R.POSITION,e.indices]],i=[[R.POSITION,new Ke(e.attributeData.position,3,!0)]];return v(e.attributeData.color)&&(i.push([R.COLOR,new Ke(e.attributeData.color,4,!0)]),t.push([R.COLOR,new Array(e.indices.length).fill(0)])),v(e.attributeData.uvMapSpace)&&(i.push([R.UVMAPSPACE,new Ke(e.attributeData.uvMapSpace,4,!0)]),t.push([R.UVMAPSPACE,e.indices])),v(e.attributeData.boundingRect)&&(i.push([R.BOUNDINGRECT,new Ke(e.attributeData.boundingRect,9,!0)]),t.push([R.BOUNDINGRECT,e.indices])),new Rn(e.material,i,t,e.mapPositions,hn.Mesh,e.attributeData.objectAndLayerIdColor)}function tue(e){const t=[[R.POSITION,e.indices],[R.UV0,e.indices]],i=[[R.POSITION,new Ke(e.attributeData.position,3,!0)],[R.UV0,new Ke(e.attributeData.uv0,2,!0)]];return new Rn(e.material,i,t,e.mapPositions)}function LP(e){switch(e.type){case"extent":if(e instanceof Gi)return zh.fromExtent(e);break;case"polygon":return e}return null}class z8{constructor(t,i,r){this.renderData=t,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}}function zX(e,t,i){var A;const r=Array.isArray(e),s=r?e.length/t:e.byteLength/(4*t),n=r?e:new Uint32Array(e,0,s*t),o=(A=i==null?void 0:i.minReduction)!=null?A:0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let $=0;$<c.length-1;$++){const I=c[$+1]-c[$];I>h&&(h=I)}else h=s;const p=Math.floor(1.1*h)+1;(im==null||im.length<2*p)&&(im=new Uint32Array(kC(2*p)));for(let $=0;$<2*p;$++)im[$]=0;let f=0;const m=!!c&&!!a,y=m?l:s;let _=KSe(s/3);const b=new Uint32Array(l),w=1.96;let T=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,S=1,E=c?c[1]:y;for(let $=0;$<y;$++){if($===T){const X=1-f/$;if(X+w*Math.sqrt(X*(1-X)/$)<o)return null;T*=2}if($===E){for(let X=0;X<2*p;X++)im[X]=0;if(a)for(let X=c[S-1];X<c[S];X++)b[X]=_[a[X]];E=c[++S]}const I=m?a[$]:$,k=I*t,V=Wct(n,k,t);let B=V%p,G=f;for(;im[2*B+1]!==0;){if(im[2*B]===V){const X=im[2*B+1]-1;if(Hct(n,k,X*t,t)){G=_[X];break}}B++,B>=p&&(B-=p)}G===f&&(im[2*B]=V,im[2*B+1]=I+1,f++),_[I]=G}if(o!==0&&1-f/s<o)return null;if(m){for(let $=c[S-1];$<b.length;$++)b[$]=_[a[$]];_=bC(b)}const M=r?new Array(f):new Uint32Array(f*t);f=0;for(let $=0;$<y;$++)_[$]===f&&(qct(n,(m?a[$]:$)*t,M,f*t,t),f++);if(a&&!m){const $=new Uint32Array(l);for(let I=0;I<$.length;I++)$[I]=_[a[I]];_=bC($)}return{buffer:Array.isArray(M)?M:M.buffer,indices:_,uniqueCount:f}}function Hct(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function qct(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function Wct(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let im=null;function S3t(e){const t=W$(e.rings,e.hasZ,$g.CCW_IS_HOLE),i=new Array;let r=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=Jd(t.position,3*c,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(ab(h,p,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=Xct(i,r,s),o=Array.isArray(n.position)?zX(n.position,3,{originalIndices:n.faces}):zX(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function Xct(e,t,i){if(e.length===1)return e[0];const r=Du(t),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function W$(e,t,i){const r=e.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let m=0;m<r;++m)h+=e[m].length;const p=Du(3*h);let f=0;for(let m=r-1;m>=0;m--){const y=e[m],_=i===$g.CCW_IS_HOLE&&Yct(y);if(_&&r!==1)s[a++]=y;else{let b=y.length;for(let T=0;T<a;++T)b+=s[T].length;const w={index:f,pathLengths:new Array(a+1),count:b,holeIndices:new Array(a)};w.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=_?qD(y,y.length-1,-1,p,f,y.length,t):qD(y,0,1,p,f,y.length,t);for(let T=0;T<a;++T){const S=s[T];w.holeIndices[T]=f,w.pathLengths[T+1]=S.length,S.length>0&&(o[c++]={index:f,count:S.length}),f=qD(S,0,1,p,f,S.length,t)}a=0,w.count>0&&(n[l++]=w)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=qD(y,0,1,p,f,y.length,t)}return n.length=l,o.length=c,{position:p,polygons:n,outlines:o}}function qD(e,t,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,t+=i}return s/3}function Yct(e){return!Pge(e,!1,!1)}var $g;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})($g||($g={}));var iI,qk,GX;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(iI||(iI={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(qk||(qk={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(GX||(GX={}));var xs,Ud,It,rI,zs,io,nl;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(xs||(xs={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Ud||(Ud={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(It||(It={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(rI||(rI={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(zs||(zs={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(io||(io={})),function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"}(nl||(nl={}));class Zct{constructor(t,i){this.vec3=t,this.id=i}}function sI(e,t,i,r){return new Zct(Le(e,t,i),r)}var Mc;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded",e[e.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Mc||(Mc={}));class iue{get extent(){return this._extent}constructor(t,i){this.index=t,this.renderTargets=i,this._extent=yi(),this.resolution=0,this.renderLocalOrigin=sI(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Jct,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const i=t===Mc.ColorAndWater?this.renderTargets.getTarget(zs.Color):t===Mc.Highlight?this.renderTargets.getTarget(zs.Highlight):t===Mc.ObjectAndLayerIdColor?this.renderTargets.getTarget(zs.ObjectAndLayerIdColor):this.renderTargets.getTarget(zs.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(zs.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(zs.Color):null}getNormalTexture(t){const i=t===Mc.ColorAndWater?this.renderTargets.getTarget(zs.Water):null;return i?i.getTexture():null}draw(t,i){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==zs.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,i):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?bA.CHANGED:bA.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[zs.Color]|+t[zs.ColorNoRasterImage]<<1|+t[zs.Highlight]<<2|+t[zs.Water]<<3|+t[zs.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const i=.001*t.range;if(this._extent[0]-i<=t.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];E5(this._extent,t.range,0,r)}if(this._extent[2]+i>=t.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];E5(this._extent,-t.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,O0(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const i=this.canvasGeometries.extents[t];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===xs.INNER?0:this.resolution,0,this.resolution,this.resolution)}}class Jct{constructor(){this.extents=[yi(),yi(),yi()],this.numViews=0}}class ZCe{constructor(t,i){this._size=zee(),this._fbo=null,this._fbo=new Yr(t,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=rt(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,i){this._size[0]=t,this._size[1]=i,this._fbo.resize(this._size[0],this._size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){const t=this._fbo.colorTexture;t.descriptor.hasMipmap&&t.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,i;return(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0}}class BS{constructor(t,i,r,s=!0){this.output=i,this.type=r,this.valid=!1,this.lastUsed=1/0,this.fbo=new ZCe(t,s)}}class Kct{constructor(t){this.renderTargets=[new BS(t,z.Color,zs.Color),new BS(t,z.Color,zs.ColorNoRasterImage),new BS(t,z.Highlight,zs.Highlight,!1),new BS(t,z.Normal,zs.Water),new BS(t,z.Color,zs.Occluded)],he("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new BS(t,z.ObjectAndLayerIdColor,zs.ObjectAndLayerIdColor))}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,i,r){if(t)i.lastUsed=r;else if(r-i.lastUsed>Qct)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,i)=>t+i.fbo.gpuMemoryUsage,0)}}const Qct=1e3;class JCe{constructor(t){this._context=t,this._perConstructorInstances=new wM,this._frameCounter=0,this._keepAliveFrameCount=rue}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(t=>t.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,i=tut){const r=i.key;let s=this._perConstructorInstances.get(t,r);if(C(s)){const n=new t(this._context,i,()=>this.release(n));s=new eut(n),this._perConstructorInstances.set(t,r,s)}return++s.refCount,s.technique}releaseAndAcquire(t,i,r){if(v(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(t,i)}release(t){if(C(t)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(t.constructor,t.key);C(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==rue&&this._perConstructorInstances.forEach((t,i)=>{t.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};t.push(s(i,r))}),await Promise.all(t)}}class eut{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const rue=-1,tut=new xl;class KCe{constructor(t,i,r,s){this._textureRepository=t,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new wM}dispose(){this._textureRepository.destroy()}acquire(t,i,r){if(this._ownMaterial(t),!t.requiresSlot(i,r))return null;let s=this._id2glMaterialRef.get(r,t.id);if(C(s)){const n=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});s=new iut(n),this._id2glMaterialRef.set(r,t.id,s)}return s.ref(),s.glMaterial}release(t,i){const r=this._id2glMaterialRef.get(i,t.id);v(r)&&(r.unref(),r.referenced||(rt(r.glMaterial),this._id2glMaterialRef.delete(i,t.id)))}_ownMaterial(t){v(t.repository)&&t.repository!==this&&se.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),t.repository=this}}class iut{constructor(t){this.glMaterial=t,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,vt(this._refCnt>=0)}get referenced(){return this._refCnt>0}}const rut={orderedRepackingEnabled:!1},sut={rootOrigin:null},nut=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];class UA{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(t,i){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new on,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),on.clearPool(),jX[0]=null,zb.prune(),ex.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);const r=on.acquire();for(let s=0;s<i;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}on.release(r)}remove(t,i=null){this._objectCount-=t.length;const r=on.acquire();for(const s of t){const n=v(i)?i:dA(this._objectToBoundingSphere(s),uut);e3(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}on.release(r),this._shrink()}update(t,i){if(!e3(i[3])&&this._isDegenerate(t))return;const r=cut(t);this.remove(r,i),this.add(r)}forEachAlongRay(t,i,r){const s=qh(t,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(t,i,r,s){const n=qh(t,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(t){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(t),r.residents!==null&&r.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=Iz(t,i),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!v1(r,f))return;const m=jv(t,i,f),y=m-f[3],_=m+f[3];y<o&&(o=y,a=_,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!v1(r,p.bounds)||(ae(id,c,p.halfSize),fe(id,id,p.bounds),jv(t,i,id)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},t,i),l}forEachInDepthRange(t,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{r===UA.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(s);const p=jv(i,r,t),f=Iz(i,r),m=Iz(i,-r),y=_=>{if(!a(_))return;const b=this._objectToBoundingSphere(_),w=b,T=jv(i,r,w)-p,S=T-b[3],E=T+b[3];S>c||E<l||!v1(o,b)||n(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!v1(o,_.bounds)||(ae(id,f,_.halfSize),fe(id,id,_.bounds),jv(i,r,id)-p>c)||(ae(id,m,_.halfSize),fe(id,id,_.bounds),jv(i,r,id)-p<l))return!1;const b=_.node;return b.terminals.forAll(w=>y(w)),b.residents!==null&&b.residents.forAll(w=>y(w)),!0},i,r)}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize))}forEachNeighbor(t,i){const r=g0(i),s=i,n=l=>{const c=this._objectToBoundingSphere(l),h=g0(c),p=r+h;return!(Ta(c,s)-p*p<=0)||t(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=g0(l.bounds),h=r+c;if(Ta(l.bounds,s)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(t,i){return WD(i.bounds,2*-i.halfSize,wh),WD(i.bounds,2*i.halfSize,xh),Zae(t.origin,t.direction,wh,xh)}_intersectsNodeWithOffset(t,i,r){return WD(i.bounds,2*-i.halfSize,wh),WD(i.bounds,2*i.halfSize,xh),r.applyToMinMax(wh,xh),Zae(t.origin,t.direction,wh,xh)}_intersectsObject(t,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||gW(r,t)}_intersectsObjectWithOffset(t,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||gW(r.applyToBoundingSphere(s),t)}_forEachNode(t,i){let r=on.acquire().init(t);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(on.acquire().init(r).advance(n));on.release(r)}}_forEachNodeDepthOrdered(t,i,r,s=UA.DepthOrder.FRONT_TO_BACK){let n=on.acquire().init(t);const o=[n];for(lut(r,s,oue);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=oue[a];n.node.children[l]&&o.push(on.acquire().init(n).advance(l))}on.release(n)}}_remove(t,i,r){zb.clear();const s=r.advanceTo(i,(n,o)=>{zb.push(n.node),zb.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=zb.length-2;n>=0;n-=2){const o=zb.data[n],a=zb.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new ri({shrink:!0})),!0)}_add(t,i){i.advanceTo(this._objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){const i=t.node.residents;t.node.residents=null;for(let r=0;r<i.length;r++){const s=on.acquire().init(t);this._add(i.getItemAt(r),s),on.release(s)}}_grow(t,i){if(i!==0&&(sue(t,i,r=>this._objectToBoundingSphere(r),ny),e3(ny[3])&&!this._fitsInsideTree(ny)))if(this._nodeIsEmpty(this._root.node))dA(ny,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(ny);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(ny,r):this._growRootAsSubNode(r),on.release(r)}}_rebuildTree(t,i){le($z,i.bounds),$z[3]=i.halfSize,sue([t,$z],2,s=>s,Lz);const r=on.acquire().init(this._root);this._root.initFrom(null,Lz,Lz[3]),this._root.increaseHalfSize(1.25),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),on.release(r)}_placingRootViolatesMaxDepth(t){const i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const i=t[3],r=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),h=r[l]+i-(n[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(p+f)*Math.LOG2E);s=Math.max(s,m),XD[l].min=p,XD[l].max=f}for(let l=0;l<3;l++){let c=XD[l].min,h=XD[l].max;const p=(s-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const f=n[l]-o-c*o*2;Pz[l]=f+(h+c)*o}const a=s*o;return Pz[3]=a*eAe,on.acquire().initFrom(null,Pz,a,0)}_growRootAsSubNode(t){const i=this._root.node;le(ny,this._root.bounds),ny[3]=this._root.halfSize,this._root.init(t),t.advanceTo(ny,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&t==null;)r=s++,t=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(t){return!e3(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const i=this._root.bounds,r=this._root.halfSize;return t[3]<=r&&t[0]>=i[0]-r&&t[0]<=i[0]+r&&t[1]>=i[1]-r&&t[1]<=i[1]+r&&t[2]>=i[2]-r&&t[2]<=i[2]+r}}class on{constructor(){this.bounds=Gn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,r,s=this.depth){return this.node=v(t)?t:on.createEmptyNode(),v(i)&&dA(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(t){this.halfSize*=t,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*eAe}advance(t){let i=this.node.children[t];i||(i=on.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;const r=QCe[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(t,i,r=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const i=this.bounds;return(i[0]<t[0]?1:0)+(i[1]<t[1]?2:0)+(i[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new ri({shrink:!0}),residents:new ri({shrink:!0})}}static acquire(){return on._pool.acquire()}static release(t){on._pool.release(t)}static clearPool(){on._pool.prune()}}function out(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function aut(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function WD(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function sue(e,t,i,r){if(t===1){const s=i(e[0]);dA(s,r)}else{wh[0]=1/0,wh[1]=1/0,wh[2]=1/0,xh[0]=-1/0,xh[1]=-1/0,xh[2]=-1/0;for(let s=0;s<t;s++){const n=i(e[s]);e3(n[3])&&(out(wh,n),aut(xh,n))}On(r,wh,xh,.5),r[3]=Math.max(xh[0]-wh[0],xh[1]-wh[1],xh[2]-wh[2])/2}}function lut(e,t,i){if(!ex.length)for(let r=0;r<8;++r)ex.push({index:0,distance:0});for(let r=0;r<8;++r){const s=QCe[r];ex.data[r].index=r,ex.data[r].distance=jv(e,t,s)}ex.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=ex.data[r].index}function Iz(e,t){let i,r=1/0;for(let s=0;s<8;++s){const n=jv(e,t,nue[s]);n<r&&(r=n,i=nue[s])}return i}function jv(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function e3(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}on._pool=new ao(on),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(UA||(UA={}));const QCe=[Le(-1,-1,-1),Le(1,-1,-1),Le(-1,1,-1),Le(1,1,-1),Le(-1,-1,1),Le(1,-1,1),Le(-1,1,1),Le(1,1,1)],nue=[Le(-1,-1,-1),Le(-1,-1,1),Le(-1,1,-1),Le(-1,1,1),Le(1,-1,-1),Le(1,-1,1),Le(1,1,-1),Le(1,1,1)],eAe=Math.sqrt(3),jX=[null];function cut(e){return jX[0]=e,jX}const Pz=Gn(),id=O(),wh=O(),xh=O(),zb=new ri,uut=Gn(),ny=Gn(),$z=Gn(),Lz=Gn(),XD=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],ex=new ri,oue=[0,0,0,0,0,0,0,0],Tf=UA;var F1;(function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"})(F1||(F1={}));class tAe extends k${get objects(){return this._objects}constructor(t,i=""){var r,s,n,o;super(),this.apiLayerUid=i,this.type=hn.Layer,this.events=new ps,this.sliceable=!1,this._objects=new ri,this._objectsAdded=new ri,this._stageHandles=new Ii,this.apiLayerUid=i,this.visible=(r=t==null?void 0:t.visible)!=null?r:!0,this.pickable=(s=t==null?void 0:t.pickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:F1.ASYNC,this._disableOctree=(o=t==null?void 0:t.disableOctree)!=null?o:!1}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const i of nut)this._stageHandles.add(this.events.on(i,r=>t.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),v(this._octree)&&this._objectsAdded.push(t)}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),v(this._octree)&&(this._objectsAdded.removeUnordered(t)||this._octree.remove([t])))}addMany(t){this._objects.pushArray(t);for(const i of t)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),v(this._octree)&&this._objectsAdded.pushArray(t)}removeMany(t){const i=new Array;if(this._objects.removeUnorderedMany(t,t.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),v(this._octree)){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){v(this._stage)&&this.updatePolicy!==F1.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,i){v(this._octree)&&!this._objectsAdded.includes(t)&&this._octree.update(t,i)}getSpatialQueryAccelerator(){return C(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new Tf(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):v(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Be(this._octree),this._objectsAdded.clear()}}function Wk(e){return v(e)&&e.type===hn.Layer}var Kd,BT;(function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"})(Kd||(Kd={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(BT||(BT={}));class pa extends qo{constructor(){super(...arguments),this.output=z.Color,this.transparencyPassType=Ct.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Kd.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=BT.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:z.COUNT})],pa.prototype,"output",void 0),u([j({count:Ct.COUNT})],pa.prototype,"transparencyPassType",void 0),u([j()],pa.prototype,"occluder",void 0),u([j()],pa.prototype,"hasSlicePlane",void 0),u([j()],pa.prototype,"writeDepth",void 0),u([j({count:Kd.COUNT})],pa.prototype,"space",void 0),u([j()],pa.prototype,"hideOnShortSegments",void 0),u([j()],pa.prototype,"hasCap",void 0),u([j({count:BT.COUNT})],pa.prototype,"anchor",void 0),u([j()],pa.prototype,"hasTip",void 0),u([j()],pa.prototype,"vvSize",void 0),u([j()],pa.prototype,"vvColor",void 0),u([j()],pa.prototype,"vvOpacity",void 0),u([j()],pa.prototype,"hasOccludees",void 0),u([j()],pa.prototype,"hasMultipassTerrain",void 0),u([j()],pa.prototype,"cullAboveGround",void 0),u([j({constValue:!0})],pa.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],pa.prototype,"hasSliceTranslatedView",void 0);const aue=8;function iAe(e,t){const i=e.vertex;i.uniforms.add(new Ie("intrinsicWidth",r=>r.width)),t.vvSize?(e.attributes.add(R.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Jt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Jt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Jt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Jt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(R.SIZE,"float"),i.code.add(x`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(R.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new cl("vvOpacityValues",r=>r.vvOpacityValues,aue),new cl("vvOpacityOpacities",r=>r.vvOpacityOpacities,aue)]),i.code.add(x`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(x`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(R.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",Pf),i.uniforms.add(new cl("vvColorValues",r=>r.vvColorValues,Pf)),i.uniforms.add(new I8("vvColorColors",r=>r.vvColorColors,Pf)),i.code.add(x`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(R.COLOR,"vec4"),i.code.add(x`vec4 getColor(){
return applyOpacity(color);
}`))}function U0(e,t){switch(e.fragment.include(ku),t.output){case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case z.Depth:e.fragment.code.add(x`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}class rAe{constructor(t){this._rctx=t,this._cache=new Map}destroy(){this._cache.forEach(t=>rt(t.stippleTexture)),this._cache.clear()}_acquire(t){if(C(t))return null;const i=this._patternId(t),r=this._cache.get(i);if(r)return r.refCount++,r;const{encodedData:s,paddedPixels:n}=dut(t),o=new hut(new pt(this._rctx,{width:n,height:1,internalFormat:ze.RGBA,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE},s));return this._cache.set(i,o),o}release(t){if(C(t))return;const i=this._patternId(t),r=this._cache.get(i);r&&(r.refCount--,r.refCount===0&&(v(r.stippleTexture)&&r.stippleTexture.dispose(),this._cache.delete(i)))}swap(t,i){const r=this._acquire(i);return this.release(t),r}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}class hut extends Rr{constructor(t){super(),this.stippleTexture=t,this.refCount=1}}function dut(e){const t=jee(e),i=1/e.pixelRatio,r=sAe(e),s=nAe(e),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const m of t){for(let y=0;y<m;y++){const _=a*(Math.min(y,m-1-y)+.5)*i/n*.5+.5;o.push(_)}a=-a}const l=Math.round(t[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=r+oAe,p=new Uint8Array(4*h);let f=4;for(const m of c)RP(m,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:h}}function jee(e){return e.pattern.map(t=>Math.round(t*e.pixelRatio))}function sAe(e){if(C(e))return 1;const t=jee(e);return Math.floor(t.reduce((i,r)=>i+r))}function nAe(e){return jee(e).reduce((t,i)=>Math.max(t,i))}const oAe=2;function put(e){return C(e)?pg:e.length===4?e:mr(fut,e[0],e[1],e[2],1)}const fut=ui();function aAe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?mut(e,t):gut(e)}function mut(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:r,fragment:s}=e;s.include(ku),t.draped||(zf(r,t),r.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(o,a)=>1/a.camera.perScreenPixelRatio)),r.code.add(x`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),r.code.add(x`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${_ut};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(x`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(x`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new Ie("pixelRatio",(o,a)=>a.camera.pixelRatio)),r.code.add(x`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?x`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",oAe);const n=t.hasWebGL2Context?fr.None:fr.Size;s.uniforms.add(Rf("stipplePatternTexture",o=>o.stippleTexture,n)),s.uniforms.add([new Ie("stipplePatternSDFNormalizer",o=>yut(o.stipplePattern)),new Ie("stipplePatternPixelSizeInv",o=>1/Hee(o))]),s.code.add(x`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${Zd(t,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),s.code.add(x`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?x`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:x`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?x`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?x`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:x`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?x`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:x`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new xi("stippleOffColor",o=>put(o.stippleOffColor))),s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function gut(e){e.fragment.code.add(x`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function yut(e){return v(e)?(Math.floor(.5*(nAe(e)-1))+.5)/e.pixelRatio:1}function Hee(e){const t=e.stipplePattern;return v(t)?sAe(e.stipplePattern)/t.pixelRatio:1}const _ut=x.float(.4),DP=64,qee=DP/2,lAe=qee/5,vut=DP/lAe,but=.25;function wut(e,t){return e.fromData(`${t}-marker`,()=>XEe(t,DP,qee,lAe))}function cAe(e,t){const i=e.vertex;e.constants.add("markerSizePerLineWidth","float",vut),i.uniforms.add(new Ie("pixelRatio",(r,s)=>s.camera.pixelRatio)),C(i.uniforms.get("markerScale"))&&i.constants.add("markerScale","float",1),i.code.add(x`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===Kd.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new Ie("perRenderPixelRatio",(r,s)=>s.camera.perRenderPixelRatio)),i.code.add(x`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var Qd;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(Qd||(Qd={}));class bs extends qo{constructor(){super(...arguments),this.output=z.Color,this.capType=Qd.BUTT,this.transparencyPassType=Ct.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}u([j({count:z.COUNT})],bs.prototype,"output",void 0),u([j({count:Qd.COUNT})],bs.prototype,"capType",void 0),u([j({count:Ct.COUNT})],bs.prototype,"transparencyPassType",void 0),u([j()],bs.prototype,"occluder",void 0),u([j()],bs.prototype,"hasSlicePlane",void 0),u([j()],bs.prototype,"hasPolygonOffset",void 0),u([j()],bs.prototype,"writeDepth",void 0),u([j()],bs.prototype,"draped",void 0),u([j()],bs.prototype,"stippleEnabled",void 0),u([j()],bs.prototype,"stippleOffColorEnabled",void 0),u([j()],bs.prototype,"stippleScaleWithLineWidth",void 0),u([j()],bs.prototype,"stipplePreferContinuous",void 0),u([j()],bs.prototype,"roundJoins",void 0),u([j()],bs.prototype,"applyMarkerOffset",void 0),u([j()],bs.prototype,"vvSize",void 0),u([j()],bs.prototype,"vvColor",void 0),u([j()],bs.prototype,"vvOpacity",void 0),u([j()],bs.prototype,"falloffEnabled",void 0),u([j()],bs.prototype,"innerColorEnabled",void 0),u([j()],bs.prototype,"hasOccludees",void 0),u([j()],bs.prototype,"hasMultipassTerrain",void 0),u([j()],bs.prototype,"cullAboveGround",void 0),u([j()],bs.prototype,"wireframe",void 0),u([j({constValue:!0})],bs.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!0})],bs.prototype,"stippleRequiresStretchMeasure",void 0),u([j({constValue:!0})],bs.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],bs.prototype,"hasSliceTranslatedView",void 0),u([j()],bs.prototype,"objectAndLayerIdColorInstanced",void 0);const Xk=1;function xut(e){const t=new Yi,{vertex:i,fragment:r}=t,s=e.hasMultipassTerrain&&(e.output===z.Color||e.output===z.Alpha);t.include(D$),t.include(iAe,e),t.include(aAe,e);const n=e.applyMarkerOffset&&!e.draped;n&&(i.uniforms.add(new Ie("markerScale",m=>m.markerScale)),t.include(cAe,{space:Kd.World})),e.output===z.Depth&&t.include(U0,e),t.include(O8,e),Pu(i,e),i.uniforms.add([new ds("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new tr("nearFar",(m,y)=>y.camera.nearFar),new Ie("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new xi("viewport",(m,y)=>y.camera.fullViewport)]),i.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.SUBDIVISIONFACTOR,"float"),t.attributes.add(R.UV0,"vec2"),t.attributes.add(R.AUXPOS1,"vec3"),t.attributes.add(R.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),Q1(t),s&&t.varyings.add("depth","float");const o=e.capType===Qd.ROUND,a=e.stippleEnabled&&e.stippleScaleWithLineWidth||o;a&&t.varyings.add("vLineWidth","float");const l=e.stippleEnabled&&e.stippleScaleWithLineWidth;l&&t.varyings.add("vLineSizeInv","float");const c=e.innerColorEnabled||o;c&&t.varyings.add("vLineDistance","float");const h=e.stippleEnabled&&o,p=e.falloffEnabled||h;p&&t.varyings.add("vLineDistanceNorm","float"),o&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),i.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),h8(t),i.code.add(x`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),i.uniforms.add(new Ie("pixelRatio",(m,y)=>y.camera.pixelRatio)),i.code.add(x`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?x`vLineWidth = lineWidth;`:""}
      ${l?x`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&i.code.add(x`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),i.code.add(x`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(e.stippleEnabled||o)&&i.code.add(x`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?x`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(x`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?i.code.add(x`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?x`min(1.0, subdivisionFactor * ${x.float((Xk+2)/(Xk+1))})`:x`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(x`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=e.capType!==Qd.BUTT;return i.code.add(x`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?x`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(x`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?x`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?x`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?x`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&i.code.add(x`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?i.uniforms.add(new Ie("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):i.code.add(x`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(x`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?i.code.add(x`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(x`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new Ie("stipplePatternPixelSize",m=>Hee(m))),i.code.add(x`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),i.code.add(x`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&t.include(Xh,e),t.include(An,e),r.include(zg),r.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?r.code.add(x`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&r.code.add(x`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${x.float(qa)}) {
        discard;
      }
    `),h?r.code.add(x`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${x.float(qa)}, stippleCoverage);
      `):r.code.add(x`float stippleAlpha = getStippleAlpha();`),r.uniforms.add(new xi("intrinsicColor",m=>m.color)),e.output!==z.ObjectAndLayerIdColor&&r.code.add(x`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),r.code.add(x`vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(r.uniforms.add(new xi("innerColor",m=>Ft(m.innerColor,m.color))),r.uniforms.add(new Ie("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),r.code.add(x`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),r.code.add(x`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(r.uniforms.add(new Ie("falloff",m=>m.falloff)),r.code.add(x`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),r.code.add(x`
    ${e.output===z.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${x.float(qa)}) {
      discard;
    }

    ${e.output===z.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===z.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===z.Color&&e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===z.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===z.Depth?x`outputDepth(linearDepth);`:""}
    ${e.output===z.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const Tut=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:Xk,build:xut},Symbol.toStringTag,{value:"Module"})),Wee={func:Zr.LESS},Yk={func:Zr.ALWAYS},Lg={mask:255},uAe={mask:0},Sut=e=>({function:{func:Zr.NOTEQUAL,ref:e,mask:e},operation:{fail:dn.KEEP,zFail:dn.KEEP,zPass:dn.KEEP}}),Eut=e=>({function:{func:Zr.ALWAYS,ref:e,mask:e},operation:{fail:dn.KEEP,zFail:dn.KEEP,zPass:dn.REPLACE}}),bb={function:{func:Zr.ALWAYS,ref:Nc.OutlineVisualElementMask,mask:Nc.OutlineVisualElementMask},operation:{fail:dn.KEEP,zFail:dn.KEEP,zPass:dn.ZERO}},cb={function:{func:Zr.ALWAYS,ref:Nc.OutlineVisualElementMask,mask:Nc.OutlineVisualElementMask},operation:{fail:dn.KEEP,zFail:dn.KEEP,zPass:dn.REPLACE}},hAe={function:{func:Zr.EQUAL,ref:Nc.OutlineVisualElementMask,mask:Nc.OutlineVisualElementMask},operation:{fail:dn.KEEP,zFail:dn.KEEP,zPass:dn.KEEP}},dAe={function:{func:Zr.NOTEQUAL,ref:Nc.OutlineVisualElementMask,mask:Nc.OutlineVisualElementMask},operation:{fail:dn.KEEP,zFail:dn.KEEP,zPass:dn.KEEP}},pAe=new Map([[R.POSITION,0],[R.SUBDIVISIONFACTOR,1],[R.UV0,2],[R.AUXPOS1,3],[R.AUXPOS2,4],[R.COLOR,5],[R.COLORFEATUREATTRIBUTE,5],[R.SIZE,6],[R.SIZEFEATUREATTRIBUTE,6],[R.OPACITYFEATUREATTRIBUTE,7],[R.OBJECTANDLAYERIDCOLOR,8]]);class G8 extends ir{initializeProgram(t){return new Ji(t.rctx,G8.shader.get().build(this.configuration),pAe)}_makePipelineState(t,i){const r=this.configuration,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:r.output===z.Color||r.output===z.Alpha?s?Vh:r_(t):null,depthTest:{func:vb(t)},depthWrite:s?r.writeDepth?zc:null:P8(t),colorWrite:si,stencilWrite:r.hasOccludees?Lg:null,stencilTest:r.hasOccludees?i?cb:bb:null,polygonOffset:s||n?r.hasPolygonOffset?lue:null:L8})}initializePipeline(){const t=this.configuration;if(t.occluder){const i=t.hasPolygonOffset?lue:null;this._occluderPipelineTransparent=Ht({blending:Vh,polygonOffset:i,depthTest:Yk,depthWrite:null,colorWrite:si,stencilWrite:null,stencilTest:dAe}),this._occluderPipelineOpaque=Ht({blending:Vh,polygonOffset:i,depthTest:Yk,depthWrite:null,colorWrite:si,stencilWrite:uAe,stencilTest:hAe}),this._occluderPipelineMaskWrite=Ht({blending:null,polygonOffset:i,depthTest:Wee,depthWrite:null,colorWrite:null,stencilWrite:Lg,stencilTest:cb})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Nt.LINES:Nt.TRIANGLE_STRIP}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}G8.shader=new Zi(Tut,()=>Q(()=>import("./RibbonLine.glsl.56427b3a.js"),[]));const lue={factor:0,units:-4};var hu;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(hu||(hu={}));class WE extends _b{constructor(t){super(t,new Aut),this._configuration=new bs,this._vertexAttributeLocations=pAe,this._layout=this.createLayout()}isClosed(t,i){return mAe(this.parameters,t,i)}getConfiguration(t,i){this._configuration.output=t,this._configuration.draped=i.slot===Ee.DRAPED_MATERIAL;const r=v(this.parameters.stipplePattern)&&t!==z.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&v(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!v(this.parameters.markerParameters)&&Rut(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&v(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Is.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(t,i,r,s,n,o){if(!r.options.selectionMode)return;const a=t.vertexAttributes.get(R.POSITION).data,l=t.vertexAttributes.get(R.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const _=t.vertexAttributes.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=ye(this.parameters.vvSizeOffset[0]+_*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const h=s[0],p=s[1],f=(c/2+4)*t.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],w=a[_+1],T=h-b,S=p-w,E=a[_+3]-b,M=a[_+4]-w,A=ye((E*T+M*S)/(E*E+M*M),0,1),$=E*A-T,I=M*A-S,k=$*$+I*I;k<m&&(m=k,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}intersect(t,i,r,s,n,o){if(!r.options.selectionMode||!t.visible)return;if(!JSe(i))return void se.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=t.vertexAttributes,l=a.get(R.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const T=a.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=ye(this.parameters.vvSizeOffset[0]+T*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(R.SIZE)&&(c*=a.get(R.SIZE).data[0]);const h=r.camera,p=Out;Mo(p,r.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;ue(mR[0],p[0]-f,p[1]+f,0),ue(mR[1],p[0]+f,p[1]+f,0),ue(mR[2],p[0]+f,p[1]-f,0),ue(mR[3],p[0]-f,p[1]-f,0);for(let T=0;T<4;T++)if(!h.unprojectFromRenderScreen(mR[T],oy[T]))return;ol(h.eye,oy[0],oy[1],Fz),ol(h.eye,oy[1],oy[2],Nz),ol(h.eye,oy[2],oy[3],kz),ol(h.eye,oy[3],oy[0],Uz);let m=Number.MAX_VALUE,y=0;const _=fAe(this.parameters,a,t.indices)?l.length-2:l.length-5;for(let T=0;T<_;T+=3){ac[0]=l[T]+i[12],ac[1]=l[T+1]+i[13],ac[2]=l[T+2]+i[14];const S=(T+3)%l.length;if(lc[0]=l[S]+i[12],lc[1]=l[S+1]+i[13],lc[2]=l[S+2]+i[14],Ur(Fz,ac)<0&&Ur(Fz,lc)<0||Ur(Nz,ac)<0&&Ur(Nz,lc)<0||Ur(kz,ac)<0&&Ur(kz,lc)<0||Ur(Uz,ac)<0&&Ur(Uz,lc)<0)continue;if(h.projectToRenderScreen(ac,jb),h.projectToRenderScreen(lc,Hb),jb[2]<0&&Hb[2]>0){me(rm,ac,lc);const M=h.frustum,A=-Ur(M[kr.NEAR],ac)/_e(rm,M[kr.NEAR]);ae(rm,rm,A),fe(ac,ac,rm),h.projectToRenderScreen(ac,jb)}else if(jb[2]>0&&Hb[2]<0){me(rm,lc,ac);const M=h.frustum,A=-Ur(M[kr.NEAR],lc)/_e(rm,M[kr.NEAR]);ae(rm,rm,A),fe(lc,lc,rm),h.projectToRenderScreen(lc,Hb)}else if(jb[2]<0&&Hb[2]<0)continue;jb[2]=0,Hb[2]=0;const E=SK(Zx(jb,Hb,hue),p);E<m&&(m=E,le(cue,ac),le(uue,lc),y=T/3)}const b=r.rayBegin,w=r.rayEnd;if(m<f*f){let T=Number.MAX_VALUE;if(mbe(Zx(cue,uue,hue),Zx(b,w,Iut),Gb)){me(Gb,Gb,b);const S=Oe(Gb);ae(Gb,Gb,1/S),T=S/Vr(b,w)}o(T,Gb,y,!1)}}createLayout(){const t=As().vec3f(R.POSITION).f32(R.SUBDIVISIONFACTOR).vec2f(R.UV0).vec3f(R.AUXPOS1).vec3f(R.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(R.SIZEFEATUREATTRIBUTE):t.f32(R.SIZE),this.parameters.vvColorEnabled?t.f32(R.COLORFEATUREATTRIBUTE):t.vec4f(R.COLOR),this.parameters.vvOpacityEnabled&&t.f32(R.OPACITYFEATUREATTRIBUTE),he("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(R.OBJECTANDLAYERIDCOLOR),t}createBufferWriter(){return new Mut(this._layout,this.parameters)}requiresSlot(t,i){return i===z.Color||i===z.Alpha||i===z.Highlight||i===z.Depth||i===z.ObjectAndLayerIdColor?t===Ee.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Is.OccludeAndTransparentStencil?t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL:i===z.Color||i===z.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL:!1}createGLMaterial(t){return new Cut(t)}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0),v(t.markerParameters)&&(t.markerScale=t.markerParameters.width/t.width)}}class Cut extends yb{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output!==z.Color&&this._output!==z.Alpha||this._updateOccludeeState(t);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,i)),this._stipplePattern=i),this.ensureTechnique(G8,t)}}class Aut extends Oee{constructor(){super(...arguments),this.width=0,this.color=jd,this.join="miter",this.cap=Qd.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class Mut{constructor(t,i){this._parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=Xk+r}}_isClosed(t){return fAe(this._parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const r=t.indices.get(R.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(t,i,r,s,n){var re;const o=Put,a=$ut,l=Lut,c=r.vertexAttributes.get(R.POSITION).data,h=r.indices&&r.indices.get(R.POSITION),p=(re=r.vertexAttributes.get(R.DISTANCETOSTART))==null?void 0:re.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSizeEnabled?m=r.vertexAttributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(R.SIZE)&&(f=r.vertexAttributes.get(R.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColorEnabled?_=r.vertexAttributes.get(R.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(R.COLOR)&&(y=r.vertexAttributes.get(R.COLOR).data);const b=he("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let w=0;this._parameters.vvOpacityEnabled&&(w=r.vertexAttributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const T=c.length/3,S=new Float32Array(s.buffer),E=he("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,M=this.vertexBufferLayout.stride/4;let A=n*M;const $=A;let I=0;const k=p?(q,L,N)=>I=p[N]:(q,L,N)=>I+=Vr(q,L),V=he("enable-feature:objectAndLayerId-rendering"),B=(q,L,N,U,W,Z,ie)=>{if(S[A++]=L[0],S[A++]=L[1],S[A++]=L[2],S[A++]=U,S[A++]=ie,S[A++]=W,S[A++]=q[0],S[A++]=q[1],S[A++]=q[2],S[A++]=N[0],S[A++]=N[1],S[A++]=N[2],this._parameters.vvSizeEnabled?S[A++]=m:S[A++]=f,this._parameters.vvColorEnabled)S[A++]=_;else{const Y=Math.min(4*Z,y.length-4);S[A++]=y[Y],S[A++]=y[Y+1],S[A++]=y[Y+2],S[A++]=y[Y+3]}this._parameters.vvOpacityEnabled&&(S[A++]=w),V&&(v(b)&&(E[4*A]=b[0],E[4*A+1]=b[1],E[4*A+2]=b[2],E[4*A+3]=b[3]),A++)};A+=M,ue(a,c[0],c[1],c[2]),t&&Ze(a,a,t);const G=this._isClosed(r);if(G){const q=c.length-3;ue(o,c[q],c[q+1],c[q+2]),t&&Ze(o,o,t)}else ue(l,c[3],c[4],c[5]),t&&Ze(l,l,t),B(a,a,l,1,hu.LEFT_CAP_START,0,0),B(a,a,l,1,hu.RIGHT_CAP_START,0,0),le(o,a),le(a,l);const X=G?0:1,K=G?T:T-1;for(let q=X;q<K;q++){const L=(q+1)%T*3;ue(l,c[L],c[L+1],c[L+2]),t&&Ze(l,l,t),k(o,a,q),B(o,a,l,0,hu.LEFT_JOIN_END,q,I),B(o,a,l,0,hu.RIGHT_JOIN_END,q,I);const N=this.numJoinSubdivisions;for(let U=0;U<N;++U){const W=(U+1)/(N+1);B(o,a,l,W,hu.LEFT_JOIN_END,q,I),B(o,a,l,W,hu.RIGHT_JOIN_END,q,I)}B(o,a,l,1,hu.LEFT_JOIN_START,q,I),B(o,a,l,1,hu.RIGHT_JOIN_START,q,I),le(o,a),le(a,l)}G?(ue(l,c[3],c[4],c[5]),t&&Ze(l,l,t),I=k(o,a,K),B(o,a,l,0,hu.LEFT_JOIN_END,X,I),B(o,a,l,0,hu.RIGHT_JOIN_END,X,I)):(I=k(o,a,K),B(o,a,a,0,hu.LEFT_CAP_END,K,I),B(o,a,a,0,hu.RIGHT_CAP_END,K,I)),Dz(S,$+M,S,$,M),A=Dz(S,A-M,S,A,M),this._parameters.wireframe&&this._addWireframeVertices(s,$,A,M)}_addWireframeVertices(t,i,r,s){const n=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=Dz(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function Dz(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function fAe(e,t,i){return mAe(e,t.get(R.POSITION).data,i?i.get(R.POSITION):null)}function mAe(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}function Rut(e){return e.anchor===BT.Tip&&e.hideOnShortSegments&&e.placement==="begin-end"&&e.worldSpace}const ac=O(),lc=O(),rm=O(),Gb=O(),Out=O(),jb=Ga(),Hb=Ga(),cue=O(),uue=O(),hue=Hf(),Iut=Hf(),Put=O(),$ut=O(),Lut=O(),mR=[Ga(),Ga(),Ga(),Ga()],oy=[O(),O(),O(),O()],Fz=nr(),Nz=nr(),kz=nr(),Uz=nr();class Xee{constructor(t){this._originSR=t,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Ru()}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(i==null){const h=sut.rootOrigin;if(v(h))return this._origins.set(this._rootOriginId,sI(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(t);const p=sI(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),o=Math.round(t[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(me(ra,t,i.vec3),ra[0]=Math.abs(ra[0]),ra[1]=Math.abs(ra[1]),ra[2]=Math.abs(ra[2]),ra[0]<c&&ra[1]<c&&ra[2]<c){if(l){const h=Math.max(...ra);if(me(ra,t,l.vec3),ra[0]=Math.abs(ra[0]),ra[1]=Math.abs(ra[1]),ra[2]=Math.abs(ra[2]),Math.max(...ra)<h)return l}return i}return l||(l=sI(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(t,i=Yt(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new WE({width:2,color:i}),s.add(this._material);const m=new tAe({pickable:!1}),y=new n_({castShadow:!1});s.add(y),m.add(y),s.add(m),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&a[m]?p:-p),c[3*m+1]=t[1]+(2&a[m]?p:-p),c[3*m+2]=t[2]+(4&a[m]?p:-p),m>0&&h.push(m-1,m);Xs(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new Rn(this._material,[[R.POSITION,new Ke(c,3,!0)]],[[R.POSITION,h]],null,hn.Line);s.add(f),o.addGeometry(f)}get test(){const t=this;return{set gridSize(i){t._gridSize=i}}}}const ra=O();class gAe{constructor(t,i,r,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new Ot,this.output=z.Color,this.renderOccludedMask=due,this.bindParameters=new c8(i,r,v(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=due}}class Dut extends gAe{constructor(t,i,r,s,n){super(t,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n,this.time=0}}const due=Is.Occlude|Is.OccludeAndTransparent|Is.OccludeAndTransparentStencil;let t3=class extends Ot{constructor(){super(...arguments),this._projectionMatrix=Pe()}get projectionMatrix(){return this._projectionMatrix}};u([d()],t3.prototype,"_projectionMatrix",void 0),u([d({readOnly:!0})],t3.prototype,"projectionMatrix",null),t3=u([P("esri.views.3d.webgl-engine.lib.CascadeCamera")],t3);var VA;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(VA||(VA={}));class YD{constructor(){this.camera=new t3,this.lightMat=Pe()}}class Yee{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return mr(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(t,i){this._rctx=t,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=Pe(),this._projectionViewInverse=Pe(),this._modelViewLight=Pe(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=ui(),this._cascades=[new YD,new YD,new YD,new YD],this._lastOrigin=null,this._maxTextureSize=Math.min(he("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this._maxNumCascades=ye(Math.floor(t),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&v(this._depthTexture)}getSnapshot(t){return this.enabled?this._snapshots[t]:null}get cascades(){for(let t=0;t<this._numCascades;++t)Bz[t]=this._cascades[t];return Bz.length=this._numCascades,Bz}start(t,i,r){vt(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(t,i);const{viewMatrix:o,projectionMatrix:a}=t;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,a,o,i);this._lastOrigin=null,this.clear()}finish(t){vt(this.enabled),this._rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this._lastOrigin||!ql(t,this._lastOrigin)){this._lastOrigin=this._lastOrigin||O(),le(this._lastOrigin,t);for(let i=0;i<this._numCascades;++i){Vc(_ue,this._cascades[i].lightMat,t);for(let r=0;r<16;++r)vue[16*i+r]=_ue[r]}}return vue}takeCascadeSnapshotTo(t,i){vt(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this._rctx,n=s.bindTexture(r,pt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(St.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,pt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this._rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(ts.COLOR_BUFFER_BIT|ts.DEPTH_BUFFER_BIT)}_computeTextureSize(t,i){const r=.5*Math.log(t*t+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this._maxTextureSize,2*n)}_ensureDepthTexture(){if(v(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new pt(this._rctx,t),this._fbo=new Yr(this._rctx,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let i=this._snapshots[t];if(v(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(t);const r={target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new pt(this._rctx,r),this._snapshots[t]=i,i}_discardDepthTexture(){this._fbo=rt(this._fbo),this._depthTexture=rt(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=rt(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this._snapshots.length;++t)this._discardSnapshot(t);this._snapshots.length=0}_bindFbo(){const t=this._rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,i,r,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);vt(l<c);for(let m=0;m<8;++m){mr(pue,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=Id[m];Ph(y,pue,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}pl(Vz,Id[0]),n.camera.viewMatrix=Vc(Fut,this._modelViewLight,Vz);for(let m=0;m<8;++m)Ze(Id[m],Id[m],n.camera.viewMatrix);let h=Id[0][2],p=Id[0][2];for(let m=1;m<8;++m)h=Math.min(h,Id[m][2]),p=Math.max(p,Id[m][2]);h-=200,p+=200,n.camera.near=-p,n.camera.far=-h,Vut(r,s,h,p,n.camera),Hs(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureSize/2;n.camera.viewport=[t%2==0?0:f,Math.floor(t/2)===0?0:f,f,f]}_setupMatrices(t,i){Hs(this._projectionView,t.projectionMatrix,t.viewMatrix),Ea(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===je.Global?t.eye:ue(Vz,0,0,1);cU(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(t){let{near:i,far:r}=t;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(t,i){this._numCascades=Math.min(1+Math.floor(Cet(t/i,4)),this._maxNumCascades);const r=(t-i)/this._numCascades,s=(t/i)**(1/this._numCascades);let n=i,o=i;for(let a=0;a<this._numCascades+1;++a)this._cascadeDistances[a]=zt(n,o,this._splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var t,i;return this._snapshots.reduce((r,s)=>r+AT(s),(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0)}get test(){const t=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){t._splitSchemeLambda=i},get splitSchemeLambda(){return t._splitSchemeLambda}}}}const Fut=Pe(),pue=ui(),Id=[];for(let e=0;e<8;++e)Id.push(ui());const fue=tt(),mue=tt(),Nut=tt(),gue=tt(),yue=tt(),Vz=O(),Bz=[],_ue=Pe(),vue=new Float32Array(64),qu=tt(),zS=tt(),qb=[tt(),tt(),tt(),tt()],fo=tt(),zz=tt(),P_=tt(),gR=tt(),GS=tt(),jS=tt(),ZD=tt();function kut(e,t,i,r,s,n,o,a){di(qu,0,0);for(let M=0;M<4;++M)lf(qu,qu,e[M]);xu(qu,qu,.25),di(zS,0,0);for(let M=4;M<8;++M)lf(zS,zS,e[M]);xu(zS,zS,.25),lE(qb[0],e[4],e[5],.5),lE(qb[1],e[5],e[6],.5),lE(qb[2],e[6],e[7],.5),lE(qb[3],e[7],e[4],.5);let l=0,c=pk(qb[0],qu);for(let M=1;M<4;++M){const A=pk(qb[M],qu);A<c&&(c=A,l=M)}eg(fo,qb[l],e[l+4]);const h=fo[0];let p,f;fo[0]=-fo[1],fo[1]=h,eg(zz,zS,qu),Kn(zz,fo)<0&&mQ(fo,fo),lE(fo,fo,zz,i),rP(fo,fo),p=f=Kn(eg(P_,e[0],qu),fo);for(let M=1;M<8;++M){const A=Kn(eg(P_,e[M],qu),fo);A<p?p=A:A>f&&(f=A)}Mo(r,qu),xu(P_,fo,p-t),lf(r,r,P_);let m=-1,y=1,_=0,b=0;for(let M=0;M<8;++M){eg(gR,e[M],r),rP(gR,gR);const A=fo[0]*gR[1]-fo[1]*gR[0];A>0?A>m&&(m=A,_=M):A<y&&(y=A,b=M)}ES(m>0,"leftArea"),ES(y<0,"rightArea"),xu(GS,fo,p),lf(GS,GS,qu),xu(jS,fo,f),lf(jS,jS,qu),ZD[0]=-fo[1],ZD[1]=fo[0];const w=cD(r,e[b],jS,lf(P_,jS,ZD),1,s),T=cD(r,e[_],jS,P_,1,n),S=cD(r,e[_],GS,lf(P_,GS,ZD),1,o),E=cD(r,e[b],GS,P_,1,a);ES(w,"rayRay"),ES(T,"rayRay"),ES(S,"rayRay"),ES(E,"rayRay")}function Ni(e,t){return 3*t+e}const bue=tt();function Hc(e,t){return di(bue,e[t],e[t+3]),bue}const cc=tt(),at=Cs();function Uut(e,t,i,r,s){eg(cc,i,r),xu(cc,cc,.5),at[0]=cc[0],at[1]=cc[1],at[2]=0,at[3]=cc[1],at[4]=-cc[0],at[5]=0,at[6]=cc[0]*cc[0]+cc[1]*cc[1],at[7]=cc[0]*cc[1]-cc[1]*cc[0],at[8]=1,at[Ni(0,2)]=-Kn(Hc(at,0),e),at[Ni(1,2)]=-Kn(Hc(at,1),e);let n=Kn(Hc(at,0),i)+at[Ni(0,2)],o=Kn(Hc(at,1),i)+at[Ni(1,2)],a=Kn(Hc(at,0),r)+at[Ni(0,2)],l=Kn(Hc(at,1),r)+at[Ni(1,2)];n=-(n+a)/(o+l),at[Ni(0,0)]+=at[Ni(1,0)]*n,at[Ni(0,1)]+=at[Ni(1,1)]*n,at[Ni(0,2)]+=at[Ni(1,2)]*n,n=1/(Kn(Hc(at,0),i)+at[Ni(0,2)]),o=1/(Kn(Hc(at,1),i)+at[Ni(1,2)]),at[Ni(0,0)]*=n,at[Ni(0,1)]*=n,at[Ni(0,2)]*=n,at[Ni(1,0)]*=o,at[Ni(1,1)]*=o,at[Ni(1,2)]*=o,at[Ni(2,0)]=at[Ni(1,0)],at[Ni(2,1)]=at[Ni(1,1)],at[Ni(2,2)]=at[Ni(1,2)],at[Ni(1,2)]+=1,n=Kn(Hc(at,1),t)+at[Ni(1,2)],o=Kn(Hc(at,2),t)+at[Ni(2,2)],a=Kn(Hc(at,1),i)+at[Ni(1,2)],l=Kn(Hc(at,2),i)+at[Ni(2,2)],n=-.5*(n/o+a/l),at[Ni(1,0)]+=at[Ni(2,0)]*n,at[Ni(1,1)]+=at[Ni(2,1)]*n,at[Ni(1,2)]+=at[Ni(2,2)]*n,n=Kn(Hc(at,1),t)+at[Ni(1,2)],o=Kn(Hc(at,2),t)+at[Ni(2,2)],a=-o/n,at[Ni(1,0)]*=a,at[Ni(1,1)]*=a,at[Ni(1,2)]*=a,s[0]=at[0],s[1]=at[1],s[2]=0,s[3]=at[2],s[4]=at[3],s[5]=at[4],s[6]=0,s[7]=at[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=at[6],s[13]=at[7],s[14]=0,s[15]=at[8]}function Vut(e,t,i,r,s){const n=1/Id[0][3],o=1/Id[4][3];vt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(uo(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,kut(Id,a,l,fue,mue,Nut,gue,yue),Uut(fue,mue,gue,yue,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function But(e){return Xf(e)&&e.intersector===Ss.TERRAIN&&!!e.target}class zut extends m8{constructor(t,i,r){super(t,i),this.triangleNr=r}}function yAe(e){return Xf(e)&&e.intersector===Ss.OVERLAY&&!!e.target}class HX{constructor(){this.adds=new ri,this.removes=new ri,this.updates=new ri({allocator:t=>t||new Gut,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}}class Gut{}class jut{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var Os,wo;(function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"})(Os||(Os={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(wo||(wo={}));function _Ae(e){const t=new Map,i=r=>{let s=t.get(r);return s||(s=new jut,t.set(r,s)),s};return e.removes.forAll(r=>{Gz(r)&&i(r.material).removes.push(r)}),e.adds.forAll(r=>{Gz(r)&&i(r.material).adds.push(r)}),e.updates.forAll(r=>{Gz(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),t}function Gz(e){return e.geometry.indexCount>=1}class Hut{constructor(t){this._rctx=t,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){const t=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,i=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(t,i,new Map([]))}_createIndexbuffer(){return Oi.createIndex(this._rctx,Xi.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,$t.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Nt.POINTS,1,dt.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}}class vAe{constructor(t,i){this._material=t,this._repository=i,this._map=new Map}destroy(){this._map.forEach((t,i)=>{v(t)&&this._repository.release(this._material,i)})}load(t,i,r){if(!this._material.requiresSlot(i,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const s=this._map.get(r);if(v(s)){if(s.ensureResources(t)===_0.LOADED)return s;this._repository.requestRender()}return null}}function qut(e){const t=x`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.vertex.code.add(t)}function X$(e,t){switch(t.normalType){case yr.CompressedAttribute:e.include(qut),e.attributes.add(R.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(x`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case yr.Attribute:e.attributes.add(R.NORMAL,"vec3"),e.vertex.code.add(x`vec3 normalModel() {
return normal;
}`);break;case yr.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:t.normalType;case yr.COUNT:case yr.Ground:}}var yr;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(yr||(yr={}));function j8(e,t){switch(t.normalType){case yr.Attribute:case yr.CompressedAttribute:e.include(X$,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new aP("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new Gg("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),e.vertex.code.add(x`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case yr.Ground:e.include(vC,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(x`
        void forwardNormal() {
          vNormalWorld = ${t.spherical?x`normalize(vPositionWorldCameraRelative);`:x`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case yr.ScreenDerivative:e.vertex.code.add(x`void forwardNormal() {}`);break;default:t.normalType;case yr.COUNT:}}class bAe extends qSe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Cs()}}class wAe extends WSe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Cs(),this.toMapSpace=ui()}}class qX extends wAe{constructor(t=O()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}class MM{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(R.POSITION).length}write(t,i,r,s,n){zEe(r,this.vertexBufferLayout,t,i,s,n)}}const Wut=As().vec3f(R.POSITION),Xut=As().vec3f(R.POSITION).vec2f(R.UV0),xAe=As().vec3f(R.POSITION).vec4u8(R.COLOR);As().vec3f(R.POSITION).vec4u8(R.OBJECTANDLAYERIDCOLOR);As().vec3f(R.POSITION).vec2f(R.UV0).vec4u8(R.OBJECTANDLAYERIDCOLOR);const Yut=As().vec3f(R.POSITION).vec4u8(R.COLOR).vec4u8(R.OBJECTANDLAYERIDCOLOR);class Zee extends _b{intersect(t,i,r,s,n,o){return IEe(t,r,s,n,void 0,o)}}function Zut(e){e.fragment.code.add(x`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Jut(e){e.fragment.code.add(x`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function wue(e){e.fragment.uniforms.add(new Lt("texWaveNormal",t=>t.waveNormal)),e.fragment.uniforms.add(new Lt("texWavePerturbation",t=>t.wavePertubation)),e.fragment.uniforms.add([new xi("waveParams",t=>mr(Kut,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new tr("waveDirection",t=>di(Qut,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(Zut),e.fragment.code.add(x`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Kut=ui(),Qut=tt();function FP(e,t){t.spherical?e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class Y$ extends Zs{constructor(t,i){super(t,"int",Ar.Pass,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}class eht extends Zs{constructor(t,i,r){super(t,"mat4",Ar.Draw,(s,n,o)=>s.setUniformMatrix4fv(t,i(n,o)),r)}}class tht extends Zs{constructor(t,i,r){super(t,"mat4",Ar.Pass,(s,n,o)=>s.setUniformMatrix4fv(t,i(n,o)),r)}}class TAe extends Rr{constructor(){super(...arguments),this.origin=O()}}function H8(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new tht("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),SAe(e,t))}function zT(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new eht("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),SAe(e,t))}function SAe(e,t){const i=e.fragment;i.include(ku),i.uniforms.add([...Rf("shadowMapTex",(r,s)=>s.shadowMap.depthTexture,t.hasWebGL2Context?fr.None:fr.Size),new Y$("numCascades",(r,s)=>s.shadowMap.numCascades),new xi("cascadeDistances",(r,s)=>s.shadowMap.cascadeDistances)]),i.code.add(x`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${Zd(t,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}function iht(e){const t=e.fragment.code;t.add(x`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(x`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(x`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function Jee(e,t){const i=e.fragment.code;e.include(D$),t.pbrMode!==gt.Normal&&t.pbrMode!==gt.Schematic&&t.pbrMode!==gt.Terrain&&t.pbrMode!==gt.TerrainWithWater||(i.add(x`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(x`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),t.pbrMode!==gt.Normal&&t.pbrMode!==gt.Schematic||(e.include(iht),i.add(x`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(x`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(x`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(x`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function rht(e,t){const i=e.fragment.code;e.include(D$),i.add(x`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(x`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(x`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(x`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(x`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function EAe(e,t){e.include(rht,t),e.include(r8),e.include(Jut),t.hasCloudsReflections&&e.include(CSe,t),t.hasScreenSpaceReflections&&e.include(NQe,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(x`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new Ie("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(x`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?(i.uniforms.add([new ds("view",(r,s)=>s.ssr.camera.viewMatrix),new Lt("lastFrameColorTexture",(r,s)=>s.ssr.lastFrameColorTexture),new Ie("fadeFactor",(r,s)=>s.ssr.fadeFactor)]),i.code.add(x`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(x`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(x`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor;
}`)}function sht(e){const t=new Yi,{vertex:i,fragment:r}=t;Pu(i,e),t.include(Dc,e),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.UV0,"vec2");const s=new xi("waterColor",n=>n.color);if(e.output===z.Color&&e.isDraped)return t.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(qa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(s),r.code.add(x`void main() {
gl_FragColor = waterColor;
}`),t;switch(e.output!==z.Color&&e.output!==z.Alpha||(t.include(FP,e),t.include(bM,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.uniforms.add(s),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(qa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===z.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(Xh,e),e.output){case z.Alpha:t.include(An,e),r.uniforms.add(s),r.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case z.Color:t.include(fk,e),t.include(CQ,{pbrMode:gt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(wue),t.include(An,e),t.include(zT,e),t.include(EAe,e),r.uniforms.add([s,new Ie("timeElapsed",n=>n.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")]),zf(r,e),r.include(zg),Y0(r),Bg(r),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?x`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case z.Normal:t.include(FP,e),t.include(wue,e),t.include(An,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.uniforms.add(s),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(qa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Ie("timeElapsed",n=>n.timeElapsed)),r.code.add(x`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case z.Highlight:t.include(i_,e),t.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(qa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(An,e),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const nht=Object.freeze(Object.defineProperty({__proto__:null,build:sht},Symbol.toStringTag,{value:"Module"}));class q8 extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2,i.spherical=t.viewingMode===je.Global,i.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new Ji(t.rctx,q8.shader.get().build(this.configuration),ji)}_setPipelineState(t){const i=this.configuration,r=t===Ct.NONE,s=t===Ct.FrontFace;return Ht({blending:i.output!==z.Normal&&i.output!==z.Highlight&&i.transparent?r?Vh:r_(t):null,depthTest:{func:vb(t)},depthWrite:r?i.writeDepth?zc:null:P8(t),colorWrite:si,polygonOffset:r||s?null:D8(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}q8.shader=new Zi(nht,()=>Q(()=>import("./WaterSurface.glsl.241e40d0.js"),[]));class fa extends qo{constructor(){super(...arguments),this.output=z.Color,this.transparencyPassType=Ct.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:z.COUNT})],fa.prototype,"output",void 0),u([j({count:Ct.COUNT})],fa.prototype,"transparencyPassType",void 0),u([j()],fa.prototype,"spherical",void 0),u([j()],fa.prototype,"receiveShadows",void 0),u([j()],fa.prototype,"hasSlicePlane",void 0),u([j()],fa.prototype,"transparent",void 0),u([j()],fa.prototype,"enableOffset",void 0),u([j()],fa.prototype,"writeDepth",void 0),u([j()],fa.prototype,"hasScreenSpaceReflections",void 0),u([j()],fa.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],fa.prototype,"hasCloudsReflections",void 0),u([j()],fa.prototype,"isDraped",void 0),u([j()],fa.prototype,"hasMultipassTerrain",void 0),u([j()],fa.prototype,"cullAboveGround",void 0),u([j({constValue:gt.Water})],fa.prototype,"pbrMode",void 0),u([j({constValue:!0})],fa.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!0})],fa.prototype,"highStepCount",void 0),u([j({constValue:!1})],fa.prototype,"useFillLights",void 0);class oht extends yb{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const i=v(t.cloudsFade.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(t){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(t)}beginSlot(t){return this._output===z.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(q8,t)}}class CAe extends Zee{constructor(t){super(t,new AAe),this._configuration=new fa,this.animation=new i2e}getConfiguration(t,i){return this._configuration.output=t,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<$8,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<aht;const r=this.animation.advance(t);return this.setParameters({timeElapsed:_Z(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}requiresSlot(t,i){switch(i){case z.Normal:return t===Ee.DRAPED_WATER;case z.Color:if(this.parameters.isDraped)return t===Ee.DRAPED_MATERIAL;break;case z.Alpha:break;case z.Highlight:return t===Ee.OPAQUE_MATERIAL||t===Ee.DRAPED_MATERIAL;default:return!1}let r=Ee.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===r}createGLMaterial(t){return new oht(t)}createBufferWriter(){return new MM(Xut)}}class AAe extends CM{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=er(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Yt(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const aht=35e3;class Kee{constructor(t=0,i=0){this.from=t,this.to=i}get numElements(){return this.to-this.from}}function xue(e){const t=new Map;e.forAll(r=>t.set(r.from,r));let i=!0;for(;i;)i=!1,e.forEach(r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)})}class Tue extends Kee{constructor(t,i,r){super(i,r),this.geometry=t}get isVisible(){return this.geometry.visible}get hasHighlights(){return v(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return v(this.geometry.occludees)}}class lht{constructor(){this.first=0,this.count=0}}class cht{constructor(){this._numElements=0,this._instances=new Map,this.holes=new ri({allocator:t=>t||new Kee,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=JD(),this.drawCommandsHighlight=JD(),this.drawCommandsOccludees=JD(),this.drawCommandsShadowHighlightRest=JD()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(t,i){this.deleteInstance(t),this._instances.set(t,i),this._numElements+=i.numElements}deleteInstance(t){const i=this._instances.get(t);i&&(this._numElements-=i.numElements,this._instances.delete(t))}updateInstance(t,i,r){const s=this._instances.get(t);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(t){t.isVisible?(t.hasHighlights&&(this.hasHighlights=!0),t.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(t){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return v(this.vao)&&this.holes.length===1&&s.to===Math.floor(this.vao.size/t)?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,s)=>r.from===s.from?r.to-s.to:r.from-s.from);for(const r of i)r.isVisible&&(Sue(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),Sue(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function uht(e){return v(e.vao)}function JD(){return new ri({allocator:e=>e||new lht,deallocator:e=>e})}function Sue(e,t){const i=e.back();if(i==null){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(hht(i,t)){const r=t.from-i.first+t.numElements;i.count=r}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}function hht(e,t){return e.first+e.count>=t.from}class dht{constructor(t){this.origin=t,this.buffers=new Array}dispose(){this.buffers.forEach(t=>t.vao.dispose()),this.buffers.length=0}findBuffer(t){return this.buffers.find(i=>i.instances.has(t))}}const pht=kN+1;class fht{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=t.newCache(`VaoCache ${Ru()}`,mht)}dispose(){this._cache.destroy()}newVao(t){const i=t.toString(),r=this._cache.pop(i);if(v(r)){const n=r.pop();return r.length>0&&this._cache.put(i,r,t*r.length,pht),n}const s=new Wf(this._rctx,this._locations,{geometry:this._layout},{geometry:Oi.createVertex(this._rctx,Xi.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(t),s}deleteVao(t){if(C(t))return null;const i=t.size,r=i.toString(),s=this._cache.pop(r);return v(s)?(s.push(t),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[t],i,-1),null}}function mht(e,t){if(t===t0.ALL)return void e.forEach(s=>s.dispose());const i=e.pop(),r=e.length*i.size;return i.dispose(),r}class MAe{constructor(t,i,r){this._rctx=t,this._materialRepository=i,this.material=r,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new vAe(this.material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._vaoCache=new fht(t,r.vertexAttributeLocations,Uu(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new Hut(this._rctx))}dispose(){var t;this._glMaterials.destroy(),this._dataByOrigin.forEach(i=>i.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(t=this._appleAmdDriverHelper)==null||t.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof CAe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Is.Occlude}get numGeometries(){let t=0;return this._dataByOrigin.forEach(i=>t+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),t}forEachGeometry(t){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(s=>t(s.geometry))))}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateDrawCommands()}_updateGeometries(t){var s;const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const n of t){const o=n.renderGeometry,a=(s=this._dataByOrigin.get(o.localOrigin.id))==null?void 0:s.findBuffer(o.id);if(C(a))return;const l=a.instances.get(o.id);if(n.updateType&(wo.GEOMETRY|wo.TRANSFORMATION)){const c=tF(i.elementCount(l.geometry.geometry)*r),h=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(o,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}n.updateType&(wo.HIGHLIGHT|wo.OCCLUDEE|wo.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(t,i){var s;const r=new wM;for(const n of t){const o=n.localOrigin;if(C(o))continue;let a=r.get(o.id,null);C(a)&&(a=new Eue(o.vec3),r.set(o.id,null,a)),a.changes.push(n)}for(const n of i){const o=n.localOrigin;if(C(o))continue;const a=(s=this._dataByOrigin.get(o.id))==null?void 0:s.findBuffer(n.id);if(C(a))continue;let l=r.get(o.id,a);C(l)&&(l=new Eue(o.vec3),r.set(o.id,a,l)),l.changes.push(n)}return r}_addAndRemoveGeometries(t,i){const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(t,i);o.forEach((a,l)=>{const c=a.get(null),h=v(c)?c.changes:[];o.delete(l,null);let p=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),C(m))return void vt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),xI(p.buffers,m),void(p.buffers.length===0&&h.length===0&&s.delete(l));const y=m.numElements,_=m.vao.size/4,b=h.reduce((E,M)=>E+r.elementCount(M.geometry),0),w=f.changes.reduce((E,M)=>E+r.elementCount(M.geometry),0),T=Math.min((y+b-w)*n,eF),S=T>_;T>Zk&&T<_/2?(f.changes.forEach(({id:E})=>m.deleteInstance(E)),m.instances.forEach(({geometry:E})=>h.push(E)),this._vaoCache.deleteVao(m.vao),xI(p.buffers,m)):S?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(C(p)&&(p=new dht(c.origin),s.set(l,p)),p.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new cht,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(t=>{t.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,za(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(t,i,r){if(v(r))for(const y of r.changes)t.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(eF/o);let l=t.numElements;for(;i.length>0;){const y=i.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){i.push(y);break}l+=_;const b=new Tue(y,0,0);vt(t.instances.get(y.id)==null),t.addInstance(y.id,b)}const c=l*o,h=tF(c),p=s.vertexBufferLayout.createView(h.buffer);let f=0;t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,t.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,p,f);const b=f;f+=s.elementCount(y.geometry.geometry),t.updateInstance(_,b,f),t.updateDrawState(y)}),this._vaoCache.deleteVao(t.vao),t.vao=this._vaoCache.newVao(Aue(c)),t.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),t.holes.clear();const m=t.holes.pushNew();return m.from=f,m.to=Math.floor(t.vao.size/n),t.updateDrawCommands(n),t}_applyRemoves(t,i){if(i.changes.length===0)return;for(const a of i.changes){const l=a.id,c=t.instances.get(l);if(!c)continue;t.deleteInstance(l);const h=sm.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=sm.pushNew();p.from=c.from,p.to=c.to}xue(sm);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=sm.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=tF(s);n.fill(0,0,s);const o=t.vao.vertexBuffers.geometry;sm.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),t.holes.pushArray(sm.data,sm.length),sm.forAll((a,l)=>sm.data[l]=null),sm.clear(),t.drawCommandsDirty=!0}_applyAdds(t,i){if(i.length===0)return;if(!uht(t))return void this._applyAndRebuild(t,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=t.numElements,o=i.reduce((w,T)=>w+r.elementCount(T.geometry),0),a=Math.min((n+o)*s,eF),l=4*a;if(t.vao.size<Aue(eF-Zk)&&l>t.vao.size)return void this._applyAndRebuild(t,i,null);xue(t.holes);const c=new Array;for(const w of i){const T=r.elementCount(w.geometry),S=ght(t.holes,T);c.push(S)}const h=t.vao.vertexBuffers.geometry;let p=0,f=0,m=0;const y=tF(a),_=r.vertexBufferLayout.createView(y.buffer);i.forEach((w,T)=>{const S=c[T];if(C(S))return;if(m!==S){const A=m-f;A>0&&h.setSubData(y,f*s,0,A*s),f=S,p=0}const E=r.elementCount(w.geometry);this._writeGeometry(w,_,p),p+=E,m=S+E;const M=new Tue(w,S,S+E);vt(t.instances.get(w.id)==null),t.addInstance(w.id,M),t.drawCommandsDirty=!0});const b=m-f;b>0&&h.setSubData(y,f*s,0,b*s),gIe(i,(w,T)=>C(c[T]))}_writeGeometry(t,i,r){const s=t.localOrigin.vec3;Aet(Cue,-s[0],-s[1],-s[2]);const n=Hs(yht,Cue,t.transformation);Ea(KD,n),Lu(KD,KD),this._bufferWriter.write(n,KD,t.geometry,i,r)}updateAnimation(t){return this.material.update(t)}requiresSlot(t,i){return this.material.requiresSlot(t,i)}render(t,i){var c;if(!this.requiresSlot(i.slot,t))return!1;const r=t===z.Highlight||t===z.ShadowHighlight;if(r&&!this._hasHighlights)return!1;const s=t===z.ShadowExcludeHighlight,n=!(r||s),o=this._rctx;let a;const l=()=>{if(v(a))return a;const h=this._glMaterials.load(o,i.slot,t);return C(h)?null:(a=h.beginSlot(i),C(a)?null:(o.bindTechnique(a,this.material.parameters,i),a))};(c=this._appleAmdDriverHelper)==null||c.resetIndicesType();for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(r&&!p.hasHighlights)continue;const f=(r?p.drawCommandsHighlight:s&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,m=n&&p.drawCommandsOccludees||null;if((f==null?void 0:f.length)||(m==null?void 0:m.length)){const y=l();if(C(y))return!1;y.program.bindDraw(new qX(h.origin),i,this.material.parameters),y.ensureAttributeLocations(p.vao),o.bindVAO(p.vao),f!=null&&f.length&&(y.bindPipelineState(o,i.slot,!1),f.forAll(_=>o.drawArrays(y.primitiveType,_.first,_.count))),m!=null&&m.length&&(y.bindPipelineState(o,i.slot,!0),m.forAll(_=>o.drawArrays(y.primitiveType,_.first,_.count)))}}return v(a)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Eue{constructor(t){this.origin=t,this.changes=new Array}}function ght(e,t){let i;if(!e.some(s=>!(s.numElements<t)&&(i=s,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}const Cue=Pe(),yht=Pe(),KD=Pe(),sm=new ri({allocator:e=>e||new Kee,deallocator:null}),Zk=65536,QD=4*Zk,RAe=16777216,eF=RAe/4;let jz=new Float32Array(Zk);function tF(e){return jz.length<e&&(jz=new Float32Array(e)),jz}function Aue(e){const t=4*e;return t<QD?QD:Math.max(Math.min(Math.ceil(1.5*t/QD)*QD,RAe),t)}let uh=class extends Te{constructor(e){super(e),this._pending=new _ht,this._changes=new HX,this._materialRenderers=new Map,this._sortedMaterialRenderers=new ri,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return za(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=_Ae(this._changes);let t=!1,i=!1,r=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new MAe(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,i=!0,r=!0),!o)return;const a=i||o.hasHighlights,l=r||o.hasWater;o.modify(s),i=i||a!==o.hasHighlights,r=r||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=za(this._materialRenderers,s=>s.hasHighlights)),r&&(this._hasWater=za(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const r=this._pending.empty;for(const s of i)this._pending.adds.add(s);r&&this.notifyChange("updating"),t===Os.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const s of e)r.has(s)?(this._pending.removed.add(s),r.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===Os.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=this._changes.updates.length===0;for(const r of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(r),s.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case wo.TRANSFORMATION:case wo.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case wo.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(i=>t=i.updateAnimation(e)||t),t}render(e){this._sortedMaterialRenderers.forAll(t=>{t.material.shouldRender(e)&&t.render(e.output,e.bindParameters)})}intersect(e,t,i,r,s){return this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(t)}),this._sortedMaterialRenderers.sort((t,i)=>{const r=i.material.renderPriority-t.material.renderPriority;return r!==0?r:t.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.visible)return;let o=0;r+=e.transformation[12],o=e.transformation[13],Hz[0]=i[0]-r,Hz[1]=i[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,Hz,(a,l,c)=>{vht(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},t)}_notifyGraphicGeometryChanged(e){if(C(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const r=i.graphicUid;v(r)&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}}_notifyGraphicVisibilityChanged(e){if(C(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const r=i.graphicUid;v(r)&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return C(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],uh.prototype,"drapeSource",void 0),u([d()],uh.prototype,"updating",null),u([d()],uh.prototype,"rctx",null),u([d()],uh.prototype,"rendererContext",void 0),u([d()],uh.prototype,"_materialRepository",null),u([d()],uh.prototype,"_localOriginFactory",null),u([d({readOnly:!0})],uh.prototype,"isEmpty",null),u([d()],uh.prototype,"_materialRenderers",void 0),u([d()],uh.prototype,"_geometries",void 0),uh=u([P("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],uh);class _ht{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function vht(e,t,i,r,s,n,o){const a=new zut(n,o,t),l=c=>{c.set(Ss.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Aa.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Aa.ALL){const c=ZQ(s.ray);l(c),s.results.all.push(c)}}const Hz=tt(),qz=4;function bht(){const e=new Yi,t=e.fragment;e.include(mp);const i=(qz+1)/2,r=1/(2*i*i);return t.include(Wh),t.uniforms.add([new Lt("depthMap",s=>s.depthTexture),new L$("tex",s=>s.colorTexture),new oP("blurSize",s=>s.blurSize),new Ie("projScale",(s,n)=>{const o=Vr(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new tr("nearFar",(s,n)=>n.camera.nearFar)]),t.code.add(x`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${x.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.code.add(x`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${x.int(qz)}; r <= ${x.int(qz)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),e}const wht=Object.freeze(Object.defineProperty({__proto__:null,build:bht},Symbol.toStringTag,{value:"Module"}));class W8 extends ir{initializeProgram(t){return new Ji(t.rctx,W8.shader.get().build(),ji)}initializePipeline(){return Ht({colorWrite:si})}}W8.shader=new Zi(wht,()=>Q(()=>import("./SSAOBlur.glsl.e9c424ab.js"),[]));const xht="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function X8(e){e.fragment.uniforms.add(new xi("projInfo",(t,i)=>Tht(i))),e.fragment.uniforms.add(new tr("zScale",(t,i)=>OAe(i))),e.fragment.code.add(x`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Tht(e){const t=e.camera.projectionMatrix;return t[11]===0?mr(Mue,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):mr(Mue,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const Mue=ui();function OAe(e){return e.camera.projectionMatrix[11]===0?di(Rue,0,1):di(Rue,1,0)}const Rue=tt(),Oue=16;function Sht(){const e=new Yi,t=e.fragment;return e.include(mp),t.include(Wh),e.include(X8),t.uniforms.add(new Ie("radius",(i,r)=>Qee(r.camera))),t.code.add(x`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),t.code.add(x`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.uniforms.add([new tr("nearFar",(i,r)=>r.camera.nearFar),new Lt("normalMap",i=>i.normalTexture),new Lt("depthMap",i=>i.depthTexture),new tr("zScale",(i,r)=>OAe(r)),new Ie("projScale",i=>i.projScale),new Lt("rnm",i=>i.noiseTexture),new tr("rnmScale",(i,r)=>di(Iue,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new Ie("intensity",i=>i.intensity),new tr("screenSize",(i,r)=>di(Iue,r.camera.fullWidth,r.camera.fullHeight))]),t.code.add(x`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${x.int(Oue)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${x.int(Oue)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),e}function Qee(e){return Math.max(10,20*e.computeRenderPixelSizeAtDist(Math.abs(4*e.relativeElevation)))}const Iue=tt(),Eht=Object.freeze(Object.defineProperty({__proto__:null,build:Sht,getRadius:Qee},Symbol.toStringTag,{value:"Module"}));class Y8 extends ir{initializeProgram(t){return new Ji(t.rctx,Y8.shader.get().build(),ji)}initializePipeline(){return Ht({colorWrite:si})}}Y8.shader=new Zi(Eht,()=>Q(()=>import("./SSAO.glsl.9fb04118.js"),[]));class Cht extends Rr{constructor(){super(...arguments),this.projScale=1}}class Aht extends Cht{constructor(){super(...arguments),this.intensity=1}}class Mht extends Rr{}class Rht extends Mht{constructor(){super(...arguments),this.blurSize=tt()}}const i3=2;class IAe{constructor(t,i,r,s){this._view=t,this._techniqueRepository=i,this._rctx=r,this._requestRender=s,this._quadVAO=null,this._passParameters=new Aht,this._drawParameters=new Rht}dispose(){this.enabled=!1,this._quadVAO=rt(this._quadVAO)}disposeOffscreenBuffers(){Mn(this._ssaoFBO,t=>t.resize(0,0)),Mn(this._blur0FBO,t=>t.resize(0,0)),Mn(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return v(this._enableTime)}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return v(this._blur1FBO)?this._blur1FBO.colorTexture:null}render(t,i,r,s){if(C(this._enableTime)||C(r)||C(s)||C(this._ssaoFBO)||C(this._blur0FBO)||C(this._blur1FBO))return;if(!this.active)return this._enableTime=i,void this._requestRender();this._enableTime===0&&(this._enableTime=i);const n=this._rctx,o=t.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,i-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=r,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*Oht/Qee(o)**6*l;const c=o.fullViewport,h=c[2],p=c[3],f=h/i3,m=p/i3;this._ssaoFBO.resize(h,p),this._blur0FBO.resize(f,m),this._blur1FBO.resize(f,m),C(this._quadVAO)&&(this._quadVAO=Tl(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.bindTechnique(this._ssaoTechnique,this._passParameters,t).bindDraw(this._drawParameters,t,this._passParameters),n.bindVAO(this._quadVAO);const y=ja(this._quadVAO,"geometry");n.drawArrays(Nt.TRIANGLE_STRIP,0,y);const _=n.bindTechnique(this._blurTechnique,this._passParameters,t);n.setViewport(0,0,f,m),n.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,di(this._drawParameters.blurSize,0,i3/p),_.bindDraw(this._drawParameters,t,this._passParameters),n.setViewport(0,0,f,m),n.drawArrays(Nt.TRIANGLE_STRIP,0,y),n.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,di(this._drawParameters.blurSize,i3/h,0),_.bindDraw(this._drawParameters,t,this._passParameters),n.drawArrays(Nt.TRIANGLE_STRIP,0,y),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(v(this._enableTime))return;const t={target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:Pt.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE};this._ssaoFBO=new Yr(this._rctx,i,t),this._blur0FBO=new Yr(this._rctx,i,t),this._blur1FBO=new Yr(this._rctx,i,t);const r=Uint8Array.from(atob(xht),s=>s.charCodeAt(0));this._passParameters.noiseTexture=new pt(this._rctx,{target:St.TEXTURE_2D,pixelFormat:ze.RGB,dataType:kt.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},r),C(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(Y8)),C(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(W8)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=rt(this._passParameters.noiseTexture),this._blur1FBO=rt(this._blur1FBO),this._blur0FBO=rt(this._blur0FBO),this._ssaoFBO=rt(this._ssaoFBO)}get gpuMemoryUsage(){return(v(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(v(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(v(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const Oht=.5;class Z$ extends ir{initializeProgram(t){return new Ji(t.rctx,Z$.shader.get().build(),ji)}initializePipeline(){return this.configuration.hasAlpha?Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si}):Ht({colorWrite:si})}}Z$.shader=new Zi(rat,()=>Q(()=>import("./TextureOnly.glsl.5024cd60.js"),[]));class ete extends xl{constructor(){super(...arguments),this.hasAlpha=!1}}u([j()],ete.prototype,"hasAlpha",void 0);let Yp=class extends Te{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Ii,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new ri,this._passParameters=new Aee,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new Ot,this.worldToPCSRatio=1,this.events=new ps,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new rAe(e.renderingContext),this._shaderTechniqueRepository=new JCe({rctx:this._rctx,viewingMode:je.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new gAe(this._rctx,new Yee(this._rctx,this.view.state.viewingMode),new IAe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([te(()=>t.updating,()=>this.events.emit("content-changed"),Gs),te(()=>this.spatialReference,i=>this._localOriginFactory=new Xee(i),Gs),Fs(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new KCe(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&Jk)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ee.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=_Se(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=Ct.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new LQ(Le(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(xt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=ls(this._debugTextureTechnique),this._passParameters.texture=rt(this._passParameters.texture),this._bindParameters.highlightDepthTexture=rt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Be(this._shaderTechniqueRepository),this._temporaryFBO=rt(this._temporaryFBO),this._quadVAO=rt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||za(this._renderers,e=>e.updating)}get hasOverlays(){return v(this._overlays)&&v(this._overlayRenderTarget)}get gpuMemoryUsage(){return v(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,uh)}createDrapeSourceRenderer(e,t,i){const r=this._renderers.get(e);v(r)&&r.destroy();const s=new t({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(te(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(C(e))return;const t=this._renderers.get(e);C(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(v(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const[r,s]=this.overlays,n=r.validTargets[i.type]||!s.validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(n,i,e)||t}return t}get overlays(){return Ft(this._overlays,[])}ensureDrapeTargets(e){v(this._overlays)&&this._overlays.forEach(t=>t.hasTargetWithoutRasterImage=lN(e,i=>i.drapeTargetType===GX.WithoutRasterImage))}ensureDrapeSources(e){v(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=lN(e,i=>i.drapeSourceType===iI.Features),t.hasDrapedRasterSource=lN(e,i=>i.drapeSourceType===iI.RasterImage)})}ensureOverlays(e,t){C(this._overlays)&&(this._overlayRenderTarget=new Kct(this._rctx),this._overlays=[new iue(xs.INNER,this._overlayRenderTarget),new iue(xs.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=rt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._renderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(v(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Hl,e=>e.updatePolicy===F1.SYNC)}get isEmpty(){return!cr.OVERLAY_DRAW_DEBUG_TEXTURE&&!za(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._renderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(r.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.output;if(this.isEmpty||s===z.Highlight&&!this.hasHighlights||s===z.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*i,this._renderContext.output=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===z.Normal?Ee.DRAPED_WATER:Ee.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===xs.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(ts.COLOR_BUFFER_BIT)),t.type===zs.Occluded&&(this._renderContext.renderOccludedMask=Jk),cr.OVERLAY_DRAW_DEBUG_TEXTURE&&t.type!==zs.Occluded)for(let c=0;c<r.numViews;c++)this._setViewParameters(r.extents[c],e),this._drawDebugTexture(e.resolution,Pht[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:c,renderer:h})=>{if(t.type===zs.ColorNoRasterImage&&c.drapeSourceType===iI.RasterImage)return;const{fullOpacity:p}=c,f=v(p)&&p<1&&s===z.Color;f&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(ts.COLOR_BUFFER_BIT));for(let m=0;m<r.numViews;m++)this._setViewParameters(r.extents[m],e),h.render(this._renderContext);f&&v(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),p,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){C(this._temporaryFBO)&&(this._temporaryFBO=new ZCe(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){var n,o;let s=0;for(const a of this._renderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,i,r,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((t,i)=>{var o;const r=e.indexOf(i.layer),s=r>=0,n=this._renderers.size*((o=i.renderGroup)!=null?o:s?qk.MapLayer:qk.ViewLayer)+(s?r:0);this._sortedRenderers.push(new Iht(i,t,n))}),this._sortedRenderers.sort((t,i)=>t.index-i.index)}_setViewParameters(e,t){const i=this._camera;i.viewport=[0,0,t.resolution,t.resolution],B_e(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),lU(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=za(this._renderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=za(this._renderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=za(this._renderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e,t);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(Nt.TRIANGLE_STRIP,0,ja(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t,i){if(ue(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*t*4);let s=0;for(let o=0;o<t;o++)for(let a=0;a<e;a++){const l=Math.floor(a/10),c=Math.floor(o/10);l<2||c<2||10*l>e-20||10*c>t-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&l&&1&c?1&a^1&o?0:255:1&l^1&c?0:128)}this._passParameters.texture=new pt(this._rctx,{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:e,height:t},r);const n=new ete;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Z$,n),this._quadVAO=Tl(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([d()],Yp.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([d({autoDestroy:!0})],Yp.prototype,"_shaderTechniqueRepository",void 0),u([d({autoDestroy:!0})],Yp.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],Yp.prototype,"view",void 0),u([d()],Yp.prototype,"worldToPCSRatio",void 0),u([d()],Yp.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],Yp.prototype,"updating",null),u([d()],Yp.prototype,"isEmpty",null),Yp=u([P("esri.views.3d.terrain.OverlayRenderer")],Yp);class Iht{constructor(t,i,r){this.drapeSource=t,this.renderer=i,this.index=r}}const Pht=[[1,.5,.5],[.5,.5,1]],tte=-2,Jk=Is.OccludeAndTransparent;function ite(e,t,i,r){const s=W$(e.rings,!!e.hasZ,$g.CCW_IS_HOLE),n=Du(s.position.length),o=CCe(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),a=o!=null;return new Dht(s.position,n,LAe(s.polygons,s.position,n),$Ae(s.outlines,s.position,n),a,o)}function PAe(e,t){const i=W$(e.rings,!1,$g.CCW_IS_HOLE),r=Xs(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=tte;return{position:i.position,polygons:LAe(i.polygons,i.position),outlines:$Ae(i.outlines,i.position),projectionSuccess:r}}function $Ae(e,t,i=null){return e.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return v(i)?new DAe(r,s,Jd(t,n,o),Jd(i,n,o)):new rte(r,s,Jd(t,n,o))})}function LAe(e,t,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),p=v(i)?new $ht(s,n,Jd(t,3*s,3*n),Jd(i,l,c),h,a):new Lht(s,n,Jd(t,3*s,3*n),h,a);r.push(p)}return r}class rte{constructor(t,i,r){this.index=t,this.count=i,this.position=r}}class DAe extends rte{constructor(t,i,r,s){super(t,i,r),this.mapPositions=s}}class $ht extends DAe{constructor(t,i,r,s,n,o){super(t,i,r,s),this.holeIndices=n,this.pathLengths=o}}class Lht extends rte{constructor(t,i,r,s,n){super(t,i,r),this.holeIndices=s,this.pathLengths=n}}class Dht{constructor(t,i,r,s,n,o){this.position=t,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}}function FAe(e,t){const i=e.fragment;switch(i.code.add(x`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Ds.None:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Ds.View:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Ds.WindingOrder:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Ds.COUNT:}}var Ds;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Ds||(Ds={}));function NAe(e){e.vertex.code.add(x`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}class Fht extends xl{constructor(){super(...arguments),this.instancedDoublePrecision=!1}}function kAe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(R.MODELORIGINHI,"vec3"),e.attributes.add(R.MODELORIGINLO,"vec3"),e.attributes.add(R.MODEL,"mat3"),e.attributes.add(R.MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include(wk,t),i.uniforms.add(new Uh("viewOriginHi",(r,s)=>$et(ue(iF,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),iF))),i.uniforms.add(new Uh("viewOriginLo",(r,s)=>Let(ue(iF,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),iF)))),i.code.add(x`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(x`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?x`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(x`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===z.Normal&&(DA(i),i.code.add(x`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(x`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([j()],Fht.prototype,"instancedDoublePrecision",void 0);const iF=O();var ro;function Nht(e){switch(e){case"multiply":default:return ro.Multiply;case"ignore":return ro.Ignore;case"replace":return ro.Replace;case"tint":return ro.Tint}}function UAe(e,t,i){if(C(e)||t===ro.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=ye(Math.round(e[3]*Kk),0,Kk),s=r===0||t===ro.Tint?0:t===ro.Replace?kht:Uht;i[0]=ye(Math.round(e[0]*HS),0,HS),i[1]=ye(Math.round(e[1]*HS),0,HS),i[2]=ye(Math.round(e[2]*HS),0,HS),i[3]=r+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(ro||(ro={}));const HS=255,Kk=85,kht=Kk,Uht=2*Kk;function VAe(e){e.vertex.code.add(x`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${x.int(ro.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${x.int(ro.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${x.int(ro.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${x.int(ro.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function BAe(e,t){t.hasSymbolColors?(e.include(VAe),e.attributes.add(R.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(x`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new Y$("colorMixMode",i=>NEe[i.colorMixMode])),e.vertex.code.add(x`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function hS(e,t){t.hasVertexColors?(e.attributes.add(R.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(x`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(x`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(x`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Vht(e){e.fragment.code.add(x`
    #define discardOrAdjustAlpha(color) { if (color.a < ${x.float(qa)}) { discard; } }
  `)}class eT extends Zs{constructor(t,i){super(t,"float",Ar.Draw,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function tT(e,t){zAe(e,t,new Ie("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Bht(e,t){zAe(e,t,new eT("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function zAe(e,t,i){const r=e.fragment;switch(t.alphaDiscardMode!==Er.Mask&&t.alphaDiscardMode!==Er.MaskBlend||r.uniforms.add(i),t.alphaDiscardMode){case Er.Blend:return e.include(Vht);case Er.Opaque:r.code.add(x`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Er.Mask:r.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Er.MaskBlend:e.fragment.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function GAe(e,t){const{vertex:i,fragment:r}=e,s=t.hasModelTransformation;s&&i.uniforms.add(new ds("model",o=>v(o.modelTransformation)?o.modelTransformation:Hh));const n=t.hasColorTexture&&t.alphaDiscardMode!==Er.Opaque;switch(t.output){case z.Depth:case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:case z.ObjectAndLayerIdColor:Pu(i,t),e.include(Dc,t),e.include(yg,t),e.include(MC,t),e.include(U0,t),e.include(An,t),e.include(O8,t),RT(e),e.varyings.add("depth","float"),n&&r.uniforms.add(new Lt("tex",o=>o.texture)),i.code.add(x`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),e.include(tT,t),r.code.add(x`
          void main(void) {
            discardBySlice(vpos);
            ${n?x`
                    vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${t.output===z.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:x`outputDepth(depth);`}
          }
        `);break;case z.Normal:Pu(i,t),e.include(Dc,t),e.include(X$,t),e.include(j8,t),e.include(yg,t),e.include(MC,t),n&&r.uniforms.add(new Lt("tex",o=>o.texture)),e.varyings.add("vPositionView","vec3"),i.code.add(x`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${t.normalType===yr.Attribute?x`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),e.include(An,t),e.include(tT,t),r.code.add(x`
          void main() {
            discardBySlice(vpos);
            ${n?x`
                    vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${t.normalType===yr.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(vPositionView);`:x`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case z.Highlight:Pu(i,t),e.include(Dc,t),e.include(yg,t),e.include(MC,t),n&&r.uniforms.add(new Lt("tex",o=>o.texture)),i.code.add(x`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),e.include(An,t),e.include(tT,t),e.include(i_,t),r.code.add(x`
          void main() {
            discardBySlice(vpos);
            ${n?x`
                    vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function jAe(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(R.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Ds.WindingOrder?i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==En.None){e.include(TQ,t);const r=t.supportsTextureAtlas?t.hasWebGL2Context?fr.None:fr.Size:fr.None;i.uniforms.add(t.pbrTextureBindType===Ar.Pass?Rf("normalTexture",s=>s.textureNormal,r):L1("normalTexture",s=>s.textureNormal,r)),i.code.add(x`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?x`vtc.size = ${Zd(t,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function J$(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add(Rf("ssaoTex",(r,s)=>s.ssaoHelper.colorTexture,t.hasWebGL2Context?fr.None:fr.InvSize)),i.constants.add("blurSizePixelsInverse","float",1/i3),i.code.add(x`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${Zd(t,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):i.code.add(x`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function K$(e){e.constants.add("ambientBoostFactor","float",jSe)}function RM(e){e.uniforms.add(new Ie("lightingGlobalFactor",(t,i)=>i.lighting.globalFactor))}function GT(e,t){const i=e.fragment;switch(e.include(J$,t),t.pbrMode!==gt.Disabled&&e.include(Jee,t),e.include(CQ,t),e.include(D$),i.code.add(x`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===gt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),K$(i),RM(i),Y0(i),i.code.add(x`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?x`normalize(vPosWorld)`:x`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Bg(i),i.code.add(x`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),t.pbrMode){case gt.Disabled:case gt.WaterOnIntegratedMesh:case gt.Water:e.include(fk,t),i.code.add(x`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case gt.Normal:case gt.Schematic:i.code.add(x`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(x`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new v0("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(x`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new Ie("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new Ie("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(x`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===gt.Schematic?x`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:x`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case gt.Terrain:case gt.TerrainWithWater:e.include(fk,t),i.code.add(x`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:t.pbrMode;case gt.COUNT:}}function kc(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function HAe(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function R4(e,t,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function zht(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:HAe,create:kc,createView:zht,fromValues:R4},Symbol.toStringTag,{value:"Module"}));function Ght(e){e.vertex.uniforms.add(new Gg("colorTextureTransformMatrix",t=>v(t.colorTextureTransformMatrix)?t.colorTextureTransformMatrix:kc())),e.varyings.add("colorUV","vec2"),e.vertex.code.add(x`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function jht(e){e.vertex.uniforms.add(new Gg("normalTextureTransformMatrix",t=>v(t.normalTextureTransformMatrix)?t.normalTextureTransformMatrix:kc())),e.varyings.add("normalUV","vec2"),e.vertex.code.add(x`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Hht(e){e.vertex.uniforms.add(new Gg("emissiveTextureTransformMatrix",t=>v(t.emissiveTextureTransformMatrix)?t.emissiveTextureTransformMatrix:kc())),e.varyings.add("emissiveUV","vec2"),e.vertex.code.add(x`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function qht(e){e.vertex.uniforms.add(new Gg("occlusionTextureTransformMatrix",t=>v(t.occlusionTextureTransformMatrix)?t.occlusionTextureTransformMatrix:kc())),e.varyings.add("occlusionUV","vec2"),e.vertex.code.add(x`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Wht(e){e.vertex.uniforms.add(new Gg("metallicRoughnessTextureTransformMatrix",t=>v(t.metallicRoughnessTextureTransformMatrix)?t.metallicRoughnessTextureTransformMatrix:kc())),e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.code.add(x`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function NP(e){e.include(zg),e.code.add(x`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${x.int(ro.Multiply)}) {
        return allMixed;
      }
      if (mode == ${x.int(ro.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(ro.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${x.int(ro.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(ro.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Xht(e){const t=new Yi,{vertex:i,fragment:r,varyings:s}=t;return Pu(i,e),t.include(F$),s.add("vpos","vec3"),t.include(MC,e),t.include(kAe,e),t.include(MEe,e),e.hasColorTextureTransform&&t.include(Ght),e.output!==z.Color&&e.output!==z.Alpha||(e.hasNormalTextureTransform&&t.include(jht),e.hasEmissionTextureTransform&&t.include(Hht),e.hasOcclusionTextureTransform&&t.include(qht),e.hasMetallicRoughnessTextureTransform&&t.include(Wht),zf(i,e),t.include(X$,e),t.include(Dc,e),e.normalType===yr.Attribute&&e.offsetBackfaces&&t.include(NAe),t.include(jAe,e),t.include(j8,e),e.instancedColor&&t.attributes.add(R.INSTANCECOLOR,"vec4"),s.add("localvpos","vec3"),t.include(yg,e),t.include(bM,e),t.include(BAe,e),t.include(hS,e),i.uniforms.add(new xi("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),e.hasMultipassTerrain&&s.add("depth","float"),e.hasModelTransformation&&i.uniforms.add(new ds("model",n=>v(n.modelTransformation)?n.modelTransformation:Hh)),i.code.add(x`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${x.float(qa)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===yr.Attribute?x`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===yr.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${e.hasColorTextureTransform?x`forwardColorUV();`:""}
        ${e.hasNormalTextureTransform?x`forwardNormalUV();`:""}
        ${e.hasEmissionTextureTransform?x`forwardEmissiveUV();`:""}
        ${e.hasOcclusionTextureTransform?x`forwardOcclusionUV();`:""}
        ${e.hasMetallicRoughnessTextureTransform?x`forwardMetallicRoughnessUV();`:""}
      }
    `)),e.output===z.Alpha&&(t.include(An,e),t.include(tT,e),t.include(Xh,e),r.uniforms.add([new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&r.uniforms.add(new Lt("tex",n=>n.texture)),r.include(NP),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===z.Color&&(t.include(An,e),t.include(GT,e),t.include(J$,e),t.include(tT,e),t.include(e.instancedDoublePrecision?H8:zT,e),t.include(Xh,e),zf(r,e),r.uniforms.add([i.uniforms.get("localOrigin"),new Jt("ambient",n=>n.ambient),new Jt("diffuse",n=>n.diffuse),new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&r.uniforms.add(new Lt("tex",n=>n.texture)),t.include(EQ,e),t.include(Jee,e),r.include(NP),t.include(FAe,e),K$(r),RM(r),Bg(r),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===yr.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(localvpos);`:x`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===gt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${e.receiveShadows?"readShadowMap(vpos, linearDepth)":e.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?x`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:x`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?x`normalize(posWorld);`:x`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?x`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===gt.Normal||e.pbrMode===gt.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?x`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===Ct.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(GAe,e),t}const Yht=Object.freeze(Object.defineProperty({__proto__:null,build:Xht},Symbol.toStringTag,{value:"Module"}));class Zht extends bAe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Le(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Br.Back,this.emissiveFactor=Le(0,0,0),this.instancedDoublePrecision=!1,this.normalType=yr.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Le(.2,.2,.2),this.diffuse=Le(.8,.8,.8),this.externalColor=Yt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=O(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Cs(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=ET.Less,this.textureAlphaMode=Er.Blend,this.textureAlphaCutoff=Gk,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Is.Occlude}}class Jht extends wAe{constructor(){super(...arguments),this.origin=O(),this.slicePlaneLocalOrigin=this.origin}}class Q$ extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2,i.spherical=t.viewingMode===je.Global,i.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?En.Default:En.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(t){return this._initializeProgram(t,Q$.shader)}_initializeProgram(t,i){return new Ji(t.rctx,i.get().build(this.configuration),ji)}_convertDepthTestFunction(t){return t===ET.Lequal?Zr.LEQUAL:Zr.LESS}_makePipeline(t,i){const r=this.configuration,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:r.output!==z.Color&&r.output!==z.Alpha||!r.transparent?null:s?Vh:r_(t),culling:Kht(r)?n8(r.cullFace):null,depthTest:{func:vb(t,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(s||n)&&r.writeDepth?zc:null,colorWrite:si,stencilWrite:r.hasOccludees?Lg:null,stencilTest:r.hasOccludees?i?cb:bb:null,polygonOffset:s||n?null:D8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}function Kht(e){return e.cullFace!==Br.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}Q$.shader=new Zi(Yht,()=>Q(()=>import("./DefaultMaterial.glsl.2d1490b6.js"),[]));class ei extends qo{constructor(){super(...arguments),this.output=z.Color,this.alphaDiscardMode=Er.Opaque,this.doubleSidedMode=Ds.None,this.pbrMode=gt.Disabled,this.cullFace=Br.None,this.transparencyPassType=Ct.NONE,this.normalType=yr.Attribute,this.textureCoordinateType=En.None,this.customDepthTest=ET.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}}u([j({count:z.COUNT})],ei.prototype,"output",void 0),u([j({count:Er.COUNT})],ei.prototype,"alphaDiscardMode",void 0),u([j({count:Ds.COUNT})],ei.prototype,"doubleSidedMode",void 0),u([j({count:gt.COUNT})],ei.prototype,"pbrMode",void 0),u([j({count:Br.COUNT})],ei.prototype,"cullFace",void 0),u([j({count:Ct.COUNT})],ei.prototype,"transparencyPassType",void 0),u([j({count:yr.COUNT})],ei.prototype,"normalType",void 0),u([j({count:En.COUNT})],ei.prototype,"textureCoordinateType",void 0),u([j({count:ET.COUNT})],ei.prototype,"customDepthTest",void 0),u([j()],ei.prototype,"spherical",void 0),u([j()],ei.prototype,"hasVertexColors",void 0),u([j()],ei.prototype,"hasSymbolColors",void 0),u([j()],ei.prototype,"hasVerticalOffset",void 0),u([j()],ei.prototype,"hasSlicePlane",void 0),u([j()],ei.prototype,"hasSliceHighlight",void 0),u([j()],ei.prototype,"hasColorTexture",void 0),u([j()],ei.prototype,"hasMetallicRoughnessTexture",void 0),u([j()],ei.prototype,"hasEmissionTexture",void 0),u([j()],ei.prototype,"hasOcclusionTexture",void 0),u([j()],ei.prototype,"hasNormalTexture",void 0),u([j()],ei.prototype,"hasScreenSizePerspective",void 0),u([j()],ei.prototype,"hasVertexTangents",void 0),u([j()],ei.prototype,"hasOccludees",void 0),u([j()],ei.prototype,"hasMultipassTerrain",void 0),u([j()],ei.prototype,"hasModelTransformation",void 0),u([j()],ei.prototype,"offsetBackfaces",void 0),u([j()],ei.prototype,"vvSize",void 0),u([j()],ei.prototype,"vvColor",void 0),u([j()],ei.prototype,"receiveShadows",void 0),u([j()],ei.prototype,"receiveAmbientOcclusion",void 0),u([j()],ei.prototype,"textureAlphaPremultiplied",void 0),u([j()],ei.prototype,"instanced",void 0),u([j()],ei.prototype,"instancedColor",void 0),u([j()],ei.prototype,"objectAndLayerIdColorInstanced",void 0),u([j()],ei.prototype,"instancedDoublePrecision",void 0),u([j()],ei.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],ei.prototype,"writeDepth",void 0),u([j()],ei.prototype,"transparent",void 0),u([j()],ei.prototype,"enableOffset",void 0),u([j()],ei.prototype,"cullAboveGround",void 0),u([j()],ei.prototype,"snowCover",void 0),u([j()],ei.prototype,"hasColorTextureTransform",void 0),u([j()],ei.prototype,"hasEmissionTextureTransform",void 0),u([j()],ei.prototype,"hasNormalTextureTransform",void 0),u([j()],ei.prototype,"hasOcclusionTextureTransform",void 0),u([j()],ei.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([j({constValue:!0})],ei.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],ei.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],ei.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!0})],ei.prototype,"useFillLights",void 0);function Qht(e){const t=new Yi,{vertex:i,fragment:r,varyings:s}=t;return Pu(i,e),t.include(F$),s.add("vpos","vec3"),t.include(MC,e),t.include(kAe,e),t.include(MEe,e),e.output!==z.Color&&e.output!==z.Alpha||(zf(t.vertex,e),t.include(X$,e),t.include(Dc,e),e.offsetBackfaces&&t.include(NAe),e.instancedColor&&t.attributes.add(R.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),e.hasMultipassTerrain&&s.add("depth","float"),t.include(yg,e),t.include(bM,e),t.include(BAe,e),t.include(hS,e),i.uniforms.add(new xi("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),i.code.add(x`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${x.float(qa)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?x`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===z.Alpha&&(t.include(An,e),t.include(tT,e),t.include(Xh,e),r.uniforms.add([new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&r.uniforms.add(new Lt("tex",n=>n.texture)),r.include(NP),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===z.Color&&(t.include(An,e),t.include(GT,e),t.include(J$,e),t.include(tT,e),t.include(e.instancedDoublePrecision?H8:zT,e),t.include(Xh,e),zf(t.fragment,e),Y0(r),K$(r),RM(r),r.uniforms.add([i.uniforms.get("localOrigin"),i.uniforms.get("view"),new Jt("ambient",n=>n.ambient),new Jt("diffuse",n=>n.diffuse),new Ie("opacity",n=>n.opacity),new Ie("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&r.uniforms.add(new Lt("tex",n=>n.texture)),t.include(EQ,e),t.include(Jee,e),r.include(NP),t.extensions.add("GL_OES_standard_derivatives"),Bg(r),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?x`colorUV`:x`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===gt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?x`albedo = mix(albedo, vec3(1), 0.9);`:x``}
        ${x`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${e.pbrMode===gt.Normal||e.pbrMode===gt.Schematic?e.spherical?x`vec3 normalGround = normalize(vpos + localOrigin);`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:x``}
        ${e.pbrMode===gt.Normal||e.pbrMode===gt.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?x`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===Ct.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:x``}
      }
    `)),t.include(GAe,e),t}const edt=Object.freeze(Object.defineProperty({__proto__:null,build:Qht},Symbol.toStringTag,{value:"Module"}));class Z8 extends Q${initializeConfiguration(t,i){super.initializeConfiguration(t,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=yr.Attribute,i.doubleSidedMode=Ds.WindingOrder,i.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,Z8.shader)}}Z8.shader=new Zi(edt,()=>Q(()=>import("./RealisticTree.glsl.bfe947af.js"),[]));class V0 extends _b{constructor(t){super(t,rdt),this.supportsEdges=!0,this._configuration=new ei,this._vertexBufferLayout=sdt(this.parameters)}isVisibleForOutput(t){return t!==z.Shadow&&t!==z.ShadowExcludeHighlight&&t!==z.ShadowHighlight||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=t,o=v(i)&&i.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,i){return this._configuration.output=t,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,v(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Br.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=v(this.parameters.modelTransformation),t!==z.Color&&t!==z.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Ds.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ds.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ds.WindingOrder:Ds.None,this._configuration.instancedColor=v(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?gt.Schematic:gt.Normal:gt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<$8,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(t){return v(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,i,r,s,n,o){if(v(this.parameters.verticalOffset)){const a=r.camera;ue(Xz,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case je.Global:l=be(Pue,Xz);break;case je.Local:l=le(Pue,adt)}let c=0;const h=me(ldt,Xz,a.eye),p=Oe(h),f=ae(h,h,1/p);let m=null;this.parameters.screenSizePerspective&&(m=_e(l,f)),c+=DEe(a,p,this.parameters.verticalOffset,m!=null?m:0,this.parameters.screenSizePerspective),ae(l,l,c),Eu(Wz,l,r.transform.inverseRotation),s=me(ndt,s,Wz),n=me(odt,n,Wz)}IEe(t,r,s,n,xX(r.verticalOffset),o)}requiresSlot(t,i){return i===z.Color||i===z.Alpha||i===z.Depth||i===z.Normal||i===z.Shadow||i===z.ShadowHighlight||i===z.ShadowExcludeHighlight||i===z.Highlight||i===z.ObjectAndLayerIdColor?t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL:!1}createGLMaterial(t){return new tdt(t)}createBufferWriter(){return new MM(this._vertexBufferLayout)}}class tdt extends SQ{constructor(t){super({...t,...t.material.parameters})}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output!==z.Color&&this._output!==z.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t));const i=this._material.parameters;this.updateTexture(i.textureId);const r=t.camera.viewInverseTransposeMatrix;return ue(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?Z8:Q$,t)}}class idt extends Zht{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const rdt=new idt;function sdt(e){const t=As().vec3f(R.POSITION).vec3f(R.NORMAL),i=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId;return e.hasVertexTangents&&t.vec4f(R.TANGENT),i&&t.vec2f(R.UV0),e.hasVertexColors&&t.vec4u8(R.COLOR),e.hasSymbolColors&&t.vec4u8(R.SYMBOLCOLOR),he("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(R.OBJECTANDLAYERIDCOLOR),t}const ndt=O(),odt=O(),adt=Le(0,0,1),Pue=O(),Wz=O(),Xz=O(),ldt=O(),cdt=["polygon","extent"];class udt extends Hg{constructor(t,i,r,s){super(t,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=N8(this._getSymbolSize());if(a)throw new H("graphics3dextrudesymbollayer:invalid-size",a)}const t=oo(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),r=Rc(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Br.None:Br.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new V0(o),this._bottomMaterial=new V0({...o,cullFace:Br.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,cdt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Zh);return this._createAs3DShape(i,t.renderingInfo,r,s,i.uid)}layerOpacityChanged(t,i){const r=oo(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();t.forEach(a=>{const l=i(a);v(l)&&l.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,ob)}slicePlaneEnabledChanged(t,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(r=>{const s=i(r);v(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getExtrusionSize(t){var r;let i;return i=t.size&&this._drivenProperties.size?(r=Gct(t.size,2))!=null?r:0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(t,i){return this._drivenPropertiesChanged(i)?lo.Recreate_Symbol:lo.Recreate_Graphics}async queryForSnapping(t,i,r,s){var c,h,p;const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/aT(i),{objectId:o,target:a}=t,l=ne(a);switch(l.z=((c=l.z)!=null?c:0)+n,t.type){case"edge":{const{start:f,end:m}=t,y=ne(f),_=ne(m);return y.z=((h=y.z)!=null?h:0)+n,_.z=((p=_.z)!=null?p:0)+n,[Qce(o,l,1/0,y,_)]}case"vertex":return[Vct(o,l,1/0),Qce(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,i,r,s,n){const o=LP(t.geometry);if(C(o))return null;if(o.rings.length===0||!o.rings.some(X=>X.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=ite(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=$ee(o);if(C(l))return null;const c=new Array,h=ho(),p=Pe(),f=O(),m=this._context.renderCoordsHelper.viewingMode===je.Global;m||this._context.renderCoordsHelper.worldUpAtPosition(null,f),Uf(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const y=Pe();Ea(y,p);const _=Cs();xA(_,y);const{polygons:b,mapPositions:w,position:T}=a,S=T.length/3,E=new Float64Array(3*S*6),M=new Float64Array(3*S*6),A=new Float64Array(3*S*6),$=new Float64Array(1*S*6);let I=0;for(let X=0;X<b.length;++X){const K=b[X],re=K.count;if(this._context.clippingExtent&&(Xr(h),Lh(h,K.mapPositions),!_f(h,this._context.clippingExtent)))continue;const q=ab(K.mapPositions,K.holeIndices,3);if(q.length===0)continue;const L=3*re*2+q.length,N=new Array(L),U=new Array(q.length),W=6*re,Z=3*E.BYTES_PER_ELEMENT,ie=new ea(E.buffer,I*Z,Z,(I+W)*Z),Y=3*M.BYTES_PER_ELEMENT,ce=new ea(M.buffer,I*Y,Y,(I+W)*Y),pe=new Float64Array(A.buffer,3*I*A.BYTES_PER_ELEMENT,3*W),ve=new Float64Array($.buffer,1*I*$.BYTES_PER_ELEMENT,1*W),Se=this._getExtrusionSize(i);hdt(T,w,q,K,ie.typedBuffer,pe,ce.typedBuffer,ve,N,U,Se,f,m),q$(ie,ie,y),lb(ce,ce,_),I+=6*re;const We=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),Ne=new gdt(ie.typedBuffer,pe,ce.typedBuffer,ve);c.push($ue(this._material,N,N.length-U.length,Ne,r,We)),c.push($ue(this._bottomMaterial,U,0,Ne,r,We))}if(c.length===0)return null;const k=new n_({geometries:c,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});k.transformation=p;const V=UCe(this.symbolLayer,{opacity:this._getLayerOpacity()}),B=v(V)?{baseMaterial:this._material,edgeMaterials:[V],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,G=new jg(this,k,c,null,null,fdt,s,B);return G.alignedSampledElevation=a.sampledElevation,G.needsElevationUpdates=ob(s.mode),G}}function $ue(e,t,i,r,s,n){const o=new Array(t.length).fill(0),a=[[R.POSITION,new Ke(r.positions,3,!0)],[R.NORMAL,new Ke(r.normals,3,!0)],[R.COLOR,new Ke(s,4,!0)],[R.SIZE,new Ke(r.heights,1,!0)]],l=[[R.POSITION,t],[R.NORMAL,t],[R.COLOR,o]];return new Rn(e,a,l,r.elevation,hn.Mesh,n,i)}function hdt(e,t,i,r,s,n,o,a,l,c,h,p,f){const m=i.length/3;let y=0,_=2*r.count;ddt(e,t,r.index,r.count,i,0,m,s,n,o,a,l,c,_,h,p,f);let b=2*r.count;_=0,Lue(s,n,a,o,y,r.pathLengths[0],r.count,b,l,_,h),b+=4*r.pathLengths[0],_+=2*r.pathLengths[0],y+=r.pathLengths[0];for(let w=1;w<r.pathLengths.length;++w)Lue(s,n,a,o,y,r.pathLengths[w],r.count,b,l,_,h),b+=4*r.pathLengths[w],_+=2*r.pathLengths[w],y+=r.pathLengths[w]}function ddt(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,_,b){le(uc,_);const w=y>0?1:-1;let T=3*i,S=0,E=3*S,M=r,A=3*M;for(let k=0;k<r;++k)b&&(uc[0]=e[T+0],uc[1]=e[T+1],uc[2]=e[T+2],be(uc,uc)),a[E+0]=e[T+0],a[E+1]=e[T+1],a[E+2]=e[T+2],l[E+0]=t[T+0],l[E+1]=t[T+1],l[E+2]=t[T+2],c[E+0]=-w*uc[0],c[E+1]=-w*uc[1],c[E+2]=-w*uc[2],h[S]=0,a[A+0]=e[T+0]+y*uc[0],a[A+1]=e[T+1]+y*uc[1],a[A+2]=e[T+2]+y*uc[2],l[A+0]=t[T+0],l[A+1]=t[T+1],l[A+2]=t[T+2],c[A+0]=w*uc[0],c[A+1]=w*uc[1],c[A+2]=w*uc[2],h[M]=y,E+=3,A+=3,T+=3,S+=1,M+=1;T=3*n,E=0,A=3*m;const $=y<0?Vue:Uue,I=y<0?Uue:Vue;for(let k=0;k<o;++k)f[E+0]=s[T+$[0]],f[E+1]=s[T+$[1]],f[E+2]=s[T+$[2]],p[A+0]=s[T+I[0]]+r,p[A+1]=s[T+I[1]]+r,p[A+2]=s[T+I[2]]+r,E+=3,A+=3,T+=3}function rF(e,t,i,r,s,n,o){r[n]=r[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const yR=O();function Lue(e,t,i,r,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,_=a,b=a+1,w=a+2*n,T=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let S=0;S<n;++S)S===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),pdt(e,p,f,m,yR),rF(e,t,r,i,yR,_,p),rF(e,t,r,i,yR,b,f),rF(e,t,r,i,yR,w,m),rF(e,t,r,i,yR,T,y),l[c++]=_,l[c++]=w,l[c++]=T,l[c++]=_,l[c++]=T,l[c++]=b,p++,f++,m++,y++,_+=2,b+=2,w+=2,T+=2}const Yz=O(),Due=O(),Fue=O(),Nue=O(),kue=O();function pdt(e,t,i,r,s){t*=3,i*=3,r*=3,ue(Yz,e[t++],e[t++],e[t++]),ue(Due,e[i++],e[i++],e[i++]),ue(Fue,e[r++],e[r++],e[r++]),me(Nue,Due,Yz),me(kue,Fue,Yz),_t(s,kue,Nue),be(s,s)}const qS=O();function fdt(e,t,i,r,s){const n=e.stageObject,o=n.geometries,a=o.length,l=t.mode!=="absolute-height";let c=0;const h=n.transformation,p=aM(Pe(),h);for(let f=0;f<a;f+=2){const m=o[f];if(!Dee(m))continue;const y=m.getMutableAttribute(R.POSITION).data,_=m.vertexAttributes.get(R.SIZE).data,b=new Y2e(m.mapPositions),w=y.length/3;let T=0,S=!1,E=0;for(let M=0;M<w;M++){qS[0]=y[T],qS[1]=y[T+1],qS[2]=y[T+2],r(b,sF),l&&(E+=sF.sampledElevation),cr.TESTS_DISABLE_OPTIMIZATIONS?(ue(qc,b.array[b.offset+0],b.array[b.offset+1],sF.z+_[T/3]),v(i)&&s.toRenderCoords(qc,i,qc),Ze(qc,qc,p)):(ue(qc,y[T+0],y[T+1],y[T+2]),Ze(qc,qc,h),s.setAltitude(qc,sF.z+_[T/3]),Ze(qc,qc,p)),y[T]=qc[0],y[T+1]=qc[1],y[T+2]=qc[2];const A=mdt/s.unitInMeters;(Math.abs(qS[0]-y[T])>=A||Math.abs(qS[1]-y[T+1])>=A||Math.abs(qS[2]-y[T+2])>=A)&&(S=!0),b.offset+=3,T+=3}S&&(m.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[f]),o[f+1].invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[f+1])),c+=E/w}return c/a}const qc=O(),uc=O(),sF=new H$,Uue=[0,2,1],Vue=[0,1,2],mdt=.01;class gdt{constructor(t,i,r,s){this.positions=t,this.elevation=i,this.normals=r,this.heights=s}}function ydt(e,t,i,r,s){if(C(e))return null;const n=e.referencesGeometry()&&s?_dt(t,r,s):t,o=e.repurposeFeature(n);try{return e.evaluate({...i,$feature:o})}catch(a){return se.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const Zz=new Map;function _dt(e,t,i){const{transform:r,hasZ:s,hasM:n}=i;Zz.has(t)||Zz.set(t,vdt(t));const o=Zz.get(t)(e.geometry,r,s,n);return{...e,geometry:o}}function vdt(e){const t={};switch(e){case"esriGeometryPoint":return(i,r,s,n)=>mCe(r,t,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>gCe(r,t,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>yCe(r,t,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>fCe(r,t,i,s,n);default:return se.getLogger("esri.views.2d.support.arcadeOnDemand").error(new H("mapview-arcade",`Unable to handle geometryType: ${e}`)),i=>i}}const E3t=1.2,bdt=pg;class J8{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Os.ADD);if(t||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,wo.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Os.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=O()){return ue(t,0,0,0)}getBoundingBoxObjectSpace(t=ho()){return Xr(t)}addObjectState(t,i){t===D0.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.geometry.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,wo.HIGHLIGHT))}removeObjectState(t){this.renderGeometries.forEach(i=>{t.removeRenderGeometry(i)})}removeRenderGeometryObjectState(t,i){t.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,wo.HIGHLIGHT)}computeAttachmentOrigin(t){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(WS)&&(t.draped.origin[0]+=WS[0],t.draped.origin[1]+=WS[1],t.draped.num++)}async getProjectedBoundingBox(t,i,r,s,n){Xr(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,Bue,r),VDe(n,Bue)}if(i){let o;yf(n,WS);const a=Lee(n,i.service.spatialReference,i);try{o=await i.service.queryElevation(WS[0],WS[1],s,a,"ground")}catch{}v(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,i,r,s){if(this.boundingBox)q6(nm,this.boundingBox);else{const n=t.boundingSphere,o=n[3];nm[0]=n[0]-o,nm[1]=n[1]-o,nm[2]=n[2]-o,nm[3]=n[0]+o,nm[4]=n[1]+o,nm[5]=n[2]+o}return i(nm,0,2),this.calculateRelativeScreenBounds&&s.push({location:yf(nm),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),QZ(nm,r)}}const Bue=yi(),nm=ho(),WS=O();class qAe{constructor(t,i,r,s=2048){this.text=t,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const t=this._lineSpacing*(this._lines.length-1),i=this._lineHeight;return Math.ceil(t+i+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(C(this._metricsCached)){const t=WX(zue,nF,nF).getContext("2d");this._setFontProperties(t,this._fontSize);let i=2*this._haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const b=t.measureText(y),w=b.width,T=w+i;this._textWidths.push(w),this._lineWidths.push(T),o=Math.max(o,T),a=Math.max(a,b.actualBoundingBoxAscent),l=Math.max(l,b.actualBoundingBoxDescent),_===0&&(s=b),_===this._lines.length-1&&(n=b)});const c=t.font;let h=jue.get(c);if(!h){const y=t.measureText(xdt);h=new Sdt(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),jue.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const p=a+l,f=this._hasBackground?s.actualBoundingBoxAscent:a,m=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new Tdt(a-f,l-m,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*wdt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(C(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case N1.Left:return this._backgroundHorizontalPadding;case N1.Center:return(this.displayWidth-this._lineWidths[t])/2;case N1.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[t]}}render(t,i=0,r=0){t.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;i+=o,r+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,i+p,r),this._renderLineDecoration(t,i+p,r,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(t,i+p,r,this._textWidths[c]),r+=this._lineSpacing}if(cr.TEXT_SHOW_BASELINE){t.strokeStyle=Gue,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this._baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this._lineSpacing}}if(cr.TEXT_SHOW_BORDER&&(t.strokeStyle=Gue,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._baselinePosition}const l=n?this._haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),t.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),t.stroke()}_roundedRect(t,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=ye(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(i,r+s),t.arcTo(i,r,i+s,r,s),t.lineTo(i+n-s,r),t.arcTo(i+n,r,i+n,r+s,s),t.lineTo(i+n,r+o-s),t.arcTo(i+n,r+o,i+n-s,r+o,s),t.lineTo(i+s,r+o),t.arcTo(i,r+o,i,r+o-s,s),t.closePath()):t.rect(i,r,n,o)}_renderHalo(t,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=WX(zue,Math.max(o,nF),Math.max(a,nF)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this._lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),t.globalAlpha=1}_renderHaloEmulated(t,i,r){r+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of WAe)this._fillText(t,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(t,i,r){const s=2*this._haloSize;r+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,i+a,r)}r+=this._lineSpacing}}_setFontProperties(t,i){t.font=this._parameters.fontString(i),t.textAlign="left",t.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,i,r,s){t.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(t,i,r,s){t.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(t,i,r){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.stroke()}_drawBox(t,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const WAe=[];for(let t=0;t<360;t+=360/16)WAe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var N1;function WX(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(N1||(N1={}));const zue={canvas:null},wdt=.2,nF=512,Gue="rgb(255, 0, 255, 0.5)",xdt=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})();class Tdt{constructor(t,i,r,s,n){this.paddingTop=t,this.paddingBottom=i,this.lineHeight=r,this.displayWidth=s,this.baselinePosition=n}}class Sdt{constructor(t,i){this.actualBoundingBoxAscent=t,this.actualBoundingBoxDescent=i}}const jue=new Map,Edt=Object.freeze({left:0,center:.5,right:1}),O4=Object.freeze({"bottom-left":er(0,0),bottom:er(.5,0),"bottom-right":er(1,0),left:er(0,.5),center:er(.5,.5),right:er(1,.5),"top-left":er(0,1),top:er(.5,1),"top-right":er(1,1)});function XAe(e){switch(e){case"left":return N1.Left;case"right":return N1.Right;default:return N1.Center}}function Hue(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Cdt(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Adt(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function Mdt(e){return e==="middle"?"center":e}var al,que;function _R(e){return e!=null}function XS(e){return typeof e=="number"}function K8(e){return typeof e=="string"}function Rdt(e){return e==null||K8(e)}function so(e,t){e&&e.push(t)}function Odt(e,t,i,r=Pe()){const s=e||0,n=t||0,o=i||0;return s!==0&&sA(r,r,-s/180*Math.PI),n!==0&&rA(r,r,n/180*Math.PI),o!==0&&aU(r,r,o/180*Math.PI),r}function $_(e,t,i,r,s){const n=e.minSize,o=e.maxSize;if(e.expression)return so(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=r.symbolSize[i];return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=al.DefinedSize,!0}if(_R(e.field))return _R(e.stops)?e.stops.length===2&&XS(e.stops[0].size)&&XS(e.stops[1].size)?(Wue(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=al.DefinedSize,!0):(so(s,"Could not convert size info: stops only supported with 2 elements"),!1):XS(n)&&XS(o)&&_R(e.minDataValue)&&_R(e.maxDataValue)?(Wue(n,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=al.DefinedSize,!0):eA[e.valueUnit]!=null?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/eA[e.valueUnit],t.type[i]=al.DefinedSize,!0):e.valueUnit==="unknown"?(so(s,"Could not convert size info: proportional size not supported"),!1):(so(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!_R(e.field)){if(e.stops&&e.stops[0]&&XS(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=al.DefinedSize,!0;if(XS(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=al.DefinedSize,!0}return so(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Wue(e,t,i,r,s,n){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-i*o,s.factor[n]=o}function Idt(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return so(r,"Could not convert size info: unsupported property"),null;if(!Rdt(e.field))return so(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return so(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[al.Undefined,al.Undefined,al.Undefined]};let s;switch(e.axis){case"width":return s=$_(e,t.size,0,i,r),s?t:null;case"height":return s=$_(e,t.size,2,i,r),s?t:null;case"depth":return s=$_(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=$_(e,t.size,0,i,r),s&&$_(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=$_(e,t.size,0,i,r),s=s&&$_(e,t.size,1,i,r),s=s&&$_(e,t.size,2,i,r),s?t:null;default:return so(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function Pdt(e,t,i){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===al.DefinedSize&&(n*=t.modelSize[s],e.type[s]=al.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let r;if(e.type[0]!==al.Undefined)r=0;else if(e.type[1]!==al.Undefined)r=1;else{if(e.type[2]===al.Undefined)return so(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===al.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}function Xue(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function $dt(e,t,i){if(e.normalizationField)return so(i,"Could not convert color info: unsupported property"),null;if(K8(e.field)){if(!e.stops)return so(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return so(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.color.values[s]=n.value,Xue(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return so(i,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,Xue(t.color.colors,s,r)}}return t}function Ldt(e,t,i){if(e.normalizationField)return so(i,"Could not convert opacity info: unsupported property"),null;if(K8(e.field)){if(!e.stops)return so(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return so(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return so(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=r}}return t}function Jz(e,t,i){const r=i===2&&e.rotationType==="arithmetic";t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function Ddt(e,t,i){if(!K8(e.field))return so(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return so(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return Jz(e,t.rotation,0),t;case"roll":return Jz(e,t.rotation,1),t;case null:case void 0:case"heading":return Jz(e,t.rotation,2),t;default:return so(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function YAe(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return so(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?Idt(c,l,t,i):l;case"color":return s?$dt(c,l,i):l;case"opacity":return o?Ldt(c,l,i):null;case"rotation":return n?Ddt(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!Pdt(a.size,t,i)?null:a:null}function ste(e){return e&&e.size!=null}function kP(e,t){if(!e)return{enabled:!1};if(cr.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=YAe(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:ZAe(i,t),requiresShaderTransformation:ste(i)}:{enabled:!1}}function UP(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=YAe(t.visualVariables,i);return!!s&&!!(oF(r.size,s.size,"size")&&oF(r.color,s.color,"color")&&oF(r.rotation,s.rotation,"rotation")&&oF(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=ZAe(s,i),e.requiresShaderTransformation=ste(s),!0)}function oF(e,t,i){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&i==="rotation"){const r=e,s=t;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function ZAe(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=ste(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=Cs(),np(nI),Odt(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],nI),cp(i.vvSymbolRotationMatrix,nI)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}function XX(e,t,i){if(!e.vvSizeEnabled)return i;Ao(L_,i);const r=e.vvSymbolRotationMatrix;Vg(nI,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Hs(L_,L_,nI);for(let s=0;s<3;++s){const n=e.vvSizeOffset[s]+t[0]*e.vvSizeFactor[s];Yue[s]=ye(n,e.vvSizeMinSize[s],e.vvSizeMaxSize[s])}return oU(L_,L_,Yue),Vc(L_,L_,e.vvSymbolAnchor),L_}function Fdt(e,t,i){if(!t.vvSizeEnabled)return ue(e,1,1,1);for(let r=0;r<3;++r){const s=t.vvSizeOffset[r]+i[0]*t.vvSizeFactor[r];e[r]=ye(s,t.vvSizeMinSize[r],t.vvSizeMaxSize[r])}return e}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(al||(al={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(que||(que={}));const L_=Pe(),Yue=O(),nI=Pe();class BA{constructor(t,i={}){this.geometry=t,this.boundingSphere=ui(),this.screenToWorldRatio=1,this._transformation=Pe(),this._shaderTransformationDirty=!0,this.id=Ru(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.boundingInfo=i.boundingInfo,this.shaderTransformer=i.shaderTransformer,this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,i,r=bT(t)){C(this.boundingInfo)||(Ze(i,this.boundingInfo.center,t),i[3]=this.boundingInfo.radius*r)}get hasShaderTransformation(){return v(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return C(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Pe()),Ao(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(t){this.geometry.visible=t}}const Ndt=Pe(),Zue=Le(0,0,1),kdt=16,Udt=1.5,Vx=Ree,Vdt=[Vx/2,Vx/2,1-Vx/2,1-Vx/2],Bdt=[OP*Vx,OP*Vx];class VP extends Hg{getCachedSize(){return{size:this._getIconSize()}}constructor(t,i,r,s){super(t,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(t){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(v(r))this._prepareResourcesPrimitive(i,r);else{const s=Exe(this.symbolLayer),n=d$(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),t):await this._prepareResourcesHref(i,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=N8(this._getIconSize());if(t)throw new H("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,i=Math.round(t.size!=null?$r(t.size):kdt);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(t){const i=this._getGraphicHash(t);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,t,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:$1.PAD};r=new If(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(t,i){const r=t.width/t.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(zdt(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;t.verticalOffset={screenLength:$r(r),minWorldLength:s||0,maxWorldLength:v(n)?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,i){const r=this._getOutlineSize();if(Kz(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,v(this._context.sharedResources.textures)){const n=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>XEe(i));this._texture=n.texture,this._releaseTexture=n,t.textureId=this._texture.id}t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=Vdt;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/Vx,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,i,r){this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(v(this._context.sharedResources.textures)){const o=await kf(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw bu(o.error),new H("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id}this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,i,r){const s=new QA({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await Q(()=>import("./CIMSymbolRasterizer.07ef2d83.js"),["assets/CIMSymbolRasterizer.07ef2d83.js","assets/cimAnalyzer.9efd79b7.js","assets/fontUtils.17892b3a.js","assets/BidiEngine.f5b8c89f.js","assets/TileClipper.7b9dd3ce.js","assets/enums.89506096.js","assets/number.dcd3e86c.js","assets/_commonjsHelpers.4421ccc9.js","assets/imageutils.e44a6f33.js","assets/rasterizingUtils.eebd054f.js"])).CIMSymbolRasterizer;ii(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await MLe(p,this._context.layer.spatialReference,n);a=(m,y,_)=>{const b=ydt(f,m,{$view:_},"esriGeometryPoint",y);return b!==null?b:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];ii(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||e0e}_getOutlineSize(){let t=0;const i=this.symbolLayer;return v(i.outline)&&i.outline.size!=null?Math.max($r(i.outline.size),0):(t=Kz(this._getPrimitive())?Udt:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),i=this.symbolLayer,r=oo(i,"outline","color");if(v(r)){const s=De.toUnitRGB(r),n=r.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(Kz(this._getPrimitive()))return bdt;const t=C(this._getPrimitive()),i=oo(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:t})}_getAnchorPos(t,i){return t==="relative"?er((i.x||0)+.5,.5-(i.y||0)):t in O4?O4[t]:O4.center}_createMaterialAndAddToStage(t,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=kP(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let r=v(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return r||(r=new NA(t),this._cimSymbolMaterials.set(Ft(t.textureId,0),r),i.add(r)),r}return this._material=new NA(t),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=ls(this._releaseTexture)}_getScaleFactor(t,i){if(this._drivenProperties.size&&t.size){for(let r=0;r<3;r++){const s=t.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[r]=$r(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/i;if(isFinite(+t.size[2]))return+t.size[2]/i}return 1}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),f={textureId:p.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(f,this._context.stage),s=[p.params.width,p.params.height]}else s=this._size,r=this._material;const n=$P(i.geometry);if(C(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=er(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(i,new Zh);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,r,a,c,t.layer.uid):this._createAs3DShape(i,n,r,a,c,h,i.uid)}layerOpacityChanged(){const t=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:t}),r.setParameters({outlineColor:i})})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j$(VP.elevationModeChangeTypes,r,s);if(n!==qs.UPDATE)return n;const o=pp(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!UP(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return lo.Recreate_Symbol;v(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return lo.Fast_Update}_defaultElevationInfoNoZ(){return Gdt}_createAs3DShape(t,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?_=>XX(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=_X(r,Zue,null,s,n,jdt,null,l,p),m=Bee(this._context,i,f,o,a,c);if(C(m))return null;const y=new jg(this,m.object,[f],null,null,IP,o);return y.alignedSampledElevation=m.sampledElevation,y.needsElevationUpdates=pp(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=_=>r.calculateRelativeScreenBounds(y.getScreenSize(),1,_),PP(y,i,this._context.elevationProvider),y}_createAsOverlay(t,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=ui();Xa(i,a,this._context.overlaySR),a[2]=tte;const l=this._context.clippingExtent;if(v(l)&&!KZ(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?_=>XX(this._fastUpdates.materialParameters,c,_):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:t.uid,layerUid:this._context.layer.uid}),f=_X(r,Zue,a,s,n,null,null,c,p),m=new BA(f,{layerUid:o,graphicUid:t.uid,shaderTransformer:h});a[3]=0,gf(m.boundingSphere,a);const y=new J8(this,[m],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,h),y.calculateRelativeScreenBounds=_=>r.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(t,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=tt())=>{const a=i(Ndt);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=t[0]/this._symbolTextureRatio+r,n=t[1]/this._symbolTextureRatio+r;return(o=tt())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Le(t,t,t),r=Gh(1),s=t*r;return{modelSize:i,symbolSize:Le(s,s,s),unitInMeters:r,transformation:{anchor:dl,scale:sg,rotation:dl}}}_getGraphicHash(t){let i="";for(const r of this._cimRequiredFields)i+=r+t.attributes[r];return i}_forEachMaterial(t){v(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return{...super.test(),material:this._material}}}function zdt(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function Kz(e){return!C(e)&&(e==="cross"||e==="x")}VP.PRIMITIVE_SIZE=Bdt,VP.elevationModeChangeTypes={definedChanged:qs.UPDATE,staysOnTheGround:qs.NONE,onTheGroundChanged:qs.RECREATE};const Gdt={mode:"relative-to-ground",offset:0},jdt=Yt(0,0,0,1);function YX(e){switch(e){case"butt":return Qd.BUTT;case"square":return Qd.SQUARE;case"round":return Qd.ROUND;default:return null}}function Hdt(e){return e==="diamond"?"kite":e}function ZX(e,t,i=null){const r=[],s=[],n=t.mapPositions;qdt(t,s,r);const o=s[0][1].data,a=r[0][1].length,l=new Array(a).fill(0);return Wdt(t,s,r,l),Zdt(t,s,r,l),Xdt(t,s,r,l),Ydt(t,s,r,l),Jdt(t,s,r,l),Kdt(t,s,r,l),Qdt(t,s,r,o),new Rn(e,s,r,n,hn.Line,i)}function qdt(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=e,n=ept(r)&&s,o=r.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?r.slice(0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([R.POSITION,new Ke(l,3,n)]),i.push([R.POSITION,a])}function Wdt(e,t,i,r){if(v(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([R.COLOR,new Ke(Ft(s,jd),4)]),i.push([R.COLOR,r])}function Xdt(e,t,i,r){if(!v(e.attributeData.normal))return;const s=e.attributeData.normal;t.push([R.NORMAL,new Ke(s,3)]),i.push([R.NORMAL,r])}function Ydt(e,t,i,r){const s=e.attributeData.colorFeature;C(s)||(t.push([R.COLORFEATUREATTRIBUTE,new Ke([s],1,!0)]),i.push([R.COLOR,r]))}function Zdt(e,t,i,r){if(v(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([R.SIZE,new Ke([Ft(s,1)],1,!0)]),i.push([R.SIZE,r])}function Jdt(e,t,i,r){const s=e.attributeData.sizeFeature;C(s)||(t.push([R.SIZEFEATUREATTRIBUTE,new Ke([s],1,!0)]),i.push([R.SIZEFEATUREATTRIBUTE,r]))}function Kdt(e,t,i,r){const s=e.attributeData.opacityFeature;C(s)||(t.push([R.OPACITYFEATUREATTRIBUTE,new Ke([s],1,!0)]),i.push([R.OPACITYFEATUREATTRIBUTE,r]))}function Qdt(e,t,i,r){if(C(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==je.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=Du(r.length),n=dr(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)hK(r,f,s,f,n);const o=r.length/3,a=Cn(o+1);let l=tpt,c=ipt,h=0,p=0;ue(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),ue(c,s[p++],s[p++],s[p++]),h+=eSe(l,c),a[f]=h,[l,c]=[c,l];t.push([R.DISTANCETOSTART,new Ke(a,1,!0)]),i.push([R.DISTANCETOSTART,i[0][1]])}function ept(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const tpt=O(),ipt=O();function C3t(e,t){if(C(e)||e.length===0)return[];const i=[];return e.forEach(r=>{const s=r.length,n=Du(3*s);r.forEach((a,l)=>{n[3*l+0]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:t},removeDuplicateStartEnd:!1};i.push(o)}),i}function rpt(e,t,i,r){const s=e.type==="polygon"?$g.CCW_IS_HOLE:$g.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=W$(n,!!e.hasZ,s),l=Du(o.length),c=CCe(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),h=c!=null;return{lines:h?JAe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function spt(e,t){const i=e.type==="polygon"?$g.CCW_IS_HOLE:$g.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=W$(r,!1,i),o=Xs(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=tte;return{lines:o?JAe(n,s):[],projectionSuccess:o}}function JAe(e,t,i=null){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=3*n;r.push({position:Jd(t,3*s,3*n),mapPositions:v(i)?Jd(i,o,a):void 0})}return r}function npt(e){const t=new Yi,i=e.hasMultipassTerrain&&(e.output===z.Color||e.output===z.Alpha),r=e.space===Kd.World;e.hasTip&&r&&t.extensions.add("GL_OES_standard_derivatives"),t.include(iAe,e),t.include(cAe,e),e.output===z.Depth&&t.include(U0,e);const{vertex:s,fragment:n}=t;return n.include(ku),Pu(s,e),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.UV0,"vec2"),t.attributes.add(R.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),Q1(t),i&&t.varyings.add("depth","float"),e.hasTip&&t.varyings.add("vLineWidth","float"),s.uniforms.add([new tr("nearFar",(o,a)=>a.camera.nearFar),new xi("viewport",(o,a)=>a.camera.fullViewport)]),s.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(x`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(t.attributes.add(R.NORMAL,"vec3"),DA(s),s.constants.add("tiltThreshold","float",.7),s.code.add(x`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(x`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(x`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${e.anchor===BT.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),e.space===Kd.Screen&&(s.uniforms.add(new ds("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(x`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(x`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Ie("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(x`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),s.uniforms.add(new Ie("pixelRatio",(o,a)=>a.camera.pixelRatio)),h8(t),s.code.add(x`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),r?(e.hideOnShortSegments&&s.code.add(x`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(x`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(x`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),e.space===Kd.Screen&&s.code.add(x`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(x`
        ${i?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${e.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&t.include(Xh,e),t.include(An,e),n.uniforms.add([new xi("intrinsicColor",o=>o.color),new Lt("tex",o=>o.texture)]),n.include(zg),t.constants.add("texelSize","float",1/DP),n.code.add(x`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),e.hasTip&&(t.constants.add("relativeMarkerSize","float",qee/DP),t.constants.add("relativeTipLineWidth","float",but),n.code.add(x`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),t.constants.add("symbolAlphaCutoff","float",qa),n.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${e.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${e.output===z.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${e.output===z.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===z.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===z.Color&&e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===z.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===z.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),t}const opt=Object.freeze(Object.defineProperty({__proto__:null,build:npt},Symbol.toStringTag,{value:"Module"})),KAe=new Map([[R.POSITION,0],[R.UV0,2],[R.AUXPOS1,3],[R.NORMAL,4],[R.COLOR,5],[R.COLORFEATUREATTRIBUTE,5],[R.SIZE,6],[R.SIZEFEATUREATTRIBUTE,6],[R.OPACITYFEATUREATTRIBUTE,7]]);class Q8 extends ir{initializeProgram(t){return new Ji(t.rctx,Q8.shader.get().build(this.configuration),KAe)}_makePipelineState(t,i){const r=this.configuration,s=t===Ct.NONE;return Ht({blending:r.output===z.Color||r.output===z.Alpha?s?Vh:r_(t):null,depthTest:{func:vb(t)},depthWrite:s?r.writeDepth?zc:null:P8(t),colorWrite:si,stencilWrite:r.hasOccludees?Lg:null,stencilTest:r.hasOccludees?i?cb:bb:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ht({blending:Vh,depthTest:Yk,depthWrite:null,colorWrite:si,stencilWrite:null,stencilTest:dAe}),this._occluderPipelineOpaque=Ht({blending:Vh,depthTest:Yk,depthWrite:null,colorWrite:si,stencilWrite:uAe,stencilTest:hAe}),this._occluderPipelineMaskWrite=Ht({blending:null,depthTest:Wee,depthWrite:null,colorWrite:null,stencilWrite:Lg,stencilTest:cb})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}Q8.shader=new Zi(opt,()=>Q(()=>import("./LineMarker.glsl.3a3e76dd.js"),[]));class apt extends _b{constructor(t){super(t,new cpt),this._vertexAttributeLocations=KAe,this._configuration=new pa,this._layout=this.createLayout()}dispose(){}getConfiguration(t,i){return this._configuration.output=t,this._configuration.space=i.slot===Ee.DRAPED_MATERIAL?Kd.Draped:this.parameters.worldSpace?Kd.World:Kd.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Qd.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===Is.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const t=As().vec3f(R.POSITION).vec2f(R.UV0).vec3f(R.AUXPOS1);return this.parameters.worldSpace&&t.vec3f(R.NORMAL),this.parameters.vvSizeEnabled?t.f32(R.SIZEFEATUREATTRIBUTE):t.f32(R.SIZE),this.parameters.vvColorEnabled?t.f32(R.COLORFEATUREATTRIBUTE):t.vec4f(R.COLOR),this.parameters.vvOpacityEnabled&&t.f32(R.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new upt(this._layout,this.parameters)}requiresSlot(t,i){return i===z.Color||i===z.Alpha||i===z.Highlight||i===z.Depth?t===Ee.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Is.OccludeAndTransparentStencil?t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL:i===z.Color||i===z.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL:!1}createGLMaterial(t){return new lpt(t)}}class lpt extends SQ{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Q8,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==z.Color&&this._output!==z.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class cpt extends Oee{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Qd.BUTT,this.anchor=BT.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class upt{constructor(t,i){this.vertexBufferLayout=t,this._parameters=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(t,i,r,s,n){const o=r.vertexAttributes.get(R.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.vertexAttributes.get(R.NORMAL);this._parameters.worldSpace&&v(c)&&(l=c.data);let h=1,p=0;this._parameters.vvSizeEnabled?p=r.vertexAttributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(R.SIZE)&&(h=r.vertexAttributes.get(R.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColorEnabled?m=r.vertexAttributes.get(R.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(R.COLOR)&&(f=r.vertexAttributes.get(R.COLOR).data);let y=0;this._parameters.vvOpacityEnabled&&(y=r.vertexAttributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let b=n*(this.vertexBufferLayout.stride/4);const w=(M,A,$,I)=>{if(_[b++]=M[0],_[b++]=M[1],_[b++]=M[2],_[b++]=$[0],_[b++]=$[1],_[b++]=A[0],_[b++]=A[1],_[b++]=A[2],this._parameters.worldSpace&&(_[b++]=l[0],_[b++]=l[1],_[b++]=l[2]),this._parameters.vvSizeEnabled?_[b++]=p:_[b++]=h,this._parameters.vvColorEnabled)_[b++]=m;else{const k=Math.min(4*I,f.length-4);_[b++]=f[k+0],_[b++]=f[k+1],_[b++]=f[k+2],_[b++]=f[k+3]}this._parameters.vvOpacityEnabled&&(_[b++]=y)};let T;(function(M){M[M.ASCENDING=1]="ASCENDING",M[M.DESCENDING=-1]="DESCENDING"})(T||(T={}));const S=(M,A)=>{const $=ue(hpt,o[3*M],o[3*M+1],o[3*M+2]),I=dpt;let k=M+A;do ue(I,o[3*k],o[3*k+1],o[3*k+2]),k+=A;while(U1($,I)&&k>=0&&k<a);t&&(Ze($,$,t),Ze(I,I,t)),w($,I,[-1,-1],M),w($,I,[1,-1],M),w($,I,[1,1],M),w($,I,[-1,-1],M),w($,I,[1,1],M),w($,I,[-1,1],M)},E=this._parameters.placement;E!=="begin"&&E!=="begin-end"||S(0,T.ASCENDING),E!=="end"&&E!=="begin-end"||S(a-1,T.DESCENDING)}}const hpt=O(),dpt=O(),el={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},ppt={dash:el.dash,"dash-dot":[...el.dash,...el.dot],dot:el.dot,"long-dash":el["long-dash"],"long-dash-dot":[...el["long-dash"],...el.dot],"long-dash-dot-dot":[...el["long-dash"],...el.dot,...el.dot],none:null,"short-dash":el["short-dash"],"short-dash-dot":[...el["short-dash"],...el["short-dot"]],"short-dash-dot-dot":[...el["short-dash"],...el["short-dot"],...el["short-dot"]],"short-dot":el["short-dot"],solid:null},fpt=8;function mpt(e,t=2){return C(e)?e:{pattern:e.slice(),pixelRatio:t}}function A3t(e,t=2){return{pattern:[e,e],pixelRatio:t}}function QAe(e){return v(e)&&e.type==="style"?gpt(e.style):null}function gpt(e){return v(e)?mpt(ppt[e],fpt):null}const ypt=["polyline","polygon","extent"];class eV extends Hg{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=kP(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Gh(1))<0)throw new H("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=v(this.symbolLayer.marker)&&v(this._context.sharedResources.textures)?wut(this._context.sharedResources.textures,Hdt(this.symbolLayer.marker.style)):null}_getMaterialParameters(t,i=!1){var n;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:YX(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:QAe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return Mn(this.symbolLayer.material,t=>t.color)}get _markerColor(){return Mn(this.symbolLayer.marker,t=>t.color)}get _lineMaterial(){return C(this._lineMaterialCached)&&(this._lineMaterialCached=new WE(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return C(this._ringMaterialCached)&&(this._ringMaterialCached=new WE(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return C(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new WE({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return C(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new WE({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return C(this._markerMaterialCached)&&v(this.symbolLayer.marker)&&v(this._markerTexture)&&(this._markerMaterialCached=new apt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=ls(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?$r(jct(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?w0(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const i=Yt(1,1,1,1);return this._drivenProperties.color&&t.color&&(i[0]=t.color[0],i[1]=t.color[1],i[2]=t.color[2],t.color.length>0&&(i[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(i[3]=t.opacity),i}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?w0(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?w0(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,ypt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Zh);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,r,i.uid)}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!UP(this._fastUpdates,i,this._vvConvertOptions))return lo.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return lo.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const i=t.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=YX(Ft(i.cap.newValue,"butt")),delete i.cap);const s=this._prepareMarkerPatch(t,i);this._prepareMaterialPatch(t,i,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((t,i)=>this._updateMaterialLayerOpacity(t,i))}_forEachMaterial(t){v(this._lineMaterialCached)&&t(this._lineMaterialCached),v(this._ringMaterialCached)&&t(this._ringMaterialCached),v(this._wireframeLineMaterialCached)&&t(this._wireframeLineMaterialCached),v(this._wireframeRingMaterialCached)&&t(this._wireframeRingMaterialCached),v(this._markerMaterialCached)&&t(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(t,i=!1){const r=t.parameters.color,s=oo(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=Yt(r[0],r[1],r[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j$(eV.elevationModeChangeTypes,r,s);if(n!==qs.UPDATE)return n;const o=pp(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof Gi)return zh.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,i,r){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=ho(),c=rpt(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,b=y.mapPositions;if(v(this._context.clippingExtent)&&(Xr(l),Lh(l,b),!_f(l,this._context.clippingExtent)))continue;const w=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,t,_,b,n.type,oI.ELEVATED,r);a.push(w),cr.LINE_WIREFRAMES&&a.push(w.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),v(this._markerMaterial)&&a.push(w.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new n_({geometries:a,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),f=new jg(this,p,a,null,null,Zlt,i);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=pp(i.mode),f}_createGeometry(t,i,r,s,n,o,a){const l=n==="polygon",c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,h=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid});return ZX(t,{overlayInfo:o===oI.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:l,mapPositions:s,attributeData:{position:r,size:h?null:this._getDrivenSize(i.renderingInfo),color:c?null:this._getDrivenColor(i.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(i.graphic),colorFeature:this._getColorFeatureAttributeData(i.graphic),opacityFeature:this._getOpacityFeatureAttributeData(i.graphic)}},p)}_createAsOverlay(t,i){const r=t.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=cr.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;v(a)&&(a.renderPriority=this._renderPriority-.001),v(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=ho(),p=Xr(),f=spt(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if(Xr(h),Lh(h,y.position),!_f(h,this._context.clippingExtent))continue;JC(p,h);const _=w=>{const T=this._createGeometry(w,t,y.position,void 0,s.type,oI.DRAPED,r.uid),S=new BA(T,{layerUid:i,graphicUid:r.uid});return c.push(S),S};if(v(l)){const w=_(l),T=this.symbolLayer.marker.placement;T!=="begin"&&T!=="begin-end"||Lh(h,y.position,0,1),T!=="end"&&T!=="begin-end"||Lh(h,y.position,y.position.length-3,1),this._updateBoundingSphere(w,h)}const b=_(o);if(this._updateBoundingSphere(b,h),cr.LINE_WIREFRAMES){const w=_(a);this._updateBoundingSphere(w,h)}}return new J8(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,i){mr(t.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return v(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=Ft(t,Gh(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?$r(1):1:$r(t)}_prepareMaterialPatch(t,i,r){var a;const s=i.material;if(C(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,t));if(s.type==="collection")return;const n=s.type==="complete"?Mn(s.newValue,l=>l.color):((a=s.diff.color)==null?void 0:a.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(y$(o),this._markerMaterialCached,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,t),delete i.material}_prepareMarkerPatch(t,i){const r=i.marker;if(C(r)||r.type!=="partial"||v(r.diff.style)||v(r.diff.placement)||v(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:C(this._markerColor)};const s=r.diff.color;if(C(s))return delete i.marker,{changed:!1,useMaterialColor:C(this._markerColor)};const n=s.newValue;return C(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterialCached,t),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,i,r){C(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:t}))}}var oI;eV.elevationModeChangeTypes={definedChanged:qs.RECREATE,staysOnTheGround:qs.NONE,onTheGroundChanged:qs.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(oI||(oI={}));let vR=null,Qk=!0;function Qz(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(Qk)try{return new ImageData(e,t)}catch{Qk=!1}return eMe(e,t,i)}function _pt(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(Qk)try{return new ImageData(e,t,i)}catch{Qk=!1}const s=eMe(t,i,r);return s.data.set(e,0),s}function vpt(){return vR||(vR=document.createElement("canvas"),vR.width=1,vR.height=1),vR}function eMe(e,t,i){return i||(i=vpt()),i.getContext("2d").createImageData(e,t)}var uE;const e7=new WeakMap;let bpt=0,Pm=uE=class extends ge{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:fT(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[i]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:fT(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else if(e instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(e)};t[i]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const i=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(e7.has(this.data)||e7.set(this.data,++bpt),t(e7.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new uE(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return _pt(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new uE({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new uE({data:e}):VC(uE,e)}};u([d({type:String,json:{write:G1}})],Pm.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],Pm.prototype,"data",null),u([Ge("data")],Pm.prototype,"writeData",null),u([Fe("data")],Pm.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Pm.prototype,"transparent",null),u([d({json:{write:!0}})],Pm.prototype,"wrap",void 0),u([d({readOnly:!0})],Pm.prototype,"contentHash",null),Pm=uE=u([P("esri.geometry.support.MeshTexture")],Pm);const aI=Pm;var JX;let Zp=JX=class extends ge{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=v(e)?e.get(this):null;if(i)return i;const r=new JX(this.clonePropertiesWithDeduplication(t));return v(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:v(this.color)?this.color.clone():null,colorTexture:v(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:v(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:v(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:v(this.normalTextureTransform)?this.normalTextureTransform:null}}};u([d({type:De,json:{write:!0}})],Zp.prototype,"color",void 0),u([d({type:aI,json:{write:!0}})],Zp.prototype,"colorTexture",void 0),u([d({type:aI,json:{write:!0}})],Zp.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],Zp.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],Zp.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],Zp.prototype,"doubleSided",void 0),u([d()],Zp.prototype,"colorTextureTransform",void 0),u([d()],Zp.prototype,"normalTextureTransform",void 0),Zp=JX=u([P("esri.geometry.support.MeshMaterial")],Zp);const nte=Zp;var KX;let xd=KX=class extends nte{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=v(e)?e.get(this):null;if(i)return i;const r=new KX(this.clonePropertiesWithDeduplication(t));return v(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:v(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:v(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:v(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null,occlusionTextureTransform:v(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:v(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:v(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};u([d({type:De,json:{write:!0}})],xd.prototype,"emissiveColor",void 0),u([d({type:aI,json:{write:!0}})],xd.prototype,"emissiveTexture",void 0),u([d({type:aI,json:{write:!0}})],xd.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],xd.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],xd.prototype,"roughness",void 0),u([d({type:aI,json:{write:!0}})],xd.prototype,"metallicRoughnessTexture",void 0),u([d()],xd.prototype,"occlusionTextureTransform",void 0),u([d()],xd.prototype,"emissiveTextureTransform",void 0),u([d()],xd.prototype,"metallicRoughnessTextureTransform",void 0),xd=KX=u([P("esri.geometry.support.MeshMaterialMetallicRoughness")],xd);const tMe=xd;var I4;const iMe="esri.geometry.support.MeshVertexAttributes",YS=se.getLogger(iMe);let rd=I4=class extends ge{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return hE(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},YS)}castPosition(e){return e&&e instanceof Float32Array&&YS.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),hE(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},YS)}castUv(e){return hE(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},YS)}castNormal(e){return hE(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},YS)}castTangent(e){return hE(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},YS)}clone(){const e={position:ne(this.position),uv:ne(this.uv),normal:ne(this.normal),tangent:ne(this.tangent),color:ne(this.color)};return new I4(e)}clonePositional(){const e={position:ne(this.position),normal:ne(this.normal),tangent:ne(this.tangent),uv:this.uv,color:this.color};return new I4(e)}};function t7(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function hE(e,t,i,r,s){if(!e)return e;if(e instanceof t)return t7(e,r,t,s);for(const n of i)if(e instanceof n)return t7(new t(e),r,t,s);if(Array.isArray(e))return t7(new t(e),r,t,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function bR(e,t,i){t[i]=wpt(e)}function wpt(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}u([d({json:{write:bR}})],rd.prototype,"color",void 0),u([Zt("color")],rd.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:bR}})],rd.prototype,"position",void 0),u([Zt("position")],rd.prototype,"castPosition",null),u([d({json:{write:bR}})],rd.prototype,"uv",void 0),u([Zt("uv")],rd.prototype,"castUv",null),u([d({json:{write:bR}})],rd.prototype,"normal",void 0),u([Zt("normal")],rd.prototype,"castNormal",null),u([d({json:{write:bR}})],rd.prototype,"tangent",void 0),u([Zt("tangent")],rd.prototype,"castTangent",null),rd=I4=u([P(iMe)],rd);var r3;const rMe="esri.geometry.support.MeshComponent",xpt=se.getLogger(rMe);let Vy=r3=class extends ge{static from(e){return VC(r3,e)}constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return hE(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},xpt)}castMaterial(e){return VC(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?tMe:nte,e)}clone(){return new r3({faces:ne(this.faces),shading:this.shading,material:ne(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:ne(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new r3(i)}};u([d({json:{write:!0}})],Vy.prototype,"faces",void 0),u([Zt("faces")],Vy.prototype,"castFaces",null),u([d({type:nte,json:{write:!0}})],Vy.prototype,"material",void 0),u([Zt("material")],Vy.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],Vy.prototype,"shading",void 0),u([d({type:Boolean})],Vy.prototype,"trustSourceNormals",void 0),Vy=r3=u([P(rMe)],Vy);const Tpt=Vy,tV=se.getLogger("esri.geometry.support.meshUtils.normalProjection");function Spt(e,t,i,r,s){return rV(r)?(iV(x0.TO_PCPF,Mr.fromTypedArray(e),ea.fromTypedArray(t),ea.fromTypedArray(i),r,Mr.fromTypedArray(s)),s):(tV.error("Cannot convert spatial reference to PCPF"),s)}function M3t(e,t,i,r,s){return rV(r)?(iV(x0.FROM_PCPF,Mr.fromTypedArray(e),ea.fromTypedArray(t),ea.fromTypedArray(i),r,Mr.fromTypedArray(s)),s):(tV.error("Cannot convert to spatial reference from PCPF"),s)}function R3t(e,t,i){return Xs(e,t,0,i,DU(t),0,e.length/3),i}function O3t(e,t,i){return Xs(e,DU(i),0,t,i,0,e.length/3),t}function Ept(e,t,i){if(C(e))return t;const r=ea.fromTypedArray(e),s=ea.fromTypedArray(t);return q$(s,r,i),t}function Cpt(e,t,i){if(C(e))return t;xA(Bo,i);const r=Mr.fromTypedArray(e),s=Mr.fromTypedArray(t);return lb(s,r,Bo),$Q(Bo)||Gee(s,s),t}function Apt(e,t,i){if(C(e))return t;xA(Bo,i);const r=Mr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=Mr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(lb(s,r,Bo),$Q(Bo)||Gee(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function Mpt(e,t,i,r,s){if(!rV(r))return tV.error("Cannot convert spatial reference to PCPF"),s;iV(x0.TO_PCPF,Mr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),ea.fromTypedArray(t),ea.fromTypedArray(i),r,Mr.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function I3t(e,t,i,r,s){if(!rV(r))return tV.error("Cannot convert to spatial reference from PCPF"),s;iV(x0.FROM_PCPF,Mr.fromTypedArray(e,16),ea.fromTypedArray(t),ea.fromTypedArray(i),r,Mr.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function iV(e,t,i,r,s,n){if(!t)return;const o=i.count,a=DU(s);if(sMe(s))for(let l=0;l<o;l++)r.getVec(l,aF),t.getVec(l,om),Uf(a,aF,lF,a),cp(Bo,lF),e===x0.FROM_PCPF&&up(Bo,Bo),Eu(om,om,Bo),n.setVec(l,om);else for(let l=0;l<o;l++){r.getVec(l,aF),t.getVec(l,om),Uf(a,aF,lF,a),cp(Bo,lF);const c=b5(i.get(l,1));let h=Math.cos(c);e===x0.TO_PCPF&&(h=1/h),Bo[0]*=h,Bo[1]*=h,Bo[2]*=h,Bo[3]*=h,Bo[4]*=h,Bo[5]*=h,e===x0.FROM_PCPF&&up(Bo,Bo),Eu(om,om,Bo),be(om,om),n.setVec(l,om)}return n}function rV(e){return sMe(e)||Rpt(e)}function sMe(e){return e.isWGS84||pge(e)||Fg(e)||Ng(e)}function Rpt(e){return e.isWebMercator}var x0;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(x0||(x0={}));const aF=O(),om=O(),lF=Pe(),Bo=Cs();class nMe{constructor(t){this.data=t,this.type="encoded-mesh-texture",this.encoding=n0.KTX2_ENCODING}}function iT(e){return(e==null?void 0:e.type)==="encoded-mesh-texture"}async function Opt(e){return new Promise((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function Ipt(e,t){return t===n0.KTX2_ENCODING?new nMe(e):new Promise((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)).then(c):(i(o),c())},l=h=>{URL.revokeObjectURL(n),r(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function ig(e){if(C(e))return null;const t=v(e.offset)?e.offset:WCe,i=v(e.rotation)?e.rotation:0,r=v(e.scale)?e.scale:XCe,s=R4(1,0,0,0,1,0,t[0],t[1],1),n=R4(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=R4(r[0],0,0,0,r[1],0,0,0,1),a=kc();return wA(a,n,o),wA(a,s,a),a}function Ppt(e){const t=new Yi,{vertex:i,fragment:r}=t;return t.include(Dc,e),t.include(hS,e),t.include(aAe,e),Pu(i,e),e.stippleEnabled&&(t.attributes.add(R.UV0,"vec2"),t.attributes.add(R.AUXPOS1,"vec3"),i.uniforms.add(new xi("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(R.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(x`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(x`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new Ie("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):i.code.add(x`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(x`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(x`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(x`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new Ie("stipplePatternPixelSize",s=>Hee(s))),i.code.add(x`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(x`}`),e.output===z.Highlight&&t.include(i_,e),t.include(An,e),r.uniforms.add(new Ie("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||r.uniforms.add(new xi("constantColor",s=>s.color)),r.code.add(x`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${e.output===z.ObjectAndLayerIdColor?x`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${x.float(qa)}) {
      discard;
    }

    ${e.output===z.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===z.Highlight?x`outputHighlight();`:""}
  }
  `),t}const $pt=Object.freeze(Object.defineProperty({__proto__:null,build:Ppt},Symbol.toStringTag,{value:"Module"}));class sV extends ir{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==z.Highlight}initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2}initializeProgram(t){return new Ji(t.rctx,sV.shader.get().build(this.configuration),ji)}initializePipeline(){const t=this.configuration,i=Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Ht({blending:n,depthTest:Wee,depthWrite:o,colorWrite:si,stencilWrite:t.hasOccludees?Lg:null,stencilTest:t.hasOccludees?s?cb:bb:null});return t.output===z.Color?(this._occludeePipelineState=r(!0,t.transparent||this._stippleEnabled?i:null,zc),r(!1,t.transparent||this._stippleEnabled?i:null,zc)):r(!1)}get primitiveType(){return Nt.LINES}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}sV.shader=new Zi($pt,()=>Q(()=>import("./NativeLine.glsl.be101582.js"),[]));class rh extends qo{constructor(){super(...arguments),this.output=z.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([j({count:z.COUNT})],rh.prototype,"output",void 0),u([j()],rh.prototype,"hasSlicePlane",void 0),u([j()],rh.prototype,"hasVertexColors",void 0),u([j()],rh.prototype,"transparent",void 0),u([j()],rh.prototype,"draped",void 0),u([j()],rh.prototype,"stippleEnabled",void 0),u([j()],rh.prototype,"stippleOffColorEnabled",void 0),u([j()],rh.prototype,"stipplePreferContinuous",void 0),u([j()],rh.prototype,"hasOccludees",void 0),u([j({constValue:!1})],rh.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!1})],rh.prototype,"stippleScaleWithLineWidth",void 0),u([j({constValue:!1})],rh.prototype,"stippleRequiresStretchMeasure",void 0);var e6;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(e6||(e6={}));class Jue extends _b{constructor(t){super(t,new Fpt),this._configuration=new rh}getConfiguration(t,i){this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=i.slot===Ee.DRAPED_MATERIAL;const r=v(this.parameters.stipplePattern);return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&v(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(t,i,r,s,n,o){if(!r.options.selectionMode||!t.visible)return;if(!JSe(i))return void se.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=t.vertexAttributes.get(R.POSITION).data,l=r.camera,c=kpt;Mo(c,r.point);const h=2;ue(wR[0],c[0]-h,c[1]+h,0),ue(wR[1],c[0]+h,c[1]+h,0),ue(wR[2],c[0]+h,c[1]-h,0),ue(wR[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(wR[_],ay[_]))return;ol(l.eye,ay[0],ay[1],i7),ol(l.eye,ay[1],ay[2],r7),ol(l.eye,ay[2],ay[3],s7),ol(l.eye,ay[3],ay[0],n7);let p=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(Fl[0]=a[_]+i[12],Fl[1]=a[_+1]+i[13],Fl[2]=a[_+2]+i[14],Nl[0]=a[_+3]+i[12],Nl[1]=a[_+4]+i[13],Nl[2]=a[_+5]+i[14],Ur(i7,Fl)<0&&Ur(i7,Nl)<0||Ur(r7,Fl)<0&&Ur(r7,Nl)<0||Ur(s7,Fl)<0&&Ur(s7,Nl)<0||Ur(n7,Fl)<0&&Ur(n7,Nl)<0)continue;if(l.projectToRenderScreen(Fl,Xb),l.projectToRenderScreen(Nl,Yb),Xb[2]<0&&Yb[2]>0){me(am,Fl,Nl);const w=l.frustum,T=-Ur(w[kr.NEAR],Fl)/_e(am,w[kr.NEAR]);ae(am,am,T),fe(Fl,Fl,am),l.projectToRenderScreen(Fl,Xb)}else if(Xb[2]>0&&Yb[2]<0){me(am,Nl,Fl);const w=l.frustum,T=-Ur(w[kr.NEAR],Nl)/_e(am,w[kr.NEAR]);ae(am,am,T),fe(Nl,Nl,am),l.projectToRenderScreen(Nl,Yb)}else if(Xb[2]<0&&Yb[2]<0)continue;Xb[2]=0,Yb[2]=0;const b=SK(Zx(Xb,Yb,ehe),c);b<p&&(p=b,le(Kue,Fl),le(Que,Nl),f=_/3)}const m=r.rayBegin,y=r.rayEnd;if(p<h*h){let _=Number.MAX_VALUE;if(mbe(Zx(Kue,Que,ehe),Zx(m,y,Npt),Wb)){me(Wb,Wb,m);const b=Oe(Wb);ae(Wb,Wb,1/b),_=b/Vr(m,y)}o(_,Wb,f,!1)}}intersectDraped(t,i,r,s,n,o){if(!r.options.selectionMode)return;const a=t.vertexAttributes.get(R.POSITION).data,l=t.vertexAttributes.get(R.SIZE),c=l?l.data[0]:0,h=s[0],p=s[1],f=((c+1)/2+4)*t.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],w=a[_+1],T=h-b,S=p-w,E=a[_+3]-b,M=a[_+4]-w,A=ye((E*T+M*S)/(E*E+M*M),0,1),$=E*A-T,I=M*A-S,k=$*$+I*I;k<m&&(m=k,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}requiresSlot(t,i){return!(i!==z.Color&&i!==z.Highlight&&i!==z.ObjectAndLayerIdColor||t!==Ee.OPAQUE_MATERIAL&&t!==Ee.DRAPED_MATERIAL)}createGLMaterial(t){return new Lpt(t)}createBufferWriter(){const t=this.parameters.hasVertexColors?xAe:Wut;return C(this.parameters.stipplePattern)?new MM(t):new Dpt(t.clone().vec3f(R.AUXPOS1).vec2f(R.UV0))}}class Lpt extends yb{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output===z.Color&&this._updateOccludeeState(t);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,i)),this._stipplePattern=i),this.ensureTechnique(sV,t)}}class Dpt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(R.POSITION).length}write(t,i,r,s,n){zEe(r,this.vertexBufferLayout,t,i,s,n),this._writeAuxpos1(t,r,s,n),this._writeUV0(t,r,s,n)}_writeAuxpos1(t,i,r,s){const n=r.getField(R.AUXPOS1,Mr),o=i.indices.get(R.POSITION),a=i.vertexAttributes.get(R.POSITION).data,l=t,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],_=a[m+1],b=a[m+2],w=l[0]*y+l[4]*_+l[8]*b+l[12],T=l[1]*y+l[5]*_+l[9]*b+l[13],S=l[2]*y+l[6]*_+l[10]*b+l[14];h[s]=w,h[s+1]=T,h[s+2]=S,s+=c}}_writeUV0(t,i,r,s){var S;const n=r.getField(R.UV0,hp),o=i.indices.get(R.POSITION),a=i.vertexAttributes.get(R.POSITION).data,l=(S=i.vertexAttributes.get(R.DISTANCETOSTART))==null?void 0:S.data,c=n.typedBufferStride,h=n.typedBuffer;let p=0;h[s*=c]=e6.START,h[s+1]=p,s+=c;const f=3*o[0],m=ue(Fl,a[f],a[f+1],a[f+2]);t&&Ze(m,m,t);const y=Nl,_=o.length-1;let b=1;const w=l?(E,M,A)=>p=l[A]:(E,M,A)=>p+=Vr(E,M);for(let E=1;E<_;E+=2){const M=3*o[E];ue(y,a[M],a[M+1],a[M+2]),t&&Ze(y,y,t),w(m,y,b++);for(let A=0;A<2;++A)h[s]=1-A,h[s+1]=p,s+=c;le(m,y)}const T=3*o[_];ue(y,a[T],a[T+1],a[T+2]),t&&Ze(y,y,t),w(m,y,b),h[s]=e6.END,h[s+1]=p}}class Fpt extends CM{constructor(){super(...arguments),this.color=jd,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}}const Fl=O(),Nl=O(),am=O(),Wb=O(),Xb=Ga(),Yb=Ga(),Kue=O(),Que=O(),ehe=Hf(),Npt=Hf(),kpt=O(),wR=[Ga(),Ga(),Ga(),Ga()],ay=[O(),O(),O(),O()],i7=nr(),r7=nr(),s7=nr(),n7=nr(),Upt=["mesh"];class Vpt extends Hg{constructor(t,i,r,s){super(t,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){cr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Jue({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Jue({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Upt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new Zh),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(t,i){const r=this._getLayerOpacity();this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=i(s);v(n)&&n.layerOpacityChanged(r,this._context.isAsync)})}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,ob)}slicePlaneEnabledChanged(t,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(r=>{const s=i(r);v(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return C(t)?"-":t instanceof De?t.toHex():t.contentHash}_materialPropertiesDefault(t,i){const r=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(t,i,r){const s=this._materialPropertiesDefault(t,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,i.material instanceof tMe){const{metallic:y,roughness:_,metallicRoughnessTexture:b,emissiveColor:w,emissiveTexture:T,occlusionTexture:S}=i.material,E=this._colorOrTextureUid(b),M=this._colorOrTextureUid(w),A=this._colorOrTextureUid(T),$=this._colorOrTextureUid(S);s.metallic=y,s.roughness=_,s.metallicRoughnessTexture=b,s.emissiveColor=w,s.emissiveTexture=T,s.occlusionTexture=S,s.colorTextureTransform=i.material.colorTextureTransform,s.normalTextureTransform=i.material.normalTextureTransform,s.emissiveTextureTransform=i.material.emissiveTextureTransform,s.occlusionTextureTransform=i.material.occlusionTextureTransform,s.metallicRoughnessTextureTransform=i.material.metallicRoughnessTextureTransform,s.uid=`${s.uid},mrm:${y},mrr:${_},mrt:${E},emuid:${M},etmuid:${A},otmuid:${$}`}return s}_setInternalColorValueParameters(t,i){i.diffuse=De.toUnitRGB(t),i.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const i=this._getInternalTexture(t,Er.Opaque);return v(i)?i.id:null}_getInternalTexture(t,i){const r=this._getLoadableTextureResource(t);if(!r)return null;const s=`${t.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new If(iT(r)?r.data:r,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:!iT(r)&&i!==Er.Opaque,encoding:iT(r)&&v(r.encoding)?r.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const i=this._castTextureWrapIndividual(t);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return Pt.CLAMP_TO_EDGE;case"mirror":return Pt.MIRRORED_REPEAT;default:return Pt.REPEAT}}_setInternalMaterialParameters(t,i){if(v(t.color)&&this._setInternalColorValueParameters(t.color,i),v(t.colorTexture)){const r=this._getInternalTexture(t.colorTexture,i.textureAlphaMode);v(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}v(t.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(t.normalTexture)),v(t.emissiveColor)&&(i.emissiveFactor=De.toUnitRGB(t.emissiveColor)),v(t.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),v(t.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),v(t.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture)),i.colorTextureTransformMatrix=ig(t.colorTextureTransform),i.normalTextureTransformMatrix=ig(t.normalTextureTransform),i.occlusionTextureTransformMatrix=ig(t.occlusionTextureTransform),i.emissiveTextureTransformMatrix=ig(t.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=ig(t.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(t){const i=this._drivenProperties.color;let r=v(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)t.externalColor=jd;else{const s=v(this.symbolLayer.material)?this.symbolLayer.material.color:null;v(s)?t.externalColor=De.toUnitRGBA(s):(r=null,t.externalColor=jd)}r&&(t.colorMixMode=r),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const i=t.vertexAttributes.color;if(C(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(t,i){var y,_,b;const r=(y=i.material)==null?void 0:y.color,s=(_=i.material)==null?void 0:_.colorTexture,n=(b=i.material)==null?void 0:b.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||v(r)&&r.a<1||v(s)&&s.transparent||o),l=this._materialProperties(t,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:dl,diffuse:sg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Br.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?Br.None:Br.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new V0(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,i){t.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,i.alphaMode==="auto"?t.textureAlphaMode=t.transparent?Er.MaskBlend:Er.Opaque:t.textureAlphaMode=i.alphaMode==="opaque"?Er.Opaque:i.alphaMode==="mask"?Er.Mask:Er.Blend}_addDebugNormals(t,i){const r=i.length,s=t.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(t.extent.width*s,t.extent.height*s,t.extent.zmax-t.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<r;m++){const y=i[m],_=y.vertexAttributes.get(R.POSITION),b=y.vertexAttributes.get(R.NORMAL),w=y.indices.get(R.POSITION),T=y.indices.get(R.NORMAL),S=_.data,E=b.data;for(let M=0;M<w.length;M++){const A=3*w[M],$=3*T[M];for(let I=0;I<3;I++)o.push(S[A+I]);for(let I=0;I<3;I++)o.push(S[A+I]+E[$+I]*n);if(a.push(a.length),a.push(a.length),M%3==0){this._calculateFaceNormal(S,w,M,KS),this._getFaceVertices(S,w,M,Da,ZS,JS),fe(Da,Da,ZS),fe(Da,Da,JS),ae(Da,Da,1/3);for(let I=0;I<3;I++)l.push(Da[I]);for(let I=0;I<3;I++)l.push(Da[I]+KS[I]*n);c.push(c.length),c.push(c.length)}}}const h=i[0].transformation,p=new Rn(this._debugVertexNormalMaterial,[[R.POSITION,new Ke(o,3,!0)]],[[R.POSITION,a]],null,hn.Line);i.push(p),p.transformation=h;const f=new Rn(this._debugFaceNormalMaterial,[[R.POSITION,new Ke(l,3,!0)]],[[R.POSITION,c]],null,hn.Line);f.transformation=h,i.push(f)}_createAs3DShape(t,i,r,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i,s);if(C(o))return null;const{geometries:a,objectTransformation:l}=o;cr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new n_({geometries:a,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});c.transformation=l;const h=UCe(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=v(h)?new rct(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new jg(this,c,a,null,null,IP,r,p);f.needsElevationUpdates=ob(r.mode),f.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(b,w)=>AM(b,m,r,y,w);return f.alignedSampledElevation=IP(f,r,m.spatialReference,_,y),f}_getCenterPointInElevationSR(t){const i=s_(0,0,0,v(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return x1e([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(t,i,r,s){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(t,i,r,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s)}}_createComponentNormalsSource(t,i,r,s){if(C(i))return this._createComponentNormalsFlat(t,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,KS);for(let a=0;a<3;a++){const l=3*s[o+a];Da[0]=i[l+0],Da[1]=i[l+1],Da[2]=i[l+2],_e(KS,Da)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return new o7(i,s,n)}_createComponentNormalsFlat(t,i){const r=Cn(i.length),s=new Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(t,i,n,KS);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return new o7(r,s,!1)}_createComponentNormalsSmooth(t,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(t,i,o,KS);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:O(),count:0},r[c]=h),fe(h.normal,h.normal,a),h.count++}}const s=Cn(3*i.length),n=new Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(be(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new o7(s,n,!1)}_getFaceVertices(t,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,i,r,s){return this._getFaceVertices(t,i,r,Da,ZS,JS),me(ZS,ZS,Da),me(JS,JS,Da),_t(Da,ZS,JS),be(s,Da),s}_getOrCreateComponents(t){return Ft(t.components,Bpt)}_createPositionBuffer(t,i){let r=t.vertexAttributes.position;const s=i.reprojection===hh.ECEF?i.transformBeforeProject:null;if(v(s)&&(r=Ept(r,new Float64Array(r.length),s)),i.reprojection===hh.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=v(s)?r:new Float64Array(r.length);return Xs(r,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(t,i,r){let s=t.vertexAttributes.normal;if(C(s))return null;const n=r.reprojection===hh.ECEF?r.transformBeforeProject:null;if(v(n)&&(s=Cpt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===hh.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=v(n)?s:new Float32Array(s.length);return Spt(s,o,i,t.spatialReference,a)}_createTangentBuffer(t,i,r){let s=t.vertexAttributes.tangent;if(C(s))return null;const n=r.reprojection===hh.ECEF?r.transformBeforeProject:null;if(v(n)&&(s=Apt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===hh.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=v(n)?s:new Float32Array(s.length);return Mpt(s,o,i,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(t),r=Nht(oo(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return UAe(i,r,s),s}return null}_createBuffers(t,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(v(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(v(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(v(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===hh.NONE&&v(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===hh.NONE&&v(a.geometryTransformation)?a.geometryTransformation:Pe()}}_computeReprojectionInfo(t){const i=v(t.transform),r=i&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===je.Local?hh.NONE:hh.ECEF;if(i){if(r===hh.NONE){const n=Pe();return Uf(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:uA(t.transform.localMatrix),needsBufferCopy:!1}}const s=lU(Pe(),t.transform.origin);return Hs(s,s,t.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(t,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;cF[0]=o.x,cF[1]=o.y,cF[2]=o.z;const a=Pe();Uf(t.spatialReference,cF,a,n);const l=ea.fromTypedArray(i);if(Ea(the,a),q$(l,l,the),v(r)||v(s)){if(cp(xR,a),up(xR,xR),v(r)){const c=Mr.fromTypedArray(r);lb(c,c,xR)}if(v(s)){const c=Mr.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);lb(c,c,xR)}}return a}_validateFaces(t,i){const r=t.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,i){return i.faces?i.faces:IA(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return v(r)&&!t.spatialReference.equals(r)?(s=new Float64Array(i.length),Xs(t.vertexAttributes.position,t.spatialReference,0,s,r,0,n)):s=i,Xr(a7),Lh(a7,s,0,n),!_f(a7,this._context.clippingExtent)}_createGeometryInfo(t,i,r){if(!q1(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const s=this._createBuffers(t,i);if(C(s))return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:p,geometryTransformation:f}=s,m=this._getOrCreateComponents(t),y=new Array;let _=!1;for(const b of m){if(!this._validateFaces(t,b))return null;const w=this._getOrCreateFaces(t,b);if(w.length===0)continue;const T=this._createComponentNormals(n,c,b,w);T.didFlipNormals&&(_=!0);const S=[[R.POSITION,new Ke(n,3,!0)],[R.NORMAL,new Ke(T.normals,3,!0)]],E=[[R.POSITION,w],[R.NORMAL,T.indices]];v(a)&&(S.push([R.COLOR,new Ke(a,4,!0)]),E.push([R.COLOR,w])),v(l)&&(S.push([R.SYMBOLCOLOR,new Ke(l,4,!0)]),E.push([R.SYMBOLCOLOR,new Array(w.length).fill(0)])),v(o)&&(S.push([R.UV0,new Ke(o,2,!0)]),E.push([R.UV0,w])),v(h)&&(S.push([R.TANGENT,new Ke(h,4,!0)]),E.push([R.TANGENT,w]));const M=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(t,b),$=new Rn(A,S,E,null,hn.Mesh,M);$.transformation=f,y.push($)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:p}}}class o7{constructor(t,i,r){this.normals=t,this.indices=i,this.didFlipNormals=r}}const cF=O(),Da=O(),ZS=O(),JS=O(),KS=O(),the=Pe(),xR=Cs(),a7=ho(),Bpt=[new Tpt];var hh;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(hh||(hh={}));class zpt{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const i=this._lodRenderer.instanceData;t!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,i,r){if(this.elevationAligner){Nee(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>AM(o,t,this.elevationContext,i,a),n=this.elevationAligner(this,this.elevationContext,t.spatialReference,s,i);v(n)&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(t=O()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,lm),Ze(t,this._lodRenderer.baseBoundingSphere.center,lm)}getBoundingBoxObjectSpace(t=ho()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,lm);const i=this._lodRenderer.baseBoundingBox;Xr(t);for(let r=0;r<8;++r)ue(sd,(1&r)==0?i[0]:i[3],(2&r)==0?i[1]:i[4],(4&r)==0?i[2]:i[5]),Ze(sd,sd,lm),Mg(t,sd);return t}computeAttachmentOrigin(t){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,lm),t.render.origin[0]+=lm[12],t.render.origin[1]+=lm[13],t.render.origin[2]+=lm[14],t.render.num++}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Gpt,l=eJ(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,lm);for(let h=0;h<l;h++){const p=a[h];sd[0]=o[p[0]],sd[1]=o[p[1]],sd[2]=o[p[2]],Ze(sd,sd,lm),Zb[3*h+0]=sd[0],Zb[3*h+1]=sd[1],Zb[3*h+2]=sd[2]}if(!t(Zb,0,l))return null;Xr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Zb[h+p]),o[p+3]=Math.max(o[p+3],Zb[h+p]);c&&r.push({location:Zb.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(yf(o,l7),this.elevationContext.mode!=="absolute-height")){let h;const p=Lee(o,i.service.spatialReference,i);try{h=await i.service.queryElevation(l7[0],l7[1],s,p,"ground")}catch{}v(h)&&Pye(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,i){if(t===D0.Highlight){const r=new Tk(t);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(t){this._highlights.forEach(i=>t.remove(i))}_addHighlightId(t){this._highlights.add(t),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const Zb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],sd=O(),l7=O(),Gpt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],lm=Pe();function jpt(e){const t=new Array;return e.stageResources.geometries.forEach(i=>{const r=e.stageResources.textures;t.push(new FCe(i,r))}),{components:t,minScreenSpaceRadius:Ft(e.lodThreshold,0),pivotOffset:e.pivotOffset}}function Hpt(e){return{levels:e.map(t=>jpt(t))}}function qpt(e,t,i){if(e.count!==t.count)return void V8.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=i[9],y=i[10],_=i[11],b=i[12],w=i[13],T=i[14],S=i[15],E=e.typedBuffer,M=e.typedBufferStride,A=t.typedBuffer,$=t.typedBufferStride;for(let I=0;I<r;I++){const k=I*M,V=I*$,B=A[V],G=A[V+1],X=A[V+2],K=A[V+3];E[k]=s*B+l*G+f*X+b*K,E[k+1]=n*B+c*G+m*X+w*K,E[k+2]=o*B+h*G+y*X+T*K,E[k+3]=a*B+p*G+_*X+S*K}}function oMe(e,t,i){if(e.count!==t.count)return void V8.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,_=t.typedBuffer,b=t.typedBufferStride;for(let w=0;w<r;w++){const T=w*y,S=w*b,E=_[S],M=_[S+1],A=_[S+2],$=_[S+3];m[T]=s*E+a*M+h*A,m[T+1]=n*E+l*M+p*A,m[T+2]=o*E+c*M+f*A,m[T+3]=$}}function Wpt(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function QX(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function Xpt(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,normalize:Wpt,scale:QX,shiftRight:Xpt,transformMat3:oMe,transformMat4:qpt},Symbol.toStringTag,{value:"Module"}));function Ypt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Ypt},Symbol.toStringTag,{value:"Module"}));function Zpt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Zpt},Symbol.toStringTag,{value:"Module"}));function Jpt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function P4(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:Jpt,makeDense:P4},Symbol.toStringTag,{value:"Module"}));function aMe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function lMe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(bet(t.elementType)){const h=wet(t.elementType);if(vet(t.elementType))for(let p=0;p<a;++p)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else aMe(e,t,i);return e}function Kpt(e,t,i,r){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=r==null?void 0:r.count)!=null?l:e.count;let a=((c=r==null?void 0:r.dstIndex)!=null?c:0)*n;for(let h=0;h<o;++h)s[a]=t,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:aMe,fill:Kpt,normalizeIntegerBuffer:lMe},Symbol.toStringTag,{value:"Module"}));function nV(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function Qpt(e,t,i,r,s){var c,h;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:nV,fill:Qpt},Symbol.toStringTag,{value:"Module"}));function cMe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function uMe(e,t,i,r,s,n){var h,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(h=n==null?void 0:n.count)!=null?h:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let f=0;f<l;++f)o[c]=t,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:cMe,fill:uMe},Symbol.toStringTag,{value:"Module"}));function Ex(e,t){return new e(new ArrayBuffer(t*e.ElementCount*ZSe(e.ElementType)))}class hMe{constructor(t){this._streamDataRequester=t}async loadJSON(t,i){return this._load("json",t,i)}async loadBinary(t,i){return Ug(t)?(ii(i),aJ(t)):this._load("binary",t,i)}async loadImage(t,i){return this._load("image",t,i)}async _load(t,i,r){if(C(this._streamDataRequester))return(await _r(i,{responseType:eft[t]})).data;const s=await kf(this._streamDataRequester.request(i,t,r));if(s.ok===!0)return s.value;throw bu(s.error),new H("",`Request for resource failed: ${s.error}`)}}const eft={image:"image",binary:"array-buffer",json:"json"};function tft(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}function ift(e,t={}){return{data:e,parameters:{wrap:{s:Pt.REPEAT,t:Pt.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}let zA=class{constructor(e,t,i=""){this.major=e,this.minor=t,this._context=i}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",i=this._context&&this._context+" ";throw new H(t+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new zA(this.major,this.minor,this._context)}static parse(e,t=""){const[i,r]=e.split("."),s=/^\s*\d+\s*$/;if(!i||!i.match||!i.match(s))throw new H((t&&t+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!r||!r.match||!r.match(s))throw new H((t&&t+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const n=parseInt(i,10),o=parseInt(r,10);return new zA(n,o,t)}};class ihe{constructor(t){this._data=t,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const t=this._offset4;return this._offset4+=1,this._dataUint32[t]}readUint8Array(t){const i=4*this._offset4;return this._offset4+=t/4,new Uint8Array(this._data,i,t)}remainingBytes(){return this._data.byteLength-4*this._offset4}}var lI,rhe;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(lI||(lI={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(rhe||(rhe={}));const dMe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},rft={pbrMetallicRoughness:dMe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},sft={ESRI_externalColorMixMode:"tint"},she=(e={})=>{const t={...dMe,...e.pbrMetallicRoughness},i=nft({...sft,...e.extras});return{...rft,...e,pbrMetallicRoughness:t,extras:i}};function nft(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const oft={magFilter:nt.LINEAR,minFilter:nt.LINEAR_MIPMAP_LINEAR,wrapS:Pt.REPEAT,wrapT:Pt.REPEAT},aft=e=>({...oft,...e});function lft(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(t=s||"",i=n||"","")),{dirPart:t,filePart:i}}const uF={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class Ky{constructor(t,i,r,s){if(this._context=t,this.uri=i,this.json=r,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=lft(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new H("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new H("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new H("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(t,i,r){if(Ug(i)){const o=d$(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Ky(t,i,l)}catch{}const a=aJ(i);if(Ky._isGLBData(a))return this._fromGLBData(t,i,a)}if(i.endsWith(".gltf")){const o=await t.loadJSON(i,r);return new Ky(t,i,o)}const s=await t.loadBinary(i,r);if(Ky._isGLBData(s))return this._fromGLBData(t,i,s);const n=await t.loadJSON(i,r);return new Ky(t,i,n)}static _isGLBData(t){if(t==null)return!1;const i=new ihe(t);return i.remainingBytes()>=4&&i.readUint32()===uF.MAGIC}static async _fromGLBData(t,i,r){const s=await Ky._parseGLBData(r);return new Ky(t,i,s.json,s.binaryData)}static async _parseGLBData(t){const i=new ihe(t);if(i.remainingBytes()<12)throw new H("gltf-loader-error","GLB binary data is insufficiently large.");const r=i.readUint32(),s=i.readUint32(),n=i.readUint32();if(r!==uF.MAGIC)throw new H("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(t.byteLength<n)throw new H("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new H("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),h=i.readUint32();if(l===0){if(h!==uF.CHUNK_TYPE_JSON)throw new H("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new H("gltf-loader-error","No JSON data found.");o=await Opt(i.readUint8Array(c))}else if(l===1){if(h!==uF.CHUNK_TYPE_BIN)throw new H("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=i.readUint8Array(c)}else se.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new H("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(t,i){const r=this.json.buffers[t];if(r.uri==null){if(this._glbBuffer==null)throw new H("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(t,i);if(s.byteLength!==r.byteLength)throw new H("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(t,i){const r=this._bufferLoaders.get(t);if(r)return r;const s=this.json.buffers[t].uri,n=this._context.loadBinary(this._resolveUri(s),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(t,n),n}async getAccessor(t,i){if(!this.json.accessors)throw new H("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[t];if((r==null?void 0:r.bufferView)==null)throw new H("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[lI.MAT2,lI.MAT3,lI.MAT4])throw new H("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const s=this.json.bufferViews[r.bufferView],n=await this.getBuffer(s.buffer,i),o=hft[r.type],a=dft[r.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(t,i){if(t.indices==null)return;const r=await this.getAccessor(t.indices,i);if(r.isDenselyPacked)switch(r.componentType){case dt.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case dt.UNSIGNED_BYTE:return P4(this._wrapAccessor(F0,r));case dt.UNSIGNED_SHORT:return P4(this._wrapAccessor(PT,r));case dt.UNSIGNED_INT:return P4(this._wrapAccessor(LT,r))}}async getPositionData(t,i){if(t.attributes.POSITION==null)throw new H("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(t.attributes.POSITION,i);if(r.componentType!==dt.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+dt[r.componentType]);if(r.componentCount!==3)throw new H("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(Mr,r)}async getNormalData(t,i){if(t.attributes.NORMAL==null)throw new H("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(t.attributes.NORMAL,i);if(r.componentType!==dt.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+dt[r.componentType]);if(r.componentCount!==3)throw new H("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(Mr,r)}async getTangentData(t,i){if(t.attributes.TANGENT==null)throw new H("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(t.attributes.TANGENT,i);if(r.componentType!==dt.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+dt[r.componentType]);if(r.componentCount!==4)throw new H("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new _l(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(t,i){if(t.attributes.TEXCOORD_0==null)throw new H("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(t.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new H("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===dt.FLOAT)return this._wrapAccessor(hp,r);if(!r.normalized)throw new H("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return pft(r)}async getVertexColors(t,i){if(t.attributes.COLOR_0==null)throw new H("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(t.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new H("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===dt.FLOAT)return this._wrapAccessor(_l,r);if(r.componentType===dt.UNSIGNED_BYTE)return this._wrapAccessor(ta,r);if(r.componentType===dt.UNSIGNED_SHORT)return this._wrapAccessor(ib,r)}else if(r.componentCount===3){if(r.componentType===dt.FLOAT)return this._wrapAccessor(Mr,r);if(r.componentType===dt.UNSIGNED_BYTE)return this._wrapAccessor(tb,r);if(r.componentType===dt.UNSIGNED_SHORT)return this._wrapAccessor($T,r)}throw new H("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+dt[r.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,i,r){var n,o,a,l,c,h,p,f,m,y;let s=t.material?this._materialCache.get(t.material):void 0;if(!s){const _=t.material!=null?she(this.json.materials[t.material]):she(),b=_.pbrMetallicRoughness,w=this.hasVertexColors(t),T=this.getTexture(b.baseColorTexture,i),S=this.getTexture(_.normalTexture,i),E=r?this.getTexture(_.occlusionTexture,i):void 0,M=r?this.getTexture(_.emissiveTexture,i):void 0,A=r?this.getTexture(b.metallicRoughnessTexture,i):void 0,$=t.material!=null?t.material:-1;s={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:b.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await T,normalTexture:await S,name:_.name,id:$,occlusionTexture:await E,emissiveTexture:await M,emissiveFactor:_.emissiveFactor,metallicFactor:b.metallicFactor,roughnessFactor:b.roughnessFactor,metallicRoughnessTexture:await A,hasVertexColors:w,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=b==null?void 0:b.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(h=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:h.KHR_texture_transform,emissiveTextureTransform:(f=(p=_.emissiveTexture)==null?void 0:p.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(y=(m=b==null?void 0:b.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:y.KHR_texture_transform}}return s}async getTexture(t,i){if(!t)return;if((t.texCoord||0)!==0)throw new H("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=t.index,s=this.json.textures[r],n=aft(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(r,s,i);return lZ(this._textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>{throw new H("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:r}})}getNodeTransform(t){if(t===void 0)return cft;let i=this._nodeTransformCache.get(t);if(!i){const r=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?i=Hs(Pe(),r,s.matrix):s.translation||s.rotation||s.scale?(i=uA(r),s.translation&&Vc(i,i,s.translation),s.rotation&&(hF[3]=GQ(hF,s.rotation),Cu(i,i,hF[3],hF)),s.scale&&oU(i,i,s.scale)):i=uA(r),this._nodeTransformCache.set(t,i)}return i}_wrapAccessor(t,i){return new t(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(t){return Rh(t,this._baseUri)}_getNodeParent(t){return this._nodeParentMap.get(t)}_checkVersionSupported(){const t=zA.parse(this.json.asset.version,"glTF");uft.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json;if(t.extensionsRequired&&!t.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new H("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,i)=>{t.children&&t.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(t,i,r){const s=this._textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(i,r);return this._textureLoaders.set(t,n),n}_getTextureSourceId(t){if(t.extensions!==void 0&&t.extensions.KHR_texture_basisu!==null)return t.extensions.KHR_texture_basisu.source;if(t.source!==null)return t.source;throw new H("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(t,i){const r=this._getTextureSourceId(t),s=this.json.images[r];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),i);return new nMe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),i)}if(s.bufferView==null)throw new H("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new H("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i);if(n.byteStride!=null)throw new H("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return Ipt(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const t=await LG(Array.from(this._bufferLoaders.values())),i=await LG(Array.from(this._textureLoaders.values()));return t.reduce((r,s)=>{var n;return r+((n=s==null?void 0:s.byteLength)!=null?n:0)},0)+i.reduce((r,s)=>r+(s?iT(s)?s.data.byteLength:s.width*s.height*4:0),0)}}const cft=F_e(Pe(),Math.PI/2),uft=new zA(2,0,"glTF"),hF=fp(),hft={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},dft={[dt.BYTE]:1,[dt.UNSIGNED_BYTE]:1,[dt.SHORT]:2,[dt.UNSIGNED_SHORT]:2,[dt.FLOAT]:4,[dt.UNSIGNED_INT]:4};function pft(e){switch(e.componentType){case dt.BYTE:return new DT(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_BYTE:return new IT(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.SHORT:return new FT(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_SHORT:return new MA(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_INT:return new RA(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.FLOAT:return new hp(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)}}let fft=0;async function pMe(e,t,i={},r=!0){const s=await Ky.load(e,t,i),n="gltf_"+fft++,o={lods:[],materials:new Map,textures:new Map,meta:mft(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await gft(s,async(h,p,f,m)=>{var V;const y=(V=l.get(f))!=null?V:0;l.set(f,y+1);const _=h.mode!==void 0?h.mode:Nt.TRIANGLES,b=_===Nt.TRIANGLES||_===Nt.TRIANGLE_STRIP||_===Nt.TRIANGLE_FAN?_:null;if(C(b))return void se.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Nt[_]+"). Skipping primitive.");if(!s.hasPositions(h))return void se.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(h,i),T=s.getMaterial(h,i,r),S=s.hasNormals(h)?s.getNormalData(h,i):null,E=s.hasTangents(h)?s.getTangentData(h,i):null,M=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,i):null,A=s.hasVertexColors(h)?s.getVertexColors(h,i):null,$=s.getIndexData(h,i),I={transform:uA(p),attributes:{position:await w,normal:S?await S:null,texCoord0:M?await M:null,color:A?await A:null,tangent:E?await E:null},indices:await $,primitiveType:b,material:_ft(o,await T,n)};let k=null;v(o.meta)&&v(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(k=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:k},o.lods[f].parts[y]=I});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function mft(e){const t=e.json;let i=null;return t.nodes.forEach(r=>{const s=r.extras;v(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function gft(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),yft(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=e.getNodeTransform(a);if(c.weights!=null&&se.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function yft(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function _ft(e,t,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=ift(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:vft.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=tft({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform,metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const vft=[nt.LINEAR_MIPMAP_LINEAR,nt.LINEAR_MIPMAP_NEAREST];function bft(e,t=IA){return typeof e=="number"?t(e):iZ(e)||ux(e)?new Uint32Array(e):e}function wft(e){const t=typeof e=="number"?e:e.length;if(t<3)return[];const i=t-2,r=KSe(i);if(typeof e=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function xft(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=e[0];let n=e[1],o=0;for(let a=0;a<i;++a){const l=e[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}class Tft{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class Sft{constructor(t,i,r){this.name=t,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new Tft,this.numberOfVertices=0}}const By=se.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function fMe(e,t){var n;const i=await Eft(e,t),r=await Oft((n=i.textureDefinitions)!=null?n:{},t);let s=0;for(const o in r)if(r.hasOwnProperty(o)){const a=r[o];s+=a!=null&&a.image?a.image.width*a.image.height*4:0}return{resource:i,textures:r,size:s+ibe(i)}}async function Eft(e,t){const i=v(t)&&t.streamDataRequester;if(i)return Cft(e,i,t);const r=await kf(_r(e,t));if(r.ok===!0)return r.value.data;bu(r.error),mMe(r.error)}async function Cft(e,t,i){const r=await kf(t.request(e,"json",i));if(r.ok===!0)return r.value;bu(r.error),mMe(r.error.details.url)}function mMe(e){throw new H("",`Request for object resource failed: ${e}`)}function Aft(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(By.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(By.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(By.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(By.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else By.warn("Indexed geometries must specify faces"),r=!1;break}default:By.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(By.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(By.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Mft(e,t){var y;const i=new Array,r=new Array,s=new Array,n=new wM,o=e.resource,a=zA.parse(o.version||"1.0","wosr");Pft.validate(a);const l=o.model.name,c=o.model.geometries,h=(y=o.materialDefinitions)!=null?y:{},p=e.textures;let f=0;const m=new Map;for(let _=0;_<c.length;_++){const b=c[_];if(!Aft(b))continue;const w=Ift(b),T=b.params.vertexAttributes,S=[];for(const G in T){const X=T[G],K=X.values;S.push([G,new Ke(K,X.valuesPerElement,!0)])}const E=[];if(b.params.topology!=="PerAttributeArray"){const G=b.params.faces;for(const X in G)E.push([X,G[X].values])}const M=w.texture,A=p&&p[M];if(A&&!m.has(M)){const{image:G,params:X}=A,K=new If(G,X);r.push(K),m.set(M,K)}const $=m.get(M),I=$?$.id:void 0,k=w.material;let V=n.get(k,M);if(C(V)){const G=h[k.substring(k.lastIndexOf("/")+1)].params;G.transparency===1&&(G.transparency=0);const X=A&&A.alphaChannelUsage,K=G.transparency>0||X==="transparency"||X==="maskAndTransparency",re=A?gMe(A.alphaChannelUsage):void 0,q={ambient:Rc(G.diffuse),diffuse:Rc(G.diffuse),opacity:1-(G.transparency||0),transparent:K,textureAlphaMode:re,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:Br.None,colorMixMode:G.externalColorMixMode||"tint",textureAlphaPremultiplied:!!A&&!!A.params.preMultiplyAlpha};v(t)&&t.materialParamsMixin&&Object.assign(q,t.materialParamsMixin),V=new V0(q),n.set(k,M,V)}s.push(V);const B=new Rn(V,S,E);f+=E.position?E.position.length:0,i.push(B)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:Rft(i)}}function Rft(e){const t=Xr();return e.forEach(i=>{const r=i.boundingInfo;v(r)&&(Mg(t,r.bbMin),Mg(t,r.bbMax))}),t}async function Oft(e,t){const i=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){By.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:Pt.REPEAT,t:Pt.REPEAT},preMultiplyAlpha:gMe(h)!==Er.Opaque},f=v(t)&&t.disableTextures?Promise.resolve(null):k0(l,t);i.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function gMe(e){switch(e){case"mask":return Er.Mask;case"maskAndTransparency":return Er.MaskBlend;case"none":return Er.Opaque;default:return Er.Blend}}function Ift(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const Pft=new zA(1,2,"wosr"),QS=2.1;async function yMe(e,t){const i=_Me(VW(e));if(i.fileType==="wosr"){const p=await(t.cache?t.cache.loadWOSR(i.url,t):fMe(i.url,t)),{engineResources:f,referenceBoundingBox:m}=Mft(p,t);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const r=await(t.cache?t.cache.loadGLTF(i.url,t,!!t.usePBR):pMe(new hMe(t.streamDataRequester),i.url,t,t.usePBR)),s=oo(r.model.meta,"ESRI_proxyEllipsoid"),n=r.meta.isEsriSymbolResource&&v(s)&&r.meta.uri.includes("/RealisticTrees/");n&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,Nft(r,s));const o=!!t.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[0,1,.2]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},l={...t.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=vMe(r,a,l,t.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function _Me(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function vMe(e,t,i,r){const s=e.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Xr();return s.lods.forEach((h,p)=>{const f=r.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&p!==r.singleLodIndex;if(f&&p!==0)return;const m=new Sft(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(y=>{const _=f?new V0({}):$ft(s,y,m,t,i,o,a),{geometry:b,vertexCount:w}=Lft(y,v(_)?_:new V0({})),T=b.boundingInfo;v(T)&&p===0&&(Mg(c,T.bbMin),Mg(c,T.bbMax)),v(_)&&(m.stageResources.geometries.push(b),m.numberOfVertices+=w)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function $ft(e,t,i,r,s,n,o){const a=t.material+(t.attributes.normal?"_normal":"")+(t.attributes.color?"_color":"")+(t.attributes.texCoord0?"_texCoord0":"")+(t.attributes.tangent?"_tangent":""),l=e.materials.get(t.material),c=v(t.attributes.texCoord0),h=v(t.attributes.normal);if(C(l))return null;const p=Dft(l.alphaMode);if(!n.has(a)){if(c){const E=(M,A=!1)=>{if(v(M)&&!o.has(M)){const $=e.textures.get(M);if(v($)){const I=$.data;o.set(M,new If(iT(I)?I.data:I,{...$.parameters,preMultiplyAlpha:!iT(I)&&A,encoding:iT(I)&&v(I.encoding)?I.encoding:void 0}))}}};E(l.textureColor,p!==Er.Opaque),E(l.textureNormal),E(l.textureOcclusion),E(l.textureEmissive),E(l.textureMetallicRoughness)}const m=l.color[0]**(1/QS),y=l.color[1]**(1/QS),_=l.color[2]**(1/QS),b=l.emissiveFactor[0]**(1/QS),w=l.emissiveFactor[1]**(1/QS),T=l.emissiveFactor[2]**(1/QS),S=v(l.textureColor)&&c?o.get(l.textureColor):null;n.set(a,new V0({...r,transparent:p===Er.Blend,customDepthTest:ET.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Br.None:Br.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:h?yr.Attribute:yr.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:v(S)?S.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:v(l.textureNormal)&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:v(S)&&!!S.params.preMultiplyAlpha,occlusionTextureId:v(l.textureOcclusion)&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:v(l.textureEmissive)&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:v(l.textureMetallicRoughness)&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[b,w,T],mrrFactors:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:ig(l.colorTextureTransform),normalTextureTransformMatrix:ig(l.normalTextureTransform),occlusionTextureTransformMatrix:ig(l.occlusionTextureTransform),emissiveTextureTransformMatrix:ig(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:ig(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(i.stageResources.materials.push(f),c){const m=y=>{v(y)&&i.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function Lft(e,t){const i=e.attributes.position.count,r=Fft(e.indices||i,e.primitiveType),s=Ex(Mr,i);q$(s,e.attributes.position,e.transform);const n=[[R.POSITION,new Ke(s.typedBuffer,s.elementCount,!0)]],o=[[R.POSITION,r]];if(v(e.attributes.normal)){const a=Ex(Mr,i);xA(dF,e.transform),lb(a,e.attributes.normal,dF),n.push([R.NORMAL,new Ke(a.typedBuffer,a.elementCount,!0)]),o.push([R.NORMAL,r])}if(v(e.attributes.tangent)){const a=Ex(_l,i);xA(dF,e.transform),oMe(a,e.attributes.tangent,dF),n.push([R.TANGENT,new Ke(a.typedBuffer,a.elementCount,!0)]),o.push([R.TANGENT,r])}if(v(e.attributes.texCoord0)){const a=Ex(hp,i);lMe(a,e.attributes.texCoord0),n.push([R.UV0,new Ke(a.typedBuffer,a.elementCount,!0)]),o.push([R.UV0,r])}if(v(e.attributes.color)){const a=Ex(ta,i);if(e.attributes.color.elementCount===4)e.attributes.color instanceof _l?QX(a,e.attributes.color,255):e.attributes.color instanceof ta?cMe(a,e.attributes.color):e.attributes.color instanceof ib&&QX(a,e.attributes.color,1/256);else{uMe(a,255,255,255,255);const l=new tb(a.buffer,0,4);e.attributes.color instanceof Mr?BX(l,e.attributes.color,255):e.attributes.color instanceof tb?nV(l,e.attributes.color):e.attributes.color instanceof $T&&BX(l,e.attributes.color,1/256)}n.push([R.COLOR,new Ke(a.typedBuffer,a.elementCount,!0)]),o.push([R.COLOR,r])}return{geometry:new Rn(t,n,o),vertexCount:i}}const dF=Cs();function Dft(e){switch(e){case"BLEND":return Er.Blend;case"MASK":return Er.Mask;case"OPAQUE":case null:case void 0:return Er.Opaque}}function Fft(e,t){switch(t){case Nt.TRIANGLES:return bft(e);case Nt.TRIANGLE_STRIP:return wft(e);case Nt.TRIANGLE_FAN:return xft(e)}}function Nft(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];for(const s of r.parts){const n=s.attributes.normal;if(C(n))return;const o=s.attributes.position,a=o.count,l=O(),c=O(),h=O(),p=Ex(ta,a),f=Ex(Mr,a),m=Ea(Pe(),s.transform);for(let y=0;y<a;y++){o.getVec(y,c),n.getVec(y,l),Ze(c,c,s.transform),me(h,c,t.center),r5(h,h,t.radius);const _=h[2],b=Oe(h),w=Math.min(.45+.55*b*b,1);r5(h,h,t.radius),m!==null&&Ze(h,h,m),be(h,h),i+1!==e.model.lods.length&&e.model.lods.length>1&&On(h,h,l,_>-1?.2:Math.min(-4*_-3.8,1)),f.setVec(y,h),p.set(y,0,255*w),p.set(y,1,255*w),p.set(y,2,255*w),p.set(y,3,255)}s.attributes.normal=f,s.attributes.color=p}}}var P3t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetch:yMe,gltfToEngineResources:vMe,parseUrl:_Me}),ns;function kft(e){let t=As().mat4f64(R.LOCALTRANSFORM).mat4f64(R.GLOBALTRANSFORM).vec4f64(R.BOUNDINGSPHERE).vec3f64(R.MODELORIGIN).mat3f(R.MODEL).mat3f(R.MODELNORMAL).vec2f(R.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(R.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(R.FEATUREATTRIBUTE)),t=t.u8(R.STATE).u8(R.LODLEVEL),e.includes(R.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(R.OBJECTANDLAYERIDCOLOR)),t.alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(ns||(ns={}));class Uft{constructor(t){this.localTransform=t.getField(R.LOCALTRANSFORM,eb),this.globalTransform=t.getField(R.GLOBALTRANSFORM,eb),this.modelOrigin=t.getField(R.MODELORIGIN,ea),this.model=t.getField(R.MODEL,Bf),this.modelNormal=t.getField(R.MODELNORMAL,Bf),this.modelScaleFactors=t.getField(R.MODELSCALEFACTORS,hp),this.boundingSphere=t.getField(R.BOUNDINGSPHERE,OT),this.color=t.getField(R.COLOR,_l),this.featureAttribute=t.getField(R.FEATUREATTRIBUTE,_l),this.state=t.getField(R.STATE,F0),this.lodLevel=t.getField(R.LODLEVEL,F0),this.objectAndLayerIdColor=t.getField(R.OBJECTANDLAYERIDCOLOR,ta)}}let dE=class extends Te{constructor(e,t){super(e),this.events=new ps,this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=kft(t)}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,ns.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;vt(e>=0&&e<this._capacity&&(t.get(e)&ns.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,ns.ACTIVE)?this._setStateFlags(e,ns.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;vt(e>=0&&e<this._capacity&&(t.get(e)&ns.ALLOCATED)!=0,"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,i=!0){this._view.localTransform.setMat(e,t),i&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,i=!0){this._view.globalTransform.setMat(e,t),i&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,i=D_,r=Cp;t.localTransform.getMat(e,nhe),t.globalTransform.getMat(e,c7);const s=Hs(c7,c7,nhe);ue(i,s[12],s[13],s[14]),t.modelOrigin.setVec(e,i),cp(r,s),t.model.setMat(e,r);const n=wze(D_,s);n.sort(),t.modelScaleFactors.set(e,0,n[1]),t.modelScaleFactors.set(e,1,n[2]),lS(r,r),up(r,r),t.modelNormal.setMat(e,r),this._setStateFlags(e,ns.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const i=this._view;i.model.getMat(e,Cp),i.modelOrigin.getVec(e,D_),t[0]=Cp[0],t[1]=Cp[1],t[2]=Cp[2],t[3]=0,t[4]=Cp[3],t[5]=Cp[4],t[6]=Cp[5],t[7]=0,t[8]=Cp[6],t[9]=Cp[7],t[10]=Cp[8],t[11]=0,t[12]=D_[0],t[13]=D_[1],t[14]=D_[2],t[15]=1}applyShaderTransformation(e,t){v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){return this._view.localTransform.getMat(e,t),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);if(v(this.shaderTransformation)){const i=this.shaderTransformation.scaleFactor(D_,this,e);t*=Math.max(i[0],i[1],i[2])}return t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);if(v(this.shaderTransformation)){const i=this.shaderTransformation.scaleFactor(D_,this,e);t*=Vft(i[0],i[1],i[2])}return t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}getColor(e,t){this._view.color.getVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,ns.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,ns.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,ns.HIGHLIGHT,t),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,ns.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++t;return t}_setStateFlags(e,t){const i=this._view.state;t=i.get(e)|t,i.set(e,t)}_clearStateFlags(e,t){const i=this._view.state;t=i.get(e)&~t,i.set(e,t)}_setStateFlag(e,t,i){i?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){const e=Math.max(Bft,Math.floor(this._capacity*zft)),t=this._layout.createBuffer(e);if(this._buffer){const i=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(i)}this._capacity=e,this._buffer=t,this._view=new Uft(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&ns.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};function Vft(e,t,i){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),i))}u([d({constructOnly:!0})],dE.prototype,"shaderTransformation",void 0),u([d()],dE.prototype,"_size",void 0),u([d({readOnly:!0})],dE.prototype,"size",null),dE=u([P("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],dE);const Bft=1024,zft=2,D_=O(),Cp=Cs(),nhe=Pe(),c7=Pe();class Gft extends Tf{constructor(t,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=Gn(),this._tmpMat4=Pe(),this._instanceData=t,this._boundingSphere=i}addInstance(t){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);Ze(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*bT(r),i.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class jft{constructor(t,i){this._worldSpaceRadius=t,this._minScreenSpaceRadii=i}selectLevel(t,i,r){const s=r.computeScreenPixelSizeAt(t),n=this._worldSpaceRadius*i/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}}class Hft extends m8{constructor(t,i,r,s,n,o){super(t,i),this.layerUid=t,this.graphicUid=i,this.geometryId=r,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}}function ote(e){return Xf(e)&&e.intersector===Ss.LOD&&!!e.target}class qft{constructor(t,i){const r=t.renderContext.rctx,s=i.geometry;this._materialRepository=t.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=n.allocate(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new vAe(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Oi.createVertex(r,Xi.STATIC_DRAW,l.buffer),this.vao=new Wf(r,ji,{geometry:Uu(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,t.transform.transform,t,r,s,(h,p,f,m,y)=>{if(h>=0){if(i!=null&&!i(t.rayBegin,t.rayEnd,h))return;const _=new Hft(o.layerUid,o.graphicUid(n),c,f,a,l);if((t.results.min.drapedLayerOrder==null||y>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||h<t.results.min.dist)&&t.results.min.set(Ss.LOD,_,h,p,t.transform.transform,y),t.options.store!==Aa.MIN&&(t.results.max.drapedLayerOrder==null||y>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||h>t.results.max.dist)&&t.results.max.set(Ss.LOD,_,h,p,t.transform.transform,y),t.options.store===Aa.ALL){const b=ZQ(t.results.min.ray);b.set(Ss.LOD,_,h,p,t.transform.transform,y),t.results.all.push(b)}}})}}class ate{static async create(t,i,r){const s=await Promise.allSettled(i.components.map(o=>t.controller.schedule(()=>new qft(t,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(v);if(So(r)||n.length!==s.length){n.forEach(o=>o.destroy()),ii(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new ate(i.minScreenSpaceRadius,n)}constructor(t,i){this.minScreenSpaceRadius=t,this.components=i}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(t,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(C(this._boundingBox)){const t=Xr();this.components.forEach(i=>{v(i.boundingInfo)&&(Mg(t,i.boundingInfo.bbMin),Mg(t,i.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(C(this._boundingSphere)){const t=this.boundingBox,i=O();yf(t,i),this._boundingSphere={center:i,radius:.5*Iye(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,i)=>t+i.triangleCount,0)}}class Wft{constructor(t,i,r){this._elementSize=i,this._buffer=Oi.createVertex(t,Xi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,i,r,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(i-t)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,i){const r=t*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(t){const i=t*this._elementSize,r=new ArrayBuffer(i);this._array&&(t>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=t}}class Xft{constructor(t){this.modelOriginHi=t.getField(R.MODELORIGINHI,Mr),this.modelOriginLo=t.getField(R.MODELORIGINLO,Mr),this.model=t.getField(R.MODEL,Bf),this.modelNormal=t.getField(R.MODELNORMAL,Bf),this.color=t.getField(R.INSTANCECOLOR,_l),this.featureAttribute=t.getField(R.INSTANCEFEATUREATTRIBUTE,_l),this.objectAndLayerIdColor=t.getField(R.OBJECTANDLAYERIDCOLOR_INSTANCED,ta)}}class ohe{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){vt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){vt(this._updating,"not updating"),this.size<Zft*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){vt(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),vt(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){vt(this._updating,"not updating"),vt(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(ahe,Math.floor(this._capacity*Yft));this._resize(t)}_shrink(){const t=Math.max(ahe,Math.floor(this._capacity*Jft));this._resize(t)}_resize(t){if(vt(this._updating,"not updating"),t===this._capacity)return;const i=new Wft(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);vt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new Xft(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,t),i-r):r>i?(this._buffer.copyRange(r,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const ahe=1024,Yft=2,Zft=.3,Jft=.5,Kft=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map(r=>r.minScreenSpaceRadius);return new jft(t,i)};let Td=class extends Te{constructor(e,t){super(e),this.type=Ss.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Ot,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new dE({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=t.registerTask(xt.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=emt(this.optionalFields),this._glInstanceBufferLayout=Uu(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(t=>{const i=t.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),this._highlightRenderInstanceData.forEach(t=>{const i=t.memoryUsage;e.cpu+=i.cpu,e.gpu+=i.gpu}),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach((i,r)=>{const s=this._defaultRenderInstanceData[r],n=this._highlightRenderInstanceData[r],o=s.size+n.size,a=i.triangleCount;t.push({renderedInstances:o,renderedTriangles:o*a,trianglesPerInstance:a})}),{totalInstances:e,renderedInstances:t.reduce((i,r)=>i+r.renderedInstances,0),renderedTriangles:t.reduce((i,r)=>i+r.renderedTriangles,0),levels:t}}async initializeRenderContext(e,t){this._context=e;const i=e.renderContext.rctx,r=await Promise.allSettled(this.symbol.levels.map(n=>(this._defaultRenderInstanceData.push(new ohe(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new ohe(i,this._instanceBufferLayout)),ate.create(e,n,t)))),s=r.map(n=>n.status==="fulfilled"?n.value:null).filter(v);if(So(t)||s.length!==r.length){s.forEach(n=>n.destroy()),ii(t);for(const n of r)if(n.status==="rejected")throw n.reason}this._levels=s,this._levelSelector=Kft(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(t=>t.material.requiresSlot(Ee.TRANSPARENT_MATERIAL,z.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(!cr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Hl),this._needFullCycle=!1)}}render(e){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output)||(e.rctx.bindVAO(),e.output!==z.Highlight&&e.output!==z.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==z.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}intersect(e,t,i,r){if(!this.baseMaterial.isVisible()||C(this._octree))return;const s=O();me(s,r,i);const n=o=>{this._instanceData.getCombinedModelTransform(o,uhe),e.transform.set(uhe),Ze(hhe,i,e.transform.inverse),Ze(dhe,r,e.transform.inverse);const a=this._instanceData.getState(o),l=this._instanceData.getLodLevel(o),c=this._levels.length;vt((a&ns.ACTIVE)!=0,"invalid instance state"),vt(l>=0&&l<c,"invaid lod level"),this._levels[l].intersect(e,t,hhe,dhe,o,this.metadata,c)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(n):this._octree.forEachAlongRay(i,s,n)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(C(this._octreeCached)){const t=this._instanceData,i=(e=t.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new Gft(t,this.baseBoundingSphere);for(let r=0;r<t.capacity;++r)i.get(r)&ns.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Be(this._octreeCached)}_queryDepthRangeOctree(e){if(C(this._octree))return{near:1/0,far:-1/0};const t=e.viewForward,i=this._octree.findClosest(t,Tf.DepthOrder.FRONT_TO_BACK,e.frustum),r=this._octree.findClosest(t,Tf.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||r==null)return{near:1/0,far:-1/0};const s=e.eye,n=this._instanceData.view;n.boundingSphere.getVec(i,cm),me(cm,cm,s);const o=_e(cm,t)-cm[3];n.boundingSphere.getVec(r,cm),me(cm,cm,s);const a=_e(cm,t)+cm[3];return{near:Math.max(e.near,o),far:Math.min(e.far,a)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>e.startUpdateCycle()),this._highlightRenderInstanceData.forEach(e=>e.startUpdateCycle())}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:i,_levelSelector:r}=this;this._defaultRenderInstanceData.forEach(c=>c.beginUpdate()),this._highlightRenderInstanceData.forEach(c=>c.beginUpdate());const s=this._instanceData,n=s.view;let o=s.size;const a=s.capacity;let l=this._instanceIndex;for(let c=0;c<o&&!e.done;++c){l===this._cycleStartIndex&&this._startUpdateCycle();const h=n.state.get(l);let p=0;if(!(h&ns.ALLOCATED)){l=l+1===a?0:l+1,o++;continue}const f=n.lodLevel.get(l);if(h&ns.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[f].freeTail(),h&ns.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[f].freeTail(),h&ns.REMOVE)s.freeInstance(l);else if(h&ns.VISIBLE){let m=0;t&&(n.modelOrigin.getVec(l,che),m=r.selectLevel(che,s.getCombinedMedianScaleFactor(l),i)),p=h&~(ns.ACTIVE|ns.TRANSFORM_CHANGED),m>=0&&(h&ns.HIGHLIGHT?(lhe(this._highlightRenderInstanceData[m],n,l),p|=ns.HIGHLIGHT_ACTIVE):(lhe(this._defaultRenderInstanceData[m],n,l),p|=ns.DEFAULT_ACTIVE)),n.state.set(l,p),n.lodLevel.set(l,m)}else p=h&~(ns.ACTIVE|ns.TRANSFORM_CHANGED),n.state.set(l,p);if(v(this._octreeCached)){const m=!!(h&ns.ACTIVE),y=!!(p&ns.ACTIVE);!m&&y?this._octreeCached.addInstance(l):m&&!y?this._octreeCached.removeInstance(l):m&&y&&h&ns.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(l),this._octreeCached.addInstance(l))}l=l+1===a?0:l+1,e.madeProgress()}this._instanceIndex=l,this._defaultRenderInstanceData.forEach(c=>c.endUpdate()),this._highlightRenderInstanceData.forEach(c=>c.endUpdate()),this._context.requestRender()}_renderComponents(e,t){this.levels.forEach((i,r)=>{const s=i.components.map(n=>this._beginComponent(e,t[r],n));i.components.forEach((n,o)=>this._renderComponent(e,s[o],t[r],n,r))})}_beginComponent(e,t,i){const{bindParameters:r,rctx:s,output:n}=e;if(t.size===0||!i.material.requiresSlot(r.slot,e.output))return null;const o=i.glMaterials.load(s,r.slot,n);return v(o)?o.beginSlot(r):null}_renderComponent(e,t,i,r,s){if(C(t))return;const{bindParameters:n,rctx:o}=e,a=o.bindTechnique(t,r.material.parameters,n);o.bindVAO(r.vao),t.ensureAttributeLocations(r.vao),a.bindDraw(tmt,n,r.material.parameters),cr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===z.Color&&(a.setUniform4fv("externalColor",phe[Math.min(s,phe.length-1)]),a.setUniform1i("colorMixMode",NEe.replace));const l=o.capabilities.instancing,c=i.capacity,h=i.headIndex,p=i.tailIndex,f=i.firstIndex,m=this._glInstanceBufferLayout,y=(_,b)=>{bQ(o,ji,i.buffer,m,_),l.drawArraysInstanced(t.primitiveType,0,r.vertexCount,b-_),wQ(o,ji,i.buffer,m)};r.material.parameters.transparent&&f!=null?h>p?(vt(f>=p&&f<=h,"invalid firstIndex"),y(f,h),y(p,f)):h<p&&(f<=h?(vt(f>=0&&f<=h,"invalid firstIndex"),y(f,h),y(p,c),y(0,f)):(vt(f>=p&&f<=c,"invalid firstIndex"),y(f,c),y(0,h),y(p,f))):h>p?y(p,h):h<p&&(y(0,h),y(p,c)),o.bindVAO(null)}};function lhe(e,t,i){const r=e.allocateHead();Qft(t,i,e.view,r)}function Qft(e,t,i,r){Det(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,e.objectAndLayerIdColor,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}function emt(e){let t=As().vec3f(R.MODELORIGINHI).vec3f(R.MODELORIGINLO).mat3f(R.MODEL).mat3f(R.MODELNORMAL);return v(e)&&e.includes("color")&&(t=t.vec4f(R.INSTANCECOLOR)),v(e)&&e.includes("featureAttribute")&&(t=t.vec4f(R.INSTANCEFEATUREATTRIBUTE)),v(e)&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(R.OBJECTANDLAYERIDCOLOR_INSTANCED)),t}u([d({constructOnly:!0})],Td.prototype,"symbol",void 0),u([d({constructOnly:!0})],Td.prototype,"optionalFields",void 0),u([d({constructOnly:!0})],Td.prototype,"metadata",void 0),u([d({constructOnly:!0})],Td.prototype,"shaderTransformation",void 0),u([d()],Td.prototype,"_instanceData",void 0),u([d()],Td.prototype,"_cycleStartIndex",void 0),u([d({readOnly:!0})],Td.prototype,"_enableLevelSelection",null),u([d()],Td.prototype,"_updateCyclesWithStaticCamera",void 0),u([d({readOnly:!0})],Td.prototype,"running",null),Td=u([P("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Td);const che=O(),cm=ui(),uhe=Pe(),hhe=O(),dhe=O(),phe=[Yt(1,0,1,1),Yt(0,0,1,1),Yt(0,1,0,1),Yt(1,1,0,1),Yt(1,0,0,1)],tmt=new Jht;class fhe{constructor(t,i,r,s,n,o,a,l,c,h,p,f){this.lodResources=t,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=p,this.pivotOffset=f}}class imt extends Hg{getCachedSize(){const[t,i,r]=v(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:i,height:r}}constructor(t,i,r,s){super(t,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(t){if(!this._drivenProperties.size&&N8(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this._isPrimitive){const r=i.resource?i.resource.primitive:fJ;this._resources=await this._createResourcesForPrimitive(r,t)}else this._resources=await this._createResourcesForUrl(i.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return v(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return v(this._resources)?this._resources.lodRenderer:null}_setMaterialTransparencyParams(t,i=oo(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=r,t.cullFace=s?Br.None:Br.Back,t}async _createResourcesForPrimitive(t,i){if(!nct(t))throw new Error(`Unknown object symbol primitive: ${t}`);const r=this.symbolLayer,s=ho(YDe(t)),n=Rc(gL(s)),o=Rc(h9(n,r)),a=Oe(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:sg,diffuse:sg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:T,minWorldLength:S,maxWorldLength:E}=f.verticalOffset;h.verticalOffset={screenLength:$r(T),minWorldLength:S||0,maxWorldLength:v(E)?E:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=jd;else{const T=v(r.material)?r.material.color:null,S=v(T)?De.toUnitRGBA(T):jd;h.externalColor=S}this._fastUpdates=kP(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,dw)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color")),he("enable-feature:objectAndLayerId-rendering")&&(h.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const m=new V0(h),y=kCe(t,m);if(!y)throw new Error(`Unknown object symbol primitive: ${t}`);const _=HD(y).map(T=>({opacity:1,transparent:T.parameters.transparent})),b=await this._createStageResources(y,p,i),w=await this._createLodRenderer(y,i);return new fhe(y,w,b,_,n,l,c,s,o,a,p,dw)}async _createResourcesForUrl(t,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=kP(this._context.renderer,this._fastVisualVariableConvertOptions(dw,dw,dw,dw)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color")),he("enable-feature:objectAndLayerId-rendering")&&(r.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:V,minWorldLength:B,maxWorldLength:G}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:$r(V),minWorldLength:B||0,maxWorldLength:v(G)?G:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled,s.skipHighLods=this._context.skipHighSymbolLods;const o=s.usePBR,a=await yMe(t,s),l=a.isEsriSymbolResource,c=a.isWosr,h=Hpt(a.lods);h.levels.sort((V,B)=>V.minScreenSpaceRadius-B.minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),y=oo(this.symbolLayer,"material","color"),_=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),b=this.needsDrivenTransparentPass,w=HD(h),T=HD(h).map(V=>({opacity:V.parameters.opacity||1,transparent:V.parameters.transparent}));w.forEach(V=>{const B=V.parameters;V.setParameters(m);const G=B.opacity*_,X=G<1||b||B.transparent;V.setParameters({opacity:G,transparent:X}),p.screenSizePerspectiveEnabled&&V.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const S=a.referenceBoundingBox,E=Rc(gL(S)),M=Rc(h.levels[0].pivotOffset),A=Rc(h9(E,this.symbolLayer)),$=Oe(A);UP(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(S,A,E,M))&&w.forEach(V=>V.setParameters(this._fastUpdates.materialParameters));const I=await this._createStageResources(h,o,i),k=await this._createLodRenderer(h,i);return new fhe(h,k,I,T,E,l,c,S,A,$,o,M)}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,i,r){const s=this._context.stage,n=HD(t);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=kce(t);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,r),ii(r);const a=Uce(t);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(t,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,pF),Ao(c,XX(this._fastUpdates.materialParameters,pF,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,pF),Fdt(a,this._fastUpdates.materialParameters,pF))}:null,o=new Td({symbol:t,optionalFields:this._optionalFields,metadata:s,shaderTransformation:n},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o),o.destroy()}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(t){const i={};return this._drivenProperties.color?i.externalColor=jd:v(t)&&v(t.color)?i.externalColor=De.toUnitRGBA(t.color):(i.externalColor=jd,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;const r=$P(i.geometry);if(C(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new Zh),n=t.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid,t.layer.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(C(this._resources))return;const t=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=oo(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?Br.None:Br.Back})}}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,ob)}slicePlaneEnabledChanged(){if(C(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(C(this._resources))return!0;const{stageResources:t,isWosr:i}=this._resources;for(const r of t.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!1}applyRendererDiff(t,i){if(C(this._resources))return lo.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!UP(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return lo.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return lo.Fast_Update}computeComplexity(){if(C(this._resources))return super.computeComplexity();const t=this._resources.lodResources,i=NCe(t.levels[0]).reduce((n,o)=>n+o.indices.get(R.POSITION).length,0)/3,r=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>{var l,c;return o+((c=(l=a.data.buffer)==null?void 0:l.byteLength)!=null?c:0)},0)+Array.from(n.indices.values()).reduce((o,a)=>o+(Array.isArray(a)?12*a.length:a.buffer.byteLength),0),s=kce(t).reduce((n,o)=>n+(o.params.encoding&&o.params.encoding==="image/ktx2"?o.estimatedTexMemRequired:o.estimatedTexMemRequired/4),0)+Uce(t).reduce((n,o)=>n+r(o),0);return{primitivesPerFeature:i,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...BCe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return v(this._resources)}_createAs3DShape(t,i,r,s,n,o){if(!this._hasLodRenderer()||C(this._resources))return null;const a=this.getFastUpdateAttrValues(t),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?tI(r.color,r.opacity):null,c=this._context.clippingExtent;if(Xa(i,e2,this._context.elevationProvider.spatialReference),v(c)&&!KZ(c,e2))return null;const h=this._requiresTerrainElevation(s),p=this._computeGlobalTransform(i,s,u7,fF),f=this._computeLocalTransform(this._resources,this.symbolLayer,r,mhe),m=this._resources.lodRenderer.instanceData,y=m.addInstance();this._instanceIndexToGraphicUid.set(y,n),m.setLocalTransform(y,f,!1),m.setGlobalTransform(y,p),a&&m.setFeatureAttribute(y,a),l&&m.setColor(y,l),v(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&m.setObjectAndLayerIdColor(y,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const _=new zpt(this,y,Ylt,s);return h&&(_.alignedSampledElevation=fF.sampledElevation),_.needsElevationUpdates=ob(s.mode),PP(_,i,this._context.elevationProvider),_}_computeGlobalTransform(t,i,r,s){return AM(t,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),e2[0]=t.x,e2[1]=t.y,e2[2]=s.z,Uf(t.spatialReference,e2,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(t,i,r,s){return np(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(t,r,s),this._applyAnchor(t,i,s),s}_applyObjectScale(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:t.symbolSize,n=Fce(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||oU(r,r,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const i=t.diff.diff;this._preparePatchTransform(t,i),this._preparePatchColor(t,i)}updateGeometry(t,i){if(C(this._resources))return!0;const r=i&&$P(i);if(C(r))return!1;const s=this.getGeometryElevationMode(i);return t.elevationContext.mode===s&&(this._computeGlobalTransform(r,t.elevationContext,u7,fF),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=fF.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,u7,!0),PP(t,r,this._context.elevationProvider),!0)}_preparePatchTransform(t,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||C(this._resources))return;const r=(y,_,b)=>Ft(y!=null&&y.type==="complete"?y.newValue:_,b),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===Th.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=Rc(h9(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((y,_)=>{const b=this._computeLocalTransform(m,f,_,mhe),w=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(w,b,!0)})}_preparePatchColor(t,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=v(s)?De.toUnitRGBA(s):jd;delete r.color;const o=this._resources;C(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return klt(t.heading,t.tilt,t.roll,r)}_computeAnchor(t,i,r){const s=O();switch(r.anchor){case"center":le(s,yf(t)),pl(s,s);break;case"top":{const n=yf(t);ue(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=yf(t);ue(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=yf(t),o=gL(t),a=r.anchorPosition,l=a?Le(a.x,a.y,a.z):dl;R6(s,o,l),fe(s,s,n),pl(s,s);break}default:v(i)?pl(s,i):le(s,dl)}return s}_applyAnchor(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,i);s&&Vc(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,i,r,s){const n=v(t)?Rc(gL(t)):sg,o=v(t)?this._computeAnchor(t,s,this.symbolLayer):dl,a=this._context.renderCoordsHelper.unitInMeters,l=Fce(v(i)?i:void 0,i,r,a),c=Le(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:v(i)?i:sg,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const e2=O(),mhe=Pe(),u7=Pe(),pF=ui(),fF=new H$;function rmt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function smt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function eY(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function nmt(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function omt(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*n-s*r;return o?(o=1/o,e[0]=n*o,e[1]=-r*o,e[2]=-s*o,e[3]=i*o,e):null}function amt(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function lmt(e){return e[0]*e[3]-e[2]*e[1]}function bMe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*a+n*l,e[1]=s*a+o*l,e[2]=r*c+n*h,e[3]=s*c+o*h,e}function cmt(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=s*l+o*a,e[2]=r*-a+n*l,e[3]=s*-a+o*l,e}function umt(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1];return e[0]=r*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function hmt(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function dmt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function pmt(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function fmt(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function mmt(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function gmt(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function wMe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function ymt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _mt(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3],h=vl();return Math.abs(i-o)<=h*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=h*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function vmt(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function bmt(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const wmt=bMe,xmt=wMe;Object.freeze(Object.defineProperty({__proto__:null,LDU:mmt,add:gmt,adjoint:amt,copy:rmt,determinant:lmt,equals:_mt,exactEquals:ymt,frob:fmt,fromRotation:hmt,fromScaling:dmt,identity:smt,invert:omt,mul:wmt,multiply:bMe,multiplyScalar:vmt,multiplyScalarAndAdd:bmt,rotate:cmt,scale:umt,set:eY,str:pmt,sub:xmt,subtract:wMe,transpose:nmt},Symbol.toStringTag,{value:"Module"}));class Tmt extends Rn{constructor(t,i,r,s,n,o,a,l){super(t,i,r,null,hn.Mesh,l),this.path=s,this.geometrySR=n,this.upVectorAlignment=o,this.stencilWidth=a}}var k1;function xMe(e){return"upVectorAlignment"in e}(function(e){e[e.World=0]="World",e[e.Path=1]="Path"})(k1||(k1={}));function TMe(){return[1,0,0,1]}function Smt(e){return[e[0],e[1],e[2],e[3]]}function Emt(e,t,i,r){return[e,t,i,r]}function Cmt(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Smt,create:TMe,createView:Cmt,fromValues:Emt},Symbol.toStringTag,{value:"Module"}));function SMe(){return{up:O(),right:O()}}function Amt(e,t,i){Ze(e.up,t.up,i),Ze(e.right,t.right,i)}function Mmt(e,t,i){di(e,_e(i,t.right),_e(i,t.up))}class Rmt{constructor(){this.pos=O(),this.posES=O(),this.vLeft=O(),this.vRight=O(),this.vMinSiblingLength=0,this.frame=SMe(),this.rotationFrameUp=O(),this.rotationRight=tt(),this.rotationAngle=0,this.miterStretch=TMe(),this.maxStretchDistance=0}setFrameFromUpVector(t){le(this.frame.up,t),fe(pE,this.vLeft,this.vRight),be(pE,pE),ae(tY,this.frame.up,_e(pE,this.frame.up)),me(gF,pE,tY),be(gF,gF),_t(this.frame.right,gF,this.frame.up)}}class EMe{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}addVertex(t,i){return this.vertices.push(PO(t)),this.vertexNormals.push(PO(i)),this.vertices.length-1}addPole(t,i=null){return this.poles.push({position:PO(t),normal:i?PO(i):null}),this.poles.length-1}addSegment(t,i=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}translate(t,i){for(const r of this.vertices)r[0]+=t,r[1]+=i;for(const r of this.poles)r.position[0]+=t,r.position[1]+=i}}function Omt(e=20){const i=new EMe,r={v0:0,v1:0};i.addPole(er(0,0));for(let n=0;n<e;++n){const o=2*n*Math.PI/e,a=Math.cos(o),l=Math.sin(o),c=er(a*.5,l*.5),h=er(a,l);i.addVertex(c,h)}for(let n=0;n<e-1;++n){const o={v0:n,v1:n+1};i.addSegment(o,r)}const s={v0:e-1,v1:0};return i.addSegment(s,r),i}function Imt(){const i=new EMe,r=er(.5*-1,.5*-1),s=er(.5*1,.5*-1),n=er(.5*1,.5*1),o=er(.5*-1,.5*1),a=er(0,-1),l=er(1,0),c=er(0,1),h=er(-1,0);return i.addPole(er(0,.5*1),c),i.addPole(er(0,.5*1)),i.addPole(er(0,.5*-1)),i.addPole(er(0,.5*-1),a),i.addVertex(r,a),i.addVertex(s,a),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(o,h),i.addVertex(r,h),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),i}class Pmt{constructor(t){this.vertices=t,this.offset=O(),this.xform=Pe();const i=Math.floor((t.length-1)/2);le(this.offset,this.vertices[i].pos);for(const r of this.vertices)me(r.pos,r.pos,this.offset);Vc(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length,i=this.vertices[0];i.index=0,i.vLeft=O(),me(i.vRight,this.vertices[1].pos,i.pos);let r=Oe(i.vRight);i.vMinSiblingLength=r,be(i.vRight,i.vRight);let s=i;for(let n=1;n<t;++n){const o=this.vertices[n];if(o.index=n,o.vLeft=s.vRight,n<t-1){me(o.vRight,this.vertices[n+1].pos,o.pos);const a=Oe(o.vRight);o.vMinSiblingLength=Math.min(r,a),r=a,be(o.vRight,o.vRight)}else le(o.vRight,o.vLeft),o.vMinSiblingLength=r;s=o}}}function $mt(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=O(),o=O(),a=O(),l=O(),c=O(),h=O(),p=nr();let f=e.vertices[0];le(o,t),ue(n,0,1,0),Sk(f.vRight,o,n,n,a,o,s),le(f.frame.up,o),le(f.frame.right,a),i=f;for(let m=1;m<r;++m){f=e.vertices[m],fe(c,f.vLeft,f.vRight);let y=Oe(c);y>0?(y=1/Math.sqrt(y),c[0]=c[0]*y,c[1]=c[1]*y,c[2]=c[2]*y):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),fe(h,i.pos,i.frame.up),A$(f.pos,c,p),nS(p,qh(h,f.vLeft),l)?(me(l,l,f.pos),be(o,l),_t(a,c,o),be(a,a)):Sk(c,i.frame.up,i.frame.right,n,a,o,s),le(f.frame.up,o),le(f.frame.right,a),i=f}}class Lmt{numProfilesPerJoin(){return 1}extrude(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],!1)}}class h7{constructor(t=.8*Math.PI,i=1){this.cutoffAngle=t,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,i,r){const s=Bmt;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){jh(_he,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrameUp),Amt(s,t.frame,_he);for(let o=0;o<i.vertices.length;++o)Kn(i.vertices[o],t.rotationRight)*t.rotationAngle>=0?r(t.index,s,i.vertices[o],i.vertexNormals[o],!1):(oX(Bx,i.vertices[o],t.miterStretch),r(t.index,t.frame,Bx,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=Kn(i.vertices[o],t.rotationRight)*t.rotationAngle>=0;oX(Bx,i.vertices[o],t.miterStretch),r(t.index,t.frame,Bx,i.vertexNormals[o],!a)}}}class lte{rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],0,0)}}class ghe extends lte{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class mF extends lte{constructor(t,i=0,r=!1){super(),this.profile=t,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,i){const r=cte;di(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(t.index,t.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(t,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}}class yhe extends lte{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,i){const r=t.frame,s=.5*this.sign,n=Bx,o=cte;di(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(t.index,r,l.position,l.normal,s,0):i(t.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(t.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];eg(n,this.profile.vertices[p],f.position),xu(n,n,c),f.normal?(lf(n,n,f.position),i(t.index,r,n,f.normal,s*h,0)):(rP(o,n),xu(o,o,c),lf(n,n,f.position),i(t.index,r,n,o,s*h,this.sign*h))}}}buildTopology(t,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,y=s+f*this.profile.vertices.length+a;this.flip?(i(m,p,h),i(p,m,y)):(i(h,p,m),i(y,m,p)),h=m,p=y}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}}class Dmt{constructor(t,i,r,s,n,o={}){this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=i,this.path=t,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=Cn(1*this.numVerticesTotal),this.profileRightAxisData=Cn(4*this.numVerticesTotal),this.profileUpAxisData=Cn(4*this.numVerticesTotal),this.profileVertexAndNormalData=Cn(4*this.numVerticesTotal),this.originData=Cn(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}_rebuildGeometry(){const t=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,t);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i)}buildTopology(){const t=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=3*(2*(i*r));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,p)=>{n.push(c),n.push(h),n.push(p),o.push(c),o.push(h),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[p])};for(let c=0;c<i;++c){const h=this.profile.vertexIndices[2*c],p=this.profile.vertexIndices[2*c+1];for(let f=0;f<r;++f){const m=f*t+h,y=(f+1)*t+p,_=f*t+p;l(m,(f+1)*t+h,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=bC(n),this.normalIndices=bC(o),this.pathVertexIndices=bC(a)}onPathChanged(){this._rebuildGeometry()}}class CMe{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class AMe extends CMe{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=Cn(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=Cn(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=Nmt;ue(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=tY,l=Bx,c=pE,h=Umt,p=Vmt;let f=0,m=0;if(ue(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),ue(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),di(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)_t(c,p,h),f=this.builder.profileRightAxisData[o+3]*t[0],m=this.builder.profileUpAxisData[o+3];else{const _=cte,b=kmt;di(_,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const w=fQ(_);rP(_,_);const T=Kn(l,_);if(Math.abs(T)>w){di(b,-_[1],_[0]);const S=Kn(l,b);xu(_,_,w*Math.sign(T)),xu(b,b,S),lf(l,_,b)}ue(c,0,0,0)}ue(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*f;const y=Bx;di(y,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*y[0]+p[0]*y[1]+c[0]*m,this.vertexAttributeNormal[3*i+1]=h[1]*y[0]+p[1]*y[1]+c[1]*m,this.vertexAttributeNormal[3*i+2]=h[2]*y[0]+p[2]*y[1]+c[2]*m}}createGeometryData(){const t=[[R.POSITION,this.builder.vertexIndices],[R.NORMAL,this.builder.normalIndices]],i=[[R.POSITION,new Ke(this.vertexAttributePosition,3,!0)],[R.NORMAL,new Ke(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;t.push([R.COLOR,new Array(r).fill(0)]),i.push([R.COLOR,new Ke(this.vertexAttributeColor,4)])}return{vertexAttributes:i,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,i,r){const s=this.builder.vertexIndices,n=new Ke(this.vertexAttributePosition,3),o=s.length/3;z$(t,i,0,o,s,n,void 0,void 0,r)}}class Fmt extends CMe{constructor(t,i,r,s){super(t),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new AMe(t),this.vvData=Cn(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[R.POSITION,new Ke(this.builder.originData,3,!0)],[R.PROFILERIGHT,new Ke(this.builder.profileRightAxisData,4,!0)],[R.PROFILEUP,new Ke(this.builder.profileUpAxisData,4,!0)],[R.PROFILEVERTEXANDNORMAL,new Ke(this.builder.profileVertexAndNormalData,4,!0)],[R.FEATUREVALUE,new Ke(this.vvData,4,!0)]],indices:[[R.POSITION,this.builder.pathVertexIndices],[R.PROFILERIGHT,this.builder.vertexIndices],[R.PROFILEUP,this.builder.vertexIndices],[R.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[R.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const Nmt=O(),Bx=tt(),cte=tt(),kmt=tt(),tY=O(),pE=O(),Umt=O(),Vmt=O(),gF=O(),Bmt=SMe(),_he=Pe(),d7=8;function zmt(e,t){const i=R.FEATUREVALUE;e.attributes.add(i,"vec4");const r=e.vertex;r.code.add(x`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new tr("size",s=>s.size)),t.vvSize?(r.uniforms.add(new Jt("vvSizeMinSize",s=>s.vvSizeMinSize)),r.uniforms.add(new Jt("vvSizeMaxSize",s=>s.vvSizeMaxSize)),r.uniforms.add(new Jt("vvSizeOffset",s=>s.vvSizeOffset)),r.uniforms.add(new Jt("vvSizeFactor",s=>s.vvSizeFactor)),r.code.add(x`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(x`vec2 getSize(){
return size;
}`),t.vvOpacity?(r.constants.add("vvOpacityNumber","int",d7),r.uniforms.add([new cl("vvOpacityValues",s=>s.vvOpacityValues,d7),new cl("vvOpacityOpacities",s=>s.vvOpacityOpacities,d7)]),r.code.add(x`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(x`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(r.constants.add("vvColorNumber","int",Pf),r.uniforms.add([new cl("vvColorValues",s=>s.vvColorValues,Pf),new I8("vvColorColors",s=>s.vvColorColors,Pf)]),r.code.add(x`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(x`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(F$),e.attributes.add(R.PROFILERIGHT,"vec4"),e.attributes.add(R.PROFILEUP,"vec4"),e.attributes.add(R.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(x`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(x`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(x`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(x`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class Gmt extends Oee{constructor(){super(...arguments),this.size=er(1,1)}}function jmt(e){const t=new Yi,{vertex:i,fragment:r}=t;switch(Pu(i,e),t.varyings.add("vpos","vec3"),t.include(zmt,e),e.output!==z.Color&&e.output!==z.Alpha||(t.include(Dc,e),t.include(zT,e),t.include(bM,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(x`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===z.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(Xh,e),e.output){case z.Alpha:t.include(An,e),r.uniforms.add(new Ie("opacity",s=>s.opacity)),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case z.Color:t.include(An,e),t.include(GT,e),t.include(J$,e),t.include(zT,e),t.include(FAe,e),zf(r,e),K$(r),RM(r),r.uniforms.add([i.uniforms.get("localOrigin"),new Jt("ambient",s=>s.ambient),new Jt("diffuse",s=>s.diffuse),new Jt("specular",s=>s.specular),new Ie("opacity",s=>s.opacity)]),r.include(zg),Bg(r),r.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case z.Depth:case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:t.include(Dc,e),RT(t),t.varyings.add("depth","float"),i.code.add(x`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(An,e),t.include(U0,e),r.code.add(x`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case z.Normal:t.include(Dc,e),t.include(FP,e),DA(i),t.varyings.add("vnormal","vec3"),i.code.add(x`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(An,e),r.code.add(x`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case z.Highlight:t.include(Dc,e),t.include(FP,e),t.varyings.add("vnormal","vec3"),i.code.add(x`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(An,e),t.include(i_,e),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const Hmt=Object.freeze(Object.defineProperty({__proto__:null,build:jmt},Symbol.toStringTag,{value:"Module"})),MMe=new Map([[R.POSITION,0],[R.PROFILERIGHT,1],[R.PROFILEUP,2],[R.PROFILEVERTEXANDNORMAL,3],[R.FEATUREVALUE,4]]);class qmt extends Gmt{constructor(){super(...arguments),this.ambient=Le(.2,.2,.2),this.diffuse=Le(.8,.8,.8),this.specular=Le(0,0,0),this.opacity=1}}class oV extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2,i.spherical=t.viewingMode===je.Global,i.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new Ji(t.rctx,oV.shader.get().build(this.configuration),MMe)}initializePipeline(){const t=this.configuration.transparencyPassType,i=this.configuration,r=t===Ct.NONE,s=t===Ct.FrontFace;return Ht({blending:i.output!==z.Color&&i.output!==z.Alpha||!i.transparent?null:r?Vh:r_(t),culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==Ds.None?sSe:null,depthTest:{func:vb(t)},depthWrite:r||s?zc:null,colorWrite:si,stencilWrite:i.hasOccludees?Lg:null,stencilTest:i.hasOccludees?bb:null,polygonOffset:r||s?null:L8})}}oV.shader=new Zi(Hmt,()=>Q(()=>import("./Path.glsl.e29e1680.js"),[]));class No extends qo{constructor(){super(...arguments),this.output=z.Color,this.doubleSidedMode=Ds.None,this.transparencyPassType=Ct.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([j({count:z.COUNT})],No.prototype,"output",void 0),u([j({count:Ds.COUNT})],No.prototype,"doubleSidedMode",void 0),u([j({count:Ct.COUNT})],No.prototype,"transparencyPassType",void 0),u([j()],No.prototype,"spherical",void 0),u([j()],No.prototype,"receiveShadows",void 0),u([j()],No.prototype,"receiveAmbientOcclusion",void 0),u([j()],No.prototype,"vvSize",void 0),u([j()],No.prototype,"vvColor",void 0),u([j()],No.prototype,"vvOpacity",void 0),u([j()],No.prototype,"hasSlicePlane",void 0),u([j()],No.prototype,"transparent",void 0),u([j()],No.prototype,"hasOccludees",void 0),u([j()],No.prototype,"hasMultipassTerrain",void 0),u([j()],No.prototype,"cullAboveGround",void 0),u([j()],No.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j({constValue:gt.Disabled})],No.prototype,"pbrMode",void 0),u([j({constValue:!0})],No.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],No.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],No.prototype,"useFillLights",void 0);class ute extends _b{constructor(t){super(t,new Xmt),this.supportsEdges=!0,this._vertexAttributeLocations=MMe,this._configuration=new No,this._vertexBufferLayout=ute.getVertexBufferLayout()}getConfiguration(t,i){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==z.Color&&t!==z.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Ds.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Ds.WindingOrder:Ds.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(t){return t!==z.Shadow&&t!==z.ShadowExcludeHighlight&&t!==z.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(t,i,r,s,n,o){const a=t;if(!xMe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,w=this.parameters.vvSizeFactor,T=this.parameters.vvSizeMinSize,S=this.parameters.vvSizeMaxSize,E=l.sizeAttributeValue;c[0]*=ye(b[0]+E*w[0],T[0],S[0]),c[1]*=ye(b[2]+E*w[2],T[2],S[2])}const h=Math.max(c[0],c[1]),p=t.boundingInfo;if(C(p))return void this._intersectTriangles(l,c,s,n,o);const f=dT(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),m=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];xee(f,s,_,r.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(t,i,r,s,n){t.baked.size&&t.baked.size[0]===i[0]&&t.baked.size[1]===i[1]||t.baked.bake(i),t.baked.intersect(r,s,n)}createBufferWriter(){return new MM(this._vertexBufferLayout)}requiresSlot(t,i){switch(i){case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case z.Color:case z.Alpha:case z.Depth:case z.Normal:case z.Highlight:case z.ObjectAndLayerIdColor:return t===(this.parameters.transparent?Ee.TRANSPARENT_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL;default:return!1}}createGLMaterial(t){return new Wmt(t)}static getVertexBufferLayout(){return As().vec3f(R.POSITION).vec4f(R.PROFILERIGHT).vec4f(R.PROFILEUP).vec4f(R.PROFILEVERTEXANDNORMAL).vec4f(R.FEATUREVALUE)}}class Wmt extends yb{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(C(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==z.Color&&this._output!==z.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(oV,t)}}class Xmt extends qmt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}const Ymt=["polyline"];class Zmt extends Hg{constructor(t,i,r,s){super(t,i,r,s),this._intrinsicSize=er(1,1),this._upVectorAlignment=k1.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=v(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=v(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=kP(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?k1.World:k1.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=Omt(DCe);break;case"quad":this._profile=Imt()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join){case"round":this._extruder=new h7(0,LCe);break;case"bevel":this._extruder=new h7(0,1);break;case"miter":this._extruder=new h7(.8*Math.PI,1);break;default:this._extruder=new Lmt}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new ghe,this._endCap=new ghe;break;case"butt":default:this._startCap=new mF(this._profile,0),this._endCap=new mF(this._profile,0,!0);break;case"square":this._startCap=new mF(this._profile,-.5),this._endCap=new mF(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new yhe({profile:this._profile,flip:!1,breakNormals:m,subdivisions:VX}),this._endCap=new yhe({profile:this._profile,flip:!0,breakNormals:m,subdivisions:VX});break}}const a=oo(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=Rc(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?Br.None:Br.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(di(this._intrinsicSize,t,i),!Hk(this._intrinsicSize[0])||!Hk(this._intrinsicSize[1])))throw new H("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||xu(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m={...f,...this._fastUpdates.materialParameters,size:lbe(this._intrinsicSize)};this._material=new ute(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new V0(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Ymt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Zh),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const t=oo(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,ob)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!UP(this._fastUpdates,i,this._vvConvertOptions))return lo.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return lo.Fast_Update}_getVertexData(t){let i=0;const r=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const f of r)i+=f.length;const l=Du(3*i),c=Du(3*i);let h=0;for(const f of r){s.push({index:h,numVertices:f.length});for(const m of f)l[h++]=m[0],l[h++]=m[1],l[h++]=t.hasZ?m[2]:0}let p=!0;return v(o)&&!n.equals(o)&&(p=Xs(l,n,0,l,o,0,i)),v(o)&&!o.equals(a)?Xs(l,o,0,c,a,0,i):this._copyVertices(l,0,c,0,i),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c,projectionSuccess:p,terrainElevation:0}}_copyVertices(t,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=t[i++],r[s++]=t[i++],r[s++]=t[i++]}_createAs3DShape(t,i,r,s){const n=t.geometry,o=new Array,a=n.spatialReference,l=ho(),c=this._context.renderCoordsHelper;OMe.spatialReference=a;const h=this._getVertexData(n);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(h.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(y=>y.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const y of h.pathVertexDataInfos){const _=y.index,b=y.numVertices;if(b<2||v(this._context.clippingExtent)&&(Xr(l),Lh(l,h.vertexDataES,3*_,b),!_f(l,this._context.clippingExtent)))continue;const w=[];for(let k=_;k<_+3*b;){const V=k++,B=k++,G=k++,X=new Rmt;ue(X.posES,h.vertexDataES[V],h.vertexDataES[B],h.vertexDataES[G]);const K=Ult(X.posES,this._context.elevationProvider,r,c);ue(ss,h.vertexDataRS[V],h.vertexDataRS[B],h.vertexDataRS[G]),c.setAltitude(ss,K),le(X.pos,ss),w.push(X)}const T=new Pmt(w);RMe(T,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new Dmt(T,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const k=this._fastUpdates.visualVariables,V=k.size?w0(k.size.field,t):0,B=k.color?w0(k.color.field,t):0,G=k.opacity?w0(k.opacity.field,t):0;E=new Fmt(S,V,B,G)}else{const k=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const G=i.size;k[0]*=vhe(G[0],G[2]==="symbol-value"?this.symbolLayer.height||0:G[2],this.symbolLayer.width||0),k[1]*=vhe(G[2],G[0]==="symbol-value"?this.symbolLayer.width||0:G[0],this.symbolLayer.height||0)}let V;this._drivenProperties.color&&(V=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(V=V?[V[0],V[1],V[2],i.opacity]:[1,1,1,i.opacity]);const B=new AMe(S);B.bake(k),V&&B.bakeVertexColors(V),E=B}const{vertexAttributes:M,indices:A}=E.createGeometryData(),$=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),I=new Tmt(this._material,M,A,E,a,this._upVectorAlignment,this._stencilWidth,$);I.transformation=E.xform,o.push(I)}if(o.length===0)return null;const p={layerUid:this._context.layer.uid,graphicUid:s},f=new n_({geometries:o,metadata:p}),m=new jg(this,f,o,null,null,Kmt,r);return m.alignedSampledElevation=h.terrainElevation,m.needsElevationUpdates=ob(r.mode),m}}function RMe(e,t,i){switch(t){default:case k1.World:for(const r of e.vertices){fe(ss,r.pos,e.offset),i.worldUpAtPosition(ss,ss),r.setFrameFromUpVector(ss),r.rotationFrameUp=r.frame.up,di(r.rotationRight,1,0),ae(ss,r.frame.up,_e(r.frame.up,r.vLeft)),me(ss,r.vLeft,ss),pl(ss,ss),be(ss,ss),ae(F_,r.frame.up,_e(r.frame.up,r.vRight)),me(F_,r.vRight,F_),be(F_,F_),_t(bhe,r.rotationFrameUp,r.vLeft);const s=Math.sign(_e(bhe,r.vRight));if(r.rotationAngle=s*(Math.PI-uo(_e(ss,F_))),Math.abs(r.rotationAngle)>0){const o=WV(Math.cos(.5*r.rotationAngle));eY(r.miterStretch,o-1+1,0,0,1)}const n=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength/Math.cos(.5*n))}break;case k1.Path:fe(ss,e.vertices[0].pos,e.offset),i.worldUpAtPosition(ss,ss),$mt(e,ss);for(const r of e.vertices){const s=Math.sign(_e(r.frame.right,r.vRight));_t(r.rotationFrameUp,r.vRight,r.vLeft),ae(r.rotationFrameUp,r.rotationFrameUp,s),be(r.rotationFrameUp,r.rotationFrameUp);const n=_e(r.rotationFrameUp,r.frame.up),o=_e(r.rotationFrameUp,r.frame.right);if(ae(ss,r.frame.up,-o),ae(F_,r.frame.right,n),fe(ss,ss,F_),be(ss,ss),Mmt(r.rotationRight,r.frame,ss),pl(ss,r.vLeft),r.rotationAngle=-s*(Math.PI-uo(_e(ss,r.vRight))),Math.abs(r.rotationAngle)>0){const l=WV(Math.cos(.5*r.rotationAngle));eY(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength*WV(Math.cos(.5*a)))}}}function vhe(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function Jmt(e,t,i,r){let s=0;for(const n of e.vertices)i(n.posES,p7),s+=p7.sampledElevation,fe(ss,n.pos,e.offset),r.setAltitude(ss,p7.z),me(n.pos,ss,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function Kmt(e,t,i,r,s){const n=e.stageObject,o=n.geometries;let a=0;Qmt.spatialReference=s.spatialReference;for(const l of o){if(!xMe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;OMe.spatialReference=p,a+=Jmt(h,t,r,s),l.upVectorAlignment!==k1.World&&RMe(h,l.upVectorAlignment,s),c.onPathChanged(),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const Qmt=s_(0,0,0,null),OMe=s_(0,0,0,null),ss=O(),F_=O(),bhe=O(),p7=new H$;function egt(e,t,i,r,s=1){if(i.isGeographic&&r===je.Global){const c=Du(t.length),h=t.length,p=dr(i);for(let f=0;f<h;f+=3)hK(t,f,c,f,p);t=c}di(eo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<t.length;c+=3)eo[0]=Math.min(eo[0],t[c]),eo[1]=Math.min(eo[1],t[c+1]);const n=eo[0]%s,o=eo[1]%s,a=eo[0]-n,l=eo[1]-o;for(let c=0;c<t.length;c+=3){const h=c/3*4;e[h]=(t[c]-a)/s,e[h+1]=(t[c+1]-l)/s,e[h+2]=a/s,e[h+3]=l/s}}function IMe(e,t,i,r,s=1){ue(Jb,1,0,0),ue(Kb,0,1,0),ue(i2,0,0,1),rgt(f7,i),tgt(i,whe)&&igt(whe,Jb,Kb,i2,r,f7),di(eo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),di(Qb,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<i.length;h+=3){ue(t2,i[h],i[h+1],i[h+2]);const p=_e(Jb,t2),f=_e(Kb,t2);eo[0]=Math.min(eo[0],p),eo[1]=Math.min(eo[1],f),Qb[0]=Math.max(Qb[0],p),Qb[1]=Math.max(Qb[1],f)}const n=_e(i2,f7);g7(N_,eo[0],eo[1],n,Jb,Kb,i2),g7(ew,Qb[0],eo[1],n,Jb,Kb,i2),g7(tw,eo[0],Qb[1],n,Jb,Kb,i2),me(ew,ew,N_),ae(ew,ew,.5),me(tw,tw,N_),ae(tw,tw,.5),fe(N_,N_,ew),fe(N_,N_,tw);const o=eo[0]%s,a=eo[1]%s,l=eo[0]-o,c=eo[1]-a;for(let h=0;h<i.length;h+=3){ue(t2,i[h],i[h+1],i[h+2]);const p=h/3,f=4*p;e[f]=(_e(Jb,t2)-l)/s,e[f+1]=(_e(Kb,t2)-c)/s,e[f+2]=l/s,e[f+3]=c/s;const m=9*p;for(let y=0;y<3;y++)t[m+y]=N_[y],t[m+y+3]=ew[y],t[m+y+6]=tw[y]}}const f7=O(),t2=O(),whe=nr(),Jb=O(),Kb=O(),i2=O(),eo=tt(),Qb=tt(),N_=O(),ew=O(),tw=O();function tgt(e,t){const i=e.length/3-1;return Mbe(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function igt(e,t,i,r,s,n){v(s)?(s.basisMatrixAtPosition(n,um),ue(yF,um[0],um[1],um[2]),ue(_F,um[4],um[5],um[6]),ue(m7,um[8],um[9],um[10])):(ue(yF,1,0,0),ue(_F,0,1,0),ue(m7,0,0,1));const o=e;_e(o,m7)<0&&ae(o,o,-1),le(r,o);const a=_e(o,_F),l=_e(o,yF);Math.abs(a)<Math.abs(l)?(Rx(t,yF,o,-l),be(t,t),_t(i,t,o),be(i,i),ae(i,i,-1)):(Rx(i,_F,o,-a),be(i,i),_t(t,i,o),be(t,t))}const um=Pe(),yF=O(),_F=O(),m7=O();function rgt(e,t){ue(TR,0,0,0);for(let i=0;i<t.length-3;i+=3)TR[0]+=t[i],TR[1]+=t[i+1],TR[2]+=t[i+2];ae(e,TR,1/(t.length/3-1))}const TR=O();function g7(e,t,i,r,s,n,o){ue(e,t*s[0]+i*n[0]+r*o[0],t*s[1]+i*n[1]+r*o[1],t*s[2]+i*n[2]+r*o[2])}function sgt(e){const t=new Yi,{vertex:i,fragment:r}=t,s=e.output===z.Depth,n=e.hasMultipassTerrain&&(e.output===z.Color||e.output===z.Alpha);return Pu(i,e),t.include(Dc,e),t.include(hS,e),t.include(O8,e),t.attributes.add(R.POSITION,"vec3"),t.varyings.add("vpos","vec3"),n&&t.varyings.add("depth","float"),s&&(t.include(U0,e),RT(t),Q1(t)),i.code.add(x`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${n?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${s?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(An,e),n&&t.include(Xh,e),r.include(zg),r.uniforms.add(new xi("eColor",o=>o.color)),e.output===z.Highlight&&t.include(i_,e),r.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${e.output===z.ObjectAndLayerIdColor?x`fColor.a = 1.0;`:""}

    if (fColor.a < ${x.float(qa)}) {
      discard;
    }

    ${e.output===z.Alpha?x`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===z.Color?x`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===z.Highlight?x`outputHighlight();`:""};
    ${e.output===z.Depth?x`outputDepth(linearDepth);`:""};
    ${e.output===z.ObjectAndLayerIdColor?x`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const ngt=Object.freeze(Object.defineProperty({__proto__:null,build:sgt},Symbol.toStringTag,{value:"Module"}));class aV extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2}initializeProgram(t){return new Ji(t.rctx,aV.shader.get().build(this.configuration),ji)}_createPipeline(t,i){const r=this.configuration,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:r.output!==z.Color&&r.output!==z.Alpha||!r.transparent?null:s?Vh:r_(t),culling:n8(r.cullFace),depthTest:{func:vb(t)},depthWrite:(s||n)&&r.writeDepth?zc:null,colorWrite:si,stencilWrite:r.hasOccludees?Lg:null,stencilTest:r.hasOccludees?i?cb:bb:null,polygonOffset:s||n?r.polygonOffset?ogt:null:D8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}aV.shader=new Zi(ngt,()=>Q(()=>import("./ColorMaterial.glsl.201bddc7.js"),[]));const ogt={factor:1,units:1};class au extends qo{constructor(){super(...arguments),this.output=z.Color,this.cullFace=Br.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Ct.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}}u([j({count:z.COUNT})],au.prototype,"output",void 0),u([j({count:Br.COUNT})],au.prototype,"cullFace",void 0),u([j()],au.prototype,"hasSlicePlane",void 0),u([j()],au.prototype,"hasVertexColors",void 0),u([j()],au.prototype,"transparent",void 0),u([j()],au.prototype,"polygonOffset",void 0),u([j()],au.prototype,"enableOffset",void 0),u([j()],au.prototype,"writeDepth",void 0),u([j()],au.prototype,"hasOccludees",void 0),u([j({count:Ct.COUNT})],au.prototype,"transparencyPassType",void 0),u([j()],au.prototype,"hasMultipassTerrain",void 0),u([j()],au.prototype,"cullAboveGround",void 0),u([j()],au.prototype,"objectAndLayerIdColorInstanced",void 0);class xhe extends Zee{constructor(t){super(t,new lgt),this.supportsEdges=!0,this._configuration=new au}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<$8,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(t,i){return i===z.Color||i===z.Alpha||i===z.Highlight||i===z.Depth&&this.parameters.writeLinearDepth||i===z.ObjectAndLayerIdColor?t===Ee.DRAPED_MATERIAL?!0:i===z.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL):!1}createGLMaterial(t){return new agt(t)}createBufferWriter(){return new MM(he("enable-feature:objectAndLayerId-rendering")?Yut:xAe)}}class agt extends yb{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==z.Color&&this._output!==z.Alpha||this._updateOccludeeState(t),this.ensureTechnique(aV,t)}}class lgt extends CM{constructor(){super(...arguments),this.color=pg,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Br.None,this.hasOccludees=!1}}var xa;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(xa||(xa={}));const iY=.70710678118,The=iY,cgt=.08715574274;function ugt(e){const t=new Yi,i=e.hasMultipassTerrain&&(e.output===z.Color||e.output===z.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const{vertex:r,fragment:s}=t;Pu(r,e),t.include(Dc,e),t.include(hS,e),e.draped?r.uniforms.add(new Ie("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(R.BOUNDINGRECT,"mat3"),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i&&t.varyings.add("depth","float");const n=e.style===xa.ForwardDiagonal||e.style===xa.BackwardDiagonal||e.style===xa.DiagonalCross;n&&r.code.add(x`
      const mat2 rotate45 = mat2(${x.float(iY)}, ${x.float(-The)},
                                 ${x.float(The)}, ${x.float(iY)});
    `),e.draped||(zf(r,e),r.uniforms.add(new Ie("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),r.code.add(x`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(x`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(x`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${x.float(cgt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(x`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${n?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${n?" * rotate45":""};

      ${e.draped?"":x`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${x.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=e.output===z.Depth;return o&&(t.include(U0,e),RT(t),Q1(t)),r.code.add(x`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(An,e),s.include(zg),e.draped&&s.uniforms.add(new Ie("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===z.Highlight&&t.include(i_,e),i&&t.include(Xh,e),e.output!==z.Highlight&&(s.code.add(x`
      const float lineWidth = ${x.float(e.lineWidth)};
      const float spacing = ${x.float(e.patternSpacing)};
      const float spacingINV = ${x.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||s.code.add(x`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.uniforms.add(new xi("uColor",a=>a.color)),s.code.add(x`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==z.Highlight?x`color.a *= ${hgt(e)};`:""}

      ${e.output===z.ObjectAndLayerIdColor?x`color.a = 1.0;`:""}

      if (color.a < ${x.float(qa)}) {
        discard;
      }

      ${e.output===z.Alpha?x`gl_FragColor = vec4(color.a);`:""}

      ${e.output===z.Color?x`gl_FragColor = color; ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===z.Highlight?x`outputHighlight();`:""}
      ${e.output===z.Depth?x`outputDepth(linearDepth);`:""};
    }
  `),t}function hgt(e){function t(i){return e.draped?x`coverage(vuv.${i}, texelSize)`:x`sample(vuv.${i})`}switch(e.style){case xa.ForwardDiagonal:case xa.Horizontal:return t("y");case xa.BackwardDiagonal:case xa.Vertical:return t("x");case xa.DiagonalCross:case xa.Cross:return x`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const dgt=Object.freeze(Object.defineProperty({__proto__:null,build:ugt},Symbol.toStringTag,{value:"Module"}));class lV extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2}initializeProgram(t){return new Ji(t.rctx,lV.shader.get().build(this.configuration),PMe)}_setPipelineState(t,i){const r=this.configuration,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:r.output===z.Color||r.output===z.Alpha?s?Vh:r_(t):null,culling:n8(r.cullFace),depthTest:{func:vb(t)},depthWrite:s?r.writeDepth?zc:null:P8(t),colorWrite:si,stencilWrite:r.hasOccludees?Lg:null,stencilTest:r.hasOccludees?i?cb:bb:null,polygonOffset:s||n?r.polygonOffset?pgt:null:D8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}lV.shader=new Zi(dgt,()=>Q(()=>import("./Pattern.glsl.4ac3ec70.js"),[]));const pgt={factor:1,units:1};class kl extends qo{constructor(){super(...arguments),this.output=z.Color,this.cullFace=Br.None,this.transparencyPassType=Ct.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:z.COUNT})],kl.prototype,"output",void 0),u([j({count:Br.COUNT})],kl.prototype,"cullFace",void 0),u([j({count:xa.COUNT})],kl.prototype,"style",void 0),u([j({count:Ct.COUNT})],kl.prototype,"transparencyPassType",void 0),u([j()],kl.prototype,"hasSlicePlane",void 0),u([j()],kl.prototype,"hasVertexColors",void 0),u([j()],kl.prototype,"polygonOffset",void 0),u([j()],kl.prototype,"writeDepth",void 0),u([j()],kl.prototype,"hasOccludees",void 0),u([j()],kl.prototype,"patternSpacing",void 0),u([j()],kl.prototype,"lineWidth",void 0),u([j()],kl.prototype,"enableOffset",void 0),u([j()],kl.prototype,"draped",void 0),u([j()],kl.prototype,"hasMultipassTerrain",void 0),u([j()],kl.prototype,"cullAboveGround",void 0);const PMe=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.BOUNDINGRECT,5]]);class hte extends Zee{constructor(t){super(t,new ggt),this.supportsEdges=!0,this._vertexAttributeLocations=PMe,this._configuration=new kl}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<$8,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(t,i){return i===z.Color||i===z.Alpha||i===z.Highlight||i===z.Depth&&this.parameters.writeLinearDepth?t===Ee.DRAPED_MATERIAL?!0:i===z.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(t){return new fgt(t)}createBufferWriter(){const t=As().vec3f(R.POSITION).vec4u8(R.COLOR).vec4f(R.UVMAPSPACE);return this.parameters.draped||t.mat3f(R.BOUNDINGRECT),new mgt(t)}}class fgt extends yb{_updateParameters(t){return this.ensureTechnique(lV,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==z.Color&&this._output!==z.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class mgt extends MM{write(t,i,r,s,n){for(const o of this.vertexBufferLayout.fieldNames){const a=r.vertexAttributes.get(o),l=r.indices.get(o);if(a&&l)switch(o){case R.POSITION:{vt(a.size===3);const c=s.getField(o,Mr);c&&R8(l,a.data,t,c,n);break}case R.COLOR:{vt(a.size===3||a.size===4);const c=s.getField(o,ta);c&&Eee(l,a.data,a.size,c,n);break}case R.UVMAPSPACE:{vt(a.size===4);const c=s.getField(o,_l);c&&FA(l,a.data,c,n);break}case R.BOUNDINGRECT:{vt(a.size===9);const c=s.getField(o,Bf);c&&this.writeBoundingRect(l,a.data,t,c,n);break}}}}writeBoundingRect(t,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],f=i[p],m=i[p+1],y=i[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let _=3;_<9;++_)a[n+_]=i[p+_];n+=l}}}class ggt extends CM{constructor(){super(...arguments),this.color=Yt(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Br.None,this.hasOccludees=!1,this.style=xa.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function ygt(e,t,i){return vgt(_gt(e),t,i)}function _gt(e){return e&&e.pattern||null}function vgt(e,t,i){return v(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=Yt(0,0,0,0),t.transparent=!0),new xhe(t)):(t.style=bgt(e.style),t.draped=i.isDraped,new hte(t)):new xhe(t)}function bgt(e){switch(e){case"horizontal":return xa.Horizontal;case"vertical":return xa.Vertical;case"cross":return xa.Cross;case"forward-diagonal":return xa.ForwardDiagonal;case"backward-diagonal":return xa.BackwardDiagonal;case"diagonal-cross":return xa.DiagonalCross;default:return}}function wgt(e){return e.material instanceof hte&&!e.material.parameters.draped}function xgt(e,t){if(wgt(e)){const i=e.vertexAttributes.get(R.POSITION).data,r=e.getMutableAttribute(R.UVMAPSPACE).data,s=e.getMutableAttribute(R.BOUNDINGRECT).data;IMe(r,s,i,t)}}function Tgt(e,t,i,r,s){const n=ACe(e,t,i,r,s),o=e.stageObject.geometries;for(const a of o)xgt(a,s);return n}const Sgt=["polyline","polygon","extent"];class cV extends Hg{constructor(t,i,r,s){super(t,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(v(this._material))return;const t=oo(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._material=ygt(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof hte,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(v(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const i=r=>{const s=QAe(t.pattern);return new WE({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:YX(t.patternCap||"butt")})};this._outlineMaterial=i($r(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return v(t)&&t.size!=null&&t.size>0&&v(t.color)&&(C(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Sgt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Zh);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(v(this._material)){const t=this._material.parameters.color,i=oo(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(v(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j$(cV.elevationModeChangeTypes,r,s);if(n!==qs.UPDATE)return n;const o=pp(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){if(v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),v(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(t,i,r){var h;const s=LP(t.geometry);if(C(s))return null;const n=ite(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new Egt(n,i,this._context.layer.uid,t.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Cn(4*a,!0),o.boundingRect=Du(9*a,!0),IMe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new n_({geometries:o.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),c=new jg(this,l,o.outGeometries,null,null,Tgt,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=pp(r.mode),c}_createAs3DShapeFill(t){const i=t.renderData.polygons;for(const{position:r,mapPositions:s,holeIndices:n,index:o,count:a}of i){if(v(this._context.clippingExtent)&&(Xr(nd),Lh(nd,s),!_f(nd,this._context.clippingExtent)))continue;const l=ab(s,n,3);if(l.length===0)continue;const c=eue({material:this._material,indices:l,mapPositions:s,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?Yae(t.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?Jd(t.boundingRect,9*o,9*a):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(c)}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPositions:s,position:n}=i[r];if(v(this._context.clippingExtent)&&(Xr(nd),Lh(nd,s),!_f(nd,this._context.clippingExtent)))continue;const o=ZX(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},t.objectAndLayerIdColor),a=o.vertexAttributes.get(R.POSITION);a.data===n&&(a.data=xet(n)),t.outGeometries.push(o)}}_createAsOverlay(t,i){var a;const r=LP(t.geometry);if(C(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,v(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=PAe(r,this._context.overlaySR),n=new Cgt(s,i,this._context.layer.uid,t.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Cn(4*o,!0),egt(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Xr(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new J8(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(t){const i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){const a=Xr(nd);if(Lh(a,r),!_f(a,this._context.clippingExtent))continue;const l=ab(r,s,3);if(l.length===0)continue;JC(t.outBoundingBox,a);const c=eue({material:this._material,indices:l,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?Yae(t.uvMapSpace,4*n,4*o):null,objectAndLayerIdColor:t.objectAndLayerIdColor}}),h=new BA(c,t);mr(h.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(h)}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(Xr(nd),Lh(nd,s),!_f(nd,this._context.clippingExtent))continue;JC(t.outBoundingBox,nd);const n=ZX(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},t.objectAndLayerIdColor),o=new BA(n,t),a=nd;mr(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o)}}_getOutlineOpacity(){const t=oo(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(v(t)?t.a:0)}_getOutlineColor(){const t=oo(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return tI(v(t)?De.toUnitRGB(t):null,i)}test(){return{...super.test(),createAsOverlay:(t,i)=>this._createAsOverlay(t,i),createAs3DShape:(t,i,r)=>this._createAs3DShape(t,i,r)}}}cV.elevationModeChangeTypes={definedChanged:qs.RECREATE,staysOnTheGround:qs.NONE,onTheGroundChanged:qs.RECREATE};const nd=ho();class Egt extends z8{constructor(t,i,r,s){super(t,r,s),this.color=i}}class Cgt extends z8{constructor(t,i,r,s){super(t,r,s),this.color=i}}class uV{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const i=this.definition.font;return`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()},${t[3]})`}static async fromSymbol(t,i){const r=oo(t,"material","color"),s=Sh(r,pg,De.toUnitRGBA),n=Sh(t.size,12,$r),o=t.lineHeight,a=v(t.background)?De.toUnitRGBA(t.background.color):pg,l={family:Sh(t.font,"sans-serif",m=>m.family),decoration:Sh(t.font,"none",m=>m.decoration),weight:Sh(t.font,"normal",m=>m.weight),style:Sh(t.font,"normal",m=>m.style)},c=t.halo,h=v(c)&&v(c.color)&&c.size>0?{size:$r(c.size),color:De.toUnitRGBA(c.color)}:{size:0,color:pg},p=new uV({color:s,size:n,background:{color:a,padding:v(t.background)?[.65*n,.5*n]:[0,0],borderRadius:v(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=p.fontString(n);try{await document.fonts.load(f)}catch{se.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class Agt{constructor(t,i,r){this._renderer=new qAe(t,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=WX(Mgt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new If(t,{wrap:{s:Pt.CLAMP_TO_EDGE,t:Pt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:$1.PAD})}}const Mgt={canvas:null},Rgt=[0,0,1];class Ogt extends Hg{constructor(t,i,r,s){super(t,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=N8(this.symbolLayer.size);if(t)throw new H("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await uV.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const i=t.graphic,r=$P(i.geometry);if(C(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(C(s)||s==="")return null;const n=_J(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(v(n)&&!g0e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new SCe(n,this.symbolLayer.horizontalAlignment,Mdt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(i,r,s,o)}createLabel(t,i,r,s){const n=t.graphic,o=$P(n.geometry);if(C(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,i){return She(t,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),qs.UPDATE}slicePlaneEnabledChanged(t,i){return She(t,i,r=>{for(const s of r.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}skipHighSymbolLodsChanged(){return!0}updateGraphicElevationContext(t,i){const r=i.elevationContext;this.setGraphicElevationContext(t,r,v(i.metadata)?i.metadata.elevationOffset:0),i.needsElevationUpdates=pp(r.mode)||r.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Pgt}_createAs3DShape(t,i,r,s,n,o){const a=this.setGraphicElevationContext(t,new Zh,s.elevationOffset),l=oo(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(C(o)){const I=XAe(s.horizontalPlacement);h=new Agt(r,I,this._textRenderParameters);let k=null;if(v(this._context.sharedResources.textures)){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{v(k)&&k.release()});const V=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(C(V)||Yh(V))return p.release(),null;k=V}}const f=Igt(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(v(o)?m.textureId=o.id:v(p)&&(m.textureId=p.texture.id),v(s.verticalOffset)){const{screenLength:I,minWorldLength:k,maxWorldLength:V}=s.verticalOffset;m.verticalOffset={screenLength:$r(I),minWorldLength:k||0,maxWorldLength:v(V)?V:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:I,screenSizePerspectiveSettingsLabels:k}=this._context.sharedResources;m.screenSizePerspective=k.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=I}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,v(n)){const I=JSON.stringify(m);y=n.get(I),C(y)&&(y=new NA(m),n.add(I,y))}else y=new NA(m);const _=s.translation,b=v(h)?er(h.displayWidth,h.displayHeight):Bc,w=s.centerOffset,T=_X(y,Rgt,_,null,b,w,[0,0],null),S=Bee(this._context,i,T,a,c);if(C(S))return null;const E=new jg(this,S.object,[T],C(n)?[y]:null,p,IP,a);E.alignedSampledElevation=S.sampledElevation,E.needsElevationUpdates=pp(a.mode)||a.mode==="absolute-height";const{displayWidth:M,displayHeight:A}=v(h)?h:s;E.getScreenSize=(I=tt())=>(I[0]=M,I[1]=A,I);const $=new $Ce(s.elevationOffset,r);return E.metadata=$,PP(E,i,this._context.elevationProvider),E}}function She(e,t,i){e&&e.forEach(r=>{const s=t(r);v(s)&&i(s,r.graphic)})}function Igt(e,t){if(t.verticalPlacement==="baseline"){const r=Edt[t.horizontalPlacement],s=v(e)?e.baselineAnchorY:0;return er(r,s)}const i=Adt(t.horizontalPlacement,t.verticalPlacement);return O4[i]}const Pgt={mode:"relative-to-ground",offset:0},$gt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Lgt=["polyline","polygon","extent"];class Zm extends Hg{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Lgt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Zh);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(v(this._material))return;const t=new AAe,i=this.symbolLayer.color;v(i)&&(t.color=De.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],r],t.transparent=r<1||this.needsDrivenTransparentPass,t.waveDirection=v(this.symbolLayer.waveDirection)?Zm.headingVectorFromAngle(this.symbolLayer.waveDirection):er(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=$gt[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new CAe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(C(this._material))return;const t=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:r})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=j$(Zm.elevationModeChangeTypes,r,s);if(n!==qs.UPDATE)return n;const o=pp(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(t,i,r){const s=LP(t.geometry);if(C(s))return null;const n=ite(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=n.position.length/3,a=Du(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new Dgt(n,a);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new n_({geometries:l.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),h=new jg(this,c,l.outGeometries,null,null,ACe,i);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=pp(i.mode),h}_createUVCoordsFromVertices(t,i,r,s){const n=wl(s);rp(k_);for(let l=0;l<r;l++)di(Ehe,i[3*l],i[3*l+1]),ZZ(k_,Ehe);YA(k_,k_,n);const o=k_[0]%Zm.unitSizeOfTexture,a=k_[1]%Zm.unitSizeOfTexture;vF[0]=k_[0]-o,vF[1]=k_[1]-a;for(let l=0;l<r;l++)t[2*l]=(i[3*l]*n-vF[0])/Zm.unitSizeOfTexture,t[2*l+1]=(i[3*l+1]*n-vF[1])/Zm.unitSizeOfTexture}_create3DShapeGeometries(t){const i=t.renderData.polygons,r=t.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of i){if(v(this._context.clippingExtent)&&(Xr(U_),Lh(U_,a),!_f(U_,this._context.clippingExtent)))continue;const c=ab(a,l,3);if(c.length===0)continue;const h=Jd(r,2*n,2*s),p=tue({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}});t.outGeometries.push(p)}}_createAsOverlay(t){const i=LP(t.geometry);if(C(i))return null;this._material.renderPriority=this._renderPriority;const r=PAe(i,this._context.overlaySR),s=r.position.length/3,n=Du(2*s);this._createUVCoordsFromVertices(n,r.position,s,this._context.overlaySR);const o=new Fgt(r,n,this._context.layer.uid,t.uid);return o.outBoundingBox=Xr(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new J8(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(t){const i=t.uvCoords,r=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(Xr(U_),Lh(U_,s),!_f(U_,this._context.clippingExtent))continue;JC(t.outBoundingBox,U_);const l=ab(s,n,3);if(l.length===0)continue;const c=Jd(i,2*o,2*a),h=tue({material:this._material,indices:l,attributeData:{position:s,uv0:c}}),p=new BA(h,t),f=U_;mr(p.boundingSphere,.5*(f[0]+f[3]),.5*(f[1]+f[4]),0,.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]))),t.outGeometries.push(p)}}static headingVectorFromAngle(t){const i=tt(),r=M6(t);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}Zm.unitSizeOfTexture=100,Zm.elevationModeChangeTypes={definedChanged:qs.RECREATE,staysOnTheGround:qs.NONE,onTheGroundChanged:qs.RECREATE};const vF=tt(),k_=yi(),Ehe=tt(),U_=ho();class Dgt extends z8{constructor(t,i){super(t,null,null),this.uvCoords=i}}class Fgt extends z8{constructor(t,i,r,s){super(t,r,s),this.uvCoords=i}}function Ngt(e,t,i,r){const s=Che[e.type]&&Che[e.type][t.type]||kgt[t.type];return s?new s(e,t,i,r):(se.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const kgt={icon:VP,object:imt,line:eV,path:Zmt,fill:cV,extrude:udt,text:Ogt,water:Zm},Che={"mesh-3d":{fill:Vpt}};class Ugt extends kee{set symbol(t){this._symbol=t,t.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];v(s)&&(s.symbol=t,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(t,i,r){super(i.schedule),this._symbol=t,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(t){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;bF.renderPriority=1-(1+n)/r,bF.renderPriorityStep=1/r,bF.ignoreDrivers=o._ignoreDrivers;const a=Ngt(this.symbol,o,this._context,bF),l=gZ(t,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await SU(this.symbolLayers,async(n,o)=>{if(v(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),ii(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const i=this.symbolLayers[t];return v(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(t=>v(t)&&t.queryForSnapping)}createGraphics3DGraphic(t,i){const r=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=v(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Fct(r,i||this,s,t.layer,n)}get complexity(){return Vee(this.symbolLayers.map(t=>oo(t,"complexity")))}globalPropertyChanged(t,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof jg?l:null};if(v(n)&&!n.globalPropertyChanged(t,i,o))return!1}return!0}applyRendererDiff(t,i){return this.loadStatus!==Th.LOADED?lo.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==lo.Recreate_Symbol&&v(s)?Math.min(r,s.applyRendererDiff(t,i)):r,lo.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===Th.FAILED||t.diff.type!=="partial")return;const i=t.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(C(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];v(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(C(s))continue;const n=t.layers[r];if(C(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(C(r))continue;const s=t.layers[i];v(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,i=0,r=0;return this.symbolLayers.forEach(s=>{C(s)||(s.loadStatus===Th.LOADING?t++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:t,slow:i,fast:r}}async queryForSnapping(t,i,r,s){const n=this.symbolLayers.filter(v).filter(a=>v(a.queryForSnapping)).map(a=>a.queryForSnapping(t,i,r,s)),o=await Promise.all(n);return ii(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)v(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const bF={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class Vgt extends kee{constructor(t,i,r){super(i),this.symbol=t,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const i=await this.symbol.fetchSymbol({signal:t});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),v(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return v(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:Uee}globalPropertyChanged(t,i){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,i)}applyRendererDiff(t,i){return v(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,i):lo.Recreate_Symbol}prepareSymbolPatch(t){v(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,i){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,i)}onRemoveGraphic(){}getFastUpdateStatus(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){v(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function dte(e){return e instanceof Vgt?e.graphics3DSymbol:e instanceof Ugt?e:null}const BP=se.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Bgt(e){const t=Zgt(e);if(C(t))return null;const i=zgt(e,t);if(C(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return jgt({anchor:r,verticalOffset:t.verticalOffset,screenOffset:tt(),centerOffset:Yt(0,0,0,-1),centerOffsetUnits:"world",translation:O(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function zgt(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=Sf[i],s=r||t6(e);return i&&!r&&BP.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),Ggt(s,e)}function pte(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=dte(t);return v(i)?i.symbol.symbolLayers.getItemAt(0):null}function Ggt(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(C(i))return null;if(v(t.disablePlacement))return t.labelClass.labelPlacement?(BP.warnOncePerTick(Ahe(e.placement,t.disablePlacement.logEntityDescription)),t6(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return BP.warnOncePerTick(Ahe(e.placement,`'${r}' geometries`)),t6(t);break;case"point":case"mesh":return e}return e}function Ahe(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function t6(e){const t=e.graphics3DGraphic.graphic.geometry;if(C(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=pte(e);return v(i)&&i.type==="extrude"?Sf["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Sf["above-center"];default:return}}function jgt(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(C(r))return null;switch(r.type){case"point":qgt(e,t,i);break;case"polygon":Hgt(e,t,i);break;case"mesh":fte(e,t,i.graphics3DGraphic.layers[0])}return e}function Hgt(e,t,i){const r=pte(i);if(!C(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.layers[0];v(s)?(s.getBoundingBoxObjectSpace(cI),yf(cI,e.translation),e.translation[2]=pb(cI)/2):ue(e.translation,0,0,0),fte(e,t,s);break}}}function qgt(e,t,i){const r=pte(i);if(C(r))return;const s=i.graphics3DGraphic.layers[0];switch(v(s)?s.getCenterObjectSpace(e.translation):ue(e.translation,0,0,0),r.type){case"icon":case"text":Wgt(e,t,i,s);break;case"object":fte(e,t,s)}}function Wgt(e,t,i,r){const{graphics3DGraphic:s}=i,n=v(r)?r.getScreenSize():null;if(!s.isDraped&&v(n)){const o=Xgt(i);SR[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),SR[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=SR[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=SR[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=SR[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(Sf[i.labelClass.labelPlacement]&&BP.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function Xgt(e,t=Jgt){const{graphics3DGraphic:i}=e,r=i.layers[0],s=v(r)?r.stageObject.geometries[0].material:null;if(s&&s instanceof NA){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function fte(e,t,i){const r=v(i)?i.getBoundingBoxObjectSpace(cI):cI,s=Le(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Oe(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function Ygt(e){return e==="above-center"}function Zgt(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=dte(r.graphics3DSymbol),n=Mn(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Sf[t]||t6(e);return v(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Mhe(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(C(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?Ygt(o.placement)?{placement:"above-center",verticalOffset:Mhe(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(BP.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function Mhe(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const Sf={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Rhe={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in Rhe){const t=Rhe[e],i=Sf[e];t.forEach(r=>{Sf[r]=i})}Object.freeze&&(Object.freeze(Sf),Object.keys(Sf).forEach(e=>{Object.freeze(Sf[e]),Object.freeze(Sf[e].normalizedOffset)}));const SR=[0,0],Jgt=[0,0],cI=ho();class Ohe{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,i){this._materials.set(t,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const y7=512,_7=4096,Kgt=.85,Qgt=.95;class eyt{constructor(){this.offset={x:0,y:0},this.uvMinMax=ui()}}class tyt{constructor(t,i){this.textId=t,this.textRenderer=i,this.placement=new eyt,this.rendered=!1}}let s3=class extends Te{constructor(e){super(e),this.type=hn.Texture,this.id=Ru(),this.events=new ps,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=rt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,flipped:!0,samplingMode:nt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return v(this._glTexture)||(this._glTexture=new pt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(xt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=hs(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=rt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",y7.toString()),e.setAttribute("height",y7.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=y7){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=kC(i),i=Math.min(i,_7),i}_resizeAtlas(e,t){t=t||e;const i=this._atlas;i.size.width=e,i.size.height=t,v(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=ER,e.cursor.y=ER+Ihe,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,t=this._elementsToAddOrUpdate.size,i=this._elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this._atlas,{renderedWidth:n,renderedHeight:o}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,mr(e.placement.uvMinMax,e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height),s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this._elements.set(t,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const t=e.placement.offset;this._ctx.clearRect(t.x,t.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const t=this._stageObjects.get(e);if(t)return t;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this._stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(R.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometries[0]))}_processAddition(e,t){const i=this._atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+ER,a=n+ER+Ihe;if(i.cursor.x+o<i.size.width&&i.cursor.y+a<i.size.height)this._addAtlasElement(e,r,o,a),this._elementsToRender.set(r,e),this._elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+a+i.lineHeight<i.size.height)){const l=this._getExpectedAtlasUsage(),c=l>Kgt&&i.size.width<_7;return c&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!c&&l>Qgt&&i.size.width===_7?(this._processRemovals(),XE.OK):(this._repack(),XE.REPACK)}i.cursor.x=ER,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,o,a),this._elementsToRender.set(r,e),this._elementsToAddOrUpdate.delete(r)}return XE.OK}_processRemovals(){this._elementsToRemove.forEach((e,t)=>{const i=this._stageObjects.get(t);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(t)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,t)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(t,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const t=this._stageObjects.get(e.textId);t&&t.forEach(i=>{i.geometries[0].vertexAttributes.get(R.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(R.SIZE).data=[e.textRenderer.displayWidth,e.textRenderer.displayHeight],i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(C(this._glTexture))return Wa.YIELD;let i=!1;if(za(this._elementsToAddOrUpdate,(s,n)=>{const o=this._elements.get(n);if(o&&o.rendered){const a=this._stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this._elements.get(n);c.get(R.UV0).data=h.placement.uvMinMax,c.get(R.SIZE).data=[h.textRenderer.displayWidth,h.textRenderer.displayHeight],l.geometryVertexAttrsUpdated(l.geometries[0])}),this._elementsToAddOrUpdate.delete(n),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(n),t)===XE.REPACK&&(i=!0,!0)}),i)return this.runTask(Hl,!1),void e.madeProgress();let r=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),za(this._elementsToRender,(s,n)=>(this._processRenderingRequest(s),this._elementsToRender.delete(n),r=!0,e.madeProgress(),e.done)),r&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&rut.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,t){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new tyt(i,e)),this._addStageObject(i,t),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,r)=>e.push({element:i,key:r}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this._elementsToRemove.size){e.sort((i,r)=>i.key.localeCompare(r.key)),this._elements.clear();for(const{element:i,key:r}of e)this._elements.set(r,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:t,_elementsToRemove:i,_atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([d({constructOnly:!0})],s3.prototype,"view",void 0),u([d({type:Boolean})],s3.prototype,"updating",void 0),s3=u([P("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],s3);const ER=2,Ihe=2;var XE;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(XE||(XE={}));class Phe{constructor(t,i){this.labelingContext=t,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}}class iyt{constructor(t,i,r,s,n){this.labelClass=t,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}}class ryt{constructor(t,i,r,s,n,o,a){this.layer=t,this.graphics3DCore=i,this.scaleVisibility=r,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=n,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new tAe({pickable:!0,disableOctree:!0},t.uid)}}let tx=class extends Te{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Ii,this._handles.add([te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),te(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(xt.LABELER,this)]),this._textTextureAtlas=new s3({view:this.view}),this._hudMaterialCollection=new Ohe(this.view._stage),this._calloutMaterialCollection=new Ohe(this.view._stage)}dispose(){this._handles=Be(this._handles),this._textTextureAtlas=rt(this._textTextureAtlas),this._hudMaterialCollection=rt(this._hudMaterialCollection),this._calloutMaterialCollection=rt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.graphics.forEach((t,i)=>{const r=new Phe(e,t);this._labels.set(i,r),e.labelsToInitialize.set(i,r),t.setVisibilityFlag(Tu.USER_SETTING,!0,wa.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((t,i)=>{t.setVisibilityFlag(Tu.USER_SETTING,!1,wa.LABEL),this.setLabelGraphicVisibility(t,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const i=e.textRenderers[t._labelIndex];v(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const i=e.textRenderers[t._labelIndex];v(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Wa.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(t.active){if(!$he(t)){if(syt(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),v7(t)){this._dirty=!0;continue}if(!$he(t))continue}za(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var n,o,a;const t=(n=e.labelClassAbortController)==null?void 0:n.signal;await((a=(o=e.layer).when)==null?void 0:a.call(o)),ii(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter(l=>!!l.symbol);!s||s.length===0||(await SU(s,async(l,c)=>{const h=l.symbol,p=dte(i.getOrCreateGraphics3DSymbol(h));if(C(p))return void se.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await p.load(),ii(t);let f=null;_J(h)&&h.hasVisibleCallout()&&(f=$ct(h,i.symbolCreationContext),await f.load(),ii(t));const m=await kf(xCe(l,e.layer.fieldsIndex,this.view.spatialReference));if(ii(t),m.ok===!0){const y=await this._createTextRenderParameters(p.symbol);ii(t),e.labelClassContexts[c]=new iyt(l,p,f,y,m.value)}else se.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${m.error}`)}),ii(t))}async _createLabelClassContext(e){return C(e.labelClassPromise)&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Ws(t))throw t;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?uV.fromSymbol(t,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,ep(t),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n=new SCe(i.verticalOffset,Hue(i.anchor),Cdt(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return V_.graphic=t,V_.renderingInfo=null,V_.layer=r,s.createLabel(V_,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){return V_.graphic=e,V_.layer=s,V_.renderingInfo=new Ict(null,t,r.translation,r.centerOffset,r.screenOffset,r.centerOffsetUnits,r.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(V_)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0||!i.emptySymbolLabelSupported&&t.layers.length===0)return!1;let s=!1;const n=t.graphic,o=i.layer,a=wF(i.layer),l=this.view._stage;for(let c=0;c<r.length;c++){const h=e.textRenderers[c],p=e.textLabelPlacements[c];if(C(h)||C(p))continue;const f=r[c],m=f.graphics3DSymbol,y=m.symbol&&m.symbol.type==="label-3d"?m.symbol:null,_=m.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(i.elevationInfoOverride);const b=this._createTextSymbolGraphic(h,n,p,o,_);if(C(b))return!1;b._labelClass=f.labelClass,b._labelIndex=c,t.addLabelGraphic(b,l,i.stageLayer),t.setVisibilityFlag(Tu.USER_SETTING,a,wa.LABEL),t.clearVisibilityFlag(Tu.SCALE_RANGE,wa.LABEL),t.setVisibilityFlag(Tu.DECONFLICTION,!1,wa.LABEL),s=!0;const w=f.graphics3DCalloutSymbolLayer;if(w&&p.hasLabelVerticalOffset){w.setElevationInfoOverride(i.elevationInfoOverride);const T=this._createLineCalloutGraphic(n,y,w,p,o);v(T)&&(f.calloutSymbolLayerIndex=t.labelLayers.length,t.addLabelGraphic(T,l,i.stageLayer))}break}return i.scaleVisibility&&s&&i.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const r=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];r!=null&&r.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const t=e.labelingContext,i=t.labelClassContexts;if(!i||i.length===0)return;const r=e.graphics3DGraphic.graphic;for(let n=0;n<i.length;n++){const o=i[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const w=a.needsHydrationToEvaluate()?Olt(r,t.layer):r;l=a.evaluate(w)}catch{l=null}else l=a.evaluate(r);if(C(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=((s=c.symbol)==null?void 0:s.type)==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=t.disablePlacement,y=Bgt({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(C(y))continue;const _=Hue(y.anchor),b=XAe(_);e.textRenderers[n]=new qAe(l,b,o.textRenderParameters),e.textLabelPlacements[n]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,t){const i=t.graphic.uid;if(e.graphics.set(i,t),e.active){const r=new Phe(e,t);this._labels.set(i,r),e.labelsToInitialize.set(i,r)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=this._labels.get(i);e.graphics.delete(i),r&&(this._destroyGraphic(r,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const r=e.graphics.get(i);r&&(this._removeGraphic(e,r),this._addGraphic(e,r))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.graphics.forEach(n=>r.set(n.graphic.uid,n));const s=n=>n.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const n=o=>o.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,n)}}}_visibilityInfoChange(e){const t=wF(e.layer);t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((t,i)=>{const r=this._labels.get(i);r&&(this._destroyGraphic(r,i),r.visible=!1,r.rendered=!1,e.labelsToInitialize.set(i,r))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a=new ryt(o,e,t,r,s,n,wF(o));return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>wF(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.graphics.forEach(r=>this._removeGraphic(t,r)),this.view._stage.remove(t.stageLayer),this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textInitialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>v7(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,i)=>t+(v7(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function v7(e){return!!e.labelClassPromise&&!!e.labelClassAbortController}function $he(e){return e.labelClassContexts&&e.labelClassContexts.length}function syt(e){return e.labelClassContexts===null}function wF(e){var t;return e.labelsVisible===!0&&!!((t=e.labelingInfo)!=null&&t.some(i=>!!i.symbol))}u([d({constructOnly:!0})],tx.prototype,"view",void 0),u([d({constructOnly:!0})],tx.prototype,"deconflictor",void 0),u([d()],tx.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],tx.prototype,"updating",null),tx=u([P("esri.views.3d.layers.graphics.Labeler")],tx);const V_=new Pct(null,null,null);class mf{constructor(t,i,r,s=null){this.lij=[0,0,0],this.extent=yi(),this.resolution=0,this.loadPriority=0,this.measures={visibility:sl.VISIBLE_ON_SURFACE,screenRect:yi(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,i,r,s)}acquire(t,i,r,s){this.tilingScheme=s,this.id=mf.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(i,r,s,this.tilingScheme),t[1].acquire(i,r+1,s,this.tilingScheme),t[2].acquire(i,r,s+1,this.tilingScheme),t[3].acquire(i,r+1,s+1,this.tilingScheme),t):[new mf(i,r,s,this.tilingScheme),new mf(i,r+1,s,this.tilingScheme),new mf(i,r,s+1,this.tilingScheme),new mf(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,O0(t.measures.screenRect,this.measures.screenRect)}static id(t,i,r){return`${t}/${i}/${r}`}}var sl;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(sl||(sl={}));const $Me=.5*Math.PI,nyt=$Me/Math.PI*180;class oyt{constructor(t){this._renderCoordsHelper=t.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:O(),direction:O()};for(let i=0;i<4;i++)this._extent[i]={origin:O(),direction:O(),cap:{next:null,direction:O()}},this._planes[i]=nr();this._planes[kr.NEAR]=nr(),this._planes[kr.FAR]=nr(),this._planesWithoutFar=this._planes.slice(0,5)}update(t,i,r,s=!0){const n=this._extent;this._toRenderBoundingExtent(t,i,r),fe(this._center.origin,n[0].origin,n[2].origin),ae(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ae(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,z0(a.cap.direction,a.origin,l.origin),XI(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ae(a.direction,a.direction,-1)}XI(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[kr.NEAR]),s?vW(this._planes[kr.NEAR],this._planes[kr.FAR]):(IU(this._planes[kr.FAR],this._planes[kr.NEAR]),vW(this._planes[kr.NEAR],this._planes[kr.NEAR])),this._maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*dr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(t,i,r=!1){if(t==null)return!1;if(this._renderCoordsHelper.viewingMode===je.Global){const n=this._maxSpanSpatialReference.isGeographic?nyt:$Me*i;if(this._maxSpan>n)return!0;if(t.altitude!=null&&t.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this._maxSpan===0){const n=this._extent[0];return!(r||!t.intersectsRay(qh(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!r&&t.intersectsRay(qh(o.origin,o.direction))||t.intersectsLineSegment(Zx(o.origin,o.cap.next,lyt),o.cap.direction))return!0}const s=r?this._planes:this._planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(Pit(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,i,r){JZ(t,Ap),Ap[2]=r,Uf(i,Ap,b7,this._renderCoordsHelper.spatialReference),Ea(Lhe,b7),Xr(Wc);for(const{x0:n,x1:o,y0:a,y1:l}of ayt)for(let c=0;c<5;c++){const h=c/4;Ap[0]=zt(t[n],t[o],h),Ap[1]=zt(t[a],t[l],h),Ap[2]=r,Zo(Ap,i,Ap,this._renderCoordsHelper.spatialReference),Ze(Ap,Ap,Lhe),Mg(Wc,Ap)}ue(this._extent[0].origin,Wc[0],Wc[1],Wc[2]),ue(this._extent[1].origin,Wc[3],Wc[1],Wc[2]),ue(this._extent[2].origin,Wc[3],Wc[4],Wc[2]),ue(this._extent[3].origin,Wc[0],Wc[4],Wc[2]);for(let n=0;n<4;++n)Ze(this._extent[n].origin,this._extent[n].origin,b7)}_toRenderBoundingExtentLocal(t,i,r){CU(t,i,ly,this._renderCoordsHelper.spatialReference),ue(this._extent[0].origin,ly[0],ly[1],r),ue(this._extent[1].origin,ly[2],ly[1],r),ue(this._extent[2].origin,ly[2],ly[3],r),ue(this._extent[3].origin,ly[0],ly[3],r)}_toRenderBoundingExtent(t,i,r){switch(this._renderCoordsHelper.viewingMode){case je.Global:this._toRenderBoundingExtentGlobal(t,i,r);break;case je.Local:this._toRenderBoundingExtentLocal(t,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(Ur(t.planes[kr.NEAR],this._center.origin)<0&&_e(this._center.direction,t.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(Ur(t.planes[kr.NEAR],r.origin)<0&&_e(r.direction,t.direction)<0)return!0}return!1}}const ayt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Ap=O(),b7=Pe(),Lhe=Pe(),Wc=ho(),ly=yi(),lyt=Hf();class cyt{constructor(t){this._renderCoordsHelper=t,this._surfaceElevation=0,this._cache=new Map,this._frustum=new Qv(t),this._extendedFrustum=new Qv(t),this._intersector=new oyt({renderCoordsHelper:t}),this._renderCoordsHelper=t}begin(t,i){this._surfaceElevation=i,this._aboveGround=this._renderCoordsHelper.getAltitude(t.eye)>i,this._frustum.update(t),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(t)}end(){this._cache.clear()}calculate(t){if(this._allTilesInvisible)return sl.INVISIBLE;const i=this._renderCoordsHelper.viewingMode===je.Global&&t.lij[0]>=uyt&&t.lij[0]<hyt,r=this._getOrCalculateSingleTileVisibility(t,!i);return r!==sl.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(t):r}_shortenFrustumFarPlane(t){const i=Qv.nearFarLineIndices,r=t.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];me(Wu,l,a),ae(Wu,Wu,pyt),fe(r[o],a,Wu)}t.updatePoints(r)}_calculateAggregatedChildrenVisibility(t){let i=sl.INVISIBLE;const r=this._cache.get(t.id);if(r!=null)return r;const s=khe.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==sl.INVISIBLE&&(i=o,o===sl.VISIBLE_ON_SURFACE))break}return khe.release(s),this._cache.set(t.id,i),i}_getOrCalculateSingleTileVisibility(t,i){const r=this._cache.get(t.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(t);return i&&this._cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===je.Global&&t.lij[0]<dyt?this._calculateSingleTileVisibilitySided(t,!1)===sl.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this._aboveGround)}_calculateSingleTileVisibilitySided(t,i){this._intersector.update(t.extent,t.tilingScheme.spatialReference,this._surfaceElevation,i);const r=dr(t.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?sl.VISIBLE_ON_SURFACE:sl.VISIBLE_WHEN_EXTENDED:sl.INVISIBLE}_updateExtendedFrustum(t){this._extendedFrustum.update(t),this._shortenFrustumFarPlane(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(t.eye,Wu);this._aboveGround||pl(i,i);const r=uo(-_e(i,t.viewForward));if(this._allTilesInvisible=r>(Math.PI+t.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>t.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Wu),a){case ct.FAR_BOTTOM_LEFT:case ct.FAR_TOP_LEFT:case ct.NEAR_BOTTOM_LEFT:case ct.NEAR_TOP_LEFT:bW(this._extendedFrustum.planes[kr.LEFT],Wu,Wu);break;case ct.FAR_BOTTOM_RIGHT:case ct.FAR_TOP_RIGHT:case ct.NEAR_BOTTOM_RIGHT:case ct.NEAR_TOP_RIGHT:bW(this._extendedFrustum.planes[kr.RIGHT],Wu,Wu)}ae(Wu,Wu,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(qh(l,Wu),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),ol(n[ct.NEAR_BOTTOM_LEFT],n[ct.NEAR_BOTTOM_RIGHT],n[ct.NEAR_TOP_RIGHT],Fhe),ol(n[ct.NEAR_BOTTOM_RIGHT],n[ct.NEAR_TOP_RIGHT],n[ct.NEAR_TOP_LEFT],Nhe),_e(Fhe,Nhe)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[ct.NEAR_BOTTOM_LEFT],o[ct.NEAR_BOTTOM_RIGHT]]=[o[ct.NEAR_BOTTOM_RIGHT],o[ct.NEAR_BOTTOM_LEFT]]:[o[ct.NEAR_TOP_LEFT],o[ct.NEAR_TOP_RIGHT]]=[o[ct.NEAR_TOP_RIGHT],o[ct.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this._surfaceElevation-Dhe;return{zWithMargin:t,pointIndices:Qv.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>t}}_extendedFrustumParametersBelowSurface(){const t=this._surfaceElevation+Dhe;return{zWithMargin:t,pointIndices:Qv.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<t}}}const uyt=2,hyt=6,dyt=12,pyt=.95,Dhe=1,Wu=O(),Fhe=nr(),Nhe=nr(),khe=new ao(Array,e=>{e.length!==4&&(e[0]=new mf,e[1]=new mf,e[2]=new mf,e[3]=new mf)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class fyt{constructor(t){this._camera=new Ot,this._focusOnMap=[0,0],this._screenRect=yi(),this._tileSize=t.tileSize,this._renderCoordsHelper=t.renderCoordsHelper,this._tilingScheme=t.tilingScheme,this._visibility=new cyt(t.renderCoordsHelper)}begin(t,i,r){this._camera.copyFrom(t),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,YZ(0,0,t.fullWidth,t.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(t){t.measures.visibility=this._visibility.calculate(t),t.measures.distance=NDe(t.extent,this._focusOnMap),t.measures.visibility!==sl.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const i=myt,r=1<<i,s=t.measures.screenRect;rp(s);let n=0;const o=t.lij[0]+i,a=t.lij[1]<<i,l=t.lij[2]<<i,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===sl.VISIBLE_WHEN_EXTENDED?this._tileSize*gyt:this._tileSize}_computeScreenArea(t,i,r,s,n){const o=t.measures.visibility===sl.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,B_),rp(w7);for(let a=0;a<4;a++)ZZ(w7,B_[a]);return A1(n,w7,n),Kae(B_[0],B_[1],B_[2])+Kae(B_[0],B_[2],B_[3])}_projectToScreen(t,i,r,s,n){this._tilingScheme.ensureMaxLod(t),this._tilingScheme.getExtent(t,i,r,CR),this._toRenderCoords(CR,0,3,z_[0]),this._toRenderCoords(CR,2,3,z_[1]),this._toRenderCoords(CR,2,1,z_[2]),this._toRenderCoords(CR,0,1,z_[3]),s&&(this._projectToPlane(z_,this._camera.frustum[kr.NEAR]),this._projectToPlane(z_,this._camera.frustum[kr.TOP]),this._projectToPlane(z_,this._camera.frustum[kr.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(z_[o],Uhe),this._camera.renderToScreen(Uhe,n[o])}_projectToPlane(t,i){for(let s=0;s<4;s++)MR[s]=Ur(i,t[s]);const r=Math.max(MR[0],MR[1],MR[2],MR[3]);if(r>0){const s=ae(AR,i,-r);for(let n=0;n<4;n++)fe(t[n],t[n],s)}}_toRenderCoords(t,i,r,s){return AR[0]=t[i],AR[1]=t[r],AR[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(AR,this._tilingScheme.spatialReference,s),s}}const w7=yi(),myt=2,gyt=5,B_=[$s(),$s(),$s(),$s()],CR=yi(),AR=O(),z_=[O(),O(),O(),O()],MR=[0,0,0,0],Uhe=Ga();function $3t(e,t,i){if(C(e)||C(i))return!1;let r=!0;return Qn[0]=e.xmin!=null?e.xmin:0,Qn[1]=e.ymin!=null?e.ymin:0,Qn[2]=e.zmin!=null?e.zmin:0,r=r&&Xs(Qn,e.spatialReference,0,t,i,0,1),Qn[0]=e.xmax!=null?e.xmax:0,Qn[1]=e.ymax!=null?e.ymax:0,Qn[2]=e.zmax!=null?e.zmax:0,r=r&&Xs(Qn,e.spatialReference,0,t,i,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),r}function LMe(e,t,i){if(C(e)||C(i))return!1;let r=!0;return Qn[0]=e.xmin!=null?e.xmin:0,Qn[1]=e.ymin!=null?e.ymin:0,Qn[2]=e.zmin!=null?e.zmin:0,r=r&&Xs(Qn,e.spatialReference,0,Qn,i,0,1),t[0]=Qn[0],t[1]=Qn[1],Qn[0]=e.xmax!=null?e.xmax:0,Qn[1]=e.ymax!=null?e.ymax:0,Qn[2]=e.zmax!=null?e.zmax:0,r=r&&Xs(Qn,e.spatialReference,0,Qn,i,0,1),t[2]=Qn[0],t[3]=Qn[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),r}const Qn=O();let ya=class extends Te{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(v(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void se.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||v(t)&&e&&t.equals(e))return;const i=v(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(C(this.filterExtent))return null;const e=yi();return LMe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Qe,this.tileSize=512,this._idToTile=new Map,this._handles=new Ii,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new ri}initialize(){this._handles.add([te(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),hr),te(()=>{var e,t,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),Gs)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(xt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=hs(this._frameWorker),this._handles=Be(this._handles)}addClient(){const e=_yt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Hl))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),v(this._frameWorker)&&(this._frameWorker.priority=xt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&v(this._frameWorker)&&(this._frameWorker.priority=xt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){var t;if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new fyt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,(t=this.cameraOnSurface.location.z)!=null?t:0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(t=>new mf(t[0],t[1],t[2],e))}_purgeHorizonTiles(e){e.sort((t,i)=>{const r=t.measures.screenRect,s=i.measures.screenRect;return r[1]+r[3]-(s[1]+s[3])}),rp(xF);for(let t=0;t<e.length;t++)if(A1(xF,e.data[t].measures.screenRect,xF),Ff(xF)>vyt)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:t}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!H6(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==sl.INVISIBLE&&(i.measures.shouldSplit?(t.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(r=>{const s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===sl.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([d({constructOnly:!0})],ya.prototype,"scheduler",void 0),u([d({constructOnly:!0})],ya.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],ya.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],ya.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],ya.prototype,"focus",void 0),u([d({constructOnly:!0})],ya.prototype,"viewState",void 0),u([d({constructOnly:!0})],ya.prototype,"terrain",void 0),u([d()],ya.prototype,"tiles",void 0),u([d()],ya.prototype,"tileSize",void 0),u([d({readOnly:!0})],ya.prototype,"tilingScheme",null),u([d()],ya.prototype,"filterExtent",null),u([d({readOnly:!0})],ya.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],ya.prototype,"_rootTileIds",null),u([d({value:!1})],ya.prototype,"suspended",null),u([d({readOnly:!0})],ya.prototype,"updating",null),ya=u([P("esri.views.3d.layers.support.FeatureTileTree3D")],ya);let yyt=0;function _yt(){return yyt++}const xF=yi(),vyt=10;let Wn=class extends Te{constructor(){super(...arguments),this._propertiesPool=new L0({camera:Ot},this),this._lastSeenCameraProjectionValues=new Ot,this.mode=Di.ANIMATING,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new ps,this.viewingMode=je.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new ky({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new L0({camera:Ot},this)}createInitialCamera(){if(this.viewingMode===je.Global){const e=dr(this.spatialReference).radius;this.camera=new Ot({eye:Le(4*e,0,0),center:Le(e,0,0),up:Le(0,0,1)})}else this.camera=new Ot({eye:Le(0,0,100),center:Le(0,0,0),up:Le(0,1,0)})}get animation(){return this.cameraController instanceof SP&&v(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==od&&od.copyFrom(e),od.computeUp(this.viewingMode),this.events.emit("before-camera-change",od);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,od)&&(this._lastSeenCameraProjectionValues.copyFrom(od),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),(!t||!t.equals(od))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(od)),this._cameraChanged=!t||!t.almostEquals(od),this._cameraChanged)){const i=rge(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return Ft(this._contentCamera,this.camera)}set contentCamera(e){this._contentCamera=v(e)?e.clone():null}get fixedContentCamera(){return v(this._contentCamera)}get isGlobal(){return this.viewingMode===je.Global}get isLocal(){return this.viewingMode===je.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.removeHandles(Vhe),this.addHandles(Qo(()=>e.state===Ps.Finished||e.state===Ps.Stopped,()=>{this._set("cameraController",null),this.updateCamera(t=>e.onControllerEnd(t))},{sync:!0,once:!0}),Vhe),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Ps.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Ps.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();od.copyFrom(this._get("camera")),e(od),this.camera=od,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[fi.TOP]!==t.padding[fi.TOP]||e.padding[fi.RIGHT]!==t.padding[fi.RIGHT]||e.padding[fi.BOTTOM]!==t.padding[fi.BOTTOM]||e.padding[fi.LEFT]!==t.padding[fi.LEFT]}};u([d()],Wn.prototype,"mode",void 0),u([d({readOnly:!0,type:yA})],Wn.prototype,"animation",null),u([d({type:Ot})],Wn.prototype,"camera",null),u([d({readOnly:!0})],Wn.prototype,"pixelRatio",null),u([d()],Wn.prototype,"rasterPixelRatio",void 0),u([d()],Wn.prototype,"contentPixelRatio",void 0),u([d({})],Wn.prototype,"_contentCamera",void 0),u([d({type:Ot})],Wn.prototype,"contentCamera",null),u([d({readOnly:!0})],Wn.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],Wn.prototype,"constraints",void 0),u([d({readOnly:!0})],Wn.prototype,"events",void 0),u([d({readOnly:!0})],Wn.prototype,"isGlobal",null),u([d({readOnly:!0})],Wn.prototype,"isLocal",null),u([d({readOnly:!0})],Wn.prototype,"viewingMode",void 0),u([d({readOnly:!0})],Wn.prototype,"spatialReference",void 0),u([d()],Wn.prototype,"navigating",null),u([d()],Wn.prototype,"stationary",null),u([d()],Wn.prototype,"_cameraChanged",void 0),u([d()],Wn.prototype,"cameraController",null),Wn=u([P("esri.views.3d.state.ViewState")],Wn);const byt=Wn,od=new Ot,Vhe="ViewStateHandles";class wyt{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new ri,this._tolerance=PA,this._tmpRay=Xo(),this._tmpRegion=yi(),this._validateHUDIntersector=dp(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(t,i,r){return this.intersectRay(this._getPickRay(t,this._tmpRay),Bhe(this.viewingMode),i,r)}intersectScreenFreePointFallback(t,i,r){return this.intersectRayFreePointFallback(this._getPickRay(t,this._tmpRay),i,r)}intersectRayFreePointFallback(t,i,r){return this.intersectRay(t,Bhe(this.viewingMode),i,r)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=Aa.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(EF,r,s),EF[0]+=.0466,EF[1]-=.0123,aee(t,EF,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this._tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){const s=this._getPickRay(t,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);const s=i.results.min;!!this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Xf(s)&&s.intersector!==Ss.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=PA){this._tolerance=t}addIntersectionHandler(t){this._externalIntersectionHandlers.push(t),this._externalIntersectionHandlers.sort((i,r)=>i.type===Ss.TERRAIN?1:r.type===Ss.TERRAIN?-1:0)}removeIntersectionHandler(t){this._externalIntersectionHandlers.removeUnordered(t)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===Ss.TERRAIN?1:r.type===Ss.TERRAIN?-1:0)}_getPickRay(t,i){const r=this._view.state.camera;return x2e(r,t,i)}_intersectRayFreePointLocal(t,i){return this.viewingMode!==je.Local||C(t)||fe(i,t.origin,be(Xe.get(),t.direction)),!1}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this._tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){var T;if(C(t))return null;const n=v(i)?i.mode:"absolute-height",o=v(i)?Ft(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(t,a,SF)){const S=this._view.computeMapPointFromVec3d(SF);return(T=S.z)!=null||(S.z=0),S.z-=o,S}return null}const c=this._view.state.camera,h=Xe.get();c.projectToRenderScreen(t.origin,h);const p=new zhe(null,this._forEachLayer),f=this._view.slicePlane,m=v(f)?Ple(f):null,y=dp(this.viewingMode);y.options.store=Aa.MIN,y.options.verticalOffset=l;const _=t.origin,b=fe(Xe.get(),_,t.direction);y.reset(_,b,c),y.point=h;const w=v(s)?"type"in s&&s.type==="graphics"?S=>{var E;return((E=S.metadata)==null?void 0:E.layerUid)!==s.uid}:S=>{var E;return((E=S.metadata)==null?void 0:E.graphicUid)!==s.uid}:null;switch(n){case"relative-to-scene":{const S=E=>{var M;return(C(w)||w(E))&&!!((M=E.metadata)!=null&&M.isElevationSource)};y.intersect(p.layers,h,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(E=>{if(E.type===Ss.I3S||E.type===Ss.TERRAIN){const M=E.slicePlaneEnabled?m:null;E.intersect(y,M,y.rayBegin,y.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const E=S.slicePlaneEnabled?m:null;S.intersect(y,E,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(SF)){const S=this._view.computeMapPointFromVec3d(SF);return S.z=r,S}return null}computeIntersection(t,i,r){var y;if(C(t))return;const s=this._view.state.camera,n=Xe.get();s.projectToRenderScreen(t.origin,n);const o=new zhe(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=t.origin,l=fe(Xe.get(),t.origin,t.direction);i.reset(a,l,s),i.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=v(c)?Ple(c):null;i.intersect(o.sliceableLayers,n,this._tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const b=_.layerUid,w=Array.isArray(b),T=w?b:[b];w&&(i.options.filteredLayerUids=[]);let S=!1;for(const E of T)o.filterLayerUid(E)?S=!0:w&&i.options.filteredLayerUids.push(E);if(i.options.isFiltered=!S,_.isGround&&p||!i.options.isFiltered){const E=_.slicePlaneEnabled?h:null;_.intersect(i,E,a,l,n)}});const f=Xe.get(),m=this._view.basemapTerrain;if(r&&r.enableDraped&&v(m.spatialReference)&&i.results.ground.getIntersectionPoint(f)){const _=m.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=Xe.get();this._view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=Ft((y=this._view.elevationProvider)==null?void 0:y.getElevation(f[0],f[1],f[2],b,"ground"),0),_.intersect(i,w,i.results.ground,T=>o.filterRenderGeometry(T))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){const i=t.results.hud;O0(this._tmpRegion,Pj);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=w=>{const T=new Tyt(w);r.projectToRenderScreen(w.target.center,T.screenPoint),T.screenPoint[0]=Math.floor(T.screenPoint[0]),T.screenPoint[1]=Math.floor(T.screenPoint[1]),s.push(T),ZZ(n,T.screenPoint)};t.sortResults(i.all),v(i.min.dist)&&o(i.min);for(const w of i.all)i.min.target.object!==w.target.object&&i.max.target.object!==w.target.object&&o(w);if(v(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-n3),h=Math.max(0,n[1]-n3),p=Math.min(Mh(n)+2*n3,a-c),f=Math.min(Ff(n)+2*n3,l-h),m=new Uint8Array(p*f*4);this._view._stage.renderer.readHUDVisibility(c,h,p,f,m);let y=!0;const _=C(t.results.max.dist);let b=0;for(const w of s)for(const T of xyt)if(m[4*(Math.min(w.screenPoint[0]+T[0],a)-n[0]+(Math.min(w.screenPoint[1]+T[1],l)-n[1])*p)]){y&&(t.results.min.copy(w.result),y=!1),_&&t.results.max.copy(w.result),t.options.store===Aa.ALL&&t.results.all.splice(b++,0,w.result);break}}}const n3=1,xyt=(()=>{const e=[],t=n3;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})();class Tyt{constructor(t){this.result=t,this.screenPoint=Ga()}}let TF;function Bhe(e){return TF&&TF.viewingMode===e||(TF=dp(e)),TF}class zhe{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){const{include:i,exclude:r}=this;return C(t)?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function Ghe(e){return typeof e=="object"&&"intersect"in e}const SF=O(),EF=Ga();class L3t{constructor(t,i){this.spatialReference=t,this._view=i}getElevation(t,i,r){return this._view.elevationProvider.getElevation(t,i,0,this.spatialReference,r)}async queryElevation(t,i,r,s,n){return this._view.elevationProvider.queryElevation(t,i,0,this.spatialReference,n,r,s)}}class Syt{constructor(t,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=t.registerTask(xt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,r,s=0){return new Promise((n,o)=>{const a={x:t,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),fl(r,()=>{tZ(this._queries,a),o(lr())})})}get running(){return this._queries.length>0}runTask(t){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(h=>h.result.reject()),void t.madeProgress();const s=i.map(h=>[h.x,h.y]),n=i.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new c$({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(h=>!!h.signal)?new AbortController:null,l=v(a)?a.signal:i[0].signal;if(v(a)){let h=0;i.forEach(p=>fl(p.signal,()=>{h++,p.result.reject(lr()),h===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(h=>{i.forEach((p,f)=>{v(p.signal)&&p.signal.aborted?p.result.reject(lr()):p.result.resolve(h.geometry.points[f][2])})}).catch(h=>{i.forEach(p=>p.result.reject(h))}),t.madeProgress()}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask(Hl)}}}let o3=class extends ps.EventedMixin(Te){get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:t.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Be(this._elevationQueryCached)}get _elevationQuery(){return C(this._elevationQueryCached)&&(this._elevationQueryCached=new Syt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&kn(r,o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=CF(n,this._im,e,t,i,r,s),C(n)&&(n=CF(n,this._ground,e,t,i,r,s)),s==="scene"&&(n=CF(n,this._scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,o=0){const a=B1();return this._elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=CF(l,this._scene,e,t,i,r,s)),a.resolve(l)}).catch(l=>{Ws(l)?a.reject(l):a.resolve(this.getElevation(e,t,i,r,s))}),a.promise}register(e,t){this._handles.set(t,t.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(t)}unregister(e){var t;this._handles.has(e)&&((t=this._handles.get(e))==null||t.remove(),this._handles.delete(e));for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function CF(e,t,i,r,s,n,o){for(const a of t){const l=a.getElevation(i,r,s,n,o);v(l)&&(e=v(e)?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],o3.prototype,"view",void 0),u([d()],o3.prototype,"spatialReference",null),o3=u([P("esri.views.3d.support.CombinedElevationProvider")],o3);class x1{static isValidProfile(t){return t in x1.profiles}static getDefaultProfile(){return he("esri-iPhone")?"low":"medium"}static apply(t,i){const r=x1.profiles[t];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}}function jhe(){const e=!!he("esri-mobile"),t=!!he("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:e?1:1/0}}}x1.test={reset(){const e=jhe();for(const t in e)x1.profiles[t]=e[t]}},function(e){e.profiles=jhe()}(x1||(x1={}));const $4=x1;function DMe(){return new Float32Array(4)}function Eyt(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Gf(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Cyt(e,t){return new Float32Array(e,t,4)}function FMe(){return DMe()}function NMe(){return Gf(1,1,1,1)}function kMe(){return Gf(1,0,0,0)}function UMe(){return Gf(0,1,0,0)}function VMe(){return Gf(0,0,1,0)}function BMe(){return Gf(0,0,0,1)}const Ayt=FMe(),Myt=NMe(),Ryt=kMe(),Oyt=UMe(),Iyt=VMe(),Pyt=BMe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Myt,UNIT_W:Pyt,UNIT_X:Ryt,UNIT_Y:Oyt,UNIT_Z:Iyt,ZEROS:Ayt,clone:Eyt,create:DMe,createView:Cyt,fromValues:Gf,ones:NMe,unitW:BMe,unitX:kMe,unitY:UMe,unitZ:VMe,zeros:FMe},Symbol.toStringTag,{value:"Module"}));const Hhe=new De([0,255,255]),qhe=new De([0,0,0]),Whe=1,Xhe=.25,Yhe=.4,Zhe=.2;let $m=class extends Te{constructor(){super(...arguments),this.color=Hhe.clone(),this.haloColor=null,this.haloOpacity=Whe,this.fillOpacity=Xhe,this.shadowOpacity=Yhe,this.shadowColor=qhe.clone(),this.shadowDifference=Zhe}static toEngineOptions(e){var l,c,h,p,f,m;const t=De.toUnitRGBA((l=e.color)!=null?l:Hhe),i=v(e.haloColor)?De.toUnitRGBA(e.haloColor):t,r=De.toUnitRGBA((c=e.shadowColor)!=null?c:qhe),s=(h=e.haloOpacity)!=null?h:Whe,n=(p=e.fillOpacity)!=null?p:Xhe,o=(f=e.shadowOpacity)!=null?f:Yhe,a=(m=e.shadowDifference)!=null?m:Zhe;return{color:Gf(t[0],t[1],t[2],t[3]),haloColor:Gf(i[0],i[1],i[2],i[3]),haloOpacity:s,haloOpacityOccluded:.25*s,fillOpacity:n,fillOpacityOccluded:.25*n,shadowOpacity:o,shadowColor:Yt(r[0],r[1],r[2],r[3]),occludedShadowOpacity:o*(1-a)}}};u([d({type:De})],$m.prototype,"color",void 0),u([d({type:De})],$m.prototype,"haloColor",void 0),u([d()],$m.prototype,"haloOpacity",void 0),u([d()],$m.prototype,"fillOpacity",void 0),u([d()],$m.prototype,"shadowOpacity",void 0),u([d({type:De})],$m.prototype,"shadowColor",void 0),u([d()],$m.prototype,"shadowDifference",void 0),$m=u([P("esri.views.3d.support.HighlightOptions")],$m);const rY=$m;let ix=class extends ge{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(r=>r.toJSON()),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:JA(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],ix.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],ix.prototype,"outSpatialReference",void 0),u([d()],ix.prototype,"transformation",void 0),u([d()],ix.prototype,"transformForward",void 0),ix=u([P("esri.rest.support.ProjectParameters")],ix);const hV=ix,$yt=zr(hV);async function mte(e,t,i){t=$yt(t);const r=_M(e),s={...r.query,f:"json",...t.toJSON()},n=t.outSpatialReference,o=JA(t.geometries[0]),a=jU(s,i);return _r(r.path+"/project",a).then(({data:{geometries:l}})=>Ixe(l,o,n))}async function gte(e=null,t){var s,n;if(or.geometryServiceUrl)return or.geometryServiceUrl;if(!e)throw new H("internal:geometry-service-url-not-configured");let i;i="portal"in e?e.portal||po.getDefault():e,await i.load({signal:t});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new H("internal:geometry-service-url-not-configured");return r}async function Lyt(e,t,i=null,r){const s=await gte(i,r),n=new hV;n.geometries=[e],n.outSpatialReference=t;const o=await mte(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new H("internal:geometry-service-projection-failed")}var Dyt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getGeometryServiceURL:gte,projectGeometry:Lyt});class Fyt{constructor(t,i){this.spatialReference=i,this.unitInMeters=wl(this.spatialReference,dr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=gte(t&&t.get("portalItem")).catch(()=>{throw new H("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?r=t:(r=[t],s=!1);const n=r.map(l=>l instanceof ut?l:new ut(l,this.spatialReference)),o=new hV({geometries:n,outSpatialReference:et.WGS84}),a=(await mte(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}}let tf=class extends Te{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([d()],tf.prototype,"minTotalNumberOfFeatures",void 0),u([d()],tf.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],tf.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],tf.prototype,"snapshotAvailable",void 0),u([d()],tf.prototype,"polygonLodFactor",void 0),u([d()],tf.prototype,"polylineLodFactor",void 0),u([d()],tf.prototype,"skipHighSymbolLods",void 0),tf=u([P("esri.views.3d.support.QualitySettings.Graphics3DSettings")],tf);let _g=class extends Te{constructor(){super(...arguments),this.lodFactor=1}};u([d()],_g.prototype,"lodFactor",void 0),_g=u([P("esri.views.3d.support.QualitySettings.LoDFactorSettings")],_g);let i6=class extends _g{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};i6=u([P("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],i6);let Qy=class extends Te{constructor(){super(...arguments),this.object=new i6,this.point=new _g,this.integratedMesh=new _g,this.pointCloud=new _g,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:i6})],Qy.prototype,"object",void 0),u([d({type:_g})],Qy.prototype,"point",void 0),u([d({type:_g})],Qy.prototype,"integratedMesh",void 0),u([d({type:_g})],Qy.prototype,"pointCloud",void 0),u([d()],Qy.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Qy=u([P("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Qy);let Hv=class extends Te{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([d()],Hv.prototype,"lodBias",void 0),u([d()],Hv.prototype,"angledSplitBias",void 0),u([d()],Hv.prototype,"reduceTileLevelDifferences",void 0),u([d()],Hv.prototype,"textureFadeDuration",void 0),Hv=u([P("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Hv);let YE=class extends Te{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],YE.prototype,"pixelRatio",void 0),u([d()],YE.prototype,"maxTotalNumberOfFeatures",void 0),YE=u([P("esri.views.3d.support.QualitySettings.HeatmapSettings")],YE);let _c=class extends Te{constructor(){super(...arguments),this.graphics3D=new tf,this.sceneService=new Qy,this.tiledSurface=new Hv,this.heatmap=new YE,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:tf})],_c.prototype,"graphics3D",void 0),u([d({type:Qy})],_c.prototype,"sceneService",void 0),u([d({type:Hv})],_c.prototype,"tiledSurface",void 0),u([d({type:YE})],_c.prototype,"heatmap",void 0),u([d()],_c.prototype,"fadeDuration",void 0),u([d()],_c.prototype,"antialiasingEnabled",void 0),u([d()],_c.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],_c.prototype,"highQualityTransparency",void 0),u([d()],_c.prototype,"memoryLimit",void 0),u([d()],_c.prototype,"additionalCacheMemory",void 0),u([d()],_c.prototype,"frameRate",void 0),u([d()],_c.prototype,"maximumPixelRatio",void 0),_c=u([P("esri.views.3d.support.QualitySettings.QualitySettings")],_c);const Jhe=_c;function Nyt(e){return sZ(e)&&e.length>=3}function kyt(e){return(nZ(e)||Array.isArray(e))&&e.length>=3}function Uyt(e){return Nyt(e)||kyt(e)}class r6{constructor(t,i,r,s){this.viewingMode=t,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=Yze(s)}set extent(t){t&&Zze(this._coordinateSystem,t,this._coordinateSystem)}getAltitude(t){return s7e(this._coordinateSystem,t)}setAltitude(t,i,r=t){return Gbe(this._coordinateSystem,r,i,t)}setAltitudeOfTransformation(t,i){n7e(this._coordinateSystem,i,t,i)}worldUpAtPosition(t,i){return e7e(this._coordinateSystem,t,i)}worldBasisAtPosition(t,i,r){return t7e(this._coordinateSystem,t,i,r)}basisMatrixAtPosition(t,i){const r=this.worldBasisAtPosition(t,Au.X,Xe.get()),s=this.worldBasisAtPosition(t,Au.Y,Xe.get()),n=this.worldBasisAtPosition(t,Au.Z,Xe.get());return Vg(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(t,i){const r=this.worldUpAtPosition(t,Xe.get()),s=this.worldBasisAtPosition(t,Au.Y,Xe.get()),n=_be(i,s,r);return Zl(n)}intersectManifoldClosestSilhouette(t,i,r){return eB(this._coordinateSystem,i,this._tmpCoordinateSystem),r7e(this._tmpCoordinateSystem,t,r),r}intersectManifold(t,i,r){eB(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=Xe.get();return i7e(this._tmpCoordinateSystem,t,s)?le(r,s):null}intersectInfiniteManifold(t,i,r){if(this.viewingMode===je.Global)return this.intersectManifold(t,i,r);eB(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Xe.get();return nS(s.plane,t,n)?le(r,n):null}toRenderCoords(t,i,r){return Dk(t)?Xa(t,i,this.spatialReference):Zo(t,i,r,this.spatialReference)}fromRenderCoords(t,i,r=null){return Dk(i)?(v(r)&&(i.spatialReference=r),x1e(t,this.spatialReference,i)):Uyt(i)?Zo(t,this.spatialReference,i,r)?i:null:W1(t,this.spatialReference,i)}static create(t,i){switch(t){case je.Local:return new r6(je.Local,i,wl(i),Qze());case je.Global:return new r6(je.Global,i,1,Kze(i))}}static renderUnitScaleFactor(t,i){return Khe(t)/Khe(i)}}function Khe(e){if(AP(e,je.Global))return 1;const t=jbe(!1,e);return wl(t)}var rg;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(rg||(rg={}));const Vyt=(()=>{const e=new Array;return e[rg.ELEVATION]=10,e[rg.BASEMAP]=10,e[rg.I3S_INDEX]=10,e[rg.I3S_DATA]=10,e[rg.SYMBOLOGY]=5,e})(),Byt=30;function zMe(e){return typeof e.getUsedMemory=="function"}function zyt(e){return new vc({view:e})}const AF=1,x7=1,Gyt=.75,jyt=.6,Qhe=1.3;let vc=class extends Te{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new EJ,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(AF),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new a4e(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<jyt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(AF);else if(e)(this._memoryPredicted>1.1*x7||this._memoryUsed>x7)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/Qhe),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>x7)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Qhe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<Gyt&&this._quality<AF){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),AF))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;v(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(zMe(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const r=C(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);se.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([d({constructOnly:!0})],vc.prototype,"view",void 0),u([d()],vc.prototype,"maxMemory",null),u([d()],vc.prototype,"additionalCacheMemory",null),u([d()],vc.prototype,"memoryFactor",null),u([d()],vc.prototype,"updating",null),u([d()],vc.prototype,"usedMemory",null),u([d()],vc.prototype,"_quality",void 0),u([d()],vc.prototype,"_memoryUsed",void 0),u([d()],vc.prototype,"_updating",void 0),u([d()],vc.prototype,"_stableQuality",void 0),u([d()],vc.prototype,"_maxMemory",void 0),u([d()],vc.prototype,"_additionalCacheMemory",void 0),vc=u([P("esri.views.3d.support.MemoryController")],vc);class Hyt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class qyt{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new Wyt}}class Wyt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Xyt{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new qyt(n))}destroy(){this._clients.length=0}hasQuota(t){const i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){const i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}_taskFinished(t){const i=this._clients[t.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,vt(i.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){const i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const t=this;return{set workerFunc(i){t._workerFunc=i}}}}let L4=class extends Te{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new Xyt((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(xt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=hs(this._frameTask),this._tasks.forEach(e=>ep(e.abortController)),this._loadQueue=Be(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=B1();s.__signal=v(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return fl(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){const o=new Jyt(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){var i;xI(e.resolvers,t),t.reject(lr()),e.resolvers.length===0&&(e.status===Ad.DOWNLOADING&&(e.status=Ad.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=Ad.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=Kyt(v(r)&&r.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(vt(e.status===Ad.DOWNLOADING),e.status=Ad.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();ii(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==Ad.DOWNLOADED&&(t.err=t.err||lr()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Ws(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)Ws(t)?r.reject(t):r.reject(new H("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const s=i<=0?e.result:ne(e.result);r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Ad.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=Ad.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=_r(e.url,{...e.options,responseType:r,timeout:i,signal:s});let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===Ad.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=Zyt(c);if(r="image",e.size=c.byteLength,h==="unknown")return e.request=_r(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(m=>o(m.data),a);const p=new Blob([c],{type:h}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=_r(f,{responseType:r,timeout:i,signal:s}),e.request.then(m=>o(new dV(m.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],L4.prototype,"updating",void 0),L4=u([P("esri.views.3d.support.StreamDataLoader")],L4);const Yyt={numRetries:0};function Zyt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class dV{constructor(t,i,r){this.image=t,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}}class Jyt extends Hyt{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Ad.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Yyt.numRetries}}function Kyt(e,t,i){return`${e}:${t}:${i}`}var Ad;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(Ad||(Ad={}));let D4=class extends Te{constructor(){super(...arguments),this.updating=!1}};function Qyt(e){return new Lm({view:e})}u([d({readOnly:!0})],D4.prototype,"updating",void 0),D4=u([P("esri.views.3d.support.ResourceControllerMain")],D4);let Lm=class extends D4{constructor(){super(...arguments),this._immediateTask=gA,this._normalTask=gA,this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=tJe(),this._memoryController=zyt(this.view),this._streamDataLoader=new L4,this._streamDataLoader.setup(Byt,Vyt,this._scheduler),this.addHandles([te(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},hr),te(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=GC({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(xt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(xt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=hs(this._frameTask),this._streamDataLoader=Be(this._streamDataLoader),this._memoryController=Be(this._memoryController),this._scheduler=Be(this._scheduler)}get updating(){var e,t,i;return!!(((e=this._memoryController)==null?void 0:e.updating)||((t=this._streamDataLoader)==null?void 0:t.updating)||((i=this._immediateTask)==null?void 0:i.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(i,r,s)=>t.request(i,r,e,s),get busy(){return!t.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(_Z(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([d({constructOnly:!0})],Lm.prototype,"view",void 0),u([d()],Lm.prototype,"_scheduler",void 0),u([d()],Lm.prototype,"_memoryController",void 0),u([d()],Lm.prototype,"_streamDataLoader",void 0),u([d()],Lm.prototype,"_immediateTask",void 0),u([d()],Lm.prototype,"_normalTask",void 0),u([d({readOnly:!0})],Lm.prototype,"updating",null),Lm=u([P("esri.views.3d.support.ResourceControllerImpl")],Lm);function e0t(e){return"performanceInfo"in e}const r2=O(),t0t=O(),cy=O(),uy=O();function i0t(e,t,i=0){const r=e.extent;if(C(r))return!1;if(i===0)return Oye(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return FDe(r,t,i*s)}function MF(e,t,i,r){le(r2,i),r2[r]=t[r];const s=me(r2,r2,t),n=me(t0t,e,t),o=_e(n,s),a=_e(s,s);let l;l=o<=0?t:a<=o?i:fe(r2,t,ae(s,s,o/a));const c=me(r2,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function r0t(e,t,i){const r=e.extent;if(C(r))return 0;cy[0]=r[0],cy[1]=r[1],cy[2]=i,uy[0]=r[2],uy[1]=r[3],uy[2]=i;let s=1/0,n=1/0;return t[0]<cy[0]?s=MF(t,cy,uy,0):t[0]>uy[0]&&(s=MF(t,uy,cy,0)),t[1]<cy[1]?n=MF(t,cy,uy,1):t[1]>uy[1]&&(n=MF(t,uy,cy,1)),Math.min(s,n)}function s0t(e,t,i){if(C(e))return dQ();if(e.spatialReference.isGeographic&&!_T(e.spatialReference))return new H("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=os.checkUnsupported(e);if(v(r))return r;if(C(i))return new H("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=n0t(e,i);if(s)return s;const n=e.spatialReference;return v(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function n0t(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],o=Mye(t),a=yi();os.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>kE){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new H("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:kE})}return null}const o0t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:s0t,isInsideExtent:i0t,tiltToExtentEdge:r0t},Symbol.toStringTag,{value:"Module"}));function a0t(){return!0}function l0t(){return 0}function c0t(e,t){if(C(e))return dQ();const i=e.lods.length-1,r=e.spatialReference,s=_T(r)||Fg(r)||Ng(r);if(r.isWebMercator){if(!os.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new H("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new H("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!os.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new H("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new H("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return v(t)&&!e.spatialReference.equals(t)?new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const u0t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:c0t,isInsideExtent:a0t,tiltToExtentEdge:l0t},Symbol.toStringTag,{value:"Module"})),h0t={[je.Global]:u0t,[je.Local]:o0t};function Xm(e,t){e||console.warn("Terrain: "+t)}let co=!1,s6=!1;function d0t(e){s6=e,co=co||e}function p0t(e){co=e}function Me(e,t){var i;if(co&&!e){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(t||"")+" at "+r),new Error("Assertion failed"+(t?": "+t:""))}}function sY(e){return pV(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function n6(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function pV(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function yte(e){return(e==null?void 0:e.type)==="tile-3d"}function zP(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function GMe(e){return(e==null?void 0:e.type)==="wmts-3d"}function nY(e){return(e==null?void 0:e.type)==="elevation-3d"}function RR(e){return(e==null?void 0:e.type)==="group"}function o6(e){return e&&(yte(e)||GMe(e)||pV(e)||zP(e))}function oY(e){return e&&(yte(e)||pV(e)||zP(e)||GMe(e))}function GP(e){return oY(e)||nY(e)}function f0t(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return v(t)&&"type"in t&&t.type==="raster-tile"}function m0t(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return v(t)&&"type"in t&&t.type==="vector-tile"}function g0t(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return v(t)&&"type"in t&&t.type==="tile-texture"}function y0t(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return t instanceof HTMLImageElement||t instanceof dV||t instanceof HTMLCanvasElement||t instanceof ImageData}function RC(e){return v(e)&&"release"in e&&e.release(),null}function ede(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function jP(e,t,i,r){return h0t[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function fV(e,t,i){let r=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=jMe(e,t,i);r=n.tileInfo,s=n.fullExtent}else{s=n6(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=i===je.Local;if(n6(e))r=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!_0t(t)||v0t.force512VTL,a=e.tileInfo.spatialReference.isGeographic;r=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=e.tileInfo}return v(r)&&v(s)&&jP(r,s,t,i)==null?{tileInfo:r,fullExtent:s}:null}function jMe(e,t,i){const r=t4e(e);if(v(r)){if(!Qe.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>jP(n.tileInfo,n.fullExtent,t,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function _0t(e){return e.isWGS84||e.isWebMercator||pge(e)||!CI(e)}const v0t={force512VTL:!1};function tde(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function hy(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function Vd(e,t,i=x0t){return Math.abs(e-t)<i}function aY(e){return e===It.NORTH_EAST?It.SOUTH_WEST:e===It.NORTH_WEST?It.SOUTH_EAST:e===It.SOUTH_WEST?It.NORTH_EAST:It.NORTH_WEST}function a6(e){return e===It.NORTH?It.SOUTH:e===It.EAST?It.WEST:e===It.SOUTH?It.NORTH:It.EAST}function b0t(e){return e===It.NORTH_WEST||e===It.SOUTH_WEST}function w0t(e){return e===It.NORTH_WEST||e===It.NORTH_EAST}function ide(e){return e===It.NORTH_WEST||e===It.WEST||e===It.SOUTH_WEST}function rde(e){return e===It.NORTH_EAST||e===It.EAST||e===It.SOUTH_EAST}function sde(e){return e===It.SOUTH_EAST||e===It.SOUTH||e===It.SOUTH_WEST}function nde(e){return e===It.NORTH_EAST||e===It.NORTH||e===It.NORTH_WEST}const cg=[It.NORTH,It.EAST,It.SOUTH,It.WEST],l6=[It.NORTH_EAST,It.SOUTH_EAST,It.SOUTH_WEST,It.NORTH_WEST],x0t=1e-5;class T0t{constructor(t,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=GP(t)?i.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),e0t(t)){const r=t.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}}class S0t{constructor(t){var r,s,n;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,v(t.resourceController)){const o=t.resourceController.memoryController;this.totalMemory=((r=o.maxMemory)!=null?r:0)*hA.MEGABYTES,this.usedMemory=Math.round(o.usedMemory*this.totalMemory),this.quality=o.memoryFactor,this.load=t.resourceController.scheduler.load}this.terrainMemory=(n=(s=t.basemapTerrain)==null?void 0:s.getUsedMemory())!=null?n:0;const i=t._stage&&t._stage.renderView&&t._stage.renderer.edgeView;this.edgesMemory=v(i)?i.usedMemory:0,t.allLayerViews.items.forEach(o=>{(zMe(o)||GP(o))&&this.layerPerformanceInfos.push(new T0t(o,t))}),this.layerPerformanceInfos.sort((o,a)=>a.memory-o.memory)}}class E0t{constructor(t){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=t("gltf-resources",()=>{}),this._wosrMemCache=t("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(t=>t.abortController.abort()),this._wosrLoading.forEach(t=>t.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(t,i,r){const s=r?`gltfPBR:${t}`:`gltf:${t}`,n=this._gltfMemCache.get(s);return v(n)?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>pMe(new hMe(o.streamDataRequester),t,o,r),i)}loadWOSR(t,i){const r=`wosr:${t}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return v(s)?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,n=>fMe(t,n),i)}async _loadOnce(t,i,r,s,n){ii(n);const o=fl(n,()=>this._abortLoad(t,r));let a=t.get(r);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},t.set(r,a)}try{const l=await a.promise;return i.put(r,l,l.size),t.delete(r),ii(n),l}finally{hs(o)}}_abortLoad(t,i){const r=t.get(i);v(r)&&--r.refCount>0||(t.delete(i),v(r)&&r.abortController.abort())}}class C0t extends UE{constructor(t,i,r,s){super(i,s),this._streamDataRequester=t,this._parameters=r}async fromUrl(t,i,r){ii(r);const s=v(r)?r.signal:null,n=this.makeUid(t,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a};const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(t,h,i);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:n,texture:p,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await yZ(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(t,i,r){var n;const s={...this._parameters,powerOfTwoResizeMode:$1.PAD};if(Xye(t)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new If(i,s)}}class A0t{constructor(t){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=t.viewState,this._view=t.view,this._pointsOfInterest=t.pointsOfInterest,this.streamDataRequester=t.resourceController.createStreamDataRequester(rg.SYMBOLOGY),this.objectResourceCache=new E0t((r,s)=>t.resourceController.memoryController.newCache(r,s)),this.textures=new C0t(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:Pt.CLAMP_TO_EDGE,t:Pt.CLAMP_TO_EDGE}},t.resourceController.scheduler);const i=dr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=bEe(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=Lot(t.viewingMode,i)}destroy(){Be(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return Df();this._graphicsOwners.push(t);const i=te(()=>{var r;return(r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Df(()=>{i.remove(),xI(this._graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(t&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Ii;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([te(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,hr),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else t||(this._screenSizePerspectiveHandles=Be(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const t=this._pointsOfInterest;RF.distance=t.centerOnSurfaceInfrequent.distance,RF.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(RF),this.screenSizePerspectiveSettingsLabels.update(RF),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}const RF={distance:0,fovY:0};class fE{constructor(t,i,r=""){this.graphics=t,this._symbol=new l1({symbolLayers:[new a1({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new tS({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(t,i){if(C(i))return;this.hide();const r=new ut({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new Ko({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){v(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let t1=class extends Te{constructor(e){super(e),this.handles=new Ii}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],t1.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],t1.prototype,"surface",void 0),u([d({constructOnly:!0})],t1.prototype,"state",void 0),t1=u([P("esri.views.3d.support.PointOfInterest")],t1);const M0t=Array;let Jp=class extends t1{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new L0({location:ut,renderLocation:M0t},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=O(),this._tmpPoint=new ut}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Fs(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Be(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Vr(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return UT(i,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var r;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),Wa.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const t=((r=this._tmpPoint.z)!=null?r:0)>R0t&&this.renderCoordsHelper.viewingMode===je.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:t?O0t:0}).then(s=>{var n;return this._updateSurfaceAltitude((n=s.geometry.z)!=null?n:0)}).catch(s=>{Ws(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,Wa.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(T7,this._estimatedSurfaceAltitude,this._camera.eye),ql(this._get("renderLocation"),T7)||(this._set("renderLocation",le(this._propertiesPool.get("renderLocation"),T7)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],Jp.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Jp.prototype,"cache",void 0),u([d({constructOnly:!0})],Jp.prototype,"task",void 0),u([d({readOnly:!0})],Jp.prototype,"location",null),u([d({constructOnly:!0})],Jp.prototype,"map",void 0),u([d({readOnly:!0})],Jp.prototype,"renderLocation",void 0),u([d({readOnly:!0})],Jp.prototype,"scale",null),u([d({readOnly:!0})],Jp.prototype,"updating",null),Jp=u([P("esri.views.3d.support.CameraOnSurface")],Jp);const T7=O(),R0t=1e5,O0t=1e6,I0t=Array;let Md=class extends t1{constructor(e){super(e),this._propertiesPool=new L0({location:ut,renderLocation:I0t},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=O(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=hs(this._frameWorker),this._propertiesPool=Be(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Wa.YIELD}_updateRenderLocation(){const e=$0t;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=L0t;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(le(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Vr(this._camera.eye,e):(ae(e,this._camera.viewForward,this._get("distance")),fe(e,e,this._camera.eye)),ql(this._get("renderLocation"),e)||this._set("renderLocation",le(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){var r,s;const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const n=dr(this.renderCoordsHelper.spatialReference).radius,o=n+e,a=ll(i.eye),l=a<o*o,c=Vr(i.eye,t);if(l&&c>n/4){const h=o-Math.sqrt(a);return ae(t,i.viewForward,h),fe(t,t,i.eye),!0}}else{const n=(r=this.surface)!=null&&r.ready?this.surface.extent:null;v(n)&&CU(n,(s=this.surface)==null?void 0:s.spatialReference,OR,this.renderCoordsHelper.spatialReference)&&(t[0]=ye(t[0],OR[0],OR[2]),t[1]=ye(t[1],OR[1],OR[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(cr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=Vr(i,e),s=Vr(i,t);if(Math.abs(s-r)/r>P0t)return!0}return!1}};u([d({constructOnly:!0})],Md.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Md.prototype,"task",void 0),u([d()],Md.prototype,"distance",void 0),u([d({constructOnly:!0})],Md.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Md.prototype,"location",null),u([d({readOnly:!0})],Md.prototype,"renderLocation",void 0),u([d()],Md.prototype,"updating",void 0),Md=u([P("esri.views.3d.support.CenterOnSurface")],Md);const P0t=.05,$0t=O(),L0t=O(),OR=yi();class D0t{constructor(t){this._handles=new Ii,this.events=new ps,this._contentLayerViews=t.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Be(this._handles)}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",F0t)}}const F0t={},N0t=Array;let Dm=class extends t1{constructor(e){super(e),this._propertiesPool=new L0({location:ut,renderLocation:N0t},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([te(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),te(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(xt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Be(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,ode);const s=Math.max(0,(Math.acos(_e(ode,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!U1(e,t)){const l=this._propertiesPool.get("renderLocation");le(l,t),this._set("renderLocation",l)}return Wa.YIELD}const n=1-ye(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(ade);const a=this._propertiesPool.get("renderLocation");return On(a,t,ade,o),e&&U1(e,a)||this._set("renderLocation",a),Wa.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(Ga());if(i[1]=t.aboveGround?t.padding[fi.BOTTOM]:t.fullHeight-t.padding[fi.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,IR)){me(IR,IR,t.eye);const s=be(IR,IR);if(this.renderCoordsHelper.intersectManifold(qh(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],Dm.prototype,"_dirty",void 0),u([d({constructOnly:!0})],Dm.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Dm.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],Dm.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],Dm.prototype,"updating",null),u([d({readOnly:!0})],Dm.prototype,"location",null),u([d({readOnly:!0})],Dm.prototype,"renderLocation",void 0),Dm=u([P("esri.views.3d.support.pointsOfInterest.Focus")],Dm);const ode=O(),IR=O(),ade=O();let zy=class extends Te{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=O();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Ii}initialize(){this.view.state.isLocal&&(this._handles.add([te(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),Fs(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||C(this.surfaceView.extent)||C(this.surfaceView.spatialReference))return void this._set("location",null);const e=JZ(this.surfaceView.extent),t=new ut({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{Ws(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",t)}};u([d({constructOnly:!0})],zy.prototype,"view",void 0),u([d({constructOnly:!0})],zy.prototype,"cache",void 0),u([d()],zy.prototype,"surface",null),u([d()],zy.prototype,"surfaceView",null),u([d({readOnly:!0})],zy.prototype,"location",void 0),u([d({readOnly:!0})],zy.prototype,"renderLocation",null),zy=u([P("esri.views.3d.terrain.StableSurfaceCenter")],zy);let Gy=class extends Te{constructor(e){super(e),this._tileGeometryUpdateExtent=rp(),this._tileGeometryUpdateSpatialReference=null,this.events=new ps,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(xt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",k0t),rp(this._tileGeometryUpdateExtent),this._set("updating",!1)),Wa.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,A1(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.contentCamera.eye,r=U0t,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,iw,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,rw,t),iw[0]<rw[0]?(r[0]=iw[0],r[2]=rw[0]):(r[0]=rw[0],r[2]=iw[0]),iw[1]<rw[1]?(r[1]=iw[1],r[3]=rw[1]):(r[1]=rw[1],r[3]=iw[1]),H6(r,e)}};u([d({constructOnly:!0})],Gy.prototype,"state",void 0),u([d({constructOnly:!0})],Gy.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],Gy.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Gy.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Gy.prototype,"surface",void 0),u([d({readOnly:!0})],Gy.prototype,"updating",void 0),Gy=u([P("esri.views.3d.support.SurfaceGeometryUpdates")],Gy);const k0t={},iw=O(),rw=O(),U0t=rp();let Ec=class extends Te{constructor(e){super(e),this._handles=new Ii,this._tmpRay=Xo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new L0({renderPointOfView:V0t},this),this.renderPointOfView=O(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=dp(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Aa.MIN,this._contentIntersector=dp(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Md({...a,task:xt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Md({...a,task:xt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Md({...a,task:xt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Jp({...a,cache:o,task:xt.POINT_OF_INTEREST_INFREQUENT,map:r})),this._set("surfaceGeometryUpdates",new Gy({...a,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new D0t({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new zy({cache:o,view:this.view})),this._set("focus",new Dm({state:e,scheduler:n,surface:t,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new fE(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new fE(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new fE(l,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new fE(l,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new fE(l,"green","Focus")),this._handles.add([te(()=>e.contentCamera,h=>this._cameraChanged(h),hr),te(()=>t.extent,()=>this._updateCenterPointsOfInterest()),Qo(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),hr),Fs(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Fs(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Qo(()=>cr.SHOW_POI,h=>this._setDebug(h),st)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(t=>t.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return C(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,s2,z0t)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(s2):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(C(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=fe(s2,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(s2)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(s2)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=aee(t,e,B0t);if(C(r))return null;const s=r.origin,n=fe(s2,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;ql(this.renderPointOfView,t)||this._set("renderPointOfView",le(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(te(()=>t.renderLocation,i=>{var r;return(r=this._debugCenters.get(t))==null?void 0:r.show(i,t.renderCoordsHelper.spatialReference)},st),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],Ec.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],Ec.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],Ec.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],Ec.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],Ec.prototype,"focus",void 0),u([d({readOnly:!0})],Ec.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],Ec.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],Ec.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],Ec.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],Ec.prototype,"view",void 0),u([d({readOnly:!0})],Ec.prototype,"updating",null),Ec=u([P("esri.views.3d.support.PointsOfInterest")],Ec);const V0t=Array,s2=O(),B0t=Xo(),z0t={exclude:new Set([Jv])};class G0t{constructor(t){this._store=t}destroy(){this._store.destroy()}get(t){return this._store.get(t)}put(t,i){this._store.put(t,i,i.values.byteLength+256)}}class j0t{constructor(t,i,r,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in t?(this.values=t.pixelData,this.width=t.width,this.height=t.height,this.noDataValue=t.noDataValue):(this.values=t,this.width=i,this.height=r,this.noDataValue=s)}get hasNoDataValues(){if(C(this._hasNoDataValues)){const t=this.noDataValue;this._hasNoDataValues=this.values.includes(t)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(v(this._minValue))return;const{noDataValue:t,values:i}=this;let r=1/0,s=-1/0,n=!0;for(const o of i)o===t?this._hasNoDataValues=!0:(r=o<r?o:r,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=r,this._maxValue=s>-3e38?s:0)}}class HMe{constructor(t,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=M_e(t,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>se.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${t} worker: ${o}`))}on(t,i){const r={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Df(()=>{r.removed=!0,tZ(this._listeners,r),this._thread&&v(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,i){return this.invokeMethod(this._mainMethod,t,i)}invokeMethod(t,i,r){if(this._thread){const s=this._transferLists[t],n=s?s(i):[];return this._thread.invoke(t,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(ii(r),this.invokeMethod(t,i,r))):Promise.reject(null)}broadcast(t,i){return this._thread?Promise.all(this._thread.broadcast(i,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,i)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(i=>{t.removed||(t.threadHandle=i)})}}class lde extends HMe{constructor(t=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,r){return t&&t.byteLength!==0?this.invoke({buffer:t,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(uI.forEach((t,i)=>{t===this&&uI.delete(i)}),this.destroy())}}const uI=new Map;function H0t(e=null){let t=uI.get(e);return t||(v(e)?(t=new lde(i=>e.immediate.schedule(i)),uI.set(e,t)):(t=new lde,uI.set(null,t))),++t.ref,t}var _u,cde,ude;(function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"})(_u||(_u={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(cde||(cde={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(ude||(ude={}));class q0t{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class D3t{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function F3t(e,t,i,r,s,n){const o=i-s;if(o>=0)return(t>>o)+(r-(n<<o))*(e>>o);const a=-o;return t-(n-(r<<a))*(e>>a)<<a}class N3t{constructor(t,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,i,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function W0t(e,t,i,r,s,n){const o=t[r++];for(let a=0;a<o;a++){const l=new q0t(n);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];const c=t[r++];for(let f=0;f<c;f++){const m=t[r++],y=t[r++],_=t[r++],b=t[r++],w=!!t[r++],T=t[r++],S=i[r++],E=i[r++],M=t[r++],A=t[r++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:b,hard:w,partIndex:T,width:M,height:A,minLod:S,maxLod:E})}const h=e[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([e[r++],e[r++]]);const p=e[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[r++],e[r++]]);s.push(l)}return r}function k3t(e,t,i){for(const[r,s]of e.symbols)X0t(e,t,i,s,r)}function X0t(e,t,i,r,s){const n=e.layerData.get(s);if(n.type===_u.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class mV{constructor(t,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=t,this.memoryUsed=t.byteLength;let r=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return C(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){C(this._data)||(this.doPrepareForRendering(t,this._data,this.bufferDataOffset),this._data=null)}}class Y0t extends mV{constructor(t,i){super(t,i),this.type=_u.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){v(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),v(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),v(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=Oi.createVertex(t,Xi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=Oi.createIndex(t,Xi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new lp(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class Z0t extends mV{constructor(t,i){super(t,i),this.type=_u.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){v(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),v(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),v(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,v(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),v(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),v(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=Oi.createVertex(t,Xi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=Oi.createIndex(t,Xi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=Oi.createVertex(t,Xi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=Oi.createIndex(t,Xi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new lp(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new lp(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class J0t extends mV{constructor(t,i,r){super(t,i),this.type=_u.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=W0t(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[i,r]of this.iconPerPageElementsMap)t+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3}doDestroy(){v(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),v(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),v(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),v(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,v(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),v(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),v(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),v(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,i=this.iconOpacityBuffer;t.length>0&&t.byteLength===i.size&&i.setSubData(t,0,0,t.length);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=Oi.createVertex(t,Xi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=Oi.createIndex(t,Xi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=Oi.createVertex(t,Xi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=Oi.createIndex(t,Xi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=Oi.createVertex(t,Xi.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=Oi.createVertex(t,Xi.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new lp(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new lp(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class K0t extends mV{constructor(t,i){super(t,i),this.type=_u.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){v(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),v(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),v(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=Oi.createVertex(t,Xi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=Oi.createIndex(t,Xi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new lp(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const U3t=!0,V3t=32,hde=200,Q0t=1/he("mapview-transitions-duration");class e_t extends ps{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){var r;if(this._stage===t)return;const i=this._stage;this._stage=t,t?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return C(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=B1(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=B1(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var t,i;(t=this._fadeInResolver)==null||t.call(this),this._fadeInResolver=null,(i=this._fadeOutResolver)==null||i.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*Q0t;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class Jm{static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}constructor(t,i,r,s){this.set(t,i,r,s)}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return i>=0&&this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new Jm(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Jm(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new Jm(t,i,r,s),new Jm(t,i,r+1,s),new Jm(t,i+1,r,s),new Jm(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}Jm.pool=new ao(Jm,null,null,25,50);class t_t extends e_t{constructor(t,i,r,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Jm(t),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t){const i=this.resolution/(t.resolution*t.pixelRatio),r=this.transforms.tileMat3,[s,n]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;MQ(r,o,0,0,0,a,0,s,n,1),wA(this.transforms.dvs,t.displayViewMat3,r)}}class hI extends t_t{constructor(t,i,r,s,n,o,a,l=null){super(t,i,r,s,n,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<hde}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<hde)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let i=!1;for(const r of t)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===_u.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(qMe.delete(this),hI._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let i=!1;if(t){const{bucketsWithData:r,emptyBuckets:s}=t,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===_u.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===_u.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t){super.setTransform(t);const i=this.resolution/(t.resolution*t.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];t.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;RQ(o),_k(o,o,n),OQ(o,o,Math.PI*t.rotation/180),IQ(o,o,[r,s,1])}_createTransforms(){return{dvs:kc(),tileMat3:kc(),tileUnitsToPixels:kc()}}static _destroyRenderBuckets(t){if(!t)return;const i=new Set;t.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),t.clear()}_createRenderBuckets(t){const i=new Map,r=new Map;for(const s of t){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(t,i){let r=i.get(t);if(r)return r;switch(new Uint32Array(t)[0]){case _u.FILL:r=new Z0t(t,this.styleRepository);break;case _u.LINE:r=new Y0t(t,this.styleRepository);break;case _u.SYMBOL:r=new J0t(t,this.styleRepository,this);break;case _u.CIRCLE:r=new K0t(t,this.styleRepository)}return i.set(t,r),r}_deleteLayerData(t){if(!this.layerData.has(t))return;const i=this.layerData.get(t);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(t),this.layerCount--}}const qMe=new Map;function i_t(){qMe.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(i=>console.log(i)),console.log("========"),e[1].forEach(i=>console.log(i))})}const B3t={value:.5,readOnly:!0},r_t={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class ZE{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class s_t{constructor(t,i){this.data=t,this.safeWidth=.99999999*(t.width-1),this.dx=(t.width-1)/(i[2]-i[0]),this.dy=(t.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}}class n_t{constructor(t,i,r){this.type="elevation",this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i,this.samplerData=new s_t(r,i)}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*eP;let f=(c-1)/o,m=(r-this.j*o)*f,y=(i-this.i*o)*f;if(f<1){const _=Math.floor(m),b=Math.floor(y),w=_+b*c,T=h[w],S=h[w+1],E=h[w+c],M=h[w+c+1];if(T+S+E+M<p){const A=m-_,$=y-b,I=WL(T,S,E,M,A,$),k=WL(T,S,E,M,A+f,$),V=WL(T,S,E,M,A,$+f),B=WL(T,S,E,M,A+f,$+f);return s.min=Math.min(I,k,V,B),s.max=Math.max(I,k,V,B),s}m=_,y=b,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let b=y;b<=y+f;b++){const w=h[_+b*c];w<p?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}const o_t=.5*eP;function cs(e,t,i){if(C(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=ye(r.dy*(r.y1-t),0,s),o=ye(r.dx*(e-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,h=a*c+l,p=r.data.values,f=p[h],m=p[h+1],y=h+c,_=p[y],b=p[y+1];if(f+_+m+b<o_t){n-=a,o-=l;const w=f+(m-f)*o;return w+(_+(b-_)*o-w)*n}}return null}let Cd=class extends Te{constructor(e){super(e),this._handles=new Ii}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles=Be(this._handles)}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const r=WMe(i.fullExtent,this.viewSpatialReference);v(r)&&e.push(Mye(r))}}),e}};function a_t(e,t){return e===je.Global?new lY(t):new cY(t)}u([d({readOnly:!0})],Cd.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],Cd.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],Cd.prototype,"stencilEnabledExtents",null),u([d()],Cd.prototype,"viewSpatialReference",void 0),u([d()],Cd.prototype,"tilingScheme",void 0),u([d()],Cd.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],Cd.prototype,"layers",void 0),u([d({constructOnly:!0})],Cd.prototype,"layerViews",void 0),Cd=u([P("esri.views.3d.terrain.ExtentHelper")],Cd);let lY=class extends Cd{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?OTe:BZe}};lY=u([P("esri.views.3d.terrain.ExtentHelperGlobal")],lY);let cY=class extends Cd{_computeLayerViewsExtent(){const e=rp(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=WMe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);A1(e,o,e)}});const i=Rj(e)?e:null,r=this._get("layerViewsExtent");return Hx(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=rp();this.layers.forEach(n=>{if(n.loaded&&lC(n)){const o=fV(n,t,je.Local);if(C(o))return;const{tileInfo:a,fullExtent:l}=o;v(a)&&v(l)&&(n6(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&A1(i,l,i)}}),A1(i,this.defaultTiledLayersExtent,i);const r=Rj(i)?i:null,s=this._get("tiledLayersExtent");return Hx(r,s)?s:r}};function WMe(e,t){return v(e)&&!e.spatialReference.equals(t)?v1e(e,e.spatialReference,t):e}cY=u([P("esri.views.3d.terrain.ExtentHelperLocal")],cY);var wi;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(wi||(wi={}));const rx=[wi.ELEVATION,wi.MAP];function XMe(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const i=Object.keys(e);for(const r of i)r.search(".glsl")!==-1&&delete e[r]}}const l_t=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let G_,bc=class extends Te{get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||cr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return v(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?dr(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Ii,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=he("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){var t;const e=this._view;this.renderer=new Yp({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=dp(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",i=>{var r;return(r=e._stage)==null?void 0:r.renderer.setParameters({hasOverlayWater:i})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),te(()=>{var i,r,s;return[(i=e.pointsOfInterest)==null?void 0:i.renderPointOfView,(s=(r=e.pointsOfInterest)==null?void 0:r.centerOnSurfaceFrequent)==null?void 0:s.location]},()=>this.setPlacementDirty()),te(()=>{var i,r;return[(i=e.state)==null?void 0:i.pixelRatio,(r=e.state)==null?void 0:r.contentPixelRatio]},()=>this.setPlacementDirty(),hr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(xt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(Hl,i,cn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,cn.BACKGROUND,i.pixelRatio)})]),(t=e._stage)==null||t.renderer.setParameters({renderOverlay:i=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(i),this._drawOverlayTextures(this.renderer.overlays,cn.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this._handles=Be(this._handles),v(G_)&&(G_.hide(),G_=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this._view.renderSpatialReference;v(e)&&v(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Y1(-20037508342787e-6,20037508342787e-6):new Y1(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,uh)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&v(e.setDrapingExtent)&&v(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this._view.state.contentCamera,cn.UPDATE)}_updateOverlays(e,t,i){if(!this._spatialReference)return Wa.YIELD;const r=this._computeOverlayResolution(t);this._computeOverlayExtents(t,r,dy);const s=Mh(dy.inner)/Mh(dy.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this._updateOverlay(xs.INNER,dy.inner,r,1*dy.pixelRatioAdjustment,dy.mapUnitsPerPixel),o=this._updateOverlay(xs.OUTER,dy.outer,r,s*dy.pixelRatioAdjustment,dy.mapUnitsPerPixel);n!==Hm.EXTENT&&o!==Hm.EXTENT||(this._drapeSources.forEach(a=>this._updateDrapeSourceExtent(a)),this.surface.updateTileOverlayParams(i)),n===Hm.NONE&&o===Hm.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const t=this._view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*t,r=e.fullHeight/e.pixelRatio*t;return Math.min(kC(Math.max(i,r)+256),this._maxResolution)}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return Hm.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,c_t(t,n.extent)&&i===n.resolution)return o===s?Hm.NONE:Hm.RERENDER_ONLY;O0(n.extent,t),n.resolution=i;const a=JZ(n.extent);return n.renderLocalOrigin=sI(a[0],a[1],0,"OV_"+this._latestOriginId++),Hm.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[xs.INNER],r=this.renderer.overlays[xs.OUTER],s=e.extent;this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,xs.INNER,t),this._setTileOverlayData(s,xs.OUTER,t)):(this._clearTileOverlayData(xs.INNER,t),this._clearTileOverlayData(xs.OUTER,t))}else this._clearTileOverlayData(xs.INNER,t),this._clearTileOverlayData(xs.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[xs.INNER],i=this.renderer.overlays[xs.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;const r=this.renderer.overlays[t].extent,s=Mh(r),n=Ff(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,Mh(e)/s,Ff(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){XMe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Hl)}_dispatchAnimationUpdate(e){const t=e-this._animationTimeLast;if(t>=this.surface.view._stage.renderer.animationTimestep||v(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=t/this.surface.view._stage.renderer.animationTimeDilation,r=new kEe(this._view.state.camera,i,this._view.state.forcedAnimationTime);this.renderer.updateAnimation(r)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,d_t,t,i);if(C(s))return!1;const n=s.origin,o=fe(OF,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([]),this._view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this._view.renderCoordsHelper.getAltitude(e.eye),n=this._view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=ye(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this._view.viewingMode==="global"){const c=OF;mM(RU(OU,dr(this._view.spatialReference).radius+a),qh(e.eye,e.viewForward),c),me(c,c,e.eye);const h=Z1.normalize(_be(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:r;i=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=Yt(0,h,1,0),f=Ph(p,p,e.projectionMatrix)[1],m=ye(.5+.5*f,0,1);i=m===1||m===0?.5:l?m*r:1-(1-m)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&YY(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=O();this._findHorizonBasedPointOfInterest(e,s)||le(s,r);const n=Math.max(.1,Vr(e.eye,s)),o=sb(this._view.renderCoordsHelper,r,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);cr.OVERLAY_SHOW_CENTER?(C(G_)&&(G_=new fE(this._view.graphics,"red")),G_.show(s,this._renderSR)):v(G_)&&G_.hide(),this._overlaySREqualsRenderSR||Zo(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&v(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&v(this._spatialReference)?1/dr(this._spatialReference).metersPerDegree:1,p=this._view.state.contentPixelRatio,f=e.perScreenPixelRatio/p*n*h;i.mapUnitsPerPixel=f/this._worldToPCSRatio;let m=t*f/2,y=!1,_=c?90:1/0;this._isSpherical&&v(l)&&v(this._spatialReference)&&(this._spatialReference.isWebMercator?(m/=Math.cos(b5(s[1])),_=l[3]):(y=!0,m/=dr(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let b=1;y&&(b=1/Math.max(.2,Math.cos(Math.abs(Wt(s[1])))),m*b>180&&(b=180/m),i.mapUnitsPerPixel*=b);const w=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/w)*w);const T=m*b,S=32,E=.5*t/(S*T),M=.5*t/(S*m);s[0]=Math.round(s[0]*E)/E,s[1]=Math.round(s[1]*M)/M;const A=i.inner;A[0]=s[0]-T,A[1]=s[1]-m,A[2]=s[0]+T,A[3]=s[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,_);const $=i.outer;if(6*T>Mh(l))O0($,l);else if(a<=.25*Math.PI)$[0]=A[0]-T,$[1]=A[1]-m,$[2]=A[2]+T,$[3]=A[3]+m;else{Zo(e.eye,this._renderSR,OF,this._spatialReference),eg(sw,s,OF);let k=-Math.atan2(sw[1],sw[0])+.125*Math.PI;k<0&&(k+=2*Math.PI);const V=Math.floor(k/(.25*Math.PI));YA(sw,l_t[V],2*m),sw[0]*=b,sw[2]*=b,ZY($,A,sw)}if(this._isSpherical)$[0]=this._longitudeCyclical.clamp($[0]),$[2]=this._longitudeCyclical.clamp($[2]),$[1]=Math.max($[1],-_),$[3]=Math.min($[3],_);else{const k=Oj(A,l,u_t),V=Oj($,l,h_t);Uie(k,V)&&($[2]=$[0],$[3]=$[1])}const I=Math.abs(A[2]-A[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,I),i.pixelRatioAdjustment=i.mapUnitsPerPixel/I}_drawOverlayTextures(e,t,i=this._view.state.contentPixelRatio){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[xs.INNER],i),n=this._drawOverlay(e[xs.OUTER],i);s!==bA.CHANGED&&n!==bA.CHANGED||this.surface.updateTileOverlayParams(cn.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),r?(this.surface.requestRender(t),t===cn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(cn.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!C(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):H6(e,t))}_rectInsideRect(e,t){return!C(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:Uie(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),E5(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Hl)}}};function c_t(e,t){const r=cr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}u([d()],bc.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],bc.prototype,"running",null),u([d()],bc.prototype,"_placementDirty",void 0),u([d()],bc.prototype,"_contentUpdated",void 0),u([d()],bc.prototype,"_isSpherical",null),u([d()],bc.prototype,"_worldToPCSRatio",null),u([d({autoDestroy:!0})],bc.prototype,"renderer",void 0),u([d({constructOnly:!0})],bc.prototype,"surface",void 0),u([d()],bc.prototype,"suspended",null),u([d()],bc.prototype,"updating",null),u([d({type:Boolean})],bc.prototype,"hasHighlights",null),u([d({type:Boolean})],bc.prototype,"rendersOccluded",null),bc=u([P("esri.views.3d.terrain.OverlayManager")],bc);const sw=ui(),OF=O(),dy={inner:yi(),outer:yi(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},u_t=yi(),h_t=yi(),d_t=Xo();var Hm;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(Hm||(Hm={}));class HP{constructor(t,i){this._factoryCallback=t,this._lengthCallback=i,this._pool=new Map}acquire(t){if(!HP.test.disabled){const i=this._pool.get(t);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(t)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+i+s),i}}release(t){if(HP.test.disabled)return;const i=this._lengthCallback(t);let r=this._pool.get(i);r||(r=new ri({shrink:!0}),this._pool.set(i,r)),r.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}HP.test={disabled:!1};class p_t{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Xr(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class dde{constructor(t,i,r,s,n){this.attributes=t,this.localOrigin=i,this.index0=r,this.stride=s,this.count=n}getVertexIndex(t){return this.getAttributeIndex(t)}getAttributeIndex(t){return Me(0<=t&&t<this.count),this.index0+this.stride*t}_getVertexRaw(t,i){this.attributes.position.getVec(t,i)}_getNormalRaw(t,i){this.attributes.normalCompressed.getVec(t,i)}getVertexPos(t,i){this._getVertexRaw(this.getAttributeIndex(i),t),fe(t,t,this.localOrigin)}getNormal(t,i){const r=tt();this._getNormalRaw(this.getAttributeIndex(i),r),y_t(t,r)}_setNormal(t,i,r,s){qP(this.attributes.normalCompressed,t,i,r,s)}_setUV(t,i,r){$u(this.attributes.uv0,t,i,r)}setNormalFromValues(t,i,r,s){this._setNormal(this.getAttributeIndex(t),i,r,s)}setVertexFromValuesRawPositionUV(t,i,r,s,n,o){const a=this.getAttributeIndex(t);this.attributes.position.setValues(a,i,r,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(t,i,r,s,n,o,a,l,c){const h=this.getAttributeIndex(t);this.attributes.position.setValues(h,i,r,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}}const f_t=As().vec3f(R.POSITION).vec2i16(R.UV0).vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}),_te=new HP(e=>f_t.createBuffer(e),e=>e.count);function m_t(){_te.clear()}function YMe(e){return _te.acquire(e)}function g_t(e){_te.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}function qP(e,t,i,r,s){const n=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),o=i*n,a=r*n,l=s<=0?(o>=0?1:-1)*(1-Math.abs(a)):o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(o)):a;e.setValues(t,fde(l),fde(c))}function y_t(e,t){const i=mde(t[0]),r=mde(t[1]),s=1-Math.abs(i)-Math.abs(r);e[2]=s,s<0?(e[0]=(i>=0?1:-1)*(1-Math.abs(r)),e[1]=(r>=0?1:-1)*(1-Math.abs(i))):(e[0]=i,e[1]=r),be(e,e)}const pde=16384;function $u(e,t,i,r){e.setValues(t,i*pde,r*pde)}function fde(e){return ye(Math.round(32767*e),-32767,32767)}function mde(e){return ye(e/32767,-1,1)}function Yl(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}class __t{constructor(){this.sinLonLUT=new Array(NO+1),this.cosLonLUT=new Array(NO+1),this.sinLatLUT=new Array(NO+1),this.cosLatLUT=new Array(NO+1)}update(t,i,r){const s=i[0],n=i[2];for(let o=0;o<=t;o++){const a=o/t,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}}class IF{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}}class v_t{constructor(){this.cornerNeighborData=[new IF,new IF,new IF,new IF],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}}class b_t{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new v_t}}class OC{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Be(this._current),this._next=Be(this._next),this._waiting=Be(this._waiting),this._delayed=Be(this._delayed)}get current(){if(C(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=OC.test.fadeMoment;if(v(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,T0.Immediate),this._delayed=null)),v(this._next)){t=t||performance.now();const i=this._fadeDuration,r=v(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==io.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(Be(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(C(this._next))return 1;const t=OC.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return v(this._next)||v(this._delayed)}push(t,i=T0.Immediate){this._delayed=Be(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),C(this._current))return void(this._current=t);const r=OC.test.fadeMoment||performance.now();return i!==T0.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):C(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(C(t)||(Be(this._waiting),this._waiting=t))}get _fadeDuration(){return C(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}}var T0;OC.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(T0||(T0={}));var GA;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(GA||(GA={}));class ZMe{constructor(){this._queue=new ri,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=void 0}reset(t=null){this._queue.clear(),v(t)&&this._queue.pushArray(t),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const t=(i=this._last)==null?void 0:i.children;return t&&t[0]&&this._queue.pushArray(t),this._last=this._queue.pop(),this._last}}class w_t{constructor(){this._q=new ri}get done(){return this._q.length===0}reset(t){if(this._q.clear(),!C(t)){this._q.pushArray(t);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}}function dI(e,t,i){if(C(t)||C(t.fullExtent))return!1;const r=t.fullExtent,s=e.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale,o=t.minScale;if(o>0&&n>1.00000001*o)return!1;const a=t.maxScale;return!(a>0&&n<.99999999*a)}function S0(e,t){const i=e.lij,r=t.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function JMe(e,t,i=null){C(i)||i.length===0?e===GA.BACK_TO_FRONT?t.sort(x_t):t.sort(T_t):t.sort((r,s)=>S_t(r,s,e,i))}function x_t(e,t){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=e.lij,s=t.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function T_t(e,t){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=e.lij,s=t.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function KMe(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:S0(e,t)}function S_t(e,t,i,r){return gde(e,r)===gde(t,r)?KMe(e,t,i):e?i:-i}function gde(e,t){for(const i of t)if(e.intersectsExtent(i))return!0;return!1}function E_t(e,t){const i=e.distanceToPOI-t.distanceToPOI;if(i!==0)return i;const r=e.lij,s=t.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function C_t(e,t){const i=e.length;for(let r=0;r<i;++r)e.getItemAt(r).updateDistanceToPOI(t);e.sort(E_t)}function A_t(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function M_t(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function z3t(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}class vte{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,io.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return v(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),s=sY(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?dI:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=v(m)?m.tile.level:-1,_=!!v(m)&&y-p>=a,b=oo(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const w=h.level,T=p-w,S=h.layerInfo[i][t];if(S.data&&T>=a){(!_||w>y)&&this._setUpsampleTile(h),S.dataInvalidated&&(f=h);break}if((C(b)||b.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&w<=o&&!S.data&&!S.dataMissing&&((C(f)||h.level===n||w%RTe==0||p-f.level<a)&&(f=h),T>=l))break;h=h.parent}return v(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,io.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class R_t extends vte{get _desiredMinLevelDelta(){throw yde}get _progressiveLevelModulo(){throw yde}dispose(){}}const yde=new Error("Abstract method called on TileAgent"),Xc=new R_t;class QMe extends vte{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return HW(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class eRe extends vte{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return RTe}}var rT,jT;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(rT||(rT={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(jT||(jT={}));function O_t(e,t){e.fragment.uniforms.add([new Lt("u_colormap",i=>i.u_colormap),new Ie("u_colormapOffset",i=>i.colormap.u_colormapOffset),new Ie("u_colormapMaxIndex",i=>i.colormap.u_colormapMaxIndex),new Ie("u_opacity",i=>i.common.u_opacity)]),e.fragment.code.add(x`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${Xl(t,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function I_t(e,t){e.fragment.uniforms.add(Rf("u_transformGrid",i=>i.u_transformGrid,t.hasWebGL2Context?fr.None:fr.InvSize)),e.fragment.uniforms.add(new tr("u_transformSpacing",i=>i.common.u_transformSpacing)),e.fragment.uniforms.add(new tr("u_targetImageSize",i=>i.common.u_targetImageSize)),e.fragment.code.add(x`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${Xl(t,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${Xl(t,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${Xl(t,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${Xl(t,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}class tRe extends Rr{constructor(){super(...arguments),this.scale=1,this.offset=Bc}}function iRe(e){e.attributes.add(R.POSITION,"vec2"),e.attributes.add(R.UV0,"vec2"),e.vertex.uniforms.add(new Ie("scale",t=>t.scale)),e.vertex.uniforms.add(new tr("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(x`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class P_t extends tRe{constructor(t,i,r){super(),this.common=t,this.u_image=i,this.u_transformGrid=r}}function $_t(e,t){e.include(I_t,t),e.fragment.uniforms.add([new Lt("u_image",i=>i.u_image),new v0("u_flipY",i=>i.common.u_flipY),new v0("u_applyTransform",i=>i.common.u_applyTransform)]),e.fragment.code.add(x`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var Ue;(function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"})(Ue||(Ue={}));const uY={normal:Ue.Normal,average:Ue.Average,lighten:Ue.Lighten,lighter:Ue.Lighter,screen:Ue.Screen,plus:Ue.Plus,"color-dodge":Ue.ColorDodge,darken:Ue.Darken,multiply:Ue.Multiply,"color-burn":Ue.ColorBurn,overlay:Ue.Overlay,"soft-light":Ue.SoftLight,"hard-light":Ue.HardLight,"vivid-light":Ue.VividLight,hue:Ue.Hue,saturation:Ue.Saturation,luminosity:Ue.Luminosity,color:Ue.Color,difference:Ue.Difference,exclusion:Ue.Exclusion,minus:Ue.Minus,invert:Ue.Invert,reflect:Ue.Reflect,"destination-over":Ue.DestinationOver,"destination-atop":Ue.DestinationAtop,"destination-in":Ue.DestinationIn,"destination-out":Ue.DestinationOut,"source-atop":Ue.SourceAtop,"source-in":Ue.SourceIn,"source-out":Ue.SourceOut,xor:Ue.Xor};function L_t(e){return e===Ue.DestinationOver||e===Ue.DestinationAtop||e===Ue.DestinationIn||e===Ue.DestinationOut||e===Ue.SourceAtop||e===Ue.SourceIn||e===Ue.SourceOut||e===Ue.Xor}function bte(e){e.code.add(x`
    float lineFactorAtPosition(float value) {
      float pos = value * ${x.float(257)};
      if(pos < 0.5 || pos > ${x.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function D_t(e,t){const i=t.blendMode;i!==Ue.Normal&&(i===Ue.Reflect&&e.code.add(x`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Ue.ColorDodge&&i!==Ue.VividLight||e.code.add(x`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Ue.ColorBurn&&i!==Ue.VividLight||e.code.add(x`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Ue.Overlay&&e.code.add(x`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Ue.HardLight&&e.code.add(x`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Ue.SoftLight&&e.code.add(x`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Ue.VividLight&&e.code.add(x`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Ue.Hue&&i!==Ue.Saturation&&i!==Ue.Color&&i!==Ue.Luminosity||(e.code.add(x`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Ue.Hue&&i!==Ue.Saturation||e.code.add(x`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(x`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Ue.Multiply?x`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Average?x`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Lighten?x`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Darken?x`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Lighter?x`return vec4(cl * ol + cb * ob, ol + ob);`:i===Ue.Plus?x`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Ue.Minus?x`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Ue.Screen?x`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Difference?x`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Invert?x`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ue.DestinationOver?x`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Ue.DestinationAtop?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Ue.DestinationOut?x`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Ue.SourceAtop?x`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ue.SourceOut?x`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Ue.Xor?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Ue.DestinationIn?x`return vec4(cb * ob * ol, ol * ob);`:i===Ue.SourceIn?x`return vec4(cl * ol * ob, ol * ob);`:i===Ue.Hue?x`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Saturation?x`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Color?x`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Luminosity?x`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Exclusion?x`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Reflect?x`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.ColorDodge?x`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.ColorBurn?x`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.Overlay?x`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.SoftLight?x`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.HardLight?x`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ue.VividLight?x`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:x``}
    }
  `))}var xo,Ef,cf;(function(e){e[e.Composite=0]="Composite",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.GroupBackgroundComposite=3]="GroupBackgroundComposite",e[e.COUNT=4]="COUNT"})(xo||(xo={})),function(e){e[e.NotRequired=0]="NotRequired",e[e.Required=1]="Required",e[e.COUNT=2]="COUNT"}(Ef||(Ef={})),function(e){e[e.Off=0]="Off",e[e.On=1]="On",e[e.COUNT=2]="COUNT"}(cf||(cf={}));function rRe(e,t){const i=t.output===xo.GridComposite,r=t.output===xo.ColorComposite,s=t.output===xo.GroupBackgroundComposite,n=t.output===xo.Composite;i&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(bte)),r&&e.fragment.uniforms.add(new Jt("backgroundColor",c=>c.backgroundColor));const o=t.baseOpacityMode===Ef.Required;if(o&&e.fragment.uniforms.add(new Ie("baseOpacity",c=>c.baseOpacity)),n){const c=t.hasWebGL2Context?fr.None:fr.InvSize;e.fragment.uniforms.add(Rf("fboColor",h=>h.fboTexture,c))}const a=t.blendMode!==Ue.Normal,l=t.premultipliedSource===cf.On;e.fragment.include(D_t,t),e.fragment.code.add(x`
    vec4 getBackground(vec2 uv) {
      return ${o?x`baseOpacity *`:""} ${s?x`vec4(0.0, 0.0, 0.0, 0.0)`:r?x`vec4(backgroundColor, 1.0)`:i?x`vec4(gridColor(uv), 1.0)`:x`${Xl(t,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?x`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:x`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?x`colorLayer * opacity;`:x`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}class gV extends P_t{constructor(t,i,r,s,n,o){super(t,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=dl,this.fboTexture=null,this.baseOpacity=1}}class F_t extends gV{}class N_t extends gV{}function k_t(e){const t=new Yi;return t.include(iRe),t.include($_t,e),t.include(O_t,e),t.include(rRe,e),t.fragment.code.add(x`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),e.colorizerType===rT.Stretch?V_t(t,e):e.colorizerType===rT.Lut?U_t(t):e.colorizerType===rT.Hillshade&&B_t(t,e),t}function U_t(e){e.fragment.code.add(x`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function V_t(e,t){e.fragment.uniforms.add([new Y$("u_bandCount",r=>r.symbolizer.u_bandCount),new cl("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new cl("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new cl("u_factor",r=>r.symbolizer.u_factor,3),new Ie("u_minOutput",r=>r.symbolizer.u_minOutput),new Ie("u_maxOutput",r=>r.symbolizer.u_maxOutput),new v0("u_useGamma",r=>r.symbolizer.u_useGamma),new cl("u_gamma",r=>r.symbolizer.u_gamma,3),new cl("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new Ie("u_opacity",r=>r.common.u_opacity)]),e.fragment.code.add(x`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(x`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===jT.Noop?x`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:x`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function B_t(e,t){const i=e.fragment;i.uniforms.add([new Lt("u_image",s=>s.u_image),new Y$("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new cl("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new cl("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new cl("u_cosZs",s=>s.symbolizer.u_cosZs,6),new cl("u_weights",s=>s.symbolizer.u_weights,6),new tr("u_factor",s=>s.symbolizer.u_factor),new Ie("u_minValue",s=>s.symbolizer.u_minValue),new Ie("u_maxValue",s=>s.symbolizer.u_maxValue),new tr("u_srcImageSize",s=>s.common.u_srcImageSize)]),i.include(zg),i.code.add(x`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(x`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(x`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const z_t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:N_t,ColorizerStretchUniforms:F_t,ColorizerUniforms:gV,build:k_t},Symbol.toStringTag,{value:"Module"}));function G_t(e,t,i="nearest",r=!1){var c;const s=!(r&&t.pixelType==="u8"),n=s?kt.FLOAT:kt.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:St.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===Tt.WEBGL2&&s?Mt.RGBA32F:ze.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?nt.NEAREST:nt.LINEAR,dataType:n,wrapMode:Pt.CLAMP_TO_EDGE,flipped:!1};return new pt(e,l,o)}function j_t(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=t,a=i[0]>1,l={width:a?4*n:n,height:o,target:St.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===Tt.WEBGL2?Mt.RGBA32F:ze.RGBA,dataType:kt.FLOAT,samplingMode:nt.NEAREST,wrapMode:Pt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a&&s!=null)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new pt(e,l,c)}function _de(e,t){const i={width:t.length/4,height:1,target:St.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,wrapMode:Pt.CLAMP_TO_EDGE,flipped:!1};return new pt(e,i,t)}function H_t(e,t,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:Bc,u_transformGridSize:e?e.size:Bc,u_targetImageSize:t,u_srcImageSize:i}}function q_t(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function W_t(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function X_t(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const vde={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class Y_t{constructor(t,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=rt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...vde,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||vde}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){v(t)&&t.length>0?this._bandIds&&t.every((i,r)=>{var s;return!!((s=this._bandIds)!=null&&s[r])&&i===this._bandIds[r]})||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,v(this._rasterTexture)){const i=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(i==="bilinear"?nt.LINEAR:nt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=rt(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((C(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),v(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&C(this._transformGridTexture)&&(this._transformGridTexture=j_t(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:i,width:r,height:s,opacity:n}=this,o=H_t(i,[r,s],[this.source.width,this.source.height],n),a=q_t(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?W_t(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?X_t(this.symbolizerParameters):null;return new gV(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(C(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(i=>v(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=rt(this._rasterTexture),this._transformGridTexture=rt(this._transformGridTexture),this._colormapTexture=rt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=rt(this._rasterTexture));const s=C(i)&&C(this.bandIds)||v(i)&&v(this.bandIds)&&i.join("")===this.bandIds.join("");if(v(this._rasterTexture)&&s)return;this._rasterTexture=rt(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=G_t(t,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=rt(this._colormapTexture),this._colormapTexture=_de(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=_de(t,r),void(this._colormap=r)):(this._colormapTexture=rt(this._colormapTexture),void(this._colormap=null))}}class F4{constructor(){this.waitingAgents=new ri,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const i=S7.acquire();return i._init(t),i}release(){this.dispose(),N4.delete(this),S7.release(this)}dispose(){this.loadingAgent=rt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=RC(this._data)}static prune(){S7.prune(0)}_init(t){this.waitingAgents.clear(),this._data=RC(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=ep(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){v(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t===i||C(i))this._unsetUpsampleInfo();else{if(C(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),A_t(t,i,this._upsampleInfo)}}get data(){return this._data}set data(t){RC(this._data),this._data=t}}const S7=new ao(F4,null,()=>{}),N4=new Map;function Z_t(){N4.size>0&&(console.log(`${N4.size} live TilePerLayerInfo allocations:`),N4.forEach(e=>console.log(e,`
`)))}class mE{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var Rt;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(Rt||(Rt={}));const E7=O(),n2=O(),sa=O(),J_t=.1;class wte{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=yi(),this._elevationBounds=tt(),this.layerInfo=[[],[]],this.extentInRadians=yi(),this.centerAtSeaLevel=O(),this._center=[O(),Gn(),O()],this.up=WY(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=O()}static prune(){xte.prune(0),Tte.prune(0),F4.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Nn.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var r,s;this._dirty=!1;const t=(s=(r=this.parent)==null?void 0:r.frustumVisibility)!=null?s:nl.INTERSECTS;this._frustumVisibility=t===nl.INSIDE?nl.INSIDE:t===nl.OUTSIDE?nl.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==nl.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setDirty()),t}get shouldLoad(){const t=this._surface.snapLevel;if(v(t)){const i=this.level-t;if(i===0)return!0;if(i===1)return!1}return this.isLeaf}init(t,i,r){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=dr(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Nn.MIDDLE][3]=0,this.vlevel=t?t[0]:0,i&&i.elevationBounds?Mo(this._elevationBounds,i.elevationBounds):di(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of rx){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=F4.acquire(this._surface.upsampleInfoPool),s===wi.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,NO)}release(){Xm(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of rx){for(const i of this.layerInfo[t])i.release();this.layerInfo[t].length=0}this._parent=null;for(let t=0;t<4;++t)this._children[t]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const t=this._cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[wi.MAP].reduce((t,i)=>t+(i instanceof hI?i.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(v(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let t=0;for(const{data:r}of this.layerInfo[wi.MAP])r instanceof hI?t+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const i=this._cpuImageMemorySize;for(const r of this.layerInfo[wi.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=AT(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+t),this._usedMemory}getUsedMemoryForLayer(t,i){const r=this.layerInfo[t][i];return r!=null&&r.data?t===wi.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):t===wi.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof mE?AT(t.texture):t instanceof HTMLImageElement||t instanceof dV?this._cpuImageMemorySize:t instanceof hI||t instanceof Y_t?t.memoryUsage:0}updateScreenDepth(t){const i=this._center[Nn.MIDDLE],r=t,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(t,i,r){if(!this.visible||v(t.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(t.frustum)===nl.OUTSIDE))return Rt.NONE;const s=this.level;me(E7,this._center[Nn.MIDDLE],i);let n=ll(E7),o=Nn.MIDDLE;me(n2,this._center[Nn.TOP],i);const a=ll(n2);a<n&&(n=a,o=Nn.TOP),me(n2,this._center[Nn.BOTTOM],i);const l=ll(n2);if(l<n&&(n=l,o=Nn.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return Rt.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,f=()=>{const b=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return b!==this.vlevel?(this.vlevel=b,Rt.VSPLITMERGE):Rt.NONE_HIT_MAXLOD};if(v(r)&&r-s===1)return s>=t.maxLod?f():Rt.SPLIT;const m=_e(this.up,E7),y=this._elevationBounds[1]-this._elevationBounds[0],_=y/this.edgeLen;if(t.aboveGround&&m>0&&_<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-_>0)return Rt.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,Rt.VSPLITMERGE):Rt.NONE;if(s>=t.maxLod)return f();if(s>6){me(n2,this._center[o],i),ae(sa,this.up,m),me(sa,sa,n2);const b=ll(sa);if(b>this.radius*this.radius){ae(sa,sa,this.radius/Math.sqrt(b)),fe(sa,sa,this._center[o]),me(sa,i,sa);const w=Math.min(1,(Math.abs(_e(sa,this.up))+.5*y+this._curvatureHeight)/Oe(sa)),T=J_t/t.angledSplitBias,S=t.fovY*c*2;if(w*(this._edgeLen/S)<T*t.relativeHeightLimit)return Rt.NONE}}return Rt.SPLIT}setChildren(t,i,r,s){Xm(!!(t&&i&&r&&s),"Null child passed"),this._children[0]=t,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,i;return(i=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?i:!1}load(){this.refMapData();for(const t of rx)this._createOrUpdateAgents(0,t);this.surface.renderer.loadTile(this)}unload(t){t.unloadTile(this);for(const i of rx){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==Xc&&(PF(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(Rt.GEOMETRY),this.resetPendingUpdate(Rt.TEXTURE_NOFADING),this.resetPendingUpdate(Rt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[wi.MAP];for(const i of t)i.loadingAgent&&i.loadingAgent!==Xc&&(PF(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(Hx(t,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;v(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(Rt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){const r=this.layerInfo[i][t];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of rx){const i=this.layerInfo[t];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Xc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(Rt.SPLIT)||t!==wi.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===Rt.SPLIT||t===Rt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){const s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),r.dataArrived(this),!0;if(s.requestPromise)return!0;ep(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){if(this.hasLij(t))return this;const i=this._children;return i[0]?i[0].findByLij(t)||i[1].findByLij(t)||i[2].findByLij(t)||i[3].findByLij(t):null}distanceToSquared(t){return ll(me(sa,this._center[Nn.MIDDLE],t))}containsPoint(t){const i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}containsPointXY(t,i){const r=this.extent;return t>=r[0]&&i>=r[1]&&t<=r[2]&&i<=r[3]}unrequestLayerData(t,i,r){const s=this.layerInfo[i][t],n=s.waitingAgents,o=n.removeUnordered(r)!=null;Xm(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,i,r){const s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${t} error ${r}`);const s=this.layerInfo[i][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,i){switch(t){case wi.MAP:return this._updateTexture(i);case wi.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===io.FADING?Rt.TEXTURE_NOFADING:Rt.TEXTURE_FADING),this.setPendingUpdate(t===io.FADING?Rt.TEXTURE_FADING:Rt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Rt.GEOMETRY);for(const t of this.layerInfo[wi.ELEVATION])t.pendingUpdates|=Rt.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const t=this._elevationBounds,i=t[0],r=t[1];di(t,1/0,-1/0);const s=this.layerInfo[wi.ELEVATION];let n=!0;for(const o of s)v(o.elevationBounds)&&(t[0]=Math.min(t[0],o.elevationBounds.min),t[1]=Math.max(t[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),i===t[0]&&r===t[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const t=this._elevationBounds,i=.5*(t[0]+t[1]),r=this._center;ae(sa,this.up,i),fe(r[Nn.MIDDLE],this.centerAtSeaLevel,sa),ae(sa,this.up,t[0]),fe(r[Nn.TOP],this.centerAtSeaLevel,sa),ae(sa,this.up,t[1]),fe(r[Nn.BOTTOM],this.centerAtSeaLevel,sa)}findElevationBoundsForLayer(t,i){const r=this.layerInfo[wi.ELEVATION][t],s=HW(this.level),n=Math.max(this.vlevel-s,0),o=r.elevationBounds;if(v(o)&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(t,wi.ELEVATION),l=sY(a);if(!dI(this,l,!1))return;const c=Q_t;let h=!1;const p=r.data;if(p&&p.level<=n){const f=r.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,y=0;for(let _=this._parent;_&&(!m||y<s)&&(y=this.vlevel-_.level,f=m||f,m=_.layerInfo[wi.ELEVATION][t].data,!(!m&&f&&_.level<=n));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(C(r.elevationBounds)&&(r.elevationBounds=new ZE),r.elevationBounds.copyFrom(c))}modifyLayers(t,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Xc&&(PF(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:F4.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,io.FADING))}updateAgents(t){if(this.renderData){const i=this.layerInfo[t];for(const r of i)r.loadingAgent===Xc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of rx){const i=this._isSuspended(t);for(const r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==Xc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Xc&&this.updateRenderData(t,io.FADING))}}removeLayerAgent(t,i){const r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==Xc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){const r=this.layerInfo[i][t];r.loadingAgent=Xc,!r.data&&C(r.upsampleInfo)&&this._createOrUpdateAgents(t+1,i)}_hasBlendableAncestor(t){return t.blendMode!=="normal"||tA(t.parent)&&this._hasBlendableAncestor(t.parent)}_hasBlendModes(t,i,r){var s,n,o;for(let a=t;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(o6(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||tA((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(t,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=t;n<r.length;++n){const o=r[n];let a=!1;const l=this._surface.layerViewByIndex(n,i),c=sY(l);if(o.loadingAgent?dI(this,c,!1)?(o.loadingAgent!==Xc&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Xc&&(a=o.loadingAgent.update())):o.dispose():dI(this,c,!1)&&(o.loadingAgent=K_t(this,n,i,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Xc&&this.setPendingUpdate(Rt.GEOMETRY):(PF(o.loadingAgent),o.loadingAgent=Xc)),o.loadingAgent===Xc&&this.updateRenderData(i,io.FADING),!this._hasBlendModes(t,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(t){const i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){const i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationVerticesPerSide(t){const i=this.vlevel-this.level,r=Math.max(this.level-t,HW(this.level)-i),s=ye(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(t,i){if(!t)return null;const r=this.surface.rootTiles;if(v(r)){for(const s of r)if(evt(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(t,i){const r=this.lij,s=this.getNeighborLIJ(r,t);return s?tvt(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(t,i){const r=t===It.NORTH_EAST?1:t===It.NORTH_WEST?0:t===It.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(t,i){var r;return((r=this.findNeighborTile(t,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(aY(t),i))||null}forAllSubtreeOnSide(t,i){const r=t===It.NORTH?[0,1]:t===It.NORTH_EAST?[1]:t===It.EAST?[1,3]:t===It.SOUTH_EAST?[3]:t===It.SOUTH?[2,3]:t===It.SOUTH_WEST?[2]:t===It.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}forallNeighbors(t){l6.forEach(i=>this.findNeighborCornerTileExact(i,t)),cg.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||t(s)))==null?void 0:r.forAllSubtreeOnSide(a6(i),t)})}getNeighborEdgeStartVertexIndex(t,i){if(!i)return 0;const r=this.level-i.level;if(Me(!co||r>=0),r===0)return 0;const s=2**r,n=(1&t)==1,o=n?0:1,a=i.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return co&&(Me(a<=l&&l<a+s),Me(0<=h&&h<s)),h}forEachLoadedNeighbor(t){const i=this.level,r=s=>s.level===i||s.isLoaded;cg.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(a6(s),o=>!!o.isLoaded&&(t(o,s),!0))}),l6.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(aY(s),a=>a.isLoaded);Me(!n||hY(this,n,s)),n!=null&&n.isLoaded&&t(n,s)})}getNeighborLIJ(t,i){const r=nde(i)?-1:sde(i)?1:0,s=ide(i)?-1:rde(i)?1:0,n=[t[0],t[1]+r,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+vl()>=this.surface.extent[1]}checkGeometryWaterproofness(){var t;s6&&(Me(this.isLoaded),(t=this.renderData)==null||t.checkGeometryWaterproofness())}shouldHaveNeighbor(t){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(nde(t)&&i[3]+s>=r[3]||sde(t)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&ide(t)&&i[0]-s<=r[0])&&!(!n&&rde(t)&&i[2]+s>=r[2])}updateDistanceToPOI(t){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2])return;le(this._lastPOI,t);const r=this._center[Nn.MIDDLE],s=t[0]-r[0],n=t[1]-r[1],o=t[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}}function K_t(e,t,i,r){const s=i===wi.ELEVATION?Tte.acquire():xte.acquire();return s.init(e,t,i,r),s}function PF(e){e.dispose(),e instanceof QMe?Tte.release(e):e instanceof eRe&&xte.release(e)}const xte=new ao(eRe),Tte=new ao(QMe),Q_t=new ZE;var Nn;function evt(e,t){const i=e.level,r=t[0];if(i>r)return!1;const s=r-i,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function tvt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function ivt(e,t,i){if(C(e)||C(t))return!1;if(e.level===0&&t.level===0&&(e.isEastEnd&&t.isWestEnd&&i===It.EAST||e.isWestEnd&&t.isEastEnd&&i===It.WEST))return!0;const r=Math.max(1e-6*(e.extent[2]-e.extent[0]),1);switch(i){case It.NORTH:return Vd(e.extent[3],t.extent[1],r);case It.SOUTH:return Vd(e.extent[1],t.extent[3],r);case It.EAST:return Vd(e.extent[2],t.extent[0],r)||Vd(e.extent[2],-t.extent[0],r);case It.WEST:return Vd(e.extent[0],t.extent[2],r)||Vd(e.extent[0],-t.extent[2],r)}}function hY(e,t,i){return!C(e)&&!C(t)&&t!==e&&(e.level>=t.level?bde(e,t,i):bde(t,e,aY(i)))}function bde(e,t,i){Me(e.level>=t.level);const r=b0t(i),s=w0t(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=Vd(a[0],l[0],c)||e.surface.isGlobal&&Vd(a[0],-l[0],c),p=Vd(a[1],l[1],c);if(h&&p)return!0;if(e.level===t.level||!h&&!p)return Me(!1),!1;const f=h?wde(o[1],o[3],n[1],n[3],c):wde(o[0],o[2],n[0],n[2],c);return Me(f),f}function wde(e,t,i,r,s=vl()){return e-s<=i&&i<=r&&r<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Nn||(Nn={}));class rvt{constructor(){this._scales=Yt(-1,-1,-1,-1),this._offsets=Yt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}function svt(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(x`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}class Ste extends bAe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=O(),this.origin=this.slicePlaneLocalOrigin}}var Su;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(Su||(Su={}));class nvt extends Ste{constructor(){super(...arguments),this.identifier=Su.Material,this.output=z.Color,this.transparent=!1,this.integratedMesh=!1}}class ovt extends Ste{constructor(){super(...arguments),this.identifier=Su.ShadowMap}}class avt extends Ste{constructor(){super(...arguments),this.identifier=Su.Highlight}}class c6 extends Zs{constructor(t,i){super(t,"vec4",Ar.Draw,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}var E0;function lvt(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add([new c6("overlayTexOffset",(s,n)=>cvt(s,n)),new c6("overlayTexScale",(s,n)=>uvt(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new Lt("ovColorTex",(s,n)=>dY(s,n))),sRe(e,t)}function sRe(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==gt.Water&&t.pbrMode!==gt.WaterOnIntegratedMesh&&t.pbrMode!==gt.TerrainWithWater||e.include(EAe,t);const{vertex:i,fragment:r}=e;e.varyings.add("vtcOverlay","vec4"),i.code.add(x`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(x`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(x`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(x`
    vec4 getOverlayColorTexel(vec4 texCoords) {
          vec2 texDim =  ${Zd(t,"ovColorTex")};

          vec4 color0 = ${Xl(t,"ovColorTex","vec2(texCoords.x * 0.5, texCoords.y)*texDim")};
          vec4 color1 = ${Xl(t,"ovColorTex","vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim")};

          bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
          bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));

          return mix(color1 * float(isValid1), color0, float(isValid0));
    }
  `),t.pbrMode!==gt.Water&&t.pbrMode!==gt.WaterOnIntegratedMesh&&t.pbrMode!==gt.TerrainWithWater||(Y0(r),Bg(r),r.code.add(x`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function dY(e,t){return t.overlays.length===0?null:e.identifier===Su.Material&&e.output===z.Color?t.overlays[xs.INNER].getColorTextureNoRasterImage():e.identifier===Su.Material&&e.output===z.ObjectAndLayerIdColor?t.overlays[xs.INNER].getColorTexture(Mc.ObjectAndLayerIdColor):e.identifier===Su.Highlight?t.overlays[xs.INNER].getValidTexture(zs.Highlight):null}function cvt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Rye(s)>0&&(IC[2*r]=e.toMapSpace[0]/Mh(s)-s[0]/Mh(s),IC[2*r+1]=e.toMapSpace[1]/Ff(s)-s[1]/Ff(s))}return IC}function uvt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Rye(s)>0&&(IC[2*r]=e.toMapSpace[2]/Mh(s),IC[2*r+1]=e.toMapSpace[3]/Ff(s))}return IC}(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(E0||(E0={}));const IC=ui();var ug;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(ug||(ug={}));class hvt extends Rr{constructor(){super(...arguments),this.overlayOpacity=1}}function PR(e,t){e.vertex.uniforms.add([new u6("overlayTexOffset"),new u6("overlayTexScale")]),e.fragment.uniforms.add([new Ie("overlayOpacity",i=>i.overlayOpacity),new Lt("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[xs.INNER].getColorTexture(i.overlaySource))]),sRe(e,t)}function dvt(e,t){const{vertex:i,fragment:r,varyings:s}=e;s.add("vtc","vec2"),i.uniforms.add(new u6("texOffsetAndScale")),r.uniforms.add(new xde("tex")),r.uniforms.add(new C7("textureOpacities"));const n=t.textureFadingEnabled&&!t.renderOccluded;n&&(i.uniforms.add(new u6("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new xde("texNext")),r.uniforms.add(new C7("nextTexOpacities")),r.uniforms.add(new pvt("fadeFactor")));const o=t.tileBlendInput===ug.ColorComposite,a=t.tileBlendInput===ug.GridComposite;a&&r.include(bte),o&&r.uniforms.add(new C7("backgroundColor")),i.code.add(x`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?x`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:x``}
  }`),r.code.add(x`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?x`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?x`backgroundColor`:x`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:x`return color;`}
    }`),n?r.code.add(x`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(x`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class pvt extends Zs{constructor(t){super(t,"float")}}class C7 extends Zs{constructor(t){super(t,"vec3")}}class u6 extends Zs{constructor(t){super(t,"vec4")}}class xde extends Zs{constructor(t){super(t,"sampler2D")}}class nRe extends hvt{}function fvt(e){const t=new Yi,{vertex:i,fragment:r,varyings:s}=t;t.include(F$),t.include(X$,e),t.include(yg,e);const n=()=>{t.include(FP,e),i.code.add(x`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${e.shading?x`decodeNormalTerrain(normalCompressed)`:x`getLocalUp(position, localOrigin)`};
      }
  `)};Pu(i,e),t.include(Dc,e);const o=e.overlayMode!==E0.Disabled;switch(e.output){case z.Color:{t.include(dvt,e),t.include(GT,e),o&&t.include(PR,{...e,pbrMode:e.pbrMode===gt.Terrain?gt.TerrainWithWater:gt.Water});const a=e.overlayMode===E0.EnabledWithWater;a&&t.include(svt,e),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),(e.atmosphere||e.screenSizePerspective)&&DA(i);const l=e.receiveShadows&&!e.renderOccluded;l&&t.include(bM,e),e.atmosphere&&s.add("wnormal","vec3"),e.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.code.add(x`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${a?x`forwardVertexTangent(vnormal);`:x``}

          ${e.atmosphere?x`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?x`setOverlayVTC(uv);`:""}
          ${e.tileBorders?x`forwardTextureCoordinates();`:""}

          ${e.screenSizePerspective?x`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?x`forwardLinearDepth();`:""}

        }
      `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(An,e),t.include(GT,e),t.include(J$,e),t.include(zT,e),zf(r,e),K$(r),RM(r),r.uniforms.add([i.uniforms.get("localOrigin"),new Jt("viewDirection",(c,h)=>be(Tde,ue(Tde,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))]),a&&r.uniforms.add([new Lt("ovWaterTex",(c,h)=>h.overlays.length===0?null:h.overlays[xs.INNER].getNormalTexture(c.overlaySource)),new CEe("view",(c,h)=>Vc(mvt,h.camera.viewMatrix,c.origin))]),r.code.add(x`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Y0(r),Bg(r),r.code.add(x`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${e.receiveShadows&&!e.renderOccluded?"readShadowMap(vpos, linearDepth)":e.spherical&&e.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?x`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${e.invisible?x`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${e.atmosphere?x`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${e.atmosphere?x`atm + tileColor.rgb;`:x`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${e.pbrMode===gt.Terrain||e.pbrMode===gt.TerrainWithWater?x`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:x`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${a?x`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${e.screenSizePerspective?x`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${e.visualizeNormals?e.spherical?x`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:x`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${e.tileBorders?x`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case z.Depth:o&&t.include(PR,e),t.include(U0,e),Q1(t),RT(t),i.code.add(x`
              void main(void) {
                ${o?x`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(x`
              void main() {
                ${o&&e.invisible?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case z.Shadow:case z.ShadowHighlight:case z.ShadowExcludeHighlight:t.include(U0,e),Q1(t),RT(t),i.code.add(x`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(x`void main() {
outputDepth(linearDepth);
}`);break;case z.Normal:o&&t.include(PR,e),s.add("vnormal","vec3"),DA(i),n(),i.code.add(x`
            void main(void) {
              ${o?x`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(x`
            void main() {
              ${o&&e.invisible?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case z.Highlight:o&&t.include(PR,e),i.code.add(x`
          void main() {
            ${o?x`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),t.include(i_,e),r.code.add(x`
          void main() {
            ${o?x`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return e.output===z.ObjectAndLayerIdColor&&(t.include(PR,{...e,pbrMode:gt.Disabled}),i.code.add(x`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(x`void main() {
gl_FragColor = getOverlayColorTexel(vtcOverlay);
}`)),t}const mvt=Pe(),Tde=O(),gvt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:nRe,build:fvt},Symbol.toStringTag,{value:"Module"}));class yV extends ir{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2,i.spherical=t.viewingMode===je.Global}initializeProgram(t){return new Ji(t.rctx,yV.shader.get().build(this.configuration),oRe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Ht({blending:i.renderOccluded?qf(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA):null,culling:r?_Q:null,depthTest:i.renderOccluded?null:{func:Zr.LESS},depthWrite:i.renderOccluded?null:zc,colorWrite:si,stencilTest:t?Sut(Nc.IntegratedMeshMaskExcluded):null})}getPipelineState(t,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,i)}}yV.shader=new Zi(gvt,()=>Q(()=>import("./Terrain.glsl.742eca62.js"),[]));const oRe=new Map([[R.POSITION,0],[R.UV0,1],[R.NORMALCOMPRESSED,2]]);class yvt{constructor(){this.geometryInfo=new p_t,this.intersectionData=null,this.geometryState=null,this._textureRef=new OC(()=>this.tile.surface.textureFadeDuration),this.overlay=new rvt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(t){this.clear(),this._tile=t;const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,Xr(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new b_t,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(t){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(t),this._geometryStateChangedSinceLastUpdate=!1),co&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Me(this.geometryInfo.outerEdges[i].count===this.geometryState.neighborData.edgeResolutions[i]+1)}_calculateEdgeResolution(t,i){var l;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(v(c)&&(t===0&&r.extent[3]>c[3]||t===1&&r.extent[2]>c[2]||t===2&&r.extent[1]<c[1]||t===3&&r.extent[0]<c[0]))return s}const n=r.level,o=cg[t];if(!i)return Me(C((l=r.surface)==null?void 0:l.rootTiles)||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.isLoaded){const c=i,h=c.renderData.geometryState,p=n-c.level;if(Me(p>=0),p===0){const y=h.numVerticesPerSide-1;return Math.max(y,s)}const f=2**p,m=h.neighborData.edgeResolutions[(t+2)%4]/f;return Math.max(1,m)}Me(!i.isLeaf);let a=s;return i.forAllSubtreeOnSide(a6(o),c=>c===r||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(Me(!c.isLeaf),!1))),a}updateNeighborData(){var a,l,c;const t=this.tile;if(!t.intersectsClippingArea)return;const i=t.renderData.geometryState.neighborData,r=h=>(h.isLoaded||h.level===t.level)&&(h==null?void 0:h.intersectsClippingArea),s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let h=0;h<4;++h){const p=t.findNeighborTile(cg[h],r),f=Cx(t,p),m=(l=(a=f==null?void 0:f.renderData)==null?void 0:a.geometryState.samplerDataVersion)!=null?l:-1,y=s[h],_=f!==Cx(t,y),b=n[h]!==m;s[h]=p,(_||b)&&(n[h]=m,this._markEdgeDirty(h));const w=i.edgeResolutions[h],T=this._calculateEdgeResolution(h,p);Me($f(T)),Me(T>=1),i.edgeResolutions[h]=T,w!==T&&this._markEdgeResolutionDirty(h)}const o=i.cornerPeerNeighbors;for(let h=0;h<4;++h){const p=t.findNeighborTile(l6[h],r);o[h]=p;const f=Cx(t,s[h]),m=Cx(t,s[(h+1)%4]),y=Cx(t,p);Mp[h]=y,Mp[(h+1)%4]=m,Mp[(h+2)%4]=t,Mp[(h+3)%4]=f,Me(Mp.some(T=>(T==null?void 0:T.isLoaded)||T===t));const _=Mp.reduce((T,S)=>{var E;return Math.min(T,(E=S==null?void 0:S.level)!=null?E:1/0)},1/0);Mp.forEach((T,S)=>{T&&(T==null?void 0:T.level)>_&&(Mp[S]=null)}),Me(Mp.some(T=>(T==null?void 0:T.isLoaded)||T===t));const b=i.cornerNeighborData[h].cornerTiles,w=i.cornerNeighborData[h].cornerTileSamplerVersions;for(let T=0;T<4;++T){const S=Mp[T],E=(c=S==null?void 0:S.renderData.geometryState.samplerDataVersion)!=null?c:-1,M=b[T]!==S,A=!M&&w[T]!==E;(M||A)&&(b[T]=S,w[T]=E,this._markCornerDirty(h))}Me(b.some(T=>(T==null?void 0:T.isLoaded)||T===t))}co&&Me(this.geometryState.neighborData.edgeResolutions.every(h=>h>0));for(let h=0;h<4;++h)Mp[h]=null}_updateGeometry(t){if(!this.tile.intersectsClippingArea)return;co&&Me(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const i=this.tile,r=this._vao,s=this.geometryInfo.vertexAttributes,n=!r||!s||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(t)):o||a?i.updateEdgeElevations():a?i.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,g_t(this.geometryInfo),!0)}ensureTexture(t,i){return v(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),C(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){v(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(t){const i=1<<t;this._dirtyCorners|=i}_markEdgeDirty(t){const i=1<<t;this._dirtyEdges|=i}_markEdgeResolutionDirty(t){const i=1<<t;this._dirtyEdgeResolutions|=i,this._dirtyEdges|=i}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const t=this._getElevationInfo(),i=this.tile,r=t.samplerData?i.getElevationVerticesPerSide(t.maxTileLevel):i.getDefaultVerticesPerSide(),s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),t.changed&&(this._samplerDataChanged=!0,o.samplerData=t.samplerData,o.samplerDataVersion++,a=!0),xg(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=i.surface,c=l.wireframe;o.wireframe!==c&&(this._wireframeChanged=!0,o.wireframe=c,a=!0);const h=l.shading;return o.shading!==h&&(this._shadingChanged=h,o.shading=h,a=h),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(t){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=t.gl;this._vao=new Wf(t,oRe,{geometry:Uu(i.layout)},{geometry:Oi.createVertex(t,s.STATIC_DRAW,i.buffer)},Oi.createIndex(t,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(t,i=T0.Immediate){v(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,i=this.tile.layerInfo[wi.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let h=0;h<r;h++){const p=i[h];if(v(p.upsampleInfo)){const f=p.upsampleInfo.tile,m=f.layerInfo[wi.ELEVATION][h].data,y=m&&m.samplerData;t&&t[n]===y||(a=!0),s[n++]=y,o=Math.max(o,f.lij[0])}else if(p.data){const f=this.tile.surface.layerViewByIndex(h,wi.ELEVATION);if(dI(this.tile,f.layer,!1)){const m=p.data;t&&t[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}v(t)&&t.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r,s,n;const t=Sh(this.intersectionData,0,o=>o.estimatedMemoryUsage);return((r=(i=this.geometryInfo.indices)==null?void 0:i.byteLength)!=null?r:0)+((n=(s=this.geometryInfo.vertexAttributes)==null?void 0:s.byteLength)!=null?n:0)+t}get textureDescriptor(){return v(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!co)return;const t=this.tile;if(Me(t==null?void 0:t.isLoaded),!t.isLoaded||!t.intersectsClippingArea)return;const i=t.renderData;if(t.level===0)return;const r=t.surface.extent;if(v(r)&&!t.intersectsExtent(r))return;const s=cg.map((l,c)=>!!v(r)&&(c<2?-1:1)*(t.extent[3-c]-r[3-c])<0),n=t.level;Me(this._dirtyCorners===0),Me(this._dirtyEdges===0),Me(this._dirtyEdgeResolutions===0),Me(!this._numVerticesPerSideChanged),Me(!this._samplerDataChanged),Me(!this._clippingAreaChanged),Me(!this._wireframeChanged);const o=l6.map(l=>{var c;return(c=t.findNeighborCornerTileExact(l,h=>!h.intersectsClippingArea||h.isLoaded||h.level===t.level))!=null?c:null}).map(l=>l!=null&&l.intersectsClippingArea?l:null),a=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=a.cornerPeerNeighbors[l],h=o[l];Me(h===c,`Tile[${t.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${h==null?void 0:h.lij}]`)}cg.forEach((l,c)=>{if(s[c])return;const h=t.findNeighborTile(l,N=>(N.level===n||(N==null?void 0:N.isLoaded))&&(N==null?void 0:N.intersectsClippingArea));if(!h){const N=!t.surface.updatingRootTiles&&v(t.surface.rootTiles)&&t.surface.rootTiles.length>0&&t.shouldHaveNeighbor(l);return void Me(!N)}Me(h.isLoaded||h.level===t.level),Me(h===this.geometryState.neighborData.edgePeerNeighbors[c]);const p=n-h.level;if(!h.isLoaded)return Me(!h.isLeaf),void Me(p===0);const f=h.renderData;Me(ivt(t,h,l)),Me(p>=0);const m=2**p;if(p<0)return void Me(!1);const y=i.geometryInfo,_=y.outerEdges[c],b=y.numVerticesPerSide-1,w=f.geometryInfo;if(!w)return void Me(!1);{const N=this.geometryState.neighborData.edgePeerNeighbors[c];if(N!=null&&N.isLoaded){const U=N.renderData;Me(N==N),Me(i.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===U.geometryState.samplerDataVersion),Me(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===U.geometryState.samplerDataVersion)}}const T=(c+2)%4,S=w.outerEdges[T],E=_.count-1,M=S.count-1;Me(E*m===M,`Tile[${t.lij}]:e${c},res=${E} edgeRes mismatch with Neighbor[${h.lij}]:e${T},res=${M} (expected:${E*m})`);const A=t.extent,$=l===It.NORTH||l===It.SOUTH,I=S.count-1,k=I/2**p,V=_.count-1;if(k<1)return void Me(V===1);Me(k===V),Me($f(k));const B=w.numVerticesPerSide-1;Me(p>0||k===Math.max(B,b));const G=t.getNeighborEdgeStartVertexIndex(c,h);Me(0<=G&&G<m);const X=G*k;Me(0<=X&&X<=I-k);let K=0,re=X;_.getVertexPos(hm,0),_.getVertexPos(dm,_.count-1);const q=Vr(hm,dm),L=Math.max(_vt,1e-4*q);for(let N=0;N<=k;++N){_.getVertexPos(hm,K),S.getVertexPos(dm,re);const U=N/k,W=$?A[0]+U*(A[2]-A[0]):l===It.WEST?A[0]:A[2],Z=$?l===It.SOUTH?A[1]:A[3]:A[1]+U*(A[3]-A[1]),ie=t.surface.extent;if(C(ie)||j6(ie,W,Z)){const Y=t$(hm,dm),ce=pu(hm)-Mi.radius,pe=pu(dm)-Mi.radius,ve=Y<L;if(!ve){console.warn(`Tile edge vertex position mismatch: between [${t.lij}].edge${c}[${K}/${_.count}] and [${h.lij}].edge${T}[${re}/${S.count}]`),v(ie)&&console.warn("  surface extent= ",ie," x,y=",W,",",Z);const Se=O();me(Se,i.localOrigin,f.localOrigin),pu(Se)>0&&console.warn(`   localOrigins: ${i.localOrigin} vs ${f.localOrigin} d=${pu(Se)} [${Se}]`),(()=>{const We=js(hm),Ne=js(dm);t.updateEdgeElevations(),h.updateEdgeElevations(),_.getVertexPos(hm,K),S.getVertexPos(dm,re);const xe=O();Wo(xe,hm,We),pu(xe)>0&&console.warn(`  XXX Tile[${t.lij}] edge out of date: ${We} vs ${hm} d=${pu(xe)} [${xe}]`),Wo(xe,dm,Ne),pu(xe)>0&&console.warn(`  XXX Neighbor[${h.lij}] edge out of date: ${Ne} vs ${dm} d=${pu(xe)} [${xe}]`)})(),Me(ve,`Mismatch in tile [${t.lij}].edge[${c}][${K}/${_.count}] vs neighbor [${h.lij}].edge[${T}][${re}/${S.count}] ${hy(hm)} vs ${hy(dm)}  dist=${Y} h(t|n|d)=${ce}|${pe}|${pe-ce}`)}if(t.surface.shading){_.getNormal(o2,K),S.getNormal(a2,re),be(Sde,o2),be(Ede,a2);const Se=_e(Sde,Ede),We=1-Se<.01||!1||t===h;if(!We){const Ne=O();Wo(Ne,o2,a2);const xe=()=>`Mismatch in tile edge normal ${tde(t.lij)} (${K}/${_.count-1}) edge ${c} vs neighbor ${tde(h.lij)}  (${re}/${S.count-1}) nedge ${T} :${hy(o2)} vs ${hy(a2)}  dot = ${Se} : ${hy(Ne)}`;console.warn("Mismatch in tile edge normal: ",xe());{t.updateEdgeElevations(),h.updateEdgeElevations();const ke=O(),Ve=O();_.getNormal(ke,K),S.getNormal(Ve,re),U1(o2,ke)||console.warn("Missing update in tile normal: ",hy(o2)," => ",hy(ke)),U1(a2,Ve)||console.warn("Missing update in neighbor normal: ",hy(a2)," => ",hy(Ve))}Me(We,xe())}}}K+=1,re+=1}})}}const hm=O(),dm=O(),o2=O(),a2=O(),Sde=O(),Ede=O(),_vt=1,Mp=[null,null,null,null];function Cx(e,t){return(t==null?void 0:t.isLoaded)||t===e?t:null}const vvt=65536;function bvt(e,t){const i=e.tile,{extent:r,extentInRadians:s,surface:n}=i,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shading||HT,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(t===Ud.HAS_SOUTH_POLE||t===Ud.HAS_BOTH_POLES),y=l&&(t===Ud.HAS_NORTH_POLE||t===Ud.HAS_BOTH_POLES),_=6,b=((m?1:0)+(y?1:0))*_*(p+1),w=a.neighborData,T=w.edgeResolutions.reduce((I,k)=>I+k+1,0),S=YMe(f+b+T),E=e.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=S;const M=E.boundingBox;Xr(M);const A=Ete(e);zn.update(p,s,A),wvt(e),mRe(e,f),aRe(e);const $=[];if((()=>{let I=f+T;const k=o[0],V=o[1],B=o[2],G=i.ellipsoid.radius,X=r[1],K=r[3],re=(q,L)=>{const N=L*h;Yl(-k,-V,q*G-B,M),$.push({connectedRowOffset:N,connectedOuterEdgeOffset:q===1?0:2,rowOffset:I,latitudeResolution:_});const U=uRe(q===-1?X:K,G),W=q*Math.PI/2-U,Z=.99*(q===1?1:-1),ie=G+0,Y=S.position,ce=S.uv0,pe=S.normalCompressed;for(let ve=1;ve<=_;++ve){const Se=U+W*(ve/_),We=Math.cos(Se),Ne=Math.sin(Se);for(let xe=0;xe<=p;xe++){const ke=xe/p,Ve=zn.sinLonLUT[xe],Et=zn.cosLonLUT[xe]*We,it=Ve*We,Gt=Ne,Kt=Et*ie-k,ni=it*ie-V,Qt=Gt*ie-B;Yl(Kt,ni,Qt,M),Y.setValues(I,Kt,ni,Qt),$u(ce,I,ke,Z),c&&qP(pe,I,Et,it,Gt),++I}}};m&&re(-1,0),y&&re(1,p)})(),fRe(E,a.numVerticesPerSide,$,[0,h-1],[0,h-1],a.wireframe),e.intersectionData=null,co)for(let I=0;I<4;++I)Me(E.outerEdges[I].count===w.edgeResolutions[I]+1)}function wvt(e){const t=e.tile;t.intersectsClippingArea&&(t.surface.shading||HT?Tvt(e):xvt(e))}function xvt(e){const t=e.geometryState,i=t.numVerticesPerSide,r=i-2,s=i-1,n=e.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=e.tile,h=c.extent,p=h[0],f=h[2],m=h[1],y=h[3],_=c.ellipsoid.radius,b=t.samplerData,w=e.localOrigin,T=w[0],S=w[1],E=w[2],M=n.boundingBox,A=a.typedBuffer,$=a.typedBufferStride;let I=0;for(let k=1;k<=r;k++){const V=k/s,B=m*(1-V)+y*V,G=zn.sinLatLUT[k],X=zn.cosLatLUT[k];for(let K=1;K<=r;K++){const re=K/s,q=p*(1-re)+f*re,L=zn.sinLonLUT[K],N=zn.cosLonLUT[K],U=_+cs(q,B,b),W=N*X*U-T,Z=L*X*U-S,ie=G*U-E;Yl(W,Z,ie,M);const Y=I*$;A[Y]=W,A[Y+1]=Z,A[Y+2]=ie,$u(l,I,re,V),++I}}}function Tvt(e){const t=e.geometryState,i=t.numVerticesPerSide,r=i-2,s=i-1,n=e.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=o.normalCompressed,h=e.tile,p=h.extent,f=p[0],m=p[2],y=p[1],_=p[3],b=h.ellipsoid.radius,w=t.samplerData,T=e.localOrigin,S=T[0],E=T[1],M=T[2],A=a.typedBuffer,$=a.typedBufferStride,I=1/s,k=n.boundingBox;let V=0;if(1<=r){const B=I,G=y*(1-B)+_*B,X=zn.sinLatLUT[1],K=zn.cosLatLUT[1];for(let re=1;re<=r;re++){const q=re*I,L=f*(1-q)+m*q,N=zn.sinLonLUT[re],U=zn.cosLonLUT[re],W=b+cs(L,G,w),Z=W*U*K-S,ie=W*N*K-E,Y=W*X-M;Yl(Z,ie,Y,k);const ce=(re-1)*$;A[ce]=Z,A[ce+1]=ie,A[ce+2]=Y,$u(l,re-1,q,B)}}for(let B=1;B<=r;B++){const G=B*I,X=y*(1-G)+_*G,K=zn.sinLatLUT[B],re=zn.cosLatLUT[B],q=B+1,L=q*I,N=y*(1-L)+_*L,U=zn.sinLatLUT[q],W=zn.cosLatLUT[q],Z=zn.sinLonLUT[0],ie=zn.cosLonLUT[0],Y=b+cs(f,X,w);let ce=ie*re*Y-S,pe=Z*re*Y-E,ve=K*Y-M;const Se=V*$;let We=A[Se],Ne=A[Se+1],xe=A[Se+2];for(let ke=1;ke<=r;ke++){const Ve=ke*I,Et=f*(1-Ve)+m*Ve,it=zn.sinLonLUT[ke],Gt=zn.cosLonLUT[ke];let Kt=Gt*re,ni=it*re,Qt=K,Ti=0,pr=0,Fi=0;{let Ki=0,$e=0,qe=0;if(ke<r){const rr=(V+1)*$;Ki=A[rr],$e=A[rr+1],qe=A[rr+2]}else{const rr=zn.sinLonLUT[s],$i=zn.cosLonLUT[s],Hi=b+cs(m,X,w);Ki=$i*re*Hi-S,$e=rr*re*Hi-E,qe=K*Hi-M}const ft=ce,At=pe,Xt=ve;ce=We,pe=Ne,ve=xe,We=Ki,Ne=$e,xe=qe,Ti=Ki-ft,pr=$e-At,Fi=qe-Xt}{let Ki=0,$e=0,qe=0;if(B>1){const ft=(V-r)*$;Ki=A[ft],$e=A[ft+1],qe=A[ft+2]}else{const ft=zn.sinLatLUT[0],At=zn.cosLatLUT[0],Xt=b+cs(Et,y,w);Ki=Gt*At*Xt-S,$e=it*At*Xt-E,qe=ft*Xt-M}{const ft=b+cs(Et,N,w),At=Gt*W*ft-S,Xt=it*W*ft-E,rr=U*ft-M;if(B<r){const Gr=V+r,oi=Gr*$;A[oi]=At,A[oi+1]=Xt,A[oi+2]=rr,Yl(At,Xt,rr,k),$u(l,Gr,Ve,L)}const $i=Ki-At,Hi=$e-Xt,qi=qe-rr;Qt*Qt<.999&&(Kt=Fi*Hi-pr*qi,ni=Ti*qi-Fi*$i,Qt=pr*$i-Ti*Hi)}}const Pi=1/Math.sqrt(Kt*Kt+ni*ni+Qt*Qt);qP(c,V,Kt*Pi,ni*Pi,Qt*Pi),++V}}}function Svt(e){e.tile.intersectsClippingArea&&(aRe(e),_V(e))}function Evt(e){e.tile.intersectsClippingArea&&(cRe(e),lRe(e,!0),_V(e))}function aRe(e){e.tile.intersectsClippingArea&&(cRe(e),lRe(e))}function lRe(e,t=!1){const i=e.geometryState,r=e.geometryInfo,s=i.neighborData,n=e.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],p=c[2],f=c[1],m=c[3],y=i.samplerData,_=a[0],b=a[2],w=a[1],T=a[3],S=Ete(e),E=r.boundingBox,M=e.localOrigin,A=M[0],$=M[1],I=M[2],k=n.surface.shading||HT,V=r.vertexAttributes,B=V.position,G=B.typedBuffer,X=B.typedBufferStride,K=V.uv0;for(let re=0;re<4;++re){const q=re===1||re===3,L=s.edgeResolutions[re];Me($f(L));const N=L+1,U=Cx(n,s.edgePeerNeighbors[re]);if(_Re(n,U,re)){gRe(e,re,U);continue}const W=v(U);Me(!W||U.level===n.level),Me(!W||S0(n,U)<=0);const Z=U==null?void 0:U.renderData,ie=Z==null?void 0:Z.geometryState;if(co){const $e=n.surface;if(!U&&$e&&!$e.updatingRootTiles){const qe=cg[re],ft=n.findNeighborTile(qe,At=>At.isLoaded||At.isLeaf||At.level===n.level);ft?ft.intersectsClippingArea&&(Me(!ft.isLoaded),Me(!ft.isLeaf),Me(ft.level===o)):Me(C($e==null?void 0:$e.rootTiles)||!n.shouldHaveNeighbor(qe))}}const Y=re===1?a[2]:a[0],ce=U==null?void 0:U.extent,pe=ce&&q?re===1?ce[0]:ce[2]:Y,ve=re===0?a[3]:a[1],Se=re===1?1:0,We=re===0?1:0,Ne=re===1?p:h,xe=re===0?m:f,ke=Math.sin(Ne),Ve=Math.cos(Ne),Et=Math.sin(xe),it=Math.cos(xe),Gt=ie==null?void 0:ie.samplerData,Kt=W?($e,qe,ft)=>.5*(cs($e,qe,y)+cs(ft,qe,Gt)):($e,qe,ft)=>cs($e,qe,y),ni=r.outerEdges[re],Qt=t&&N>3?N-3:1,Ti=v(y)&&y.some($e=>$e!=null),pr=v(Gt)&&Gt.some($e=>$e!=null),Fi=Ti||pr,Pi=1/L,Ki=ni.index0;k?(Me(!ce||Vd(ce[2]-ce[0],a[2]-a[0])),(()=>{const $e=re===1?-1:re===3?1:0,qe=re===0?-1:re===2?1:0,ft=(a[2]-a[0])*Pi,At=$e*ft,Xt=qe*ft,rr=q?$e*((p-h)*Pi):0,$i=q?0:qe*Pi,Hi=We,qi=q?Ne+rr:Ne,Gr=q?Math.sin(qi):ke,oi=q?Math.cos(qi):Ve,Si=q?Ne-rr:Ne,vi=q?Math.sin(Si):ke,Ns=q?Math.cos(Si):Ve,vr=q?xe:S(Hi+$i),fs=q?Et:Math.sin(vr),Or=q?it:Math.cos(vr),rs=q?xe:S(Hi-$i),ks=q?Et:Math.sin(rs),fn=q?it:Math.cos(rs);let ia=0,Oo=0,Js=0;{const br=0*Pi,Ia=q?Y:_*(1-br)+b*br,Kl=q?pe:Ia,de=q?w*(1-br)+T*br:ve,Lr=q?Ne:h*(1-br)+p*br,_p=q?ke:Math.sin(Lr),Ya=q?Ve:Math.cos(Lr),Vu=q?S(br):xe,mt=q?Math.sin(Vu):Et,Gc=q?Math.cos(Vu):it,Ms=l+Kt(Ia,de,Kl);ia=Ya*Gc*Ms,Oo=_p*Gc*Ms,Js=mt*Ms}let ms=0,gs=0,Ks=0;{const br=1*Pi,Ia=q?Y:_*(1-br)+b*br,Kl=q?pe:Ia,de=q?w*(1-br)+T*br:ve,Lr=q?Ne:h*(1-br)+p*br,_p=q?ke:Math.sin(Lr),Ya=q?Ve:Math.cos(Lr),Vu=q?S(br):xe,mt=q?Math.sin(Vu):Et,Gc=q?Math.cos(Vu):it,Ms=l+Kt(Ia,de,Kl);ms=Ya*Gc*Ms,gs=_p*Gc*Ms,Ks=mt*Ms}for(let br=1;br<N-1;br+=Qt){let Ia=0,Kl=0,de=0;{const Pa=(br+1)*Pi,Jh=q?Y:_*(1-Pa)+b*Pa,Kh=q?pe:Jh,wr=q?w*(1-Pa)+T*Pa:ve,Yf=q?Ne:h*(1-Pa)+p*Pa,Yg=q?ke:Math.sin(Yf),dS=q?Ve:Math.cos(Yf),xb=q?S(Pa):xe,pS=q?Math.sin(xb):Et,Tb=q?Math.cos(xb):it,u_=l+Kt(Jh,wr,Kh);Ia=dS*Tb*u_,Kl=Yg*Tb*u_,de=pS*u_}const Lr=Ia,_p=Kl,Ya=de,Vu=ms,mt=gs,Gc=Ks;ms=Lr,gs=_p,Ks=Ya;{const Pa=Ki+br,Jh=Pa*X,Kh=Vu-A,wr=mt-$,Yf=Gc-I;G[Jh]=Kh,G[Jh+1]=wr,G[Jh+2]=Yf,Yl(Kh,wr,Yf,E);const Yg=br*Pi;$u(K,Pa,q?Se:Yg,q?Yg:We)}const Ms=ia,wb=Oo,jV=Js;ia=Vu,Oo=mt,Js=Gc;const Ql=Vu,a_=mt,Wg=Gc,ai=1/Math.sqrt(Ql*Ql+a_*a_+Wg*Wg),sL=Wg*ai;let Xg=0,l_=0,c_=0;if(Fi&&sL*sL<.999){let Pa=0,Jh=0,Kh=0;{const wr=re===0?-1:1;Pa=wr*(Lr-Ms),Jh=wr*(_p-wb),Kh=wr*(Ya-jV)}{const wr=br*Pi,Yf=q?Y:_*(1-wr)+b*wr,Yg=q?pe:Yf,dS=q?w*(1-wr)+T*wr:ve,xb=q?Ne:h*(1-wr)+p*wr,pS=q?ke:Math.sin(xb),Tb=q?Ve:Math.cos(xb),u_=q?S(wr):xe,ec=q?Math.sin(u_):Et,nL=q?Math.cos(u_):it;let OM=Ql,J=a_,we=Wg;if(W){const Re=l+cs(Yg-At,dS-Xt,Gt),bi=q?nL:fn;OM=(q?Ns:Tb)*bi*Re,J=(q?vi:pS)*bi*Re,we=(q?ec:ks)*Re}{const Re=l+cs(Yf+At,dS+Xt,y),bi=q?nL:Or,Io=(q?oi:Tb)*bi*Re,Qs=(q?Gr:pS)*bi*Re,tc=(q?ec:fs)*Re;W||(OM=2*Ql-Io,J=2*a_-Qs,we=2*Wg-tc);const h_=re===3?-1:1,jte=h_*(OM-Io),Hte=h_*(J-Qs),qte=h_*(we-tc);Xg=Kh*Hte-Jh*qte,l_=Pa*qte-Kh*jte,c_=Jh*jte-Pa*Hte;const HV=1/Math.sqrt(Xg*Xg+l_*l_+c_*c_);Xg*=HV,l_*=HV,c_*=HV}}}else Xg=Ql*ai,l_=a_*ai,c_=Wg*ai;ni.setNormalFromValues(br,Xg,l_,c_)}})()):(()=>{for(let $e=1;$e<N-1;$e+=Qt){const qe=$e*Pi,ft=q?Se:qe,At=q?qe:We,Xt=q?Y:_*(1-qe)+b*qe,rr=q?w*(1-qe)+T*qe:ve,$i=q?pe:Xt,Hi=q?Ne:h*(1-qe)+p*qe,qi=q?ke:Math.sin(Hi),Gr=q?Ve:Math.cos(Hi),oi=q?S(qe):xe,Si=q?Math.sin(oi):Et,vi=q?Math.cos(oi):it,Ns=Kt(Xt,rr,$i),vr=l+Ns,fs=Gr*vi*vr-A,Or=qi*vi*vr-$,rs=Si*vr-I;Yl(fs,Or,rs,E);const ks=Ki+$e,fn=ks*X;G[fn]=fs,G[fn+1]=Or,G[fn+2]=rs,$u(K,ks,ft,At)}})()}}function cRe(e){yRe(e)}function uRe(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function Cvt(e,t,i,r){return uRe(e*(1-r)+t*r,i)}function Avt(e,t,i){return e*(1-i)+t*i}function Ete(e){const t=e.tile;if(t.surface.isWebMercator){const r=t.extent,s=t.ellipsoid.radius;return n=>Cvt(r[1],r[3],s,n)}const i=t.extentInRadians;return r=>Avt(i[1],i[3],r)}function Mvt(e,t){const i=e.tile.extent,r=e.geometryState,s=i[0],n=i[1],o=i[2]-s,a=i[3]-n,l=r.clippingArea,c=v(l)?Math.max(0,(l[0]-s)/o):0,h=v(l)?Math.max(0,(l[1]-n)/a):0,p=v(l)?Math.min(1,(l[2]-s)/o):1,f=v(l)?Math.min(1,(l[3]-n)/a):1,m=r.numVerticesPerSide,y=(m-2)**2,_=r.neighborData.edgeResolutions.reduce((S,E)=>S+E+1,0),b=YMe(y+_),w=e.geometryInfo,T=w.boundingBox;Xr(T),w.numVerticesPerSide=r.numVerticesPerSide,w.vertexAttributes=b,mr(w.uvRange,c,h,p,f),Rvt(e),mRe(e,y),hRe(e),fRe(w,r.numVerticesPerSide,[],[0,m-1],[0,m-1],r.wireframe),e.intersectionData=null}function Rvt(e){const t=e.tile;t.intersectsClippingArea&&(t.surface.shading?Ivt(e):Ovt(e))}function Ovt(e){const t=e.geometryState,i=t.samplerData,r=e.tile,s=r.surface,n=e.localOrigin,o=s.isWebMercatorOnPlateeCarree,a=t.clippingArea,l=v(a)?a:vV,c=r.extent,h=c[0],p=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),w=Math.min(m,l[3]),T=n[0],S=n[1],E=n[2],M=r.ellipsoid.radius,A=r.horizontalScale,$=Cte(o,M,A),I=t.numVerticesPerSide,k=I-1,V=I-2,B=e.geometryInfo,G=B.uvRange,X=G[0],K=G[1],re=G[2],q=G[3],L=B.boundingBox,N=B.vertexAttributes,U=N.position,W=N.uv0;let Z=0;for(let ie=1;ie<=V;ie++){const Y=ie/k,ce=ye(p*(1-Y)+m*Y,b,w),pe=ye(Y,K,q),ve=$(ce)-S;for(let Se=1;Se<=V;Se++){const We=Se/k,Ne=ye(h*(1-We)+f*We,y,_),xe=ye(We,X,re),ke=Ne*A-T,Ve=cs(Ne,ce,i)-E;Yl(ke,ve,Ve,L),U.setValues(Z,ke,ve,Ve),$u(W,Z,xe,pe),++Z}}}function Ivt(e){const t=e.tile,i=t.surface;if(!(i.shading||HT))return;const r=e.geometryState,s=r.samplerData,n=e.localOrigin,o=i.isWebMercatorOnPlateeCarree,a=r.clippingArea,l=v(a)?a:vV,c=t.extent,h=c[0],p=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),w=Math.min(m,l[3]),T=t.ellipsoid.radius,S=t.horizontalScale,E=r.numVerticesPerSide,M=E-1,A=E-2,$=e.geometryInfo,I=$.vertexAttributes,k=I.position,V=I.uv0,B=I.normalCompressed,G=$.uvRange,X=G[0],K=G[1],re=G[2],q=G[3],L=$.boundingBox,N=n[0],U=n[1],W=n[2],Z=k.typedBuffer,ie=k.typedBufferStride;let Y=0;const ce=ye(p,b,w),pe=o?(Math.PI/2-2*Math.atan(Math.exp(-ce/T)))*T:ce*S,ve=1/M,Se=ye(p*(1-ve)+m*ve,b,w);let We=pe,Ne=o?(Math.PI/2-2*Math.atan(Math.exp(-Se/T)))*T:Se*S;for(let xe=1;xe<=A;xe++){const ke=xe/M,Ve=ye(p*(1-ke)+m*ke,b,w),Et=ye(ke,K,q),it=Ne,Gt=(xe-1)/M,Kt=ye(p*(1-Gt)+m*Gt,b,w),ni=We,Qt=(xe+1)/M,Ti=ye(p*(1-Qt)+m*Qt,b,w),pr=o?(Math.PI/2-2*Math.atan(Math.exp(-Ti/T)))*T:Ti*S,Fi=ye(Qt,K,q);We=Ne,Ne=pr;const Pi=ye(h,y,_);let Ki=Pi*S,$e=cs(Pi,Ve,s);const qe=1/M,ft=ye(qe,X,re),At=ye(h*(1-ft)+f*ft,y,_);let Xt=ft,rr=At,$i=At*S,Hi=cs(At,Ve,s);if(xe===1){const qi=$i-N,Gr=We-U,oi=Hi-W,Si=0*ie;Z[Si]=qi,Z[Si+1]=Gr,Z[Si+2]=oi,Yl(qi,Gr,oi,L);const vi=ye(qe,X,re);$u(V,Y,vi,Et)}for(let qi=1;qi<=A;qi++){const Gr=$i,oi=Hi,Si=(qi+1)/M,vi=ye(Si,X,re),Ns=ye(h*(1-Si)+f*Si,y,_),vr=rr;rr=Ns;{const Js=Y+1,ms=Js*ie;if(xe===1||qi===A){const gs=Ns*S,Ks=cs(Ns,Ve,s);if(xe===1&&qi<A){const br=gs-N,Ia=it-U,Kl=Ks-W;Z[ms]=br,Z[ms+1]=Ia,Z[ms+2]=Kl,Yl(br,Ia,Kl,L),$u(V,Js,vi,Et)}$i=gs,Hi=Ks}else $i=Z[ms]+N,Hi=Z[ms+2]+W}const fs=$i,Or=Hi,rs=Ki,ks=$e;Ki=Gr,$e=oi;const fn=(Y-A)*ie,ia=xe===1?cs(vr,Kt,s):Z[fn+2]+W,Oo=cs(vr,Ti,s);if(xe<A){const Js=Y+A,ms=Js*ie,gs=Gr-N,Ks=pr-U,br=Oo-W;Z[ms]=gs,Z[ms+1]=Ks,Z[ms+2]=br,Yl(gs,Ks,br,L);const Ia=Xt;Xt=vi,$u(V,Js,Ia,Fi)}{const Js=fs-rs,ms=ni-pr,gs=ms*(Or-ks),Ks=Js*(ia-Oo),br=-ms*Js,Ia=gs*gs+Ks*Ks+br*br;if(Ia===0)qP(B,Y,0,0,1);else{const Kl=1/Math.sqrt(Ia);qP(B,Y,gs*Kl,Ks*Kl,br*Kl)}}++Y}}}function Pvt(e,t){e.tile.intersectsClippingArea&&(pRe(e),dRe(e,!0),_V(e))}function $vt(e,t){e.tile.intersectsClippingArea&&(hRe(e),_V(e))}function hRe(e,t){e.tile.intersectsClippingArea&&(pRe(e),dRe(e,!1))}function dRe(e,t){const i=e.geometryState,r=i.neighborData,s=e.tile,n=s.surface,o=n.shading||HT,a=s.extent,l=i.clippingArea,c=v(l)?l:vV,h=a[0],p=a[2],f=a[1],m=a[3],y=[m>c[3],p>c[2],f<c[1],h<c[0]],_=e.geometryInfo,b=s.horizontalScale,w=Cte(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,b),T=_.boundingBox,S=_.uvRange[0],E=_.uvRange[1],M=_.uvRange[2],A=_.uvRange[3],$=Math.max(h,c[0]),I=Math.min(p,c[2]),k=Math.max(f,c[1]),V=Math.min(m,c[3]),B=e.localOrigin,G=B[0],X=B[1],K=B[2],re=i.samplerData;for(let q=0;q<4;++q){const L=q===1||q===3,N=r.edgeResolutions[q];Me($f(N));const U=N+1,W=y[q],Z=Cx(s,r.edgePeerNeighbors[q]);if(!W&&_Re(s,Z,q)){gRe(e,q,Z);continue}const ie=v(Z)&&!W,Y=Z==null?void 0:Z.renderData,ce=Y==null?void 0:Y.geometryState;if(co&&(Me(!ie||Z.level===s.level),Me(!ie||S0(s,Z)<=0),s&&!Z&&!n.updatingRootTiles)){const Et=cg[q],it=s.findNeighborTile(Et,Gt=>Gt.isLoaded||Gt.isLeaf||Gt.level===s.level);n.updatingRootTiles||(it?it.intersectsClippingArea&&(Me(!it.isLoaded),Me(!it.isLeaf),Me(it.level===s.level)):Me(C(n==null?void 0:n.rootTiles)||!s.shouldHaveNeighbor(Et)))}const pe=ye(q===1?p:h,$,I),ve=ye(q===0?m:f,k,V),Se=ce==null?void 0:ce.samplerData,We=_.outerEdges[q],Ne=t&&U>3?U-3:1,xe=ye(q===1?1:0,S,M),ke=ye(q===0?1:0,E,A),Ve=ie?(Et,it)=>.5*(cs(Et,it,Se)+cs(Et,it,re)):(Et,it)=>cs(Et,it,re);if(o){const Et=(p-h)/N,it=L?q===1?Et:-Et:0,Gt=L?0:q===0?Et:-Et,Kt=-it,ni=-Gt;let Qt=0,Ti=0,pr=0;{const $e=0/N,qe=L?pe:ye(h*(1-$e)+p*$e,$,I),ft=L?ye(f*(1-$e)+m*$e,k,V):ve,At=Ve(qe,ft);Qt=qe*b,Ti=w(ft),pr=At}let Fi=0,Pi=0,Ki=0;{const $e=1/N,qe=L?pe:ye(h*(1-$e)+p*$e,$,I),ft=L?ye(f*(1-$e)+m*$e,k,V):ve,At=Ve(qe,ft);Fi=qe*b,Pi=w(ft),Ki=At}for(let $e=1;$e<U-1;$e+=Ne){const qe=$e/N,ft=Fi,At=Pi,Xt=Ki;{const vr=L?xe:ye(qe,S,M),fs=L?ye(qe,E,A):ke,Or=ft-G,rs=At-X,ks=Xt-K;Yl(ft,rs,ks,T),We.setVertexFromValuesRawPositionUV($e,Or,rs,ks,vr,fs)}{const vr=($e+1)/N,fs=L?pe:ye(h*(1-vr)+p*vr,$,I),Or=L?ye(f*(1-vr)+m*vr,k,V):ve,rs=Ve(fs,Or);Fi=fs*b,Pi=w(Or),Ki=rs}const rr=Fi,$i=Ki,Hi=Qt,qi=Ti,Gr=pr;Qt=ft,Ti=At,pr=Xt;let oi=0,Si=0,vi=0;if(L){const vr=Pi-At,fs=$i-Xt,Or=qi-At,rs=Gr-Xt,ks=ye(f*(1-qe)+m*qe,k,V),fn=pe+Kt,ia=fn*b-ft,Oo=cs(fn,ks,re)-Xt,Js=q===3?-1:1;if(oi=Js*(-Or+vr)*Oo,Si=Js*ia*(-rs+fs),vi=-Js*ia*(-Or+vr),ie){const ms=pe+it,gs=ms*b-ft;oi=(-Or+vr)*(Oo-(cs(ms,ks,Se)-Xt)),Si=(ia-gs)*(-rs+fs),vi=-(ia-gs)*(-Or+vr)}}else{const vr=rr-ft,fs=$i-Xt,Or=Hi-ft,rs=Gr-Xt,ks=ye(h*(1-qe)+p*qe,$,I),fn=ve+ni,ia=cs(ks,fn,re)-Xt,Oo=w(fn)-At,Js=q===2?-1:1;if(oi=Js*Oo*(-rs+fs),Si=Js*(-Or+vr)*ia,vi=-Js*Oo*(-Or+vr),ie){const ms=ks,gs=ve+Gt,Ks=w(gs)-At;oi=(-Oo+Ks)*(-rs+fs),Si=(-Or+vr)*(-ia+(cs(ms,gs,Se)-Xt)),vi=-(-Oo+Ks)*(-Or+vr)}}const Ns=1/Math.sqrt(oi*oi+Si*Si+vi*vi);We.setNormalFromValues($e,oi*Ns,Si*Ns,vi*Ns)}}else for(let Et=1;Et<U-1;Et+=Ne){const it=Et/N,Gt=L?pe:ye(h*(1-it)+p*it,$,I),Kt=L?ye(f*(1-it)+m*it,k,V):ve,ni=L?xe:ye(it,S,M),Qt=L?ye(it,E,A):ke,Ti=Ve(Gt,Kt),pr=Gt*b-G,Fi=w(Kt)-X,Pi=Ti-K;Yl(pr,Fi,Pi,T),We.setVertexFromValuesRawPositionUV(Et,pr,Fi,Pi,ni,Qt)}}}function pRe(e,t){yRe(e)}function Lvt(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function Dvt(e,t){return e*t}function Cte(e,t,i){return e?r=>Lvt(r,t):r=>Dvt(r,i)}function fRe(e,t,i,r,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,r[1])-Math.max(1,r[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=cg.map((S,E)=>E===0&&s[1]<t-2||E===1&&r[1]<t-2||E===2&&s[0]>1||E===3&&r[0]>1),h=e.outerEdges.reduce((S,E,M)=>S+(c[M]?0:o-2+E.count-1),0),p=i.reduce((S,E)=>S+o*(2*(E.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+h+p)*f,y=a>=vvt?new Uint32Array(m):new Uint16Array(m);let _=0;const b=t-2,w=o-2;Me(w>=0);const T=(S,E,M,A,$,I)=>{const k=S*$,V=I[k],B=I[k+1],G=I[k+2],X=E*$,K=I[X],re=I[X+1],q=I[X+2],L=M*$,N=I[L],U=I[L+1],W=I[L+2],Z=A*$,ie=I[Z],Y=I[Z+1],ce=I[Z+2];return(K-ie)*(K-ie)+(re-Y)*(re-Y)+(q-ce)*(q-ce)>(V-N)*(V-N)+(B-U)*(B-U)+(G-W)*(G-W)};if(n){const S=(M,A,$)=>{y[_++]=M,y[_++]=A,y[_++]=A,y[_++]=$,y[_++]=$,y[_++]=M,co&&(Me(M<a),Me(A<a),Me($<a),Me(_<=m))};(()=>{for(let M=Math.max(s[0],1)-1;M<Math.min(s[1],t-2)-1;++M){const A=M*b;for(let $=Math.max(r[0],1)-1;$<Math.min(r[1],t-2)-1;++$){const I=M*b+$,k=I+1,V=k+b,B=V-1,G=A+$,X=G+1,K=X+b,re=K-1,q=e.vertexAttributes.position.typedBuffer,L=e.vertexAttributes.position.typedBufferStride;T(G,X,K,re,L,q)?(S(I,k,V),S(V,B,I)):(S(I,k,B),S(B,V,k))}}})(),Me(_===3*l*f),(()=>{for(let M=0;M<4;++M){const A=_;if(c[M])continue;const $=e.outerEdges[M],I=e.innerEdges[M];let k=0,V=0;const B=$.count,G=I.count;Me(G===o-1);let X=0;const K=M===1||M===2?(re,q,L)=>S(re,q,L):(re,q,L)=>S(re,L,q);for(;k<B-1||V<G-1;){const re=I.getVertexIndex(V),q=$.getVertexIndex(k),L=k<B-1,N=V<G-1;L&&(!N||(L?0+o*(k+.5)/(B-1):0)<=(N?1+w*(V+.5)/(G-1):0))?(++k,co&&Me(k<B),K(re,q,$.getVertexIndex(k)),X++):(++V,co&&Me(V<G),K(re,q,I.getVertexIndex(V)),X++)}co&&(Me(k===B-1),Me(V===G-1),Me(X===B+G-2),Me(X===o-2+$.count-1),Me(_===A+3*X*f))}})(),Me(_===3*(l+h)*f);const E=M=>{const A=e.outerEdges[M.connectedOuterEdgeOffset];let $=A.getVertexIndex(0),I=A.stride;for(let k=0;k<M.latitudeResolution;++k){const V=k===0?M.rowOffset:$+t;for(let B=0;B<o;B++)S($,$+1,V+B),k<M.latitudeResolution-1&&S($+1,V+B+1,V+B),$+=I;$=V,I=1}};i.forEach(E)}else{(()=>{const E=Math.max(s[0],1)-1,M=Math.min(s[1],t-2)-1,A=Math.max(r[0],1)-1,$=Math.min(r[1],t-2)-1;for(let I=E;I<M;++I){const k=I*b;for(let V=A;V<$;++V){const B=k+V,G=B+1,X=G+b,K=X-1,re=e.vertexAttributes.position.typedBuffer,q=e.vertexAttributes.position.typedBufferStride;T(B,G,X,K,q,re)?(y[_]=B,y[_+1]=G,y[_+2]=X,y[_+3]=X,y[_+4]=K,y[_+5]=B):(y[_]=B,y[_+1]=G,y[_+2]=K,y[_+3]=K,y[_+4]=G,y[_+5]=X),_+=6}}})(),Me(_===3*l*f),(()=>{for(let E=0;E<4;++E){if(c[E])continue;const M=e.outerEdges[E],A=e.innerEdges[E];let $=0,I=0;const k=M.count,V=A.count;Me(V===o-1);const B=E===1||E===2,G=B?1:2,X=B?2:1,K=M.index0,re=M.stride,q=A.index0,L=A.stride;for(;$<k-1||I<V-1;){const N=q+I*L,U=K+$*re,W=$<k-1,Z=I<V-1,ie=W&&(!Z||(W?0+o*($+.5)/(k-1):0)<=(Z?1+w*(I+.5)/(V-1):0));ie?++$:++I;const Y=ie?U+re:N+L;y[_]=N,y[_+G]=U,y[_+X]=Y,_+=3}}})(),Me(_===3*(l+h)*f);const S=E=>{const M=e.outerEdges[E.connectedOuterEdgeOffset];let A=M.getVertexIndex(0),$=M.stride;for(let I=0;I<E.latitudeResolution;++I){const k=I===0?E.rowOffset:A+t;for(let V=0;V<o;V++){const B=k+V;y[_]=A,y[_+1]=A+1,y[_+2]=B,I<E.latitudeResolution-1?(y[_+3]=A+1,y[_+4]=B+1,y[_+5]=B,_+=6):_+=3,A+=$}A=k,$=1}};i.forEach(S)}Me(_===m),e.indices=y,e.indexCount=m}function mRe(e,t){const i=e.localOrigin,r=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new dde(o,i,h,p,n)}{const c=a,h=s[l]+1;r.outerEdges[l]=new dde(o,i,c,1,h),a+=h}}}function gRe(e,t,i){const r=(t+2)%4,s=e.geometryState,n=e.tile,o=s.neighborData,a=n.level-i.level,l=t===1||t===3,c=o.edgeResolutions[t];Me($f(c));const h=c+1,p=e.geometryInfo,f=p.boundingBox,m=p.outerEdges[t],y=p.uvRange[0],_=p.uvRange[1],b=p.uvRange[2],w=p.uvRange[3],T=ye(t===1?1:0,y,b),S=ye(t===0?1:0,_,w),E=i.renderData,M=E.geometryState,A=E.geometryInfo.outerEdges[r],$=n.getNeighborEdgeStartVertexIndex(t,i)*c,I=c*2**a;Me(M.neighborData.edgeResolutions[r]===I),Me(A.count-1===I);const k=E.localOrigin[0]-e.localOrigin[0],V=E.localOrigin[1]-e.localOrigin[1],B=E.localOrigin[2]-e.localOrigin[2],G=m.attributes,X=m.index0,K=m.stride,re=G.position.typedBuffer,q=G.position.typedBufferStride,L=G.normalCompressed.typedBuffer,N=G.normalCompressed.typedBufferStride,U=G.uv0,W=A.attributes,Z=A.index0,ie=A.stride,Y=W.position.typedBuffer,ce=W.position.typedBufferStride,pe=W.normalCompressed.typedBuffer,ve=W.normalCompressed.typedBufferStride;for(let Se=1;Se<h-1;++Se){const We=X+K*Se,Ne=Z+ie*($+Se),xe=We*q,ke=Ne*ce,Ve=Y[ke]+k,Et=Y[ke+1]+V,it=Y[ke+2]+B;re[xe]=Ve,re[xe+1]=Et,re[xe+2]=it,Yl(Ve,Et,it,f);const Gt=We*N,Kt=Ne*ve;L[Gt]=pe[Kt],L[Gt+1]=pe[Kt+1];const ni=Se/c,Qt=l?T:ye(ni,y,b),Ti=l?ye(ni,_,w):S;$u(U,We,Qt,Ti)}}function yRe(e){var ke;const t=e.geometryState,i=t.neighborData,r=e.localOrigin,s=i.cornerNeighborData,n=e.geometryInfo,o=n.outerEdges,a=n.boundingBox,l=e.tile,c=((ke=e.tile.surface.view)==null?void 0:ke.viewingMode)==="local",h=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let m=0,y=0,_=0;const b=(Ve,Et,it)=>{const Gt=p[Et===0?1:3],Kt=p[Ve===0?0:2],ni=Math.cos(Gt),Qt=Math.sin(Gt),Ti=Math.sin(Kt),pr=Math.cos(Kt),Fi=h+it;m=pr*ni*Fi,y=Ti*ni*Fi,_=Qt*Fi},w=c?(()=>{const Ve=e.geometryState.clippingArea,Et=l.extent,it=v(Ve)&&(Et[3]>Ve[3]||Et[2]>Ve[2]||Et[1]<Ve[1]||Et[0]<Ve[0]),Gt=Cte(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Kt,ni,Qt)=>{const Ti=Kt===0?X[0]:X[2],pr=ni===0?X[1]:X[3],Fi=it?ye(Ti,Ve[0],Ve[2]):Ti,Pi=it?ye(pr,Ve[1],Ve[3]):pr,Ki=Qt;m=Fi*f,y=Gt(Pi),_=Ki}})():b;let T=0,S=0,E=0,M=0,A=0,$=0,I=0,k=0,V=0;const B=c&&e.tile.surface.isWebMercatorOnPlateeCarree,G=(Ve,Et,it,Gt,Kt)=>{let ni=0,Qt=0,Ti=0;if(c){const pr=Et*f,Fi=B?(Math.PI/2-2*Math.atan(Math.exp(-it/h)))*h:it*f;ni=pr-m,Qt=Fi-y,Ti=Gt-_}else{const pr=Ete(Ve),Fi=Ve.tile,Pi=Fi.extent,Ki=Fi.extentInRadians,$e=(Et-Pi[0])/(Pi[2]-Pi[0]),qe=(it-Pi[1])/(Pi[3]-Pi[1]),ft=Ki[0]*(1-$e)+Ki[2]*$e,At=pr(qe),Xt=Math.cos(At),rr=Math.sin(At),$i=Math.sin(ft),Hi=Math.cos(ft),qi=h+Gt;ni=Hi*Xt*qi-m,Qt=$i*Xt*qi-y,Ti=rr*qi-_}switch(Kt){case 0:I+=ni,k+=Qt,V+=Ti;break;case 1:M-=ni,A-=Qt,$-=Ti;break;case 2:I-=ni,k-=Qt,V-=Ti;break;case 3:M+=ni,A+=Qt,$+=Ti}},X=l.extent,K=t.clippingArea,re=v(K)?K:vV,q=X[0],L=X[2],N=X[1],U=X[3],W=[U>re[3],L>re[2],N<re[1],q<re[0]],Z=Math.max(q,re[0]),ie=Math.min(L,re[2]),Y=Math.max(N,re[1]),ce=Math.min(U,re[3]),pe=n.uvRange[0],ve=n.uvRange[1],Se=n.uvRange[2],We=n.uvRange[3],Ne=l.surface.shading||HT,xe=Ve=>{var Pi,Ki;const Et=s[Ve].cornerTiles;T=0,S=0,E=1;let it=1/0;for(let $e=0;$e<4;++$e)it=Math.min(it,(Ki=(Pi=Et[$e])==null?void 0:Pi.level)!=null?Ki:1/0);for(let $e=0;$e<4;++$e){const qe=Et[$e];$R[$e]=(qe==null?void 0:qe.level)===it?qe:null}let Gt=1,Kt=0;for(let $e=0;$e<4;++$e){const qe=$R[$e];qe&&(Gt=Math.max(Gt,qe==null?void 0:qe.renderData.geometryState.numVerticesPerSide),Kt=qe.extent[2]-qe.extent[0])}const ni=Kt,Qt=Gt;Me(Qt>1);const Ti=ni/Qt;for(let $e=0;$e<4;++$e){const qe=$R[($e+3)%4],ft=$R[$e%4];if(!qe&&!ft)continue;const At=$e===0?1:$e===1?2:$e===2?3:0,Xt=$e===0?2:$e===1?3:$e===2?0:1;if(qe&&ft){const rr=A7[$e][0]*Ti,$i=A7[$e][1]*Ti,Hi=qe.extent,qi=Hi[At===0||At===1?2:0]+rr,Gr=Hi[At===0||At===3?3:1]+$i,oi=ft.extent,Si=oi[Xt===0||Xt===1?2:0]+rr,vi=oi[Xt===0||Xt===3?3:1]+$i,Ns=qe.renderData,vr=ft.renderData,fs=cs(qi,Gr,Ns.geometryState.samplerData),Or=cs(Si,vi,vr.geometryState.samplerData);G(Ns,qi,Gr,.5*(fs+Or),$e)}else{const rr=qe!=null?qe:ft,$i=qe?At:Xt,Hi=rr.extent,qi=A7[$e],Gr=Hi[$i===0||$i===1?2:0]+qi[0]*Ti,oi=Hi[$i===0||$i===3?3:1]+qi[1]*Ti,Si=rr.renderData,vi=cs(Gr,oi,Si.geometryState.samplerData);G(Si,Gr,oi,vi,$e)}}if(!c){const $e=Math.sqrt(m*m+y*y+_*_);T=m/$e,S=y/$e,E=_/$e}const pr=Math.sqrt(M*M+A*A+$*$);M/=pr,A/=pr,$/=pr;const Fi=Math.sqrt(I*I+k*k+V*V);if(I/=Fi,k/=Fi,V/=Fi,c||E*E<.999){T=$*k-A*V,S=M*V-$*I,E=A*I-M*k;const $e=1/Math.sqrt(T*T+S*S+E*E);T*=$e,S*=$e,E*=$e}};for(let Ve=0;Ve<4;++Ve){const Et=Ve,it=(Ve+1)%4,Gt=Ve===0||Ve===1?1:0,Kt=Ve===0||Ve===3?1:0,ni=ye(Gt,pe,Se),Qt=ye(Kt,ve,We),Ti=o[Et],pr=Ve===0||Ve===3?Ti.count-1:0,Fi=o[it],Pi=Ve===0||Ve===1?Fi.count-1:0,Ki=s[Ve].cornerTiles;let $e=-1;for(let At=0;At<4;++At){const Xt=Ki[At];Xt&&($e===-1||S0(Ki[$e],Xt)>0)&&($e=At)}const qe=$e,ft=Ki[qe];if(T=0,S=0,E=1,ft!==l){const At=l.level-ft.level,Xt=2**At,rr=[ft.lij[0]+At,ft.lij[1]*Xt,ft.lij[2]*Xt],$i=[rr[1]+Xt===l.lij[1],Ve===0&&(qe===1||qe===0&&ft!==Ki[3])||Ve===1&&(qe===0||qe===1&&ft!==Ki[2]),rr[1]===l.lij[1]+1,Ve===2&&(qe===3||qe===2&&ft!==Ki[1])||Ve===3&&(qe===2||qe===3&&ft!==Ki[0])],Hi=$i.reduce((vi,Ns)=>vi+(Ns?1:0),0);Me(Hi===1||Hi===2);let qi=-1,Gr=-1;const oi=ft.renderData;if(Hi===1){const vi=$i.findIndex(vr=>vr);Me(0<=vi&&vi<=3),qi=(vi+2)%4;const Ns=e.geometryState.neighborData.edgeResolutions[vi];Gr=l.getNeighborEdgeStartVertexIndex(vi,ft)*Ns+Ns*(vi===0&&Ve===0||vi===1&&Ve===0||vi===2&&Ve===1||vi===3&&Ve===3?1:0)}else{Me($i[1]||$i[3]),qi=$i[1]?3:1;const vi=oi.geometryState.neighborData.edgeResolutions[qi];Gr=Ve===0||Ve===3?0:vi}const Si=oi.geometryInfo.outerEdges[qi];{const vi=Ti.index0+pr*Ti.stride,Ns=Fi.index0+Pi*Fi.stride,vr=Si.index0+Gr*Si.stride;{const fs=Si.attributes.position,Or=fs.typedBuffer,rs=vr*fs.typedBufferStride,ks=e.localOrigin,fn=Si.localOrigin,ia=Or[rs]+fn[0]-ks[0],Oo=Or[rs+1]+fn[1]-ks[1],Js=Or[rs+2]+fn[2]-ks[2];Yl(ia,Oo,Js,a);{const ms=Ti.attributes.position,gs=ms.typedBuffer,Ks=vi*ms.typedBufferStride;gs[Ks]=ia,gs[Ks+1]=Oo,gs[Ks+2]=Js}{const ms=Fi.attributes.position,gs=ms.typedBuffer,Ks=Ns*ms.typedBufferStride;gs[Ks]=ia,gs[Ks+1]=Oo,gs[Ks+2]=Js}}$u(Ti.attributes.uv0,vi,ni,Qt),$u(Fi.attributes.uv0,Ns,ni,Qt);{const fs=Si.attributes.normalCompressed.typedBuffer,Or=vr*Si.attributes.normalCompressed.typedBufferStride;{const rs=Ti.attributes.normalCompressed,ks=rs.typedBuffer,fn=vi*rs.typedBufferStride;ks[fn]=fs[Or],ks[fn+1]=fs[Or+1]}{const rs=Fi.attributes.normalCompressed,ks=rs.typedBuffer,fn=Ns*rs.typedBufferStride;ks[fn]=fs[Or],ks[fn+1]=fs[Or+1]}}}}else{const At=W[Et],Xt=W[it];let rr;if(At||Xt){const Gr=ye(q*(1-Gt)+L*Gt,Z,ie),oi=ye(N*(1-Kt)+U*Kt,Y,ce),Si=t.samplerData;rr=cs(Gr,oi,Si)}else rr=Fvt(Ki);w(Gt,Kt,rr),(Ne||HT)&&xe(Ve);const $i=m-r[0],Hi=y-r[1],qi=_-r[2];Yl($i,Hi,qi,a),Ti.setVertexFromValuesRawPositionUVNormal(pr,$i,Hi,qi,ni,Qt,T,S,E),Fi.setVertexFromValuesRawPositionUVNormal(Pi,$i,Hi,qi,ni,Qt,T,S,E)}}for(let Ve=0;Ve<4;++Ve)$R[Ve]=null}function Fvt(e){var n,o;const t=e.reduce((a,l)=>{var c;return Math.min(a,(c=l==null?void 0:l.level)!=null?c:1/0)},1/0);co&&(Me(!e[0]||!e[2]||hY(e[0],e[2],It.SOUTH_WEST)),Me(!e[1]||!e[3]||hY(e[1],e[3],It.NORTH_WEST)));let i=0,r=0;for(let a=0;a<4;++a){const l=e[a];if(l&&l.level===t){const c=a===0||a===1,h=a===0||a===3,p=l.extent,f=p[c?0:2],m=p[h?1:3],y=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;r+=cs(f,m,y),i++}}const s=i?r/i:0;return Me(s!=null),s}function _V(e){const t=e.vao,i=e.geometryInfo.vertexAttributes.position.typedBuffer;t.vertexBuffers.geometry.setSubData(i,0,0,i.length)}const A7=[[0,1],[1,0],[0,-1],[-1,0]],zn=new __t,vV=YZ(-1/0,-1/0,1/0,1/0),$R=[null,null,null,null];function _Re(e,t,i){if(!t)return!1;const r=S0(e,t);return r>0||r===0&&i>=2}const HT=!0;class Nvt extends wte{get horizontalScale(){return this._horizontalScaleFactor}constructor(t,i,r){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=yi(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=v(s)&&wZ(s)&&v(n)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Le(c[0],c[1],0);Zo(h,et.WebMercator,h,et.PlateCarree);const p=Le(c[2],c[3],0);Zo(p,et.WebMercator,p,et.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this._extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Nn.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(t){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let h=0;h<6;h++){const p=t[h],f=p[0],m=p[1],y=p[2],_=p[3];if(f*(f>0?r:o)+m*(m>0?s:a)+y*(y>0?n:l)+_>=0)return nl.OUTSIDE;c=c&&f*(f<0?r:o)+m*(m<0?s:a)+y*(y<0?n:l)+_<=0}return c?nl.INSIDE:nl.INTERSECTS}_aabb(){const t=this._extentInRenderSR;return jDe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,i,r,s){return $F[0]=1/i[0],$F[1]=1/i[1],$F[2]=1/i[2],Tee(this._aabb(),t,$F,r,s)}createGeometry(){Mvt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){Pvt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){$vt(this.renderData,this._horizontalScaleFactor)}}const $F=O();class kvt{constructor(){this.extent=ui(),this.minLevel=0,this.maxLevel=0,this.callback=null}}let k4=class extends Te{constructor(){super(...arguments),this._queries=new ri({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new ri({initialSize:30}),this._queryPool=new ao(kvt)}queryVisibleLevelRange(e,t,i,r){const s=this._queryPool.acquire();gf(s.extent,e),s.minLevel=t!=null?t:-Number.MAX_VALUE,s.maxLevel=i!=null?i:Number.MAX_VALUE,s.callback=r,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const t=e.level;let i=0;for(;i<this._queriesInvPtr;){const r=this._queries.data[i],s=r.extent;t>=r.minLevel&&t<=r.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};u([d()],k4.prototype,"updating",null),k4=u([P("esri.views.3d.terrain.ScaleRangeQueries")],k4);class Uvt extends wte{get convexHull(){return this._convexHull}constructor(t,i,r){super(),this._convexHull=new Array(24),this._boundingSphere=Gn(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=zt(o,l,.5),p=zt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),N9e(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=Rc(this.centerAtSeaLevel);be(m,m),this.up=m,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const t=this._center;if(this.lij[0]===0)ue(t[Nn.MIDDLE],0,0,0),ue(t[Nn.TOP],0,0,0),ue(t[Nn.BOTTOM],0,0,0),t[Nn.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const i=t[Nn.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,Vvt(i,r,3*n));t[Nn.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(t){if(!v1(t,this._boundingSphere))return nl.OUTSIDE;if(this.lij[0]<10)return nl.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<K1.NUM;n++){const o=n===kr.NEAR,a=t[n],l=a[0],c=a[1],h=a[2],p=a[3]-(o?r:0);let f=!1;for(let m=0;m<8;++m){const y=3*m;if(l*i[y+0]+c*i[y+1]+h*i[y+2]+p<0){if(f=!0,!s)break}else s=!1}if(!f)return nl.OUTSIDE}return s?nl.INSIDE:nl.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){bvt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),co&&this._checkBVs()}_updateBoundingSphere(){const t=this._boundingSphere,i=t,r=this.elevationBounds,s=this.ellipsoid.radius,n=r[1];if(this.level===0)ue(i,0,0,0),t[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];nw(Mde,a,l,s),nw(Rde,a,c,s),fe(i,Mde,Rde);const h=.5*(r[0]+r[1]);ae(i,i,(s+h)/pu(i));const p=this.convexHull;let f=0;const m=(_,b)=>{const w=_[0]-p[3*b+0],T=_[1]-p[3*b+1],S=_[2]-p[3*b+2];return Math.sqrt(w*w+T*T+S*S)};for(let _=0;_<8;++_){const b=m(i,_);f=Math.max(f,b)}const y=f;t[3]=y+2}}_updateConvexHull(){const t=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===Ud.HAS_NORTH_POLE,a=n&&s===Ud.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=t[0],p=t[2],f=a?-c:t[1],m=o?c:t[3],y=.5*(h+p),_=r[0],b=i+(l?Math.min(0,_-1):_),w=(q,L,N)=>nw(q,L,N,b),T=O(),S=O(),E=O(),M=O();w(T,h,f),w(S,h,m),w(E,p,m),w(M,p,f);const A=(q,L)=>{for(let N=0;N<3;++N)this._convexHull[3*L+N]=q[N]};A(T,0),A(S,1),A(E,2),A(M,3);const $=r[1],I=i+(l?Math.max(0,$+1):$),k=O(),V=O(),B=O();nw(V,y,m,b),nw(B,y,f,b),fe(k,V,B),be(k,k);const G=O(),X=O(),K=(q,L)=>{Wo(X,q,L),be(X,X);const N=-_e(q,G)/_e(X,G);Me(N>=0),ae(X,X,N),fe(q,q,X)};if(2**this.lij[0]>2*this.lij[1]){const q=B,L=O();_t(L,Ade,q),be(L,L),_t(G,q,L),be(G,G),Me(Vd(_e(G,q)/pu(q),0)),K(T,S),K(M,E),A(T,0),A(M,3)}else if(2**this.lij[0]!==2*this.lij[1]){const q=V,L=O();_t(L,Ade,q),be(L,L),_t(G,L,q),be(G,G),K(S,T),K(E,M),A(S,1),A(E,2)}const re=(q,L)=>{const N=I/_e(L,k);for(let U=0;U<3;++U)this._convexHull[3*q+U]=L[U]*N};re(4,T),re(5,S),re(6,E),re(7,M)}_getPatchType(){const t=this.lij[1],i=t===0,r=t===(1<<this.level)-1;return i?r?Ud.HAS_BOTH_POLES:Ud.HAS_NORTH_POLE:r?Ud.HAS_SOUTH_POLE:Ud.REGULAR}intersectsRay(t,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*p-l,m=i[1]*p-c,y=i[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<Cde.length?Cde[this.level]+1:2}updateCornerElevations(){Evt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){Svt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var ce;if(!co||this.level<=2)return;const t=this._boundingSphere,i=t[3],r=t,s=O(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[Nn.MIDDLE][3],p=this.convexHull,f=(pe,ve)=>{for(let Se=0;Se<3;++Se)pe[Se]=p[3*ve+Se]};{const pe=O(),ve=O(),Se=O(),We=O(),Ne=O(),xe=(ke,Ve,Et,it)=>{f(ve,ke),f(Se,Ve),f(We,Et),Wo(ve,ve,Se),Wo(We,We,Se),_t(pe,ve,We),be(pe,pe);const Gt=_e(pe,Se);f(Ne,it);const Kt=_e(pe,Ne),ni=Math.abs(Kt-Gt);Me(Vd(ni,0),`Non coplanar ${ke},${Ve},${Et},${it} diff = ${ni}`)};xe(0,1,2,3),xe(4,5,6,7),xe(0,1,4,5),xe(1,2,5,6),xe(2,3,6,7),xe(3,0,7,4)}const m=Du(24),y=(pe,ve,Se)=>{const We=4*pe;for(let Ne=0;Ne<3;++Ne)m[We+Ne]=ve[Ne];m[We+3]=Se},_=O(),b=O(),w=O(),T=O(),S=(pe,ve,Se,We)=>{f(_,ve),f(b,Se),f(w,We),Wo(_,_,b),be(_,_),Wo(w,w,b),be(w,w),_t(T,_,w),be(T,T);const Ne=_e(T,b);y(pe,T,Ne)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const E=1,M=(pe,ve,Se,We)=>{const Ne=4*pe;return m[Ne+0]*ve+m[Ne+1]*Se+m[Ne+2]*We-m[Ne+3]},A=(pe,ve,Se,We)=>M(pe,ve,Se,We)>=-E,$=(pe,ve)=>A(pe,ve[0],ve[1],ve[2]),I=2**this.lij[0]>2*this.lij[1],k=(pe,ve,Se)=>Math.sqrt(vRe(pe,ve,Se,r[0],r[1],r[2]))<i,V=pe=>k(pe[0],pe[1],pe[2]),B=(pe,ve)=>k(pe[ve+0],pe[ve+1],pe[ve+2]),G=this.extentInRadians,X=.5*(G[0]+G[2]),K=G[1],re=G[3],q=O(),L=O();nw(q,X,re,a),nw(L,X,K,a);const N=I?"Upper":"Lower";let U=!0;for(let pe=0;pe<6;++pe){for(let ve=0;ve<8;++ve){const Se=3*ve,We=A(pe,p[Se+0],p[Se+1],p[Se+2]);U&&(U=We),Me(We,`Tile[${this.lij}] Convex hull point ${ve} outside of plane ${pe}`)}Me($(pe,L),`Tile[${this.lij}] (${N}) bottom mid outside of plane ${pe}`),Me($(pe,q),`Tile[${this.lij}] (${N}) top mid outside of plane ${pe}`)}Me(U,"Not all convex hull points are inside  convex hull polyhedron"),Me(V(L),`Tile[${this.lij}] (${N}) bottom mid outside of bounding sphere`),Me(V(q),`Tile[${this.lij}] (${N}) top mid outside of bounding sphere`);for(let pe=0;pe<8;++pe){const ve=B(p,3*pe);Me(ve,`Tile[${this.lij}] Convex hull point ${pe} outside of bounding sphere`)}for(let pe=0;pe<6;++pe)for(let ve=0;ve<8;++ve){const Se=3*ve;A(pe,p[Se+0],p[Se+1],p[Se+2])||console.error(`Tile[${this.lij}] Convex hull point ${ve} outside of plane ${pe}`)}const W=this.extentInRadians,Z=Math.max(W[2]-W[0],W[3]-W[1]),ie=Math.round(Z*n),Y=this.renderData;if(Y){const pe=Y.geometryInfo,ve=Y.localOrigin,Se=(ce=pe.vertexAttributes)==null?void 0:ce.position;if(!Se)return;const We=Se.count,Ne=O(),xe=pe.numVerticesPerSide-2,ke=xe*xe,Ve=Y.geometryState.neighborData,Et=Ve.edgeResolutions.reduce((it,Gt)=>it+Gt+1,0);for(let it=0;it<We;++it){const Gt=it<ke,Kt=!Gt&&it<ke+Et;let ni=!1,Qt=-1;if(Kt){let oi=ke;for(let Si=0;Si<4;++Si){const vi=Ve.edgeResolutions[Si];if(it===oi||it===oi+vi-1){ni=!0;break}if(oi+=vi,it<oi){Qt=Si;break}}}const Ti=Qt,pr=ni,Fi=Kt&&!pr,Pi=Kt?Ve.edgePeerNeighbors[Ti]:null,Ki=Kt&&Pi&&S0(this,Pi)>0,$e=Gt?"internal":Fi?"edge":pr?"corner":"pole";Se.getVec(it,s),fe(Ne,s,ve);const qe=pu(Ne)-n;let ft=0,At=!1;const Xt=o[0]-qe,rr=qe-o[1],$i=Xt>l,Hi=rr>l,qi=$i||Hi,Gr=`Tile[${this.lij}].vertex[${it}]:${$e}`+($i?"(below)":Hi?"(above)":"")+(Ki?"(Neighbor)":"");{const oi=t$(Ne,r);if(oi>=i+c){const Si=oi-i;qi||(console.error(`${Gr} is out of the bounding sphere by ${Si.toFixed(0)} / ${i.toFixed(0)}[tol=${c}] h=${qe.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Si/i).toFixed(0)})`),At=!0)}}for(let oi=0;oi<6;++oi)if(!A(oi,Ne[0],Ne[1],Ne[2])){const Si=M(oi,Ne[0],Ne[1],Ne[2]),vi=it%xe,Ns=(it-vi)/xe;oi===0&&Xt||oi===5&&rr||(console.error(`${Gr} (${vi},${Ns})|${xe}] is out of the bounding trapezoid plane ${oi} h=${Math.round(qe)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(Si)} radii = ${Math.round(i)}/${Math.round(h)}} : maxL = ${ie}`),++ft)}if(At||ft>0)break}}}}const Cde=[128,64,64,32,16,8,8,4];function Vvt(e,t,i){return vRe(e[0],e[1],e[2],t[i+0],t[i+1],t[i+2])}function vRe(e,t,i,r,s,n){const o=r-e,a=s-t,l=n-i;return o*o+a*a+l*l}const nw=(e,t,i,r)=>{const s=Math.cos(t),n=Math.sin(t),o=Math.cos(i),a=Math.sin(i);e[0]=r*o*s,e[1]=r*o*n,e[2]=r*a},Ade=[0,0,1],Mde=O(),Rde=O();class Bvt{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class bRe extends xl{constructor(){super(...arguments),this.blendMode=Ue.Normal}}u([j({count:Ue.COUNT})],bRe.prototype,"blendMode",void 0);class JE extends bRe{constructor(){super(...arguments),this.output=xo.Composite,this.baseOpacityMode=Ef.NotRequired,this.premultipliedSource=cf.Off,this.hasWebGL2Context=!1}}u([j({count:xo.COUNT})],JE.prototype,"output",void 0),u([j({count:Ef.COUNT})],JE.prototype,"baseOpacityMode",void 0),u([j()],JE.prototype,"premultipliedSource",void 0),u([j()],JE.prototype,"hasWebGL2Context",void 0);var qT;function zvt(e){const t=new Yi;if(t.include(iRe),e.background===qT.Only){const i=e.output===xo.ColorComposite;return i?t.fragment.uniforms.add(new Jt("backgroundColor",r=>r.backgroundColor)):(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(bte)),t.fragment.code.add(x`
    void main() {
      gl_FragColor = vec4(${i?x`backgroundColor`:x`gridColor(uv)`}, 1.0);
    }
  `),t}return t.include(rRe,e),t.fragment.uniforms.add(new Lt("tex",i=>i.texture)),t.fragment.uniforms.add(new Ie("opacity",i=>i.opacity)),t.fragment.code.add(x`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),t}(function(e){e[e.BelowLayer=0]="BelowLayer",e[e.Only=1]="Only",e[e.COUNT=2]="COUNT"})(qT||(qT={}));const Gvt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return qT},build:zvt},Symbol.toStringTag,{value:"Module"}));class jvt extends tRe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=dl}}class bV extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2}initializeProgram(t){return new Ji(t.rctx,bV.shader.get().build(this.configuration),ji)}initializePipeline(){return Ht({blending:qf(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}}bV.shader=new Zi(Gvt,()=>Q(()=>import("./BlendLayers.glsl.b16acc1a.js"),[]));class wRe extends JE{constructor(){super(...arguments),this.background=qT.BelowLayer}}u([j()],wRe.prototype,"background",void 0);class M7{constructor(t,i,r,s,n,o){this.texture=t,this.type=i,t.retain(),this.offsetAndScale=Yt(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Le(s,n,o)}destroy(){this.texture.release()}}function U4(){return[1,0,0,1,0,0]}function Hvt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function qvt(e,t,i,r,s,n){return[e,t,i,r,s,n]}function Wvt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Hvt,create:U4,createView:Wvt,fromValues:qvt},Symbol.toStringTag,{value:"Module"}));function Xvt(e){return e instanceof Float32Array&&e.length>=2}function Yvt(e){return Array.isArray(e)&&e.length>=2}function R7(e){return Xvt(e)||Yvt(e)}const Zvt=96,Jvt=39.37;function Ate(e,t){return t.type?di(e,t.x,t.y):Mo(e,t)}function Kvt(e){return wl(e)}function Qvt(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const e1t=function(){const e=tt();return function(t,i,r){const s=i.targetGeometry;Ate(e,s);const n=.5*wV(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();function wV(e){return e.scale*t1t(e.targetGeometry)}function t1t(e){return v(e)&&hl(e.spatialReference)?1/(Kvt(e.spatialReference)*Jvt*Zvt):1}function i1t(e){return M6(e.rotation)||0}const Mte=function(){const e=tt(),t=tt(),i=tt();return function(r,s,n,o,a,l){return mQ(e,s),xu(t,n,.5*l),di(i,1/o*l,-1/o*l),cQ(r,t),a&&ZU(r,r,a),lQ(r,r,i),JU(r,r,e),r}}(),r1t=function(){const e=tt();return function(t,i,r,s){const n=wV(i),o=i1t(i);return Ate(e,i.targetGeometry),Mte(t,e,r,n,o,s)}}(),s1t=function(){const e=tt();return function(t,i,r,s){const n=wV(i);return Ate(e,i.targetGeometry),Mte(t,e,r,n,0,s)}}();function n1t(e){const t=E1(e);return t?t.valid[1]-t.valid[0]:0}function o1t(e,t){return Math.round(n1t(e)/t)}var pY;const py=[0,0];let Mv=pY=class extends ge{constructor(e){super(e),this._viewpoint2D={center:tt(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Gi,this.id=0,this.inverseTransform=U4(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=U4(),this.transformNoRotation=U4(),this.displayMat3=kc(),this.displayViewMat3=kc(),this.viewMat3=kc(),this.viewMat2d=ck(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=Qvt(i,e.viewpoint),this._set("size",Mo(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new pY({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return R7(t)?Yw(e,t,this.inverseTransform):(py[0]=t,py[1]=i,Yw(e,py,this.inverseTransform))}toScreen(e,t,i){return R7(t)?Yw(e,t,this.transform):(py[0]=t,py[1]=i,Yw(e,py,this.transform))}toScreenNoRotation(e,t,i){return R7(t)?Yw(e,t,this.transformNoRotation):(py[0]=t,py[1]=i,Yw(e,py,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return Mte(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new ap({targetGeometry:new ut(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=wV(o),this.rotation=r,this.scale=i,this.spatialReference=t,Mo(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;MQ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=RQ(this.viewMat3),h=kd(n[0]/2,n[1]/2),p=kd(-n[0]/2,-n[1]/2),f=M6(r);_k(c,c,h),OQ(c,c,f),_k(c,c,p),wA(this.displayViewMat3,this.displayMat3,c);const m=cQ(this.viewMat2d,h);return ZU(m,m,f),JU(m,m,p),e1t(this.extent,o,n),r1t(this.transform,o,n,s),cTe(this.inverseTransform,this.transform),s1t(this.transformNoRotation,o,n,s),this.worldScreenWidth=o1t(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],Mv.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],Mv.prototype,"pixelRatio",null),u([d({json:{write:!0}})],Mv.prototype,"size",null),u([d()],Mv.prototype,"spatialReference",void 0),u([d({type:ap,json:{write:!0}})],Mv.prototype,"viewpoint",null),Mv=pY=u([P("esri.views.2d.ViewState")],Mv);const a1t=Mv,l1t=.125;class c1t{constructor(){this._renderParams={context:null,drawPhase:1,state:new a1t({viewpoint:new ap({targetGeometry:new ut(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(t,i,r,s,n,o,a,l,c,h){const p=o.adjustLevel(i[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(i[0]),[y,_]=o.getShift(i,a*m),b=l1t*a*m/c,w=r.transforms.dvs;w[0]=b,w[4]=-b,w[6]=-1-y-l[0]*a*2,w[7]=1+_+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(t),r.triangleCount=0,s.drawTile(f,r,n)}}class xV extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2}initializeProgram(t){return new Ji(t.rctx,xV.shader.get().build(this.configuration),ji)}initializePipeline(){return Ht({blending:qf(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}}xV.shader=new Zi(z_t,()=>Q(()=>import("./RasterColorizer.glsl.17a7c0fd.js"),[]));class V4 extends JE{constructor(){super(...arguments),this.colorizerType=rT.Stretch,this.stretchType=jT.Noop,this.applyColormap=!0}}u([j({count:rT.COUNT})],V4.prototype,"colorizerType",void 0),u([j({count:jT.COUNT})],V4.prototype,"stretchType",void 0),u([j()],V4.prototype,"applyColormap",void 0);class Ode{constructor(t){this._rctx=t,this._fbos=new Map}get(t){return this._getPool(t)}dispose(){this._fbos.forEach(t=>t.dispose()),this._fbos.clear()}_getPool(t){const i=this._fbos.get(t);if(i)return i;const r=new Yr(this._rctx,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.DEPTH_RENDER_BUFFER,width:t,height:t});return this._fbos.set(t,r),r}}const u1t=se.getLogger("esri.views.3d.terrain");class h1t{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._fbos=[],this._vectorTileHelper=new c1t,this._bindParameters=new c8(null,null,null),this._blendLayersTechniqueConfig=new wRe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Tl(this._rctx,vM)}dispose(){this._fbos.forEach(rt),this._fbos=null,this._vtFBO=rt(this._vtFBO),this._vaoQuad=rt(this._vaoQuad),this._vectorTileHelper=rt(this._vectorTileHelper),this._backgroundTechnique=ls(this._backgroundTechnique),this._applyOpacityTechnique=ls(this._applyOpacityTechnique),this._blendLayersTechnique=ls(this._blendLayersTechnique)}_getBlendLayersTechnique(t,i,r,s=cf.Off,n=qT.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(bV,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,i){const r=this._getBlendLayersTechnique(Ue.Normal,i?xo.ColorComposite:xo.GridComposite,Ef.NotRequired,cf.Off,qT.Only),s=this._rctx.bindTechnique(r,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Nt.TRIANGLE_STRIP,0,ja(this._vaoQuad,"geometry"))}drawGroup(t,i,r,s,n,o=cf.On){i===xo.Composite&&(t.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),t.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const a=this._getBlendLayersTechnique(s,i,n,o),l=this._rctx.bindTechnique(a,t,this._bindParameters);this._render(l)}drawRasterData(t,i,r,s,n,o=cf.Off){if(C(t.texture))return;t.fboTexture=i===xo.GroupBackgroundComposite||s===Ue.Normal&&n===Ef.NotRequired&&o===cf.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(s,i,n,o),l=this._rctx.bindTechnique(a,t,this._bindParameters);this._render(l)}drawImageryTileData(t,i,r,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,wi.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;t.fboTexture=s===Ue.Normal&&n===Ef.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(a,i,s,n);a.opacity=t.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=t.backgroundColor,c.fboTexture=t.fboTexture,c.baseOpacity=t.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(t,i,r,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return C(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new V4,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?jT.Noop:jT.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(xV,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,i,r,s,n,o,a,l,c){const h=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,wi.MAP),m=n===Ef.Required||t.opacity<1||s!==Ue.Normal||i!==xo.Composite,y=m?cf.On:cf.Off;this._getBlendLayersTechnique(s,i,n,y).bindPipelineState(h);let _=null,b=null;m?(b=this.currentFBO(r),C(this._vtFBO)&&(this._vtFBO=new Ode(this._rctx)),_=this._vtFBO.get(r),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(ts.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(w){u1t.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return!v(_)||(h.bindFramebuffer(b),t.texture=_.colorTexture,t.offset=Bc,t.scale=1,this.drawRasterData(t,i,r,s,n,y),c)}copyFBOToTexture(t){const i=this._rctx,r=i.bindTexture(t.texture,pt.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;i.gl.copyTexImage2D(St.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),i.bindTexture(r,pt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(ts.COLOR_BUFFER_BIT|ts.DEPTH_BUFFER_BIT)}_initFBO(t,i,r){this._rctx.bindFramebuffer(t),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(t){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(t)}bind(t,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new Ode(this._rctx));this._initFBO(this._fbos[i].get(t),t,r)}_bindNextFreeBuffer(t){this._lastUsedIds.length>0?this.bind(t,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(t,this._lastCreatedBufferId))}openGroup(t){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(t)}switch(t){const i=this.currentFBO(t),r=this._current;return this._bindNextFreeBuffer(t),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(t){const i=this._current;this._bindNextFreeBuffer(t),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(t){return this._fbos[this._current].get(t)}}class d1t{constructor(t,i,r,s){this.start=t,this.end=i,this.blendMode=r,this.opacity=s}}class p1t{constructor(t,i,r){this._rctx=t,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new jvt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new h1t(this._rctx,this._techniqueRepository),this._blackTex=new mE(YKe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=rt(this._composition),this._backgroundTexture=ls(this._backgroundTexture),this._blackTex=ls(this._blackTex)}get backgroundIsGrid(){return C(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,i){if(!t.renderData)return;const r=t.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=r.view.state.contentPixelRatio;let h=!1;h6.clear(),l2.length=0;const p=t.layerInfo[wi.MAP];let f=p.length,m=0;for(;m<p.length;m++){const b=r.layerViewByIndex(m,wi.MAP),w=b.layer.opacity;Ide[m]=w;const T=b.fullOpacity;if(Pde[m]=T,G0e(b.layer)&&f>=p.length&&(f=m),o6(b)){$de[m]=b.layer.blendMode;let E=b.layer.blendMode!=="normal";if(tA(b.layer.parent)){const M=fY(b.layer.parent);v(M)&&M!==""&&(E=xRe(b.layer.parent)||E)}E&&(h=E,l=!1)}if(w===0&&!h){p[m].pendingUpdates&=~(Rt.TEXTURE_NOFADING&Rt.TEXTURE_FADING);continue}++o;const S=O7(t,m);if(S){if(p[m].pendingUpdates&=~(Rt.TEXTURE_NOFADING&Rt.TEXTURE_FADING),tA(b.layer.parent)){const E=fY(b.layer.parent);v(E)&&E!==""&&TRe(b.layer.parent,m)}zP(b)?a=Math.max(a,this.tileSize*c):s===1&&T===1&&(b.isOpaque||this._dataToTexture(S)&&S.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n}}this._rctx.type===Tt.WEBGL1&&(a=f1t(a));const y=a/this.tileSize,_=m-1;this._ensureBackgroundTexture(this.tileSize),n!==0?n===1&&!h&&this._useLayerTexture(t,_,f,Pde[_])||this._composeMapLayers(t,i,_,f,Ide,$de,a,y,!l||h,h6,h):this._useBackgroundTexture(t,o)}_ensureBackgroundTexture(t){C(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(t),this._passParameters.offset=Bc,this._passParameters.scale=1,this._passParameters.opacity=1,v(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,v(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(t,i){let r=T0.Immediate;(t.surface.view.layerViewManager.updating||i>0)&&(r=T0.Delayed);const s=t.renderData;this._backgroundTexture&&C(s.textureReference)&&(r=T0.Immediate),s.setTextureReference(v(this._backgroundTexture)?new M7(this._backgroundTexture,io.FADING,Lde,t.surface.baseOpacity,0,1):null,r)}_useLayerTexture(t,i,r,s){const n=i<r,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=O7(t,i);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new M7(l.sourceLayerInfo.data,io.FADING,l,o,a,s)),!0)}_composeMapLayers(t,i,r,s,n,o,a,l,c,h,p){this._composition.ensureBuffer(a);const f=t.surface.baseOpacity;let m=!1,y=nt.LINEAR_MIPMAP_LINEAR,_=!1,b=0;for(let S=r;S>=0;S--){const E=O7(t,S);if(!E||n[S]===0&&!p)continue;const M=S<s&&f<1&&!m;this._passParameters.baseOpacity=M?f:1;const A=this._passParameters.baseOpacity<1?Ef.Required:Ef.NotRequired;M&&(m=!0);let $=!1;h.forEach(B=>{B.start===S&&(l2.push(B),this._composition.openGroup(a),$=!0)});const I=b===0,k=$?xo.GroupBackgroundComposite:c&&I?this.backgroundIsGrid?xo.GridComposite:xo.ColorComposite:xo.Composite,V=uY[o[S]];for(m0t(E)?(this._passParameters.opacity=n[S],_=this._composition.drawVectorData(this._passParameters,k,a,V,A,E,l,this.tileSize,_)):f0t(E)?(this._passParameters.opacity=n[S],this._composition.drawImageryTileData(this._passParameters,k,a,V,A,E),this._hasNearestInterpolation(E)&&(y=nt.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._passParameters.opacity=n[S],this._composition.drawRasterData(this._passParameters,k,a,V,A));l2.length>0&&l2[l2.length-1].end===S;){const B=l2.pop();this._passParameters.opacity=B.opacity,this._passParameters.offset=Bc,this._passParameters.scale=1;const G=c&&I?this.backgroundIsGrid?xo.GridComposite:xo.ColorComposite:xo.Composite;this._composition.drawGroup(this._passParameters,G,a,uY[B.blendMode],A)}b++}const w=t.renderData,T=w.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(T),this._composition.unbind(),w.setTextureReference(new M7(T,i,Lde,m?1:f,0,1))}_hasNearestInterpolation(t){const i=t.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(t){if(y0t(t)){const i=t.sourceLayerInfo;i.data=this._buildTexture(i.data),t.tile.setMemoryDirty()}return g0t(t)}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,i=nt.LINEAR_MIPMAP_LINEAR){if(C(t))return null;const r={target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")r.width=r.height=t,n=new mE(new pt(s,r));else if(t instanceof dV)r.isOpaque=t.isOpaque,n=new mE(new pt(s,r,t.image)),t.release();else try{r.width=t.width,r.height=t.height,n=new mE(new pt(s,r,t))}catch{n=new mE(ySe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,pt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,pt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function f1t(e){const t=kC(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}function O7(e,t){Xu.layerIndex=t;const i=e.layerInfo[wi.MAP][t];if(v(i.data))return di(Xu.offset,0,0),Xu.tile=e,Xu.scale=1,Xu.sourceLod=e.lij,Xu.sourceLayerInfo=i,Xu;const r=i.upsampleInfo;if(v(r)){const s=r.tile.layerInfo[wi.MAP][t];return Xu.tile=r.tile,Mo(Xu.offset,r.offset),Xu.scale=r.scale,Xu.sourceLod=r.tile.lij,Xu.sourceLayerInfo=s,Xu}return null}function fY(e){return e.get("uid")}function xRe(e){let t=e.blendMode!=="normal";return tA(e.parent)&&(t=xRe(e.parent)||t),t}function TRe(e,t){tA(e.parent)&&TRe(e.parent,t);const i=fY(e);if(v(i)&&i!==""){const r=h6.get(i);r?r.start=t:h6.set(i,new d1t(t,t,e.blendMode,e.opacity))}}const Ide=new Array,Pde=new Array,$de=new Array,h6=new Map,l2=new Array,Xu={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},Lde={offset:[0,0],scale:1},SRe=200,I7=40,m1t=.8,g1t=10,a3=1e-6;function y1t(e,t,i){const r=t,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(r[a]<l){if(s[a]<=a3)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-a3){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(r[a]>l){if(s[a]>=-a3)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=a3){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class Dde{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}}class jA{constructor(t,i,r,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=s,this._rayDirection=O(),this.bspNodeTree=new Array;const n=r-i,o=n<=ERe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=x1t(t,i,r,s.data,s.stride),l=ye(Math.log2(n/I7),2,g1t),c=(h,p,f)=>{const m=b1t(o,a,h,p),y=p-h;if(y<=I7){const E=new Dde(m,void 0,0,h,p);return this.bspNodeTree.push(E),E}const{axis:_,midValue:b}=w1t(m),w=v1t(o,a,h,p,_,b),T=(E,M)=>{if(f>l)return;const A=M-E;return A<I7||A>=m1t*y?void 0:c(E,M,f+1)},S=new Dde(m,_,b,w.next,w.mid);return this.bspNodeTree.push(S),S.leftNode=T(h,w.next),S.rightNode=T(w.mid,p),S};c(0,n,0),this.triangleVertexIndices=T1t(o,t,i,r)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,p=h[0],f=h[1],m=h[2];for(let y=t,_=3*t;y<i;++y){let b=r[_++]*n;const w=s[b++],T=s[b++],S=s[b];b=r[_++]*n;const E=s[b++],M=s[b++],A=s[b];b=r[_++]*n;const $=E-w,I=M-T,k=A-S,V=s[b++]-w,B=s[b++]-T,G=s[b]-S,X=f*G-B*m,K=m*V-G*p,re=p*B-V*f,q=$*X+I*K+k*re;if(Math.abs(q)<=Number.EPSILON)continue;const L=a-w,N=l-T,U=c-S,W=L*X+N*K+U*re;if(q>0){if(W<0||W>q)continue}else if(W>0||W<q)continue;const Z=N*k-I*U,ie=U*$-k*L,Y=L*I-$*N,ce=p*Z+f*ie+m*Y;if(q>0){if(ce<0||W+ce>q)continue}else if(ce>0||W+ce<q)continue;const pe=(V*Z+B*ie+G*Y)/q;if(pe>=0){const ve=this.indices[y]+this.firstTriangleIndex,Se=wee($,I,k,V,B,G,_1t);this._callback(pe,Se,ve,!1)}}}jA.numFacesTested+=i-t}intersectRay(t,i){jA.numFacesTested=0;const r=Le(t.r0[0],t.r0[1],t.r0[2]),s=Le(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<a3)return;this._rayOrigin=r;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,i,r){const s=this._rayOrigin,n=this._rayDirection;if(!y1t(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=i,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=r;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}jA.numFacesTested=0;const _1t=O(),c2=[1/0,1/0,1/0],u2=[-1/0,-1/0,-1/0];function v1t(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=r;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function b1t(e,t,i,r){if(r<=i)return dT(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[i];for(let n=0;n<3;++n)c2[n]=t[s+0+n],u2[n]=t[s+3+n]}for(let s=i+1;s<r;++s){const n=6*e[s];for(let o=0;o<3;++o)c2[o]=Math.min(c2[o],t[n+0+o]),u2[o]=Math.max(u2[o],t[n+3+o])}return dT(c2[0],c2[1],c2[2],u2[0],u2[1],u2[2])}function w1t(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function x1t(e,t,i,r,s){const n=i-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],y=r[h+f],_=r[p+f];o[6*a+f]=Math.min(m,y,_),o[6*a+3+f]=Math.max(m,y,_)}}return o}function T1t(e,t,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=ERe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+i);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const ERe=65535;class Rs extends qo{constructor(){super(...arguments),this.output=z.Color,this.overlayMode=E0.Disabled,this.tileBlendInput=ug.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!cr.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=cr.TERRAIN_USE_LEGACY_SHADING,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=gt.Terrain}}u([j({count:z.COUNT})],Rs.prototype,"output",void 0),u([j({count:E0.COUNT})],Rs.prototype,"overlayMode",void 0),u([j({count:ug.COUNT})],Rs.prototype,"tileBlendInput",void 0),u([j()],Rs.prototype,"spherical",void 0),u([j()],Rs.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Rs.prototype,"atmosphere",void 0),u([j()],Rs.prototype,"receiveShadows",void 0),u([j()],Rs.prototype,"hasSlicePlane",void 0),u([j()],Rs.prototype,"backfaceCullingEnabled",void 0),u([j()],Rs.prototype,"stencilEnabled",void 0),u([j()],Rs.prototype,"textureFadingEnabled",void 0),u([j()],Rs.prototype,"renderOccluded",void 0),u([j()],Rs.prototype,"hasScreenSpaceReflections",void 0),u([j()],Rs.prototype,"hasCloudsReflections",void 0),u([j()],Rs.prototype,"shading",void 0),u([j()],Rs.prototype,"useLegacyTerrainShading",void 0),u([j()],Rs.prototype,"invisible",void 0),u([j()],Rs.prototype,"tileBorders",void 0),u([j()],Rs.prototype,"visualizeNormals",void 0),u([j()],Rs.prototype,"screenSizePerspective",void 0),u([j()],Rs.prototype,"receiveAmbientOcclusion",void 0),u([j({count:gt.COUNT})],Rs.prototype,"pbrMode",void 0),u([j({constValue:yr.CompressedAttribute})],Rs.prototype,"normalType",void 0),u([j({constValue:En.Compressed})],Rs.prototype,"textureCoordinateType",void 0),u([j({constValue:!1})],Rs.prototype,"highStepCount",void 0),u([j({constValue:!1})],Rs.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Rs.prototype,"useFillLights",void 0);const P7=7,S1t=10,$7=ho();var vo;(function(e){e[e.Opaque=0]="Opaque",e[e.Semitransparent=1]="Semitransparent",e[e.TransparentWithDraped=2]="TransparentWithDraped",e[e.Empty=3]="Empty"})(vo||(vo={}));let lu=class extends Te{get _isGlobal(){return this._stage.viewingMode===je.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}constructor(e){super(e),this.type=Ss.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Rs,this._passParameters=new nRe,this._rctx=null,this._renderDataPool=new ao(yvt),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new ZMe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=vo.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Is.Occlude}initialize(){const e=[Ee.OPAQUE_TERRAIN,Ee.TRANSPARENT_TERRAIN,Ee.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),m_t()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===vo.TransparentWithDraped||e===vo.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Jv}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?Jk:Is.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,v(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,Rt.TEXTURE_FADING)}updateTileTexture(e,t){v(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,t===Rt.TEXTURE_FADING?io.FADING:io.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(const i of e.layerInfo[wi.ELEVATION])i.pendingUpdates&=~Rt.GEOMETRY;e.resetPendingUpdate(Rt.GEOMETRY);const t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const t=S1t-P7,i=Math.max(0,Math.floor((e.level-t)/P7)*P7);if(this._isGlobal&&i===0)return dl;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=cn.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=cn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=cn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new p1t(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=ySe(this._rctx)}uninitializeRenderContext(){this._emptyTex=rt(this._emptyTex),this._tileRenderer=rt(this._tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==vo.Opaque)return;const s=E1t,n=C1t;me(s,r,i),ue(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===Aa.MIN,h=!!e.results.ground.target,p=lrt(e.verticalOffset),f=e.tolerance;let m,y=c&&v(o.dist)?o.dist:1/0;const _=w=>{const T=w.renderData;if(!(T!=null&&T.vao))return;const S=T.geometryInfo;q6($7,S.boundingBox);const E=T.localOrigin;v(p)&&(p.localOrigin=E,p.applyToAabb($7));const M=$7;if(h2[0]=i[0]-E[0],h2[1]=i[1]-E[1],h2[2]=i[2]-E[2],!Tee(M,h2,n,f,y))return;const A=(K,re,q)=>{K.set(this.type,w,re,q,Hh),y=c&&v(o.dist)?o.dist:1/0},$=(K,re)=>{if(v(re)&&K>=0&&(e.options.backfacesTerrain||_e(re,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(i,r,K))){if((l.dist==null||K<l.dist)&&A(l,K,re),e.options.isFiltered)return;e.options.store===Aa.ALL&&(C(m)?(m=ZQ(e.ray),A(m,K,re),e.results.all.push(m)):K<m.dist&&A(m,K,re)),(o.dist==null||K<o.dist)&&A(o,K,re),e.options.store!==Aa.MIN&&(a.dist==null||K>a.dist)&&A(a,K,re)}},I=A1t;me(I,r,E);const k=S.indices,V=S.vertexAttributes,B=V.getField(R.POSITION,Mr),G=new Ke(B.typedBuffer,3,!1,V.stride/4),X=S.indexCount/3;if(C(p)&&X>SRe){const K=w.renderData;C(K.intersectionData)&&(K.intersectionData=new jA(k,0,X,G)),K.intersectionData.intersectRay({r0:h2,r1:I},$)}else z$(h2,I,0,X,k,G,null,p,$)},b=this._rootTiles;v(b)&&(()=>{const w=this._tileIterator;w.reset(b);const T=e.options.invisibleTerrain;for(let S=w.next();S;S=w.next())!(S.visible||T&&S.intersectsClippingArea)||!v(p)&&!S.intersectsRay(i,s,f,y)||h&&this._useStencilForTile(S)?w.skipSubtree():_(S)})()}processScaleRangeQueries(e,t){var i;if(!t.done)for(this._updatePatchGroups();e.updating&&!t.done;){e.prepare();for(const r of this._patchGroups.values())for(const s of r)v((i=s.renderData)==null?void 0:i.textureReference)&&e.queriesForTile(s);e.process(),t.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===Ee.OCCLUDED_TERRAIN){if((e.renderOccludedMask&Jk)==0)return null}else{const t=this.transparency===vo.Opaque?Ee.OPAQUE_TERRAIN:Ee.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.output){case z.Color:return this.transparency===vo.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=v(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?E0.Disabled:this._overlayRenderer.hasWater?E0.EnabledWithWater:E0.Enabled,this._updateTechnique(z.Color,e.bindParameters.slot===Ee.OCCLUDED_TERRAIN));case z.Shadow:case z.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(z.Shadow,!1)):null;case z.Depth:return this.transparency===vo.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(z.Depth,!1));case z.Normal:return this.transparency===vo.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(z.Normal,!1));case z.ObjectAndLayerIdColor:return this.transparency===vo.Empty?null:this._updateTechnique(z.ObjectAndLayerIdColor,!1);case z.Highlight:return this.transparency!==vo.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(z.Highlight,!1)):null}return null}render(e,t){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case z.Color:{const r=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?Mc.Occluded:Mc.ColorAndWater;this.transparency===vo.Opaque?this._renderMaterialPass(e,t,r):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,t,r),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case z.Depth:case z.Normal:this._renderAuxiliaryPass(e,t,Mc.None);break;case z.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,t,Mc.Highlight);break;case z.Shadow:case z.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,t,Mc.None);break;case z.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,Mc.ObjectAndLayerIdColor)}}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,t,i)}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,i)}updateTileBackground(e=null){if(C(this._tileRenderer))return;const t=this._tileRenderer;let i=null;if(v(e)){const r=De.toUnitRGBA(e);i=Le(r[0]||0,r[1]||0,r[2]||0)}t.setBackground(i),this._allTiles.forAll(r=>t.updateTileTexture(r,io.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?ug.GridComposite:v(t.backgroundColor)?ug.ColorComposite:ug.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==GA.NONE){const e=Array.from(this._patchGroups.values()),t=this._stencilEnabledLayerExtents;for(const i of e)JMe(this.renderOrder,i,t);e.sort((i,r)=>KMe(i[0],r[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!C(e)){(t=e[0])==null||t.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const t=this._tileIterator;for(t.resetOne(e);!t.done;){const i=t.next(),r=i.renderData;if(!r){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,t.skipSubtree();continue}const s=r.localOrigin;let n=this._patchGroups.get(s);n||(n=new Array,this._patchGroups.set(s,n)),n.push(i),(!this._highestVisibleLODTile||i.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=i),t.skipSubtree()}}_useStencilForTile(e){for(const t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){const r=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new qX(n),e.bindParameters,this._passParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],Nt.TRIANGLES,r,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.bindParameters.camera,s=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=bEe(this._stage.viewingMode,this._ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:r.fovY})}const n=this._stencilEnabledLayerExtents.length>0,o=i===Mc.Occluded;o&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",dl),s.setUniform4fv("texOffsetAndScale",pg));const a=v(this._tileRenderer)&&v(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:dl;this._techniqueConfiguration.tileBlendInput===ug.ColorComposite&&s.setUniform3fv("backgroundColor",a);const l=this.wireframe?Nt.LINES:Nt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const c=this._patchGroups;for(const h of c.values()){const p=h[0].renderData.localOrigin;t.program.bindDraw(new qX(p),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const f of h){const m=f.renderData,y=m.textureReference;if(!C(y)){if(!o){s.setUniform4fv("texOffsetAndScale",y.offsetAndScale),s.bindTexture("tex",y.texture.texture);const _=m.textureFadeFactor,b=_<1?m.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&v(b)&&_<1?(s.setUniform1f("fadeFactor",_),s.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),s.setUniform3fv("nextTexOpacities",b.opacities),s.bindTexture("texNext",b.texture.texture)):s.setUniform1f("fadeFactor",1),m.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,t,f,l,n,i),f.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,t,i,r,s,n){const o=i.renderData,a=o.vao,l=a.indexBuffer;if(C(l))return void(co&&console.error("Rendered tile with no indices: ",i.lij," : ",o));const c=t.program;n===Mc.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===z.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(yV,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([d({constructOnly:!0})],lu.prototype,"_overlayRenderer",void 0),u([d({constructOnly:!0})],lu.prototype,"_stage",void 0),u([d({readOnly:!0})],lu.prototype,"_isGlobal",null),u([d({constructOnly:!0})],lu.prototype,"_allTiles",void 0),u([d({constructOnly:!0})],lu.prototype,"_ellipsoidRadius",void 0),u([d({value:!1})],lu.prototype,"renderingDisabled",null),u([d()],lu.prototype,"renderPatchBorders",null),u([d()],lu.prototype,"visualizeNormals",null),u([d()],lu.prototype,"cullBackFaces",null),u([d({value:GA.FRONT_TO_BACK})],lu.prototype,"renderOrder",null),u([d()],lu.prototype,"wireframe",null),lu=u([P("esri.views.3d.terrain.TerrainRenderer")],lu);const E1t=O(),C1t=O(),h2=O(),A1t=O();class M1t{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let Fm=class extends Te{constructor(e){super(e),this._handles=new Ii}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(te(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Be(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!lC(t)||t.isRejected())&&!(t.isFulfilled()&&!R1t(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||n6(t)))),e)if(e.isResolved()){const t=fV(e,this.viewSpatialReference,this.viewingMode);if(v(t)){const i=new os(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===je.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=os.makeWebMercatorAuxiliarySphere(t):_T(e.spatialReference)&&(e=os.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(te(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===je.Global){const e=this.extentHelper.viewSpatialReference,t=_T(e)||Fg(e)||Ng(e);e.isWebMercator?this.tilingScheme=os.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=os.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;v(e)&&!Hx(e,this.extent)&&(this.tilingScheme=os.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function R1t(e,t,i){return v(fV(e,t,i))}u([d()],Fm.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],Fm.prototype,"extent",void 0),u([d({value:!1})],Fm.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],Fm.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],Fm.prototype,"layers",void 0),u([d({constructOnly:!0})],Fm.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],Fm.prototype,"viewingMode",void 0),Fm=u([P("esri.views.3d.terrain.TilingSchemeLogic")],Fm);class O1t{constructor(){this.offset=tt(),this.scale=0,this.tile=null}init(t,i,r,s){this.tile=t,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}let li=class extends ps.EventedMixin(Te){constructor(e){var t,i;super(e),this._scaleRangeQueries=new k4,this._iteratorPool=new ao(ZMe,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new w_t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new M1t,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=O(),this._eyePosSurfaceSR=O(),this._splitLimits=new Bvt,this._frustum=cP(),this._viewProjectionMatrix=Pe(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Ii,this._watchUpdatingTracking=new fg,this._frameTask=gA,this._allTiles=new ri,this._upsampleInfoPool=new ao(O1t),this._rootTilesExtent=yi(),this.updatingProgress=0,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=et.WebMercator,this.visibleElevationBounds=new ZE(1/0,-1/0),this.rootTileElevationBounds=new ZE(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((i=(t=e.view)==null?void 0:t.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=H0t(this.view.resourceController),this._tilePool=this.view.state.isLocal?new ao(Nvt):new ao(Uvt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",n=>n.unloadMapData()),this._elevationQueryCache=new G0t(e.newCache("elevation-query")),this._set("overlayManager",new bc({surface:this})),this._handles.add([te(()=>this.overlayManager.hasHighlights,n=>this._renderer.setNeedsHighlight(n)),te(()=>this.overlayManager.rendersOccluded,n=>this._renderer.setRenderOccludedOverlay(n)),te(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new lu({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:dr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([te(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?io.UNFADED:io.IMMEDIATE)},Gs),te(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?io.UNFADED:io.IMMEDIATE),Gs),te(()=>this.renderingDisabled,()=>{var n,o;return(o=(n=this.view)==null?void 0:n._stage)==null?void 0:o.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},hr),te(()=>this.backgroundColor,n=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(n)},Gs),te(()=>this.snapLevel,()=>this._viewChanged=!0,hr),te(()=>this.view.pointsOfInterest,n=>{this._renderer.pointsOfInterest=n,this._watchUpdatingTracking.removeAll(),n&&this._watchUpdatingTracking.add(()=>n.focus.renderLocation,()=>this._allTilesSorted=!1)}),te(()=>cr.TERRAIN_TILE_TREE_SHOW_TILES,n=>{n&&!this._treeDebugger?Q(()=>import("./TerrainTileTree3DDebugger.7e2f34e9.js"),["assets/TerrainTileTree3DDebugger.7e2f34e9.js","assets/TileTreeDebugger.fbb18468.js"]).then(({TerrainTileTree3DDebugger:o})=>{!this._treeDebugger&&cr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new o({view:this.view}))}):n||(this._treeDebugger=Be(this._treeDebugger))},st)]);const{spatialReference:t}=this.view;this._extentHelper=a_t(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:t});const i=new cA({getCollections:()=>{var n,o,a;return(a=(o=(n=this.view)==null?void 0:n.defaultsFromMap)==null?void 0:o.mapCollections)==null?void 0:a.map(({layers:l})=>l)},getChildrenFunction:n=>n&&"layers"in n?n.layers:null}),r=new Fm({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:t});this._set("tilingSchemeLogic",r),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(rg.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(rg.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(xt.TERRAIN_SURFACE,this),this._handles.add([te(()=>this._extentHelper.stencilEnabledExtents,n=>this._renderer.setStencilEnabledLayerExtents(n),st),te(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),hr),te(()=>this.extent,()=>this._updateRootTiles(),st),this.view.on("resize",()=>this._viewChangeUpdate()),te(()=>{var a,l;const n=this.view,o=n.state;return[this._lodBias,this.lodSnapping,(l=(a=n.resourceController)==null?void 0:a.memoryController)==null?void 0:l.memoryFactor,o.camera,o.contentCamera,o.fixedContentCamera]},()=>this._viewChangeUpdate(),Gs),te(()=>{var n,o;return(o=(n=this.view.qualitySettings)==null?void 0:n.tiledSurface)==null?void 0:o.textureFadeDuration},n=>this._renderer.textureFadingEnabled=n>0,st),te(()=>{var n;return(n=this.view.qualitySettings)==null?void 0:n.physicallyBasedRenderingEnabled},n=>this._renderer.pbrMode=n?gt.Terrain:gt.Disabled,st),te(()=>this._userClippingExtent,()=>this._updateClippingExtent(),hr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([te(()=>{var n;return(n=this.view)==null?void 0:n.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=ls(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Be(this._upsampleMapCache),this._elevationQueryCache=Be(this._elevationQueryCache);const e=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",Be(this.tilingSchemeLogic)),e.destroy(),this._basemapLayerViewHandles.forEach((t,i)=>this._unregisterTiledLayerView(i)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Be(this.overlayManager)),this._tilePool=Be(this._tilePool),wte.prune(),this._treeDebugger=Be(this._treeDebugger),this._renderer=Be(this._renderer),this._iteratorPool=Be(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=Be(this._upsampleInfoPool),i_t(),Z_t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,t;if(this.lodSnapping===rI.ON){const i=this.view,r=this.tilingScheme,s=(t=(e=i.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:t.scale;if(s&&r){const n=i.state.contentCamera;let o=T8(i,n.eye,n.viewForward,n.up).tilt;o>90&&(o=180-o);const a=2*(o/90)**2,l=r.levelAtScale(s)-a;return Math.round(l)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?rI.ON:rI.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(C(t)||C(e))return null;const i=yi(),r=LMe(t,i,e)?i:null,s=this._get("extent");return Hx(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=Oj(this.groundExtent,this._userClippingExtent,yi()),t=this._get("extent");return Hx(e,t)?t:e}get groundExtent(){return v(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return v(this._rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e,t;return(t=(e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)!=null?t:!1}set velvetOverground(e){this._renderer.velvetOverground=e,this._set("velvetOverground",e)}get wireframe(){return this._renderer.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===vo.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){var e;return(e=this.view.qualitySettings.tiledSurface.textureFadeDuration)!=null?e:0}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this._rootTiles;if(C(s)||!s.length||s[0].layerInfo[wi.ELEVATION].length===0)return null;const n=hc;return n[0]=e,n[1]=t,n[2]=i,Zo(n,r,n,this._spatialReference)?Nde(s,n[0],n[1]):(se.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,t,i){const r=this._rootTiles,s=r?r[0].layerInfo[wi.ELEVATION].length:0;if(!C(r)&&r.length&&s!==0)for(let n=0;n<t;++n){const o=3*n;i(n,Nde(r,e[o+0],e[o+1]))}else for(let n=0;n<t;++n)i(n,null)}getScale(e){if(!this.tilingScheme)return null;if(!Xa(e,hc,this.spatialReference))return se.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this._rootTiles;if(v(t)){for(const i of t)if(i!=null&&i.containsPoint(hc)){let r=i;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let n=0;hc[0]>s[2]&&(n+=1),hc[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}getSphereElevationBounds(e,t,i,r,s){var c;if(hc[0]=e,hc[1]=t,hc[2]=i,hc[3]=r,!Zo(hc,s,hc,(c=this.tilingScheme)==null?void 0:c.spatialReference))return se.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=h=>{if(h&&kie(h.extent,hc))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),o=Math.max(o,h.elevationBounds[1]);else for(const p of h.children)a(p)},l=this._rootTiles;if(v(l))for(const h of l)a(h);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!Xa(e,hc,this.spatialReference))return se.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;hc[3]=t;let i=null;const r=n=>{if(n&&kie(n.extent,hc)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}}},s=this._rootTiles;if(v(s))for(const n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+o,n+o,r)}_evaluateTransparency(){var n,o;const e=this.baseOpacity,t=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?t?vo.Empty:vo.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?vo.Opaque:vo.Semitransparent,s=i!==r;return s&&(this._renderer.transparency=r,(o=(n=this.view)==null?void 0:n._stage)==null||o.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var i,r,s,n;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;Xm(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(i=this.view)==null?void 0:i.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles();const t=(s=e==null?void 0:e.spatialReference)!=null?s:et.WebMercator;this._spatialReference=t,this._isWebMercator=!!(t!=null&&t.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&wZ((n=this.view)==null?void 0:n.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return LF[0]=e,LF[1]=t,LF[2]=i,s.init(LF,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=$1t;let r=t.rootTilesInExtent(e,i,5*kE);if(v(this._rootTiles)){if(r.length>kE)return void se.getLogger(this.declaredClass).warn(zZe);const s=this._rootTiles.map(o=>o.lij),n=uIe(s,r,Fde);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>Fde(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>kE&&(se.getLogger(this.declaredClass).warn(GZe),r=t.rootTilesInExtent(e,i,kE)),this._setRootTiles(r.map(s=>this._newRootTile(s)));Hx(i,this._rootTilesExtent)||(this._rootTilesExtent=yi(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(t=>t.isLoaded&&t.intersectsClippingArea);e.forEach(t=>this._renderer.updateTileGeometryState(t)),e.forEach(t=>t.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(S0);const t=this.renderer;e.forEach(i=>t.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Rt.SPLIT}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(t)&&t.setPendingUpdate(Rt.SPLIT),this._loadTile(t),this._markTileToUpdate(t),this._updateRootTileElevationBounds(),t}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),v(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(Rt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(C(e))return;const t=M_t(e),i=this.visibleElevationBounds;let r=t?i.min:1/0,s=t?i.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(Rt.GEOMETRY)&&this._updateTileGeometryState(l),l.setPendingUpdate(Rt.RENDERDATA),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBounds[0],r),s=Math.max(l.elevationBounds[1],s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(i.min!==r||i.max!==s)&&(this.visibleElevationBounds=new ZE(r,s))}_updateRootTileElevationBounds(){let e=1/0,t=-1/0;const i=this._rootTiles;v(i)&&i.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),t=Math.max(t,s[1])});const r=this.rootTileElevationBounds;r.min===e&&r.max===t||(this.rootTileElevationBounds=new ZE(e,t))}_updateViewDependentParameters(){const{camera:e,contentCamera:t}=this.view.state,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(C(this._splitLimits.frustum)&&(this._splitLimits.frustum=cP()),vk(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,vk(this._frustum,e.frustum),Hs(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),le(this._eyePosRenderSR,t.eye),Zo(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(CRe(e)?this._loadChildren(e):P1t(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const t=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{t.add(i)})}_updateTileTexture(e,t){const i=e.resetPendingUpdate(Rt.TEXTURE_FADING)?Rt.TEXTURE_FADING:!!e.resetPendingUpdate(Rt.TEXTURE_NOFADING)&&Rt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_emitElevationUpdateEventForTiles(){const e=D7.extent;rp(e),this._pendingTilesForElevationUpdateEvent.forEach(t=>A1(e,t.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),D7.spatialReference=this.spatialReference,this.emit("elevation-change",D7)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),this._updateElevation(e),this._updateTextures(e),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();t.reset(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;for(;!t.done;){const n=t.next(),o=n.shouldSplit(r,s,i);if(o!==Rt.SPLIT){if(n.resetPendingUpdate(Rt.SPLIT)&&n.updateAgentSuspension(),o===Rt.VSPLITMERGE&&n.updateAgents(wi.ELEVATION),t.skipSubtree(),!n.isLeaf){n.setPendingUpdate(Rt.MERGE),n.resetPendingUpdate(Rt.SPLIT);const a=this._iteratorPool.acquire();a.resetOne(n);const l=this._viewProjectionMatrix;for(let c=a.next();!a.done;c=a.next())this._updateClippingStatus(c),c.updateVisibility(),c.updateScreenDepth(l);a.remove()}}else n.resetPendingUpdate(Rt.MERGE),n.isLeaf&&(n.setPendingUpdate(Rt.SPLIT),t.skipSubtree()),n.rendered&&n.setPendingUpdate(Rt.RENDERDATA)}t.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(C_t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Me(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const t=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),i=(s,n)=>{!(n!=null&&n.isLoaded)||!n.intersectsClippingArea||n.level<s.level||e.has(n)||(e.add(n),t.push(n),n.renderData.updateNeighborData())};t.sort(S0);const r=t.length;for(let s=0;s<r;++s){const n=t[s];Me(n.isLoaded),Me(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o._dirtyEdgeResolutions,l=o.geometryState.neighborData;for(let c=0;c<4;++c)if(a&1<<c){const h=o.geometryState.neighborData.edgePeerNeighbors[c];h&&(h==null?void 0:h.level)>=n.level&&h.forAllSubtreeOnSide(a6(cg[c]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(Me(e.has(p)||S0(n,p)<0),i(n,p),!0)),i(n,l.cornerPeerNeighbors[c]),i(n,l.cornerPeerNeighbors[(c+1)%4])}}e.clear(),this._updateTilesGeometries(t),co&&s6&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!e.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{var c;if(!i&&!r&&!a.visible)return e.done;let l=a;if(a.resetPendingUpdate(Rt.MERGE)){if(!t)return a.setPendingUpdate(Rt.MERGE),e.done;for(;(c=l.parent)!=null&&c.resetPendingUpdate(Rt.MERGE);)l=l.parent;this._mergeTile(l),n=!0,e.madeProgress()}else a.resetPendingUpdate(Rt.SPLIT)&&(this._splitTile(a),n=!0,e.madeProgress());return!e.done&&l===a&&a.resetPendingUpdate(Rt.RENDERDATA)&&(this._updateRenderData(a),e.madeProgress()),e.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0),o){if(!i){i=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(t=>(t.resetPendingUpdate(Rt.GEOMETRY)&&(this._updateTileGeometryState(t),this._updateTileTexture(t,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(cn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*VZe}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=ye(e-this._lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){v(this._rootTiles)&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i])||t;return e.unsetChildren(),t}_purgeTile(e){const t=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),t}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){Xm(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(Rt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){DF.spatialReference=this.spatialReference,DF.extent=e.extent,DF.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",DF)}_createTile(e,t,i,r){Xm(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(Rt.SPLIT),s}get shortBatches(){return this.view.state.mode!==Di.IDLE}_mergeTile(e){Xm(!e.hasPendingUpdate(Rt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Xm(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){Xm(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(i=>this._loadTile(i)),t.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t,t.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const t=e.children;if(t[0])for(let i=0;i<4;++i){const r=t[i];this._unloadChildren(r),this._unloadTile(r)}}_loadTile(e){e.load(),e.setPendingUpdate(Rt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,t,i){const r=new n_t(e.lij,e.extent,i);e.dataArrived(t,wi.ELEVATION,r);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}n===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=Hl){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),GP(s)||RR(s))if(this._basemapLayerViewHandles.has(s.uid)&&!RR(s)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);v(o)&&((o<r||C(r))&&(t=!0),r=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,i;let e=((i=(t=this.view.map)==null?void 0:t.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(oY(r)&&!G0e(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((o6(e)||RR(e))&&L_t(uY[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return nY(e)?wi.ELEVATION:wi.MAP}_registerTiledLayerView(e){const t=[];if((o6(e)||RR(e))&&t.push(te(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(io.UNFADED)})),RR(e))return;const i=this._layerClassFromLayerView(e);t.push(te(()=>e.suspended,()=>this._updateTiledLayers())),t.push(te(()=>e.fullOpacity,()=>this._updateTileTextures(io.UNFADED))),t.push(te(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,e.uid);v(r)&&this._invalidateLayerData(r,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let i=0;i<t.length;i++)t[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach(r=>{if(!r.layer||r.suspended||!GP(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===wi.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}t[s].push(r)});for(const r of rx){const s=this._layerViews[r],n=t[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const p=n[h].uid;this._layerIndexByUid[r].set(p,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this._rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this._rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===wi.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(wi.MAP),e===io.IMMEDIATE?this.renderer.updateTileTexture(t,Rt.TEXTURE_NOFADING):t.updateRenderData(wi.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=cn.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||zP(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,ii(r),Ws(o)||this._dataMissing(e,i,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){return t===wi.ELEVATION?nY(i)?this._requestElevationTileData(e,i,r):Promise.reject():oY(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=o=>{if(So(i))return;const a=this._layerIndexByUid[wi.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):se.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",wi.ELEVATION,e.lij.toString())},s=o=>{Ws(o)||(this._dataMissing(e,wi.ELEVATION,t,o),this.requestUpdate())};if(ede(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:eP,signal:i.signal}).then(o=>{if(!So(i))return this._frameTask.schedule(()=>r(o),i.signal,s);se.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:eP},i.signal)).then(o=>{o?r(new j0t(o)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,RC(h),So(i)||(this._dataMissing(e,wi.MAP,t,c),this.requestUpdate())},s=c=>h=>r(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),So(i)?RC(c):this._mapTileDataArrived(e,t,c)},i.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(zP(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],i).then(n,o)}if(pV(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,o);if(yte(t)&&ede(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(c=>{if(So(i))return se.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(lr());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);X9e(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(n,o)}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(wi.MAP,t.uid);v(r)?e.dataArrived(r,wi.MAP,i):(RC(i),se.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i,r){const s=this._getLayerIdxByUID(t,i.uid);v(s)?e.dataMissing(s,t,r):se.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(C(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),v(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return v(r)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(C(e)||C(this._rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this._rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return Xm(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{v(e._rootTiles)&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){L7.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&L7.push(i)});const t=L7.toArray();return JMe(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTilesWaterproofness(){if(!s6)return;const e=this._rootTiles;if(C(e))return;const t=n=>{var o,a,l;return((l=(a=(o=n==null?void 0:n.renderData)==null?void 0:o.geometryInfo)==null?void 0:a.indices)==null?void 0:l.length)>0},i=(n,o)=>{t(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},r=n=>{var o,a,l;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometryInfo&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((o=n.renderData)!=null&&o.geometryInfo)||((l=(a=n.renderData.geometryInfo.indices)==null?void 0:a.length)!=null?l:0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometryInfo),t(n)){n.checkGeometryWaterproofness();for(const c of n.children)i(c,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const c of n.children)r(c)},s=n=>{var c,h;const o=(h=(c=n.parent)==null?void 0:c.visible)!=null?h:!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const p of n.children)s(p)};for(const n of e)r(n),s(n)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var t,i,r;((r=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.ground)==null?void 0:r.shading)!==this._shading&&this._updateShading()}_updateShading(){var t,i,r;const e=(r=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.ground)==null?void 0:r.shading;this._shading=e,this.renderer&&(this.renderer.shading=e,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(v(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}enableInternalChecks(e){p0t(e)}enableWaterproofnessChecks(e){d0t(e)}};u([d()],li.prototype,"_renderer",void 0),u([d({constructOnly:!0})],li.prototype,"_scaleRangeQueries",void 0),u([d()],li.prototype,"_hasPendingUpdates",void 0),u([d()],li.prototype,"_asyncWorkItems",void 0),u([d()],li.prototype,"_allTilesDirty",void 0),u([d()],li.prototype,"_allTilesSorted",void 0),u([d()],li.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],li.prototype,"_watchUpdatingTracking",void 0),u([d()],li.prototype,"_frameTask",void 0),u([d({readOnly:!0})],li.prototype,"snapLevel",null),u([d({readOnly:!0})],li.prototype,"lodSnapping",null),u([d({constructOnly:!0})],li.prototype,"view",void 0),u([d()],li.prototype,"_userClippingExtent",null),u([d()],li.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],li.prototype,"extent",null),u([d({readOnly:!0})],li.prototype,"groundExtent",null),u([d({readOnly:!0})],li.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],li.prototype,"updating",null),u([d({readOnly:!0})],li.prototype,"running",null),u([d(r_t)],li.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],li.prototype,"updatingProgressValue",null),u([d()],li.prototype,"_maxNumUpdating",void 0),u([d()],li.prototype,"baseOpacity",null),u([d()],li.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],li.prototype,"overlayManager",void 0),u([d({readOnly:!0})],li.prototype,"viewingMode",null),u([d()],li.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],li.prototype,"ready",null),u([d({value:GA.FRONT_TO_BACK})],li.prototype,"renderOrder",null),u([d({readOnly:!0})],li.prototype,"rootTiles",null),u([d()],li.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],li.prototype,"spatialReference",null),u([d({type:De})],li.prototype,"backgroundColor",null),u([d({value:!1})],li.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],li.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],li.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],li.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],li.prototype,"velvetOverground",null),u([d()],li.prototype,"wireframe",null),u([d({value:!1})],li.prototype,"suspended",null),u([d()],li.prototype,"textureFadeDuration",null),u([d()],li.prototype,"visibleElevationBounds",void 0),u([d()],li.prototype,"rootTileElevationBounds",void 0),u([d()],li.prototype,"_layerViewsDirty",void 0),u([d()],li.prototype,"renderPatchBorders",null),u([d()],li.prototype,"visualizeNormals",null),u([d()],li.prototype,"renderingDisabled",null),li=u([P("esri.views.3d.terrain.TerrainSurface")],li);const I1t=li;function Fde(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function CRe(e){const t=e.children;if(!t[0])return!1;for(const i of t)if(i.shouldLoad)return!0;for(const i of t)if(CRe(i))return!0;return!1}function P1t(e){var t,i;return e.isLeaf&&((i=(t=e.parent)==null?void 0:t.shouldLoad)!=null?i:!1)}const hc=ui(),$1t=yi(),LF=[0,0,0],L7=new ri,D7={spatialReference:null,extent:yi(),context:"ground"},DF={spatialReference:null,extent:null,scale:0};function Nde(e,t,i){var r,s;for(const n of e){if(!n.containsPointXY(t,i))continue;let o=n;for(;o&&!o.renderData;){const l=(t>o.extentMidX?1:0)+(i<o.extentMidY?2:0);o=o.children[l]}const a=(s=(r=o==null?void 0:o.renderData)==null?void 0:r.geometryState.samplerData)!=null?s:null;return cs(t,i,a)}return null}class L1t{constructor(t,i,r){this.operation=t,this.geometry=i,this.states=r}}let l3=class extends Te{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((r,s)=>{const n=this._ensureGeomRecord(e,s);r.forEach(({geometry:o,operation:a,states:l},c)=>{let h=!1;if(a===Os.UPDATE){const p=n.get(c);if(p){if(l&wo.TRANSFORMATION){const f=this.model.getObject(s);this.model.updateRenderGeometryTransformation(f,o,p)&&(h=!0)}h||t.updates.push({renderGeometry:p,updateType:l})}else vt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(a===Os.REMOVE||h){const p=n.get(c);p?(t.removes.push(p),n.delete(c)):a===Os.REMOVE&&vt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(a===Os.ADD||h){const p=this.model.getObject(s);if(v(p)){const f=this.model.getRenderGeometry(p,o);t.adds.push(f),n.set(c,f)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s)))}_objectStateChanged(e,t){for(const i of t.geometries)this._updateOrCreateDirtyRecord(t,i,null,Os.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(wo.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(wo.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(wo.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,Os.UPDATE,wo.GEOMETRY)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometries)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometries)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((i,r)=>{const s=this.model.getObject(r);s&&s.hasVolativeTransformation()&&i.forEach(n=>n.shaderTransformationChanged())})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r.geometry,t,Os.UPDATE,wo.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,Os.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,Os.REMOVE)}_updateOrCreateDirtyRecord(e,t,i,r,s=wo.NONE){i=Ft(i,this._getParentLayerId(e));const n=e.id,o=t.id,a=this._ensureDirtyRecord(i,n),l=a.get(o);if(l){const c=l.operation;c===Os.REMOVE&&r===Os.ADD&&l.states!==wo.NONE?l.operation=Os.UPDATE:c===Os.REMOVE&&r===Os.ADD||c===Os.ADD&&r===Os.REMOVE?a.delete(o):c!==Os.UPDATE||r!==Os.REMOVE&&r!==Os.UPDATE?(vt((c===Os.REMOVE||c===Os.ADD)&&r===Os.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),l.states|=s):(l.operation=r,l.states|=s)}else a.set(o,new L1t(r,t,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return za(this._dirtyGeomRecords,e=>za(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return v(e.parentLayer)?e.parentLayer.id:kPe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;const o=[];s.forEach(a=>{const l=a.operation;o[l]||(o[l]=[]),o[l].push(a.geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,i)=>t+i.size,0)},commit:t=>e._dirtyGeomRecords.forEach((i,r)=>e.commitLayer(r,t))}}};u([d({constructOnly:!0})],l3.prototype,"model",void 0),u([d()],l3.prototype,"dirty",void 0),l3=u([P("esri.views.3d.webgl-engine.lib.ModelDirtySet")],l3);const D1t=l3;let B4=class extends Te{constructor(){super(...arguments),this.dirtySet=new D1t({model:this}),this._content=new Map,this._originFactory=new Xee(null)}getObject(e){return this._content.get(e)}add(e){const t=e.id;vt(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),Wk(e)&&this.dirtySet.layerAdded(e)}remove(e){vt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),Wk(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)v(t)&&(vt(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)vt(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{shaderTransformer:i,localOrigin:r}=t,s=new BA(t,{boundingInfo:t.boundingInfo,shaderTransformer:i,castShadow:e.castShadow});return s.updateTransformation(n=>e.getCombinedStaticTransformation(t,n)),s.localOrigin=v(r)?r:this._originFactory.getOrigin(s.boundingSphere),s}updateRenderGeometryTransformation(e,t,i){if(C(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const r=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<hn.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],B4.prototype,"dirtySet",void 0),B4=u([P("esri.views.3d.webgl-engine.parts.Model")],B4);function F1t(){const e=new Float32Array(4);return e[3]=1,e}function ARe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function N1t(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function MRe(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:ARe,create:F1t,createView:MRe,fromValues:N1t},Symbol.toStringTag,{value:"Module"}));const HA=1e-6,LR=[0,0,0],FF=[0,0,0];function k1t(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new W1t(e);z4(LR,n.minProj,n.maxProj),Ax(LR,LR,.5),Bd(FF,n.maxProj,n.minProj);const o=mY(FF),a=new X1t;a.quality=o,s<14&&(e=new Ke(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(U1t(n,e,y,l,c,h,p,f,m,a)){case 1:return void Bde(LR,FF,t);case 2:return void q1t(e,p,t)}V1t(e,y,l,c,h,p,f,m,a),RRe(e,a.b0,a.b1,a.b2,$C,LC);const _=[0,0,0];Bd(_,LC,$C),a.quality=mY(_),a.quality<o?ORe(a.b0,a.b1,a.b2,$C,LC,_,t):Bde(LR,FF,t)}function U1t(e,t,i,r,s,n,o,a,l,c){return B1t(e,r,s),gY(r,s)<HA?1:(Bd(o,r,s),ka(o,o),z1t(t,r,o,n)<HA?2:(Bd(a,s,n),ka(a,a),Bd(l,n,r),ka(l,l),zd(i,a,o),ka(i,i),sx(t,i,o,a,l,c),0))}const DR=[0,0,0],FR=[0,0,0],ad=[0,0,0],ld=[0,0,0],cd=[0,0,0],j_=[0,0,0],H_=[0,0,0],q_=[0,0,0];function V1t(e,t,i,r,s,n,o,a,l){G1t(e,t,i,DR,FR),DR[0]!==void 0&&(Bd(ad,DR,i),ka(ad,ad),Bd(ld,DR,r),ka(ld,ld),Bd(cd,DR,s),ka(cd,cd),zd(j_,ld,n),ka(j_,j_),zd(H_,cd,o),ka(H_,H_),zd(q_,ad,a),ka(q_,q_),sx(e,j_,n,ld,ad,l),sx(e,H_,o,cd,ld,l),sx(e,q_,a,ad,cd,l)),FR[0]!==void 0&&(Bd(ad,FR,i),ka(ad,ad),Bd(ld,FR,r),ka(ld,ld),Bd(cd,FR,s),ka(cd,cd),zd(j_,ld,n),ka(j_,j_),zd(H_,cd,o),ka(H_,H_),zd(q_,ad,a),ka(q_,q_),sx(e,j_,n,ld,ad,l),sx(e,H_,o,cd,ld,l),sx(e,q_,a,ad,cd,l))}function B1t(e,t,i){let r=gY(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=gY(e.maxVert[n],e.minVert[n]);o>r&&(r=o,s=n)}Mu(t,e.minVert[s]),Mu(i,e.maxVert[s])}const ud=[0,0,0];function z1t(e,t,i,r){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){ud[0]=s[l]-t[0],ud[1]=s[l+1]-t[1],ud[2]=s[l+2]-t[2];const c=i[0]*ud[0]+i[1]*ud[1]+i[2]*ud[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=ud[0]*ud[0]+ud[1]*ud[1]+ud[2]*ud[2]-c*c/h;p>o&&(o=p,a=l)}return Mu(r,s,a),o}const bo=[0,0];function G1t(e,t,i,r,s){H1t(e,t,bo,s,r);const n=PRe(i,t);bo[1]-HA<=n&&(r[0]=void 0),bo[0]+HA>=n&&(s[0]=void 0)}const kde=[0,0,0],Ude=[0,0,0],Vde=[0,0,0],d2=[0,0,0],p2=[0,0,0],NF=[0,0,0];function sx(e,t,i,r,s,n){if(IRe(t)<HA)return;zd(kde,i,t),zd(Ude,r,t),zd(Vde,s,t),PC(e,t,bo),p2[1]=bo[0],d2[1]=bo[1],NF[1]=d2[1]-p2[1];const o=[i,r,s],a=[kde,Ude,Vde];for(let l=0;l<3;++l){PC(e,o[l],bo),p2[0]=bo[0],d2[0]=bo[1],PC(e,a[l],bo),p2[2]=bo[0],d2[2]=bo[1],NF[0]=d2[0]-p2[0],NF[2]=d2[2]-p2[2];const c=mY(NF);c<n.quality&&(Mu(n.b0,o[l]),Mu(n.b1,t),Mu(n.b2,a[l]),n.quality=c)}}const j1t=[0,0,0];function PC(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*t[0]+r[n+1]*t[1]+r[n+2]*t[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function H1t(e,t,i,r,s){const{data:n,size:o}=e;Mu(r,n),Mu(s,r),i[0]=PRe(j1t,t),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<i[0]&&(i[0]=l,Mu(r,n,a)),l>i[1]&&(i[1]=l,Mu(s,n,a))}}function Bde(e,t,i){Mu(i.center,e),Ax(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const fy=[0,0,0],f2=[0,0,0],NR=[0,0,0],$C=[0,0,0],LC=[0,0,0],zde=[0,0,0];function q1t(e,t,i){Mu(fy,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?fy[0]=0:Math.abs(t[1])>Math.abs(t[2])?fy[1]=0:fy[2]=0,IRe(fy)<HA&&(fy[0]=fy[1]=fy[2]=1),zd(f2,t,fy),ka(f2,f2),zd(NR,t,f2),ka(NR,NR),RRe(e,t,f2,NR,$C,LC),Bd(zde,LC,$C),ORe(t,f2,NR,$C,LC,zde,i)}function RRe(e,t,i,r,s,n){PC(e,t,bo),s[0]=bo[0],n[0]=bo[1],PC(e,i,bo),s[1]=bo[0],n[1]=bo[1],PC(e,r,bo),s[2]=bo[0],n[2]=bo[1]}const kF=[0,0,0],pm=[1,0,0,0,1,0,0,0,1],m2=[0,0,0];function ORe(e,t,i,r,s,n,o){pm[0]=e[0],pm[1]=e[1],pm[2]=e[2],pm[3]=t[0],pm[4]=t[1],pm[5]=t[2],pm[6]=i[0],pm[7]=i[1],pm[8]=i[2],Y1t(o.quaternion,pm),z4(m2,r,s),Ax(m2,m2,.5),Ax(o.center,e,m2[0]),Ax(kF,t,m2[1]),z4(o.center,o.center,kF),Ax(kF,i,m2[2]),z4(o.center,o.center,kF),Ax(o.halfSize,n,.5)}const Yu=7;class W1t{constructor(t){this.minVert=new Array(Yu),this.maxVert=new Array(Yu);const i=64*Yu;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Yu),r+=8*Yu,this.maxProj=new Float64Array(this.buffer,r,Yu),r+=8*Yu;for(let l=0;l<Yu;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Yu;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Yu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Yu),n=new Array(Yu),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Yu;++l){let c=s[l];Mu(this.minVert[l],o,c),c=n[l],Mu(this.maxVert[l],o,c)}}}class X1t{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function mY(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function z4(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function Bd(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function Ax(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function Mu(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function zd(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o}function ka(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function IRe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function gY(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function PRe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Y1t(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1);e[r]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+r]+t[3*r+s])*o,e[n]=(t[3*n+r]+t[3*r+n])*o}}const pI=fp(),zx=O(),Z1t=O(),J1t=Cs();class G3t{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:qY(this.buffer,56*a+0),halfSize:vSe(this.buffer,56*a+24),quaternion:MRe(this.buffer,56*a+36)}}}function $Re(e=[0,0,0],t=[-1,-1,-1],i=fp()){return{center:js(e),halfSize:yk(t),quaternion:ARe(i)}}function Gde(e){return $Re(e.center,e.halfSize,e.quaternion)}function j3t(e,t){le(t.center,e.center),le(t.halfSize,e.halfSize),HQ(t.quaternion,e.quaternion)}function H3t(e,t){return t=t||$Re(),k1t(e,t),t}function nx(e,t){const i=Ur(t,e.center),r=TV(e,t);return i>r?1:i<-r?-1:0}function q3t(e,t){t||(t=ho());const i=PQ(J1t,e.quaternion),r=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),s=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),n=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+r,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function W3t(e,t){return Ur(t,e.center)-TV(e,t)}function X3t(e,t){return Ur(t,e.center)+TV(e,t)}function Y3t(e,t){return nx(e,t[0])<=0&&nx(e,t[1])<=0&&nx(e,t[2])<=0&&nx(e,t[3])<=0&&nx(e,t[4])<=0&&nx(e,t[5])<=0}function Z3t(e,t,i,r=0){NT(pI,e.quaternion),me(zx,t,e.center);const s=Cf(zx,zx,pI),n=Cf(Z1t,i,pI);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+e.halfSize[l]-s[l])/n[l],h=(-r-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+r||s[l]<-e.halfSize[l]-r)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function TV(e,t){NT(pI,e.quaternion),Cf(zx,t,pI);const i=e.halfSize;return Math.abs(zx[0]*i[0])+Math.abs(zx[1]*i[1])+Math.abs(zx[2]*i[2])}function J3t(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],Cf(r,r,e.quaternion),fe(r,r,e.center)}}function K1t(e){return pu(e.halfSize)}function Q1t(e,t,i,r,s){if(HQ(s.quaternion,e.quaternion),r===je.Global){NT(UF,e.quaternion),Cf(W_,e.center,UF),yG(g2,W_),eme(y2,g2,e.halfSize),Wo(y2,g2,y2);const n=Oe(y2);fe(y2,g2,e.halfSize);const o=Oe(y2);if(n<i)le(s.center,e.center),ue(W_,i,i,i),fe(s.halfSize,e.halfSize,W_);else{const a=o>0?1+t/o:1,l=n>0?1+i/n:1,c=(l+a)/2,h=(l-a)/2;ae(s.halfSize,g2,h),Rx(s.halfSize,s.halfSize,e.halfSize,c),ae(s.center,g2,c),Rx(s.center,s.center,e.halfSize,h),Qfe(W_,W_),R6(s.center,s.center,W_),Cf(s.center,s.center,s.quaternion)}}else{const n=ue(W_,0,0,1);Rx(s.center,e.center,n,(i+t)/2),NT(UF,e.quaternion),Cf(n,n,UF),yG(n,n),Rx(s.halfSize,e.halfSize,n,(i-t)/2)}return s}const W_=O(),g2=O(),y2=O(),UF=fp();class ebt{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];return i}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=tbt(t)}forEachComponent(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=t[n],l=t[o];i[s]=a,i[s+1]=l-a}return i}}function tbt(e){const t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}class ibt{constructor(t,i){this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=i.slice();const r=this.count;this.visibility=new ebt(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return C(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return C(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return C(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((C(this.cachedHighlightRanges)||C(this.cachedDefaultRanges))&&v(this.highlightCounts)){const{highlightRanges:t,defaultRanges:i}=rbt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=i}}}function rbt(e,t,i){const r=[],s=[];let n=i.length,o=i.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let c3=class extends Te{constructor(){super(...arguments),this.visible=DC.Hidden}};var DC;u([d({autoDestroy:!0})],c3.prototype,"renderable",void 0),u([d({autoDestroy:!0})],c3.prototype,"components",void 0),c3=u([P("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],c3),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(DC||(DC={}));function sbt(e,t,i,r){if(i>=t)return e;e==null&&(e=nbt());const s=e.isVisibleBit;let n=e.data;const o=DRe(n),a=i/o|0,l=i-o*a,c=(t-1)/o|0,h=n,p=r===s;if(!(i<h.length*o)&&p){const m=a+1,y=Math.ceil(h.length*1.5),_=c+1;let b=Math.max(m,y);b=Math.min(b,_),n=new Uint32Array(b),n.set(h)}return a<n.length&&(n[a]=abt(n[a],l,p)),e.data=n,e}function LRe(e,t){if(e==null)return!0;const{isVisibleBit:i,data:r}=e,s=DRe(r);return t<r.length*s?obt(i,r,t,s):!e.isVisibleBit}function nbt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function obt(e,t,i,r){const s=i/r|0,n=i-s*r;return lbt(t[s],n)===e}function DRe(e){return e.BYTES_PER_ELEMENT*8}function abt(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function lbt(e,t){return(e&1<<t)!=0}class cbt{constructor(t,i){this._indices=v(t.indices)?t.indices:IA(t.positions.length/3),this._positions=new Mr(t.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(t,i){if(v(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*t+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(t,i)}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,o,a){const l=new Ke(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),c=this._indices,h=this._components.offsets,p=LEe(t,i,ubt),f=t[2],m=i[2];this._components.visibility.forEachComponent(y=>{if(!LRe(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,hbt);if(v(o)){const E=o[y];v(n)?n.componentOffset=E:(t[2]=f-E,i[2]=m-E)}if(v(n)&&n.applyToAabb(_),!xee(_,t,p,r))return!0;const b=h[y]/3,w=h[y+1]/3,T=w-b,S=(E,M,A)=>a(y,E,Eu(M,M,s),A);return C(n)&&T>SRe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new jA(this._indices,b,w,l)),this._componentIntersectionData[y].intersectRay({r0:t,r1:i},S)):z$(t,i,b,w,c,l,void 0,n,S),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const i=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,_=-1/0;for(let b=l;b<c;b++){const w=i[b]*s,T=r[w],S=r[w+1],E=r[w+2];h=Math.min(h,T),p=Math.min(p,S),f=Math.min(f,E),m=Math.max(m,T),y=Math.max(y,S),_=Math.max(_,E)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=y,this._perComponentAabbs[o++]=_}}get positions(){return this._positions}get indices(){return this._indices}}const ubt=O(),hbt=ho();class dbt{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}}class pbt{constructor(t,i,r,s){this.vao=t,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}}class fbt{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}}function mbt(e,t){return{near:e,far:t}}function eL(e){return e?WP(e,1/0,-1/0):mbt(1/0,-1/0)}function WP(e,t,i){return e.near=t,e.far=i,e}function qA(e,t,i=e){return t!=null&&(i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far)),i}function VF(e,t){return e.near<=t&&t<=e.far}const yY={near:0,far:0};function gbt(e,t){const i=eL(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=v(o.offsetObb)?o.offsetObb:o.obb,l=_e(Wo(sh,a.center,r),n),c=TV(a,n);if(VF(i,l-c)&&VF(i,l+c))return;const h=wbt(a,s);if(h===-1)return;if(h===0)return my.far=l+c,my.near=l-c,void qA(i,my);const p=BF.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<BF.length;o++){const a=BF.data[o];if(VF(i,a.near)&&VF(i,a.far))continue;my.far=a.far,my.near=1/0,bbt(v(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,ybt,c=>{let h=_bt;for(let p=0;p<FRe&&c.length>0;p++){if((a.mask&1<<p)==0)continue;vbt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){ue(Cc,c.data[p+0],c.data[p+1],c.data[p+2]);const f=_e(Wo(Cc,Cc,r),n);my.near=Math.min(my.near,f)}})===0&&(my.near=0),qA(i,my)}return BF.length=0,i}const BF=new ri({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=sT(e.object),e)}),my=eL(),Cc=O(),ow=O(),ybt=new ri({deallocator:null}),_bt=new ri({deallocator:null});function vbt(e,t,i){i.length=0;const r=t.length-3;F7(Cc,t,r);const s=Ur(e,Cc);s<=0&&(i.push(Cc[0]),i.push(Cc[1]),i.push(Cc[2]));let n=0,o=s;for(;n<r;n+=3){F7(ow,t,n);const a=Ur(e,ow);o*a<0&&(On(Cc,ow,Cc,a/(a-o)),Ac(i,Cc)),a<=0&&Ac(i,ow),o=a,le(Cc,ow)}o*s<0&&(F7(ow,t,r),On(Cc,ow,Cc,s/(s-o)),Ac(i,Cc))}function F7(e,t,i){return ue(e,t.data[i+0],t.data[i+1],t.data[i+2])}function Ac(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function bbt(e,t,i,r){NT(Hde,e.quaternion),Wo(sh,t,e.center),Cf(sh,sh,Hde);const s=8*((sh[0]<-e.halfSize[0]?-1:sh[0]>e.halfSize[0]?1:0)+3*(sh[1]<-e.halfSize[1]?-1:sh[1]>e.halfSize[1]?1:0)+9*(sh[2]<-e.halfSize[2]?-1:sh[2]>e.halfSize[2]?1:0)+13),n=jde[s];if(n===0)return n;PQ(zF,e.quaternion),IQ(zF,zF,e.halfSize);const o=(a,l)=>{const c=jde[s+l+1];return ue(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Eu(a,a,zF),fe(a,e.center,a)};return i.length=0,Ac(i,o(N7,0)),Ac(i,o(qde,1)),Ac(i,o(sh,2)),Ac(i,o(Wde,3)),r(i),n===1||(i.length=0,Ac(i,N7),Ac(i,Wde),Ac(i,o(sh,4)),Ac(i,o(Xde,5)),r(i),n===2||(i.length=0,Ac(i,N7),Ac(i,Xde),Ac(i,o(sh,6)),Ac(i,qde),r(i))),n}const jde=(()=>{const e=new Int8Array(216);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),FRe=4;function wbt(e,t){let i=0;for(let r=0;r<FRe;r++){const s=nx(e,t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const zF=Cs(),Hde=fp(),sh=O(),N7=O(),qde=O(),Wde=O(),Xde=O();class xbt{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,i,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?gbt(t,this._objects.visibleObjects):null}}function Tbt(e){const t=As().vec3f(R.POSITION);return e.normals&&t.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===En.Default?t.vec2f(R.UV0):e.textureCoordinates===En.Atlas&&(t.vec2f(R.UV0),t.vec4u16(R.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(R.COLOR,{glNormalized:!0}),t.alignTo(4)}class Sbt{constructor(){this.externalColor=ui(),this.externalColorMixMode=ro.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}}class Ebt extends Zs{constructor(t,i){super(t,"int",Ar.Draw,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}var vg;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(vg||(vg={}));const Rte=429496.7296;function NRe(e,t){RP(e/Rte*.5+.5,t)}function Cbt(e,t){switch(t.componentData){case vg.Varying:return Abt(e,t);case vg.Uniform:return Mbt(e);case vg.COUNT:return;default:t.componentData}}function Abt(e,t){const{vertex:i,fragment:r}=e;i.include(ku),i.uniforms.add(L1("componentColorTex",n=>n.componentParameters.texture.texture,t.hasWebGL2Context?fr.None:fr.Size)),e.attributes.add(R.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4");const s=t.output===z.ObjectAndLayerIdColor;s&&e.varyings.add("vObjectAndLayerIdColor","vec4"),e.include(VAe),i.constants.add("elevationScale","float",2*Rte),i.constants.add("stride","float",he("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(x`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${Zd(t,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),i.code.add(x`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${Xl(t,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${Xl(t,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?x`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${Xl(t,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:x`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(x`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?x`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function Mbt(e){const{vertex:t,fragment:i}=e;t.uniforms.add(new c6("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new Ebt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(x`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(x`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var Hd;function Rbt(e,t){const i=e.vertex;switch(i.code.add(x`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case Hd.None:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Hd.Opaque:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Hd.Transparent:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Hd||(Hd={}));var bg;function K3t(e){return e&&Fg(e)?bg.Mars:e&&Ng(e)?bg.Moon:bg.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(bg||(bg={}));var Ah;(function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"})(Ah||(Ah={}));class Ci extends xl{constructor(){super(...arguments),this.output=z.Color,this.textureCoordinateType=En.None,this.componentData=vg.Uniform,this.cullFace=Br.Back,this.vertexDiscardMode=Hd.None,this.doubleSidedMode=Ds.WindingOrder,this.alphaDiscardMode=Er.Opaque,this.integratedMeshMode=Ah.None,this.transparencyPassType=Ct.NONE,this.ellipsoidMode=bg.Earth,this.pbrMode=gt.Disabled,this.normalType=yr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}}u([j({count:z.COUNT})],Ci.prototype,"output",void 0),u([j({count:En.COUNT})],Ci.prototype,"textureCoordinateType",void 0),u([j({count:vg.COUNT})],Ci.prototype,"componentData",void 0),u([j({count:Br.COUNT})],Ci.prototype,"cullFace",void 0),u([j({count:Hd.COUNT})],Ci.prototype,"vertexDiscardMode",void 0),u([j({count:Ds.COUNT})],Ci.prototype,"doubleSidedMode",void 0),u([j({count:Er.COUNT})],Ci.prototype,"alphaDiscardMode",void 0),u([j({count:Ah.COUNT})],Ci.prototype,"integratedMeshMode",void 0),u([j({count:Ct.COUNT})],Ci.prototype,"transparencyPassType",void 0),u([j({count:bg.COUNT})],Ci.prototype,"ellipsoidMode",void 0),u([j({count:gt.COUNT})],Ci.prototype,"pbrMode",void 0),u([j({count:yr.COUNT})],Ci.prototype,"normalType",void 0),u([j()],Ci.prototype,"spherical",void 0),u([j()],Ci.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Ci.prototype,"hasVertexColors",void 0),u([j()],Ci.prototype,"hasNormals",void 0),u([j()],Ci.prototype,"hasSlicePlane",void 0),u([j()],Ci.prototype,"hasBaseColorTexture",void 0),u([j()],Ci.prototype,"receiveAmbientOcclusion",void 0),u([j()],Ci.prototype,"receiveShadows",void 0),u([j()],Ci.prototype,"blendingEnabled",void 0),u([j()],Ci.prototype,"hasScreenSpaceReflections",void 0),u([j()],Ci.prototype,"hasPolygonOffset",void 0),u([j()],Ci.prototype,"hasMetallicRoughnessTexture",void 0),u([j()],Ci.prototype,"hasEmissionTexture",void 0),u([j()],Ci.prototype,"hasOcclusionTexture",void 0),u([j()],Ci.prototype,"hasNormalTexture",void 0),u([j()],Ci.prototype,"hasOccludees",void 0),u([j()],Ci.prototype,"hasMultipassTerrain",void 0),u([j()],Ci.prototype,"cullAboveGround",void 0),u([j()],Ci.prototype,"useLegacyTerrainShading",void 0),u([j()],Ci.prototype,"hasCloudsReflections",void 0),u([j()],Ci.prototype,"snowCover",void 0),u([j()],Ci.prototype,"objectAndLayerIdColor",void 0),u([j()],Ci.prototype,"hasWebGL2Context",void 0),u([j({constValue:Ar.Draw})],Ci.prototype,"pbrTextureBindType",void 0),u([j({constValue:!0})],Ci.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],Ci.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Ci.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Ci.prototype,"hasVertexTangents",void 0),u([j({constValue:!0})],Ci.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!1})],Ci.prototype,"highStepCount",void 0),u([j({constValue:!1})],Ci.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!0})],Ci.prototype,"useFillLights",void 0),u([j({constValue:!1})],Ci.prototype,"objectAndLayerIdColorInstanced",void 0);function Yde(e,t){e.include(hS,t),e.fragment.include(NP);const i=e.fragment;i.uniforms.add(new c6("baseColor",r=>r.baseColor)),i.uniforms.add(new eT("objectOpacity",r=>r.objectOpacity)),t.hasVertexColors?i.code.add(x`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(x`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(x`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Zde(e,t){const i=e.fragment;switch(t.doubleSidedMode){case Ds.None:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Ds.View:e.include(vC,t),i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Ds.WindingOrder:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Ds.COUNT:}switch(t.normalType){case yr.Attribute:case yr.CompressedAttribute:e.include(j8,t),i.code.add(x`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case yr.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(vC,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case yr.Ground:t.spherical?(e.include(vC,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(x`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case yr.COUNT:}}function Obt(e,t){const i=e.fragment;if(t.hasBaseColorTexture&&(t.output===z.Color||t.alphaDiscardMode!==Er.Opaque)){e.include(TQ,t);const r=t.textureCoordinateType===En.Atlas;i.uniforms.add(L1("baseColorTexture",s=>s.texture,r?t.hasWebGL2Context?fr.None:fr.Size:fr.None)),r?(e.include(SSe),i.code.add(x`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${Zd(t,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):i.code.add(x`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(x`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Ibt(e){const t=new Yi;t.include(vC,e),t.include(j8,e),t.include(hS,e),t.include(yg,e),t.include(bM,e),t.include(Cbt,e),t.include(Bht,e),t.include(Dat,e),t.include(Obt,e),t.include(Rbt,e);const{vertex:i,fragment:r}=t;e.pbrMode!==gt.Normal&&e.pbrMode!==gt.Schematic||(t.include(EQ,e),e.hasNormalTexture&&t.include(jAe,e));const s=e.output===z.Shadow||e.output===z.ShadowHighlight||e.output===z.ShadowExcludeHighlight;s&&e.componentData===vg.Varying?i.code.add(x`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(x`#define discardShadows(castShadows) {}`);const n=e.integratedMeshMode===Ah.ColorOverlay||e.integratedMeshMode===Ah.ColorOverlayWithWater,o=n&&e.output===z.Color&&e.pbrMode===gt.WaterOnIntegratedMesh;return n&&(t.include(GT,e),t.include(lvt,e),e.spherical?i.code.add(x`
      const float invEllipsoidRadius = ${x.float(1/(e.ellipsoidMode===bg.Earth?Mi.radius:e.ellipsoidMode===bg.Mars?hg.radius:R0.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(x`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),i.code.add(x`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${e.output===z.ObjectAndLayerIdColor?x`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${x.float(qa)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${e.output===z.ObjectAndLayerIdColor?x`forwardObjectAndLayerIdColor();`:""}
      ${o?e.spherical?x`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:x`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?x`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===z.Alpha&&(r.include(Wh),t.include(Xh,e),t.include(Yde,e),n&&r.uniforms.add(new Lt("ovColorTex",(a,l)=>dY(a,l))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?x`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===z.Color&&(r.include(Wh),t.include(Xh,e),t.include(Yde,e),t.include(Zde,e),t.include(GT,e),e.receiveShadows?(t.include(H8,e),r.code.add(x`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(x`float evaluateShadow() { return 0.0; }`),n&&r.uniforms.add(new Lt("ovColorTex",(a,l)=>dY(a,l))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?x`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===gt.Normal||e.pbrMode===gt.Schematic?(Bg(r),r.code.add(x`
        ${e.pbrMode===gt.Normal?x`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),e.hasNormalTexture?r.code.add(x`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(x`vec3 shadingNormal = normalVertex;`),r.code.add(x`${e.spherical?x`vec3 normalGround = normalize(positionWorld());`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(x`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?x`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?r.code.add(x`float shadow = evaluateShadow();`):e.spherical?(RM(r),r.code.add(x`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(x`float shadow = 0.0;`),o&&r.uniforms.add(new Lt("ovNormalTex",(a,l)=>Ote(l))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(x`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(x`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?x`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(x`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(e.output===z.Depth||s)&&(t.include(U0,e),r.code.add(x`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===z.Normal&&(t.include(Zde,e),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===yr.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===z.ObjectAndLayerIdColor&&t.fragment.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?x`gl_FragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),e.output===z.Highlight&&(t.include(i_,e),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?x`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function Ote(e){return e.overlays.length===0?null:e.overlays[xs.INNER].getValidTexture(zs.Water)}const Pbt=Object.freeze(Object.defineProperty({__proto__:null,build:Ibt,getOverlayNormalTexture:Ote},Symbol.toStringTag,{value:"Module"}));class SV extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2,i.spherical=t.viewingMode===je.Global,i.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new Ji(t.rctx,SV.shader.get().build(this.configuration),kRe)}_setPipelineState(t){const i=this.configuration,r=i.integratedMeshMode!==Ah.None,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:i.output!==z.Color&&i.output!==z.Alpha||!i.blendingEnabled?null:s?Vh:r_(t),culling:n8(i.cullFace),depthTest:{func:vb(t)},depthWrite:s||n?zc:null,colorWrite:si,stencilWrite:r||i.hasOccludees?Lg:null,stencilTest:r?Eut(Nc.IntegratedMeshMaskExcluded):i.hasOccludees?bb:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:L8})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}SV.shader=new Zi(Pbt,()=>Q(()=>import("./ComponentShader.glsl.7765cb9c.js"),[]));const kRe=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.COLOR,2],[R.UV0,3],[R.UVREGION,4],[R.COMPONENTINDEX,5]]);class $bt extends Rr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class Ite{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Vs(e={}){return(t,i)=>{var s;const r=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=r+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[r]},set(o){const a=this[r];if(a==null)this[r]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[r]},set(n){this[r]!==n&&(e.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function Jde(){return(e,t)=>{var r;const i=(r=e._parameterCount)!=null?r:0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(s){this[i]!==s&&(this[i]=s,this._setDirty())}})}}class EV{constructor(t){this._low=as(),this._high=as(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const i=this._low,r=this._high;le(i,t),Wo(r,t,i)}setElements(t,i,r){ue(Kde,t,i,r),this.set(Kde)}get(t){return fe(t,this._low,this._high)}getLowScaled(t){return ae(t,this._low,1)}}const Kde=O();class ko extends $bt{constructor(t,i){super(),this.toMapSpace=i,this.baseColor=Gf(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=ur(1,1,.5),this.emissiveFactor=ur(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new G4,this.componentParameters=new fI,this.textureAlphaCutoff=Gk,this.alphaDiscardMode=Er.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=bg.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Ci;const r=new EV(t.position),s=HAe(t.rotationScale);lS(s,s),this.transformNormalGlobalFromModel=up(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=ls(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return v(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return v(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return v(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return v(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=v(this.metallicRoughnessTexture),n.hasEmissionTexture=v(this.emissionTexture),n.hasOcclusionTexture=v(this.occlusionTexture),n.hasNormalTexture=v(this.normalTexture),n.transparencyPassType=i.identifier===Su.Material&&r.transparencyPassType!=null?r.transparencyPassType:Ct.NONE,n.hasMultipassTerrain=i.identifier===Su.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===Su.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Ds.View:Ds.None,n.hasBaseColorTexture=v(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Vl.Transparent||o===Vl.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?Dbt(r)?Ote(r)?Ah.ColorOverlayWithWater:Ah.ColorOverlay:Ah.NoOverlay:Ah.None,n.useLegacyTerrainShading=this.isIntegratedMesh&&cr.TERRAIN_USE_LEGACY_SHADING,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&C(this.baseColorTexture);if(n.pbrMode=n.integratedMeshMode===Ah.ColorOverlayWithWater?gt.WaterOnIntegratedMesh:this.usePBR?a?gt.Schematic:gt.Normal:gt.Disabled,n.normalType=n.integratedMeshMode===Ah.None?n.hasNormals?yr.CompressedAttribute:yr.ScreenDerivative:yr.Ground,n.hasSlicePlane=v(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Su.ShadowMap)n.output=z.Shadow,n.vertexDiscardMode=Hd.None;else if(i.identifier===Su.Highlight)n.output=z.Highlight,n.vertexDiscardMode=Hd.None;else{switch(this._computeWhichMaterialPass()===Vl.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?Hd.Opaque:Hd.Transparent:n.vertexDiscardMode=Hd.None,n.output=i.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,i.output){case z.Color:n.receiveAmbientOcclusion=r.ssaoHelper.active,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=v(r.cloudsFade.data);break;case z.Alpha:n.hasOccludees=r.hasOccludees;break;case z.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=t.releaseAndAcquire(SV,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return v(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Vl.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case Vl.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case Vl.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case Vl.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),Lbt(i)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==To.None;h&&t.shadowMap.submitDraw(this,s,a,o),v(l)&&(t.highlight.submitDraw(this,s,l,o),h&&t.highlightShadowMap.submitDraw(this,s,l,o)),h&&v(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Vl.IntegratedMesh:this.objectOpacity<1?Vl.Transparent:this.componentParameters.opaqueOverride===To.All?Vl.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Er.Blend||this.alphaDiscardMode===Er.MaskBlend?Vl.Transparent:this.componentParameters.transparent===To.None?Vl.Opaque:this.componentParameters.transparent===To.All?Vl.Transparent:Vl.OpaqueAndTransparent}}var Vl,To;u([Vs({vectorOps:lme})],ko.prototype,"baseColor",void 0),u([Vs()],ko.prototype,"usePBR",void 0),u([Vs()],ko.prototype,"hasParametersFromSource",void 0),u([Vs({vectorOps:Xte})],ko.prototype,"mrrFactors",void 0),u([Vs({vectorOps:Xte})],ko.prototype,"emissiveFactor",void 0),u([Vs({dispose:!0})],ko.prototype,"baseColorTexture",void 0),u([Vs({dispose:!0})],ko.prototype,"metallicRoughnessTexture",void 0),u([Vs({dispose:!0})],ko.prototype,"emissionTexture",void 0),u([Vs({dispose:!0})],ko.prototype,"occlusionTexture",void 0),u([Vs({dispose:!0})],ko.prototype,"normalTexture",void 0),u([Vs()],ko.prototype,"objectOpacity",void 0),u([Jde()],ko.prototype,"commonMaterialParameters",void 0),u([Jde()],ko.prototype,"componentParameters",void 0),u([Vs()],ko.prototype,"textureAlphaCutoff",void 0),u([Vs()],ko.prototype,"alphaDiscardMode",void 0),u([Vs()],ko.prototype,"isIntegratedMesh",void 0),u([Vs()],ko.prototype,"polygonOffsetEnabled",void 0),u([Vs()],ko.prototype,"ellipsoidMode",void 0),u([Vs()],ko.prototype,"hasOccludees",void 0),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(Vl||(Vl={}));class G4 extends Ite{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Br.Back,this.hasSlicePlane=!0}}u([Vs()],G4.prototype,"doubleSided",void 0),u([Vs()],G4.prototype,"cullFace",void 0),u([Vs()],G4.prototype,"hasSlicePlane",void 0);class fI extends Ite{constructor(){super(...arguments),this.externalColor=Yt(1,1,1,1),this.externalColorMixMode=ro.Multiply,this.castShadows=To.All}get transparent(){return this.externalColor[3]<1?To.All:To.None}get opaqueOverride(){return this.externalColorMixMode===ro.Replace&&this.externalColor[3]===1?To.All:To.None}get visible(){return this.externalColor[3]>0?To.All:To.None}get type(){return vg.Uniform}}u([Vs({vectorOps:lme})],fI.prototype,"externalColor",void 0),u([Vs()],fI.prototype,"externalColorMixMode",void 0),u([Vs()],fI.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(To||(To={}));class u3 extends Ite{constructor(){super(...arguments),this.texture=null,this.transparent=To.None,this.opaqueOverride=To.None,this.castShadows=To.None}get type(){return vg.Varying}}function Lbt(e){return e.overlays.length!==0&&v(e.overlays[xs.INNER].getValidTexture(zs.Highlight))}function Dbt(e){return e.overlays.length!==0&&v(e.overlays[xs.INNER].getColorTextureNoRasterImage())}u([Vs()],u3.prototype,"texture",void 0),u([Vs()],u3.prototype,"transparent",void 0),u([Vs()],u3.prototype,"opaqueOverride",void 0),u([Vs()],u3.prototype,"castShadows",void 0);const d6=As().vec3f(R.POSITION).u16(R.COMPONENTINDEX).u16(R.U16PADDING),URe=As().vec2u8(R.SIDENESS),Fbt=Uu(URe),VRe=As().vec3f(R.POSITION0).vec3f(R.POSITION1).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}).u8(R.U8PADDING,{glPadding:!0}).u16(R.U16PADDING,{glPadding:!0}),_Y=VRe.clone().vec3f(R.NORMAL),vY=VRe.clone().vec3f(R.NORMALA).vec3f(R.NORMALB),BRe=new Map([[R.POSITION0,0],[R.POSITION1,1],[R.COMPONENTINDEX,2],[R.VARIANTOFFSET,3],[R.VARIANTSTROKE,4],[R.VARIANTEXTENSION,5],[R.NORMAL,6],[R.NORMALA,6],[R.NORMALB,7],[R.SIDENESS,8]]);function Qde(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(w,T)=>{w<T?s[w+1]++:n[T+1]++};for(let w=0;w<r;w++){const T=e[3*w],S=e[3*w+1],E=e[3*w+2];o(T,S),o(S,E),o(E,T)}let a=0,l=0;for(let w=0;w<i;w++){const T=s[w+1],S=n[w+1];s[w+1]=a,n[w+1]=l,a+=T,l+=S}const c=new Uint32Array(6*r),h=s[i],p=(w,T,S)=>{if(w<T){const E=s[w+1]++;c[2*E]=T,c[2*E+1]=S}else{const E=n[T+1]++;c[2*h+2*E]=w,c[2*h+2*E+1]=S}};for(let w=0;w<r;w++){const T=e[3*w],S=e[3*w+1],E=e[3*w+2];p(T,S,w),p(S,E,w),p(E,T,w)}const f=(w,T)=>{const S=2*w,E=T-w;for(let M=1;M<E;M++){const A=c[S+2*M],$=c[S+2*M+1];let I=M-1;for(;I>=0&&c[S+2*I]>A;I--)c[S+2*I+2]=c[S+2*I],c[S+2*I+3]=c[S+2*I+1];c[S+2*I+2]=A,c[S+2*I+3]=$}};for(let w=0;w<i;w++)f(s[w],s[w+1]),f(h+n[w],h+n[w+1]);const m=new Int32Array(3*r),y=(w,T)=>w===e[3*T]?0:w===e[3*T+1]?1:w===e[3*T+2]?2:-1,_=(w,T)=>{const S=y(w,T);m[3*T+S]=-1},b=(w,T,S,E)=>{const M=y(w,T);m[3*T+M]=E;const A=y(S,E);m[3*E+A]=T};for(let w=0;w<i;w++){let T=s[w];const S=s[w+1];let E=n[w];const M=n[w+1];for(;T<S&&E<M;){const A=c[2*T],$=c[2*h+2*E];A===$?(b(w,c[2*T+1],$,c[2*h+2*E+1]),T++,E++):A<$?(_(w,c[2*T+1]),T++):(_($,c[2*h+2*E+1]),E++)}for(;T<S;)_(w,c[2*T+1]),T++;for(;E<M;)_(c[2*h+2*E],c[2*h+2*E+1]),E++}return m}class zRe{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?kbt:Nbt}write(t,i,r){const s=this._edgeHashFunction(r);jF.seed=s;const n=jF.getIntRange(0,255),o=jF.getIntRange(0,this.settings.variants-1),a=.7,l=jF.getFloat(),c=255*(.5*Ubt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex),t.variantOffset.set(i,n),t.variantStroke.set(i,o),t.variantExtension.set(i,c)}trim(t,i){return t.slice(0,i)}}const Pte=new Float32Array(6),p6=new Uint32Array(Pte.buffer),T1=new Uint32Array(1);function Nbt(e){const t=Pte;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],T1[0]=5381;for(let i=0;i<p6.length;i++)T1[0]=31*T1[0]+p6[i];return T1[0]}function kbt(e){const t=Pte;t[0]=_2(e.position0[0]),t[1]=_2(e.position0[1]),t[2]=_2(e.position0[2]),t[3]=_2(e.position1[0]),t[4]=_2(e.position1[1]),t[5]=_2(e.position1[2]),T1[0]=5381;for(let i=0;i<p6.length;i++)T1[0]=31*T1[0]+p6[i];return T1[0]}const epe=1e4;function _2(e){return Math.round(e*epe)/epe}function Ubt(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class f6{constructor(){this._commonWriter=new zRe}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return _Y.createBuffer(t)}write(t,i,r){this._commonWriter.write(t,i,r),fe(GF,r.faceNormal0,r.faceNormal1),be(GF,GF),t.normal.setVec(i,GF)}trim(t,i){return this._commonWriter.trim(t,i)}}f6.Layout=_Y,f6.glLayout=Uu(_Y,1);class m6{constructor(){this._commonWriter=new zRe}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return vY.createBuffer(t)}write(t,i,r){this._commonWriter.write(t,i,r),t.normalA.setVec(i,r.faceNormal0),t.normalB.setVec(i,r.faceNormal1)}trim(t,i){return this._commonWriter.trim(t,i)}}m6.Layout=vY,m6.glLayout=Uu(vY,1);const GF=O(),jF=new Dd,ox=-1;var g6;function Vbt(e,t,i,r=qbt){const s=e.vertices.position,n=e.vertices.componentIndex,o=Wt(r.anglePlanar),a=Wt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=bY.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,_=Hbt(e),b=jbt(e),w=b.length/4,T=t.allocate(w);let S=0;const E=w,M=i.allocate(E);let A=0,$=0,I=0;const k=pIe(0,w),V=new Float32Array(w);V.forEach((re,q,L)=>{s.getVec(b[4*q+0],p),s.getVec(b[4*q+1],f),L[q]=Vr(p,f)}),k.sort((re,q)=>V[q]-V[re]);const B=new Array,G=new Array;for(let re=0;re<w;re++){const q=k[re],L=V[q],N=b[4*q+0],U=b[4*q+1],W=b[4*q+2],Z=b[4*q+3],ie=Z===ox;if(s.getVec(N,p),s.getVec(U,f),ie)ue(m,_[3*W+0],_[3*W+1],_[3*W+2]),le(y,m),h.componentIndex=n.get(N),h.cosAngle=_e(m,y);else{if(ue(m,_[3*W+0],_[3*W+1],_[3*W+2]),ue(y,_[3*Z+0],_[3*Z+1],_[3*Z+2]),h.componentIndex=n.get(N),h.cosAngle=_e(m,y),zbt(h,c))continue;h.cosAngle<-.9999&&le(y,m)}$+=L,I++,ie||Bbt(h,l)?(t.write(T,S++,h),B.push(L)):Gbt(h,o)&&(i.write(M,A++,h),G.push(L))}const X=new Float32Array(B.reverse()),K=new Float32Array(G.reverse());return{regular:{instancesData:t.trim(T,S),lodInfo:{lengths:X}},silhouette:{instancesData:i.trim(M,A),lodInfo:{lengths:K}},averageEdgeLength:$/I}}function Bbt(e,t){return e.cosAngle<t}function zbt(e,t){return e.cosAngle>t}function Gbt(e,t){const i=uo(e.cosAngle),r=bY.fwd,s=bY.ortho;return z0(r,e.position1,e.position0),i*(_e(_t(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function jbt(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];s+=l===ox||p<f?1:0,s+=c===ox||f<m?1:0,s+=h===ox||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];(l===ox||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===ox||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===ox||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function Hbt(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=k7.v0,n=k7.v1,o=k7.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(p,o),me(n,n,s),me(o,o,s),_t(s,n,o),be(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(g6||(g6={}));const bY={edge:{position0:O(),position1:O(),faceNormal0:O(),faceNormal1:O(),componentIndex:0,cosAngle:0},ortho:O(),fwd:O()},k7={v0:O(),v1:O(),v2:O()},qbt={anglePlanar:4,angleSignificantEdge:35};function Wbt(e){const t=Xbt(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return tpe.updateSettings(e.writerSettings),ipe.updateSettings(e.writerSettings),Vbt(t,tpe,ipe)}function Xbt(e,t,i,r){if(t){const o=Qde(i,r,e.count);return new Ybt(i,r,o,e)}const s=zX(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:r}),n=Qde(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:d6.createView(s.buffer)}}class Ybt{constructor(t,i,r,s){this.faces=t,this.facesLength=i,this.neighbors=r,this.vertices=s}}const tpe=new f6,ipe=new m6,Q3t=As().vec3f(R.POSITION0).vec3f(R.POSITION1),Zbt=As().vec3f(R.POSITION0).vec3f(R.POSITION1).u16(R.COMPONENTINDEX).u16(R.U16PADDING,{glPadding:!0});class Jbt{constructor(t){this._maxCount=t,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this._recycledIndices.push(t)}}class Kbt{constructor(t,i=1){this._rctx=t,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0,this._texture=new pt(this._rctx,{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,wrapMode:Pt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new ta(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(t,i,r,s,n,o){const a=t*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(t,i,r,s){const n=t*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}resizeToFit(t){const i=t*this._fieldCount;if(i>=this._data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new ta(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const t=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>t*i&&this._texture.resize(t,this._data.count/t),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}}const GRe=65536;class Qbt{constructor(t,i=1){this.textureBuffer=new Kbt(t,i),this._indexManager=new Jbt(GRe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const t=this._indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this._indexManager.release(t)}}class jRe{constructor(t,i=1){this._rctx=t,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this._buffers.forEach(t=>t.dispose()),this._buffers=[]}getBuffer(t){for(const r of this._buffers)if(r.availableCount>=t)return r;if(t>GRe)return null;const i=new Qbt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const t of this._buffers)t.textureBuffer.updateTexture()}}const rpe=se.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class ewt{constructor(t,i){this._renderManager=t,this._viewingMode=i,this._objects=[new ri,new ri],this._renderSubmit=new xbt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=he("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new jRe(t.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){vt(this._objects[DC.Hidden].length===0&&this._objects[DC.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const i=new c3;return i.toMapSpace=t.toMapSpace,i.transform=t.transform,i.obb=Gde(t.obb),i.components=new ibt(this._componentBufferManager,t.geometry.componentOffsets),i.renderable=this._createRenderable(t,i.components),i.intersectionGeometry=new cbt(t.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(t){const i=t;this._objects[i.visible].removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(t,i){const r=t;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(t){const i=t.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Ta(i,r.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,i){const r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){const r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){const i=t,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){const r=t,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new Sbt,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,_=n.verticalOffsets,b=1/0,w=-1/0,T=!1,S=!1,E=0;for(let M=0;M<n.count;M++){i(M,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===ro.Replace&&l.externalColor[3]===1),y+=+l.castShadows,UAe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[M],0,h[0],h[1],h[2],h[3]),T||(T=M>0&&E!==p[0]),E=p[0],S||(S=l.elevationOffset!==0),S&&C(_)&&(_=new Array(M).fill(0)),v(_)&&(_[M]=l.elevationOffset),b=Math.min(b,l.elevationOffset),w=Math.max(w,l.elevationOffset),NRe(l.elevationOffset,h),c.setData(a[M],1,h[0],h[1],h[2],h[3]);const A=l.objectAndLayerIdColor;v(A)&&c.setData(a[M],2,A[0],A[1],A[2],A[3]),l.pickable!==LRe(n.pickability,M)&&(n.pickability=sbt(n.pickability,n.count,M,l.pickable))}n.verticalOffsets=S?_:null,r.offsetObb=S?Q1t(r.obb,b,w,this._viewingMode,v(r.offsetObb)?r.offsetObb:Gde(r.obb)):null,T||S||this._hasObjectAndLayerId?(s.componentParameters=new u3,s.componentParameters.castShadows=U7(y,n.count),s.componentParameters.transparent=U7(f,n.count),s.componentParameters.opaqueOverride=U7(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new fI,s.componentParameters.castShadows=l.castShadows?To.All:To.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,i,r,s=!1){t.intersectionGeometry.getComponentAabb(i,r);const n=t,o=n.components.verticalOffsets;if(s||C(o))return r;const a=o[i];if(this._viewingMode===je.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=art(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}intersect(t,i,r,s,n,o){const a=t;v(n)&&(n.localOrigin=a.transform.position);const l=lS(spe,a.transform.rotationScale);Wo(HF,i,a.transform.position),Wo(qF,r,a.transform.position),Eu(HF,HF,l),Eu(qF,qF,l);const c=up(spe,l);return a.intersectionGeometry.intersect(HF,qF,s,c,n,a.components.verticalOffsets,o)}addEdges(t,i,r,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(t,n.transform,{center:n.obb.center,radius:K1t(n.obb)},a,o,l,r,s)}async extractEdgeInformation(t,i,r){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:Zbt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=d6.createBuffer(a.count);nV(c.position,a),lb(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:js(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(t,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,i,r,s){if(t&&i.allVisible())return t;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=Array.isArray(t)?new Array(n):(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let f=h;f<p;f++)o[a++]=t?t[f]:f;return!0}),o}addComponentHighlight(t,i){const r=t.components;C(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(t,i){const r=t.components;if(C(r.highlightCounts))return void rpe.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else rpe.warn("Removing non-existing highlight.")}clearHighlights(t){const i=t.components;v(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[DC.Visible]}_createRenderable(t,i){const r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=Oi.createVertex(r,Xi.STATIC_DRAW,s.vertices.data),a=Mn(s.indices,_=>Oi.createIndex(r,Xi.STATIC_DRAW,_)),l=Uu(Tbt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<i.count;_++){const b=i.offsets[_],w=i.offsets[_+1],T=i.materialDataIndices[_];if(v(s.indices))for(let S=b;S<w;S++)c[s.indices[S]]=T;else for(let S=b;S<w;S++)c[S]=T}const h=Oi.createVertex(r,Xi.STATIC_DRAW,c.buffer),p=new ko(t.transform,t.toMapSpace),f=new lp(r,kRe,{data:l,componentIndices:twt},{data:o,componentIndices:h},a),m=new pbt(f,Nt.TRIANGLES,n,v(a)),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(v(a)?a.byteSize:0)};return new dbt(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const twt=Uu(As().u16(R.COMPONENTINDEX));function U7(e,t){return e===t?To.All:e===0?To.None:To.Some}const spe=kc(),HF=O(),qF=O();class HRe extends Rr{constructor(){super(...arguments),this.opacity=1}}function iwt(e){const t=new Yi;return t.include(mp),t.fragment.uniforms.add(new Lt("tex",i=>i.texture)),e.hasOpacityFactor&&t.fragment.uniforms.add(new Ie("opacity",i=>i.opacity)),t.fragment.code.add(x`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${e.hasOpacityFactor?"* opacity":""};
    }`),t}const rwt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:HRe,build:iwt},Symbol.toStringTag,{value:"Module"}));var ul;(function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"})(ul||(ul={}));class wY extends xl{constructor(){super(...arguments),this.alphaMode=ul.None,this.hasOpacityFactor=!1}}u([j({count:ul.COUNT})],wY.prototype,"alphaMode",void 0),u([j()],wY.prototype,"hasOpacityFactor",void 0);class CV extends ir{initializeProgram(t){return new Ji(t.rctx,CV.shader.get().build(this.configuration),ji)}initializePipeline(){switch(this.configuration.alphaMode){case ul.None:return Ht({colorWrite:si});case ul.Alpha:return Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si});case ul.PremultipliedAlpha:case ul.COUNT:return Ht({blending:qf(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}}}CV.shader=new Zi(rwt,()=>Q(()=>import("./Compositing.glsl.4ea04aa3.js"),[]));class qRe extends Rr{}function swt(){const e=new Yi;return e.include(mp),e.fragment.uniforms.add(new Lt("tex",t=>t.texture)),e.fragment.code.add(x`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),e}const nwt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:qRe,build:swt},Symbol.toStringTag,{value:"Module"}));class AV extends ir{initializeProgram(t){return new Ji(t.rctx,AV.shader.get().build(),ji)}initializePipeline(){return Ht({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}AV.shader=new Zi(nwt,()=>Q(()=>import("./HUDCompositing.glsl.27627527.js"),[]));class WRe extends Rr{}function owt(){const e=new Yi;return e.include(mp),e.fragment.uniforms.add([new Lt("colorTexture",t=>t.colorTexture),new Lt("alphaTexture",t=>t.alphaTexture),new Lt("frontFaceTexture",t=>t.frontFaceTexture)]),e.fragment.code.add(x`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),e}const awt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:WRe,build:owt},Symbol.toStringTag,{value:"Module"}));class MV extends ir{initializeProgram(t){return new Ji(t.rctx,MV.shader.get().build(),ji)}initializePipeline(){return Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}}MV.shader=new Zi(awt,()=>Q(()=>import("./OITCompositing.glsl.b11483bc.js"),[]));class XRe extends Rr{constructor(){super(...arguments),this.overlayIndex=xs.INNER,this.opacity=1}}function lwt(){const e=new Yi;return e.include(mp),e.fragment.uniforms.add(new Lt("tex",t=>t.texture)),e.fragment.uniforms.add(new Y$("overlayIdx",t=>t.overlayIndex)),e.fragment.uniforms.add(new Ie("opacity",t=>t.opacity)),e.fragment.code.add(x`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),e}const cwt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:XRe,build:lwt},Symbol.toStringTag,{value:"Module"}));class RV extends ir{initializeProgram(t){return new Ji(t.rctx,RV.shader.get().build(),ji)}initializePipeline(){return Ht({blending:qf(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}}RV.shader=new Zi(cwt,()=>Q(()=>import("./OverlayCompositing.glsl.ff435c89.js"),[]));class uwt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._configuration=new wY,this._passParameters=new HRe,this._oitParameters=new WRe,this._hudParameters=new qRe,this._overlayParameters=new XRe}destroy(){this._vao=rt(this._vao)}compositeOIT(t,i,r,s){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(MV);n.bindTechnique(o,this._oitParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Nt.TRIANGLE_STRIP,0,ja(a,"geometry")),o.release()}compositeHUD(t,i){this._hudParameters.texture=i;const r=this._rctx,s=this._techniqueRepository.acquire(AV);r.bindTechnique(s,this._hudParameters,t);const n=this._ensureVAO();r.bindVAO(n),r.drawArrays(Nt.TRIANGLE_STRIP,0,ja(n,"geometry")),s.release()}compositeOverlay(t,i,r,s){this._overlayParameters.texture=i,this._overlayParameters.opacity=r,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(RV);n.bindTechnique(o,this._overlayParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Nt.TRIANGLE_STRIP,0,ja(a,"geometry")),o.release()}composite(t,i,r=ul.None,s=1){const n=this._rctx;this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(CV,this._configuration);n.bindTechnique(o,this._passParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Nt.TRIANGLE_STRIP,0,ja(a,"geometry")),o.release()}_ensureVAO(){return C(this._vao)&&(this._vao=Tl(this._rctx)),this._vao}}const hwt=1e4,xY=100,dwt=500,pwt=500,fwt=.1;function mwt(e,t,i){return Cee(t,e)*(i[1]-i[0])+i[0]}function gwt(e,t,i){let r=0;if(!t.some(n=>(r+=n.numGeometries,r>=hwt)))return Swt.compute(e,t);const s=eL();return i.forAll(n=>{n.visible&&qA(s,ywt(e,n))}),s}function ywt(e,t){if(!t.visible)return;const i=eL(),r=t.getSpatialQueryAccelerator();return v(r)?_wt(i,e,r):vwt(i,e,t.objects),i}function _wt(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.visible,a=i.objectCount;if(a<dwt)WP(Pd,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,Tf.DepthOrder.FRONT_TO_BACK,Pd,(l,c)=>{TY(e,t,l),Pd.far=e.near,c.setRange(Pd)},n,o),WP(Pd,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,Tf.DepthOrder.BACK_TO_FRONT,Pd,(l,c)=>{TY(e,t,l),Pd.near=e.far,c.setRange(Pd)},n,o);else{const l=Math.max(Math.min(a,pwt),Math.ceil(a*fwt)),c=i.findClosest(s,Tf.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,Tf.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(npe(e,t,c.boundingVolumeWorldSpace.bounds),npe(e,t,h.boundingVolumeWorldSpace.bounds))}}function vwt(e,t,i){v2.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&v2.add(r)}),v2.empty||(v2.sort(t),WP(Pd,t.near,Math.min(e.near,t.far)),v2.forEachInDepthRange(Pd,Tf.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<e.near&&TY(e,t,r)}),WP(Pd,Math.max(e.far,t.near),t.far),v2.forEachInDepthRange(Pd,Tf.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function TY(e,t,i){if(!i.visible||!v1(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=Twt;i.geometries.forEach(n=>{Hs(s,r,n.shaderTransformation);const o=bT(s);YRe(e,t,n.boundingInfo,s,o)})}function YRe(e,t,i,r,s){if(C(i))return;Ze(Ua,i.center,r);const{eye:n,viewForward:o}=t,a=o[0]*(Ua[0]-n[0])+o[1]*(Ua[1]-n[1])+o[2]*(Ua[2]-n[2]);if(Ua[3]=i.radius*s,!(a-Ua[3]>e.near&&a+Ua[3]<e.far)&&v1(t.frustum,Ua))if(i.radius>xY&&i.getChildren())for(const l of i.getChildren())YRe(e,t,l,r,s);else SY.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function npe(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}class bwt{constructor(){this._items=new ri({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const i=t.eye,r=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===Tf.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}}}class wwt{constructor(){this._view=Pe(),this._viewProj=Pe(),this._frustum=cP(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(t,i){this._reset(),Ao(this._view,t.viewMatrix),Hs(this._viewProj,t.projectionMatrix,this._view),vk(this._frustum,t.frustum);const r=this._view,s=r[2],n=r[6],o=r[10],a=r[14];i.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;let y;m.hasShaderTransformation?(m.computeBoundingSphere(m.shaderTransformation,Ua,1),y=Ua):y=m.boundingSphere;const _=s*y[0]+n*y[1]+o*y[2]+a,b=_-y[3],w=_+y[3];this._geometries.push(m),this._near.push(-w),this._far.push(-b)}));const l=new fbt;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[p++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(t,i,r){if(C(t))return;const s=t.center;Ze(Ua,s,i);const n=bT(i),o=Ua[0],a=Ua[1],l=Ua[2],c=t.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=p+c;if(!(-(p-c)<2||-f>=r.near))if(-f>this._looseRange.near)r.near=-f;else{if(c>xY){const m=t.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,i,r);return}}SY.unionDepthRangeWithAABB(r,this._viewProj,i,t.bbMin,t.bbMax)}}_includeFarBoundingInfoRec(t,i,r){if(C(t))return;let s=t.radius;const n=t.center;Ze(Ua,n,i);const o=bT(i),a=Ua[0],l=Ua[1],c=Ua[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-p<=r.far))if(-p<this._looseRange.far)r.far=-p;else{if(s>xY){const f=t.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,i,r);return}}SY.unionDepthRangeWithAABB(r,this._viewProj,i,t.bbMin,t.bbMax)}}}class xwt{constructor(){this._modelViewProj=Pe(),this._clipPosition=[ui(),ui(),ui(),ui(),ui(),ui(),ui(),ui()]}unionDepthRangeWithAABB(t,i,r,s,n){const o=this._modelViewProj;Hs(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[V7[l][0]],h=this._clipPosition[V7[l][1]],p=this._clipPosition[V7[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const _=f[y][3];Number.isFinite(_)&&(t.near=Math.min(_,t.near),t.far=Math.max(_,t.far))}}}return a}_inside(t,i){return i===0?t[0]>=-t[3]:i===1?t[1]>=-t[3]:i===2?t[0]<=t[3]:i===3?t[1]<=t[3]:void vt(!1)}_intersect(t,i,r){let s=0;return r===0?s=(-t[3]-t[0])/(i[0]-t[0]+i[3]-t[3]):r===1?s=(-t[3]-t[1])/(i[1]-t[1]+i[3]-t[3]):r===2?s=(t[3]-t[0])/(i[0]-t[0]-i[3]+t[3]):r===3&&(s=(t[3]-t[1])/(i[1]-t[1]-i[3]+t[3])),O6(ui(),t,i,s)}_clipTriangle(t,i,r){let s=[t,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const V7=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Ua=Gn(),Twt=Pe(),Pd=eL(),v2=new bwt,Swt=new wwt,SY=new xwt;class Ewt{}class Cwt extends Rr{constructor(){super(...arguments),this.textures=new Ewt}}function Awt(){const e=new Yi;return e.attributes.add(R.POSITION,"vec2"),e.vertex.uniforms.add(new xi("drawPosition",(t,i)=>Mwt(t,i))),e.varyings.add("vUV","vec2"),e.vertex.code.add(x`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new Lt("textureInput",t=>t.textures.input)),e.fragment.uniforms.add(new Lt("textureMask",t=>t.textures.mask)),e.fragment.uniforms.add(new Lt("textureOverlay",t=>t.textures.overlay)),e.fragment.uniforms.add(new v0("maskEnabled",t=>t.magnifier.maskEnabled)),e.fragment.uniforms.add(new v0("overlayEnabled",t=>t.magnifier.overlayEnabled)),e.fragment.code.add(x`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}function Mwt(e,t){const i=t.camera.pixelRatio,r=e.magnifier.offset.x*i,s=e.magnifier.offset.y*i;Km(e.magnifier.position,ope);const n=t.camera.screenToRender(ope,Rwt),o=Math.ceil(i*e.magnifier.size),a=t.camera.fullWidth,l=t.camera.fullHeight;return mr(Owt,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const ope=$s(),Rwt=vye(),Owt=ui();async function Iwt(e){const t=Q(()=>import("./mask-svg.c5a192a7.js"),[]),i=Q(()=>import("./overlay-svg.ebd5d958.js"),[]),r=k0((await t).default,{signal:e}),s=k0((await i).default,{signal:e}),n={mask:await r,overlay:await s};return ii(e),n}let gE=class extends Te{constructor(){super(...arguments),this._handles=new Ii,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Cwt,this.events=new ps,this.attributeLocations=new Map([[R.POSITION,0]]),this._tmpScreenPoint=$s(),this._tmpRenderPoint=vye()}get updating(){return C(this._imageSources)&&v(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};v(this._magnifier)&&this._handles.add(te(()=>Mn(this._magnifier,i=>i.version),t)),t()}get enabled(){return v(this._validMagnifier)}get _validMagnifier(){return v(this._magnifier)&&this._magnifier.visible&&v(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return v(this._magnifier)&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),v(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if(C(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),C(this._resources))return;const n=this._passParameters.textures,o=Math.ceil(1/this._factor*s);n.input.resize(o,o),Km(i.position,this._tmpScreenPoint);const a=t.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),l=t.camera.fullWidth,c=t.camera.fullHeight,h=.5*o,p=.5*o;a[0]=ye(a[0],h,l-h-1),a[1]=ye(a[1],p,c-p-1);const f=Math.floor(a[0]-h),m=Math.floor(a[1]-p),y=this._resources.program;y.bindTexture("textureInput",n.input),e.gl.copyTexImage2D(n.input.descriptor.target,0,n.input.descriptor.pixelFormat,f,m,o,o,0),this._passParameters.magnifier=i,e.useProgram(y),y.bindPass(this._passParameters,t),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Nt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(C(e))return;const t=e.maskUrl,i=e.overlayUrl;!v(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),v(this._imageSources)||v(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:C$(async r=>{const s=C(t)||C(i)?Iwt(r):null,n=v(t)?k0(t,{signal:r}):s.then(a=>a.mask),o=v(i)?k0(i,{signal:r}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(v(this._resources)){if(this._passParameters.textures.size!==t){const r=this._createTextureResources(e,t);if(C(r))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=r}return}const i=this._createTextureResources(e,t);C(i)||(this._resources={program:this._createProgram(e),vao:Tl(e,vQ,this.attributeLocations,0,1),pipelineState:Ht({blending:qf(Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:si})},this._passParameters.textures=i)}_disposeResources(){C(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(C(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new pt(e,{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!0,preMultiplyAlpha:!Xye(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),r=new pt(e,{target:St.TEXTURE_2D,pixelFormat:ze.ALPHA,internalFormat:ze.ALPHA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new pt(e,{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){return new Ji(e,Awt(),this.attributeLocations)}};u([d()],gE.prototype,"_imageSources",void 0),u([d()],gE.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],gE.prototype,"updating",null),gE=u([P("esri/views/3d/webgl-engine/lib/MagnifierHelper")],gE);class Pwt{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new ta(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(t,i,r,s,n,o=null,a=null,l=null){if(!(t&&i&&r&&s)||(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(i,{objectId:t,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(t){const i=this.getObjectAndLayerIdColorArray(t);return Yt(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(t){if(!t.layerUid||!t.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(t.layerUid);if(i===void 0)return se.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+t.layerUid),this.colorZero;if(i===!1)return this.colorZero;let r=this._uidToRenderColor.get(t.layerUid);r||(r=new Map,this._uidToRenderColor.set(t.layerUid,r));let s=r.get(t.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");r.set(t.graphicUid,s),this._colorToUID.set(s,t)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new ta(n)}getColorToObjectAndLayerIdMapping(){const t=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let n=null;s?(n=s.get(r.graphicUid),n||se.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):se.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const o=this._layerUidToId.get(r.layerUid);o||se.getLogger(this.declaredClass).warn("no layerId found for uid "+r.layerUid),n&&o&&t.set(i,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return t}}var XP;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(XP||(XP={}));class X_{constructor(t,i,r=XP.FrontToBack){this._rctx=t,this._techniqueRepository=i,this._sorting=r,this._draws=new ri({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s){var o;const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=t,n.depthSquaredHint=s,n.indexType=(o=i.indexed?i.vao.indexBuffer.indexType:null)!=null?o:0}dispatch(t,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===Ct.NONE||(r.bindTechnique(l,t,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,t),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=j4.get(c.indexType);for(let y=0;y<f;y+=2){const _=p[y],b=p[y+1];r.drawElements(h.primitiveType,b,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const y=p[m],_=p[m+1];r.drawArrays(h.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===XP.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}}const j4=new Map;j4.set(dt.UNSIGNED_BYTE,1),j4.set(dt.UNSIGNED_SHORT,2),j4.set(dt.UNSIGNED_INT,4);class $wt{constructor(t,i){this.rctx=t,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new nvt,this._shadowPassParameters=new ovt,this._highlightPassParameters=new avt,this._systems=new Set,this._passes={materialOpaque:new X_(t,i),materialTransparent:new X_(t,i,XP.BackToFront),materialIntegratedMesh:new X_(t,i),shadowMap:new X_(t,i),highlight:new X_(t,i),highlightIntegratedMesh:new X_(t,i),highlightShadowMap:new X_(t,i),defaultShadowMap:new X_(t,i)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,t.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),this._materialPassParameters.output=t.output,t.bindParameters.slot){case Ee.OPAQUE_MATERIAL:switch(t.output){case z.Color:case z.Depth:case z.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case z.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case z.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case z.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case z.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case z.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters)}return;case Ee.TRANSPARENT_MATERIAL:switch(t.output){case z.Color:case z.Alpha:case z.Depth:case z.Normal:case z.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Ee.INTEGRATED_MESH:switch(t.output){case z.Color:case z.Depth:case z.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case z.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters);case z.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL,Ee.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(t);v(s)&&qA(i,s,i)}),i}_configure(t){const i=t.output===z.Shadow||t.output===z.ShadowHighlight||t.output===z.ShadowExcludeHighlight?this._shadowPassParameters:t.output===z.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,i)}_updateParameters(t,i){const r=t.bindParameters.camera,s=r.viewInverseTransposeMatrix;ue(B7,s[3],s[7],s[11]),z7.set(B7),le(i.transformWorldFromViewTH,z7.high),le(i.transformWorldFromViewTL,z7.low),le(i.slicePlaneLocalOrigin,B7),cp(i.transformViewFromCameraRelativeRS,r.viewMatrix),Ao(i.transformProjFromView,r.projectionMatrix),i.identifier===Su.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Ee.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Ee.INTEGRATED_MESH,up(ape,i.transformViewFromCameraRelativeRS),lS(i.transformNormalViewFromGlobal,ape))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const B7=O(),ape=Cs(),z7=new EV;class Lwt{constructor(){this._step=upe,this._dilation=1,this._firstIdleTime=0}frame(t,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,he("enable-feature:high-quality-idle")){const s=i?performance.now()-this._firstIdleTime:0;if(s>=lpe+Fwt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=lpe?Nwt:1}else this._dilation=1;const r=ye(t/Dwt,upe,Uwt);this._step===1/0?this._step=r:this._step=this._step*cpe+r*(1-cpe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}}const Dwt=.5,lpe=6e4,Fwt=5e3,Nwt=10,cpe=.9,kwt=30,upe=1e3/1,Uwt=1e3/kwt,Vwt=8.6,Bwt=.4;function zwt(){const e=new Yi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(R.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(R.UV0,"vec2"),t.uniforms.add(new Lt("coverageTex",n=>n.coverageTexture)),r.add(x`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new Lt("tex",n=>n.blurColorTexture)),i.uniforms.add(new Lt("origin",n=>n.highlightColorTexture)),i.uniforms.add(new xi("uColor",n=>n.color)),i.uniforms.add(new xi("haloColor",n=>n.haloColor)),i.uniforms.add(new xi("opacities",n=>mr(Gwt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",Vwt),i.constants.add("blurSize","float",Bwt),s.add(x`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const Gwt=ui(),jwt=Object.freeze(Object.defineProperty({__proto__:null,build:zwt},Symbol.toStringTag,{value:"Module"}));class OV extends ir{initializeProgram(t){return new Ji(t.rctx,OV.shader.get().build(),ji)}initializePipeline(){return Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si})}}OV.shader=new Zi(jwt,()=>Q(()=>import("./HighlightApply.glsl.923a7551.js"),[]));class ZRe extends Rr{constructor(){super(...arguments),this.blurSize=tt()}}function Hwt(){const e=new Yi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(R.POSITION,"vec2"),e.attributes.add(R.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new Lt("coverageTex",n=>n.coverageTexture)),i.uniforms.add(new oP("blurSize",n=>n.blurSize)),r.add(x`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new L$("tex",n=>n.blurInputTexture)),s.add(x`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const qwt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:ZRe,build:Hwt},Symbol.toStringTag,{value:"Module"}));class IV extends ir{initializeProgram(t){return new Ji(t.rctx,IV.shader.get().build(),ji)}initializePipeline(){return Ht({colorWrite:si})}}IV.shader=new Zi(qwt,()=>Q(()=>import("./HighlightBlur.glsl.efd3d990.js"),[]));class JRe extends Rr{constructor(){super(...arguments),this.invFramebufferDim=tt()}}function Wwt(){const e=new Yi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(R.POSITION,"vec2"),r.add(x`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new L$("tex",n=>n.inputTexture)),i.uniforms.add(new oP("invFramebufferDim",n=>n.invFramebufferDim)),s.add(x`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const Xwt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:JRe,build:Wwt},Symbol.toStringTag,{value:"Module"}));class PV extends ir{initializeProgram(t){return new Ji(t.rctx,PV.shader.get().build(),ji)}initializePipeline(){return Ht({colorWrite:si})}}PV.shader=new Zi(Xwt,()=>Q(()=>import("./HighlightDownsample.glsl.877e168b.js"),[]));class hpe extends Rr{constructor(){super(...arguments),this.color=Gf(1,0,1,1),this.haloColor=Gf(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Yt(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const Ywt=32;class Zwt{constructor(t,i){this._techniqueRep=t,this._rctx=i,this._viewportToRestore=ui(),this._passParameters=new hpe,this._downsampleDrawParameters=new JRe,this._blurDrawParameters=new ZRe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Tl(this._rctx);const t={colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE,width:0,height:0},i={target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:Pt.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new Yr(this._rctx,t,i),this._blur1Fbo=new Yr(this._rctx,t,i),this._blurTechnique=this._techniqueRep.acquire(IV),this._downsampleTechnique=this._techniqueRep.acquire(PV),this._applyTechnique=this._techniqueRep.acquire(OV)}dispose(){if(this._blurTechnique=ls(this._blurTechnique),this._downsampleTechnique=ls(this._downsampleTechnique),this._applyTechnique=ls(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=rt(this._blur0Fbo),this._blur1Fbo=rt(this._blur1Fbo)}setDefaultOptions(t){this._passParameters={...new hpe,...t}}render(t,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=t.camera;gf(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(i,Ywt),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(ts.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,di(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,ja(p,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(ts.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,di(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,ja(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,ja(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:St.TEXTURE_2D,pixelFormat:ze.RGB,dataType:kt.UNSIGNED_SHORT_5_6_5,samplingMode:nt.LINEAR,wrapMode:Pt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Yr(r,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let _=0;for(let b=0;b<l;b++)for(let w=0;w<c;w++)y[_+0]=(w-.5)*p*2-1,y[_+1]=(b-.5)*h*2-1,y[_+2]=w*p,y[_+3]=b*h,y[_+4]=(w+.5)*p*2-1,y[_+5]=(b-.5)*h*2-1,y[_+6]=w*p,y[_+7]=b*h,y[_+8]=(w-.5)*p*2-1,y[_+9]=(b+.5)*h*2-1,y[_+10]=w*p,y[_+11]=b*h,y[_+12]=(w-.5)*p*2-1,y[_+13]=(b+.5)*h*2-1,y[_+14]=w*p,y[_+15]=b*h,y[_+16]=(w+.5)*p*2-1,y[_+17]=(b-.5)*h*2-1,y[_+18]=w*p,y[_+19]=b*h,y[_+20]=(w+.5)*p*2-1,y[_+21]=(b+.5)*h*2-1,y[_+22]=w*p,y[_+23]=b*h,_+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new Wf(r,ji,{geometry:vM},{geometry:Oi.createVertex(r,Xi.STATIC_DRAW,y)})}}_gridComputeMipmap(t){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,t);i.bindVAO(this._quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,di(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t,this._passParameters),i.setViewport(0,0,o,a),i.drawArrays(Nt.TRIANGLE_STRIP,0,ja(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(v(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(v(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)t+=i.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}}const Jwt={dataType:kt.UNSIGNED_BYTE,internalFormat:ze.RGBA},Kwt={};class Qwt{constructor(t){this._rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const i=t.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(t,i){const r=t.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),t.delete(i))}getDepthTexture(t,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(t.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=sT()),r||(r=new pt(this._rctx,{target:St.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:kt.UNSIGNED_INT_24_8,samplingMode:nt.NEAREST,wrapMode:Pt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(t.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new cE(this._rctx,{internalFormat:zl.DEPTH_STENCIL,...i}),this._depthBuffers.set(t.id,r),this._activeTargets.add(t.id)),r}getColorTexture(t,i){let r=this._colorTextures.get(t.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=sT())),r||(r=new pt(this._rctx,{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:nt.LINEAR,wrapMode:Pt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return{id:Ru(),...Kwt,...t}}registerColorTarget(t={}){return{id:Ru(),...Jwt,...t}}getFramebuffer(t,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,t);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=v(r)?new Yr(this._rctx,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.DEPTH_STENCIL_TEXTURE},o,l):new Yr(this._rctx,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Yr(this._rctx,{colorTarget:Ls.TEXTURE,depthStencilTarget:r?Wi.DEPTH_STENCIL_RENDER_BUFFER:Wi.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,i){return`${t.id}_${i?i.id:"X"}_${t.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let t=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),t+=AT(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),t}}class ext{constructor(t,i){this._rctx=t,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const r=t.type===Tt.WEBGL2;this._renderTargetHelper=new Qwt(t);const s=this._renderTargetHelper;this._mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:kt.FLOAT,internalFormat:r?Mt.RGBA32F:ze.RGBA,samplingMode:nt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:nt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?Mt.RGBA4:ze.RGBA,dataType:kt.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?Mt.RGBA4:ze.RGBA,dataType:kt.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(t){t||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&t?1:0}initializeFrame(t){const i=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(ts.COLOR_BUFFER_BIT|ts.DEPTH_BUFFER_BIT|ts.STENCIL_BUFFER_BIT)}composite(t){v(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,ul.None)}renderTmpAndCompositeToMain(t,i,r,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,txt),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(t,i=!1){this.renderToTargets(t,this.hudVisibility,i?this.tmpDepth:this.mainDepth,ixt)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.compositeHUD(t,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(t,i,r){let s,n;switch(i){case Ct.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case Ct.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case Ct.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),ul.PremultipliedAlpha)}compositeOccludedOntoMain(t,i){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),ul.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(t,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(ts.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}renderToFBO(t,i,r=!1,s=!1){const n=this._rctx;let o=0;if(i){const l=Math.max(1e-13,i[3]);n.setClearColor(i[0],i[1],i[2],l),o|=ts.COLOR_BUFFER_BIT}r&&(o|=ts.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=ts.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),t(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(t,i,r,s,n=!1,o=!1){const a=this.bindTarget(i,r);return this.renderToFBO(t,s,n,o),a}bindTarget(t,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,t,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const txt=[0,0,0,0],ixt=[0,1,0,1];class rxt{constructor(t){this._context=t,this._renderPlugins=new ri,this._slots=[];for(let i=0;i<Ee.MAX_SLOTS;++i)this._slots[i]=[]}add(t,i,r){const s=()=>{if(r!=null&&r.aborted)throw i.uninitializeRenderContext(),lr();this._renderPlugins.push(i);for(const o of t)this._slots[o].push(i);this._context.requestRender()},n=i.initializeRenderContext(this._context,r);if(Yh(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==t);t.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this._context.renderContext)})}updateAnimation(t){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(t)||i)}),i}render(){const t=this._slots[this._context.renderContext.bindParameters.slot],i=new Array;t.filter(r=>{if(!r.canRender)return!1;if(sxt(r)){const s=r.prepareTechnique(this._context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this._context.renderContext,i[s]))}queryDepthRange(t){const i=nxt;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(t);s&&qA(i,s,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(t=>!!t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>!!t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>!!t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this._slots[Ee.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,i)=>t|i.renderOccludedFlags,0)}}function sxt(e){return"prepareTechnique"in e}const nxt={near:0,far:0};class KRe extends TAe{}const $V=255,oxt=1/$V;function axt(e){const t=new Yi,i=t.fragment;return i.include(ku),i.include(Wh),t.include(X8),t.include(mp),t.include(H8,e),i.uniforms.add([new Lt("depthMap",r=>r.linearDepthTexture),new ds("inverseViewMatrix",(r,s)=>Ea(dpe,Vc(dpe,s.camera.viewMatrix,s.camera.center))),new tr("nearFar",(r,s)=>s.camera.nearFar)]),i.constants.add("sampleValue","float",oxt),i.code.add(x`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),t}const dpe=Pe(),lxt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:KRe,ShadowCastMaxSamples:$V,build:axt},Symbol.toStringTag,{value:"Module"}));var WT;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(WT||(WT={}));class EY extends xl{constructor(){super(...arguments),this.visualization=WT.Gradient,this.bandsEnabled=!1}}u([j({count:WT.COUNT})],EY.prototype,"visualization",void 0),u([j()],EY.prototype,"bandsEnabled",void 0);class QRe extends Rr{constructor(t){super(),this.shadowCastMap=t,this.sampleScale=0,this.opacityFromElevation=1,this.color=y$(cxt),this.bandSize=.1,this.threshold=.5}}const cxt=Yt(.01,0,.25,1);function uxt(e){const t=new Yi,i=t.fragment;i.include(ku),i.include(Wh),t.include(X8),t.include(mp);const{visualization:r,bandsEnabled:s}=e;i.constants.add("inverseSampleValue","float",$V),i.uniforms.add([new Lt("shadowCastMap",a=>a.shadowCastMap),new Ie("sampleScale",a=>a.sampleScale),new Ie("opacityFromElevation",a=>a.opacityFromElevation),new xi("uColor",a=>a.color)]);const n=r===WT.Gradient,o=r===WT.Threshold;return n&&s?i.uniforms.add(new Ie("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new Ie("threshold",a=>a.threshold)),i.code.add(x`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?x`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?x`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?x`* strength`:""});
      }
    `),t}const hxt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:QRe,build:uxt},Symbol.toStringTag,{value:"Module"}));class LV extends ir{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){return new Ji(t.rctx,LV.shader.get().build(this.configuration),ji)}initializePipeline(){return Ht({blending:Vh,colorWrite:si,depthTest:null,depthWrite:null})}get primitiveType(){return Nt.TRIANGLE_STRIP}}LV.shader=new Zi(hxt,()=>Q(()=>import("./ShadowCastVisualize.glsl.dfee5ecf.js"),[]));const dxt=4e4,pxt=5e4,eOe=1/512;let H4=class extends Te{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._data=i,this._requestRender=r,this._passParameters=new QRe(this._data.shadowCastTexture),this._techniqueConfig=new EY,this._enabled=!1,this._vao=Tl(t),this._techniqueConfig.visualization=WT.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=rt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(LV,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const t=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,ja(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>eOe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;eC(e,t)||(gf(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],H4.prototype,"opacityFromElevation",null),H4=u([P("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],H4);class y6 extends xl{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}}u([j()],y6.prototype,"receiveShadows",void 0),u([j()],y6.prototype,"hasWebGL2Context",void 0);class DV extends ir{constructor(t){super(t,new y6,()=>this.destroy())}initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2}initializeProgram(t){return new Ji(t.rctx,DV.shader.get().build(this.configuration),ji)}initializePipeline(){return Ht({blending:Ro(Ce.ONE,Ce.ONE,Ce.ONE,Ce.ONE),colorWrite:si,depthTest:null,depthWrite:null})}get primitiveType(){return Nt.TRIANGLE_STRIP}}DV.shader=new Zi(lxt,()=>Q(()=>import("./ShadowCastAccumulate.glsl.615b4773.js"),[]));let wc=class extends Te{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new KRe,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=yY,this._previewing=!1,this._handles=new Ii,this._cameraForcedForScreenshot=!1,this._bindParameters=new c8(new Yee(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Tl(e);const o={colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE,width:0,height:0},a={target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:Pt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Yr(e,o,a),this._accumulationRenderer=new H4(t,e,this,n);const l=this._stage.view.resourceController.scheduler;this._handles.add([l.registerTask(xt.SHADOW_ACCUMULATOR,this),te(()=>i.renderView,c=>{this._handles.remove(ppe),v(c)&&this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),ppe)},Gs),te(()=>this._previewing,()=>this._requestRenderIfEnabled(),hr)])}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(C(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new DV(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==yY&&this._opacityFromElevation>eOe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){var r;const t=this._cachedLightDirections;if(xg(t,e,U1))return;const i=Math.min($V,e.length);t.length=i,this._sampleCount=i;for(let s=0;s<i;++s)t[s]=le((r=t[s])!=null?r:O(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(fxt,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=rt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=rt(this._fbo),this._vao=rt(this._vao),this._accumulationTechniqueCached=ls(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,t){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height?0:(this._fbo.readPixels(e,t,1,1,ze.RGBA,kt.UNSIGNED_BYTE,fpe),fpe[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ts.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,ja(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*mxt%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-UC(dxt,pxt,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([d()],wc.prototype,"_progress",void 0),u([d()],wc.prototype,"_sampleCount",void 0),u([d()],wc.prototype,"_enabledInternal",void 0),u([d()],wc.prototype,"_depthRange",void 0),u([d()],wc.prototype,"_previewing",void 0),u([d()],wc.prototype,"_accumulationRenderer",void 0),u([d()],wc.prototype,"_isRefining",null),u([d()],wc.prototype,"_isActive",null),u([d()],wc.prototype,"canAccumulate",null),u([d()],wc.prototype,"_isDoneAccumulating",null),u([d()],wc.prototype,"_opacityFromElevation",null),u([d()],wc.prototype,"running",null),wc=u([P("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],wc);const fxt=6,ppe="renderView",mxt=104729,fpe=new Uint8Array(4),mpe={highlightedThreshold:.99999,selfShadowThreshold:.025};function gxt(e){const t=new Yi;t.include(zT,e);const i=t.fragment;return i.include(ku),i.include(Wh),t.include(X8),t.include(mp),i.uniforms.add([new Lt("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(VA.Default)),new Lt("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(VA.Highlight)),new Lt("depthMap",(r,s)=>s.linearDepthTexture),new Lt("highlightMap",(r,s)=>s.highlightColorTexture),new xi("uColor",r=>r.shadowColor),new tr("nearFar",(r,s)=>s.camera.nearFar),new Ie("opacity",r=>r.shadowOpacity),new Ie("occludedOpacity",r=>r.occludedShadowOpacity),new Ie("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new Jt("lightingMainDirectionView",(r,s)=>be(ype,Ze(ype,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new tr("texelSize",(r,s)=>v(s.linearDepthTexture)?di(yxt,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):Bc),new ds("inverseViewMatrix",(r,s)=>Ea(gpe,Vc(gpe,s.camera.viewMatrix,s.camera.center)))]),i.constants.add("unoccludedHighlightFlag","vec4",sCe).add("highlightedThreshold","float",mpe.highlightedThreshold).add("selfShadowThreshold","float",mpe.selfShadowThreshold),i.code.add(x`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),i.code.add(x`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),t}const gpe=Pe(),ype=O(),yxt=tt(),_xt=Object.freeze(Object.defineProperty({__proto__:null,build:gxt},Symbol.toStringTag,{value:"Module"}));class vxt extends Rr{constructor(){super(...arguments),this.shadowColor=Yt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class FV extends ir{constructor(t){super(t,new y6,()=>this.destroy())}initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2}initializeProgram(t){return new Ji(t.rctx,FV.shader.get().build(this.configuration),ji)}initializePipeline(){return Ht({blending:Ro(Ce.SRC_ALPHA,Ce.ONE,Ce.ONE_MINUS_SRC_ALPHA,Ce.ONE_MINUS_SRC_ALPHA),colorWrite:si,depthTest:null,depthWrite:null})}get primitiveType(){return Nt.TRIANGLE_STRIP}}FV.shader=new Zi(_xt,()=>Q(()=>import("./ShadowHighlight.glsl.bf078705.js"),[]));const bxt=.001953125,wxt=4e4,xxt=5e4;class Txt{constructor(t,i){this._rctx=t,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new vxt,this._drawParameters=new TAe,this._vao=Tl(this._rctx)}get _technique(){return C(this._techniqueCached)&&(this._techniqueCached=new FV({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(t,i){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const r=this._technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,t).bindDraw(this._drawParameters,t,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,ja(this._vao,"geometry"))}get gpuMemoryUsage(){var t,i;return(i=(t=this._vao)==null?void 0:t.size)!=null?i:0}setDefaultOptions(t){this._passParameters={...this._passParameters,...t},this._updateMaxOpacity()}updateParameters(t,i){this._passParameters.opacityElevation=1-UC(wxt,xxt,t.relativeElevation);const r=this._viewingMode===je.Global?be(_pe,t.center):ue(_pe,0,0,1),s=_e(r,i);this._passParameters.dayNightTerminator=UC(0,1,ye(30*s,0,1))}dispose(){this._vao=rt(this._vao),this._techniqueCached=ls(this._techniqueCached)}get isVisible(){const{opacityElevation:t,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*t*i>=bxt}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const _pe=O(),vpe=X0();class Sxt{constructor(){this._plane=X0()}get isEnabled(){return!Nbe(this.plane,vpe)}get plane(){return this._plane}set plane(t){oS(t||vpe,this._plane)}}class Ext extends Rr{}function YP(e){e.uniforms.add(new xi("resolution",t=>{const{descriptor:i}=t.colorTexture,r=i.width,s=i.height;return mr(Cxt,1/r,1/s,r,s)}))}const Cxt=ui(),b2={maxSearchSteps:8,maxDistanceAreaTex:16};function Axt(){const e=new Yi,{attributes:t,varyings:i,vertex:r,fragment:s}=e;return t.add(R.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),i.add("maxOffset","vec4"),i.add("pixelCoord","vec2"),YP(r),r.code.add(x`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${x.int(b2.maxSearchSteps)} );
      }
    `),s.uniforms.add(new Lt("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new Lt("areaTexture",n=>n.areaTexture)),s.uniforms.add(new Lt("searchTexture",n=>n.searchTexture)),YP(s),s.code.add(x`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(b2.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(b2.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(b2.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(b2.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${x.int(b2.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `),e}const Mxt=Object.freeze(Object.defineProperty({__proto__:null,build:Axt},Symbol.toStringTag,{value:"Module"}));class NV extends ir{initializeProgram(t){return new Ji(t.rctx,NV.shader.get().build(),ji)}initializePipeline(){return Ht({colorWrite:si})}}NV.shader=new Zi(Mxt,()=>Q(()=>import("./BlendWeights.glsl.7a49a876.js"),[]));function Rxt(){const e=new Yi,{attributes:t,varyings:i,vertex:r,fragment:s}=e;return t.add(R.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),YP(r),r.code.add(x`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new Lt("blendWeightsTexture",n=>n.blend.colorTexture)),s.uniforms.add(new Lt("colorTexture",n=>n.colorTexture)),YP(s),s.code.add(x`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`),e}const Oxt=Object.freeze(Object.defineProperty({__proto__:null,build:Rxt},Symbol.toStringTag,{value:"Module"}));class kV extends ir{initializeProgram(t){return new Ji(t.rctx,kV.shader.get().build(),ji)}initializePipeline(){return Ht({colorWrite:si})}}kV.shader=new Zi(Oxt,()=>Q(()=>import("./Blur.glsl.d6e214c6.js"),[]));const bpe={threshold:.05,localConstrastAdaption:2};function Ixt(){const e=new Yi,{attributes:t,varyings:i,vertex:r,fragment:s}=e;return t.add(R.POSITION,"vec2"),YP(r),i.add("uv","vec2"),i.add("offsets[3]","vec4"),r.code.add(x`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new Lt("colorTexture",n=>n.colorTexture)),s.code.add(x`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${x.float(bpe.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${x.float(bpe.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `),e}const Pxt=Object.freeze(Object.defineProperty({__proto__:null,build:Ixt},Symbol.toStringTag,{value:"Module"}));class UV extends ir{initializeProgram(t){return new Ji(t.rctx,UV.shader.get().build(),ji)}initializePipeline(){return Ht({colorWrite:si})}}UV.shader=new Zi(Pxt,()=>Q(()=>import("./EdgeDetect.glsl.95833f83.js"),[]));let h3=class extends Te{constructor(e,t){super({}),this._rctx=e,this._techniqueRep=t,this._passParameters=new Ext,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=ep(this._abortController),this.disable()}_loadResources(e){if(v(this._abortController))return!1;if(v(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return Q(()=>import("./SmaaRenderPassData.dfb9dc82.js"),[]).then(i=>this._loadTextures(i,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return ii(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,nt.LINEAR,ze.RGB),this._loadTextureFromBase64(e.searchTexure,nt.NEAREST,ze.LUMINANCE)]).then(([i,r])=>{So(t)?(i.dispose(),r.dispose(),ii(t)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=r)})}get updating(){return v(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new xl;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(UV,t,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(NV,t,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(kV,t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=XKe(this._rctx),this._passParameters.edges=new Yr(this._rctx,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},{target:St.TEXTURE_2D,pixelFormat:ze.RGB,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:Pt.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new Yr(this._rctx,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},{target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.LINEAR,wrapMode:Pt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=rt(this._vao),this._passParameters.areaTexture=rt(this._passParameters.areaTexture),this._passParameters.searchTexture=rt(this._passParameters.searchTexture),this._passParameters.blend=rt(this._passParameters.blend),this._passParameters.edges=rt(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const t=this._validPassParameters;if(C(t))return;t.colorTexture=e;const i=this._rctx,r=i.getBoundFramebufferObject(),s=e.descriptor.width,n=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,s,n),t.edges.resize(s,n),i.bindFramebuffer(t.edges),i.setClearColor(0,0,0,1),i.clear(ts.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,t,null),i.drawArrays(Nt.TRIANGLES,0,3),t.blend.resize(s,n),i.bindFramebuffer(t.blend),i.setClearColor(0,0,1,1),i.clear(ts.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,t,null),i.drawArrays(Nt.TRIANGLES,0,3),i.bindFramebuffer(r),i.setClearColor(0,1,0,1),i.clear(ts.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,t,null),i.drawArrays(Nt.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){return k0(e).then(r=>new pt(this._rctx,{pixelFormat:i,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.CLAMP_TO_EDGE,width:r.width,height:r.height,samplingMode:t},r))}};u([d()],h3.prototype,"_abortController",void 0),u([d({readOnly:!0})],h3.prototype,"updating",null),h3=u([P("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],h3);function $xt(e,t){const i=-e[0],r=-e[1],s=-e[2],n=t[3],o=t[7],a=t[11],l=t[15];t[0]+=n*i,t[1]+=n*r,t[2]+=n*s,t[4]+=o*i,t[5]+=o*r,t[6]+=o*s,t[8]+=a*i,t[9]+=a*r,t[10]+=a*s,t[12]+=l*i,t[13]+=l*r,t[14]+=l*s}function Lxt(e,t){const i=e[0],r=e[1],s=e[2];t[12]+=i*t[0]+r*t[4]+s*t[8],t[13]+=i*t[1]+r*t[5]+s*t[9],t[14]+=i*t[2]+r*t[6]+s*t[10],t[14]+=i*t[3]+r*t[7]+s*t[11]}class Dxt{constructor(t){this._factory=t,this._originData=new Map}acquire(t){return this.register(this._factory.getOrigin(t))}register(t){const i=this._originData.get(t.id)||new Fxt(t);return i.refCount++,this._originData.has(i.origin.id)||this._originData.set(i.origin.id,i),i}release(t){t.refCount--,t.refCount===0&&this._originData.delete(t.origin.id)}updateViewMatrices(t){this._originData.forEach(i=>{Ao(i.viewMatrix,t),Lxt(i.origin.vec3,i.viewMatrix)})}}class Fxt{constructor(t){this.origin=t,this.refCount=0,this.viewMatrix=Pe()}}class Nxt extends qSe{constructor(t,i){super(),this.distanceFalloffFactor=t,this.transparency=i,this.transformNormalViewFromGlobal=Cs()}}class kxt extends WSe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Cs(),this.slicePlaneLocalOrigin=O(),this.transformNormalGlobalFromModel=Cs()}}function Uxt(e){const t=x`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const Vxt=er(.5,-4e-4);function Bxt(e,t){const i=e.vertex;i.include(Uxt),i.constants.add("depthBias","vec2",Vxt),i.uniforms.add(new tr("inverseViewport",(r,s)=>s.inverseViewport)),t.legacy?(i.uniforms.add(new ds("proj",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new Gg("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new ds("transformProjFromView",r=>r.transformProjFromView)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(x`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function zxt(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(x`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(x`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Gxt(e,t){const i=e.vertex;t.silhouette?(i.code.add(x`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function jxt(e,t){const i=e.vertex;i.include(ku),i.uniforms.add(new Ie("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(x`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(L1("componentDataTex",r=>r.componentDataTexture,t.hasWebGL2Context?fr.None:fr.InvSize)),e.attributes.add(R.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*Rte),i.code.add(x`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${Zd(t,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${Xl(t,"componentDataTex","colorIndex")};
      vec4 otherValue = ${Xl(t,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${Xl(t,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),t.legacy?i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new aP("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(R.NORMALA,"vec3"),e.attributes.add(R.NORMALB,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(R.NORMAL,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(x`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(wk,t),i.include(wk,t),i.uniforms.add([new Gg("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new aP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Uh("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Uh("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Jt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Jt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(x`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?x`normalize(transformWorldFromModelTL + rotatedModelPosition);`:x`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new ds("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(x`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Hxt(e){return e.mode===no.SKETCH||e.mode===no.MIXED}var no,Mx;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(no||(no={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SILHOUETTE=1]="SILHOUETTE"}(Mx||(Mx={}));function $te(e,t){const i=e.vertex;switch(e.attributes.add(R.SIDENESS,"vec2"),t.mode===no.MIXED?i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case no.MIXED:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case no.SKETCH:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case no.SOLID:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case no.COUNT:break;default:t.mode}}function qxt(e,t){const i=e.vertex;switch(e.include($te,t),t.mode){case no.SOLID:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case no.SKETCH:i.uniforms.add(new eT("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case no.MIXED:i.uniforms.add(new eT("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Wxt(e,t){e.include($te,t);const{vertex:i,fragment:r}=e;switch(Hxt(t)&&(i.uniforms.add(L1("strokesTexture",s=>s.strokesTexture.texture,t.hasWebGL2Context?fr.None:fr.InvSize)),i.uniforms.add([new eT("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new eT("strokeVariants",s=>s.strokesTexture.variants)]),e.varyings.add("vStrokeUV","vec2"),r.uniforms.add([new L$("strokesTexture",s=>s.strokesTexture.texture),new eT("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)]),i.code.add(x`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${Zd(t,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),e.fragment.include(ku),r.code.add(x`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case no.SOLID:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(x`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case no.SKETCH:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(x`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case no.MIXED:e.varyings.add("vType","float"),i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(x`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Xxt(e){const t=new Yi,{vertex:i,fragment:r}=t;return e.legacy&&i.uniforms.add([new wpe("model"),new wpe("localView")]),t.include(Bxt,e),t.include(jxt,e),t.include(qxt,e),t.include($te,e),t.include(Wxt,e),t.include(An,e),t.include(Gxt,e),t.include(zxt,e),t.include(Xh,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add([new tr("pixelToNDC",(s,n)=>di(Yxt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new xi("viewport",(s,n)=>n.camera.fullViewport),new Ie("pixelRatio",(s,n)=>n.camera.pixelRatio)]),t.attributes.add(R.POSITION0,"vec3"),t.attributes.add(R.POSITION1,"vec3"),t.attributes.add(R.VARIANTOFFSET,"float"),t.attributes.add(R.VARIANTSTROKE,"float"),t.attributes.add(R.VARIANTEXTENSION,"float"),i.code.add(x`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${e.antialiasing?x`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:x`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${e.mode===no.SKETCH?x`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:e.mode===no.MIXED?x`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(x`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),t}const Yxt=tt();class wpe extends Zs{constructor(t){super(t,"mat4")}}const Zxt=Object.freeze(Object.defineProperty({__proto__:null,build:Xxt},Symbol.toStringTag,{value:"Module"}));class VV extends ir{initializeConfiguration(t,i){i.hasWebGL2Context=t.rctx.type===Tt.WEBGL2}initializeProgram(t){return new Ji(t.rctx,VV.shader.get().build(this.configuration),BRe)}initializePipeline(t){return t.blendMinMax?Ht({blending:Ro(Ce.ONE,Ce.ONE,Ce.ZERO,Ce.ONE,Ig.ADD,t.blendMinMax.MAX),depthTest:{func:Zr.LEQUAL},colorWrite:si}):Ht({depthTest:{func:Zr.LEQUAL},depthWrite:zc,colorWrite:si})}}VV.shader=new Zi(Zxt,()=>Q(()=>import("./EdgeShader.glsl.c755d61f.js"),[]));class Nm extends qo{constructor(){super(...arguments),this.mode=no.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([j({count:no.COUNT})],Nm.prototype,"mode",void 0),u([j()],Nm.prototype,"hasSlicePlane",void 0),u([j()],Nm.prototype,"silhouette",void 0),u([j()],Nm.prototype,"legacy",void 0),u([j()],Nm.prototype,"antialiasing",void 0),u([j()],Nm.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Nm.prototype,"hasMultipassTerrain",void 0),u([j()],Nm.prototype,"cullAboveGround",void 0),u([j()],Nm.prototype,"spherical",void 0);const Jxt=8,G7=128,Kxt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},Qxt={solid:no.SOLID,sketch:no.SKETCH,uber:no.MIXED};class mI{constructor(t,i,r){this._rctx=t,this._shaderTechniqueRepository=i,this._configuration=new Nm,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[ci.TRANSPARENT]:{[ci.TRANSPARENT]:new ri,[ci.OPAQUE]:new ri},[ci.OPAQUE]:{[ci.TRANSPARENT]:new ri,[ci.OPAQUE]:new ri}},this._renderablesDirty=!1,this._drawParameters=new kxt,this._settings={...Kxt,...r},this.key=mI.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:cr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=Qxt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=t.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=ls(this._technique)}addRenderable(t){this._renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this._renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,i){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[i][ci.TRANSPARENT].forAll(t),this._sortedRenderables[i][ci.OPAQUE].forAll(t)}updateTechnique(t,i){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(VV,this._configuration,this._technique),this._technique}bindRegularEdges(t,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!1),t,i)}bindSilhouetteEdges(t,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!0),t,i)}renderRegularEdges(t,i,r,s,n){this._render(t,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(t,i,r,s,n){this._render(t,i,i.silhouette.vao,r,s,n)}_render(t,i,r,s,n,o){o>0&&(this._bindDraw(t,i,s,n),this._rctx.bindVAO(r),this._rctx.capabilities.instancing.drawArraysInstanced(Nt.TRIANGLE_FAN,0,4,o))}_bindDraw(t,i,r,s){if(this._drawParameters.componentDataTexture=i.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in i.transform)this._lastOriginId!==i.transform.origin.origin.id&&(t.setUniformMatrix4fv("localView",i.transform.origin.viewMatrix),this._lastOriginId=i.transform.origin.origin.id),t.setUniformMatrix4fv("model",i.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=i.transform.origin.origin.vec3;else{const n=new EV(i.transform.position),o=up(xpe,lS(xpe,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;ue(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,s,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[ci.TRANSPARENT][ci.TRANSPARENT].clear(),this._sortedRenderables[ci.TRANSPARENT][ci.OPAQUE].clear(),this._sortedRenderables[ci.OPAQUE][ci.TRANSPARENT].clear(),this._sortedRenderables[ci.OPAQUE][ci.OPAQUE].clear(),this._renderables.forEach(i=>{i.objectTransparency!==ci.INVISIBLE&&i.edgeTransparency!==ci.INVISIBLE&&this._sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const t=(i,r)=>"origin"in i.transform?"origin"in r.transform?i.transform.origin.origin.id<r.transform.origin.origin.id?-1:i.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[ci.TRANSPARENT][ci.TRANSPARENT].sort(t),this._sortedRenderables[ci.TRANSPARENT][ci.OPAQUE].sort(t),this._sortedRenderables[ci.OPAQUE][ci.TRANSPARENT].sort(t),this._sortedRenderables[ci.OPAQUE][ci.OPAQUE].sort(t)}static getKey(t,i,r){return`edges-t:${t}:${i}:${r}`}}const xpe=kc();function eIt(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:eTt(e.layout)}}function WF(e){return tTt(e.layout).createView(e.buffer)}function eTt(e){const t=new Array;return e.fields.forEach((i,r)=>{const s={...i,constructor:tOe(i.constructor)};t.push([r,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function tTt(e){const t=As();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(i=>t.fields.set(i[0],{...i[1],constructor:rTt(i[1].constructor)})),t}const iTt=[N$,hp,Mr,_l,Bf,EA,CA,AA,ea,OT,SA,eb,F0,IT,tb,ta,PT,MA,$T,ib,LT,RA,uP,hP,OA,DT,dP,pP,fP,FT,mP,gP,yP,_P,vP,bP];function tOe(e){return`${e.ElementType}_${e.ElementCount}`}function rTt(e){return iOe.get(e)}const iOe=new Map;iTt.forEach(e=>iOe.set(tOe(e),e));class sTt extends HMe{constructor(t){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},t)}async process(t,i,r){if(r)return Wbt(t);const s=await this.invoke(new j7(t),i);return this._unpackOutput(s)}async extractEdgeLocations(t,i){const r=await this.invokeMethod("extractEdgeLocations",new j7(t),i);return WF(r)}async extractComponentsEdgeLocations(t,i){const r=await this.invokeMethod("extractComponentsEdgeLocations",new j7(t),i);return WF(r)}_unpackOutput(t){return{regular:{instancesData:WF(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:WF(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}class j7{constructor(t){this.dataBuffer=t.data.buffer,this.writerSettings=t.writerSettings,this.skipDeduplicate=t.skipDeduplicate,this.indices=Array.isArray(t.indices)?t.indices:t.indices.buffer,this.indicesType=Array.isArray(t.indices)?"Array":rZ(t.indices)?"Uint32Array":"Uint16Array",this.indicesLength=t.indicesLength}}function nTt(e){const i=kR.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=kR.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=kR.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:y}of kR.strokes){let _=m,b=y,w=p;for(let T=0;T<c;T++){T!==0&&(_=Tpe(_,ZP.DISTANCE),b=Tpe(b,ZP.PRESSURE));for(let S=0;S<kR.resolution;S++){const E=.5+(_?_[S%_.length]/a:0),M=b?b[S%b.length]:1;RP(E,s,w),RP(M,s,w+n),w+=4}w-=l*(h+1)}p+=l}const f=new pt(e,{pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:nt.LINEAR,width:i,height:i,wrapMode:Pt.REPEAT},s);return new aTt(i,a,o,h,f)}function Tpe(e,t){if(!e)return null;const i=e.length/2,r=oTt*i,s=new Array(i);let n=0;const o=t===ZP.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*Spe):Math.min(r,l*Spe)}return s}var ZP;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(ZP||(ZP={}));const oTt=.1,Spe=.5;class aTt{constructor(t,i,r,s,n){this.resolution=t,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=rt(this.texture)}}const kR={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Epe(e){let t=null;for(const i of e){const r=i.type;if(lTt(i)){if(C(t))t=r;else if(t!==r)return"uber"}}return v(t)?t:"uber"}function Cpe(e){let t=ci.INVISIBLE;for(const{material:i}of e)if(rOe(i)){if(i.color[3]*i.opacity<1)return ci.TRANSPARENT;t=ci.OPAQUE}return t}function Ape(e){let t=ci.INVISIBLE;for(const{material:i}of e)if(rOe(i)){switch(i.objectTransparency){case ci.TRANSPARENT:case ci.INVISIBLE:return ci.TRANSPARENT;case ci.OPAQUE:if(i.opacity<1)return ci.TRANSPARENT}t=ci.OPAQUE}return t}function rOe(e){return e.size*e.color[3]*e.opacity>0}function lTt(e){return e.size*e.color[3]>0}function Mpe(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}let Kp=class extends Te{constructor(e){super(e),this._updatingHandles=new fg,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=O(),this._localOrigins=new Dxt(new Xee(e.renderSR))}initialize(){this._worker=new sTt(this.schedule),this._componentColorManager=new jRe(this.rctx,3);const e=URe.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this._verticesBufferObject=Oi.createVertex(this.rctx,Xi.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=rt(this._strokesTexture),this._componentColorManager=Be(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=rt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,t,i,r,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new Ope(new Promise(p=>l=p),i.center,i.radius);this._perObjectData.set(e,c);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(t,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void se.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new Ope(new Promise(c=>n=c),o,g0(o));this._perObjectData.set(e,a);const l=new Array;if(i.mergeGeometries&&e.geometries.length>1&&cTt(e))l.push(this._addObjectMergedGeometries(e,a,t,i,r));else for(let c=0;c<e.geometries.length;c++){const h=e.geometries[c];h.material.supportsEdges&&l.push(this._addGeometry(e,a,h,t[0],i,r))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(C(i))return;const r=t instanceof Array?s=>t[s]:()=>t;i.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=r(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const t=await this._getObjectEntry(e);return v(t)?t.renderables.reduce((i,r)=>i+r.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof n_,n=!!i.hasSlicePlane,o=Epe(t),a=mI.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(e));C(l)||(l.renderables.forEach(c=>{if(a!==c.rendererKey){const h=this._renderers.get(c.rendererKey),p=this._acquireRenderer(o,n,s);h.removeRenderable(c),--h.refCount,c.rendererKey=a,p.addRenderable(c)}for(let h=0;h<t.length;h++)c.components.meta[h].material=t[h];r&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,t){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));C(i)||(i.renderables.forEach(r=>{var n;const s=r.components.meta;for(let o=0;o<s.length;o++)r.components.meta[o].verticalOffset=(n=t==null?void 0:t[o])!=null?n:0;this._updateComponentBuffer(r.components)}),this.setNeedsRender())}async updateObjectVisibility(e,t){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));v(i)&&(i.renderables.forEach(r=>r.visible=t),this.setNeedsRender())}removeObject(e){const t=this._perObjectData.get(e);t&&(this._perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this._perObjectData.get(e);if(!t)throw new Error("no object");return await t.loaded,t.loaded==null?null:t}render(e,t){if(C(this._componentColorManager))return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=O(),s=new EV;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,h=!0;l.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,c&&p.regular&&(l.updateTechnique(e,!1),c=!1),h&&p.silhouette&&(l.updateTechnique(e,!0),h=!1))},t)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new Nxt(40*n/o,t);ue(r,i[3],i[7],i[11]),s.set(r),le(a.transformWorldFromViewTH,s.high),le(a.transformWorldFromViewTL,s.low),cp(a.transformViewFromCameraRelativeRS,e.camera.viewMatrix),up(Lpe,a.transformViewFromCameraRelativeRS),lS(a.transformNormalViewFromGlobal,Lpe),a.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(l=>{this._renderRegularEdges(l,e,a),this._renderSilhouetteEdges(l,e,a)})}_updateTransparency(e){const t=Cpe(e.components.meta),i=Ape(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){e.getCombinedStaticTransformation(t,i);const r=v(t.localOrigin)?this._localOrigins.register(t.localOrigin):this._localOrigins.acquire(ue(this._tmpModelPosition,i[12],i[13],i[14]));return t.localOrigin=r.origin,$xt(r.origin.vec3,i),r}_updateComponentBuffer(e){const{meta:t,buffer:i}=e,r=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=ye(Math.round(n.size*Jxt),0,255),l=ye(n.extensionLength,-G7,255-G7)+G7,c=n.type==="solid"?g6.SOLID:g6.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],y=255*p[2],_=255*p[3];i.textureBuffer.setData(o,0,f,m,y,_),i.textureBuffer.setData(o,1,a,l,c,h),NRe(t[s].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(e){if(C(this._componentColorManager))return null;const t=new Array,i=this._componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=i.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const r=new uTt(i,t);return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this._worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this._workerAbort.signal,r)}_createRenderable(e,t,i,r,s){const n=c=>v(this._verticesBufferObject)?new hTt(new Wf(this.rctx,BRe,{vertices:Fbt,instances:c===Mx.REGULAR?f6.glLayout:m6.glLayout},{vertices:this._verticesBufferObject,instances:Oi.createVertex(this.rctx,Xi.STATIC_DRAW,c===Mx.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),c===Mx.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,o=e.regular.lodInfo.lengths.length>0?n(Mx.REGULAR):null,a=e.silhouette.lodInfo.lengths.length>0?n(Mx.SILHOUETTE):null,l=(v(o)?o.vao.size:0)+(v(a)?a.vao.size:0);return new pTt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:e.averageEdgeLength},i,Cpe(t.meta),Ape(t.meta),t,r)}async _addGeometry(e,t,i,r,s,n){const o=i.vertexAttributes.get(R.POSITION),a=i.indices.get(R.POSITION),l=Pe(),c=this._computeModelTransformWithLocalOrigin(e,i,l),h=new $pe(o,a,l,c);return this._addPositionData(t,h,i.edgeIndicesLength,r,s,n)}async _addPositionData(e,t,i,r,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([r]);if(C(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,f=p.data.length/p.size,m=d6.createBuffer(f);for(let b=0;b<f;b++)m.position.set(b,0,p.data[b*p.size+0]),m.position.set(b,1,p.data[b*p.size+1]),m.position.set(b,2,p.data[b*p.size+2]);Mpe(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,i));if(e.loaded==null)return;const _=this._createRenderable(y,o,new dTt(l,c),a.key,!1);e.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(e,t,i,r,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(C(a))return 0;const l=Epe(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=d6.createBuffer(i.count);nV(h.position,i),Mpe(a.meta,s,h.componentIndex,r);const p=!0,f=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(f,h,p,!1,r));if(t.loaded==null)return 0;const y=this._createRenderable(m,a,e,c.key,!0);return t.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let w=0;w<e.geometries.length;w++){const T=e.geometries[w];if(!T.material.supportsEdges)continue;!a&&T.localOrigin&&(a=T);const S=T.vertexAttributes.get(R.POSITION);l+=S.data.length/S.size,o+=T.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let w=0;w<e.geometries.length;w++){const T=e.geometries[w];if(!T.material.supportsEdges)continue;const S=T.vertexAttributes.get(R.POSITION),E=T.indices.get(R.POSITION);let M=n.get(S.data);if(M==null){M=p.length/3;for(let A=0;A<S.data.length;A+=S.size)p.push(S.data[A+0]),p.push(S.data[A+1]),p.push(S.data[A+2]);n.set(S.data,M)}if(E)for(let A=0;A<T.edgeIndicesLength;A++)h[f++]=M+E[A]}const m=a||e.geometries[0],y=Pe(),_=this._computeModelTransformWithLocalOrigin(e,m,y);for(let w=0;w<e.geometries.length;w++)e.geometries[w].localOrigin=_.origin;const b=new $pe({data:p,size:3},h,y,_);await this._updatingHandles.addPromise(this._addPositionData(t,b,h.length,i[0],r,s))}_acquireRenderer(e,t,i){const r=mI.getKey(e,t,i);let s=this._renderers.get(r);return C(this._strokesTexture)&&(this._strokesTexture=nTt(this.rctx)),s||(s=new mI(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===je.Global}),this._renderers.set(r,s)),++s.refCount,s}_removeRenderable(e){Rpe(e.regular),Rpe(e.silhouette);const t=this._renderers.get(e.rendererKey);if(t){t.removeRenderable(e),--t.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=O(),s=n=>{Wo(r,n.center,t);const o=_e(r,i),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){const r=e.bindRegularEdges(i,t),s=i.transparency,n=t.camera.perScreenPixelRatio;e.forEachRenderable(o=>{if(!Ipe(o)||!o.visible)return;const a=XF(o.regular.lod.lengths,o.distanceToCamera,n);e.renderRegularEdges(r,o,i,t,a)},s)}_renderSilhouetteEdges(e,t,i){const r=e.bindSilhouetteEdges(i,t),s=i.transparency,n=t.camera.perScreenPixelRatio;e.forEachRenderable(o=>{if(!Ppe(o)||!o.visible)return;const a=XF(o.silhouette.lod.lengths,o.distanceToCamera,n);e.renderSilhouetteEdges(r,o,i,t,a)},s)}get test(){return{hasRenderedPrimitives:e=>{let t=!1;const i=e.perScreenPixelRatio,r=(s,n)=>s.forEachRenderable(o=>{o.visible&&!t&&(Ipe(o)&&(t=XF(o.regular.lod.lengths,o.distanceToCamera,i)>0),!t&&Ppe(o)&&(t=XF(o.silhouette.lod.lengths,o.distanceToCamera,i)>0))},n);return this._renderers.forEach(s=>{t||(r(s,ci.OPAQUE),r(s,ci.TRANSPARENT))}),t}}}};function Rpe(e){v(e)&&(e.vao.vertexBuffers.instances.dispose(),e.vao.dispose(!1),e.vao=null)}function cTt(e){let t=null,i=null;for(let r=0;r<e.geometries.length;r++){const s=e.geometries[r];if(s.material.supportsEdges){if(t){if(!xg(t,s.transformation))return!1}else t=s.transformation;if(!i&&v(s.localOrigin))i=s;else if(i&&v(i.localOrigin)&&v(s.localOrigin)&&i.localOrigin.id!==s.localOrigin.id)return!1}}return!0}u([d({constructOnly:!0})],Kp.prototype,"rctx",void 0),u([d({constructOnly:!0})],Kp.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Kp.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Kp.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],Kp.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],Kp.prototype,"schedule",void 0),u([d({readOnly:!0})],Kp.prototype,"_updatingHandles",void 0),u([d({readOnly:!0})],Kp.prototype,"updating",null),Kp=u([P("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Kp);class Ope{constructor(t,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class uTt{constructor(t,i){this.buffer=t,this.meta=i}}class hTt{constructor(t,i){this.vao=t,this.lod=i}}class dTt{constructor(t,i){this.modelMatrix=t,this.origin=i}}class pTt{constructor(t,i,r,s,n,o,a,l){this.regular=t,this.silhouette=i,this.statistics=r,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function Ipe(e){return v(e.regular)}function Ppe(e){return v(e.silhouette)}function XF(e,t,i){const r=t*i,s=fIe(e,r,!0);return s===-1?r<e[0]?e.length:0:e.length-s}class $pe{constructor(t,i,r,s){this.position=t,this.indices=i,this.modelTransform=r,this.origin=s}}const Lpe=Cs();function qg(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}class Dpe{constructor(t,i,r,s,n,o,a,l,c){this.createQuery=t,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}}let jy=!1;function fTt(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&qg(e)?new Dpe(()=>e.createQuery(),r=>{e.deleteQuery(r),jy=!1},r=>e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),r=>e.getQueryParameter(r,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>{jy||(jy=!0,e.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{e.endQuery(i.TIME_ELAPSED_EXT),jy=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new Dpe(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),jy=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>{jy||(jy=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),jy=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function mTt(e,t){const i=e.capabilities.disjointTimerQuery;return C(i)?null:new gTt(i,t)}class gTt{constructor(t,i){this._timer=t,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){jy||(this._currentQuery=this._queryPool.pop(),C(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(t){if(this._timer.disjoint()||C(this._currentQuery)||!this._queryResults.has(t))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(t);if(C(i))return this._queryResults.set(t,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(t,this._currentQuery),this._currentQuery=null,r}abort(){v(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){v(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(t=>{this._timer.deleteQuery(t)}),this._queryResults.forEach(t=>{C(t)||this._timer.deleteQuery(t)})}}var Wr;(function(e){e.OVERLAY="overlay",e.PREPARE="prepare",e.SHADOW_MAP="shadow map",e.LINEAR_DEPTH="linear depth",e.ACCUMULATED_SHADOWS="accumulated shadows",e.NORMALS="normals",e.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",e.SSAO="SSAO",e.OPAQUE="opaque",e.OPAQUE_EDGES="opaque edges",e.VOXEL="voxel",e.TRANSPARENT="transparent",e.TRANSPARENT_EDGES="transparent edges",e.HUD_VISIBILITY="HUD visibility",e.TRANSPARENT_TERRAIN="transparent terrain",e.ENVIRONMENT="environment",e.LASER_LINE="laser line",e.OCCLUDED="occluded",e.ANTIALIASING="antialiasing",e.HIGHLIGHTS="highlights",e.HUD="HUD",e.HUD_OCCLUDED="HUD occluded",e.FINISH="finish"})(Wr||(Wr={}));const Fpe="Total";class yTt{constructor(t){this._rctx=t,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new l0(Fpe),this._cpuTimeSamplers=new Map(Object.values(Wr).map(i=>[i,new l0(i)])),this._enableGPUTimer=0,this._totalGPUTime=new l0("GPU"),this._gpuTimeSamplers=new Map(Object.values(Wr).map(i=>[i,new l0(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return v(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(C(this._gpuTimerPool)){const t=[...Object.values(Wr),Fpe];this._gpuTimerPool=mTt(this._rctx,t)}return C(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:uZ(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=rt(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),v(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(t){const i=performance.now();if(this._cpuTimeSamplers.get(t).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,v(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(t);this._gpuTimeSamplers.get(t).record(r),this._gpuTimerPool.start()}}finishFrame(){if(v(this._gpuTimerPool)){const i=this._gpuTimerPool.stop(Wr.FINISH);this._gpuTimeSamplers.get(Wr.FINISH).record(i)}const t=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+t,this._totalCPUTime.record(t),v(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}}let nh=class extends Te{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(e,t=this._state){return Ft(this._renderStateFeatures.get(t,e),!1)}setFeatureEnabled(e,t,i){this._renderStateFeatures.set(t,e,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(wn.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(wn.HighQualityTransparency)}get hasWaterReflection(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(wn.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(e,t,i,r,s,n,o,a){super({}),this._stage=e,this._materialRepository=t,this._shaderTechniqueRepository=r,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new ri,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new Sxt,this._state=Di.IDLE,this._renderStateFeatures=wle(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=vo.Opaque,this._waterReflectionEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Lwt,this._handles=new Ii,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new h3(this._rctx,r),a(),this._offscreen=new ext(this._rctx,this._compositingHelper),this.performanceInfo=new yTt(this._rctx),this._shadowMap=new Yee(this._rctx,e.viewingMode),this._ssaoHelper=new IAe(e.view,r,this._rctx,a),this._highlight=new Zwt(r,this._rctx),this._shadowHighlight=new Txt(this._rctx,e.viewingMode),this._shadowAccumulator=new wc(this._rctx,r,e,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,h)=>{l.shadowMap.start(l.camera,c,h),this._renderShadowCascades(z.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new Dut(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new rxt({renderContext:this._renderContext,techniqueRepository:r,textureRepository:i,materialRepository:this._materialRepository,requestRender:a,controller:e}),this.renderPassManager=new $wt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([te(()=>this._stage.view.state.camera,()=>a(),Gs),te(()=>cr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(ci.TRANSPARENT):()=>{},a()},st),te(()=>this._ssaoEnabled||this.isFeatureEnabled(wn.SSAO),l=>this._ssaoHelper.enabled=l,Gs)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=hs(this._gpuTimerHandle),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=rt(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),d8.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||v(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return C(this._edgeView)&&(this._edgeView=new Kp({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.view.resourceController.immediate.schedule(e)}),this._handles.add(te(()=>Mn(this._edgeView,e=>e.updating),()=>this._requestRender(),hr)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return BJ(this._bindParameters.ssr.reprojectionMatrix,Hh)}set _reprojectionMatrix(e){eZ(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){const{_shadowMap:t,_bindParameters:i}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&i.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(i.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),v(e.environment)){v(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&this._ssaoEnabled!==e.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const r=e.environment.lighting.type!=="virtual";i.enableFillLights!==r&&(i.enableFillLights=r,this._requestRender())}e.background&&this._offscreen.background!==e.background&&(this._offscreen.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==e.antialiasingEnabled&&(this._antialiasingEnabled=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,t){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:r,updates:s}=e;if(i.length===0&&r.length===0&&s.length===0)return;const n=_Ae(e);let o=!1;n.forEach((a,l)=>{if(t.done)return;let c=this._materialRenderers.find(h=>h.material===l);C(c)&&a.adds.length>0&&(c=new MAe(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(h=>e.removes.removeUnordered(h)),a.adds.forEach(h=>e.adds.removeUnordered(h)),a.updates.forEach(h=>e.updates.removeUnordered(h)),t.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(Ee.LINE_CALLOUTS_HUD_DEPTH,z.Color)||a.requiresSlot(Ee.HUD_MATERIAL,z.Color)||a.requiresSlot(Ee.LABEL_MATERIAL,z.Color)),this._requestRender()}updateAnimation(e){const t=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations!==t&&(this._gpuTimerHandle=t?hs(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(e,t,i,r,s){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:n,contentCamera:o,mode:a}=i;this._state=a,this._renderOverlay(s),this.performanceInfo.advance(Wr.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=Ct.NONE;const l=this._offscreen;l.setupRenderTarget(this.hasWaterReflection);const c=X0(this._sliceHelper.plane);r===CT.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Wr.PREPARE);const h=this._computeDepthRange(n);this._renderShadowMap(e,n,this._bindParameters.lighting.mainLight.direction,h),this.performanceInfo.advance(Wr.SHADOW_MAP),l.initializeFrame(n),this._ensureBindParameters(n,o),this._renderLinearDepth(),this.performanceInfo.advance(Wr.LINEAR_DEPTH),this._accumulateShadows(h,n,o),this.performanceInfo.advance(Wr.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(Wr.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(Wr.SSAO),this._renderContext.output=z.Color,l.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Wr.OPAQUE);const p=this._terrainRenderingEnabled&&(this._terrainTransparency===vo.Semitransparent||this._terrainTransparency===vo.TransparentWithDraped),f=this._highQualityTransparency&&p;this._renderTerrainLinearDepth(f),this._setMultipassEnabled(f),this._setTerrainCulling(f),this._renderEdges(ci.OPAQUE),this.performanceInfo.advance(Wr.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(Ee.VOXEL),this.performanceInfo.advance(Wr.VOXEL),this._renderHiddenTransparentEdges();const m=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;m&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Wr.TRANSPARENT),this._renderGeometryLinearDepth(f);const y=this._renderHUDVisibility(f);f||this._renderInternalSlot(Ee.LINE_CALLOUTS),this.performanceInfo.advance(Wr.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(t),this.performanceInfo.advance(Wr.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(ci.TRANSPARENT,f),this.performanceInfo.advance(Wr.TRANSPARENT_EDGES),this._renderTransparentTerrain(),p&&y&&(f?this._renderLineCallouts(mh.Occluded):l.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(mh.Occluded,l.framebuffer),this.performanceInfo.advance(Wr.HUD_OCCLUDED)),this.performanceInfo.advance(Wr.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),p&&(l.compositeTransparentTerrainOntoMain(this._bindParameters),f&&(this._renderEdges(ci.OPAQUE),this.performanceInfo.advance(Wr.OPAQUE_EDGES),m&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Wr.TRANSPARENT),this._renderEdges(ci.TRANSPARENT),this.performanceInfo.advance(Wr.TRANSPARENT_EDGES))),f&&this._renderLineCallouts(mh.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),l.renderToTargets(()=>{this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Ee.LASERLINES)},l.currentColorTarget,l.mainDepth),this.performanceInfo.advance(Wr.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&l.renderTmpAndCompositeToMain(()=>this._renderSlot(Ee.LASERLINES_CONTRAST_CONTROL),this._bindParameters,ul.PremultipliedAlpha),this.performanceInfo.advance(Wr.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(Wr.OCCLUDED);const _=r===CT.ON&&this._magnifierHelper.enabled,b=_&&C(e)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):e;this._rctx.bindFramebuffer(b);const w=this._offscreen.colorTexture;!this._renderAntiAliasing(w)&&v(w)&&this._compositingHelper.composite(this._bindParameters,w,ul.None),this.performanceInfo.advance(Wr.ANTIALIASING),this._renderHUD(mh.NotOccluded,b),this.performanceInfo.advance(Wr.HUD),this._renderHighlights(b,this._bindParameters),this.performanceInfo.advance(Wr.HIGHLIGHTS),_&&this._magnifierHelper.render(this._rctx,this._bindParameters),b!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,ul.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=c,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(e){if(v(e)&&he("enable-feature:objectAndLayerId-rendering")){const t=this._renderContext.output;this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(z.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=mh.NotOccluded,this._renderInternalSlot(Ee.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=t}}finish(e){this._hasAnimations||this._animationTimestep.clear();const t=this.performanceInfo.gpuSamplingEnabled,i=e===cn.BACKGROUND;if(i||t){const r=i?this.performanceInfo.elapsedTime:0,s=t?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(r,s);this._animationTimestep.frame(n,i)}}readDepthPixels(e,t,i){const r=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=ts.COLOR_BUFFER_BIT|ts.DEPTH_BUFFER_BIT|ts.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(z.Depth)}r.readPixels(t[0],t[1],t[2],t[3],ze.RGBA,kt.UNSIGNED_BYTE,i)}readHUDVisibility(e,t,i,r,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(e,t,i,r,ze.RGBA,kt.UNSIGNED_BYTE,s)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;v(i)&&i.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,ul.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&this.isFeatureEnabled(wn.ShadowMapUpdate)&&(s.start(t,i,r),this._shadowHighlight.updateParameters(t,i),this._needsShadowHighlight?(this._renderShadowCascades(z.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,VA.Highlight)),s.clear(),this._renderShadowCascades(z.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,VA.Default),this._renderGeometryAndTransparentTerrainPass(z.ShadowHighlight)})):this._renderShadowCascades(z.Shadow),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=r=>{}){for(const r of t.cascades)r.camera.setGLViewport(this._rctx),this._prepare(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(z.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.output;this._renderContext.output=z.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=t}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(z.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=t}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(z.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return yY;const t=gwt(e,this._materialRenderers,this._stage.layers);return qA(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(e){this._ssaoHelper.render(this._bindParameters,e,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(Ee.INTEGRATED_MESH),this._renderSlot(Ee.OPAQUE_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL),this._renderSlot(Ee.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Ee.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let t=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,t=this._renderInternalSlot(Ee.OCCLUSION_PIXELS)},e),t}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===mh.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(Ee.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Ee.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,ul.PremultipliedAlpha)):e===mh.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(mh.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Ee.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Ee.HUD_MATERIAL),this._renderInternalSlot(Ee.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,t){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const i=this._highlight,r=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(z.Highlight),this._rctx.clearSafe(ts.DEPTH_BUFFER_BIT),this._renderHUDElements(mh.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(t,e),i.render(this._bindParameters,r,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this._needsShadowCast&&v(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,e,t,i)}_renderOrderIndependentTransparency(e,t){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreen.renderOITPass(()=>e(),s,t)},r=this._renderContext.output;this._renderContext.output=z.Alpha,i(Ct.Alpha),this._renderContext.output=z.Color,i(Ct.Color),i(Ct.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=Ct.NONE,this._renderContext.output=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;Rp.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===Is.OccludeAndTransparentStencil&&(e|=n.material.renderOccluded,Rp.push(n))});const t=this._offscreen,i=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};Rp.length!==0&&(this._renderInternalSlot(Ee.OCCLUDER_MATERIAL,Rp),i(.5,Is.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Ee.TRANSPARENT_OCCLUDER_MATERIAL,Rp),!1,!1)),Rp.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===Is.OccludeAndTransparent||n.material.renderOccluded===Is.Transparent||n.material.renderOccluded===Is.Opaque)&&(e|=n.material.renderOccluded,Rp.push(n))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>Is.Occlude&&this._renderSlot(Ee.OCCLUDED_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL,Rp),this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL,Rp),this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Rp),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=z.Color,i(.5,Is.OccludeAndTransparent,()=>s(Is.OccludeAndTransparent),!0,Nc.OutlineVisualElementMask),i(.5,Is.Transparent,()=>s(Is.Transparent),!0,Nc.OutlineVisualElementMask),i(1,Is.Opaque,()=>s(Is.Opaque),!0,Nc.OutlineVisualElementMask),Rp.clear()}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&v(e))return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,t){this._needsTransparentPass=this._materialRenderers.some(i=>i.requiresSlot(Ee.TRANSPARENT_MATERIAL,z.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var r;this._bindParameters.camera=e,this._bindParameters.contentCamera=t;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.mainColorTexture=i.mainColorTexture,this._bindParameters.highlightDepthTexture=(r=i.depthTexture)!=null?r:this._getFallbackDepthTexture()}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.enabled=this.hasWaterReflection,this._bindParameters.ssr.enabled){C(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Hh:(Ea(kpe,this._bindParameters.camera.viewMatrix),Ea(Npe,this._bindParameters.camera.projectionMatrix),Hs(w2,kpe,Npe),Hs(w2,this._renderContext.lastFrameCamera.viewMatrix,w2),Hs(w2,this._renderContext.lastFrameCamera.projectionMatrix,w2),this._reprojectionMatrix=w2),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const t=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=t>0?Math.min(t,e-this._waterReflectionEnableTime)/t:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._waterReflectionEnableTime=null}_renderInternalSlot(e,t=this._materialRenderers){let i=!1;return this._bindParameters.slot=e,t.forAll(r=>{r.material.shouldRender(this._renderContext)&&r.render(this._renderContext.output,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=_Se(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreen)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((r=(i=this._highlight)==null?void 0:i.gpuMemoryUsage)!=null?r:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{e._renderStateFeatures=wle()},getFramebufferTexture:t=>{switch(t){case qv.Color:return e._offscreen.colorTexture;case qv.LinearDepth:return e._offscreen.linearDepthTexture;case qv.Normals:return e._offscreen.normalTexture;case qv.ShadowMap:return e._shadowMap.depthTexture;case qv.HudVisibility:return e._offscreen.hudVisibilityTexture;case qv.Highlight:return e._offscreen.highlightTexture}}}}};var qv;u([d()],nh.prototype,"_shadowAccumulator",void 0),u([d()],nh.prototype,"_state",void 0),u([d()],nh.prototype,"_renderStateFeatures",void 0),u([d()],nh.prototype,"_antialiasingEnabled",void 0),u([d({readOnly:!0})],nh.prototype,"_antialiasing",null),u([d()],nh.prototype,"_ssaoEnabled",void 0),u([d()],nh.prototype,"_smaaPass",void 0),u([d({autoDestroy:!0})],nh.prototype,"_edgeView",void 0),u([d()],nh.prototype,"updating",null),u([d()],nh.prototype,"isCameraFinal",null),nh=u([P("esri.views.3d.webgl-engine.lib.Renderer")],nh),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(qv||(qv={}));const Rp=new ri,Npe=Pe(),kpe=Pe(),w2=Pe();class Upe{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ce.ONE,dstRGB:Ce.ZERO,srcAlpha:Ce.ONE,dstAlpha:Ce.ZERO},this.blendEquation={mode:Ig.ADD,modeAlpha:Ig.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=xf.BACK,this.frontFace=vA.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Zr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:xf.FRONT_AND_BACK,func:Zr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:xf.FRONT_AND_BACK,fail:dn.KEEP,zFail:dn.KEEP,zPass:dn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}}class _Tt{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}get information(){let t="";if(this._allocations.size>0){t+=`${this._allocations.size} live object allocations:
`;const i=new Map;this._allocations.forEach(r=>{var s;i.set(r,((s=i.get(r))!=null?s:0)+1)}),i.forEach((r,s)=>{const n=s.split(`
`);n.shift(),n.shift(),t+=`${r}: ${n.shift()}
`,n.forEach(o=>t+=`   ${o}
`)})}return t}}const vTt={RECORD_ALLOCATIONS:!1};class bTt{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new _Tt(vTt.RECORD_ALLOCATIONS);this._current.length<Co.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,i){const r=++this._current[t];this._max[t]=Math.max(r,this._max[t]),this._allocations.add(i)}decrement(t,i){--this._current[t],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,i)=>t+i,0)}get resourceInformation(){let t="";if(this.total>0){t+=`Live objects:
`;for(let i=0;i<Co.COUNT;++i){const r=this._current[i];r>0&&(t+=`${Co[i]}: ${r}
`)}}return t+=this._allocations.information,t}}const wTt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Vpe,CY={},xTt={get exports(){return CY},set exports(e){CY=e}};(Vpe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(xTt.exports=Vpe);const TTt=CY;var Bpe,AY={},STt={get exports(){return AY},set exports(e){AY=e}};Bpe=STt,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(Bpe.exports=t)}();const zpe=AY;var MY={},ETt={get exports(){return MY},set exports(e){MY=e}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(e.exports=i)})()})(ETt);const CTt=MY;var Op=999,Gpe=9999,H7=0,q7=1,jpe=2,Hpe=3,qpe=4,YF=5,ATt=6,MTt=7,RTt=8,Wpe=9,OTt=10,Xpe=11,ITt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function PTt(){var e,t,i,r=0,s=0,n=Op,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(G){return a=[],G!==null?_(G.replace?G.replace(/\r\n/g,`
`):G):b()};function y(G){G.length&&a.push({type:ITt[n],data:G,position:h,line:l,column:c})}function _(G){var X;for(r=0,i=(m+=G).length;e=m[r],r<i;){switch(X=r,n){case H7:r=M();break;case q7:r=E();break;case jpe:r=S();break;case Hpe:r=A();break;case qpe:r=k();break;case Xpe:r=I();break;case YF:r=V();break;case Gpe:r=B();break;case Wpe:r=T();break;case Op:r=w()}X!==r&&(m[X]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function b(G){return o.length&&y(o.join("")),n=OTt,y("(eof)"),a}function w(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+r-1,n=H7,t=e,r+1):t==="/"&&e==="/"?(h=s+r-1,n=q7,t=e,r+1):e==="#"?(n=jpe,h=s+r,r):/\s/.test(e)?(n=Wpe,h=s+r,r):(p=/\d/.test(e),f=/[^\w_]/.test(e),h=s+r,n=p?qpe:f?Hpe:Gpe,r)}function T(){return/[^\s]/g.test(e)?(y(o.join("")),n=Op,r):(o.push(e),t=e,r+1)}function S(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,r+1):(y(o.join("")),n=Op,r)}function E(){return S()}function M(){return e==="/"&&t==="*"?(o.push(e),y(o.join("")),n=Op,r+1):(o.push(e),t=e,r+1)}function A(){if(t==="."&&/\d/.test(e))return n=YF,r;if(t==="/"&&e==="*")return n=H7,r;if(t==="/"&&e==="/")return n=q7,r;if(e==="."&&o.length){for(;$(o););return n=YF,r}if(e===";"||e===")"||e==="("){if(o.length)for(;$(o););return y(e),n=Op,r+1}var G=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||G){for(;$(o););return n=Op,r}return o.push(e),t=e,r+1}function $(G){for(var X,K,re=0;;){if(X=zpe.indexOf(G.slice(0,G.length+re).join("")),K=zpe[X],X===-1){if(re--+G.length>0)continue;K=G.slice(0,1).join("")}return y(K),h+=K.length,(o=o.slice(K.length)).length}}function I(){return/[^a-fA-F0-9]/.test(e)?(y(o.join("")),n=Op,r):(o.push(e),t=e,r+1)}function k(){return e==="."||/[eE]/.test(e)?(o.push(e),n=YF,t=e,r+1):e==="x"&&o.length===1&&o[0]==="0"?(n=Xpe,o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=Op,r):(o.push(e),t=e,r+1)}function V(){return e==="f"&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=Op,r):(o.push(e),t=e,r+1)}function B(){if(/[^\d\w_]/.test(e)){var G=o.join("");return n=TTt.indexOf(G)>-1?RTt:CTt.indexOf(G)>-1?MTt:ATt,y(o.join("")),n=Op,r}return o.push(e),t=e,r+1}}function $Tt(e){var t=PTt(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function LTt(e){return $Tt(e)}function DTt(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const W7=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function FTt(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function NTt(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function d3(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,d3(e,t,r+"_"+t[r],r);return i}function sOe(e,t,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=r(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function kTt(e,t,i,r="lowp"){sOe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function UTt(e,t,i,r,s="lowp"){sOe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function VTt(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&e.splice(i,r-i+1),s}function Ype(e,t){const i=BTt();if(v(i))return i;const r=LTt(e);if(FTt(r,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":t===Ch.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===Ch.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===Ch.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=d3(r,o,"fragColor"),kTt(r,s,"vec4")),c.data=s),t===Ch.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=VTt(r,l+1),p=d3(r,o,"fragData");UTt(r,p,"vec4",h,"mediump"),c.data=p}else t===Ch.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=d3(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if(wTt.includes(c.data)){if(t===Ch.VERTEX_SHADER&&NTt(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=d3(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&W7.includes(h[1].trim())){const m=r[l+1];r.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&W7.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&W7.includes(f[1].trim())&&(c.data="#if 0")}}return zTt(e,DTt(r))}function BTt(e){return null}function zTt(e,t){return t}const GTt=4294967295;class jTt{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Tt.WEBGL2&&(i=Ype(i,Ch.VERTEX_SHADER),r=Ype(r,Ch.FRAGMENT_SHADER)),this._vShader=Zpe(this._context,Ch.VERTEX_SHADER,i),this._fShader=Zpe(this._context,Ch.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Co.Shader,this),cX()&&(this.vertexShader=i,this.fragmentShader=r);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),cX()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Tt.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<GTt&&l.uniformBlockBinding(a,p,h)}}this._glName=a,this._context.instanceCounter.increment(Co.Program,this)}get glName(){return this._glName}get hasGLName(){return v(this._glName)}get compiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null||C(this.glName)?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Co.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Co.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&v(this.glName)&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){fm(this._nameToUniform1v,t,i)&&this._context.gl.uniform1iv(this._getUniformLocation(t),i)}setUniform2iv(t,i){fm(this._nameToUniform2,t,i)&&this._context.gl.uniform2iv(this._getUniformLocation(t),i)}setUniform3iv(t,i){fm(this._nameToUniform3,t,i)&&this._context.gl.uniform3iv(this._getUniformLocation(t),i)}setUniform4iv(t,i){fm(this._nameToUniform4,t,i)&&this._context.gl.uniform4iv(this._getUniformLocation(t),i)}setUniform1f(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){fm(this._nameToUniform1v,t,i)&&this._context.gl.uniform1fv(this._getUniformLocation(t),i)}setUniform2f(t,i,r){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),this._nameToUniform2.set(t,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s[0]=i,s[1]=r)}setUniform2fv(t,i){fm(this._nameToUniform2,t,i)&&this._context.gl.uniform2fv(this._getUniformLocation(t),i)}setUniform3f(t,i,r,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),this._nameToUniform3[t]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(t,i){fm(this._nameToUniform3,t,i)&&this._context.gl.uniform3fv(this._getUniformLocation(t),i)}setUniform4f(t,i,r,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),this._nameToUniform4.set(t,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(t,i){fm(this._nameToUniform4,t,i)&&this._context.gl.uniform4fv(this._getUniformLocation(t),i)}setUniformMatrix3fv(t,i,r=!1){fm(this._nameToUniformMatrix3,t,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i)}setUniformMatrix4fv(t,i,r=!1){fm(this._nameToUniformMatrix4,t,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i)}stop(){}}function Zpe(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),cX()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===Ch.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(HTt(i))),s}function HTt(e){let t=2;return e.replace(/\n/g,()=>`
`+qTt(t++)+":")}function qTt(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function fm(e,t,i){const r=e.get(t);return r?eZ(r,i):(e.set(t,Array.from(i)),!0)}class WTt{constructor(t){this._rctx=t,this._store=new wM}dispose(){this._store.forEach(t=>t.forEach(i=>i.dispose())),this._store.clear()}acquire(t,i,r,s){const n=this._store.get(t,i);if(v(n))return n.ref(),n;const o=new jTt(this._rctx,t,i,r,s);return o.ref(),this._store.set(t,i,o),o}get test(){let t=0;return this._store.forEach(i=>i.forEach(r=>t+=r.hasGLName?2:1)),{cachedWebGLObjects:t}}}class tL{constructor(){this._result=!1}dispose(){this._program=rt(this._program)}get result(){return v(this._program)&&(this._result=this._test(this._program),this.dispose()),this._result}}class XTt extends tL{constructor(t){super(),this._rctx=t,this._dummyProgram=null,this._rctx.type===Tt.WEBGL2&&he("mac")&&he("chrome")&&(this._program=this._prepareProgram(),this._dummyProgram=this._prepareDummyProgram())}dispose(){var t;super.dispose(),(t=this._dummyProgram)==null||t.dispose(),this._dummyProgram=null}_test(t){const i=this._rctx;i.resetState();const r=new Yr(i,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},{target:St.TEXTURE_2D,wrapMode:Pt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1}),s=Oi.createIndex(this._rctx,Xi.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.useProgram(this._dummyProgram),i.bindBuffer(s,$t.ELEMENT_ARRAY_BUFFER),i.drawElements(Nt.POINTS,1,dt.UNSIGNED_BYTE,0),i.useProgram(t),i.bindVAO(null),i.drawArrays(Nt.TRIANGLES,0,258);const n=new Uint8Array(4);return r.readPixels(0,0,1,1,ze.RGBA,kt.UNSIGNED_BYTE,n),r.dispose(),s.dispose(),n[0]===255}_prepareProgram(){const i=`
    precision highp float;

    varying float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${x.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`
    precision highp float;

    varying float triangleId;

    void main(void) {
      gl_FragColor = triangleId == ${x.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareDummyProgram(){const t=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,i=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(t,i,new Map([]))}}class YTt extends tL{constructor(t){super(),this._rctx=t,this._program=Jpe(this._rctx,!1),this._obfuscated=Jpe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=rt(this._obfuscated)}_test(t){if(he("force-double-precision-obfuscation"))return!0;if(C(this._obfuscated))return!1;const i=this._runProgram(t),r=this._runProgram(this._obfuscated);return i!==0&&(r===0||i/r>5)}_runProgram(t){const i=this._rctx;i.resetState();const r=new Yr(i,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},{target:St.TEXTURE_2D,wrapMode:Pt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1}),s=Oi.createVertex(i,Xi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new lp(i,new Map([["position",0]]),{geometry:[new Ca("position",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Le(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Le(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=new Float32Array(6);mX(o,l,3);const c=new Float32Array(6);mX(a,c,3),i.useProgram(t),t.setUniform3f("u_highA",l[0],l[2],l[4]),t.setUniform3f("u_lowA",l[1],l[3],l[5]),t.setUniform3f("u_highB",c[0],c[2],c[4]),t.setUniform3f("u_lowB",c[1],c[3],c[5]),i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.bindVAO(n),i.drawArrays(Nt.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);r.readPixels(0,0,1,1,ze.RGBA,kt.UNSIGNED_BYTE,h),n.dispose(!1),s.dispose(),r.dispose();const p=(o[2]-a[2])/25,f=Cee(h);return Math.abs(p-f)}}function Jpe(e,t){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return e.programCache.acquire(i,r,new Map([["position",0]]))}var Kpe,Qpe,RY={},ZTt={get exports(){return RY},set exports(e){RY=e}};Kpe=ZTt,(Qpe=function(){var e=function(_){window.console&&window.console.log&&window.console.log(_)},t=function(_){window.console&&window.console.error?window.console.error(_):e(_)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(_){if(r==null)for(var b in r={},s={},_)typeof _[b]=="number"&&(r[_[b]]=b,s[b]=_[b])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(_){return o(),r[_]!==void 0}function l(_){o();var b=r[_];return b!==void 0?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+_.toString(16)}function c(_,b,w,T){var S;if((S=i[_])!==void 0&&(S=S[b])!==void 0&&S[w]){if(typeof S[w]=="object"&&S[w].enumBitwiseOr!==void 0){for(var E=S[w].enumBitwiseOr,M=0,A=[],$=0;$<E.length;++$){var I=s[E[$]];(T&I)!=0&&(M|=I,A.push(l(I)))}return M===T?A.join(" | "):l(T)}return l(T)}return T===null?"null":T===void 0?"undefined":T.toString()}function h(_,b){for(var w="",T=b.length,S=0;S<T;++S)w+=(S==0?"":", ")+c(_,T,S,b[S]);return w}function p(_,b,w){_.__defineGetter__(w,function(){return b[w]}),_.__defineSetter__(w,function(T){b[w]=T})}function f(_,b,w,T){T=T||_,n(_),b=b||function(I,k,V){for(var B="",G=V.length,X=0;X<G;++X)B+=(X==0?"":", ")+c(k,G,X,V[X]);t("WebGL error "+l(I)+" in "+k+"("+B+")")};var S={};function E(I,k){return function(){w&&w(k,arguments);var V=I[k].apply(I,arguments),B=T.getError();return B!=0&&(S[B]=!0,b(B,k,arguments)),V}}var M={};for(var A in _)if(typeof _[A]=="function")if(A!="getExtension")M[A]=E(_,A);else{var $=E(_,A);M[A]=function(){return f($.apply(_,arguments),b,w,T)}}else p(M,_,A);return M.getError=function(){for(var I in S)if(S.hasOwnProperty(I)&&S[I])return S[I]=!1,I;return _.NO_ERROR},M}function m(_){var b=_.getParameter(_.MAX_VERTEX_ATTRIBS),w=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,w);for(var T=0;T<b;++T)_.disableVertexAttribArray(T),_.vertexAttribPointer(T,4,_.FLOAT,!1,0,0),_.vertexAttrib1f(T,0);_.deleteBuffer(w);var S=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS);for(T=0;T<S;++T)_.activeTexture(_.TEXTURE0+T),_.bindTexture(_.TEXTURE_CUBE_MAP,null),_.bindTexture(_.TEXTURE_2D,null);for(_.activeTexture(_.TEXTURE0),_.useProgram(null),_.bindBuffer(_.ARRAY_BUFFER,null),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.disable(_.BLEND),_.disable(_.CULL_FACE),_.disable(_.DEPTH_TEST),_.disable(_.DITHER),_.disable(_.SCISSOR_TEST),_.blendColor(0,0,0,0),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.ONE,_.ZERO),_.clearColor(0,0,0,0),_.clearDepth(1),_.clearStencil(-1),_.colorMask(!0,!0,!0,!0),_.cullFace(_.BACK),_.depthFunc(_.LESS),_.depthMask(!0),_.depthRange(0,1),_.frontFace(_.CCW),_.hint(_.GENERATE_MIPMAP_HINT,_.DONT_CARE),_.lineWidth(1),_.pixelStorei(_.PACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,!1),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_.UNPACK_COLORSPACE_CONVERSION_WEBGL&&_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.BROWSER_DEFAULT_WEBGL),_.polygonOffset(0,0),_.sampleCoverage(1,!1),_.scissor(0,0,_.canvas.width,_.canvas.height),_.stencilFunc(_.ALWAYS,0,4294967295),_.stencilMask(4294967295),_.stencilOp(_.KEEP,_.KEEP,_.KEEP),_.viewport(0,0,_.canvas.width,_.canvas.height),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT|_.STENCIL_BUFFER_BIT);_.getError(););}function y(_){var b,w,T=[],S=[],E={},M=1,A=!1,$=[],I=0,k=0,V=!1,B=0,G={};function X(Y){return typeof Y=="function"?Y:function(ce){Y.handleEvent(ce)}}_.getContext=(w=_.getContext,function(){var Y=w.apply(_,arguments);if(Y instanceof WebGLRenderingContext){if(Y!=b){if(b)throw"got different context";E=ie(b=Y)}return E}return Y});var K=function(Y){T.push(X(Y))},re=function(Y){S.push(X(Y))};function q(Y){var ce=Y.addEventListener;Y.addEventListener=function(pe,ve,Se){switch(pe){case"webglcontextlost":K(ve);break;case"webglcontextrestored":re(ve);break;default:ce.apply(Y,arguments)}}}function L(){for(var Y=Object.keys(G),ce=0;ce<Y.length;++ce)delete G[Y]}function N(){++k,A||I==k&&_.loseContext()}function U(Y,ce){var pe=Y[ce];return function(){if(N(),!A)return pe.apply(Y,arguments)}}function W(){for(var Y=0;Y<$.length;++Y){var ce=$[Y];ce instanceof WebGLBuffer?b.deleteBuffer(ce):ce instanceof WebGLFramebuffer?b.deleteFramebuffer(ce):ce instanceof WebGLProgram?b.deleteProgram(ce):ce instanceof WebGLRenderbuffer?b.deleteRenderbuffer(ce):ce instanceof WebGLShader?b.deleteShader(ce):ce instanceof WebGLTexture&&b.deleteTexture(ce)}}function Z(Y){return{statusMessage:Y,preventDefault:function(){V=!0}}}return q(_),_.loseContext=function(){if(!A){for(A=!0,I=0,++M;b.getError(););L(),G[b.CONTEXT_LOST_WEBGL]=!0;var Y=Z("context lost"),ce=T.slice();setTimeout(function(){for(var pe=0;pe<ce.length;++pe)ce[pe](Y);B>=0&&setTimeout(function(){_.restoreContext()},B)},0)}},_.restoreContext=function(){A&&S.length&&setTimeout(function(){if(!V)throw"can not restore. webglcontestlost listener did not call event.preventDefault";W(),m(b),A=!1,k=0,V=!1;for(var Y=S.slice(),ce=Z("context restored"),pe=0;pe<Y.length;++pe)Y[pe](ce)},0)},_.loseContextInNCalls=function(Y){if(A)throw"You can not ask a lost contet to be lost";I=k+Y},_.getNumCalls=function(){return k},_.setRestoreTimeout=function(Y){B=Y},_;function ie(Y){for(var ce in Y)typeof Y[ce]=="function"?E[ce]=U(Y,ce):p(E,Y,ce);E.getError=function(){if(N(),!A)for(;xe=b.getError();)G[xe]=!0;for(var xe in G)if(G[xe])return delete G[xe],xe;return E.NO_ERROR};for(var pe=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],ve=0;ve<pe.length;++ve){var Se=pe[ve];E[Se]=function(xe){return function(){if(N(),A)return null;var ke=xe.apply(Y,arguments);return ke.__webglDebugContextLostId__=M,$.push(ke),ke}}(Y[Se])}var We=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(ve=0;ve<We.length;++ve)Se=We[ve],E[Se]=function(xe){return function(){return N(),A?null:xe.apply(Y,arguments)}}(E[Se]);var Ne=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(ve=0;ve<Ne.length;++ve)Se=Ne[ve],E[Se]=function(xe){return function(){return N(),!A&&xe.apply(Y,arguments)}}(E[Se]);return E.checkFramebufferStatus=function(xe){return function(){return N(),A?E.FRAMEBUFFER_UNSUPPORTED:xe.apply(Y,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(xe){return function(){return N(),A?-1:xe.apply(Y,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(xe){return function(){return N(),A?0:xe.apply(Y,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return A},E}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:y,resetToInitialState:m}}())!==void 0&&(Kpe.exports=Qpe);class JTt extends tL{constructor(t){var s,n,o,a,l;if(super(),this._rctx=t,!t.gl)return;if(t.type===Tt.WEBGL1)return void(this._result=!(!((s=t.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=t.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!(((o=t.capabilities.textureFloat)==null?void 0:o.textureFloat)&&((a=t.capabilities.colorBufferFloat)==null?void 0:a.textureFloat)&&((l=t.capabilities.colorBufferFloat)==null?void 0:l.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=t.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(t){const i=this._rctx,r=new Yr(i,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},{target:St.TEXTURE_2D,wrapMode:Pt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:kt.FLOAT,internalFormat:Mt.RGBA32F,samplingMode:nt.NEAREST,width:1,height:1}),s=Oi.createVertex(i,Xi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new lp(i,new Map([["a_pos",0]]),{geometry:[new Ca("a_pos",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:s});i.useProgram(t);const o=i.getBoundFramebufferObject(),{x:a,y:l,width:c,height:h}=i.getViewport();i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.bindVAO(n),i.drawArrays(Nt.TRIANGLE_STRIP,0,4);const p=Ht({blending:oCe});i.setPipelineState(p),i.drawArrays(Nt.TRIANGLE_STRIP,0,4),RY.init(i);const f=i.gl.getError();return i.setViewport(a,l,c,h),i.bindFramebuffer(o),n.dispose(!1),s.dispose(),r.dispose(),f!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}}class KTt extends tL{constructor(t){super(),this._rctx=t;const i=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,r=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=t.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(t){const i=this._rctx,r=new Yr(i,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},{target:St.TEXTURE_2D,wrapMode:Pt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1}),s=new Uint8Array(4),n=Oi.createVertex(i,Xi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new lp(i,new Map([["a_position",0]]),{geometry:[new Ca("a_position",2,dt.SHORT,0,4)]},{geometry:n});i.useProgram(t);const a=new pt(i,{target:St.TEXTURE_2D,wrapMode:Pt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));t.setUniform1i("u_texture",0),i.bindTexture(a,0);const l=i.getBoundFramebufferObject();i.bindFramebuffer(r),i.useProgram(t);const{x:c,y:h,width:p,height:f}=i.getViewport();i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Nt.TRIANGLE_STRIP,0,4),i.setViewport(c,h,p,f),r.readPixels(0,0,1,1,ze.RGBA,kt.UNSIGNED_BYTE,s),o.dispose(!1),n.dispose(),r.dispose();const m=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return m&&se.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),i.bindFramebuffer(l),m}}new Ca("a_pos",2,dt.BYTE,0,2);new Ca("a_pos",2,dt.BYTE,0,4),new Ca("a_tex",2,dt.BYTE,2,4);const QTt={geometry:[new Ca("a_pos",2,dt.UNSIGNED_SHORT,0,4)]};class eSt extends tL{constructor(t){super(),this._rctx=t,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=t.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(t){const i=this._rctx;if(!i.gl)return t.dispose(),!0;const r=new Yr(i,{colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.NONE},{target:St.TEXTURE_2D,wrapMode:Pt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,samplingMode:nt.NEAREST,width:1,height:1}),s=Oi.createVertex(i,Xi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new lp(i,new Map([["a_pos",0]]),QTt,{geometry:s}),o=new pt(i,{dataType:kt.UNSIGNED_BYTE,pixelFormat:ze.RGBA,preMultiplyAlpha:!1,wrapMode:Pt.CLAMP_TO_EDGE,samplingMode:nt.LINEAR},this._image);i.useProgram(t),i.bindTexture(o,0),t.setUniform1i("u_texture",0);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=i.getViewport();i.bindFramebuffer(r),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clearSafe(ts.COLOR_BUFFER_BIT),i.bindVAO(n),i.drawArrays(Nt.TRIANGLE_STRIP,0,4);const f=new Uint8Array(4);return r.readPixels(0,0,1,1,ze.RGBA,kt.UNSIGNED_BYTE,f),n.dispose(!1),s.dispose(),r.dispose(),o.dispose(),i.setViewport(l,c,h,p),i.bindFramebuffer(a),f[0]!==255}}class tSt{constructor(t){this.rctx=t,this.floatBufferBlend=new JTt(t),this.svgPremultipliesAlpha=new eSt(t),this.doublePrecisionRequiresObfuscation=new YTt(t),this.ignoresSamplerPrecision=new KTt(t),this.drawArraysRequiresIndicesTypeReset=new XTt(t)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}}function iSt(e,t){if(t.disjointTimerQuery)return null;if(qg(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function rSt(e){if(qg(e))return e;const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function sSt(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function nSt(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function oSt(e,t){if(qg(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function aSt(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function lSt(e,t){if(qg(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function cSt(e,t){if(qg(e)){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function UR(e,t,i,r,s){if(r&&qg(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function uSt(e,t){if(!qg(e)||t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function hSt(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function dSt(e,t){if(qg(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class pSt{constructor(t,i){this._gl=t,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=iSt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=rSt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=dSt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=sSt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=nSt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=aSt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=fTt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=lSt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=cSt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=oSt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=UR(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=UR(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=UR(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=UR(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=hSt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=uSt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=UR(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}let fSt=class{constructor(e,t){this.gl=e,this.instanceCounter=new bTt,this.programCache=new WTt(this),this._state=new Upe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=qg(e)?Tt.WEBGL2:Tt.WEBGL1,this._loadExtensions(),this.configure(t)}get gl2(){return this.type===Tt.WEBGL1?null:this.gl}configure(e){this._capabilities=new pSt(this.gl,e),this._parameters=this._loadParameters(e);const t=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Upe,this._state.viewport={x:t[0],y:t[1],width:t[2],height:t[3]},this._stateTracker=new NKe({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const r=i.color;this.setBlendColor(r.r,r.g,r.b,r.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const r=i.function;this.setStencilFunction(r.func,r.ref,r.mask);const s=i.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),rt(this._driverTest),this._driverTest=new tSt(this)}dispose(){rt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer($t.ARRAY_BUFFER),this.unbindBuffer($t.ELEMENT_ARRAY_BUFFER),this.type===Tt.WEBGL2&&(this.unbindBuffer($t.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer($t.PIXEL_PACK_BUFFER),this.unbindBuffer($t.PIXEL_UNPACK_BUFFER),this.unbindBuffer($t.COPY_READ_BUFFER),this.unbindBuffer($t.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,_h()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,t){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;t>=0&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,t,i,r){e===this._state.blendColor.r&&t===this._state.blendColor.g&&i===this._state.blendColor.b&&r===this._state.blendColor.a||(this.gl.blendColor(e,t,i,r),this._state.blendColor.r=e,this._state.blendColor.g=t,this._state.blendColor.b=i,this._state.blendColor.a=r,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._state.blendFunction.srcRGB&&t===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,t),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,i,r){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===t&&this._state.blendFunction.dstAlpha===r||(this.gl.blendFuncSeparate(e,t,i,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,i,r){this._state.colorMask.r===e&&this._state.colorMask.g===t&&this._state.colorMask.b===i&&this._state.colorMask.a===r||(this.gl.colorMask(e,t,i,r),this._state.colorMask.r=e,this._state.colorMask.g=t,this._state.colorMask.b=i,this._state.colorMask.a=r,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,i,r){this._state.clearColor.r===e&&this._state.clearColor.g===t&&this._state.clearColor.b===i&&this._state.clearColor.a===r||(this.gl.clearColor(e,t,i,r),this._state.clearColor.r=e,this._state.clearColor.g=t,this._state.clearColor.b=i,this._state.clearColor.a=r)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===t||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,t,i,r){this._state.scissorRect.x===e&&this._state.scissorRect.y===t&&this._state.scissorRect.width===i&&this._state.scissorRect.height===r||(this.gl.scissor(e,t,i,r),this._state.scissorRect.x=e,this._state.scissorRect.y=t,this._state.scissorRect.width=i,this._state.scissorRect.height=r)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===t||(this.gl.depthRange(e,t),this._state.depthRange.zNear=e,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,t,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===t&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,t,i),this._state.stencilFunction.face=xf.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,i,r){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFuncSeparate(e,t,i,r),this._state.stencilFunction.face=e,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,i){this._state.stencilOperation.face===xf.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===t&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,t,i),this._state.stencilOperation.face=xf.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,i,r){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOpSeparate(e,t,i,r),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const i=this._state.activeTexture;return e>=0&&(t||e!==this._state.activeTexture)&&(this.gl.activeTexture($B+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(e&ts.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&ts.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&ts.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,i){if(_h()&&(this._numOfDrawCalls++,this._numOfTriangles+=efe(e,i)),this.gl.drawArrays(e,t,i),_h()){const r=Lae(this);r&&console.error("drawArrays:",r)}}drawElements(e,t,i,r){var s;if(_h()&&(this._numOfDrawCalls++,this._numOfTriangles+=efe(e,t)),this.gl.drawElements(e,t,i,r),_h()){const n=Lae(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:t,type:i,offset:r},p=(s=Mn(a,y=>y.size))!=null?s:0,f=r+t,m=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}logInfo(){_h()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){_h()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,t,i,r){i=Math.max(Math.round(i),1),r=Math.max(Math.round(r),1);const s=this._state.viewport;s.x===e&&s.y===t&&s.width===i&&s.height===r||(s.x=e,s.y=t,s.width=i,s.height=r,this.gl.viewport(e,t,i,r))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var t,i;this._state.program!==e&&((t=this._state.program)==null||t.stop(),this._state.program=e,this.gl.useProgram((i=e==null?void 0:e.glName)!=null?i:null))}bindTexture(e,t,i=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const r=this._state.textureUnitMap[t];return C(e)||e.glName==null?(v(r)&&(this.setActiveTexture(t,i),this.gl.bindTexture(r.descriptor.target,null)),this._state.textureUnitMap[t]=null,r):i||r!==e?(this.setActiveTexture(t,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[t]=e,r):(e.isDirty&&(this.setActiveTexture(t,i),e.applyChanges()),r)}unbindTexture(e){if(!C(e))for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===e&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(e,t=!1){if(t||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(C(e))return this.gl.bindFramebuffer(zo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(zo.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,t,i=!1){const r=t===zo.READ_FRAMEBUFFER,s=r?this._state.readFramebuffer:this._state.drawFramebuffer;(i||s!==e)&&(C(e)?this.gl.bindFramebuffer(t,null):e.initializeAndBind(t),r?this._state.readFramebuffer=Ft(e,null):this._state.drawFramebuffer=Ft(e,null))}blitFramebuffer(e,t,i=0,r=0,s=e.width,n=e.height,o=0,a=0,l=t.width,c=t.height,h=ts.COLOR_BUFFER_BIT,p=nt.NEAREST){this.bindFramebufferSeparate(e,zo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(t,zo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,r,s,n,o,a,l,c,h,p)}bindBuffer(e,t){if(e)switch(t!=null||(t=e.bufferType),t){case $t.ARRAY_BUFFER:this._state.vertexBuffer=Yc(this.gl,e,t,this._state.vertexBuffer);break;case $t.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Yc(this.gl,e,t,this._state.indexBuffer);break;case $t.UNIFORM_BUFFER:this._state.uniformBuffer=Yc(this.gl,e,t,this._state.uniformBuffer);break;case $t.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Yc(this.gl,e,t,this._state.pixelPackBuffer);break;case $t.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Yc(this.gl,e,t,this._state.pixelUnpackBuffer);break;case $t.COPY_READ_BUFFER:this._state.copyReadBuffer=Yc(this.gl,e,t,this._state.copyReadBuffer);break;case $t.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Yc(this.gl,e,t,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,t){if(t>=this.parameters.maxUniformBufferBindings||t<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let r=i[t];return C(r)&&(r={buffer:null,offset:0,size:0},i[t]=r),r}bindBufferBase(e,t,i){const r=this._getBufferBinding(e,t);C(r)||r.buffer===i&&r.offset===0&&r.size===0||(this.gl.bindBufferBase(e,t,i?i.glName:null),r.buffer=i,r.offset=0,r.size=0)}bindBufferRange(e,t,i,r,s){const n=this._getBufferBinding(e,t);if(!C(n)&&!(n.buffer===i&&n.offset===r&&n.size===s)){if(r%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,t,i.glName,r,s),n.buffer=i,n.offset=r,n.size=s}}bindUBO(e,t,i,r){C(t)?this.bindBufferBase($t.UNIFORM_BUFFER,e,null):(_h()&&(r!=null?r:t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),i!==void 0&&r!==void 0?this.bindBufferRange($t.UNIFORM_BUFFER,e,t.buffer,i,r):this.bindBufferBase($t.UNIFORM_BUFFER,e,t.buffer))}unbindUBO(e){for(let t=0,i=this._state.uniformBufferBindingPoints.length;t<i;t++){const r=this._state.uniformBufferBindingPoints[t];v(r)&&r.buffer===e.buffer&&this.bindBufferBase($t.UNIFORM_BUFFER,t,null)}}unbindBuffer(e){switch(e){case $t.ARRAY_BUFFER:this._state.vertexBuffer=Yc(this.gl,null,e,this._state.vertexBuffer);break;case $t.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Yc(this.gl,null,e,this._state.indexBuffer);break;case $t.UNIFORM_BUFFER:this._state.uniformBuffer=Yc(this.gl,null,e,this._state.uniformBuffer);break;case $t.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Yc(this.gl,null,e,this._state.pixelPackBuffer);break;case $t.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Yc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case $t.COPY_READ_BUFFER:this._state.copyReadBuffer=Yc(this.gl,null,e,this._state.copyReadBuffer);break;case $t.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Yc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){C(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=10){const t=this.gl,i=t.fenceSync(lX.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let r;this.instanceCounter.increment(Co.Sync,i),t.flush();do await M0(e),r=t.clientWaitSync(i,0,0);while(r===mk.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Co.Sync,i),t.deleteSync(i),r===mk.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=zo.FRAMEBUFFER){return e===zo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer($t.ARRAY_BUFFER),this.unbindBuffer($t.ELEMENT_ARRAY_BUFFER),this.type===Tt.WEBGL2&&(this.unbindBuffer($t.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer($t.PIXEL_PACK_BUFFER),this.unbindBuffer($t.PIXEL_UNPACK_BUFFER),this.unbindBuffer($t.COPY_READ_BUFFER),this.unbindBuffer($t.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ce.ONE,Ce.ZERO),this.setBlendEquation(Ig.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(xf.BACK),this.setFrontFace(vA.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Zr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Zr.ALWAYS,0,0),this.setStencilOp(dn.KEEP,dn.KEEP,dn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,n,o,a,l,c;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:t,gl2:i}=this;for(let h=0;h<this.parameters.maxVertexAttributes;h++)t.disableVertexAttribArray(h);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer($t.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer($t.ELEMENT_ARRAY_BUFFER,null),v(i)){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer($t.UNIFORM_BUFFER,null);for(let h=0;h<this._parameters.maxUniformBufferBindings;h++){const p=this._state.uniformBufferBindingPoints[h];if(v(p)){const{buffer:f,offset:m,size:y}=p;f!==null?m===0&&y===0?i.bindBufferBase($t.UNIFORM_BUFFER,h,f.glName):i.bindBufferRange($t.UNIFORM_BUFFER,h,f.glName,m,y):i.bindBufferBase($t.UNIFORM_BUFFER,h,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer($t.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer($t.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer($t.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer($t.COPY_WRITE_BUFFER,null),i.bindFramebuffer(zo.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(zo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(fh.COLOR_ATTACHMENT0)),i.bindFramebuffer(zo.DRAW_FRAMEBUFFER,(n=(s=this._state.drawFramebuffer)==null?void 0:s.glName)!=null?n:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(zo.FRAMEBUFFER,(a=(o=this._state.drawFramebuffer)==null?void 0:o.glName)!=null?a:null);if(e&&this._state.vertexArrayObject){const h=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(h)}t.useProgram((c=(l=this._state.program)==null?void 0:l.glName)!=null?c:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let h=0;h<this.parameters.maxTextureImageUnits;h++){t.activeTexture($B+h),t.bindTexture(St.TEXTURE_2D,null),t.bindTexture(St.TEXTURE_CUBE_MAP,null),this.type===Tt.WEBGL2&&(t.bindTexture(St.TEXTURE_3D,null),t.bindTexture(St.TEXTURE_2D_ARRAY,null));const p=this._state.textureUnitMap[h];v(p)&&t.bindTexture(p.descriptor.target,p.glName)}t.activeTexture($B+this._state.activeTexture);const r=this._state.viewport;t.viewport(r.x,r.y,r.width,r.height),this.resetInfo()}_loadExtensions(){this.type===Tt.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){var o;const t=this.capabilities.textureFilterAnisotropic,i=(o=e.maxAnisotropy)!=null?o:1/0,r=this.type===Tt.WEBGL2,s=this.gl,n={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:t?Math.min(this.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY),i):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:r?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:r?s.getParameter(s.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:r?s.getParameter(s.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:r?s.getParameter(s.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:r?s.getParameter(s.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:r?s.getParameter(s.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:r?s.getParameter(s.MAX_SAMPLES):1};return pt.TEXTURE_UNIT_FOR_UPDATES=n.maxTextureImageUnits-1,n}};function Yc(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function efe(e,t){switch(e){case Nt.POINTS:return 2*t;case Nt.TRIANGLES:return t/3;case Nt.TRIANGLE_STRIP:case Nt.TRIANGLE_FAN:return t-2;default:return 0}}class mSt extends fSt{constructor(t,i,r){super(t,i),this.newCache=r,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(t,i,r,s){return this.useProgram(t.program),t.bindPipelineState(this,r==null?void 0:r.slot,!!s),t.program.bindPass(i,r),t.program}get test(){return this.programCache.test}}let yE=class extends Te{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ps,this._frameTask=e.view.resourceController.scheduler.registerTask(xt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(hn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return C(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(Z$,new ete)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),Ft(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",cn.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(C(t))return vt(t!==void 0),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new gSt(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),v(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,Ws(a)||se.getLogger(this.declaredClass).error(a),null);return Yh(s)?s.then(n,o):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",cn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],yE.prototype,"_loadingCount",void 0),u([d()],yE.prototype,"_frameTask",void 0),u([d()],yE.prototype,"updating",null),yE=u([P("esri.views.3d.webgl-engine.lib.TextureRepository")],yE);class gSt{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(se.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}let p3=class extends Te{constructor(){super(...arguments),this._passParameters=new ySt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=rt(this._passParameters.waveNormal),this._passParameters.wavePertubation=rt(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return _0.LOADING;if(v(this._passParameters.waveNormal)&&v(this._passParameters.wavePertubation))return _0.LOADED;const t={target:St.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:kt.UNSIGNED_BYTE,wrapMode:Pt.REPEAT,samplingMode:nt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,k0(Vi("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new pt(e,{...t,width:i.width,height:i.height},i)).catch(i=>se.getLogger(this.declaredClass).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,k0(Vi("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new pt(e,{...t,width:i.width,height:i.height},i)).catch(i=>se.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),_0.LOADING}};u([d()],p3.prototype,"_loading",void 0),u([d({type:Boolean,readOnly:!0})],p3.prototype,"updating",null),p3=u([P("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],p3);class ySt extends Rr{}const tfe=2048,_St=1.5,vSt=8;function bSt(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},o=Lte(e,t.padding),a=ASt(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=CSt(e,a),h=OSt(i),p=DSt[h];return{format:h,quality:ye(r!=null?r:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function wSt(e,t){const i=bSt(e,t),r=i.area,s=i.width/r.width,n=Lte(i,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],m=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function X7(e,t,i){const{ctx:r,canvas:s}=nOe(e,i),n=r.getImageData(0,0,e.width,e.height),o=TSt(s,t);return oOe(s),{dataUrl:o,data:n}}function Y7(e,t){const{ctx:i,canvas:r}=nOe(e,t),s=i.getImageData(0,0,e.width,e.height);return oOe(r),s}function nOe(e,t){const i=xSt();t.premultipliedAlpha&&PSt(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(e,0,0),t.flipY&&ISt(r),{ctx:r,canvas:i}}function oOe(e){e.width=0,e.height=0}function xSt(){return C(Z7)&&(Z7=document.createElement("canvas")),Z7}let Z7=null;function TSt(e,t){const i=$St[t.format],r=t.quality/100;return e.toDataURL(i,r)}function SSt(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,f=n/c,m=o/h,y=Math.ceil(f/2),_=Math.ceil(m/2),b=e.width;for(let w=0;w<h;w++)for(let T=0;T<c;T++){const S=4*(T+(a?h-w-1:w)*c);let E=0,M=0,A=0,$=0,I=0,k=0;const V=(w+.5)*m;for(let B=Math.floor(w*m);B<(w+1)*m;B++){const G=Math.abs(V-(B+.5))/_,X=(T+.5)*f,K=G*G;for(let re=Math.floor(T*f);re<(T+1)*f;re++){const q=Math.abs(X-(re+.5))/y,L=Math.sqrt(K+q*q);if(L>=1)continue;let N=2*L*L*L-3*L*L+1;const U=4*(r+re+(s+B)*b);k+=N*l[U+3],M+=N,!i&&l[U+3]<255&&(N=N*l[U+3]/255),A+=N*l[U],$+=N*l[U+1],I+=N*l[U+2],E+=N}}p[S]=A/E,p[S+1]=$/E,p[S+2]=I/E,p[S+3]=k/M}return t}function ESt(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,a=Lte(e,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=s-c,f=Math.min(vSt,Math.min((tfe-l)/h,(tfe-c)/p));return f<_St?e:{...e,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}}}function CSt(e,t){if(!e)return t;const i=e.width,r=e.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return t;const s=t.width/t.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function ASt(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(i.x=Math.floor(e.area.x)),e.area.y!=null&&(i.y=Math.floor(e.area.y));const r=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return MSt(RSt(i,e),t)}function MSt(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function RSt(e,t){if(!t||t.width==null||t.height==null)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const n=Math.floor(e.height*i);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}function Lte(e,t){return!t||e&&e.ignorePadding?FSt:t}function OSt(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return LSt}}function ISt(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function PSt(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s!==255&&s>0){const n=255/s;t[r+0]=t[r+0]*n,t[r+1]=t[r+1]*n,t[r+2]=t[r+2]*n}}}const $St={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},ife=98,LSt="png",DSt={png:100,jpg:ife,jpeg:ife},FSt={top:0,right:0,bottom:0,left:0};class NSt{constructor(t,i){this.viewCamera=t,this.frameHasDecorations=i}}class kSt{constructor(t,i,r,s){this._rctx=t,this._renderFunctions=i,this._forceCameraHook=r,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(t){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(cn.BACKGROUND);const i=B1();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*t.viewCamera.pixelRatio},n=this._renderScreenshot(t,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){t.width=i.width,t.height=i.height;const s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(t,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled({...t,resample:t.resample},i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=Qz(r,s,a);this._rctx.gl.readPixels(0,0,r,s,ze.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...t,region:void 0});const c=Qz(n.width,n.height,a);return SSt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){const{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=Qz(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,ze.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,i,r){let s=null,n=null;const o=t.viewCamera,{framebufferWidth:a,framebufferHeight:l}=i;let c=!1;const h=i.disableDecorations&&t.frameHasDecorations,p=a!==o.fullWidth||l!==o.fullHeight,f=i.ignorePadding&&o.pixelRatio!==i.pixelRatio,m=p||h||f||i.objectAndLayerIdColor;if(i.objectAndLayerIdColor&&(n=new Yr(this._rctx,{width:a,height:l,colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.DEPTH_STENCIL_RENDER_BUFFER})),m){const w=o.clone();if(i.ignorePadding){const E=y$(w.padding);for(let M=0;M<4;M++)E[M]=Math.round(E[M]/w.pixelRatio*i.pixelRatio);w.padding=E}w.fullWidth=a,w.fullHeight=l,w.pixelRatio=i.pixelRatio;const T=o.fovX-w.fovX,S=o.fovY-w.fovY;T<0&&T<S?w.fovX=o.fovX:S<0&&S<T&&(w.fovY=o.fovY),this._forceCameraHook(w),c=!0,s=new Yr(this._rctx,{width:w.fullWidth,height:w.fullHeight,colorTarget:Ls.TEXTURE,depthStencilTarget:Wi.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(s,n,w,i.disableDecorations?CT.OFF:CT.ON,r),this._disposeOffscreenBuffers()}const y=()=>{this._rctx.bindFramebuffer(null),rt(s)},_=this._readbackScreenshot(i,y);y();let b=null;if(i.objectAndLayerIdColor){const w=()=>{this._rctx.bindFramebuffer(null),rt(n)};this._rctx.bindFramebuffer(n),b=this._readbackScreenshot(i,w),this._rctx.bindFramebuffer(null),w()}if(m&&!this._rctx.contextAttributes.alpha)for(let w=3;w<_.data.length;w+=4)_.data[w]=255;if(b&&!this._rctx.contextAttributes.alpha)for(let w=3;w<b.data.length;w+=4)b.data[w]=255;return c&&this._forceCameraHook(o),[_,b]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}let ma=class extends Te{constructor(e){super({}),this.events=new ps,this.waterTextureRepository=new p3,this._magnifierHelper=new gE,this.objectAndLayerIdRenderHelper=he("enable-feature:objectAndLayerId-rendering")?new Pwt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),te(()=>{var i;return(i=this.waterTextureRepository)==null?void 0:i.updating},()=>this.requestRender(),st),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new rAe(this._rctx),this._shaderTechniqueRepository=new JCe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new yE(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",i=>this.requestRender(i)),this._materialRepository=new KCe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new uwt(this._rctx,this._shaderTechniqueRepository),this.renderer=new nh(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,i=>this.requestRender(i));const t={renderScene:(i,r,s,n,o)=>this.renderer.render(i,r,{camera:s,contentCamera:s,mode:Di.IDLE},n,o),requestRenderScene:i=>this.requestRender(i),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(i,r)=>e.options.screenshot.renderOverlay(i,r)};this._screenshotManager=new kSt(this._rctx,t,i=>this.events.emit("force-camera-for-screenshot",i),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=hs(this._frameTask),this._shaderTechniqueRepository=Be(this._shaderTechniqueRepository)}get performanceInfo(){const e=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=cn.UPDATE){this._needsRender=!0,e===cn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(t=>t[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,t,i,r,s,n=s){const o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(o);this.renderer.readDepthPixels(r,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=mwt(4*c,a,r.nearFar);l>h&&h!==r.nearFar[0]&&h!==r.nearFar[1]&&(l=h)}if(v(e)){const c=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);v(c)&&l>c&&c!==r.nearFar[0]&&c!==r.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(C(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}async reloadShaders(){XMe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const t=e.view.state;let i=!1,r=cn.BACKGROUND,s=!1;const n={preRender:({time:o})=>{i=this.updating,r=this._needsUpdate?cn.UPDATE:cn.BACKGROUND,e.commitSyncLayers();const a=o-this._lastAnimationUpdate;if(a>this.renderer.animationTimestep||v(t.forcedAnimationTime)||i||this._needsRender){const l=a/this.renderer.animationTimeDilation,c=new kEe(t.camera,l,t.forcedAnimationTime);this.renderer.updateAnimation(c)&&this.requestRender(cn.BACKGROUND),this._lastAnimationUpdate=o}},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,t,CT.ON,o),s=!0,a&&this.renderer.hasWaterReflection&&(this.requestRender(cn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{const a=new NSt(t.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(a,o)},finish:()=>{s&&(this.renderer.finish(t.mode===Di.IDLE?r:cn.UPDATE),s=!1)}};this._frameTask=GC(n)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},r=VKe("3d",this._canvas,i);if(C(r)){const n=he("esri-force-webgl");se.getLogger(this.declaredClass).error(n)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&se.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&he("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>t.view.resourceController.memoryController.newCache(s,n);return new mSt(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return v(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return C(this._componentObjectCollection)&&(this._componentObjectCollection=new ewt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],ma.prototype,"updating",null),u([d({autoDestroy:!0})],ma.prototype,"_rctx",void 0),u([d({autoDestroy:!0})],ma.prototype,"_container",void 0),u([d({autoDestroy:!0})],ma.prototype,"_canvas",void 0),u([d({autoDestroy:!0})],ma.prototype,"_stippleTextureRepository",void 0),u([d({autoDestroy:!0})],ma.prototype,"waterTextureRepository",void 0),u([d({autoDestroy:!0})],ma.prototype,"_magnifierHelper",void 0),u([d({readOnly:!0})],ma.prototype,"objectAndLayerIdRenderHelper",void 0),u([d({autoDestroy:!0})],ma.prototype,"_textureRepository",void 0),u([d({autoDestroy:!0})],ma.prototype,"_compositingHelper",void 0),u([d({autoDestroy:!0,readOnly:!0})],ma.prototype,"renderer",void 0),u([d({autoDestroy:!0})],ma.prototype,"_screenshotManager",void 0),u([d()],ma.prototype,"componentObjectCollection",null),u([d({autoDestroy:!0})],ma.prototype,"_componentObjectCollection",void 0),u([d()],ma.prototype,"_needsUpdate",void 0),u([d()],ma.prototype,"_needsWaterReflectionUpdate",void 0),ma=u([P("esri.views.3d.webgl-engine.parts.RenderView")],ma);let cu=class extends Te{constructor(e){super(e),this._handles=new Ii,this._model=new B4,this._layers=new ri,this._asyncChangeSet=new HX,this._syncChangeSet=new HX,this._layerSyncSet=new Set}initialize(){this._set("renderView",new ma(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(xt.STAGE,this),this._handles.add(this._frameTask)}destroy(){this._handles.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),Wk(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){C(e)||(this.renderView.requestRender(),this._model.remove(e),Wk(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){v(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){v(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e,t){C(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>C(i.glTexture)).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),t)))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const t=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const r=this._layerSyncSet.has(i.id)||i.updatePolicy===F1.SYNC,s=r?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(i.id,s),this._layerSyncSet.delete(i.id),s.empty||(this.renderer.modify(s,r?Hl:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Hl),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==F1.ASYNC||(t.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===F1.SYNC)&&(e.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Hl),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Hl),this.renderView.requestRender())}schedule(e,t){return this._frameTask.schedule(e,t)}reschedule(e,t){return this._frameTask.reschedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Hl))}addRenderPlugin(e,t,i){const r=this.renderer.renderPlugins.add(e,t,i),s=()=>{Ghe(t)&&this.view.sceneIntersectionHelper.addIntersectionHandler(t)};if(Yh(r))return r.then(s);s()}removeRenderPlugin(e){Ghe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(i=>i.type===t).length,model:e._model}}};cu.DebugSettings={endFrameContentValidation:!1},u([d({constructOnly:!0})],cu.prototype,"view",void 0),u([d({constructOnly:!0})],cu.prototype,"options",void 0),u([d({readOnly:!0})],cu.prototype,"viewingMode",null),u([d({constructOnly:!0})],cu.prototype,"container",void 0),u([d({constructOnly:!0})],cu.prototype,"_handles",void 0),u([d({readOnly:!0})],cu.prototype,"updating",null),u([d({constructOnly:!0})],cu.prototype,"_model",void 0),u([d({autoDestroy:!0})],cu.prototype,"renderView",void 0),u([d({readOnly:!0})],cu.prototype,"renderer",null),u([d({readOnly:!0})],cu.prototype,"running",null),cu=u([P("esri.views.3d.webgl-engine.Stage")],cu);class tIt extends m8{constructor(t,i,r,s){super(i,r),this.point=t,this.createGraphic=s}}function aOe(e){return Xf(e)&&e.intersector===Ss.PCL&&!!e.target}class iIt extends h2e{constructor(t,i,r,s,n){super(t),this.layerUid=t,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}}class rIt extends m8{constructor(t,i,r){super(i,null),this.point=t,this.createVoxelGraphic=r}}function BV(e){return Xf(e)&&e.intersector===Ss.I3S&&!!e.target}function lOe(e){return Xf(e)&&e.intersector===Ss.VOXEL&&!!e.target}function rfe(e,t){var i,r;return g8(e)||y8(e)?JP((i=e.target)==null?void 0:i.object.metadata,t):But(e)?(r=t.map)==null?void 0:r.ground:aOe(e)||BV(e)||yAe(e)||lOe(e)?JP(e.target,t):null}function sIt(e,t){const i=OY(e,t);return v(i)&&i.type==="graphic"?i.graphic:null}function OY(e,t){var i;if(C(e))return null;if(g8(e)||y8(e))return sfe((i=e.target)==null?void 0:i.object.metadata,t);if(aOe(e)){const r=e.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(lOe(e)){const r=e.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return yAe(e)||ote(e)?sfe(e.target,t):BV(e)?USt(e.target,t):null}function sfe(e,t){if(C(e)||C(e.graphicUid))return null;const i=JP(e,t);if(C(i))return null;if(i===t.graphics)return C(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||C(e.graphicUid)?null:"getHit"in r?r.getHit(e.graphicUid):null}function USt(e,t){const i=JP(e,t);if(C(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?BSt(r.getGraphicFromIntersectorTarget(e)):null}function VSt(e,t){const i=JP(e,t);if(C(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}function BSt(e){return v(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function JP(e,t){return!e||C(e.layerUid)?null:v(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function nIt(e,t){if(g8(e)||y8(e))return g0(e.target.object.boundingVolumeWorldSpace.bounds);if(ote(e)){U_e(ZF,e.transformation);const i=Math.max(ZF[0],ZF[1],ZF[2]);return e.target.baseBoundingSphere.radius*i}return BV(e)?Mn(VSt(e.target,t),i=>.5*Iye(i)):null}function oIt(e){return!g8(e)&&!y8(e)&&(ote(e)?e.target.numLodLevels>1:!!BV(e))}const ZF=O();async function zSt(e,t){var o;if(e.type==="2d")return e.hitTest(t);const i=await e.hitTest(t);if(i.results.length===0)return i;const r=i.results[0],s=((o=r.distance)!=null?o:0)*(1+GSt),n=i.results.findIndex(a=>{var l;return((l=a.distance)!=null?l:0)>s});return n!==-1&&(i.results=i.results.slice(0,n)),i}const GSt=.05;let J7,K7;function jSt(e){const t=mSe(e);for(;t.length>1;){const i=nfe(t.shift());if(i.available)return i}return nfe(t.shift())}function nfe(e){switch(e){case Tt.WEBGL1:return HSt();case Tt.WEBGL2:return qSt()}}function HSt(){return J7||(J7=YSt()),J7}function qSt(){return K7||(K7=ZSt()),K7}class cOe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class WSt extends cOe{constructor(){super(...arguments),this.type=Tt.WEBGL1}}class XSt extends cOe{constructor(){super(...arguments),this.type=Tt.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function uOe(e,t){var n;if(e===Tt.WEBGL1&&typeof WebGLRenderingContext=="undefined"||e===Tt.WEBGL2&&typeof WebGL2RenderingContext=="undefined")return null;const i=document.createElement("canvas");if(!i)return null;let r=gk(i,e,{failIfMajorPerformanceCaveat:!0});if(C(r)&&(r=gk(i,e),v(r)&&(t.majorPerformanceCaveat=!0)),C(r))return r;if(e===Tt.WEBGL1){const o=(n=r.getParameter(r.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),r}function YSt(){const e=new WSt,t=uOe(Tt.WEBGL1,e);return C(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function ZSt(){const e=new XSt,t=uOe(Tt.WEBGL2,e);return C(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function JSt(e){const t=jSt(e);if(!t.available)return new H("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new H("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new H("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new H("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===Tt.WEBGL1){if(!t.supportsElementIndexUint)return new H("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new H("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new H("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function KSt(e){return e&&"nodeType"in e}function QSt(e){return e&&typeof e.render=="function"}const ofe={component:"esri-component"};let ax=class extends Te{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(ofe.component),t&&t.classList.remove(ofe.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||KSt(e)?(this._set("widget",null),MU(e)):(QSt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],ax.prototype,"id",null),u([d()],ax.prototype,"node",null),u([Zt("node")],ax.prototype,"castNode",null),u([d({readOnly:!0})],ax.prototype,"widget",void 0),ax=u([P("esri.views.ui.Component")],ax);const q4=ax,e2t={left:0,top:0,bottom:0,right:0},hOe={bottom:30,top:15,right:15,left:15},Q7="manual",gy="esri-ui",dc={ui:gy,corner:`${gy}-corner`,innerContainer:`${gy}-inner-container`,manualContainer:`${gy}-manual-container`,cornerContainer:`${gy}-corner-container`,topLeft:`${gy}-top-left`,topRight:`${gy}-top-right`,bottomLeft:`${gy}-bottom-left`,bottomRight:`${gy}-bottom-right`};function t2t(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function eG(e){const t=e,i=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(i===null||i===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function tG(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let km=class extends ps.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=Xd(),this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&tG(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&tG(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([te(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,st),te(()=>this.padding,this._applyUIPadding,st),te(()=>[this.container,this._locale],([e,t])=>{e&&e.setAttribute("lang",t)},st),BZ(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(dc.ui),YHe(e),this._attachContainers(e)),t&&(t.classList.remove(dc.ui),tG(t,{top:"",bottom:"",left:"",right:""}),J1e(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...hOe,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=eG(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,i)=>t.concat(i)):(e=e||Q7)===Q7?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(dc.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i;const r=eG(e)||eG(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof q4||(e=new q4({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof q4?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||e2t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(dc.innerContainer),e.classList.add(dc.cornerContainer);const t=document.createElement("div");t.classList.add(dc.innerContainer),t.classList.add(dc.manualContainer);const i=document.createElement("div");i.classList.add(dc.topLeft),i.classList.add(dc.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(dc.topRight),r.classList.add(dc.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(dc.bottomLeft),s.classList.add(dc.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(dc.bottomRight),n.classList.add(dc.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=og();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||Q7,r=e.index,s=this._positionNameToContainerLookup[i],n=r!=null&&r>-1;if(t2t(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(r===0)return void(s.firstChild?une(t.node,s.firstChild):s.appendChild(t.node));r>=o.length?s.appendChild(t.node):une(t.node,o[r])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some(r=>(t=r===e,t&&(i=r),t)),i}_findById(e){let t,i=null;return this._components.some(r=>(t=r.id===e,t&&(i=r),t)),i}_findByNode(e){let t,i=null;return this._components.some(r=>(t=r.node===e,t&&(i=r),t)),i}};u([d()],km.prototype,"_locale",void 0),u([d()],km.prototype,"container",null),u([d()],km.prototype,"height",null),u([d({value:hOe})],km.prototype,"padding",null),u([Zt("padding")],km.prototype,"castPadding",null),u([d()],km.prototype,"view",void 0),u([d()],km.prototype,"width",null),km=u([P("esri.views.ui.UI")],km);const i2t=km;function afe(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function r2t(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function JF(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function s2t(e){return e.type==="bing-maps"}const Y_=[];let _E=class extends BI{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Qe,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>te(()=>{var s;return[r.suspended,(s=r.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.handles.add([Fs(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Qo(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,t=e==null?void 0:e.allLayerViews;Y_.length=0,e&&t?(t.forEach(i=>{var n;if(i.suspended||!((n=i.layer)!=null&&n.attributionVisible))return;const r=i.layer;if(afe(r,"user"))return void JF(Y_,i,r.copyright);if(r.hasAttributionData){if(this._fetchedAttributionData.has(i)){const o=this._fetchedAttributionData.get(i);return void(o?JF(Y_,i,this._getDynamicAttribution(o,e,r)):afe(r)&&JF(Y_,i,r.copyright))}return void this._fetchAttributionData(i)}const s=r.get("portalItem.accessInformation");JF(Y_,i,s||r.copyright)}),r2t(this.items,Y_)&&(this.items.removeAll(),this.items.addMany(Y_)),Y_.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await kf(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,s2t(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:et.WGS84},f={extent:dg(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)r[m]=r[m]||[],r[m].push(f)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){var c,h,p;const{extent:r,scale:s}=t;let n=(h=(c=i.tileInfo)==null?void 0:c.scaleToZoom(s))!=null?h:0;if(n=Math.min((p=e.maxKey)!=null?p:0,Math.round(n)),!r||n==null||n<=-1)return"";const o=e[n],a=YT(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(f=>{const m=f.id,y=!l[m]&&a&&f.extent&&MZ(f.extent,a);return y&&(l[m]=!0),y}).sort((f,m)=>m.score-f.score||f.objectId-m.objectId).map(f=>f.attribution).join(", "):""}};u([d({readOnly:!0,type:Qe})],_E.prototype,"items",void 0),u([d({readOnly:!0})],_E.prototype,"state",null),u([d()],_E.prototype,"view",void 0),_E=u([P("esri.widgets.Attribution.AttributionViewModel")],_E);const dOe=_E,x2="esri-attribution",Z_={base:`${x2} esri-widget`,poweredBy:`${x2}__powered-by`,sources:`${x2}__sources`,open:`${x2}--open`,sourcesOpen:`${x2}__sources--open`,link:`${x2}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let xc=class extends pn{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.iconClass=Z_.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new dOe}initialize(){this.addHandles(Fs(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Z_.open]:this._isOpen};return D("div",{bind:this,class:this.classes(Z_.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return D("div",{class:Z_.poweredBy},"Powered by"," ",D("a",{class:Z_.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?"0":"",{attributionText:r}=this,s={[Z_.sourcesOpen]:e,[Z_.interactive]:t};return D("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Z_.sources,s),innerHTML:r,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],xc.prototype,"_isOpen",void 0),u([d()],xc.prototype,"_isInteractive",null),u([d()],xc.prototype,"_attributionTextOverflowed",void 0),u([d()],xc.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],xc.prototype,"attributionText",null),u([d()],xc.prototype,"iconClass",void 0),u([d()],xc.prototype,"itemDelimiter",void 0),u([d()],xc.prototype,"label",null),u([d(),Es("esri/widgets/Attribution/t9n/Attribution")],xc.prototype,"messages",void 0),u([d()],xc.prototype,"view",null),u([d({type:dOe})],xc.prototype,"viewModel",void 0),u([ln()],xc.prototype,"_toggleState",null),xc=u([P("esri.widgets.Attribution")],xc);const n2t=xc,o2t="esri.widgets.CompassViewModel";let lx=class extends t8(Te){constructor(e){super(e),this._handles=new Ii,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(te(()=>this.view,this._updateRotationWatcher,st))}destroy(){hs(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var t;if(!this.get("view.ready"))return;const e={};((t=this.view)==null?void 0:t.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?te(()=>e==null?void 0:e.rotation,this._updateForRotation,st):te(()=>e==null?void 0:e.camera,this._updateForCamera,st))}};u([d({readOnly:!0})],lx.prototype,"canShowNorth",null),u([d()],lx.prototype,"orientation",void 0),u([d({readOnly:!0})],lx.prototype,"state",null),u([d()],lx.prototype,"view",void 0),lx=u([P(o2t)],lx);const pOe=lx,J_={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Um=class extends pn{constructor(e,t){super(e,t),this.iconClass=J_.widgetIcon,this.messages=null,this.viewModel=new pOe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i=t==="disabled",r=(t==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,n={[J_.disabled]:i,[J_.interactive]:!i},o={[J_.northIcon]:r,[J_.rotationIcon]:!r},{messages:a}=this;return D("div",{bind:this,class:this.classes(J_.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},D("span",{"aria-hidden":"true",class:this.classes(J_.icon,o),styles:this._toRotationTransform(e)}),D("span",{class:J_.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([d()],Um.prototype,"goToOverride",null),u([d()],Um.prototype,"iconClass",void 0),u([d()],Um.prototype,"label",null),u([d(),Es("esri/widgets/Compass/t9n/Compass")],Um.prototype,"messages",void 0),u([d()],Um.prototype,"view",null),u([d({type:pOe})],Um.prototype,"viewModel",void 0),u([ln()],Um.prototype,"_reset",null),Um=u([P("esri.widgets.Compass")],Um);const a2t=Um,T2="esri-navigation-toggle",hd={base:`${T2} esri-widget`,button:`${T2}__button esri-widget--button`,activeButton:`${T2}__button--active`,panButton:`${T2}__button--pan`,rotateButton:`${T2}__button--rotate`,isLayoutHorizontal:`${T2}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let vE=class extends Te{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(Qo(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],vE.prototype,"state",null),u([d()],vE.prototype,"navigationMode",void 0),u([d()],vE.prototype,"view",void 0),vE=u([P("esri.widgets.NavigationToggleViewModel")],vE);const fOe=vE;let Vm=class extends pn{constructor(e,t){super(e,t),this.iconClass=hd.widgetIcon,this.messages=null,this.viewModel=new fOe}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",i={[hd.disabled]:e,[hd.isLayoutHorizontal]:this.layout==="horizontal"},r={[hd.activeButton]:t},s={[hd.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return D("div",{bind:this,class:this.classes(hd.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},D("div",{class:this.classes(hd.button,hd.panButton,r)},D("span",{class:hd.panIcon})),D("div",{class:this.classes(hd.button,hd.rotateButton,s)},D("span",{class:hd.rotationIcon})))}_toggle(){this.toggle()}};u([d()],Vm.prototype,"iconClass",void 0),u([d()],Vm.prototype,"label",null),u([d({value:"vertical"})],Vm.prototype,"layout",null),u([d(),Es("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Vm.prototype,"messages",void 0),u([d()],Vm.prototype,"view",null),u([d({type:fOe})],Vm.prototype,"viewModel",void 0),u([ln()],Vm.prototype,"_toggle",null),Vm=u([P("esri.widgets.NavigationToggle")],Vm);const l2t=Vm,VR={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Rv=class extends pn{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[VR.disabled]:!this.enabled,[VR.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return D("div",{bind:this,class:this.classes(VR.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},D("span",{"aria-hidden":"true",role:"presentation",class:this.classes(VR.icon,i)}),D("span",{class:VR.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],Rv.prototype,"action",void 0),u([d()],Rv.prototype,"enabled",void 0),u([d()],Rv.prototype,"iconClass",void 0),u([d()],Rv.prototype,"title",void 0),u([ln()],Rv.prototype,"_triggerAction",null),Rv=u([P("esri.widgets.IconButton")],Rv);const lfe=Rv;let bE=class extends Te{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([d({readOnly:!0})],bE.prototype,"canZoomIn",null),u([d({readOnly:!0})],bE.prototype,"canZoomOut",null),u([d()],bE.prototype,"view",void 0),bE=u([P("esri.widgets.Zoom.ZoomConditions2D")],bE);const c2t=bE;let wE=class extends Te{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],wE.prototype,"canZoomIn",null),u([d({readOnly:!0})],wE.prototype,"canZoomOut",null),u([d()],wE.prototype,"view",void 0),wE=u([P("esri.widgets.Zoom.ZoomConditions3D")],wE);const u2t=wE;let Ov=class extends Te{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return v(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return v(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new c2t({view:e}):e.type==="3d"&&(this._zoomConditions=new u2t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():rC(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():rC(e.goTo({zoomFactor:.5}))}};u([d()],Ov.prototype,"_zoomConditions",void 0),u([d()],Ov.prototype,"canZoomIn",null),u([d()],Ov.prototype,"canZoomOut",null),u([d({readOnly:!0})],Ov.prototype,"state",null),u([d()],Ov.prototype,"view",null),Ov=u([P("esri.widgets.Zoom.ZoomViewModel")],Ov);const mOe=Ov,BR={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let Hy=class extends pn{constructor(e,t){super(e,t),this.iconClass=BR.widgetIcon,this.messages=null,this.viewModel=new mOe}initialize(){this._zoomInButton=new lfe({action:this.zoomIn.bind(this),iconClass:BR.zoomInIcon}),this._zoomOutButton=new lfe({action:this.zoomOut.bind(this),iconClass:BR.zoomOutIcon})}destroy(){this._zoomInButton=Be(this._zoomInButton),this._zoomOutButton=Be(this._zoomOutButton)}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,t={[BR.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=r;const{zoomIn:s,zoomOut:n}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=n,D("div",{class:this.classes(BR.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],Hy.prototype,"iconClass",void 0),u([d()],Hy.prototype,"label",null),u([d({value:"vertical"})],Hy.prototype,"layout",null),u([d(),Es("esri/widgets/Zoom/t9n/Zoom")],Hy.prototype,"messages",void 0),u([d()],Hy.prototype,"view",null),u([d({type:mOe})],Hy.prototype,"viewModel",void 0),Hy=u([P("esri.widgets.Zoom")],Hy);const h2t=Hy;function d2t(e){return e&&e.view!==void 0}let W4=class extends i2t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this.addHandles([te(()=>this.components,this._componentsWatcher.bind(this),st),te(()=>this.view,this._updateViewAwareWidgets.bind(this),st)])}_add(e,t,i,r){let s=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;s=this._createComponent(e)}super._add(s,t,i,r)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const i=this._find(t),r=i&&i.widget;d2t(r)&&(r.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.constructed&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new q4({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new n2t({view:this.view})}_createCompass(){return new a2t({view:this.view})}_createNavigationToggle(){return new l2t({view:this.view})}_createZoom(){return new h2t({view:this.view})}};u([d()],W4.prototype,"components",void 0),W4=u([P("esri.views.ui.DefaultUI")],W4);const p2t=W4;let X4=class extends p2t{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],X4.prototype,"components",void 0),X4=u([P("esri.views.ui.3d.DefaultUI3D")],X4);const gOe=X4;let ht=class extends c7e(PZe(XZe(bJe))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._lostWebGLContextHandle=null,this._resolveWhenReady=[],this._propertiesPool=new L0({slicePlane:Obe},this),this._resourceController=Qyt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new UX({view:this}),this.labeler=new tx({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new pA,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new xx,this.environmentManager=new Wp,this.floors=new Qe,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new xJe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new byt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new gOe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new rY,this.voxelWasm=null,this.voxelWasmPromise=null,k5e(),e&&e.environment||(this._defaults.environment=new aE,this.environment=this._defaults.environment);const t=(i=null)=>{v(i)&&i.type===Ir.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([Fs(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),te(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new Rot({view:this}),this.stateManager=new qn({view:this})}initialize(){this.groundView=new WZe({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(Fs(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},st),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},st),this.updatingHandles.add(()=>{var t;return(t=this.qualitySettings.frameRate)!=null?t:0},t=>$Pe(t>0?1e3/Math.ceil(t):0),st),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,Gs),this.updatingHandles.add(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),Gs),this.handles.add(te(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),hr))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Be(this.sharedSymbolResources),this._set("labeler",Be(this.labeler)),this._set("deconflictor",Be(this.deconflictor)),this._resourceController=Be(this._resourceController),this._set("stateManager",Be(this.stateManager)),this._set("inputManager",Be(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",Be(this.environmentManager)),this.groundView=Be(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}get animation(){var e;return(e=this.state)==null?void 0:e.animation}get camera(){var e;return(e=this.stateManager)==null?void 0:e.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){var e;return(e=this.stateManager)==null?void 0:e.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get center(){var e;return(e=this.stateManager)==null?void 0:e.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){var t;if(this.viewingMode==="global")return null;let e=this._userClippingArea||("clippingArea"in this.map?(t=this.map)==null?void 0:t.clippingArea:void 0);return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||C(e)?(this._clippingArea=null,null):e instanceof Gi?this.spatialReference&&(e=KF(e,this.spatialReference),C(e))?(se.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),C(e.intersection(this._groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(se.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&v(e)?se.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===je.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return C(t)||C(e)||t.spatialReference.equals(e)?t:KF(t,e)}get dataExtent(){let e=this._groundAndLayersExtent;const t=this.spatialReference||et.WGS84,i=KF(this.clippingArea,t);v(i)&&(e=v(e)?e.intersection(i):i);const r=this._get("dataExtent");return v(e)&&e.equals(r)?r:e}get _groundAndLayersExtent(){var n,o;const e=this.spatialReference||et.WGS84;let t;const i=a=>{const l=KF(a,e);C(l)||(v(t)?t.union(l):t=l.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const a=r.groundExtent;i(new Gi({xmin:a[0],ymin:a[1],zmin:0,xmax:a[2],ymax:a[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const a=l=>{!v(l.fullExtent)||l.type==="graphics"&&l.internal||i(l.fullExtent)};this.map.allLayers.forEach(l=>a(l))}if(C(t))return null;t.hasZ?(t.zmin=Math.min(0,(n=t.zmin)!=null?n:0),t.zmax=Math.max(0,(o=t.zmax)!=null?o:0)):(t.zmin=0,t.zmax=0);const s=this._get("_groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof aE?e:e instanceof XTe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):aE.fromWebsceneEnvironment(e):zr(aE,e):new aE}get extent(){var e;return(e=this.stateManager)==null?void 0:e.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){var e;return(e=this.stateManager)==null?void 0:e.screenCenter}get frustum(){var e;return(e=this.stateManager)==null?void 0:e.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||v(this.activeTool)&&this.activeTool.visible}get stationary(){return!this.animation&&!this.resizing&&(C(this.state)||this.state.stationary)}get navigating(){var e,t;return(t=(e=this.state)==null?void 0:e.navigating)!=null?t:!1}get padding(){var e;return(e=this.stateManager)==null?void 0:e.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){$4.isValidProfile(e)&&($4.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||$4.getDefaultProfile()}set slicePlane(e){if(v(this._stage)&&this._stage.renderer.setParameters({slicePlane:e}),C(e))return void this._set("slicePlane",null);const t=this._propertiesPool.get("slicePlane");oS(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Hbe(this.scale,this.spatialReference):0}get scale(){var e;return(e=this.stateManager)==null?void 0:e.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?cM.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var s,n,o;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(t=!0,a.suspended||GP(a))return;++i,e+=a.updatingProgress}}else++i});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])v(a)&&a.updating&&(i+=.1,e+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])v(a)&&a.updating&&(++i,e+=a.updatingProgress);const r=this.stateManager.test.updatingIgnoreRenderState?Di.IDLE:this.state.mode;if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r!==Di.IDLE||this._createGraphicsViewController||((s=this.inputManager)==null?void 0:s.hasPendingInputs)||((o=(n=this.map)==null?void 0:n.allLayers)==null?void 0:o.some(a=>!a.isFulfilled()))),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const a=performance.now();if(e<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-l)+e*l}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?a:0}return t}get viewingMode(){var i;const e=this._predeterminedViewingMode;if(v(e))return H3(e);const t=this.spatialReference;return t?v((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?H3(this.defaultsFromMap.viewingMode):AP(t,je.Global)?"global":"local":"global"}set viewingMode(e){this.ready?se.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){var e;return(e=this.stateManager)==null?void 0:e.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get resourceController(){return this._resourceController}get performanceInfo(){return new S0t(this)}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return se.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=v(i.graphics)&&(v(i.graphics.include)||v(i.graphics.exclude)),s=pae(e)?dae(this,e):e,n=Km(s);i.enableDraped=i.include&&!i.include.has(Jv)||i.exclude&&i.exclude.has(Jv);const o=this.sceneIntersectionHelper,a=dp(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?Aa.ALL:Aa.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=OY(l,this);if(C(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return se.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=Ft(e.z==null?ag(this.elevationProvider,e):null,0);return Xa(e,S2,this.renderSpatialReference,t),this.state.camera.projectToScreen(S2,iG),ip(iG[0],iG[1])}pixelSizeAt(e){return this.ready?e?(Xa(e,S2,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(S2)):0:(se.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return se.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=pae(e)?dae(this,e):e,r=$s(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=dp(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=Aa.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=rfe(a,this),c=v(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Xf(a)?a.distanceInRenderSpace:0,layer:c}};return cr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:i}=await zSt(this,e);let r=null;return!(t.length===0||Math.abs(Ft(t[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(C(e.parent))throw new H("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return X7(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return Y7(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(t);return[Y7(i[0],this._pixelFormat()),Y7(i[1],this._pixelFormat())]}_completeSettings(e){const t=wSt(e,this);return t.pixelRatio/=this.state.pixelRatio,ESt(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e),takeScreenshotWithObjectAndLayerId:e=>this._takeScreenshotWithObjectAndLayerId(e)}}async takeScreenshotWithObjectAndLayerId(e){if(!he("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(t),r=X7(i[0],t,this._pixelFormat()),s=this._completeSettings(e);return s.format="png",[r,X7(i[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(C(this._stage.renderView.objectAndLayerIdRenderHelper))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return wae.importLayerView(e)}hasLayerViewModule(e){return wae.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=JSt(this.type);const t=he("safari");if(t&&t<9&&(e=new H("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:t})),v(e))throw se.getLogger(this.declaredClass).warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,i;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(i=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?i:null;return v(e)?_ae(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(v(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,je.Local),s=this._validateSpatialReferenceForViewingMode(e,t,je.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,je.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,je.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!AP(e,i)&&(!!C(t)||!!hre(t)||(!lC(t)||!C(fV(t,e,i)))&&(!ure(t)||i!==je.Global))}_makeSpatialReferenceConstraints(e,t,i){if(C(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return hre(t)&&(r||s)?!s||i===je.Local||jP(t.tileInfo,t.fullExtent,e,je.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:et.WebMercator,viewingMode:i}]:[{spatialReference:r?et.WGS84:et.WebMercator,viewingMode:i}]:lC(t)||ure(t)||!r&&!s?lC(t)&&r&&i!==je.Global?[{spatialReference:e,viewingMode:i},{spatialReference:et.WGS84,viewingMode:je.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?et.WGS84:et.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=v(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(v(i)?se.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${H3(i)} viewing mode.`):e.isGeographic&&se.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||et.WGS84;return Zo(e,this.renderSpatialReference,e,i)||(i=et.WGS84,Zo(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new ut(e,i),t}trackGraphicState(e){if(!e.graphic)return se.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=n=>{var o;!r&&v(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return v(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,v(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return BC(e.map(i=>this.highlight(i)));if(Qe.isCollection(e))return BC(e.toArray().map(i=>this.highlight(i)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Df()}maskOccludee(e){if(!e)return se.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=n=>{!r&&v(n)&&SZe(n)&&(i=n.maskOccludee(e))};return v(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,v(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){v(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await I0(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new H("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,gI.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,gI.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(S2)?(t=this.computeMapPointFromVec3d(S2,t),e.intersector===Ss.TERRAIN&&this.basemapTerrain&&(t.z=Ft(ag(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=rfe(n,this);if(v(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=OY(n,this);if(C(a))continue;if(a.type==="graphic"){if(C(r)&&s!==e.length-1&&(r=new Set),v(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push({...a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(e){var s,n;const t=e.sourceLayer,i=e.layer,r=t&&"objectIdField"in t?t:i&&"objectIdField"in i?i:t;if(r){const o=(s=r.objectIdField)!=null?s:qbe,a=(n=e.attributes)==null?void 0:n[o];if(a)return`o-${r.id}-${a}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return C(e)||(C(e.include)||e.include.has(i))&&(C(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:void 0,graphicUids:void 0}){if(!e)return i;if(e instanceof Ko)f2t(i,this._getGraphicFilterUid(e)),t===gI.INCLUDE&&(v(this.graphicsView)&&e.layer===this?zR(i,this.graphicsView.processor.layer.id):e.layer&&zR(i,e.layer.uid));else if(RG(e))for(const r of e)r===this.graphics&&v(this.graphicsView)?zR(i,this.graphicsView.processor.layer.id):r===this.map.ground?zR(i,Jv):this._externalToInternalRenderItems(r,t,i);else"uid"in e&&zR(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new I1t({view:this})),this._set("elevationProvider",new o3({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Ec({view:this})),this._set("featureTiles",new ya({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var i;const t=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const r=v(this.basemapTerrain.extent)&&v(this.basemapTerrain.spatialReference)?fM(G6(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;v(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>cr.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(Q(()=>import("./FeatureTileTree3DDebugger.3cd304a3.js"),["assets/FeatureTileTree3DDebugger.3cd304a3.js","assets/TileTreeDebugger.fbb18468.js"])).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&cr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):t||!this._featureTreeDebugger||cr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Gs),this.updatingHandles.add(()=>this.clippingArea,e,Gs),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Gs)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Fyt(this.map,e));const t=this.state.isGlobal,i=jbe(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",r6.create(this.state.viewingMode,i)),t||this.handles.add(te(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;v(r)&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&CU(r,this.basemapTerrain.spatialReference,cfe,s)&&(this.renderCoordsHelper.extent=cfe)},hr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(PA/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){v(e)&&e.type===Ir.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(te(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),hr),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},t=new wyt(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",t);const i=MU(this.surface);this._stage=new cu({view:this,options:e,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=a$(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new H("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),st),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),st),te(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,Gs),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()})],"stage");const r=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:rY.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],r),"stage"),r(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(PA/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Be(this._stage),this._lostWebGLContextHandle=hs(this._lostWebGLContextHandle),this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new A0t({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await Q(()=>import("./GraphicsView3D.d98ae279.js"),["assets/GraphicsView3D.d98ae279.js","assets/GraphicsProcessor.dcdbca5b.js","assets/Graphics3DObjectStates.00695ba4.js","assets/rendererConversion.bf1e92f2.js","assets/optimizedFeatureQueryEngineAdapter.04eb7bfe.js","assets/centroid.bfde938e.js","assets/PooledRBush.53bd9abe.js","assets/quickselect.2c5f2780.js"])).default;ii(e),await I0(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),v(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=_ae(this.viewingMode);if(e===je.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(Fs(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Jv);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Jv);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultHitTestOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return C(this.voxelWasm)?(C(this.voxelWasmPromise)&&(this.voxelWasmPromise=Q(()=>import("./VoxelWasmPerSceneView.56997369.js"),[]).then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){v(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function zR(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function f2t(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function KF(e,t){return v(e)&&q1(e.spatialReference,t)?fM(e,t):null}var gI;ht.type="3d",u([d()],ht.prototype,"_userClippingArea",void 0),u([d()],ht.prototype,"_resourceController",void 0),u([d()],ht.prototype,"_stage",void 0),u([d({readOnly:!0})],ht.prototype,"deconflictor",void 0),u([d({readOnly:!0})],ht.prototype,"labeler",void 0),u([d(fW(pA,"analyses"))],ht.prototype,"analyses",void 0),u([d({type:yA,readOnly:!0})],ht.prototype,"animation",null),u([d({readOnly:!0})],ht.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],ht.prototype,"elevationProvider",void 0),u([d()],ht.prototype,"camera",null),u([d({type:op})],ht.prototype,"contentCamera",null),u([d({readOnly:!0})],ht.prototype,"canvas",void 0),u([d({type:ut})],ht.prototype,"center",null),u([d({type:Gi})],ht.prototype,"clippingArea",null),u([d({type:xx})],ht.prototype,"constraints",void 0),u([d({type:Gi,readOnly:!0})],ht.prototype,"renderDataExtent",null),u([d({type:Gi,readOnly:!0})],ht.prototype,"dataExtent",null),u([d({type:Gi,readOnly:!0})],ht.prototype,"_groundAndLayersExtent",null),u([d({value:null,type:aE})],ht.prototype,"environment",null),u([Zt("environment")],ht.prototype,"castEnvironment",null),u([d({readOnly:!0})],ht.prototype,"environmentManager",void 0),u([d({type:Gi})],ht.prototype,"extent",null),u([d()],ht.prototype,"floors",void 0),u([d()],ht.prototype,"screenCenter",null),u([d()],ht.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],ht.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],ht.prototype,"graphicsView",void 0),u([d({readOnly:!0})],ht.prototype,"analysisViewManager",void 0),u([d()],ht.prototype,"groundView",void 0),u([d({type:Boolean})],ht.prototype,"initialExtentRequired",null),u([d()],ht.prototype,"_defaultsFromMapSettings",null),u([d()],ht.prototype,"interacting",null),u([d()],ht.prototype,"stationary",null),u([d()],ht.prototype,"navigating",null),u([d()],ht.prototype,"map",void 0),u([d({readOnly:!0})],ht.prototype,"mapCoordsHelper",void 0),u([d()],ht.prototype,"padding",null),u([d({type:Ec,readOnly:!0})],ht.prototype,"pointsOfInterest",void 0),u([d({type:ya,readOnly:!0})],ht.prototype,"featureTiles",void 0),u([d()],ht.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],ht.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],ht.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],ht.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],ht.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],ht.prototype,"state",void 0),u([d({readOnly:!0})],ht.prototype,"inputManager",void 0),u([d({readOnly:!0})],ht.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],ht.prototype,"qualityProfile",null),u([d({type:Jhe,get(){let e=this._get("qualitySettings");return e||(e=new Jhe,$4.apply(this.qualityProfile,e)),e}})],ht.prototype,"qualitySettings",void 0),u([d()],ht.prototype,"slicePlane",null),u([d({readOnly:!0})],ht.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],ht.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],ht.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],ht.prototype,"resolution",null),u([d({type:Number})],ht.prototype,"scale",null),u([d()],ht.prototype,"heightModelInfo",null),u([d()],ht.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],ht.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],ht.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],ht.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],ht.prototype,"type",void 0),u([d({type:gOe})],ht.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating","state.mode"]})],ht.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],ht.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],ht.prototype,"viewingMode",null),u([d({type:ap})],ht.prototype,"viewpoint",null),u([d({type:Number})],ht.prototype,"zoom",null),u([d({type:rY})],ht.prototype,"highlightOptions",void 0),ht=u([P("esri.views.SceneView")],ht),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(gI||(gI={}));const S2=O(),iG=$s(),cfe=yi(),m2t=ht;async function g2t(e,t={}){await _2t(e,t),ii(t)}async function y2t(e,t={}){var o;const{basemap:i,view:r}=e;if(ii(t),"spatialReferenceLocked"in r&&!r.spatialReferenceLocked||(await i.load(t),ii(t),i.baseLayers.length===0))return;const s=i.baseLayers.getItemAt(0);if(!lC(s))return;if(i.spatialReference){if(r.spatialReference.equals(i.spatialReference))return;ufe()}await s.load(t),ii(t);const n=(("supportedSpatialReferences"in s?s.supportedSpatialReferences:null)||["tileInfo"in s?(o=s.tileInfo)==null?void 0:o.spatialReference:null]).filter(v);n.length!==0&&n.every(a=>!r.spatialReference.equals(a))&&ufe()}function ufe(){throw new H("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}async function _2t(e,t){const{basemap:i,view:r}=e;if(await i.load(t),i.baseLayers.length===0)return;const s=i.baseLayers.concat(i.referenceLayers).toArray().filter(o=>!cre(o)).map(o=>new H("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:o,operationalLayerType:o.operationalLayerType||"unknown"}));if(s.length)throw s[0];const n=i.baseLayers.getItemAt(0);if(cre(n)){try{await n.load(t)}catch(o){const a="basemap-compatibility:unknown-error",l="Unknown basemap compatibility error",{name:c=a,message:h=l,details:p}=o;throw new H(c,h,p)}v2t(n,r)}}function v2t(e,t){const i=t.state.viewingMode;if(!i)return;let r,s;if((e==null?void 0:e.type)==="wmts"){const l=jMe(e,t.spatialReference,i);if(C(l.tileInfo))throw new H("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");r=l.tileInfo,s=l.fullExtent}else r=e.tileInfo,s=e.fullExtent;if(C(r))return;if(!AP(r.spatialReference,i))throw new H(`basemapgalleryitem:spatial-reference-unsupported-${H3(i)}`,`Basemap spatial reference is unsupported in ${H3(i)} mode`);const n=r.spatialReference.isGeographic,o=(e==null?void 0:e.type)==="vector-tile"?r.getOrCreateCompatible(256,n?1:2):null;if(i===je.Global){let l=jP(r,s,null,i);if(l&&(e==null?void 0:e.type)==="vector-tile"&&v(s)&&o&&!jP(o,s,null,i)&&(l=null),l){const c=r.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new H(`basemapgalleryitem:tiling-scheme-unsupported-${c}-global`,"Basemap tiling scheme is unsupported in global mode",{error:l})}}else if(os.checkUnsupported(r))throw new H("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const a=t.get("basemapTerrain.tilingScheme");if(a&&!a.compatibleWith(r)&&((e==null?void 0:e.type)!=="vector-tile"||!o||!a.compatibleWith(o)))throw new H("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}let Bm=class extends G0(jf(Te)){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.handles.add([te(()=>{var t;return(t=this.basemap)==null?void 0:t.loadStatus},e),te(()=>this.compatibilityFunction,e),te(()=>{var t;return this.view&&"basemapTerrain"in this.view&&((t=this.view.basemapTerrain)==null?void 0:t.tilingScheme)},e),te(()=>{var t;return(t=this.view)==null?void 0:t.ready},e),te(()=>{var t;return(t=this.view)==null?void 0:t.spatialReference},e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return zBe(this.view,this.basemap)}set basemap(e){const t=this._get("basemap");t&&t.cancelLoad(),e&&e.load().catch(()=>{}),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){var r;this._cancelRefresh(),this._set("state","loading");const e=(r=this.basemap)==null?void 0:r.loadStatus;if(e!=="loaded"&&e!=="failed")return;if(!this.compatibilityFunction)return void(e==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:i}=t;this.compatibilityFunction(this,{signal:i}).then(()=>I0(()=>!this._spatialReferenceTask.updating,i)).then(()=>{this._set("state","ready"),this._set("error",null)}).catch(s=>{Ws(s)||(this._set("state","error"),this._set("error",s))}),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};u([d({readOnly:!0})],Bm.prototype,"_spatialReferenceTask",null),u([d()],Bm.prototype,"basemap",null),u([d()],Bm.prototype,"compatibilityFunction",void 0),u([d({readOnly:!0})],Bm.prototype,"error",void 0),u([d({readOnly:!0})],Bm.prototype,"spatialReference",null),u([d({readOnly:!0})],Bm.prototype,"state",void 0),u([d()],Bm.prototype,"view",void 0),Bm=u([P("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],Bm);const yOe=Bm,_Oe=Qe.ofType(vT);let f3=class extends Te{constructor(e){super(e),this.basemaps=new _Oe}get state(){return"ready"}refresh(){}};u([d({type:_Oe})],f3.prototype,"basemaps",void 0),u([d({readOnly:!0})],f3.prototype,"state",null),f3=u([P("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],f3);const vOe=f3,bOe=Qe.ofType(vT);let qy=class extends sp.LoadableMixin(p$(vOe)){constructor(e){super(e),this._handles=new Ii,this.basemaps=new bOe,this.filterFunction=null,this.portal=po.getDefault(),this.query=null,this.updateBasemapsCallback=null}initialize(){this._handles.add([te(()=>{var e,t;return[this.filterFunction,this.loadStatus,(e=this.portal)==null?void 0:e.basemapGalleryGroupQuery,(t=this.portal)==null?void 0:t.user,this.query,this.updateBasemapsCallback]},()=>this.refresh(),st)])}destroy(){this._handles.destroy(),this._handles=null,this.filterFunction=null,this.portal=null}get state(){return this.loadStatus==="not-loaded"?"not-loaded":this.loadStatus==="loading"||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),this.notifyChange("state"),Promise.resolve(this)}async refresh(){if(this.state!=="ready")return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{const i=await e.fetchBasemaps(this._toQueryString(this.query),t);this._updateBasemaps(i)}catch(i){if(Ws(i))throw i;se.getLogger(this.declaredClass).warn(new H("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:i})),this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(e){return e&&typeof e!="string"?Object.keys(e).map(t=>`${t}:${e[t]}`).join(" AND "):e}_updateBasemaps(e=[]){let t=this.filterFunction?e.filter(this.filterFunction):e;t=this.updateBasemapsCallback?this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)}};u([d({readOnly:!0,type:bOe})],qy.prototype,"basemaps",void 0),u([d()],qy.prototype,"filterFunction",void 0),u([d({type:po})],qy.prototype,"portal",void 0),u([d()],qy.prototype,"query",void 0),u([d({readOnly:!0})],qy.prototype,"state",null),u([d()],qy.prototype,"updateBasemapsCallback",void 0),qy=u([P("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],qy);const Y4=qy,wOe=Qe.ofType(yOe);function b2t(e){return e&&e.declaredClass==="esri.portal.Portal"}function w2t(e){return e&&!(e instanceof Y4)&&(!!e.portal||!!e.query)}function x2t(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}let Sd=class extends jf(sp){constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new wOe,this.source=new Y4,this.view=null}initialize(){const e=()=>this._recreateItems();this.handles.add([te(()=>this.state==="ready"?this.compatibilityFunction:null,()=>this._updateItems()),Fs(()=>{var t;return(t=this.source)==null?void 0:t.basemaps},"change",e,{onListenerAdd:e})])}get activeBasemap(){var e,t,i;return(i=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.basemap)!=null?i:null}set activeBasemap(e){var r,s;if(!this.view.map)return;const t=typeof e=="string"?vT.fromId(e):e;if(!t||!this.view.ready)return this.view.map.basemap=t,void this._clearOverride("activeBasemap");const i=t.spatialReference||((s=(r=this.items)==null?void 0:r.find(n=>this.basemapEquals(t,n.basemap)))==null?void 0:s.spatialReference);if(i&&"spatialReferenceLocked"in this.view&&!this.view.spatialReferenceLocked){const n=this.view.spatialReference;if(v(i)&&!kn(n,i)&&!q1(this.view.spatialReference,i)&&!EU())return this._override("activeBasemap",t),this._loadingProjectionEngine=!0,void qI().then(()=>{this._get("activeBasemap")===e&&(this.view.map.basemap=e,this.view.spatialReference=i,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1});this.view.map.basemap=t,this._clearOverride("activeBasemap"),v(i)&&!kn(this.view.spatialReference,i)&&(this.view.spatialReference=i)}else this.view.map.basemap=t,this._clearOverride("activeBasemap")}get activeBasemapIndex(){const{state:e,items:t,activeBasemap:i}=this;if(e!=="ready")return-1;const r=t.findIndex(s=>s.basemap===i);return r===-1?t.findIndex(s=>this.basemapEquals(s.basemap,i)):r}get compatibilityFunction(){var e;return((e=this.view)==null?void 0:e.type)==="3d"?g2t:y2t}set compatibilityFunction(e){this._overrideIfSome("compatibilityFunction",e)}castSource(e){return Array.isArray(e)||Qe.isCollection(e)?new vOe({basemaps:e}):b2t(e)?new Y4({portal:e}):w2t(e)?new Y4(e):x2t(e)?e:null}get state(){var e;return((e=this.view)==null?void 0:e.ready)&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return BBe(e,t)}refresh(){this._recreateItems()}load(e){return this.addResolvingPromise(sp.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_recreateItems(){var r;const e=(r=this.source)==null?void 0:r.basemaps,{view:t,compatibilityFunction:i}=this;this.items.removeAll().forEach(s=>s.destroy()),e&&this.items.addMany(e.map(s=>new yOe({basemap:s,compatibilityFunction:i,view:t})))}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};u([d()],Sd.prototype,"_loadingProjectionEngine",void 0),u([d()],Sd.prototype,"activeBasemap",null),u([d({readOnly:!0})],Sd.prototype,"activeBasemapIndex",null),u([d()],Sd.prototype,"compatibilityFunction",null),u([d({readOnly:!0,type:wOe})],Sd.prototype,"items",void 0),u([d()],Sd.prototype,"source",void 0),u([Zt("source")],Sd.prototype,"castSource",null),u([d({readOnly:!0})],Sd.prototype,"state",null),u([d()],Sd.prototype,"view",void 0),Sd=u([P("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],Sd);const T2t=Sd,yy="esri-basemap-gallery",Zu={base:`${yy} esri-widget esri-widget--panel-height-only`,sourceLoading:`${yy}--source-loading`,loader:`${yy}__loader`,item:`${yy}__item`,itemContainer:`${yy}__item-container`,itemTitle:`${yy}__item-title`,itemThumbnail:`${yy}__item-thumbnail`,selectedItem:`${yy}__item--selected`,itemError:`${yy}__item--error`,emptyMessage:"esri-widget__content--empty",widgetIcon:"esri-icon-basemap",disabled:"esri-disabled",loaderAnimation:"esri-widget__loader-animation"};let oh=class extends pn{constructor(e,t){super(e,t),this._handles=new Ii,this._focusBasemapItemEnabled=!1,this.disabled=!1,this.headingLevel=2,this.iconClass=Zu.widgetIcon,this.messages=null,this.viewModel=new T2t}initialize(){const e=this._handles;this.addHandles([Fs(()=>this.viewModel.items,"change",t=>{const i="basemap-gallery-item-changes",{added:r,moved:s}=t;e.remove(i),e.add([...r,...s].map(n=>te(()=>n.state,()=>this.scheduleRender())),i),this.scheduleRender()}),Qo(()=>this.source,()=>this.viewModel.load(),{initial:!0,once:!0})])}destroy(){this._handles.destroy()}loadDependencies(){return Q(()=>import("./calcite-scrim.021ec791.js"),["assets/calcite-scrim.021ec791.js","assets/scrim.a5ee631c.js","assets/t9n.6be6d1c5.js","assets/observers.0143061c.js","assets/loader.5c70f655.js","assets/guid.ba2965fd.js"])}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.source.state==="loading",t=this.disabled||this.viewModel.state==="disabled",i=this.viewModel.items.map((o,a)=>this._renderBasemapGalleryItem(o,a)).toArray(),r={[Zu.sourceLoading]:e,[Zu.disabled]:t},s=e?D("div",{class:Zu.loader,key:"esri-basemap-gallery__loader"}):null,n=e?null:i.length>0?D("ul",{bind:this,"aria-disabled":this.disabled,"aria-label":this.label,class:Zu.itemContainer,key:"esri-basemap-gallery__item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},i):D("div",{class:Zu.emptyMessage,key:"esri-basemap-gallery__empty-message"},D(BU,{level:this.headingLevel},this.messages.noBasemaps));return D("div",{class:this.classes(Zu.base,r)},s,n)}_getRoundRobinIndex(e,t){return(e+t)%t}_handleKeyDown(e){const{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();const{items:i,activeBasemapIndex:r}=this.viewModel,s=t==="ArrowUp"||t==="ArrowLeft"?this._getRoundRobinIndex(Math.max(r-1,-1),i.length):this._getRoundRobinIndex(r+1,i.length),n=i.getItemAt(s);(n==null?void 0:n.state)==="ready"&&(this.viewModel.activeBasemap=n.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&e.tabIndex===0&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const t=e.currentTarget["data-item"];t.state==="ready"&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e,t){var y,_;const i=e.basemap.thumbnailUrl||Vi("esri/themes/base/images/basemap-toggle-64.svg"),r=e.basemap.title,s=(y=e.basemap.portalItem)==null?void 0:y.snippet,n=((_=e.error)==null?void 0:_.message)||s||r,{viewModel:{state:o,activeBasemapIndex:a}}=this,l=this.disabled||o==="disabled",c=a===t,h=c||a===-1&&t===0?0:-1,p=o==="loading",f={[Zu.selectedItem]:c,[Zu.itemError]:e.state==="error"},m=`basemapgallery-item-${e.uid}`;return D("li",{"aria-checked":c.toString(),"aria-disabled":l.toString(),"aria-labelledby":m,bind:this,class:this.classes(Zu.item,f),"data-item":e,onkeydown:this._handleClick,onclick:this._handleClick,role:"radio",tabIndex:h,afterUpdate:this._focusBasemapItem,title:n},D("img",{alt:"",class:Zu.itemThumbnail,src:i}),D("div",{id:m,class:Zu.itemTitle},r),e.state==="loading"||c&&p?D("calcite-scrim",null,D("span",{"aria-hidden":"true",role:"presentation",class:Zu.loaderAnimation})):null)}};u([d()],oh.prototype,"activeBasemap",null),u([d()],oh.prototype,"disabled",void 0),u([d()],oh.prototype,"headingLevel",void 0),u([d()],oh.prototype,"iconClass",void 0),u([d()],oh.prototype,"label",null),u([d(),Es("esri/widgets/BasemapGallery/t9n/BasemapGallery")],oh.prototype,"messages",void 0),u([d()],oh.prototype,"source",null),u([d()],oh.prototype,"view",null),u([d()],oh.prototype,"viewModel",void 0),u([ln()],oh.prototype,"_handleClick",null),oh=u([P("esri.widgets.BasemapGallery")],oh);const S2t=oh;let Iv=class extends Te{constructor(e){super(e),this._viewpointHandle=null,this._handles=new Ii,this.group=null}initialize(){this._handles.add(Fs(()=>{var e;return(e=this.view)==null?void 0:e.ui},"expand",e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const t=!!e;this._set("expanded",t);const i=this.get("view.ui");i&&i.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&Qo(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?Qo(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:t,view:i}=this;if(i&&t){const r=C4e(()=>i.type==="3d"?i.camera:i.viewpoint,()=>this._collapse());this._handles.add(r,e),this._viewpointHandle=r}}_collapse(){this.expanded=!1}};u([d({value:!1})],Iv.prototype,"autoCollapse",null),u([d({value:!1})],Iv.prototype,"expanded",null),u([d()],Iv.prototype,"group",void 0),u([d({readOnly:!0})],Iv.prototype,"state",null),u([d({value:null})],Iv.prototype,"view",null),Iv=u([P("esri.widgets.Expand.ExpandViewModel")],Iv);const xOe=Iv,Zc="esri-expand",Po={base:`${Zc} esri-widget`,modeAuto:`${Zc}--auto`,modeDrawer:`${Zc}--drawer`,modeFloating:`${Zc}--floating`,container:`${Zc}__container`,containerExpanded:`${Zc}__container--expanded`,panel:`${Zc}__panel`,button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:`${Zc}__icon--expanded`,iconNumber:`${Zc}__icon-number`,iconNumberExpanded:`${Zc}__icon-number--expanded`,expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:`${Zc}__content`,contentExpanded:`${Zc}__content--expanded`,expandMask:`${Zc}__mask`,expandMaskExpanded:`${Zc}__mask--expanded`};let Xn=class extends pn{constructor(e,t){super(e,t),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.viewModel=new xOe,this._handleKeyDown=i=>{const{closeOnEsc:r,_toggleButtonEl:s,expanded:n}=this;!n||!r||i.target===s||i.key!=="Escape"||(typeof r=="function"?r(i):r)&&(this.expanded=!1,s==null||s.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:i,expandTooltip:r}=this;return e?i||t.collapse:r||t.expand}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIconClass(){return Po.collapseIcon}set collapseIconClass(e){this._overrideIfSome("collapseIconClass",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIconClass(){return mA(this.content)?this.content.iconClass:Po.expandIcon}set expandIconClass(e){this._overrideIfSome("expandIconClass",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,t={[Po.modeAuto]:e==="auto",[Po.modeDrawer]:e==="drawer",[Po.modeFloating]:e==="floating"};return D("div",{class:this.classes(Po.base,t),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,t={[Po.containerExpanded]:e};return D("div",{class:this.classes(Po.container,t)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,t={[Po.expandMaskExpanded]:e};return D("div",{bind:this,onclick:this._toggle,class:this.classes(Po.expandMask,t)})}renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?D("span",{key:"expand__icon-number",class:Po.iconNumber},t):null}renderPanelNumber(){const{iconNumber:e,expanded:t}=this;return e&&t?D("span",{key:"expand__expand-icon-number",class:this.classes(Po.iconNumber,Po.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:t,expanded:i}=this,r={[Po.iconExpanded]:i,[e]:i,[t]:!i};return e===t&&(r[e]=!0),D("span",{"aria-hidden":"true",class:this.classes(Po.icon,r)})}renderTitle(){return D("span",{class:Po.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:t,contentId:i}=this;return D("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":i,"aria-expanded":e?"true":"false",bind:this,class:Po.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:t},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return D("div",{class:Po.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:t,content:i}=this,r={[Po.contentExpanded]:e},s={id:t,role:"region",class:this.classes(Po.content,r)};return typeof i=="string"?D("div",{key:"content__string",innerHTML:i,...s}):mA(i)?D("div",{key:"content__widget",...s},i.render()):i instanceof HTMLElement?D("div",{key:"content__html-element",bind:i,afterCreate:this._attachToNode,...s}):gxe(i)?D("div",{key:"content__node",bind:i.domNode,afterCreate:this._attachToNode,...s}):null}_toggle(){this.toggle()}_attachToNode(e){const t=this;e.appendChild(t)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};u([d({readOnly:!0})],Xn.prototype,"contentId",null),u([d({readOnly:!0})],Xn.prototype,"expandTitle",null),u([d()],Xn.prototype,"autoCollapse",null),u([d()],Xn.prototype,"closeOnEsc",void 0),u([d()],Xn.prototype,"collapseIconClass",null),u([d()],Xn.prototype,"collapseTooltip",void 0),u([d()],Xn.prototype,"content",void 0),u([d()],Xn.prototype,"expanded",null),u([d()],Xn.prototype,"expandIconClass",null),u([d()],Xn.prototype,"expandTooltip",void 0),u([d()],Xn.prototype,"group",null),u([d()],Xn.prototype,"iconNumber",void 0),u([d()],Xn.prototype,"label",null),u([d(),Es("esri/widgets/Expand/t9n/Expand")],Xn.prototype,"messages",void 0),u([d(),Es("esri/t9n/common")],Xn.prototype,"messagesCommon",void 0),u([d()],Xn.prototype,"mode",void 0),u([d()],Xn.prototype,"view",null),u([d({type:xOe})],Xn.prototype,"viewModel",void 0),u([ln()],Xn.prototype,"_toggle",null),Xn=u([P("esri.widgets.Expand")],Xn);const rG=Xn;let Wy=class extends t8(ps.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){var t;if(!this.get("view.ready"))throw new H("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await((t=this.view)==null?void 0:t.when()),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};u([d()],Wy.prototype,"_goingHomeController",void 0),u([d({readOnly:!0})],Wy.prototype,"state",null),u([d()],Wy.prototype,"view",null),u([d({type:ap})],Wy.prototype,"viewpoint",null),u([d()],Wy.prototype,"go",null),u([d()],Wy.prototype,"cancelGo",null),Wy=u([P("esri.widgets.Home.HomeViewModel")],Wy);const TOe=Wy,E2={base:"esri-home esri-widget--button esri-widget",esriIcon:"esri-icon",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",widgetIcon:"esri-icon-home",disabled:"esri-disabled"};let ah=class extends pn{constructor(e,t){super(e,t),this.iconClass=E2.widgetIcon,this.messages=null,this.messagesCommon=null,this.viewModel=new TOe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get viewpoint(){return this.viewModel.viewpoint}set viewpoint(e){this.viewModel.viewpoint=e}cancelGo(){this.viewModel.cancelGo()}go(){return this.viewModel.go()}render(){var s;const e=(s=this.viewModel)==null?void 0:s.state,{messagesCommon:t,messages:i}=this,r={[E2.disabled]:e==="disabled"};return D("div",{bind:this,class:this.classes(E2.base,r),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":i.widgetLabel,title:e==="going-home"?t.cancel:i.title},this.renderIcon())}renderIcon(){var i;const e=(i=this.viewModel)==null?void 0:i.state,t={[E2.esriIcon]:!0,[this.iconClass]:e!=="going-home",[E2.loadingIcon]:e==="going-home",[E2.rotatingIcon]:e==="going-home"};return D("span",{"aria-hidden":"true",class:this.classes(t)})}_go(){const{viewModel:e}=this;e.state==="going-home"?e.cancelGo():e.go()}};u([d()],ah.prototype,"goToOverride",null),u([d()],ah.prototype,"iconClass",void 0),u([d()],ah.prototype,"label",null),u([d(),Es("esri/widgets/Home/t9n/Home")],ah.prototype,"messages",void 0),u([d(),Es("esri/t9n/common")],ah.prototype,"messagesCommon",void 0),u([d()],ah.prototype,"uiStrings",void 0),u([d()],ah.prototype,"view",null),u([d({type:TOe}),O$("go")],ah.prototype,"viewModel",void 0),u([d()],ah.prototype,"viewpoint",null),u([ln()],ah.prototype,"_go",null),ah=u([P("esri.widgets.Home")],ah);const E2t=ah;var IY;let Pv=IY=class extends KA{constructor(e){super(e),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new IY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};u([d()],Pv.prototype,"displayValueEnabled",void 0),u([d()],Pv.prototype,"max",void 0),u([d()],Pv.prototype,"min",void 0),u([d()],Pv.prototype,"step",void 0),u([d()],Pv.prototype,"value",void 0),Pv=IY=u([P("esri.support.Action.ActionSlider")],Pv);const C2t=Pv,SOe={hide:"hide",hideChildren:"hide-children"};function _6(e){if(e)return e.listMode!=null?e.listMode:void 0}function A2t(e){if(e)return e.minScale!=null?e.minScale:void 0}function M2t(e){if(e)return e.maxScale!=null?e.maxScale:void 0}function R2t(e){if(!e)return"inherited";const t=e.get("layer.capabilities.exportMap.supportsSublayerVisibility");if(typeof t=="boolean")return t?"independent":"inherited";const i=e.get("capabilities.exportMap.supportsSublayerVisibility");return typeof i=="boolean"?i?"independent":"inherited":e.visibilityMode!=null?e.visibilityMode:"independent"}function EOe(e){if(e&&(!("type"in e)||e.type!=="wmts")&&e.listMode!==SOe.hideChildren)return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function O2t(e){const t=e&&(e.get("layer.layer")||e.layer);if(!t)return!1;const i=t.get("capabilities.exportMap.supportsDynamicLayers");return typeof i!="boolean"||i}function I2t(e){return _6(e)!==SOe.hide}function P2t(e,t){if(!e||isNaN(t))return!1;const i=A2t(e),r=M2t(e),s=!isNaN(i)&&i>0&&t>i,n=!isNaN(r)&&r>0&&t<r;return s||n}function COe(e,t){e&&e.sort((i,r)=>{const s=t.indexOf(i.uid),n=t.indexOf(r.uid);return s>n?-1:s<n?1:0})}function $2t(e,t){const i=e==null?void 0:e.layer;if(!i)return;const r=EOe(i);!r||COe(i.get(r),t)}function hfe(e){const t=e==null?void 0:e.layer;return t&&"layers"in t?t.layers:null}function sG(e,t){var r;const i=(r=e.layer)==null?void 0:r.uid;return i&&t.find(s=>{var n;return((n=s.layer)==null?void 0:n.uid)===i})}function L2t(e){const t=D2t(e)?e:null,i=e==null?void 0:e.parent,r=(i==null?void 0:i.type)==="map-image"&&t.source,s="";return r&&i?{layer:i,title:s,sublayerIds:[r.mapLayerId]}:{layer:e,title:s}}function D2t(e){return!!(e!=null&&e.layer)}const AOe="esri-layer-list-panel",GR=`${AOe}__content`,_y={base:AOe,content:GR,contentLegend:`${GR}--legend`,contentString:`${GR}--string`,contentElement:`${GR}--html-element`,contentWidget:`${GR}--widget`},F2t="legends";let Ed=class extends G0(pn){constructor(e,t){super(e,t),this._legend=null,this._handles=new Ii,this.content=null,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles(te(()=>this.content,e=>this._createLegend(e),st))}destroy(){const{_legend:e}=this;e&&e.destroy(),this._legend=null}get className(){const{image:e}=this,t=this._getFirstWidget();return this._get("className")||!e&&t?t.iconClass:""}set className(e){this._override("className",e)}get disabled(){var r;const{listItem:e,_legend:t,content:i}=this;return!e||!(Array.isArray(i)&&i.length>1)&&!!t&&(!((r=t.activeLayerInfos)!=null&&r.length)||!e.visibleAtCurrentScale)}set disabled(e){this._overrideIfSome("disabled",e)}get title(){const e=this._getFirstWidget();return this._get("title")||e?e.label:""}set title(e){this._override("title",e)}render(){return D("div",{class:_y.base},this._renderContents())}_renderContent(e){const{_legend:t,disabled:i}=this;return!e||i?null:e==="legend"&&t?D("div",{class:this.classes(_y.content,_y.contentLegend),key:t},t.render()):typeof e=="string"?D("div",{class:this.classes(_y.content,_y.contentString),key:e,innerHTML:e}):mA(e)?D("div",{class:this.classes(_y.content,_y.contentWidget),key:e},e.render()):e instanceof HTMLElement?D("div",{class:this.classes(_y.content,_y.contentElement),key:e,bind:e,afterCreate:this._attachToNode}):null}_renderContents(){const{content:e}=this;return Array.isArray(e)?e.map(t=>this._renderContent(t)):this._renderContent(e)}_getLegendOptions(){const{listItem:e}=this;if(!e)return{};const{layer:t,view:i}=e;return t&&i?{view:i,layerInfos:[L2t(t)]}:{}}_createLegend(e){this._hasLegend(e)&&!this._legend&&Q(()=>import("./Legend.0253243e.js"),["assets/Legend.0253243e.js","assets/ExportImageParameters.23657883.js","assets/floorFilterUtils.4de71259.js","assets/sublayerUtils.f556487c.js","assets/pixelRangeUtils.eec66021.js","assets/rendererConversion.bf1e92f2.js"]).then(({default:t})=>{const{_handles:i,listItem:r}=this,s=new t(this._getLegendOptions());this._legend=s,this.notifyChange("className"),this.notifyChange("title");const n=te(()=>{var o,a;return[r==null?void 0:r.view,r==null?void 0:r.layer,(o=r==null?void 0:r.layer)==null?void 0:o.source,(a=r==null?void 0:r.layer)==null?void 0:a.parent]},()=>this._updateLegend(s),st);i.add(n,F2t),this.scheduleRender()})}_hasLegend(e){const t="legend";return e===t||!!Array.isArray(e)&&e.includes(t)}_attachToNode(e){e.appendChild(this)}_updateLegend(e){e.set(this._getLegendOptions()),this.scheduleRender()}_getWidget(e){return e==="legend"?this._legend:mA(e)?e:null}_getFirstWidget(){const{content:e}=this;if(Array.isArray(e)){let t=null;return e.some(i=>{const r=this._getWidget(i);return r&&(t=r),!!r}),t}return this._getWidget(e)}};u([d()],Ed.prototype,"_legend",void 0),u([d()],Ed.prototype,"className",null),u([d()],Ed.prototype,"content",void 0),u([d()],Ed.prototype,"disabled",null),u([d()],Ed.prototype,"image",void 0),u([d()],Ed.prototype,"listItem",void 0),u([d()],Ed.prototype,"title",null),u([d()],Ed.prototype,"open",void 0),u([d()],Ed.prototype,"visible",void 0),Ed=u([P("esri.widgets.LayerList.ListItemPanel")],Ed);const MOe=Ed;var m3;const N2t=Qe.ofType({key:"type",defaultKeyValue:"button",base:KA,typeMap:{button:JT,toggle:qZ,slider:C2t}}),ROe=Qe.ofType(N2t),QF="layer",nG="child-list-mode",k2t="hide",U2t="esri.widgets.LayerList.ListItem";let Us=m3=class extends G0(jf(Te)){constructor(e){super(e),this.actionsSections=new ROe,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(Qe.ofType(m3)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.layerView=null,this.listItemCreatedFunction=null,this.open=!1,this.panel=null,this.parent=null,this.sortable=!0,this.view=null}initialize(){if(this.handles.add([te(()=>this.layer,e=>this._watchLayerProperties(e),st),te(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),st),te(()=>this.view,e=>this._updateChildrenView(e),st),te(()=>this.panel,e=>this._setListItemOnPanel(e),st),te(()=>[this.layer,this.view],()=>this._getLayerView(),st)]),typeof this.listItemCreatedFunction=="function"){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){var e;return(e=this.layer)==null?void 0:e.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e))&&!e.spatialReferenceSupported}castPanel(e){return this.get("panel.open")&&!e.hasOwnProperty("open")&&(e.open=!0),e?new MOe(e):null}get title(){const e=this.get("layer.layer");return(!e||e&&this.get("layer.layer.loaded"))&&this.get("layer.title")||this.get("layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){var i;const{layer:e,checkPublishStatusEnabled:t}=this;return t&&e&&"publishingInfo"in e&&((i=e.publishingInfo)==null?void 0:i.status)==="publishing"}get updating(){const{layerView:e,connectionStatus:t,layer:i,publishing:r}=this;return!r&&!t&&(e?e.updating:(i==null?void 0:i.loadStatus)==="loading"||!1)}get visible(){var e;return(e=this.layer)==null?void 0:e.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return!P2t(this.layer,this.get("view.scale"))}get visibilityMode(){return R2t(this.layer)}clone(){return new m3({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){const t=this.children;t&&t.forEach(i=>i.checkPublishStatusEnabled=e)}_updateChildrenView(e){const t=this.children;t&&t.forEach(i=>i.view=e)}_addChildren(e){if(this.handles.remove(nG),this.children.removeAll(),!e)return;e.forEach(i=>{this.handles.add(te(()=>i.listMode,()=>this._addChildren(e)),nG)});const t=e.filter(i=>_6(i)!==k2t);this.children.addMany(this._makeChildren(t))}_watchSublayerChanges(e){e&&this.handles.add(e.on("change",()=>{this._addChildren(e)}),QF)}_initializeChildLayers(e){this._addChildren(e),this._watchSublayerChanges(e)}_makeChildren(e){return e.map(t=>I2t(t)?new m3({layer:t,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,parent:this,view:this.view}):null).filter(v).reverse()}_watchLayerProperties(e){if(!this.handles||(this.handles.remove(QF),this.handles.remove(nG),!e))return;if(this.handles.add(te(()=>e.listMode,()=>this._watchLayerProperties(e)),QF),_6(e)==="hide-children")return void this.children.removeAll();const t=EOe(e);t&&this.handles.add(te(()=>e[t],()=>{e.hasOwnProperty(t)&&this._initializeChildLayers(e[t])},st),QF)}async _getLayerView(){const{layer:e,view:t}=this;if(e&&t)try{const i=await t.whenLayerView(e);if(i.layer!==this.layer)return;this._set("layerView",i)}catch{}}};u([d({type:ROe})],Us.prototype,"actionsSections",void 0),u([d()],Us.prototype,"actionsOpen",void 0),u([d()],Us.prototype,"checkPublishStatusEnabled",void 0),u([d({type:Qe})],Us.prototype,"children",void 0),u([d()],Us.prototype,"childrenSortable",void 0),u([d({readOnly:!0})],Us.prototype,"connectionStatus",null),u([d({readOnly:!0})],Us.prototype,"error",null),u([d()],Us.prototype,"hidden",void 0),u([d({readOnly:!0})],Us.prototype,"incompatible",null),u([d()],Us.prototype,"layer",void 0),u([d({readOnly:!0})],Us.prototype,"layerView",void 0),u([d()],Us.prototype,"listItemCreatedFunction",void 0),u([d()],Us.prototype,"open",void 0),u([d({type:MOe})],Us.prototype,"panel",void 0),u([Zt("panel")],Us.prototype,"castPanel",null),u([d()],Us.prototype,"parent",void 0),u([d()],Us.prototype,"sortable",void 0),u([d()],Us.prototype,"title",null),u([d({readOnly:!0})],Us.prototype,"publishing",null),u([d({readOnly:!0})],Us.prototype,"updating",null),u([d()],Us.prototype,"view",void 0),u([d()],Us.prototype,"visible",null),u([d({readOnly:!0})],Us.prototype,"visibleAtCurrentScale",null),u([d({readOnly:!0})],Us.prototype,"visibilityMode",null),Us=m3=u([P(U2t)],Us);const Dte=Us,Ju={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode",children:"children"},V2t="hide",OOe=Qe.ofType(Dte);let $v=class extends ps.EventedAccessor{constructor(e){super(e),this._handles=new Ii,this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.operationalItems=new OOe,this.view=null}initialize(){this._handles.add([te(()=>{var e;return[this.view,(e=this.view)==null?void 0:e.ready]},()=>this._viewHandles(),st),te(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],Ju.view)}destroy(){this._handles.destroy(),this._handles=null,this.view=null,this.operationalItems.removeAll()}get state(){const e=this.get("view");return this.get("view.ready")?"ready":e?"loading":"disabled"}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,r){var f,m;const s=e==null?void 0:e.layer;if(!s)return;const n=(m=(f=this.view)==null?void 0:f.map)==null?void 0:m.layers,o=t?hfe(t):n,a=i?hfe(i):n;if(!o||!a)return;const{operationalItems:l}=this,c=(t==null?void 0:t.children)||l,h=(i==null?void 0:i.children)||l,p=a.length-r;e.parent=i||null,c.includes(e)&&c.remove(e),o.includes(s)&&o.remove(s),h.includes(e)||h.add(e,p),a.includes(s)||a.add(s,p)}_createLayerViewHandles(e){const{_handles:t}=this;t.remove(Ju.layerViews),this._compileList(),e&&t.add(e.on("change",()=>this._compileList()),Ju.layerViews)}_createMapLayerHandles(e){const{_handles:t}=this;t.remove(Ju.mapLayers),this._compileList(),e&&t.add(e.on("change",()=>this._compileList()),Ju.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:r}=this;return new Dte({checkPublishStatusEnabled:r,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){const{_handles:e,operationalItems:t}=this;t.forEach(i=>{e.remove(`${Ju.children}-${i.uid}`)}),t.removeAll()}_getViewableLayers(e){if(e)return e.filter(t=>_6(t)!==V2t)}_watchLayersListMode(e){const{_handles:t}=this;t.remove(Ju.layerListMode),e&&e.forEach(i=>{"listMode"in i&&t.add(te(()=>i.listMode,()=>this._compileList()),Ju.layerListMode)})}_compileList(){const e=this.get("view.map.layers");this._watchLayersListMode(e);const t=this._getViewableLayers(e);t&&t.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(i=>{t.find(r=>r.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){const{_handles:t,operationalItems:i}=this,r=[];i.forEach(s=>{s&&e&&e.includes(s.layer)||(t.remove(`${Ju.children}-${s.uid}`),r.push(s))}),i.removeMany(r)}_sortItems(e){const{operationalItems:t}=this;t.sort((i,r)=>{const s=e.indexOf(i.layer),n=e.indexOf(r.layer);return s>n?-1:s<n?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{_handles:e,view:t}=this;e.remove([Ju.mapLayers,Ju.layerViews,Ju.viewLayers]),this._compileList(),t&&t.ready&&e.add([te(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.allLayers},i=>this._createMapLayerHandles(i),st),te(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},i=>this._createLayerViewHandles(i),st)],Ju.viewLayers)}};u([d()],$v.prototype,"checkPublishStatusEnabled",void 0),u([d()],$v.prototype,"listItemCreatedFunction",void 0),u([d({type:OOe})],$v.prototype,"operationalItems",void 0),u([d({readOnly:!0})],$v.prototype,"state",null),u([d()],$v.prototype,"view",void 0),$v=u([P("esri.widgets.LayerList.LayerListViewModel")],$v);const IOe=$v;/**!
 * Sortable 1.15.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function dfe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,r)}return i}function Dg(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?dfe(Object(i),!0).forEach(function(r){B2t(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):dfe(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function Z4(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Z4=function(t){return typeof t}:Z4=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z4(e)}function B2t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function B0(){return B0=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},B0.apply(this,arguments)}function z2t(e,t){if(e==null)return{};var i={},r=Object.keys(e),s,n;for(n=0;n<r.length;n++)s=r[n],!(t.indexOf(s)>=0)&&(i[s]=e[s]);return i}function G2t(e,t){if(e==null)return{};var i=z2t(e,t),r,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(s=0;s<n.length;s++)r=n[s],!(t.indexOf(r)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,r)||(i[r]=e[r]))}return i}var j2t="1.15.0";function C0(e){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(e)}var o_=C0(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),iL=C0(/Edge/i),pfe=C0(/firefox/i),yI=C0(/safari/i)&&!C0(/chrome/i)&&!C0(/android/i),POe=C0(/iP(ad|od|hone)/i),$Oe=C0(/chrome/i)&&C0(/android/i),LOe={capture:!1,passive:!1};function Qr(e,t,i){e.addEventListener(t,i,!o_&&LOe)}function Fr(e,t,i){e.removeEventListener(t,i,!o_&&LOe)}function v6(e,t){if(!!t){if(t[0]===">"&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch{return!1}return!1}}function H2t(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Ym(e,t,i,r){if(e){i=i||document;do{if(t!=null&&(t[0]===">"?e.parentNode===i&&v6(e,t):v6(e,t))||r&&e===i)return e;if(e===i)break}while(e=H2t(e))}return null}var ffe=/\s+/g;function lh(e,t,i){if(e&&t)if(e.classList)e.classList[i?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(ffe," ").replace(" "+t+" "," ");e.className=(r+(i?" "+t:"")).replace(ffe," ")}}function mi(e,t,i){var r=e&&e.style;if(r){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),t===void 0?i:i[t];!(t in r)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),r[t]=i+(typeof i=="string"?"":"px")}}function FC(e,t){var i="";if(typeof e=="string")i=e;else do{var r=mi(e,"transform");r&&r!=="none"&&(i=r+" "+i)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(i)}function DOe(e,t,i){if(e){var r=e.getElementsByTagName(t),s=0,n=r.length;if(i)for(;s<n;s++)i(r[s],s);return r}return[]}function wg(){var e=document.scrollingElement;return e||document.documentElement}function va(e,t,i,r,s){if(!(!e.getBoundingClientRect&&e!==window)){var n,o,a,l,c,h,p;if(e!==window&&e.parentNode&&e!==wg()?(n=e.getBoundingClientRect(),o=n.top,a=n.left,l=n.bottom,c=n.right,h=n.height,p=n.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,h=window.innerHeight,p=window.innerWidth),(t||i)&&e!==window&&(s=s||e.parentNode,!o_))do if(s&&s.getBoundingClientRect&&(mi(s,"transform")!=="none"||i&&mi(s,"position")!=="static")){var f=s.getBoundingClientRect();o-=f.top+parseInt(mi(s,"border-top-width")),a-=f.left+parseInt(mi(s,"border-left-width")),l=o+n.height,c=a+n.width;break}while(s=s.parentNode);if(r&&e!==window){var m=FC(s||e),y=m&&m.a,_=m&&m.d;m&&(o/=_,a/=y,p/=y,h/=_,l=o+h,c=a+p)}return{top:o,left:a,bottom:l,right:c,width:p,height:h}}}function mfe(e,t,i){for(var r=S1(e,!0),s=va(e)[t];r;){var n=va(r)[i],o=void 0;if(i==="top"||i==="left"?o=s>=n:o=s<=n,!o)return r;if(r===wg())break;r=S1(r,!1)}return!1}function WA(e,t,i,r){for(var s=0,n=0,o=e.children;n<o.length;){if(o[n].style.display!=="none"&&o[n]!==gi.ghost&&(r||o[n]!==gi.dragged)&&Ym(o[n],i.draggable,e,!1)){if(s===t)return o[n];s++}n++}return null}function Fte(e,t){for(var i=e.lastElementChild;i&&(i===gi.ghost||mi(i,"display")==="none"||t&&!v6(i,t));)i=i.previousElementSibling;return i||null}function Rd(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)e.nodeName.toUpperCase()!=="TEMPLATE"&&e!==gi.clone&&(!t||v6(e,t))&&i++;return i}function gfe(e){var t=0,i=0,r=wg();if(e)do{var s=FC(e),n=s.a,o=s.d;t+=e.scrollLeft*n,i+=e.scrollTop*o}while(e!==r&&(e=e.parentNode));return[t,i]}function q2t(e,t){for(var i in e)if(!!e.hasOwnProperty(i)){for(var r in t)if(t.hasOwnProperty(r)&&t[r]===e[i][r])return Number(i)}return-1}function S1(e,t){if(!e||!e.getBoundingClientRect)return wg();var i=e,r=!1;do if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var s=mi(i);if(i.clientWidth<i.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||i.clientHeight<i.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!i.getBoundingClientRect||i===document.body)return wg();if(r||t)return i;r=!0}}while(i=i.parentNode);return wg()}function W2t(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function oG(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}var _I;function FOe(e,t){return function(){if(!_I){var i=arguments,r=this;i.length===1?e.call(r,i[0]):e.apply(r,i),_I=setTimeout(function(){_I=void 0},t)}}}function X2t(){clearTimeout(_I),_I=void 0}function NOe(e,t,i){e.scrollLeft+=t,e.scrollTop+=i}function kOe(e){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}var Ih="Sortable"+new Date().getTime();function Y2t(){var e=[],t;return{captureAnimationState:function(){if(e=[],!!this.options.animation){var r=[].slice.call(this.el.children);r.forEach(function(s){if(!(mi(s,"display")==="none"||s===gi.ghost)){e.push({target:s,rect:va(s)});var n=Dg({},e[e.length-1].rect);if(s.thisAnimationDuration){var o=FC(s,!0);o&&(n.top-=o.f,n.left-=o.e)}s.fromRect=n}})}},addAnimationState:function(r){e.push(r)},removeAnimationState:function(r){e.splice(q2t(e,{target:r}),1)},animateAll:function(r){var s=this;if(!this.options.animation){clearTimeout(t),typeof r=="function"&&r();return}var n=!1,o=0;e.forEach(function(a){var l=0,c=a.target,h=c.fromRect,p=va(c),f=c.prevFromRect,m=c.prevToRect,y=a.rect,_=FC(c,!0);_&&(p.top-=_.f,p.left-=_.e),c.toRect=p,c.thisAnimationDuration&&oG(f,p)&&!oG(h,p)&&(y.top-p.top)/(y.left-p.left)===(h.top-p.top)/(h.left-p.left)&&(l=J2t(y,f,m,s.options)),oG(p,h)||(c.prevFromRect=h,c.prevToRect=p,l||(l=s.options.animation),s.animate(c,y,p,l)),l&&(n=!0,o=Math.max(o,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(t),n?t=setTimeout(function(){typeof r=="function"&&r()},o):typeof r=="function"&&r(),e=[]},animate:function(r,s,n,o){if(o){mi(r,"transition",""),mi(r,"transform","");var a=FC(this.el),l=a&&a.a,c=a&&a.d,h=(s.left-n.left)/(l||1),p=(s.top-n.top)/(c||1);r.animatingX=!!h,r.animatingY=!!p,mi(r,"transform","translate3d("+h+"px,"+p+"px,0)"),this.forRepaintDummy=Z2t(r),mi(r,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),mi(r,"transform","translate3d(0,0,0)"),typeof r.animated=="number"&&clearTimeout(r.animated),r.animated=setTimeout(function(){mi(r,"transition",""),mi(r,"transform",""),r.animated=!1,r.animatingX=!1,r.animatingY=!1},o)}}}}function Z2t(e){return e.offsetWidth}function J2t(e,t,i,r){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*r.animation}var C2=[],aG={initializeByDefault:!0},rL={mount:function(t){for(var i in aG)aG.hasOwnProperty(i)&&!(i in t)&&(t[i]=aG[i]);C2.forEach(function(r){if(r.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),C2.push(t)},pluginEvent:function(t,i,r){var s=this;this.eventCanceled=!1,r.cancel=function(){s.eventCanceled=!0};var n=t+"Global";C2.forEach(function(o){!i[o.pluginName]||(i[o.pluginName][n]&&i[o.pluginName][n](Dg({sortable:i},r)),i.options[o.pluginName]&&i[o.pluginName][t]&&i[o.pluginName][t](Dg({sortable:i},r)))})},initializePlugins:function(t,i,r,s){C2.forEach(function(a){var l=a.pluginName;if(!(!t.options[l]&&!a.initializeByDefault)){var c=new a(t,i,t.options);c.sortable=t,c.options=t.options,t[l]=c,B0(r,c.defaults)}});for(var n in t.options)if(!!t.options.hasOwnProperty(n)){var o=this.modifyOption(t,n,t.options[n]);typeof o!="undefined"&&(t.options[n]=o)}},getEventProperties:function(t,i){var r={};return C2.forEach(function(s){typeof s.eventProperties=="function"&&B0(r,s.eventProperties.call(i[s.pluginName],t))}),r},modifyOption:function(t,i,r){var s;return C2.forEach(function(n){!t[n.pluginName]||n.optionListeners&&typeof n.optionListeners[i]=="function"&&(s=n.optionListeners[i].call(t[n.pluginName],r))}),s}};function K2t(e){var t=e.sortable,i=e.rootEl,r=e.name,s=e.targetEl,n=e.cloneEl,o=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,h=e.oldDraggableIndex,p=e.newDraggableIndex,f=e.originalEvent,m=e.putSortable,y=e.extraEventProperties;if(t=t||i&&i[Ih],!!t){var _,b=t.options,w="on"+r.charAt(0).toUpperCase()+r.substr(1);window.CustomEvent&&!o_&&!iL?_=new CustomEvent(r,{bubbles:!0,cancelable:!0}):(_=document.createEvent("Event"),_.initEvent(r,!0,!0)),_.to=o||i,_.from=a||i,_.item=s||i,_.clone=n,_.oldIndex=l,_.newIndex=c,_.oldDraggableIndex=h,_.newDraggableIndex=p,_.originalEvent=f,_.pullMode=m?m.lastPutMode:void 0;var T=Dg(Dg({},y),rL.getEventProperties(r,t));for(var S in T)_[S]=T[S];i&&i.dispatchEvent(_),b[w]&&b[w].call(t,_)}}var Q2t=["evt"],Jc=function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=r.evt,n=G2t(r,Q2t);rL.pluginEvent.bind(gi)(t,i,Dg({dragEl:Je,parentEl:Yn,ghostEl:Ui,rootEl:$n,nextEl:cx,lastDownEl:J4,cloneEl:Bn,cloneHidden:i1,dragStarted:g3,putSortable:rl,activeSortable:gi.active,originalEvent:s,oldIndex:KE,oldDraggableIndex:vI,newIndex:dh,newDraggableIndex:Wv,hideGhostForTarget:zOe,unhideGhostForTarget:GOe,cloneNowHidden:function(){i1=!0},cloneNowShown:function(){i1=!1},dispatchSortableEvent:function(a){Tc({sortable:i,name:a,originalEvent:s})}},n))};function Tc(e){K2t(Dg({putSortable:rl,cloneEl:Bn,targetEl:Je,rootEl:$n,oldIndex:KE,oldDraggableIndex:vI,newIndex:dh,newDraggableIndex:Wv},e))}var Je,Yn,Ui,$n,cx,J4,Bn,i1,KE,dh,vI,Wv,eN,rl,xE=!1,b6=!1,w6=[],aw,Ip,lG,cG,yfe,_fe,g3,A2,bI,wI=!1,tN=!1,K4,Ol,uG=[],PY=!1,x6=[],zV=typeof document!="undefined",iN=POe,vfe=iL||o_?"cssFloat":"float",eEt=zV&&!$Oe&&!POe&&"draggable"in document.createElement("div"),UOe=function(){if(!!zV){if(o_)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto",e.style.pointerEvents==="auto"}}(),VOe=function(t,i){var r=mi(t),s=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),n=WA(t,0,i),o=WA(t,1,i),a=n&&mi(n),l=o&&mi(o),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+va(n).width,h=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+va(o).width;if(r.display==="flex")return r.flexDirection==="column"||r.flexDirection==="column-reverse"?"vertical":"horizontal";if(r.display==="grid")return r.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&a.float&&a.float!=="none"){var p=a.float==="left"?"left":"right";return o&&(l.clear==="both"||l.clear===p)?"vertical":"horizontal"}return n&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=s&&r[vfe]==="none"||o&&r[vfe]==="none"&&c+h>s)?"vertical":"horizontal"},tEt=function(t,i,r){var s=r?t.left:t.top,n=r?t.right:t.bottom,o=r?t.width:t.height,a=r?i.left:i.top,l=r?i.right:i.bottom,c=r?i.width:i.height;return s===a||n===l||s+o/2===a+c/2},iEt=function(t,i){var r;return w6.some(function(s){var n=s[Ih].options.emptyInsertThreshold;if(!(!n||Fte(s))){var o=va(s),a=t>=o.left-n&&t<=o.right+n,l=i>=o.top-n&&i<=o.bottom+n;if(a&&l)return r=s}}),r},BOe=function(t){function i(n,o){return function(a,l,c,h){var p=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(n==null&&(o||p))return!0;if(n==null||n===!1)return!1;if(o&&n==="clone")return n;if(typeof n=="function")return i(n(a,l,c,h),o)(a,l,c,h);var f=(o?a:l).options.group.name;return n===!0||typeof n=="string"&&n===f||n.join&&n.indexOf(f)>-1}}var r={},s=t.group;(!s||Z4(s)!="object")&&(s={name:s}),r.name=s.name,r.checkPull=i(s.pull,!0),r.checkPut=i(s.put),r.revertClone=s.revertClone,t.group=r},zOe=function(){!UOe&&Ui&&mi(Ui,"display","none")},GOe=function(){!UOe&&Ui&&mi(Ui,"display","")};zV&&!$Oe&&document.addEventListener("click",function(e){if(b6)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),b6=!1,!1},!0);var lw=function(t){if(Je){t=t.touches?t.touches[0]:t;var i=iEt(t.clientX,t.clientY);if(i){var r={};for(var s in t)t.hasOwnProperty(s)&&(r[s]=t[s]);r.target=r.rootEl=i,r.preventDefault=void 0,r.stopPropagation=void 0,i[Ih]._onDragOver(r)}}},rEt=function(t){Je&&Je.parentNode[Ih]._isOutsideThisEl(t.target)};function gi(e,t){if(!(e&&e.nodeType&&e.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=B0({},t),e[Ih]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return VOe(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(o,a){o.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:gi.supportPointer!==!1&&"PointerEvent"in window&&!yI,emptyInsertThreshold:5};rL.initializePlugins(this,e,i);for(var r in i)!(r in t)&&(t[r]=i[r]);BOe(t);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=t.forceFallback?!1:eEt,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?Qr(e,"pointerdown",this._onTapStart):(Qr(e,"mousedown",this._onTapStart),Qr(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(Qr(e,"dragover",this),Qr(e,"dragenter",this)),w6.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),B0(this,Y2t())}gi.prototype={constructor:gi,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(A2=null)},_getDirection:function(t,i){return typeof this.options.direction=="function"?this.options.direction.call(this,t,i,Je):this.options.direction},_onTapStart:function(t){if(!!t.cancelable){var i=this,r=this.el,s=this.options,n=s.preventOnFilter,o=t.type,a=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(a||t).target,c=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,h=s.filter;if(hEt(r),!Je&&!(/mousedown|pointerdown/.test(o)&&t.button!==0||s.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&yI&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Ym(l,s.draggable,r,!1),!(l&&l.animated)&&J4!==l)){if(KE=Rd(l),vI=Rd(l,s.draggable),typeof h=="function"){if(h.call(this,t,l,this)){Tc({sortable:i,rootEl:c,name:"filter",targetEl:l,toEl:r,fromEl:r}),Jc("filter",i,{evt:t}),n&&t.cancelable&&t.preventDefault();return}}else if(h&&(h=h.split(",").some(function(p){if(p=Ym(c,p.trim(),r,!1),p)return Tc({sortable:i,rootEl:p,name:"filter",targetEl:l,fromEl:r,toEl:r}),Jc("filter",i,{evt:t}),!0}),h)){n&&t.cancelable&&t.preventDefault();return}s.handle&&!Ym(c,s.handle,r,!1)||this._prepareDragStart(t,a,l)}}},_prepareDragStart:function(t,i,r){var s=this,n=s.el,o=s.options,a=n.ownerDocument,l;if(r&&!Je&&r.parentNode===n){var c=va(r);if($n=n,Je=r,Yn=Je.parentNode,cx=Je.nextSibling,J4=r,eN=o.group,gi.dragged=Je,aw={target:Je,clientX:(i||t).clientX,clientY:(i||t).clientY},yfe=aw.clientX-c.left,_fe=aw.clientY-c.top,this._lastX=(i||t).clientX,this._lastY=(i||t).clientY,Je.style["will-change"]="all",l=function(){if(Jc("delayEnded",s,{evt:t}),gi.eventCanceled){s._onDrop();return}s._disableDelayedDragEvents(),!pfe&&s.nativeDraggable&&(Je.draggable=!0),s._triggerDragStart(t,i),Tc({sortable:s,name:"choose",originalEvent:t}),lh(Je,o.chosenClass,!0)},o.ignore.split(",").forEach(function(h){DOe(Je,h.trim(),hG)}),Qr(a,"dragover",lw),Qr(a,"mousemove",lw),Qr(a,"touchmove",lw),Qr(a,"mouseup",s._onDrop),Qr(a,"touchend",s._onDrop),Qr(a,"touchcancel",s._onDrop),pfe&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Je.draggable=!0),Jc("delayStart",this,{evt:t}),o.delay&&(!o.delayOnTouchOnly||i)&&(!this.nativeDraggable||!(iL||o_))){if(gi.eventCanceled){this._onDrop();return}Qr(a,"mouseup",s._disableDelayedDrag),Qr(a,"touchend",s._disableDelayedDrag),Qr(a,"touchcancel",s._disableDelayedDrag),Qr(a,"mousemove",s._delayedDragTouchMoveHandler),Qr(a,"touchmove",s._delayedDragTouchMoveHandler),o.supportPointer&&Qr(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(l,o.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var i=t.touches?t.touches[0]:t;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Je&&hG(Je),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;Fr(t,"mouseup",this._disableDelayedDrag),Fr(t,"touchend",this._disableDelayedDrag),Fr(t,"touchcancel",this._disableDelayedDrag),Fr(t,"mousemove",this._delayedDragTouchMoveHandler),Fr(t,"touchmove",this._delayedDragTouchMoveHandler),Fr(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,i){i=i||t.pointerType=="touch"&&t,!this.nativeDraggable||i?this.options.supportPointer?Qr(document,"pointermove",this._onTouchMove):i?Qr(document,"touchmove",this._onTouchMove):Qr(document,"mousemove",this._onTouchMove):(Qr(Je,"dragend",this),Qr($n,"dragstart",this._onDragStart));try{document.selection?Q4(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,i){if(xE=!1,$n&&Je){Jc("dragStarted",this,{evt:i}),this.nativeDraggable&&Qr(document,"dragover",rEt);var r=this.options;!t&&lh(Je,r.dragClass,!1),lh(Je,r.ghostClass,!0),gi.active=this,t&&this._appendGhost(),Tc({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function(){if(Ip){this._lastX=Ip.clientX,this._lastY=Ip.clientY,zOe();for(var t=document.elementFromPoint(Ip.clientX,Ip.clientY),i=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(Ip.clientX,Ip.clientY),t!==i);)i=t;if(Je.parentNode[Ih]._isOutsideThisEl(t),i)do{if(i[Ih]){var r=void 0;if(r=i[Ih]._onDragOver({clientX:Ip.clientX,clientY:Ip.clientY,target:t,rootEl:i}),r&&!this.options.dragoverBubble)break}t=i}while(i=i.parentNode);GOe()}},_onTouchMove:function(t){if(aw){var i=this.options,r=i.fallbackTolerance,s=i.fallbackOffset,n=t.touches?t.touches[0]:t,o=Ui&&FC(Ui,!0),a=Ui&&o&&o.a,l=Ui&&o&&o.d,c=iN&&Ol&&gfe(Ol),h=(n.clientX-aw.clientX+s.x)/(a||1)+(c?c[0]-uG[0]:0)/(a||1),p=(n.clientY-aw.clientY+s.y)/(l||1)+(c?c[1]-uG[1]:0)/(l||1);if(!gi.active&&!xE){if(r&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<r)return;this._onDragStart(t,!0)}if(Ui){o?(o.e+=h-(lG||0),o.f+=p-(cG||0)):o={a:1,b:0,c:0,d:1,e:h,f:p};var f="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");mi(Ui,"webkitTransform",f),mi(Ui,"mozTransform",f),mi(Ui,"msTransform",f),mi(Ui,"transform",f),lG=h,cG=p,Ip=n}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!Ui){var t=this.options.fallbackOnBody?document.body:$n,i=va(Je,!0,iN,!0,t),r=this.options;if(iN){for(Ol=t;mi(Ol,"position")==="static"&&mi(Ol,"transform")==="none"&&Ol!==document;)Ol=Ol.parentNode;Ol!==document.body&&Ol!==document.documentElement?(Ol===document&&(Ol=wg()),i.top+=Ol.scrollTop,i.left+=Ol.scrollLeft):Ol=wg(),uG=gfe(Ol)}Ui=Je.cloneNode(!0),lh(Ui,r.ghostClass,!1),lh(Ui,r.fallbackClass,!0),lh(Ui,r.dragClass,!0),mi(Ui,"transition",""),mi(Ui,"transform",""),mi(Ui,"box-sizing","border-box"),mi(Ui,"margin",0),mi(Ui,"top",i.top),mi(Ui,"left",i.left),mi(Ui,"width",i.width),mi(Ui,"height",i.height),mi(Ui,"opacity","0.8"),mi(Ui,"position",iN?"absolute":"fixed"),mi(Ui,"zIndex","100000"),mi(Ui,"pointerEvents","none"),gi.ghost=Ui,t.appendChild(Ui),mi(Ui,"transform-origin",yfe/parseInt(Ui.style.width)*100+"% "+_fe/parseInt(Ui.style.height)*100+"%")}},_onDragStart:function(t,i){var r=this,s=t.dataTransfer,n=r.options;if(Jc("dragStart",this,{evt:t}),gi.eventCanceled){this._onDrop();return}Jc("setupClone",this),gi.eventCanceled||(Bn=kOe(Je),Bn.removeAttribute("id"),Bn.draggable=!1,Bn.style["will-change"]="",this._hideClone(),lh(Bn,this.options.chosenClass,!1),gi.clone=Bn),r.cloneId=Q4(function(){Jc("clone",r),!gi.eventCanceled&&(r.options.removeCloneOnHide||$n.insertBefore(Bn,Je),r._hideClone(),Tc({sortable:r,name:"clone"}))}),!i&&lh(Je,n.dragClass,!0),i?(b6=!0,r._loopId=setInterval(r._emulateDragOver,50)):(Fr(document,"mouseup",r._onDrop),Fr(document,"touchend",r._onDrop),Fr(document,"touchcancel",r._onDrop),s&&(s.effectAllowed="move",n.setData&&n.setData.call(r,s,Je)),Qr(document,"drop",r),mi(Je,"transform","translateZ(0)")),xE=!0,r._dragStartId=Q4(r._dragStarted.bind(r,i,t)),Qr(document,"selectstart",r),g3=!0,yI&&mi(document.body,"user-select","none")},_onDragOver:function(t){var i=this.el,r=t.target,s,n,o,a=this.options,l=a.group,c=gi.active,h=eN===l,p=a.sort,f=rl||c,m,y=this,_=!1;if(PY)return;function b(N,U){Jc(N,y,Dg({evt:t,isOwner:h,axis:m?"vertical":"horizontal",revert:o,dragRect:s,targetRect:n,canSort:p,fromSortable:f,target:r,completed:T,onMove:function(Z,ie){return rN($n,i,Je,s,Z,va(Z),t,ie)},changed:S},U))}function w(){b("dragOverAnimationCapture"),y.captureAnimationState(),y!==f&&f.captureAnimationState()}function T(N){return b("dragOverCompleted",{insertion:N}),N&&(h?c._hideClone():c._showClone(y),y!==f&&(lh(Je,rl?rl.options.ghostClass:c.options.ghostClass,!1),lh(Je,a.ghostClass,!0)),rl!==y&&y!==gi.active?rl=y:y===gi.active&&rl&&(rl=null),f===y&&(y._ignoreWhileAnimating=r),y.animateAll(function(){b("dragOverAnimationComplete"),y._ignoreWhileAnimating=null}),y!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(r===Je&&!Je.animated||r===i&&!r.animated)&&(A2=null),!a.dragoverBubble&&!t.rootEl&&r!==document&&(Je.parentNode[Ih]._isOutsideThisEl(t.target),!N&&lw(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),_=!0}function S(){dh=Rd(Je),Wv=Rd(Je,a.draggable),Tc({sortable:y,name:"change",toEl:i,newIndex:dh,newDraggableIndex:Wv,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),r=Ym(r,a.draggable,i,!0),b("dragOver"),gi.eventCanceled)return _;if(Je.contains(t.target)||r.animated&&r.animatingX&&r.animatingY||y._ignoreWhileAnimating===r)return T(!1);if(b6=!1,c&&!a.disabled&&(h?p||(o=Yn!==$n):rl===this||(this.lastPutMode=eN.checkPull(this,c,Je,t))&&l.checkPut(this,c,Je,t))){if(m=this._getDirection(t,r)==="vertical",s=va(Je),b("dragOverValid"),gi.eventCanceled)return _;if(o)return Yn=$n,w(),this._hideClone(),b("revert"),gi.eventCanceled||(cx?$n.insertBefore(Je,cx):$n.appendChild(Je)),T(!0);var E=Fte(i,a.draggable);if(!E||aEt(t,m,this)&&!E.animated){if(E===Je)return T(!1);if(E&&i===t.target&&(r=E),r&&(n=va(r)),rN($n,i,Je,s,r,n,t,!!r)!==!1)return w(),E&&E.nextSibling?i.insertBefore(Je,E.nextSibling):i.appendChild(Je),Yn=i,S(),T(!0)}else if(E&&oEt(t,m,this)){var M=WA(i,0,a,!0);if(M===Je)return T(!1);if(r=M,n=va(r),rN($n,i,Je,s,r,n,t,!1)!==!1)return w(),i.insertBefore(Je,M),Yn=i,S(),T(!0)}else if(r.parentNode===i){n=va(r);var A=0,$,I=Je.parentNode!==i,k=!tEt(Je.animated&&Je.toRect||s,r.animated&&r.toRect||n,m),V=m?"top":"left",B=mfe(r,"top","top")||mfe(Je,"top","top"),G=B?B.scrollTop:void 0;A2!==r&&($=n[V],wI=!1,tN=!k&&a.invertSwap||I),A=lEt(t,r,n,m,k?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,tN,A2===r);var X;if(A!==0){var K=Rd(Je);do K-=A,X=Yn.children[K];while(X&&(mi(X,"display")==="none"||X===Ui))}if(A===0||X===r)return T(!1);A2=r,bI=A;var re=r.nextElementSibling,q=!1;q=A===1;var L=rN($n,i,Je,s,r,n,t,q);if(L!==!1)return(L===1||L===-1)&&(q=L===1),PY=!0,setTimeout(nEt,30),w(),q&&!re?i.appendChild(Je):r.parentNode.insertBefore(Je,q?re:r),B&&NOe(B,0,G-B.scrollTop),Yn=Je.parentNode,$!==void 0&&!tN&&(K4=Math.abs($-va(r)[V])),S(),T(!0)}if(i.contains(Je))return T(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){Fr(document,"mousemove",this._onTouchMove),Fr(document,"touchmove",this._onTouchMove),Fr(document,"pointermove",this._onTouchMove),Fr(document,"dragover",lw),Fr(document,"mousemove",lw),Fr(document,"touchmove",lw)},_offUpEvents:function(){var t=this.el.ownerDocument;Fr(t,"mouseup",this._onDrop),Fr(t,"touchend",this._onDrop),Fr(t,"pointerup",this._onDrop),Fr(t,"touchcancel",this._onDrop),Fr(document,"selectstart",this)},_onDrop:function(t){var i=this.el,r=this.options;if(dh=Rd(Je),Wv=Rd(Je,r.draggable),Jc("drop",this,{evt:t}),Yn=Je&&Je.parentNode,dh=Rd(Je),Wv=Rd(Je,r.draggable),gi.eventCanceled){this._nulling();return}xE=!1,tN=!1,wI=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),$Y(this.cloneId),$Y(this._dragStartId),this.nativeDraggable&&(Fr(document,"drop",this),Fr(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),yI&&mi(document.body,"user-select",""),mi(Je,"transform",""),t&&(g3&&(t.cancelable&&t.preventDefault(),!r.dropBubble&&t.stopPropagation()),Ui&&Ui.parentNode&&Ui.parentNode.removeChild(Ui),($n===Yn||rl&&rl.lastPutMode!=="clone")&&Bn&&Bn.parentNode&&Bn.parentNode.removeChild(Bn),Je&&(this.nativeDraggable&&Fr(Je,"dragend",this),hG(Je),Je.style["will-change"]="",g3&&!xE&&lh(Je,rl?rl.options.ghostClass:this.options.ghostClass,!1),lh(Je,this.options.chosenClass,!1),Tc({sortable:this,name:"unchoose",toEl:Yn,newIndex:null,newDraggableIndex:null,originalEvent:t}),$n!==Yn?(dh>=0&&(Tc({rootEl:Yn,name:"add",toEl:Yn,fromEl:$n,originalEvent:t}),Tc({sortable:this,name:"remove",toEl:Yn,originalEvent:t}),Tc({rootEl:Yn,name:"sort",toEl:Yn,fromEl:$n,originalEvent:t}),Tc({sortable:this,name:"sort",toEl:Yn,originalEvent:t})),rl&&rl.save()):dh!==KE&&dh>=0&&(Tc({sortable:this,name:"update",toEl:Yn,originalEvent:t}),Tc({sortable:this,name:"sort",toEl:Yn,originalEvent:t})),gi.active&&((dh==null||dh===-1)&&(dh=KE,Wv=vI),Tc({sortable:this,name:"end",toEl:Yn,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){Jc("nulling",this),$n=Je=Yn=Ui=cx=Bn=J4=i1=aw=Ip=g3=dh=Wv=KE=vI=A2=bI=rl=eN=gi.dragged=gi.ghost=gi.clone=gi.active=null,x6.forEach(function(t){t.checked=!0}),x6.length=lG=cG=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":Je&&(this._onDragOver(t),sEt(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],i,r=this.el.children,s=0,n=r.length,o=this.options;s<n;s++)i=r[s],Ym(i,o.draggable,this.el,!1)&&t.push(i.getAttribute(o.dataIdAttr)||uEt(i));return t},sort:function(t,i){var r={},s=this.el;this.toArray().forEach(function(n,o){var a=s.children[o];Ym(a,this.options.draggable,s,!1)&&(r[n]=a)},this),i&&this.captureAnimationState(),t.forEach(function(n){r[n]&&(s.removeChild(r[n]),s.appendChild(r[n]))}),i&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,i){return Ym(t,i||this.options.draggable,this.el,!1)},option:function(t,i){var r=this.options;if(i===void 0)return r[t];var s=rL.modifyOption(this,t,i);typeof s!="undefined"?r[t]=s:r[t]=i,t==="group"&&BOe(r)},destroy:function(){Jc("destroy",this);var t=this.el;t[Ih]=null,Fr(t,"mousedown",this._onTapStart),Fr(t,"touchstart",this._onTapStart),Fr(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(Fr(t,"dragover",this),Fr(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(i){i.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),w6.splice(w6.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!i1){if(Jc("hideClone",this),gi.eventCanceled)return;mi(Bn,"display","none"),this.options.removeCloneOnHide&&Bn.parentNode&&Bn.parentNode.removeChild(Bn),i1=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(i1){if(Jc("showClone",this),gi.eventCanceled)return;Je.parentNode==$n&&!this.options.group.revertClone?$n.insertBefore(Bn,Je):cx?$n.insertBefore(Bn,cx):$n.appendChild(Bn),this.options.group.revertClone&&this.animate(Je,Bn),mi(Bn,"display",""),i1=!1}}};function sEt(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}function rN(e,t,i,r,s,n,o,a){var l,c=e[Ih],h=c.options.onMove,p;return window.CustomEvent&&!o_&&!iL?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=e,l.dragged=i,l.draggedRect=r,l.related=s||t,l.relatedRect=n||va(t),l.willInsertAfter=a,l.originalEvent=o,e.dispatchEvent(l),h&&(p=h.call(c,l,o)),p}function hG(e){e.draggable=!1}function nEt(){PY=!1}function oEt(e,t,i){var r=va(WA(i.el,0,i.options,!0)),s=10;return t?e.clientX<r.left-s||e.clientY<r.top&&e.clientX<r.right:e.clientY<r.top-s||e.clientY<r.bottom&&e.clientX<r.left}function aEt(e,t,i){var r=va(Fte(i.el,i.options.draggable)),s=10;return t?e.clientX>r.right+s||e.clientX<=r.right&&e.clientY>r.bottom&&e.clientX>=r.left:e.clientX>r.right&&e.clientY>r.top||e.clientX<=r.right&&e.clientY>r.bottom+s}function lEt(e,t,i,r,s,n,o,a){var l=r?e.clientY:e.clientX,c=r?i.height:i.width,h=r?i.top:i.left,p=r?i.bottom:i.right,f=!1;if(!o){if(a&&K4<c*s){if(!wI&&(bI===1?l>h+c*n/2:l<p-c*n/2)&&(wI=!0),wI)f=!0;else if(bI===1?l<h+K4:l>p-K4)return-bI}else if(l>h+c*(1-s)/2&&l<p-c*(1-s)/2)return cEt(t)}return f=f||o,f&&(l<h+c*n/2||l>p-c*n/2)?l>h+c/2?1:-1:0}function cEt(e){return Rd(Je)<Rd(e)?1:-1}function uEt(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,r=0;i--;)r+=t.charCodeAt(i);return r.toString(36)}function hEt(e){x6.length=0;for(var t=e.getElementsByTagName("input"),i=t.length;i--;){var r=t[i];r.checked&&x6.push(r)}}function Q4(e){return setTimeout(e,0)}function $Y(e){return clearTimeout(e)}zV&&Qr(document,"touchmove",function(e){(gi.active||xE)&&e.cancelable&&e.preventDefault()});gi.utils={on:Qr,off:Fr,css:mi,find:DOe,is:function(t,i){return!!Ym(t,i,t,!1)},extend:W2t,throttle:FOe,closest:Ym,toggleClass:lh,clone:kOe,index:Rd,nextTick:Q4,cancelNextTick:$Y,detectDirection:VOe,getChild:WA};gi.get=function(e){return e[Ih]};gi.mount=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0].constructor===Array&&(t=t[0]),t.forEach(function(r){if(!r.prototype||!r.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(r));r.utils&&(gi.utils=Dg(Dg({},gi.utils),r.utils)),rL.mount(r)})};gi.create=function(e,t){return new gi(e,t)};gi.version=j2t;var Vo=[],y3,LY,DY=!1,dG,pG,T6,_3;function dEt(){function e(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return e.prototype={dragStarted:function(i){var r=i.originalEvent;this.sortable.nativeDraggable?Qr(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Qr(document,"pointermove",this._handleFallbackAutoScroll):r.touches?Qr(document,"touchmove",this._handleFallbackAutoScroll):Qr(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(i){var r=i.originalEvent;!this.options.dragOverBubble&&!r.rootEl&&this._handleAutoScroll(r)},drop:function(){this.sortable.nativeDraggable?Fr(document,"dragover",this._handleAutoScroll):(Fr(document,"pointermove",this._handleFallbackAutoScroll),Fr(document,"touchmove",this._handleFallbackAutoScroll),Fr(document,"mousemove",this._handleFallbackAutoScroll)),bfe(),e5(),X2t()},nulling:function(){T6=LY=y3=DY=_3=dG=pG=null,Vo.length=0},_handleFallbackAutoScroll:function(i){this._handleAutoScroll(i,!0)},_handleAutoScroll:function(i,r){var s=this,n=(i.touches?i.touches[0]:i).clientX,o=(i.touches?i.touches[0]:i).clientY,a=document.elementFromPoint(n,o);if(T6=i,r||this.options.forceAutoScrollFallback||iL||o_||yI){fG(i,this.options,a,r);var l=S1(a,!0);DY&&(!_3||n!==dG||o!==pG)&&(_3&&bfe(),_3=setInterval(function(){var c=S1(document.elementFromPoint(n,o),!0);c!==l&&(l=c,e5()),fG(i,s.options,c,r)},10),dG=n,pG=o)}else{if(!this.options.bubbleScroll||S1(a,!0)===wg()){e5();return}fG(i,this.options,S1(a,!1),!1)}}},B0(e,{pluginName:"scroll",initializeByDefault:!0})}function e5(){Vo.forEach(function(e){clearInterval(e.pid)}),Vo=[]}function bfe(){clearInterval(_3)}var fG=FOe(function(e,t,i,r){if(!!t.scroll){var s=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,o=t.scrollSensitivity,a=t.scrollSpeed,l=wg(),c=!1,h;LY!==i&&(LY=i,e5(),y3=t.scroll,h=t.scrollFn,y3===!0&&(y3=S1(i,!0)));var p=0,f=y3;do{var m=f,y=va(m),_=y.top,b=y.bottom,w=y.left,T=y.right,S=y.width,E=y.height,M=void 0,A=void 0,$=m.scrollWidth,I=m.scrollHeight,k=mi(m),V=m.scrollLeft,B=m.scrollTop;m===l?(M=S<$&&(k.overflowX==="auto"||k.overflowX==="scroll"||k.overflowX==="visible"),A=E<I&&(k.overflowY==="auto"||k.overflowY==="scroll"||k.overflowY==="visible")):(M=S<$&&(k.overflowX==="auto"||k.overflowX==="scroll"),A=E<I&&(k.overflowY==="auto"||k.overflowY==="scroll"));var G=M&&(Math.abs(T-s)<=o&&V+S<$)-(Math.abs(w-s)<=o&&!!V),X=A&&(Math.abs(b-n)<=o&&B+E<I)-(Math.abs(_-n)<=o&&!!B);if(!Vo[p])for(var K=0;K<=p;K++)Vo[K]||(Vo[K]={});(Vo[p].vx!=G||Vo[p].vy!=X||Vo[p].el!==m)&&(Vo[p].el=m,Vo[p].vx=G,Vo[p].vy=X,clearInterval(Vo[p].pid),(G!=0||X!=0)&&(c=!0,Vo[p].pid=setInterval(function(){r&&this.layer===0&&gi.active._onTouchMove(T6);var re=Vo[this.layer].vy?Vo[this.layer].vy*a:0,q=Vo[this.layer].vx?Vo[this.layer].vx*a:0;typeof h=="function"&&h.call(gi.dragged.parentNode[Ih],q,re,e,T6,Vo[this.layer].el)!=="continue"||NOe(Vo[this.layer].el,q,re)}.bind({layer:p}),24))),p++}while(t.bubbleScroll&&f!==l&&(f=S1(f,!1)));DY=c}},30),jOe=function(t){var i=t.originalEvent,r=t.putSortable,s=t.dragEl,n=t.activeSortable,o=t.dispatchSortableEvent,a=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(!!i){var c=r||n;a();var h=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,p=document.elementFromPoint(h.clientX,h.clientY);l(),c&&!c.el.contains(p)&&(o("spill"),this.onSpill({dragEl:s,putSortable:r}))}};function Nte(){}Nte.prototype={startIndex:null,dragStart:function(t){var i=t.oldDraggableIndex;this.startIndex=i},onSpill:function(t){var i=t.dragEl,r=t.putSortable;this.sortable.captureAnimationState(),r&&r.captureAnimationState();var s=WA(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(i,s):this.sortable.el.appendChild(i),this.sortable.animateAll(),r&&r.animateAll()},drop:jOe};B0(Nte,{pluginName:"revertOnSpill"});function kte(){}kte.prototype={onSpill:function(t){var i=t.dragEl,r=t.putSortable,s=r||this.sortable;s.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),s.animateAll()},drop:jOe};B0(kte,{pluginName:"removeOnSpill"});gi.mount(new dEt);gi.mount(kte,Nte);function wfe(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const pEt="esri-layerlist-new-ui",fEt=Qe.ofType(Dte),xfe="data-sort-filter",Tfe="data-layer-uid",mEt="layerUid",Zn="esri-layer-list",In=`${Zn}__item`,lt={base:`${Zn} esri-widget esri-widget--panel`,newUI:`${Zn}--new-ui`,noItems:`${Zn}__no-items`,list:`${Zn}__list`,listRoot:`${Zn}__list--root`,listExclusive:`${Zn}__list--exclusive`,listInherited:`${Zn}__list--inherited`,listIndependent:`${Zn}__list--independent`,item:In,itemContent:`${In}-content`,itemMessage:`${In}--has-message`,itemInvisible:`${In}--invisible`,itemInvisibleAtScale:`${In}--invisible-at-scale`,itemChildren:`${In}--has-children`,itemSelectable:`${In}--selectable`,itemContainer:`${In}-container`,actionsMenu:`${In}-actions-menu`,actionsMenuItem:`${In}-actions-menu-item`,actionsMenuItemActive:`${In}-actions-menu-item--active`,actions:`${In}-actions`,actionsList:`${In}-actions-list`,action:`${In}-action`,actionIcon:`${In}-action-icon`,actionImage:`${In}-action-image`,actionTitle:`${In}-action-title`,actionToggle:`${Zn}__action-toggle`,actionToggleOn:`${Zn}__action-toggle--on`,label:`${In}-label`,message:`${In}-message`,title:`${In}-title`,statusIndicator:`${Zn}__status-indicator`,publishing:`${Zn}__publishing`,updating:`${Zn}__updating`,connectionStatus:`${Zn}__connection-status`,connectionStatusConnected:`${Zn}__connection-status--connected`,toggleVisible:`${In}-toggle`,toggleVisibleIcon:`${In}-toggle-icon`,toggleIcon:`${In}-toggle-icon`,radioIcon:`${In}-radio-icon`,childToggle:`${Zn}__child-toggle`,childToggleOpen:`${Zn}__child-toggle--open`,childOpened:`${Zn}__child-toggle-icon--opened`,childClosed:`${Zn}__child-toggle-icon--closed`,childClosed_RTL:`${Zn}__child-toggle-icon--closed-rtl`,sortableChosen:`${Zn}--chosen`,disabled:"esri-disabled",disabledElement:"esri-disabled-element",hidden:"esri-hidden",rotating:"esri-rotating",iconEllipses:"esri-icon-handle-horizontal",iconVisible:"esri-icon-visible",iconInvisible:"esri-icon-non-visible",iconRadioSelected:"esri-icon-radio-checked",iconRadioUnselected:"esri-icon-radio-unchecked",iconNoticeTriangle:"esri-icon-notice-triangle",iconChildrenOpen:"esri-icon-down-arrow",iconDownArrow:"esri-icon-down-arrow",iconRightArrow:"esri-icon-right-triangle-arrow",iconLeftArrow:"esri-icon-left-triangle-arrow",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",widgetIcon:"esri-icon-layers"},mG={actions:"actions",actionSection:"action-section",items:"items"},jR={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function HOe(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach(r=>HOe(r))}const gG="root",Sfe={statusIndicators:!0,errors:!1};let vn=class extends pn{constructor(e,t){super(e,t),this._handles=new Ii,this._sortableNodes=new Map,this._sortableMap=new Map,this._focusSortUid=null,this._newUI=he(pEt),this._tooltipReferenceMap=new Map,this.visibleItems=null,this.iconClass=lt.widgetIcon,this.listItemCanGiveFunction=null,this.listItemCanReceiveFunction=null,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.selectionEnabled=!1,this.selectedItems=new fEt,this.viewModel=new IOe,this.visibleElements={...Sfe},this._onSortableSort=({to:i,from:r,item:s,newIndex:n})=>{r&&i&&(r===i?this._sortLayers(this._sortableMap.get(r.dataset.group)):this._moveLayerFromChildList({to:i,from:r,item:s,newIndex:n}))},this._sortableCanSort=(i,r)=>!(!i.el.dataset.group||!r.el.dataset.group),this._sortableCanPull=(i,r,s)=>{const{listItemCanGiveFunction:n}=this,o={selected:s["data-item"],from:r.el["data-item"],to:i.el["data-item"]};return!this._sortableCanSort(i,r)||typeof n!="function"||n.call(null,o)},this._sortableCanPut=(i,r,s)=>{const{listItemCanReceiveFunction:n}=this,o={selected:s["data-item"],from:r.el["data-item"],to:i.el["data-item"]};return!this._sortableCanSort(i,r)||typeof n!="function"||n.call(null,o)},this._onSortableEnd=({oldIndex:i,from:r,to:s,item:n})=>{r!==s&&r.insertBefore(n,r.children[i])}}initialize(){const e=this.operationalItems;this._setVisibleItems(e),this.addHandles([Fs(()=>this.operationalItems,"change",()=>this._itemsChanged(e)),te(()=>this.visibleElements,()=>this._itemsChanged(e)),te(()=>this.selectionEnabled,()=>this._toggleAllSorting(),st)])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-icon.cd430452.js"),["assets/calcite-icon.cd430452.js","assets/icon.2acbc95d.js","assets/observers.0143061c.js"]),Q(()=>import("./calcite-tooltip.02366f89.js"),["assets/calcite-tooltip.02366f89.js","assets/tooltip.ef998d8f.js","assets/openCloseComponent.79fe4357.js","assets/debounce.aad9914a.js","assets/guid.ba2965fd.js"])])}destroy(){this._destroySortables(),this._tooltipReferenceMap.clear(),this._handles.destroy(),this._handles=null}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(e){this.viewModel.listItemCreatedFunction=e}get operationalItems(){return this.viewModel.operationalItems}set operationalItems(e){this.viewModel.operationalItems=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...Sfe,...e}}triggerAction(e,t){return this.viewModel.triggerAction(e,t)}render(){var o;const{visibleItems:e,_newUI:t}=this,i=(o=this.viewModel)==null?void 0:o.state,r={[lt.newUI]:t,[lt.hidden]:i==="loading",[lt.disabled]:i==="disabled"},s=this.renderItemTooltips(),n=this.renderItems();return D("div",{class:this.classes(lt.base,r)},e!=null&&e.length?[s,n]:this.renderNoItems())}renderItemTooltip(e){const{_tooltipReferenceMap:t,messages:i}=this;return e?D("calcite-tooltip",{label:i.layerIncompatible,referenceElement:t.get(e.uid)},i.layerIncompatibleTooltip):null}renderItemTooltipNodes(e){const{incompatible:t,children:i}=e;return[t?this.renderItemTooltip(e):null,...t?[]:i==null?void 0:i.toArray().map(r=>this.renderItemTooltipNodes(r))]}renderItemTooltips(){return this.visibleItems.toArray().map(e=>this.renderItemTooltipNodes(e))}renderNoItems(){return D("div",{class:lt.noItems},this.messages.noItemsToDisplay)}renderItems(){const{visibleItems:e,selectionEnabled:t,messages:i}=this;return D("ul",{"aria-label":i.widgetLabel,role:t?"listbox":void 0,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,"data-group":gG,bind:this,class:this.classes(lt.list,lt.listRoot,lt.listIndependent)},e==null?void 0:e.map(r=>this.renderItem(r,null)).toArray())}renderActionsMenuIcon(e,t){const{messagesCommon:i}=this,r={[lt.actionsMenuItemActive]:e.actionsOpen};return D("div",{key:"actions-menu-toggle","data-item":e,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(lt.actionsMenuItem,r),tabindex:"0",role:"button","aria-controls":t,"aria-label":i.options,title:i.options},D("span",{"aria-hidden":"true",class:lt.iconEllipses}))}renderActionsMenu(e,t,i,r){const{panel:s}=e,n=s&&s.visible?this.renderPanelButton(s):null,o=i===1&&this._getSingleActionButton(t),a=o?this.renderAction({item:e,action:o,singleAction:!0}):null,l=!o&&i?this.renderActionsMenuIcon(e,r):null;return l||n||o?D("div",{key:"actions-menu",class:lt.actionsMenu},n,a,l):null}renderChildList(e,t){var h;const{selectionEnabled:i}=this,{visibilityMode:r,children:s}=e,n=this._hasChildren(e),o=!n&&i&&((h=e.layer)==null?void 0:h.type)==="group",{exclusive:a,inherited:l}=jR,c={[lt.listExclusive]:r===a,[lt.listInherited]:r===l,[lt.listIndependent]:r!==l&&r!==a};return n||o?D("ul",{bind:this,key:"list-items",id:t,"data-group":e.uid,"data-item":e,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,class:this.classes(lt.list,c),"aria-expanded":e.open?"true":"false",role:i?"listbox":r===a?"radiogroup":"group",hidden:!e.open&&!o||null},s==null?void 0:s.map(p=>this.renderItem(p,e)).toArray()):null}renderChildrenToggle(e,t){const{messagesCommon:i}=this,r=this._hasChildren(e),s={[lt.childToggleOpen]:e.open},n=e.open?i.collapse:i.expand;return r?D("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":e,key:"toggle-children",class:this.classes(lt.childToggle,s),tabindex:"0",role:"button","aria-controls":t,"aria-label":n,title:n},D("span",{"aria-hidden":"true",class:this.classes(lt.childClosed,lt.iconRightArrow)}),D("span",{"aria-hidden":"true",class:this.classes(lt.childOpened,lt.iconDownArrow)}),D("span",{"aria-hidden":"true",class:this.classes(lt.childClosed_RTL,lt.iconLeftArrow)})):null}renderItemMessage(e){return e.error?D("div",{key:"esri-layer-list__error",class:lt.message,role:"alert"},D("span",{"aria-hidden":"true",class:lt.iconNoticeTriangle}),this.messages.layerError):e.incompatible?D("div",{key:"esri-layer-list__incompatible",class:lt.message,role:"alert"},D("span",{bind:this,tabIndex:0,"aria-hidden":"true",class:lt.iconNoticeTriangle,afterCreate:t=>this._setTooltipReference(t,e)}),this.messages.layerIncompatible):null}renderItemContent(e,t,i){const{id:r}=this,s=`${r}_${e.uid}`,n=`${s}_actions`,o=`${s}__list`,{panel:a}=e,l=this._filterActions(e.actionsSections),c=this._countActions(l);return[D("div",{key:"list-item-container",class:lt.itemContainer},this.renderChildrenToggle(e,o),this.renderLabel(e,t,i),this.renderActionsMenu(e,l,c,n)),this.renderItemMessage(e),c?this.renderActionsSections(e,l,n):null,a&&a.open&&!a.disabled?a.render():null,this.renderChildList(e,o)]}renderItem(e,t){var h;const{_newUI:i,id:r,selectionEnabled:s,selectedItems:n}=this,o=`${`${r}_${e.uid}`}__title`,a=this._hasMessage(e),l=this._hasChildren(e),c={[lt.itemChildren]:l,[lt.itemMessage]:!!a,[lt.itemInvisible]:i&&!e.visible,[lt.itemInvisibleAtScale]:!e.visibleAtCurrentScale,[lt.itemSelectable]:s};if(s){const p={[Tfe]:(h=e.layer)==null?void 0:h.uid,[xfe]:(!e.sortable).toString()};return D("li",{key:`item-with-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(lt.item,c),"aria-labelledby":o,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item":e,"data-group":t?t.uid:gG,tabIndex:0,"aria-selected":sG(e,n)?"true":"false",role:"option",...p},this.renderItemContent(e,t,o))}return D("li",{key:`item-no-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(lt.item,c),"aria-labelledby":o},this.renderItemContent(e,t,o))}renderConnectionIcon(e){const{connectionStatus:t}=e;return v(t)?D("calcite-icon",{icon:t==="connected"?"check-circle":"offline",scale:"s"}):null}renderItemStatus(e,t){const{visibleElements:i}=this;if(!i.statusIndicators)return null;const{connectionStatus:r,publishing:s,updating:n}=e,o=n&&!t,a=!!r;return D("span",{class:this.classes({[lt.statusIndicator]:!0,[lt.publishing]:s,[lt.updating]:o,[lt.connectionStatus]:a,[lt.connectionStatusConnected]:a&&r==="connected"}),key:"layer-item-status"},this.renderConnectionIcon(e))}renderItemTitle(e,t){const{messages:i}=this;if(!e)return null;const r=e.title||i.untitledLayer,s=e.visibleAtCurrentScale?r:`${r} (${i.layerInvisibleAtScale})`;return D("span",{key:"layer-title-container",id:t,title:s,"aria-label":s,class:lt.title},r)}renderItemToggleIcon(e,t){const{_newUI:i}=this,{exclusive:r}=jR,s=t&&t.visibilityMode,n={[lt.toggleVisibleIcon]:i,[lt.toggleIcon]:i&&s!==r,[lt.radioIcon]:i&&s===r,[lt.iconRadioSelected]:s===r&&e.visible,[lt.iconRadioUnselected]:s===r&&!e.visible,[lt.iconVisible]:s!==r&&e.visible,[lt.iconInvisible]:s!==r&&!e.visible};return D("span",{key:"item-toggle-icon",class:this.classes(n),"aria-hidden":"true"})}renderItemToggle(e,t,i){const{selectionEnabled:r,messages:s}=this,{exclusive:n}=jR,o=t&&t.visibilityMode,a=o===n?"radio":"switch";return D("span",r?{key:"item-toggle-selection-enabled",class:lt.toggleVisible,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":o,tabIndex:0,title:e.visible?s.hideLayer:s.showLayer,"aria-checked":e.visible?"true":"false",role:a,"aria-labelledby":i}:{key:"item-toggle",class:lt.toggleVisible},this.renderItemToggleIcon(e,t))}renderLabel(e,t,i){const{selectionEnabled:r,_newUI:s,messages:n}=this,{inherited:o,exclusive:a}=jR,l=t==null?void 0:t.visibilityMode,c=l===a?"radio":"switch",h=s?[this.renderItemTitle(e,i),this.renderItemStatus(e,t),this.renderItemToggle(e,t,i)]:[this.renderItemToggle(e,t,i),this.renderItemTitle(e,i),this.renderItemStatus(e,t)],p=D("div",r?{key:`item-label-no-selection-${e.uid}`,class:lt.label}:{key:`item-label-with-selection-${e.uid}`,class:lt.label,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":l,tabIndex:0,"aria-checked":e.visible?"true":"false",title:e.visible?n.hideLayer:n.showLayer,role:c,"aria-labelledby":i},h);return l===o||e.error?D("div",{key:`item-label-container-${e.uid}`,class:lt.label},this.renderItemTitle(e,i),this.renderItemStatus(e,t)):p}renderPanelButton(e){const{className:t,open:i,title:r,image:s}=e,n=s||t?t:lt.iconDefaultAction,o=this._getIconImageStyles(e),a={[lt.actionsMenuItemActive]:i},l={[lt.actionImage]:!!o["background-image"],[lt.disabledElement]:e.disabled};return n&&(l[n]=!!n),D("div",{"aria-disabled":e.disabled.toString(),key:`panel-${e.uid}`,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(lt.actionsMenuItem,a),role:"button",tabindex:e.disabled?null:0,title:r,"aria-label":r},D("span",{class:this.classes(l),styles:o}))}renderActionsSections(e,t,i){const r=t.toArray().map((s,n)=>D("ul",{key:`${e}-action-section-${n}`,class:lt.actionsList},this.renderActionSection(e,s)));return D("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"actions-section",id:i,class:lt.actions,hidden:!e.actionsOpen||null},r)}renderActionSection(e,t){return(t&&t.toArray()).map(i=>this.renderAction({item:e,action:i}))}renderActionIcon(e){const{active:t,className:i}=e,r=this._getIconImageStyles(e),s=e.type!=="button"||e.image||i?i:lt.iconDefaultAction,n={[lt.actionImage]:!t&&!!r["background-image"],[lt.iconLoading]:t,[lt.rotating]:t};return s&&!t&&(n[s]=!0),D("span",{key:"action-icon","aria-hidden":"true",class:this.classes(lt.actionIcon,n),styles:r})}renderActionTitle(e,t){return t?null:D("span",{key:"action-title",class:lt.actionTitle},e)}renderAction(e){const{item:t,action:i,singleAction:r}=e,{active:s,disabled:n,title:o}=i,a={[lt.actionsMenuItem]:r&&i.type==="button",[lt.action]:s||!r&&i.type!=="toggle",[lt.actionToggle]:!s&&i.type==="toggle",[lt.actionToggleOn]:!s&&i.type==="toggle"&&i.value,[lt.disabledElement]:n},l=[this.renderActionIcon(i),this.renderActionTitle(o,r)];return r?D("div",{bind:this,"data-item":t,"data-action":i,role:"button",key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",title:o,"aria-label":o},l):D("li",{bind:this,"data-item":t,"data-action":i,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",role:"button",title:o,"aria-label":o},l)}_setTooltipReference(e,t){this._tooltipReferenceMap.set(t.uid,e),this.scheduleRender()}_hasMessage(e){return!!e.error||e.incompatible}_hasChildren(e){return!!e.children.length&&!this._hasMessage(e)}_sortNodeRemoved(e){const{_sortableMap:t}=this,i=e.dataset.group,r=t.get(i);r&&r.destroy(),t.delete(i)}_destroySortables(){const{_sortableMap:e,_sortableNodes:t}=this;e.forEach(i=>i&&i.destroy()),e.clear(),t.clear()}_moveLayerFromChildList({to:e,from:t,item:i,newIndex:r}){const s=i["data-item"],n=e["data-item"],o=t["data-item"];this.viewModel.moveListItem(s,o,n,r)}_sortLayers(e){var r,s;if(!e)return;const t=e.el["data-item"],i=e.toArray();t?$2t(t,i):COe((s=(r=this.view)==null?void 0:r.map)==null?void 0:s.layers,i)}_toggleSorting(e,t){const{_sortableMap:i,selectionEnabled:r}=this,s=i.get(t),n=e["data-item"],o=(t===gG||n.childrenSortable&&O2t(n))&&r;if(s)s.option("disabled",!o);else if(o){const a=gi.create(e,{dataIdAttr:Tfe,group:{name:t,pull:this._sortableCanPull,put:this._sortableCanPut},filter:`[${xfe}="true"]`,fallbackTolerance:4,onSort:this._onSortableSort,onEnd:this._onSortableEnd,disabled:!o,chosenClass:lt.sortableChosen});i.set(t,a)}}_toggleAllSorting(){this._sortableNodes.forEach((e,t)=>this._toggleSorting(e,t))}_sortNodeCreated(e){const t=e.dataset.group;t&&(this._sortableNodes.set(t,e),this._toggleSorting(e,t))}_setVisibleItems(e){this.visibleItems=e==null?void 0:e.filter(t=>!t.hidden&&(this.visibleElements.errors||!t.error))}_getSingleActionButton(e){return e.reduce(t=>t).filter(t=>t&&t.type==="button").getItemAt(0)}_focusListItem(e){var i;const{_focusSortUid:t}=this;!e||!t||((i=e["data-item"].layer)==null?void 0:i.uid)===t&&(e.focus(),this._focusSortUid=null)}_watchActionSectionChanges(e,t){const i=mG.actionSection+t;this._handles.add(e.on("change",this.scheduleRender.bind(this)),i),e.forEach(r=>this._renderOnActionChanges(r,t))}_renderOnActionChanges(e,t){const i=mG.actions+t;e.type!=="toggle"?e.type!=="slider"?this._handles.add(te(()=>[e==null?void 0:e.className,e==null?void 0:e.image,e==null?void 0:e.id,e==null?void 0:e.title,e==null?void 0:e.visible],()=>this.scheduleRender(),st),i):this._handles.add(te(()=>[e==null?void 0:e.className,e==null?void 0:e.id,e==null?void 0:e.title,e==null?void 0:e.visible,e==null?void 0:e.value,e==null?void 0:e.displayValueEnabled,e==null?void 0:e.max,e==null?void 0:e.min,e==null?void 0:e.step],()=>this.scheduleRender(),st),i):this._handles.add(te(()=>[e==null?void 0:e.className,e==null?void 0:e.image,e==null?void 0:e.id,e==null?void 0:e.title,e==null?void 0:e.visible,e==null?void 0:e.value],()=>this.scheduleRender(),st),i)}_renderOnItemChanges(e){const t=e.uid,i=mG.items+t;this._handles.add([te(()=>{var r,s,n;return[e==null?void 0:e.actionsOpen,e==null?void 0:e.visible,e==null?void 0:e.open,e==null?void 0:e.updating,e==null?void 0:e.connectionStatus,e==null?void 0:e.publishing,e==null?void 0:e.title,e==null?void 0:e.visibleAtCurrentScale,e==null?void 0:e.error,e==null?void 0:e.visibilityMode,e==null?void 0:e.panel,(r=e==null?void 0:e.panel)==null?void 0:r.title,(s=e==null?void 0:e.panel)==null?void 0:s.content,(n=e==null?void 0:e.panel)==null?void 0:n.className,e==null?void 0:e.sortable,e==null?void 0:e.childrenSortable]},()=>this.scheduleRender(),Gs),te(()=>[e==null?void 0:e.hidden,e==null?void 0:e.error],()=>this._setVisibleItems(this.operationalItems)),e.actionsSections.on("change",()=>this.scheduleRender()),e.children.on("change",()=>this.scheduleRender())],i),e.children.forEach(r=>this._renderOnItemChanges(r)),e.actionsSections.forEach(r=>this._watchActionSectionChanges(r,t))}_itemsChanged(e){this._handles.removeAll(),e.forEach(t=>this._renderOnItemChanges(t)),this._tooltipReferenceMap.clear(),this._setVisibleItems(e),this.scheduleRender()}_filterActions(e){return e.map(t=>t.filter(i=>i.visible))}_countActions(e){return e.reduce((t,i)=>t+i.length,0)}_getIconImageStyles(e){const t=e.declaredClass==="esri.widgets.LayerList.ListItemPanel"||e.declaredClass==="esri.support.Action.ActionButton"||e.declaredClass==="esri.support.Action.ActionToggle"?e.image:null;return{"background-image":t?`url("${t}")`:null}}_selectionKeydown(e){var m,y,_,b;const t=["ArrowDown","ArrowUp"],i=Pc(e);if(!t.includes(i))return void this._toggleSelection(e);e.stopPropagation();const r=e.currentTarget,s=r["data-item"],{_sortableMap:n,selectedItems:o}=this,a=r.dataset.group,l=n.get(a);if(!l)return;const c=sG(s,o),h=l.toArray(),p=e.target,f=h.indexOf(p.dataset[mEt]);if(f!==-1){if(i==="ArrowDown"){const w=f+1;if(w>=h.length)return;c?(wfe(h,f,w),l.sort(h),this._sortLayers(l),this._focusSortUid=(m=s.layer)==null?void 0:m.uid):(this._focusSortUid=(y=s.layer)==null?void 0:y.uid,this.scheduleRender())}if(i==="ArrowUp"){const w=f-1;if(w<=-1)return;c?(wfe(h,f,w),l.sort(h),this._sortLayers(l),this._focusSortUid=(_=s.layer)==null?void 0:_.uid):(this._focusSortUid=(b=s.layer)==null?void 0:b.uid,this.scheduleRender())}}}_toggleActionsOpen(e){const t=e.currentTarget["data-item"],{actionsOpen:i}=t,r=!i;r&&this.operationalItems.forEach(s=>HOe(s)),t.actionsOpen=r,e.stopPropagation()}_triggerPanel(e){const t=e.currentTarget["data-panel"];e.stopPropagation(),t&&!t.disabled&&(t.open=!t.open)}_triggerAction(e){const t=e.currentTarget,i=t["data-action"],r=t["data-item"];i.type==="toggle"&&(i.value=!i.value),this.triggerAction(i,r),e.stopPropagation()}_toggleVisibility(e){const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),r=t["data-item"];i===jR.exclusive&&r.visible||(r.visible=!r.visible),e.stopPropagation()}_toggleChildrenClick(e){const t=e.currentTarget["data-item"];t.open=!t.open,e.stopPropagation()}_toggleSelection(e){var o,a;e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,r=e.currentTarget["data-item"],s=sG(r,i),{length:n}=i;if(!t)return n&&!(s&&n===1)?(i.removeAll(),void i.add(r)):void(s?(o=i.remove)==null?void 0:o.call(i,s):i.add(r));s?(a=i.remove)==null||a.call(i,s):i.add(r)}};u([d()],vn.prototype,"visibleItems",void 0),u([d()],vn.prototype,"iconClass",void 0),u([d()],vn.prototype,"label",null),u([d()],vn.prototype,"listItemCanGiveFunction",void 0),u([d()],vn.prototype,"listItemCanReceiveFunction",void 0),u([d()],vn.prototype,"listItemCreatedFunction",null),u([d(),Es("esri/widgets/LayerList/t9n/LayerList")],vn.prototype,"messages",void 0),u([d(),Es("esri/t9n/common")],vn.prototype,"messagesCommon",void 0),u([d()],vn.prototype,"multipleSelectionEnabled",void 0),u([d()],vn.prototype,"operationalItems",null),u([d()],vn.prototype,"selectionEnabled",void 0),u([d()],vn.prototype,"selectedItems",void 0),u([d()],vn.prototype,"view",null),u([O$("trigger-action"),d({type:IOe})],vn.prototype,"viewModel",void 0),u([d()],vn.prototype,"visibleElements",void 0),u([Zt("visibleElements")],vn.prototype,"castVisibleElements",null),u([ln()],vn.prototype,"_toggleActionsOpen",null),u([ln()],vn.prototype,"_triggerPanel",null),u([ln()],vn.prototype,"_triggerAction",null),u([ln()],vn.prototype,"_toggleVisibility",null),u([ln()],vn.prototype,"_toggleChildrenClick",null),u([ln()],vn.prototype,"_toggleSelection",null),vn=u([P("esri.widgets.LayerList")],vn);const gEt=vn,mn="esri-search",Ut={base:`${mn} esri-widget`,loader:"esri-widget__loader",loaderText:"esri-widget__loader-text",loaderAnimation:"esri-widget__loader-animation",esriInput:"esri-input",hasMultipleSources:`${mn}--multiple-sources`,isLoading:`${mn}--loading`,isSearching:`${mn}--searching`,showSuggestions:`${mn}--show-suggestions`,showSources:`${mn}--sources`,showWarning:`${mn}--warning`,container:`${mn}__container`,input:`${mn}__input`,inputContainer:`${mn}__input-container`,form:`${mn}__form`,submitButton:`${mn}__submit-button`,sourcesButton:`${mn}__sources-button`,clearButton:`${mn}__clear-button`,sourceName:`${mn}__source-name`,suggestionsMenu:`${mn}__suggestions-menu`,suggestionList:`${mn}__suggestions-list`,suggestionListCurrentLocation:`${mn}__suggestions-list--current-location`,sourcesMenu:`${mn}__sources-menu`,source:`${mn}__source`,warningMenu:`${mn}__warning-menu`,warningMenuBody:`${mn}__warning-body`,warningMenuHeader:`${mn}__warning-header`,warningMenuText:`${mn}__warning-text`,noValueText:`${mn}__no-value-text`,esriWidgetDisabled:"esri-widget--disabled",button:"esri-widget--button",fallbackText:"esri-icon-font-fallback-text",header:"esri-widget__heading",locate:"esri-icon-locate-circled",menu:"esri-menu",menuList:"esri-menu__list",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuHeader:"esri-menu__header",loadingIcon:"esri-icon-loading-indicator esri-rotating",searchIcon:"esri-icon-search",dropdownIcon:"esri-icon-down-arrow esri-search__sources-button--down",dropupIcon:"esri-icon-up-arrow esri-search__sources-button--up",clearIcon:"esri-icon-close",noticeIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-search",disabled:"esri-disabled"},cw="esri-search-result-renderer",vy={base:`${cw} esri-widget`,anchor:"esri-widget__anchor",showMoreResults:`${cw}__more-results--show-more-results`,moreResults:`${cw}__more-results`,moreResultsList:`${cw}__more-results-list`,moreResultsHeader:`${cw}__more-results-header`,moreResultsItem:`${cw}__more-results-item`,moreResultsListHeader:`${cw}__more-results-list-header`};let mo=class extends G0(ge){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};u([d()],mo.prototype,"autoNavigate",void 0),u([d()],mo.prototype,"filter",void 0),u([d()],mo.prototype,"getResults",void 0),u([d()],mo.prototype,"getSuggestions",void 0),u([d()],mo.prototype,"maxResults",void 0),u([d()],mo.prototype,"maxSuggestions",void 0),u([d()],mo.prototype,"minSuggestCharacters",void 0),u([d()],mo.prototype,"outFields",void 0),u([d()],mo.prototype,"placeholder",void 0),u([d()],mo.prototype,"popupEnabled",void 0),u([d()],mo.prototype,"popupTemplate",void 0),u([d()],mo.prototype,"prefix",void 0),u([d()],mo.prototype,"resultGraphicEnabled",void 0),u([d()],mo.prototype,"resultSymbol",void 0),u([d()],mo.prototype,"suggestionsEnabled",void 0),u([d()],mo.prototype,"suffix",void 0),u([d()],mo.prototype,"withinViewEnabled",void 0),u([d()],mo.prototype,"zoomScale",void 0),mo=u([P("esri.widgets.Search.SearchSource")],mo);const Ute=mo,Efe=se.getLogger("esri.widgets.Search.support.geometryUtils");function yEt(e,t){var r,s;if(!t)return Efe.error("missing-parameter: view is missing."),Promise.reject(new H("searchgeometryutils:missing-parameter","view is missing."));if(!e)return Efe.error("missing-parameter: point is missing."),Promise.reject(new H("searchgeometryutils:missing-parameter","point is missing."));if(e.hasZ||t.type==="2d")return Promise.resolve(e);const i=(r=t==null?void 0:t.map)==null?void 0:r.ground;return i&&i.layers.length?i.queryElevation(e,{cache:(s=t.basemapTerrain)==null?void 0:s.elevationQueryCache}).then(n=>n.geometry):Promise.resolve(e)}function Cfe(e){if(C(e))return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":return e.getPoint(0);case"polyline":return e.getPoint(0,0)}return null}function Vte(e,t,i){return C(e)?null:e.type==="extent"?e:e.type==="multipoint"||e.type==="polygon"||e.type==="polyline"?e.extent:e.type==="point"?qOe(e,t,i):void 0}function FY(e,t,i){return C(e)||C(t)?null:qOe(e.center,t,i)}function qOe(e,t,i){const r=e.hasZ?e.z:void 0;return t&&t.map?(i?a7e(t,i):t.extent).clone().centerAt(e).set({zmax:r,zmin:r}):new Gi({xmin:e.x-.25,ymin:e.y-.25,xmax:e.x+.25,ymax:e.y+.25,spatialReference:e.spatialReference,zmin:r,zmax:r})}const _Et=/https?:\/\/services.*\.arcgis\.com/i,vEt=/(?:\{([^}]+)\})/g,NC=se.getLogger("esri.widgets.Search.support.layerSearchUtils");function bEt(e,t){const{exactMatch:i=!1,location:r,maxResults:s,spatialReference:n,source:o,sourceIndex:a,suggestResult:l,view:c}=e,{layer:h,filter:p,zoomScale:f}=o,m=c&&c.scale,y=WOe(o,c),_=t&&t.signal;return YOe(h).then(()=>{const b=h.popupTemplate;return b?b.getRequiredFields(h.fieldsIndex):null}).then(b=>{var B,G,X;const{objectIdField:w,returnZ:T}=h,S=t3e(o);if(!Bte(h,S))throw NC.error("invalid-field: displayField is invalid."),new H("getResults():invalid-field","displayField is invalid.");const E=b&&b.length?b:[S],M=o.outFields||E,A=XOe(M);if(M.includes(w)||A||M.push(w),(B=h.floorInfo)!=null&&B.floorField&&M.push(h.floorInfo.floorField),!(A||S6(h,M)))throw NC.error("invalid-field: outField is invalid."),new H("getResults():invalid-field","outField is invalid.");const $=h.createQuery(),{orderByFields:I}=o;if(I&&($.orderByFields=I),n){$.outSpatialReference=n;const K=1/wl(n);K&&($.maxAllowableOffset=K)}const k=h.geometryType==="mesh"||h.geometryType==="multipatch",V=((X=(G=h.capabilities)==null?void 0:G.data)==null?void 0:X.supportsZ)&&!k;if($.returnZ=V&&T!==!1,$.returnGeometry=!0,$.multipatchOption=k?"xyFootprint":null,M&&($.outFields=M),r)$.geometry=r;else if(l.key)$.objectIds=[l.key];else{const K=o.searchFields||[S];if(!S6(h,K))throw NC.error("invalid-field: search field is invalid."),new H("getResults():invalid-field","search field is invalid.");if(e3e(h)&&($.num=s),y&&($.geometry=y),!l.text.trim())return[];const re=l.text,{prefix:q="",suffix:L=""}=o,N=i3e(`${q}${re}${L}`);QOe(h)&&JOe(h,K)&&!i&&re&&($.fullText=KOe({text:re,searchFields:K}));const U=r3e({searchTerm:N,layer:h,searchFields:K,filter:p,exactMatch:i,query:$,type:"search"});if($.where=U,!ZOe($))return[]}return h.queryFeatures($,{signal:_}).then(K=>PEt(K,c,o,a,S,m,f))})}function wEt(e,t){const{source:i,spatialReference:r,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a,exactMatch:l}=e,{layer:c,filter:h}=i,p=t&&t.signal,f=WOe(i,s);return YOe(c).then(()=>{if(!e3e(c))return[];const m=t3e(i),y=i.searchFields||[m],_=[];i.suggestionTemplate?i.suggestionTemplate.replace(vEt,(V,B)=>(_.push(B),V)):_.push(m);const b=XOe(_);_.includes(c.objectIdField)||b||_.push(c.objectIdField);const w=Bte(c,m),T=b||S6(c,_),S=S6(c,y);if(!w)throw NC.error("invalid-field: displayField is invalid."),new H("getSuggestions():invalid-field","displayField is invalid.");if(!T)throw NC.error("invalid-field: outField is invalid."),new H("getSuggestions():invalid-field","outField is invalid.");if(!S)throw NC.error("invalid-field: search field is invalid."),new H("getSuggestions():invalid-field","search field is invalid.");const E=c.createQuery(),{orderByFields:M}=i;if(M&&(E.orderByFields=M),E.outSpatialReference=r,E.returnGeometry=!1,E.num=o,E.outFields=_,f&&(E.geometry=f),!n.trim())return[];const{prefix:A="",suffix:$=""}=i,I=i3e(`${A}${n}${$}`);QOe(c)&&JOe(c,y)&&!l&&n&&(E.fullText=KOe({text:n,searchFields:y}));const k=r3e({searchTerm:I,layer:c,searchFields:y,filter:h,exactMatch:l,query:E,type:"suggest"});return E.where=k,ZOe(E)?c.queryFeatures(E,{signal:p}).then(V=>OEt(V,i,a,m)):[]})}function WOe(e,t){const{filter:i,withinViewEnabled:r}=e,s=t&&t.extent;return i&&i.geometry||(r&&s?s:void 0)}function XOe(e){return e&&e.includes("*")}async function YOe(e){e&&await e.load()}function ZOe(e){return!(!e.fullText&&!e.where)}function JOe(e,t){const i=e==null?void 0:e.indexes;return!i||!(t!=null&&t.length)?!1:i.filter(r=>r.indexType==="FullText").some(r=>{var n;const s=((n=r.fields)==null?void 0:n.split(",").map(o=>o.trim().toLowerCase()))||[];return t.every(o=>s.includes(o.toLowerCase()))})}function KOe({text:e,searchFields:t}){return e.trim().split(" ").filter(i=>!!i.trim()).map(i=>new Z_e({onFields:t,searchTerm:i,searchType:"prefix"}))}function QOe(e){var t,i,r;return(r=(i=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:i.supportsFullTextSearch)!=null?r:!1}function e3e(e){var t,i,r;return(r=(i=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:i.supportsPagination)!=null?r:!1}function xEt(e){var t,i,r,s;return(s=(r=(i=(t=e==null?void 0:e.fieldsIndex)==null?void 0:t.fields)==null?void 0:i.find(n=>n.type==="string"))==null?void 0:r.name)!=null?s:""}function t3e(e){return e.displayField||e.layer.displayField||xEt(e.layer)}function S6(e,t){return!(!e||!(t!=null&&t.length))&&t.every(i=>Bte(e,i))}function Bte(e,t){return!!e.getField(t)}function TEt(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}function SEt(e,t,i){let r=null;const{codedValues:s}=e;return s&&s.some(n=>{const o=n.name,a=i?o:o.toLowerCase();return(i?t:t.toLowerCase())===a&&(r=n.code.toString(),!0)}),r}function i3e(e){return e.replace(/\'/g,"''")}function HR(e,t){const i=t&&t.where;return i?`(${e}) AND (${i})`:e}function EEt({currentTerm:e,field:t,filter:i,exactMatch:r,url:s,type:n}){const o=t.type,a=t.name;if(o==="string"||o==="date"||o==="global-id"){const l=_Et.test(s),c=l&&TEt(e)?"N":"";return HR(r&&n==="search"?`${a} = ${c}'${e}'`:l?`${a} LIKE ${c}${`'${e}%'`}`:`${`LOWER(${a})`} LIKE ${c}${`'${e.toLowerCase()}%'`}`,i)}if(o==="oid"||o==="small-integer"||o==="integer"||o==="single"||o==="double"){const l=Number(e);return isNaN(l)?null:HR(`${a} = ${l}`,i)}return HR(`${a} = ${e}`,i)}function CEt(e,t){return e?` OR (${t})`:`(${t})`}function r3e({searchTerm:e,layer:t,searchFields:i,filter:r,exactMatch:s,query:n,type:o}){const{definitionExpression:a,url:l}=t;let c="";return!n.fullText&&e&&i&&i.forEach(h=>{const p=t.getField(h),f=typeof t.getFieldDomain=="function"&&t.getFieldDomain(h),m=(f&&f.type==="coded-value"?SEt(f,e,s):null)||e||null;if(m!==null){const y=EEt({currentTerm:m,field:p,filter:r,exactMatch:s,url:l,type:o});y&&(c+=CEt(c,y))}}),a&&c?`(${a}) AND (${c})`:a||c}function AEt(e,t){let i=null;const{codedValues:r}=e;return r&&r.length&&r.some(s=>s.code===t&&(i=s.name,!0)),i}function MEt(e,t){return e[Object.keys(e).find(i=>i.toLowerCase()===t.toLowerCase())]}function s3e(e,t,i){const r=e.sourceLayer,{attributes:s}=e,n=typeof r.getFieldDomain=="function"&&r.getFieldDomain(i);if(t)return gh(t,s);if(i&&s){const o=r.getField(i),a=MEt(s,i);return a==null?"":n&&n.type==="coded-value"?AEt(n,a):(o==null?void 0:o.type)==="date"?Ou(new Date(a)):typeof a=="number"?a.toString():typeof a!="string"?"":a.trim()}return""}function REt(e,t,i,r){const s=e.sourceLayer,{attributes:n}=e,{objectIdField:o}=s,a=n[o];return{text:s3e(e,t.suggestionTemplate,r),key:a,sourceIndex:i}}function OEt(e,t,i,r){return e.features.map(s=>REt(s,t,i,r))}function IEt(e,t,i,r,s,n,o){const a=e.clone(),l=e.sourceLayer,c=l&&l.objectIdField,h=c&&e.attributes[c],p=s3e(e,i.searchTemplate,s),f=Vte(a.geometry,t,n),m=typeof o=="number"?FY(ne(f),t,o):f,y=e.clone();return v(m)&&(y.geometry=zh.fromExtent(m)),{extent:m,target:y,feature:a,key:h,name:p,sourceIndex:r}}function PEt(e,t,i,r,s,n,o){return e.features.map(a=>IEt(a,t,i,r,s,n,o))}var NY;let Qp=NY=class extends Ute{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(t,i)=>bEt({source:this,...t},i),this.getSuggestions=(t,i)=>wEt({source:this,...t},i)}set layer(e){this._set("layer",e),e&&e.load().catch(()=>{})}get name(){var e;return(e=this._getLayerTitle())!=null?e:""}set name(e){this._overrideIfSome("name",e)}clone(){return new NY({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?ne(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?ne(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var e,t;return(t=(e=this.layer.fieldsIndex.fields.find(i=>i.type==="string"))==null?void 0:e.name)!=null?t:""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map(i=>{const r=e.getField(i);return r&&r.alias||i}).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};u([d({json:{read:{source:"field.name"},write:{target:"field.name"}}})],Qp.prototype,"displayField",void 0),u([d({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],Qp.prototype,"exactMatch",void 0),u([d({value:null})],Qp.prototype,"layer",null),u([d()],Qp.prototype,"name",null),u([d({type:[String],json:{write:!0}})],Qp.prototype,"orderByFields",void 0),u([d()],Qp.prototype,"searchFields",void 0),u([d()],Qp.prototype,"searchTemplate",void 0),u([d()],Qp.prototype,"suggestionTemplate",void 0),Qp=NY=u([P("esri.widgets.Search.LayerSearchSource")],Qp);const TE=Qp;function $Et(e){return!!e&&typeof e.x=="number"&&typeof e.y=="number"}function LEt(e){return e&&typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"}let Lv=class extends ge{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};u([d({type:String,json:{write:!0}})],Lv.prototype,"address",void 0),u([d({type:Object,json:{write:!0}})],Lv.prototype,"attributes",void 0),u([d({type:Gi,json:{write:!0}})],Lv.prototype,"extent",void 0),u([d({type:ut,json:{write:!0}})],Lv.prototype,"location",void 0),u([d({type:Number,json:{write:!0}})],Lv.prototype,"score",void 0),Lv=u([P("esri.rest.support.AddressCandidate")],Lv);const n3e=Lv,zte={type:String,json:{read:{source:"token"},write:{target:"token"}}};let tl=class extends ge{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};u([d({type:Object,json:{write:!0}})],tl.prototype,"address",void 0),u([d(zte)],tl.prototype,"apiKey",void 0),u([d({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],tl.prototype,"categories",void 0),u([d({type:String,json:{write:!0}})],tl.prototype,"countryCode",void 0),u([d({type:Boolean,json:{write:!0}})],tl.prototype,"forStorage",void 0),u([d({type:ut,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],tl.prototype,"location",void 0),u([d({type:String,json:{write:!0}})],tl.prototype,"locationType",void 0),u([d({type:String,json:{write:!0}})],tl.prototype,"magicKey",void 0),u([d({type:Number,json:{write:!0}})],tl.prototype,"maxLocations",void 0),u([d({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],tl.prototype,"outFields",void 0),u([d({type:et,json:{read:{source:"outSR"},write:{target:"outSR"}}})],tl.prototype,"outSpatialReference",void 0),u([d({type:Gi,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=i}}}})],tl.prototype,"searchExtent",void 0),tl=u([P("esri.rest.support.AddressToLocationsParameters")],tl),tl.from=zr(tl);const o3e=tl;async function DEt(e,t,i){t=o3e.from(t);const r=_M(e),{address:s,...n}=t.toJSON(),o={...s,...n,f:"json"},a=HU({...r.query,...o}),l=jU(a,i),c=`${r.path}/findAddressCandidates`;return _r(c,l).then(FEt)}function FEt({data:e}){if(!e)return[];const{candidates:t,spatialReference:i}=e;return t?t.map(r=>{if(!r)return;const{extent:s,location:n}=r,o=!s||LEt(s);return $Et(n)&&o?(s&&(s.spatialReference=i),n&&(n.spatialReference=i),n3e.fromJSON(r)):void 0}):[]}let Xy=class extends ge{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};u([d(zte)],Xy.prototype,"apiKey",void 0),u([d({type:ut,json:{write:{writer:(e,t)=>{const i=e?e.clone().normalize():null,r=i!==void 0;t.location=r?i:null}}}})],Xy.prototype,"location",void 0),u([d({type:String,json:{write:!0}})],Xy.prototype,"locationType",void 0),u([d({type:et,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Xy.prototype,"outSpatialReference",void 0),Xy=u([P("esri.rest.support.LocationToAddressParameters")],Xy),Xy.from=zr(Xy);const a3e=Xy;async function NEt(e,t,i){t=a3e.from(t);const r=_M(e),s={...t.toJSON(),f:"json"},n=HU({...r.query,...s}),o=jU(n,i),a=`${r.path}/reverseGeocode`;return _r(a,o).then(kEt)}function kEt({data:e}){if(!e)return;const{address:t,location:i}=e,r=t&&t.Match_addr||"";return n3e.fromJSON({address:r,attributes:t||{},location:i,score:100})}let SE=class extends ge{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};u([d({type:Boolean,json:{write:!0}})],SE.prototype,"isCollection",void 0),u([d({type:String,json:{write:!0}})],SE.prototype,"magicKey",void 0),u([d({type:String,json:{write:!0}})],SE.prototype,"text",void 0),SE=u([P("esri.rest.support.SuggestionCandidate")],SE);const UEt=SE;let ch=class extends ge{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};u([d(zte)],ch.prototype,"apiKey",void 0),u([d({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],ch.prototype,"categories",void 0),u([d({type:String,json:{write:!0}})],ch.prototype,"countryCode",void 0),u([d({type:ut,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],ch.prototype,"location",void 0),u([d({type:Number,json:{write:!0}})],ch.prototype,"maxSuggestions",void 0),u([d({type:et,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ch.prototype,"outSpatialReference",void 0),u([d({type:Gi,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(i)}}}})],ch.prototype,"searchExtent",void 0),u([d({type:String,json:{write:!0}})],ch.prototype,"text",void 0),ch=u([P("esri.rest.support.SuggestLocationsParameters")],ch),ch.from=zr(ch);const l3e=ch;async function VEt(e,t,i){const r=_M(e),s={...(t=l3e.from(t)).toJSON(),f:"json"},n=HU({...r.query,...s}),o=jU(n,i),a=`${r.path}/suggest`;return _r(a,o).then(BEt)}function BEt(e){const{data:t}=e;if(!t)return[];const{suggestions:i}=t;return i?i.map(r=>new UEt(r)):[]}const zEt="Single Line Input",GEt=3e5;function jEt(e,t){return e.location?YEt(e,t):ZEt(e,t)}function c3e(e,t){if(t.localSearchDisabled)return null;const i=e==null?void 0:e.scale;return typeof i=="number"&&i<=GEt?e.get("extent.center"):null}function HEt(e,t){const{source:i,spatialReference:r,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a}=e,l=new l3e,{apiKey:c,url:h}=i,p=u3e(i,s),f=t&&t.signal;if(!h)return Promise.resolve(null);c&&(l.apiKey=c),i.categories&&(l.categories=i.categories),r&&(l.outSpatialReference=r);const m=c3e(s,i);if(m&&(l.location=m),!n.trim())return Promise.resolve(null);const{prefix:y="",suffix:_=""}=i,b=`${y}${n}${_}`;return l.text=b,p&&(l.searchExtent=p),l.maxSuggestions=o,i.countryCode&&(l.countryCode=i.countryCode),VEt(h,l,{signal:f}).then(w=>KEt(w,a))}function qEt(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function WEt(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}function Afe(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}const XEt="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";function YEt(e,t){const{source:i,spatialReference:r,location:s,sourceIndex:n,view:o}=e,{apiKey:a,url:l,zoomScale:c,defaultZoomScale:h}=i,p=o&&o.scale,f=t&&t.signal,m=new a3e;return m.location=s,a&&(m.apiKey=a),r&&(m.outSpatialReference=r),NEt(l,m,{signal:f}).then(y=>h3e([y],{sourceIndex:n,scale:p,view:o,zoomScale:c,defaultZoomScale:h})).catch(()=>[])}function u3e(e,t){const{filter:i,withinViewEnabled:r}=e,s=t&&t.scale,n=t&&t.extent,o=i&&i.geometry;return Vte(o,t,s)||(r&&n?n:void 0)}function ZEt(e,t){const{source:i,suggestResult:r,spatialReference:s,view:n,maxResults:o,sourceIndex:a}=e,l=i&&i.zoomScale,c=i&&i.defaultZoomScale;if(!r.text.trim())return Promise.resolve(null);const h=!r.key&&i.prefix?i.prefix:"",p=!r.key&&i.suffix?i.suffix:"",f=`${h}${r.text}${p}`,m=new o3e,{apiKey:y,url:_}=i,b=n&&n.scale,w=u3e(i,n),T=t&&t.signal;if(y&&(m.apiKey=y),!_)return Promise.resolve(null);i.categories&&(m.categories=i.categories),i.locationType&&(m.locationType=i.locationType),s&&(m.outSpatialReference=s);const S=c3e(n,i);S&&(m.location=S),m.maxLocations=o,w&&(m.searchExtent=w),i.countryCode&&(m.countryCode=i.countryCode);const{key:E}=r,M=`${E}`;return E&&(m.magicKey=M),m.address={},m.address[i.singleLineFieldName||zEt]=f,i.outFields&&(m.outFields=i.outFields),DEt(_,m,{signal:T}).then(A=>h3e(A,{key:M,scale:b,sourceIndex:a,view:n,zoomScale:l,defaultZoomScale:c}))}function JEt(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function KEt(e,t){return e.map(i=>JEt(i,t))}function QEt(e,t){const{key:i,scale:r,sourceIndex:s,view:n,zoomScale:o,defaultZoomScale:a}=t,{attributes:l,extent:c,location:h,address:p}=e,f=new Ko({geometry:h,attributes:l}),m=c||h,y=Vte(m,n,r),_=typeof o=="number"?FY(y,n,o):typeof a=="number"&&m.type==="point"?FY(y,n,a):y,b=h?`${h.x},${h.y}`:"",w=p||b,T=f.clone();return v(_)&&(T.geometry=zh.fromExtent(_)),{extent:_,feature:f,target:T,key:i,name:w,sourceIndex:s}}function h3e(e,t){return e.filter(Boolean).map(i=>QEt(i,t))}var kY;const eCt="esri.widgets.Search.LocatorSearchSource";let Ul=kY=class extends Ute{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(t,i)=>jEt({source:this,...t},i),this.getSuggestions=(t,i)=>HEt({source:this,...t},i)}clone(){return new kY({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?ne(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?ne(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};u([d()],Ul.prototype,"apiKey",void 0),u([d()],Ul.prototype,"categories",void 0),u([d()],Ul.prototype,"countryCode",void 0),u([d({json:{write:!0}})],Ul.prototype,"defaultZoomScale",void 0),u([d()],Ul.prototype,"localSearchDisabled",void 0),u([d()],Ul.prototype,"locationType",void 0),u([d({json:{write:!0}})],Ul.prototype,"name",void 0),u([d({json:{write:!0}})],Ul.prototype,"placeholder",void 0),u([d()],Ul.prototype,"searchTemplate",void 0),u([d({json:{write:!0}})],Ul.prototype,"singleLineFieldName",void 0),u([d({json:{read:{source:"suggest"},write:{target:"suggest"}}})],Ul.prototype,"suggestionsEnabled",void 0),u([d({json:{write:!0}})],Ul.prototype,"url",void 0),u([d({json:{write:!0}})],Ul.prototype,"zoomScale",void 0),Ul=kY=u([P(eCt)],Ul);const d3e=Ul;new _i({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"});new _i({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});let uw=class extends ge{constructor(e){super(e),this.deviationUnit=null,this.geometries=null,this.maxDeviation=null}};u([d({type:String,json:{write:!0}})],uw.prototype,"deviationUnit",void 0),u([d({json:{read:{reader:e=>e?e.map(t=>Jl(t)).filter(v):null},write:{writer:(e,t)=>{var i;t.geometries=(i=e==null?void 0:e.map(r=>r.toJSON()))!=null?i:null}}}})],uw.prototype,"geometries",void 0),u([d({type:Number,json:{write:!0}})],uw.prototype,"maxDeviation",void 0),uw=u([P("esri.rest.support.GeneralizeParameters")],uw),uw.from=zr(uw);new _i({preserveShape:"preserve-shape"});let K_=class extends ge{constructor(e){super(e),this.calculationType=null,this.geodesic=null,this.lengthUnit=null,this.polylines=null}};u([d({type:String,json:{write:!0}})],K_.prototype,"calculationType",void 0),u([d({type:Boolean,json:{write:!0}})],K_.prototype,"geodesic",void 0),u([d({json:{write:!0}})],K_.prototype,"lengthUnit",void 0),u([d({type:[$h],json:{read:{reader:e=>e?e.map(t=>Jl(t)):null},write:{writer:(e,t)=>{t.polylines=e.map(i=>i.toJSON())}}}})],K_.prototype,"polylines",void 0),K_=u([P("esri.rest.support.LengthsParameters")],K_),K_.from=zr(K_);new _i({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"});new _i({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});let by=class extends ge{constructor(e){super(e),this.bevelRatio=null,this.geometries=null,this.offsetDistance=null,this.offsetHow=null,this.offsetUnit=null}};u([d({type:Number,json:{write:!0}})],by.prototype,"bevelRatio",void 0),u([d({json:{read:{reader:e=>e?e.map(t=>Jl(t)).filter(v):null},write:{writer:(e,t)=>{var i;t.geometries=(i=e==null?void 0:e.map(r=>r.toJSON()))!=null?i:null}}}})],by.prototype,"geometries",void 0),u([d({type:Number,json:{write:!0}})],by.prototype,"offsetDistance",void 0),u([d({type:String,json:{write:!0}})],by.prototype,"offsetHow",void 0),u([d({type:String,json:{write:!0}})],by.prototype,"offsetUnit",void 0),by=u([P("esri.rest.support.OffsetParameters")],by),by.from=zr(by);new _i({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});let Q_=class extends ge{constructor(e){super(e),this.geometries1=null,this.geometries2=null,this.relation=null,this.relationParameter=null}};u([d({json:{read:{reader:e=>e?e.map(t=>Jl(t)).filter(v):null},write:{writer:(e,t)=>{var i;t.geometries1=(i=e==null?void 0:e.map(r=>r.toJSON()))!=null?i:null}}}})],Q_.prototype,"geometries1",void 0),u([d({json:{read:{reader:e=>e?e.map(t=>Jl(t)).filter(v):null},write:{writer:(e,t)=>{var i;t.geometries2=(i=e==null?void 0:e.map(r=>r.toJSON()))!=null?i:null}}}})],Q_.prototype,"geometries2",void 0),u([d({type:String,json:{write:!0}})],Q_.prototype,"relation",void 0),u([d({type:String,json:{write:!0}})],Q_.prototype,"relationParameter",void 0),Q_=u([P("esri.rest.support.RelationParameters")],Q_),Q_.from=zr(Q_);new _i({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});let hw=class extends ge{constructor(e){super(e),this.extendHow="default-curve-extension",this.polylines=null,this.trimExtendTo=null}};u([d({type:String,json:{write:!0}})],hw.prototype,"extendHow",void 0),u([d({type:[$h],json:{read:{reader:e=>e?e.map(t=>Jl(t)):null},write:{writer:(e,t)=>{t.polylines=e.map(i=>i.toJSON())}}}})],hw.prototype,"polylines",void 0),u([d({json:{read:{reader:e=>e?Jl(e):null},write:{writer:(e,t)=>{t.trimExtendTo=e.toJSON()}}}})],hw.prototype,"trimExtendTo",void 0),hw=u([P("esri.rest.support.TrimExtendParameters")],hw),hw.from=zr(hw);const p3e=se.getLogger("esri.widgets.support.geolocationUtils"),tCt={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function iCt(){const e=he("esri-geolocation");return e||p3e.warn("geolocation-unsupported","Geolocation unsupported."),e}function rCt(){const e=window.isSecureContext;return e||p3e.warn("insecure-context","Geolocation requires a secure origin."),e}function Mfe(){return iCt()&&rCt()}function sCt(e){return e||(e=tCt),new Promise((i,r)=>{setTimeout(()=>r(new H("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(i,r,e)})}function nCt(e,t){var n;const{position:i,view:r}=e,s=(n=oCt(i))==null?void 0:n.coords;if(!s)throw new H("geometry-service:no-coords","Geolocation has no coordinates");return lCt(aCt(s),r,t)}function oCt(e){const t=e&&e.coords||{},i={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e&&{coords:i,timestamp:e.timestamp}}function aCt({longitude:e,latitude:t,altitude:i}){return new ut({longitude:e,latitude:t,z:i||void 0,spatialReference:{wkid:4326}})}function lCt(e,t,i){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve(dg(e)):cCt(i).then(s=>{if(!s)throw new H("geometry-service:missing-url","Geometry service URL is missing");const n=new hV({geometries:[e],outSpatialReference:r});return mte(s,n,i).then(o=>o[0])})}function cCt(e){if(or.geometryServiceUrl)return Promise.resolve(or.geometryServiceUrl);const t=po.getDefault();return t.load(e).catch(()=>{}).then(()=>t.get("helperServices.geometry.url"))}function Il(e,t){return e.hasOwnProperty(t)&&e[t]!=null&&e[t]!==""}const uCt=()=>NJ("esri/widgets/Search/t9n/Search"),f3e="esri.widgets.Search.SearchViewModel",wy=se.getLogger(f3e),Rfe="highlight",t5=Qe.ofType({key:e=>e.layer?"layer":"locator",base:Ute,typeMap:{layer:TE,locator:d3e}}),Ofe=et.WGS84,hCt="esri/images/search/search-symbol-32.png",dCt=/<(?:.|\s)*?>/g,EE=-1;let Li=class extends t8(ps.EventedMixin(Te)){constructor(e){super(e),this._handles=new Ii,this._gotoController=null,this._searching=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new t5,this.defaultSymbols={point:new m$({url:Vi(hCt),size:24,width:24,height:24}),polyline:new Nu({color:[130,130,130,1],width:2}),polygon:new H0({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=po.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new t5,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const t=await uCt();this.messages=t,this.defaultPopupTemplate=new KT({title:t.searchResult,content:"{Match_addr}"})};e(),this._handles.add([te(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),st),BZ(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics(),this._handles.destroy(),this._handles=null}get activeSource(){var e;return(e=this.allSources.at(this.activeSourceIndex))!=null?e:null}get activeSourceIndex(){return this.allSources.length===1||!this.searchAllEnabled?0:EE}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){var e;return(e=this.messages)==null?void 0:e.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:i}=this,r=typeof i=="function"?i.call(null,{sources:e,defaultSources:t}):i?t.concat(e):e,s=this._get("allSources")||new t5;return s.removeAll(),s.addMany(r.filter(Boolean)),s}get locationEnabled(){return this._get("locationEnabled")||Mfe()}set locationEnabled(e){if(e===void 0)return void this._clearOverride("locationEnabled");const t=Mfe();if(e&&!t){const i=new H("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});wy.error(i)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:i}=this;if(t===EE)return i;const r=e.at(t);return r?r.placeholder:""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),e===""&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":this.allSources.length===0?"disabled":"ready"}get updating(){return this._updatingPromise!=null}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup(),this.view&&this.view.graphics.remove(this.resultGraphic),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const i=this._createSuggestionForSearch(e),r=this.when().then(()=>this._getResultsFromSources(i,t).then(s=>{var l;if((l=t==null?void 0:t.signal)!=null&&l.aborted)return null;const n={activeSourceIndex:this.activeSourceIndex,searchTerm:i.text,numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(n,s,i);const o=this._getFirstResult(n.results),a=(i.location&&o?o.name:i.text).replace(dCt,"");return this._set("searchTerm",a),(i.key&&typeof i.sourceIndex=="number"||i.location)&&this._set("selectedSuggestion",i),this._set("results",n.results),this._set("resultCount",n.results.reduce((c,h)=>c+h.results.length,0)),this.emit("search-complete",n),this._selectFirstResult(o).then(()=>n)})).then(s=>(this._clearSearching(),s),s=>{throw this._clearSearching(),s});return this._searching=r,r}searchNearby(e){if(!this.locationEnabled){const i=new H("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});return wy.error(i),Promise.reject(i)}const t=sCt().then(i=>nCt({position:i,view:this.view},e)).then(i=>this.search(i,e));return this._searching=t,t.catch(()=>{}).then(()=>this._clearSearching()),t}select(e){if(this.clearGraphics(),!e){const w=new H("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});return wy.error(w),Promise.reject(w)}const{view:t}=this,i=Il(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),r=this.allSources.at(i);if(!r){const w=new H("select:missing-source","Cannot select without a source.",{source:r});return wy.error(w),Promise.reject(w)}const s=r instanceof TE?this._getLayerSourcePopupTemplate(r):r.popupTemplate,n=r.resultSymbol||this._getDefaultSymbol(e),o=Il(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,a=Il(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,l=Il(r,"popupEnabled")?r.popupEnabled:this.popupEnabled,c=l?s||this.popupTemplate||this.defaultPopupTemplate:null,{feature:h}=e;if(!h){const w=new H("select:missing-feature","Cannot select without a feature.",{feature:h});return wy.error(w),Promise.reject(w)}const{attributes:p,geometry:f,layer:m,sourceLayer:y}=h,_=Cfe(f),b={layerViewQuery:this._getLayerView(h),elevationQuery:t&&v(_)?yEt(_,t).catch(()=>_):Promise.resolve(_)};return Eo(b).then(w=>{const T=w.layerViewQuery.value,S=w.elevationQuery.value;n instanceof iS&&(n.text=e.name);const E=t&&a?e.target||e.extent:null;return(v(E)?this._goToSearchResult(E):Promise.resolve()).then(()=>{var I;const M=T?h:new Ko({geometry:f,symbol:n,attributes:p,layer:m,sourceLayer:y,popupTemplate:c}),A=l&&((I=this.view)==null?void 0:I.popup),$=A&&M.getEffectivePopupTemplate(A.defaultPopupTemplateEnabled);return $&&t.popup.open({features:[M],location:S}),T&&GW(T)&&!$&&this._highlightFeature({graphic:M,layerView:T}),!T&&o&&t&&t.graphics.push(M),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",M),this.emit("select-result",{result:e,source:r,sourceIndex:i}),e})})}suggest(e,t,i){const r=e||this.searchTerm;return this.emit("suggest-start",{searchTerm:r}),this._suggestTimer(t,i).then(()=>this._suggestImmediate(r,i).then(s=>(this._set("suggestions",s.results),this._set("suggestionCount",s.results.reduce((n,o)=>n+o.results.length,0)),this.emit("suggest-complete",s),s)))}async when(){await I0(()=>!this.updating)}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const i=this._updatingPromise=Eo([e==null?void 0:e.load(),t==null?void 0:t.when()]);if(this.destroyed||(await i,i!==this._updatingPromise))return}await I0(()=>this.messages),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){var t,i;const e=(i=(t=this.portal)==null?void 0:t.helperServices)==null?void 0:i.geocode;return e?e.map(r=>{if(r.placefinding===!1)return;const s=or.apiKey&&Afe(r.url)?{url:XEt}:null,n=d3e.fromJSON({...r,...s}),o=n.url;if(Afe(o)||WEt(o)||qEt(o)){const a=n.outFields||["Addr_type","Match_addr","StAddr","City"],l=n.placeholder||this.messages.placeholder,c=typeof n.defaultZoomScale=="number"?n.defaultZoomScale:2500;n.set({singleLineFieldName:"SingleLine",outFields:a,placeholder:l,defaultZoomScale:c})}return n.singleLineFieldName?n:void 0}).filter(Boolean):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(e=>e==null?void 0:e.destroy()),this._createdFeatureLayers=[]}_getLayerSources(e,t){var r;const i=(r=this.view)==null?void 0:r.map;return e.map(s=>{const n=i.findLayerById(s.id);if(!n)return;const o=this._getLayerJSON(s),a=TE.fromJSON(o);return a.placeholder=t,this._getLayer(n,o).then(l=>{a.layer=l}),a}).filter(Boolean).toArray()}_getTableSources(e,t){var r;const i=(r=this.view)==null?void 0:r.map;return e.map(s=>{const n=i.findTableById(s.id);if(!n)return;const o=this._getLayerJSON(s),a=TE.fromJSON(o);return a.placeholder=t,this._getLayer(n,o).then(l=>{a.layer=l}),a}).filter(Boolean).toArray()}_convertApplicationProperties(){var o,a,l;const e=(o=this.view)==null?void 0:o.map,t=(l=(a=e==null?void 0:e.applicationProperties)==null?void 0:a.viewing)==null?void 0:l.search;if(!t)return[];const{enabled:i,hintText:r,layers:s,tables:n}=t;return i?[...this._getLayerSources(s,r),...this._getTableSources(n,r)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const i=e.allSublayers.find(s=>s.id===t.subLayer);if(!i)throw new Error;const r=await i.createFeatureLayer();return this._createdFeatureLayers.push(r),r}async _getBuildingSubLayer(e,t){await e.load();const i=e.allSublayers.find(r=>r.id===t.subLayer);if((i==null?void 0:i.type)!=="building-component")throw new Error;if(await i.load(),i.associatedLayer==null)throw new Error;return await i.associatedLayer.load(),i}_getLayer(e,t){return e.type==="feature"||e.type==="scene"||e.type==="csv"||e.type==="geojson"||e.type==="ogc-feature"?Promise.resolve(e):e.type==="map-image"?this._getSubLayer(e,t).catch(()=>{const i=new H("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return wy.error(i),null}):e.type==="building-scene"?this._getBuildingSubLayer(e,t):Promise.resolve(null)}_getLayerJSON(e){return typeof e.toJSON=="function"?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var r;const e=(r=this.view)==null?void 0:r.popup,{resultGraphic:t}=this;if(!e||!t)return;const{selectedFeature:i}=e;i&&i===t&&e.close()}_suggestTimer(e,t){const i=e!=null?e:this.suggestionDelay;return M0(i,null,t&&t.signal)}_createLocationForSearch(e){return e instanceof Ko?Cfe(e.geometry):e instanceof ut?e:Array.isArray(e)&&e.length===2?new ut({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&Il(e,"key")&&Il(e,"text")&&Il(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),i=typeof e=="string"?e:this.searchTerm,{selectedSuggestion:r,selectedResult:s}=this,n=!e&&r&&s,o=n&&r.key===s.key&&r.sourceIndex===s.sourceIndex,a=n&&r.location;return o||a?r:{location:t,text:t?"":i,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some(i=>{const{results:r}=i,s=r[0],n=!!s;return n&&(t=s),n}),t}_selectFirstResult(e){return this.autoSelect&&e?this.select(e):Promise.resolve(null)}_suggestImmediate(e,t){return this.when().then(()=>this._getSuggestionsFromSources(e,t)).then(i=>{var s;if((s=t==null?void 0:t.signal)!=null&&s.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:e,numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(r,i),r})}_formatSourceResponse(e,t,i){const r=t&&t.value||[],s=t&&t.error,n=this.allSources.at(i);if(s){const o={sourceIndex:i,source:n,error:s};e.errors.push(o),wy.error(s),e.numErrors++}else{const o={sourceIndex:i,source:n,results:r};e.results.push(o),e.numResults+=r.length}}_formatResponse(e,t,i){if(t)if(e.activeSourceIndex===EE){const r=i&&Il(i,"sourceIndex")&&i.sourceIndex!==-1?i.sourceIndex:void 0;t.forEach((s,n)=>{const o=r!==void 0?r:n;this._formatSourceResponse(e,s,o)})}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}_getResultsFromSources(e,t){const{allSources:i}=this,r=!e.location&&Il(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,s=[];if(!i.length){const n=new H("search:no-sources-defined","At least one source is required.",{allSources:i});return wy.error(n),Promise.reject(n)}return r===EE?i.forEach((n,o)=>{s.push(this._getResultsFromSource(e,o,t))}):s.push(this._getResultsFromSource(e,r,t)),Eo(s)}_getSuggestionsFromSources(e,t){const{allSources:i,activeSourceIndex:r}=this,s=[];if(!i.length){const n=new H("suggest:no-sources-defined","At least one source is required.",{allSources:i});return wy.error(n),Promise.reject(n)}return r===EE?i.forEach((n,o)=>{s.push(this._getSuggestionsFromSource(e,o,t))}):s.push(this._getSuggestionsFromSource(e,r,t)),Eo(s)}_getResultsFromSource(e,t,i){var c;const r=this.allSources.at(t),{location:s=null}=e,n=((c=this.view)==null?void 0:c.spatialReference)||Ofe,o=Il(r,"maxResults")?r.maxResults:this.maxResults,a=!!(r instanceof TE&&Il(r,"exactMatch"))&&r.exactMatch,{view:l}=this;return r.getResults({view:l,sourceIndex:t,location:s,suggestResult:e,spatialReference:n,exactMatch:a,maxResults:o},i)}_getSuggestionsFromSource(e,t,i){var a;const r=this.allSources.at(t),s=Il(r,"suggestionsEnabled")?r.suggestionsEnabled:this.suggestionsEnabled,n=e.length,o=Il(r,"minSuggestCharacters")?r.minSuggestCharacters:this.minSuggestCharacters;if(s&&e.trim()&&n>=o){const l=((a=this.view)==null?void 0:a.spatialReference)||Ofe,c=Il(r,"maxSuggestions")?r.maxSuggestions:this.maxSuggestions,{view:h}=this,p=!!(r instanceof TE&&Il(r,"exactMatch"))&&r.exactMatch;return r.getSuggestions({view:h,sourceIndex:t,suggestTerm:e,spatialReference:l,maxSuggestions:c,exactMatch:p},i)}return Promise.resolve(null)}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return Il(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){const t=this.results;let i=null;return t.some(r=>r.results.some(s=>s===e&&(i=r.sourceIndex,!0))),i}async _goToSearchResult(e){const t=!!e;this._abortGoTo();const i=new AbortController;this._gotoController=i;const r={target:{target:e},options:{animate:t,signal:i.signal}};await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(e){var r;const{defaultSymbols:t}=this,i=(r=e.feature)==null?void 0:r.geometry;if(C(i))return null;switch(i.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this._handles.remove(Rfe)}async _getLayerView(e){const{view:t}=this;if(!e||!t||e.layer.type==="building-component"||e.layer.type==="subtype-sublayer")return null;const{layer:i}=e;return await t.when(),t.whenLayerView(i)}_highlightFeature(e){const{graphic:t,layerView:i}=e,{attributes:r,layer:s}=t,{objectIdField:n}=s,o=r&&r[n],a=i.highlight(o||t);this._handles.add(a,Rfe)}_setResultFloor(e){var s,n,o;const{view:t}=this,i=(s=e.feature)==null?void 0:s.attributes,r=(n=e.feature)==null?void 0:n.sourceLayer;if(r&&"floorInfo"in r&&((o=r==null?void 0:r.floorInfo)==null?void 0:o.floorField)&&i){const a=i[r.floorInfo.floorField];t==null||t.emit("select-result-floor",a)}}};Li.ALL_INDEX=EE,u([d()],Li.prototype,"_searching",void 0),u([d()],Li.prototype,"_updatingPromise",void 0),u([d({readOnly:!0,value:null})],Li.prototype,"activeSource",null),u([d()],Li.prototype,"activeSourceIndex",null),u([d()],Li.prototype,"allPlaceholder",null),u([d({readOnly:!0})],Li.prototype,"allSources",null),u([d()],Li.prototype,"autoNavigate",void 0),u([d()],Li.prototype,"autoSelect",void 0),u([d()],Li.prototype,"defaultPopupTemplate",void 0),u([d({readOnly:!0})],Li.prototype,"defaultSources",void 0),u([d()],Li.prototype,"defaultSymbols",void 0),u([d()],Li.prototype,"includeDefaultSources",void 0),u([d()],Li.prototype,"locationEnabled",null),u([d()],Li.prototype,"maxInputLength",void 0),u([d()],Li.prototype,"maxResults",void 0),u([d()],Li.prototype,"maxSuggestions",void 0),u([d()],Li.prototype,"messages",void 0),u([d()],Li.prototype,"minSuggestCharacters",void 0),u([d({readOnly:!0})],Li.prototype,"placeholder",null),u([d()],Li.prototype,"popupEnabled",void 0),u([d({type:KT})],Li.prototype,"popupTemplate",void 0),u([d({type:po})],Li.prototype,"portal",void 0),u([d()],Li.prototype,"resultCount",void 0),u([d()],Li.prototype,"resultGraphicEnabled",void 0),u([d({readOnly:!0})],Li.prototype,"resultGraphic",void 0),u([d({readOnly:!0})],Li.prototype,"results",void 0),u([d({readOnly:!0})],Li.prototype,"selectedSuggestion",void 0),u([d()],Li.prototype,"searchAllEnabled",void 0),u([d({readOnly:!0})],Li.prototype,"selectedResult",void 0),u([d()],Li.prototype,"searchTerm",null),u([d({type:t5})],Li.prototype,"sources",void 0),u([d({readOnly:!0})],Li.prototype,"state",null),u([d()],Li.prototype,"suggestionDelay",void 0),u([d()],Li.prototype,"suggestionCount",void 0),u([d({readOnly:!0})],Li.prototype,"suggestions",void 0),u([d()],Li.prototype,"suggestionsEnabled",void 0),u([d({readOnly:!0})],Li.prototype,"updating",null),u([d()],Li.prototype,"view",void 0),u([d()],Li.prototype,"clear",null),Li=u([P(f3e)],Li);const QE=Li;let Dv=class extends pn{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}render(){const e={[vy.showMoreResults]:this.showMoreResultsOpen};return D("div",{class:vy.base},D("div",{key:"esri-search-renderer__container",class:this.classes(vy.moreResults,e)},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return D("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){var i;const e=(i=this.viewModel)==null?void 0:i.selectedResult,t=e&&e.name||"";return D("div",{key:"esri-search-renderer__result-name",class:vy.moreResultsItem},t)}renderMoreResultsLists(){var r;const e=(r=this.viewModel)==null?void 0:r.results,{resultCount:t}=this.viewModel;if(t<2)return null;const i=e.map(s=>this.renderMoreResultsList(s));return D("div",{key:"esri-search-renderer__more-results-container",class:vy.moreResultsList},i)}renderMoreResultsButton(){const{messages:e}=this,{resultCount:t}=this.viewModel;return t<2?null:D("div",{key:"esri-search-renderer__more-results-button",class:vy.moreResultsItem},D("a",{class:vy.anchor,href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults))}renderMoreResultsHeader(e,t){return D("div",{key:`esri-search-result-renderer__header-${t}`,class:vy.moreResultsListHeader},e)}renderMoreResultsList(e){var h,p;const{results:t}=e,i=t.length,r=!!i,s=(h=this.viewModel)==null?void 0:h.selectedResult,n=i===1&&t[0]===s,o=this._getSourceName(e.source,e.sourceIndex),a=((p=this.viewModel)==null?void 0:p.results.length)>1&&!n?this.renderMoreResultsHeader(o,e.sourceIndex):null,l=r&&t.map((f,m)=>this.renderMoreResultsListItem(f,m)),c=r&&!n?D("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},l):null;return r?D("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},a,c):null}renderMoreResultsListItem(e,t){return e!==this.get("viewModel.selectedResult")?D("li",{key:`esri-search-result-renderer__list-item-${t}`},D("a",{class:vy.anchor,href:"#",tabindex:"0",bind:this,"data-result":e,onclick:this._selectResultClick,onkeydown:this._selectResultClick},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=this.get("viewModel.view.popup");t&&t.reposition()}_selectResultClick(e){e.preventDefault();const t=e.currentTarget["data-result"];this.viewModel&&this.viewModel.select(t)}_getSourceName(e,t){return t===QE.ALL_INDEX?this.messages.all:e.name}};u([d(),Es("esri/widgets/Search/t9n/Search")],Dv.prototype,"messages",void 0),u([d()],Dv.prototype,"showMoreResultsOpen",void 0),u([d()],Dv.prototype,"viewModel",void 0),u([ln()],Dv.prototype,"_showMoreResultsClick",null),u([ln()],Dv.prototype,"_selectResultClick",null),Dv=u([P("esri.widgets.Search.SearchResultRenderer")],Dv);const pCt=Dv,fCt=/<[a-z/][\s\S]*>/i;let ki=class extends pn{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._handles=new Ii,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new pCt,this._locateFailed=null,this._container=null,this.activeMenu="none",this.disabled=!1,this.iconClass=Ut.widgetIcon,this.messages=null,this.messagesCommon=null,this.viewModel=new QE,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=i=>{var s;const r=i.relatedTarget;r&&((s=this._container)==null?void 0:s.contains(r))||this._clearActiveMenu()},this.addHandles([te(()=>this.searchTerm,i=>{(i&&this.activeMenu==="warning"||!i&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()}),Fs(()=>{var i;return(i=this.viewModel)==null?void 0:i.allSources},"change",()=>this._watchSourceChanges()),te(()=>this.activeMenu,()=>this._resetActiveMenuItemIndex(),st),te(()=>{var i;return(i=this.viewModel)==null?void 0:i.defaultPopupTemplate},i=>{i&&(i.content=this._renderSearchResultsContent.bind(this))},st)])}destroy(){this._handles.destroy(),this._handles=null,this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this.viewModel.clear()}focus(){var e;(e=this._inputNode)==null||e.focus(),this.emit("search-focus")}blur(){var e;(e=this._inputNode)==null||e.blur(),this.emit("search-blur")}search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:i}=t;return this._searchController=t,this.viewModel.search(e,{signal:i}).catch(r=>{if(this._searchController===t)return this._clearActiveMenu(),this._searchController=null,r}).then(r=>{if(this._searchController===t)return this.activeMenu=r.numResults?"none":"warning",this._searchController=null,r})}suggest(e){this._cancelSuggest();const t=new AbortController,{signal:i}=t;return this._suggestController=t,this.viewModel.suggest(e,null,{signal:i}).then(r=>{if(this._suggestController===t)return this._suggestController=null,r.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),r}).catch(()=>{if(this._suggestController===t)return this._suggestController=null,null})}render(){const{state:e}=this.viewModel,t={[Ut.disabled]:e==="disabled",[Ut.esriWidgetDisabled]:this.disabled};return D("div",{class:this.classes(Ut.base,t)},e==="loading"?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:e,disabled:t}=this;return D("button",{"aria-label":e.searchButtonTitle,bind:this,disabled:t,class:this.classes(Ut.submitButton,Ut.button),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},D("span",{"aria-hidden":"true",class:Ut.searchIcon}))}renderWarningMenu(){return D("div",{key:"esri-search__error-menu",class:this.classes(Ut.menu,Ut.warningMenu)},D("div",{class:Ut.warningMenuBody},this.renderWarning()))}renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:i,sourceMenuButtonId:r,disabled:s}=this,{activeSourceIndex:n,allSources:o}=this.viewModel;return o.length>1?D("button",{id:r,key:"esri-search__source-menu-button",bind:this,disabled:s,"aria-label":e.searchIn,title:e.searchIn,"aria-haspopup":"true","aria-expanded":(t==="source").toString(),"aria-controls":i,class:this.classes(Ut.sourcesButton,Ut.button),onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,afterCreate:y1,"data-node-ref":"_sourceMenuButtonNode",type:"button"},D("span",{"aria-hidden":"true",class:Ut.dropdownIcon}),D("span",{"aria-hidden":"true",class:Ut.dropupIcon}),D("span",{class:Ut.sourceName},this._getSourceName(n))):null}renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:i,activeMenu:r,sourceMenuId:s,sourceMenuButtonId:n}=this,o=r==="source"&&i>-1?this._buildId("source-item",i):null;return e.length>1?D("ul",{"aria-activedescendant":o,"aria-labelledby":n,id:s,role:"menu",bind:this,afterCreate:y1,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:Ut.menuList,tabIndex:-1},t?this.renderSource(QE.ALL_INDEX):null,e.map((a,l)=>this.renderSource(l)).toArray()):null}renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?D("div",{key:"esri-search__source-menu",class:this.classes(Ut.menu,Ut.sourcesMenu)},this.renderSourcesList()):null}renderLoader(){const{messages:e,messagesCommon:t,disabled:i}=this;return D("div",{class:Ut.loader,key:"base-loader",tabIndex:i?-1:null},D("span",{"aria-hidden":"true",class:Ut.loaderAnimation}),D("span",{class:Ut.fallbackText},e.searchButtonTitle),D("span",{class:Ut.loaderText},t.loading))}renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:i}=this,r={[Ut.hasMultipleSources]:e.length>1,[Ut.isLoading]:t==="loading",[Ut.isSearching]:t==="searching",[Ut.showWarning]:i==="warning",[Ut.showSources]:i==="source",[Ut.showSuggestions]:i==="suggestion"};return D("div",{tabIndex:-1,afterCreate:s=>{this._container=s,s.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:s=>{s.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(r,Ut.container),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?D("button",{bind:this,disabled:this.disabled,class:this.classes(Ut.clearButton,Ut.button),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},D("span",{"aria-hidden":"true",class:Ut.clearIcon})):null}renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:i}=this,r=t&&!i,s=this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0;return r?D("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(Ut.menuList,Ut.suggestionList,Ut.suggestionListCurrentLocation)},D("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0).toString(),role:"option",class:this.classes(Ut.menuItem,s?Ut.menuItemFocus:null)},D("span",{"aria-hidden":"true",class:Ut.locate})," ",e.useCurrentLocation)):null}renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:i,messages:r,suggestionsMenuId:s,inputId:n,_activeMenuItemIndex:o,disabled:a}=this,{maxInputLength:l,placeholder:c,searchTerm:h,suggestionCount:p}=this.viewModel,f=!(!(t&&!i)&&!p),m=e==="suggestion"&&o>-1?this._buildId("suggestion-item",o):null;return D("input",{"aria-activedescendant":m,"aria-autocomplete":"list","aria-expanded":(f&&e==="suggestion").toString(),"aria-controls":f?s:null,"aria-haspopup":"listbox","aria-label":r.searchButtonTitle,bind:this,disabled:a,placeholder:c,maxlength:l,autocomplete:"off",type:"text",class:this.classes(Ut.esriInput,Ut.input),value:h,id:n,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:y1,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:h?"":c})}renderForm(){return D("form",{key:"esri-search__form",bind:this,disabled:this.disabled,class:Ut.form,onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(e){const{sourceIndex:t}=e,i=e.results.length,r=e.results;return i?D("ul",{role:"group",key:`esri-search__suggestion-list-${t}`,class:this.classes(Ut.menuList,Ut.suggestionList)},r.map(s=>this.renderSuggestion(s,this._menuItemCount++))):null}renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map(t=>[this.renderSuggestionHeader(t),this.renderSuggestList(t)]):null}renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:i,inputId:r}=this,{suggestionCount:s}=this.viewModel,n=t&&!e||s;return this._menuItemCount=0,n?D("div",{id:i,key:"esri-search__suggestions-menu",class:this.classes(Ut.menu,Ut.suggestionsMenu),role:"listbox","aria-labelledby":r,bind:this,afterCreate:y1,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return D("div",{key:"esri-search__input-container",class:Ut.inputContainer},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:i}=this.viewModel,{sourceIndex:r}=e,s=e.results.length,n=t.length>1&&i===QE.ALL_INDEX;return s&&n?D("div",{key:`esri-search__suggestion-header-${r}`,class:Ut.menuHeader},this._getSourceName(r)):null}renderSuggestion(e,t){const{_activeMenuItemIndex:i,messages:r}=this,{searchTerm:s}=this.viewModel;if(s){const{text:n}=e,o=n||r.untitledResult,a=fCt.test(o),l=[];if(a)l.push(D("div",{innerHTML:o}));else{const h=this._splitResult(o,s),p=s.toLowerCase();h.forEach((f,m)=>{f&&f.length&&(f.toLowerCase()===p?l.push(D("strong",{key:m},f)):l.push(f))})}const c=this.activeMenu==="suggestion"&&i===t;return D("li",{bind:this,id:this._buildId("suggestion-item",t),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===t).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${t}`,"data-suggestion":e,role:"option",class:this.classes(Ut.menuItem,c?Ut.menuItemFocus:null)},l)}}renderSource(e){const{activeSourceIndex:t,searchAllEnabled:i}=this.viewModel,r={[Ut.menuItemActive]:e===t,[Ut.menuItemFocus]:this.activeMenu==="source"&&e===(i?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},s=i?e+1:e;return D("li",{bind:this,key:`esri-search__source-${e}`,id:this._buildId("source-item",s),"aria-checked":(e===t).toString(),onclick:this._handleSourceClick,"data-source-index":e,role:"menuitemradio",class:this.classes(Ut.source,Ut.menuItem,r)},this._getSourceName(e))}renderNoResultsWarning(e){const{messages:t}=this,i=e?gh(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return D("div",{key:"esri-search__no_results"},D("div",{class:Ut.warningMenuHeader},t.noResults),D("div",{class:Ut.warningMenuText},i))}renderEmptySearchWarning(){const{messages:e}=this;return D("div",{key:"esri-search__empty-search"},D("span",{"aria-hidden":"true",class:Ut.noticeIcon}),D("span",{class:Ut.noValueText},e.emptyValue))}renderLocateWarning(){const{messages:e}=this;return D("div",{key:"esri-search__locate-error"},D("span",{"aria-hidden":"true",class:Ut.noticeIcon}),D("span",{class:Ut.noValueText},e.locateError))}renderWarning(){var r;const{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:i}=this;return t?this.renderLocateWarning():((r=i.selectedSuggestion)==null?void 0:r.location)||e?this.renderNoResultsWarning(e):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${t===void 0?"":`-${t}`}`}_watchSourceChanges(){const{_handles:e,viewModel:{allSources:t}}=this,i="sources";e.remove(i),t.forEach(r=>e.add(te(()=>r.name,()=>this.scheduleRender()),i))}_handleSourcesMenuToggleFocus(){this.activeMenu!=="source"&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){var t;const e=this.activeMenu==="source";this.activeMenu=e?"none":"source",this.renderNow(),this.activeMenu==="source"&&((t=this._sourceListNode)==null||t.focus())}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=e.currentTarget["data-suggestion"];t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,this.viewModel.searchNearby({signal:t}).then(i=>{this.activeMenu=i.numResults?"none":"warning"}).catch(()=>{this._locateFailed=!0,this.activeMenu="warning"}).then(()=>{this._searchController=null})}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){var i;if(!e)return;const t=e["data-source-index"];this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),(i=this._sourceMenuButtonNode)==null||i.focus()}_cancelSuggest(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null)}_cancelSearch(){this._searchController&&(this._searchController.abort(),this._searchController=null),this._locateFailed=!1}_handleInputKeyup(e){var s;const t=Pc(e);if(e.ctrlKey||e.metaKey||t==="Copy"||t==="ArrowLeft"||t==="ArrowRight"||t==="Shift")return;if(t==="Tab"||t==="Escape"||e.shiftKey&&t==="Tab")return this._cancelSuggest(),void(t==="Escape"&&this._clearActiveMenu());const i=t==="Home"||t==="End"||t==="ArrowUp"||t==="ArrowDown";if(t==="Enter"&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const r=(s=this._suggestionListNode)==null?void 0:s.getElementsByTagName("li");if(r!=null&&r.length){if(this.activeMenu!=="suggestion"&&this._openSuggestionMenu(),i)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,r,this._suggestionListNode);const n=r[this._activeMenuItemIndex];if(t==="Enter"&&n){const o=n["data-suggestion"];return void(o?(this._focus(),this.search(o)):n["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,i){const r=this._activeMenuItemIndex;e==="Home"&&(this._activeMenuItemIndex=0),e==="End"&&(this._activeMenuItemIndex=t.length-1),e==="ArrowUp"&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),e==="ArrowDown"&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),r!==this._activeMenuItemIndex&&dGe(t[this._activeMenuItemIndex],i)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const t=Pc(e);if(dwe(t)){e.preventDefault();const i=this._sourceListNode.getElementsByTagName("li")[this._activeMenuItemIndex];this._setSourceFromMenuItem(i)}else t!=="ArrowUp"&&t!=="ArrowDown"&&t!=="End"&&t!=="Home"||e.preventDefault()}_handleSourceMenuKeyup(e){var s,n;const t=Pc(e),i=t==="ArrowUp"||t==="ArrowDown"||t==="End"||t==="Home";if(i&&e.preventDefault(),t==="Escape")return this._clearActiveMenu(),void((s=this._sourceMenuButtonNode)==null?void 0:s.focus());const r=(n=this._sourceListNode)==null?void 0:n.getElementsByTagName("li");return r&&r.length!==0&&i?(this.activeMenu!=="source"&&(this.activeMenu="source"),void this._handleItemNavigation(t,r,this._sourceListNode.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),this._activeMenuItemIndex===-1&&this.search()}_getSourceName(e){const{messages:t}=this,i=this.viewModel,{allSources:r}=i,s=r.getItemAt(e);return e===QE.ALL_INDEX?t.all:s&&s.name||t.untitledSource}_splitResult(e,t){const i=AIe(t);return e.replace(new RegExp(`(^|)(${i})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};u([d()],ki.prototype,"_activeMenuItemIndex",void 0),u([d()],ki.prototype,"displayedSearchTerm",null),u([d({readOnly:!0})],ki.prototype,"inputId",null),u([d({readOnly:!0})],ki.prototype,"suggestionsMenuId",null),u([d({readOnly:!0})],ki.prototype,"sourceMenuId",null),u([d({readOnly:!0})],ki.prototype,"sourceMenuButtonId",null),u([d()],ki.prototype,"activeMenu",void 0),u([d({readOnly:!0})],ki.prototype,"activeSource",null),u([d()],ki.prototype,"activeSourceIndex",null),u([d()],ki.prototype,"allPlaceholder",null),u([d({readOnly:!0})],ki.prototype,"allSources",null),u([d()],ki.prototype,"autoNavigate",null),u([d()],ki.prototype,"autoSelect",null),u([d({readOnly:!0})],ki.prototype,"defaultSources",null),u([d()],ki.prototype,"disabled",void 0),u([d()],ki.prototype,"goToOverride",null),u([d()],ki.prototype,"iconClass",void 0),u([d()],ki.prototype,"includeDefaultSources",null),u([d()],ki.prototype,"label",null),u([d()],ki.prototype,"locationEnabled",null),u([d()],ki.prototype,"maxResults",null),u([d()],ki.prototype,"maxSuggestions",null),u([d(),Es("esri/widgets/Search/t9n/Search")],ki.prototype,"messages",void 0),u([d(),Es("esri/t9n/common")],ki.prototype,"messagesCommon",void 0),u([d()],ki.prototype,"minSuggestCharacters",null),u([d()],ki.prototype,"popupEnabled",null),u([d()],ki.prototype,"popupTemplate",null),u([d()],ki.prototype,"portal",null),u([d()],ki.prototype,"resultGraphic",null),u([d()],ki.prototype,"resultGraphicEnabled",null),u([d({readOnly:!0})],ki.prototype,"results",null),u([d()],ki.prototype,"searchAllEnabled",null),u([d()],ki.prototype,"searchTerm",null),u([d({readOnly:!0})],ki.prototype,"selectedResult",null),u([d()],ki.prototype,"sources",null),u([d({readOnly:!0})],ki.prototype,"suggestions",null),u([d()],ki.prototype,"suggestionsEnabled",null),u([d()],ki.prototype,"view",null),u([O$(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),d({type:QE})],ki.prototype,"viewModel",void 0),ki=u([P("esri.widgets.Search")],ki);const mCt=ki;let Sc=class extends Te{constructor(e){super(e),this.precision=4,this.thumbsConstrained=!0}set effectiveMax(e){this.setEffectiveMax(e)}set effectiveMin(e){this.setEffectiveMin(e)}set labelFormatFunction(e){this._set("labelFormatFunction",e)}set inputFormatFunction(e){this._set("inputFormatFunction",e)}set inputParseFunction(e){this._set("inputParseFunction",e)}get labels(){const{max:e,min:t,values:i}=this,r=i&&i.length?i.map((s,n)=>this.getLabelForValue(s,"value",n)):[];return{max:this.getLabelForValue(e,"max"),min:this.getLabelForValue(t,"min"),values:r}}set max(e){this.setMax(e)}set min(e){this.setMin(e)}get state(){const{max:e,min:t}=this;return e!=null&&t!=null&&e>t?"ready":"disabled"}set values(e){const{max:t,min:i}=this,r=this.values;r&&e&&r.length===e.length&&r.every((s,n)=>s===e[n])||(this._set("values",null),e&&e.length&&(i!=null&&e.some(s=>s<i)&&(this.min=Math.min(...e)),t!=null&&e.some(s=>s>t)&&(this.max=Math.max(...e))),this._set("values",e))}toPrecision(e){return parseFloat(e.toFixed(this.precision))}defaultLabelFormatFunction(e){const{max:t,min:i,precision:r}=this,s=t!=null&&i!=null&&t-i>10?2:r;return parseFloat(e.toFixed(s)).toString()}defaultInputFormatFunction(e){return e.toString()}defaultInputParseFunction(e){return parseFloat(e)}getBounds(){const{effectiveMax:e,effectiveMin:t,max:i,min:r}=this;return{min:t!=null&&r!=null?Math.max(r,t):r,max:e!=null&&i!=null?Math.min(i,e):i}}getBoundsForValueAtIndex(e){const{thumbsConstrained:t,values:i}=this,{min:r,max:s}=this.getBounds();if(t&&i){const n=e-1,o=e+1;return{min:i[n]!=null?i[n]:r,max:i[o]!=null?i[o]:s}}return{min:r,max:s}}getLabelForValue(e,t,i){return e==null?null:this.labelFormatFunction?this.labelFormatFunction(e,t,i):this.defaultLabelFormatFunction(e)}setMax(e){const{max:t,values:i}=this;if(e==null)return void this._set("max",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'max' is NaN.");const r=this.toPrecision(e);if(t!==r&&(this._set("max",r),i&&i.length))for(let s=0;s<i.length;s++)r<i[s]&&this.setValue(s,r)}setMin(e){const{min:t,values:i}=this;if(e==null)return void this._set("min",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'min' is NaN.");const r=this.toPrecision(e);if(t!==r&&(this._set("min",r),i&&i.length))for(let s=0;s<i.length;s++)r>i[s]&&this.setValue(s,r)}setEffectiveMax(e){if(e==null)return void this._set("effectiveMax",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMax' is NaN.");const t=this.toPrecision(e);this.effectiveMax!==t&&this._set("effectiveMax",this._applyBoundsToValue(t))}setEffectiveMin(e){if(e==null)return void this._set("effectiveMin",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMin' is NaN.");const t=this.toPrecision(e);this.effectiveMin!==t&&this._set("effectiveMin",this._applyBoundsToValue(t))}setValue(e,t){if(isNaN(t))return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is NaN.");const{values:i}=this;if(i==null)return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is null.");const r=i[e],s=this.toPrecision(t);if(r===s)return;const n=[...i];n[e]=s,this._set("values",n),this.notifyChange("labels")}_applyBoundsToValue(e){const{max:t,min:i}=this;return i!=null&&e<i?i:t!=null&&e>t?t:e}_logError(e,t,i){se.getLogger(this.declaredClass).error(new H(e,t,i))}};u([d()],Sc.prototype,"effectiveMax",null),u([d()],Sc.prototype,"effectiveMin",null),u([d()],Sc.prototype,"labelFormatFunction",null),u([d()],Sc.prototype,"inputFormatFunction",null),u([d()],Sc.prototype,"inputParseFunction",null),u([d({readOnly:!0})],Sc.prototype,"labels",null),u([d()],Sc.prototype,"max",null),u([d()],Sc.prototype,"min",null),u([d()],Sc.prototype,"precision",void 0),u([d({readOnly:!0})],Sc.prototype,"state",null),u([d()],Sc.prototype,"thumbsConstrained",void 0),u([d()],Sc.prototype,"values",null),Sc=u([P("esri.widgets.Slider.SliderViewModel")],Sc);const gCt=Sc,jr="esri-slider",Ri={base:jr,reversed:`${jr}--reversed`,horizontalLayout:`${jr}--horizontal`,verticalLayout:`${jr}--vertical`,contentElement:`${jr}__content`,extraContentElement:`${jr}__extra-content`,trackElement:`${jr}__track`,ticksContainerElement:`${jr}__ticks`,tickElement:`${jr}__tick`,tickLabelElement:`${jr}__tick-label`,maxElement:`${jr}__max`,minElement:`${jr}__min`,maxElementInteractive:`${jr}__max--interactive`,minElementInteractive:`${jr}__min--interactive`,rangeElementActive:`${jr}__range--active`,rangeInput:`${jr}__range-input`,anchorElement:`${jr}__anchor`,movingAnchorElement:`${jr}__anchor--moving`,lastMovedAnchorElement:`${jr}__anchor--moved`,anchorElementActive:`${jr}__anchor--active`,anchorElementIndexPrefix:`${jr}__anchor-`,segmentElement:`${jr}__segment`,segmentElementIndexPrefix:`${jr}__segment-`,segmentElementInteractive:`${jr}__segment--interactive`,segmentElementActive:`${jr}__segment--active`,effectiveSegmentElement:`${jr}__effective-segment`,effectiveMaxSegmentElement:`${jr}__effective-max-segment`,effectiveMinSegmentElement:`${jr}__effective-min-segment`,thumbElement:`${jr}__thumb`,labelElement:`${jr}__label`,labelElementInteractive:`${jr}__label--interactive`,labelInput:`${jr}__label-input`,esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},Kc={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},yCt="esri.widgets.Slider",Ife={labels:!1,rangeLabels:!1};let Qi=class extends pn{constructor(e,t){super(e,t),this._activeLabelInputIndex=null,this._anchorElements=[],this._dragged=!1,this._dragStartInfo=null,this._focusedAnchorIndex=null,this._isMinInputActive=!1,this._isMaxInputActive=!1,this._lastMovedHandleIndex=null,this._positionPrecision=5,this._segmentDragStartInfo=null,this._trackHeight=null,this._trackWidth=null,this._zIndices=null,this._zIndexOffset=3,this.disabled=!1,this.draggableSegmentsEnabled=!0,this.effectiveSegmentElements=new Qe,this.extraNodes=[],this.inputCreatedFunction=null,this.labelElements=new Qe,this.labelInputsEnabled=!1,this.maxLabelElement=null,this.messages=null,this.minLabelElement=null,this.rangeLabelInputsEnabled=!1,this.segmentElements=new Qe,this.snapOnClickEnabled=!0,this.steps=null,this.syncedSegmentsEnabled=!1,this.thumbCreatedFunction=null,this.thumbElements=new Qe,this.tickElements=new Qe,this.trackElement=null,this.viewModel=new gCt,this.visibleElements={...Ife},this._onAnchorPointerDown=this._onAnchorPointerDown.bind(this),this._onAnchorPointerMove=this._onAnchorPointerMove.bind(this),this._onAnchorPointerUp=this._onAnchorPointerUp.bind(this),this._onLabelPointerDown=this._onLabelPointerDown.bind(this),this._onLabelPointerUp=this._onLabelPointerUp.bind(this),this._onSegmentPointerDown=this._onSegmentPointerDown.bind(this),this._onSegmentPointerMove=this._onSegmentPointerMove.bind(this),this._onSegmentPointerUp=this._onSegmentPointerUp.bind(this),this._onTrackPointerDown=this._onTrackPointerDown.bind(this),this._onTrackPointerMove=this._onTrackPointerMove.bind(this),this._onTrackPointerUp=this._onTrackPointerUp.bind(this)}destroy(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this.labelElements.removeAll(),this.labelElements.destroy(),this.segmentElements.removeAll(),this.segmentElements.destroy(),this.effectiveSegmentElements.removeAll(),this.effectiveSegmentElements.destroy(),this.thumbElements.removeAll(),this.thumbElements.destroy(),this.tickElements.removeAll(),this.tickElements.destroy()}get effectiveMax(){return this.viewModel.effectiveMax}set effectiveMax(e){this.viewModel.effectiveMax=e}get effectiveMin(){return this.viewModel.effectiveMin}set effectiveMin(e){this.viewModel.effectiveMin=e}get inputFormatFunction(){return this.viewModel.inputFormatFunction}set inputFormatFunction(e){this.viewModel.inputFormatFunction=e}get inputParseFunction(){return this.viewModel.inputParseFunction}set inputParseFunction(e){this.viewModel.inputParseFunction=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(e){this.viewModel.labelFormatFunction=e}get labels(){return this.viewModel.labels}set layout(e){["vertical","vertical-reversed","horizontal","horizontal-reversed"].includes(e)||(e="horizontal"),this._set("layout",e)}get max(){return this.viewModel.max}set max(e){this.viewModel.max=e}get min(){return this.viewModel.min}set min(e){this.viewModel.min=e}get precision(){return this.viewModel.precision}set precision(e){this.viewModel.precision=e}get state(){const{_activeLabelInputIndex:e,_isMaxInputActive:t,_isMinInputActive:i,_dragStartInfo:r,_segmentDragStartInfo:s,disabled:n,viewModel:o}=this,a=v(r)||v(s);return n?"disabled":e===null&&!t&&!i?a?"dragging":o.state:"editing"}get thumbsConstrained(){return this.viewModel.thumbsConstrained}set thumbsConstrained(e){this.viewModel.thumbsConstrained=e}set tickConfigs(e){this._set("tickConfigs",e),this.scheduleRender()}get values(){return this.viewModel.values}set values(e){this.viewModel.values=e}castVisibleElements(e){return{...Ife,...e}}render(){const{label:e}=this,t=this.classes(Ri.base,Ri.esriWidget,this._isHorizontalLayout()?Ri.horizontalLayout:Ri.verticalLayout,this._isReversedLayout()?Ri.reversed:null,this._isDisabled()?Ri.disabled:null);return this._storeTrackDimensions(),D("div",{"aria-label":e,class:t,"touch-action":"none",bind:this,afterCreate:this._afterContainerCreate},this.renderContent())}toNextStep(e){this._toStep(e,1)}toPreviousStep(e){this._toStep(e,-1)}renderContent(){const{max:e,min:t}=this;if(!(C(t)||C(e)||t>=e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]}renderSliderContainer(){return D("div",{key:"slider-container",bind:this,class:Ri.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())}renderTrackElement(){return D("div",{afterCreate:this._afterTrackCreate,afterRemoved:this._afterTrackRemoved,bind:this,class:Ri.trackElement,"touch-action":"none"},this.renderEffectiveSegmentElements(),this.renderSegmentElements(),this.renderAnchorElements())}renderEffectiveSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=v(this.effectiveMax),t=v(this.effectiveMin);if(!e&&!t)return;const{max:i,min:r,viewModel:s}=this,n=s.getBounds(),o=[];return t&&o.push(this.renderEffectiveSegmentElement(r,n.min,!0)),e&&o.push(this.renderEffectiveSegmentElement(n.max,i,!1)),o}renderSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length,t=[];for(let i=0;i<=e;i++)t.push(this.renderSegmentElement(i));return t}renderSegmentElement(e){const{_trackHeight:t,_trackWidth:i,draggableSegmentsEnabled:r,id:s,state:n,values:o}=this,a=this._isHorizontalLayout(),l=a?i:t,c=this.viewModel.getBounds(),h=this._positionFromValue(c.max),p=this._positionFromValue(c.min),f=e===o.length?null:e,m=e===0?null:e-1,y=v(f),_=v(m);let b,w;const T=[...o].sort(($,I)=>$-I);this._isReversedLayout()?(b=_?this._positionFromValue(T[m]):p,w=y?this._positionFromValue(T[f]):h):(b=y?this._positionFromValue(T[f]):h,w=_?this._positionFromValue(T[m]):p);const S=this._applyPrecisionToPosition(100*w/l),E=(b-w)/l,M=a?`transform: translate(${S}%, 0px) scale(${E}, 1);`:`transform: translate(0px, ${S}%) scale(1, ${E});`,A=this.classes(Ri.segmentElement,Ri.segmentElementIndexPrefix+e,r&&y&&_&&n!=="disabled"?Ri.segmentElementInteractive:null);return D("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:A,"data-max-thumb-index":f,"data-min-thumb-index":m,"data-segment-index":e,key:`${s}-segment-${e}`,style:M,"touch-action":"none"})}renderEffectiveSegmentElement(e,t,i){const{_trackHeight:r,_trackWidth:s,layout:n}=this,o=this._positionFromValue(e),a=this._positionFromValue(t),l=this._isHorizontalLayout(),c=l?s:r,h=this._applyPrecisionToPosition(100*o/c);let p=null;if(n==="horizontal"){const y=i?c-a:a,_=o===c?0:h;p=`clip-path: inset(0% ${a===c?0:this._applyPrecisionToPosition(y/c*100)}% 0% ${_}%);`}else{const y=(a-o)/c;p=l?`transform: translate(${h}%, 0px) scale(${y}, 1);`:`transform: translate(0px, ${h}%) scale(1, ${y});`}const f=i?Ri.effectiveMinSegmentElement:Ri.effectiveMaxSegmentElement,m=this.classes(Ri.segmentElement,Ri.effectiveSegmentElement,f);return D("div",{afterCreate:this._afterEffectiveSegmentCreate,afterRemoved:this._afterEffectiveSegmentRemoved,bind:this,class:m,style:p,"touch-action":"none"})}renderAnchorElements(){const{trackElement:e,values:t}=this;if(t&&t.length)return this._zIndices=t.map((i,r)=>{const s=this._positionFromValue(i),n=this._positionToPercent(s),o=(this._isHorizontalLayout()?n>50:n<50)?-1:1;return this._zIndexOffset+(t.length+o*r)}),e&&t&&t.length?t.map((i,r)=>this.renderAnchorElement(i,r)):null}renderAnchorElement(e,t){const i=this._positionFromValue(e),r=this._valueFromPosition(i);if(C(r)||isNaN(r))return;const{_dragStartInfo:s,_lastMovedHandleIndex:n,id:o,layout:a,values:l,visibleElements:{labels:c}}=this,h=s&&s.index===t,p=n===t,f=this.classes(Ri.anchorElement,Ri.anchorElementIndexPrefix+t,h?Ri.movingAnchorElement:null,p?Ri.lastMovedAnchorElement:null),m=this.labels.values[t],y=this._getStyleForAnchor(e,t,h||p),{min:_,max:b}=this.viewModel.getBoundsForValueAtIndex(t),{disabled:w,messages:T}=this,S=l.length===2?gh(t===0?T.rangeMinimum:T.rangeMaximum,{value:e}):m,E=l.length===1?null:t===0?`${o}-handle-${t+1}`:t===l.length-1?`${o}-handle-${t-1}`:`${o}-handle-${t-1} ${o}-handle-${t+1}`;return D("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":E,"aria-label":T.sliderValue,"aria-labelledby":c?`${o}-label-${t}`:null,"aria-orientation":a,"aria-valuemax":b.toString(),"aria-valuemin":_.toString(),"aria-valuenow":e.toString(),"aria-valuetext":S,bind:this,class:f,"data-thumb-index":t,"data-value":e,id:`${o}-handle-${t}`,key:`${o}-handle-${t}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:y,tabIndex:w?-1:0},D("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:Ri.thumbElement,"data-thumb-index":t,"touch-action":"none"}),this.renderThumbLabel(t))}renderThumbLabel(e){const{id:t,labels:i,labelInputsEnabled:r,state:s}=this,n=this.visibleElements.labels,o=i.values[e],a=this.classes(Ri.labelElement,n?null:Ri.hidden,r&&s!=="disabled"?Ri.labelElementInteractive:null);return D("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!n).toString(),bind:this,class:a,"data-thumb-index":e,key:`${t}-label-${e}`,id:`${t}-label-${e}`,role:r?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):o)}renderValueInput(e){const{disabled:t,values:i}=this,r=i[e];return D("input",{key:`value-input-${e}`,afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:Ri.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:t?-1:0,type:"text",value:this._formatInputValue(r,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})}renderMax(){const{_isMaxInputActive:e,labels:t,rangeLabelInputsEnabled:i,state:r}=this,s=this.visibleElements.rangeLabels,n=this.classes(Ri.maxElement,{[Ri.hidden]:!s,[Ri.maxElementInteractive]:i&&r!=="disabled",[Ri.rangeElementActive]:e});return D("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMaxLabelCreate,bind:this,class:n,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:i?"button":null,tabIndex:!this.disabled&&i?0:-1},e?this.renderMaxInput():t.max)}renderMin(){const{_isMinInputActive:e,labels:t,rangeLabelInputsEnabled:i,state:r}=this,s=this.visibleElements.rangeLabels,n=this.classes(Ri.minElement,{[Ri.hidden]:!s,[Ri.minElementInteractive]:i&&r!=="disabled",[Ri.rangeElementActive]:e});return D("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMinLabelCreate,bind:this,class:n,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:i?"button":null,tabIndex:!this.disabled&&i?0:-1},e?this.renderMinInput():t.min)}renderMaxInput(){return D("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:Ri.rangeInput,"data-input-type":"max",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})}renderMinInput(){return D("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:Ri.rangeInput,"data-input-type":"min",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})}renderExtraContentElements(){return D("div",{bind:this,class:Ri.extraContentElement},this.extraNodes)}renderTicksContainer(){if(this.tickConfigs&&this.trackElement&&(this._trackHeight!==0||this._trackWidth!==0))return this.tickConfigs.map((e,t)=>D("div",{key:"ticks-container",class:this.classes(Ri.ticksContainerElement)},this.renderTicks(e,t)))}renderTicks(e,t){const{mode:i,values:r}=e;if(this.tickElements.getItemAt(t)||this.tickElements.add(new Qe,t),i==="position"){const o=Array.isArray(r)?r:[r];return this._calculateTickPositions(o).map((a,l)=>this.renderTickGroup(e,l,t,a))}if(i==="percent"&&Array.isArray(r)){const{max:o,min:a}=this,l=o-a,c=r.map(h=>this._applyPrecisionToPosition(h/100*l+a));return this._calculateTickPositions(c).map((h,p)=>this.renderTickGroup(e,p,t,h))}const s=Array.isArray(r)&&r.length?r[0]:isNaN(r)?null:r,n=this._getTickCounts(s,e);return this._calculateEquidistantTickPositions(n).map((o,a)=>this.renderTickGroup(e,a,t,o))}renderTickGroup(e,t,i,r){const s=e.mode==="position"?Array.isArray(e.values)?e.values[t]:e.values:this._valueFromPosition(r);if(!C(s)&&!isNaN(s))return D("div",{afterCreate:this._afterTickGroupCreate,afterRemoved:this._afterTickGroupRemoved,bind:this,"data-config":e,"data-position":r,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":s,onclick:this._onTickGroupClick,key:`tick-group-${t}`},this.renderTickLine(e,t,i,s),e.labelsVisible?this.renderTickLabel(e,t,i,s):null)}renderTickLine(e,t,i,r){return D("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":r.toString(),bind:this,class:Ri.tickElement,"data-config":e,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":r,key:`tick-label-${t}`,style:this._getPositionStyleForElement(r)})}renderTickLabel(e,t,i,r){const s=e.labelFormatFunction?e.labelFormatFunction(r,"tick",t):this.viewModel.getLabelForValue(r,"tick",t);return D("div",{afterCreate:this._afterTickLabelCreate,"aria-label":s,"aria-valuenow":r.toString(),"aria-valuetext":s,bind:this,class:Ri.tickLabelElement,"data-config":e,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":r,key:`tick-label-${t}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(r)}`},s)}_afterContainerCreate(e){this.addHandles(uwe(e,()=>this.scheduleRender()))}_afterTrackCreate(e){this._set("trackElement",e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()}_afterTrackRemoved(e){e.removeEventListener("pointerdown",this._onTrackPointerDown),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp)}_afterSegmentCreate(e){this.segmentElements.add(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)}_afterSegmentRemoved(e){this.segmentElements.remove(e),e.removeEventListener("pointerdown",this._onSegmentPointerDown)}_afterEffectiveSegmentCreate(e){this.effectiveSegmentElements.add(e)}_afterEffectiveSegmentRemoved(e){this.effectiveSegmentElements.remove(e)}_afterAnchorCreate(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const t=e["data-thumb-index"],i=e["data-value"],r=this.thumbElements.getItemAt(t)||null,s=this.labelElements.getItemAt(t)||null;this.thumbCreatedFunction(t,i,r,s)}}_afterAnchorUpdate(e){v(this._focusedAnchorIndex)&&e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}_afterAnchorRemoved(e){const t=this._anchorElements.indexOf(e,0);t>-1&&this._anchorElements.splice(t,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)}_afterThumbCreate(e){this.thumbElements.add(e)}_afterThumbRemoved(e){this.thumbElements.remove(e)}_afterLabelCreate(e){this.labelElements.add(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)}_afterLabelRemoved(e){this.labelElements.remove(e),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)}_afterInputCreate(e){if(e.focus(),e.select(),this.inputCreatedFunction){const t=e.getAttribute("data-input-type"),i=t==="thumb"?e["data-input-index"]:null;this.inputCreatedFunction(e,t,i)}}_afterTickLineCreate(e){const t=e["data-tick-config-index"],i=e["data-tick-group-index"],r=this.tickElements.getItemAt(t);r.getItemAt(i)?r.getItemAt(i).tickElement=e:r.add({groupElement:null,tickElement:e,labelElement:null},i)}_afterTickLabelCreate(e){const t=e["data-tick-config-index"],i=e["data-tick-group-index"],r=this.tickElements.getItemAt(t);r.getItemAt(i)?r.getItemAt(i).labelElement=e:r.add({groupElement:null,labelElement:e,tickElement:null},i)}_afterTickGroupRemoved(e){const t=e["data-tick-config-index"],i=this.tickElements.items[t],r=i==null?void 0:i.find(s=>s.groupElement===e);r&&i.remove(r)}_afterTickGroupCreate(e){var i,r;const t=e["data-config"];if(t&&t.tickCreatedFunction){const s=e["data-tick-config-index"],n=e["data-tick-group-index"],o=e["data-value"],a=(r=(i=this.tickElements)==null?void 0:i.getItemAt(s))==null?void 0:r.getItemAt(n);if(a){a.groupElement=e;const l=a.tickElement||null,c=a.labelElement||null;t.tickCreatedFunction(o,l,c)}}}_afterMaxLabelCreate(e){this._set("maxLabelElement",e)}_afterMinLabelCreate(e){this._set("minLabelElement",e)}_onAnchorKeyDown(e){if(this._isDisabled()||this.state==="editing")return;const{target:t}=e,i=Pc(e),{_anchorElements:r,values:s}=this,n=t["data-thumb-index"],o=r[n],a=s[n],l=[Kc.moveAnchorUp,Kc.moveAnchorDown,Kc.moveAnchorLeft,Kc.moveAnchorRight];if(i===Kc.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=n,this.notifyChange("state");else if(l.includes(i)){e.preventDefault();const{steps:c}=this,h=i===Kc.moveAnchorUp||i===Kc.moveAnchorRight?1:-1;if(v(c))this._toStep(n,this._isReversedLayout()?-1*h:h);else{const{precision:f}=this,m=this._getPositionOfElement(o),y=this._valueFromPosition(m),_=this._isHorizontalLayout()?h:-1*h;let b;b=f===0?this._positionFromValue(y+_):f===1?this._positionFromValue(y+.1*_):m+_,this._toPosition(n,b)}const p=this.values[n];a!==p&&this._emitThumbChangeEvent({index:n,oldValue:a,value:p})}else if(i===Kc.moveAnchorToMax||i===Kc.moveAnchorToMin){e.preventDefault();const{min:c,max:h}=this._getAnchorBoundsInPixels(n),p=this._isPositionInverted()?i===Kc.moveAnchorToMax?c:h:i===Kc.moveAnchorToMin?c:h;this._toPosition(n,p);const f=this.values[n];a!==f&&this._emitThumbChangeEvent({index:n,oldValue:a,value:f})}}_onAnchorPointerDown(e){if(this._isDisabled())return;const{target:t,clientX:i,clientY:r}=e,s=t["data-thumb-index"];s!==void 0&&(e.preventDefault(),this._anchorElements[s]&&this._anchorElements[s].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:i,clientY:r,index:s,position:this._getPositionOfElement(this._anchorElements[s])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onAnchorPointerMove(e){if(this.state==="editing"||!this._dragStartInfo)return;e.preventDefault();const{values:t,_anchorElements:i,_dragged:r,_dragStartInfo:s,_dragStartInfo:{index:n,position:o}}=this,{clientX:a,clientY:l}=e,c=r?"drag":"start",h=i[n],p=this._getPositionOfElement(h),f=this._applyPrecisionToPosition(this._isHorizontalLayout()?o+a-s.clientX:o+l-s.clientY);if(p===f)return;const m=t[n];this._dragged=!0,this._toPosition(n,f);const y=this.values[n];r?m!==y&&this._emitThumbDragEvent({index:n,state:c,value:y}):this._emitThumbDragEvent({index:n,state:c,value:m})}_onAnchorPointerUp(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:t}=this._dragStartInfo,i=this._dragged,r=this.values[t];this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=t,this.notifyChange("state"),i?this._emitThumbDragEvent({index:t,state:"stop",value:r}):(this.scheduleRender(),this.state!=="editing"&&this._emitThumbClickEvent({index:t,value:r}))}_onTrackPointerDown(e){const{_dragStartInfo:t,snapOnClickEnabled:i,state:r,values:s}=this;if(this._isDisabled()||r==="editing"||t||(document.addEventListener("pointermove",this._onTrackPointerMove),document.addEventListener("pointerup",this._onTrackPointerUp),!i||!s.length))return;const{steps:n}=this,{clientX:o,clientY:a}=e,l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l),h=this._getIndexOfNearestValue(c),p=s[h],f=s.some((b,w)=>b===p&&w!==h)&&c>p?this.values.lastIndexOf(p):h;if(C(f))return;const m=s[f],y=v(n)?this._calculateNearestStepPosition(l):l;this._toPosition(f,y),this._dragged=!0,this._dragStartInfo={clientX:o,clientY:a,index:f,position:y},this._focusedAnchorIndex=f,this.notifyChange("state"),this._emitThumbDragEvent({index:f,state:"start",value:m});const _=this.values[f];m!==_&&this._emitThumbDragEvent({index:f,state:"drag",value:_}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}_onTrackPointerMove(e){e.preventDefault(),this._dragged=!0}_onTrackPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp),this.snapOnClickEnabled||(this._dragged=!1),!this._dragged){const t=this._getCursorPositionFromEvent(e),i=this._valueFromPosition(t);this._emitTrackClickEvent({value:i})}}_onSegmentPointerDown(e){var a,l;e.preventDefault();const t=e.target,i=t["data-segment-index"],r=t["data-min-thumb-index"],s=t["data-max-thumb-index"];if(this._isDisabled()||C(r)||C(s))return;e.stopPropagation(),this._storeTrackDimensions(),document.addEventListener("pointerup",this._onSegmentPointerUp);const n=this._getAnchorDetails(r),o=this._getAnchorDetails(s);this.syncedSegmentsEnabled?(this.segmentElements.forEach(c=>c.classList.add(Ri.segmentElementActive)),this._anchorElements.forEach(c=>c.classList.add(Ri.anchorElementActive))):(this.segmentElements.getItemAt(i).classList.add(Ri.segmentElementActive),(a=this._anchorElements[n.index])==null||a.classList.add(Ri.anchorElementActive),(l=this._anchorElements[o.index])==null||l.classList.add(Ri.anchorElementActive)),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:i,details:this._normalizeSegmentDetails({min:n,max:o})},this.draggableSegmentsEnabled&&(document.addEventListener("pointermove",this._onSegmentPointerMove),this.notifyChange("state"),this._emitSegmentDragEvent({index:i,state:"start",thumbIndices:[r,s]}))}_onSegmentPointerMove(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:t,_trackWidth:i,_segmentDragStartInfo:{index:r,cursorPosition:s,details:{min:n,max:o}}}=this,{index:a,position:l,value:c}=n,{index:h,position:p,value:f}=o;this._dragged=!0;const m=this._getCursorPositionFromEvent(e);if(m===s)return;const y=this._positionToPercent(s),_=this._positionToPercent(m)-y,b=this._positionToPercent(l)+_,w=this._positionToPercent(p)+_,{min:T}=this._getAnchorBoundsAsPercents(a),{max:S}=this._getAnchorBoundsAsPercents(h);let E=!1,M=!1;if(b<T?E=!0:w>S&&(M=!0),E){const{min:X,max:K}=this.viewModel.getBoundsForValueAtIndex(a),re=this._isPositionInverted()?K:X,q=re,L=f+(re-c),N=L-this.values[h];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(N):this._updateAnchorValues([a,h],[q,L]))}if(M){const{min:X,max:K}=this.viewModel.getBoundsForValueAtIndex(h),re=this._isPositionInverted()?X:K,q=re,L=c+(re-f),N=L-this.values[a];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(N):this._updateAnchorValues([a,h],[L,q]))}const A=this._isHorizontalLayout()?i:t,$=w/100*A,I=b/100*A,k=this.values,V=[k[a],k[h]],B=this._getValueForAnchorAtPosition(a,I),G=this._getValueForAnchorAtPosition(h,$);this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(B-V[0]):this._updateAnchorValues([a,h],[B,G]),[this.values[a],this.values[h]].every((X,K)=>X===V[K])||this._emitSegmentDragEvent({index:r,state:"drag",thumbIndices:[a,h]})}_onSegmentPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{_dragged:t,max:i,min:r,values:s}=this,{index:n,details:{min:{index:o},max:{index:a}}}=this._segmentDragStartInfo;if(this.segmentElements.forEach(l=>l.classList.remove(Ri.segmentElementActive)),this._anchorElements.forEach(l=>l.classList.remove(Ri.anchorElementActive)),this.draggableSegmentsEnabled){const l=i-r,c=s[o],h=s[a];this._lastMovedHandleIndex=c===h?c>l/2?o:a:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:n,state:"stop",thumbIndices:[o,a]})}if(!t){const l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l);this._emitSegmentClickEvent({index:n,value:c,thumbIndices:[o,a]})}}_onTickGroupClick(e){const t=e.target;if(t["data-config"]){const i=t["data-tick-config-index"],r=t["data-tick-group-index"],s=t["data-value"];this._emitTickClickEvent({configIndex:i,groupIndex:r,value:s})}}_storeTrackDimensions(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}}_onLabelPointerDown(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onLabelPointerMove(){this._isDisabled()||(this._dragged=!0)}_onLabelPointerUp(e){if(this._isDisabled())return;const t=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&v(t)&&(this._activeLabelInputIndex=t),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}_onLabelInputBlur(e){const{_activeLabelInputIndex:t,values:i,viewModel:r}=this,s=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!s)return;const n=this._parseInputValue(s,"value",t),o=i[t],{min:a,max:l}=this.viewModel.getBoundsForValueAtIndex(t);if(n<a||n>l)return;r.setValue(t,n);const c=this.values[t];o!==c&&this._emitThumbChangeEvent({index:t,oldValue:o,value:c})}_onInputKeyDown(e){if(this._isDisabled())return;const{target:t}=e,i=Pc(e),{hideInput1:r,hideInput2:s,hideInput3:n}=Kc,{_activeLabelInputIndex:o,_anchorElements:a}=this,l=t;if(i===r||i===s||i===n){e.stopPropagation();const c=o;l.blur(),v(c)?a[c].focus():l.parentElement.focus()}}_onMaxLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"max-click",value:this.max}),this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state")))}_onMaxLabelKeyDown(e){this._isDisabled()||Pc(e)!==Kc.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxInputBlur(e){const t=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!t)return;const i=this.max,r=this._parseInputValue(t,"max");r<=this.min||(this.viewModel.set("max",r),this.max!==i&&this._emitMaxChangeEvent({oldValue:i,value:this.max}))}_onMinLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"min-click",value:this.min}),this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state")))}_onMinLabelKeyDown(e){this._isDisabled()||Pc(e)!==Kc.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinInputBlur(e){const t=e.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!t)return;const i=this.min,r=this._parseInputValue(t,"min");r>=this.max||(this.viewModel.set("min",r),this.min!==i&&this._emitMinChangeEvent({oldValue:i,value:this.min}))}_isDisabled(){return this.disabled||this.state==="disabled"}_positionFromValue(e){const{max:t,min:i}=this,r=t-i;if(r===0)return 0;const{_trackHeight:s,_trackWidth:n}=this,o=this._isHorizontalLayout();let a=parseFloat(o?(n*(e-i)/r).toFixed(2):(s*(t-e)/r).toFixed(2));return this._isReversedLayout()&&(a=o?n-a:s-a),a}_valueFromPosition(e){const{_trackHeight:t,_trackWidth:i,max:r,min:s,precision:n}=this,o=r-s;let a=this._isHorizontalLayout()?e*o/i+s:o*(1e3-e/t*1e3)/1e3+s;return this._isReversedLayout()&&(a=r+s-a),parseFloat(a.toFixed(n))}_positionToPercent(e){const{_trackHeight:t,_trackWidth:i}=this,r=100*e/(this._isHorizontalLayout()?i:t);return this._applyPrecisionToPosition(r)}_applyPrecisionToPosition(e){return parseFloat(e.toFixed(this._positionPrecision))}_isPositionInverted(){const{layout:e}=this;return e==="horizontal-reversed"||e==="vertical"}_isHorizontalLayout(){return this.layout.includes("horizontal")}_isReversedLayout(){return this.layout.includes("reversed")}_normalizeSegmentDetails(e){if(this._isPositionInverted()){const{min:t,max:i}=e;return{min:i,max:t}}return e}_parseInputValue(e,t,i){return this.inputParseFunction?this.inputParseFunction(e,t,i):this.viewModel.defaultInputParseFunction(e)}_formatInputValue(e,t,i){return this.inputFormatFunction?this.inputFormatFunction(e,t,i):this.viewModel.defaultInputFormatFunction(e)}_getAnchorDetails(e){const t=[...this.values].sort((r,s)=>r-s)[e],i=this.values.indexOf(t);return{index:i,position:this._getPositionOfElement(this._anchorElements[i]),value:t}}_updateAnchorStyle(e,t){const i=this._anchorElements[e];i&&(this._isHorizontalLayout()?i.style.left=`${t}`:i.style.top=`${t}`)}_getStyleForAnchor(e,t,i){const r=this._getPositionStyleForElement(e);if(this.values.length===1)return`${r}`;const s=this._zIndices[t];return`${r}; z-index: ${i?this._zIndexOffset+s:s}`}_getPositionStyleForElement(e){const t=this._positionFromValue(e),i=this._positionToPercent(t);return`${this._isHorizontalLayout()?"left":"top"}: ${i+"%"}`}_getPositionOfElement(e){const t=this._getDimensions(e.offsetParent),i=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(i.left-t.left):this._applyPrecisionToPosition(i.top-t.top)}_updateAnchorValues(e,t){e.forEach((i,r)=>this._toValue(i,t[r]))}_updateAnchorValuesByDifference(e){const{min:t,max:i,values:r}=this;r.forEach((s,n)=>this._toValue(n,Math.max(Math.min(s+e,i),t)))}_toValue(e,t){v(this.steps)&&(t=this._getStepValues()[this._getIndexOfNearestStepValue(t)]),this._updateAnchorStyle(e,this._getPositionStyleForElement(t)),this.viewModel.setValue(e,t)}_toPosition(e,t){const i=v(this.steps)?this._getStepValueForAnchorAtPosition(e,t):this._getValueForAnchorAtPosition(e,t);this._updateAnchorStyle(e,this._getPositionStyleForElement(i)),this.viewModel.setValue(e,i)}_getValueForAnchorAtPosition(e,t){const{min:i,max:r}=this._getAnchorBoundsInPixels(e),{min:s,max:n}=this.viewModel.getBoundsForValueAtIndex(e);let o,a,l=null;return this._isPositionInverted()?(o=s,a=n):(o=n,a=s),l=t>r?o:t<i?a:this._valueFromPosition(t),l>n?l=n:l<s&&(l=s),l}_getStepValueForAnchorAtPosition(e,t){const i=this._getStepValues(),r=this._calculateNearestStepPosition(t),s=this._getValueForAnchorAtPosition(e,r);return i[this._getIndexOfNearestStepValue(s)]}_getAnchorBoundsAsPercents(e){const{min:t,max:i}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(t),max:this._positionToPercent(i)}}_getAnchorBoundsInPixels(e){const{_anchorElements:t,_trackHeight:i,_trackWidth:r,effectiveMax:s,effectiveMin:n,thumbsConstrained:o}=this,a=t[e-1],l=t[e+1],c=this._isHorizontalLayout()?r:i;let h,p;return this._isPositionInverted()?(h=v(n)?this._positionFromValue(n):c,p=v(s)?this._positionFromValue(s):0):(h=v(s)?this._positionFromValue(s):c,p=v(n)?this._positionFromValue(n):0),o?this._isPositionInverted()?{max:a?this._getPositionOfElement(a):h,min:l?this._getPositionOfElement(l):p}:{max:l?this._getPositionOfElement(l):h,min:a?this._getPositionOfElement(a):p}:{max:h,min:p}}_getIndexOfNearestValue(e){return this.values.indexOf(this.values.reduce((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t))}_getCursorPositionFromEvent(e){const t=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-t.left:e.clientY-t.top}_getStepValues(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:t,min:i}=this,r=Math.ceil((t-i)/e),s=[];for(let n=0;n<=r;n++){const o=i+e*n;s.push(o>t?t:o)}return s}_toStep(e,t){const{values:i,viewModel:r}=this,s=i[e],n=this._getStepValues(),o=n.indexOf(s);let a=null;if(o>-1){let l=n[o+t];isNaN(l)&&(l=n[o]);const c=this._positionFromValue(l);a=this._getStepValueForAnchorAtPosition(e,c)}else a=n[this._getIndexOfNearestStepValue(s)+t];r.setValue(e,a)}_getIndexOfNearestStepValue(e){const{steps:t}=this;if(C(t))return null;const i=this._getStepValues(),r=i.reduce((s,n)=>Math.abs(n-e)<Math.abs(s-e)?n:s);return i.indexOf(r)}_calculateNearestStepPosition(e){const t=this._valueFromPosition(e),i=this._getIndexOfNearestStepValue(t),r=this._getStepValues();return this._positionFromValue(r[i])}_getTickCounts(e,t){const{mode:i}=t;return i==="count"||i==="position"?e||0:i==="percent"&&100/e||0}_calculateTickPositions(e){return e.map(t=>this._positionFromValue(t))}_calculateEquidistantTickPositions(e){const{_trackWidth:t,_trackHeight:i}=this,r=this._isHorizontalLayout()?t:i,s=r/(e-1),n=[];if(e===1)return[r/2];for(let o=0;o<e;o++){const a=o*s;a<=r&&n.push(a)}return n}_getDimensions(e){try{return e.getBoundingClientRect()}catch(t){if(typeof t=="object"&&t!==null)return new DOMRect(0,0,0,0);throw t}}_emitTrackClickEvent(e){this.emit("track-click",{...e,type:"track-click"})}_emitTickClickEvent(e){this.emit("tick-click",{...e,type:"tick-click"})}_emitMaxChangeEvent(e){this.emit("max-change",{...e,type:"max-change"})}_emitMinChangeEvent(e){this.emit("min-change",{...e,type:"min-change"})}_emitThumbChangeEvent(e){this.emit("thumb-change",{...e,type:"thumb-change"})}_emitThumbClickEvent(e){this.emit("thumb-click",{...e,type:"thumb-click"})}_emitThumbDragEvent(e){this.emit("thumb-drag",{...e,type:"thumb-drag"})}_emitSegmentClickEvent(e){this.emit("segment-click",{...e,type:"segment-click"})}_emitSegmentDragEvent(e){this.emit("segment-drag",{...e,type:"segment-drag"})}_emitRangeLabelClickEvent(e){this.emit(e.type,{...e})}};u([d()],Qi.prototype,"disabled",void 0),u([d()],Qi.prototype,"draggableSegmentsEnabled",void 0),u([d()],Qi.prototype,"effectiveMax",null),u([d()],Qi.prototype,"effectiveMin",null),u([d({readOnly:!0})],Qi.prototype,"effectiveSegmentElements",void 0),u([d()],Qi.prototype,"extraNodes",void 0),u([d()],Qi.prototype,"inputCreatedFunction",void 0),u([d()],Qi.prototype,"inputFormatFunction",null),u([d()],Qi.prototype,"inputParseFunction",null),u([d()],Qi.prototype,"label",null),u([d({readOnly:!0})],Qi.prototype,"labelElements",void 0),u([d()],Qi.prototype,"labelInputsEnabled",void 0),u([d()],Qi.prototype,"labelFormatFunction",null),u([d({readOnly:!0})],Qi.prototype,"labels",null),u([d({value:"horizontal"})],Qi.prototype,"layout",null),u([d()],Qi.prototype,"max",null),u([d({readOnly:!0})],Qi.prototype,"maxLabelElement",void 0),u([d(),Es("esri/widgets/Slider/t9n/Slider")],Qi.prototype,"messages",void 0),u([d()],Qi.prototype,"min",null),u([d({readOnly:!0})],Qi.prototype,"minLabelElement",void 0),u([d()],Qi.prototype,"precision",null),u([d()],Qi.prototype,"rangeLabelInputsEnabled",void 0),u([d({readOnly:!0})],Qi.prototype,"segmentElements",void 0),u([d()],Qi.prototype,"snapOnClickEnabled",void 0),u([d({readOnly:!0})],Qi.prototype,"state",null),u([d()],Qi.prototype,"steps",void 0),u([d()],Qi.prototype,"syncedSegmentsEnabled",void 0),u([d()],Qi.prototype,"thumbsConstrained",null),u([d()],Qi.prototype,"thumbCreatedFunction",void 0),u([d({readOnly:!0})],Qi.prototype,"thumbElements",void 0),u([d()],Qi.prototype,"tickConfigs",null),u([d({readOnly:!0})],Qi.prototype,"tickElements",void 0),u([d({readOnly:!0})],Qi.prototype,"trackElement",void 0),u([d()],Qi.prototype,"values",null),u([d()],Qi.prototype,"viewModel",void 0),u([d()],Qi.prototype,"visibleElements",void 0),u([Zt("visibleElements")],Qi.prototype,"castVisibleElements",null),Qi=u([P(yCt)],Qi);const _Ct=Qi,ys="esri-time-slider",Dt={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:`${ys}`,timeSliderOutOfBounds:`${ys}--out-of-bounds`,timeSliderMode:`${ys}__mode--`,timeSliderLayout:`${ys}__layout--`,timeSliderRow:`${ys}__row`,animation:`${ys}__animation`,animationButton:`${ys}__animation-button`,animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:`${ys}__time-extent`,timeExtentGroup:`${ys}__time-extent-group`,timeExtentDate:`${ys}__time-extent-date`,timeExtentTime:`${ys}__time-extent-time`,timeExtentSeparator:`${ys}__time-extent-separator`,playbackControls:`${ys}__playback-controls`,min:`${ys}__min`,minDate:`${ys}__min-date`,minTime:`${ys}__min-time`,slider:`${ys}__slider`,sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:`${ys}__max`,maxDate:`${ys}__max-date`,maxTime:`${ys}__max-time`,previous:`${ys}__previous`,previousButton:`${ys}__previous-button`,previousIcon:"esri-icon-reverse",next:`${ys}__next`,nextButton:`${ys}__next-button`,nextIcon:"esri-icon-forward",warning:`${ys}__warning`,warningIcon:"esri-icon-notice-triangle",warningText:`${ys}__warning-text`,hasActions:`${ys}--has-actions`,actions:`${ys}__actions`,actionsButton:`${ys}__actions-button`};var UY;let zm=UY=class extends ge{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new UY(ne({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};u([d({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],zm.prototype,"enabled",void 0),u([d({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],zm.prototype,"longNames",void 0),u([d({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],zm.prototype,"minimized",void 0),u([d({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],zm.prototype,"pinnedLevels",void 0),u([d({type:String,json:{read:{source:"site"},write:{target:"site"}}})],zm.prototype,"site",void 0),u([d({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],zm.prototype,"facility",void 0),u([d({type:String,json:{read:{source:"level"},write:{target:"level"}}})],zm.prototype,"level",void 0),zm=UY=u([P("esri.webdoc.widgets.FloorFilter")],zm);const vCt=zm;var VY;const sN=new _i({slider:"slider",picker:"picker"});let CE=VY=class extends ge{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new VY({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};u([d({type:sN.apiValues,nonNullable:!0,json:{type:sN.jsonValues,default:null,read:{reader:sN.read},write:{isRequired:!0,writer:sN.write}}})],CE.prototype,"interactionMode",void 0),u([d({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=this.stopInterval!=null;return{enabled:!e,isRequired:!e}}}}})],CE.prototype,"numStops",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],CE.prototype,"stopInterval",void 0),CE=VY=u([P("esri.webdoc.widgets.Range")],CE);const bCt=CE;var BY;let ga=BY=class extends ge{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){if(!e)return;const t=e[0]!=null?new Date(e[0]):null,i=e[1]!=null?new Date(e[1]):null;return new Ts({start:t,end:i})}writeCurrentTimeExtent(e,t,i){e&&Sa(i,[v(e.start)?e.start.getTime():null,v(e.end)?e.end.getTime():null],t)}readFullTimeExtent(e,t){const i=t.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,s=i.startTime!=null?new Date(i.startTime):null;return new Ts({start:s,end:r})}writeFullTimeExtent(e,t){if(!e)return;const i=t.properties=t.properties||{},r=e.end,s=e.start;r&&(i.endTime=v(r)?r.getTime():null),s&&(i.startTime=v(s)?s.getTime():null)}readStopInterval(e,t,i){return e?yt.fromJSON({value:e.interval,unit:e.units},i):null}writeStopInterval(e,t,i,r){if(!e)return;const s=e.toJSON(r);Sa(i,{interval:s.value,units:s.unit},t)}readStops(e){return e&&e.length?e.map(t=>new Date(t)):null}writeStops(e,t,i){e&&e.length&&Sa(i,e.map(r=>r.getTime()),t)}clone(){return new BY(ne({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};u([d({type:Ts,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],ga.prototype,"currentTimeExtent",void 0),u([Fe("currentTimeExtent")],ga.prototype,"readCurrentTimeExtent",null),u([Ge("currentTimeExtent")],ga.prototype,"writeCurrentTimeExtent",null),u([d({type:Ts,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],ga.prototype,"fullTimeExtent",void 0),u([Fe("fullTimeExtent")],ga.prototype,"readFullTimeExtent",null),u([Ge("fullTimeExtent")],ga.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],ga.prototype,"loop",void 0),u([d({type:Number,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var r;const e=!!this.stopInterval,t=!!((r=this.stops)!=null&&r.length),i=!(e||t);return{enabled:i,isRequired:i}}}}})],ga.prototype,"numStops",void 0),u([d({type:[1,2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],ga.prototype,"numThumbs",void 0),u([d({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],ga.prototype,"stopDelay",void 0),u([d({type:yt,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy(){var i;const e=this.numStops!=null,t=!!((i=this.stops)!=null&&i.length);return{enabled:!t,isRequired:!(e||t)}}}}})],ga.prototype,"stopInterval",void 0),u([Fe("stopInterval")],ga.prototype,"readStopInterval",null),u([Ge("stopInterval")],ga.prototype,"writeStopInterval",null),u([d({type:[Date],json:{read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],ga.prototype,"stops",void 0),u([Fe("stops")],ga.prototype,"readStops",null),u([Ge("stops")],ga.prototype,"writeStops",null),ga=BY=u([P("esri.webdoc.widgets.TimeSlider")],ga);const m3e=ga;var zY;let AE=zY=class extends ge{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new zY(ne({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};u([d({type:bCt,json:{write:!0}})],AE.prototype,"range",void 0),u([d({type:m3e,json:{write:!0}})],AE.prototype,"timeSlider",void 0),u([d({type:vCt,json:{write:!0}})],AE.prototype,"floorFilter",void 0),AE=zY=u([P("esri.webdoc.Widgets")],AE);const wCt=AE,Pfe=1e4;function GY(e){return v(e)&&e.count!==void 0}function E6(e){return v(e)&&e.interval!==void 0}function $fe(e){return v(e)&&e.dates!==void 0}function Lfe(e){return e.declaredClass==="esri.WebMap"}let Uo=class extends jf(ps.EventedAccessor){constructor(e){super(e),this._animationController=null,this._isViewTimeExtentInitialized=!1,this._timerId=null,this.actions=new Qe,this.fullTimeExtent=null,this.loop=!1,this.mode="time-window",this.stops={count:10},this.timeExtent=null,this.view=null}initialize(){this.handles.add([te(()=>this.effectiveStops,()=>{C(this.timeExtent)&&(this.timeExtent=this._getDefaultTimeExtent())},st),te(()=>this.view,(e,t)=>{this._unregisterWidget(t),this._registerWidget(e)},Gs),te(()=>this.timeExtent,e=>{if(C(this.view))return;const t=this.view.timeExtent;(C(e)||e.isAllTime)&&(C(t)||t.isAllTime)||v(e)&&v(t)&&e.equals(t)||(this.view.timeExtent=e)},st),te(()=>Mn(this.view,e=>e.timeExtent),e=>{this._isViewTimeExtentInitialized?(C(e)||e.isAllTime)&&(C(this.timeExtent)||this.timeExtent.isAllTime)||v(e)&&v(this.timeExtent)&&e.equals(this.timeExtent)||(this.timeExtent=e):this._isViewTimeExtentInitialized=!0})])}destroy(){v(this._timerId)&&(clearInterval(this._timerId),this._timerId=null),this._unregisterWidget(this.view),this.view=null,v(this._animationController)&&(this._animationController.abort(),this._animationController=null)}get effectiveStops(){var i,r;const{fullTimeExtent:e,stops:t}=this;if($fe(t)){const{dates:s}=t;if(s==null||s.length===0)return null;const n=s.sort((l,c)=>l.getTime()-c.getTime());if(C(e))return n;const{start:o,end:a}=e;return C(o)||C(a)?n:n.filter(l=>!(l.getTime()<o.getTime()||l.getTime()>a.getTime()))}if(GY(t)){const s=(i=t.timeExtent)!=null?i:e;return this._divideTimeExtentByCount(s,t.count)}if(E6(t)){const s=(r=t.timeExtent)!=null?r:e;return this._divideTimeExtentByInterval(s,t.interval)}return[]}set playRate(e){e<=0||e>36e5||(this.state==="playing"&&this._startAnimation(),this._set("playRate",e))}get state(){return C(this.fullTimeExtent)?"disabled":v(this._animationController)?"playing":"ready"}get timeExtentValues(){const{mode:e,timeExtent:t}=this;if(C(t)||t.isAllTime||t.isEmpty)return null;const{start:i,end:r}=t;switch(e){case"cumulative-from-end":case"instant":return v(i)?[i.getTime()]:null;case"cumulative-from-start":return v(r)?[r.getTime()]:null;case"time-window":return v(i)&&v(r)?[i.getTime(),r.getTime()]:null}}static async getPropertiesFromWebMap(e,t){var h,p;if(C(e)||!Lfe(e))return null;await e.load({signal:t});const i=(h=e==null?void 0:e.widgets)==null?void 0:h.timeSlider;if(!i)return null;const{getFullTimeExtentFromWebDocument:r,getModeFromTimeSlider:s,getStopsFromTimeSlider:n,getTimeExtentFromTimeSlider:o}=await Q(()=>import("./utils.079daaa9.js"),[]),a=await r(e,t),l=i.loop,c=s(i);return{fullTimeExtent:a,loop:l,mode:c,playRate:(p=i.stopDelay)!=null?p:2e3,stops:n(i),timeExtent:o(i,c)}}next(){this._step({forward:!0,allowRestart:!1})}play(){this._startAnimation()}previous(){this._step({forward:!1,allowRestart:!1})}stop(){this._stopAnimation()}triggerAction(e){this.emit("trigger-action",{action:e})}updateWebDocument(e){if(Lfe(e)){const t=new m3e({currentTimeExtent:this.timeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:GY(this.stops)?this.stops.count:null,numThumbs:this.mode==="time-window"?2:1,stopDelay:this.playRate,stopInterval:E6(this.stops)?this.stops.interval:null,stops:$fe(this.stops)?this.stops.dates:null});e.widgets?e.widgets.timeSlider=t:e.widgets=new wCt({timeSlider:t})}}valuesToTimeExtent(e){if(C(e))return null;const t=e.sort((s,n)=>s-n).map(s=>new Date(s)),i=t.length>0?t[0]:null,r=t.length>1?t[1]:null;switch(this.mode){case"time-window":return new Ts({start:i,end:r});case"instant":return new Ts({start:i,end:i});case"cumulative-from-start":return new Ts({start:null,end:i});case"cumulative-from-end":return new Ts({start:i,end:null});default:return Ts.allTime}}async _animate(){try{const e=this.view,t=Mn(this._animationController,i=>i.signal);await Promise.all([M0(this.playRate,null,t),v(e)&&I0(()=>e.updating===!1,t)])}catch(e){return Ws(e)||se.getLogger(this.declaredClass).error(e),void(this._animationController=null)}this._step({forward:!0,allowRestart:!1}),C(this._animationController)||this._animate()}_divideTimeExtentByCount(e,t=10){if(!e||!t)return[];const{start:i,end:r}=e;if(C(i)||C(r))return[];if(t>Pfe)return this._divideTimeExtentByCount(e);const s=[],n=i.getTime(),o=r.getTime()-n;for(let a=0;a<=t;a++)s.push(new Date(n+a/t*o));return s}_divideTimeExtentByInterval(e,t,i=Pfe){if(!e||!t)return[];const{start:r,end:s}=e;if(C(r)||C(s))return[];const n=s.getTime()-r.getTime(),o=t.toMilliseconds();if(o<=0||n/o>i)return this._divideTimeExtentByCount(e);const a=[],{value:l,unit:c}=t;let h=r;for(;h.getTime()<=s.getTime();)a.push(new Date(h.getTime())),h=m0(h,l,c);return a}_getDefaultTimeExtent(){const{effectiveStops:e,mode:t}=this;if(C(e)||!t)return null;switch(t){case"time-window":return e.length>1?new Ts({start:e[0],end:e[1]}):null;case"cumulative-from-start":return e.length>0?new Ts({start:null,end:e[0]}):null;case"cumulative-from-end":return e.length>0?new Ts({start:e[0],end:null}):null;case"instant":return e.length>0?new Ts({start:e[0],end:e[0]}):null;default:return null}}_registerWidget(e){v(e)&&(e.persistableViewModels.includes(this)||e.persistableViewModels.add(this))}_startAnimation(){this._stopAnimation(),this._animationController=new AbortController,this._step({forward:!0,allowRestart:!0}),this._animate()}_step(e){const{forward:t,allowRestart:i}=e,{effectiveStops:r}=this;if(C(this.timeExtentValues)||C(r))return;const s=r.map(h=>h.getTime()),n=this.timeExtentValues.map(h=>{const p=s.indexOf(h);if(p!==-1)return p;const f=s.reduce((m,y)=>Math.abs(y-h)<Math.abs(m-h)?y:m);return s.indexOf(f)}),o=n.map(h=>h+(t?1:-1)),a=o.some(h=>h<0||h>s.length-1),{loop:l,state:c}=this;if(a)if(l||i){const h=Math.min(...n),p=Math.max(...n),f=(t?n.map(m=>m-h):n.map(m=>m+(s.length-1-p))).map(m=>s[m]);this.timeExtent=this.valuesToTimeExtent(f)}else c==="playing"&&this.stop();else{const h=o.map(p=>s[p]);this.timeExtent=this.valuesToTimeExtent(h)}}_stopAnimation(){v(this._animationController)&&(this._animationController.abort(),this._animationController=null)}_unregisterWidget(e){v(e)&&e.persistableViewModels.remove(this)}};u([d()],Uo.prototype,"_animationController",void 0),u([d({type:Qe})],Uo.prototype,"actions",void 0),u([d({readOnly:!0})],Uo.prototype,"effectiveStops",null),u([d({type:Ts})],Uo.prototype,"fullTimeExtent",void 0),u([d({nonNullable:!0})],Uo.prototype,"loop",void 0),u([d({nonNullable:!0})],Uo.prototype,"mode",void 0),u([d({nonNullable:!0,value:1e3})],Uo.prototype,"playRate",null),u([d({readOnly:!0})],Uo.prototype,"state",null),u([d({cast:e=>C(e)?null:(E6(e)&&(e.interval=zr(yt,e.interval)),(E6(e)||GY(e))&&(e.timeExtent=zr(Ts,e.timeExtent)),e)})],Uo.prototype,"stops",void 0),u([d({type:Ts})],Uo.prototype,"timeExtent",void 0),u([d({readOnly:!0})],Uo.prototype,"timeExtentValues",null),u([d()],Uo.prototype,"view",void 0),u([d()],Uo.prototype,"next",null),u([d()],Uo.prototype,"play",null),u([d()],Uo.prototype,"previous",null),u([d()],Uo.prototype,"stop",null),u([d()],Uo.prototype,"updateWebDocument",null),Uo=u([P("esri.widgets.TimeSlider.TimeSliderViewModel")],Uo);const jY=Uo,xCt=3,TCt=858,SCt=new Qe([{minor:new yt({value:100,unit:"milliseconds"}),major:new yt({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new yt({value:500,unit:"milliseconds"}),major:new yt({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new yt({value:1,unit:"seconds"}),major:new yt({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new yt({value:2,unit:"seconds"}),major:new yt({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new yt({value:10,unit:"seconds"}),major:new yt({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new yt({value:15,unit:"seconds"}),major:new yt({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new yt({value:1,unit:"minutes"}),major:new yt({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new yt({value:5,unit:"minutes"}),major:new yt({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new yt({value:15,unit:"minutes"}),major:new yt({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new yt({value:1,unit:"hours"}),major:new yt({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new yt({value:6,unit:"hours"}),major:new yt({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new yt({value:1,unit:"days"}),major:new yt({value:1,unit:"months"}),format:{month:"long"}},{minor:new yt({value:2,unit:"days"}),major:new yt({value:1,unit:"months"}),format:{month:"short"}},{minor:new yt({value:3,unit:"days"}),major:new yt({value:1,unit:"months"}),format:{month:"short"}},{minor:new yt({value:4,unit:"days"}),major:new yt({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new yt({value:1,unit:"weeks"}),major:new yt({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new yt({value:1,unit:"months"}),major:new yt({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new yt({value:2,unit:"months"}),major:new yt({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new yt({value:1,unit:"years"}),major:new yt({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new yt({value:2,unit:"years"}),major:new yt({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new yt({value:5,unit:"decades"}),major:new yt({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:1,unit:"centuries"}),major:new yt({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:2,unit:"centuries"}),major:new yt({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:5,unit:"centuries"}),major:new yt({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:10,unit:"centuries"}),major:new yt({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:20,unit:"centuries"}),major:new yt({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:50,unit:"centuries"}),major:new yt({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:100,unit:"centuries"}),major:new yt({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:200,unit:"centuries"}),major:new yt({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:500,unit:"centuries"}),major:new yt({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new yt({value:1e3,unit:"centuries"}),major:new yt({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let nn=class extends pn{constructor(e,t){super(e,t),this._ignoreNextSliderUpdate=!1,this._slider=new _Ct({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.disabled=!1,this.iconClass=Dt.widgetIcon,this.labelFormatFunction=null,this.messages=null,this.messagesCommon=null,this.tickConfigs=null,this.timeVisible=!1,this.viewModel=new jY}initialize(){this.addHandles([te(()=>this._slider.values,e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);v(this.timeExtent)?v(t)?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:v(t)&&(this.timeExtent=t)}),te(()=>this.effectiveStops,()=>this._updateSliderSteps(),st)])}loadDependencies(){return Promise.all([Q(()=>import("./calcite-action.0466daf5.js"),["assets/calcite-action.0466daf5.js","assets/action.4ad29f2f.js","assets/guid.ba2965fd.js","assets/interactive.5b40332c.js","assets/loadable.f81dc576.js","assets/t9n.6be6d1c5.js","assets/observers.0143061c.js","assets/icon.2acbc95d.js","assets/loader.5c70f655.js"]),Q(()=>import("./calcite-action-menu.ae738a12.js"),["assets/calcite-action-menu.ae738a12.js","assets/action-menu.6a4dc6a9.js","assets/guid.ba2965fd.js","assets/t9n.6be6d1c5.js","assets/observers.0143061c.js","assets/loadable.f81dc576.js","assets/action.4ad29f2f.js","assets/interactive.5b40332c.js","assets/icon.2acbc95d.js","assets/loader.5c70f655.js","assets/openCloseComponent.79fe4357.js","assets/debounce.aad9914a.js"])])}destroy(){this._slider.destroy(),this._tickFormat=null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get effectiveStops(){return this.viewModel.effectiveStops}get fullTimeExtent(){return this.viewModel.fullTimeExtent}set fullTimeExtent(e){this.viewModel.fullTimeExtent=e}get interactive(){var e;return!this.disabled&&((e=this.viewModel)==null?void 0:e.state)!=="disabled"}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}set layout(e){["auto","compact","wide"].includes(e)||(e="auto"),this._set("layout",e)}get loop(){return this.viewModel.loop}set loop(e){this.viewModel.loop=e}get mode(){return this.viewModel.mode}set mode(e){this.viewModel.mode=e}get playRate(){return this.viewModel.playRate}set playRate(e){this.viewModel.playRate=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}static async getPropertiesFromWebMap(e,t){return jY.getPropertiesFromWebMap(e,t)}next(){return this.viewModel.next()}play(){return this.viewModel.play()}previous(){return this.viewModel.previous()}stop(){return this.viewModel.stop()}render(){var re;const{_slider:e,actions:t,domNode:i,effectiveStops:r,fullTimeExtent:s,interactive:n,messages:o,messagesCommon:a,mode:l,tickConfigs:c,timeExtent:h,timeVisible:p,viewModel:{state:f,timeExtentValues:m}}=this;if(v(s)){const{start:q,end:L}=s;if(v(q)&&v(L)){const N=q.getTime(),U=L.getTime(),W=e.min!==N||e.max!==U;if(W&&(e.min=N,e.max=U),v(c))e.tickConfigs!==c&&(e.tickConfigs=c);else{const Z=(U-N)/(((re=e.trackElement)==null?void 0:re.offsetWidth)||400),ie=SCt.find(ce=>ce.minor.toMilliseconds()>xCt*Z),Y=this._tickFormat!==ie&&ie!=null;if(Y&&(this._tickFormat=ie),W||Y){const ce={mode:"position",values:this._getTickPositions(ie.minor),labelsVisible:!1,tickCreatedFunction:(ve,Se)=>{Se.classList.add(Dt.sliderMinorTick)}},pe={mode:"position",values:this._getTickPositions(ie.major),labelsVisible:!0,tickCreatedFunction:(ve,Se)=>{Se.classList.add(Dt.sliderMajorTick)},labelFormatFunction:ve=>Ou(ve,ie.format)};e.tickConfigs=[ce,pe]}}}}const y=C(this.fullTimeExtent)||C(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||v(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||v(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(y)switch(this._ignoreNextSliderUpdate=!0,l){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else v(m)?xg(e.values,m)||(e.values=m):e.values=null;e.disabled=!n;const _=f==="ready",b=f==="playing",w=y||!n||C(r)||r.length===0,T=this.layout==="auto"?i.clientWidth<TCt?"compact":"wide":this.layout,S=D("div",{class:Dt.animation},D("button",{"aria-disabled":w?"true":"false","aria-label":b?a.control.stop:a.control.play,bind:this,class:this.classes(Dt.esriWidgetButton,Dt.animationButton,w&&Dt.esriButtonDisabled),disabled:w,title:b?a.control.stop:a.control.play,onclick:this._playOrStopClick,type:"button"},D("div",{class:this.classes((_||w)&&Dt.animationPlay,b&&Dt.animationPause)}))),E=v(this.labelFormatFunction)?D("div",{key:"extent",bind:this,class:Dt.timeExtentDate,"data-type":"extent","data-layout":T,"data-date":Mn(h,q=>[q.start,q.end]),afterCreate:this._createLabel,afterUpdate:this._createLabel}):C(h)||v(h)&&h.isAllTime?[D("div",{class:this.classes(Dt.warning,Dt.warningIcon)}),D("div",{key:"warning-text",class:Dt.warningText},o.noTimeExtent)]:h.isEmpty?[D("div",{class:this.classes(Dt.warning,Dt.warningIcon)}),D("div",{key:"warning-text",class:Dt.warningText},o.emptyTimeExtent)]:[v(h.start)&&D("div",{key:"start-date-group",class:Dt.timeExtentGroup},D("div",{key:"start-date",class:Dt.timeExtentDate},this._formatDate(h.start)),p&&D("div",{key:"start-time",class:Dt.timeExtentTime},this._formatTime(h.start))),v(h.start)&&v(h.end)&&h.start.getTime()!==h.end.getTime()&&D("div",{key:"separator",class:Dt.timeExtentSeparator},"\u2013"),v(h.end)&&(C(h.start)||h.start.getTime()!==h.end.getTime())&&D("div",{key:"end-date-group",class:Dt.timeExtentGroup},D("div",{key:"end-date",class:Dt.timeExtentDate},this._formatDate(h.end)),p&&D("div",{key:"end-time",class:Dt.timeExtentTime},this._formatTime(h.end)))],M=D("div",{class:this.classes(Dt.timeExtent,!n&&Dt.esriButtonDisabled)},[E]),A=v(this.labelFormatFunction)?D("div",{key:"min-date",bind:this,class:Dt.minDate,"data-date":Mn(s,q=>q.start),"data-type":"min","data-layout":T,afterCreate:this._createLabel,afterUpdate:this._createLabel}):v(s)&&v(s.start)&&[D("div",{key:"min-date",class:Dt.minDate},this._formatDate(s.start)),p&&D("div",{key:"min-time",class:Dt.minTime},this._formatTime(s.start))],$=D("div",{class:this.classes(Dt.min,!n&&Dt.esriButtonDisabled)},[A]),I=D("div",{class:Dt.slider},e.render()),k=v(this.labelFormatFunction)?D("div",{key:"max-date",bind:this,class:Dt.maxDate,"data-date":Mn(s,q=>q.end),"data-type":"max","data-layout":T,afterCreate:this._createLabel,afterUpdate:this._createLabel}):v(s)&&v(s.end)&&[D("div",{key:"max-date",class:Dt.maxDate},this._formatDate(s.end)),p&&D("div",{key:"max-time",class:Dt.maxTime},this._formatTime(s.end))],V=D("div",{class:this.classes(Dt.max,!n&&Dt.esriButtonDisabled)},[k]),B=D("div",{class:Dt.previous},D("button",{"aria-disabled":w?"true":"false","aria-label":a.pagination.previous,bind:this,class:this.classes(Dt.esriWidgetButton,Dt.previousButton,(b||w)&&Dt.esriButtonDisabled),disabled:w,title:a.pagination.previous,onclick:this._previousClick,type:"button"},D("div",{class:Dt.previousIcon}))),G=D("div",{class:Dt.next},D("button",{"aria-disabled":w?"true":"false","aria-label":a.pagination.next,bind:this,class:this.classes(Dt.esriWidgetButton,Dt.nextButton,(b||w)&&Dt.esriButtonDisabled),disabled:w,title:a.pagination.next,onclick:this._nextClick,type:"button"},D("div",{class:Dt.nextIcon}))),X=(t==null?void 0:t.length)>0,K=X&&D("div",{class:Dt.actions,title:a.options},D("calcite-action-menu",{label:a.options,class:Dt.actionsButton},t.toArray().map(q=>D("calcite-action",{bind:this,icon:q.icon,id:q.id,onclick:()=>this.viewModel.triggerAction(q),text:q.title,textEnabled:!0}))));return D("div",{class:this.classes(Dt.timeSlider,Dt.esriWidget,`${Dt.timeSliderMode}${l}`,`${Dt.timeSliderLayout}${T}`,!n&&Dt.esriDisabled,y&&Dt.timeSliderOutOfBounds,X&&Dt.hasActions,mxe()),afterCreate:q=>{this.addHandles(uwe(q,()=>this.scheduleRender()))},"aria-label":o.widgetLabel},T==="wide"&&D("div",{class:Dt.timeSliderRow},D("div",{class:Dt.playbackControls},[S,M,$,I,V,B,G]),K),T==="compact"&&[D("div",{key:"time-slider-row-1",class:Dt.timeSliderRow},[M,K]),D("div",{key:"time-slider-row-2",class:Dt.timeSliderRow},[I]),D("div",{key:"time-slider-row-3",class:Dt.timeSliderRow},[$,B,S,G,V])])}updateWebDocument(e){var t;(t=this.viewModel)==null||t.updateWebDocument(e)}_createLabel(e){if(C(this.labelFormatFunction))return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),r=e["data-date"];this.labelFormatFunction(r,t,e,i)}_getTickPositions(e){const{fullTimeExtent:t}=this;if(C(t)||C(t.start)||C(t.end))return[];const{start:i,end:r}=t,s=[],{value:n,unit:o}=e;let a=pq(i,o);for(;a.getTime()<=r.getTime();)a.getTime()>=i.getTime()&&s.push(a.getTime()),a=m0(a,n,o);return s}_formatDate(e){return e?Ou(e,XC("short-date")):null}_formatTime(e){return e?Ou(e,XC("long-time")):null}_updateSliderSteps(){this._slider.steps=v(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map(e=>e.getTime()):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:this.viewModel.state}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};u([d()],nn.prototype,"actions",null),u([d()],nn.prototype,"disabled",void 0),u([d()],nn.prototype,"effectiveStops",null),u([d()],nn.prototype,"fullTimeExtent",null),u([d()],nn.prototype,"iconClass",void 0),u([d({readOnly:!0})],nn.prototype,"interactive",null),u([d()],nn.prototype,"label",null),u([d()],nn.prototype,"labelFormatFunction",void 0),u([d({value:"auto"})],nn.prototype,"layout",null),u([d()],nn.prototype,"loop",null),u([d(),Es("esri/widgets/TimeSlider/t9n/TimeSlider")],nn.prototype,"messages",void 0),u([d(),Es("esri/t9n/common")],nn.prototype,"messagesCommon",void 0),u([d()],nn.prototype,"mode",null),u([d()],nn.prototype,"playRate",null),u([d()],nn.prototype,"stops",null),u([d()],nn.prototype,"tickConfigs",void 0),u([d()],nn.prototype,"timeExtent",null),u([d({nonNullable:!0})],nn.prototype,"timeVisible",void 0),u([d()],nn.prototype,"view",null),u([d({type:jY}),O$("trigger-action")],nn.prototype,"viewModel",void 0),u([ln()],nn.prototype,"_playOrStopClick",null),u([ln()],nn.prototype,"_previousClick",null),u([ln()],nn.prototype,"_nextClick",null),nn=u([P("esri.widgets.TimeSlider")],nn);const ECt=nn;class CCt{addMap(){let t=new N3({url:"https://services-eu1.arcgis.com/iqyjb3bABMyiZGeU/arcgis/rest/services/Ukraine_AdministrativeBorders/FeatureServer/2",title:"Country",popupEnabled:!1,renderer:new f0({symbol:new M1({symbolLayers:[new eM({material:{color:"yellow"},outline:{color:"black",size:"1px"}})]})})}),i=new N3({url:"https://services-eu1.arcgis.com/iqyjb3bABMyiZGeU/arcgis/rest/services/Ukraine_AdministrativeBorders/FeatureServer/1",title:"Level 1",visible:!1,renderer:new f0({symbol:new M1({symbolLayers:[{type:"fill",material:{color:"yellow"},outline:{color:"black",size:"1px"}}]})})}),r=new N3({url:"https://services-eu1.arcgis.com/iqyjb3bABMyiZGeU/arcgis/rest/services/Ukraine_AdministrativeBorders/FeatureServer/0",title:"Level 2",visible:!1,renderer:new f0({symbol:new M1({symbolLayers:[{type:"fill",material:{color:"yellow"},outline:{color:"black",size:"0.5px"}}]})})}),s=new W1e({title:"Administrative Borders",layers:[t,i,r]});const n=new Z1e({basemap:"satellite",ground:"world-elevation",layers:[s]}),o=new m2t({container:"viewDiv",map:n,camera:{position:new ut({x:35.13531112,y:39.48777225,z:220872242006e-5}),heading:2.86,tilt:22.15},qualityProfile:"high",environment:{atmosphere:{quality:"high"}}});o.ui.add(new E2t({view:o}),"top-left"),o.ui.add(new rG({view:o,content:new mCt({view:o})}),{position:"top-right"}),o.ui.add(new rG({view:o,content:new S2t({view:o})}),{position:"top-right"}),o.ui.add(new rG({view:o,content:new gEt({view:o})}),{position:"top-right"}),o.popup.defaultPopupTemplateEnabled=!0,o.when().then(()=>{n.ground.surfaceColor=new De([220,220,220])}),new ECt({container:"footer",fullTimeExtent:{start:new Date(2021,1,1),end:new Date(2022,2,1)},mode:"instant"}),window.view=o}}class ACt{constructor(t,i){this.strings=t,this.language=i}updateAttributes(t,i){var r=new URLSearchParams(window.location.search);r.set(t,i),history.replaceState(null,"","?"+r.toString())}}var MCt="data:text/csv;base64,aWQ7ZW47dWE7cnU7Y247DQp0aXRsZTtNYXBwaW5nIFVrcmFpbmU70JrQsNGA0YLQvtCz0YDQsNGE0YPQstCw0L3QvdGPINCj0LrRgNCw0ZfQvdC4O9Ca0LDRgNGC0LjRgNC+0LLQsNC90LjQtSDQo9C60YDQsNC40L3Rizs7DQp0b29sczsrIFRvb2xzOyArINGW0L3RgdGC0YDRg9C80LXQvdGC0Lg7K9C40L3RgdGC0YDRg9C80LXQvdGC0Ys7Ow0Kd29ya3NwYWNlczsgV29ya3NwYWNlczvQoNC+0LHQvtGH0ZYg0LzRltGB0YbRjzvQoNCw0LHQvtGH0LjQtSDQvNC10YHRgtCwOzsNCnVhO1VBO1VBO1VBOzsNCmVuO0VOO0VOO0VOOzsNCnJ1O1JVO1JVO1JVOzsNCmNuO0NOO0NOO0NOOzsNCmxvZ2luO0xvZ2luO9Cb0L7Qs9GW0L070JLRhdC+0LQg0LIg0YHQuNGB0YLQtdC80YM7Ow0KaGVscDtIZWxwO9CU0L7Qv9C+0LzQvtCz0LA70J/QvtC80L7RidGMOzsNCmRvd25sb2FkO0Rvd25sb2FkO9CX0LDQstCw0L3RgtCw0LbQuNGC0Lg70YHQutCw0YfQsNGC0Yw7Ow0KZGltZW5zaW9uczsyRC8zRDsyRC8zRDsyRC8zRDs7DQpsYXllcnM7KyBMYXllcnM7KyDQqNCw0YDQuDsrINCh0LvQvtC4OzsNCg==";class RCt{constructor(t){this.lang=t,this.data={}}init(){let t=[];return t.push(new Promise((i,r)=>{window.fetch(MCt).then(s=>s.blob()).then(s=>{const n=new FileReader;var o=this;n.onload=function(a){var c;const l=(c=a.target)==null?void 0:c.result;o.csvToArray(l),i()},n.readAsText(s)})})),t}csvToArray(t,i=";"){var r=this;const s=t.slice(0,t.indexOf(`
`)).split(i);this.languages=[...s],this.languages.shift(),this.languages.pop(),t.slice(t.indexOf(`
`)+1).split(`
`).forEach(function(o){const a=o.split(i),l=s.reduce(function(c,h,p){return c[h]=a[p],c},{});Object.keys(r.data).includes(l.id)&&l.id!=""?alert("The content has two identical IDs: "+l.id):r.data[l.id]=l})}checkString(t){return!!Object.keys(this.data).includes(t)}get(t){if(Object.keys(this.data).includes(t)){let i=this.data[t][this.lang];return i[0]=='"'&&(i=i.substring(1)),i[i.length-1]=='"'&&(i=i.substring(0,i.length-1)),i}else{if(t==""||t==null)return"";if(t.includes("textual"))return t;alert("There is a missing string: "+t)}}}var OCt=Object.defineProperty,ICt=Object.getOwnPropertyDescriptor,PCt=(e,t,i,r)=>{for(var s=r>1?void 0:r?ICt(t,i):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(r?o(t,i,s):o(s))||s);return r&&s&&OCt(t,i,s),s};let KP=class extends pn{constructor(e){super(e)}};KP=PCt([P("mu.Widget")],KP);var $Ct=Object.defineProperty,LCt=Object.getOwnPropertyDescriptor,GV=(e,t,i,r)=>{for(var s=r>1?void 0:r?LCt(t,i):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(r?o(t,i,s):o(s))||s);return r&&s&&$Ct(t,i,s),s};let XA=class extends KP{constructor(){super(...arguments),this.actions={}}render(){var e;return D("div",{id:this.domId,class:"button",onclick:()=>{var t,i;switch(this.domId){case"tools":(t=document.getElementById("toolsContainer"))==null||t.classList.toggle("showPanel");break;case"layers":(i=document.getElementById("layersContainer"))==null||i.classList.toggle("showPanel");break;case"en":this.updateAttributes("lang","en"),window.open(window.location.href,"_self");break;case"ua":this.updateAttributes("lang","ua"),window.open(window.location.href,"_self");break;case"ru":this.updateAttributes("lang","ru"),window.open(window.location.href,"_self");break;case"cn":this.updateAttributes("lang","cn"),window.open(window.location.href,"_self");break}}},(e=this.state)==null?void 0:e.strings.get(this.domId))}updateAttributes(e,t){var i=new URLSearchParams(window.location.search);i.set(e,t),history.replaceState(null,"","?"+i.toString())}};GV([d()],XA.prototype,"domId",2);GV([d()],XA.prototype,"state",2);GV([d()],XA.prototype,"actions",2);XA=GV([P("mu.Button")],XA);var Pp=XA,DCt=Object.defineProperty,FCt=Object.getOwnPropertyDescriptor,Gte=(e,t,i,r)=>{for(var s=r>1?void 0:r?FCt(t,i):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(r?o(t,i,s):o(s))||s);return r&&s&&DCt(t,i,s),s};let QP=class extends KP{render(){return D("div",{id:"header"},D("div",{id:"headerLeft",class:"headerPart"},D(Pp,{domId:"tools",state:this.state}),D(Pp,{domId:"workspaces",state:this.state})),D("div",{id:"headerCenter",class:"headerPart"},D("div",{id:"languages",class:"headerPart"},D(Pp,{domId:"ua",state:this.state}),D(Pp,{domId:"en",state:this.state}),D(Pp,{domId:"ru",state:this.state})),D(Pp,{domId:"title",state:this.state}),D("div",{id:"functions",class:"headerPart"},D(Pp,{domId:"login",state:this.state}),D(Pp,{domId:"help",state:this.state}),D(Pp,{domId:"download",state:this.state}))),D("div",{id:"headerRight",class:"headerPart"},D(Pp,{domId:"dimensions",state:this.state}),D(Pp,{domId:"layers",state:this.state})))}};Gte([d()],QP.prototype,"text",2);Gte([d()],QP.prototype,"state",2);QP=Gte([P("mu.Header")],QP);var NCt=QP,kCt=Object.defineProperty,UCt=Object.getOwnPropertyDescriptor,g3e=(e,t,i,r)=>{for(var s=r>1?void 0:r?UCt(t,i):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(s=(r?o(t,i,s):o(s))||s);return r&&s&&kCt(t,i,s),s};let C6=class extends KP{render(){return D("div",null,D(NCt,{text:"",state:this.state}),D("div",{id:"map"},D("div",{id:"toolsContainer",class:"panel"}),D("div",{id:"viewDiv"}),D("div",{id:"layersContainer",class:"panel"})),D("div",{id:"footer"}))}};g3e([d()],C6.prototype,"state",2);C6=g3e([P("mu.UI")],C6);var VCt=C6;let A6=BCt();"lang"in A6||(zCt("lang","en"),A6.lang="en");let Dfe=new RCt(A6.lang);Promise.all(Dfe.init()).then(()=>{let e=new ACt(Dfe,A6.lang),t=new CCt;new VCt({container:"app",state:e}).when(()=>{t.addMap()})});function BCt(){var e=location.search.substr(1),t={};return e.split("&").forEach(function(i){var r=i.split("=");t[r[0]]=decodeURIComponent(r[1])}),t}function zCt(e,t){var i=new URLSearchParams(window.location.search);i.set(e,t),history.replaceState(null,"","?"+i.toString())}export{L3 as $,O_e as A,XT as B,boe as C,WWe as D,ba as E,fOt as F,Te as G,OWe as H,UJ as I,yZ as J,af as K,Ma as L,gOt as M,mOt as N,se as O,po as P,SJ as Q,qMt as R,DVe as S,Ts as T,_r as U,pT as V,uIe as W,N3 as X,Eo as Y,fMt as Z,Q as _,P as a,QZ as a$,oM as a0,XMt as a1,WMt as a2,YMt as a3,fg as a4,Ii as a5,st as a6,Be as a7,zh as a8,H0 as a9,$Mt as aA,M1 as aB,LMt as aC,J6 as aD,eM as aE,s1e as aF,CDe as aG,IMt as aH,ho as aI,ps as aJ,d3t as aK,S9e as aL,Fc as aM,Og as aN,Ugt as aO,$ct as aP,kf as aQ,ii as aR,Ict as aS,tZ as aT,QAt as aU,dp as aV,Aa as aW,aT as aX,A6e as aY,Ft as aZ,Xr as a_,De as aa,l1 as ab,tS as ac,iS as ad,zt as ae,G0 as af,Die as ag,BI as ah,iI as ai,F1 as aj,O4e as ak,Ws as al,te as am,hr as an,x3t as ao,T3t as ap,VI as aq,Olt as ar,D0 as as,Qe as at,Gs as au,Df as av,m3t as aw,E3t as ax,PMt as ay,Z6 as az,GCt as b,dr as b$,le as b0,Mg as b1,rp as b2,O as b3,w3t as b4,n4e as b5,b3t as b6,L0 as b7,gA as b8,ri as b9,h3t as bA,kn as bB,Bse as bC,rt as bD,o3t as bE,ict as bF,Y6 as bG,q1 as bH,rS as bI,Vgt as bJ,$ee as bK,Eg as bL,_$ as bM,lo as bN,ZA as bO,yi as bP,LMe as bQ,eMt as bR,Xs as bS,CU as bT,NOt as bU,O0 as bV,Rye as bW,A1 as bX,Uie as bY,Oye as bZ,oyt as b_,Tu as ba,wa as bb,L3t as bc,Xee as bd,v3t as be,_3t as bf,Qo as bg,Fs as bh,Hl as bi,xt as bj,hs as bk,tAe as bl,za as bm,Wa as bn,nAt as bo,V1 as bp,oo as bq,yf as br,I0 as bs,ue as bt,Zo as bu,fe as bv,ae as bw,ut as bx,Th as by,SL as bz,Sr as c,Yd as c$,UM as c0,YCt as c1,bG as c2,ume as c3,Vi as c4,z as c5,Ee as c6,Ss as c7,Tt as c8,Zr as c9,MRt as cA,Dje as cB,$je as cC,wRt as cD,xRt as cE,TRt as cF,RRt as cG,_Rt as cH,Es as cI,pn as cJ,D as cK,gh as cL,y1 as cM,mA as cN,ge as cO,dme as cP,oC as cQ,B1 as cR,fl as cS,So as cT,KC as cU,zye as cV,sMt as cW,a$ as cX,DI as cY,sFe as cZ,or as c_,xf as ca,dn as cb,ct as cc,kr as cd,r6 as ce,je as cf,jbe as cg,Qv as ch,wn as ci,Vr as cj,ZQ as ck,rIt as cl,yRt as cm,vRt as cn,xwe as co,Fje as cp,ARt as cq,fRt as cr,DGe as cs,pRt as ct,SRt as cu,PRt as cv,mRt as cw,CRt as cx,LRt as cy,gRt as cz,H as d,Pe as d$,X6 as d0,r$ as d1,Rh as d2,d9 as d3,uMt as d4,AIe as d5,Bi as d6,Q5e as d7,aMt as d8,EBe as d9,bu as dA,_K as dB,Fe as dC,RMt as dD,AMt as dE,L6e as dF,xre as dG,us as dH,Q9e as dI,uBe as dJ,OAt as dK,O6e as dL,V4e as dM,XJ as dN,KT as dO,eBe as dP,Bh as dQ,TBe as dR,F6e as dS,cM as dT,P6e as dU,Ge as dV,eke as dW,VJ as dX,ike as dY,rke as dZ,Uf as d_,pMt as da,oBe as db,B9e as dc,TMt as dd,EMt as de,l6e as df,s4e as dg,H0e as dh,$xe as di,SGe as dj,kZe as dk,W_e as dl,k1e as dm,Y9e as dn,u4 as dp,h1e as dq,PJ as dr,hf as ds,bt as dt,bye as du,p$ as dv,ske as dw,L1e as dx,Z5e as dy,cA as dz,u as e,YJ as e$,hct as e0,F1t as e1,$Re as e2,fIe as e3,eAt as e4,bIe as e5,wIe as e6,Mn as e7,Ke as e8,DU as e9,Cr as eA,Gh as eB,i0e as eC,mT as eD,b9e as eE,Zt as eF,bK as eG,Fd as eH,Ys as eI,H0t as eJ,ls as eK,j0t as eL,tAt as eM,jf as eN,hA as eO,l4e as eP,dAt as eQ,lr as eR,Wge as eS,u9e as eT,a6e as eU,o9e as eV,w6e as eW,J9e as eX,$ie as eY,Zge as eZ,nU as e_,ro as ea,Nht as eb,uct as ec,wZ as ed,HQ as ee,PQ as ef,H3t as eg,J3t as eh,jQ as ei,NT as ej,Wo as ek,Cf as el,Ea as em,Cs as en,Ze as eo,ZZ as ep,H6 as eq,DAt as er,Jge as es,R as et,lMt as eu,M_e as ev,hJ as ew,G1 as ex,l$ as ey,Pie as ez,et as f,fT as f$,xU as f0,Kse as f1,$6e as f2,Aq as f3,rU as f4,I6e as f5,yK as f6,B1e as f7,AI as f8,Fu as f9,U0e as fA,Z0e as fB,P5 as fC,oAt as fD,hb as fE,O0e as fF,R3 as fG,POt as fH,aQ as fI,$Ot as fJ,$$ as fK,Dd as fL,tke as fM,E1 as fN,vG as fO,EU as fP,qI as fQ,fM as fR,wl as fS,Yq as fT,bn as fU,Xq as fV,Jq as fW,z5 as fX,w9e as fY,z1 as fZ,Rme as f_,Nu as fa,m$ as fb,fb as fc,iU as fd,bl as fe,O$e as ff,R$e as fg,bAt as fh,HU as fi,jU as fj,ZT as fk,JA as fl,c$ as fm,VC as fn,fB as fo,WIe as fp,nBe as fq,rM as fr,wJ as fs,aC as ft,ENe as fu,CNe as fv,L0e as fw,Nqe as fx,XNe as fy,kqe as fz,D_e as g,Xge as g$,FI as g0,s1 as g1,Nh as g2,$Fe as g3,QC as g4,P6 as g5,LFe as g6,cMt as g7,zMt as g8,Vie as g9,Pj as gA,G6 as gB,Eu as gC,up as gD,di as gE,MQ as gF,wA as gG,cQe as gH,KBe as gI,ip as gJ,lS as gK,lE as gL,WJe as gM,tt as gN,er as gO,Zl as gP,M6 as gQ,zAt as gR,Ug as gS,nMt as gT,T9e as gU,Mye as gV,W$e as gW,oT as gX,iD as gY,DZ as gZ,LZ as g_,MAt as ga,JC as gb,zr as gc,sAt as gd,dT as ge,VMt as gf,ZAt as gg,b3e as gh,ar as gi,dRt as gj,oA as gk,zA as gl,i1e as gm,cZ as gn,j1 as go,G2 as gp,ml as gq,Dq as gr,j4e as gs,ZMt as gt,oVe as gu,f5 as gv,MMt as gw,j3 as gx,fW as gy,Hx as gz,he as h,iMt as h$,jx as h0,FZ as h1,AAt as h2,Oxe as h3,SAt as h4,Dx as h5,Oie as h6,q5e as h7,xOt as h8,qWe as h9,Q6 as hA,LJ as hB,eVe as hC,r5e as hD,q0 as hE,vVe as hF,rVe as hG,sVe as hH,z8e as hI,G8e as hJ,j8e as hK,H8e as hL,q8e as hM,W8e as hN,X8e as hO,Y8e as hP,Z8e as hQ,J8e as hR,K8e as hS,Q8e as hT,V1e as hU,IM as hV,vIe as hW,Jm as hX,lZ as hY,Af as hZ,uJ as h_,YT as ha,h$e as hb,qU as hc,DLe as hd,U6 as he,Rg as hf,Sg as hg,gye as hh,PNe as hi,Wx as hj,Wye as hk,$h as hl,zte as hm,Wte as hn,UI as ho,to as hp,c6e as hq,wMt as hr,R1 as hs,kse as ht,LI as hu,f0 as hv,BC as hw,k6e as hx,N6e as hy,ub as hz,U5e as i,kOt as i$,Bie as i0,Qye as i1,jSt as i2,C$ as i3,dt as i4,Ca as i5,cde as i6,C3e as i7,Ek as i8,be as i9,n0e as iA,jye as iB,c1 as iC,P0 as iD,w$ as iE,Wl as iF,k8e as iG,yJe as iH,zOt as iI,r_t as iJ,B3t as iK,jP as iL,Hbe as iM,Mh as iN,Ff as iO,YOt as iP,Du as iQ,Cn as iR,Rn as iS,SU as iT,cr as iU,ep as iV,Os as iW,If as iX,Pt as iY,xs as iZ,BA as i_,fp as ia,Le as ib,ye as ic,me as id,r5 as ie,Rc as ig,R6 as ih,D6e as ii,pPe as ij,lAt as ik,xFe as il,cJ as im,SMt as io,rMt as ip,o$e as iq,yie as ir,F as is,pAt as it,s_t as iu,VOt as iv,Yh as iw,Xd as ix,Pge as iy,jG as iz,Ko as j,BMt as j$,Oj as j0,Lyt as j1,Yi as j2,Pu as j3,Dc as j4,tr as j5,fbe as j6,x as j7,An as j8,Xh as j9,$8 as jA,MM as jB,Xut as jC,SQ as jD,CM as jE,y$ as jF,rDe as jG,v6e as jH,rAt as jI,LG as jJ,q6 as jK,Lh as jL,Dye as jM,s_ as jN,HMe as jO,xI as jP,GC as jQ,vke as jR,art as jS,Z3t as jT,iIt as jU,wF as jV,GEe as jW,Uu as jX,Tbt as jY,qbe as jZ,eze as j_,Lt as ja,Ie as jb,Gk as jc,zg as jd,Ct as je,qf as jf,Ce as jg,j as jh,Br as ji,Zi as jj,qo as jk,ir as jl,Ji as jm,ji as jn,Ht as jo,r_ as jp,n8 as jq,vb as jr,zc as js,P8 as jt,si as ju,Lg as jv,cb as jw,bb as jx,D8 as jy,Zee as jz,d$ as k,qAt as k$,Gde as k0,DC as k1,uA as k2,Hs as k3,mke as k4,cp as k5,kc as k6,HMt as k7,Yt as k8,En as k9,DSe as kA,gf as kB,Ult as kC,Q1t as kD,Y3t as kE,v1 as kF,hze as kG,Ta as kH,_e as kI,ll as kJ,rg as kK,QZe as kL,_ae as kM,kie as kN,UOt as kO,Byt as kP,bMt as kQ,DMt as kR,Cg as kS,Q1e as kT,ebe as kU,wbe as kV,Alt as kW,c3t as kX,YAt as kY,iAt as kZ,z3t as k_,jMt as ka,mr as kb,iM as kc,ci as kd,N0e as ke,k0e as kf,g3t as kg,xet as kh,k6 as ki,YZ as kj,c9 as kk,Mi as kl,ui as km,AJ as kn,Oe as ko,n0 as kp,K3t as kq,GOt as kr,$f as ks,Er as kt,FMt as ku,gZ as kv,uAt as kw,cP as kx,Zh as ky,y3t as kz,$Ve as l,kxe as l$,g6e as l0,u3t as l1,os as l2,J_e as l3,cAt as l4,ONe as l5,dMt as l6,C1 as l7,mp as l8,Vht as l9,gMt as lA,vOt as lB,HCt as lC,Xa as lD,tte as lE,hn as lF,wo as lG,aOt as lH,j$e as lI,J$e as lJ,Gxe as lK,MZ as lL,wAt as lM,hl as lN,EJ as lO,a4e as lP,ME as lQ,w3 as lR,Vse as lS,COt as lT,voe as lU,MOt as lV,RAt as lW,dge as lX,_Ot as lY,Vxe as lZ,zxe as l_,Rr as la,Vh as lb,Nt as lc,uh as ld,Ls as le,Wi as lf,St as lg,Yr as lh,Tl as li,ze as lj,kt as lk,nt as ll,pt as lm,ts as ln,ja as lo,Ig as lp,As as lq,_b as lr,pk as ls,yb as lt,R8 as lu,t3t as lv,Mt as lw,tbe as lx,JMt as ly,$r as lz,sp as m,yk as m$,aqe as m0,Qce as m1,Vct as m2,NAt as m3,r3t as m4,Hge as m5,rLe as m6,EAt as m7,Tg as m8,I$ as m9,Tk as mA,tMt as mB,i3t as mC,CEe as mD,lU as mE,ds as mF,oP as mG,Uh as mH,RT as mI,h8 as mJ,ku as mK,i_ as mL,nr as mM,pl as mN,Pye as mO,W3t as mP,X3t as mQ,KZ as mR,aze as mS,Wf as mT,Oi as mU,Xi as mV,tIt as mW,$3t as mX,g_e as mY,bO as mZ,Abe as m_,MWe as ma,l3t as mb,b6e as mc,FAt as md,IAt as me,$At as mf,PAt as mg,LAt as mh,RI as mi,Dh as mj,iDe as mk,vCe as ml,Ir as mm,lN as mn,AM as mo,H$ as mp,AOt as mq,GX as mr,aAt as ms,$1 as mt,j3t as mu,q3t as mv,JAt as mw,zDe as mx,nx as my,G3t as mz,LVe as n,rP as n$,lL as n0,_t as n1,A0 as n2,N6 as n3,U$e as n4,M0 as n5,Y_t as n6,Jx as n7,$G as n8,N3t as n9,nRt as nA,oRt as nB,ST as nC,bC as nD,Kae as nE,Wt as nF,ag as nG,Xze as nH,hRt as nI,x9e as nJ,xi as nK,Ro as nL,Is as nM,Mo as nN,eC as nO,A3t as nP,BZ as nQ,JCt as nR,yAt as nS,gAt as nT,bge as nU,_ge as nV,NJ as nW,UMt as nX,kMt as nY,NMt as nZ,eg as n_,V3t as na,HAe as nb,hde as nc,F3t as nd,k3t as ne,D3t as nf,hI as ng,kN as nh,R4 as ni,Gf as nj,ZCt as nk,lp as nl,zee as nm,kd as nn,_0t as no,v0t as np,ao as nq,RP as nr,t4e as ns,R9e as nt,lRt as nu,M9e as nv,ab as nw,_T as nx,Au as ny,GMt as nz,Sa as o,Zx as o$,Ga as o0,Ao as o1,n_ as o2,WE as o3,dl as o4,C3t as o5,ZX as o6,vAt as o7,zG as o8,VU as o9,A$ as oA,Ur as oB,U3 as oC,IU as oD,cRt as oE,Rbe as oF,uRt as oG,ZJe as oH,_At as oI,mAt as oJ,fAt as oK,Rx as oL,jh as oM,YY as oN,$lt as oO,hae as oP,uae as oQ,vut as oR,JOt as oS,ql as oT,np as oU,oU as oV,l8 as oW,Hf as oX,Xo as oY,Eyt as oZ,jCt as o_,NRt as oa,kRt as ob,DRt as oc,FRt as od,$s as oe,lf as of,xu as og,mQ as oh,fQ as oi,vye as oj,On as ok,Xe as ol,js as om,aRt as on,xze as oo,lbe as op,QTe as oq,U1 as or,O6 as os,QY as ot,xg as ou,BJe as ov,Kn as ow,JTe as ox,z0 as oy,EK as oz,ne as p,nze as p$,UQe as p0,qOt as p1,jOt as p2,HOt as p3,iRt as p4,HAt as p5,P1 as p6,qk as p7,CCe as p8,XOt as p9,S1e as pA,zf as pB,DA as pC,Jt as pD,qa as pE,L8 as pF,IEe as pG,zEe as pH,vt as pI,Mr as pJ,KAt as pK,xhe as pL,Jue as pM,TK as pN,tP as pO,KMt as pP,Jv as pQ,Wh as pR,X8 as pS,Vc as pT,xl as pU,Ph as pV,Gn as pW,FEe as pX,eRt as pY,Wot as pZ,qh as p_,tC as pa,KJe as pb,PO as pc,_G as pd,vl as pe,zC as pf,rC as pg,oZ as ph,BOt as pi,L6 as pj,apt as pk,wut as pl,BT as pm,pg as pn,Ot as po,uZ as pp,p3t as pq,Km as pr,x2e as ps,nS as pt,SK as pu,GAt as pv,rRt as pw,XAt as px,Vg as py,pK as pz,_M as q,M3t as q$,XEe as q0,NA as q1,kC as q2,_X as q3,Ree as q4,KCt as q5,sRt as q6,BV as q7,H5 as q8,But as q9,hke as qA,CMt as qB,s3t as qC,u$e as qD,_Mt as qE,w4e as qF,jLe as qG,d6 as qH,Wbt as qI,eIt as qJ,Xbt as qK,Vbt as qL,Q3t as qM,Zbt as qN,U$ as qO,yle as qP,e3t as qQ,yke as qR,ea as qS,q$ as qT,BJ as qU,Hh as qV,nV as qW,j_e as qX,O3t as qY,xA as qZ,lb as q_,sIt as qa,oIt as qb,nIt as qc,t$ as qd,WAt as qe,dw as qf,cae as qg,Om as qh,AK as qi,XI as qj,sA as qk,jAt as ql,Tst as qm,MK as qn,N_e as qo,rA as qp,_be as qq,X0 as qr,zze as qs,$0 as qt,$U as qu,Wtt as qv,QMt as qw,ZOt as qx,ele as qy,oS as qz,v as r,XK as r$,I3t as r0,R3t as r1,Spt as r2,Mpt as r3,Ept as r4,Cpt as r5,Apt as r6,pOt as r7,SOt as r8,TOt as r9,qCt as rA,WCt as rB,Sh as rC,dOt as rD,XCt as rE,vu as rF,ur as rG,as as rH,h1 as rI,dze as rJ,Tf as rK,tRt as rL,vze as rM,U3t as rN,_u as rO,ude as rP,cwe as rQ,og as rR,pTe as rS,fTe as rT,FYe as rU,dTe as rV,VYe as rW,BYe as rX,zYe as rY,Mxe as rZ,ws as r_,aZ as ra,jxe as rb,wOt as rc,bOt as rd,UAt as re,VAt as rf,BAt as rg,cIe as rh,a3t as ri,n3t as rj,Ru as rk,EWe as rl,R4e as rm,MLe as rn,GDe as ro,lWe as rp,ROt as rq,vWe as rr,foe as rs,RWe as rt,EOt as ru,p5e as rv,vMt as rw,nq as rx,mB as ry,gB as rz,_i as s,eOt as s$,nOt as s0,H_e as s1,Nke as s2,kke as s3,Eqe as s4,VRt as s5,oOt as s6,Gqe as s7,cOt as s8,ok as s9,URt as sA,jYe as sB,IRt as sC,ORt as sD,nRe as sE,fvt as sF,ERt as sG,bRt as sH,$Rt as sI,Uqe as sJ,UW as sK,IOt as sL,wqe as sM,rOt as sN,$ge as sO,IZ as sP,sLe as sQ,xAt as sR,OZ as sS,TAt as sT,CAt as sU,YRt as sV,ZRt as sW,iOt as sX,KRt as sY,JRt as sZ,QRt as s_,sOt as sa,_xe as sb,sqe as sc,xMt as sd,Vqe as se,Bqe as sf,FOt as sg,hMt as sh,Xqe as si,uOt as sj,dq as sk,LOt as sl,KU as sm,DOt as sn,Zqe as so,hOt as sp,jqe as sq,lOt as sr,Ra as ss,hZe as st,LNe as su,kAt as sv,qqe as sw,EW as sx,ln as sy,BU as sz,C as t,F_t as t$,soe as t0,noe as t1,HRt as t2,ak as t3,tOt as t4,ydt as t5,uqe as t6,hqe as t7,WRt as t8,XRt as t9,jk as tA,Tct as tB,Aee as tC,iat as tD,qT as tE,zvt as tF,Ibt as tG,Ote as tH,HRe as tI,iwt as tJ,qRe as tK,swt as tL,WRe as tM,owt as tN,XRe as tO,lwt as tP,gL as tQ,h9 as tR,YDe as tS,ISe as tT,PQe as tU,Xht as tV,Qht as tW,bht as tX,Sht as tY,Qee as tZ,N_t as t_,vxe as ta,qRt as tb,BRt as tc,ooe as td,dqe as te,GRt as tf,u$ as tg,hAt as th,jRt as ti,IE as tj,fqe as tk,zRt as tl,W3 as tm,fKe as tn,sQe as to,OSe as tp,RSe as tq,RQe as tr,DQ as ts,uet as tt,XSe as tu,kQ as tv,met as tw,itt as tx,wtt as ty,Vat as tz,yOt as u,UVe as u$,gV as u0,k_t as u1,Xk as u2,xut as u3,zwt as u4,ZRe as u5,Hwt as u6,JRe as u7,Wwt as u8,KRe as u9,u1e as uA,gS as uB,Pbe as uC,kze as uD,sl as uE,hk as uF,eJe as uG,sTt as uH,yMt as uI,yYe as uJ,ck as uK,_x as uL,Yw as uM,JU as uN,ZU as uO,pYe as uP,OOt as uQ,cQ as uR,d_e as uS,F4e as uT,OJ as uU,p_e as uV,D4e as uW,JYe as uX,VW as uY,NVe as uZ,kVe as u_,$V as ua,axt as ub,gxt as uc,Axt as ud,Rxt as ue,Ixt as uf,sht as ug,QRe as uh,uxt as ui,Xxt as uj,npt as uk,Ppt as ul,jmt as um,ugt as un,sgt as uo,oJ as up,rd as uq,Tpt as ur,QOt as us,KOt as ut,S3t as uu,Lxe as uv,aA as uw,oHe as ux,jL as uy,aq as uz,Jl as v,Htt as v0,tze as v1,QBe as v2,sg as v3,tMe as v4,iT as v5,Dtt as v6,oMt as v7,hMe as v8,pMe as v9,tNe as vA,tU as vB,mMt as vC,OMt as vD,xBe as vE,PBe as vF,f3t as vG,P3t as vH,aI as va,Ex as vb,_l as vc,ta as vd,hp as ve,QS as vf,QCt as vg,Gee as vh,Qpt as vi,oMe as vj,Wpt as vk,uMe as vl,lMe as vm,Kpt as vn,QX as vo,cMe as vp,ib as vq,Xpt as vr,tb as vs,BX as vt,$T as vu,Uct as vv,xft as vw,wft as vx,bft as vy,WOt as vz,Gi as w,Wme as x,d as y,mg as z};
