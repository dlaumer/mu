import{ss as z,lz as v,s0 as T,r$ as Z,sK as P,d as A,sL as C,sm as R,aa as F,sM as U,eB as V}from"./index.1c994251.js";import{n as W}from"./fontUtils.e6cc7e51.js";import{u as j}from"./colorUtils.498dc625.js";const q="picture-fill",H="picture-marker",K="simple-fill",G="simple-line",I="simple-marker",J="text",N="Aa",Q=z.size,x=z.maxSize,X=z.maxOutlineSize,Y=z.lineWidth,E=225,_=document.createElement("canvas");function O(a,e){const n=_.getContext("2d"),s=[];return e&&(e.weight&&s.push(e.weight),e.size&&s.push(e.size+"px"),e.family&&s.push(e.family)),n.font=s.join(" "),n.measureText(a).width}const $=7.2/2.54,ee=72/2.54;function ae(a){if(a.length===0)return 0;if(a.length>2){const e=V(1),n=parseFloat(a);switch(a.slice(-2)){case"px":return n;case"pt":return n*e;case"in":return 72*n*e;case"pc":return 12*n*e;case"mm":return n*$*e;case"cm":return n*ee*e}}return parseFloat(a)}function k(a){const e=a==null?void 0:a.size;return{width:e!=null&&typeof e=="object"&&"width"in e?v(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?v(e.height):null}}async function ne(a,e){const n=e.fill,s=a.color;if((n==null?void 0:n.type)==="pattern"&&s&&a.type!==q){const h=await U(n.src,s.toCss(!0));n.src=h,e.fill=n}}async function se(a,e,n,s){var p,c,o;if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await W(a.font)}catch{}const{width:h}=k(s),u=/[\uE600-\uE6FF]/.test(e.shape.text);h!=null||u||(n[0]=O(e.shape.text,{weight:(p=e.font)==null?void 0:p.weight,size:(c=e.font)==null?void 0:c.size,family:(o=e.font)==null?void 0:o.family}))}function D(a,e){return a>e?"dark":"light"}function le(a,e){var M;const n=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,s=n!=null?v(n):null,h=(e==null?void 0:e.maxSize)!=null?v(e.maxSize):null,u=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in a?a.angle:null,p=T(a);let c=Z(a);ie(a,245)!=="dark"||(e==null?void 0:e.ignoreWhiteSymbols)||(c={width:.75,...c,color:"#bdc3c7"});const o={shape:null,fill:p,stroke:c,offset:[0,0]};c!=null&&c.width&&(c.width=Math.min(c.width,X));const d=(c==null?void 0:c.width)||0;let w=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),l=0,i=0,b=!1;switch(a.type){case I:{const r=a.style,{width:m,height:t}=k(e),y=m===t&&m!=null?m:s!=null?s:Math.min(v(a.size),h||x);switch(l=y,i=y,r){case"circle":o.shape={type:"circle",cx:0,cy:0,r:.5*y},w||(l+=d,i+=d);break;case"cross":o.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[l,.5*i]},{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,i]}]};break;case"diamond":o.shape={type:"path",path:[{command:"M",values:[0,.5*i]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*i]},{command:"L",values:[.5*l,i]},{command:"Z",values:[]}]},w||(l+=d,i+=d);break;case"square":o.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},w||(l+=d,i+=d),u&&(b=!0);break;case"triangle":o.shape={type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"Z",values:[]}]},w||(l+=d,i+=d),u&&(b=!0);break;case"x":o.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,i]},{command:"M",values:[l,0]},{command:"L",values:[0,i]}]},u&&(b=!0);break;case"path":o.shape={type:"path",path:a.path||""},w||(l+=d,i+=d),u&&(b=!0),w=!0}break}case G:{const{width:r,height:m}=k(e),t=m!=null?m:s!=null?s:d,y=r!=null?r:Y;c&&(c.width=t),l=y,i=t;const g=((M=o==null?void 0:o.stroke)==null?void 0:M.cap)||"butt",f=g==="round";w=!0,o.stroke&&(o.stroke.cap=g==="butt"?"square":g),o.shape={type:"path",path:[{command:"M",values:[f?t/2:0,i/2]},{command:"L",values:[f?l-t/2:l,i/2]}]};break}case q:case K:{const r=typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.isSquareFill),{width:m,height:t}=k(e);l=!r&&m!==t||m==null?s!=null?s:Q:m,i=!r&&m!==t||t==null?l:t,w||(l+=d,i+=d),w=!0,o.shape=r?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,i]},{command:"L",values:[0,i]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:P.fill[0];break}case H:{const r=Math.min(v(a.width),h||x),m=Math.min(v(a.height),h||x),{width:t,height:y}=k(e),g=t===y&&t!=null?t:s!=null?s:Math.max(r,m),f=r/m;l=f<=1?Math.ceil(g*f):g,i=f<=1?g:Math.ceil(g/f),o.shape={type:"image",x:-Math.round(l/2),y:-Math.round(i/2),width:l,height:i,src:a.url||""},u&&(b=!0);break}case J:{const r=a,m=(e==null?void 0:e.overrideText)||r.text||N,t=r.font,{width:y,height:g}=k(e),f=g!=null?g:s!=null?s:Math.min(v(t.size),h||x),B=O(m,{weight:t.weight,size:f,family:t.family}),L=/[\uE600-\uE6FF]/.test(m);l=y!=null?y:L?f:B,i=f;let S=.25*ae((t?f:0).toString());L&&(S+=5),o.shape={type:"text",text:m,x:r.xoffset||0,y:r.yoffset||S,align:"middle",alignBaseline:r.verticalAlignment,decoration:t&&t.decoration,rotated:r.rotated,kerning:r.kerning},o.font=t&&{size:f,style:t.style,decoration:t.decoration,weight:t.weight,family:t.family};break}}return{shapeDescriptor:o,size:[l,i],renderOptions:{node:e==null?void 0:e.node,scale:w,opacity:e==null?void 0:e.opacity,rotation:u,useRotationSize:b,effectView:e==null?void 0:e.effectView}}}async function re(a,e){const{shapeDescriptor:n,size:s,renderOptions:h}=le(a,e);if(!n.shape)throw new A("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ne(a,n),await se(a,n,s,e);const u=[[n]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.applyColorModulation)){const p=.6*s[0];u.unshift([{...n,offset:[-p,0],fill:C(n.fill,-.3)}]),u.push([{...n,offset:[p,0],fill:C(n.fill,.3)}]),s[0]+=2*p,h.scale=!1}return R(u,s,h)}function ie(a,e=E){const n=T(a),s=Z(a),h=!n||"type"in n?null:new F(n),u=s!=null&&s.color?new F(s==null?void 0:s.color):null,p=h?D(j(h),e):null,c=u?D(j(u),e):null;return c?p?p===c?p:e>=E?"light":"dark":c:p}export{ie as getContrastingBackgroundTheme,le as getRenderSymbolParameters,re as previewSymbol2D};
