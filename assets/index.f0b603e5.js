const ZCe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}};ZCe();const QN={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function khe(e){return QN[e]||QN[e.toLowerCase()]}function hW(e){var t;return(t=QN[e])!=null?t:QN[e.toLowerCase()]}function JCe(e){return[...hW(e)]}function P8(e,t,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?e+(t-e)*i:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function Vhe(e,t,r,i=1){const s=(e%360+360)%360/360,n=r<=.5?r*(t+1):r+t-r*t,o=2*r-n;return[Math.round(255*P8(o,n,s+1/3)),Math.round(255*P8(o,n,s)),Math.round(255*P8(o,n,s-1/3)),i]}function QCe(e){const t=e.length>5,r=t?8:4,i=(1<<r)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}const M1=null;function v(e){return e!=null}function E(e){return e==null}function ho(e,t){return v(e)?t(e):M1}function iwt(e){return e}function swt(e){return e}function Ul(e,t){return x5(e,t),e}function x5(e,t){if(E(e))throw new Error(t!=null?t:"value is None")}function Pt(e,t){return v(e)?e:typeof t=="function"?t():t}function hK(e,t){return v(e)?e:t}function Ve(e){return v(e)&&e.destroy(),null}function tt(e){return v(e)&&e.dispose(),null}function zi(e){return v(e)&&e.remove(),null}function Yh(e){return v(e)&&e.abort(),null}function Wi(e){return v(e)&&e.release(),null}function KCe(e,t,r){return v(e)&&v(t)?v(r)?r(e,t):e.equals(t):e===t}function Sw(e){return null}function nwt(e,t){const r=new Array;return e.forEach(i=>{const s=t(i);v(s)&&r.push(s)}),r}function owt(e,t){const r=new Array;for(const i of e)r.push(Tu(i,null,t));return r}function awt(e,t){for(const r of e)ho(r,t)}function Tu(e,t,r){return v(e)?r(e):t}function lwt(e){return e.filter(t=>v(t))}function en(e,...t){let r=e;for(let i=0;i<t.length&&r;++i)r=r[t[i]];return r}function cwt(e){return e}function M(){return[0,0,0]}function bs(e){return[e[0],e[1],e[2]]}function Le(e,t,r){return[e,t,r]}function kl(e){const t=M(),r=Math.min(3,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function dW(e,t){return new Float64Array(e,t,3)}function Bhe(){return M()}function zhe(){return Le(1,1,1)}function Ghe(){return Le(1,0,0)}function jhe(){return Le(0,1,0)}function pW(){return Le(0,0,1)}const Sa=Bhe(),Qf=zhe(),eAe=Ghe(),tAe=jhe(),Hhe=pW();Object.freeze(Object.defineProperty({__proto__:null,ONES:Qf,UNIT_X:eAe,UNIT_Y:tAe,UNIT_Z:Hhe,ZEROS:Sa,clone:bs,create:M,createView:dW,fromArray:kl,fromValues:Le,ones:zhe,unitX:Ghe,unitY:jhe,unitZ:pW,zeros:Bhe},Symbol.toStringTag,{value:"Module"}));let fW=1e-6;function Pa(){return fW}function rAe(e){fW=e}const JM=Math.random,iAe=Math.PI/180,sAe=180/Math.PI;function T5(e){return e*iAe}function nAe(e){return e*sAe}function oAe(e,t){return Math.abs(e-t)<=fW*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:JM,equals:oAe,getEpsilon:Pa,setEpsilon:rAe,toDegree:nAe,toRadian:T5},Symbol.toStringTag,{value:"Module"}));function Me(e){const t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function le(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ce(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function me(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function ge(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function S5(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function KN(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function aAe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function qhe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function zB(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function Whe(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function Xhe(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function lAe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function cAe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function ae(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Wb(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function Ai(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}function jn(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function ba(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function Ea(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function uAe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function ve(e,t){const r=t[0],i=t[1],s=t[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function _e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function dt(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2];return e[0]=s*l-n*a,e[1]=n*o-i*l,e[2]=i*a-s*o,e}function rn(e,t,r,i){const s=t[0],n=t[1],o=t[2];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e}function hAe(e,t,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+r[0]*l+i[0]*c+s[0]*h,e[1]=t[1]*a+r[1]*l+i[1]*c+s[1]*h,e[2]=t[2]*a+r[2]*l+i[2]*c+s[2]*h,e}function dAe(e,t,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+r[0]*h+i[0]*p+s[0]*f,e[1]=t[1]*c+r[1]*h+i[1]*p+s[1]*f,e[2]=t[2]*c+r[2]*h+i[2]*p+s[2]*f,e}function pAe(e,t){t=t||1;const r=JM,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=s*t,e}function Ze(e,t,r){const i=t[0],s=t[1],n=t[2];return e[0]=r[0]*i+r[4]*s+r[8]*n+r[12],e[1]=r[1]*i+r[5]*s+r[9]*n+r[13],e[2]=r[2]*i+r[6]*s+r[10]*n+r[14],e}function Mc(e,t,r){const i=t[0],s=t[1],n=t[2];return e[0]=i*r[0]+s*r[3]+n*r[6],e[1]=i*r[1]+s*r[4]+n*r[7],e[2]=i*r[2]+s*r[5]+n*r[8],e}function bp(e,t,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-i*c,f=i*l-s*a,m=s*f-n*p,y=n*h-i*f,_=i*p-s*h;const b=2*o;return h*=b,p*=b,f*=b,m*=2,y*=2,_*=2,e[0]=a+h+m,e[1]=l+p+y,e[2]=c+f+_,e}function fAe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function mAe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function gAe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function Yhe(e,t){le(oI,e),le(aI,t),ve(oI,oI),ve(aI,aI);const r=_e(oI,aI);return r>1?0:r<-1?Math.PI:Math.acos(r)}const oI=M(),aI=M();function yAe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function el(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function lv(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],n=t[0],o=t[1],a=t[2],l=Pa();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function Cy(e,t,r){const i=r[0]-t[0],s=r[1]-t[1],n=r[2]-t[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=i*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const lo=ge,_Ae=S5,vAe=KN,QM=Ai,mW=jn,_c=Me,GB=ba,dK=Object.freeze(Object.defineProperty({__proto__:null,abs:zB,add:me,angle:Yhe,bezier:dAe,ceil:aAe,copy:le,cross:dt,direction:Cy,dist:QM,distance:Ai,div:vAe,divide:KN,dot:_e,equals:lv,exactEquals:el,floor:qhe,hermite:hAe,inverse:uAe,len:_c,length:Me,lerp:rn,max:lAe,min:Xhe,mul:_Ae,multiply:S5,negate:Ea,normalize:ve,random:pAe,rotateX:fAe,rotateY:mAe,rotateZ:gAe,round:cAe,scale:ae,scaleAndAdd:Wb,set:ce,sign:Whe,sqrDist:mW,sqrLen:GB,squaredDistance:jn,squaredLength:ba,str:yAe,sub:lo,subtract:ge,transformMat3:Mc,transformMat4:Ze,transformQuat:bp},Symbol.toStringTag,{value:"Module"}));function cp(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ti(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}function gW(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Zhe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Jhe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Qhe(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function bAe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function wAe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function xAe(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function TAe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function SAe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function uC(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function EAe(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function Khe(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function eF(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return r*r+i*i+s*s+n*n}function yW(e){const t=e[0],r=e[1],i=e[2],s=e[3];return Math.sqrt(t*t+r*r+i*i+s*s)}function _W(e){const t=e[0],r=e[1],i=e[2],s=e[3];return t*t+r*r+i*i+s*s}function CAe(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function AAe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ede(e,t){const r=t[0],i=t[1],s=t[2],n=t[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=s*o,e[3]=n*o),e}function tde(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function E5(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e[3]=a+i*(r[3]-a),e}function RAe(e,t){const r=JM;let i,s,n,o,a,l;t=t||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return e[0]=t*i,e[1]=t*s,e[2]=t*n*c,e[3]=t*o*c,e}function Mu(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3];return e[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,e[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,e[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,e[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,e}function OAe(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2],c=r[3],h=c*i+a*n-l*s,p=c*s+l*i-o*n,f=c*n+o*s-a*i,m=-o*i-a*s-l*n;return e[0]=h*c+m*-o+p*-l-f*-a,e[1]=p*c+m*-a+f*-o-h*-l,e[2]=f*c+m*-l+h*-a-p*-o,e[3]=t[3],e}function MAe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function mS(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function vW(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3],h=Pa();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}const PAe=Zhe,IAe=Jhe,$Ae=Qhe,LAe=Khe,DAe=eF,NAe=yW,FAe=_W,rde=Object.freeze(Object.defineProperty({__proto__:null,add:gW,ceil:bAe,copy:cp,dist:LAe,distance:Khe,div:$Ae,divide:Qhe,dot:tde,equals:vW,exactEquals:mS,floor:wAe,inverse:AAe,len:NAe,length:yW,lerp:E5,max:TAe,min:xAe,mul:IAe,multiply:Jhe,negate:CAe,normalize:ede,random:RAe,round:SAe,scale:uC,scaleAndAdd:EAe,set:ti,sqrDist:DAe,sqrLen:FAe,squaredDistance:eF,squaredLength:_W,str:MAe,sub:PAe,subtract:Zhe,transformMat4:Mu,transformQuat:OAe},Symbol.toStringTag,{value:"Module"})),pK=new Float32Array(1);function JS(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function ye(e,t,r){return Math.min(Math.max(e,t),r)}function Rp(e){return(e&e-1)==0}function uwt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function hwt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function Nt(e,t,r){return e+(t-e)*r}function Gt(e){return e*Math.PI/180}function nl(e){return 180*e/Math.PI}function I8(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Mn(e){return Math.acos(ye(e,-1,1))}function Zh(e){return Math.asin(ye(e,-1,1))}function gS(e,t,r=1e-6){return e===t?!0:!Number.isFinite(e)||!Number.isFinite(t)?!1:(e>t?e-t:t-e)<=r}const tF=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function UAe(e){return tF.setFloat64(0,e),tF.getBigInt64(0)}function kAe(e){return tF.setBigInt64(0,e),tF.getFloat64(0)}const $8=BigInt("1000000");VAe(1);function VAe(e){const t=UAe(e=Math.abs(e)),r=kAe(t<=$8?$8:t-$8);return Math.abs(e-r)}function BAe(e,t,r=1e-6){if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;const i=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function zAe(e){return ide(Math.max(-jB,Math.min(e,jB)))}function ide(e){return pK[0]=e,pK[0]}function QS(e,t,r){const i=ye((r-e)/(t-e),0,1);return i*i*(3-2*i)}function fK(e,t){const r=Me(e),i=Zh(e[2]/r),s=Math.atan2(e[1]/r,e[0]/r);return ce(t,r,i,s),t}function dwt(e,t,r){return ti(e,t[0],t[1],t[2],t[3]*r)}function pwt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],i=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(gS(t,1)&&gS(r,1)&&gS(i,1))}const jB=ide(34028234663852886e22);let M_;function de(e){return typeof M_[e]=="function"?M_[e]=M_[e](globalThis):M_[e]}var Mhe,Phe,Ihe,$he;M_=((Mhe=globalThis.dojoConfig)==null?void 0:Mhe.has)||((Phe=globalThis.esriConfig)==null?void 0:Phe.has)?{...(Ihe=globalThis.dojoConfig)==null?void 0:Ihe.has,...($he=globalThis.esriConfig)==null?void 0:$he.has}:{},de.add=(e,t,r,i)=>((i||M_[e]===void 0)&&(M_[e]=t),r&&de(e)),de.cache=M_,de.add("esri-deprecation-warnings",!0),(()=>{var t;de.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document;if(de.add("host-browser",e),de.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),de.add("dom",e),de("host-browser")){const r=navigator,i=r.userAgent,s=r.appVersion,n=parseFloat(s);if(de.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),de.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),de.add("khtml",s.includes("Konqueror")?n:void 0),de.add("edge",parseFloat(i.split("Edge/")[1])||void 0),de.add("opr",parseFloat(i.split("OPR/")[1])||void 0),de.add("webkit",!de("wp")&&!de("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),de.add("chrome",!de("edge")&&!de("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),de.add("android",!de("wp")&&parseFloat(i.split("Android ")[1])||void 0),de.add("safari",!s.includes("Safari")||de("wp")||de("chrome")||de("android")||de("edge")||de("opr")?void 0:parseFloat(s.split("Version/")[1])),de.add("mac",s.includes("Macintosh")),!de("wp")&&i.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=i.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));de.add(o,l),de.add("ios",l)}de("webkit")||(!i.includes("Gecko")||de("wp")||de("khtml")||de("edge")||de.add("mozilla",n),de("mozilla")&&de.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),r=/iPhone/i.test(e);t&&de.add("esri-mobile",t),r&&de.add("esri-iPhone",r),de.add("esri-geolocation",!!navigator.geolocation)}de.add("esri-wasm","WebAssembly"in globalThis),de.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),de.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),de.add("esri-atomics","Atomics"in globalThis),de.add("esri-workers","Worker"in globalThis),de.add("web-feat:cache","caches"in globalThis),de.add("esri-workers-arraybuffer-transfer",!de("safari")||Number(de("safari"))>=12),de.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),de.add("featurelayer-simplify-payload-size-factors",[1,1,4]),de.add("featurelayer-snapshot-enabled",!0),de.add("featurelayer-snapshot-point-min-threshold",8e4),de.add("featurelayer-snapshot-point-max-threshold",4e5),de.add("featurelayer-snapshot-point-coverage",.1),de.add("featurelayer-advanced-symbols",!1),de.add("featurelayer-pbf",!0),de.add("featurelayer-pbf-statistics",!1),de.add("feature-layers-workers",!0),de.add("feature-polyline-generalization-factor",1),de.add("mapview-transitions-duration",200),de.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),de.add("mapserver-pbf-version-support",10.81),de.add("mapservice-popup-identify-max-tolerance",20),de.add("heatmap-allow-raster-fallback",!0),de.add("heatmap-force-raster",!1),de("host-webworker")||de("host-browser")&&(de.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),de.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{de.add("esri-image-decode",!0,!0,!0)}).catch(()=>{de.add("esri-image-decode",!1,!0,!0)})}return!1}),de.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();class Mh{constructor(t=1){this._seed=t}set seed(t){this._seed=t!=null?t:Math.random()*Mh._m}getInt(){return this._seed=(Mh._a*this._seed+Mh._c)%Mh._m,this._seed}getFloat(){return this.getInt()/(Mh._m-1)}getIntRange(t,r){return Math.round(this.getFloatRange(t,r))}getFloatRange(t,r){const i=r-t;return t+this.getInt()/Mh._m*i}}Mh._m=2147483647,Mh._a=48271,Mh._c=0;function KM(e,t){return t?e.filter((r,i,s)=>s.findIndex(t.bind(null,r))===i):e.filter((r,i,s)=>s.indexOf(r)===i)}function dy(e,t,r){if(E(e)&&E(t))return!0;if(E(e)||E(t)||e.length!==t.length)return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function bW(e,t){let r=e.length!==t.length;r&&(e.length=t.length);for(let i=0;i<t.length;++i)e[i]!==t[i]&&(e[i]=t[i],r=!0);return r}function GAe(e,t,r){let i,s;return r?(i=t.filter(n=>!e.some(o=>r(o,n))),s=e.filter(n=>!t.some(o=>r(o,n)))):(i=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:i,removed:s}}function jAe(e){return e&&typeof e.length=="number"}function fwt(e,t){const r=e.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=t)i.push(e.slice(s,s+t));return i}const HAe=!!Array.prototype.fill;function mwt(e,t){if(HAe)return new Array(e).fill(t);const r=new Array(e);for(let i=0;i<e;i++)r[i]=t;return r}function qAe(e,t){t===void 0&&(t=e,e=0);const r=new Array(t-e);for(let i=e;i<t;i++)r[i-e]=i;return r}function WAe(e,t,r){const i=e.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return r?t>=e[i-1]?-1:o===t?s:s-1:o===t?s:-1}class sde{constructor(){this.last=0}}const nde=new sde;function HB(e,t,r,i){i=i||nde;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(e[o]===t)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(e[o]===t)return i.last=o,o;return-1}function EO(e,t,r,i){const s=r!=null?r:e.length,n=HB(e,t,s,i);if(n!==-1)return e[n]=e[s-1],r==null&&e.pop(),t}const fd=new Set;function XAe(e,t,r=e.length,i=t.length,s,n){if(i===0||r===0)return r;fd.clear();for(let a=0;a<i;++a)fd.add(t[a]);s=s||nde;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(fd.has(e[a])&&(n&&n.push(e[a]),fd.delete(e[a]),e[a]=e[r-1],--r,--a,fd.size===0||r===0))return fd.clear(),r;for(let a=0;a<o;++a)if(fd.has(e[a])&&(n&&n.push(e[a]),fd.delete(e[a]),e[a]=e[r-1],--r,--a,fd.size===0||r===0))return fd.clear(),r;return fd.clear(),r}function YAe(e,t){let r=0;for(let i=0;i<e.length;++i){const s=e[i];t(s,i)&&(e[r]=s,r++)}e.length=r}function ZAe(e){return e?(mK.seed=e,()=>mK.getFloat()):Math.random}function gwt(e,t){const r=ZAe(t);for(let i=e.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=e[i];e[i]=e[s],e[s]=n}return e}const mK=new Mh;function wW(e,t){const r=e.indexOf(t);return r!==-1?(e.splice(r,1),t):null}function ywt(e,t){const r=new Map,i=e.length;for(let s=0;s<i;s++){const n=e[s],o=t(n,s,e),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function HC(e){return e instanceof ArrayBuffer}function JAe(e){return e&&e.constructor&&e.constructor.name==="Int8Array"}function Ob(e){return e&&e.constructor&&e.constructor.name==="Uint8Array"}function QAe(e){return e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function KAe(e){return e&&e.constructor&&e.constructor.name==="Int16Array"}function xW(e){return e&&e.constructor&&e.constructor.name==="Uint16Array"}function eRe(e){return e&&e.constructor&&e.constructor.name==="Int32Array"}function TW(e){return e&&e.constructor&&e.constructor.name==="Uint32Array"}function SW(e){return e&&e.constructor&&e.constructor.name==="Float32Array"}function EW(e){return e&&e.constructor&&e.constructor.name==="Float64Array"}function lI(e){return v(e)?128+e.buffer.byteLength+64:0}const fm=1024;function ode(e,t){let r;if(t)for(r in e)e.hasOwnProperty(r)&&(e[r]===void 0?delete e[r]:e[r]instanceof Object&&ode(e[r],!0));else for(r in e)e.hasOwnProperty(r)&&e[r]===void 0&&delete e[r];return e}function re(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=ude(e);if(v(t))return t;if(ade(e))return e.clone();if(lde(e))return e.map(re);if(cde(e))return e.clone();const r={};for(const i of Object.getOwnPropertyNames(e))r[i]=re(e[i]);return r}function qB(e){if(!e||typeof e!="object"||typeof e=="function"||"HTMLElement"in globalThis&&e instanceof HTMLElement)return e;const t=ude(e);if(v(t))return t;if(lde(e)){let r=!0;const i=e.map(s=>{const n=qB(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(ade(e))return e.clone();if(!cde(e)){const r=new(Object.getPrototypeOf(e)).constructor;for(const i of Object.getOwnPropertyNames(e)){const s=e[i],n=qB(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function ade(e){return typeof e.clone=="function"}function lde(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function cde(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function gK(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function ude(e){if(JAe(e)||Ob(e)||QAe(e)||KAe(e)||xW(e)||eRe(e)||TW(e)||SW(e)||EW(e))return e.slice();if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;for(const[r,i]of e)t.set(r,re(i));return t}if(e instanceof Set){const t=new Set;for(const r of e)t.add(re(r));return t}return null}function CW(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function tRe(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&dy(e,t):e instanceof Set?t instanceof Set&&iRe(e,t):e instanceof Map?t instanceof Map&&sRe(e,t):!!gK(e)&&gK(t)&&rRe(e,t))}function rRe(e,t){if(e===null||t===null)return!1;const r=Object.keys(e);if(t===null||Object.keys(t).length!==r.length)return!1;for(const i of r)if(e[i]!==t[i]||!Object.prototype.hasOwnProperty.call(t,i))return!1;return!0}function iRe(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function sRe(e,t){if(e.size!==t.size)return!1;for(const[r,i]of e){const s=t.get(r);if(s!==i||s===void 0&&!t.has(r))return!1}return!0}function hde(e,t,r=!1){return pde(e,t,r)}function eP(e,t){if(t!=null)return t[e]||dde(e.split("."),!1,t)}function ol(e,t,r){const i=e.split("."),s=i.pop(),n=dde(i,!0,r);n&&s&&(n[s]=t)}function dde(e,t,r){let i=r;for(const s of e){if(i==null)return;if(!(s in i)){if(!t)return;i[s]={}}i=i[s]}return i}function pde(e,t,r){return t?Object.keys(t).reduce((i,s)=>{let n=i[s],o=t[s];return n===o?i:n===void 0?(i[s]=re(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=pde(n,o,r):i.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(i[s]=o),i)},e||{}):e}var Lhe;const ni={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(Lhe=globalThis.location)==null?void 0:Lhe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(hde(ni,globalThis.esriConfig,!0),delete ni.has),!ni.assetsPath){{const e="4.26.5";ni.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}ni.defaultAssetsPath=ni.assetsPath}const nRe=/\{([^\}]+)\}/g;function yK(e){return e!=null?e:""}function mm(e,t){return e.replace(nRe,typeof t=="object"?(r,i)=>yK(eP(i,t)):(r,i)=>yK(t(i)))}function _wt(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>t&&t.includes(r)?r:`\\${r}`)}function AW(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}function vwt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const _K={info:0,warn:1,error:2,none:3};class ee{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,ee._loggers[this.module]=this;const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=ee.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const r=ee._loggers;return ee._loggers=t,r},set throttlingDisabled(t){ee._throttlingDisabled=t}}}static getLogger(t){let r=ee._loggers[t];return r||(r=new ee({module:t})),r}_log(t,r,...i){if(!!this._matchLevel(t)){if(r!=="always"&&!ee._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[t].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=ee._tickCounter)return;this._loggedMessages[t].set(s,ee._tickCounter),ee._scheduleTickCounterIncrement()}for(const s of ni.log.interceptors)if(s(t,this.module,...i))return;this._inheritedWriter()(t,this.module,...i)}}_parentWithMember(t,r){let i=this;for(;v(i);){const s=i[t];if(v(s))return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,r,...i){console[t](`[${r}]`,...i)}_matchLevel(t){const r=ni.log.level?ni.log.level:"warn";return _K[this._parentWithMember("level",r)]<=_K[t]}_argsToKey(...t){const r=(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return AW(JSON.stringify(t,r))}static _scheduleTickCounterIncrement(){ee._tickCounterScheduled||(ee._tickCounterScheduled=!0,Promise.resolve().then(()=>{ee._tickCounter++,ee._tickCounterScheduled=!1}))}}ee._loggers={},ee._tickCounter=0,ee._tickCounterScheduled=!1,ee._throttlingDisabled=!1;function ea(e,t){for(const[r,i]of e)if(t(i,r))return!0;return!1}function bwt(e,t){for(const[r,i]of e)if(t(i,r))return i;return null}function RW(e,t,r){const i=e.get(t);if(i!==void 0)return i;const s=r();return e.set(t,s),s}const yS=ee.getLogger("esri.core.accessorSupport.ensureTypes");function oRe(e){return e==null?e:new Date(e)}function aRe(e){return e==null?e:!!e}function tP(e){return e==null?e:e.toString()}function Ph(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function OW(e){return e==null?e:Math.round(parseFloat(e))}function fde(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function rF(e,t){return t!=null&&e&&!(t instanceof e)}function mde(e){return e&&"isCollection"in e}function vK(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function lRe(e,t){if(!t||!t.constructor||!mde(t.constructor))return WB(e,t)?t:new e(t);const r=vK(e.prototype.itemType),i=vK(t.constructor.prototype.itemType);return r?i?r===i?t:r.prototype.isPrototypeOf(i.prototype)?new e(t):(WB(e,t),t):new e(t):t}function WB(e,t){return!!fde(t)&&(yS.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+C5(e)+"'"),!0)}function KS(e,t){return t==null?t:mde(e)?lRe(e,t):rF(e,t)?WB(e,t)?t:new e(t):t}function C5(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const cRe=new WeakMap;function uRe(e){switch(e){case Number:return Ph;case Ri:return OW;case Boolean:return aRe;case String:return tP;case Date:return oRe;default:return RW(cRe,e,()=>KS.bind(null,e))}}function Us(e,t){const r=uRe(e);return arguments.length===1?r:r(t)}function CO(e,t,r){return arguments.length===1?CO.bind(null,e):t&&(Array.isArray(t)?t.map(i=>e(i,r)):[e(t,r)])}function hRe(e,t){return arguments.length===1?CO(Us.bind(null,e)):CO(Us.bind(null,e),t)}function gde(e,t,r){return t!==0&&Array.isArray(r)?r.map(i=>gde(e,t-1,i)):e(r)}function iF(e,t,r){if(arguments.length===2)return iF.bind(null,e,t);if(!r)return r;let i=t,s=r=gde(e,t,r);for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function dRe(e,t,r){return arguments.length===2?iF(Us.bind(null,e),t):iF(Us.bind(null,e),t,r)}function yde(e){return!!Array.isArray(e)&&!e.some(t=>{const r=typeof t;return!(r==="string"||r==="number"||r==="function"&&e.length>1)})}function XB(e,t){if(arguments.length===2)return XB(e).call(null,t);const r=new Set,i=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(r.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!rF(a,p))?a:(h&&i.length?(n||(n=i.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),yS.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>C5(p)).join(", ")),yS.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):yS.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Op(e,t){if(arguments.length===2)return Op(e).call(null,t);const r={},i=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];r[l]=Us(c),i.push(C5(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!rF(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=r[c];if(!h)return yS.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!rF(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!fde(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return h(p)}return h(l)}}class Ri{}const wwt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function pRe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function _de(e){switch(e.type){case"native":return Us(e.value);case"array":return CO(_de(e.value));case"one-of":return fRe(e);default:return null}}function fRe(e){let t=null;return(r,i)=>ZB(r,e)?r:(t==null&&(t=YB(e)),yS.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),i&&(i.valid=!1),null)}function YB(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Ri:return"integer";case Date:return"date";default:return C5(e.value)}case"array":return`array of ${YB(e.value)}`;case"one-of":{const t=e.values.map(r=>YB(r));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function ZB(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case Ri:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(r=>!ZB(r,t.value));case"one-of":return t.values.some(r=>ZB(e,r))}}function cI(e){return ye(OW(e),0,255)}function uI(e,t,r){return e=Number(e),isNaN(e)?r:e<t?t:e>r?r:e}class Ln{static blendColors(t,r,i,s=new Ln){return s.r=Math.round(t.r+(r.r-t.r)*i),s.g=Math.round(t.g+(r.g-t.g)*i),s.b=Math.round(t.b+(r.b-t.b)*i),s.a=t.a+(r.a-t.a)*i,s._sanitize()}static fromRgb(t,r){const i=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Ln.fromArray(a,r)}return Ln.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Ln.fromArray(Vhe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(t,r=new Ln){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const i=t.length===4?4:8,s=(1<<i)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(t,r=new Ln){return r._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(t,r){const i=khe(t)?hW(t):null;return i&&Ln.fromArray(i,r)||Ln.fromRgb(t,r)||Ln.fromHex(t,r)}static fromJSON(t){return t&&new Ln([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return v(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return v(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var r,i,s,n;return typeof t=="string"?Ln.fromString(t,this):Array.isArray(t)?Ln.fromArray(t,this):(this._set((r=t.r)!=null?r:0,(i=t.g)!=null?i:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof Ln||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${t.length<2?"0"+t:t}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(t=!1){const r=this.r+", "+this.g+", "+this.b;return t?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=Ln.AlphaMode.ALWAYS){const r=cI(this.r),i=cI(this.g),s=cI(this.b);return t===Ln.AlphaMode.ALWAYS||this.a!==1?[r,i,s,cI(255*this.a)]:[r,i,s]}clone(){return new Ln(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return v(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(uI(this.r,0,255)),this.g=Math.round(uI(this.g,0,255)),this.b=Math.round(uI(this.b,0,255)),this.a=uI(this.a,0,1),this}_set(t,r,i,s){this.r=t,this.g=r,this.b=i,this.a=s}}Ln.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(Ln||(Ln={}));const Qe=Ln;function A5(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function rP(e,t,r){if(!A5(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,r);if(Array.isArray(t)){const i=t.slice();for(const s of i)e.addEventListener(s,r);return{remove(){for(const s of i)e.removeEventListener(s,r)}}}return e.addEventListener(t,r),{remove(){e.removeEventListener(t,r)}}}function vde(e,t,r){if(!A5(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,r);const i=rP(e,t,s=>{i.remove(),r.call(e,s)});return{remove(){i.remove()}}}const mRe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Mb({key:e}){return mRe[e]||e}function eE(e){return Mp(()=>e.forEach(t=>v(t)&&t.remove()))}function Mp(e){return{remove:()=>{e&&(e(),e=void 0)}}}function xwt(e){return Mp(v(e)?()=>e.destroy():void 0)}function gRe(e){return{setTimeout:(t,r)=>{const i=e.setTimeout(t,r);return{remove:()=>e.clearTimeout(i)}}}}const R5=gRe(globalThis),bK=new Set;function yRe(e,t,r=!1){r&&bK.has(t)||(r&&bK.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function JB(e,t,r={}){if(de("esri-deprecation-warnings")){const{moduleName:i}=r;bde(e,`Property: ${(i?i+"::":"")+t}`,r)}}function bde(e,t,r={}){if(de("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=t;i&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${i}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),yRe(e,a,o)}}function _Re(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>{if(i==="")return"$";const s=eP(i,t),n=s!=null?s:"";if(n===void 0)throw new Error(`could not find key "${i}" in template`);return n.toString()})}class O5{constructor(t,r,i){var s;this.name=t,this.details=i,this instanceof O5&&(this.message=(s=r&&_Re(r,i))!=null?s:"")}toString(){return"["+this.name+"]: "+this.message}}class j extends O5{constructor(t,r,i){if(super(t,r,i),!(this instanceof j))return new j(t,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return re(r)}catch{return"[object]"}}))}}catch(t){throw ee.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new j(t.name,t.message,t.details)}}j.prototype.type="error";function Wr(e="Aborted"){return new j("AbortError",e)}function cr(e,t="Aborted"){if(zn(e))throw Wr(t)}function M5(e){return v(e)?"aborted"in e?e:e.signal:e}function zn(e){const t=M5(e);return v(t)&&t.aborted}function Sc(e){if(sn(e))throw e}function QB(e){if(!sn(e))throw e}function Ca(e,t){const r=M5(e);if(!E(r)){if(!r.aborted)return vde(r,"abort",()=>t());t()}}function P5(e,t){const r=M5(e);if(!E(r))return cr(r),vde(r,"abort",()=>t(Wr()))}function MW(e,t){const r=M5(t);return E(r)?e:new Promise((i,s)=>{let n=Ca(t,()=>s(Wr()));const o=()=>n=zi(n);e.then(o,o),e.then(i,s)})}function sn(e){return(e==null?void 0:e.name)==="AbortError"}async function _S(e){try{return await e}catch(t){if(!sn(t))throw t;return}}async function Twt(e,t=ee.getLogger("esri")){try{return await e}catch(r){sn(r)||t.error(r)}}function cv(){let e=null;const t=new Promise((r,i)=>{e={promise:void 0,resolve:r,reject:i}});return e.promise=t,e}async function fo(e){if(!e)return;if(typeof e.forEach!="function"){const r=Object.keys(e),i=r.map(o=>e[o]),s=await fo(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(r=>{const i=[];let s=t.length;s===0&&r(i),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};i.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&r(i)})})})}async function KB(e){return(await fo(e)).filter(t=>!!t.value).map(t=>t.value)}function Ew(e,t,r){const i=new AbortController;return Ca(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);Ca(i,()=>{o&&(clearTimeout(o),n(Wr()))})})}function Hu(e){return e&&typeof e.then=="function"}function ez(e){return Hu(e)?e:Promise.resolve(e)}function PW(e,t=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(Wr()),n=cv();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||cv(),n=null,t>0){const f=new AbortController;r=ez(e(...l,f.signal));const m=r;Ew(t).then(()=>{r===m&&(n?f.abort():o=f)})}else r=1,r=ez(e(...l));const c=()=>{const f=i;i=s=r=o=null,f!=null&&a(...f)},h=r,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function uv(){let e,t;const r=new Promise((s,n)=>{e=s,t=n}),i=s=>{e(s)};return i.resolve=s=>e(s),i.reject=s=>t(s),i.timeout=(s,n)=>R5.setTimeout(()=>i.reject(n),s),i.promise=r,i}function Swt(e,t){return e.then(t,t)}async function wK(e){await Promise.resolve(),cr(e)}function vRe(e){return e&&e.release&&typeof e.release=="function"}function bRe(e){return e&&e.acquire&&typeof e.acquire=="function"}class An{constructor(t,r,i,s=1,n=0){if(this._ctor=t,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let r;if(An.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...t):bRe(r)&&r.acquire(...t),r}release(t){t&&!An.test.disabled&&(this._releaseFunction?this._releaseFunction(t):vRe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let r=t;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}An.test={disabled:!1};function wRe(e){e.length=0}class Ec{constructor(t=50,r=50){this._pool=new An(Array,void 0,wRe,r,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return L8.acquire()}static release(t){return L8.release(t)}static prune(){L8.prune()}}const L8=new Ec(100);class wde extends An{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=Sw(this._set)}acquire(...t){const r=super.acquire(...t);return this._set.delete(r),r}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const hI=[];function tE(e){hI.push(e),hI.length===1&&queueMicrotask(()=>{const t=hI.slice();hI.length=0;for(const r of t)r()})}class Xg{constructor(t,r=30){this.name=t,this._counter=0,this._samples=new Array(r)}record(t){v(t)&&(this._samples[++this._counter%this._samples.length]=t)}get median(){return this._samples.slice().sort((t,r)=>t-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((t,r)=>t+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}}var tz;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=i,e.iterableSort=s})(tz||(tz={}));const xK=tz,xRe=1.5,TRe=1.1;class Jt{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new sde,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>TK(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];t(s)&&r.push(s)}return r}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,r){const i=this.data.indexOf(t,r);return i!==-1&&i<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let r=t;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,r=t.length){for(let i=0;i<r;i++)this.data[this._length++]=t[i]}fill(t,r){for(let i=0;i<r;i++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,TK(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const r=HB(this.data,t,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,t}removeUnordered(t){return this.removeUnorderedIndex(HB(this.data,t,this.length,this._hint))}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,r=t.length,i){this.length=XAe(this.data,t,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,r){if(t>=this.length||r>=this.length||t===r)return;const i=this.data[t];this.data[t]=this.data[r],this.data[r]=i}sort(t){xK.sort(this.data,0,this.length,t)}iterableSort(t){return xK.iterableSort(this.data,0,this.length,t)}some(t,r){for(let i=0;i<this.length;++i)if(t.call(r,this.data[i],i,this.data))return!0;return!1}find(t,r){for(let i=0;i<this.length;++i){const s=this.data[i];if(t.call(r,s,i))return s}}filterInPlace(t,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(t,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)t.call(r,s[n],n,s)}forEach(t,r){for(let i=0;i<this.length;++i)t.call(r,this.data[i],i,this.data)}map(t,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=t.call(r,this.data[s],s,this.data);return i}reduce(t,r){let i=r;for(let s=0;s<this.length;++s)i=t(i,this.data[s],s,this.data);return i}has(t){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===t)return!0;return!1}}function TK(e){e.data.length>xRe*e.length&&(e.data.length=Math.floor(e.length*TRe))}function Ewt(e){return e}function xde(e){return 1e3*e}function IW(e){return .001*e}class SRe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class ERe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let rz=0,iz=0;const qC={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},sz=["prepare","preRender","render","postRender","update","finish"],nz=[],Cw=new Jt;class CRe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const sF={frameTasks:Cw,willDispatch:!1,clearFrameTasks:ARe,dispatch:Ede,executeFrameTasks:ORe};function hC(e){const t=new ERe(e);return nz.push(t),sF.willDispatch||(sF.willDispatch=!0,tE(Ede)),t}function rE(e){const t=new SRe(e);return Cw.push(t),nF==null&&(rz=performance.now(),nF=requestAnimationFrame(Tde)),new CRe(t)}let nF=null;function ARe(e=!1){Cw.forAll(t=>{t.removed=!0}),e&&Sde()}function RRe(e){iz=Math.max(0,e)}function Tde(){const e=performance.now();nF=null,nF=Cw.length>0?requestAnimationFrame(Tde):null,sF.executeFrameTasks(e)}function ORe(e){const t=e-rz;rz=e;const r=iz>0?iz:1e3/60,i=Math.max(0,t-r);qC.time=e,qC.frameDuration=r-i;for(let s=0;s<sz.length;s++){const n=performance.now(),o=sz[s];Cw.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(qC.elapsedFrameTime=performance.now()-e,qC.deltaTime=a.ticks===0?0:t,(l=a.phases[o])==null||l.call(a,qC)))}),MRe[s].record(performance.now()-n)}Sde(),PRe.record(performance.now()-e)}const dI=new Jt;function Sde(){Cw.forAll(e=>{e.removed&&dI.push(e)}),Cw.removeUnorderedMany(dI.data,dI.length),dI.clear()}function Ede(){for(;nz.length;){const e=nz.shift();e.isActive&&e.callback()}sF.willDispatch=!1}function Cwt(e=1,t){const r=uv(),i=()=>{zn(t)?r.reject(Wr()):e===0?r():(--e,tE(()=>i()))};return i(),r.promise}const MRe=sz.map(e=>new Xg(e)),PRe=new Xg("total");function tD(e,t){for(const r of e.entries())if(t(r[0]))return!0;return!1}let IRe=0;const $Re=0;function Lc(){return++IRe}function al(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function LRe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function rD(e,t,r){return r?oF(e,t,{policy:r,path:""}):oF(e,t,null)}function oF(e,t,r){return t?Object.keys(t).reduce((i,s)=>{let n=null,o="merge";if(r&&(n=r.path?`${r.path}.${s}`:s,o=r.policy(n)),o==="replace"||o==="replace-arrays"&&Array.isArray(i[s]))return i[s]=t[s],i;if(i[s]===void 0)return i[s]=re(t[s]),i;let a=i[s],l=t[s];if(a===l)return i;if(Array.isArray(l)||Array.isArray(i))a=a?Array.isArray(a)?i[s]=a.concat():i[s]=[a]:i[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(r){const c=r.path;r.path=n,i[s]=oF(a,l,r),r.path=c}else i[s]=oF(a,l,null);else i.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(i[s]=l);return i},e||{}):e}function Cde(e){return Array.isArray(e)?e:e.split(".")}function SK(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function DRe(e){if(Array.isArray(e)){const t=[];for(const r of e)t.push(...SK(r));return t}return SK(e)}function Ade(e,t,r,i){const s=DRe(t);if(s.length!==1){const n=s.map(o=>i(e,o,r));return eE(n)}return i(e,s[0],r)}function $W(e){let t=!1;return()=>{t||(t=!0,e())}}function Rde(e,t){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const i=al(t);return LRe(i,r)?i.get(r):t[r]}function Ode(e,t,r){if(e==null)return e;const i=Rde(t[r],e);return!i&&r<t.length-1?void 0:r===t.length-1?i:Ode(i,t,r+1)}function iP(e,t,r=0){return typeof t!="string"||t.includes(".")?Ode(e,Cde(t),r):Rde(t,e)}function aF(e,t){return iP(e,t)}function EK(e,t){return iP(t,e)!==void 0}var ki;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(ki||(ki={}));const lF={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},iR=[];let A3=lF;function vr(e){A3.onObservableAccessed(e)}let iD=!1,sD=!1;function py(e,t,r){if(iD)return LW(e,t,r);Mde(e);const i=t.call(r);return Pde(),i}function NRe(e,t){return py(lF,e,t)}function LW(e,t,r){const i=iD;iD=!0,Mde(e);let s=null;try{s=t.call(r)}catch(n){sD&&ee.getLogger("esri.core.accessorSupport.tracking").error(n)}return Pde(),iD=i,s}function Mde(e){A3=e,iR.push(e)}function Pde(){const e=iR.length;if(e>1){const t=iR.pop();A3=iR[e-2],t.onTrackingEnd()}else if(e===1){const t=iR.pop();A3=lF,t.onTrackingEnd()}else A3=lF}function Ide(e,t){const r=t.observerObject;if(r.flags&ki.DepTrackingInitialized)return;const i=sD;sD=!1,r.flags&ki.AutoTracked?LW(t,t.metadata.get,e):$de(e,t),sD=i}const FRe=[];function $de(e,t){const r=t.observerObject;r.flags&ki.ExplicitlyTracking||(r.flags|=ki.ExplicitlyTracking,LW(t,()=>{const i=t.metadata.dependsOn||FRe;for(const s of i)if(typeof s!="string"||s.includes(".")){const n=Cde(s);for(let o=0,a=e;o<n.length&&a!=null&&typeof a=="object";++o)a=CK(a,n[o],o!==n.length-1)}else CK(e,s,!1)}),r.flags&=~ki.ExplicitlyTracking)}function CK(e,t,r){var n;const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(i,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=al(e))==null?void 0:n.properties.get(i);return s&&(vr(s.observerObject),Ide(e,s)),r?e[i]:void 0}class I5{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._observerObject=new URe(this._notify),AK.register(this,this._observerObject)}destroy(){var t;this._accessed.length=0,(t=this._observerObject)==null||t.destroy(),this.clear(),AK.unregister(this)}onObservableAccessed(t){const r=this._accessed;r.includes(t)||r.push(t)}onTrackingEnd(){const t=this._handles,r=this._accessed,i=this._observerObject;for(let s=0;s<r.length;++s)t.push(r[s].observe(i));r.length=0}clear(){const t=this._handles;for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}class URe{constructor(t){this._notify=t,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}destroy(){this.destroyed=!0,this._notify=kRe}}const AK=new FinalizationRegistry(e=>{e.destroy()});function kRe(){}let vS=!1;const cF=[];function Lde(e,t){let r=new I5(n),i=null,s=!1;function n(){if(!r||s)return;if(vS)return void Fde(n);const a=i;r.clear(),vS=!0,s=!0,i=py(r,e),s=!1,vS=!1,t(i,a),Ude()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=py(r,e),s=!1,{remove:o}}function Dde(e,t){let r=new I5(s),i=null;function s(){t(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=py(r,e),i):null}return o(),{remove:n}}function Nde(e){let t=new I5(i),r=!1;function i(){t&&!r&&(vS?Fde(i):(t.clear(),vS=!0,r=!0,py(t,e),r=!1,vS=!1,Ude()))}function s(){t&&(t.destroy(),t=null)}return r=!0,py(t,e),r=!1,{remove:s}}function Fde(e){cF.includes(e)||cF.unshift(e)}function Ude(){for(;cF.length;)cF.pop()()}var R3;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(R3||(R3={}));class AO{constructor(){this.uid=Lc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,r,i,s,n){return this.pool.acquire(R3.Untracked,t,r,i,s,n,CW)}static acquireTracked(t,r,i,s){return this.pool.acquire(R3.Tracked,t,r,i,null,null,s)}notify(t,r){this.type===R3.Untracked?this.callback.call(this.target,t,r,this.path,this.target):this.callback.call(null,t,r)}acquire(t,r,i,s,n,o,a){this.uid=Lc(),this.removed=!1,this.type=t,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Lc(),this.removed=!0}}AO.pool=new wde(AO);const nD=new Ec,Kg=new Set;let uF;function hF(e){Kg.delete(e),Kg.add(e),uF||(uF=hC(zRe))}function VRe(e){if(e.removed)return;const t=e.oldValue,r=e.getValue();e.equals(t,r)||(e.oldValue=r,e.notify(r,t))}function BRe(e){for(const t of Kg.values())t.target===e&&(t.removed=!0)}function zRe(){let e=10;for(;uF&&e--;){uF=null;const t=GRe(),r=nD.acquire();for(const i of t){const s=i.uid;VRe(i),s===i.uid&&i.removed&&r.push(i)}for(const i of Kg)i.removed&&(r.push(i),Kg.delete(i));for(const i of r)AO.pool.release(i);nD.release(r),nD.release(t),oz.forEach(i=>i())}}function GRe(){const e=nD.acquire();e.length=Kg.size;let t=0;for(const r of Kg)e[t]=r,++t;return Kg.clear(),e}const oz=new Set;function kde(e){return oz.add(e),{remove(){oz.delete(e)}}}function jRe(e,t,r){let i=Ade(e,t,r,(s,n,o)=>{let a,l,c=Dde(()=>iP(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=AO.acquireUntracked(h,o,p,s,n),l=a.uid),hF(a))});return{remove:$W(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,hF(a)),a=null),i=c=null})}});return i}function HRe(e,t,r){const i=Ade(e,t,r,(s,n,o)=>{let a=!1;return Lde(()=>iP(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,CW(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function qRe(e,t,r,i=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:i?HRe(e,t,r):jRe(e,t,r)}function WRe(e,t,r){let i,s,n=Dde(e,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=AO.acquireTracked(o,t,a,r),s=i.uid),hF(i))});return{remove:$W(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,hF(i)),i=null),n=null})}}function XRe(e,t,r){let i=!1;return Lde(e,(s,n)=>{i||(i=!0,r(n,s)||t(s,n),i=!1)})}function YRe(e,t,r=!1,i=tRe){return r?XRe(e,t,i):WRe(e,t,i)}function RK(e){return tD(Kg,t=>t.oldValue===e)}function se(e,t,r={}){return DW(e,t,r,Vde)}function oa(e,t,r={}){return DW(e,t,r,Bde)}function DW(e,t,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(zi(s),t(o,a))}:(o,a)=>{i(o)&&t(o,a)};if(s=YRe(e,n,r.sync,r.equals),r.initial){const o=e();n(o,o)}return s}function dn(e,t,r,i={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=i.onListenerRemove)==null||h.call(i,s),s=null,n=null)}function l(h){i.once&&i.once&&zi(o),r(h)}const c=se(e,(h,p)=>{var f;a(),A5(h)&&(s=h,n=rP(h,t,l),(f=i.onListenerAdd)==null||f.call(i,h))},{sync:i.sync,initial:!0});return o=Mp(()=>{c.remove(),a()}),o}function iE(e,t){return ZRe(e,Bde,t)}function ZRe(e,t,r){if(zn(r))return Promise.reject(Wr());const i=e();if(t!=null&&t(i))return Promise.resolve(i);let s=null;function n(){s=zi(s)}return new Promise((o,a)=>{s=eE([Ca(r,()=>{n(),a(Wr())}),DW(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:Vde)])})}function Vde(e){return!0}function Bde(e){return!!e}const ri={sync:!0},kt={initial:!0},Ys={sync:!0,initial:!0},JRe="modulepreload",OK={},QRe="./",ie=function(t,r){return!r||r.length===0?t():Promise.all(r.map(i=>{if(i=`${QRe}${i}`,i in OK)return;OK[i]=!0;const s=i.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${n}`))return;const o=document.createElement("link");if(o.rel=s?"stylesheet":JRe,s||(o.as="script",o.crossOrigin=""),o.href=i,document.head.appendChild(o),s)return new Promise((a,l)=>{o.addEventListener("load",a),o.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t())};function u(e,t,r,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o}function Awt(e){const t=[];return function*(){yield*t;for(const r of e)t.push(r),yield r}}function KRe(e,t){for(const r of e)if(r!=null&&t(r))return r}function az(e){return e!=null&&typeof e[Symbol.iterator]=="function"}class Jr{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let t=0;return this._groups.forEach(r=>{t+=r.length}),t}add(t,r){if(az(t)){const i=this._getOrCreateGroup(r);for(const s of t)this._isHandle(s)&&i.push(s)}else this._isHandle(t)&&this._getOrCreateGroup(r).push(t);return this}forEach(t,r){if(typeof t=="function")this._groups.forEach(i=>i.forEach(t));else{const i=this._getGroup(t);i&&r&&i.forEach(r)}}has(t){return this._groups.has(this._ensureGroupKey(t))}remove(t){if(typeof t!="string"&&az(t)){for(const r of t)this.remove(r);return this}return this.has(t)?(this._removeAllFromGroup(this._getGroup(t)),this._groups.delete(this._ensureGroupKey(t)),this):this}removeAll(){return this._groups.forEach(t=>this._removeAllFromGroup(t)),this._groups.clear(),this}_isHandle(t){return t&&!!t.remove}_getOrCreateGroup(t){if(this.has(t))return this._getGroup(t);const r=[];return this._groups.set(this._ensureGroupKey(t),r),r}_getGroup(t){return this._groups.get(this._ensureGroupKey(t))}_ensureGroupKey(t){return t||"_default_"}_removeAllFromGroup(t){t.forEach(r=>r.remove())}}const zde=Symbol("Accessor-beforeDestroy");function sP(e){let t=e.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!r){t=Object.create(t);for(const i in t)t[i]=re(t[i]);Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t={},Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function $5(e,t){const r=sP(e);let i=r[t];return i||(i=r[t]={}),i}function e3e(e,t){return rD(e,t,r3e)}const t3e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function r3e(e){return t3e.test(e)?"replace":"merge"}var Gg;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(Gg||(Gg={}));class i3e{constructor(t,r){this._observers=t,this._observer=r}remove(){wW(this._observers,this._observer)}}class Gde{constructor(){this._observers=null,this.destroyed=!1}observe(t){if(this.destroyed||t.destroyed)return s3e;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,s=!1;const n=r.length;for(let o=0;o<n;++o){const a=r[o];if(a.destroyed)s=!0;else if(a===t){i=!0;break}}return i||(r.push(t),s&&this._removeDestroyedObservers()),new i3e(r,t)}_removeDestroyedObservers(){const t=this._observers;if(!t||t.length===0)return;const r=t.length;let i=0;for(let s=0;s<r;++s){for(;s+i<r&&t[s+i].destroyed;)++i;if(i>0){if(!(s+i<r))break;t[s]=t[s+i]}}t.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const t=this._observers;if(t!=null){for(const r of t)r.onCommitted();this._observers=null}}}const s3e={remove:()=>{}};var Hr;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(Hr||(Hr={}));const lz=Hr.USER+1;function P_(e){switch(e){case"defaults":return Hr.DEFAULTS;case"service":return Hr.SERVICE;case"portal-item":return Hr.PORTAL_ITEM;case"web-scene":return Hr.WEB_SCENE;case"web-map":return Hr.WEB_MAP;case"user":return Hr.USER;default:return null}}function dF(e){switch(e){case Hr.DEFAULTS:return"defaults";case Hr.SERVICE:return"service";case Hr.PORTAL_ITEM:return"portal-item";case Hr.WEB_SCENE:return"web-scene";case Hr.WEB_MAP:return"web-map";case Hr.USER:return"user"}return void 0}function n3e(e){return dF(e)}class MK{constructor(t,r,i){this.properties=t,this.propertyName=r,this.metadata=i,this.observerObject=new o3e,this._accessed=null,this._handles=null,this.observerObject.flags=ki.Dirty|(i.nonNullable?ki.NonNullable:0)|(i.hasOwnProperty("value")?ki.HasDefaultValue:0)|(i.get===void 0?ki.DepTrackingInitialized:0)|(i.dependsOn===void 0?ki.AutoTracked:0),PK.register(this,this.observerObject)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles(),PK.unregister(this)}getComputed(){const t=this.observerObject;vr(t);const r=this.properties.store,i=this.propertyName,s=t.flags,n=r.get(i);if(s&ki.Computing||~s&ki.Dirty&&r.has(i))return n;t.flags|=ki.Computing;const o=this.properties.host;let a;s&ki.AutoTracked?a=py(this,this.metadata.get,o):($de(o,this),a=this.metadata.get.call(o)),r.set(i,a,Hr.COMPUTED);const l=r.get(i);return l===n?t.flags&=~ki.Dirty:NRe(this.commit,this),t.flags&=~ki.Computing,l}onObservableAccessed(t){t!==this.observerObject&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles();const t=this.observerObject;t.flags|=ki.DepTrackingInitialized;const r=this._accessed;if(r===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let s=0;s<r.length;++s)i.push(r[s].observe(t));r.length=0}notifyChange(){const t=this.observerObject;t.onInvalidated(),t.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const t=this.observerObject;t.flags&=~ki.Dirty,t.onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}}class o3e extends Gde{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&ki.Overriden&&(this.flags|=ki.Dirty);const t=this._observers;if(t&&t.length>0)for(const r of t)r.onInvalidated()}onCommitted(){const t=this._observers;if(t&&t.length>0){const r=t.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&ki.Dirty&&this.onCommitted(),super.destroy()}}const PK=new FinalizationRegistry(e=>{e.destroy()});class NW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new NW;return this._values.forEach((i,s)=>{t&&t.has(s)||r.set(s,re(i))}),r}get(t){return this._values.get(t)}originOf(){return Hr.USER}keys(){return[...this._values.keys()]}set(t,r){this._values.set(t,r)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function pI(e,t,r){return e!==void 0}function IK(e,t,r,i){return e!==void 0&&(!(r==null&&e.observerObject.flags&ki.NonNullable)||(i.lifecycle,Gg.INITIALIZING,!1))}function a3e(e){return e&&typeof e.destroy=="function"}ee.getLogger("esri.core.accessorSupport.Properties");class l3e{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Gg.INITIALIZING,this.store=new NW,this._origin=Hr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const s=new MK(this,i,r[i]);this.properties.set(i,s)}this.metadatas=r}initialize(){this.lifecycle=Gg.CONSTRUCTING}constructed(){this.lifecycle=Gg.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[t,r]of this.properties){if(r.metadata.autoDestroy){const i=this.internalGet(t);i&&a3e(i)&&(i.destroy(),~r.observerObject.flags&ki.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==Gg.INITIALIZING}get(t){const r=this.properties.get(t);if(r.metadata.get)return r.getComputed();vr(r.observerObject);const i=this.store;return i.has(t)?i.get(t):r.metadata.value}originOf(t){const r=this.store.originOf(t);if(r===void 0){const i=this.properties.get(t);if(i!==void 0&&i.observerObject.flags&ki.HasDefaultValue)return"defaults"}return dF(r)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const r=this.properties.get(t);if(pI(r))return this.store.has(t)?this.store.get(t):r.metadata.value}internalSet(t,r){const i=this.properties.get(t);pI(i)&&this._internalSet(i,r)}getDependsInfo(t,r,i){const s=this.properties.get(r);if(!pI(s))return"";const n=new Set,o=py({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${i}${t.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n){if(!(l instanceof MK))continue;const c=l.properties.host,h=l.propertyName,p=al(c);a+=p?p.getDependsInfo(c,h,i):`${i}${h}: undefined
`}return a}setAtOrigin(t,r,i){const s=this.properties.get(t);if(pI(s))return this._setAtOrigin(s,r,i)}isOverridden(t){const r=this.properties.get(t);return r!==void 0&&!!(r.observerObject.flags&ki.Overriden)}clearOverride(t){const r=this.properties.get(t),i=r==null?void 0:r.observerObject;i&&i.flags&ki.Overriden&&(i.flags&=~ki.Overriden,r.notifyChange())}override(t,r){const i=this.properties.get(t);if(!IK(i,t,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(D8.release(n),!o)return;r=a}i.observerObject.flags|=ki.Overriden,this._internalSet(i,r)}set(t,r){const i=this.properties.get(t);if(!IK(i,t,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(D8.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(t){this._origin=P_(t)}getDefaultOrigin(){return dF(this._origin)}notifyChange(t){const r=this.properties.get(t);r!==void 0&&r.notifyChange()}invalidate(t){const r=this.properties.get(t);r!==void 0&&r.invalidate()}commit(t){const r=this.properties.get(t);r!==void 0&&r.commit()}_internalSet(t,r){const i=this.lifecycle!==Gg.INITIALIZING?this._origin:Hr.DEFAULTS;this._setAtOrigin(t,r,i)}_setAtOrigin(t,r,i){const s=this.store,n=t.propertyName;s.has(n,i)&&CW(r,s.get(n))&&~t.observerObject.flags&ki.Overriden&&i===s.originOf(n)||(t.invalidate(),s.set(n,r,i),t.commit(),Ide(this.host,t))}_cast(t,r){const i=D8.acquire();return i.valid=!0,i.value=r,t&&(i.value=t.call(this.host,r,i)),i}}class c3e{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const D8=new An(c3e);function pF(e,t,r){if(e&&t)if(typeof t=="object")for(const i of Object.getOwnPropertyNames(t))pF(e,i,t[i]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void pF(aF(e,s),n,r)}const i=e.__accessor__;i!=null&&u3e(t,i),e[t]=r}}function u3e(e,t){if(de("esri-unknown-property-errors")&&!h3e(e,t))throw new j("set:unknown-property",d3e(e,t))}function h3e(e,t){return t.metadatas[e]!=null}function d3e(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}function d(e={}){return(t,r)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(t,r),s=$5(t,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in e&&ee.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=i.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=aF(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=aF(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){this._override(r,p)}:function(p){pF(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=p3e(o):a&&(Array.isArray(a)?s.cast=CO(Op(a[0])):s.cast=Op(a))),e3e(s,e),e.range&&(s.cast=f3e(s.cast,e.range))}}function jde(e,t,r){const i=$5(e,r);i.json||(i.json={});let s=i.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function p3e(e){let t=0,r=e;if(pRe(e))return _de(e);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],t++;const i=r;if(yde(i))return t===0?XB(i):iF(XB(i),t);if(t===1)return hRe(i);if(t>1)return dRe(i,t);const s=e;return s.from?s.from:Us(s)}function f3e(e,t){return r=>{let i=+e(r);return t.step!=null&&(i=Math.round(i/t.step)*t.step),t.min!=null&&(i=Math.max(t.min,i)),t.max!=null&&(i=Math.min(t.max,i)),i}}function m3e(e){if(e.json&&e.json.origins){const t=e.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(t[i]){const s=t[i];r[i].forEach(n=>{t[n]=s}),delete t[i]}}}class Uu extends O5{constructor(t,r,i){if(super(t,r,i),!(this instanceof Uu))return new Uu(t,r,i)}}Uu.prototype.type="warning";function Hde(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const cz=ee.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function $K(e,t,r){var i,s;e&&(!r&&!t.read||((i=t.read)==null?void 0:i.reader)||((s=t.read)==null?void 0:s.enabled)===!1||_3e(e)&&ol("read.reader",Pv(e),t))}function Pv(e){var r,i,s;const t=(r=e.ndimArray)!=null?r:0;if(t>1)return y3e(e);if(t===1)return LK(e);if("type"in e&&Wde(e.type)){const n=(s=(i=e.type.prototype)==null?void 0:i.itemType)==null?void 0:s.Type,o=LK(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return FW(e)}function FW(e){return"type"in e?g3e(e.type):v3e(e.types)}function g3e(e){return e.prototype.read?(t,r,i)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void cz.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,i),n}:e.fromJSON}function qde(e,t,r,i){return i!==0&&Array.isArray(t)?t.map(s=>qde(e,s,r,i-1)):e(t,void 0,r)}function y3e(e){var s;const t=FW(e),r=qde.bind(null,t),i=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=r(n,a,i);let l=i,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function LK(e){const t=FW(e);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(r,void 0,s);return n!==void 0?[n]:void 0}}function Wde(e){if(!Hde(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?UW(t.Type):Xde(t.Type))}function _3e(e){return"types"in e?Xde(e.types):UW(e.type)}function UW(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||Wde(e))}function Xde(e){for(const t in e.typeMap)if(!UW(e.typeMap[t]))return!1;return!0}function v3e(e){var i;let t=null;const r=(i=e.errorContext)!=null?i:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void cz.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=b3e(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new Uu(`${r}:unsupported`,f,{definition:s,context:o})),void cz.error(f)}const p=new h;return p.read(s,o),p}}function b3e(e){var r,i;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=sP(n.prototype);if(typeof e.key=="function")continue;const a=o[e.key];if(!a)continue;((r=a.json)==null?void 0:r.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function w3e(e){if(e.json||(e.json={}),NK(e.json),FK(e.json),DK(e.json),e.json.origins)for(const t in e.json.origins)NK(e.json.origins[t]),FK(e.json.origins[t]),DK(e.json.origins[t]);return!0}function DK(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function NK(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function FK(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}function UK(e,t){var i;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const r=(i=e==null?void 0:e.ndimArray)!=null?i:0;e&&(r===1||"type"in e&&Hde(e.type))?t.write.writer=S3e:r>1?t.write.writer=E3e(r):t.types?Array.isArray(t.types)?t.write.writer=T3e(t.types[0]):t.write.writer=x3e(t.types):t.write.writer=RO}function x3e(e){return(t,r,i,s)=>t?Yde(t,e,s)?RO(t,r,i,s):void 0:RO(t,r,i,s)}function Yde(e,t,r){var i,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(r!=null&&r.messages){const n=(i=t.errorContext)!=null?i:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;r&&r.messages&&e&&r.messages.push(new j(`${n}:unsupported`,o,{definition:e,context:r})),ee.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(o)}return!1}function T3e(e){return(t,r,i,s)=>!t||!Array.isArray(t)?RO(t,r,i,s):RO(t.filter(n=>Yde(n,e,s)),r,i,s)}function RO(e,t,r,i){ol(r,fF(e,i),t)}function fF(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?mF(e):e}function mF(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function S3e(e,t,r,i){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>fF(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[fF(e,i)],ol(r,s,t)}function Zde(e,t,r){return r!==0&&Array.isArray(e)?e.map(i=>Zde(i,t,r-1)):fF(e,t)}function E3e(e){return(t,r,i,s)=>{let n;if(t===null)n=null;else{n=Zde(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}ol(i,n,r)}}function uz(e,t){return kW(e,"read",t)}function Jde(e,t){return kW(e,"write",t)}function kW(e,t,r){let i=e&&e.json;if(e&&e.json&&e.json.origins&&r){const s=r.origin&&e.json.origins[r.origin];s&&(t==="any"||t in s)&&(i=s)}return i}function C3e(e){const t=A3e(e);if(e.json.origins)for(const r in e.json.origins){const i=e.json.origins[r],s=i.types?R3e(i):t;$K(s,i,!1),i.types&&!i.write&&e.json.write&&e.json.write.enabled&&(i.write={...e.json.write}),UK(s,i)}$K(t,e.json,!0),UK(t,e.json)}function A3e(e){return e.json.types?hz(e.json):e.type?Qde(e):hz(e)}function R3e(e){return e.type?Qde(e):hz(e)}function Qde(e){if(!e.type)return;let t=0,r=e.type;for(;Array.isArray(r)&&!yde(r);)r=r[0],t++;return{type:r,ndimArray:t}}function hz(e){if(!e.types)return;let t=0,r=e.types;for(;Array.isArray(r);)r=r[0],t++;return{types:r,ndimArray:t}}function O3e(e){w3e(e)&&(m3e(e),C3e(e))}const N8=new Set,F8=new Set;function P(e){return t=>{t.prototype.declaredClass=e,P3e(t);const r=[],i=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!N8.has(s.initialize)&&(N8.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!F8.has(s.destroy)&&(F8.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);N8.clear(),F8.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[zde];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let h=0;h<i.length;h++)i[h].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=sP(t.prototype),n.prototype.declaredClass=e,n}}function M3e(e,t){return t.get==null?function(){const r=this.__accessor__.properties.get(e);if(r===void 0)return;vr(r.observerObject);const i=this.__accessor__.store;return i.has(e)?i.get(e):r.metadata.value}:function(){const r=this.__accessor__.properties.get(e);if(r!==void 0)return r.getComputed()}}function P3e(e){const t=e.prototype,r=sP(t),i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];O3e(n),i[s]={enumerable:!0,configurable:!0,get:M3e(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===Gg.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,i)}var Kde,epe;function I3e(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const P1=Symbol("Accessor-Handles"),dz=Symbol("Accessor-Initialized");class Te{static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}sP(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:t[a]}for(const a in r){const l=I3e(r[a]);d(l)(o.prototype,a)}return P(i)(o)}constructor(...t){if(this[Kde]=null,this[epe]=!1,this.constructor===Te)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new l3e(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}postscript(t){const r=this.__accessor__,i=r.ctorArgs||t;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[dz]=!0}initialize(){}[zde](){this[P1]=Ve(this[P1])}destroy(){this.destroyed||(BRe(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[dz]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return aF(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,r){return pF(this,t,r),this}watch(t,r,i){return qRe(this,t,r,i)}own(t){this.addHandles(t)}addHandles(t,r){let i=this[P1];E(i)&&(i=this[P1]=new Jr),i.add(t,r)}removeHandles(t){const r=this[P1];E(r)||r.remove(t)}hasHandles(t){const r=this[P1];return!!v(r)&&r.has(t)}_override(t,r){r===void 0?this.__accessor__.clearOverride(t):this.__accessor__.override(t,r)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_overrideIfSome(t,r){r==null?this.__accessor__.clearOverride(t):this.__accessor__.override(t,r)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,r){return this.__accessor__.internalSet(t,r),this}}Kde=P1,epe=dz;const Ss=e=>{let t=class extends e{clone(){var l;const r=Ul(al(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const c in i){const h=i[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==Hr.USER&&p!==Hr.DEFAULTS&&p!==Hr.WEB_MAP&&p!==Hr.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof f=="function"?f(m):f==="reference"?m:qB(m),m!=null&&y==null||(p===Hr.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=al(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Hr.DEFAULTS)}return a}};return t=u([P("esri.core.Clonable")],t),t};let kK=class extends Ss(Te){};kK=u([P("esri.core.Clonable")],kK);class hv{constructor(t,r){this.min=t,this.max=r,this.range=r-t}ndiff(t,r=0){return Math.ceil((t-r)/this.range)*this.range+r}_normalize(t,r,i,s=0,n=!1){return(i-=s)<t?i+=this.ndiff(t-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=t),i+s}normalize(t,r=0,i=!1){return this._normalize(this.min,this.max,t,r,i)}clamp(t,r=0){return ye(t-r,this.min,this.max)+r}monotonic(t,r,i){return t<r?r:r+this.ndiff(t-r,i)}minimalMonotonic(t,r,i){return this._normalize(t,t+this.range,r,i)}center(t,r,i){return r=this.monotonic(t,r,i),this.normalize((t+r)/2,i)}diff(t,r,i){return this.monotonic(t,r,i)-t}shortestSignedDiff(t,r){t=this.normalize(t);const i=(r=this.normalize(r))-t,s=r<t?this.minimalMonotonic(t,r)-t:r-this.minimalMonotonic(r,t);return Math.abs(i)<Math.abs(s)?i:s}contains(t,r,i){return r=this.minimalMonotonic(t,r),(i=this.minimalMonotonic(t,i))>t&&i<r}}function VW(e){for(const t in e){const r=e[t];r instanceof Function&&(e[t]=r.bind(e))}return e}const $3e=VW(new hv(0,2*Math.PI)),dv=VW(new hv(-Math.PI,Math.PI)),BW=VW(new hv(0,360));class zW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new zW;return this._values.forEach((i,s)=>{t&&t.has(s)||r.set(s,re(i.value),i.origin)}),r}get(t,r){r=this._normalizeOrigin(r);const i=this._values.get(t);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(t){var r,i;return(i=(r=this._values.get(t))==null?void 0:r.origin)!=null?i:Hr.USER}keys(t){t=this._normalizeOrigin(t);const r=[...this._values.keys()];return t==null?r:r.filter(i=>{var s;return((s=this._values.get(i))==null?void 0:s.origin)===t})}set(t,r,i){if((i=this._normalizeOrigin(i))===Hr.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(t,new L3e(r,i))}delete(t,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(t))==null?void 0:i.origin)!==r||this._values.delete(t)}has(t,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(t))==null?void 0:i.origin)===r:this._values.has(t)}forEach(t){this._values.forEach(({value:r},i)=>t(r,i))}_normalizeOrigin(t){if(t!=null)return t===Hr.DEFAULTS?t:Hr.USER}}class L3e{constructor(t,r){this.value=t,this.origin=r}}function tpe(e,t,r){t.keys().forEach(s=>{r.set(s,t.get(s),Hr.DEFAULTS)});const i=e.metadatas;Object.keys(i).forEach(s=>{e.internalGet(s)&&r.set(s,e.internalGet(s),Hr.DEFAULTS)})}function D3e(e,t,r){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const i=e.read.source;if(typeof i=="string"){if(i===t||i.includes(".")&&i.indexOf(t)===0&&EK(i,r))return!0}else for(const s of i)if(s===t||s.includes(".")&&s.indexOf(t)===0&&EK(s,r))return!0;return!1}function N3e(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function F3e(e,t,r,i,s){let n=uz(t[r],s);N3e(n)&&(e[r]=!0);for(const o of Object.getOwnPropertyNames(t))n=uz(t[o],s),D3e(n,r,i)&&(e[o]=!0)}function U3e(e,t,r,i){const s=r.metadatas,n=kW(s[t],"any",i),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,i):o;a!==void 0&&r.set(t,a)}const rpe={origin:"service"};function ipe(e,t,r=rpe){if(!t||typeof t!="object")return;const i=al(e),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))F3e(n,s,o,t,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=uz(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?iP(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||U3e(e,o,i,r)}i.setDefaultOrigin("user")}function spe(e,t,r,i=rpe){var n;const s={...i,messages:[]};r(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?i&&i.messages&&i.messages.push(o):e.loadWarnings.push(o)})}function k3e(e,t,r,i,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,i,n,r,s),n}function npe(e,t,r,i,s,n){if(!i||!i.write)return!1;const o=e.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(e,o,r,n);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new j("web-document-write:property-required",`Missing value for required property '${r}' on '${e.declaredClass}'`,{propertyName:r,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&ee.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(r)===Hr.DEFAULTS)&&V3e(e,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(r)<P_(n.origin))}function V3e(e,t,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,r);return dy(o,s)}return!1}return n===s}function B3e(e,t,r,i){const s=al(e),n=s.metadatas,o=Jde(n[t],i);return!!o&&npe(e,s,t,o,r,i)}function ope(e,t,r){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return rD(t,e.toJSON(r));const i=al(e),s=i.metadatas;for(const a in s){const l=Jde(s[a],r);if(!npe(e,i,a,l,void 0,r))continue;const c=e.get(a),h=k3e(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(h).length>0&&(t=rD(t,h),(o=(n=r==null?void 0:r.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>rD(t,h,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:e,propName:a,oldOrigin:n3e(i.store.originOf(a)),newOrigin:r.origin}))}return t}const nP=e=>{let t=class extends e{constructor(...r){super(...r);const i=al(this),s=i.store,n=new zW;i.store=n,tpe(i,s,n)}read(r,i){ipe(this,r,i)}write(r={},i){return ope(this,r,i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return z3e.call(this,r,i)}};return t=u([P("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function z3e(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(e,t),r}let fe=class extends nP(Te){};fe=u([P("esri.core.JSONSupport")],fe);const G3e=Object.prototype.toString;function j3e(e){const t="__accessorMetadata__"in e?Us(e):e;return function(...r){if(r.push(t),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return H3e.apply(this,r)}}function H3e(e,t,r,i){$5(e,t).cast=i}function q3e(e){return(t,r)=>{$5(t,e).cast=t[r]}}function zt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&G3e.call(e[0])==="[object Function]"?j3e(e[0]):e.length===1&&typeof e[0]=="string"?q3e(e[0]):void 0}function De(e,t,r){let i,s;return t===void 0||Array.isArray(t)?(s=e,r=t,i=[void 0]):(s=t,i=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=jde(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}function Be(e,t,r){let i,s;return t===void 0?(s=e,i=[void 0]):typeof t!="string"?(s=e,i=[void 0],r=t):(s=t,i=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=jde(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}class Vr{constructor(t,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=t,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&ol(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(t==null)return null;if(this._apiToJSON.hasOwnProperty(t)){const r=this._apiToJSON[t];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:t}fromJSON(t){return t!=null&&this._jsonToAPI.hasOwnProperty(t)?this._jsonToAPI[t]:this._options.ignoreUnknown?void 0:t}_invertMap(t){const r={};for(const i in t)r[t[i]]=i;return r}_getKeysSorted(t){const r=[];for(const i in t)r.push(i);return r.sort(),r}}function Ia(){return function(e,t){return new Vr(e,{ignoreUnknown:!0,...t})}}class GW{constructor(t,r,i,s){this.semiMajorAxis=t,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const br=new GW(6378137,1/298.257223563,3e5,.006694379990137799),nm=new GW(3396190,1/169.8944472236118,23e4),fy=new GW(1737400,0,0);var Uh;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(Uh||(Uh={}));let g;const D={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)D[g]=0;for(g=2056;g<=2065;g++)D[g]=0;for(g=2067;g<=2135;g++)D[g]=0;for(g=2137;g<=2154;g++)D[g]=0;for(g=2161;g<=2170;g++)D[g]=0;for(g=2172;g<=2193;g++)D[g]=0;for(g=2195;g<=2198;g++)D[g]=0;for(g=2200;g<=2203;g++)D[g]=0;for(g=2205;g<=2217;g++)D[g]=0;for(g=2222;g<=2224;g++)D[g]=1;for(g=2225;g<=2250;g++)D[g]=2;for(g=2251;g<=2253;g++)D[g]=1;for(g=2257;g<=2264;g++)D[g]=2;for(g=2274;g<=2279;g++)D[g]=2;for(g=2280;g<=2282;g++)D[g]=1;for(g=2283;g<=2289;g++)D[g]=2;for(g=2290;g<=2292;g++)D[g]=0;for(g=2308;g<=2313;g++)D[g]=0;for(g=2315;g<=2491;g++)D[g]=0;for(g=2494;g<=2866;g++)D[g]=0;for(g=2867;g<=2869;g++)D[g]=1;for(g=2870;g<=2888;g++)D[g]=2;for(g=2891;g<=2895;g++)D[g]=2;for(g=2896;g<=2898;g++)D[g]=1;for(g=2902;g<=2908;g++)D[g]=2;for(g=2915;g<=2920;g++)D[g]=2;for(g=2921;g<=2923;g++)D[g]=1;for(g=2924;g<=2930;g++)D[g]=2;for(g=2931;g<=2962;g++)D[g]=0;for(g=2964;g<=2968;g++)D[g]=2;for(g=2969;g<=2973;g++)D[g]=0;for(g=2975;g<=2991;g++)D[g]=0;for(g=2995;g<=3051;g++)D[g]=0;for(g=3054;g<=3079;g++)D[g]=0;for(g=3081;g<=3088;g++)D[g]=0;for(g=3092;g<=3101;g++)D[g]=0;for(g=3106;g<=3138;g++)D[g]=0;for(g=3146;g<=3151;g++)D[g]=0;for(g=3153;g<=3166;g++)D[g]=0;for(g=3168;g<=3172;g++)D[g]=0;for(g=3174;g<=3203;g++)D[g]=0;for(g=3294;g<=3358;g++)D[g]=0;for(g=3367;g<=3403;g++)D[g]=0;for(g=3408;g<=3416;g++)D[g]=0;for(g=3417;g<=3438;g++)D[g]=2;for(g=3441;g<=3446;g++)D[g]=2;for(g=3447;g<=3450;g++)D[g]=0;for(g=3451;g<=3459;g++)D[g]=2;for(g=3460;g<=3478;g++)D[g]=0;for(g=3554;g<=3559;g++)D[g]=0;for(g=3560;g<=3570;g++)D[g]=2;for(g=3571;g<=3581;g++)D[g]=0;for(g=3594;g<=3597;g++)D[g]=0;for(g=3601;g<=3604;g++)D[g]=0;for(g=3637;g<=3639;g++)D[g]=0;for(g=3665;g<=3667;g++)D[g]=0;for(g=3693;g<=3695;g++)D[g]=0;for(g=3701;g<=3727;g++)D[g]=0;for(g=3728;g<=3739;g++)D[g]=2;for(g=3740;g<=3751;g++)D[g]=0;for(g=3753;g<=3760;g++)D[g]=2;for(g=3761;g<=3773;g++)D[g]=0;for(g=3775;g<=3777;g++)D[g]=0;for(g=3779;g<=3781;g++)D[g]=0;for(g=3783;g<=3785;g++)D[g]=0;for(g=3788;g<=3791;g++)D[g]=0;for(g=3797;g<=3802;g++)D[g]=0;for(g=3814;g<=3816;g++)D[g]=0;for(g=3825;g<=3829;g++)D[g]=0;for(g=3832;g<=3841;g++)D[g]=0;for(g=3844;g<=3852;g++)D[g]=0;for(g=3873;g<=3885;g++)D[g]=0;for(g=3890;g<=3893;g++)D[g]=0;for(g=3907;g<=3912;g++)D[g]=0;for(g=3942;g<=3950;g++)D[g]=0;for(g=3968;g<=3970;g++)D[g]=0;for(g=3973;g<=3976;g++)D[g]=0;for(g=3986;g<=3989;g++)D[g]=0;for(g=3994;g<=3997;g++)D[g]=0;for(g=4048;g<=4051;g++)D[g]=0;for(g=4056;g<=4063;g++)D[g]=0;for(g=4093;g<=4096;g++)D[g]=0;for(g=4390;g<=4398;g++)D[g]=0;for(g=4399;g<=4413;g++)D[g]=2;for(g=4418;g<=4433;g++)D[g]=2;for(g=4455;g<=4457;g++)D[g]=2;for(g=4484;g<=4489;g++)D[g]=0;for(g=4491;g<=4554;g++)D[g]=0;for(g=4568;g<=4589;g++)D[g]=0;for(g=4652;g<=4656;g++)D[g]=0;for(g=4766;g<=4800;g++)D[g]=0;for(g=5014;g<=5016;g++)D[g]=0;for(g=5069;g<=5072;g++)D[g]=0;for(g=5105;g<=5130;g++)D[g]=0;for(g=5173;g<=5188;g++)D[g]=0;for(g=5253;g<=5259;g++)D[g]=0;for(g=5269;g<=5275;g++)D[g]=0;for(g=5292;g<=5311;g++)D[g]=0;for(g=5329;g<=5331;g++)D[g]=0;for(g=5343;g<=5349;g++)D[g]=0;for(g=5355;g<=5357;g++)D[g]=0;for(g=5387;g<=5389;g++)D[g]=0;for(g=5459;g<=5463;g++)D[g]=0;for(g=5479;g<=5482;g++)D[g]=0;for(g=5518;g<=5520;g++)D[g]=0;for(g=5530;g<=5539;g++)D[g]=0;for(g=5550;g<=5552;g++)D[g]=0;for(g=5562;g<=5583;g++)D[g]=0;for(g=5623;g<=5625;g++)D[g]=2;for(g=5631;g<=5639;g++)D[g]=0;for(g=5649;g<=5653;g++)D[g]=0;for(g=5663;g<=5680;g++)D[g]=0;for(g=5682;g<=5685;g++)D[g]=0;for(g=5875;g<=5877;g++)D[g]=0;for(g=5896;g<=5899;g++)D[g]=0;for(g=5921;g<=5940;g++)D[g]=0;for(g=6050;g<=6125;g++)D[g]=0;for(g=6244;g<=6275;g++)D[g]=0;for(g=6328;g<=6348;g++)D[g]=0;for(g=6350;g<=6356;g++)D[g]=0;for(g=6366;g<=6372;g++)D[g]=0;for(g=6381;g<=6387;g++)D[g]=0;for(g=6393;g<=6404;g++)D[g]=0;for(g=6480;g<=6483;g++)D[g]=0;for(g=6511;g<=6514;g++)D[g]=0;for(g=6579;g<=6581;g++)D[g]=0;for(g=6619;g<=6624;g++)D[g]=0;for(g=6625;g<=6627;g++)D[g]=2;for(g=6628;g<=6632;g++)D[g]=0;for(g=6634;g<=6637;g++)D[g]=0;for(g=6669;g<=6692;g++)D[g]=0;for(g=6707;g<=6709;g++)D[g]=0;for(g=6720;g<=6723;g++)D[g]=0;for(g=6732;g<=6738;g++)D[g]=0;for(g=6931;g<=6933;g++)D[g]=0;for(g=6956;g<=6959;g++)D[g]=0;for(g=7005;g<=7007;g++)D[g]=0;for(g=7057;g<=7070;g++)D[g]=2;for(g=7074;g<=7082;g++)D[g]=0;for(g=7109;g<=7118;g++)D[g]=0;for(g=7119;g<=7127;g++)D[g]=1;for(g=7374;g<=7376;g++)D[g]=0;for(g=7528;g<=7586;g++)D[g]=0;for(g=7587;g<=7645;g++)D[g]=2;for(g=7692;g<=7696;g++)D[g]=0;for(g=7755;g<=7787;g++)D[g]=0;for(g=7791;g<=7795;g++)D[g]=0;for(g=7799;g<=7801;g++)D[g]=0;for(g=7803;g<=7805;g++)D[g]=0;for(g=7825;g<=7831;g++)D[g]=0;for(g=7845;g<=7859;g++)D[g]=0;for(g=8013;g<=8032;g++)D[g]=0;for(g=8065;g<=8068;g++)D[g]=1;for(g=8518;g<=8529;g++)D[g]=2;for(g=8533;g<=8536;g++)D[g]=2;for(g=8538;g<=8540;g++)D[g]=2;for(g=8677;g<=8679;g++)D[g]=0;for(g=8836;g<=8840;g++)D[g]=0;for(g=8857;g<=8859;g++)D[g]=0;for(g=8908;g<=8910;g++)D[g]=0;for(g=9154;g<=9159;g++)D[g]=0;for(g=9205;g<=9218;g++)D[g]=0;for(g=9271;g<=9273;g++)D[g]=0;for(g=9295;g<=9297;g++)D[g]=0;for(g=9356;g<=9360;g++)D[g]=0;for(g=9404;g<=9407;g++)D[g]=0;for(g=9476;g<=9482;g++)D[g]=0;for(g=9487;g<=9494;g++)D[g]=0;for(g=9697;g<=9699;g++)D[g]=0;for(g=9821;g<=9865;g++)D[g]=0;for(g=20002;g<=20032;g++)D[g]=0;for(g=20047;g<=20049;g++)D[g]=0;for(g=20062;g<=20092;g++)D[g]=0;for(g=20135;g<=20138;g++)D[g]=0;for(g=20248;g<=20258;g++)D[g]=0;for(g=20348;g<=20358;g++)D[g]=0;for(g=20436;g<=20440;g++)D[g]=0;for(g=20822;g<=20824;g++)D[g]=0;for(g=20904;g<=20932;g++)D[g]=0;for(g=20934;g<=20936;g++)D[g]=0;for(g=21004;g<=21032;g++)D[g]=0;for(g=21035;g<=21037;g++)D[g]=0;for(g=21095;g<=21097;g++)D[g]=0;for(g=21148;g<=21150;g++)D[g]=0;for(g=21207;g<=21264;g++)D[g]=0;for(g=21307;g<=21364;g++)D[g]=0;for(g=21413;g<=21423;g++)D[g]=0;for(g=21453;g<=21463;g++)D[g]=0;for(g=21473;g<=21483;g++)D[g]=0;for(g=21780;g<=21782;g++)D[g]=0;for(g=21891;g<=21894;g++)D[g]=0;for(g=21896;g<=21899;g++)D[g]=0;for(g=22171;g<=22177;g++)D[g]=0;for(g=22181;g<=22187;g++)D[g]=0;for(g=22191;g<=22197;g++)D[g]=0;for(g=22207;g<=22222;g++)D[g]=0;for(g=22234;g<=22236;g++)D[g]=0;for(g=22243;g<=22250;g++)D[g]=0;for(g=22262;g<=22265;g++)D[g]=0;for(g=22307;g<=22322;g++)D[g]=0;for(g=22348;g<=22357;g++)D[g]=0;for(g=22407;g<=22422;g++)D[g]=0;for(g=22462;g<=22465;g++)D[g]=0;for(g=22521;g<=22525;g++)D[g]=0;for(g=22607;g<=22622;g++)D[g]=0;for(g=22641;g<=22646;g++)D[g]=0;for(g=22648;g<=22657;g++)D[g]=0;for(g=22707;g<=22722;g++)D[g]=0;for(g=22762;g<=22765;g++)D[g]=0;for(g=22991;g<=22994;g++)D[g]=0;for(g=23028;g<=23038;g++)D[g]=0;for(g=23830;g<=23853;g++)D[g]=0;for(g=23866;g<=23872;g++)D[g]=0;for(g=23877;g<=23884;g++)D[g]=0;for(g=23886;g<=23894;g++)D[g]=0;for(g=23946;g<=23948;g++)D[g]=0;for(g=24311;g<=24313;g++)D[g]=0;for(g=24342;g<=24347;g++)D[g]=0;for(g=24370;g<=24374;g++)D[g]=10;for(g=24375;g<=24381;g++)D[g]=0;for(g=24718;g<=24721;g++)D[g]=0;for(g=24817;g<=24821;g++)D[g]=0;for(g=24877;g<=24882;g++)D[g]=0;for(g=24891;g<=24893;g++)D[g]=0;for(g=25391;g<=25395;g++)D[g]=0;for(g=25828;g<=25838;g++)D[g]=0;for(g=26191;g<=26195;g++)D[g]=0;for(g=26391;g<=26393;g++)D[g]=0;for(g=26701;g<=26722;g++)D[g]=0;for(g=26729;g<=26799;g++)D[g]=2;for(g=26801;g<=26803;g++)D[g]=2;for(g=26811;g<=26813;g++)D[g]=2;for(g=26847;g<=26870;g++)D[g]=2;for(g=26891;g<=26899;g++)D[g]=0;for(g=26901;g<=26923;g++)D[g]=0;for(g=26929;g<=26946;g++)D[g]=0;for(g=26948;g<=26998;g++)D[g]=0;for(g=27037;g<=27040;g++)D[g]=0;for(g=27205;g<=27232;g++)D[g]=0;for(g=27258;g<=27260;g++)D[g]=0;for(g=27391;g<=27398;g++)D[g]=0;for(g=27561;g<=27564;g++)D[g]=0;for(g=27571;g<=27574;g++)D[g]=0;for(g=27581;g<=27584;g++)D[g]=0;for(g=27591;g<=27594;g++)D[g]=0;for(g=28191;g<=28193;g++)D[g]=0;for(g=28348;g<=28358;g++)D[g]=0;for(g=28402;g<=28432;g++)D[g]=0;for(g=28462;g<=28492;g++)D[g]=0;for(g=29118;g<=29122;g++)D[g]=0;for(g=29168;g<=29172;g++)D[g]=0;for(g=29177;g<=29185;g++)D[g]=0;for(g=29187;g<=29195;g++)D[g]=0;for(g=29900;g<=29903;g++)D[g]=0;for(g=30161;g<=30179;g++)D[g]=0;for(g=30491;g<=30494;g++)D[g]=0;for(g=30729;g<=30732;g++)D[g]=0;for(g=31251;g<=31259;g++)D[g]=0;for(g=31265;g<=31268;g++)D[g]=0;for(g=31275;g<=31279;g++)D[g]=0;for(g=31281;g<=31297;g++)D[g]=0;for(g=31461;g<=31469;g++)D[g]=0;for(g=31491;g<=31495;g++)D[g]=0;for(g=31917;g<=31922;g++)D[g]=0;for(g=31965;g<=32e3;g++)D[g]=0;for(g=32001;g<=32003;g++)D[g]=2;for(g=32005;g<=32031;g++)D[g]=2;for(g=32033;g<=32060;g++)D[g]=2;for(g=32064;g<=32067;g++)D[g]=2;for(g=32074;g<=32077;g++)D[g]=2;for(g=32081;g<=32086;g++)D[g]=0;for(g=32107;g<=32130;g++)D[g]=0;for(g=32133;g<=32159;g++)D[g]=0;for(g=32164;g<=32167;g++)D[g]=2;for(g=32180;g<=32199;g++)D[g]=0;for(g=32201;g<=32260;g++)D[g]=0;for(g=32301;g<=32360;g++)D[g]=0;for(g=32601;g<=32662;g++)D[g]=0;for(g=32664;g<=32667;g++)D[g]=2;for(g=32701;g<=32761;g++)D[g]=0;for(g=53001;g<=53004;g++)D[g]=0;for(g=53008;g<=53019;g++)D[g]=0;for(g=53021;g<=53032;g++)D[g]=0;for(g=53034;g<=53037;g++)D[g]=0;for(g=53042;g<=53046;g++)D[g]=0;for(g=53074;g<=53080;g++)D[g]=0;for(g=54001;g<=54004;g++)D[g]=0;for(g=54008;g<=54019;g++)D[g]=0;for(g=54021;g<=54032;g++)D[g]=0;for(g=54034;g<=54037;g++)D[g]=0;for(g=54042;g<=54046;g++)D[g]=0;for(g=54048;g<=54053;g++)D[g]=0;for(g=54074;g<=54080;g++)D[g]=0;for(g=54098;g<=54101;g++)D[g]=0;for(g=102001;g<=102040;g++)D[g]=0;for(g=102042;g<=102063;g++)D[g]=0;for(g=102065;g<=102067;g++)D[g]=0;for(g=102070;g<=102117;g++)D[g]=0;for(g=102122;g<=102216;g++)D[g]=0;for(g=102221;g<=102377;g++)D[g]=0;for(g=102382;g<=102388;g++)D[g]=0;for(g=102389;g<=102398;g++)D[g]=2;for(g=102399;g<=102444;g++)D[g]=0;for(g=102445;g<=102447;g++)D[g]=2;for(g=102448;g<=102458;g++)D[g]=0;for(g=102459;g<=102468;g++)D[g]=2;for(g=102469;g<=102499;g++)D[g]=0;for(g=102500;g<=102519;g++)D[g]=1;for(g=102520;g<=102524;g++)D[g]=0;for(g=102525;g<=102529;g++)D[g]=2;for(g=102530;g<=102588;g++)D[g]=0;for(g=102590;g<=102598;g++)D[g]=0;for(g=102601;g<=102603;g++)D[g]=0;for(g=102605;g<=102628;g++)D[g]=0;for(g=102629;g<=102646;g++)D[g]=2;for(g=102648;g<=102700;g++)D[g]=2;for(g=102701;g<=102703;g++)D[g]=0;for(g=102707;g<=102730;g++)D[g]=2;for(g=102733;g<=102758;g++)D[g]=2;for(g=102767;g<=102900;g++)D[g]=0;for(g=102901;g<=102933;g++)D[g]=2;for(g=102934;g<=102950;g++)D[g]=13;for(g=102951;g<=102955;g++)D[g]=0;for(g=102961;g<=102963;g++)D[g]=0;for(g=102965;g<=102969;g++)D[g]=0;for(g=102971;g<=102973;g++)D[g]=0;for(g=102975;g<=102989;g++)D[g]=0;for(g=102990;g<=102992;g++)D[g]=1;for(g=102997;g<=103002;g++)D[g]=0;for(g=103003;g<=103008;g++)D[g]=2;for(g=103009;g<=103011;g++)D[g]=0;for(g=103012;g<=103014;g++)D[g]=2;for(g=103019;g<=103021;g++)D[g]=0;for(g=103022;g<=103024;g++)D[g]=2;for(g=103029;g<=103031;g++)D[g]=0;for(g=103032;g<=103034;g++)D[g]=2;for(g=103065;g<=103068;g++)D[g]=0;for(g=103074;g<=103076;g++)D[g]=0;for(g=103077;g<=103079;g++)D[g]=1;for(g=103080;g<=103082;g++)D[g]=0;for(g=103083;g<=103085;g++)D[g]=2;for(g=103090;g<=103093;g++)D[g]=0;for(g=103097;g<=103099;g++)D[g]=0;for(g=103100;g<=103102;g++)D[g]=2;for(g=103107;g<=103109;g++)D[g]=0;for(g=103110;g<=103112;g++)D[g]=2;for(g=103113;g<=103116;g++)D[g]=0;for(g=103117;g<=103120;g++)D[g]=2;for(g=103153;g<=103157;g++)D[g]=0;for(g=103158;g<=103162;g++)D[g]=2;for(g=103163;g<=103165;g++)D[g]=0;for(g=103166;g<=103168;g++)D[g]=1;for(g=103169;g<=103171;g++)D[g]=2;for(g=103186;g<=103188;g++)D[g]=0;for(g=103189;g<=103191;g++)D[g]=2;for(g=103192;g<=103195;g++)D[g]=0;for(g=103196;g<=103199;g++)D[g]=2;for(g=103200;g<=103224;g++)D[g]=0;for(g=103225;g<=103227;g++)D[g]=1;for(g=103232;g<=103237;g++)D[g]=0;for(g=103238;g<=103243;g++)D[g]=2;for(g=103244;g<=103246;g++)D[g]=0;for(g=103247;g<=103249;g++)D[g]=2;for(g=103254;g<=103256;g++)D[g]=0;for(g=103257;g<=103259;g++)D[g]=2;for(g=103264;g<=103266;g++)D[g]=0;for(g=103267;g<=103269;g++)D[g]=2;for(g=103300;g<=103375;g++)D[g]=0;for(g=103381;g<=103383;g++)D[g]=0;for(g=103384;g<=103386;g++)D[g]=1;for(g=103387;g<=103389;g++)D[g]=0;for(g=103390;g<=103392;g++)D[g]=2;for(g=103397;g<=103399;g++)D[g]=0;for(g=103400;g<=103471;g++)D[g]=2;for(g=103476;g<=103478;g++)D[g]=0;for(g=103479;g<=103481;g++)D[g]=2;for(g=103486;g<=103488;g++)D[g]=0;for(g=103489;g<=103491;g++)D[g]=2;for(g=103492;g<=103495;g++)D[g]=0;for(g=103496;g<=103499;g++)D[g]=2;for(g=103528;g<=103543;g++)D[g]=0;for(g=103544;g<=103548;g++)D[g]=2;for(g=103549;g<=103551;g++)D[g]=0;for(g=103552;g<=103554;g++)D[g]=1;for(g=103555;g<=103557;g++)D[g]=2;for(g=103558;g<=103560;g++)D[g]=0;for(g=103571;g<=103573;g++)D[g]=0;for(g=103574;g<=103576;g++)D[g]=2;for(g=103577;g<=103580;g++)D[g]=0;for(g=103581;g<=103583;g++)D[g]=2;for(g=103595;g<=103694;g++)D[g]=0;for(g=103696;g<=103699;g++)D[g]=0;for(g=103700;g<=103793;g++)D[g]=2;for(g=103794;g<=103890;g++)D[g]=0;for(g=103891;g<=103896;g++)D[g]=2;for(g=103900;g<=103971;g++)D[g]=2;for(g=103972;g<=103977;g++)D[g]=0;for(g=112e3;g<=112101;g++)D[g]=0;const W3e={102113:!0,102100:!0,3857:!0,3785:!0},X3e={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},VK='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',fI=[-20037508342788905e-9,20037508342788905e-9],mI=[-20037508342787e-6,20037508342787e-6],ape={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:fI,origin:mI,dx:1e-5},102100:{wkTemplate:VK,valid:fI,origin:mI,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:fI,origin:mI,dx:1e-5},3857:{wkTemplate:VK,valid:fI,origin:mI,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Pn(e,t){return e===t||!E(e)&&!E(t)&&(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||Aw(e)&&Aw(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase())}function Z_(e){return Ta(e)&&e.wkid&&ape[e.wkid]||null}function lpe(e){return!!Ta(e)&&(e.wkid?D[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function sE(e){return!(Om(e)||Mm(e))}function OO(e){return Ta(e)&&e.wkid===4326}function cpe(e){return Ta(e)&&e.wkid===Uh.CGCS2000}function Aw(e){return Ta(e)&&e.wkid!=null&&W3e[e.wkid]===!0}function jW(e){return Ta(e)&&e.wkid===32662}function HW(e){return e===Uh.GCSMARS2000||e===Uh.GCSMARS2000_SPHERE}function Om(e){return Ta(e)&&e.wkid!=null&&HW(e.wkid)}function qW(e){return e===Uh.GCSMOON2000}function Mm(e){return Ta(e)&&e.wkid!=null&&qW(e.wkid)}function Y3e(e){return Ta(e)&&e.wkid!=null&&X3e[e.wkid]===!0}function Ta(e){return v(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const Z3e={wkid:4326,wkt:mm(ape[4326].wkTemplate,{Central_Meridian:"0.0"})},J3e={wkid:102100,latestWkid:3857},Q3e={wkid:32662};function WW(e){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const upe=WW(br),XW=WW(nm),YW=WW(fy),hpe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${br.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Zr(e){return v(e)&&(Om(e)||Pn(e,XW))?nm:v(e)&&(Mm(e)||Pn(e,YW))?fy:br}function Rwt(e){return HW(e)?nm:qW(e)?fy:br}const ZW=39.37,K3e=br.radius*Math.PI/200,dpe=/UNIT\[([^\]]+)\]\]$/i,aw=D,ppe=/UNIT\[([^\]]+)\]/i,eOe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),tOe=Ia()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),jp=e=>e*e,Wy=e=>e*e*e,MO={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:jp(.001)},"square-centimeters":{inBaseUnits:jp(.01)},"square-decimeters":{inBaseUnits:jp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:jp(1e3)},"square-inches":{inBaseUnits:jp(.0254)},"square-feet":{inBaseUnits:jp(.3048)},"square-yards":{inBaseUnits:jp(.9144)},"square-miles":{inBaseUnits:jp(1609.344)},"square-us-feet":{inBaseUnits:jp(1200/3937)},acres:{inBaseUnits:.0015625*jp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*Wy(.001)},"cubic-centimeters":{inBaseUnits:1e3*Wy(.01)},"cubic-decimeters":{inBaseUnits:1e3*Wy(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*Wy(1e3)},"cubic-inches":{inBaseUnits:1e3*Wy(.0254)},"cubic-feet":{inBaseUnits:1e3*Wy(.3048)},"cubic-yards":{inBaseUnits:1e3*Wy(.9144)},"cubic-miles":{inBaseUnits:1e3*Wy(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},rOe=(()=>{const e={};for(const t in MO)for(const r in MO[t].units)e[r]=t;return e})();function iOe(e,t,r){return e*MO[r].units[t].inBaseUnits}function sOe(e,t,r){return e/MO[r].units[t].inBaseUnits}const nOe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function pz(e){const t=rOe[e];if(!t)throw new Error("unknown type");return t}function BK(e,t=null){return t=t||pz(e),MO[t].baseUnit===e}function xn(e,t,r){if(t===r)return e;const i=pz(t);if(i!==pz(r))throw new Error("incompatible units");const s=BK(t,i)?e:iOe(e,t,i);return BK(r,i)?s:sOe(s,r,i)}function Owt(e,t,r){switch(r){case"metric":return fpe(e,t);case"imperial":return gpe(e,t);default:return r}}function Mwt(e,t,r){switch(r){case"metric":return mpe(e,t);case"imperial":return ype(e,t);default:return r}}function fpe(e,t){const r=xn(e,t,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function mpe(e,t){const r=xn(e,t,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function gpe(e,t){const r=xn(e,t,"feet");return Math.abs(r)<1e3?"feet":"miles"}function ype(e,t){const r=xn(e,t,"feet");return Math.abs(r)<1e5?"feet":"miles"}function Pwt(e,t){const r=xn(e,t,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function Iwt(e,t){const r=xn(e,t,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function oOe(e,t,r){return xn(e,t,"meters")/(r*Math.PI/180)}function _pe(e){return tOe.fromJSON(e.toLowerCase())||null}function Rw(e){if(v(e)&&!sE(e))return 1;const t=ll(e);return t>1e5?1:t}function aOe(e){return ll(e)>=Zr(e).metersPerDegree?"meters":L5(e)}function ll(e,t=br.metersPerDegree){return Pt(lOe(e,!0),t)}function lOe(e,t=!1){const r=v(e)?e.wkid:null,i=v(e)?e.wkt:null;let s=null;if(r){if(HW(r))return nm.metersPerDegree;if(qW(r))return fy.metersPerDegree;s=aw.values[aw[r]],!s&&t&&eOe.has(r)&&(s=K3e)}else i&&(wpe(i)?s=zK(dpe.exec(i),s):bpe(i)&&(s=zK(ppe.exec(i),s)));return s}function zK(e,t){return e&&e[1]?vpe(e[1]):t}function vpe(e){return parseFloat(e.split(",")[1])}function L5(e){const t=v(e)?e.wkid:null,r=v(e)?e.wkt:null;let i=null;if(t)i=aw.units[aw[t]];else if(r){const s=wpe(r)?dpe:bpe(r)?ppe:null;if(s){const n=s.exec(r);n&&n[1]&&(i=uOe(n[1]))}}return v(i)?_pe(i):null}function $wt(e){const t=L5(e);return E(t)||!nOe.includes(t)?null:t}function bpe(e){return/^GEOCCS/i.test(e)}function wpe(e){return/^PROJCS/i.test(e)}const cOe=1e-7;function uOe(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let r=t&&t[1];if(!r||!aw.units.includes(r)){const i=vpe(e);r=null;const s=aw.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<cOe){r=aw.units[n];break}}return r}function Lwt(e){const t=L5(e);if(E(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const hOe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},dOe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},pOe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},fOe=Ia()(hOe),mOe=Ia()(dOe),Dwt=Ia()(pOe);var uf;let Pi=uf=class extends fe{static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return uf.WebMercator;if(e.wkid===4326)return uf.WGS84}const t=new uf;return t.read(e),t}constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return OO(this)}get isWebMercator(){return Aw(this)}get isGeographic(){return lpe(this)}get isWrappable(){return Y3e(this)}get metersPerUnit(){return ll(this)}get unit(){return L5(this)||(this.isGeographic?"degrees":null)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===uf.WGS84)return uf.WGS84;if(this===uf.WebMercator)return uf.WebMercator;const e=new uf;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=re(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:r}=e.imageCoordinateSystem,{geodataXform:i}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||i?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):r?s.id===t&&s.referenceServiceName===r:s.id===t}return Pn(this,e)}toJSON(e){return this.write(void 0,e)}};Pi.GCS_NAD_1927=null,Pi.WGS84=null,Pi.WebMercator=null,Pi.PlateCarree=null,u([d({readOnly:!0})],Pi.prototype,"isWGS84",null),u([d({readOnly:!0})],Pi.prototype,"isWebMercator",null),u([d({readOnly:!0})],Pi.prototype,"isGeographic",null),u([d({readOnly:!0})],Pi.prototype,"isWrappable",null),u([d({type:Ri,json:{write:!0}})],Pi.prototype,"latestWkid",void 0),u([d({readOnly:!0})],Pi.prototype,"metersPerUnit",null),u([d({readOnly:!0})],Pi.prototype,"unit",null),u([d({type:Ri,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Pi.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Pi.prototype,"wkt",void 0),u([Be("wkt"),Be("web-scene","wkt")],Pi.prototype,"writeWkt",null),u([d({type:Ri,json:{write:!0}})],Pi.prototype,"vcsWkid",void 0),u([d({type:Ri,json:{write:!0}})],Pi.prototype,"latestVcsWkid",void 0),u([d()],Pi.prototype,"imageCoordinateSystem",void 0),Pi=uf=u([P("esri.geometry.SpatialReference")],Pi),Pi.prototype.toJSON.isDefaultToJSON=!0,Pi.GCS_NAD_1927=new Pi({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Pi.WGS84=new Pi(Z3e),Pi.WebMercator=new Pi(J3e),Pi.PlateCarree=new Pi(Q3e),Object.freeze&&(Object.freeze(Pi.GCS_NAD_1927),Object.freeze(Pi.WGS84),Object.freeze(Pi.WebMercator));const Ye=Pi;let hf=class extends fe{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ye.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof Ye)return e;if(e!=null){const r=new Ye;return r.read(e,t),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([d()],hf.prototype,"type",void 0),u([d({readOnly:!0})],hf.prototype,"cache",null),u([d({readOnly:!0})],hf.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],hf.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],hf.prototype,"hasZ",void 0),u([d({type:Ye,json:{write:!0},value:Ye.WGS84})],hf.prototype,"spatialReference",void 0),u([De("spatialReference")],hf.prototype,"readSpatialReference",null),hf=u([P("esri.geometry.Geometry")],hf);const Iv=hf;function gOe(e,t){const r=e.x-t.x,i=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(r*r+i*i+s*s)}const yOe=57.29577951308232,_Oe=.017453292519943;function GK(e){return e*yOe}function jK(e){return e*_Oe}function HK(e){return e/br.radius}function gF(e){return Math.PI/2-2*Math.atan(Math.exp(-e/br.radius))}function fz(e){return e.wkid!=null||e.wkt!=null}const U8=[0,0];function yF(e,t,r,i,s){const n=e,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,U8,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,U8,i),[o.xmax,o.ymax]=t(n.xmax,n.ymax,U8,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],i)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function J_(e,t){const r=e&&(fz(e)?e:e.spatialReference),i=t&&(fz(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!r||!i)&&(!!Pn(i,r)||Aw(i)&&OO(r)||Aw(r)&&OO(i))}function gx(e,t){if(E(e))return null;const r=e.spatialReference,i=t&&(fz(t)?t:t.spatialReference);return J_(r,i)?Pn(r,i)?re(e):Aw(i)?yF(e,j2,Ye.WebMercator,!1,re(e)):OO(i)?yF(e,O3,Ye.WGS84,!1,re(e)):null:null}function j2(e,t,r=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const i=jK(t);return r[0]=jK(e)*br.radius,r[1]=br.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function O3(e,t,r=[0,0],i=!1){const s=GK(e/br.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=GK(Math.PI/2-2*Math.atan(Math.exp(-t/br.radius))),r}function ey(e,t=!1,r=re(e)){return yF(e,j2,Ye.WebMercator,t,r)}function H2(e,t=!1,r=re(e)){return yF(e,O3,Ye.WGS84,t,r)}var oD;const WC=[0,0];function qK(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let Sl=oD=class extends Iv{static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const r=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(e,t,r,i,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],r=n[2],i=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ye(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)ee.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)ee.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=j2(n.longitude,n.latitude,WC);e=a[0],t=a[1]}}}else qK(r)?(s=r,r=null):qK(i)&&(s=i,i=null);const o={x:e,y:t};return o.x==null&&o.y!=null?ee.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&ee.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:r}=this;if(e){if(e.isWebMercator)return O3(t,r,WC)[1];if(e.isGeographic)return r}return null}set latitude(e){const{spatialReference:t,x:r}=this;e!=null&&t&&(t.isWebMercator?this._set("y",j2(r,e,WC)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:r}=this;if(r){if(r.isWebMercator)return O3(e,t,WC)[0];if(r.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:r}=this;e!=null&&r&&(r.isWebMercator?this._set("x",j2(e,t,WC)[0]):r.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,r){t[r]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new oD;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return oD.copy(e,this),this}equals(e){if(E(e))return!1;const{x:t,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=j2(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=O3(l,c),h=n}return t===l&&r===c&&i===o&&s===a&&n.wkid===h.wkid}offset(e,t,r){var i;return this.x+=e,this.y+=t,r!=null&&(this.z=((i=this.z)!=null?i:0)+r),this}normalize(){if(!this.spatialReference)return this;const e=Z_(this.spatialReference);if(!e)return this;let t=this.x;const[r,i]=e.valid,s=2*i;let n;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s),this._set("x",t),this}distance(e){return gOe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],Sl.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Sl.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Sl.prototype,"hasZ",null),u([d({type:Number})],Sl.prototype,"latitude",null),u([d({type:Number})],Sl.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),zt(e=>isNaN(e)?e:Ph(e))],Sl.prototype,"x",void 0),u([Be("x")],Sl.prototype,"writeX",null),u([De("x")],Sl.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],Sl.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Sl.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Sl.prototype,"m",void 0),Sl=oD=u([P("esri.geometry.Point")],Sl),Sl.prototype.toJSON.isDefaultToJSON=!0;const yt=Sl;let hg=class extends Ss(fe){constructor(...e){super(...e),this.position=new yt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,r,i){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),r!=null&&(s.tilt=r),i!=null&&(s.fov=i),s}return e}writePosition(e,t,r,i){const s=e.clone();s.x=Ph(e.x||0),s.y=Ph(e.y||0),s.z=e.hasZ?Ph(e.z||0):e.z,t[r]=s.write({},i)}readPosition(e,t){const r=new yt;return r.read(e,t),r.x=Ph(r.x||0),r.y=Ph(r.y||0),r.z=r.hasZ?Ph(r.z||0):r.z,r}equals(e){return!E(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:yt,json:{write:{isRequired:!0}}})],hg.prototype,"position",void 0),u([Be("position")],hg.prototype,"writePosition",null),u([De("position")],hg.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),zt(e=>BW.normalize(Ph(e)))],hg.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),zt(e=>ye(Ph(e),-180,180))],hg.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],hg.prototype,"fov",void 0),hg=u([P("esri.Camera")],hg);const Jh=hg,k8=[0,0];function JW(e,t){return!!v(t)&&Ya(e,t.x,t.y,t.z)}function Nwt(e,t){if(!t.points||t.points.length)return!1;for(const r of t.points)if(!nE(e,r))return!1;return!0}function vOe(e,t){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?Ya(e,r,i,s)&&Ya(e,r,o,s)&&Ya(e,n,o,s)&&Ya(e,n,i,s)&&Ya(e,r,i,a)&&Ya(e,r,o,a)&&Ya(e,n,o,a)&&Ya(e,n,i,a):Ya(e,r,i)&&Ya(e,r,o)&&Ya(e,n,o)&&Ya(e,n,i)}function nE(e,t){return Ya(e,t[0],t[1])}function bOe(e,t){return Ya(e,t[0],t[1],t[2])}function Ya(e,t,r,i){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax&&(i==null||!e.hasZ||i>=e.zmin&&i<=e.zmax)}function wOe(e,t){return k8[1]=t.y,k8[0]=t.x,xOe(e,k8)}function xOe(e,t){return xpe(e.rings,t)}function xpe(e,t){if(!e)return!1;if(TOe(e))return WK(!1,e,t);let r=!1;for(let i=0,s=e.length;i<s;i++)r=WK(r,e[i],t);return r}function TOe(e){return!Array.isArray(e[0][0])}function WK(e,t,r){const[i,s]=r;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,f]=t[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<i&&(n=!n)}return n}function SOe(e,t){return JW(e,t)}function EOe(e,t){const r=e.hasZ&&t.hasZ;let i,s,n;if(e.xmin<=t.xmin){if(i=t.xmin,e.xmax<i)return!1}else if(i=e.xmin,t.xmax<i)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(r&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function COe(e,t){const{points:r,hasZ:i}=t,s=i?bOe:nE;for(const n of r)if(s(e,n))return!0;return!1}const Ow=[0,0],Mw=[0,0],Pw=[0,0],Iw=[0,0],AOe=[Ow,Mw,Pw,Iw],Tpe=[[Pw,Ow],[Ow,Mw],[Mw,Iw],[Iw,Pw]];function ROe(e,t){return OOe(e,t.rings)}function OOe(e,t){Ow[0]=e.xmin,Ow[1]=e.ymax,Mw[0]=e.xmax,Mw[1]=e.ymax,Pw[0]=e.xmin,Pw[1]=e.ymin,Iw[0]=e.xmax,Iw[1]=e.ymin;for(const r of AOe)if(xpe(t,r))return!0;for(const r of t){if(!r.length)continue;let i=r[0];if(nE(e,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(nE(e,n)||Spe(i,n,Tpe))return!0;i=n}}return!1}function MOe(e,t){Ow[0]=e.xmin,Ow[1]=e.ymax,Mw[0]=e.xmax,Mw[1]=e.ymax,Pw[0]=e.xmin,Pw[1]=e.ymin,Iw[0]=e.xmax,Iw[1]=e.ymin;const r=t.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(nE(e,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(nE(e,o)||Spe(s,o,Tpe))return!0;s=o}}return!1}const Ho=[0,0];function POe(e){for(let t=0;t<e.length;t++){const r=e[t];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(mz(n,o,c,h,Ho)&&!(Ho[0]===n[0]&&Ho[1]===n[1]||Ho[0]===c[0]&&Ho[1]===c[1]||Ho[0]===o[0]&&Ho[1]===o[1]||Ho[0]===h[0]&&Ho[1]===h[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],h=r[l+1];if(mz(o,a,c,h,Ho)&&!(Ho[0]===o[0]&&Ho[1]===o[1]||Ho[0]===c[0]&&Ho[1]===c[1]||Ho[0]===a[0]&&Ho[1]===a[1]||Ho[0]===h[0]&&Ho[1]===h[1]))return!0}}}return!1}function Spe(e,t,r){for(let i=0;i<r.length;i++)if(mz(e,t,r[i][0],r[i][1]))return!0;return!1}function mz(e,t,r,i,s){const[n,o]=e,[a,l]=t,[c,h]=r,[p,f]=i,m=p-c,y=n-c,_=a-n,b=f-h,x=o-h,T=l-o,S=b*_-m*T;if(S===0)return!1;const C=(m*x-b*y)/S,O=(_*x-T*y)/S;return C>=0&&C<=1&&O>=0&&O<=1&&(s&&(s[0]=n+C*(a-n),s[1]=o+C*(l-o)),!0)}function IOe(e){switch(e){case"esriGeometryEnvelope":case"extent":return EOe;case"esriGeometryMultipoint":case"multipoint":return COe;case"esriGeometryPoint":case"point":return SOe;case"esriGeometryPolygon":case"polygon":return ROe;case"esriGeometryPolyline":case"polyline":return MOe}}var lh;function $Oe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function Xy(e,t,r){return t==null?r:r==null?t:e(t,r)}let xo=lh=class extends Iv{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,r,i,s){return $Oe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?Ye.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:r,ymax:i,spatialReference:s!=null?s:Ye.WGS84}}static fromBounds(e,t){return new lh({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new lh({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new yt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new lh;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&J_(t,r)&&(e=t.isWebMercator?ey(e):H2(e,!0)),e.type==="point"?JW(this,e):e.type==="extent"&&vOe(this,e)}equals(e){if(this===e)return!0;if(E(e))return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&J_(t,r)&&(e=t.isWebMercator?ey(e):H2(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),r=this.width*t,i=this.height*t;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(E(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,r=e.spatialReference;return t&&r&&!Pn(t,r)&&J_(t,r)&&(e=t.isWebMercator?ey(e):H2(e,!0)),IOe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,r){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Xy(Math.min,this.zmin,e.zmin),this.zmax=Xy(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Xy(Math.min,this.mmin,e.mmin),this.mmax=Xy(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:E(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Xy(Math.max,this.zmin,e.zmin),this.zmax=Xy(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Xy(Math.max,this.mmin,e.mmin),this.mmax=Xy(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=Z_(this.spatialReference)){var i;if(!e||!this.spatialReference)return this;const t=this.spatialReference,r=this._getCM(e);if(r){const s=t.isWebMercator?H2(r):r;this.xmin-=r.x,this.xmax-=r.x,t.isWebMercator||(s.x=this._normalizeX(s.x,e).x),this.spatialReference=new Ye(mm((i=t.isWGS84?e.altTemplate:null)!=null?i:e.wkTemplate,{Central_Meridian:s.x}))}return this}_getCM(e){let t=null;const[r,i]=e.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(t=this.center),t}_normalize(e,t,r){const i=this.spatialReference;if(!i)return this;const s=r!=null?r:Z_(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return e?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(e)return this._shiftCM(s);if(t)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const h=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}if(a){const h=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(h)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||Z_(o);const[p,f]=e.valid;h=this._normalizeX(this.xmin,e);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,e);const _=h.x,b=h.frameId,x=m===_&&a>0;if(a>2*f){const T=new lh(l<c?m:_,s,f,n,o),S=new lh(p,s,l<c?_:m,n,o),C=new lh(0,s,f,n,o),O=new lh(p,s,0,n,o),R=[],$=[];T.contains(C)&&R.push(y),T.contains(O)&&$.push(y),S.contains(C)&&R.push(b),S.contains(O)&&$.push(b);for(let I=y+1;I<b;I++)R.push(I),$.push(I);t.push({extent:T,frameIds:[y]},{extent:S,frameIds:[b]},{extent:C,frameIds:R},{extent:O,frameIds:$})}else m>_||x?t.push({extent:new lh(m,s,f,n,o),frameIds:[y]},{extent:new lh(p,s,_,n,o),frameIds:[b]}):t.push({extent:new lh(m,s,_,n,o),frameIds:[y]});this.cache._parts=t}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[r,i]=t.valid,s=2*i;let n,o=0;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s,o=n):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([d({readOnly:!0})],xo.prototype,"cache",null),u([d({readOnly:!0})],xo.prototype,"center",null),u([d({readOnly:!0})],xo.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],xo.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],xo.prototype,"hasZ",null),u([d({readOnly:!0})],xo.prototype,"height",null),u([d({readOnly:!0})],xo.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],xo.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],xo.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],xo.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],xo.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],xo.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],xo.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],xo.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],xo.prototype,"zmax",void 0),xo=lh=u([P("esri.geometry.Extent")],xo),xo.prototype.toJSON.isDefaultToJSON=!0;const qr=xo;function oE(e,t,r=!1){let{hasM:i,hasZ:s}=e;Array.isArray(t)?t.length!==4||i||s?t.length===3&&r&&!i?(s=!0,i=!1):t.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&t.hasZ&&(!i||t.hasM),i=!i&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=i}var gz;function XK(e){return(t,r)=>t==null?r:r==null?t:e(t,r)}function LOe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let $0=gz=class extends Iv{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return{};const r={};Array.isArray(e)?(r.points=e,r.spatialReference=t):LOe(e)?r.spatialReference=e:(e.points&&(r.points=e.points),e.spatialReference&&(r.spatialReference=e.spatialReference),e.hasZ&&(r.hasZ=e.hasZ),e.hasM&&(r.hasM=e.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new qr,r=this.hasZ,i=this.hasM,s=r?3:2,n=e[0],o=XK(Math.min),a=XK(Math.max);let l,c,h,p,[f,m]=n,[y,_]=n;for(let b=0,x=e.length;b<x;b++){const T=e[b],[S,C]=T;if(f=o(f,S),m=o(m,C),y=a(y,S),_=a(_,C),r&&T.length>2){const O=T[2];l=o(l,O),h=a(h,O)}if(i&&T.length>s){const O=T[s];c=o(c,O),p=a(p,O)}}return t.xmin=f,t.ymin=m,t.xmax=y,t.ymax=_,t.spatialReference=this.spatialReference,r?(t.zmin=l,t.zmax=h):(t.zmin=void 0,t.zmax=void 0),i?(t.mmin=c,t.mmax=p):(t.mmin=void 0,t.mmax=void 0),t}writePoints(e,t){t.points=re(this.points)}addPoint(e){return oE(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:re(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new gz(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],r={x:t[0],y:t[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=t[2],i=3),this.hasM&&(r.m=t[i]),new yt(r)}removePoint(e){if(!this._validateInputs(e))return null;const t=new yt(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(oE(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([d({readOnly:!0})],$0.prototype,"cache",null),u([d()],$0.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],$0.prototype,"points",void 0),u([Be("points")],$0.prototype,"writePoints",null),$0=gz=u([P("esri.geometry.Multipoint")],$0),$0.prototype.toJSON.isDefaultToJSON=!0;const oP=$0;function QW(e,t){const r=t[0]-e[0],i=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function Epe(e,t,r){const i=e[0]+r*(t[0]-e[0]),s=e[1]+r*(t[1]-e[1]);return e.length>2&&t.length>2?[i,s,e[2]+r*(t[2]-e[2])]:[i,s]}function Fwt(e,t,r,i){const[s,n]=t,[o,a]=r[i],[l,c]=r[i+1],h=l-o,p=c-a,f=h*h+p*p,m=(s-o)*h+(n-a)*p,y=Math.min(1,Math.max(0,m/f));return e[0]=o+h*y,e[1]=a+p*y,e}function Uwt(e,t,r){const i=r.rings;let s,n,o=!1,a=1/0;for(let l=0;l<i.length;l++){const c=i[l];for(let h=0,p=c.length-1;h<c.length;p=h++)s=c[h],n=c[p],s[1]>t!=n[1]>t&&e<(n[0]-s[0])*(t-s[1])/(n[1]-s[1])+s[0]&&(o=!o),a=Math.min(a,DOe(e,t,s,n))}return a===0?0:(o?1:-1)*Math.sqrt(a)}function DOe(e,t,r,i){let s=r[0],n=r[1],o=i[0]-s,a=i[1]-n;if(o!==0||a!==0){const l=((e-s)*o+(t-n)*a)/(o*o+a*a);l>1?(s=i[0],n=i[1]):l>0&&(s+=o*l,n+=a*l)}return o=e-s,a=t-n,o*o+a*a}function NOe(e,t){return Epe(e,t,.5)}function Cpe(e){const t=e.length;let r=0;for(let i=0;i<t-1;++i)r+=QW(e[i],e[i+1]);return r}function Ape(e,t){if(t<=0)return e[0];const r=e.length;let i=0;for(let s=0;s<r-1;++s){const n=QW(e[s],e[s+1]);if(t-i<n){const o=(t-i)/n;return Epe(e[s],e[s+1],o)}i+=n}return e[r-1]}function Rpe(e,t,r){const i=e.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=e[a],c=e[(a+1)%i];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function FOe(e){const t=e.length;return t>2&&dy(e[0],e[t-1])}function kwt(e){if("rings"in e)for(const t of e.rings)FOe(t)||t.push(t[0].slice())}function Ope(e){if(!e||e.length<3)return 0;let t=0;const r=e.length-1;for(let i=0;i<r;i++)t+=(e[i][0]-e[i+1][0])*(e[i][1]+e[i+1][1]);return t+=(e[r][0]-e[0][0])*(e[r][1]+e[0][1]),-.5*t}function Vwt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function UOe(e){var t;return e?KW(e.rings,(t=e.hasZ)!=null?t:!1):null}function KW(e,t){if(!e||!e.length)return null;const r=[],i=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=kOe(e[n],t,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],t&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||t&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=e[0]&&e[0].length?VOe(e[0],t):null;if(!n)return null;r[0]=n[0],r[1]=n[1],t&&n.length>2&&(r[2]=n[2])}return r}function kOe(e,t,r){let i=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const m=e[f],y=e[(f+1)%e.length],[_,b,x]=m,T=_-l,S=b-c,[C,O,R]=y,$=C-l,I=O-c,U=T*I-$*S;if(o+=U,i+=(T+$)*U,s+=(S+I)*U,t&&m.length>2&&y.length>2){const V=x-h,G=R-h,z=T*G-$*V;n+=(V+G)*z,a+=z}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),b<r[2]&&(r[2]=b),b>r[3]&&(r[3]=b),t&&(x<r[4]&&(r[4]=x),x>r[5]&&(r[5]=x))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[i/(6*o)+l,s/(6*o)+c,o];return t&&(r[4]===r[5]||a===0?(p[3]=(r[4]+r[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function VOe(e,t){const r=t?[0,0,0]:[0,0],i=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){r[0]=h[0],r[1]=h[1],i[0]=p[0],i[1]=p[1],t&&h.length>2&&p.length>2&&(r[2]=h[2],i[2]=p[2]);const f=QW(r,i);if(f){s+=f;const m=NOe(h,p);n+=f*m[0],o+=f*m[1],t&&m.length>2&&(a+=f*m[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}const BOe=1e-6;function Bwt(e){if(!e||!e.rings)return null;const{rings:t}=e;let r=0;for(let n=0;n<t.length;n++)r+=Ope(t[n]);if(r<BOe)return KW(t,!1);const i=[0,0],s=t[0][0];for(let n=0;n<t.length;n++)GOe(i,s,t[n]);return i[0]*=1/r,i[1]*=1/r,i[0]+=s[0],i[1]+=s[1],i}const zOe=1/3;function GOe(e,t,r){if(!e||!r||r.length<3)return null;const i=r[0],s=[0,0],n=[r[1][0]-i[0],r[1][1]-i[1]];let o;for(let c=2;c<r.length;c++)s[0]=r[c][0]-i[0],s[1]=r[c][1]-i[1],o=.5*zOe*(s[0]*n[1]-s[1]*n[0]),e[0]+=o*(n[0]+s[0]),e[1]+=o*(n[1]+s[1]),n[0]=s[0],n[1]=s[1];const a=Ope(r),l=[i[0],i[1]];return l[0]-=t[0],l[1]-=t[1],l[0]*=a,l[1]*=a,e[0]+=l[0],e[1]+=l[1],e}function Mpe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Ppe(e){return e.points!==void 0}function Ipe(e){return e.x!==void 0&&e.y!==void 0}function $pe(e){return e.paths!==void 0}function Lpe(e){return e.rings!==void 0}function Dpe(e){function t(r,i){return r==null?i:i==null?r:e(r,i)}return t}const I_=Dpe(Math.min),$_=Dpe(Math.max);function zwt(e,t){return $pe(t)?aE(e,t.paths,!1,!1):Lpe(t)?aE(e,t.rings,!1,!1):Ppe(t)?eX(e,t.points,!1,!1,!1,!1):Mpe(t)?Npe(e,t):(Ipe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function Gwt(e,t){return $pe(t)?aE(e,t.paths,!0,!1):Lpe(t)?aE(e,t.rings,!0,!1):Ppe(t)?eX(e,t.points,!0,!1,!0,!1):Mpe(t)?Npe(e,t,!0,!1,!0,!1):(Ipe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function aE(e,t,r,i){const s=r?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const y=t[m];for(let _=0;_<y.length;_++){const b=y[_],[x,T]=b;if(c=I_(c,x),h=I_(h,T),p=$_(p,x),f=$_(f,T),r&&b.length>2){const S=b[2];n=I_(n,S),o=$_(o,S)}if(i&&b.length>s){const S=b[s];a=I_(n,S),l=$_(o,S)}}}return r?i?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):i?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function Npe(e,t,r,i,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,f=t.mmin,m=t.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=h,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=m,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=m,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function eX(e,t,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!t.length||!t[0].length)return null;let c,h,p,f,[m,y]=t[0],[_,b]=t[0];for(let x=0;x<t.length;x++){const T=t[x],[S,C]=T;if(m=I_(m,S),y=I_(y,C),_=$_(_,S),b=$_(b,C),l&&T.length>2){const O=T[2];c=I_(c,O),h=$_(h,O)}if(a&&T.length>o){const O=T[o];p=I_(c,O),f=$_(h,O)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=c,e[3]=p,e[4]=_,e[5]=b,e[6]=h,e[7]=f,e):(e[0]=m,e[1]=y,e[2]=c,e[3]=_,e[4]=b,e[5]=h,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=p,e[3]=_,e[4]=b,e[5]=f,e):(e[0]=m,e[1]=y,e[2]=_,e[3]=b,e)}function jOe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function HOe(e){return e.points!==void 0}function qOe(e){return e.x!==void 0&&e.y!==void 0}function WOe(e){return e.paths!==void 0}function XOe(e){return e.rings!==void 0}const tX=[];function Fpe(e,t,r,i){return{xmin:e,ymin:t,xmax:r,ymax:i}}function Upe(e,t,r,i,s,n){return{xmin:e,ymin:t,zmin:r,xmax:i,ymax:s,zmax:n}}function kpe(e,t,r,i,s,n){return{xmin:e,ymin:t,mmin:r,xmax:i,ymax:s,mmax:n}}function Vpe(e,t,r,i,s,n,o,a){return{xmin:e,ymin:t,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function rX(e,t=!1,r=!1){return t?r?Vpe(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):Upe(e[0],e[1],e[2],e[3],e[4],e[5]):r?kpe(e[0],e[1],e[2],e[3],e[4],e[5]):Fpe(e[0],e[1],e[2],e[3])}function jwt(e){return e?jOe(e)?e:qOe(e)?ZOe(e):XOe(e)?Bpe(e):WOe(e)?zpe(e):HOe(e)?YOe(e):null:null}function YOe(e){const{hasZ:t,hasM:r,points:i}=e;return rX(eX(tX,i,t!=null?t:!1,r!=null?r:!1),t,r)}function ZOe(e){const{x:t,y:r,z:i,m:s}=e,n=s!=null;return i!=null?n?Vpe(t,r,i,s,t,r,i,s):Upe(t,r,i,t,r,i):n?kpe(t,r,s,t,r,s):Fpe(t,r,t,r)}function Bpe(e){const{hasZ:t,hasM:r,rings:i}=e,s=aE(tX,i,t!=null?t:!1,r!=null?r:!1);return s?rX(s,t,r):null}function zpe(e){const{hasZ:t,hasM:r,paths:i}=e,s=aE(tX,i,t!=null?t:!1,r!=null?r:!1);return s?rX(s,t,r):null}var aD;function YK(e){return!Array.isArray(e[0])}let df=aD=class extends Iv{static fromExtent(e){const t=e.clone().normalize(),r=e.spatialReference;let i=!1,s=!1;for(const o of t)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new aD(n)}constructor(...e){super(...e),this.rings=[],this.type="polygon"}normalizeCtorArgs(e,t){let r,i,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),r=e.hasZ,i=e.hasM):s=e,s=s||[],t=t||Ye.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=UOe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new yt;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Bpe(this);if(!t)return null;const r=new qr(t);return r.spatialReference=e,r}get isSelfIntersecting(){return POe(this.rings)}writeRings(e,t){t.rings=re(this.rings)}addRing(e){if(!e)return;const t=this.rings,r=t.length;if(YK(e)){const i=[];for(let s=0,n=e.length;s<n;s++)i[s]=e[s].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new aD;return e.spatialReference=this.spatialReference,e.rings=re(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(E(e))return!1;const t=this.spatialReference,r=e.spatialReference;if(v(t)!==v(r)||v(t)&&v(r)&&!t.equals(r)||this.rings.length!==e.rings.length)return!1;const i=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!dy(n,o,i))return!1}return!0}contains(e){if(!e)return!1;const t=gx(e,this.spatialReference);return wOe(this,v(t)?t:e)}isClockwise(e){let t;return t=YK(e)?e.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):e,Rpe(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.rings[e][t],i=this.hasZ,s=this.hasM;return i&&!s?new yt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new yt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new yt(r[0],r[1],r[2],r[3],this.spatialReference):new yt(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(oE(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e].splice(t,0,r),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new yt(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],r=this.spatialReference,i=t.map(s=>new yt(s,r));return this.notifyChange("rings"),i}setPoint(e,t,r){return this._validateInputs(e,t)?(oE(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e][t]=r,this.notifyChange("rings"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const i=this.rings[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],df.prototype,"cache",null),u([d({readOnly:!0})],df.prototype,"centroid",null),u([d({readOnly:!0})],df.prototype,"extent",null),u([d({readOnly:!0})],df.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],df.prototype,"rings",void 0),u([Be("rings")],df.prototype,"writeRings",null),df=aD=u([P("esri.geometry.Polygon")],df),df.prototype.toJSON.isDefaultToJSON=!0;const Pp=df;var yz;function JOe(e){return!Array.isArray(e[0])}let L0=yz=class extends Iv{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let r,i,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),r=e.hasZ,i=e.hasM):s=e,s=s||[],t=t||Ye.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=zpe(this);if(!t)return null;const r=new qr(t);return r.spatialReference=e,r}writePaths(e,t){t.paths=re(this.paths)}addPath(e){if(!e)return;const t=this.paths,r=t.length;if(JOe(e)){const i=[];for(let s=0,n=e.length;s<n;s++)i[s]=e[s].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new yz;return e.spatialReference=this.spatialReference,e.paths=re(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.paths[e][t],i=this.hasZ,s=this.hasM;return i&&!s?new yt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new yt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new yt(r[0],r[1],r[2],r[3],this.spatialReference):new yt(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(oE(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e].splice(t,0,r),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],r=this.spatialReference,i=t.map(s=>new yt(s,r));return this.notifyChange("paths"),i}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new yt(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(e,t,r){return this._validateInputs(e,t)?(oE(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e][t]=r,this.notifyChange("paths"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const i=this.paths[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],L0.prototype,"cache",null),u([d({readOnly:!0})],L0.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],L0.prototype,"paths",void 0),u([Be("paths")],L0.prototype,"writePaths",null),L0=yz=u([P("esri.geometry.Polyline")],L0),L0.prototype.toJSON.isDefaultToJSON=!0;const up=L0,Gpe=Ia()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),ZK=Ia()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function jpe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function iX(e){return e.points!==void 0}function sX(e){return e.x!==void 0&&e.y!==void 0}function nX(e){return e.paths!==void 0}function lw(e){return e.rings!==void 0}function gm(e){return E(e)?null:e instanceof Iv?e:sX(e)?yt.fromJSON(e):nX(e)?up.fromJSON(e):lw(e)?Pp.fromJSON(e):iX(e)?oP.fromJSON(e):jpe(e)?qr.fromJSON(e):null}function dC(e){return e?sX(e)?"esriGeometryPoint":nX(e)?"esriGeometryPolyline":lw(e)?"esriGeometryPolygon":jpe(e)?"esriGeometryEnvelope":iX(e)?"esriGeometryMultipoint":null:null}const QOe={esriGeometryPoint:yt,esriGeometryPolyline:up,esriGeometryPolygon:Pp,esriGeometryEnvelope:qr,esriGeometryMultipoint:oP};function KOe(e){return e&&QOe[e]||null}const yx={base:Iv,key:"type",typeMap:{extent:qr,multipoint:oP,point:yt,polyline:up,polygon:Pp}};Op(yx);class bS{constructor(){this._emitter=new bS.EventEmitter(this)}emit(t,r){return this._emitter.emit(t,r)}on(t,r){return this._emitter.on(t,r)}once(t,r){return this._emitter.once(t,r)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return eE(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([P("esri.core.Evented")],s),s};let r=class extends Te{constructor(){super(...arguments),this._emitter=new bS.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([P("esri.core.Evented")],r),e.EventedAccessor=r})(bS||(bS={}));const Vs=bS;var vi;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(vi||(vi={}));function oX(e){return(t,r)=>{t[r]=e}}class aX extends Gde{notify(){const t=this._observers;if(t&&t.length>0){const r=t.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}}var Vg;class eMe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const Yu=new An(eMe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),tMe=()=>{};function V8(e){return e?e instanceof Pb?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function B8(e){if(e&&e.length)return e[0]}function rMe(e,t,r,i){const s=Math.min(e.length-r,t.length-i);let n=0;for(;n<s&&e[r+n]===t[i+n];)n++;return n}function Hpe(e,t,r,i){t&&t.forEach((s,n,o)=>{e.push(s),Hpe(e,r.call(i,s,n,o),r,i)})}const Yy=new Set,Zy=new Set,Jy=new Set,z8=new Map;let iMe=0,Pb=Vg=class extends Vs.EventedAccessor{static isCollection(e){return e!=null&&e instanceof Vg}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new aX,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:iMe++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof Vg?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return vr(this._observable),this._items}set items(e){this._emitBeforeChanges(vi.ADD)||(this._splice(0,this.length,V8(e)),this._emitAfterChanges(vi.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const r=this._chgListeners,i={removed:!1,callback:t};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=tMe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(e,t)}once(e,t){const r=this.on(e,t);return{remove(){r.remove()}}}add(e,t){if(vr(this._observable),this._emitBeforeChanges(vi.ADD))return this;const r=this.getNextIndex(t!=null?t:null);return this._splice(r,0,[e]),this._emitAfterChanges(vi.ADD),this}addMany(e,t=this._items.length){if(vr(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(vi.ADD))return this;const r=this.getNextIndex(t);return this._splice(r,0,V8(e)),this._emitAfterChanges(vi.ADD),this}at(e){if(vr(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(vr(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(vi.REMOVE),e}clone(){return vr(this._observable),this._createNewInstance({items:this._items.map(re)})}concat(...e){vr(this._observable);const t=e.map(V8);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(vr(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)e.call(t,r[s],s,r);this._emitAfterChanges(vi.REMOVE)}every(e,t){return vr(this._observable),this._items.every(e,t)}filter(e,t){let r;return vr(this._observable),r=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:r})}find(e,t){return vr(this._observable),this._items.find(e,t)}findIndex(e,t){return vr(this._observable),this._items.findIndex(e,t)}flatten(e,t){vr(this._observable);const r=[];return Hpe(r,this,e,t),new Vg(r)}forEach(e,t){return vr(this._observable),this._items.forEach(e,t)}getItemAt(e){return vr(this._observable),this._items[e]}getNextIndex(e){vr(this._observable);const t=this.length;return(e=e!=null?e:t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return vr(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return vr(this._observable),this._items.indexOf(e,t)}join(e=","){return vr(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return vr(this._observable),this._items.lastIndexOf(e,t)}map(e,t){vr(this._observable);const r=this._items.map(e,t);return new Vg({items:r})}reorder(e,t=this.length-1){vr(this._observable);const r=this.indexOf(e);if(r!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(vi.MOVE))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(vi.MOVE)}return e}}pop(){if(vr(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return;const e=B8(this._splice(this.length-1,1));return this._emitAfterChanges(vi.REMOVE),e}push(...e){return vr(this._observable),this._emitBeforeChanges(vi.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(vi.ADD)),this.length}reduce(e,t){vr(this._observable);const r=this._items;return arguments.length===2?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){vr(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return vr(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(vr(this._observable),e<0||e>=this.length||this._emitBeforeChanges(vi.REMOVE))return;const t=B8(this._splice(e,1));return this._emitAfterChanges(vi.REMOVE),t}removeMany(e){if(vr(this._observable),!e||!e.length||this._emitBeforeChanges(vi.REMOVE))return[];const t=e instanceof Vg?e.toArray():e,r=this._items,i=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=r.indexOf(o);if(a>-1){const l=1+rMe(t,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(vi.REMOVE),i}reverse(){if(vr(this._observable),this._emitBeforeChanges(vi.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(vi.MOVE),this}shift(){if(vr(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return;const e=B8(this._splice(0,1));return this._emitAfterChanges(vi.REMOVE),e}slice(e=0,t=this.length){return vr(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return vr(this._observable),this._items.some(e,t)}sort(e){if(vr(this._observable),!this.length||this._emitBeforeChanges(vi.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(vi.MOVE),this}splice(e,t,...r){vr(this._observable);const i=(t?vi.REMOVE:0)|(r.length?vi.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(e,t,r)||[];return this._emitAfterChanges(i),s}toArray(){return vr(this._observable),this._items.slice()}toJSON(){return vr(this._observable),this.toArray()}toLocaleString(){return vr(this._observable),this._items.toLocaleString()}toString(){return vr(this._observable),this._items.toString()}unshift(...e){return vr(this._observable),!e.length||this._emitBeforeChanges(vi.ADD)||(this._splice(0,0,e),this._emitAfterChanges(vi.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=hC(()=>this._dispatchChange())),t){if(o=i.splice(e,t),this.hasEventListener("before-remove")){const a=Yu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(e,0,n),e+=1,l-=1,c-=1);Yu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Yu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Yu.release(a)}}if(r&&r.length){if(s){const h=[];for(const p of r){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}r=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=Yu.acquire();h.target=this,h.cancellable=!0;const p=Yu.acquire();p.target=this,p.cancellable=!1;for(const f of r)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?i.push(f):i.splice(e++,0,f),this._set("length",i.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?i.push(f):i.splice(e++,0,f),this._set("length",i.length),p.reset(f),this.emit("after-add",p));Yu.release(p),Yu.release(h)}else{if(c)for(const h of r)i.push(h);else i.splice(e,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=Yu.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,Yu.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=Yu.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),Yu.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const r=t.changes;Yy.clear(),Zy.clear(),Jy.clear();for(const{added:l,removed:c}of r){if(l)if(Jy.size===0&&Zy.size===0)for(const h of l)Yy.add(h);else for(const h of l)Zy.has(h)?(Jy.add(h),Zy.delete(h)):Jy.has(h)||Yy.add(h);if(c)if(Jy.size===0&&Yy.size===0)for(const h of c)Zy.add(h);else for(const h of c)Yy.has(h)?Yy.delete(h):(Jy.delete(h),Zy.add(h))}const i=Ec.acquire();Yy.forEach(l=>{i.push(l)});const s=Ec.acquire();Zy.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=Ec.acquire();if(Jy.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}Ec.release(i),Ec.release(s),Ec.release(a)}Yy.clear(),Zy.clear(),Jy.clear()}};Pb.ofType=e=>{if(!e)return Vg;if(z8.has(e))return z8.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const s=e.typeMap[i].prototype.declaredClass;t?t+=` | ${s}`:t=s}let r=class extends Vg{};return u([oX({Type:e,ensureType:typeof e=="function"?Us(e):Op(e)})],r.prototype,"itemType",void 0),r=u([P(`esri.core.Collection<${t}>`)],r),z8.set(e,r),r},u([d()],Pb.prototype,"length",void 0),u([d()],Pb.prototype,"items",null),Pb=Vg=u([P("esri.core.Collection")],Pb);const pt=Pb;var lE;function sMe(e,t){switch(e.type){case"range":{const r="range"in e?e.range[0]:e.minValue,i="range"in e?e.range[1]:e.maxValue;if(r!=null&&+t<r||i!=null&&+t>i)return lE.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(r=>r==null||r.code!==t))return lE.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(lE||(lE={}));const nMe=ee.getLogger("esri.support.arcadeOnDemand");let G8;function ym(){return G8||(G8=(async()=>{const e=await ie(()=>import("./arcadeUtils.24dabaae.js").then(function(t){return t.ax}),["assets/arcadeUtils.24dabaae.js","assets/arcadeTimeUtils.001f6459.js","assets/executionError.c4c51b90.js","assets/number.45471352.js","assets/hash.079e8d2d.js"]);return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),G8}const oMe=(e,t,r)=>aP.create(e,t,r,null,["$feature"]),aMe=(e,t,r)=>aP.create(e,t,r,null,["$feature","$view"]),lMe=(e,t,r,i)=>aP.create(e,t,r,i,["$feature","$view"]);class aP{constructor(t,r,i,s,n,o,a){this.script=t,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await ym(),h=Ye.fromJSON(r);let p;try{p=a.parseScript(t,o)}catch(I){return nMe.error(new j("arcade-bad-expression","Failed to parse arcade script",{script:t,error:I})),null}const f=n.reduce((I,U)=>({...I,[U]:null}),{});let m=null;v(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p),_=y&&a.enableGeometrySupport(),b=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),x=a.scriptIsAsync(p),T=x&&a.enableAsyncSupport(),S={vars:f,spatialReference:h,useAsync:!!T};await Promise.all([_,b,T]);const C=new Set;await a.loadDependentModules(C,p,null,x,y);const O=new c;O.immutable=!1,O.setField("scale",0);const R=a.compileScript(p,S),$=I=>("$view"in I&&I.$view&&(O.setField("scale",typeof I.$view=="object"?I.$view.scale:void 0),I.$view=O),m&&(I.$config=m),R({vars:I,spatialReference:h}));return new aP(t,a,p,$,new l,i,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}}const cMe=/^([0-9])/,uMe=/[^a-z0-9_\u0080-\uffff]/gi,hMe=/_{2,}/g,dMe=/^_/,pMe=/_$/;function fMe(e){return e==null?null:e.trim().replace(uMe,"_").replace(hMe,"_").replace(dMe,"").replace(pMe,"").replace(cMe,"F$1")||null}const mMe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],gMe=["field","normalizationField"];function JK(e,t){if(e!=null&&t!=null){for(const r of Array.isArray(e)?e:[e])if(QK(mMe,r,t),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)QK(gMe,i,t)}}function QK(e,t,r){if(e)for(const i of e){const s=eP(i,t),n=s&&typeof s!="function"&&r.get(s);n&&ol(i,n.name,t)}}function qpe(e,t){var r,i,s,n,o;if(e!=null&&((r=t==null?void 0:t.fields)==null?void 0:r.length))if("startField"in e){const a=t.get(e.startField),l=t.get(e.endField);e.startField=(i=a==null?void 0:a.name)!=null?i:null,e.endField=(s=l==null?void 0:l.name)!=null?s:null}else{const a=t.get(e.startTimeField),l=t.get(e.endTimeField);e.startTimeField=(n=a==null?void 0:a.name)!=null?n:null,e.endTimeField=(o=l==null?void 0:l.name)!=null?o:null}}const j8=new Set;function Wpe(e,t){return e&&t?(j8.clear(),PO(j8,e,t),Array.from(j8).sort()):[]}function PO(e,t,r){var i;if(r)if((i=t==null?void 0:t.fields)!=null&&i.length)if(r.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of r)Iu(e,t,s);else{if(r.includes("*"))return e.clear(),void e.add("*");for(const s of r)s!=null&&e.add(s)}}function Iu(e,t,r){if(typeof r=="string")if(t){const i=t.get(r);i&&e.add(i.name)}else e.add(r)}function Hwt(e,t){var r;return E(t)||E(e)?[]:t.includes("*")?((r=e.fields)!=null?r:[]).map(i=>i.name):t}async function Xl(e,t,r){var n;if(!r)return;const{arcadeUtils:i}=await ym(),s=i.extractFieldNames(r,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Iu(e,t,o)}async function Xpe(e,t,r){if(r&&r!=="1=1"){const i=(await ie(()=>import("./WhereClause.7eef08f1.js").then(function(s){return s.W}),["assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js"])).WhereClause.create(r,t);if(!i.isStandardized)throw new j("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});PO(e,t,i.fieldNames)}}function yMe({displayField:e,fields:t}){return e||(t&&t.length?H8(t,"name-or-title")||H8(t,"unique-identifier")||H8(t,"type-or-category")||_Me(t):null)}function _Me(e){for(const t of e){if(!t||!t.name)continue;const r=t.name.toLowerCase();if(r.includes("name")||r.includes("title"))return t.name}return null}function H8(e,t){for(const r of e)if(r&&r.valueType&&r.valueType===t)return r.name;return null}async function qwt(e,t){var i;if(!t)return;const r=(i=t.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(e,t.fieldsIndex):void 0}function vMe(e,t,r){r.onStatisticExpression?Xl(e,t,r.onStatisticExpression.expression):e.add(r.onStatisticField)}async function Wwt(e,t,r){if(!t||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(bMe(e,t,s)),r.fields&&i.push(...r.fields.map(async n=>vMe(e,t.fieldsIndex,n))),await Promise.all(i)}async function bMe(e,t,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(n=>Xl(e,t.fieldsIndex,n.expression)));const s=r==null?void 0:r.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(Xl(e,t.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function Xwt(e,t,r){t&&(t.timeInfo&&v(r)&&r.timeExtent&&PO(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&PO(e,t.fieldsIndex,[t.floorInfo.floorField]),v(r)&&v(r.where)&&await Xpe(e,t.fieldsIndex,r.where))}async function Ywt(e,t,r){t&&r&&await Promise.all(r.map(i=>wMe(e,t,i)))}async function wMe(e,t,r){t&&r&&(r.valueExpression?await Xl(e,t.fieldsIndex,r.valueExpression):r.field&&Iu(e,t.fieldsIndex,r.field))}function Zwt(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?Wpe(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function Jwt(e,t){const{labelingInfo:r,fieldsIndex:i}=t;r&&r.length&&await Promise.all(r.map(s=>xMe(e,i,s)))}async function xMe(e,t,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await Xl(e,t,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Iu(e,t,o.slice(1,-1))})}await Xpe(e,t,s)}function TMe(e){const t=e.defaultValue;return t!==void 0&&Jpe(e,t)?t:e.nullable?null:void 0}function Ype(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function SMe(e){return e===null||Ype(e)}const lX="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function EMe(e){return e===null||lX(e)}function Zpe(e){return e!=null&&typeof e=="string"}function CMe(e){return e===null||Zpe(e)}function AMe(){return!0}function Jpe(e,t){let r;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=e.nullable?EMe:lX;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=e.nullable?SMe:Ype;break;case"string":case"esriFieldTypeString":r=e.nullable?CMe:Zpe;break;default:r=AMe}return arguments.length===1?r:r(t)}const RMe=["integer","small-integer","single","double"],OMe=new Set([...RMe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function D5(e){return e!=null&&OMe.has(e.type)}function Qwt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}var _F,vF;function Kwt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function ext(e,t){return e==null||e.nullable&&t===null?null:D5(e)&&!MMe(e.type,Number(t))?_F.OUT_OF_RANGE:Jpe(e,t)?e.domain?sMe(e.domain,t):null:vF.INVALID_TYPE}function MMe(e,t){const r=typeof e=="string"?Qpe(e):e;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?lX(t)&&t>=i&&t<=s:t>=i&&t<=s}function Qpe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return PMe;case"esriFieldTypeInteger":case"integer":return IMe;case"esriFieldTypeSingle":case"single":return $Me;case"esriFieldTypeDouble":case"double":return LMe}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(_F||(_F={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(vF||(vF={}));const PMe={min:-32768,max:32767,isInteger:!0},IMe={min:-2147483648,max:2147483647,isInteger:!0},$Me={min:-34e37,max:12e37,isInteger:!1},LMe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function txt(e,t,r){switch(e){case lE.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case lE.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case vF.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case _F.OUT_OF_RANGE:{const{min:i,max:s}=Qpe(t.type);return`Value ${r} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${i} to ${s}`}}}function DMe(e,t){return!NMe(e,t,null)}function NMe(e,t,r){if(!t||!t.attributes||!e){if(v(r))for(const n of e!=null?e:[])r.add(n);return!0}const i=t.attributes;let s=!1;for(const n of e)if(!(n in i)){if(s=!0,!v(r))break;r.add(n)}return s}function Kpe(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let lD=class extends fe{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],lD.prototype,"type",void 0),lD=u([P("esri.popup.content.Content")],lD);const $v=lD;var _z;let I1=_z=class extends $v{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new _z({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],I1.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],I1.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],I1.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],I1.prototype,"type",void 0),I1=_z=u([P("esri.popup.content.AttachmentsContent")],I1);const IO=I1;var vz;let $1=vz=class extends $v{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new vz({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?re(this.outFields):null})}};u([d()],$1.prototype,"creator",void 0),u([d()],$1.prototype,"destroyer",void 0),u([d()],$1.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],$1.prototype,"type",void 0),$1=vz=u([P("esri.popup.content.CustomContent")],$1);const FMe=$1;var bz;let GT=bz=class extends fe{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new bz({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],GT.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],GT.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],GT.prototype,"returnType",void 0),GT=bz=u([P("esri.popup.ElementExpressionInfo")],GT);const efe=GT;var wz;let sR=wz=class extends $v{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new wz({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([d({type:efe,json:{write:!0}})],sR.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],sR.prototype,"type",void 0),sR=wz=u([P("esri.popup.content.ExpressionContent")],sR);const cX=sR;function ft(e,t={}){var s;const r=e instanceof Vr?e:new Vr(e,t),i={type:(s=t==null?void 0:t.ignoreUnknown)==null||s?r.apiValues:String,json:{type:r.jsonValues,read:!(t!=null&&t.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(i.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(i.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(i.json.name=t.name),(t==null?void 0:t.nonNullable)!==void 0&&(i.nonNullable=t.nonNullable),d(i)}const $O=Ia()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});$O.toJSON.bind($O);$O.fromJSON.bind($O);let M3;var Dhe,Nhe,Fhe;const q8=(Fhe=(Dhe=globalThis.esriConfig)==null?void 0:Dhe.locale)!=null?Fhe:(Nhe=globalThis.dojoConfig)==null?void 0:Nhe.locale;function tfe(){var e,t;return(t=q8!=null?q8:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function Gh(){return M3===void 0&&(M3=tfe()),M3}const P3=[];function rfe(e){return P3.push(e),{remove(){P3.splice(P3.indexOf(e),1)}}}const xz=[];function uX(e){return xz.push(e),{remove(){P3.splice(xz.indexOf(e),1)}}}function UMe(){const e=tfe();M3!==e&&(M3=e,[...xz].forEach(t=>{t.call(null,e)}),[...P3].forEach(t=>{t.call(null,e)}))}var Uhe;(Uhe=globalThis.addEventListener)==null||Uhe.call(globalThis,"languagechange",UMe);const Hp={year:"numeric",month:"numeric",day:"numeric"},XC={year:"numeric",month:"long",day:"numeric"},YC={year:"numeric",month:"short",day:"numeric"},ZC={year:"numeric",month:"long",weekday:"long",day:"numeric"},ch={hour:"numeric",minute:"numeric"},md={...ch,second:"numeric"},hX={"short-date":Hp,"short-date-short-time":{...Hp,...ch},"short-date-short-time-24":{...Hp,...ch,hour12:!1},"short-date-long-time":{...Hp,...md},"short-date-long-time-24":{...Hp,...md,hour12:!1},"short-date-le":Hp,"short-date-le-short-time":{...Hp,...ch},"short-date-le-short-time-24":{...Hp,...ch,hour12:!1},"short-date-le-long-time":{...Hp,...md},"short-date-le-long-time-24":{...Hp,...md,hour12:!1},"long-month-day-year":XC,"long-month-day-year-short-time":{...XC,...ch},"long-month-day-year-short-time-24":{...XC,...ch,hour12:!1},"long-month-day-year-long-time":{...XC,...md},"long-month-day-year-long-time-24":{...XC,...md,hour12:!1},"day-short-month-year":YC,"day-short-month-year-short-time":{...YC,...ch},"day-short-month-year-short-time-24":{...YC,...ch,hour12:!1},"day-short-month-year-long-time":{...YC,...md},"day-short-month-year-long-time-24":{...YC,...md,hour12:!1},"long-date":ZC,"long-date-short-time":{...ZC,...ch},"long-date-short-time-24":{...ZC,...ch,hour12:!1},"long-date-long-time":{...ZC,...md},"long-date-long-time-24":{...ZC,...md,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":ch,"long-time":md},LO=Ia()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});LO.apiValues;LO.toJSON.bind(LO);LO.fromJSON.bind(LO);const kMe={ar:"ar-u-nu-latn-ca-gregory"};let Tz=new WeakMap,ife=hX["short-date-short-time"];function VMe(e){const t=e||ife;let r=Tz.get(t);if(!r){const i=Gh(),s=kMe[Gh()]||i;r=new Intl.DateTimeFormat(s,t),Tz.set(t,r)}return r}function N5(e){return e?hX[e]:null}function _m(e,t){return VMe(t).format(e)}uX(()=>{Tz=new WeakMap,ife=hX["short-date-short-time"]});const BMe={ar:"ar-u-nu-latn"};let cD=new WeakMap,sfe={};function zMe(e){const t=e||sfe;if(!cD.has(t)){const r=Gh(),i=BMe[Gh()]||r;cD.set(t,new Intl.NumberFormat(i,e))}return cD.get(t)}function nfe(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function vm(e,t){return e===-0&&(e=0),zMe(t).format(e)}uX(()=>{cD=new WeakMap,sfe={}});var Sz;let L1=Sz=class extends fe{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new Sz({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?_m(e,{...N5(this.dateFormat),...this.dateTimeFormatOptions}):vm(e,nfe(this))}formatRasterPixelValue(e){if(e.includes("-"))return e;let t,r;return e.trim().includes(",")?(t=",",r=t+" ",this._formatDelimitedString(e,t,r,this)):e.trim().includes(";")?(t=";",r=t+" ",this._formatDelimitedString(e,t,r,this)):e.trim().includes(" ")?(t=r=" ",this._formatDelimitedString(e,t,r,this)):this.format(Number(e))}_formatDelimitedString(e,t,r,i){return e&&t&&r&&i?e.trim().split(t).map(s=>this.format(Number(s))).join(r):e}};u([ft($O)],L1.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],L1.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],L1.prototype,"digitSeparator",void 0),u([d({type:Ri,json:{write:!0}})],L1.prototype,"places",void 0),L1=Sz=u([P("esri.popup.support.FieldInfoFormat")],L1);const q2=L1;var Ez;let Cd=Ez=class extends fe{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new Ez({fieldName:this.fieldName,format:this.format?re(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Cd.prototype,"fieldName",void 0),u([d({type:q2,json:{write:!0}})],Cd.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],Cd.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],Cd.prototype,"label",void 0),u([ft(new Vr({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Cd.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Cd.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],Cd.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],Cd.prototype,"visible",void 0),Cd=Ez=u([P("esri.popup.FieldInfo")],Cd);const lP=Cd;var Cz;let dg=Cz=class extends $v{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(r=>r.toJSON())}clone(){return new Cz(re({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],dg.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],dg.prototype,"description",void 0),u([d({type:[lP]})],dg.prototype,"fieldInfos",void 0),u([Be("fieldInfos")],dg.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],dg.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],dg.prototype,"type",void 0),dg=Cz=u([P("esri.popup.content.FieldsContent")],dg);const cE=dg;let D1=class extends fe{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],D1.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],D1.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],D1.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],D1.prototype,"type",void 0),D1=u([P("esri.popup.content.mixins.MediaInfo")],D1);const dX=D1;var Az;let jT=Az=class extends Te{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new Az({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],jT.prototype,"fieldName",void 0),u([d()],jT.prototype,"tooltip",void 0),u([d()],jT.prototype,"value",void 0),jT=Az=u([P("esri.popup.content.support.ChartMediaInfoValueSeries")],jT);const ofe=jT;var Rz;let N1=Rz=class extends fe{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Rz({fields:re(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],N1.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],N1.prototype,"normalizeField",void 0),u([d({type:[ofe],json:{read:!1}})],N1.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],N1.prototype,"tooltipField",void 0),N1=Rz=u([P("esri.popup.content.support.ChartMediaInfoValue")],N1);const GMe=N1;let nR=class extends dX{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],nR.prototype,"type",void 0),u([d({type:GMe,json:{write:!0}})],nR.prototype,"value",void 0),nR=u([P("esri.popup.content.mixins.ChartMediaInfo")],nR);const F5=nR,U5=Ia()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var Oz;let uD=Oz=class extends F5{constructor(e){super(e),this.type="bar-chart"}clone(){return new Oz({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:U5.write}})],uD.prototype,"type",void 0),uD=Oz=u([P("esri.popup.content.BarChartMediaInfo")],uD);const afe=uD;var Mz;let hD=Mz=class extends F5{constructor(e){super(e),this.type="column-chart"}clone(){return new Mz({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:U5.write}})],hD.prototype,"type",void 0),hD=Mz=u([P("esri.popup.content.ColumnChartMediaInfo")],hD);const lfe=hD;var Pz;let oR=Pz=class extends fe{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new Pz({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],oR.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],oR.prototype,"sourceURL",void 0),oR=Pz=u([P("esri.popup.content.support.ImageMediaInfoValue")],oR);const jMe=oR;var Iz;let HT=Iz=class extends dX{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new Iz({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],HT.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],HT.prototype,"type",void 0),u([d({type:jMe,json:{write:!0}})],HT.prototype,"value",void 0),HT=Iz=u([P("esri.popup.content.ImageMediaInfo")],HT);const cfe=HT;var $z;let dD=$z=class extends F5{constructor(e){super(e),this.type="line-chart"}clone(){return new $z({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:U5.write}})],dD.prototype,"type",void 0),dD=$z=u([P("esri.popup.content.LineChartMediaInfo")],dD);const ufe=dD;var Lz;let pD=Lz=class extends F5{constructor(e){super(e),this.type="pie-chart"}clone(){return new Lz({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:U5.write}})],pD.prototype,"type",void 0),pD=Lz=u([P("esri.popup.content.PieChartMediaInfo")],pD);const hfe=pD,dfe={base:dX,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":afe,"column-chart":lfe,"line-chart":ufe,"pie-chart":hfe,image:cfe}};var Dz;let Ad=Dz=class extends $v{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?cfe.fromJSON(t):t.type==="barchart"?afe.fromJSON(t):t.type==="columnchart"?lfe.fromJSON(t):t.type==="linechart"?ufe.fromJSON(t):t.type==="piechart"?hfe.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(r=>r.toJSON())}clone(){return new Dz(re({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],Ad.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],Ad.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Ad.prototype,"description",void 0),u([d({types:[dfe]})],Ad.prototype,"mediaInfos",void 0),u([De("mediaInfos")],Ad.prototype,"readMediaInfos",null),u([Be("mediaInfos")],Ad.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],Ad.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Ad.prototype,"type",void 0),Ad=Dz=u([P("esri.popup.content.MediaContent")],Ad);const DO=Ad;var Nz;let aR=Nz=class extends fe{constructor(e){super(e),this.field=null,this.order=null}clone(){return new Nz({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],aR.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],aR.prototype,"order",void 0),aR=Nz=u([P("esri.popup.support.RelatedRecordsInfoFieldOrder")],aR);const pX=aR;let pf=class extends Ss($v){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([d({type:String,json:{write:!0}})],pf.prototype,"description",void 0),u([d({type:Number,json:{type:Ri,write:!0}})],pf.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],pf.prototype,"displayType",void 0),u([d({type:[pX],json:{write:!0}})],pf.prototype,"orderByFields",void 0),u([d({type:Number,json:{type:Ri,write:!0}})],pf.prototype,"relationshipId",void 0),u([d({type:String,json:{write:!0}})],pf.prototype,"title",void 0),u([d({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],pf.prototype,"type",void 0),pf=u([P("esri.popup.content.RelationshipContent")],pf);const bF=pf;var Fz;let lR=Fz=class extends $v{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new Fz({text:this.text})}};u([d({type:String,json:{write:!0}})],lR.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],lR.prototype,"type",void 0),lR=Fz=u([P("esri.popup.content.TextContent")],lR);const uE=lR,HMe={base:null,key:"type",typeMap:{attachment:IO,media:DO,text:uE,expression:cX,field:cE,relationship:bF}};var Uz;let F1=Uz=class extends fe{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Uz({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],F1.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],F1.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],F1.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],F1.prototype,"returnType",void 0),F1=Uz=u([P("esri.popup.ExpressionInfo")],F1);const pfe=F1;var kz;let cR=kz=class extends fe{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new kz({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],cR.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],cR.prototype,"showNoDataRecords",void 0),cR=kz=u([P("esri.popup.LayerOptions")],cR);const qMe=cR;var Vz;let uR=Vz=class extends fe{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Vz({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?re(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],uR.prototype,"showRelatedRecords",void 0),u([d({type:[pX],json:{write:!0}})],uR.prototype,"orderByFields",void 0),uR=Vz=u([P("esri.popup.RelatedRecordsInfo")],uR);const WMe=uR;let ffe=0;const cP=e=>{let t=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+ffe++})}};return t=u([P("esri.core.Identifiable")],t),t},rxt=e=>{let t=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:ffe++})}};return t=u([P("esri.core.NumericIdentifiable")],t),t};let KK=class extends cP(class{}){};KK=u([P("esri.core.Identifiable")],KK);var Bz;let Rd=Bz=class extends cP(Te){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new Bz({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],Rd.prototype,"active",void 0),u([d()],Rd.prototype,"className",void 0),u([d()],Rd.prototype,"disabled",void 0),u([d()],Rd.prototype,"id",void 0),u([d()],Rd.prototype,"indicator",void 0),u([d()],Rd.prototype,"title",void 0),u([d()],Rd.prototype,"type",void 0),u([d()],Rd.prototype,"visible",void 0),Rd=Bz=u([P("esri.support.actions.ActionBase")],Rd);const k5=Rd;var zz;let fD=zz=class extends k5{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new zz({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],fD.prototype,"image",void 0),fD=zz=u([P("esri.support.Action.ActionButton")],fD);const pC=fD;var Gz;let hR=Gz=class extends k5{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new Gz({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],hR.prototype,"image",void 0),u([d()],hR.prototype,"value",void 0),hR=Gz=u([P("esri.support.Action.ActionToggle")],hR);const mfe=hR,XMe="esri.PopupTemplate",YMe=ee.getLogger(XMe),JC="relationships/",eee="expression/",ZMe=pt.ofType({key:"type",defaultKeyValue:"button",base:k5,typeMap:{button:pC,toggle:mfe}}),JMe={base:$v,key:"type",typeMap:{media:DO,custom:FMe,text:uE,attachments:IO,fields:cE,expression:cX,relationship:bF}},QMe=["attachments","fields","media","text","expression","relationship"];let To=class extends Ss(fe){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(t=>Op(JMe,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Hu(e)?e:(YMe.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:r}=t;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t.description,t.mediaInfos,r):this._readPopupInfo(t)}writeContent(e,t,r,i){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>QMe.includes(s.type)).map(s=>s&&s.toJSON(i)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"?this._writeTextContent(s,t):s.type==="relationship"&&this._writeRelationshipContent(s,t)})):t.description=e}writeFieldInfos(e,t,r,i){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(i);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,r,i){t[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(i)}writeTitle(e,t){t.title=e||""}async collectRequiredFields(e,t){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...r,...this._getContentExpressionInfos(this.content,r)]),PO(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=re(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach(i=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===i.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(i)}):t.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,t){var s,n;const r=((s=e.orderByFields)==null?void 0:s.map(o=>this._toFieldOrderJSON(o,e.relationshipId)))||[],i=[...((n=t.relatedRecordsInfo)==null?void 0:n.orderByFields)||[],...r];t.relatedRecordsInfo={showRelatedRecords:!0,...(i==null?void 0:i.length)&&{orderByFields:i}}}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=re(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...r]:t.mediaInfos=r}_readPopupInfoElements(e,t,r){const i={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!t||i.mediaInfos||(s.mediaInfos=t,i.mediaInfos=!0),DO.fromJSON(s)):s.type==="text"?(s.text||!e||i.description||(s.text=e,i.description=!0),uE.fromJSON(s)):s.type==="attachments"?IO.fromJSON(s):s.type==="fields"?cE.fromJSON(s):s.type==="expression"?cX.fromJSON(s):s.type==="relationship"?bF.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:t,order:r}=e;if(!(t!=null&&t.startsWith(JC)))return null;const i=t.replace(JC,"").split("/");if(i.length!==2)return null;const s=parseInt(i[0],10),n=i[1];return typeof s=="number"&&n?bF.fromJSON({relationshipId:s,orderByFields:[{field:n,order:r}]}):null}_toFieldOrderJSON(e,t){const{order:r,field:i}=e;return{field:`${JC}${t}/${i}`,order:r}}_readPopupInfo({description:e,mediaInfos:t,showAttachments:r,relatedRecordsInfo:i={showRelatedRecords:!1}}){const s=[];e?s.push(new uE({text:e})):s.push(new cE),Array.isArray(t)&&t.length&&s.push(DO.fromJSON({mediaInfos:t})),r&&s.push(IO.fromJSON({displayType:"auto"}));const{showRelatedRecords:n,orderByFields:o}=i;return n&&(o==null?void 0:o.length)&&o.forEach(a=>{const l=this._toRelationshipContent(a);l&&s.push(l)}),s.length?s:e}_getContentElementFields(e){var r;const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields((r=e.fieldInfos)!=null?r:this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:r,value:i}=e,s=i||{},{fields:n,normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n!=null?n:[]];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((r,i)=>[...r,...i.type==="expression"&&i.expressionInfo?[i.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,r)=>[...t,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,t,r){r&&await Promise.all(r.map(i=>Xl(e,t,i.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.startsWith(JC)&&!t.startsWith(eee)):[]}_getActionsFields(e){return e?e.toArray().reduce((t,r)=>[...t,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:t,title:r,type:i}=e,s=i==="button"||i==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,r=e.match(t);if(!r)return[];const i=/\{(\w+):.+\}/,s=r.filter(n=>!(n.indexOf(`{${JC}`)===0||n.indexOf(`{${eee}`)===0)).map(n=>n.replace(i,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([d({type:ZMe})],To.prototype,"actions",void 0),u([d()],To.prototype,"content",void 0),u([zt("content")],To.prototype,"castContent",null),u([De("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],To.prototype,"readContent",null),u([Be("content",{popupElements:{type:pt.ofType(HMe)},showAttachments:{type:Boolean},mediaInfos:{type:pt.ofType(dfe)},description:{type:String},relatedRecordsInfo:{type:WMe}})],To.prototype,"writeContent",null),u([d({type:[pfe],json:{write:!0}})],To.prototype,"expressionInfos",void 0),u([d({type:[lP]})],To.prototype,"fieldInfos",void 0),u([Be("fieldInfos")],To.prototype,"writeFieldInfos",null),u([d({type:qMe})],To.prototype,"layerOptions",void 0),u([Be("layerOptions")],To.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],To.prototype,"lastEditInfoEnabled",void 0),u([d()],To.prototype,"outFields",void 0),u([d()],To.prototype,"overwriteActions",void 0),u([d()],To.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],To.prototype,"title",void 0),u([Be("title")],To.prototype,"writeTitle",null),To=u([P("esri.PopupTemplate")],To);const uP=To,tee=new Vr({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let KMe=0,qT=class extends fe{constructor(e){super(e),this.id="sym"+KMe++,this.type=null,this.color=new Qe([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:tee.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:tee.write}}})],qT.prototype,"type",void 0),u([d({type:Qe,json:{write:{allowNull:!0}}})],qT.prototype,"color",void 0),u([De("color")],qT.prototype,"readColor",null),qT=u([P("esri.symbols.Symbol")],qT);const Gc=qT;var jz;let D0=jz=class extends Gc{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const r in e)t[r]=e[r]}async collectRequiredFields(e,t){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const s=i.map(n=>{const o=n.valueExpressionInfo;return Xl(e,t,o.expression)});await Promise.all(s)}}}clone(){return new jz({data:re(this.data)})}hash(){return AW(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],D0.prototype,"color",void 0),u([d({json:{write:!0}})],D0.prototype,"data",void 0),u([De("data",["symbol"])],D0.prototype,"readData",null),u([Be("data",{})],D0.prototype,"writeData",null),u([ft({CIMSymbolReference:"cim"},{readOnly:!0})],D0.prototype,"type",void 0),D0=jz=u([P("esri.symbols.CIMSymbol")],D0);const fC=D0;let WT=class extends fe{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,r){e||(t[r]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],WT.prototype,"enabled",void 0),u([Be("enabled")],WT.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],WT.prototype,"type",void 0),WT=u([P("esri.symbols.Symbol3DLayer")],WT);const Pm=WT,ePe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,tPe="screenUtils.toPt: input not recognized!",gfe=96;function Fo(e){return e?e/72*gfe:0}function Qh(e){return e?72*e/gfe:0}function pi(e){if(typeof e=="string"){const t=e.match(ePe);if(t){const r=Number(t[1]),i=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=i==="px"?Qh(r):r;return s?-n:n}return console.warn(tPe),null}return e}function Kh(e=0,t=0){return{x:e,y:t}}function ds(e=0,t=0){return[e,t]}function yfe(e=0,t=0){return[e,t]}function ta(e=0,t=0,r=0){return[e,t,r]}function ixt(e){return e}function sxt(e){return e}function nxt(e){return e}function qf(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function hP(e){const t=OW(100*(1-e));return Math.max(0,Math.min(t,100))}function hE(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function rPe(e,t){const r=t.transparency!=null?hE(t.transparency):1,i=t.color;return i&&Array.isArray(i)?new Qe([i[0]||0,i[1]||0,i[2]||0,r]):null}function iPe(e,t){t.color=e.toJSON().slice(0,3);const r=hP(e.a);r!==0&&(t.transparency=r)}const Ay={type:Qe,json:{type:[Ri],default:null,read:{source:["color","transparency"],reader:rPe},write:{target:{color:{type:[Ri]},transparency:{type:Ri}},writer:iPe}}},bm={type:Number,cast:pi,json:{write:!0}};let U1=class extends fe{constructor(e){super(e),this.color=new Qe([0,0,0,1]),this.extensionLength=0,this.size=Qh(1)}clone(){}cloneProperties(){return{color:re(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],U1.prototype,"type",void 0),u([d(Ay)],U1.prototype,"color",void 0),u([d({...bm,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],U1.prototype,"extensionLength",void 0),u([d(bm)],U1.prototype,"size",void 0),U1=u([P("esri.symbols.edges.Edges3D")],U1);const fX=U1;var Hz;let mD=Hz=class extends fX{constructor(e){super(e),this.type="sketch"}clone(){return new Hz(this.cloneProperties())}};u([ft({sketch:"sketch"},{readOnly:!0})],mD.prototype,"type",void 0),mD=Hz=u([P("esri.symbols.edges.SketchEdges3D")],mD);const sPe=mD;var qz;let gD=qz=class extends fX{constructor(e){super(e),this.type="solid"}clone(){return new qz(this.cloneProperties())}};u([ft({solid:"solid"},{readOnly:!0})],gD.prototype,"type",void 0),gD=qz=u([P("esri.symbols.support.SolidEdges3D")],gD);const nPe=gD,_fe={types:{key:"type",base:fX,typeMap:{solid:nPe,sketch:sPe}},json:{write:!0}};var Wz;let $u=Wz=class extends fe{constructor(e){super(e),this.color=null}clone(){const e={color:v(this.color)?this.color.clone():null};return new Wz(e)}};u([d(Ay)],$u.prototype,"color",void 0),$u=Wz=u([P("esri.symbols.support.Symbol3DMaterial")],$u);var Xz;let N0=Xz=class extends Pm{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new Xz({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([ft({Extrude:"extrude"},{readOnly:!0})],N0.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],N0.prototype,"size",void 0),u([d({type:$u,json:{write:!0}})],N0.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],N0.prototype,"castShadows",void 0),u([d(_fe)],N0.prototype,"edges",void 0),N0=Xz=u([P("esri.symbols.ExtrudeSymbol3DLayer")],N0);const vfe=N0;let dR=class extends Gc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([ft({esriSLS:"simple-line"},{readOnly:!0})],dR.prototype,"type",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],dR.prototype,"width",void 0),dR=u([P("esri.symbols.LineSymbol")],dR);const oPe=dR,aPe=["begin","end","begin-end"],bfe=["arrow","circle","square","diamond","cross","x"];var Yz;let ff=Yz=class extends fe{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,i){t[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,i){(i==null?void 0:i.origin)==="web-map"||(t[r]=e)}clone(){return new Yz({color:re(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],ff.prototype,"placement",void 0),u([ft({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],ff.prototype,"type",void 0),u([d({type:bfe})],ff.prototype,"style",void 0),u([Be("style")],ff.prototype,"writeStyle",null),u([d({type:Qe,value:null,json:{write:{allowNull:!0}}})],ff.prototype,"color",null),u([De("color")],ff.prototype,"readColor",null),u([Be("color")],ff.prototype,"writeColor",null),ff=Yz=u([P("esri.symbols.LineSymbolMarker")],ff);const lPe=ff;var Zz;const W8=new Vr({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let pg=Zz=class extends oPe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,i,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),r!=null&&(o.width=pi(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=pi(n)),o}clone(){var e;return new Zz({color:re(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([ft({esriSLS:"simple-line"},{readOnly:!0})],pg.prototype,"type",void 0),u([d({type:W8.apiValues,json:{read:W8.read,write:W8.write}})],pg.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],pg.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],pg.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":lPe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],pg.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],pg.prototype,"miterLimit",void 0),pg=Zz=u([P("esri.symbols.SimpleLineSymbol")],pg);const ld=pg;let pR=class extends Gc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":ld}},json:{default:null,write:!0}})],pR.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],pR.prototype,"type",void 0),pR=u([P("esri.symbols.FillSymbol")],pR);const wfe=pR;let yD=class extends fe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],yD.prototype,"type",void 0),yD=u([P("esri.symbols.patterns.LinePattern3D")],yD);const xfe=yD,cPe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var Jz;const uPe=Ia()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let fR=Jz=class extends xfe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new Jz(e)}};u([d({type:["style"]})],fR.prototype,"type",void 0),u([ft(uPe),d({type:cPe})],fR.prototype,"style",void 0),fR=Jz=u([P("esri.symbols.patterns.LineStylePattern3D")],fR);const mX=fR;let _D=class extends fe{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],_D.prototype,"type",void 0),_D=u([P("esri.symbols.patterns.Pattern3D")],_D);const Tfe=_D,hPe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var Qz;let mR=Qz=class extends Tfe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new Qz(e)}};u([d({type:["style"]})],mR.prototype,"type",void 0),u([d({type:hPe,json:{read:!0,write:!0}})],mR.prototype,"style",void 0),mR=Qz=u([P("esri.symbols.patterns.StylePattern3D")],mR);const Sfe=mR,dPe={types:{key:"type",base:Tfe,typeMap:{style:Sfe}},json:{write:!0}},Efe={types:{key:"type",base:xfe,typeMap:{style:mX}},json:{write:!0}},I3=new Qe("white");new Qe("black");const pPe=new Qe([255,255,255,0]);function fPe(e){return e.r===0&&e.g===0&&e.b===0}var Kz;let $3=Kz=class extends $u{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:v(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new Kz(e)}};u([ft({multiply:"multiply",replace:"replace",tint:"tint"})],$3.prototype,"colorMixMode",void 0),$3=Kz=u([P("esri.symbols.support.Symbol3DFillMaterial")],$3);function ur(e=_Pe){return[e[0],e[1],e[2],e[3]]}function oxt(e){return[e[0],e[1],e[2],e[3]]}function my(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function gX(e,t,r,i,s=ur()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function Cfe(e,t=ur()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function V5(e,t){return new qr({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function yX(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function Q_(e,t,r){if(E(t))my(r,e);else if("length"in t)r7(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[0]),r[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":r[0]=Math.min(e[0],t.xmin),r[1]=Math.min(e[1],t.ymin),r[2]=Math.max(e[2],t.xmax),r[3]=Math.max(e[3],t.ymax);break;case"point":r[0]=Math.min(e[0],t.x),r[1]=Math.min(e[1],t.y),r[2]=Math.max(e[2],t.x),r[3]=Math.max(e[3],t.y)}}function X8(e,t,r=e){const i=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<i;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function e7(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function Au(e){return E(e)||e[0]>=e[2]?0:e[2]-e[0]}function Ip(e){return e[1]>=e[3]?0:e[3]-e[1]}function Afe(e){return Au(e)*Ip(e)}function _X(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Rfe(e,t){return B5(e,t[0],t[1])}function ree(e,t){const r=t[3],i=.5*(e[0]+e[2]),s=Math.abs(t[0]-i),n=.5*(e[2]-e[0]);if(s>r+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=r*r}function axt(e,t,r){const i=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=r,p=(b,x)=>(h-l)*b+(a-c)*x+(c*l-a*h)<0,f=p(i,o),m=p(n,o),y=p(n,s),_=p(i,s);return!(f===m&&m===y&&y===_&&_===f||a<i&&c<i||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function lxt(e,t){return B5(e,t.x,t.y)}function B5(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function mPe(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r}function z5(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function iee(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function t7(e,t,r){if(E(t))return my(r,e);const i=t[0],s=t[1],n=t[2],o=t[3];return r[0]=ye(e[0],i,n),r[1]=ye(e[1],s,o),r[2]=ye(e[2],i,n),r[3]=ye(e[3],s,o),r}function gPe(e,t){const r=(e[0]+e[2])/2,i=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-r)-Au(e)/2,0),n=Math.max(Math.abs(t[1]-i)-Ip(e)/2,0);return Math.sqrt(s*s+n*n)}function wF(e,t,r,i=e){return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+t,i[3]=e[3]+r,i}function ed(e){return e?my(e,i7):ur(i7)}function r7(e){return e!=null&&e.length===4}function yPe(e){return!(Au(e)!==0&&isFinite(e[0])||Ip(e)!==0&&isFinite(e[1]))}function cw(e,t){return r7(e)&&r7(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const cxt=[-1/0,-1/0,1/0,1/0],i7=[1/0,1/0,-1/0,-1/0],_Pe=[0,0,0,0];function In(e=$fe){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function $w(e,t,r,i,s,n,o=In()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function uxt(e,t){const r=isFinite(e[2])||isFinite(e[5]);return new qr(r?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function dE(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function vPe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function wm(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Pu(e,t,r=0,i=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<i;h++)s=Math.min(s,t[r+3*h]),n=Math.min(n,t[r+3*h+1]),o=Math.min(o,t[r+3*h+2]),a=Math.max(a,t[r+3*h]),l=Math.max(l,t[r+3*h+1]),c=Math.max(c,t[r+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function Y8(e,t,r){const i=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(r)for(let h=0;h<i;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<i;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function bPe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function _x(e){return e[0]>=e[3]?0:e[3]-e[0]}function vx(e){return e[1]>=e[4]?0:e[4]-e[1]}function Lv(e){return e[2]>=e[5]?0:e[5]-e[2]}function Ofe(e){const t=_x(e),r=Lv(e),i=vx(e);return Math.sqrt(t*t+r*r+i*i)}function hp(e,t=[0,0,0]){return t[0]=e[0]+_x(e)/2,t[1]=e[1]+vx(e)/2,t[2]=e[2]+Lv(e)/2,t}function gI(e,t=[0,0,0]){return t[0]=_x(e),t[1]=vx(e),t[2]=Lv(e),t}function vX(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function hxt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function wPe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function dp(e,t){return!!E(t)||wPe(e,t)}function Mfe(e,t,r,i,s=e){return s[0]=e[0]+t,s[1]=e[1]+r,s[2]=e[2]+i,s[3]=e[3]+t,s[4]=e[4]+r,s[5]=e[5]+i,s}function dxt(e,t,r=e){const i=e[0]+_x(e)/2,s=e[1]+vx(e)/2,n=e[2]+Lv(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=s+(e[1]-s)*t,r[2]=n+(e[2]-n)*t,r[3]=i+(e[3]-i)*t,r[4]=s+(e[4]-s)*t,r[5]=n+(e[5]-n)*t,r}function Pfe(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function Ife(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function G5(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function $i(e){return e?G5(e,see):In(see)}function bX(e,t){return t||(t=ur()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function pxt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function xPe(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=Number.NEGATIVE_INFINITY,e[3]=i,e[4]=s,e[5]=Number.POSITIVE_INFINITY,e}function s7(e){return e.length===6}function wX(e){return _x(e)===0&&vx(e)===0&&Lv(e)===0}function fxt(e,t,r){if(E(e)||E(t))return e===t;if(!s7(e)||!s7(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function TPe(e,t,r,i,s,n){return $w(e,t,r,i,s,n,SPe)}const mxt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],see=[1/0,1/0,1/0,-1/0,-1/0,-1/0],$fe=[0,0,0,0,0,0],SPe=In();function Z8(e,{isPrimitive:t,width:r,depth:i,height:s}){const n=t?10:1;if(r==null&&s==null&&i==null)return[n*e[0],n*e[1],n*e[2]];const o=Le(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const EPe=$w(-.5,-.5,-.5,.5,.5,.5),CPe=$w(-.5,-.5,0,.5,.5,1),APe=$w(-.5,-.5,0,.5,.5,.5);function RPe(e){switch(e){case"sphere":case"cube":case"diamond":return EPe;case"cylinder":case"cone":case"inverted-cone":return CPe;case"tetrahedron":return APe;default:return}}const xX=["butt","square","round"],OPe=[...xX,"none"],Lfe=["miter","bevel","round"];var n7;let k1=n7=class extends fe{constructor(e){super(e),this.color=new Qe([0,0,0,1]),this.size=Qh(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:v(this.color)?this.color.clone():null,size:this.size,pattern:v(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new n7(e)}};u([d(Ay)],k1.prototype,"color",void 0),u([d(bm)],k1.prototype,"size",void 0),u([d(Efe)],k1.prototype,"pattern",void 0),u([d({type:xX,json:{default:"butt",write:{overridePolicy(){return{enabled:v(this.pattern)}}}}})],k1.prototype,"patternCap",void 0),k1=n7=u([P("esri.symbols.support.Symbol3DOutline")],k1);var vD;let fg=vD=class extends Pm{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:v(this.edges)?this.edges.clone():null,enabled:this.enabled,material:v(this.material)?this.material.clone():null,pattern:v(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:v(this.outline)?this.outline.clone():null};return new vD(e)}static fromSimpleFillSymbol(e){var i,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new mX({style:e.outline.style}):null,r={size:(s=(i=e.outline)==null?void 0:i.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:I3).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(r.patternCap=e.outline.cap),new vD({material:new $3({color:((l=e.color)!=null?l:pPe).clone()}),pattern:e.style&&e.style!=="solid"?new Sfe({style:e.style}):null,outline:r})}};u([ft({Fill:"fill"},{readOnly:!0})],fg.prototype,"type",void 0),u([d({type:$3,json:{write:!0}})],fg.prototype,"material",void 0),u([d(dPe)],fg.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],fg.prototype,"castShadows",void 0),u([d({type:k1,json:{write:!0}})],fg.prototype,"outline",void 0),u([d(_fe)],fg.prototype,"edges",void 0),fg=vD=u([P("esri.symbols.FillSymbol3DLayer")],fg);const dP=fg,MPe=["none","underline","line-through"],PPe=["normal","italic","oblique"],IPe=["normal","lighter","bold","bolder"],Dfe={type:Number,cast:e=>{const t=Ph(e);return t===0?1:ye(t,.1,4)},nonNullable:!0},$Pe=["left","right","center"],LPe=["baseline","top","middle","bottom"],Nfe={type:$Pe,nonNullable:!0},Ffe={type:LPe,nonNullable:!0};var o7;let mg=o7=class extends fe{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return pi(e)}clone(){return new o7({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:MPe,json:{default:"none",write:!0}})],mg.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],mg.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],mg.prototype,"size",void 0),u([zt("size")],mg.prototype,"castSize",null),u([d({type:PPe,json:{default:"normal",write:!0}})],mg.prototype,"style",void 0),u([d({type:IPe,json:{default:"normal",write:!0}})],mg.prototype,"weight",void 0),mg=o7=u([P("esri.symbols.Font")],mg);const j5=mg,DPe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,NPe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function nee(e){const t=e==null?void 0:e.match(DPe);if(!t)return null;const[,r,i,s]=t;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:h}=NPe;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=h);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=h);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function FPe(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}const UPe=ee.getLogger("esri.core.urlUtils"),mC=ni.request,oee="esri/config: esriConfig.request.proxyUrl is not set.",Ufe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,kfe=/^\s*http:/i,kPe=/^\s*https:/i,VPe=/^\s*file:/i,BPe=/:\d+$/,zPe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,GPe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),jPe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class wS{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(GPe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(jPe),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}}const yI={},HPe=new wS(ni.applicationUrl);let Ja=HPe;const qPe=WPe();let TX=qPe;const SX=()=>Ja,gxt=()=>TX;function WPe(){const e=Ja.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${Ja.scheme}://${Ja.host}${Ja.port!=null?`:${Ja.port}`:""}`}${t}`}function po(e){if(!e)return null;const t={path:null,query:null},r=new wS(e),i=e.indexOf("?");return r.query===null?t.path=e:(t.path=e.substring(0,i),t.query=Vfe(r.query)),r.fragment&&(t.hash=r.fragment,r.query===null&&(t.path=t.path.substring(0,t.path.length-(r.fragment.length+1)))),t}function Vfe(e){const t=e.split("&"),r={};for(const i of t){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function aee(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function NO(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(t(r,e[r]))).join("&"):Object.keys(e).map(r=>{const i=e[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=t&&t[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>aee(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):aee(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function XPe(e=!1){let t,r=mC.proxyUrl;if(typeof e=="string"){t=tIe(e);const i=H5(e);i&&(r=i.proxyUrl)}else t=!!e;if(!r)throw UPe.warn(oee),new j("urlutils:proxy-not-set",oee);return t&&a7()&&(r=MX(r)),po(r)}function yxt(e){const t=H5(e);let r,i;if(t){const s=EX(t.proxyUrl);r=s.path,i=s.query?Vfe(s.query):null}if(r){const s=po(e);e=r+"?"+s.path;const n=NO({...i,...s.query});n&&(e=`${e}?${n}`)}return e}const QC={path:"",query:""};function EX(e){const t=e.indexOf("?");return t!==-1?(QC.path=e.slice(0,t),QC.query=e.slice(t+1)):(QC.path=e,QC.query=null),QC}function Bfe(e){return e=(e=TF(e=aIe(e=EX(e).path),!0)).toLowerCase()}function YPe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:Bfe(e.urlPrefix)},r=mC.proxyRules,i=t.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,t),s}function H5(e){const t=mC.proxyRules,r=Bfe(e);for(let i=0;i<t.length;i++)if(r.indexOf(t[i].urlPrefix)===0)return t[i]}function ZPe(e,t){if(!e||!t)return!1;e=xF(e),t=xF(t);const r=nee(e),i=nee(t);return v(r)&&v(i)?r.portalHostname===i.portalHostname:!v(r)&&!v(i)&&pE(e,t,!0)}function zfe(e,t){return e=xF(e),t=xF(t),TF(e)===TF(t)}function xF(e){const t=(e=jh(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function Gfe(e){const t=i=>i==null||i instanceof RegExp&&i.test(e)||typeof i=="string"&&e.startsWith(i),r=mC.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(t))return i}else if(t(i.urls))return i}return null}function pE(e,t,r=!1){if(!e||!t)return!1;const i=c7(e),s=c7(t);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function CX(e){if(typeof e=="string"){if(!Lu(e))return!0;e=c7(e)}if(pE(e,Ja))return!0;const t=mC.trustedServers||[];for(let r=0;r<t.length;r++){const i=JPe(t[r]);for(let s=0;s<i.length;s++)if(pE(e,i[s]))return!0}return!1}function JPe(e){return yI[e]||(OX(e)||xm(e)?yI[e]=[new wS(Ru(e))]:yI[e]=[new wS(`http://${e}`),new wS(`https://${e}`)]),yI[e]}function Ru(e,t=TX,r){return xm(e)?r&&r.preserveProtocolRelative?e:Ja.scheme==="http"&&Ja.authority===wp(e).slice(2)?`http:${e}`:`https:${e}`:OX(e)?e:ku(e[0]==="/"?nIe(t):t,e)}function AX(e,t=TX,r){if(e==null||!Lu(e))return e;const i=jh(e),s=i.toLowerCase(),n=jh(t).toLowerCase().replace(/\/+$/,""),o=r?jh(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=i.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function jh(e){return e=uIe(e=cIe(e=lIe(e=Ru(e=e.trim()))))}function ku(...e){const t=e.filter(v);if(!t||!t.length)return;const r=[];if(Lu(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),iIe(t[0])&&(r[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&r.push("");const i=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function wp(e,t=!1){if(e==null||fE(e)||Im(e))return null;let r=e.indexOf("://");if(r===-1&&xm(e))r=2;else{if(r===-1)return null;r+=3}const i=e.indexOf("/",r);return i!==-1&&(e=e.slice(0,i)),t&&(e=TF(e,!0)),e}function Lu(e){return xm(e)||OX(e)}function fE(e){return e!=null&&e.slice(0,5)==="blob:"}function Im(e){return e!=null&&e.slice(0,5)==="data:"}function RX(e){const t=pP(e);if(!t||!t.isBase64)return null;const r=atob(t.data),i=new Uint8Array(r.length);for(let s=0;s<r.length;s++)i[s]=r.charCodeAt(s);return i.buffer}function _xt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const QPe=/^data:(.*?)(;base64)?,(.*)$/;function pP(e){const t=e.match(QPe);if(!t)return null;const[,r,i,s]=t;return{mediaType:r,isBase64:!!i,data:s}}function jfe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function vxt(e){const t=RX(e);if(!t)return null;const r=pP(e);return new Blob([t],{type:r.mediaType})}function bxt(e,t){KPe(e,t)||eIe(e,t)}function KPe(e,t){if(!e)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(e);return r.download=t,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function eIe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function xm(e){return e!=null&&e[0]==="/"&&e[1]==="/"}function OX(e){return e!=null&&Ufe.test(e)}function tIe(e){return e!=null&&kPe.test(e)||Ja.scheme==="https"&&xm(e)}function rIe(e){return e!=null&&kfe.test(e)||Ja.scheme==="http"&&xm(e)}function iIe(e){return e!=null&&VPe.test(e)}function MX(e){return xm(e)?`https:${e}`:e.replace(kfe,"https:")}function sIe(){return Ja.scheme==="http"}function a7(){return Ja.scheme==="https"}function TF(e,t=!1){return xm(e)?e.slice(2):(e=e.replace(Ufe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function nIe(e){const t=e.indexOf("//"),r=e.indexOf("/",t+2);return r===-1?e:e.slice(0,r)}function oIe(e){let t=0;if(Lu(e)){const i=e.indexOf("//");i!==-1&&(t=i+2)}const r=e.lastIndexOf("/");return r<t?e:e.slice(0,r+1)}function wxt(e,t){if(!e)return"";const r=po(e).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(t!=null&&t.length))return i;const s=new RegExp(`.(${t.join("|")})$`,"ig");return i.replace(s,"")}function aIe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function Hfe(e){return e.replace(/\/+$/,"")}function lIe(e){if(/^https?:\/\//i.test(e)){const t=EX(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function cIe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function uIe(e){const t=mC.httpsDomains;if(!rIe(e))return e;const r=e.indexOf("/",7);let i;if(i=r===-1?e:e.slice(0,r),i=i.toLowerCase().slice(7),BPe.test(i)){if(!i.endsWith(":80"))return e;i=i.slice(0,-3),e=e.replace(":80","")}return sIe()&&i===Ja.authority&&!zPe.test(e)||(a7()&&i===Ja.authority||t&&t.some(s=>i===s||i.endsWith(`.${s}`))||a7()&&!H5(e))&&(e=MX(e)),e}function l7(e,t,r){if(!(t&&r&&e&&Lu(e)))return e;const i=e.indexOf("//"),s=e.indexOf("/",i+2),n=e.indexOf(":",i+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(i+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,i+2)}${r}${e.slice(o)}`}function c7(e){return typeof e=="string"?new wS(Ru(e)):(e.scheme||(e.scheme=Ja.scheme),e)}function qfe(e){return dIe.test(e)}function Wfe(e,t){const r=po(e),i=Object.keys(r.query||{});return i.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function PX(e,t,r){const i=po(e),s=i.query||{};return s[t]=String(r),`${i.path}?${NO(s)}`}function J8(e,t){const r=po(e),i=r.query||{};for(const n in t)i[n]=t[n];const s=NO(i);return s?`${r.path}?${s}`:r.path}function hIe(e){if(E(e))return null;const t=e.match(Xfe);return t?t[2]:null}function lee(e){if(E(e))return null;const t=e.match(Xfe);return t?{path:t[1],extension:t[2]}:{path:e,extension:null}}const Xfe=/([^.]*)\.([^\/]*)$/,dIe=/(^data:image\/svg|\.svg$)/i;function gC(e,t){const r=t&&t.url&&t.url.path;if(e&&r&&(e=Ru(e,r,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=AX(e,t.portalItem.itemUrl);i!=null&&pIe.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return u7(e,t&&t.portal)}function Lw(e,t,r=FO.YES){if(e==null)return e;!Lu(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let i=Ru(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=u7(s,t.portal),o=u7(i,t.portal);i=AX(o,n,n),i!=null&&i!==o&&i!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=Zfe(i,t==null?void 0:t.portal),Lu(i)&&(i=jh(i)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!Lu(i)&&!Im(i)&&r===FO.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i),compress:!1}),i}function IX(e,t,r){return gC(e,r)}function pv(e,t,r,i){const s=Lw(e,i);s!==void 0&&(t[r]=s)}const Yfe=/\/items\/([^\/]+)\/resources\/(.*)/,pIe=/^\.\/resources\//;function fIe(e){var t,r,i;return(i=(r=(t=e==null?void 0:e.match(Yfe))!=null?t:null)==null?void 0:r[1])!=null?i:null}function mIe(e){var o;const t=(o=e==null?void 0:e.match(Yfe))!=null?o:null;if(t==null)return null;const r=t[2],i=r.lastIndexOf("/");if(i===-1){const{path:a,extension:l}=lee(r);return{prefix:null,filename:a,extension:l}}const{path:s,extension:n}=lee(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function Zfe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?l7(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function u7(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const r=`${t.urlKey}.${t.customBaseUrl}`,i=SX();return pE(i,`${i.scheme}://${r}`)?l7(e,t.portalHostname,r):l7(e,r,t.portalHostname)}var FO;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(FO||(FO={}));const xxt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return FO},ensureMainOnlineDomain:Zfe,fromJSON:gC,itemIdFromResourceUrl:fIe,prefixAndFilenameFromResourceUrl:mIe,read:IX,toJSON:Lw,write:pv},Symbol.toStringTag,{value:"Module"}));var h7;const gIe=Ia()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let V1=h7=class extends fe{constructor(e){super(e)}readHref(e,t,r){return e?gC(e,r):t.dataURI}writeHref(e,t,r,i){e&&(Im(e)?t.dataURI=e:(t.href=Lw(e,i),Lu(t.href)&&(t.href=jh(t.href))))}clone(){return new h7({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],V1.prototype,"href",void 0),u([De("href")],V1.prototype,"readHref",null),u([Be("href",{href:{type:String},dataURI:{type:String}})],V1.prototype,"writeHref",null),u([ft(gIe)],V1.prototype,"primitive",void 0),V1=h7=u([P("esri.symbols.support.IconSymbol3DLayerResource")],V1);const yIe="circle";var d7;let W2=d7=class extends Te{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new d7({x:this.x,y:this.y})}};u([d({type:Number})],W2.prototype,"x",void 0),u([d({type:Number})],W2.prototype,"y",void 0),W2=d7=u([P("esri.symbols.support.Symbol3DAnchorPosition2D")],W2);var p7;let gR=p7=class extends fe{constructor(e){super(e),this.color=new Qe([0,0,0,1]),this.size=Qh(1)}clone(){const e={color:v(this.color)?this.color.clone():null,size:this.size};return new p7(e)}};u([d(Ay)],gR.prototype,"color",void 0),u([d(bm)],gR.prototype,"size",void 0),gR=p7=u([P("esri.symbols.support.Symbol3DIconOutline")],gR);var XT;const Jfe="esri.symbols.IconSymbol3DLayer";let mf=XT=class extends Pm{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new XT({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,outline:v(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||I3,r=cee(e),i=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||I3).clone()}:null;return new XT({size:e.size,resource:{primitive:vIe(e.style)},material:{color:t},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(e){const t=!e.color||fPe(e.color)?I3:e.color,r=cee(e);return new XT({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new XT({resource:{href:jfe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function cee(e){const t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,i=uee(e.xoffset),s=uee(e.yoffset);return(i||s)&&t&&r?{x:-i/t,y:s/r}:null}function uee(e){return isFinite(e)?e:0}u([d({type:$u,json:{write:!0}})],mf.prototype,"material",void 0),u([d({type:V1,json:{write:!0}})],mf.prototype,"resource",void 0),u([ft({Icon:"icon"},{readOnly:!0})],mf.prototype,"type",void 0),u([d(bm)],mf.prototype,"size",void 0),u([ft({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],mf.prototype,"anchor",void 0),u([d({type:W2,json:{type:[Number],read:{reader:e=>new W2({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],mf.prototype,"anchorPosition",void 0),u([d({type:gR,json:{write:!0}})],mf.prototype,"outline",void 0),mf=XT=u([P(Jfe)],mf);const _Ie={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function vIe(e){return _Ie[e]||(ee.getLogger(Jfe).warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const L_=mf;function gy(e,t,r=pt){return t||(t=new r),t===e||(t.removeAll(),bIe(e)?t.addMany(e):e&&t.add(e)),t}function $X(e){return e}function bIe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const Qfe="20230301",Kfe="2657e728c1857e6d94c324181c0788310bb0958a",LX="4.26",wIe={async request(e,t){var a,l;const{default:r}=await ie(()=>Promise.resolve().then(function(){return FIe}),void 0),i=e.options,s=i.responseType;i.signal=t==null?void 0:t.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&((a=Gfe(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await r(e.url,i),o={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((l=n.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Ci;function Txt(e){Ci=e}function Sxt(e){const t=Ci&&Ci.findCredential(e);return t&&t.token?PX(e,"token",t.token):e}de("host-webworker");const xIe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function eme(e){const t=wp(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!xIe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function tme(e,t,r=!1,i){return new Promise((s,n)=>{if(zn(i))return void n(hee());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n(hee())};const c=()=>{de("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,v(i)&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(t)};v(i)&&i.addEventListener("abort",l),de("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function hee(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function TIe(e){var r,i,s;ni.request.crossOriginNoCorsDomains||(ni.request.crossOriginNoCorsDomains={});const t=ni.request.crossOriginNoCorsDomains;for(let n of e)n=n.toLowerCase(),/^https?:\/\//.test(n)?t[(r=wp(n))!=null?r:""]=0:(t[(i=wp("http://"+n))!=null?i:""]=0,t[(s=wp("https://"+n))!=null?s:""]=0)}function SIe(e){const t=ni.request.crossOriginNoCorsDomains;if(t){let r=wp(e);if(r)return r=r.toLowerCase(),!pE(r,SX())&&t[r]<Date.now()-36e5}return!1}async function EIe(e){var s;const t=ni.request.crossOriginNoCorsDomains,r=wp(e);t&&r&&(t[r.toLowerCase()]=Date.now());const i=po(e);e=i.path,((s=i.query)==null?void 0:s.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function Di(e,t){var c;const r=Im(e),i=fE(e);i||r||(e=jh(e));const s={url:e,requestOptions:{...t}};let n=Gfe(e);if(n){const h=await $Ie(n,s);if(h!=null)return{data:h,getHeader:DX,httpStatus:200,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(de("host-webworker")||de("host-node"))throw pp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(r)throw pp("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw pp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw pp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await MIe(),SF)return SF.execute(e,t);const o=new AbortController;Ca(t,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Jd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await DIe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let SF;const Jd=ni.request,rme="FormData"in globalThis,CIe=[499,498,403,401],AIe=["COM_0056","COM_0057","SB_0008"],RIe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],DX=()=>null,EF=Symbol();function OIe(e){const t=wp(e);t&&!Di._corsServers.includes(t)&&Di._corsServers.push(t)}function dee(e){const t=wp(e);return!t||t.endsWith(".arcgis.com")||Di._corsServers.includes(t)||CX(t)}function pp(e,t,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:DX,ssl:!1};if(t instanceof j)return t.details?(t.details=re(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=n,t;if(t){const o=i&&(c=>i.headers.get(c)),a=i&&i.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=EF in t?t[EF]:t}return sn(t)?Wr():new j(e,s,n)}async function MIe(){de("host-webworker")?SF||(SF=await ie(()=>import("./request.062625c7.js"),[])):Di._abortableFetch||(Di._abortableFetch=globalThis.fetch.bind(globalThis))}async function f7(){Ci||await ie(()=>import("./IdentityManager.66a3def7.js"),[])}async function PIe(e){var a;const t=e.params.url,r=e.params.requestOptions,i=e.controller.signal,s=r.body;let n=null,o=null;if(rme&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:r.cacheBust&&!Di._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Jd.priority,redirect:"follow",signal:i},(n||o)&&(e.fetchOptions.body=n||o),r.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=r.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&ni.apiKey&&eme(t)&&(r.query||(r.query={}),r.query.token=ni.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!ime(t)&&!zn(i)){let l;r.authMode==="immediate"?(await f7(),l=await Ci.getCredential(t,{signal:i}),e.credential=l):r.authMode==="no-prompt"?(await f7(),l=await Ci.getCredential(t,{prompt:!1,signal:i}).catch(()=>{}),e.credential=l):Ci&&(l=Ci.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function ime(e){return RIe.some(t=>t.test(e))}async function IIe(e){var f,m;let t=e.params.url;const r=e.params.requestOptions,i=(f=e.fetchOptions)!=null?f:{},s=fE(t)||Im(t),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Jd.timeout;let a=!1;if(!s){e.useSSL&&(t=MX(t)),r.cacheBust&&i.cache==="default"&&(t=PX(t,"request.preventCache",Date.now()));let y={...r.query};e.credentialToken&&(y.token=e.credentialToken);let _=NO(y);de("esri-url-encodes-apostrophe")&&(_=_.replace(/'/g,"%27"));const b=t.length+1+_.length;let x;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||b>Jd.maxUrlLength;const T=r.useProxy||!!H5(t);if(T){const S=XPe(t);x=S.path,!a&&x.length+1+b>Jd.maxUrlLength&&(a=!0),S.query&&(y={...S.query,...y})}if(i.method==="HEAD"&&(a||T)){if(a)throw b>Jd.maxUrlLength?pp("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):pp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(T)throw pp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?t=J8(t,y):(i.body=NO(y),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):t=J8(t,y),T&&(e.useProxy=!0,t=`${x}?${t}`),y.token&&rme&&i.body instanceof FormData&&!FPe(t)&&i.body.set("token",y.token),r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!pE(t,SX())){if(CX(t))e.withCredentials=!0;else if(Ci){const S=Ci.findServerInfo(t);S&&S.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(i.credentials="include",SIe(t)&&await EIe(a?J8(t,y):t))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=t;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||LIe(r.headers)||!s&&!e.useProxy&&Jd.proxyUrl&&!dee(t)){if(l=await Di._abortableFetch(t,i),e.useProxy||OIe(t),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=pee(c,"application/xml");break;case"document":c=pee(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const y=l.headers.get("Content-Type");if(y&&/application\/json|text\/plain/i.test(y)&&c[n==="blob"?"size":"byteLength"]<=750)try{const _=await new Response(c).json();_.error&&(c=_)}catch{}}n==="image"&&c instanceof Blob&&(c=await fee(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await fee(t,e)}catch(y){if(y.name==="AbortError")throw p?new Error("Timeout exceeded"):Wr("Request canceled");if(!(!l&&y instanceof TypeError&&Jd.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||e.useProxy||dee(t))throw y;e.redoRequest=!0,YPe({proxyUrl:Jd.proxyUrl,urlPrefix:(m=wp(t))!=null?m:""})}finally{h&&clearTimeout(h)}return[l,c]}async function $Ie(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,i;try{i=await e.before(t)}catch(s){r=pp("request:interceptor",s,t)}if((i instanceof Error||i instanceof j)&&(r=pp("request:interceptor",i,t)),r)throw e.error&&e.error(r),r;return i}}function LIe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function pee(e,t){let r;try{r=new DOMParser().parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function DIe(e){var n,o;let t,r;await PIe(e);try{do[t,r]=await IIe(e);while(!await NIe(e,t,r))}catch(a){const l=pp("request:server",a,e.params,t);throw l.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(l),l}const i=e.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!e.hasToken&&!e.credentialToken&&((n=r.user)==null?void 0:n.username)&&!CX(i)){const a=wp(i,!0);a&&Jd.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&TIe(r.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&Ci){const a=Ci.findServerInfo(s.server);let l=a&&a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Ci.findCredential(l,s.userId);c&&Ci._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getHeader:t?a=>t==null?void 0:t.headers.get(a):DX,httpStatus:(o=t==null?void 0:t.status)!=null?o:200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function NIe(e,t,r){if(e.redoRequest)return e.redoRequest=!1,!1;const i=e.params.requestOptions;if(!t||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[EF]=r,s;r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[EF]=r,s.details=r.messages));let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o&&o.toUpperCase());const l=i.authMode;if(n===403&&(a===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&CIe.includes(n)&&!ime(e.params.url)&&(n!==403||o&&!AIe.includes(o)&&(a==null||a===2&&e.credentialToken))){await f7();try{const c=await Ci.getCredential(e.params.url,{error:pp("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=void 0,e.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function fee(e,t,r=!1){const i=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Jd.priority,s.src=e,tme(s,e,r,i)}Di._abortableFetch=null,Di._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var FIe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Di}),h_;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(h_||(h_={}));class UIe{constructor(t){this.instance=t,this._resolver=cv(),this._status=h_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=h_.RESOLVED,this._cleanUp()},()=>{this._status=h_.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===h_.RESOLVED}isRejected(){return this._status===h_.REJECTED}isFulfilled(){return this._status!==h_.PENDING}abort(){this._resolver.reject(Wr())}when(t,r){return this._resolver.promise.then(t,r)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=cv(),r=[...this._resolvingPromises,t.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==i||sn(s)||this._resolver.reject(s)}),t.resolve()}}const fP=e=>{let t=class extends e{constructor(...r){super(...r),this._promiseProps=new UIe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return t=u([P("esri.core.Promise")],t),t};let CF=class extends fP(Te){};CF=u([P("esri.core.Promise")],CF);const kIe="not-loaded",VIe="loading",BIe="failed",mee="loaded",sme=e=>{let t=class extends e{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=P5(n,l);this.destroyed&&l(new j("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===kIe){this._set("loadStatus",VIe);const a=this._loadController=new AbortController;s({signal:a.signal}),Ca(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",mee),this._loadController=null},i=>{this._set("loadStatus",BIe),this._set("loadError",i),this._loadController=null})}get loaded(){return this.loadStatus===mee}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new j("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return u([d({readOnly:!0})],t.prototype,"loaded",null),u([d({readOnly:!0})],t.prototype,"loadError",void 0),u([d({clonable:!1})],t.prototype,"loadStatus",void 0),u([d({type:[Uu],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([P("esri.core.Loadable")],t),t};let yR=class extends sme(CF){};yR=u([P("esri.core.Loadable")],yR),function(e){function t(r){return!(!r||!r.load)}e.LoadableMixin=sme,e.isLoadable=t}(yR||(yR={}));const Tm=yR;var m7;const zIe=new Vr({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let uh=m7=class extends Te{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new m7({categories:this.categories?re(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=gx(this.extent,Ye.WGS84);v(o)&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>zIe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...t,...n}}}};u([d()],uh.prototype,"categories",void 0),u([d()],uh.prototype,"disableExtraQuery",void 0),u([d({type:qr})],uh.prototype,"extent",void 0),u([d()],uh.prototype,"filter",void 0),u([d()],uh.prototype,"num",void 0),u([d()],uh.prototype,"query",void 0),u([d()],uh.prototype,"sortField",void 0),u([d()],uh.prototype,"sortOrder",null),u([d()],uh.prototype,"start",void 0),uh=m7=u([P("esri.portal.PortalQueryParams")],uh);const jg=uh;let B1=class extends Te{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],B1.prototype,"nextQueryParams",void 0),u([d()],B1.prototype,"queryParams",void 0),u([d()],B1.prototype,"results",void 0),u([d()],B1.prototype,"total",void 0),B1=u([P("esri.portal.PortalQueryResult")],B1);const GIe=B1;let gg=class extends fe{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new j("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],gg.prototype,"created",void 0),u([d()],gg.prototype,"id",void 0),u([d()],gg.prototype,"portal",void 0),u([d()],gg.prototype,"title",void 0),u([d({readOnly:!0})],gg.prototype,"url",null),u([d()],gg.prototype,"username",void 0),gg=u([P("esri.portal.PortalFolder")],gg);const jIe=gg;let So=class extends fe{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const e=this.url,t=this.thumbnail;return e&&t&&this.portal?(r=this.portal)==null?void 0:r.normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return Ul(this.portal).request(this.url+"/categorySchema",e).then(t=>{const r=t.categorySchema||[];return r.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return Ul(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new j("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let r=Us(jg,e);const i=Ul(this.portal);return parseFloat(i.currentVersion)>5?(r=r||new jg,i.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",t)):(r=r?r.clone():new jg,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,t))}_fetchCategorySchemaSet(e,t){const r=Ul(this.portal);return r.fetchSelf(r.authMode,!0,t).then(i=>{const s=i.contentCategorySetsGroupQuery;if(s){const n=new jg;return n.disableExtraQuery=!0,n.num=1,n.query=s,r.queryGroups(n,t)}throw new j("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const s=i.results[0],n=new jg;return n.num=1,n.query=`typekeywords:"${e}"`,s.queryItems(n,t)}throw new j("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(s=>{const n=s&&s.categorySchema;return n&&n.length?n:[]}):[])}};u([d()],So.prototype,"access",void 0),u([d({type:Date})],So.prototype,"created",void 0),u([d()],So.prototype,"description",void 0),u([d()],So.prototype,"id",void 0),u([d()],So.prototype,"isInvitationOnly",void 0),u([d({type:Date})],So.prototype,"modified",void 0),u([d()],So.prototype,"owner",void 0),u([d()],So.prototype,"portal",void 0),u([d()],So.prototype,"snippet",void 0),u([d()],So.prototype,"sortField",void 0),u([d()],So.prototype,"sortOrder",void 0),u([d()],So.prototype,"tags",void 0),u([d()],So.prototype,"thumbnail",void 0),u([d({readOnly:!0})],So.prototype,"thumbnailUrl",null),u([d()],So.prototype,"title",void 0),u([d({readOnly:!0})],So.prototype,"url",null),So=u([P("esri.portal.PortalGroup")],So);const g7=So;var HIe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:g7}),y7;let Os=y7=class extends fe{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal.normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,r=e&&e.data,i=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal.request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal.request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",r=e.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(t,i).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){var t;const e={query:{num:1}};return this.portal.request((t=this.userContentUrl)!=null?t:"",e).then(r=>{let i;return i=r&&r.folders?r.folders.map(s=>{const n=jIe.fromJSON(s);return n.portal=this.portal,n}):[],i})}fetchGroups(){var e;return this.portal.request((e=this.url)!=null?e:"").then(t=>{let r;return r=t&&t.groups?t.groups.map(i=>{const s=g7.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchItems(e){var s;const t=e!=null?e:{};let r,i=(s=this.userContentUrl)!=null?s:"";return t.folder&&(i+="/"+t.folder.id),ie(()=>Promise.resolve().then(function(){return i1e}),void 0).then(({default:n})=>{r=n;const o={folders:!1,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"};return this.portal.request(i,{query:o})}).then(n=>{let o;return n&&n.items?(o=n.items.map(a=>{const l=r.fromJSON(a);return l.portal=this.portal,l}),Promise.all(o.map(a=>a.load())).catch(a=>a).then(()=>({items:o,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new g7({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new j("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new j("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new y7;return t.sourceJSON=e,t.read(e),t}};u([d()],Os.prototype,"access",void 0),u([d({type:Date})],Os.prototype,"created",void 0),u([d()],Os.prototype,"culture",void 0),u([d()],Os.prototype,"description",void 0),u([d()],Os.prototype,"email",void 0),u([d()],Os.prototype,"favGroupId",void 0),u([d()],Os.prototype,"fullName",void 0),u([d({type:Date})],Os.prototype,"modified",void 0),u([d()],Os.prototype,"orgId",void 0),u([d()],Os.prototype,"portal",void 0),u([d()],Os.prototype,"preferredView",void 0),u([d()],Os.prototype,"privileges",void 0),u([d()],Os.prototype,"region",void 0),u([d()],Os.prototype,"role",void 0),u([d()],Os.prototype,"roleId",void 0),u([d()],Os.prototype,"sourceJSON",void 0),u([d()],Os.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Os.prototype,"thumbnailUrl",null),u([d()],Os.prototype,"units",void 0),u([d({readOnly:!0})],Os.prototype,"userContentUrl",null),u([d({readOnly:!0})],Os.prototype,"url",null),u([d()],Os.prototype,"username",void 0),u([d()],Os.prototype,"userType",void 0),Os=y7=u([P("esri.portal.PortalUser")],Os);const NX=Os;var qIe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:NX}),ru;let Q8;const gee={PortalGroup:()=>ie(()=>Promise.resolve().then(function(){return HIe}),void 0),PortalItem:()=>ie(()=>Promise.resolve().then(function(){return i1e}),void 0),PortalUser:()=>ie(()=>Promise.resolve().then(function(){return qIe}),void 0)};let je=ru=class extends nP(Tm){constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=ni.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriIdCredentialCreateHandle=zi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)ni.request.trustedServers.includes(t)||ni.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=NX.fromJSON(e),t.portal=this),t}load(e){const t=ie(()=>Promise.resolve().then(function(){return Zje}),void 0).then(({default:r})=>{cr(e),Q8=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,e)).then(r=>{if(Ci){const i=Ci;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==ru.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=i.on("credential-create",()=>{i.findCredential(this.restUrl)&&this.signIn().catch(()=>{})}))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await ie(()=>import("./ElevationLayer.e76e4e42.js"),["assets/ElevationLayer.e76e4e42.js","assets/ArcGISCachedService.83ce70a9.js","assets/TilemapCache.b23c161f.js"])).default;return e?e.map(r=>new t({id:r.id,url:r.url})):[]}fetchBasemaps(e,t){const r=new jg;return r.query=e||(ni.apiKey&&eme(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,t).then(i=>{if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',i.total){const s=i.results[0];return r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc",s.queryItems(r,t)}return null}).then(i=>{let s;return s=i&&i.total?i.results.filter(n=>n.type==="Web Map").map(n=>new Q8({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):zn(e)?Promise.reject(Wr()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,r=new jg;if(r.num=100,r.sortField="title",t&&t.length){const i=[];for(const s of t)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,e).then(s=>s.results)}return zn(e)?Promise.reject(Wr()):Promise.resolve([])}fetchRegions(e){var r;const t=((r=this.user)==null?void 0:r.culture)||this.culture||Gh();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){var r;const t=((r=this.user)==null?void 0:r.culture)||this.culture||Gh();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return ru._default&&!ru._default.destroyed||(ru._default=new ru),ru._default}queryGroups(e,t){return this.queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this.queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",t)}fetchSelf(e=this.authMode,t=!1,r){const i=this.restUrl+"/portals/self",s={authMode:e,query:{culture:Gh().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this.request(i,s)}queryPortal(e,t,r,i){const s=Us(jg,t),n=o=>this.request(this.restUrl+e,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new GIe({nextQueryParams:l,queryParams:s,total:a.total,results:ru._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Sc(l),a)));return r&&gee[r]?gee[r]().then(({default:o})=>(cr(i),n(o))):n()}signIn(){if(this.authMode===ru.AUTH_MODE_ANONYMOUS)return Promise.reject(new j("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this.fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Ci?Ci.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}requestToTypedArray(e,t,r){return this.request(e,t).then(i=>{const s=ru._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}request(e,t={}){const r={f:"json",...t.query},{authMode:i=this.authMode===ru.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return Di(this._normalizeSSL(e),c).then(h=>h.data)}toJSON(){throw new j("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new ru({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new j("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const t=Q8.fromJSON(e);return t.portalItem={portal:this},t}return null}static _resultsToTypedArray(e,t,r,i){let s=[];if(r){const n=v(i)?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};je.AUTH_MODE_ANONYMOUS="anonymous",je.AUTH_MODE_AUTO="auto",je.AUTH_MODE_IMMEDIATE="immediate",u([d()],je.prototype,"access",void 0),u([d()],je.prototype,"allSSL",void 0),u([d()],je.prototype,"authMode",void 0),u([d()],je.prototype,"authorizedCrossOriginDomains",void 0),u([De("authorizedCrossOriginDomains")],je.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],je.prototype,"basemapGalleryGroupQuery",void 0),u([d()],je.prototype,"bingKey",void 0),u([d()],je.prototype,"canListApps",void 0),u([d()],je.prototype,"canListData",void 0),u([d()],je.prototype,"canListPreProvisionedItems",void 0),u([d()],je.prototype,"canProvisionDirectPurchase",void 0),u([d()],je.prototype,"canSearchPublic",void 0),u([d()],je.prototype,"canShareBingPublic",void 0),u([d()],je.prototype,"canSharePublic",void 0),u([d()],je.prototype,"canSignInArcGIS",void 0),u([d()],je.prototype,"canSignInIDP",void 0),u([d()],je.prototype,"colorSetsGroupQuery",void 0),u([d()],je.prototype,"commentsEnabled",void 0),u([d({type:Date})],je.prototype,"created",void 0),u([d()],je.prototype,"credential",void 0),u([d()],je.prototype,"culture",void 0),u([d()],je.prototype,"currentVersion",void 0),u([d()],je.prototype,"customBaseUrl",void 0),u([d()],je.prototype,"defaultBasemap",void 0),u([De("defaultBasemap")],je.prototype,"readDefaultBasemap",null),u([d()],je.prototype,"defaultDevBasemap",void 0),u([De("defaultDevBasemap")],je.prototype,"readDefaultDevBasemap",null),u([d({type:qr})],je.prototype,"defaultExtent",void 0),u([d()],je.prototype,"defaultVectorBasemap",void 0),u([De("defaultVectorBasemap")],je.prototype,"readDefaultVectorBasemap",null),u([d()],je.prototype,"description",void 0),u([d()],je.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],je.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],je.prototype,"extraQuery",null),u([d()],je.prototype,"featuredGroups",void 0),u([d()],je.prototype,"featuredItemsGroupQuery",void 0),u([d()],je.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],je.prototype,"livingAtlasGroupQuery",void 0),u([d()],je.prototype,"hasCategorySchema",void 0),u([d()],je.prototype,"helpBase",void 0),u([d()],je.prototype,"helperServices",void 0),u([d()],je.prototype,"helpMap",void 0),u([d()],je.prototype,"homePageFeaturedContent",void 0),u([d()],je.prototype,"homePageFeaturedContentCount",void 0),u([d()],je.prototype,"httpPort",void 0),u([d()],je.prototype,"httpsPort",void 0),u([d()],je.prototype,"id",void 0),u([d()],je.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],je.prototype,"isOrganization",null),u([d()],je.prototype,"isPortal",void 0),u([d()],je.prototype,"isReadOnly",void 0),u([d({readOnly:!0})],je.prototype,"itemPageUrl",null),u([d()],je.prototype,"layerTemplatesGroupQuery",void 0),u([d()],je.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],je.prototype,"modified",void 0),u([d()],je.prototype,"name",void 0),u([d()],je.prototype,"portalHostname",void 0),u([d()],je.prototype,"portalMode",void 0),u([d()],je.prototype,"portalProperties",void 0),u([d()],je.prototype,"region",void 0),u([d({readOnly:!0})],je.prototype,"restUrl",null),u([d()],je.prototype,"rotatorPanels",void 0),u([d()],je.prototype,"showHomePageDescription",void 0),u([d()],je.prototype,"sourceJSON",void 0),u([d()],je.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],je.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],je.prototype,"stylesGroupQuery3d",void 0),u([d()],je.prototype,"supportsHostedServices",void 0),u([d()],je.prototype,"symbolSetsGroupQuery",void 0),u([d()],je.prototype,"templatesGroupQuery",void 0),u([d()],je.prototype,"thumbnail",void 0),u([d({readOnly:!0})],je.prototype,"thumbnailUrl",null),u([d()],je.prototype,"units",void 0),u([d()],je.prototype,"url",void 0),u([d()],je.prototype,"urlKey",void 0),u([De("urlKey")],je.prototype,"readUrlKey",null),u([d()],je.prototype,"user",void 0),u([De("user")],je.prototype,"readUser",null),u([d()],je.prototype,"useStandardizedQuery",void 0),u([d()],je.prototype,"useVectorBasemaps",void 0),u([d()],je.prototype,"vectorBasemapGalleryGroupQuery",void 0),je=ru=u([P("esri.portal.Portal")],je);const Uo=je;let z1=class extends Ss(fe){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return v(e)&&e.placement===this.placement&&e.style===this.style&&(E(this.color)&&E(e.color)||v(this.color)&&v(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],z1.prototype,"type",void 0),u([d({type:aPe,json:{default:"begin-end",write:!0}})],z1.prototype,"placement",void 0),u([d({type:bfe,json:{default:"arrow",write:!0}})],z1.prototype,"style",void 0),u([d({type:Qe,json:{type:[Ri],default:null,write:!0}})],z1.prototype,"color",void 0),z1=u([P("esri.symbols.LineStyleMarker3D")],z1);const _7=z1;var bD;let gf=bD=class extends Pm{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Qh(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:v(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:v(this.pattern)?this.pattern.clone():null,marker:v(this.marker)?this.marker.clone():null};return new bD(e)}static fromSimpleLineSymbol(e){var r,i,s;const t={enabled:!0,size:(r=e.width)!=null?r:Qh(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new mX({style:e.style}):null,material:new $u({color:(e.color||I3).clone()}),marker:e.marker?new _7({placement:e.marker.placement,style:e.marker.style,color:(s=(i=e.marker.color)==null?void 0:i.clone())!=null?s:null}):null};return new bD(t)}};u([d({type:$u,json:{write:!0}})],gf.prototype,"material",void 0),u([ft({Line:"line"},{readOnly:!0})],gf.prototype,"type",void 0),u([d({type:Lfe,json:{write:!0,default:"miter"}})],gf.prototype,"join",void 0),u([d({type:xX,json:{write:!0,default:"butt"}})],gf.prototype,"cap",void 0),u([d(bm)],gf.prototype,"size",void 0),u([d(Efe)],gf.prototype,"pattern",void 0),u([d({types:{key:"type",base:_7,typeMap:{style:_7}},json:{write:!0}})],gf.prototype,"marker",void 0),gf=bD=u([P("esri.symbols.LineSymbol3DLayer")],gf);const mP=gf;var v7;const WIe=Ia()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let _R=v7=class extends fe{clone(){return new v7({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:IX,write:pv}})],_R.prototype,"href",void 0),u([ft(WIe)],_R.prototype,"primitive",void 0),_R=v7=u([P("esri.symbols.support.ObjectSymbol3DLayerResource")],_R);const nme="sphere";var b7;let Ib=b7=class extends Te{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new b7({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],Ib.prototype,"x",void 0),u([d({type:Number})],Ib.prototype,"y",void 0),u([d({type:Number})],Ib.prototype,"z",void 0),Ib=b7=u([P("esri.symbols.support.Symbol3DAnchorPosition3D")],Ib);var w7;let Ba=w7=class extends Pm{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new w7({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:$u,json:{write:!0}})],Ba.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ba.prototype,"castShadows",void 0),u([d({type:_R,json:{write:!0}})],Ba.prototype,"resource",void 0),u([ft({Object:"object"},{readOnly:!0})],Ba.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Ba.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],Ba.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],Ba.prototype,"depth",void 0),u([ft({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],Ba.prototype,"anchor",void 0),u([d({type:Ib,json:{type:[Number],read:{reader:e=>new Ib({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ba.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],Ba.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],Ba.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],Ba.prototype,"roll",void 0),u([d({readOnly:!0})],Ba.prototype,"isPrimitive",null),Ba=w7=u([P("esri.symbols.ObjectSymbol3DLayer")],Ba);const FX=Ba;var x7;let El=x7=class extends Pm{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new x7({enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:$u,json:{write:!0}})],El.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],El.prototype,"castShadows",void 0),u([ft({Path:"path"},{readOnly:!0})],El.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],El.prototype,"profile",void 0),u([d({type:Lfe,json:{write:!0,default:"miter"}})],El.prototype,"join",void 0),u([d({type:OPe,json:{write:!0,default:"butt"}})],El.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],El.prototype,"width",void 0),u([De("width",["width","size","height"])],El.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],El.prototype,"height",void 0),u([De("height",["height","size","width"])],El.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],El.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],El.prototype,"profileRotation",void 0),El=x7=u([P("esri.symbols.PathSymbol3DLayer")],El);const UX=El;var T7;let X2=T7=class extends fe{constructor(){super(...arguments),this.color=new Qe([0,0,0,1]),this.size=0}clone(){const e={color:re(this.color),size:this.size};return new T7(e)}};u([d(Ay)],X2.prototype,"color",void 0),u([d(bm)],X2.prototype,"size",void 0),X2=T7=u([P("esri.symbols.support.Symbol3DHalo")],X2);let L3=class extends Ss(fe){constructor(e){super(e),this.color=null}};u([d(Ay)],L3.prototype,"color",void 0),L3=u([P("esri.symbols.support.Symbol3DTextBackground")],L3);var wD;let nc=wD=class extends Pm{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){v(e)&&v(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,r,i){const s={...i,textSymbol3D:!0};t.font=e.write({},s),delete t.font.size}get size(){return v(this._userSize)?this._userSize:v(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,v(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new wD({enabled:this.enabled,font:this.font&&re(this.font),halo:this.halo&&re(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:v(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:re(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new wD({font:v(e.font)?e.font.clone():new j5,halo:XIe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new $u({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new L3({color:e.backgroundColor.clone()}):null})}};function XIe(e,t){return e&&t!=null&&t>0?new X2({color:re(e),size:t}):null}u([d({type:j5,json:{write:!0}})],nc.prototype,"font",null),u([Be("font")],nc.prototype,"writeFont",null),u([d({type:X2,json:{write:!0}})],nc.prototype,"halo",void 0),u([d({...Nfe,json:{default:"center",write:!0}})],nc.prototype,"horizontalAlignment",void 0),u([d({...Dfe,json:{default:1,write:!0}})],nc.prototype,"lineHeight",void 0),u([d({type:$u,json:{write:!0}})],nc.prototype,"material",void 0),u([d({type:L3,json:{write:!0}})],nc.prototype,"background",void 0),u([d(bm)],nc.prototype,"size",null),u([d({type:String,json:{write:!0}})],nc.prototype,"text",void 0),u([ft({Text:"text"},{readOnly:!0})],nc.prototype,"type",void 0),u([d({...Ffe,json:{default:"baseline",write:!0}})],nc.prototype,"verticalAlignment",void 0),nc=wD=u([P("esri.symbols.TextSymbol3DLayer")],nc);const bx=nc;var S7;let F0=S7=class extends Pm{constructor(e){super(e),this.color=E7.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new S7({color:re(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:Qe,nonNullable:!0,json:{type:[Ri],write:(e,t,r)=>t[r]=e.toArray(Qe.AlphaMode.UNLESS_OPAQUE),default:()=>E7.clone(),defaultEquals:e=>e.toCss(!0)===E7.toCss(!0)}})],F0.prototype,"color",void 0),u([ft({Water:"water"},{readOnly:!0})],F0.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],F0.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],F0.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],F0.prototype,"waveStrength",void 0),F0=S7=u([P("esri.symbols.WaterSymbol3DLayer")],F0);const E7=new Qe([0,119,190]),ome=F0;var C7;let G1=C7=class extends Te{constructor(e){super(e),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new C7({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],G1.prototype,"name",void 0),u([d({type:String})],G1.prototype,"styleUrl",void 0),u([d({type:String})],G1.prototype,"styleName",void 0),u([d({type:Uo})],G1.prototype,"portal",void 0),G1=C7=u([P("esri.symbols.support.StyleOrigin")],G1);const A7=G1;var R7;let D3=R7=class extends Te{constructor(){super(...arguments),this.url=""}clone(){return new R7({url:this.url})}};u([d({type:String})],D3.prototype,"url",void 0),D3=R7=u([P("esri.symbols.support.Thumbnail")],D3);const ame={icon:L_,object:FX,line:mP,path:UX,fill:dP,extrude:vfe,text:bx,water:ome},YIe=pt.ofType({base:Pm,key:"type",typeMap:ame,errorContext:"symbol-layer"});let yf=class extends Gc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=t&&t.type||pt;this._set("symbolLayers",new r)}get color(){return null}set color(e){this.constructed&&ee.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){gy(e,this._get("symbolLayers"))}readStyleOrigin(e,t,r){if(e.styleUrl&&e.name){const i=gC(e.styleUrl,r);return new A7({styleUrl:i,name:e.name})}if(e.styleName&&e.name)return new A7({portal:r&&r.portal||Uo.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new Uu("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,t,r,i){if(e.styleUrl&&e.name){let s=Lw(e.styleUrl,i);Lu(s)&&(s=jh(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&i&&i.portal&&!zfe(e.portal.restUrl,i.portal.restUrl)?i&&i.messages&&i.messages.push(new Uu("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Pm||e&&ame[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],yf.prototype,"color",null),u([d({type:YIe,nonNullable:!0,json:{write:!0}}),zt($X)],yf.prototype,"symbolLayers",null),u([d({type:A7})],yf.prototype,"styleOrigin",void 0),u([De("styleOrigin")],yf.prototype,"readStyleOrigin",null),u([Be("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],yf.prototype,"writeStyleOrigin",null),u([d({type:D3,json:{read:!1}})],yf.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],yf.prototype,"type",void 0),yf=u([P("esri.symbols.Symbol3D")],yf);const yC=yf;let vR=class extends fe{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],vR.prototype,"type",void 0),u([d({readOnly:!0})],vR.prototype,"visible",void 0),vR=u([P("esri.symbols.callouts.Callout3D")],vR);const lme=vR;var O7;let xD=O7=class extends fe{constructor(){super(...arguments),this.color=new Qe("white")}clone(){return new O7({color:re(this.color)})}};u([d(Ay)],xD.prototype,"color",void 0),xD=O7=u([P("esri.symbols.callouts.LineCallout3DBorder")],xD);const cme=xD;Object.freeze(Object.defineProperty({__proto__:null,default:cme},Symbol.toStringTag,{value:"Module"}));var M7;let U0=M7=class extends lme{constructor(e){super(e),this.type="line",this.color=new Qe([0,0,0,1]),this.size=Qh(1),this.border=null}get visible(){return this.size>0&&v(this.color)&&this.color.a>0}clone(){return new M7({color:re(this.color),size:this.size,border:re(this.border)})}};u([ft({line:"line"},{readOnly:!0})],U0.prototype,"type",void 0),u([d(Ay)],U0.prototype,"color",void 0),u([d(bm)],U0.prototype,"size",void 0),u([d({type:cme,json:{write:!0}})],U0.prototype,"border",void 0),u([d({readOnly:!0})],U0.prototype,"visible",null),U0=M7=u([P("esri.symbols.callouts.LineCallout3D")],U0);const ZIe=U0;function kX(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||v(t.maxWorldLength)&&t.maxWorldLength<=0)}function ume(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!kX(e)}function VX(e){return e.type==="point-3d"||e.type==="label-3d"}function hme(e){return e.horizontalAlignment==="center"}const dme={types:{key:"type",base:lme,typeMap:{line:ZIe}},json:{write:!0}};var P7;let YT=P7=class extends fe{constructor(e){super(e),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new P7({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(bm)],YT.prototype,"screenLength",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0,default:0}})],YT.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],YT.prototype,"maxWorldLength",void 0),YT=P7=u([P("esri.symbols.support.Symbol3DVerticalOffset")],YT);const pme=YT;var TD;const fme=pt.ofType({base:null,key:"type",typeMap:{text:bx}});let k0=TD=class extends yC{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new fme,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return ume(this)}hasVisibleVerticalOffset(){return kX(this)}clone(){return new TD({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail),callout:re(this.callout),verticalOffset:re(this.verticalOffset)})}static fromTextSymbol(e){return new TD({symbolLayers:[bx.fromTextSymbol(e)]})}};u([d({type:pme,json:{write:!0}})],k0.prototype,"verticalOffset",void 0),u([d(dme)],k0.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],k0.prototype,"styleOrigin",void 0),u([d({type:fme})],k0.prototype,"symbolLayers",void 0),u([ft({LabelSymbol3D:"label-3d"},{readOnly:!0})],k0.prototype,"type",void 0),k0=TD=u([P("esri.symbols.LabelSymbol3D")],k0);const q5=k0;var SD;const mme=pt.ofType({base:null,key:"type",typeMap:{line:mP,path:UX}}),JIe=pt.ofType({base:null,key:"type",typeMap:{line:mP,path:UX}});let bR=SD=class extends yC{constructor(e){super(e),this.symbolLayers=new mme,this.type="line-3d"}clone(){return new SD({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleLineSymbol(e){return new SD({symbolLayers:[mP.fromSimpleLineSymbol(e)]})}};u([d({type:mme,json:{type:JIe}})],bR.prototype,"symbolLayers",void 0),u([ft({LineSymbol3D:"line-3d"},{readOnly:!0})],bR.prototype,"type",void 0),bR=SD=u([P("esri.symbols.LineSymbol3D")],bR);const W5=bR;let V0=class extends Gc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],V0.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],V0.prototype,"type",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],V0.prototype,"xoffset",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],V0.prototype,"yoffset",void 0),u([d({type:Number,cast:e=>e==="auto"?e:pi(e),json:{write:!0}})],V0.prototype,"size",void 0),V0=u([P("esri.symbols.MarkerSymbol")],V0);const gme=V0;var ED;const yme=pt.ofType({base:null,key:"type",typeMap:{fill:dP}});let wR=ED=class extends yC{constructor(e){super(e),this.symbolLayers=new yme,this.type="mesh-3d"}clone(){return new ED({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleFillSymbol(e){return new ED({symbolLayers:[dP.fromSimpleFillSymbol(e)]})}};u([d({type:yme})],wR.prototype,"symbolLayers",void 0),u([ft({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],wR.prototype,"type",void 0),wR=ED=u([P("esri.symbols.MeshSymbol3D")],wR);const X5=wR;function QIe(e,t,r){return t.imageData?jfe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):_me(t.url,r)}function _me(e,t){var r;return e$e(t)&&!Lu(e)&&((r=t==null?void 0:t.layer)==null?void 0:r.parsedUrl)?ku(t.layer.parsedUrl.path,"images",e):gC(e,t)}function KIe(e,t,r,i){if(Im(e)){const s=pP(e);if(!s)return;t.contentType=s.mediaType,t.imageData=s.data,r&&r.imageData===t.imageData&&r.url&&pv(r.url,t,"url",i)}else pv(e,t,"url",i)}const vme={json:{read:{source:["imageData","url"],reader:QIe},write:{writer(e,t,r,i){KIe(e,t,this.source,i)}}}},bme={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const i={};return t.imageData&&(i.imageData=t.imageData),t.contentType&&(i.contentType=t.contentType),t.url&&(i.url=_me(t.url,r)),i}}}};function e$e(e){var t,r;return!(e==null||e.origin!=="service"&&e.origin!=="portal-item"||((t=e.layer)==null?void 0:t.type)!=="feature"&&((r=e.layer)==null?void 0:r.type)!=="stream")}var I7;let hh=I7=class extends wfe{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),r!=null&&(s.width=pi(r)),i!=null&&(s.height=pi(i)),s}clone(){const e=new I7({color:re(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",re(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([ft({esriPFS:"picture-fill"},{readOnly:!0})],hh.prototype,"type",void 0),u([d(vme)],hh.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],hh.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],hh.prototype,"yscale",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],hh.prototype,"width",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],hh.prototype,"height",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],hh.prototype,"xoffset",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],hh.prototype,"yoffset",void 0),u([d(bme)],hh.prototype,"source",void 0),hh=I7=u([P("esri.symbols.PictureFillSymbol")],hh);const wme=hh;var $7;let Od=$7=class extends gme{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const i={};return e&&(i.url=e),t!=null&&(i.width=pi(t)),r!=null&&(i.height=pi(r)),i}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new $7({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",re(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],Od.prototype,"color",void 0),u([ft({esriPMS:"picture-marker"},{readOnly:!0})],Od.prototype,"type",void 0),u([d(vme)],Od.prototype,"url",void 0),u([d(bme)],Od.prototype,"source",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],Od.prototype,"height",void 0),u([De("height",["height","size"])],Od.prototype,"readHeight",null),u([d({type:Number,cast:pi,json:{write:!0}})],Od.prototype,"width",void 0),u([d({json:{write:!1}})],Od.prototype,"size",void 0),Od=$7=u([P("esri.symbols.PictureMarkerSymbol")],Od);const Y5=Od;var j1;const xme=pt.ofType({base:null,key:"type",typeMap:{icon:L_,object:FX,text:bx}});let H1=j1=class extends yC{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new xme,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return ume(this)}hasVisibleVerticalOffset(){return kX(this)}clone(){return new j1({verticalOffset:re(this.verticalOffset),callout:re(this.callout),styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new j1({symbolLayers:[L_.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new j1({symbolLayers:[L_.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var i,s;if(((s=(i=e.data)==null?void 0:i.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const r=e.data.symbol;return new j1(r!=null&&r.callout?{symbolLayers:[L_.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[L_.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new j1({symbolLayers:[bx.fromTextSymbol(e)]})}};u([d({type:pme,json:{write:!0}})],H1.prototype,"verticalOffset",void 0),u([d(dme)],H1.prototype,"callout",void 0),u([d({type:xme,json:{origins:{"web-scene":{write:!0}}}})],H1.prototype,"symbolLayers",void 0),u([ft({PointSymbol3D:"point-3d"},{readOnly:!0})],H1.prototype,"type",void 0),H1=j1=u([P("esri.symbols.PointSymbol3D")],H1);const D_=H1;var xR;const Tme=pt.ofType({base:null,key:"type",typeMap:{extrude:vfe,fill:dP,icon:L_,line:mP,object:FX,text:bx,water:ome}});let TR=xR=class extends yC{constructor(e){super(e),this.symbolLayers=new Tme,this.type="polygon-3d"}clone(){return new xR({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromJSON(e){const t=new xR;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const r=t.symbolLayers.getItemAt(0),i=t.symbolLayers.getItemAt(1);!i.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:v(i.material)?i.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new xR({symbolLayers:[dP.fromSimpleFillSymbol(e)]})}};u([d({type:Tme,json:{write:!0}})],TR.prototype,"symbolLayers",void 0),u([ft({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],TR.prototype,"type",void 0),TR=xR=u([P("esri.symbols.PolygonSymbol3D")],TR);const gP=TR;var L7;const K8=new Vr({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let q1=L7=class extends wfe{constructor(...e){super(...e),this.color=new Qe([0,0,0,.25]),this.outline=new ld,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.style=e),t&&(i.outline=t),r&&(i.color=r),i}clone(){return new L7({color:re(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],q1.prototype,"color",void 0),u([d()],q1.prototype,"outline",void 0),u([ft({esriSFS:"simple-fill"},{readOnly:!0})],q1.prototype,"type",void 0),u([d({type:K8.apiValues,json:{read:K8.read,write:K8.write}})],q1.prototype,"style",void 0),q1=L7=u([P("esri.symbols.SimpleFillSymbol")],q1);const Dv=q1;var D7;const ek=new Vr({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let _f=D7=class extends gme{constructor(...e){super(...e),this.color=new Qe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new ld}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=pi(t)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new D7({angle:this.angle,color:re(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([d()],_f.prototype,"color",void 0),u([Be("color")],_f.prototype,"writeColor",null),u([ft({esriSMS:"simple-marker"},{readOnly:!0})],_f.prototype,"type",void 0),u([d()],_f.prototype,"size",void 0),u([d({type:ek.apiValues,json:{read:ek.read,write:ek.write}})],_f.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],_f.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":ld}},json:{default:null,write:!0}})],_f.prototype,"outline",void 0),_f=D7=u([P("esri.symbols.SimpleMarkerSymbol")],_f);const Nv=_f;var N7;let zs=N7=class extends Gc{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new j5,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.text=e),t&&(i.font=t),r&&(i.color=r),i}writeLineWidth(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}castLineWidth(e){return pi(e)}writeLineHeight(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}clone(){return new N7({angle:this.angle,backgroundColor:re(this.backgroundColor),borderLineColor:re(this.borderLineColor),borderLineSize:this.borderLineSize,color:re(this.color),font:this.font&&this.font.clone(),haloColor:re(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:Qe,json:{write:!0}})],zs.prototype,"backgroundColor",void 0),u([d({type:Qe,json:{write:!0}})],zs.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0},cast:pi})],zs.prototype,"borderLineSize",void 0),u([d({type:j5,json:{write:!0}})],zs.prototype,"font",void 0),u([d({...Nfe,json:{write:!0}})],zs.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],zs.prototype,"kerning",void 0),u([d({type:Qe,json:{write:!0}})],zs.prototype,"haloColor",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],zs.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],zs.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],zs.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],zs.prototype,"text",void 0),u([ft({esriTS:"text"},{readOnly:!0})],zs.prototype,"type",void 0),u([d({...Ffe,json:{write:!0}})],zs.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],zs.prototype,"xoffset",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],zs.prototype,"yoffset",void 0),u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],zs.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],zs.prototype,"width",void 0),u([d({type:Number})],zs.prototype,"lineWidth",void 0),u([Be("lineWidth")],zs.prototype,"writeLineWidth",null),u([zt("lineWidth")],zs.prototype,"castLineWidth",null),u([d(Dfe)],zs.prototype,"lineHeight",void 0),u([Be("lineHeight")],zs.prototype,"writeLineHeight",null),zs=N7=u([P("esri.symbols.TextSymbol")],zs);const _C=zs;var F7;let Md=F7=class extends Gc{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=v(this.portal)?this.portal:Uo.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t==null?void 0:t.portal,super.read(e,t)}clone(){return new F7({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const r=v(t)?t.cache:null,i=r?this._fetchCacheKey:null;if(v(r)){const a=i&&r.get(i);if(a)return a.clone()}const s=await t$e();cr(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{ee.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(v(r)&&r.set(i,o.clone()),o):null}};function t$e(){return ie(()=>import("./webStyleSymbolUtils.e83354b4.js"),[])}u([d({json:{write:!1}})],Md.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Md.prototype,"styleName",void 0),u([d({type:Uo,json:{write:!1}})],Md.prototype,"portal",void 0),u([d({type:String,json:{read:IX,write:pv}})],Md.prototype,"styleUrl",void 0),u([d({type:D3,json:{read:!1}})],Md.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],Md.prototype,"name",void 0),u([ft({styleSymbolReference:"web-style"},{readOnly:!0})],Md.prototype,"type",void 0),u([d()],Md.prototype,"_fetchCacheKey",null),Md=F7=u([P("esri.symbols.WebStyleSymbol")],Md);const wx=Md;function Z5(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function mE(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const uw={base:Gc,key:"type",typeMap:{"simple-fill":Dv,"picture-fill":wme,"picture-marker":Y5,"simple-line":ld,"simple-marker":Nv,text:_C,"label-3d":q5,"line-3d":W5,"mesh-3d":X5,"point-3d":D_,"polygon-3d":gP,"web-style":wx,cim:fC},errorContext:"symbol"},r$e={base:Gc,key:"type",typeMap:{"picture-marker":Y5,"simple-marker":Nv,text:_C,"web-style":wx,cim:fC},errorContext:"symbol"},i$e=Pv({types:uw}),J5={base:Gc,key:"type",typeMap:{"simple-fill":Dv,"picture-fill":wme,"picture-marker":Y5,"simple-line":ld,"simple-marker":Nv,text:_C,"line-3d":W5,"mesh-3d":X5,"point-3d":D_,"polygon-3d":gP,"web-style":wx,cim:fC},errorContext:"symbol"},s$e={base:Gc,key:"type",typeMap:{text:_C,"label-3d":q5},errorContext:"symbol"},yee={base:Gc,key:"type",typeMap:{"line-3d":W5,"mesh-3d":X5,"point-3d":D_,"polygon-3d":gP,"web-style":wx,cim:fC},errorContext:"symbol"},n$e={base:Gc,key:"type",typeMap:{"label-3d":q5},errorContext:"symbol"},Sme=Op(uw);function o$e(e){if(!e)return null;const t={};for(const r in e){const i=gm(e[r]);i&&(t[r]=i)}return Object.keys(t).length!==0?t:null}function a$e(e){if(!v(e))return null;const t={};for(const r in e){const i=e[r];i&&(t[r]=i.toJSON())}return Object.keys(t).length!==0?t:null}let oc=class extends Ss(fe){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Lc(),configurable:!0})}normalizeCtorArgs(e,t,r,i){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:r,popupTemplate:i}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&v(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){var t;return(t=this.attributes)==null?void 0:t[e]}setAttribute(e,t){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:a$e(this.aggregateGeometries),geometry:v(this.geometry)?this.geometry.toJSON():null,symbol:v(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){v(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:r};e==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:o$e}})],oc.prototype,"aggregateGeometries",null),u([d({value:null})],oc.prototype,"attributes",null),u([d({value:null,types:yx,json:{read:gm}})],oc.prototype,"geometry",null),u([d({type:Boolean})],oc.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],oc.prototype,"layer",void 0),u([d({type:uP})],oc.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],oc.prototype,"sourceLayer",void 0),u([d({value:null,types:uw})],oc.prototype,"symbol",null),u([d({type:Boolean,value:!0})],oc.prototype,"visible",null),oc=u([P("esri.Graphic")],oc),function(e){e.generateUID=Lc}(oc||(oc={}));const Aa=oc;var U7;let B0=U7=class extends fe{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new U7({rotation:this.rotation,scale:this.scale,targetGeometry:v(this.targetGeometry)?this.targetGeometry.clone():null,camera:v(this.camera)?this.camera.clone():null})}};function tk(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:tk}}}}})],B0.prototype,"rotation",void 0),u([zt("rotation")],B0.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:tk}}}}})],B0.prototype,"scale",void 0),u([d({types:yx,json:{read:gm,write:!0,origins:{"web-scene":{read:gm,write:{overridePolicy:tk}}}}})],B0.prototype,"targetGeometry",void 0),u([d({type:Jh,json:{write:!0}})],B0.prototype,"camera",void 0),B0=U7=u([P("esri.Viewpoint")],B0);const Uc=B0;function Q5(e){return typeof e=="string"?document.getElementById(e):e!=null?e:null}function Eme(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function _ee(e,t){const r=t.parentNode;r&&r.insertBefore(e,t)}function vee(e,t){for(;;){const r=e.firstChild;if(!r)break;t.appendChild(r)}}class k7{constructor(t=r=>r.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(r=>{t(r)||this._items.delete(r)}),this}}var Ko;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(Ko||(Ko={}));let l$e=0;function Cme(){return l$e++}function c$e(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function UO(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function BX(e,t,r,i){if(t.type===Ko.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==Ko.INVOKE&&t.type!==Ko.RESPONSE)return void e.postMessage(t);let s;if(c$e(r)?(s=bee(r.transferList),t.data=r.result):(s=bee(i),t.data=r),s){if(de("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case Ko.INVOKE:throw o;case Ko.RESPONSE:return void BX(e,{type:Ko.RESPONSE,jobId:t.jobId,error:UO(o)})}}}e.postMessage(t,s)}else e.postMessage(t)}function kO(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function bee(e){if(!e||!e.length)return null;if(de("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(r=>!u$e(r));return t.length?t:null}function u$e(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const h$e={statsWorker:()=>ie(()=>import("./statsWorker.391c9d4d.js"),["assets/statsWorker.391c9d4d.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js"]),geometryEngineWorker:()=>ie(()=>import("./geometryEngineWorker.0d874716.js"),["assets/geometryEngineWorker.0d874716.js","assets/geometryEngineJSON.7d40f72f.js","assets/geometryEngineBase.871c2f6a.js","assets/json.5152e73f.js"]),CSVSourceWorker:()=>ie(()=>import("./CSVSourceWorker.908c6fb1.js"),["assets/CSVSourceWorker.908c6fb1.js","assets/json.5152e73f.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineCapabilities.ea616409.js","assets/number.45471352.js","assets/clientSideDefaults.c880334e.js"]),EdgeProcessingWorker:()=>ie(()=>import("./EdgeProcessingWorker.82856c71.js"),[]),ElevationSamplerWorker:()=>ie(()=>import("./ElevationSamplerWorker.38a284c6.js"),["assets/ElevationSamplerWorker.38a284c6.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/georeference.a4923933.js"]),FeatureServiceSnappingSourceWorker:()=>ie(()=>import("./FeatureServiceSnappingSourceWorker.2a6f044d.js"),["assets/FeatureServiceSnappingSourceWorker.2a6f044d.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineCapabilities.ea616409.js","assets/symbologySnappingCandidates.e65c661e.js"]),GeoJSONSourceWorker:()=>ie(()=>import("./GeoJSONSourceWorker.099eee22.js"),["assets/GeoJSONSourceWorker.099eee22.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineCapabilities.ea616409.js","assets/geojson.c0f03210.js","assets/clientSideDefaults.c880334e.js","assets/sourceUtils.8da292db.js"]),LercWorker:()=>ie(()=>import("./LercWorker.c1f9072d.js"),[]),MemorySourceWorker:()=>ie(()=>import("./MemorySourceWorker.09e5be64.js"),["assets/MemorySourceWorker.09e5be64.js","assets/objectIdUtils.e2ddfb9a.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineCapabilities.ea616409.js","assets/clientSideDefaults.c880334e.js","assets/sourceUtils.8da292db.js"]),PBFDecoderWorker:()=>ie(()=>import("./PBFDecoderWorker.d9bb2bee.js"),[]),Pipeline:()=>ie(()=>import("./Pipeline.1861f0cc.js").then(function(e){return e.P}),["assets/Pipeline.1861f0cc.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/StreamFeatureManager.36755ebd.js","assets/quickselect.2c5f2780.js","assets/arcadeTimeUtils.001f6459.js","assets/centroid.bdcfdd86.js","assets/ogcFeatureUtils.8f778f46.js","assets/geojson.c0f03210.js","assets/clientSideDefaults.c880334e.js","assets/createConnection.19b0ad4e.js","assets/enums.89506096.js","assets/TileInfoView.0e7c4da0.js","assets/number.dcd3e86c.js"]),PointCloudWorker:()=>ie(()=>import("./PointCloudWorker.e87a5938.js"),["assets/PointCloudWorker.e87a5938.js","assets/PointCloudWorkerUtil.cc594518.js","assets/PointCloudUniqueValueRenderer.0f882fcf.js","assets/I3SBinaryReader.4d236402.js"]),RasterWorker:()=>ie(()=>import("./RasterWorker.605154ad.js"),["assets/RasterWorker.605154ad.js","assets/dataUtils.118f21a1.js","assets/colorUtils.31a1b5d7.js","assets/utils.223d4124.js","assets/rasterProjectionHelper.e8a0406f.js"]),SceneLayerSnappingSourceWorker:()=>ie(()=>import("./SceneLayerSnappingSourceWorker.32903abc.js"),["assets/SceneLayerSnappingSourceWorker.32903abc.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js"]),SceneLayerWorker:()=>ie(()=>import("./SceneLayerWorker.bdfc6ad5.js").then(function(e){return e.S}),["assets/SceneLayerWorker.bdfc6ad5.js","assets/I3SNode.9784587b.js"]),WFSSourceWorker:()=>ie(()=>import("./WFSSourceWorker.e6f55f57.js"),["assets/WFSSourceWorker.e6f55f57.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineCapabilities.ea616409.js","assets/geojson.c0f03210.js","assets/sourceUtils.8da292db.js","assets/wfsUtils.f7501da4.js","assets/xmlUtils.e4562140.js"]),WorkerTileHandler:()=>ie(()=>import("./WorkerTileHandler.f40eb0b7.js"),["assets/WorkerTileHandler.f40eb0b7.js","assets/TileClipper.7b9dd3ce.js","assets/StyleRepository.831f4e35.js","assets/enums.89506096.js","assets/colorUtils.31a1b5d7.js","assets/Rect.e8e4d18d.js","assets/TurboLine.3075a6ee.js","assets/BidiEngine.f5b8c89f.js"])},{CLOSE:wee,ABORT:xee,INVOKE:Tee,RESPONSE:KC,OPEN_PORT:See,ON:d$e}=Ko,p$e=2;class f$e{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===Ko.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class Cc{static connect(t){const r=new MessageChannel;let i;i=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new Cc(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),Cc.clients.set(s,i),r.port2}static loadWorker(t){const r=h$e[t];return r?r():Promise.resolve(null)}constructor(t,r,i){this._port=t,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new f$e(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:wee}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,r,i){const s=i&&i.signal,n=i&&i.transferList;if(!this._port)return Promise.reject(new j("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:r}));const o=Cme();return new Promise((a,l)=>{if(zn(s))return this._processWork(),void l(Wr());const c=Ca(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),zi(p.abortHandle),this._post({type:xee,jobId:o}),l(Wr()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:Tee,jobId:o,methodName:t,abortable:s!=null},r,n)})}on(t,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:Ko.ON,eventType:t,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:Ko.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:See,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=p$e)return;const t=this._getNextJob();if(!t)return;const{methodName:r,data:i,invokeOptions:s,deferred:n}=t;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{zi(t.abortHandle),t.reject(Wr(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){v(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const r=kO(t);if(r)switch(r.type){case KC:this._onResponseMessage(r);break;case Tee:this._invokeQueue.push(r);break;case xee:this._onAbortMessage(r);break;case wee:this._onCloseMessage();break;case See:this._onOpenPortMessage(r);break;case d$e:this._onOnMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,s=r.get(i);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&Cc.clients.get(this)===t&&t.destroy(),Cc.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:r,jobId:i,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[r];try{if(!h&&r&&r.includes(".")){const p=r.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${r} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:KC,jobId:i,error:UO(p)})}Hu(l)?(a.set(i,{controller:o,promise:l}),l.then(p=>{a.has(i)&&(a.delete(i),this._post({type:KC,jobId:i},p))},p=>{a.has(i)&&(a.delete(i),sn(p)||this._post({type:KC,jobId:i,error:UO(p||{message:`Error encountered at method ${r}`})}))})):this._post({type:KC,jobId:i},l)}_onOpenPortMessage(t){new Cc(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:r}=t,i=this._client.on(t.eventType,n=>{r.postMessage(n)}),s=rP(t.port,"message",n=>{var o;((o=kO(n))==null?void 0:o.type)===Ko.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(t){const{jobId:r,error:i,data:s}=t,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),zi(o.abortHandle),i?o.reject(j.fromJSON(JSON.parse(i))):o.resolve(s)}_post(t,r,i){return BX(this._port,t,r,i)}}Cc.kernelInfo={revision:Kfe,version:LX,buildDate:Qfe},Cc.clients=new Map;class m$e{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new k7}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,r){return new Promise((i,s)=>{let n=!0;const o=a=>{cr(r.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];Hu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Cc(c,r,()=>{var h;return(h=this._ongoingJobsQueue.pop())!=null?h:null}),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Cc(l,r,()=>{var c;return(c=this._ongoingJobsQueue.pop())!=null?c:null}),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(t,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(t,r,i))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(Wr(`Worker closing, aborting job calling '${t.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,r,i){let s;Array.isArray(i)?(ee.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=cv();this._ongoingJobsQueue.push({methodName:t,data:r,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(t,r){return Promise.all(this._clientPromises).then(()=>eE(this._clients.map(i=>i.on(t,r))))}openPorts(){return new Promise(t=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&t(r)})})}get test(){return{numClients:this._clients.length}}}const g$e=ee.getLogger("esri.assets");function y$e(e,t){return Di(Kr(e),t)}function Kr(e){if(!ni.assetsPath)throw g$e.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new j("assets:path-not-set","config.assetsPath is not set");return ku(ni.assetsPath,e)}const Ame=ee.getLogger("esri.intl.substitute");function Ff(e,t,r={}){const{format:i={}}=r;return mm(e,s=>_$e(s,t,i))}function _$e(e,t,r){var l;let i,s;const n=e.indexOf(":");if(n===-1?i=e.trim():(i=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!i)return"";const o=eP(i,t);if(o==null)return"";const a=(l=s?r==null?void 0:r[s]:null)!=null?l:r==null?void 0:r[i];return a?v$e(o,a):s?b$e(o,s):zX(o)}function v$e(e,t){switch(t.type){case"date":return _m(e,t.intlOptions);case"number":return vm(e,t.intlOptions);default:return Ame.warn("missing format descriptor for key {key}"),zX(e)}}function b$e(e,t){switch(t.toLowerCase()){case"dateformat":return _m(e);case"numberformat":return vm(e);default:return Ame.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?_m(e):/^numberformat/i.test(t)?vm(e):zX(e)}}function zX(e){switch(typeof e){case"string":return e;case"number":return vm(e);case"boolean":return""+e;default:return e instanceof Date?_m(e):""}}const Eee=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,w$e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Cee(e){var t;return(t=w$e[e])!=null?t:!1}const SR=[],xS=new Map;function Aee(e){for(const t of xS.keys())Ome(e.pattern,t)&&xS.delete(t)}function x$e(e){return SR.includes(e)||(Aee(e),SR.unshift(e)),{remove(){const t=SR.indexOf(e);t>-1&&(SR.splice(t,1),Aee(e))}}}async function Rme(e){const t=Gh();xS.has(e)||xS.set(e,S$e(e,t));const r=xS.get(e);return r&&await E$e.add(r),r}function T$e(e){if(!Eee.test(e))return null;const t=Eee.exec(e);if(t===null)return null;const[,r,i]=t,s=r+(i?"-"+i.toUpperCase():"");return Cee(s)?s:Cee(r)?r:null}async function S$e(e,t){const r=[];for(const i of SR)if(Ome(i.pattern,e))try{return await i.fetchMessageBundle(e,t)}catch(s){r.push(s)}throw r.length?new j("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r}):new j("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function Ome(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}uX(()=>{xS.clear()});const E$e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=cv())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function C$e(e,t,r,i){const s=t.exec(r);if(!s)throw new j("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=T$e(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await Ree(e(c))}catch(p){if(c===l)throw new j("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p});try{h=await Ree(e(l))}catch(f){throw new j("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return h}async function Ree(e){if(v(Oee.fetchBundleAsset))return Oee.fetchBundleAsset(e);const t=await Di(e,{responseType:"text"});return JSON.parse(t.data)}class A$e{constructor({base:t="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,r){return C$e(this.getAssetUrl,this.matcher,t,r)}}function R$e(e){return new A$e(e)}const Oee={};x$e(R$e({pattern:"esri/",location:Kr}));const O$e={};function M$e(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=O$e.baseUrl),t}class P$e{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>t[r](...i)})}}class CD{constructor(){this._dispatcher=new P$e,this._workerPostMessage({type:Ko.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){tE(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,r,i){this._dispatcher.addEventListener(t,r,i)}removeEventListener(t,r,i){this._dispatcher.removeEventListener(t,r,i)}_workerPostMessage(t){tE(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const r=kO(t);if(r&&r.type===Ko.OPEN){const{modulePath:i,jobId:s}=r;let n=await Cc.loadWorker(i);n||(n=await ie(()=>import(i),[]));const o=Cc.connect(n);this._workerPostMessage({type:Ko.OPENED,jobId:s,data:o})}}}const V7=ee.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:I$e}=Ko,$$e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let _I,vI;const Mee="Failed to create Worker. Fallback to execute module in main thread";async function L$e(){if(!de("esri-workers")||(de("mozilla"),0))return Pee(new CD);if(!_I&&!vI)try{const t=$$e.split('"{CONFIGURATION}"').join(`'${D$e()}'`);_I=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){vI=t||{}}let e;if(_I)try{e=new Worker(_I,{name:"esri-worker-"+N$e++})}catch{V7.warn(Mee,vI),e=new CD}else V7.warn(Mee,vI),e=new CD;return Pee(e)}async function Pee(e){return new Promise(t=>{function r(s){const n=kO(s);n&&n.type===I$e&&(e.removeEventListener("message",r),e.removeEventListener("error",i),t(e))}function i(s){s.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",i),V7.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new CD).addEventListener("message",r),e.addEventListener("error",i)}e.addEventListener("message",r),e.addEventListener("error",i)})}function D$e(){let e;if(ni.default!=null){const s={...ni};delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(ni));e.assetsPath=Ru(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?Ru(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=Gh(),e.has={"esri-csp-restrictions":de("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":de("esri-2d-update-debug"),"featurelayer-pbf":de("featurelayer-pbf"),"featurelayer-simplify-thresholds":de("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":de("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":de("featurelayer-simplify-mobile-factor"),"esri-atomics":de("esri-atomics"),"esri-shared-array-buffer":de("esri-shared-array-buffer"),"esri-tiles-debug":de("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":de("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":de("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":de("polylabel-placement-enabled")},e.workers.loaderUrl&&(e.workers.loaderUrl=Ru(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=Ru(e.workers.workerPath):e.workers.workerPath=Ru(Kr("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=ni.workers.loaderConfig,r=M$e({baseUrl:t==null?void 0:t.baseUrl,locale:Gh(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t==null?void 0:t.has},map:{...t==null?void 0:t.map},paths:{...t==null?void 0:t.paths},packages:(t==null?void 0:t.packages)||[]}),i={version:LX,buildDate:Qfe,revision:Kfe};return JSON.stringify({esriConfig:e,loaderConfig:r,kernelInfo:i})}let N$e=0;const{ABORT:Iee,INVOKE:F$e,OPEN:U$e,OPENED:k$e,RESPONSE:eA}=Ko;class GX{static async create(t){const r=await L$e();return new GX(r,t)}constructor(t,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=r,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",i=>{i.preventDefault(),ee.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(t,r={}){const{signal:i}=r,s=Cme();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:P5(i,()=>{this._outJobs.delete(s),this._post({type:Iee,jobId:s})})};this._outJobs.set(s,a),this._post({type:U$e,jobId:s,modulePath:t})})}_onMessage(t){const r=kO(t);if(r)switch(r.type){case k$e:this._onOpenedMessage(r);break;case eA:this._onResponseMessage(r);break;case Iee:this._onAbortMessage(r);break;case F$e:this._onInvokeMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(t){const{methodName:r,jobId:i,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=wIe[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:eA,jobId:i,error:UO(h)})}Hu(c)?(a.set(i,{controller:o,promise:c}),c.then(h=>{a.has(i)&&(a.delete(i),this._post({type:eA,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),h||(h={message:"Error encountered at method"+r}),sn(h)||this._post({type:eA,jobId:i,error:UO(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:eA,jobId:i},c)}_onOpenedMessage(t){const{jobId:r,data:i}=t,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),zi(s.abortHandle),s.resolve(i))}_onResponseMessage(t){const{jobId:r,error:i,data:s}=t,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),zi(n.abortHandle),i?n.reject(j.fromJSON(JSON.parse(i))):n.resolve(s))}_post(t,r,i){return BX(this.worker,t,r,i)}}let Xb=de("esri-workers-debug")?1:de("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):de("host-browser")?navigator.hardwareConcurrency-1:0;Xb||(Xb=de("safari")&&de("mac")?7:2);let $ee=0;const AD=[];function V$e(){Pme()}async function bI(e,t){const r=new m$e;return await r.open(e,t),r}async function Mme(e,t={}){if(typeof e!="string")throw new j("workers:undefined-module","modulePath is missing");let r=t.strategy||"distributed";if(de("host-webworker")&&!de("esri-workers")&&(r="local"),r==="local"){let i=await Cc.loadWorker(e);i||(i=await ie(()=>import(e),[])),cr(t.signal);const s=t.client||i;return bI([Cc.connect(i)],{...t,client:s})}if(await Pme(),cr(t.signal),r==="dedicated"){const i=$ee++%Xb;return bI([await AD[i].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const i=Math.min(t.maxNumWorkers,Xb);if(i<Xb){const s=new Array(i);for(let n=0;n<i;++n){const o=$ee++%Xb;s[n]=AD[o].open(e,t)}return bI(s,t)}}return bI(AD.map(i=>i.open(e,t)),t)}let wI=null;async function Pme(){if(wI)return wI;new AbortController;const e=[];for(let t=0;t<Xb;t++){const r=GX.create(t).then(i=>(AD[t]=i,i));e.push(r)}return wI=Promise.all(e),wI}let om=class extends Te{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Jr,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,t,r={}){return this._installWatch(e,t,r,se)}addWhen(e,t,r={}){return this._installWatch(e,t,r,oa)}addOnCollectionChange(e,t,{initial:r=!1,final:i=!1}={}){const s=++this._handleId;return this._handles.add([dn(e,"after-changes",this._createSyncUpdatingCallback(),ri),dn(e,"change",t,{onListenerAdd:r?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:i?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this._handles.remove(s)}}addPromise(e){if(E(e))return e;const t=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(xI)||this._set("updating",!1))}},t),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this._handles.remove(t);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,r={},i){const s=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,s);const n=i(e,t,r);return this._handles.add(n,s),{remove:()=>this._handles.remove(s)}}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),i=se(e,r,{sync:!0,equals:()=>!1});return this._handles.add(i,t),i}_createSyncUpdatingCallback(){return()=>{this._handles.remove(xI),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(hC(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(xI))}),xI)}}};u([d({readOnly:!0})],om.prototype,"updating",void 0),om=u([P("esri.core.support.WatchUpdatingTracking")],om);const xI=-42,xx=e=>{let t=class extends e{destroy(){var r,i;this.destroyed||((r=this._get("handles"))==null||r.destroy(),(i=this._get("updatingHandles"))==null||i.destroy())}get handles(){return this._get("handles")||new Jr}get updatingHandles(){return this._get("updatingHandles")||new om}};return u([d({readOnly:!0})],t.prototype,"handles",null),u([d({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([P("esri.core.HandleOwner")],t),t};let VO=class extends xx(Te){};VO=u([P("esri.core.HandleOwner")],VO);let N3=class extends xx(pt){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{E(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(pt.ofType(this.itemType.Type))(e):new pt(e)}};function B7(e,t){return{type:e,cast:$X,set(r){const i=gy(r,this._get(t),e);i.owner=this,this._set(t,i)}}}u([d()],N3.prototype,"owner",null),N3=u([P("esri.core.support.OwningCollection")],N3);var ER;const AF=Ia()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Ime=AF.jsonValues.slice();EO(Ime,"orthometric");const F3=Ia()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Pd=ER=class extends fe{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return AF.write(e,t,r)}readHeightModel(e,t,r){return AF.read(e)||(r&&r.messages&&r.messages.push(B$e(e,{context:r})),null)}readHeightUnit(e,t,r){return F3.read(e)||(r&&r.messages&&r.messages.push(Lee(e,{context:r})),null)}readHeightUnitService(e,t,r){return _pe(e)||F3.read(e)||(r&&r.messages&&r.messages.push(Lee(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new ER({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=aOe(t);return new ER({heightModel:e.heightModel,heightUnit:r,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new ER;return t.read(e,{origin:"web-scene"}),t}};function Lee(e,t){return new Uu("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function B$e(e,t){return new Uu("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([d({type:AF.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Ime,default:"ellipsoidal"}}}})],Pd.prototype,"heightModel",void 0),u([Be("web-scene","heightModel")],Pd.prototype,"writeHeightModel",null),u([De(["web-scene","service"],"heightModel")],Pd.prototype,"readHeightModel",null),u([d({type:F3.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:F3.jsonValues,write:F3.write}}}})],Pd.prototype,"heightUnit",void 0),u([De("web-scene","heightUnit")],Pd.prototype,"readHeightUnit",null),u([De("service","heightUnit")],Pd.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Pd.prototype,"vertCRS",void 0),u([De("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Pd.prototype,"readVertCRS",null),Pd=ER=u([P("esri.geometry.HeightModelInfo")],Pd);const Fv=Pd;function Hn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function $m(e,t,r,i,s,n,o,a,l,c,h,p,f,m,y,_,b){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=f,e[12]=m,e[13]=y,e[14]=_,e[15]=b,e}function td(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kc(e,t){if(e===t){const r=t[1],i=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function vC(e,t){return ko(e,t)||td(e),e}function ko(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],b=t[14],x=t[15],T=r*a-i*o,S=r*l-s*o,C=r*c-n*o,O=i*l-s*a,R=i*c-n*a,$=s*c-n*l,I=h*_-p*y,U=h*b-f*y,V=h*x-m*y,G=p*b-f*_,z=p*x-m*_,Z=f*x-m*b;let Q=T*Z-S*z+C*G+O*V-R*U+$*I;return Q?(Q=1/Q,e[0]=(a*Z-l*z+c*G)*Q,e[1]=(s*z-i*Z-n*G)*Q,e[2]=(_*$-b*R+x*O)*Q,e[3]=(f*R-p*$-m*O)*Q,e[4]=(l*V-o*Z-c*U)*Q,e[5]=(r*Z-s*V+n*U)*Q,e[6]=(b*C-y*$-x*S)*Q,e[7]=(h*$-f*C+m*S)*Q,e[8]=(o*z-a*V+c*I)*Q,e[9]=(i*V-r*z-n*I)*Q,e[10]=(y*R-_*C+x*T)*Q,e[11]=(p*C-h*R-m*T)*Q,e[12]=(a*U-o*G-l*I)*Q,e[13]=(r*G-i*U+s*I)*Q,e[14]=(_*S-y*O-b*T)*Q,e[15]=(h*O-p*S+f*T)*Q,e):null}function z$e(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],b=t[14],x=t[15];return e[0]=a*(f*x-m*b)-p*(l*x-c*b)+_*(l*m-c*f),e[1]=-(i*(f*x-m*b)-p*(s*x-n*b)+_*(s*m-n*f)),e[2]=i*(l*x-c*b)-a*(s*x-n*b)+_*(s*c-n*l),e[3]=-(i*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*x-m*b)-h*(l*x-c*b)+y*(l*m-c*f)),e[5]=r*(f*x-m*b)-h*(s*x-n*b)+y*(s*m-n*f),e[6]=-(r*(l*x-c*b)-o*(s*x-n*b)+y*(s*c-n*l)),e[7]=r*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),e[8]=o*(p*x-m*_)-h*(a*x-c*_)+y*(a*m-c*p),e[9]=-(r*(p*x-m*_)-h*(i*x-n*_)+y*(i*m-n*p)),e[10]=r*(a*x-c*_)-o*(i*x-n*_)+y*(i*c-n*a),e[11]=-(r*(a*m-c*p)-o*(i*m-n*p)+h*(i*c-n*a)),e[12]=-(o*(p*b-f*_)-h*(a*b-l*_)+y*(a*f-l*p)),e[13]=r*(p*b-f*_)-h*(i*b-s*_)+y*(i*f-s*p),e[14]=-(r*(a*b-l*_)-o*(i*b-s*_)+y*(i*l-s*a)),e[15]=r*(a*f-l*p)-o*(i*f-s*p)+h*(i*l-s*a),e}function G$e(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],m=e[12],y=e[13],_=e[14],b=e[15];return(t*o-r*n)*(p*b-f*_)-(t*a-i*n)*(h*b-f*y)+(t*l-s*n)*(h*_-p*y)+(r*a-i*o)*(c*b-f*m)-(r*l-s*o)*(c*_-p*m)+(i*l-s*a)*(c*y-h*m)}function ws(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=t[9],m=t[10],y=t[11],_=t[12],b=t[13],x=t[14],T=t[15];let S=r[0],C=r[1],O=r[2],R=r[3];return e[0]=S*i+C*a+O*p+R*_,e[1]=S*s+C*l+O*f+R*b,e[2]=S*n+C*c+O*m+R*x,e[3]=S*o+C*h+O*y+R*T,S=r[4],C=r[5],O=r[6],R=r[7],e[4]=S*i+C*a+O*p+R*_,e[5]=S*s+C*l+O*f+R*b,e[6]=S*n+C*c+O*m+R*x,e[7]=S*o+C*h+O*y+R*T,S=r[8],C=r[9],O=r[10],R=r[11],e[8]=S*i+C*a+O*p+R*_,e[9]=S*s+C*l+O*f+R*b,e[10]=S*n+C*c+O*m+R*x,e[11]=S*o+C*h+O*y+R*T,S=r[12],C=r[13],O=r[14],R=r[15],e[12]=S*i+C*a+O*p+R*_,e[13]=S*s+C*l+O*f+R*b,e[14]=S*n+C*c+O*m+R*x,e[15]=S*o+C*h+O*y+R*T,e}function Yl(e,t,r){const i=r[0],s=r[1],n=r[2];if(t===e)e[12]=t[0]*i+t[4]*s+t[8]*n+t[12],e[13]=t[1]*i+t[5]*s+t[9]*n+t[13],e[14]=t[2]*i+t[6]*s+t[10]*n+t[14],e[15]=t[3]*i+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],m=t[7],y=t[8],_=t[9],b=t[10],x=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=f,e[7]=m,e[8]=y,e[9]=_,e[10]=b,e[11]=x,e[12]=o*i+h*s+y*n+t[12],e[13]=a*i+p*s+_*n+t[13],e[14]=l*i+f*s+b*n+t[14],e[15]=c*i+m*s+x*n+t[15]}return e}function K5(e,t,r){const i=r[0],s=r[1],n=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Pc(e,t,r,i){let s,n,o,a,l,c,h,p,f,m,y,_,b,x,T,S,C,O,R,$,I,U,V,G,z=i[0],Z=i[1],Q=i[2],te=Math.sqrt(z*z+Z*Z+Q*Q);return te<Pa()?null:(te=1/te,z*=te,Z*=te,Q*=te,s=Math.sin(r),n=Math.cos(r),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],f=t[5],m=t[6],y=t[7],_=t[8],b=t[9],x=t[10],T=t[11],S=z*z*o+n,C=Z*z*o+Q*s,O=Q*z*o-Z*s,R=z*Z*o-Q*s,$=Z*Z*o+n,I=Q*Z*o+z*s,U=z*Q*o+Z*s,V=Z*Q*o-z*s,G=Q*Q*o+n,e[0]=a*S+p*C+_*O,e[1]=l*S+f*C+b*O,e[2]=c*S+m*C+x*O,e[3]=h*S+y*C+T*O,e[4]=a*R+p*$+_*I,e[5]=l*R+f*$+b*I,e[6]=c*R+m*$+x*I,e[7]=h*R+y*$+T*I,e[8]=a*U+p*V+_*G,e[9]=l*U+f*V+b*G,e[10]=c*U+m*V+x*G,e[11]=h*U+y*V+T*G,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function gE(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*i,e[5]=o*s+h*i,e[6]=a*s+p*i,e[7]=l*s+f*i,e[8]=c*s-n*i,e[9]=h*s-o*i,e[10]=p*s-a*i,e[11]=f*s-l*i,e}function e6(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*i,e[1]=o*s-h*i,e[2]=a*s-p*i,e[3]=l*s-f*i,e[8]=n*i+c*s,e[9]=o*i+h*s,e[10]=a*i+p*s,e[11]=l*i+f*s,e}function yE(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*i,e[1]=o*s+h*i,e[2]=a*s+p*i,e[3]=l*s+f*i,e[4]=c*s-n*i,e[5]=h*s-o*i,e[6]=p*s-a*i,e[7]=f*s-l*i,e}function t6(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function j$e(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Vu(e,t,r){if(t===0)return td(e);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Pa()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*i,e[2]=l*o*n-a*i,e[3]=0,e[4]=o*a*n-l*i,e[5]=a*a*n+s,e[6]=l*a*n+o*i,e[7]=0,e[8]=o*l*n+a*i,e[9]=a*l*n-o*i,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function $me(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function H$e(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lme(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Dme(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=i+i,l=s+s,c=n+n,h=i*a,p=i*l,f=i*c,m=s*l,y=s*c,_=n*c,b=o*a,x=o*l,T=o*c;return e[0]=1-(m+_),e[1]=p+T,e[2]=f-x,e[3]=0,e[4]=p-T,e[5]=1-(h+_),e[6]=y+b,e[7]=0,e[8]=f+x,e[9]=y-b,e[10]=1-(h+m),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function q$e(e,t){const r=W$e,i=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=i*i+s*s+n*n+o*o;return p>0?(r[0]=2*(a*o+h*i+l*n-c*s)/p,r[1]=2*(l*o+h*s+c*i-a*n)/p,r[2]=2*(c*o+h*n+a*s-l*i)/p):(r[0]=2*(a*o+h*i+l*n-c*s),r[1]=2*(l*o+h*s+c*i-a*n),r[2]=2*(c*o+h*n+a*s-l*i)),Dme(e,t,r),e}const W$e=M();function X$e(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Nme(e,t){const r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(r*r+i*i+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function Y$e(e,t){const r=t[0]+t[5]+t[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function Z$e(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,_=n*h,b=o*h,x=a*l,T=a*c,S=a*h,C=i[0],O=i[1],R=i[2];return e[0]=(1-(y+b))*C,e[1]=(f+S)*C,e[2]=(m-T)*C,e[3]=0,e[4]=(f-S)*O,e[5]=(1-(p+b))*O,e[6]=(_+x)*O,e[7]=0,e[8]=(m+T)*R,e[9]=(_-x)*R,e[10]=(1-(p+y))*R,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function J$e(e,t,r,i,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,_=o*h,b=o*p,x=a*p,T=l*c,S=l*h,C=l*p,O=i[0],R=i[1],$=i[2],I=s[0],U=s[1],V=s[2],G=(1-(_+x))*O,z=(m+C)*O,Z=(y-S)*O,Q=(m-C)*R,te=(1-(f+x))*R,q=(b+T)*R,L=(y+S)*$,N=(b-T)*$,F=(1-(f+_))*$;return e[0]=G,e[1]=z,e[2]=Z,e[3]=0,e[4]=Q,e[5]=te,e[6]=q,e[7]=0,e[8]=L,e[9]=N,e[10]=F,e[11]=0,e[12]=r[0]+I-(G*I+Q*U+L*V),e[13]=r[1]+U-(z*I+te*U+N*V),e[14]=r[2]+V-(Z*I+q*U+F*V),e[15]=1,e}function Q$e(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,y=s*l,_=n*o,b=n*a,x=n*l;return e[0]=1-p-y,e[1]=h+x,e[2]=f-b,e[3]=0,e[4]=h-x,e[5]=1-c-y,e[6]=m+_,e[7]=0,e[8]=f+b,e[9]=m-_,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fme(e,t,r,i,s,n,o){const a=1/(r-t),l=1/(s-i),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+i)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function K$e(e,t,r,i,s){const n=1/Math.tan(t/2);let o;return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(i-s),e[10]=(s+i)*o,e[14]=2*s*i*o):(e[10]=-1,e[14]=-2*i),e}function eLe(e,t,r,i){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function Ume(e,t,r,i,s,n,o){const a=1/(t-r),l=1/(i-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(s+i)*l,e[14]=(o+n)*c,e[15]=1,e}function r6(e,t,r,i){let s,n,o,a,l,c,h,p,f,m;const y=t[0],_=t[1],b=t[2],x=i[0],T=i[1],S=i[2],C=r[0],O=r[1],R=r[2],$=Pa();return Math.abs(y-C)<$&&Math.abs(_-O)<$&&Math.abs(b-R)<$?td(e):(h=y-C,p=_-O,f=b-R,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,s=T*f-S*p,n=S*h-x*f,o=x*p-T*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*y+n*_+o*b),e[13]=-(a*y+l*_+c*b),e[14]=-(h*y+p*_+f*b),e[15]=1,e)}function kme(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=i[0],l=i[1],c=i[2];let h=s-r[0],p=n-r[1],f=o-r[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,_=c*h-a*f,b=a*p-l*h;return m=y*y+_*_+b*b,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,b*=m),e[0]=y,e[1]=_,e[2]=b,e[3]=0,e[4]=p*b-f*_,e[5]=f*y-h*b,e[6]=h*_-p*y,e[7]=0,e[8]=h,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function tLe(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function rLe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function iLe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Vme(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function sLe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function nLe(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function Bme(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function jX(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],_=e[13],b=e[14],x=e[15],T=t[0],S=t[1],C=t[2],O=t[3],R=t[4],$=t[5],I=t[6],U=t[7],V=t[8],G=t[9],z=t[10],Z=t[11],Q=t[12],te=t[13],q=t[14],L=t[15],N=Pa();return Math.abs(r-T)<=N*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-S)<=N*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(s-C)<=N*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(n-O)<=N*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(o-R)<=N*Math.max(1,Math.abs(o),Math.abs(R))&&Math.abs(a-$)<=N*Math.max(1,Math.abs(a),Math.abs($))&&Math.abs(l-I)<=N*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-U)<=N*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(h-V)<=N*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(p-G)<=N*Math.max(1,Math.abs(p),Math.abs(G))&&Math.abs(f-z)<=N*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(m-Z)<=N*Math.max(1,Math.abs(m),Math.abs(Z))&&Math.abs(y-Q)<=N*Math.max(1,Math.abs(y),Math.abs(Q))&&Math.abs(_-te)<=N*Math.max(1,Math.abs(_),Math.abs(te))&&Math.abs(b-q)<=N*Math.max(1,Math.abs(b),Math.abs(q))&&Math.abs(x-L)<=N*Math.max(1,Math.abs(x),Math.abs(L))}function HX(e){const t=Pa(),r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(r*r+n*n+l*l))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}function i6(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[8]===0&&e[9]===0&&e[10]===1}const oLe=ws,aLe=Vme;Object.freeze(Object.defineProperty({__proto__:null,add:iLe,adjoint:z$e,copy:Hn,determinant:G$e,equals:jX,exactEquals:Bme,frob:rLe,fromQuat:Q$e,fromQuat2:q$e,fromRotation:Vu,fromRotationTranslation:Dme,fromRotationTranslationScale:Z$e,fromRotationTranslationScaleOrigin:J$e,fromScaling:j$e,fromTranslation:t6,fromXRotation:$me,fromYRotation:H$e,fromZRotation:Lme,frustum:Fme,getRotation:Y$e,getScaling:Nme,getTranslation:X$e,hasIdentityRotation:i6,identity:td,invert:ko,invertOrIdentity:vC,isOrthoNormal:HX,lookAt:r6,mul:oLe,multiply:ws,multiplyScalar:sLe,multiplyScalarAndAdd:nLe,ortho:Ume,perspective:K$e,perspectiveFromFieldOfView:eLe,rotate:Pc,rotateX:gE,rotateY:e6,rotateZ:yE,scale:K5,set:$m,str:tLe,sub:aLe,subtract:Vme,targetTo:kme,translate:Yl,transpose:kc},Symbol.toStringTag,{value:"Module"}));let rk,oe=null;function zme(){return!!oe}function lLe(){return!!de("esri-wasm")}function Gme(){return rk||(rk=ie(()=>import("./pe-wasm.c681b595.js"),[]).then(e=>e.p).then(({default:e})=>e({locateFile:t=>Kr(`esri/geometry/support/${t}`)})).then(e=>{Hme(e)}),rk)}var z7,Hs,G7;(function(e){function t(n,o,a){oe.ensureCache.prepare();const l=$b(a),c=a===l,h=oe.ensureFloat64(l),p=oe._pe_geog_to_proj(oe.getPointer(n),o,h);return p&&x_(a,o,h,c),p}function r(n,o,a,l){switch(l){case Hs.PE_TRANSFORM_P_TO_G:return i(n,o,a);case Hs.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){oe.ensureCache.prepare();const c=$b(a),h=a===c,p=oe.ensureFloat64(c),f=oe._pe_proj_to_geog_center(oe.getPointer(n),o,p,l);return f&&x_(a,o,p,h),f}e.geogToProj=t,e.projGeog=r,e.projToGeog=i,e.projToGeogCenter=s})(z7||(z7={})),function(e){function t(){e.PE_BUFFER_MAX=oe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=oe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=oe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=oe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=oe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=oe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=oe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=oe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=oe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=oe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=oe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=oe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=oe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=oe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=oe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=oe.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=oe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=oe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=oe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=oe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=oe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=oe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=oe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=oe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=oe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=oe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=oe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=oe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=oe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=oe.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(Hs||(Hs={})),function(e){const t={},r={},i=m=>{if(m){const y=m.getType();switch(y){case Hs.PE_TYPE_GEOGCS:m=oe.castObject(m,oe.PeGeogcs);break;case Hs.PE_TYPE_PROJCS:m=oe.castObject(m,oe.PeProjcs);break;case Hs.PE_TYPE_GEOGTRAN:m=oe.castObject(m,oe.PeGeogtran);break;default:y&Hs.PE_TYPE_UNIT&&(m=oe.castObject(m,oe.PeUnit))}}return m};function s(){oe.PeFactory.prototype.initialize(null)}function n(m){return o(Hs.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,b=t[m];if(b||(b={},t[m]=b),b.hasOwnProperty(String(y)))_=b[y];else{const x=oe.PeFactory.prototype.factoryByType(m,y);oe.compare(x,oe.NULL)||(_=x,b[y]=_)}return _=i(_),_}function a(m,y){let _=null,b=r[m];if(b||(b={},r[m]=b),b.hasOwnProperty(y))_=b[y];else{const x=oe.PeFactory.prototype.fromString(m,y);oe.compare(x,oe.NULL)||(_=x,b[y]=_)}return _=i(_),_}function l(m){return o(Hs.PE_TYPE_GEOGCS,m)}function c(m){return o(Hs.PE_TYPE_GEOGTRAN,m)}function h(m){return oe.PeFactory.prototype.getCode(m)}function p(m){return o(Hs.PE_TYPE_PROJCS,m)}function f(m){return o(Hs.PE_TYPE_UNIT,m)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=f}(G7||(G7={}));let jme=null;var RF,j7,H7,q7,OF,W7,MF,PF,X7;function Hme(e){function t(n,o,a){n[o]=a(n[o])}oe=e,Hs.init(),RF.init(),OF.init(),MF.init(),PF.init(),jme=class extends oe.PeGCSExtent{destroy(){oe.destroy(this)}};const r=[oe.PeDatum,oe.PeGeogcs,oe.PeGeogtran,oe.PeObject,oe.PeParameter,oe.PePrimem,oe.PeProjcs,oe.PeSpheroid,oe.PeUnit];for(const n of r)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(Hs.PE_NAME_MAX))});for(const n of[oe.PeGeogtran,oe.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(Hs.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=oe.getValue(l,"*");a[c]=h?oe.wrapPointer(h,oe.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(oe.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return x_(a,o,n.call(this)),a}),t(oe.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=oe._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=oe.getPointer(l);for(let p=1;p<c;p++)a.push(oe.wrapPointer(h+o*p,oe.PeGTlistExtendedGTs))}}return a}});const i=oe._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=l.getNump();if(c>1){const h=oe.getPointer(l);for(let p=1;p<c;p++)a.push(oe.wrapPointer(h+i*p,oe.PeHorizon))}}return o.set(n,a),a};t(oe.PeProjcs.prototype,"horizonGcsGenerate",s),t(oe.PeProjcs.prototype,"horizonPcsGenerate",s),oe.PeObject.prototype.toString=function(n=Hs.PE_STR_OPTS_NONE){oe.ensureCache.prepare();const o=oe.getPointer(this),a=oe.ensureInt8(new Array(Hs.PE_BUFFER_MAX));return oe.UTF8ToString(oe._pe_object_to_string_ext(o,n,a))}}function jm(e){if(!e)return;const t=oe.getClass(e);if(!t)return;const r=oe.getCache(t);if(!r)return;const i=oe.getPointer(e);i&&delete r[i]}function TI(e,t){const r=[],i=new Array(t);for(let s=0;s<e;s++)r.push(oe.ensureInt8(i));return r}function $b(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(r=>{t.push(r[0],r[1])})):t=e,t}function x_(e,t,r,i=!1){if(i)for(let s=0;s<2*t;s++)e[s]=oe.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=oe.getValue(r,"double"),e[n][1]=oe.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function r(){e.PE_GTLIST_OPTS_COMMON=oe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=oe._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let h=null;const p=new oe.PeInteger(c);try{const f=oe.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=oe.getPointer(f);for(let y=1;y<c;y++)h.push(oe.wrapPointer(m+t*y,oe.PeGTlistExtendedEntry))}}finally{oe.destroy(p)}return h}e.init=r,e.getGTlist=i})(RF||(RF={})),function(e){function t(r){if(r&&r.length){for(const i of r)jm(i),i.getEntries().forEach(s=>{jm(s);const n=s.getGeogtran();jm(n),n.getParameters().forEach(jm),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{jm(o);const a=o.getDatum();jm(a),jm(a.getSpheroid()),jm(o.getPrimem()),jm(o.getUnit())})});oe.PeGTlistExtendedEntry.prototype.Delete(r[0])}}e.destroy=t}(j7||(j7={})),function(e){function t(r,i,s,n,o){oe.ensureCache.prepare();const a=$b(s),l=s===a,c=oe.ensureFloat64(a);let h=0;n&&(h=oe.ensureFloat64(n));const p=oe._pe_geog_to_geog(oe.getPointer(r),i,c,h,o);return p&&x_(s,i,c,l),p}e.geogToGeog=t}(H7||(H7={})),function(e){const t=(c,h,p,f,m,y)=>{let _,b;switch(oe.ensureCache.prepare(),c){case"dd":_=oe._pe_geog_to_dd,b=Hs.PE_DD_MAX;break;case"ddm":_=oe._pe_geog_to_ddm,b=Hs.PE_DDM_MAX;break;case"dms":_=oe._pe_geog_to_dms,b=Hs.PE_DMS_MAX}let x=0;h&&(x=oe.getPointer(h));const T=$b(f),S=oe.ensureFloat64(T),C=TI(p,b),O=_(x,p,S,m,oe.ensureInt32(C));if(O)for(let R=0;R<p;R++)y[R]=oe.UTF8ToString(C[R]);return O},r=(c,h,p,f,m)=>{let y;switch(oe.ensureCache.prepare(),c){case"dd":y=oe._pe_dd_to_geog;break;case"ddm":y=oe._pe_ddm_to_geog;break;case"dms":y=oe._pe_dms_to_geog}let _=0;h&&(_=oe.getPointer(h));const b=f.map(C=>oe.ensureString(C)),x=oe.ensureInt32(b),T=oe.ensureFloat64(new Array(2*p)),S=y(_,p,x,T);return S&&x_(m,p,T),S};function i(c,h,p,f,m){return t("dms",c,h,p,f,m)}function s(c,h,p,f){return r("dms",c,h,p,f)}function n(c,h,p,f,m){return t("ddm",c,h,p,f,m)}function o(c,h,p,f){return r("ddm",c,h,p,f)}function a(c,h,p,f,m){return t("dd",c,h,p,f,m)}function l(c,h,p,f){return r("dd",c,h,p,f)}e.geogToDms=i,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(q7||(q7={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=oe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=oe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,h){oe.ensureCache.prepare();let p=0;s&&(p=oe.getPointer(s));const f=$b(o),m=oe.ensureFloat64(f),y=TI(n,Hs.PE_MGRS_MAX),_=oe.ensureInt32(y),b=oe._pe_geog_to_mgrs_extended(p,n,m,a,l,c,_);if(b)for(let x=0;x<n;x++)h[x]=oe.UTF8ToString(y[x]);return b}function i(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=o.map(y=>oe.ensureString(y)),p=oe.ensureInt32(h),f=oe.ensureFloat64(new Array(2*n)),m=oe._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&x_(l,n,f),m}e.init=t,e.geogToMgrsExtended=r,e.mgrsToGeogExtended=i}(OF||(OF={})),function(e){function t(i,s,n,o,a,l,c){oe.ensureCache.prepare();let h=0;i&&(h=oe.getPointer(i));const p=$b(n),f=oe.ensureFloat64(p),m=TI(s,Hs.PE_MGRS_MAX),y=oe.ensureInt32(m),_=oe._pe_geog_to_usng(h,s,f,o,a,l,y);if(_)for(let b=0;b<s;b++)c[b]=oe.UTF8ToString(m[b]);return _}function r(i,s,n,o){oe.ensureCache.prepare();let a=0;i&&(a=oe.getPointer(i));const l=n.map(f=>oe.ensureString(f)),c=oe.ensureInt32(l),h=oe.ensureFloat64(new Array(2*s)),p=oe._pe_usng_to_geog(a,s,c,h);return p&&x_(o,s,h),p}e.geogToUsng=t,e.usngToGeog=r}(W7||(W7={})),function(e){function t(){e.PE_UTM_OPTS_NONE=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=oe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=$b(o),p=oe.ensureFloat64(h),f=TI(n,Hs.PE_UTM_MAX),m=oe.ensureInt32(f),y=oe._pe_geog_to_utm(c,n,p,a,m);if(y)for(let _=0;_<n;_++)l[_]=oe.UTF8ToString(f[_]);return y}function i(s,n,o,a,l){oe.ensureCache.prepare();let c=0;s&&(c=oe.getPointer(s));const h=o.map(y=>oe.ensureString(y)),p=oe.ensureInt32(h),f=oe.ensureFloat64(new Array(2*n)),m=oe._pe_utm_to_geog(c,n,p,a,f);return m&&x_(l,n,f),m}e.init=t,e.geogToUtm=r,e.utmToGeog=i}(MF||(MF={})),function(e){const t=new Map;function r(){e.PE_PCSINFO_OPTION_NONE=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=oe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=oe.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=oe.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=r,e.generate=i}(PF||(PF={})),function(e){function t(){return oe.PeVersion.prototype.version_string()}e.versionString=t}(X7||(X7={}));const cLe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return z7},get PeDefs(){return Hs},get PeFactory(){return G7},get PeGCSExtent(){return jme},get PeGTTransformations(){return H7},get PeGTlistExtended(){return RF},get PeGTlistExtendedEntry(){return j7},get PeNotationDms(){return q7},get PeNotationMgrs(){return OF},get PeNotationUsng(){return W7},get PeNotationUtm(){return MF},get PePCSInfo(){return PF},get PeVersion(){return X7},_init:Hme,get _pe(){return oe},isLoaded:zme,isSupported:lLe,load:Gme},Symbol.toStringTag,{value:"Module"})),Ext=Math.PI/180,Cxt=/SPHEROID\[([^\]]+)]/i,Qy=br.radius,gd=br.eccentricitySquared,uLe={a1:Qy*gd,a2:Qy*gd*Qy*gd,a3:Qy*gd*gd/2,a4:Qy*gd*Qy*gd*2.5,a5:Qy*gd+Qy*gd*gd/2,a6:1-gd},Axt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:br.radius,f:br.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:fy.radius,f:fy.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:nm.radius,f:nm.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:nm.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let SI=0;class TS{static fromGE(t){const r=new TS;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r}constructor(t){this.uid=SI++,t?(this._wkt=t.wkt!=null?t.wkt:null,this._wkid=t.wkid!=null?t.wkid:-1,this._isInverse=t.isInverse!=null&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=SI++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=SI++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=SI++}getInverse(){const t=new TS;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class N_{static cacheKey(t,r){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(t){const r=new N_;let i="";for(const s of t.steps){const n=TS.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(t){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const r of t.steps)r instanceof TS?this.steps.push(r):this.steps.push(new TS({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const t=new N_;t.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];t.steps.push(i.getInverse())}return t}getGTListEntry(){let t="";for(const r of this.steps)t+=r.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=t),this._gtlistentry}assignCachedGe(t,r,i){this._cachedProjection[N_.cacheKey(t,r)]=i}getCachedGeTransformation(t,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[N_.cacheKey(t,r)];return s===void 0?null:s}}function qme(e,t,r){if(E(t)||E(r)||r.vcsWkid||Pn(t,r))return null;const i=Rw(t)/Rw(r);if(i===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>hLe(s,i);case"polyline":case"esriGeometryPolyline":return s=>pLe(s,i);case"polygon":case"esriGeometryPolygon":return s=>dLe(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>fLe(s,i);case"extent":case"esriGeometryExtent":return s=>mLe(s,i);default:return null}}function hLe(e,t){e&&e.z!=null&&(e.z*=t)}function dLe(e,t){if(e)for(const r of e.rings)for(const i of r)i.length>2&&(i[2]*=t)}function pLe(e,t){if(e)for(const r of e.paths)for(const i of r)i.length>2&&(i[2]*=t)}function fLe(e,t){if(e)for(const r of e.points)r.length>2&&(r[2]*=t)}function mLe(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let K_=null,BO=null,ik=null,sk={};const Wme=new aX;function qX(){return!!K_&&zme()}function IF(e){return E(ik)&&(ik=Promise.all([Gme(),ie(()=>import("./geometryEngineBase.871c2f6a.js"),[]).then(t=>t.g),ie(()=>import("./hydrated.9342ac27.js"),[])])),ik.then(([,t,{hydratedAdapter:r}])=>{cr(e),BO=r,K_=t.default,K_._enableProjection(cLe),Wme.notify()})}function bC(e,t,r=null,i=null){return Array.isArray(e)?e.length===0?[]:Dee(BO,e,e[0].spatialReference,t,r,i):Dee(BO,[e],e.spatialReference,t,r,i)[0]}function Dee(e,t,r,i,s=null,n=null){if(E(r)||E(i))return t;if(fv(r,i,s))return t.map(o=>Xme(o,r,i));if(E(s)){const o=N_.cacheKey(r,i);sk[o]!==void 0?s=sk[o]:(s=yLe(r,i,void 0),E(s)&&(s=new N_),sk[o]=s)}if(E(K_)||E(e))throw new WX;return v(n)?K_._project(e,t,r,i,s,n):K_._project(e,t,r,i,s)}function Rxt(e,t){const r=gLe([e],t);return v(r.pending)?{pending:r.pending,geometry:null}:v(r.geometries)?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function gLe(e,t){if(!qX()){for(const r of e)if(v(r)&&!Pn(r.spatialReference,t)&&Ta(r.spatialReference)&&Ta(t)&&!fv(r.spatialReference,t))return vr(Wme),{pending:IF(),geometries:null}}return{pending:null,geometries:e.map(r=>E(r)?null:Pn(r.spatialReference,t)?r:Ta(r.spatialReference)&&Ta(t)?_Le(r,t):null)}}function yLe(e,t,r=null){if(E(e)||E(t))return null;if(E(K_)||E(BO))throw new WX;const i=K_._getTransformation(BO,e,t,r,r==null?void 0:r.spatialReference);return i!==null?N_.fromGE(i):null}class WX extends j{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var J;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(J||(J={}));function _Le(e,t){try{const r=bC(e,t);if(r==null)return null;"xmin"in e&&"xmin"in r&&(r.zmin=e.zmin,r.zmax=e.zmax);const i=qme(r.type,e.spatialReference,t);return v(i)&&i(r),r}catch(r){if(!(r instanceof WX))throw r;return null}}function fv(e,t,r){return!r&&(!!Pn(e,t)||Ta(e)&&Ta(t)&&!!JX(e,t,KX))}async function vLe(e,t,r,i){if(qX())return wK(i);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!fv(s,n,o))return IF(i)}else if(!fv(e,t,r))return IF(i);return wK(i)}function Oxt(e,t){switch(JX(e,t,KX)){case Ui:return"copy3";case U_:return"wgs84ToSphericalECEF";case Dw:return"wgs84ToWebMercator";case F_:return"wgs84ToPlateCarree";case V_:return"wgs84ToWGS84ECEF";case hw:return"webMercatorToWGS84";case ege:return"webMercatorToSphericalECEF";case tge:return"webMercatorToWGS84ECEF";case rge:return"webMercatorToPlateCarree";case B_:return"wgs84ECEFToWGS84";case nge:return"wgs84ECEFToSphericalECEF";case oge:return"wgs84ECEFToWebMercator";case k_:return"sphericalECEFToWGS84";case ige:return"sphericalECEFToWebMercator";case Q7:return"sphericalMarsPCPFToMars2000";case J7:return"sphericalMoonPCPFToMoon2000";case sge:return"sphericalECEFToWGS84ECEF";case Z7:return"mars2000ToSphericalPCPF";case Y7:return"moon2000ToSphericalPCPF";default:return null}}function Xme(e,t,r){return e?"x"in e?Yme(e,t,new yt,r,0):"xmin"in e?TLe(e,t,new qr,r,0):"rings"in e?Zme(e,t,new Pp,r,0):"paths"in e?xLe(e,t,new up,r,0):"points"in e?wLe(e,t,new oP,r,0):null:null}function bLe(e,t,r=t.spatialReference,i=0){return v(r)&&v(e.spatialReference)&&v(Yme(e,e.spatialReference,t,r,i))}function Yme(e,t,r,i,s){ii[0]=e.x,ii[1]=e.y;const n=e.z;return ii[2]=n!==void 0?n:s,Ts(ii,t,0,ii,i,0,1)?(r.x=ii[0],r.y=ii[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=ii[2],r.hasZ=!0),e.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=e.m,r.hasM=!0),r):null}function wLe(e,t,r,i,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!Ts(h,t,0,h,i,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function xLe(e,t,r,i,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return Qme(n,o!=null?o:!1,a!=null?a:!1,t,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function Mxt(e,t,r=t.spatialReference,i=0){return v(e.spatialReference)&&v(r)&&v(Zme(e,e.spatialReference,t,r,i))}function Zme(e,t,r,i,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return Qme(n,o!=null?o:!1,a!=null?a:!1,t,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function TLe(e,t,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return Nee(n,o,c?e.zmin:s,t,ii,i)?(r.xmin=ii[0],r.ymin=ii[1],c&&(r.zmin=ii[2]),Nee(a,l,c?e.zmax:s,t,ii,i)?(r.xmax=ii[0],r.ymax=ii[1],c&&(r.zmax=ii[2]),h&&(r.mmin=e.mmin,r.mmax=e.mmax),r.spatialReference=i,r):null):null}function mv(e,t,r){if(E(t)||E(r))return null;const i=new yt({spatialReference:r});return Ts(e,t,0,ii,r,0,1)?(i.x=ii[0],i.y=ii[1],i.z=ii[2],i):null}function Jme(e,t,r){return Ts(e,t,0,ii,r.spatialReference,0,1)?(r.x=ii[0],r.y=ii[1],r.z=ii[2],r):null}function aa(e,t,r,i=0){ii[0]=e.x,ii[1]=e.y;const s=e.z;return ii[2]=s!==void 0?s:i,Ts(ii,e.spatialReference,0,t,r,0,1)}function Nee(e,t,r,i,s,n){return _s[0]=e,_s[1]=t,_s[2]=r,Ts(_s,i,0,s,n,0,1)}function mo(e,t,r,i){return!(E(t)||E(i)||e.length<2)&&(e.length===2&&(_s[0]=e[0],_s[1]=e[1],_s[2]=0,e=_s),Ts(e,t,0,r,i,0,1))}function SLe(e,t){ii[0]=e.x,ii[1]=e.y;const r=e.z;return ii[2]=r!==void 0?r:0,ELe(ii,e.spatialReference,t)}function ELe(e,t,r){return CLe(e,t,r)}function CLe(e,t,r){if(E(t))return!1;const i=gv(t,n6),s=Kf[i][J.WGS84_COMPARABLE_LON_LAT];return!E(s)&&(s(e,0,_s,0),r!==_s&&(r[0]=_s[0],r[1]=_s[1],r.length>2&&(r[2]=_s[2])),!0)}function Ts(e,t,r,i,s,n,o=1){const a=JX(t,s,KX);if(E(a))return!1;if(a===Ui){if(e===i&&r===n)return!0;const c=r+3*o;for(let h=r,p=n;h<c;h++,p++)i[p]=e[h];return!0}const l=r+3*o;for(let c=r,h=n;c<l;c+=3,h+=3)a(e,c,i,h);return!0}function Pxt(e,t,r,i,s){le(ii,e),me(EI,e,t),mo(ii,r,ii,s),mo(EI,r,EI,s),ge(i,EI,ii),ve(i,i)}function Qme(e,t,r,i,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!Ts(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&r?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function Ixt(e,t,r,i){var a,l;if(E(t)||E(i))return!1;const s=age(t,i,DLe);if(s.projector===Ui)return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],!0;if(E(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===J.WEB_MERCATOR){const c=Kf[n.spatialReferenceId][J.WGS84];return!E(c)&&(c(e,0,Yd,0),Dw(Yd,0,r,0),r[3]=Fee(Yd[1],e[2],e[3],br.radius),!0)}if(n.spatialReferenceId!==J.WGS84&&n.spatialReferenceId!==J.CGCS2000||o.spatialReferenceId!==J.PLATE_CARREE){s.projector(e,0,r,0);const c=(a=n.metersPerUnit)!=null?a:1,h=(l=o.metersPerUnit)!=null?l:1;r[3]=e[3]*c/h}else{const c=Kf[n.spatialReferenceId][J.SPHERICAL_ECEF],h=Kf[J.SPHERICAL_ECEF][J.PLATE_CARREE];let p=e[3];v(c)&&v(h)&&(p=Fee(e[1],e[2],e[3],br.radius)),s.projector(e,0,r,0),r[3]=p}return!0}function Fee(e,t,r,i){const s=i+t;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(fp*e)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function s6(e,t,r,i){return e!=null&&(Pn(t,i)?(my(r,e),!0):(_s[0]=e[0],_s[1]=e[1],_s[2]=0,!!Ts(_s,t,0,_s,i,0,1)&&(r[0]=_s[0],r[1]=_s[1],_s[0]=e[2],_s[1]=e[3],_s[2]=0,!!Ts(_s,t,0,_s,i,0,1)&&(r[2]=_s[0],r[3]=_s[1],!0))))}function $xt(e,t,r,i){if(E(t)||E(i))return!1;const s=gv(t,n6),n=gv(i,lge);if(s===n&&s!==J.UNKNOWN||Pn(t,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===J.SPHERICAL_ECEF){const o=Me(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/br.radius;if(n===J.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===J.WGS84||n===J.CGCS2000){const c=U3;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===J.PLATE_CARREE){if(n===J.WGS84||n===J.CGCS2000)return r[0]=U3,r[1]=U3,r[2]=1,!0;if(n===J.WEB_MERCATOR){const o=e[1]/br.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function $p(e,t,r,i){if(E(e)||E(i))return!1;const s=gv(e,n6),n=gv(i,lge);if(s===n&&!Uee(n)&&(s!==J.UNKNOWN||Pn(e,i)))return t6(r,t),!0;if(Uee(n)){const o=Kf[s][J.LON_LAT],a=Kf[J.LON_LAT][n];return!E(o)&&!E(a)&&(o(t,0,Yd,0),a(Yd,0,Ky,0),Kme(fp*Yd[0],fp*Yd[1],r),r[12]=Ky[0],r[13]=Ky[1],r[14]=Ky[2],!0)}if((n===J.WEB_MERCATOR||n===J.PLATE_CARREE)&&(s===J.WGS84||s===J.CGCS2000&&n===J.PLATE_CARREE||s===J.SPHERICAL_ECEF||s===J.WEB_MERCATOR)){const o=Kf[s][J.LON_LAT],a=Kf[J.LON_LAT][n];return!E(o)&&!E(a)&&(o(t,0,Yd,0),a(Yd,0,Ky,0),s===J.SPHERICAL_ECEF?ALe(fp*Yd[0],fp*Yd[1],r):td(r),r[12]=Ky[0],r[13]=Ky[1],r[14]=Ky[2],!0)}return!1}function Uee(e){return e===J.SPHERICAL_ECEF||e===J.SPHERICAL_MARS_PCPF||e===J.SPHERICAL_MOON_PCPF}function Kme(e,t,r){const i=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function ALe(e,t,r){return Kme(e,t,r),kc(r,r),r}function gv(e,t){return e?t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=ll(e,1)),e.wkt===upe.wkt?t.spatialReferenceId=J.SPHERICAL_ECEF:OO(e)?t.spatialReferenceId=J.WGS84:Aw(e)?t.spatialReferenceId=J.WEB_MERCATOR:jW(e)?t.spatialReferenceId=J.PLATE_CARREE:e.wkt===hpe.wkt?t.spatialReferenceId=J.WGS84_ECEF:e.wkid===Uh.CGCS2000?t.spatialReferenceId=J.CGCS2000:e.wkt===XW.wkt?t.spatialReferenceId=J.SPHERICAL_MARS_PCPF:e.wkt===YW.wkt?t.spatialReferenceId=J.SPHERICAL_MOON_PCPF:Om(e)?t.spatialReferenceId=J.GCSMARS2000:Mm(e)?t.spatialReferenceId=J.GCSMOON2000:t.spatialReferenceId=J.UNKNOWN):J.UNKNOWN}function Ui(e,t,r,i){e!==r&&(r[i++]=e[t++],r[i++]=e[t++],r[i]=e[t])}function hw(e,t,r,i){r[i++]=_E*(e[t++]/br.radius),r[i++]=_E*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/br.radius))),r[i]=e[t]}function ege(e,t,r,i){hw(e,t,r,i),U_(r,i,r,i)}function tge(e,t,r,i){hw(e,t,r,i),V_(r,i,r,i)}function XX(e,t,r,i,s){const n=.4999999*Math.PI,o=ye(fp*e[t+1],-n,n),a=Math.sin(o);r[i++]=fp*e[t]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=e[t+2]}function Dw(e,t,r,i){XX(e,t,r,i,br)}const kee=br.radius*Math.PI/180,U3=180/(br.radius*Math.PI);function F_(e,t,r,i){r[i]=e[t]*kee,r[i+1]=e[t+1]*kee,r[i+2]=e[t+2]}function Yb(e,t,r,i){r[i]=e[t]*U3,r[i+1]=e[t+1]*U3,r[i+2]=e[t+2]}function rge(e,t,r,i){hw(e,t,r,i),F_(r,i,r,i)}function RLe(e,t,r,i){B_(e,t,r,i),F_(r,i,r,i)}function OLe(e,t,r,i){k_(e,t,r,i),F_(r,i,r,i)}function MLe(e,t,r,i){Yb(e,t,r,i),U_(r,i,r,i)}function PLe(e,t,r,i){Yb(e,t,r,i),Dw(r,i,r,i)}function ILe(e,t,r,i){Yb(e,t,r,i),V_(r,i,r,i)}function Nw(e){if(E(e))return!1;const t=gv(e,n6);return!!Kf[t][J.WGS84_COMPARABLE_LON_LAT]}function $Le(e,t,r,i){const s=Math.cos(r);e[0]=Math.cos(t)*s*i,e[1]=Math.sin(t)*s*i,e[2]=Math.sin(r)*i}function YX(e,t,r,i,s){const n=s+e[t+2],o=fp*e[t+1],a=fp*e[t],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function Y7(e,t,r,i){YX(e,t,r,i,fy.radius)}function Z7(e,t,r,i){YX(e,t,r,i,nm.radius)}function U_(e,t,r,i){YX(e,t,r,i,br.radius)}function ZX(e,t,r,i,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=Zh(a/(l===0?1:l)),h=Math.atan2(o,n);r[i++]=_E*h,r[i++]=_E*c,r[i]=l-s}function J7(e,t,r,i){ZX(e,t,r,i,fy.radius)}function Q7(e,t,r,i){ZX(e,t,r,i,nm.radius)}function k_(e,t,r,i){ZX(e,t,r,i,br.radius)}function ige(e,t,r,i){k_(e,t,r,i),Dw(r,i,r,i)}function sge(e,t,r,i){k_(e,t,r,i),V_(r,i,r,i)}function LLe(e,t,r,i,s){const n=fp*e[t],o=fp*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(h+a)*c*Math.cos(n),r[i++]=(h+a)*c*Math.sin(n),r[i++]=(h*(1-s.eccentricitySquared)+a)*l}function V_(e,t,r,i){LLe(e,t,r,i,br)}function B_(e,t,r,i){const s=uLe,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,f,m,y,_,b,x,T,S,C,O,R,$,I,U,V,G,z;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),G=Math.atan2(o,n),m=a*a/p,y=c/p,O=s.a2/f,R=s.a3-s.a4/f,y>.3?(_=l/f*(1+y*(s.a1+O+m*R)/f),V=Math.asin(_),x=_*_,b=Math.sqrt(1-x)):(b=h/f*(1-m*(s.a5-O-y*R)/f),V=Math.acos(b),x=1-b*b,_=Math.sqrt(x)),T=1-br.eccentricitySquared*x,S=br.radius/Math.sqrt(T),C=s.a6*S,O=h-S*b,R=l-C*_,I=b*O+_*R,$=b*R-_*O,U=$/(C/T+I),V+=U,z=I+$*U/2,a<0&&(V=-V),r[i++]=_E*G,r[i++]=_E*V,r[i]=z}function nge(e,t,r,i){B_(e,t,r,i),U_(r,i,r,i)}function oge(e,t,r,i){B_(e,t,r,i),Dw(r,i,r,i)}const Kf={[J.WGS84]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Ui,[J.WGS84_COMPARABLE_LON_LAT]:Ui,[J.SPHERICAL_ECEF]:U_,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Dw,[J.PLATE_CARREE]:F_,[J.WGS84]:Ui,[J.WGS84_ECEF]:V_},[J.CGCS2000]:{[J.CGCS2000]:Ui,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Ui,[J.WGS84_COMPARABLE_LON_LAT]:Ui,[J.SPHERICAL_ECEF]:U_,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:F_,[J.WGS84]:null,[J.WGS84_ECEF]:V_},[J.GCSMARS2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:Ui,[J.GCSMOON2000]:null,[J.LON_LAT]:Ui,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:Z7,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.GCSMOON2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:Ui,[J.LON_LAT]:Ui,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:Y7,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.WEB_MERCATOR]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:hw,[J.WGS84_COMPARABLE_LON_LAT]:hw,[J.SPHERICAL_ECEF]:ege,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Ui,[J.PLATE_CARREE]:rge,[J.WGS84]:hw,[J.WGS84_ECEF]:tge},[J.WGS84_ECEF]:{[J.CGCS2000]:B_,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:B_,[J.WGS84_COMPARABLE_LON_LAT]:B_,[J.SPHERICAL_ECEF]:nge,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:oge,[J.PLATE_CARREE]:RLe,[J.WGS84]:B_,[J.WGS84_ECEF]:Ui},[J.SPHERICAL_ECEF]:{[J.CGCS2000]:k_,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:k_,[J.WGS84_COMPARABLE_LON_LAT]:k_,[J.SPHERICAL_ECEF]:Ui,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:ige,[J.PLATE_CARREE]:OLe,[J.WGS84]:k_,[J.WGS84_ECEF]:sge},[J.SPHERICAL_MARS_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:Q7,[J.GCSMOON2000]:null,[J.LON_LAT]:Q7,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:Ui,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.SPHERICAL_MOON_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:J7,[J.LON_LAT]:J7,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:Ui,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.UNKNOWN]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:null,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:Ui,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.LON_LAT]:{[J.CGCS2000]:Ui,[J.GCSMARS2000]:Ui,[J.GCSMOON2000]:Ui,[J.LON_LAT]:Ui,[J.WGS84_COMPARABLE_LON_LAT]:Ui,[J.SPHERICAL_ECEF]:U_,[J.SPHERICAL_MARS_PCPF]:Z7,[J.SPHERICAL_MOON_PCPF]:Y7,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Dw,[J.PLATE_CARREE]:F_,[J.WGS84]:Ui,[J.WGS84_ECEF]:V_},[J.WGS84_COMPARABLE_LON_LAT]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Ui,[J.WGS84_COMPARABLE_LON_LAT]:Ui,[J.SPHERICAL_ECEF]:U_,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:F_,[J.WGS84]:Ui,[J.WGS84_ECEF]:V_},[J.PLATE_CARREE]:{[J.CGCS2000]:Yb,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Yb,[J.WGS84_COMPARABLE_LON_LAT]:Yb,[J.SPHERICAL_ECEF]:MLe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:PLe,[J.PLATE_CARREE]:Ui,[J.WGS84]:Yb,[J.WGS84_ECEF]:ILe}};function JX(e,t,r=QX()){return E(e)||E(t)?null:age(e,t,r).projector}function age(e,t,r){if(E(e)||E(t)||r.source.spatialReference===e&&r.dest.spatialReference===t)return r;const i=gv(e,r.source),s=gv(t,r.dest);return i===J.UNKNOWN&&s===J.UNKNOWN?Pn(e,t)?r.projector=Ui:r.projector=null:r.projector=Kf[i][s],r}function QX(){return{source:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},projector:Ui}}const n6={spatialReference:null,spatialReferenceId:J.UNKNOWN},lge={spatialReference:null,spatialReferenceId:J.UNKNOWN},KX=QX(),DLe=QX(),fp=Gt(1),_E=nl(1),_s=M(),Yd=M(),Ky=M(),ii=M(),EI=M();class Ry{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&tE(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Vee);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,Vee));t++)this._items.push(this._allocator())}}const Vee=1024;function Ie(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function vE(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function eY(e,t,r,i,s,n,o,a,l,c,h,p,f,m,y,_){return[e,t,r,i,s,n,o,a,l,c,h,p,f,m,y,_]}function cge(e,t){return new Float64Array(e,t,16)}const Bu=Ie();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Bu,clone:vE,create:Ie,createView:cge,fromValues:eY},Symbol.toStringTag,{value:"Module"}));var Ic;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Ic||(Ic={}));function uge(e){return 32+e.length}function hge(e){return 16}function dge(e){if(!e)return 0;let t=mge;for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];switch(typeof i){case"string":t+=uge(i);break;case"number":t+=hge();break;case"boolean":t+=4}}return t}function pge(e){if(!e)return 0;if(Array.isArray(e))return NLe(e);let t=mge;for(const r in e)e.hasOwnProperty(r)&&(t+=fge(e[r]));return t}function NLe(e){const t=e.length;if(t===0||typeof e[0]=="number")return 32+8*t;let r=gge;for(let i=0;i<t;i++)r+=fge(e[i]);return r}function fge(e){switch(typeof e){case"object":return pge(e);case"string":return uge(e);case"number":return hge();case"boolean":return 4;default:return 8}}function Lxt(e,t){return gge+e.length*t}const mge=32,gge=32;var bE;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(bE||(bE={}));function ns(){return[1,0,0,0,1,0,0,0,1]}function FLe(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function ULe(e,t,r,i,s,n,o,a,l){return[e,t,r,i,s,n,o,a,l]}function yge(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:FLe,create:ns,createView:yge,fromValues:ULe},Symbol.toStringTag,{value:"Module"}));function cd(){return[0,0,0,1]}function kLe(e){return[e[0],e[1],e[2],e[3]]}function VLe(e,t,r,i){return[e,t,r,i]}function _ge(e,t){return new Float64Array(e,t,4)}const BLe=cd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:BLe,clone:kLe,create:cd,createView:_ge,fromValues:VLe},Symbol.toStringTag,{value:"Module"}));function Ke(){return[0,0]}function CR(e){return[e[0],e[1]]}function Ur(e,t){return[e,t]}function vge(e){const t=Ke(),r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function bge(e,t){return new Float64Array(e,t,2)}function wge(){return Ke()}function xge(){return Ur(1,1)}function Tge(){return Ur(1,0)}function Sge(){return Ur(0,1)}const Zl=wge(),Ege=xge(),zLe=Tge(),GLe=Sge();Object.freeze(Object.defineProperty({__proto__:null,ONES:Ege,UNIT_X:zLe,UNIT_Y:GLe,ZEROS:Zl,clone:CR,create:Ke,createView:bge,fromArray:vge,fromValues:Ur,ones:xge,unitX:Tge,unitY:Sge,zeros:wge},Symbol.toStringTag,{value:"Module"}));function sr(){return[0,0,0,0]}function yP(e){return[e[0],e[1],e[2],e[3]]}function Ht(e,t,r,i){return[e,t,r,i]}function tY(e){const t=sr(),r=Math.min(4,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function Cge(e,t){return new Float64Array(e,t,4)}function Age(){return sr()}function Rge(){return Ht(1,1,1,1)}function Oge(){return Ht(1,0,0,0)}function Mge(){return Ht(0,1,0,0)}function Pge(){return Ht(0,0,1,0)}function Ige(){return Ht(0,0,0,1)}const am=Age(),kh=Rge(),jLe=Oge(),HLe=Mge(),qLe=Pge(),WLe=Ige();Object.freeze(Object.defineProperty({__proto__:null,ONES:kh,UNIT_W:WLe,UNIT_X:jLe,UNIT_Y:HLe,UNIT_Z:qLe,ZEROS:am,clone:yP,create:sr,createView:Cge,fromArray:tY,fromValues:Ht,ones:Rge,unitW:Ige,unitX:Oge,unitY:Mge,unitZ:Pge,zeros:Age},Symbol.toStringTag,{value:"Module"}));class Su{constructor(t,r,i){this._itemByteSize=t,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&tE(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=$x){return new Su(16,bge,t)}static createVec3f64(t=$x){return new Su(24,dW,t)}static createVec4f64(t=$x){return new Su(32,Cge,t)}static createMat3f64(t=$x){return new Su(72,yge,t)}static createMat4f64(t=$x){return new Su(128,cge,t)}static createQuatf64(t=$x){return new Su(32,_ge,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const $x=4*bE.KILOBYTES,Dxt=Su.createVec2f64(),We=Su.createVec3f64(),rY=Su.createVec4f64();Su.createMat3f64();const iY=Su.createMat4f64(),Nxt=Su.createQuatf64();function kp(e){return e?{origin:bs(e.origin),vector:bs(e.vector)}:{origin:M(),vector:M()}}function XLe(e,t){const r=ZLe.get();return r.origin=e,r.vector=t,r}function Fxt(e,t=kp()){return YLe(e.origin,e.vector,t)}function YLe(e,t,r=kp()){return le(r.origin,e),le(r.vector,t),r}function dw(e,t,r=kp()){return le(r.origin,e),ge(r.vector,t,e),r}function sY(e,t){const r=ge(We.get(),t,e.origin),i=_e(e.vector,r),s=_e(e.vector,e.vector),n=ye(i/s,0,1),o=ge(We.get(),ae(We.get(),e.vector,n),r);return _e(o,o)}function Uxt(e,t,r){return K7(e,t,0,1,r)}function kxt(e,t,r){return me(r,e.origin,ae(r,e.vector,t))}function K7(e,t,r,i,s){const{vector:n,origin:o}=e,a=ge(We.get(),t,o),l=_e(n,a)/ba(n);return ae(s,n,ye(l,r,i)),me(s,s,e.origin)}function Vxt(e,t){if(Lge(e,XLe(t.origin,t.direction),!1,$F)){const{tA:r,pB:i,distance2:s}=$F;if(r>=0&&r<=1)return s;if(r<0)return jn(e.origin,i);if(r>1)return jn(me(We.get(),e.origin,e.vector),i)}return null}function $ge(e,t,r){return!!Lge(e,t,!0,$F)&&(le(r,$F.pA),!0)}function Lge(e,t,r,i){const n=e.origin,o=me(We.get(),n,e.vector),a=t.origin,l=me(We.get(),a,t.vector),c=We.get(),h=We.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=We.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],_=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],b=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-m*m;if(Math.abs(b)<1e-6)return!1;let x=(f*m-y*_)/b,T=(f+m*x)/_;r&&(x=ye(x,0,1),T=ye(T,0,1));const S=We.get(),C=We.get();return S[0]=n[0]+x*p[0],S[1]=n[1]+x*p[1],S[2]=n[2]+x*p[2],C[0]=a[0]+T*h[0],C[1]=a[1]+T*h[1],C[2]=a[2]+T*h[2],i.tA=x,i.tB=T,i.pA=S,i.pB=C,i.distance2=jn(S,C),!0}const $F={tA:0,tB:0,pA:M(),pB:M(),distance2:0},ZLe=new Ry(()=>kp());function co(e){return e?Bee(bs(e.origin),bs(e.direction)):Bee(M(),M())}function Bee(e,t){return{origin:e,direction:t}}function Bxt(e,t){return dy(e.origin,t.origin)&&dy(e.direction,t.direction)}function zu(e,t){const r=eDe.get();return r.origin=e,r.direction=t,r}function LF(e,t=co()){return Dge(e.origin,e.direction,t)}function JLe(e,t,r=co()){return le(r.origin,e),ge(r.direction,t,e),r}function Dge(e,t,r=co()){return le(r.origin,e),le(r.direction,t),r}function QLe(e,t){const r=dt(We.get(),ve(We.get(),e.direction),ge(We.get(),t,e.origin));return _e(r,r)}function KLe(e,t,r){const i=_e(e.direction,ge(r,t,e.origin));return me(r,e.origin,ae(r,e.direction,i)),r}const eDe=new Ry(()=>co());function k3(e,t){return _e(e,t)/Me(e)}function nY(e,t){const r=_e(e,t)/(Me(e)*Me(t));return-Mn(r)}function Nge(e,t,r){ve(CI,e),ve(nk,t);const i=_e(CI,nk),s=Mn(i),n=dt(CI,CI,nk);return _e(n,r)<0?2*Math.PI-s:s}const CI=M(),nk=M();function pn(){return sr()}function wE(e,t=pn()){return cp(t,e)}function Fge(e,t){return Ht(e[0],e[1],e[2],t)}function tDe(e){return e}function Uge(e){e[0]=e[1]=e[2]=e[3]=0}function o6(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function ty(e){return e[3]}function rDe(e){return e}function kge(e,t,r,i){return Ht(e,t,r,i)}function iDe(e,t,r){return e!==r&&le(r,e),r[3]=e[3]+t,r}function sDe(e,t,r){return ee.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),e===r?r:wE(e,r)}function Uv(e,t,r){if(E(t))return!1;const{origin:i,direction:s}=t,n=nDe;n[0]=i[0]-e[0],n[1]=i[1]-e[1],n[2]=i[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(r&&(r[0]=i[0]+s[0]*h,r[1]=i[1]+s[1]*h,r[2]=i[2]+s[2]*h),!0)}const nDe=M();function eG(e,t){return Uv(e,t,null)}function oDe(e,t,r){if(Uv(e,t,r))return r;const i=wC(e,t,We.get());return me(r,t.origin,ae(We.get(),t.direction,Ai(t.origin,i)/Me(t.direction))),r}function wC(e,t,r){const i=We.get(),s=iY.get();dt(i,t.origin,t.direction);const n=ty(e);dt(r,i,t.origin),ae(r,r,1/Me(r)*n);const o=zge(e,t.origin),a=nY(t.origin,r);return Vu(s,a+o,i),Ze(r,r,s),r}function aDe(e,t,r){return Uv(e,t,r)?r:(KLe(t,e,r),Vge(e,r,r))}function Vge(e,t,r){const i=ge(We.get(),t,e),s=ae(We.get(),i,e[3]/Me(i));return me(r,s,e)}function Bge(e,t){const r=ge(We.get(),t,e),i=ba(r),s=e[3]*e[3];return Math.sqrt(Math.abs(i-s))}function zge(e,t){const r=ge(We.get(),t,e),i=Me(r),s=ty(e),n=s+Math.abs(s-i);return Mn(s/n)}const ok=M();function Gge(e,t,r,i){const s=ge(ok,t,e);switch(r){case Ic.X:{const n=fK(s,ok)[2];return ce(i,-Math.sin(n),Math.cos(n),0)}case Ic.Y:{const n=fK(s,ok),o=n[1],a=n[2],l=Math.sin(o);return ce(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Ic.Z:return ve(i,s);default:return}}function jge(e,t){const r=ge(tG,t,e);return Me(r)-e[3]}function lDe(e,t,r,i){const s=jge(e,t),n=Gge(e,t,Ic.Z,tG),o=ae(tG,n,r-s);return me(i,t,o)}function cDe(e,t){const r=jn(e,t),i=ty(e);return r<=i*i}const tG=M(),a6=pn(),uDe=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:jge,angleToSilhouette:zge,axisAt:Gge,clear:Uge,closestPoint:aDe,closestPointOnSilhouette:wC,containsPoint:cDe,copy:wE,create:pn,distanceToSilhouette:Bge,elevate:iDe,fromCenterAndRadius:Fge,fromRadius:o6,fromValues:kge,getCenter:rDe,getRadius:ty,intersectRay:Uv,intersectRayClosestSilhouette:oDe,intersectsRay:eG,projectPoint:Vge,setAltitudeAt:lDe,setExtent:sDe,tmpSphere:a6,wrap:tDe},Symbol.toStringTag,{value:"Module"}));function Fw(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}function hDe(e,t){const r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return ce(e,r,i,s),e}function zxt(e,t,r){r=r||e;const i=_e(e,t);ce(r,e[0]-i*t[0],e[1]-i*t[1],e[2]-i*t[2]),ve(r,r)}function Gxt(e,t,r){Math.abs(e[0])>Math.abs(e[1])?ce(t,0,1,0):ce(t,1,0,0),dt(r,e,t),ve(t,t),dt(t,r,e),ve(r,r)}function dDe(e,t){return(e%t+t)%t}function AI(e,t,r,i,s,n){const o=e+(t-e)*s;return o+(r+(i-r)*s-o)*n}function pDe(e,t,r,i=M()){const s=Me(e),n=Me(t),o=_e(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),h=l/n*Math.sin(r*a);return ae(Zb,e,c),ae(Jb,t,h),me(i,Zb,Jb)}return rn(i,e,t,r)}function jxt(e,t,r,i=M(),s=M()){const n=Me(e),o=Me(t),a=_e(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(r*l),p=Math.sin((1-r)*l),f=(1-r)*n+r*o;{const m=f/c,y=m/o*h;ae(Zb,e,m/n*p),ae(Jb,t,y),me(i,Zb,Jb)}{const m=1/n*(-Math.cos((1-r)*l)*l*f+p*(-n+o));ae(Zb,e,m);const y=1/o*(Math.cos(r*l)*l*f+h*(-n+o));ae(Jb,t,y),me(s,Zb,Jb),ae(s,s,1/c)}return s}return rn(i,e,t,r),ge(s,t,e),ve(s,s),s}function RD(e,t,r){e=ve(Zb,e),t=ve(Jb,t);const i=Mn(_e(e,t));if(r){const s=dt(fDe,e,t);if(_e(s,r)<0)return-i}return i}function OD(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const s=e[i-1][0],n=e[i][0],o=(n-r)/(n-s);return o*e[i-1][1]+(1-o)*e[i][1]}}function Hxt(e,t,r,i){ge(zee,t,e),ge(Gee,r,e),dt(i,zee,Gee),ve(i,i),i[3]=-_e(e,i)}const zee=M(),Gee=M(),fDe=M(),Zb=M(),Jb=M();function jr(e=AR){return[e[0],e[1],e[2],e[3]]}function mDe(e=AR[0],t=AR[1],r=AR[2],i=AR[3]){return oY(e,t,r,i,rY.get())}function l6(e,t){return oY(t[0],t[1],t[2],t[3],e)}function oY(e,t,r,i,s=jr()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function Hge(e,t,r){return le(r,e),r[3]=t,r}function _P(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function _a(e,t,r,i=jr()){const s=r[0]-t[0],n=r[1]-t[1],o=r[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=h*y,i[1]=p*y,i[2]=f*y,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function qge(e,t,r,i,s){const n=e.length/3;if(n<3)return!1;ce(tA,e[3*r],e[3*r+1],e[3*r+2]);let o=i,a=!1;for(;o<n-1&&!a;){const l=3*o;ce(Lx,e[l],e[l+1],e[l+2]),o++,a=!el(tA,Lx)}if(!a)return!1;for(o=Math.max(o,s),a=!1;o<n&&!a;){const l=3*o;ce(Lb,e[l],e[l+1],e[l+2]),o++,ge(RI,tA,Lx),ve(RI,RI),ge(OI,Lx,Lb),ve(OI,OI),a=!el(tA,Lb)&&!el(Lx,Lb)&&Math.abs(_e(RI,OI))<gDe}return a?(_a(tA,Lx,Lb,t),!0):(r!==0||i!==1||s!==2)&&qge(e,t,0,1,2)}const gDe=.99619469809,tA=M(),Lx=M(),Lb=M(),RI=M(),OI=M();function rG(e,t,r){return t!==e&&l6(e,t),e[3]=-_e(e,r),e}function iG(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function zO(e,t,r,i){return dt(Lb,t,e),_P(r,Lb,i)}function qxt(e,t,r,i){return c6(e,t,ge(We.get(),r,t),xDe,i)}function Tx(e,t,r){return!!v(t)&&c6(e,t.origin,t.direction,TDe,r)}function yDe(e,t,r){return c6(e,t.origin,t.vector,lm.NONE,r)}function _De(e,t,r){return c6(e,t.origin,t.vector,lm.CLAMP,r)}function Wge(e,t){return Ei(e,t)>=0}function vDe(e,t){const r=_e(e,t.ray.direction),i=-Ei(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function bDe(e,t){const r=_e(e,t.ray.direction),i=-Ei(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function wDe(e,t,r){const i=ae(We.get(),e,-e[3]),s=sG(e,ge(We.get(),t,i),We.get());return me(r,s,i),r}function sG(e,t,r){const i=ae(We.get(),e,_e(e,t));return ge(r,t,i),r}function Ei(e,t){return _e(e,t)+e[3]}function c6(e,t,r,i,s){const n=_e(e,r);if(n===0)return!1;let o=-(_e(e,t)+e[3])/n;return i&lm.CLAMP&&(o=ye(o,0,1)),!(!(i&lm.INFINITE_MIN)&&o<0||!(i&lm.INFINITE_MAX)&&o>1)&&(me(s,t,ae(s,r,o)),!0)}function Wxt(e){return e}const AR=[0,0,1,0];var lm;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(lm||(lm={}));const xDe=lm.INFINITE_MIN|lm.INFINITE_MAX,TDe=lm.INFINITE_MAX,ak=ee.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class SDe{constructor(){this.plane=jr(),this.origin=M(),this.basis1=M(),this.basis2=M()}}const Xge=SDe;function Oy(e=nye){return{plane:jr(e.plane),origin:bs(e.origin),basis1:bs(e.basis1),basis2:bs(e.basis2)}}function EDe(e,t,r){const i=FDe.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=mDe(0,0,0,0),u6(i),i}function Sx(e,t=Oy()){return aY(e.origin,e.basis1,e.basis2,t)}function CDe(e,t){le(t.origin,e.origin),le(t.basis1,e.basis1),le(t.basis2,e.basis2),l6(t.plane,e.plane)}function aY(e,t,r,i=Oy()){return le(i.origin,e),le(i.basis1,t),le(i.basis2,r),u6(i),DDe(i,"fromValues()"),i}function u6(e){zO(e.basis2,e.basis1,e.origin,e.plane)}function Yge(e,t,r){e!==r&&Sx(e,r);const i=ae(We.get(),yy(e),t);return me(r.origin,r.origin,i),r.plane[3]-=t,r}function ADe(e,t,r){return Zge(t,r),Yge(r,hY(e,e.origin),r),r}function Zge(e,t=Oy()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return ce(t.origin,e[0]+r,e[1]+i,0),ce(t.basis1,r,0,0),ce(t.basis2,0,i,0),oY(0,0,1,0,t.plane),t}function lY(e,t,r){return!!Tx(e.plane,t,r)&&iye(e,r)}function RDe(e,t,r){if(lY(e,t,r))return r;const i=Jge(e,t,We.get());return me(r,t.origin,ae(We.get(),t.direction,Ai(t.origin,i)/Me(t.direction))),r}function Jge(e,t,r){const i=DF.get();sye(e,t,i,DF.get());let s=Number.POSITIVE_INFINITY;for(const n of pY){const o=dY(e,n,h6.get()),a=We.get();if(yDe(i,o,a)){const l=Cy(We.get(),t.origin,a),c=Math.abs(Mn(_e(t.direction,l)));c<s&&(s=c,le(r,a))}}return s===Number.POSITIVE_INFINITY?Qge(e,t,r):r}function Qge(e,t,r){if(lY(e,t,r))return r;const i=DF.get(),s=DF.get();sye(e,t,i,s);let n=Number.POSITIVE_INFINITY;for(const o of pY){const a=dY(e,o,h6.get()),l=We.get();if(_De(i,a,l)){const c=QLe(t,l);if(!Wge(s,l))continue;c<n&&(n=c,le(r,l))}}return cY(e,t.origin)<n&&Kge(e,t.origin,r),r}function Kge(e,t,r){const i=wDe(e.plane,t,We.get()),s=K7(jee(e,e.basis1),i,-1,1,We.get()),n=K7(jee(e,e.basis2),i,-1,1,We.get());return ge(r,me(We.get(),s,n),e.origin),r}function eye(e,t,r){const{origin:i,basis1:s,basis2:n}=e,o=ge(We.get(),t,i),a=k3(s,o),l=k3(n,o),c=k3(yy(e),o);return ce(r,a,l,c)}function cY(e,t){const r=eye(e,t,We.get()),{basis1:i,basis2:s}=e,n=Me(i),o=Me(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function ODe(e,t){return Math.sqrt(cY(e,t))}function MDe(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of pY){const s=dY(e,i,h6.get()),n=sY(s,t);n>r&&(r=n)}return Math.sqrt(r)}function uY(e,t){return Wge(e.plane,t)&&iye(e,t)}function PDe(e,t,r,i){return LDe(e,r,i)}function hY(e,t){const r=-e.plane[3];return k3(yy(e),t)-r}function IDe(e,t,r,i){const s=hY(e,t),n=ae(NDe,yy(e),r-s);return me(i,t,n),i}function tye(e,t){return el(e.basis1,t.basis1)&&el(e.basis2,t.basis2)&&el(e.origin,t.origin)}function rye(e,t,r){return e!==r&&Sx(e,r),ko(Dx,t),kc(Dx,Dx),Ze(r.basis1,e.basis1,Dx),Ze(r.basis2,e.basis2,Dx),Ze(r.plane,e.plane,Dx),Ze(r.origin,e.origin,t),rG(r.plane,r.plane,r.origin),r}function $De(e,t,r,i){return e!==i&&Sx(e,i),Vu(lk,t,r),Ze(i.basis1,e.basis1,lk),Ze(i.basis2,e.basis2,lk),u6(i),i}function yy(e){return e.plane}function LDe(e,t,r){switch(t){case Ic.X:le(r,e.basis1),ve(r,r);break;case Ic.Y:le(r,e.basis2),ve(r,r);break;case Ic.Z:le(r,yy(e))}return r}function iye(e,t){const r=ge(We.get(),t,e.origin),i=ba(e.basis1),s=ba(e.basis2),n=_e(e.basis1,r),o=_e(e.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function jee(e,t){const r=h6.get();return le(r.origin,e.origin),le(r.vector,t),r}function dY(e,t,r){const{basis1:i,basis2:s,origin:n}=e,o=ae(We.get(),i,t.origin[0]),a=ae(We.get(),s,t.origin[1]);me(r.origin,o,a),me(r.origin,r.origin,n);const l=ae(We.get(),i,t.direction[0]),c=ae(We.get(),s,t.direction[1]);return ae(r.vector,me(l,l,c),2),r}function DDe(e,t){Math.abs(_e(e.basis1,e.basis2)/(Me(e.basis1)*Me(e.basis2)))>1e-6&&ak.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(_e(e.basis1,yy(e)))>1e-6&&ak.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-_e(yy(e),e.origin)-e.plane[3])>1e-6&&ak.warn(t,"Plane offset is not consistent with plane origin")}function sye(e,t,r,i){const s=yy(e);zO(s,t.direction,t.origin,r),zO(r,s,t.origin,i)}const nye={plane:jr(),origin:Le(0,0,0),basis1:Le(1,0,0),basis2:Le(0,1,0)},DF=new Ry(jr),h6=new Ry(kp),NDe=M(),FDe=new Ry(()=>Oy()),pY=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Dx=Ie(),lk=Ie(),UDe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Xge,UP:nye,altitudeAt:hY,axisAt:PDe,closestPoint:Qge,closestPointOnSilhouette:Jge,copy:Sx,copyWithoutVerify:CDe,create:Oy,distance:ODe,distance2:cY,distanceToSilhouette:MDe,elevate:Yge,equals:tye,extrusionContainsPoint:uY,fromAABoundingRect:Zge,fromValues:aY,intersectRay:lY,intersectRayClosestSilhouette:RDe,normal:yy,projectPoint:Kge,projectPointLocal:eye,rotate:$De,setAltitudeAt:IDe,setExtent:ADe,transform:rye,updateUnboundedPlane:u6,wrap:EDe},Symbol.toStringTag,{value:"Module"})),kDe=new Ye(upe),Hee=new Ye(XW),qee=new Ye(YW),Xxt=new Ye(hpe);function d6(e){return e&&(Om(e)||Pn(e,Hee))?Hee:e&&(Mm(e)||Pn(e,qee))?qee:kDe}function VDe(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}}function BDe(e,t,r){return e.operations.setExtent(e.value,t,r.value),r}function zDe(e){return{operations:e,value:e.create()}}function oye(e,t,r=zDe(e)){return r.operations=e,e.copy(t,r.value),r}function GDe(e){return oye(uDe,kge(0,0,0,Zr(e).radius))}const Wee=2**50;function jDe(){return oye(UDe,aY([0,0,0],[Wee,0,0],[0,Wee,0]))}function HDe(e,t,r){return e.operations.axisAt(e.value,t,Ic.Z,r)}function qDe(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)}function WDe(e,t,r){return e.operations.intersectRay(e.value,t,r)}function XDe(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)}function YDe(e,t){return e.operations.altitudeAt(e.value,t)}function aye(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}function ZDe(e,t,r,i){return t!==i&&Hn(i,t),ce(Nx,i[12],i[13],i[14]),aye(e,Nx,r,Nx),i[12]=Nx[0],i[13]=Nx[1],i[14]=Nx[2],i}function ck(e,t,r){return e.operations.elevate(e.value,t,r.value)}const Nx=M();function Xee(e,t,r,i,s){return s[0]=_e(e,t),s[1]=_e(e,r),s[2]=_e(e,i),s}function nG(e,t,r,i,s){le(r,e),le(MI,t),ve(MI,MI),dt(i,MI,r),dt(s,i,r)}function lye(e,t){return e?d6(t):t.isGeographic?Ye.PlateCarree:t}const MI=M(),fY=96;function Yxt(e,t){const r=t||e.extent,i=e.width,s=ll(r&&r.spatialReference);return r&&i?r.width/i*s*ZW*fY:0}function JDe(e,t){return e/(ll(t)*ZW*fY)}function QDe(e){return e/(ZW*fY)}const cye="OBJECTID";function V3(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function xE(e){return e!=null&&"type"in e&&e.type==="group"}const Zxt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function uye(e){const t=e==null?void 0:e.type;return t==="building-scene"||t==="integrated-mesh"||t==="point-cloud"||t==="scene"}function Yee(e){return(e==null?void 0:e.type)==="voxel"}function Zee(e){return(e==null?void 0:e.type)==="imagery-tile"}function hye(e){return e!=null&&e.parent!=null&&"declaredClass"in e.parent&&e.parent.declaredClass==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function mY(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function Jxt(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function KDe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const r=e.activeLayer.tileMatrixSets;if(r)return r}return null}async function dye(e,t){const r=Ci==null?void 0:Ci.findServerInfo(e);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=e.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const s=`${e.substring(0,i)}/rest/info`,n=v(t)?t.signal:null,{data:o}=await Di(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function eNe(e){if(!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function pye(e){return eNe(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null}function tNe(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function rNe(e){return!!tNe(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)}let TE=class extends N3{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{E(t.item)||t.item.parent===this.owner&&(ee.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};TE=u([P("esri.support.AnalysesCollection")],TE);const MD={widthBreakpoint:{getValue(e){const t=e.viewSize[0],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,r=t[0],i=t[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},uk={xsmall:544,small:768,medium:992,large:1200};function iNe(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function hk(e,t){return t?MD[e].valueToClassName[t].split(" "):[]}const sNe=e=>{let t=class extends e{constructor(...r){super(...r),this._breakpointsHandles=new Jr,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=uk}initialize(){this._breakpointsHandles.add(se(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),kt))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Ve(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=iNe(r);if(!i){const s=JSON.stringify(uk,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:uk,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=Ec.acquire(),i=Ec.acquire();let s,n=!1;for(s in MD){const o=this[s],a=MD[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,hk(s,o).forEach(l=>i.push(l)),hk(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),Ec.release(r),Ec.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in MD)hk(i,this[i]).forEach(s=>r.classList.remove(s))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([P("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var nNe=function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},Db={exports:{}},fn={},GO={exports:{}},Ex={};function fye(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function oNe(e,t,r){}function aNe(e,t,r){}var lNe=/javascript\s*\:/img;function cNe(e,t){return lNe.test(t)?"":t}Ex.whiteList=fye();Ex.getDefaultWhiteList=fye;Ex.onAttr=oNe;Ex.onIgnoreAttr=aNe;Ex.safeAttrValue=cNe;var uNe={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,s;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,s=e.length;i<s;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},rA=uNe;function hNe(e,t){e=rA.trimRight(e),e[e.length-1]!==";"&&(e+=";");var r=e.length,i=!1,s=0,n=0,o="";function a(){if(!i){var h=rA.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=rA.trim(h.slice(0,p)),m=rA.trim(h.slice(p+1));if(f){var y=t(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<r;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return rA.trim(o)}var dNe=hNe,PI=Ex,pNe=dNe;function Jee(e){return e==null}function fNe(e){var t={};for(var r in e)t[r]=e[r];return t}function mye(e){e=fNe(e||{}),e.whiteList=e.whiteList||PI.whiteList,e.onAttr=e.onAttr||PI.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||PI.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||PI.safeAttrValue,this.options=e}mye.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=pNe(e,function(l,c,h,p,f){var m=i[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var _={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var b=s(h,p,_);return Jee(b)?h+":"+p:b}else{var b=n(h,p,_);if(!Jee(b))return b}}});return a};var mNe=mye;(function(e,t){var r=Ex,i=mNe;function s(o,a){var l=new i(a);return l.process(o)}t=e.exports=s,t.FilterCSS=i;for(var n in r)t[n]=r[n]})(GO,GO.exports);var gY={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,s;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,s=e.length;i<s;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,r=t.exec(e);return r?r.index:-1}},gNe=GO.exports.FilterCSS,yNe=GO.exports.getDefaultWhiteList,NF=gY;function gye(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var yye=new gNe;function _Ne(e,t,r){}function vNe(e,t,r){}function bNe(e,t,r){}function wNe(e,t,r){}function _ye(e){return e.replace(TNe,"&lt;").replace(SNe,"&gt;")}function xNe(e,t,r,i){if(r=Sye(r),t==="href"||t==="src"){if(r=NF.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(t==="background"){if(II.lastIndex=0,II.test(r))return""}else if(t==="style"){if(Qee.lastIndex=0,Qee.test(r)||(Kee.lastIndex=0,Kee.test(r)&&(II.lastIndex=0,II.test(r))))return"";i!==!1&&(i=i||yye,r=i.process(r))}return r=Eye(r),r}var TNe=/</g,SNe=/>/g,ENe=/"/g,CNe=/&quot;/g,ANe=/&#([a-zA-Z0-9]*);?/gim,RNe=/&colon;?/gim,ONe=/&newline;?/gim,II=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Qee=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Kee=/u\s*r\s*l\s*\(.*/gi;function vye(e){return e.replace(ENe,"&quot;")}function bye(e){return e.replace(CNe,'"')}function wye(e){return e.replace(ANe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function xye(e){return e.replace(RNe,":").replace(ONe," ")}function Tye(e){for(var t="",r=0,i=e.length;r<i;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return NF.trim(t)}function Sye(e){return e=bye(e),e=wye(e),e=xye(e),e=Tye(e),e}function Eye(e){return e=vye(e),e=_ye(e),e}function MNe(){return""}function PNe(e,t){typeof t!="function"&&(t=function(){});var r=!Array.isArray(e);function i(o){return r?!0:NF.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return NF.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function INe(e){for(var t="",r=0;r<e.length;){var i=e.indexOf("<!--",r);if(i===-1){t+=e.slice(r);break}t+=e.slice(r,i);var s=e.indexOf("-->",i);if(s===-1)break;r=s+3}return t}function $Ne(e){var t=e.split("");return t=t.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),t.join("")}fn.whiteList=gye();fn.getDefaultWhiteList=gye;fn.onTag=_Ne;fn.onIgnoreTag=vNe;fn.onTagAttr=bNe;fn.onIgnoreTagAttr=wNe;fn.safeAttrValue=xNe;fn.escapeHtml=_ye;fn.escapeQuote=vye;fn.unescapeQuote=bye;fn.escapeHtmlEntities=wye;fn.escapeDangerHtml5Entities=xye;fn.clearNonPrintableCharacter=Tye;fn.friendlyAttrValue=Sye;fn.escapeAttrValue=Eye;fn.onIgnoreTagStripAll=MNe;fn.StripTagBody=PNe;fn.stripCommentTag=INe;fn.stripBlankChar=$Ne;fn.cssFilter=yye;fn.getDefaultCSSWhiteList=yNe;var p6={},d_=gY;function LNe(e){var t=d_.spaceIndex(e),r;return t===-1?r=e.slice(1,-1):r=e.slice(1,t+1),r=d_.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function DNe(e){return e.slice(0,2)==="</"}function NNe(e,t,r){var i="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){i+=r(e.slice(s,a)),n=a,s=a;continue}if(p===">"){i+=r(e.slice(s,n)),h=e.slice(n,a+1),c=LNe(h),i+=t(n,i.length,c,h,DNe(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=e.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(i+=r(e.substr(s))),i}var FNe=/[^a-zA-Z0-9\\_:.-]/gim;function UNe(e,t){var r=0,i=0,s=[],n=!1,o=e.length;function a(f,m){if(f=d_.trim(f),f=f.replace(FNe,"").toLowerCase(),!(f.length<1)){var y=t(f,m||"");y&&s.push(y)}}for(var l=0;l<o;l++){var c=e.charAt(l),h,p;if(n===!1&&c==="="){n=e.slice(r,l),r=l+1,i=e.charAt(r)==='"'||e.charAt(r)==="'"?r:VNe(e,l+1);continue}if(n!==!1&&l===i){if(p=e.indexOf(c,l+1),p===-1)break;h=d_.trim(e.slice(i+1,p)),a(n,h),n=!1,l=p,r=l+1;continue}if(/\s|\n|\t/.test(c))if(e=e.replace(/\s|\n|\t/g," "),n===!1)if(p=kNe(e,l),p===-1){h=d_.trim(e.slice(r,l)),a(h),n=!1,r=l+1;continue}else{l=p-1;continue}else if(p=BNe(e,l-1),p===-1){h=d_.trim(e.slice(r,l)),h=ete(h),a(n,h),n=!1,r=l+1;continue}else continue}return r<e.length&&(n===!1?a(e.slice(r)):a(n,ete(d_.trim(e.slice(r))))),d_.trim(s.join(" "))}function kNe(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="="?t:-1}}function VNe(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="'"||r==='"'?t:-1}}function BNe(e,t){for(;t>0;t--){var r=e[t];if(r!==" ")return r==="="?t:-1}}function zNe(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function ete(e){return zNe(e)?e.substr(1,e.length-2):e}p6.parseTag=NNe;p6.parseAttr=UNe;var GNe=GO.exports.FilterCSS,Zd=fn,Cye=p6,jNe=Cye.parseTag,HNe=Cye.parseAttr,PD=gY;function $I(e){return e==null}function qNe(e){var t=PD.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=PD.trim(e.slice(t+1,-1));var r=e[e.length-1]==="/";return r&&(e=PD.trim(e.slice(0,-1))),{html:e,closing:r}}function WNe(e){var t={};for(var r in e)t[r]=e[r];return t}function XNe(e){var t={};for(var r in e)Array.isArray(e[r])?t[r.toLowerCase()]=e[r].map(function(i){return i.toLowerCase()}):t[r.toLowerCase()]=e[r];return t}function Aye(e){e=WNe(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Zd.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=XNe(e.whiteList||e.allowList):e.whiteList=Zd.whiteList,e.onTag=e.onTag||Zd.onTag,e.onTagAttr=e.onTagAttr||Zd.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Zd.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Zd.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Zd.safeAttrValue,e.escapeHtml=e.escapeHtml||Zd.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new GNe(e.css))}Aye.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,h=t.cssFilter;r.stripBlankChar&&(e=Zd.stripBlankChar(e)),r.allowCommentTag||(e=Zd.stripCommentTag(e));var p=!1;r.stripIgnoreTagBody&&(p=Zd.StripTagBody(r.stripIgnoreTagBody,n),n=p.onIgnoreTag);var f=jNe(e,function(m,y,_,b,x){var T={sourcePosition:m,position:y,isClosing:x,isWhite:Object.prototype.hasOwnProperty.call(i,_)},S=s(_,b,T);if(!$I(S))return S;if(T.isWhite){if(T.isClosing)return"</"+_+">";var C=qNe(b),O=i[_],R=HNe(C.html,function($,I){var U=PD.indexOf(O,$)!==-1,V=o(_,$,I,U);return $I(V)?U?(I=l(_,$,I,h),I?$+'="'+I+'"':$):(V=a(_,$,I,U),$I(V)?void 0:V):V});return b="<"+_,R&&(b+=" "+R),C.closing&&(b+=" /"),b+=">",b}else return S=n(_,b,T),$I(S)?c(b):S},c);return p&&(f=p.remove(f)),f};var YNe=Aye;(function(e,t){var r=fn,i=p6,s=YNe;function n(a,l){var c=new s(l);return c.process(a)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s,function(){for(var a in r)t[a]=r[a];for(var l in i)t[l]=i[l]}();function o(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=e.exports)})(Db,Db.exports);var ZNe=function(){function e(t,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):Db.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;t&&!r?s=t:t&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new Db.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,r){switch(r===void 0&&(r={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,r);default:return r.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t,r){var i=(r!=null?r:{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?Db.exports.escapeAttrValue(t):!n&&!s?Db.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,r,i,s):Db.exports.safeAttrValue(t,r,i,s)},e.prototype.validate=function(t,r){r===void 0&&(r={});var i=this.sanitize(t,r);return{isValid:t===i,sanitized:i}},e.prototype.encodeHTML=function(t){var r=this;return String(t).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},e.prototype.encodeAttrValue=function(t){var r=/^[a-zA-Z0-9]$/;return String(t).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(t.charCodeAt(s)).toString(16),";")})},e.prototype._extendObjectOfArrays=function(t){var r={};return t.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},e.prototype._iterateOverObject=function(t,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(nNe(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=i.validate(c,r);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return r.allowUndefined&&typeof t=="undefined"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const f6=new Map;function Rye(){f6.clear()}function JNe(e){return f6.get(e)}function QNe(e,t){f6.set(e,t)}function dk(e){f6.delete(e)}var Uw,SE,KNe=function(e){if("WebkitTransition"in e.style)Uw="webkitTransitionEnd",SE="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");Uw="transitionend",SE="animationend"}},Oye=function(e){Uw||KNe(e)},eFe=function(e,t){return t===void 0&&(t=e+"-active"),function(r){Oye(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(Uw,s),r.removeEventListener(SE,s),r.classList.remove(e),r.classList.remove(t))};r.classList.add(e),r.addEventListener(Uw,s),r.addEventListener(SE,s),requestAnimationFrame(function(){r.classList.add(t)})}},tFe=function(e,t){return t===void 0&&(t=e+"-active"),function(r,i){Oye(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(Uw,n),r.removeEventListener(SE,n),i())};r.classList.add(e),r.addEventListener(Uw,n),r.addEventListener(SE,n),requestAnimationFrame(function(){r.classList.add(t)})}};const rFe=ee.getLogger("esri.widgets.support.widgetUtils");function Mye(e){const t=Ec.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const r=t.join(" ");return Ec.release(t),r}(()=>{const e=new Map,t=new ResizeObserver(r=>{var i;Rye();for(const s of r)(i=e.get(s.target))==null||i(s)});return(r,i,s)=>(e.has(r)&&rFe.error("Already observing element",r),e.set(r,i),t.observe(r,s),Mp(()=>{t.unobserve(r),e.delete(r)}))})();function em(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function tte(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function FF(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function iFe(e,t){return(e==="enter"?eFe:tFe)(t)}const sFe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],nFe=sFe.reduce((e,t)=>(e[t]=[],e),{}),oFe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Pye=new ZNe({whiteList:nFe,onTagAttr:(e,t,r)=>{const i=`${t}="${r}"`;if(oFe.includes(t))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function aFe(e){return e==="Enter"||e===" "}const Iye="http://www.w3.org/",m6=`${Iye}2000/svg`,$ye=`${Iye}1999/xlink`;let rte=[],yY=(e,t)=>{let r={};return Object.keys(e).forEach(i=>{r[i]=e[i]}),t&&Object.keys(t).forEach(i=>{r[i]=t[i]}),r},_Y=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Lye=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},lFe=(e,t,r)=>{if(t.vnodeSelector!==""){for(let i=r;i<e.length;i++)if(_Y(e[i],t))return i}return-1},pk=(e,t,r,i)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(_Y(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},cFe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},oG=[],aG=!1,Dye=e=>{(e.children||[]).forEach(Dye),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},ite=()=>{aG=!1,oG.forEach(Dye),oG.length=0},ste=e=>{oG.push(e),aG||(aG=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(ite,{timeout:16}):setTimeout(ite,16))},nte=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r)return t.style.pointerEvents="none",void r(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),ste(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),ste(e))},uFe=(e,t,r)=>{if(!t)return;let i=r.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")lG(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(Lye(m),r.styleApplyer(e,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):r.namespace===m6?a==="href"?e.setAttributeNS($ye,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=Pye.sanitize(l):Nye(e)&&a in e?e[a]=l:e.setAttribute(a,l):e[a]=l}}};function Nye(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let UF,hFe=(e,t,r)=>{if(t)for(let i of t)Y2(i,e,void 0,r)},Fye=(e,t,r)=>{hFe(e,t.children,r),t.text&&(e.textContent=t.text),uFe(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},Y2=(e,t,r,i)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),r!==void 0?t.insertBefore(s,r):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(i=yY(i,{namespace:m6})),i.namespace!==void 0?s=e.domNode=a.createElementNS(i.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),r!==void 0?t.insertBefore(s,r):s.parentNode!==t&&t.appendChild(s)),n=l+1}}Fye(s,e,i)}},lG=(e,t,r)=>{t&&t.split(" ").forEach(i=>{i&&e.classList.toggle(i,r)})},dFe=(e,t,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],h=t[l];if(l==="class")h!==c&&(lG(e,h,!1),lG(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let _=f[y],b=!!c[_];b!==!!h[_]&&(s=!0,b?p.add(_):p.remove(_))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],_=c[y];_!==h[y]&&(s=!0,_?(Lye(_),i.styleApplyer(e,y,_)):i.styleApplyer(e,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&i.eventHandlerInterceptor||(i.namespace===m6?l==="href"?e.setAttributeNS($ye,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=Pye.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):Nye(e)&&l in e?e[l]=c:e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},pFe=(e,t,r,i,s)=>{if(r===i)return!1;i=i||rte;let n,o=(r=r||rte).length,a=i.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?r[l]:void 0,f=i[c];if(p!==void 0&&_Y(p,f))h=UF(p,f,s)||h,l++;else{let m=lFe(r,f,l+1);if(m>=0){for(n=l;n<m;n++)nte(r[n]),pk(r,n,e,"removed");h=UF(r[m],f,s)||h,l=m+1}else Y2(f,t,l<o?r[l].domNode:void 0,s),cFe(f),pk(i,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)nte(r[n]),pk(r,n,e,"removed");return h};UF=(e,t,r)=>{let i=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=i.ownerDocument.createTextNode(t.text);return i.parentNode.replaceChild(o,i),t.domNode=o,s=!0,s}t.domNode=i}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(r=yY(r,{namespace:m6})),e.text!==t.text&&(n=!0,t.text===void 0?i.removeChild(i.firstChild):i.textContent=t.text),t.domNode=i,n=pFe(t,i,e.children,t.children,r)||n,n=dFe(i,e.properties,t.properties,r)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[i,r,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(i,t.properties,e.properties),s};let iA=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=e;e=r,UF(i,r,t)},domNode:e.domNode});const fFe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{t.charAt(0)==="-"?e.style.setProperty(t,r):e.style[t]=r}};let ZT=e=>yY(fFe,e),z_={create:(e,t)=>(t=ZT(t),Y2(e,document.createElement("div"),void 0,t),iA(e,t)),append:(e,t,r)=>(r=ZT(r),Y2(t,e,void 0,r),iA(t,r)),insertBefore:(e,t,r)=>(r=ZT(r),Y2(t,e.parentNode,e,r),iA(t,r)),merge:(e,t,r)=>(r=ZT(r),t.domNode=e,Fye(e,t,r),iA(t,r)),replace:(e,t,r)=>(r=ZT(r),Y2(t,e.parentNode,e,r),e.parentNode.removeChild(e),iA(t,r))},Uye,mFe=(e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r};Uye=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let gFe=(e,t)=>{let r=e;return t.forEach(i=>{r=r&&r.children?Uye(r.children,s=>s.domNode===i):void 0}),r},yFe=(e,t,r)=>{let i=function(s){r("domEvent",s);let n=t(),o=mFe(s.currentTarget,n.domNode);o.reverse();let a,l=gFe(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},cG=e=>{let t,r,i=ZT(e),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,_=()=>y;i.eventHandlerInterceptor=yFe(t,_,s),y=p(f,m(),i),a.push(y),l.push(m)},h=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{r||o||(r=requestAnimationFrame(h))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(z_.append,p,f)},insertBefore:(p,f)=>{c(z_.insertBefore,p,f)},merge:(p,f)=>{c(z_.merge,p,f)},replace:(p,f)=>{c(z_.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t},z0=class extends Te{constructor(){super(...arguments),this.items=new pt,this._watchUpdatingTracking=new om,this._callbacks=new Map,this._projector=cG(),this._hiddenProjector=cG()}get needsRender(){return this.items.length>0}get updating(){var e,t;return(t=(e=this._watchUpdatingTracking)==null?void 0:e.updating)!=null?t:!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const r of t.added){const i=()=>r.render();this._callbacks.set(r,i),this._projector.append(this.surface,i)}for(const r of t.removed){const i=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(i.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,r=this._hiddenProjector;let i;const s=()=>(i=e.render(),i);r.append(t,s),r.renderNow();const n={left:0,top:0,right:0,bottom:0};if(i&&i.domNode){const o=i.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(r.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const r=this.computeBoundingRect(e),i=this.computeBoundingRect(t);return Math.max(r.left,i.left)<=Math.min(r.right,i.right)&&Math.max(r.top,i.top)<=Math.min(r.bottom,i.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const t=e.getContext("2d");t.save(),t.font=this._fontString(),this.items.forEach(r=>{t.save(),r.renderCanvas(t),t.restore()}),t.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([d({readOnly:!0})],z0.prototype,"surface",void 0),u([d({readOnly:!0})],z0.prototype,"items",void 0),u([d({readOnly:!0})],z0.prototype,"needsRender",null),u([d({readOnly:!0})],z0.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],z0.prototype,"updating",null),z0=u([P("esri.views.overlay.ViewOverlay")],z0);const ote=z0;function SS(e,t,r,i){let s=null,n=1e3;typeof t=="number"?(n=t,i=r):(s=t!=null?t:null,n=r);let o,a=0;const l=()=>{a=0,e.apply(i,o)},c=(...h)=>{s&&s.apply(i,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const _Fe="randomUUID"in crypto;function kye(){if(_Fe)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=r=>e[r].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const vFe={handleInterceptedEvent:(e,t,r,i)=>(e.scheduleRender(),t.properties[`on${i.type}`].apply(t.properties.bind||r,[i]))},bFe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}},wFe=e=>({...bFe,...e}),xFe=(e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},TFe=(e,t)=>e.find(t),ate=(e,t,r=!1)=>{let i=e;return t.forEach((s,n)=>{const o=i!=null&&i.children?TFe(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==t.length-1||(i=o)}),i},SFe=e=>{let t;const r={...vFe,...e},i=wFe(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{var x;let _;i.eventHandlerInterceptor=(T,S,C,O)=>function(R){let $;s("domEvent",R);const I=xFe(R.currentTarget,_.domNode),U=I.some(G=>{var z;return customElements.get((z=G==null?void 0:G.tagName)==null?void 0:z.toLowerCase())});if(R.eventPhase===Event.CAPTURING_PHASE||!U)I.reverse(),$=ate(_.getLastRender(),I);else{const G=R.composedPath(),z=G.slice(G.indexOf(R.currentTarget),G.indexOf(_.domNode)).filter(Z=>Z.getRootNode()===Z.ownerDocument).reverse();$=ate(_.getLastRender(),z,!0)}let V;return $&&(V=r.handleInterceptedEvent(t,$,this,R)),s("domEventProcessed",R),V},(x=r.postProcessProjectionOptions)==null||x.call(r,i);const b=y();_=f(m,b,i),l.push(_),c.push(y),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,b)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,m)=>{h(z_.append,f,m)},insertBefore:(f,m)=>{h(z_.insertBefore,f,m)},merge:(f,m)=>{h(z_.merge,f,m)},replace:(f,m)=>{h(z_.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},Rr={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let JT,Vye,g6,Bye=!1,kF=!1,vY=!1,mu=!1,lte=null,uG=!1;const Qxt={isDev:!!Rr.isDev,isBrowser:!0,isServer:!1,isTesting:!!Rr.isTesting},Kxt=e=>{const t=new URL(e,Ra.$resourcesUrl$);return t.origin!==TC.location.origin?t.href:t.pathname},EFe=e=>Ra.$resourcesUrl$=e,kw=(e,t="")=>()=>{},cte="http://www.w3.org/1999/xlink",ute={},CFe="http://www.w3.org/2000/svg",AFe="http://www.w3.org/1999/xhtml",RFe=e=>e!=null,bY=e=>(e=typeof e,e==="object"||e==="function"),zye=(e,t,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)i=p[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof e!="function"&&!bY(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?VF(null,i):i),a=o)};if(c(r),t&&(Rr.isDev&&e==="input"&&IFe(t),Rr.vdomKey&&t.key&&(s=t.key),Rr.slotRelocation&&t.name&&(n=t.name),Rr.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(Rr.isDev&&l.some(Gye)&&o4e(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Rr.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,MFe);const h=VF(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),Rr.vdomKey&&(h.$key$=s),Rr.slotRelocation&&(h.$name$=n),h},VF=(e,t)=>{const r={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Rr.vdomAttribute&&(r.$attrs$=null),Rr.vdomKey&&(r.$key$=null),Rr.slotRelocation&&(r.$name$=null),r},OFe={},Gye=e=>e&&e.$tag$===OFe,MFe={forEach:(e,t)=>e.map(hte).forEach(t),map:(e,t)=>e.map(hte).map(t).map(PFe)},hte=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),PFe=e=>{if(typeof e.vtag=="function"){const r=Object.assign({},e.vattrs);return e.vkey&&(r.key=e.vkey),e.vname&&(r.name=e.vname),zye(e.vtag,r,...e.vchildren||[])}const t=VF(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},IFe=e=>{const t=Object.keys(e),r=t.indexOf("value");if(r===-1)return;const i=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(r<i||r<s||r<n||r<o)&&t0e('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},$Fe=e=>a4e.map(t=>t(e)).find(t=>!!t),LFe=(e,t)=>e!=null&&!bY(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,DFe=e=>Rr.lazyLoad?xC(e).$hostElement$:e,eTt=(e,t,r)=>{const i=DFe(e);return{emit:s=>(Rr.isDev&&!i.isConnected&&t0e(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),NFe(i,t,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s}))}},NFe=(e,t,r)=>{const i=Ra.ce(t,r);return e.dispatchEvent(i),i},dte=new WeakMap,FFe=(e,t,r)=>{let i=zF.get(e);u4e&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=t:i.replaceSync(t)):i=t,zF.set(e,i)},UFe=(e,t,r,i)=>{let s=jye(t,r);const n=zF.get(s);if(e=e.nodeType===11?e:xp,n)if(typeof n=="string"){e=e.head||e;let o=dte.get(e),a;o||dte.set(e,o=new Set),o.has(s)||(a=xp.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},kFe=e=>{const t=e.$cmpMeta$,r=e.$hostElement$,i=t.$flags$,s=kw("attachStyles",t.$tagName$),n=UFe(GF&&r.shadowRoot?r.shadowRoot:r.getRootNode(),t,e.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},jye=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),pte=(e,t,r,i,s,n)=>{if(r!==i){let o=yte(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=fte(r),h=fte(i);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?e.style.setProperty(l,i[l]):e.style[l]=i[l])}else if(t!=="key")if(t==="ref")i&&i(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):yte(TC,a)?t=a.slice(2):t=a[2]+t.slice(3),r&&Ra.rel(e,t,r,!1),i&&Ra.ael(e,t,i,!1);else{const l=bY(i);if((o||l&&i!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=i;else{const h=i==null?"":i;t==="list"?o=!1:(r==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),i==null||i===!1?(i!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(cte,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?e.setAttributeNS(cte,t,i):e.setAttribute(t,i))}}},VFe=/\s/,fte=e=>e?e.split(VFe):[],Hye=(e,t,r,i)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||ute,o=t.$attrs$||ute;for(i in n)i in o||pte(s,i,n[i],void 0,r,t.$flags$);for(i in o)pte(s,i,n[i],o[i],r,t.$flags$)},BF=(e,t,r,i)=>{const s=t.$children$[r];let n=0,o,a,l;if(Bye||(vY=!0,s.$tag$==="slot"&&(JT&&i.classList.add(JT+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=xp.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=xp.createTextNode("");else{if(mu||(mu=s.$tag$==="svg"),o=s.$elm$=xp.createElementNS(mu?CFe:AFe,s.$flags$&2?"slot-fb":s.$tag$),mu&&s.$tag$==="foreignObject"&&(mu=!1),Hye(null,s,mu),RFe(JT)&&o["s-si"]!==JT&&o.classList.add(o["s-si"]=JT),s.$children$)for(n=0;n<s.$children$.length;++n)a=BF(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?mu=!1:o.tagName==="foreignObject"&&(mu=!0)}return o["s-hn"]=g6,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=Vye,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[r],l&&l.$tag$===s.$tag$&&e.$elm$&&jO(e.$elm$,!1)),o},jO=(e,t)=>{Ra.$flags$|=1;const r=e.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==g6&&s["s-ol"]&&(Xye(s).insertBefore(s,wY(s)),s["s-ol"].remove(),s["s-ol"]=void 0,vY=!0),t&&jO(s,t)}Ra.$flags$&=-2},qye=(e,t,r,i,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===g6&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=BF(null,r,s,e),a&&(i[s].$elm$=a,o.insertBefore(a,wY(t))))},Wye=(e,t,r,i,s)=>{for(;t<=r;++t)(i=e[t])&&(s=i.$elm$,Jye(i),kF=!0,s["s-ol"]?s["s-ol"].remove():jO(s,!0),s.remove())},BFe=(e,t,r,i)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=i.length-1,f=i[0],m=i[p],y,_;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=i[++n];else if(m==null)m=i[--p];else if(LI(c,f))QT(c,f),c=t[++s],f=i[++n];else if(LI(h,m))QT(h,m),h=t[--l],m=i[--p];else if(LI(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&jO(c.$elm$.parentNode,!1),QT(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=i[--p];else if(LI(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&jO(h.$elm$.parentNode,!1),QT(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=i[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(_=t[o],_.$tag$!==f.$tag$?y=BF(t&&t[n],r,o,e):(QT(_,f),t[o]=void 0,y=_.$elm$),f=i[++n]):(y=BF(t&&t[n],r,n,e),f=i[++n]),y&&Xye(c.$elm$).insertBefore(y,wY(c.$elm$))}s>l?qye(e,i[p+1]==null?null:i[p+1].$elm$,r,i,n,p):n>p&&Wye(t,s,l)},LI=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,wY=e=>e&&e["s-ol"]||e,Xye=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,QT=(e,t)=>{const r=t.$elm$=e.$elm$,i=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(mu=n==="svg"?!0:n==="foreignObject"?!1:mu,n==="slot"||Hye(e,t,mu),i!==null&&s!==null?BFe(r,i,t,s):s!==null?(e.$text$!==null&&(r.textContent=""),qye(r,null,t,s,0,s.length-1)):i!==null&&Wye(i,0,i.length-1),mu&&n==="svg"&&(mu=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(r.data=o)},Yye=e=>{const t=e.childNodes;let r,i,s,n,o,a;for(i=0,s=t.length;i<s;i++)if(r=t[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){r.hidden=!0;break}}Yye(r)}},rp=[],Zye=e=>{let t,r,i,s,n,o,a=0;const l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(r=t["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=t["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==t["s-hn"]&&(mte(r,s)?(n=rp.find(h=>h.$nodeToRelocate$===r),kF=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=t:rp.push({$slotRefNode$:t,$nodeToRelocate$:r}),r["s-sr"]&&rp.map(h=>{mte(h.$nodeToRelocate$,r["s-sn"])&&(n=rp.find(p=>p.$nodeToRelocate$===r),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):rp.some(h=>h.$nodeToRelocate$===r)||rp.push({$nodeToRelocate$:r}));t.nodeType===1&&Zye(t)}},mte=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Jye=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Jye)},zFe=(e,t)=>{const r=e.$hostElement$,i=e.$cmpMeta$,s=e.$vnode$||VF(null,null),n=Gye(t)?t:zye(null,null,t);g6=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,JT=r["s-sc"],Vye=r["s-cr"],Bye=GF&&(i.$flags$&1)!==0,kF=!1,QT(s,n);{if(Ra.$flags$|=1,vY){Zye(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<rp.length;f++)o=rp[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=xp.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<rp.length;f++)if(o=rp[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}kF&&Yye(n.$elm$),Ra.$flags$&=-2,rp.length=0}},GFe=(e,t)=>{},xY=(e,t)=>{Rr.taskQueue&&Rr.updatable&&(e.$flags$|=16),GFe(e,e.$ancestorComponent$);const r=()=>jFe(e,t);return Rr.taskQueue?p4e(r):r()},jFe=(e,t)=>{const r=e.$hostElement$,i=kw("scheduleUpdate",e.$cmpMeta$.$tagName$),s=r;let n;return t?n=ES(s,"componentWillLoad"):n=ES(s,"componentWillUpdate"),n=gte(n,()=>ES(s,"componentWillRender")),i(),gte(n,()=>HFe(e,s,t))},HFe=async(e,t,r)=>{const i=e.$hostElement$,s=kw("update",e.$cmpMeta$.$tagName$);i["s-rc"],r&&kFe(e);const n=kw("render",e.$cmpMeta$.$tagName$);qFe(e,t,i),n(),s(),WFe(e)},qFe=(e,t,r)=>{try{lte=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Rr.hasRenderFn||Rr.reflect)&&(Rr.vdomRender||Rr.reflect)&&(Rr.hydrateServerSide||zFe(e,t))}catch(a){vP(a,e.$hostElement$)}return lte=null,null},WFe=e=>{const t=e.$cmpMeta$.$tagName$,r=e.$hostElement$,i=kw("postUpdate",t),s=r;e.$ancestorComponent$,ES(s,"componentDidRender"),e.$flags$&64?(ES(s,"componentDidUpdate"),i()):(e.$flags$|=64,ES(s,"componentDidLoad"),i())},tTt=e=>{if(Rr.updatable){const t=xC(e),r=t.$hostElement$.isConnected;return r&&(t.$flags$&18)===2&&xY(t,!1),r}return!1},ES=(e,t,r)=>{if(e&&e[t])try{return e[t](r)}catch(i){vP(i)}},gte=(e,t)=>e&&e.then?e.then(t):t(),XFe=(e,t)=>xC(e).$instanceValues$.get(t),YFe=(e,t,r,i)=>{const s=xC(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;r=LFe(r,i.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(t,r);{if(i.$watchers$&&a&128){const p=i.$watchers$[t];p&&p.map(f=>{try{l[f](r,o,t)}catch(m){vP(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,t)===!1)return;xY(s,!1)}}}},ZFe=(e,t,r)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const i=Object.entries(t.$members$),s=e.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return XFe(this,n)},set(a){YFe(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Ra.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},JFe=async(e,t,r,i,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=$Fe(e)]);const a=jye(r,t.$modeName$);if(!zF.has(a)){const l=kw("registerStyles",r.$tagName$);FFe(a,o,!!(r.$flags$&1)),l()}}t.$ancestorComponent$,(()=>xY(t,!0))()},QFe=e=>{},KFe=e=>{if((Ra.$flags$&1)===0){const t=xC(e),r=t.$cmpMeta$,i=kw("connectedCallback",r.$tagName$);t.$flags$&1?(Qye(e,t,r.$listeners$),QFe(t.$lazyInstance$)):(t.$flags$|=1,r.$flags$&12&&e4e(e),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),JFe(e,t,r)),i()}},e4e=e=>{const t=e["s-cr"]=xp.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},t4e=e=>{if((Ra.$flags$&1)===0){const t=xC(e);t.$rmListeners$&&(t.$rmListeners$.map(r=>r()),t.$rmListeners$=void 0)}},rTt=(e,t)=>{const r={$flags$:t[0],$tagName$:t[1]};Rr.member&&(r.$members$=t[2]),Rr.hostListener&&(r.$listeners$=t[3]),Rr.watchCallback&&(r.$watchers$=e.$watchers$),Rr.reflect&&(r.$attrsToReflect$=[]),Rr.shadowDom&&!GF&&r.$flags$&1&&(r.$flags$|=8);const i=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){n4e(this,r)},connectedCallback(){KFe(this),Rr.connectedCallback&&i&&i.call(this)},disconnectedCallback(){t4e(this),Rr.disconnectedCallback&&s&&s.call(this)},__attachShadow(){GF?Rr.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=r.$tagName$,ZFe(e,r)},iTt=(e,t)=>t,Qye=(e,t,r,i)=>{r&&r.map(([s,n,o])=>{const a=i4e(e,s),l=r4e(t,o),c=s4e(s);Ra.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>Ra.rel(a,n,l,c))})},r4e=(e,t)=>r=>{try{Rr.lazyLoad||e.$hostElement$[t](r)}catch(i){vP(i)}},i4e=(e,t)=>t&4?xp:t&8?TC:t&16?xp.body:e,s4e=e=>l4e?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Kye=new WeakMap,xC=e=>Kye.get(e),n4e=(e,t)=>{const r={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Rr.isDev&&(r.$renderCount$=0),Rr.method&&Rr.lazyLoad&&(r.$onInstancePromise$=new Promise(i=>r.$onInstanceResolve$=i)),Rr.asyncLoading&&(r.$onReadyPromise$=new Promise(i=>r.$onReadyResolve$=i),e["s-p"]=[],e["s-rc"]=[]),Qye(e,r,t.$listeners$),Kye.set(e,r)},yte=(e,t)=>t in e,vP=(e,t)=>(0,console.error)(e,t),e0e=Rr.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],o4e=(...e)=>console.error(...e0e,...e),t0e=(...e)=>console.warn(...e0e,...e),zF=new Map,a4e=[],TC=typeof window!="undefined"?window:{};Rr.cssVarShim&&TC.CSS;const xp=TC.document||{head:{}},sTt=TC.HTMLElement||class{},Ra={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,r,i)=>e.addEventListener(t,r,i),rel:(e,t,r,i)=>e.removeEventListener(t,r,i),ce:(e,t)=>new CustomEvent(e,t)},GF=Rr.shadowDomShim&&Rr.shadowDom?(()=>(xp.head.attachShadow+"").indexOf("[native")>-1)():!0,l4e=(()=>{let e=!1;try{xp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),c4e=e=>Promise.resolve(e),u4e=Rr.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})():!1,_te=[],r0e=[],h4e=(e,t)=>r=>{e.push(r),uG||(uG=!0,t&&Ra.$flags$&4?d4e(hG):Ra.raf(hG))},vte=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(r){vP(r)}e.length=0},hG=()=>{vte(_te),vte(r0e),(uG=_te.length>0)&&Ra.raf(hG)},d4e=e=>c4e().then(e),p4e=h4e(r0e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */const i0e="calcite-mode-auto",s0e="calcite-mode-dark",f4e="calcite-mode-light",nTt={autoMode:i0e,darkMode:s0e,lightMode:f4e,rtl:"calcite--rtl"};/*!
* tabbable 6.0.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var n0e=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],jF=n0e.join(","),o0e=typeof Element=="undefined",Vw=o0e?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,HF=!o0e&&Element.prototype.getRootNode?function(e){return e.getRootNode()}:function(e){return e.ownerDocument},a0e=function(t,r,i){var s=Array.prototype.slice.apply(t.querySelectorAll(jF));return r&&Vw.call(t,jF)&&s.unshift(t),s=s.filter(i),s},l0e=function e(t,r,i){for(var s=[],n=Array.from(t);n.length;){var o=n.shift();if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=e(l,!0,i);i.flatten?s.push.apply(s,c):s.push({scopeParent:o,candidates:c})}else{var h=Vw.call(o,jF);h&&i.filter(o)&&(r||!t.includes(o))&&s.push(o);var p=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),f=!i.shadowRootFilter||i.shadowRootFilter(o);if(p&&f){var m=e(p===!0?o.children:p.children,!0,i);i.flatten?s.push.apply(s,m):s.push({scopeParent:o,candidates:m})}else n.unshift.apply(n,o.children)}}return s},c0e=function(t,r){return t.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||t.isContentEditable)&&isNaN(parseInt(t.getAttribute("tabindex"),10))?0:t.tabIndex},m4e=function(t,r){return t.tabIndex===r.tabIndex?t.documentOrder-r.documentOrder:t.tabIndex-r.tabIndex},u0e=function(t){return t.tagName==="INPUT"},g4e=function(t){return u0e(t)&&t.type==="hidden"},y4e=function(t){var r=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(i){return i.tagName==="SUMMARY"});return r},_4e=function(t,r){for(var i=0;i<t.length;i++)if(t[i].checked&&t[i].form===r)return t[i]},v4e=function(t){if(!t.name)return!0;var r=t.form||HF(t),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},s;if(typeof window!="undefined"&&typeof window.CSS!="undefined"&&typeof window.CSS.escape=="function")s=i(window.CSS.escape(t.name));else try{s=i(t.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var n=_4e(s,t.form);return!n||n===t},b4e=function(t){return u0e(t)&&t.type==="radio"},w4e=function(t){return b4e(t)&&!v4e(t)},x4e=function(t){for(var r,i=HF(t).host,s=!!((r=i)!==null&&r!==void 0&&r.ownerDocument.contains(i)||t.ownerDocument.contains(t));!s&&i;){var n;i=HF(i).host,s=!!((n=i)!==null&&n!==void 0&&n.ownerDocument.contains(i))}return s},bte=function(t){var r=t.getBoundingClientRect(),i=r.width,s=r.height;return i===0&&s===0},T4e=function(t,r){var i=r.displayCheck,s=r.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var n=Vw.call(t,"details>summary:first-of-type"),o=n?t.parentElement:t;if(Vw.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof s=="function"){for(var a=t;t;){var l=t.parentElement,c=HF(t);if(l&&!l.shadowRoot&&s(l)===!0)return bte(t);t.assignedSlot?t=t.assignedSlot:!l&&c!==t.ownerDocument?t=c.host:t=l}t=a}if(x4e(t))return!t.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return bte(t);return!1},S4e=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var r=t.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var s=r.children.item(i);if(s.tagName==="LEGEND")return Vw.call(r,"fieldset[disabled] *")?!0:!s.contains(t)}return!0}r=r.parentElement}return!1},qF=function(t,r){return!(r.disabled||g4e(r)||T4e(r,t)||y4e(r)||S4e(r))},dG=function(t,r){return!(w4e(r)||c0e(r)<0||!qF(t,r))},E4e=function(t){var r=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},C4e=function e(t){var r=[],i=[];return t.forEach(function(s,n){var o=!!s.scopeParent,a=o?s.scopeParent:s,l=c0e(a,o),c=o?e(s.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:n,tabIndex:l,item:s,isScope:o,content:c})}),i.sort(m4e).reduce(function(s,n){return n.isScope?s.push.apply(s,n.content):s.push(n.content),s},[]).concat(r)},A4e=function(t,r){r=r||{};var i;return r.getShadowRoot?i=l0e([t],r.includeContainer,{filter:dG.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:E4e}):i=a0e(t,r.includeContainer,dG.bind(null,r)),C4e(i)},oTt=function(t,r){r=r||{};var i;return r.getShadowRoot?i=l0e([t],r.includeContainer,{filter:qF.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=a0e(t,r.includeContainer,qF.bind(null,r)),i},aTt=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return Vw.call(t,jF)===!1?!1:dG(r,t)},R4e=n0e.concat("iframe").join(","),lTt=function(t,r){if(r=r||{},!t)throw new Error("No node provided");return Vw.call(t,R4e)===!1?!1:qF(r,t)};const O4e={getShadowRoot:!0};function cTt(e){const t="dir",r=`[${t}]`,i=M4e(e,r);return i?i.getAttribute(t):"ltr"}function uTt(e,t,r){const i=`[${t}]`,s=e.closest(i);return s?s.getAttribute(t):r}function h0e(e){return e.getRootNode()}function d0e(e){return e.host||null}function hTt(e,{selector:t,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=h0e(s),o=r?"getElementById"in n?n.getElementById(r):null:t?n.querySelector(t):null,a=d0e(n);return o||(a?i(a):null)}return i(e)}function M4e(e,t){function r(i){return i?i.closest(t)||r(d0e(h0e(i))):null}return r(e)}function P4e(e,t){return p0e(e,t)}function p0e(e,t){if(!e)return;const r=t(e);if(r!==void 0)return r;const{parentNode:i}=e;return p0e(i instanceof ShadowRoot?i.host:i,t)}function dTt(e,t){return!!P4e(t,r=>r===e?!0:void 0)}function I4e(e){return typeof(e==null?void 0:e.setFocus)=="function"}async function pTt(e){if(!!e)return I4e(e)?e.setFocus():e.focus()}function fTt(e){(A4e(e,O4e)[0]||e).focus()}const HO=":not([slot])";function mTt(e,t,r){t&&!Array.isArray(t)&&typeof t!="string"&&(r=t,t=null);const i=t?Array.isArray(t)?t.map(s=>`[slot="${s}"]`).join(","):`[slot="${t}"]`:HO;return r!=null&&r.all?$4e(e,i,r):L4e(e,i,r)}function f0e(e,t){return e?Array.from(e.children||[]).filter(r=>r==null?void 0:r.matches(t)):[]}function $4e(e,t,r){let i=t===HO?f0e(e,HO):Array.from(e.querySelectorAll(t));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===e),i=r!=null&&r.matches?i.filter(n=>n==null?void 0:n.matches(r.matches)):i;const s=r==null?void 0:r.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function L4e(e,t,r){let i=t===HO?f0e(e,HO)[0]||null:e.querySelector(t);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===e?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const s=r==null?void 0:r.selector;return s?i==null?void 0:i.querySelector(s):i}function gTt(e,t,r){if(typeof t=="string"&&t!=="")return t;if(t==="")return e[r]}function yTt(e){return Boolean(e).toString()}function _Tt(e){return!!D4e(e).length}function D4e(e){return e.target.assignedElements({flatten:!0})}function vTt(e){return!!(e.isPrimary&&e.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */function wte(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>e.contains(s0e)||e.contains(i0e)&&t?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function N4e(){typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?wte():document.addEventListener("DOMContentLoaded",()=>wte(),{once:!0}))}const F4e=N4e;F4e();let m0e;function U4e(){EFe(Ru(Kr(m0e)))}m0e="components/assets";const g0e=Symbol("widget"),k4e=Symbol("widget-test-data"),V4e=[],B4e={},WF=new WeakMap;function y0e(e,t){let r=t.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=y0e(e,r[s]);else r=V4e;const i=t.vnodeSelector;if(TY(i)){const s=t.properties||B4e,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:z4e,afterUpdate:G4e,afterRemoved:_0e,parentWidget:e,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return t}function z4e(e,t,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,WF.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),i._internalHandles.add(Mp(()=>_0e(e)))}function G4e(e,t,r,{widgetProperties:i}){var n;const s=WF.get(e);s&&(s.set(i),(n=s.afterUpdate)==null||n.call(s,s,e))}function _0e(e){var r;const t=WF.get(e);t&&((r=t.afterRemoved)==null||r.call(t,t,e),t.destroy(),WF.delete(e))}function TY(e){return typeof e=="function"&&e[g0e]}const xte=new Set;function j4e(e){xte.add(e),e.finally(()=>xte.delete(e))}var v0e;const H4e="esri.widgets.Widget";let q4e=0;const W4e={widgetIcon:"esri-icon-checkbox-unchecked"};function b0e(e,t){for(const r in t)e[r]!=null&&(typeof e[r]=="object"&&typeof t[r]=="object"?b0e(e[r],t==null?void 0:t[r]):e[r]=t[r]);return e}const X4e=SFe({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(i,s,n,o)=>{const a=t==null?void 0:t(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),h=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(e,t,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(Rye(),e.scheduleRender(),l[a].call(l.bind||r,i))}});let fk=!1,Eo=class extends fP(Vs.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Jr,this._projector=X4e,this._readyForTrueRender=!1,this.iconClass=W4e.widgetIcon,this.key=this,this._loadLocale=PW(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await fo(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await Rme(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=b0e(re(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&ee.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),U4e();const r="esri-widget-uid-"+kye(),i=this.render.bind(this);this._trackingTarget=new I5(()=>this.scheduleRender());const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const n=i();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=r),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(h=n.children)==null||h.forEach(p=>{if(TY(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),y0e(this,n)};this.render=()=>{var o;if(fk)return s();let n=(o=JNe(this))!=null?o:null;if(n)return n;this._trackingTarget.clear(),fk=!0;try{n=py(this._trackingTarget,s)}catch(a){throw console.error(a),a}finally{fk=!1}return n&&QNe(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),j4e(this._resourcesFetch)}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(QB)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Ve(this._trackingTarget),Ve(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,dk(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return Q5(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+q4e++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(v0e=g0e,k4e)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(dk(this),this._projector.scheduleRender())}classes(...e){return Mye.apply(this,e)}renderNow(){dk(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this._internalHandles.add(se(()=>this.viewModel,(r,i)=>{i&&this._internalHandles.remove("delegated-events"),r&&A5(r)&&this._internalHandles.add(this._delegatedEventNames.map(s=>rP(r,s,n=>{this.emit(s,n)})),"delegated-events")},kt)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(QB),this.scheduleRender()};this._internalHandles.add([rfe(e),se(()=>this.uiStrings,e),oa(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var t;this._attached&&(this._projector.detach(this.render),this._attached=!1),(t=e==null?void 0:e.parentNode)==null||t.removeChild(e)}};Eo[v0e]=!0,u([d()],Eo.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Eo.prototype,"container",null),u([zt("container")],Eo.prototype,"castContainer",null),u([d()],Eo.prototype,"iconClass",void 0),u([d()],Eo.prototype,"id",null),u([d()],Eo.prototype,"label",null),u([d()],Eo.prototype,"renderable",null),u([d()],Eo.prototype,"uiStrings",void 0),u([d()],Eo.prototype,"viewModel",void 0),u([d({value:!0})],Eo.prototype,"visible",null),u([d()],Eo.prototype,"key",void 0),u([d()],Eo.prototype,"children",void 0),u([d()],Eo.prototype,"afterCreate",void 0),u([d()],Eo.prototype,"afterUpdate",void 0),u([d()],Eo.prototype,"afterRemoved",void 0),Eo=u([P(H4e)],Eo);const cl=Eo;function Y4e(e,t,r){return e.units[t][r]}function y6(e,t,r,i=2,s="abbr"){return`${vm(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:t>0?"never":"exceptZero"})} ${Y4e(e,r,s)}`}function bTt(e,t,r,i=2,s="abbr"){const n=fpe(t,r);return y6(e,xn(t,r,n),n,i,s)}function wTt(e,t,r,i=2,s="abbr"){const n=mpe(t,r);return y6(e,xn(t,r,n),n,i,s)}function xTt(e,t,r,i=2,s="abbr"){const n=gpe(t,r);return y6(e,xn(t,r,n),n,i,s)}function TTt(e,t,r,i=2,s="abbr"){const n=ype(t,r);return y6(e,xn(t,r,n),n,i,s)}const Tte=["B","kB","MB","GB","TB"];function Z4e(e,t){let r=t===0?0:Math.floor(Math.log(t)/Math.log(bE.KILOBYTES));r=ye(r,0,Tte.length-1);const i=vm(t/bE.KILOBYTES**r,{maximumFractionDigits:2});return mm(e.units.bytes[Tte[r]],{fileSize:i})}function J4e(e){const{exifInfo:t,exifName:r,tagName:i}=e;if(!t||!r||!i)return null;const s=t.find(n=>n.name===r);return s?Q4e({tagName:i,tags:s.tags}):null}function Q4e(e){const{tagName:t,tags:r}=e;if(!r||!t)return null;const i=r.find(s=>s.name===t);return i&&i.value||null}var pG;const K4e={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let ac=pG=class extends fe{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=J4e({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return K4e[t]||null}clone(){return new pG({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],ac.prototype,"contentType",void 0),u([d()],ac.prototype,"exifInfo",void 0),u([d({readOnly:!0})],ac.prototype,"orientationInfo",null),u([d({type:Ri})],ac.prototype,"id",void 0),u([d({type:String})],ac.prototype,"globalId",void 0),u([d({type:String})],ac.prototype,"keywords",void 0),u([d({type:String})],ac.prototype,"name",void 0),u([d({json:{read:!1}})],ac.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],ac.prototype,"parentObjectId",void 0),u([d({type:Ri})],ac.prototype,"size",void 0),u([d({json:{read:!1}})],ac.prototype,"url",void 0),ac=pG=u([P("esri.layers.support.AttachmentInfo")],ac);const e5e=ac;var fG;let Xo=fG=class extends fe{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new fG(re({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Xo.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Xo.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Xo.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Xo.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Xo.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Xo.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Xo.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Xo.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Xo.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Xo.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Xo.prototype,"start",void 0),u([Be("start"),Be("num")],Xo.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Xo.prototype,"where",void 0),Xo=fG=u([P("esri.rest.support.AttachmentQuery")],Xo),Xo.from=Us(Xo);const mG=Xo,t5e="esri.widgets.Feature.support.featureUtils",Ste=ee.getLogger(t5e),r5e=/href=(""|'')/gi,i5e=/(\{([^\{\r\n]+)\})/g,s5e=/\'/g,w0e=/^\s*expression\//i,n5e=/(\n)/gi,o5e=/[\u00A0-\u9999<>\&]/gim,a5e=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,l5e=/^(?:mailto:|tel:)/,x0e="relationships/",gG=N5("short-date-short-time");function T0e(e){if(!E(e))return e.get("sourceLayer")||e.get("layer")}async function XF(e,t){return typeof e=="function"?e.call(null,t):e}function S0e(e=""){if(e)return!l5e.test(e.trim().toLowerCase())}function SY(e){return!!e&&w0e.test(e)}function c5e(e,t){if(!SY(t)||!e)return null;const r=t.replace(w0e,"").toLowerCase();let i=null;return e.some(s=>s.name.toLowerCase()===r&&(i=s,!0)),i}function E0e(e,t){const r=c5e(t,e==null?void 0:e.fieldName);return r?r.title||null:e?e.label||e.fieldName:null}function u5e(e,t){const r=t.get(e.toLowerCase());return`{${r&&r.fieldName||e}}`}function h5e(e){return e.replace(r5e,"")}function qO(e,t){const r=EY(t,e);return r?r.name:e}function d5e(e,t){return e&&e.map(r=>qO(r,t))}function EY(e,t){var r;return e&&typeof e.getField=="function"&&t&&(r=e.getField(t))!=null?r:null}function C0e(e){return`${e}`.trim()}function Qb({attributes:e,globalAttributes:t,layer:r,text:i,expressionAttributes:s,fieldInfoMap:n}){return i?yG({formattedAttributes:t,template:g5e(i,{...t,...s,...e},r),fieldInfoMap:n}):""}function yG({formattedAttributes:e,template:t,fieldInfoMap:r}){return C0e(h5e(mm(mm(t,i=>u5e(i,r)),e)))}function p5e(e,t,r=!1){const i=t[e];if(typeof i=="string"){const s="%27",n=(r?encodeURIComponent(i):i).replace(s5e,s);t[e]=n}}function f5e(e,t=!1){const r={...e};return Object.keys(r).forEach(i=>p5e(i,r,t)),r}function m5e(e,t,r){const i=(t=C0e(t))&&t[0]!=="{";return mm(e,f5e(r,i||!1))}function _G(e,t){return e.replace(i5e,(r,i,s)=>{const n=EY(t,s);return n?`{${n.name}}`:i})}function g5e(e,t,r){const i=_G(e,r);return i&&i.replace(a5e,(s,n,o)=>m5e(s,n||o,t))}function y5e(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const r=Number(e);if(!isNaN(r))return r}return e}function _5e(e){return(e==null?void 0:e.type)==="feature"}function Ete(e){return!!(e!=null&&e.layer)}function v5e(e){return(e==null?void 0:e.type)==="map-image"}function b5e(e,t){var c;const r=t.fieldInfos,i=t.fieldName,s=(c=A0e(r,i))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=EY(o,i);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new q2;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!Ete(o)&&_5e(o)&&o.datesInUnknownTimezone||Ete(o)&&v5e(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof e=="string"&&Kpe(i)&&l?l.formatRasterPixelValue(e):typeof(e=y5e(e,l))=="string"||e==null||l==null?bP(e):n?vm(e,{...nfe(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function A0e(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let i;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==r)&&(i=s,!0)),i}function w5e({fieldName:e,graphic:t,layer:r}){if(Yg(e)||!r||typeof r.getFeatureType!="function")return null;const{typeIdField:i}=r;if(!i||e!==i)return null;const s=r.getFeatureType(t);return s?s.name:null}function x5e({fieldName:e,value:t,graphic:r,layer:i}){if(Yg(e)||!i||typeof i.getFieldDomain!="function")return null;const s=r&&i.getFieldDomain(e,{feature:r});return s&&s.type==="coded-value"?s.getName(t):null}function T5e(e,t){const{creatorField:r,creationDateField:i,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:_m(o,gG),user:l}}const a=t[i];if(typeof a=="number"){const l=t[r];return{type:"create",date:_m(a,gG),user:l}}return null}function S5e(e,t){const r=new Map;return e&&e.forEach(i=>{const s=qO(i.fieldName,t);i.fieldName=s,r.set(s.toLowerCase(),i)}),r}function Cte(e){const t=[];if(!e)return t;const{fieldInfos:r,content:i}=e;return r&&t.push(...r),i&&Array.isArray(i)&&i.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function CY(e){return e.replace(o5e,t=>`&#${t.charCodeAt(0)};`)}function bP(e){return typeof e=="string"?e.replace(n5e,'<br class="esri-text-new-line" />'):e}function R0e(e){const{value:t,fieldName:r,fieldInfos:i,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=x5e({fieldName:r,value:t,graphic:o,layer:n});if(a)return a;const l=w5e({fieldName:r,graphic:o,layer:n});if(l)return l;if(s.get(r.toLowerCase()))return b5e(t,{fieldInfos:i||Array.from(s.values()),fieldName:r,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(r)?_m(t,gG):bP(t)}function mk({fieldInfos:e,attributes:t,layer:r,graphic:i,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>R5e({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:r})),t&&Object.keys(t).forEach(a=>{const l=t[a];o[a]=R0e({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:r,value:l,graphic:i})}),o}async function O0e(e,t){var h,p;const{layer:r,graphic:i,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:r,graphic:i,objectId:l,requiredFields:s};return Ste.warn(f,m),null}if(!((p=(h=pye(r))==null?void 0:h.operations)!=null&&p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:r,graphic:i,requiredFields:s,returnGeometry:o};return Ste.warn(f,m),null}const c=r.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[r.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await r.queryFeatures(c,t)).features[0]}async function E5e(e){var i;if(!((i=e.expressionInfos)!=null&&i.length))return!1;const t=await ym(),{arcadeUtils:{hasGeometryFunctions:r}}=t;return r(e)}async function C5e({graphic:e,popupTemplate:t,layer:r,spatialReference:i},s){if(!r||!t||(typeof r.load=="function"&&await r.load(s),!e.attributes))return;const n=e.attributes[r.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(r.fieldsIndex),l=DMe(a,e),c=l?[]:a,h=t.returnGeometry||await E5e(t);if(l&&!h)return;const p=await O0e({layer:r,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:i},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes={...e.attributes,...p.attributes}))}function Yg(e=""){return!!e&&e.includes(x0e)}function A5e(e){return e?`${x0e}${e.layerId}/${e.fieldName}`:""}function Ate({attributes:e,graphic:t,relatedInfo:r,fieldInfos:i,fieldInfoMap:s,layer:n}){e&&t&&r&&Object.keys(t.attributes).forEach(o=>{const a=A5e({layerId:r.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=R0e({fieldName:a,fieldInfos:i,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function R5e({attributes:e,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>Ate({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>Ate({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:s})))}const Rte=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},M0e=({layer:e,method:t,query:r,definitionExpression:i})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||t==="attachments")return;const s=v(r.where)?r.where:null,n=v(r.geometry)?r.geometry:null;Rte(i)||Rte(s)||(n==null?void 0:n.type)==="extent"||r.resultType==="tile"||(r.cacheHint=!0)},O5e=({query:e,layer:t,method:r})=>{M0e({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},M5e=({queryPayload:e,layer:t,method:r})=>{M0e({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})};function P5e(e,t,r){return e&&t&&r?Ote(e.allLayers,t,r)||Ote(e.allTables,t,r):null}function Ote(e,t,r){return e.find(i=>i!==t&&i.type==="feature"&&i.url===t.url&&i.layerId===r.relatedTableId)}const Mte={editing:!1,operations:{add:!0,update:!0,delete:!0}},P0e=pt.ofType(e5e);let lc=class extends Te{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...Mte},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new P0e,this.fileInfos=new pt,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(se(()=>this.graphic,()=>this._graphicChanged(),kt))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...Mte,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return(t==null?void 0:t.loaded)&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new j("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId(),i=new mG({objectIds:[r],returnMetadata:!0}),s=[],n=e.queryAttachments(i).then(a=>a[r]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e,t=this.graphic){var a;const{_attachmentLayer:r,attachmentInfos:i,abilities:s}=this;if(!t)throw new j("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new j("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((a=s.operations)!=null&&a.add))throw new j("invalid-abilities","addAttachment(): add abilities are required.");if(!r||typeof r.addAttachment!="function")throw new j("invalid-layer","addAttachment(): A valid layer is required.");const n=r.addAttachment(t,e).then(l=>this._queryAttachment(l.objectId,t)),o=await n;return i.add(o),o}async deleteAttachment(e){var a;const{_attachmentLayer:t,attachmentInfos:r,graphic:i,abilities:s}=this;if(!e)throw new j("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((a=s.operations)!=null&&a.delete))throw new j("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new j("invalid-layer","deleteAttachment(): A valid layer is required.");if(!i)throw new j("invalid-graphic","deleteAttachment(): A graphic is required.");const n=t.deleteAttachments(i,[e.id]).then(()=>e),o=await n;return r.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){var c;const{_attachmentLayer:r,attachmentInfos:i,graphic:s,abilities:n}=this;if(!e)throw new j("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new j("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!((c=n.operations)!=null&&c.update))throw new j("invalid-abilities","updateAttachment(): Update abilities are required.");const o=i.findIndex(h=>h===t);if(!r||typeof r.updateAttachment!="function")throw new j("invalid-layer","updateAttachment(): A valid layer is required.");if(!s)throw new j("invalid-graphic","updateAttachment(): A graphic is required.");const a=r.updateAttachment(s,t.id,e).then(h=>this._queryAttachment(h.objectId)),l=await a;return i.splice(o,1,l),l}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const r={file:e,form:t};return this.fileInfos.add(r),r}updateFile(e,t,r=this.activeFileInfo){if(!e||!t||!r)return null;const i=this.fileInfos.findIndex(s=>r===s);return i>-1&&this.fileInfos.splice(i,1,{file:e,form:t}),this.fileInfos.items[i]}deleteFile(e){const t=this.fileInfos.find(r=>r.file===e);return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:r}=this;if(!e||!(r!=null&&r.queryAttachments))throw new j("invalid-attachment-id","Could not query attachment.");const i=this._getObjectId(t),s=new mG({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(s).then(n=>n[i][0])}_getObjectId(e=this.graphic){var t;return(t=e==null?void 0:e.getObjectId())!=null?t:null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=T0e(e);this._attachmentLayer=t?t.type==="scene"&&v(t.associatedLayer)?t.associatedLayer:t:null}};u([d()],lc.prototype,"abilities",void 0),u([zt("abilities")],lc.prototype,"castAbilities",null),u([d()],lc.prototype,"activeAttachmentInfo",void 0),u([d()],lc.prototype,"activeFileInfo",void 0),u([d({readOnly:!0,type:P0e})],lc.prototype,"attachmentInfos",void 0),u([d()],lc.prototype,"fileInfos",void 0),u([d({type:Aa})],lc.prototype,"graphic",void 0),u([d()],lc.prototype,"mode",void 0),u([d({readOnly:!0})],lc.prototype,"state",null),u([d()],lc.prototype,"filesEnabled",void 0),u([d({readOnly:!0})],lc.prototype,"supportsResizeAttachments",null),lc=u([P("esri.widgets.Attachments.AttachmentsViewModel")],lc);const AY=lc;function Pte(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function I5e(e){const t=Kr("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function il(e){return(t,r)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}var $5e=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},I0e=function(e,t){for(var r=0,i=e.length;r<i;r++){var s=e[r];Array.isArray(s)?I0e(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=$5e(s)),t.push(s))}},L5e=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:r[0],domNode:null};var s=[];return I0e(r,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function ne(e,t,...r){return typeof e!="function"||TY(e)?L5e(e,t,...r):e(t,...r)}const Ite={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},ui="esri-attachments",Wv="esri-button",Xe={base:ui,loaderContainer:`${ui}__loader-container`,loader:`${ui}__loader`,fadeIn:`${ui}--fade-in`,container:`${ui}__container`,containerList:`${ui}__container--list`,containerPreview:`${ui}__container--preview`,actions:`${ui}__actions`,deleteButton:`${ui}__delete-button`,addAttachmentButton:`${ui}__add-attachment-button`,errorMessage:`${ui}__error-message`,items:`${ui}__items`,item:`${ui}__item`,itemButton:`${ui}__item-button`,itemMask:`${ui}__item-mask`,itemMaskIcon:`${ui}__item-mask--icon`,itemImage:`${ui}__image`,itemImageResizable:`${ui}__image--resizable`,itemLabel:`${ui}__label`,itemFilename:`${ui}__filename`,itemChevronIcon:`${ui}__item-chevron-icon`,itemLink:`${ui}__item-link`,itemLinkOverlay:`${ui}__item-link-overlay`,itemLinkOverlayIcon:`${ui}__item-link-overlay-icon`,itemEditIcon:`${ui}__item-edit-icon`,itemAddIcon:`${ui}__item-add-icon`,itemAddButton:`${ui}__item-add-button`,formNode:`${ui}__form-node`,fileFieldset:`${ui}__file-fieldset`,fileLabel:`${ui}__file-label`,fileName:`${ui}__file-name`,fileInput:`${ui}__file-input`,metadata:`${ui}__metadata`,metadataFieldset:`${ui}__metadata-fieldset`,progressBar:`${ui}__progress-bar`,esriWidget:"esri-widget",esriButton:Wv,buttonDisabled:`${Wv}--disabled`,esriButtonSecondary:`${Wv}--secondary`,esriButtonTertiary:`${Wv}--tertiary`,esriButtonThird:`${Wv}--third`,esriButtonSmall:`${Wv}--small`,esriButtonHalf:`${Wv}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},gk=window.CSS;let za=class extends cl{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...Ite},this._supportsImageOrientation=gk&&gk.supports&&gk.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new AY),this.addHandles([dn(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),dn(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),se(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),kt)])}loadDependencies(){return Promise.all([ie(()=>import("./calcite-icon.55d8d95f.js"),["assets/calcite-icon.55d8d95f.js","assets/icon.3bedc1f6.js","assets/observers.7ede75e6.js"])])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...Ite,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new j("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new j("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new j("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){var r;const t=this.viewModel.deleteFile(e||((r=this.viewModel.activeFileInfo)==null?void 0:r.file));return this.viewModel.mode="view",t}render(){const{submitting:e,viewModel:t}=this,{state:r}=t;return ne("div",{class:this.classes(Xe.base,Xe.esriWidget)},e?this.renderProgressBar():null,r==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?ne("div",{key:"error-message",class:Xe.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:t,activeAttachmentInfo:r}=this.viewModel;return t==="add"?this.renderAddForm():t==="edit"?this.renderDetailsForm(r||e):this.renderAttachmentContainer()}renderLoading(){return ne("div",{class:Xe.loaderContainer,key:"loader"},ne("div",{class:Xe.loader}))}renderProgressBar(){return this.visibleElements.progressBar?ne("div",{class:Xe.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,r=e||!t,i=this.visibleElements.cancelAddButton?ne("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Xe.esriButton,Xe.esriButtonTertiary,Xe.esriButtonSmall,Xe.esriButtonHalf,e&&Xe.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?ne("button",{type:"submit",disabled:r,class:this.classes(Xe.esriButton,Xe.esriButtonSecondary,Xe.esriButtonSmall,Xe.esriButtonHalf,{[Xe.buttonDisabled]:r})},this.messages.add):null,n=t?ne("span",{key:"file-name",class:Xe.fileName},t.name):null,o=ne("form",{bind:this,afterCreate:FF,afterRemoved:tte,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},ne("fieldset",{class:Xe.fileFieldset},n,ne("label",{class:this.classes(Xe.fileLabel,Xe.esriButton,Xe.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,ne("input",{class:Xe.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,i);return ne("div",{key:"add-form-container",class:Xe.formNode},o)}renderDetailsForm(e){var S,C,O;const{visibleElements:t,viewModel:r,selectedFile:i,submitting:s}=this,{abilities:n}=r,o=s||!i;let a,l,c,h;i?(a=i.type,l=i.name,c=i.size):e&&"file"in e?(a=e.file.type,l=e.file.name,c=e.file.size):e&&"contentType"in e&&(a=e.contentType,l=e.name,c=e.size,h=e.url);const p=n.editing&&((S=n.operations)==null?void 0:S.delete)&&t.deleteButton?ne("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:R=>this._submitDeleteAttachment(R,e),class:this.classes(Xe.esriButton,Xe.esriButtonSmall,Xe.esriButtonTertiary,Xe.deleteButton,{[Xe.buttonDisabled]:s})},this.messages.delete):void 0,f=n.editing&&((C=n.operations)==null?void 0:C.update)&&t.updateButton?ne("button",{disabled:o,key:"update-button",type:"submit",class:this.classes(Xe.esriButton,Xe.esriButtonSmall,Xe.esriButtonThird,{[Xe.buttonDisabled]:o})},this.messages.update):void 0,m=this.visibleElements.cancelUpdateButton?ne("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Xe.esriButton,Xe.esriButtonSmall,Xe.esriButtonTertiary,Xe.esriButtonThird,{[Xe.buttonDisabled]:s})},this.messages.cancel):void 0,y=n.editing&&((O=n.operations)==null?void 0:O.update)?ne("fieldset",{key:"file",class:Xe.fileFieldset},ne("span",{key:"file-name",class:Xe.fileName},l),ne("label",{class:this.classes(Xe.fileLabel,Xe.esriButton,Xe.esriButtonSecondary)},this.messages.changeFile,ne("input",{class:Xe.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,_=ne("fieldset",{key:"size",class:Xe.metadataFieldset},ne("label",null,Z4e(this.messagesUnits,c!=null?c:0))),b=ne("fieldset",{key:"content-type",class:Xe.metadataFieldset},ne("label",null,a)),x=v(h)?ne("a",{class:Xe.itemLink,href:h,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),ne("div",{class:Xe.itemLinkOverlay},ne("span",{class:Xe.itemLinkOverlayIcon},ne("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),T=ne("form",{bind:this,afterCreate:FF,afterRemoved:tte,"data-node-ref":"_updateAttachmentForm",onsubmit:R=>this._submitUpdateAttachment(R,e)},ne("div",{class:Xe.metadata},_,b),y,ne("div",{class:Xe.actions},p,m,f));return ne("div",{key:"edit-form-container",class:Xe.formNode},x,T)}renderImageMask(e,t){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,t):null}renderGenericImageMask(e,t){const{supportsResizeAttachments:r}=this.viewModel,i=I5e(t),s={[Xe.itemImageResizable]:r};return ne("div",{class:this.classes(Xe.itemMaskIcon,Xe.itemMask)},ne("img",{title:e,alt:e,src:i,class:this.classes(s,Xe.itemImage)}))}renderImageMaskForAttachment(e,t){const{supportsResizeAttachments:r}=this.viewModel;if(!e)return null;const{contentType:i,name:s,url:n}=e;if(!r||!Pte(i))return this.renderGenericImageMask(s,i);const o=this._getCSSTransform(e),a=o?{transform:o,"image-orientation":"none"}:{},l=`${n}${n!=null&&n.includes("?")?"&":"?"}w=${t}`,c={[Xe.itemImageResizable]:r};return ne("div",{class:this.classes(Xe.itemMask)},ne("img",{styles:a,alt:s,title:s,src:l,class:this.classes(c,Xe.itemImage)}))}renderFile(e){const{file:t}=e;return ne("li",{class:Xe.item,key:t},ne("button",{key:"details-button",bind:this,class:Xe.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),ne("label",{class:Xe.itemLabel},ne("span",{class:Xe.itemFilename},t.name||this.messages.noTitle),ne("span",{"aria-hidden":"true",class:this.classes(Xe.itemChevronIcon,em(this.container)?Xe.iconLeft:Xe.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:r,effectiveDisplayType:i}=this,{abilities:s,supportsResizeAttachments:n}=r,{contentType:o,name:a,url:l}=e,c=this.renderImageMask(e,t==="list"?48:400),h=s.editing?ne("span",{"aria-hidden":"true",class:this.classes(Xe.itemChevronIcon,em(this.container)?Xe.iconLeft:Xe.iconRight)}):null,p=[c,i==="preview"&&n&&Pte(o)?null:ne("label",{class:Xe.itemLabel},ne("span",{class:Xe.itemFilename},a||this.messages.noTitle),h)],f=s.editing?ne("button",{key:"details-button",bind:this,class:Xe.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},p):ne("a",{key:"details-link",class:Xe.itemButton,href:l!=null?l:void 0,target:"_blank"},p);return ne("li",{class:Xe.item,key:e},f)}renderAttachmentContainer(){var m;const{effectiveDisplayType:e,viewModel:t,visibleElements:r}=this,{attachmentInfos:i,abilities:s,fileInfos:n}=t,o=!!(i!=null&&i.length),a=!!(n!=null&&n.length),l={[Xe.containerList]:e!=="preview",[Xe.containerPreview]:e==="preview"},c=s.editing&&((m=s.operations)==null?void 0:m.add)&&r.addButton?ne("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Xe.esriButton,Xe.esriButtonTertiary,Xe.addAttachmentButton),type:"button"},ne("span",{"aria-hidden":"true",class:this.classes(Xe.itemAddIcon,Xe.iconPlus)}),this.messages.add):void 0,h=o?ne("ul",{key:"attachments-list",class:Xe.items},i.toArray().map(y=>this.renderAttachmentInfo({attachmentInfo:y,displayType:e}))):void 0,p=a?ne("ul",{key:"file-list",class:Xe.items},n.toArray().map(y=>this.renderFile(y))):void 0,f=a||o?void 0:ne("div",{class:Xe.empty},this.messages.noAttachments);return ne("div",{key:"attachments-container",class:this.classes(Xe.container,l)},h,p,f,c)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,r=t&&t.files&&t.files.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){const{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};u([d()],za.prototype,"abilities",null),u([d()],za.prototype,"displayType",void 0),u([d({readOnly:!0})],za.prototype,"effectiveDisplayType",null),u([d()],za.prototype,"graphic",null),u([d()],za.prototype,"label",null),u([d(),il("esri/widgets/Attachments/t9n/Attachments")],za.prototype,"messages",void 0),u([d(),il("esri/core/t9n/Units")],za.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],za.prototype,"selectedFile",void 0),u([d({readOnly:!0})],za.prototype,"submitting",void 0),u([d({readOnly:!0})],za.prototype,"error",void 0),u([d({type:AY})],za.prototype,"viewModel",void 0),u([d()],za.prototype,"visibleElements",void 0),u([zt("visibleElements")],za.prototype,"castVisibleElements",null),za=u([P("esri.widgets.Attachments")],za);const D5e=za;let RR=class extends AY{constructor(e){super(e),this.description=null,this.title=null}};u([d()],RR.prototype,"description",void 0),u([d()],RR.prototype,"title",void 0),RR=u([P("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],RR);const RY=RR,N5e={heading:"esri-widget__heading"};function OY({level:e,class:t,...r},i){const s=F5e(e);return ne(`h${s}`,{...r,class:Mye(N5e.heading,t),role:"heading","aria-level":String(s)},i)}function F5e(e){return ye(Math.ceil(e),1,6)}const yk="esri-feature-element-info",_k={base:yk,title:`${yk}__title`,description:`${yk}__description`};let KT=class extends cl{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return ne("div",{class:_k.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?ne(OY,{level:this.headingLevel,class:_k.title},e):null}renderDescription(){const{description:e}=this;return e?ne("div",{key:"description",class:_k.description},e):null}};u([d()],KT.prototype,"description",void 0),u([d()],KT.prototype,"headingLevel",void 0),u([d()],KT.prototype,"title",void 0),KT=u([P("esri.widgets.Feature.support.FeatureElementInfo")],KT);const _6=KT,U5e={base:"esri-feature-attachments"};let vf=class extends cl{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new D5e,this.headingLevel=2,this.viewModel=new RY}initialize(){this._featureElementInfo=new _6,this.addHandles([se(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),kt),se(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,kt)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var t;const{attachmentsWidget:e}=this;return ne("div",{class:U5e.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var i;const{description:e,title:t,headingLevel:r}=this;(i=this._featureElementInfo)==null||i.set({description:e,title:t,headingLevel:r})}};u([d({readOnly:!0})],vf.prototype,"attachmentsWidget",void 0),u([d()],vf.prototype,"description",null),u([d()],vf.prototype,"displayType",null),u([d()],vf.prototype,"graphic",null),u([d()],vf.prototype,"headingLevel",void 0),u([d()],vf.prototype,"title",null),u([d({type:RY})],vf.prototype,"viewModel",void 0),vf=u([P("esri.widgets.Feature.FeatureAttachments")],vf);const k5e=vf;let G0=class extends xx(Te){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(se(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},kt))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:r}=this;e&&t&&(XF(r,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const t=this.graphic;if(!t||!e)return;const r=XF(e,{graphic:t}).catch(()=>null);this._loadingPromise=r,this.notifyChange("state");const i=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",i))}};u([d({readOnly:!0})],G0.prototype,"created",void 0),u([d()],G0.prototype,"creator",void 0),u([d()],G0.prototype,"destroyer",void 0),u([d({type:Aa})],G0.prototype,"graphic",void 0),u([d({readOnly:!0})],G0.prototype,"state",null),G0=u([P("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],G0);const YF=G0;function Sh(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:B5e(e[t])}}}function V5e(e){const t=e==null?void 0:e.type;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function B5e(e){return function(t,...r){V5e(t)?aFe(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...r)}}function z5e(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const r=t._delegatedEventNames,i=Array.isArray(e)?e:G5e(e);r.push(...i)}}function G5e(e){return e.split(",").map(t=>t.trim())}const $0e="calcite-mode-";function j5e(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replace(/\s|'|"/g,"")}function ZF(){return j5e().startsWith("dark")}function H5e(){return`${$0e}${ZF()?"dark":"light"}`}function q5e(e){W5e(e),e.classList.add(H5e())}function W5e(e){Array.from(e.classList).forEach(t=>{t.startsWith($0e)&&e.classList.remove(t)})}function L0e(e){return e&&typeof e.render=="function"}function X5e(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const vk="esri-feature-content",bk={base:vk,loaderContainer:`${vk}__loader-container`,loader:`${vk}__loader`};let e2=class extends cl{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(i=>{S0e(i.href)&&!i.hasAttribute("target")&&i.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return ne("div",{class:bk.loaderContainer,key:"loader"},ne("div",{class:bk.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?ne("div",{key:e,bind:e,afterCreate:this._attachToNode}):L0e(e)?ne("div",{key:e},!e.destroyed&&e.render()):ne("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return ne("div",{class:bk.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([d()],e2.prototype,"creator",null),u([d()],e2.prototype,"graphic",null),u([d({type:YF})],e2.prototype,"viewModel",void 0),e2=u([P("esri.widgets.Feature.FeatureContent")],e2);const ID=e2;let yg=class extends Te{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,r=[];return t==null||t.forEach(i=>{if(!(!i.hasOwnProperty("visible")||i.visible))return;const s=i.clone();s.label=E0e(s,e),r.push(s)}),r}};u([d()],yg.prototype,"attributes",void 0),u([d({type:[pfe]})],yg.prototype,"expressionInfos",void 0),u([d()],yg.prototype,"description",void 0),u([d({type:[lP]})],yg.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],yg.prototype,"formattedFieldInfos",null),u([d()],yg.prototype,"title",void 0),yg=u([P("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],yg);const v6=yg,Y5e=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Z5e(e){let t=null;return Y5e.some(r=>(r.pattern.test(e)&&(t=r),!!t)),t}function J5e(e,t){if(typeof t!="string"||!t)return t;const r=Z5e(t);if(!r)return t;const i=t.match(r.pattern),s=i&&i[2],n=mm(mm(r.label,{messages:e,hierPart:s}),{appName:r.appName}),o=r.target?` target="${r.target}"`:"",a=r.target==="_blank"?' rel="noreferrer"':"";return t.replace(r.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const DI="esri-feature-fields",sA={base:DI,fieldHeader:`${DI}__field-header`,fieldData:`${DI}__field-data`,fieldDataDate:`${DI}__field-data--date`,esriTable:"esri-widget__table"};let Id=class extends cl{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new v6,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new _6,this.addHandles(se(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),kt))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,t){const{attributes:r}=this.viewModel,i=e.fieldName,s=e.label||i,n=r?r[i]==null?"":r[i]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):J5e(this.messagesURIUtils,n),l={[sA.fieldDataDate]:o};return ne("tr",{key:`fields-element-info-row-${i}-${t}`},ne("th",{key:`fields-element-info-row-header-${i}-${t}`,class:sA.fieldHeader,innerHTML:s}),ne("td",{key:`fields-element-info-row-data-${i}-${t}`,class:this.classes(sA.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?ne("table",{class:sA.esriTable,summary:this.messages.fieldsSummary},ne("tbody",null,e.map((t,r)=>this.renderFieldInfo(t,r)))):null}render(){var e;return ne("div",{class:sA.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var r;const{description:e,title:t}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([d()],Id.prototype,"attributes",null),u([d()],Id.prototype,"description",null),u([d()],Id.prototype,"expressionInfos",null),u([d()],Id.prototype,"fieldInfos",null),u([d()],Id.prototype,"title",null),u([d({type:v6,nonNullable:!0})],Id.prototype,"viewModel",void 0),u([d(),il("esri/widgets/Feature/t9n/Feature")],Id.prototype,"messages",void 0),u([d(),il("esri/widgets/support/t9n/uriUtils")],Id.prototype,"messagesURIUtils",void 0),Id=u([P("esri.widgets.Feature.FeatureFields")],Id);const D0e=Id,Q5e={maximumFractionDigits:20};function K5e(e){return vm(e,Q5e)}var vG;let W1=vG=class extends fe{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=e!=null?e:0}clone(){return new vG({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:Qe,json:{type:[Ri],write:!0}})],W1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],W1.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],W1.prototype,"value",void 0),u([Be("value")],W1.prototype,"writeValue",null),W1=vG=u([P("esri.renderers.visualVariables.support.ColorStop")],W1);const e6e=W1;function b6(e,t,r){return fo(e.map((i,s)=>t.apply(r,[i,s])))}async function t6e(e,t,r){return(await fo(e.map((i,s)=>t.apply(r,[i,s])))).map(i=>i.value)}function MY(e){return{ok:!0,value:e}}function PY(e){return{ok:!1,error:e}}function r6e(e){return v(e)&&e.ok===!0?e.value:null}function i6e(e){return v(e)&&e.ok===!1?e.error:null}async function Vc(e){if(E(e))return{ok:!1,error:new Error("no promise provided")};try{return MY(await e)}catch(t){return PY(t)}}async function STt(e){try{return MY(await e)}catch(t){return Sc(t),PY(t)}}function ETt(e){if(e.ok===!0)return e.value;throw e.error}function wP(e,t){return new j0(e,t)}let j0=class extends Te{get value(){return r6e(this._result)}get error(){return i6e(this._result)}get finished(){return v(this._result)}constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Yh(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(i=>{this._result=MY(i),this._cleanup()},i=>{this._result=PY(i),this._cleanup()}),this._abortHandle=Ca(t,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=zi(this._abortHandle),this._abortController=null}};u([d()],j0.prototype,"value",null),u([d()],j0.prototype,"error",null),u([d()],j0.prototype,"finished",null),u([d()],j0.prototype,"promise",void 0),u([d()],j0.prototype,"_result",void 0),j0=u([P("esri.core.asyncUtils.ReactiveTask")],j0);function xP(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function s6e(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function n6e(e,t,r,i,s,n,o,a,l,c,h,p,f,m,y,_){const b=new Float32Array(16);return b[0]=e,b[1]=t,b[2]=r,b[3]=i,b[4]=s,b[5]=n,b[6]=o,b[7]=a,b[8]=l,b[9]=c,b[10]=h,b[11]=p,b[12]=f,b[13]=m,b[14]=y,b[15]=_,b}function o6e(e,t){return new Float32Array(e,t,16)}const a6e=xP();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:a6e,clone:s6e,create:xP,createView:o6e,fromValues:n6e},Symbol.toStringTag,{value:"Module"}));const l6e=(e,t)=>{const r=$m(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return kc(r,r)},c6e=(e,t)=>{const r=$m(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return kc(r,r)},u6e=(e,t)=>{const r=1-t,i=$m(e,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return kc(i,i)},h6e=(e,t)=>{const r=Math.sin(t*Math.PI/180),i=Math.cos(t*Math.PI/180),s=$m(e,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return kc(s,s)},d6e=(e,t)=>{const r=1-2*t,i=$m(e,r,0,0,t,0,r,0,t,0,0,r,t,0,0,0,1);return kc(i,i)},p6e=(e,t)=>{const r=$m(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return kc(r,r)},f6e=(e,t)=>{const r=1-t,i=$m(e,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return kc(i,i)};class w6{constructor(t,r,i){this.strength=t,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(t,r,i){this.strength=wc(t.strength,r.strength,i),this.radius=wc(t.radius,r.radius,i),this.threshold=wc(t.threshold,r.threshold,i)}clone(){return new w6(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:B3(this.radius),strength:this.strength,threshold:this.threshold}}}class x6{constructor(t){this.radius=t,this.type="blur"}interpolate(t,r,i){this.radius=Math.round(wc(t.radius,r.radius,i))}clone(){return new x6(this.radius)}toJSON(){return{type:"blur",radius:B3(this.radius)}}}class WO{constructor(t,r){this.type=t,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.amount=wc(t.amount,r.amount,i),this._updateMatrix()}clone(){return new WO(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||xP();switch(this.type){case"brightness":this._colorMatrix=l6e(t,this.amount);break;case"contrast":this._colorMatrix=c6e(t,this.amount);break;case"grayscale":this._colorMatrix=u6e(t,this.amount);break;case"invert":this._colorMatrix=d6e(t,this.amount);break;case"saturate":this._colorMatrix=p6e(t,this.amount);break;case"sepia":this._colorMatrix=f6e(t,this.amount)}}}class T6{constructor(t,r,i,s){this.offsetX=t,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(t,r,i){this.offsetX=wc(t.offsetX,r.offsetX,i),this.offsetY=wc(t.offsetY,r.offsetY,i),this.blurRadius=wc(t.blurRadius,r.blurRadius,i),this.color[0]=Math.round(wc(t.color[0],r.color[0],i)),this.color[1]=Math.round(wc(t.color[1],r.color[1],i)),this.color[2]=Math.round(wc(t.color[2],r.color[2],i)),this.color[3]=wc(t.color[3],r.color[3],i)}clone(){return new T6(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:B3(this.offsetX),yoffset:B3(this.offsetY),blurRadius:B3(this.blurRadius),color:t}}}class S6{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.angle=wc(t.angle,r.angle,i),this._updateMatrix()}clone(){return new S6(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||xP();this._colorMatrix=h6e(t,this.angle)}}class E6{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,r,i){this.amount=wc(t.amount,r.amount,i)}clone(){return new E6(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function wc(e,t,r){return e+(t-e)*r}function B3(e){return Math.round(1e3*Qh(e))/1e3}function m6e(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new WO(e.type,0);case"saturate":case"brightness":case"contrast":return new WO(e.type,1);case"opacity":return new E6(1);case"hue-rotate":return new S6(0);case"blur":return new x6(0);case"drop-shadow":return new T6(0,0,0,[...hW("transparent")]);case"bloom":return new w6(0,0,1)}}function g6e(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every((i,s)=>i.type===r[s].type)}function y6e(e,t){const r=e.length>t.length?e:t,i=e.length>t.length?t:e;for(let s=i.length;s<r.length;s++)i.push(m6e(r[s]))}function _6e(e){const t=e[0];return!!t&&"type"in t}var $te,Lte,bG={};function N0e(e){if(!e||e.length===0)return null;if(typeof e=="string"){const r=Dte(e);return r&&r.length!==0?r:null}const t=e.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new j("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:Dte(r.value)}});t.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<t.length-1;r++){if(!g6e(t[r].effects,t[r+1].effects))throw new j("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[r].effects,b:t[r+1].effects});y6e(t[r].effects,t[r+1].effects)}return t.sort((r,i)=>i.scale-r.scale),t}function Dte(e){let t;if(!e)return[];try{t=bG.parse(e)}catch(r){throw new j("effect:invalid-syntax","Invalid effect syntax",{value:e,error:r})}return t.map(r=>v6e(r))}function v6e(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return b6e(e);case"opacity":return w6e(e);case"hue-rotate":return x6e(e);case"blur":return T6e(e);case"drop-shadow":return S6e(e);case"bloom":return E6e(e)}}catch(t){throw t.details.filter=e,t}throw new j("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function b6e(e){let t=1;return SC(e.parameters,1),e.parameters.length===1&&(t=Qd(e.parameters[0])),new WO(e.name,t)}function w6e(e){let t=1;return SC(e.parameters,1),e.parameters.length===1&&(t=Qd(e.parameters[0])),new E6(t)}function x6e(e){let t=0;return SC(e.parameters,1),e.parameters.length===1&&(t=P6e(e.parameters[0])),new S6(t)}function T6e(e){let t=0;return SC(e.parameters,1),e.parameters.length===1&&(t=LY(e.parameters[0]),TP(t,e.parameters[0])),new x6(t)}function S6e(e){const t=[];let r=null;for(const i of e.parameters)if(i.type==="color"){if(t.length&&Object.freeze(t),r)throw new j("effect:type-error","Accepts only one color",{});r=I6e(i)}else{const s=LY(i);if(Object.isFrozen(t))throw new j("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&TP(s,i)}if(t.length<2||t.length>3)throw new j("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new T6(t[0],t[1],t[2]||0,r||F0e("black"))}function E6e(e){let t=1,r=0,i=0;return SC(e.parameters,3),e.parameters[0]&&(t=Qd(e.parameters[0])),e.parameters[1]&&(r=LY(e.parameters[1]),TP(r,e.parameters[1])),e.parameters[2]&&(i=Qd(e.parameters[2])),new w6(t,r,i)}function SC(e,t){if(e.length>t)throw new j("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function C6(e){if(e.type==="color")return"<color>";if(e.unit){if($Y[e.unit])return"<length>";if(IY[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function TP(e,t){if(e<0)throw new j("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function C6e(e){if(e.type!=="quantity"||e.unit!==null)throw new j("effect:type-error",`Expected <double>, Actual: ${C6(e)}`,{term:e})}function A6e(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new j("effect:type-error",`Expected <double> or <percentage>, Actual: ${C6(e)}`,{term:e})}Lte=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:zm},h=zm,p="none",f=")",m=",",y="(",_="%",b="px",x="cm",T="mm",S="in",C="pt",O="pc",R="deg",$="rad",I="grad",U="turn",V="#",G=".",z="e",Z=/^[ \t\n\r]/,Q=/^[a-z\-]/,te=/^[0-9a-fA-F]/,q=/^[+\-]/,L=/^[0-9]/,N=hl("none"),F=as("none",!1),H=as(")",!1),X=as(",",!1),K=hl("whitespace"),W=jv([" ","	",`
`,"\r"],!1,!1),ue=hl("function"),pe=as("(",!1),we=hl("identifier"),Ce=jv([["a","z"],"-"],!1,!1),qe=hl("percentage"),Ne=as("%",!1),xe=hl("length"),Fe=as("px",!1),ke=as("cm",!1),wt=as("mm",!1),et=as("in",!1),Ft=as("pt",!1),Wt=as("pc",!1),Kt=hl("angle"),Xt=as("deg",!1),mr=as("rad",!1),Qr=as("grad",!1),Er=as("turn",!1),xr=hl("number"),Fr=hl("color"),$e=as("#",!1),He=jv([["0","9"],["a","f"],["A","F"]],!1,!1),ct=jv(["+","-"],!1,!1),Tt=jv([["0","9"]],!1,!1),jt=as(".",!1),zr=as("e",!1),Tr=function(){return[]},Mr=function(Y,be){return{type:"function",name:Y,parameters:be||[]}},Pr=function(Y,be){return be.length>0?jC(Y,be,3):[Y]},Mi=function(Y){return{type:"quantity",value:Y.value,unit:Y.unit}},er=function(Y){return{type:"color",colorType:Y.type,value:Y.value}},gr=function(Y){return Y},hr=function(){return Ql()},ms=function(Y){return{value:Y,unit:"%"}},ai=function(Y){return{value:Y,unit:"px"}},Zi=function(Y){return{value:Y,unit:"cm"}},yi=function(Y){return{value:Y,unit:"mm"}},Gi=function(Y){return{value:Y,unit:"in"}},gs=function(Y){return{value:Y,unit:"pt"}},Bs=function(Y){return{value:Y,unit:"pc"}},vo=function(Y){return{value:Y,unit:"deg"}},Xn=function(Y){return{value:Y,unit:"rad"}},Cs=function(Y){return{value:Y,unit:"grad"}},Ji=function(Y){return{value:Y,unit:"turn"}},Qi=function(Y){return{value:Y,unit:null}},As=function(){return{type:"hex",value:Ql()}},li=function(Y){return{type:"function",value:Y}},Go=function(){return{type:"named",value:Ql()}},ul=function(){return parseFloat(Ql())},he=0,wi=0,pd=[{line:1,column:1}],la=0,qc=[],ut=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function Ql(){return s.substring(wi,he)}function as(Y,be){return{type:"literal",text:Y,ignoreCase:be}}function jv(Y,be,Oe){return{type:"class",parts:Y,inverted:be,ignoreCase:Oe}}function O8(){return{type:"end"}}function hl(Y){return{type:"other",description:Y}}function zy(Y){var be,Oe=pd[Y];if(Oe)return Oe;for(be=Y-1;!pd[be];)be--;for(Oe={line:(Oe=pd[be]).line,column:Oe.column};be<Y;)s.charCodeAt(be)===10?(Oe.line++,Oe.column=1):Oe.column++,be++;return pd[Y]=Oe,Oe}function Bm(Y,be){var Oe=zy(Y),dr=zy(be);return{source:l,start:{offset:Y,line:Oe.line,column:Oe.column},end:{offset:be,line:dr.line,column:dr.column}}}function tr(Y){he<la||(he>la&&(la=he,qc=[]),qc.push(Y))}function sI(Y,be,Oe){return new t(t.buildMessage(Y,be),Y,be,Oe)}function zm(){var Y;return(Y=Gy())===a&&(Y=jy()),Y}function Gy(){var Y,be;return ut++,Y=he,ci(),s.substr(he,4)===p?(be=p,he+=4):(be=a,ut===0&&tr(F)),be!==a?(ci(),wi=Y,Y=Tr()):(he=Y,Y=a),ut--,Y===a&&ut===0&&tr(N),Y}function jy(){var Y,be;if(Y=[],(be=jo())!==a)for(;be!==a;)Y.push(be),be=jo();else Y=a;return Y}function jo(){var Y,be,Oe,dr;return Y=he,ci(),(be=Gp())!==a?(ci(),(Oe=Wu())===a&&(Oe=null),ci(),s.charCodeAt(he)===41?(dr=f,he++):(dr=a,ut===0&&tr(H)),dr!==a?(ci(),wi=Y,Y=Mr(be,Oe)):(he=Y,Y=a)):(he=Y,Y=a),Y}function Wu(){var Y,be,Oe,dr,Yn,Rs,pl,qy;if(Y=he,(be=Xu())!==a){for(Oe=[],dr=he,Yn=ci(),s.charCodeAt(he)===44?(Rs=m,he++):(Rs=a,ut===0&&tr(X)),Rs===a&&(Rs=null),pl=ci(),(qy=Xu())!==a?dr=Yn=[Yn,Rs,pl,qy]:(he=dr,dr=a);dr!==a;)Oe.push(dr),dr=he,Yn=ci(),s.charCodeAt(he)===44?(Rs=m,he++):(Rs=a,ut===0&&tr(X)),Rs===a&&(Rs=null),pl=ci(),(qy=Xu())!==a?dr=Yn=[Yn,Rs,pl,qy]:(he=dr,dr=a);wi=Y,Y=Pr(be,Oe)}else he=Y,Y=a;return Y}function Xu(){var Y,be;return Y=he,(be=Px())===a&&(be=Hv())===a&&(be=Ix())===a&&(be=qv()),be!==a&&(wi=Y,be=Mi(be)),(Y=be)===a&&(Y=he,(be=Hy())!==a&&(wi=Y,be=er(be)),Y=be),Y}function ci(){var Y,be;for(ut++,Y=[],Z.test(s.charAt(he))?(be=s.charAt(he),he++):(be=a,ut===0&&tr(W));be!==a;)Y.push(be),Z.test(s.charAt(he))?(be=s.charAt(he),he++):(be=a,ut===0&&tr(W));return ut--,be=a,ut===0&&tr(K),Y}function Gp(){var Y,be,Oe;return ut++,Y=he,(be=Gm())!==a?(s.charCodeAt(he)===40?(Oe=y,he++):(Oe=a,ut===0&&tr(pe)),Oe!==a?(wi=Y,Y=gr(be)):(he=Y,Y=a)):(he=Y,Y=a),ut--,Y===a&&(be=a,ut===0&&tr(ue)),Y}function Gm(){var Y,be,Oe;if(ut++,Y=he,be=[],Q.test(s.charAt(he))?(Oe=s.charAt(he),he++):(Oe=a,ut===0&&tr(Ce)),Oe!==a)for(;Oe!==a;)be.push(Oe),Q.test(s.charAt(he))?(Oe=s.charAt(he),he++):(Oe=a,ut===0&&tr(Ce));else be=a;return be!==a&&(wi=Y,be=hr()),ut--,(Y=be)===a&&(be=a,ut===0&&tr(we)),Y}function Px(){var Y,be,Oe;return ut++,Y=he,ci(),(be=dl())!==a?(s.charCodeAt(he)===37?(Oe=_,he++):(Oe=a,ut===0&&tr(Ne)),Oe!==a?(wi=Y,Y=ms(be)):(he=Y,Y=a)):(he=Y,Y=a),ut--,Y===a&&ut===0&&tr(qe),Y}function Hv(){var Y,be,Oe;return ut++,Y=he,ci(),(be=dl())!==a?(s.substr(he,2)===b?(Oe=b,he+=2):(Oe=a,ut===0&&tr(Fe)),Oe!==a?(wi=Y,Y=ai(be)):(he=Y,Y=a)):(he=Y,Y=a),Y===a&&(Y=he,ci(),(be=dl())!==a?(s.substr(he,2)===x?(Oe=x,he+=2):(Oe=a,ut===0&&tr(ke)),Oe!==a?(wi=Y,Y=Zi(be)):(he=Y,Y=a)):(he=Y,Y=a),Y===a&&(Y=he,ci(),(be=dl())!==a?(s.substr(he,2)===T?(Oe=T,he+=2):(Oe=a,ut===0&&tr(wt)),Oe!==a?(wi=Y,Y=yi(be)):(he=Y,Y=a)):(he=Y,Y=a),Y===a&&(Y=he,ci(),(be=dl())!==a?(s.substr(he,2)===S?(Oe=S,he+=2):(Oe=a,ut===0&&tr(et)),Oe!==a?(wi=Y,Y=Gi(be)):(he=Y,Y=a)):(he=Y,Y=a),Y===a&&(Y=he,ci(),(be=dl())!==a?(s.substr(he,2)===C?(Oe=C,he+=2):(Oe=a,ut===0&&tr(Ft)),Oe!==a?(wi=Y,Y=gs(be)):(he=Y,Y=a)):(he=Y,Y=a),Y===a&&(Y=he,ci(),(be=dl())!==a?(s.substr(he,2)===O?(Oe=O,he+=2):(Oe=a,ut===0&&tr(Wt)),Oe!==a?(wi=Y,Y=Bs(be)):(he=Y,Y=a)):(he=Y,Y=a)))))),ut--,Y===a&&ut===0&&tr(xe),Y}function Ix(){var Y,be,Oe;return ut++,Y=he,(be=dl())!==a?(s.substr(he,3)===R?(Oe=R,he+=3):(Oe=a,ut===0&&tr(Xt)),Oe!==a?(wi=Y,Y=vo(be)):(he=Y,Y=a)):(he=Y,Y=a),Y===a&&(Y=he,(be=dl())!==a?(s.substr(he,3)===$?(Oe=$,he+=3):(Oe=a,ut===0&&tr(mr)),Oe!==a?(wi=Y,Y=Xn(be)):(he=Y,Y=a)):(he=Y,Y=a),Y===a&&(Y=he,(be=dl())!==a?(s.substr(he,4)===I?(Oe=I,he+=4):(Oe=a,ut===0&&tr(Qr)),Oe!==a?(wi=Y,Y=Cs(be)):(he=Y,Y=a)):(he=Y,Y=a),Y===a&&(Y=he,(be=dl())!==a?(s.substr(he,4)===U?(Oe=U,he+=4):(Oe=a,ut===0&&tr(Er)),Oe!==a?(wi=Y,Y=Ji(be)):(he=Y,Y=a)):(he=Y,Y=a)))),ut--,Y===a&&(be=a,ut===0&&tr(Kt)),Y}function qv(){var Y,be;return ut++,Y=he,ci(),(be=dl())!==a?(wi=Y,Y=Qi(be)):(he=Y,Y=a),ut--,Y===a&&ut===0&&tr(xr),Y}function Hy(){var Y,be,Oe,dr;if(ut++,Y=he,s.charCodeAt(he)===35?(be=V,he++):(be=a,ut===0&&tr($e)),be!==a){if(Oe=[],te.test(s.charAt(he))?(dr=s.charAt(he),he++):(dr=a,ut===0&&tr(He)),dr!==a)for(;dr!==a;)Oe.push(dr),te.test(s.charAt(he))?(dr=s.charAt(he),he++):(dr=a,ut===0&&tr(He));else Oe=a;Oe!==a?(wi=Y,Y=As()):(he=Y,Y=a)}else he=Y,Y=a;return Y===a&&(Y=he,(be=jo())!==a&&(wi=Y,be=li(be)),(Y=be)===a&&(Y=he,(be=Gm())!==a&&(wi=Y,be=Go()),Y=be)),ut--,Y===a&&(be=a,ut===0&&tr(Fr)),Y}function dl(){var Y,be,Oe,dr,Yn,Rs,pl;for(Y=he,q.test(s.charAt(he))?(s.charAt(he),he++):ut===0&&tr(ct),be=he,Oe=[],L.test(s.charAt(he))?(dr=s.charAt(he),he++):(dr=a,ut===0&&tr(Tt));dr!==a;)Oe.push(dr),L.test(s.charAt(he))?(dr=s.charAt(he),he++):(dr=a,ut===0&&tr(Tt));if(s.charCodeAt(he)===46?(dr=G,he++):(dr=a,ut===0&&tr(jt)),dr!==a){if(Yn=[],L.test(s.charAt(he))?(Rs=s.charAt(he),he++):(Rs=a,ut===0&&tr(Tt)),Rs!==a)for(;Rs!==a;)Yn.push(Rs),L.test(s.charAt(he))?(Rs=s.charAt(he),he++):(Rs=a,ut===0&&tr(Tt));else Yn=a;Yn!==a?be=Oe=[Oe,dr,Yn]:(he=be,be=a)}else he=be,be=a;if(be===a)if(be=[],L.test(s.charAt(he))?(Oe=s.charAt(he),he++):(Oe=a,ut===0&&tr(Tt)),Oe!==a)for(;Oe!==a;)be.push(Oe),L.test(s.charAt(he))?(Oe=s.charAt(he),he++):(Oe=a,ut===0&&tr(Tt));else be=a;if(be!==a){if(Oe=he,s.charCodeAt(he)===101?(dr=z,he++):(dr=a,ut===0&&tr(zr)),dr!==a){if(q.test(s.charAt(he))?(Yn=s.charAt(he),he++):(Yn=a,ut===0&&tr(ct)),Yn===a&&(Yn=null),Rs=[],L.test(s.charAt(he))?(pl=s.charAt(he),he++):(pl=a,ut===0&&tr(Tt)),pl!==a)for(;pl!==a;)Rs.push(pl),L.test(s.charAt(he))?(pl=s.charAt(he),he++):(pl=a,ut===0&&tr(Tt));else Rs=a;Rs!==a?Oe=dr=[dr,Yn,Rs]:(he=Oe,Oe=a)}else he=Oe,Oe=a;Oe===a&&(Oe=null),wi=Y,Y=ul()}else he=Y,Y=a;return Y}function nI(Y,be){return Y.map(function(Oe){return Oe[be]})}function jC(Y,be,Oe){return[Y].concat(nI(be,Oe))}if((o=h())!==a&&he===s.length)return o;throw o!==a&&he<s.length&&tr(O8()),sI(qc,la<s.length?s.charAt(la):null,la<s.length?Bm(la,la+1):Bm(la,la))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=r("",l.line.toString().length," "),f=a[l.line-1],m=(l.line===h.line?h.column:f.length+1)-l.column||1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+r("",l.column-1," ")+r("",m,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,_,b=m.map(h);if(b.sort(),b.length>0){for(y=1,_=1;y<b.length;y++)b[y-1]!==b[y]&&(b[_]=b[y],_++);b.length=_}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:i}},($te={get exports(){return bG},set exports(e){bG=e}}).exports&&($te.exports=Lte());const IY={deg:1,grad:.9,rad:180/Math.PI,turn:360};function R6e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&IY[e.unit]!=null))throw new j("effect:type-error",`Expected <angle>, Actual: ${C6(e)}`,{term:e})}const $Y={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function O6e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&$Y[e.unit]!=null))throw new j("effect:type-error",`Expected <length>, Actual: ${C6(e)}`,{term:e})}function Qd(e){A6e(e);const t=e.value;return TP(t,e),e.unit==="%"?.01*t:t}function M6e(e){return C6e(e),TP(e.value,e),e.value}function P6e(e){return R6e(e),e.value*IY[e.unit]||0}function LY(e){return O6e(e),e.value*$Y[e.unit]||0}function I6e(e){switch(e.colorType){case"hex":return QCe(e.value);case"named":return F0e(e.value);case"function":return D6e(e.value)}}function F0e(e){if(!khe(e))throw new j("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return JCe(e)}const $6e=/^rgba?/i,L6e=/^hsla?/i;function D6e(e){if(SC(e.parameters,4),$6e.test(e.name))return[Qd(e.parameters[0]),Qd(e.parameters[1]),Qd(e.parameters[2]),e.parameters[3]?Qd(e.parameters[3]):1];if(L6e.test(e.name))return Vhe(M6e(e.parameters[0]),Qd(e.parameters[1]),Qd(e.parameters[2]),e.parameters[3]?Qd(e.parameters[3]):1);throw new j("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function DY(e,t,r){var i;try{return F6e(e)}catch(s){(i=r==null?void 0:r.messages)==null||i.push(s)}return null}function NY(e,t,r,i){try{const s=N6e(e);ol(r,s,t)}catch(s){i.messages&&i.messages.push(s)}}function N6e(e){const t=N0e(e);return t?_6e(t)?t.map(r=>r.toJSON()):t.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function F6e(e){if(!e||e.length===0)return null;if(U6e(e)){const t=[];for(const r of e)t.push({scale:r.scale,value:Nte(r.value)});return t}return Nte(e)}function U6e(e){const t=e[0];return!!t&&"scale"in t}function Nte(e){if(!e||!e.length)return"";const t=[];for(const r of e){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[Hm(r,"amount")];break;case"blur":i=[Hm(r,"radius","pt")];break;case"hue-rotate":i=[Hm(r,"angle","deg")];break;case"drop-shadow":i=[Hm(r,"xoffset","pt"),Hm(r,"yoffset","pt"),Hm(r,"blurRadius","pt"),k6e(r,"color")];break;case"bloom":i=[Hm(r,"strength"),Hm(r,"radius","pt"),Hm(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;N0e(s),t.push(s)}return t.join(" ")}function Hm(e,t,r){if(e[t]==null)throw new j("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return r?e[t]+r:""+e[t]}function k6e(e,t){if(e[t]==null)throw new j("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const r=e[t];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}const $D=-3;var Bg;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(Bg||(Bg={}));class V6e{constructor(t,r,i){this._namespace=t,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,r,i,s=0){this._storage.put(this._namespace+t,r,i,s)}get(t){const r=this._storage.get(this._namespace+t);return r===void 0?++this._miss:++this._hit,r}pop(t){const r=this._storage.pop(this._namespace+t);return r===void 0?++this._miss:++this._hit,r}updateSize(t,r,i){this._storage.updateSize(this._namespace+t,r,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class FY{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Jt,this._users=new Jt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,r){this._removeFuncs.push([t,r])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(r=>r[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,r,i,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==r&&this._notifyRemove(t,n.entry,Bg.ALL)),i>this._maxSize)return void this._notifyRemove(t,r,Bg.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const o=1+Math.max(s,$D)-$D;this._db.set(t,{entry:r,size:i,lifetime:o,lives:o}),this._size+=i,this._checkSizeLimit()}updateSize(t,r,i){const s=this._db.get(t);if(s&&s.entry===r){for(this._size-=s.size;i>this._maxSize;){const n=this._notifyRemove(t,r,Bg.SOME);if(!(v(n)&&n>0))return void this._db.delete(t);i=n}s.size=i,this._size+=i,this._checkSizeLimit()}}pop(t){const r=this._db.get(t);if(r)return this._size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(t){const r=this._db.get(t);if(r!==void 0)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=r[h]||0;r[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>t[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(t["Priority "+(o+$D-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((r,i)=>{i.startsWith(t)&&(this._size-=r.size,this._db.delete(i),this._notifyRemove(i,r.entry,Bg.ALL))})}clearAll(){this._db.forEach((t,r)=>this._notifyRemove(r,t.entry,Bg.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,r,i){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,r]of this._db){if(this._db.delete(t),r.lives<=1){this._size-=r.size;const i=this._notifyRemove(t,r.entry,Bg.SOME);v(i)&&i>0&&(this._size+=i,r.lives=r.lifetime,r.size=i,this._db.set(t,r))}else--r.lives,this._db.set(t,r);if(this._size<=.9*this.maxSize)return}}}class B6e{constructor(t,r){this._storage=new FY,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}put(t,r){this._storage.put(t,r,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}new B6e(1e3);new Qe([128,128,128]);const z6e=new Qe("white");function G6e(e){return Ul(e.resource).href}function Fx(e,t){if(!e)return null;let r=null;return mE(e)?r=j6e(e):Z5(e)&&(r=e.color?new Qe(e.color):null),r?XO(r,t):null}function j6e(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach(i=>{var s;i.type==="object"&&((s=i.resource)==null?void 0:s.href)!=null||(r=i.type==="water"?i.color:v(i.material)?i.material.color:null)}),r?new Qe(r):null}function XO(e,t){if(t==null||e==null)return e;const r=e.toRgba();return r[3]=r[3]*t,new Qe(r)}function H6e(e,t,r){const i=e.symbolLayers;if(!i)return;const s=n=>{var a;const o=v(n)?n:null;return XO(t=(a=t!=null?t:o)!=null?a:r!=null?z6e:null,r)};i.forEach(n=>{var o;if(n.type!=="object"||((o=n.resource)==null?void 0:o.href)==null||t)if(n.type==="water")n.color=s(n.color);else{const a=v(n.material)?n.material.color:null,l=s(a);E(n.material)?n.material=new $u({color:l}):n.material.color=l,r!=null&&"outline"in n&&v(n.outline)&&v(n.outline.color)&&(n.outline.color=XO(n.outline.color,r))}})}function q6e(e,t,r){(t=t!=null?t:e.color)&&(e.color=XO(t,r)),r!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=XO(e.outline.color,r))}function wk(e,t,r){e&&(t||r!=null)&&(t&&(t=new Qe(t)),mE(e)?H6e(e,t,r):Z5(e)&&q6e(e,t,r))}async function W6e(e,t){const r=e.symbolLayers;r&&await b6(r,async i=>X6e(i,t))}async function X6e(e,t){switch(e.type){case"extrude":Z6e(e,t);break;case"icon":case"line":case"text":Y6e(e,t);break;case"path":Q6e(e,t);break;case"object":await J6e(e,t)}}function Y6e(e,t){const r=U0e(t);v(r)&&(e.size=r)}function U0e(e){for(const t of e)if(typeof t=="number")return t;return null}function Z6e(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function J6e(e,t){const{resourceSize:r,symbolSize:i}=await K6e(e),s=k0e(t,r,i);e.width=z3(t[0],i[0],r[0],s),e.depth=z3(t[1],i[1],r[1],s),e.height=z3(t[2],i[2],r[2],s)}function Q6e(e,t){const r=k0e(t,Qf,[e.width,void 0,e.height]);e.width=z3(t[0],e.width,1,r),e.height=z3(t[2],e.height,1,r)}function k0e(e,t,r){for(let i=0;i<3;i++){const s=e[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/t[i]:1}case"proportional":break;default:if(s&&t[i])return s/t[i]}}return 1}async function K6e(e){const t=await ie(()=>import("./symbolLayerUtils.9ae315bb.js"),[]),r=await t.computeObjectLayerResourceSize(e,10),{width:i,height:s,depth:n}=e,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function z3(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return t!=null?t:r;default:return e}}function eUe(e,t){const r=U0e(t);if(!E(r))switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const i=e.width/e.height;i>1?(e.width=r,e.height=r*i):(e.width=r*i,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}async function tUe(e,t){if(e&&t)return mE(e)?W6e(e,t):void(Z5(e)&&eUe(e,t))}function rUe(e,t,r){if(e&&t!=null)if(mE(e)){const i=e.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else Z5(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function CTt(e){return v(e)&&e.type==="polygon-3d"&&e.symbolLayers.some(t=>t.type==="extrude")}async function iUe(e,t){return await e.fetchSymbol(t)||e.fetchCIMSymbol(t)}const sUe="<",nUe=">",oUe=N5("short-date");function aUe(e,t,r,i){let s="";t===0?s=`${sUe} `:t===r&&(s=`${nUe} `);let n=null;return n=i?_m(e,oUe):K5e(e),s+n}const lUe=new Qe([64,64,64]);function cUe(e,t){const r=[],i=e.length-1;return e.length===5?r.push(0,2,4):r.push(0,i),e.map((s,n)=>r.includes(n)?aUe(s,n,i,t):null)}async function uUe(e,t,r){let i=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(h=>h.value),i=c.some(h=>!!h.label),i&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=i?null:cUe(s,r!=null?r:!1);return(await Promise.all(s.map(async(c,h)=>{var p;return{value:c,color:e.type==="opacity"?await hUe(c,e,t):(await ie(()=>Promise.resolve().then(function(){return KY}),void 0)).getColor(e,c),label:i?n[h]:(p=l==null?void 0:l[h])!=null?p:""}}))).reverse()}async function hUe(e,t,r=lUe){const i=new Qe(r),s=(await ie(()=>Promise.resolve().then(function(){return KY}),void 0)).getOpacity(t,e);return s!=null&&(i.a=s),i}var wG;let OR=wG=class extends fe{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new wG({color:this.color,ratio:this.ratio})}};u([d({type:Qe,json:{type:[Ri],default:null,write:!0}})],OR.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],OR.prototype,"ratio",void 0),OR=wG=u([P("esri.renderers.support.HeatmapColorStop")],OR);const G3=OR;function dUe(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(i=>{var s;return((s=i.color)==null?void 0:s.a)>0});let r=t.length-1;if(t&&t[0]){const i=t[r];i&&i.ratio!==1&&(t.push(new G3({ratio:1,color:i.color})),r++)}return t.map((i,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===r&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:i.color,label:n,ratio:i.ratio}}).reverse()}ee.getLogger("esri.renderers.support.utils");async function Wc(e,t,r){RW(e,t,()=>[]).push(...r)}async function pUe(e){var r,i,s,n,o;const t=new Map;if(!e)return t;if("visualVariables"in e&&e.visualVariables){const a=e.visualVariables.filter(l=>l.type==="color");for(const l of a){const c=((r=await uUe(l))!=null?r:[]).map(h=>h.color);await Wc(t,l.field||l.valueExpression,c)}}if(e.type==="heatmap"){const a=dUe(e).map(l=>l.color);await Wc(t,e.field||e.valueExpression,a)}else if(e.type==="pie-chart"){for(const a of e.attributes)await Wc(t,a.field||a.valueExpression,[a.color]);await Wc(t,"default",[(i=e==null?void 0:e.othersCategory)==null?void 0:i.color,Fx(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const a of e.attributes)await Wc(t,a.field||a.valueExpression,[a.color]);await Wc(t,"default",[e.backgroundColor])}else if(e.type==="unique-value")if(((s=e.authoringInfo)==null?void 0:s.type)==="predominance")for(const a of(n=e.uniqueValueInfos)!=null?n:[])await Wc(t,a.value.toString(),[Fx(a.symbol,null)]);else{const a=((o=e.uniqueValueInfos)!=null?o:[]).map(f=>Fx(f.symbol,null)),{field:l,field2:c,field3:h,valueExpression:p}=e;(l||p)&&await Wc(t,l||p,a),c&&await Wc(t,c,a),h&&await Wc(t,h,a)}else if(e.type==="class-breaks"){const a=e.classBreakInfos.map(h=>Fx(h.symbol,null)),{field:l,valueExpression:c}=e;await Wc(t,l!=null?l:c,a)}else e.type==="simple"&&await Wc(t,"default",[Fx(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&await Wc(t,"default",[Fx(e.defaultSymbol,null)]),t.forEach((a,l)=>{const c=KM(a.filter(Boolean),(h,p)=>JSON.stringify(h)===JSON.stringify(p));t.set(l,c)}),t}var xG;let MR=xG=class extends fe{constructor(e){super(e),this.name=null,this.code=null}clone(){return new xG({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],MR.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],MR.prototype,"code",void 0),MR=xG=u([P("esri.layers.support.CodedValue")],MR);const fUe=new Vr({inherited:"inherited",codedValue:"coded-value",range:"range"});let PR=class extends fe{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],PR.prototype,"name",void 0),u([ft(fUe)],PR.prototype,"type",void 0),PR=u([P("esri.layers.support.Domain")],PR);const A6=PR;var TG;let IR=TG=class extends A6{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const r=String(e);this.codedValues.some(i=>(String(i.code)===r&&(t=i.name),!!t))}return t}clone(){return new TG({codedValues:re(this.codedValues),name:this.name})}};u([d({type:[MR],json:{write:!0}})],IR.prototype,"codedValues",void 0),u([ft({codedValue:"coded-value"})],IR.prototype,"type",void 0),IR=TG=u([P("esri.layers.support.CodedValueDomain")],IR);const V0e=IR;var SG;let LD=SG=class extends A6{constructor(e){super(e),this.type="inherited"}clone(){return new SG}};u([ft({inherited:"inherited"})],LD.prototype,"type",void 0),LD=SG=u([P("esri.layers.support.InheritedDomain")],LD);const B0e=LD;var EG;let t2=EG=class extends A6{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new EG({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,r){t[r]=[this.minValue||0,e]}}}})],t2.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,r){t[r]=[e,this.maxValue||0]}}}})],t2.prototype,"minValue",void 0),u([ft({range:"range"})],t2.prototype,"type",void 0),t2=EG=u([P("esri.layers.support.RangeDomain")],t2);const z0e=t2,G0e={key:"type",base:A6,typeMap:{range:z0e,"coded-value":V0e,inherited:B0e}};function UY(e){if(!e||!e.type)return null;switch(e.type){case"range":return z0e.fromJSON(e);case"codedValue":return V0e.fromJSON(e);case"inherited":return B0e.fromJSON(e)}return null}const kY=new Vr({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var CG;const mUe=new Vr({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Ga=CG=class extends fe{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:t}){var i;let r=null;try{r=t?JSON.parse(t):null}catch{}return(i=r==null?void 0:r.value)!=null?i:null}readValueType(e,{description:t}){let r=null;try{r=t?JSON.parse(t):null}catch{}return r?mUe.fromJSON(r.fieldValueType):null}clone(){return new CG({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Ga.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],Ga.prototype,"defaultValue",void 0),u([d()],Ga.prototype,"description",void 0),u([De("description")],Ga.prototype,"readDescription",null),u([d({types:G0e,json:{read:{reader:UY},write:!0}})],Ga.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Ga.prototype,"editable",void 0),u([d({type:Ri,json:{write:!0}})],Ga.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],Ga.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],Ga.prototype,"nullable",void 0),u([ft(kY)],Ga.prototype,"type",void 0),u([d()],Ga.prototype,"valueType",void 0),u([De("valueType",["description"])],Ga.prototype,"readValueType",null),u([d({type:Boolean,json:{read:!1}})],Ga.prototype,"visible",void 0),Ga=CG=u([P("esri.layers.support.Field")],Ga);const R6=Ga;var AG;let r2=AG=class extends fe{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new AG({mapLayerId:e,gdbVersion:t})}};u([ft({mapLayer:"map-layer"})],r2.prototype,"type",void 0),u([d({type:Ri,json:{write:!0}})],r2.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],r2.prototype,"gdbVersion",void 0),r2=AG=u([P("esri.layers.support.source.MapLayerSource")],r2);var RG;let _g=RG=class extends fe{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:r,spatialReference:(o=i==null?void 0:i.clone())!=null?o:void 0,geometryType:s};return new RG(n)}};u([ft({queryTable:"query-table"})],_g.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],_g.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],_g.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],_g.prototype,"oidFields",void 0),u([d({type:Ye,json:{write:!0}})],_g.prototype,"spatialReference",void 0),u([ft(Gpe)],_g.prototype,"geometryType",void 0),_g=RG=u([P("esri.layers.support.source.QueryTableDataSource")],_g);var OG;let i2=OG=class extends fe{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new OG({workspaceId:e,dataSourceName:t})}};u([ft({raster:"raster"})],i2.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],i2.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],i2.prototype,"workspaceId",void 0),i2=OG=u([P("esri.layers.support.source.RasterDataSource")],i2);var MG;let X1=MG=class extends fe{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:r}=this;return new MG({workspaceId:e,gdbVersion:t,dataSourceName:r})}};u([ft({table:"table"})],X1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],X1.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],X1.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],X1.prototype,"dataSourceName",void 0),X1=MG=u([P("esri.layers.support.source.TableDataSource")],X1);var PG,IG;const gUe=Ia()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let iu=PG=class extends fe{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,r){return Fte()(e,t,r)}castLeftTableSource(e){return Op($G(),e)}readRightTableSource(e,t,r){return Fte()(e,t,r)}castRightTableSource(e){return Op($G(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=r==null?void 0:r.clone())!=null?o:void 0,rightTableSource:(a=i==null?void 0:i.clone())!=null?a:void 0,joinType:s};return new PG(n)}};u([ft({joinTable:"join-table"})],iu.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],iu.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],iu.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],iu.prototype,"leftTableSource",void 0),u([De("leftTableSource")],iu.prototype,"readLeftTableSource",null),u([zt("leftTableSource")],iu.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],iu.prototype,"rightTableSource",void 0),u([De("rightTableSource")],iu.prototype,"readRightTableSource",null),u([zt("rightTableSource")],iu.prototype,"castRightTableSource",null),u([ft(gUe)],iu.prototype,"joinType",void 0),iu=PG=u([P("esri.layers.support.source.JoinTableDataSource")],iu);let xk=null;function Fte(){return xk||(xk=Pv({types:$G()})),xk}let Tk=null;function $G(){return Tk||(Tk={key:"type",base:null,typeMap:{"data-layer":Kd,"map-layer":r2}}),Tk}const yUe={key:"type",base:null,typeMap:{"join-table":iu,"query-table":_g,raster:i2,table:X1}};let Kd=IG=class extends fe{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new IG({fields:e,dataSource:t})}};u([ft({dataLayer:"data-layer"})],Kd.prototype,"type",void 0),u([d({type:[R6],json:{write:!0}})],Kd.prototype,"fields",void 0),u([d({types:yUe,json:{write:!0}})],Kd.prototype,"dataSource",void 0),Kd=IG=u([P("esri.layers.support.source.DataLayerSource")],Kd),Kd.from=Us(Kd);function _Ue(e,t){return t?{...t,query:{...e!=null?e:{},...t.query}}:{query:e}}function VY(e){return typeof e=="string"?po(e):re(e)}function vUe(e,t,r){const i={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=vUe(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=t?o:JSON.stringify(o)}else i[s]=t?n:JSON.stringify(n);else i[s]=n}return i}const NI={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new up({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ye.WebMercator}),minus180Line:new up({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ye.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new up({paths:[[[180,-180],[180,180]]],spatialReference:Ye.WGS84}),minus180Line:new up({paths:[[[-180,-180],[-180,180]]],spatialReference:Ye.WGS84})}};function Kb(e,t){return Math.ceil((e-t)/(2*t))}function j0e(e,t){const r=j3(e);for(const i of r)for(const s of i)s[0]+=t;return e}function j3(e){return lw(e)?e.rings:e.paths}async function bUe(e,t,r,i){const s=VY(e),n=t[0].spatialReference,o={...i,query:{...s.query,f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:dC(t[0]),geometries:t}),cutter:JSON.stringify(r)}},a=await Di(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=gm(h);return p.spatialReference=n,p})}}function wUe(e){return{geometryType:dC(e[0]),geometries:e.map(t=>t.toJSON())}}function H0e(e,t,r){const i=KOe(t);return e.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}async function xUe(e,t,r){const i=typeof e=="string"?po(e):e,s=t[0].spatialReference,n=dC(t[0]),o={...r,query:{...i.query,f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(wUe(t))}},{data:a}=await Di(i.path+"/simplify",o);return H0e(a.geometries,n,s)}const q0e=ee.getLogger("esri.geometry.support.normalizeUtils");function TUe(e){return e.type==="polygon"}function SUe(e){return e[0].type==="polygon"}function EUe(e){return e[0].type==="polyline"}function CUe(e,t){if(!(e instanceof up||e instanceof Pp)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw q0e.error(s),new j(s)}const r=j3(e),i=[];for(const s of r){const n=[];i.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,y=p/t;if(y>1){for(let T=1;T<=y-1;T++){const S=T*t,C=m*S+a,O=f*S+l;n.push([C,O])}const _=(p+Math.floor(y-1)*t)/2,b=m*_+a,x=f*_+l;n.push([b,x])}n.push([c,h])}}return TUe(e)?new Pp({rings:i,spatialReference:e.spatialReference}):new up({paths:i,spatialReference:e.spatialReference})}function Ute(e,t,r){if(t){const i=CUe(e,1e6);e=H2(i,!0)}return r&&(e=j0e(e,r)),e}function kte(e,t,r){if(Array.isArray(e)){const i=e[0];if(i>t){const s=Kb(i,t);e[0]=i+s*(-2*t)}else if(i<r){const s=Kb(i,r);e[0]=i+s*(-2*r)}}else{const i=e.x;if(i>t){const s=Kb(i,t);e=e.clone().offset(s*(-2*t),0)}else if(i<r){const s=Kb(i,r);e=e.clone().offset(s*(-2*r),0)}}return e}function AUe(e,t){let r=-1;for(let i=0;i<t.cutIndexes.length;i++){const s=t.cutIndexes[i],n=t.geometries[i],o=j3(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*Kb(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===r){if(SUe(e))for(const a of j3(n))e[s]=e[s].addRing(a);else if(EUe(e))for(const a of j3(n))e[s]=e[s].addPath(a)}else r=s,e[s]=n}return e}async function W0e(e,t,r){var C;if(!Array.isArray(e))return W0e([e],t);t&&typeof t!="string"&&q0e.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof t=="string"?t:(C=t==null?void 0:t.url)!=null?C:ni.geometryServiceUrl;let s,n,o,a,l,c,h,p,f=0;const m=[],y=[];for(const O of e)if(E(O))y.push(O);else if(s||(s=O.spatialReference,n=Z_(s),o=s.isWebMercator,c=o?102100:4326,a=NI[c].maxX,l=NI[c].minX,h=NI[c].plus180Line,p=NI[c].minus180Line),n)if(O.type==="mesh")y.push(O);else if(O.type==="point")y.push(kte(O.clone(),a,l));else if(O.type==="multipoint"){const R=O.clone();R.points=R.points.map($=>kte($,a,l)),y.push(R)}else if(O.type==="extent"){const R=O.clone()._normalize(!1,!1,n);y.push(R.rings?new Pp(R):R)}else if(O.extent){const R=O.extent,$=Kb(R.xmin,l)*(2*a);let I=$===0?O.clone():j0e(O.clone(),$);R.offset($,0),R.intersects(h)&&R.xmax!==a?(f=R.xmax>f?R.xmax:f,I=Ute(I,o),m.push(I),y.push("cut")):R.intersects(p)&&R.xmin!==l?(f=R.xmax*(2*a)>f?R.xmax*(2*a):f,I=Ute(I,o,360),m.push(I),y.push("cut")):y.push(I)}else y.push(O.clone());else y.push(O);let _=Kb(f,a),b=-90;const x=_,T=new up;for(;_>0;){const O=360*_-180;T.addPath([[O,b],[O,-1*b]]),b*=-1,_--}if(m.length>0&&x>0){const O=AUe(m,await bUe(i,m,T,r)),R=[],$=[];for(let V=0;V<y.length;V++){const G=y[V];if(G!=="cut")$.push(G);else{const z=O.shift(),Z=e[V];v(Z)&&Z.type==="polygon"&&Z.rings&&Z.rings.length>1&&z.rings.length>=Z.rings.length?(R.push(z),$.push("simplify")):$.push(o?ey(z):z)}}if(!R.length)return $;const I=await xUe(i,R,r),U=[];for(let V=0;V<$.length;V++){const G=$[V];G!=="simplify"?U.push(G):U.push(o?ey(I.shift()):I.shift())}return U}const S=[];for(let O=0;O<y.length;O++){const R=y[O];if(R!=="cut")S.push(R);else{const $=m.shift();S.push(o===!0?ey($):$)}}return S}function X0e(e){const t={};for(const r in e){if(r==="declaredClass")continue;const i=e[r];if(i!=null&&typeof i!="function")if(Array.isArray(i)){t[r]=[];for(let s=0;s<i.length;s++)t[r][s]=X0e(i[s])}else typeof i=="object"?i.toJSON&&(t[r]=JSON.stringify(i)):t[r]=i}return t}var p_;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(p_||(p_={}));const Vte=4294967296,RUe=new TextDecoder("utf-8"),OUe=de("safari")||de("ios")?6:de("ff")?12:32;class pw{constructor(t,r,i=0,s=t?t.byteLength:0){this._tag=0,this._dataType=p_.unknown,this._init(t,r,i,s)}_init(t,r,i,s){this._data=t,this._dataView=r,this._pos=i,this._end=s}asUnsafe(){return this}clone(){return new pw(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const r=this._decodeVarint();if(this._tag=r>>3,this._dataType=7&r,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();if(t!==void 0)return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,r=this._pos,i=t.getUint32(r,!0)+t.getUint32(r+4,!0)*Vte;return this._skip(8),i}getSFixed64(){const t=this._dataView,r=this._pos,i=t.getUint32(r,!0)+t.getInt32(r+4,!0)*Vte;return this._skip(8),i}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),r=this._pos,i=this._toString(this._data,r,r+t);return this._skip(t),i}getBytes(){const t=this._getLength(),r=this._pos,i=this._toBytes(this._data,r,r+t);return this._skip(t),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,r,i,s){const n=this.getMessage(),o=t(n,r,i,s);return n.release(),o}processMessage(t){const r=this.getMessage(),i=t(r);return r.release(),i}getMessage(){const t=this._getLength(),r=pw.pool.acquire();return r._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),r}release(){pw.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case p_.varint:this._decodeVarint();break;case p_.fixed64:this._skip(8);break;case p_.delimited:this._skip(this._getLength());break;case p_.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let r=this._pos,i=0,s=0;if(this._end-r>=10)do{if(s=t[r++],i|=127&s,(128&s)==0||(s=t[r++],i|=(127&s)<<7,(128&s)==0)||(s=t[r++],i|=(127&s)<<14,(128&s)==0)||(s=t[r++],i|=(127&s)<<21,(128&s)==0)||(s=t[r++],i+=268435456*(127&s),(128&s)==0)||(s=t[r++],i+=34359738368*(127&s),(128&s)==0)||(s=t[r++],i+=4398046511104*(127&s),(128&s)==0)||(s=t[r++],i+=562949953421312*(127&s),(128&s)==0)||(s=t[r++],i+=72057594037927940*(127&s),(128&s)==0)||(s=t[r++],i+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(s=t[r],(128&s)!=0);)++r,i+=(127&s)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=s*n}return this._pos=r,i}_decodeSVarint(){const t=this._data;let r=this._pos,i=0,s=0;const n=1&t[r];if(this._end-r>=10)do{if(s=t[r++],i|=127&s,(128&s)==0||(s=t[r++],i|=(127&s)<<7,(128&s)==0)||(s=t[r++],i|=(127&s)<<14,(128&s)==0)||(s=t[r++],i|=(127&s)<<21,(128&s)==0)||(s=t[r++],i+=268435456*(127&s),(128&s)==0)||(s=t[r++],i+=34359738368*(127&s),(128&s)==0)||(s=t[r++],i+=4398046511104*(127&s),(128&s)==0)||(s=t[r++],i+=562949953421312*(127&s),(128&s)==0)||(s=t[r++],i+=72057594037927940*(127&s),(128&s)==0)||(s=t[r++],i+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let o=1;for(;r!==this._end&&(s=t[r],(128&s)!=0);)++r,i+=(127&s)*o,o*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=s*o}return this._pos=r,n?-(i+1)/2:i/2}_getLength(){if(this._dataType!==p_.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,r,i){if((i=Math.min(this._end,i))-r>OUe){const o=t.subarray(r,i);return RUe.decode(o)}let s="",n="";for(let o=r;o<i;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,r,i){return i=Math.min(this._end,i),new Uint8Array(t.buffer,r,i-r)}}pw.pool=new An(pw,void 0,e=>{e._data=null,e._dataView=null});class Hl{constructor(t=[],r=[],i=!1){this.lengths=t!=null?t:[],this.coords=r!=null?r:[],this.hasIndeterminateRingOrder=i}static fromRect(t){const[r,i,s,n]=t,o=s-r,a=n-i;return new Hl([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,r)=>t+r)}forEachVertex(t){let r=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)t(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(t){return t?(t.set(this.coords),new Hl(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new Hl(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class Sm{constructor(t=null,r={},i,s){this.geometry=t,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new Sm(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function MUe(e){return!(E(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class ATt extends Sm{}class O6{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new O6;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const Y0e=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class RTt{constructor(t){this._options=t,this.geometryTypes=Y0e,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new O6}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this._options.sourceSpatialReference||!t.spatialReference||Pn(t.spatialReference,this._options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const r=Rw(this._options.sourceSpatialReference)/Rw(t.spatialReference);if(r!==1)for(const i of t.features){if(!MUe(i))continue;const s=i.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=r}}addFeature(t,r){t.features.push(r)}createFeature(){return new Sm}createSpatialReference(){return{wkid:0}}createGeometry(){return new Hl}addField(t,r){t.fields.push(r)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((r,i)=>r+i,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,r){t.coords[this._coordinatePtr++]=r}addCoordinatePoint(t,r){t.coords.push(r)}addLength(t,r){t.lengths.push(r)}addQueryGeometry(t,r){t.queryGeometry=r.queryGeometry,t.queryGeometryType=r.queryGeometryType}createPointGeometry(){return new Hl}}const Bte=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],zte=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],Gte=["upperLeft","lowerLeft"];function jte(e){return e>=Bte.length?null:Bte[e]}function PUe(e){return e>=zte.length?null:zte[e]}function Hte(e){return e>=Gte.length?null:Gte[e]}function qte(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function IUe(e,t,r){const s=e.asUnsafe(),n=t.createPointGeometry(r);for(;s.next();)switch(s.tag()){case 3:{const o=s.getUInt32(),a=s.pos()+o;let l=0;for(;s.pos()<a;)t.addCoordinatePoint(n,s.getSInt64(),l++);break}default:s.skip()}return n}function $Ue(e,t,r){const n=e.asUnsafe(),o=t.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(;n.pos()<c;)t.addLength(o,n.getUInt32(),h++);break}case 3:{const l=n.getUInt32(),c=n.pos()+l;let h=0;for(t.allocateCoordinates(o);n.pos()<c;)t.addCoordinate(o,n.getSInt64(),h),h++,h===a&&(h=0);break}default:n.skip()}return o}function LUe(e){const s=e.asUnsafe(),n=new Hl;let o="esriGeometryPoint";for(;s.next();)switch(s.tag()){case 2:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.lengths.push(s.getUInt32());break}case 3:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.coords.push(s.getSInt64());break}case 1:o=Y0e[s.getEnum()];break;default:s.skip()}return{queryGeometry:n,queryGeometryType:o}}function DUe(e){const h=e.asUnsafe();for(;h.next();)switch(h.tag()){case 1:return h.getString();case 2:return h.getFloat();case 3:return h.getDouble();case 4:return h.getSInt32();case 5:return h.getUInt32();case 6:return h.getInt64();case 7:return h.getUInt64();case 8:return h.getSInt64();case 9:return h.getBool();default:return h.skip(),null}return null}function NUe(e){const a=e.asUnsafe(),l={type:jte(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=jte(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=PUe(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function FUe(e){const i={},s=e.asUnsafe();for(;s.next();)switch(s.tag()){case 1:i.name=s.getString();break;case 2:i.isSystemMaintained=s.getBool();break;default:s.skip()}return i}function UUe(e,t,r,i){const a=t.createFeature(r);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=i[l++].name;a.attributes[c]=e.processMessage(DUe);break}case 2:a.geometry=e.processMessageWithArgs($Ue,t,r);break;case 4:a.centroid=e.processMessageWithArgs(IUe,t,r);break;default:e.skip()}return a}function kUe(e){const n=[1,1,1,1],o=e.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function VUe(e){const n=[0,0,0,0],o=e.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function BUe(e){const s={originPosition:Hte(0)},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.originPosition=Hte(n.getEnum());break;case 2:s.scale=n.processMessage(kUe);break;case 3:s.translate=n.processMessage(VUe);break;default:n.skip()}return s}function zUe(e){const s={},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.shapeAreaFieldName=n.getString();break;case 2:s.shapeLengthFieldName=n.getString();break;case 3:s.units=n.getString();break;default:n.skip()}return s}function GUe(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function jUe(e,t){const _=t.createFeatureResult(),b=e.asUnsafe();_.geometryType=qte(t,0);let x=!1;for(;b.next();)switch(b.tag()){case 1:_.objectIdFieldName=b.getString();break;case 3:_.globalIdFieldName=b.getString();break;case 4:_.geohashFieldName=b.getString();break;case 5:_.geometryProperties=b.processMessage(zUe);break;case 7:_.geometryType=qte(t,b.getEnum());break;case 8:_.spatialReference=b.processMessageWithArgs(GUe,t);break;case 10:_.hasZ=b.getBool();break;case 11:_.hasM=b.getBool();break;case 12:_.transform=b.processMessage(BUe);break;case 9:{const T=b.getBool();_.exceededTransferLimit=T;break}case 13:t.addField(_,b.processMessage(NUe));break;case 15:x||(t.prepareFeatures(_),x=!0),t.addFeature(_,b.processMessageWithArgs(UUe,t,_,_.fields));break;case 2:_.uniqueIdField=b.processMessage(FUe);break;default:b.skip()}return t.finishFeatureResult(_),_}function HUe(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(LUe);break;case 1:s.featureResult=e.processMessageWithArgs(jUe,t);break;default:e.skip()}return v(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function qUe(e,t){try{const i=new pw(new Uint8Array(e),new DataView(e)),s={};for(;i.next();)i.tag()===2?s.queryResult=i.processMessageWithArgs(HUe,t):i.skip();return s}catch(r){throw new j("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}function WUe(e,t){const r=qUe(e,t),i=r.queryResult.featureResult,s=r.queryResult.queryGeometry,n=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const o=i.objectIdFieldName;for(const a of i.features)a.attributes&&(a.objectId=a.attributes[o])}return i&&(i.queryGeometry=s,i.queryGeometryType=n),i}function LG(e,t,r){if(!r||!r.features||!r.hasZ)return;const i=qme(r.geometryType,t,e.outSpatialReference);if(!E(i))for(const s of r.features)i(s.geometry)}const Wte="Layer does not support extent calculation.";function XUe(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function YUe(e,t){const r=e.geometry,i=e.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const s=i;let n,o,a;if(v(r)&&(o=r.spatialReference,a=r.spatialReference.wkid||JSON.stringify(r.spatialReference),s.geometryType=dC(r),s.geometry=XUe(r,e.compactGeometryEnabled),s.inSR=a),i.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(s.objectIds=i.objectIds.join(",")),i.orderByFields&&(s.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:i.outFields.includes("*")?s.outFields="*":s.outFields=i.outFields.join(","),i.outSR?(s.outSR=i.outSR.wkid||JSON.stringify(i.outSR),n=e.outSpatialReference):r&&(i.returnGeometry||i.returnCentroid)&&(s.outSR=s.inSR,n=o),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(s.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(s.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(s.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&v(o)&&v(e.quantizationParameters)&&v(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(s.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(s.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(s.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const l=i.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c!=null?c:"null"},${h!=null?h:"null"}`),delete i.timeExtent}return e.defaultSpatialReferenceEnabled&&v(o)&&v(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function ZUe(e,t,r,i){const s=v(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await SP(e,t,"json",i);return LG(t,r,s.data),s}async function OTt(e,t,r,i){if(v(t.timeExtent)&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const s=await JUe(e,t,i),n=s;return n.data=WUe(s.data,r),n}function JUe(e,t,r){return SP(e,t,"pbf",r)}function MTt(e,t,r){return v(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):SP(e,t,"json",r,{returnIdsOnly:!0})}function PTt(e,t,r){return v(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):SP(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function ITt(e,t,r){return v(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):SP(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(i=>{const s=i.data;if(s.hasOwnProperty("extent"))return i;if(s.features)throw new Error(Wte);if(s.hasOwnProperty("count"))throw new Error(Wte);return i})}function SP(e,t,r,i={},s={}){const n=typeof e=="string"?po(e):e,o=t.geometry?[t.geometry]:[];return i.responseType=r==="pbf"?"array-buffer":"json",W0e(o,null,i).then(a=>{const l=a&&a[0];v(l)&&((t=t.clone()).geometry=l);const c=X0e({...n.query,f:r,...s,...YUe(t,s)});return Di(ku(n.path,"query"),{...i,query:{...c,...i.query}})})}var DG;const NG=new Vr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Yo=DG=class extends fe{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const r=Ye.fromJSON(t.spatialReference),i=[];for(let n=0;n<e.length;n++){const o=e[n],a=Aa.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;v(a.geometry)&&!l&&(a.geometry.spatialReference=r);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&v(h))for(const p in h){const f=h[p],m=(s=c[p])==null?void 0:s.spatialReference;v(f)&&!m&&(f.spatialReference=r)}i.push(a)}return i}writeGeometryType(e,t,r,i){if(e)return void NG.write(e,t,r,i);const{features:s}=this;if(s){for(const n of s)if(n&&v(n.geometry))return void NG.write(n.geometry.type,t,r,i)}}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,i=gm(e);return i&&!r&&t.spatialReference&&(i.spatialReference=Ye.fromJSON(t.spatialReference)),i}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&v(i.geometry)&&i.geometry.spatialReference)return void(t.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new DG(this.cloneProperties())}cloneProperties(){return re({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const i=t.features[r];if(i.geometry){const s=e&&e[r];i.geometry=s&&s.toJSON()||i.geometry}}return t}quantize(e){const{scale:[t,r],translate:[i,s]}=e,n=c=>Math.round((c-i)/t),o=c=>Math.round((s-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[i,s],scale:[n,o]}=r,a=h=>h*n+i,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)v(h)&&c&&c(h);return this.transform=null,this}_quantizePoints(e,t,r){let i,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=r(l[1]);c===i&&h===s||(n.push([c-i,h-s]),i=c,s=h)}else i=t(l[0]),s=r(l[1]),n.push([i,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,r){return e==="point"?i=>(i.x=t(i.x),i.y=r(i.y),i):e==="polyline"||e==="polygon"?i=>{const s=lw(i)?i.rings:i.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,r);c&&n.push(c)}return n.length>0?(lw(i)?i.rings=n:i.paths=n,i):null}:e==="multipoint"?i=>{const s=this._quantizePoints(i.points,t,r);return s&&s.length>0?(i.points=s,i):null}:e==="extent"?i=>i:null}_getHydrationFunction(e,t,r){return e==="point"?i=>{i.x=t(i.x),i.y=r(i.y)}:e==="polyline"||e==="polygon"?i=>{const s=lw(i)?i.rings:i.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=r(o)}}}:e==="extent"?i=>{i.xmin=t(i.xmin),i.ymin=r(i.ymin),i.xmax=t(i.xmax),i.ymax=r(i.ymax)}:e==="multipoint"?i=>{const s=i.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=r(o)}}:null}};u([d({type:String,json:{write:!0}})],Yo.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Yo.prototype,"exceededTransferLimit",void 0),u([d({type:[Aa],json:{write:!0}})],Yo.prototype,"features",void 0),u([De("features")],Yo.prototype,"readFeatures",null),u([d({type:[R6],json:{write:!0}})],Yo.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:NG.read}}})],Yo.prototype,"geometryType",void 0),u([Be("geometryType")],Yo.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Yo.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Yo.prototype,"hasZ",void 0),u([d({types:yx,json:{write:!0}})],Yo.prototype,"queryGeometry",void 0),u([De("queryGeometry")],Yo.prototype,"readQueryGeometry",null),u([d({type:Ye,json:{write:!0}})],Yo.prototype,"spatialReference",void 0),u([Be("spatialReference")],Yo.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Yo.prototype,"transform",void 0),Yo=DG=u([P("esri.rest.support.FeatureSet")],Yo),Yo.prototype.toJSON.isDefaultToJSON=!0;const BY=Yo,Xte={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},QUe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function KUe(e,t){const r=new Date(e,t+1,1);return r.setDate(0),r.getDate()}function fw(e,t,r){const i=new Date(e.getTime());if(t&&r){const s=QUe[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=KUe(i.getFullYear(),i.getMonth()+t);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+t*a)}return i}function Yte(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function e8e(e,t,r){return e===0?0:e*Xte[t]/Xte[r]}var $d;let du=$d=class extends fe{static get allTime(){return Zte}static get empty(){return t8e}constructor(e){super(e),this.end=null,this.start=null}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals($d.allTime)}get isEmpty(){return this.equals($d.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new $d({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=v(this.start)?this.start.getTime():this.start,r=v(this.end)?this.end.getTime():this.end,i=v(e.start)?e.start.getTime():e.start,s=v(e.end)?e.end.getTime():e.end;return t===i&&r===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=ho(this.start,i=>Yte(i,e)),r=ho(this.end,i=>{const s=Yte(i,e);return i.getTime()===s.getTime()?s:fw(s,1,e)});return new $d({start:t,end:r})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return $d.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=Tu(this.start,-1/0,a=>a.getTime()),r=Tu(this.end,1/0,a=>a.getTime()),i=Tu(e.start,-1/0,a=>a.getTime()),s=Tu(e.end,1/0,a=>a.getTime());let n,o;if(i>=t&&i<=r?n=i:t>=i&&t<=s&&(n=t),r>=i&&r<=s?o=r:s>=t&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new $d;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return $d.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const r=new $d,{start:i,end:s}=this;return v(i)&&(r.start=fw(i,e,t)),v(s)&&(r.end=fw(s,e,t)),r}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return Zte.clone();const t=v(this.start)&&v(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=v(this.end)&&v(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new $d({start:t,end:r})}};u([d({type:Date,json:{write:{allowNull:!0}}})],du.prototype,"end",void 0),u([De("end")],du.prototype,"readEnd",null),u([Be("end")],du.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],du.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],du.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],du.prototype,"start",void 0),u([De("start")],du.prototype,"readStart",null),u([Be("start")],du.prototype,"writeStart",null),du=$d=u([P("esri.TimeExtent")],du);const Zte=new du,t8e=new du({start:void 0,end:void 0}),Lm=du;let Y1=class extends Ss(fe){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([d({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.onFields)&&this.onFields.length>0}}}}})],Y1.prototype,"onFields",void 0),u([d({type:String,json:{write:!0}})],Y1.prototype,"operator",void 0),u([d({type:String,json:{write:!0}})],Y1.prototype,"searchTerm",void 0),u([d({type:String,json:{write:!0}})],Y1.prototype,"searchType",void 0),Y1=u([P("esri.rest.support.FullTextSearch")],Y1);const r8e=Y1;var FG;const Jte=new Vr({upperLeft:"upper-left",lowerLeft:"lower-left"});let Z1=FG=class extends fe{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new FG(re({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:qr,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Z1.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],Z1.prototype,"mode",void 0),u([d({type:String,json:{read:Jte.read,write:Jte.write}})],Z1.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Z1.prototype,"tolerance",void 0),Z1=FG=u([P("esri.rest.support.QuantizationParameters")],Z1);const i8e=Z1;var UG;const Qte=new Vr({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Ld=UG=class extends fe{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=re(e))}clone(){return new UG({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:re(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],Ld.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],Ld.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],Ld.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],Ld.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],Ld.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:Qte.read},write:{target:"statisticType",writer:Qte.write}}})],Ld.prototype,"statisticType",void 0),u([d({type:Object})],Ld.prototype,"statisticParameters",void 0),u([Be("statisticParameters")],Ld.prototype,"writeStatisticParameters",null),Ld=UG=u([P("esri.rest.support.StatisticDefinition")],Ld);const Z0e=Ld;var CS;const s8e=new Vr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),n8e=new Vr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Bt=CS=class extends fe{static from(e){return KS(CS,e)}constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const r={};for(const i in e){const s=e[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}t.parameterValues=r}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new CS(re({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:v(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Bt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],Bt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],Bt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],Bt.prototype,"datumTransformation",void 0),u([zt("datumTransformation")],Bt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Bt.prototype,"distance",void 0),u([d({type:Kd,json:{write:!0}})],Bt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"formatOf3DObjects",void 0),u([d({type:[r8e],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.fullText)&&this.fullText.length>0}}}}})],Bt.prototype,"fullText",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"gdbVersion",void 0),u([d({types:yx,json:{read:gm,write:!0}})],Bt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Bt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],Bt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"having",void 0),u([d({type:Date})],Bt.prototype,"historicMoment",void 0),u([Be("historicMoment")],Bt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Bt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:e=>e<1?1:e>CS.MAX_MAX_RECORD_COUNT_FACTOR?CS.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],Bt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],Bt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Bt.prototype,"num",void 0),u([d({json:{write:!0}})],Bt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Bt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Bt.prototype,"outFields",void 0),u([d({type:Ye,json:{name:"outSR",write:!0}})],Bt.prototype,"outSpatialReference",void 0),u([d({type:[Z0e],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.outStatistics)&&this.outStatistics.length>0}}}}})],Bt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],Bt.prototype,"parameterValues",void 0),u([Be("parameterValues")],Bt.prototype,"writeParameterValues",null),u([d({type:yt,json:{write:!0}})],Bt.prototype,"pixelSize",void 0),u([d({type:i8e,json:{write:!0}})],Bt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],Bt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Bt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],Bt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],Bt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Bt.prototype,"returnZ",void 0),u([d({type:Ye,json:{write:!0}})],Bt.prototype,"sourceSpatialReference",void 0),u([ft(s8e,{ignoreUnknown:!1,name:"spatialRel"})],Bt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Bt.prototype,"start",void 0),u([Be("start"),Be("num")],Bt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],Bt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],Bt.prototype,"text",void 0),u([d({type:Lm,json:{write:!0}})],Bt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Bt.prototype,"timeReferenceUnknownClient",void 0),u([ft(n8e,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(e){return{enabled:!!e&&this.distance!=null&&this.distance>0}}}}})],Bt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start!=null&&this.start>0}}}}})],Bt.prototype,"where",void 0),u([Be("where")],Bt.prototype,"writeWhere",null),Bt=CS=u([P("esri.rest.support.Query")],Bt);const cm=Bt;async function Sk(e,t,r){const i=await o8e(e,t,r);return BY.fromJSON(i)}async function o8e(e,t,r){const i=VY(e),s={...r},n=cm.from(t),{data:o}=await ZUe(i,n,n.sourceSpatialReference,s);return o}function Oa(e,t){return e?t?4:3:t?3:2}const EP=ee.getLogger("esri.layers.graphics.featureConversionUtils"),J0e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},a8e=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n},Kte=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2]},l8e=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+3]},c8e=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2],e[r+3]=t[i+3]};function zY(e,t,r,i){if(e){if(r)return t&&i?c8e:Kte;if(t&&i)return l8e}else if(t&&i)return Kte;return a8e}function Ek({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function Ck({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function Ak({scale:e,translate:t},r,i){return r*e[i]+t[i]}function $Tt(e,t,r){return e?t?r?HY(e):GY(e):r?jY(e):M6(e):null}function M6(e){const t=e.coords;return{x:t[0],y:t[1]}}function Q0e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function GY(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function u8e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function jY(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function h8e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function HY(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function d8e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function p8e(e,t,r,i){let s=M6;r&&i?s=HY:r?s=GY:i&&(s=jY);for(const n of t){const{geometry:o,attributes:a}=n,l=v(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function qY(e,t){return e&&t?d8e:e?u8e:t?h8e:Q0e}function f8e(e,t,r,i,s){const n=qY(r,i);for(const{geometry:o,attributes:a}of t){const l=v(o)?n(new Hl,o):null;e.push(new Sm(l,a,null,s?a[s]:void 0))}return e}function LTt(e,t,r=qY(t.z!=null,t.m!=null)){return r(e,t)}function m8e(e,t,r,i){for(const{geometry:s,attributes:n}of t)e.push({attributes:n,geometry:v(s)?K0e(s,r,i):null});return e}function K0e(e,t,r){if(E(e))return null;const i=Oa(t,r),s=[];for(let n=0;n<e.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(e.coords[n+a]);s.push(o)}return t?r?{points:s,hasZ:t,hasM:r}:{points:s,hasZ:t}:r?{points:s,hasM:r}:{points:s}}function g8e(e,t,r,i,s){const n=Oa(r,i);for(const{geometry:o,attributes:a}of t){const l=v(o)?e_e(new Hl,o,n):null;e.push(new Sm(l,a,null,s?a[s]:void 0))}return e}function e_e(e,t,r=Oa(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let s=0;for(const n of t.points)for(let o=0;o<r;o++)i[s++]=n[o];return e}function y8e(e,t,r,i){for(const{geometry:s,attributes:n}of t)e.push({attributes:n,geometry:v(s)?t_e(s,r,i):null});return e}function t_e(e,t,r){if(!e)return null;const i=Oa(t,r),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function _8e(e,t,r,i,s){const n=Oa(r,i);for(const{geometry:o,attributes:a}of t){const l=v(o)?r_e(new Hl,o,n):null;e.push(new Sm(l,a,null,s?a[s]:void 0))}return e}function r_e(e,t,r=Oa(t.hasZ,t.hasM)){const{lengths:i,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return e}function v8e(e,t,r,i){for(const{geometry:s,attributes:n,centroid:o}of t){const a=v(s)?i_e(s,r,i):null;if(v(o)){const l=M6(o);e.push({attributes:n,centroid:l,geometry:a})}else e.push({attributes:n,geometry:a})}return e}function i_e(e,t,r){if(!e)return null;const i=Oa(t,r),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function b8e(e,t,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of t){const l=v(n)?s_e(new Hl,n,r,i):null,c=s?a[s]:void 0;v(o)?e.push(new Sm(l,a,Q0e(new Hl,o),c)):e.push(new Sm(l,a,null,c))}return e}function s_e(e,t,r=t.hasZ,i=t.hasM){return w8e(e,t.rings,r,i),e}function w8e(e,t,r,i){const s=Oa(r,i),{lengths:n,coords:o}=e;let a=0;ry(e);for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const AS=[],H3=[];function DTt(e,t,r,i,s){AS[0]=e;const[n]=n_e(H3,AS,t,r,i,s);return Lp(AS),Lp(H3),n}function n_e(e,t,r,i,s,n){if(Lp(e),!r){for(const o of t){const a=n?o.attributes[n]:void 0;e.push(new Sm(null,o.attributes,null,a))}return e}switch(r){case"esriGeometryPoint":return f8e(e,t,i,s,n);case"esriGeometryMultipoint":return g8e(e,t,i,s,n);case"esriGeometryPolyline":return _8e(e,t,i,s,n);case"esriGeometryPolygon":return b8e(e,t,i,s,n);default:EP.error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${r}'`)),Lp(e)}return e}function NTt(e,t,r,i){H3[0]=e,o_e(AS,H3,t,r,i);const s=AS[0];return Lp(AS),Lp(H3),s}function x8e(e,t,r){if(E(e))return null;const i=new Hl;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&r==null&&(r=e.hasM),sX(e)?qY(t!=null?t:e.z!=null,r!=null?r:e.m!=null)(i,e):lw(e)?s_e(i,e,t,r):nX(e)?r_e(i,e,Oa(t,r)):iX(e)?e_e(i,e,Oa(t,r)):void EP.error("convertFromGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${e}'`))}function T8e(e,t,r,i){const s=e&&("coords"in e?e:e.geometry);if(E(s))return null;switch(t){case"esriGeometryPoint":{let n=M6;return r&&i?n=HY:r?n=GY:i&&(n=jY),n(s)}case"esriGeometryMultipoint":return K0e(s,r,i);case"esriGeometryPolyline":return t_e(s,r,i);case"esriGeometryPolygon":return i_e(s,r,i);default:return EP.error("convertToGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${t}'`)),null}}function S8e(e,t){for(const r of t)e.push({attributes:r.attributes});return e}function o_e(e,t,r,i,s){if(Lp(e),E(r))return S8e(e,t);switch(r){case"esriGeometryPoint":return p8e(e,t,i,s);case"esriGeometryMultipoint":return m8e(e,t,i,s);case"esriGeometryPolyline":return y8e(e,t,i,s);case"esriGeometryPolygon":return v8e(e,t,i,s);default:EP.error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${r}'`))}return e}function FTt(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=e,m={features:o_e([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:h,queryGeometry:T8e(p,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function UTt(e,t){var f;const r=new O6,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(r.fields=p),r.geometryType=l!=null?l:null,r.objectIdFieldName=(f=o!=null?o:t)!=null?f:null,r.spatialReference=a!=null?a:null,r.objectIdFieldName?(n&&n_e(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(EP.error(new j("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function kTt(e){const{transform:t,features:r,hasM:i,hasZ:s}=e;if(!t)return e;for(const n of r)v(n.geometry)&&tre(n.geometry,n.geometry,i,s,t),v(n.centroid)&&tre(n.centroid,n.centroid,i,s,t);return e.transform=null,e}function VTt(e,t){const{geometryType:r,features:i,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new Hl,ere(l.geometry,a.geometry,s,n,r,e),a.centroid&&(l.centroid=new Hl,ere(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),i[o]=l}return t.transform=e,t}function ere(e,t,r,i,s,n,o=r,a=i){if(ry(e),E(t)||!t.coords.length)return null;const l=J0e[s],{coords:c,lengths:h}=t,p=Oa(r,i),f=Oa(r&&o,i&&a),m=zY(r,i,o,a);if(!h.length)return m(e.coords,c,0,0,Ek(n,c[0]),Ck(n,c[1])),ry(e,p,0),e;let y,_,b,x,T=0,S=0,C=S;for(const O of h){if(O<l)continue;let R=0;S=C,b=y=Ek(n,c[T]),x=_=Ck(n,c[T+1]),m(e.coords,c,S,T,b,x),R++,T+=p,S+=f;for(let $=1;$<O;$++,T+=p)b=Ek(n,c[T]),x=Ck(n,c[T+1]),b===y&&x===_||(m(e.coords,c,S,T,b-y,x-_),S+=f,R++,y=b,_=x);R>=l&&(e.lengths.push(R),C=S)}return Lp(e.coords,C),e.coords.length?e:null}function BTt(e,t,r,i,s,n,o=r,a=i){if(ry(e),!t||!t.coords.length)return null;const l=J0e[s],{coords:c,lengths:h}=t,p=Oa(r,i),f=Oa(r&&o,i&&a),m=zY(r,i,o,a);if(!h.length)return m(e.coords,c,0,0,c[0],c[1]),ry(e,p,0),e;let y=0;const _=n*n;for(const b of h){if(b<l){y+=b*p;continue}const x=e.coords.length/f,T=y,S=y+(b-1)*p;m(e.coords,c,e.coords.length,T,c[T],c[T+1]),kG(e.coords,c,p,_,m,T,S),m(e.coords,c,e.coords.length,S,c[S],c[S+1]);const C=e.coords.length/f-x;C>=l?e.lengths.push(C):Lp(e.coords,x*f),y+=b*p}return e.coords.length?e:null}function E8e(e,t,r,i){const s=e[t],n=e[t+1],o=e[r],a=e[r+1],l=e[i],c=e[i+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function kG(e,t,r,i,s,n,o){let a,l=i,c=0;for(let h=n+r;h<o;h+=r)a=E8e(t,h,n,o),a>l&&(c=h,l=a);l>i&&(c-n>r&&kG(e,t,r,i,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>r&&kG(e,t,r,i,s,c,o))}function zTt(e,t,r,i){if(E(t)||!t.coords||!t.coords.length)return null;const s=Oa(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return s7(e)?xPe(e,n,o,a,l):gX(n,o,a,l,e),e}function tre(e,t,r,i,s){var _,b,x,T,S,C,O,R;const{coords:n,lengths:o}=t,a=Oa(r,i);if(!n.length)return e!==t&&ry(e),e;x5(s);const{originPosition:l,scale:c,translate:h}=s,p=A8e;p.originPosition=l;const f=p.scale;f[0]=(_=c[0])!=null?_:1,f[1]=-((b=c[1])!=null?b:1),f[2]=(x=c[2])!=null?x:1,f[3]=(T=c[3])!=null?T:1;const m=p.translate;if(m[0]=(S=h[0])!=null?S:0,m[1]=(C=h[1])!=null?C:0,m[2]=(O=h[2])!=null?O:0,m[3]=(R=h[3])!=null?R:0,!o.length){for(let $=0;$<a;++$)e.coords[$]=Ak(p,n[$],$);return e!==t&&ry(e,a,0),e}let y=0;for(let $=0;$<o.length;$++){const I=o[$];e.lengths[$]=I;for(let G=0;G<a;++G)e.coords[y+G]=Ak(p,n[y+G],G);let U=e.coords[y],V=e.coords[y+1];y+=a;for(let G=1;G<I;G++,y+=a){U+=n[y]*f[0],V+=n[y+1]*f[1],e.coords[y]=U,e.coords[y+1]=V;for(let z=2;z<a;++z)e.coords[y+z]=Ak(p,n[y+z],z)}}return e!==t&&ry(e,n.length,o.length),e}function GTt(e,t,r,i,s,n){if(ry(e),e.lengths.push(...t.lengths),r===s&&i===n)for(let o=0;o<t.coords.length;o++)e.coords.push(t.coords[o]);else{const o=Oa(r,i),a=zY(r,i,s,n),l=t.coords;for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1])}return e}function C8e(e,t,r,i){let s=0,n=e[i*t],o=e[i*(t+1)];for(let a=1;a<r;a++){const l=n+e[i*(t+a)],c=o+e[i*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function jTt(e,t){const{coords:r,lengths:i}=e;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=C8e(r,s,a,t),s+=a}return Math.abs(n)}function HTt(e,t){if(E(e))return null;const r=e.clone(),i=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=i[t*n],c=i[t*n+1];for(let h=1;h<a;h++){const p=l+i[t*(n+h)],f=c+i[t*(n+h)+1];r.coords[t*(n+h)]=p,r.coords[t*(n+h)+1]=f,l=p,c=f}n+=a}return r}function ry(e,t=0,r=0){Lp(e.lengths,r),Lp(e.coords,t)}function Lp(e,t=0){e.length!==t&&(e.length=t)}const A8e={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};var VG;let nn=VG=class extends fe{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new VG(re({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],nn.prototype,"cacheHint",void 0),u([d({type:Kd,json:{write:!0}})],nn.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],nn.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],nn.prototype,"geometryPrecision",void 0),u([d({type:Date})],nn.prototype,"historicMoment",void 0),u([Be("historicMoment")],nn.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],nn.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],nn.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],nn.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],nn.prototype,"outFields",void 0),u([d({type:Ye,json:{read:{source:"outSR"},write:{target:"outSR"}}})],nn.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],nn.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],nn.prototype,"start",void 0),u([Be("start"),Be("num")],nn.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],nn.prototype,"num",void 0),u([d({json:{write:!0}})],nn.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],nn.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],nn.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],nn.prototype,"where",void 0),nn=VG=u([P("esri.rest.support.RelationshipQuery")],nn),nn.from=Us(nn);const EE=nn;var qTt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:EE}),BG;let s2=BG=class extends fe{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new BG({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],s2.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],s2.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],s2.prototype,"orderByFields",void 0),s2=BG=u([P("esri.rest.support.TopFilter")],s2);const R8e=s2;var zG;const rre=new Vr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),ire=new Vr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Ms=zG=class extends fe{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new zG(re({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],Ms.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Ms.prototype,"distance",void 0),u([d({types:yx,json:{read:gm,write:!0}})],Ms.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Ms.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],Ms.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Ms.prototype,"num",void 0),u([d({json:{write:!0}})],Ms.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Ms.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Ms.prototype,"outFields",void 0),u([d({type:Ye,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ms.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],Ms.prototype,"resultType",void 0),u([d({json:{write:!0}})],Ms.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ms.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ms.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Ms.prototype,"start",void 0),u([Be("start"),Be("num")],Ms.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:rre.read},write:{target:"spatialRel",writer:rre.write}}})],Ms.prototype,"spatialRelationship",void 0),u([d({type:Lm,json:{write:!0}})],Ms.prototype,"timeExtent",void 0),u([d({type:R8e,json:{write:!0}})],Ms.prototype,"topFilter",void 0),u([d({type:String,json:{read:ire.read,write:{writer:ire.write,overridePolicy(e){return{enabled:v(e)&&v(this.distance)&&this.distance>0}}}}})],Ms.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],Ms.prototype,"where",void 0),Ms=zG=u([P("esri.rest.support.TopFeaturesQuery")],Ms),Ms.from=Us(Ms);const FI=Ms,O8e="esri.widgets.Feature.support.relatedFeatureUtils",sre=ee.getLogger(O8e),nre=new Map;function DD(e){if(!Yg(e))return null;const[t,r]=e.split("/").slice(1);return{layerId:t,fieldName:r}}function M8e(e,t){if(!t.relationships)return null;let r=null;const{relationships:i}=t;return i.some(s=>s.id===parseInt(e,10)&&(r=s,!0)),r}function P8e({originRelationship:e,relationships:t,layerId:r}){let i=null;return t&&t.some(s=>(`${s.relatedTableId}`===r&&s.id===(e==null?void 0:e.id)&&(i=s),!!i)),i}function I8e(e,t){const r=t.toLowerCase();for(const i in e)if(i.toLowerCase()===r)return e[i];return null}function $8e(e,t){const r=M8e(e,t);if(!!r)return{url:`${t.url}/${r.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:r,relatedFields:[],outStatistics:[]}}function L8e(e,t){if(!t||!e)return;const{features:r,statsFeatures:i}=e,s=r&&r.value;t.relatedFeatures=s?s.features:[];const n=i&&i.value;t.relatedStatsFeatures=n?n.features:[]}function D8e(e,t,r,i){var n,o;const s=new EE;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[r.objectIdField]],(o=(n=r.queryRelatedFeatures)==null?void 0:n.call(r,s,i))!=null?o:Promise.resolve({})}function N8e(e,t,r){let i=0;const s=[];for(;i<t.length;)s.push(`${e} IN (${t.slice(i,r+i)})`),i+=r;return s.join(" OR ")}async function F8e(e,t,r,i){const s=r.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t;if(!n||!o)return null;const p=P8e({originRelationship:o,relationships:n.relationships,layerId:s});if((p==null?void 0:p.relationshipTableId)&&p.keyFieldInRelationshipTable){const m=(await D8e(e,p,r,i))[e.attributes[r.objectIdField]];if(!m)return null;const y=m.features.map(_=>_.attributes[n.objectIdField]);if((l==null?void 0:l.length)&&n.supportsStatistics){const _=new cm;_.where=N8e(n.objectIdField,y,1e3),_.outFields=a,_.outStatistics=l,_.sourceSpatialReference=h;const b={features:Promise.resolve(m),statsFeatures:Sk(c,_)};return fo(b)}}const f=p==null?void 0:p.keyField;if(f){const m=D5(z8e(n.fields,f)),y=I8e(e.attributes,o.keyField),_=m?`${f}=${y}`:`${f}='${y}'`,b=Sk(c,new cm({where:_,outFields:t.relatedFields,sourceSpatialReference:h}),i),x=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?Sk(c,new cm({where:_,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),i):null,T={features:b};return x&&(T.statsFeatures=x),fo(T)}return null}function U8e(e,t){return Di(e,{query:{f:"json"},signal:t&&t.signal})}function k8e({relatedInfos:e,layer:t},r){const i={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new j("relation-required","A relation is required on a layer to retrieve related records.");throw sre.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new j("A related table ID is required on a layer to retrieve related records.");throw sre.error(p),p}const l=`${t.url}/${a}`,c=nre.get(l),h=c||U8e(l);c||nre.set(l,h),i[n]=h}),MW(fo(i),r)}function V8e({graphic:e,relatedInfos:t,layer:r},i){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=F8e(e,n,r,i))}),fo(s)}function B8e({relatedInfo:e,fieldName:t,fieldInfo:r}){var i,s;if((i=e.relatedFields)==null||i.push(t),r.statisticType){const n=new Z0e({statisticType:r.statisticType,onStatisticField:t,outStatisticFieldName:t});(s=e.outStatistics)==null||s.push(n)}}function z8e(e,t){if(e!=null){t=t.toLowerCase();for(const r of e)if(r&&r.name.toLowerCase()===t)return r}return null}const ore={chartAnimation:!0};let Zn=class extends Te{constructor(e){super(e),this.abilities={...ore},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...ore,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,r=(e+t)%t;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,r=t+e;this._setContentElementMedia(r)}_formatMediaInfos(){var o,a,l,c,h;const{mediaInfos:e,layer:t}=this,r=(o=this.attributes)!=null?o:{},i=(a=this.formattedAttributes)!=null?a:{},s=(l=this.expressionAttributes)!=null?l:{},n=(c=this.fieldInfoMap)!=null?c:new Map;return(h=e==null?void 0:e.map(p=>{const f=p==null?void 0:p.clone();if(!f)return null;if(f.title=Qb({attributes:r,fieldInfoMap:n,globalAttributes:i,expressionAttributes:s,layer:t,text:f.title}),f.caption=Qb({attributes:r,fieldInfoMap:n,globalAttributes:i,expressionAttributes:s,layer:t,text:f.caption}),f.altText=Qb({attributes:r,fieldInfoMap:n,globalAttributes:i,expressionAttributes:s,layer:t,text:f.altText}),f.type==="image"){const{value:m}=f;return this._setImageValue({value:m,formattedAttributes:i,layer:t}),f.value.sourceURL?f:void 0}if(f.type==="pie-chart"||f.type==="line-chart"||f.type==="column-chart"||f.type==="bar-chart"){const{value:m}=f;return this._setChartValue({value:m,chartType:f.type,attributes:r,formattedAttributes:i,layer:t,expressionAttributes:s}),f}return null}).filter(v))!=null?h:[]}_setImageValue(e){var a;const t=(a=this.fieldInfoMap)!=null?a:new Map,{value:r,formattedAttributes:i,layer:s}=e,{linkURL:n,sourceURL:o}=r;if(o){const l=_G(o,s);r.sourceURL=yG({formattedAttributes:i,template:l,fieldInfoMap:t})}if(n){const l=_G(n,s);r.linkURL=yG({formattedAttributes:i,template:l,fieldInfoMap:t})}}_setChartValue(e){var m;const{value:t,attributes:r,formattedAttributes:i,chartType:s,layer:n,expressionAttributes:o}=e,{popupTemplate:a,relatedInfos:l}=this,{fields:c,normalizeField:h}=t,p=n;if(t.fields=d5e(c,p),h&&(t.normalizeField=qO(h,p)),!c.some(y=>!!(i[y]!=null||Yg(y)&&(l==null?void 0:l.size))))return;const f=(m=a==null?void 0:a.fieldInfos)!=null?m:[];c.forEach(y=>{if(Yg(y))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:y,formattedAttributes:i,chartType:s,value:t})]);const _=this._getChartOption({value:t,attributes:r,chartType:s,formattedAttributes:i,expressionAttributes:o,fieldName:y,fieldInfos:f});t.series.push(_)})}_getRelatedChartInfos(e){var f;const{fieldInfos:t,fieldName:r,formattedAttributes:i,chartType:s,value:n}=e,o=[],a=DD(r),l=a&&((f=this.relatedInfos)==null?void 0:f.get(a.layerId.toString()));if(!l)return o;const{relatedFeatures:c,relation:h}=l;if(!h||!c)return o;const{cardinality:p}=h;return c.forEach(m=>{const{attributes:y}=m;y&&Object.keys(y).forEach(_=>{_===a.fieldName&&o.push(this._getChartOption({value:n,attributes:y,formattedAttributes:i,fieldName:r,chartType:s,relatedFieldName:_,hasMultipleRelatedFeatures:(c==null?void 0:c.length)>1,fieldInfos:t}))})}),p==="one-to-many"||p==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var O,R,$,I,U,V,G;const{value:t,attributes:r,formattedAttributes:i,expressionAttributes:s,fieldName:n,relatedFieldName:o,fieldInfos:a,chartType:l,hasMultipleRelatedFeatures:c}=e,h=this.layer,p=(O=this.fieldInfoMap)!=null?O:new Map,{normalizeField:f,tooltipField:m}=t,y=f?Yg(f)?r[DD(f).fieldName]:r[f]:null,_=SY(n)&&s&&s[n]!==void 0?s[n]:o&&r[o]!==void 0?r[o]:r[n]!==void 0?r[n]:i[n],b=new ofe({fieldName:n,value:_===void 0?null:_&&y?_/y:_});if(Yg(n)){const z=p.get(n.toLowerCase()),Z=m&&p.get(m.toLowerCase()),Q=(R=z==null?void 0:z.fieldName)!=null?R:n,te=c&&m?DD(m).fieldName:($=Z==null?void 0:Z.fieldName)!=null?$:m,q=c&&te?r[te]:(V=(U=(I=i[te])!=null?I:z==null?void 0:z.label)!=null?U:z==null?void 0:z.fieldName)!=null?V:o,L=c&&o?r[o]:i[Q];return b.tooltip=this._getTooltip({label:q,value:L,chartType:l}),b}const x=A0e(a,n),T=qO(n,h),S=m&&i[m]!==void 0?i[m]:E0e(x||new lP({fieldName:T}),(G=this.popupTemplate)==null?void 0:G.expressionInfos),C=i[T];return b.tooltip=this._getTooltip({label:S,value:C,chartType:l}),b}};u([d()],Zn.prototype,"abilities",void 0),u([zt("abilities")],Zn.prototype,"castAbilities",null),u([d()],Zn.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],Zn.prototype,"activeMediaInfo",null),u([d()],Zn.prototype,"attributes",void 0),u([d()],Zn.prototype,"description",void 0),u([d()],Zn.prototype,"fieldInfoMap",void 0),u([d()],Zn.prototype,"formattedAttributes",void 0),u([d()],Zn.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],Zn.prototype,"formattedMediaInfos",null),u([d()],Zn.prototype,"isAggregate",void 0),u([d()],Zn.prototype,"layer",void 0),u([d({readOnly:!0})],Zn.prototype,"formattedMediaInfoCount",null),u([d()],Zn.prototype,"mediaInfos",void 0),u([d()],Zn.prototype,"popupTemplate",void 0),u([d()],Zn.prototype,"relatedInfos",void 0),u([d()],Zn.prototype,"title",void 0),Zn=u([P("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Zn);const ew=Zn;var are=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],G8e=[].concat(are.slice(30,39),are.slice(28,30).reverse()),j8e=[{name:"default",colors:G8e},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const lre="en-us",WY=new Map([["ar",()=>ie(()=>import("./ar.64bdae33.js"),["assets/ar.64bdae33.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.a)],["bg-bg",()=>ie(()=>import("./bg_BG.8070db04.js"),["assets/bg_BG.8070db04.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.b)],["bs-ba",()=>ie(()=>import("./bs_BA.e94fced0.js"),["assets/bs_BA.e94fced0.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.b)],["ca-es",()=>ie(()=>import("./ca_ES.fa1fb6d4.js"),["assets/ca_ES.fa1fb6d4.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.c)],["cs-cz",()=>ie(()=>import("./cs_CZ.26d7de29.js"),["assets/cs_CZ.26d7de29.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.c)],["da-dk",()=>ie(()=>import("./da_DK.120f7f3f.js"),["assets/da_DK.120f7f3f.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.d)],["de-de",()=>ie(()=>import("./de_DE.05454bea.js"),["assets/de_DE.05454bea.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.d)],["de-ch",()=>ie(()=>import("./de_CH.354b0f69.js"),["assets/de_CH.354b0f69.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.d)],["el-gr",()=>ie(()=>import("./el_GR.6e9d996c.js"),["assets/el_GR.6e9d996c.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["en-us",()=>ie(()=>import("./en_US.aa05200a.js"),["assets/en_US.aa05200a.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["en-ca",()=>ie(()=>import("./en_CA.ff5961af.js"),["assets/en_CA.ff5961af.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["es-es",()=>ie(()=>import("./es_ES.b6c9470c.js"),["assets/es_ES.b6c9470c.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["et-ee",()=>ie(()=>import("./et_EE.43d8819e.js"),["assets/et_EE.43d8819e.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.e)],["fi-fi",()=>ie(()=>import("./fi_FI.3aabcb85.js"),["assets/fi_FI.3aabcb85.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.f)],["fr-fr",()=>ie(()=>import("./fr_FR.8416be11.js"),["assets/fr_FR.8416be11.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.f)],["he-il",()=>ie(()=>import("./he_IL.e0d274e8.js"),["assets/he_IL.e0d274e8.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.h)],["hr-hr",()=>ie(()=>import("./hr_HR.d7fe48fb.js"),["assets/hr_HR.d7fe48fb.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.h)],["hu-hu",()=>ie(()=>import("./hu_HU.806bf1a2.js"),["assets/hu_HU.806bf1a2.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.h)],["id-id",()=>ie(()=>import("./id_ID.85c2ee17.js"),["assets/id_ID.85c2ee17.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.i)],["it-it",()=>ie(()=>import("./it_IT.b038d1ce.js"),["assets/it_IT.b038d1ce.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.i)],["ja-jp",()=>ie(()=>import("./ja_JP.f97218a7.js"),["assets/ja_JP.f97218a7.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.j)],["ko-kr",()=>ie(()=>import("./ko_KR.bf13fd77.js"),["assets/ko_KR.bf13fd77.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.k)],["lt-lt",()=>ie(()=>import("./lt_LT.6a79f2eb.js"),["assets/lt_LT.6a79f2eb.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.l)],["lv-lv",()=>ie(()=>import("./lv_LV.79bc32a5.js"),["assets/lv_LV.79bc32a5.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.l)],["nb-no",()=>ie(()=>import("./nb_NO.4305bd9b.js"),["assets/nb_NO.4305bd9b.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.n)],["nl-nl",()=>ie(()=>import("./nl_NL.f0879c32.js"),["assets/nl_NL.f0879c32.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.n)],["pl-pl",()=>ie(()=>import("./pl_PL.b8fb6a8c.js"),["assets/pl_PL.b8fb6a8c.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.p)],["pt-br",()=>ie(()=>import("./pt_BR.08b07c11.js"),["assets/pt_BR.08b07c11.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.p)],["pt-pt",()=>ie(()=>import("./pt_PT.d28f3862.js"),["assets/pt_PT.d28f3862.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.p)],["ro-ro",()=>ie(()=>import("./ro_RO.39f3d641.js"),["assets/ro_RO.39f3d641.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.r)],["ru-ru",()=>ie(()=>import("./ru_RU.d88da93b.js"),["assets/ru_RU.d88da93b.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.r)],["sk-sk",()=>ie(()=>import("./sk_SK.9da3725b.js"),["assets/sk_SK.9da3725b.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.s)],["sl-sl",()=>ie(()=>import("./sl_SL.f070a09a.js"),["assets/sl_SL.f070a09a.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.s)],["sr-rs",()=>ie(()=>import("./sr_RS.819b319a.js"),["assets/sr_RS.819b319a.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.s)],["sv-se",()=>ie(()=>import("./sv_SE.21930b6e.js"),["assets/sv_SE.21930b6e.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.s)],["th-th",()=>ie(()=>import("./th_TH.e79ffca7.js"),["assets/th_TH.e79ffca7.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.t)],["tr-tr",()=>ie(()=>import("./tr_TR.83778020.js"),["assets/tr_TR.83778020.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.t)],["uk-ua",()=>ie(()=>import("./uk_UA.349126cc.js"),["assets/uk_UA.349126cc.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.u)],["vi-vn",()=>ie(()=>import("./vi_VN.dfae26af.js"),["assets/vi_VN.dfae26af.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.v)],["zh-cn",()=>ie(()=>import("./zh_Hans.b2367cdd.js"),["assets/zh_Hans.b2367cdd.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.z)],["zh-hk",()=>ie(()=>import("./zh_Hant.8c4a1b8d.js"),["assets/zh_Hant.8c4a1b8d.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.z)],["zh-tw",()=>ie(()=>import("./zh_Hant.8c4a1b8d.js"),["assets/zh_Hant.8c4a1b8d.js","assets/_commonjsHelpers.4421ccc9.js","assets/_commonjs-dynamic-modules.0552a654.js"]).then(e=>e.z)]]);function H8e(e){const t=e.split("-")[0].toLowerCase();let r=null;for(const i of WY.keys())if(i.startsWith(t)){r=i;break}return r}function q8e(e){return e?WY.has(e.toLowerCase())?e.toLowerCase():H8e(e)||lre:lre}let Ux=null,nA=null;async function W8e(e=Gh()){if(e=q8e(e),Ux&&e===nA)return Ux;Ux=ie(()=>import("./index.9fddb7c2.js"),["assets/index.9fddb7c2.js","assets/_commonjsHelpers.4421ccc9.js"]).then(t=>t.i),nA=e;try{const[t,r]=await Promise.all([Ux,WY.get(nA)()]);nA===e&&(t.am4core.options.defaultLocale=r.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Ux=null,nA=null,null}return Ux}function X8e(e,t="default"){const r=j8e.find(i=>i.name===t);return r?r.colors.map(i=>e.color(i)):null}const fl="esri-feature-media",cn={base:fl,mediaContainer:`${fl}__container`,mediaItemContainer:`${fl}__item-container`,mediaItem:`${fl}__item`,mediaItemTitle:`${fl}__item-title`,mediaItemCaption:`${fl}__item-caption`,mediaPrevious:`${fl}__previous`,mediaPreviousIconLTR:`${fl}__previous-icon`,mediaPreviousIconRTL:`${fl}__previous-icon--rtl`,mediaNext:`${fl}__next`,mediaNextIconLTR:`${fl}__next-icon`,mediaNextIconRTL:`${fl}__next-icon--rtl`,mediaChart:`${fl}__chart`,mediaButton:`${fl}__button`,mediaIcon:`${fl}__icon`,iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},Rk=.05,Ok=.95,Mk=15,qm="color",e0="tooltip",oA="value",cre="default-line-value";let cc=class extends cl{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new ew,this.messages=null,this._getChartDependencies=async r=>{const i=await W8e(),{destroyed:s,viewModel:n}=this;if(s||!n||!r)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(i);this._renderChart({chartDiv:r,mediaInfo:o,chartsModule:i,colorMap:a})}}initialize(){this._featureElementInfo=new _6,this.addHandles([se(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),kt),se(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),kt)])}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return ne("div",{bind:this,class:cn.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?ne("div",{key:"media-element-container",class:cn.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:i}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=S0e(h!=null?h:void 0)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",m=n?t:null,y=m?m.timestamp:0,_=m?m.sourceURL:c,b=ne("img",{alt:o||a,key:`media-${l}-${r}-${i}-${y}`,src:_!=null?_:void 0});return(h?ne("a",{title:a,href:h,rel:f,target:p},b):null)||b}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:r}=this.viewModel;return ne("div",{key:`media-${e.type}-${t}-${r}`,bind:this,class:cn.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?ne("div",{key:"media-title",class:cn.mediaItemTitle,innerHTML:e.title}):null,r=e.caption?ne("div",{key:"media-caption",class:cn.mediaItemCaption,innerHTML:e.caption}):null;return ne("div",{key:"media-container",class:cn.mediaItemContainer},ne("div",{key:"media-item-container",class:cn.mediaItem},this.renderMediaInfoType()),t,r)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",r=t?this.messages.previous:this.messages.next,i=t?this.classes(cn.mediaButton,cn.mediaPrevious):this.classes(cn.mediaButton,cn.mediaNext),s=t?this.classes(cn.mediaIcon,cn.mediaPreviousIconLTR,cn.iconLeftTriangleArrow):this.classes(cn.mediaIcon,cn.mediaNextIconLTR,cn.iconRightTriangleArrow),n=t?this.classes(cn.mediaIcon,cn.mediaPreviousIconRTL,cn.iconRightTriangleArrow):this.classes(cn.mediaIcon,cn.mediaNextIconRTL,cn.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return ne("button",{type:"button",key:o,title:r,"aria-label":r,tabIndex:0,class:i,bind:this,onclick:a},ne("span",{"aria-hidden":"true",class:s}),ne("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){var r;const{description:e,title:t}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:e,layer:t}=this.viewModel;return e&&(t==null?void 0:t.featureReduction)&&"renderer"in t.featureReduction?t.featureReduction.renderer:t==null?void 0:t.renderer}async _getRendererColors(e){const{am4core:t}=e,r=new Map,i=this._getRenderer(),s="default";if(!i)return r;const n=await pUe(i);return n.delete(s),Array.from(n.values()).every(o=>(o==null?void 0:o.length)===1)&&(r.set(cre,t.color({r:50,g:50,b:50,a:1})),Array.from(n.keys()).forEach(o=>{var a;o&&r.set(o,t.color((a=n.get(o))==null?void 0:a[0].toCss(!0)))})),r}_handleMediaKeyup(e){const t=Mb(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:r,chartDiv:i,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=r,c=X8e(l);function h(m){m instanceof l.ColorSet&&c&&(m.list=c)}ZF()&&l.useTheme(r.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(r.am4themes_animated):l.unuseTheme(r.am4themes_animated),l.useTheme(h);const f=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);i.setAttribute("aria-label",s.altText||s.title),f.data=o.series.map(m=>({[e0]:m.tooltip,[oA]:m.value,[qm]:n.get(m.fieldName)})).filter(m=>a!=="pie-chart"||m.value!=null&&m.value>0)}_customizeChartTooltip(e,t){e&&(e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7}))}_createPieChart(e){const{chartDiv:t,chartsModule:r}=e,{am4core:i,am4charts:s}=r,n=i.create(t,s.PieChart);n.rtl=em(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=oA,o.dataFields.category=e0,this._customizeChartTooltip(o.tooltip,i),o.slices.template.propertyFields.fill=qm,o.slices.template.propertyFields.stroke=qm,n}_getMinSeriesValue(e){let t=0;return e.forEach(r=>t=Math.min(r.value,t)),t}_createColumnChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:s}=i,{am4core:n,am4charts:o}=r,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=e0,a.renderer.labels.template.disabled=!0;const l=a.tooltip;this._customizeChartTooltip(l,n),l.events.on("sizechanged",()=>{l.dy=-l.contentHeight});const c=e.yAxes.push(new o.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=Rk,c.renderer.maxLabelPosition=Ok,c.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(c.tooltip,n),h.wrap=!0;const p=e.series.push(new o.ColumnSeries);p.dataFields.valueY=oA,p.dataFields.categoryX=e0,p.columns.template.propertyFields.fill=qm,p.columns.template.propertyFields.stroke=qm,e.cursor=new o.XYCursor,s.series.length>Mk&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:s}=i,{am4core:n,am4charts:o}=r,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=e0,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0;const l=a.tooltip;this._customizeChartTooltip(l,n),l.events.on("sizechanged",()=>{l.dx=l.contentWidth});const c=e.xAxes.push(new o.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=Rk,c.renderer.maxLabelPosition=Ok,c.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(c.tooltip,n),h.wrap=!0;const p=e.series.push(new o.ColumnSeries);p.dataFields.valueX=oA,p.dataFields.categoryY=e0,p.columns.template.propertyFields.fill=qm,p.columns.template.propertyFields.stroke=qm,e.cursor=new o.XYCursor,s.series.length>Mk&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:r,mediaInfo:i,colorMap:s}=t,{value:n}=i,{am4core:o,am4charts:a}=r,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=e0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,o),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const h=e.yAxes.push(new a.ValueAxis),p=h.renderer.labels.template;h.renderer.minLabelPosition=Rk,h.renderer.maxLabelPosition=Ok,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,o),p.wrap=!0;const f=e.series.push(new a.LineSeries);f.dataFields.categoryX=e0,f.dataFields.valueY=oA,f.strokeWidth=1;const m=s.get(cre);m&&(f.stroke=m);const y=f.bullets.push(new a.CircleBullet);y.propertyFields.fill=qm,y.propertyFields.stroke=qm,e.cursor=new a.XYCursor,n.series.length>Mk&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:r,mediaInfo:i}=e,{type:s}=i,{am4core:n,am4charts:o}=r,a=n.create(t,o.XYChart);return a.rtl=em(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:r}=e;if(!t)return;const i=6e4*t;this._updateMediaInfoTimestamp(r.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},i);this._refreshTimer=s}_getImageSource(e,t){const r=e.includes("?")?"&":"?",[i,s=""]=e.split("#");return`${i}${r}timestamp=${t}${s?"#":""}${s}`}};u([d()],cc.prototype,"attributes",null),u([d()],cc.prototype,"activeMediaInfoIndex",null),u([d()],cc.prototype,"description",null),u([d()],cc.prototype,"fieldInfoMap",null),u([d()],cc.prototype,"layer",null),u([d()],cc.prototype,"mediaInfos",null),u([d()],cc.prototype,"popupTemplate",null),u([d()],cc.prototype,"relatedInfos",null),u([d()],cc.prototype,"title",null),u([d({type:ew})],cc.prototype,"viewModel",void 0),u([d(),il("esri/widgets/Feature/t9n/Feature")],cc.prototype,"messages",void 0),cc=u([P("esri.widgets.Feature.FeatureMedia")],cc);const a_e=cc;var GG;let $R=GG=class extends fe{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new GG({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],$R.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],$R.prototype,"maxValue",void 0),$R=GG=u([P("esri.renderer.support.AuthoringInfoClassBreakInfo")],$R);var jG;let f_=jG=class extends fe{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new jG({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:re(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],f_.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],f_.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],f_.prototype,"label",void 0),u([d({type:[$R],json:{write:!0}})],f_.prototype,"classBreakInfos",void 0),f_=jG=u([P("esri.renderers.support.AuthoringInfoFieldInfo")],f_);var HG;const UI=new Vr({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),kI=new Vr({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),ure={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},hre=["high-to-low","above-and-below","centered-on","extremes"],dre=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],pre=["seconds","minutes","hours","days","months","years"];let uc=HG=class extends fe{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new HG({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:ure,json:{write:!0}})],uc.prototype,"endTime",void 0),u([zt("endTime")],uc.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],uc.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],uc.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],uc.prototype,"minSliderValue",void 0),u([d({types:ure,json:{write:!0}})],uc.prototype,"startTime",void 0),u([zt("startTime")],uc.prototype,"castStartTime",null),u([d({type:UI.apiValues,value:null,json:{type:UI.jsonValues,read:UI.read,write:UI.write}})],uc.prototype,"style",null),u([d({type:dre,value:null,json:{type:dre,origins:{"web-scene":{type:hre,write:{writer:(e,t)=>{hre.includes(e)&&(t.theme=e)}}}},write:!0}})],uc.prototype,"theme",null),u([d({type:kI.apiValues,json:{type:kI.jsonValues,read:kI.read,write:kI.write}})],uc.prototype,"type",void 0),u([d({type:pre,json:{type:pre,write:!0}})],uc.prototype,"units",void 0),uc=HG=u([P("esri.renderers.support.AuthoringInfoVisualVariable")],uc);const Y8e=uc;let ND=class extends fe{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],ND.prototype,"type",void 0),ND=u([P("esri.rest.support.ColorRamp")],ND);const XY=ND;var qG;let J1=qG=class extends XY{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new qG({fromColor:re(this.fromColor),toColor:re(this.toColor),algorithm:this.algorithm})}};u([ft({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],J1.prototype,"algorithm",void 0),u([d({type:Qe,json:{type:[Ri],write:!0}})],J1.prototype,"fromColor",void 0),u([d({type:Qe,json:{type:[Ri],write:!0}})],J1.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],J1.prototype,"type",void 0),J1=qG=u([P("esri.rest.support.AlgorithmicColorRamp")],J1);const YY=J1;var WG;let LR=WG=class extends XY{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new WG({colorRamps:re(this.colorRamps)})}};u([d({type:[YY],json:{write:!0}})],LR.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],LR.prototype,"type",void 0),LR=WG=u([P("esri.rest.support.MultipartColorRamp")],LR);const l_e=LR,Z8e={key:"type",base:XY,typeMap:{algorithmic:YY,multipart:l_e}};function J8e(e){return e&&e.type?e.type==="algorithmic"?YY.fromJSON(e):e.type==="multipart"?l_e.fromJSON(e):null:null}var XG;const Xv=new Vr({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),VI=new Vr({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),fre=new Vr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),mre=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],Q8e=["high-to-low","above-and-below","above","below","90-10"],K8e=["flow-line","wave-front"],eke=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let un=XG=class extends fe{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?J8e(e):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new XG({classificationMethod:this.classificationMethod,colorRamp:re(this.colorRamp),fadeRatio:re(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:re(this.field1),field2:re(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:Xv.apiValues,value:null,json:{type:Xv.jsonValues,read:Xv.read,write:Xv.write,origins:{"web-document":{default:"manual",type:Xv.jsonValues,read:Xv.read,write:Xv.write}}}})],un.prototype,"classificationMethod",null),u([d({types:Z8e,json:{write:!0}})],un.prototype,"colorRamp",void 0),u([De("colorRamp")],un.prototype,"readColorRamp",null),u([d({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"fadeRatio",void 0),u([d({type:[String],value:null,json:{write:!0}})],un.prototype,"fields",null),u([d({type:f_,value:null,json:{write:!0}})],un.prototype,"field1",null),u([d({type:f_,value:null,json:{write:!0}})],un.prototype,"field2",null),u([d({type:K8e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],un.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],un.prototype,"focus",null),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],un.prototype,"isAutoGenerated",void 0),u([d({type:Number,value:null,json:{type:Ri,write:!0}})],un.prototype,"numClasses",null),u([d({type:mre,json:{type:mre,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],un.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],un.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],un.prototype,"standardDeviationInterval",null),u([d({type:VI.apiValues,value:null,json:{type:VI.jsonValues,read:VI.read,write:VI.write,origins:{"web-scene":{type:fre.jsonValues,write:{writer:fre.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],un.prototype,"type",null),u([d({type:[Y8e],json:{write:!0}})],un.prototype,"visualVariables",void 0),u([d({type:eke,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],un.prototype,"univariateSymbolStyle",null),u([d({type:Q8e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],un.prototype,"univariateTheme",null),un=XG=u([P("esri.renderers.support.AuthoringInfo")],un);const ZY=un,Pk=new Vr({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let DR=class extends fe{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:ZY,json:{write:!0}})],DR.prototype,"authoringInfo",void 0),u([d({type:Pk.apiValues,readOnly:!0,json:{type:Pk.jsonValues,read:!1,write:{writer:Pk.write,ignoreOrigin:!0}}})],DR.prototype,"type",void 0),DR=u([P("esri.renderers.Renderer")],DR);const My=DR;function tke(e){var t,r,i;return(i=(r=(t=e.match(rke))==null?void 0:t[1])==null?void 0:r.replace(/\\'/g,"'"))!=null?i:null}const rke=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var YG;let RS=YG=class extends fe{constructor(){super(...arguments),this.title=null}clone(){return new YG({title:this.title})}};u([d({type:String,json:{write:!0}})],RS.prototype,"title",void 0),RS=YG=u([P("esri.renderers.support.LegendOptions")],RS);var ZG;let FD=ZG=class extends RS{constructor(){super(...arguments),this.showLegend=null}clone(){return new ZG({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],FD.prototype,"showLegend",void 0),FD=ZG=u([P("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],FD);const c_e=FD,Ik=new Vr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Dd=class extends fe{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(ee.getLogger(this.declaredClass).error(".field: field must be a string value"),null):tP(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],Dd.prototype,"index",void 0),u([d({type:Ik.apiValues,readOnly:!0,json:{read:Ik.read,write:Ik.write}})],Dd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Dd.prototype,"field",void 0),u([zt("field")],Dd.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Dd.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Dd.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],Dd.prototype,"arcadeRequired",null),u([d({type:c_e,json:{write:!0}})],Dd.prototype,"legendOptions",void 0),Dd=u([P("esri.renderers.visualVariables.VisualVariable")],Dd);const CP=Dd;var JG;let Q1=JG=class extends CP{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value),this._set("stops",e)}clone(){return new JG({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],Q1.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],Q1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Q1.prototype,"normalizationField",void 0),u([d({type:[e6e],json:{write:!0}})],Q1.prototype,"stops",null),Q1=JG=u([P("esri.renderers.visualVariables.ColorVariable")],Q1);const u_e=Q1;var QG;let H0=QG=class extends fe{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return hE(t.transparency)}writeOpacity(e,t,r){t[r]=hP(e)}clone(){return new QG({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],H0.prototype,"label",void 0),u([d({type:Number,json:{type:Ri,write:{target:"transparency"}}})],H0.prototype,"opacity",void 0),u([De("opacity",["transparency"])],H0.prototype,"readOpacity",null),u([Be("opacity")],H0.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],H0.prototype,"value",void 0),H0=QG=u([P("esri.renderers.visualVariables.support.OpacityStop")],H0);const ike=H0;var KG;let K1=KG=class extends CP{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value),this._set("stops",e)}clone(){return new KG({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],K1.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],K1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],K1.prototype,"normalizationField",void 0),u([d({type:[ike],json:{write:!0}})],K1.prototype,"stops",null),K1=KG=u([P("esri.renderers.visualVariables.OpacityVariable")],K1);const h_e=K1;var ej;let vg=ej=class extends CP{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,r,i){if(i&&i.messages){const s=`visualVariables[${this.index}]`;i.messages.push(new j("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:i}))}}clone(){return new ej({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],vg.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],vg.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],vg.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],vg.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],vg.prototype,"valueExpressionTitle",void 0),u([Be("web-scene","valueExpressionTitle")],vg.prototype,"writeValueExpressionTitleWebScene",null),vg=ej=u([P("esri.renderers.visualVariables.RotationVariable")],vg);const d_e=vg;var tj;let n2=tj=class extends fe{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new tj({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],n2.prototype,"label",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],n2.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],n2.prototype,"value",void 0),n2=tj=u([P("esri.renderers.visualVariables.support.SizeStop")],n2);const o2=n2;var rj;let UD=rj=class extends c_e{constructor(){super(...arguments),this.customValues=null}clone(){return new rj({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],UD.prototype,"customValues",void 0),UD=rj=u([P("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],UD);const ske=UD;var iy,Lo;function G_(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function YO(e){return e!=null&&!isNaN(e)&&isFinite(e)}function p_e(e){return e.valueExpression?iy.Expression:e.field&&typeof e.field=="string"?iy.Field:iy.Unknown}function nke(e,t){const r=t||p_e(e),i=e.valueUnit||"unknown";return r===iy.Unknown?Lo.Constant:e.stops?Lo.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?Lo.ClampedLinear:i==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?Lo.Proportional:Lo.Additive:Lo.Identity:Lo.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(iy||(iy={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(Lo||(Lo={}));function WTt(e){}function oke(e){return()=>e}const CE={inches:xn(1,"meters","inches"),feet:xn(1,"meters","feet"),"us-feet":xn(1,"meters","us-feet"),yards:xn(1,"meters","yards"),miles:xn(1,"meters","miles"),"nautical-miles":xn(1,"meters","nautical-miles"),millimeters:xn(1,"meters","millimeters"),centimeters:xn(1,"meters","centimeters"),decimeters:xn(1,"meters","decimeters"),meters:xn(1,"meters","meters"),kilometers:xn(1,"meters","kilometers"),"decimal-degrees":1/oOe(1,"meters",br.radius)},yv=ee.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),gre=new Aa,kD=Math.PI,f_e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function m_e(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="color"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void yv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(E(r)||E(r.arcade))return void yv.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,b=_.getViewInfo(y),x=_.createExecContext(n,b);if(!p){const T=_.createSyntaxTree(i.valueExpression);p=_.createFunction(T),i.cache.compiledFunc=p}a=_.executeFunction(p,x)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=QY(a,c);if(y){const _=y[0],b=y[1],x=_===b?i.stops[_].color:Qe.blendColors(i.stops[_].color,i.stops[b].color,y[2],v(r)?r.color:void 0);return new Qe(x)}}}function g_e(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="opacity"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void yv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=i.field,{ipData:c,hasExpression:h}=i.cache;let p=i.cache.compiledFunc;if(!l&&!h){const y=i.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(E(r)||E(r.arcade))return void yv.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,b=_.getViewInfo(y),x=_.createExecContext(n,b);if(!p){const T=_.createSyntaxTree(i.valueExpression);p=_.createFunction(T),i.cache.compiledFunc=p}a=_.executeFunction(p,x)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=QY(a,c);if(y){const _=y[0],b=y[1];if(_===b)return i.stops[_].opacity;{const x=i.stops[_].opacity;return x+(i.stops[b].opacity-x)*y[2]}}}}function y_e(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void yv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=i.field,{hasExpression:h}=i.cache;let p=i.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(E(r)||E(r.arcade))return void yv.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(m),b=y.createExecContext(a,_);if(!p){const x=y.createSyntaxTree(i.valueExpression);p=y.createFunction(x),i.cache.compiledFunc=p}f=y.executeFunction(p,b)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function ake(e,t,r){const i=typeof t=="number",s=i?null:t,n=s&&s.attributes;let o=i?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=v(r)?r.scale:void 0,p=v(r)?r.view:void 0;o=h==null||p==="3d"?lke(e):h}else if(!i)switch(e.inputValueType){case iy.Expression:{if(E(r)||E(r.arcade))return void yv.error("Use of arcade expressions requires an arcade context");const h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(e.valueExpression);l=p.createFunction(y),e.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case iy.Field:n&&(o=n[e.field]);break;case iy.Unknown:o=null}if(!YO(o))return null;if(i||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return YO(c)&&c!==0?o/c:null}function lke(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}function P6(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void yv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=v_e(ake(i,t,r),i,t,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function Dc(e,t,r){return e==null?null:G_(e)?P6(e,t,r):YO(e)?e:null}function __e(e,t,r){return YO(r)&&e>r?r:YO(t)&&e<t?t:e}function cke(e,t,r,i){var s;return e+((s=Dc(t.minSize,r,i)||t.minDataValue)!=null?s:0)}function uke(e,t,r){const i=e.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=e.minSize),Dc(s,t,r)}function hke(e,t,r,i){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Dc(t.minSize,r,i),o=Dc(t.maxSize,r,i),a=v(i)?i.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(n==null||o==null)return null;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?kD*(n/2)**2:n*n,h=c+s*((l?kD*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/kD):Math.sqrt(h)}return n+s*(o-n)}function dke(e,t,r,i){const s=v(i)?i.shape:void 0,n=e/t.minDataValue,o=Dc(t.minSize,r,i),a=Dc(t.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,__e(l,o,a)}function pke(e,t,r,i,s){var l,c,h;const[n,o,a]=QY(e,s);if(n===o)return Dc((l=t.stops)==null?void 0:l[n].size,r,i);{const p=Dc((c=t.stops)==null?void 0:c[n].size,r,i);return p+(Dc((h=t.stops)==null?void 0:h[o].size,r,i)-p)*a}}function fke(e,t,r,i){const s=(v(i)&&i.resolution?i.resolution:1)*CE[t.valueUnit],n=Dc(t.minSize,r,i),o=Dc(t.maxSize,r,i),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/kD)/s:a==="radius"||a==="distance"?2*e/s:e/s,__e(l,n,o)}function v_e(e,t,r,i,s){switch(t.transformationType){case Lo.Additive:return cke(e,t,r,i);case Lo.Constant:return uke(t,r,i);case Lo.ClampedLinear:return hke(e,t,r,i);case Lo.Proportional:return dke(e,t,r,i);case Lo.Stops:return pke(e,t,r,i,s);case Lo.RealWorldSize:return fke(e,t,r,i);case Lo.Identity:return e;case Lo.Unknown:return null}}function mke(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&r==="3d"||t))return null;const s={scale:t,view:r};let n=Dc(e.minSize,gre,s),o=Dc(e.maxSize,gre,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function JY(e,t,r){if(!e.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=m_e(l,t,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=g_e(l,t,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=y_e(l,t,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=P6(l,t,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function QY(e,t){if(!t)return;let r=0,i=t.length-1;return t.some((s,n)=>e<s?(i=n,!0):(r=n,!1)),[r,i,(e-t[r])/(t[i]-t[r])]}function gke(e,t,r){const i=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":P6(s,t,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}var KY=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getAllSizes:gke,getColor:m_e,getOpacity:g_e,getRotationAngle:y_e,getSize:P6,getSizeForValue:v_e,getSizeFromNumberOrVariable:Dc,getSizeRangeAtScale:mke,getVisualVariableValues:JY,viewScaleRE:f_e}),ij;const BI=new Vr({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),sj=new Vr({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function yre(e){if(e!=null)return typeof e=="string"||typeof e=="number"?pi(e):e.type==="size"?G_(e)?e:(delete(e={...e}).type,new xi(e)):void 0}function _re(e,t,r){if(typeof e!="object")return e;const i=new xi;return i.read(e,r),i}let xi=ij=class extends CP{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&f_e.test(this.valueExpression)}}set expression(e){ee.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){G_(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),G_(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return p_e(this)}set maxDataValue(e){e&&this.stops&&(ee.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(ee.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return yre(e)}readMaxSize(e,t,r){return _re(e,t,r)}set minDataValue(e){e&&this.stops&&(ee.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(ee.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return yre(e)}readMinSize(e,t,r){return _re(e,t,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value):e&&(ee.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return nke(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,r,i){if(e==="$view.scale"){if(i&&i.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;i.messages.push(new j("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:i}))}}else t[r]=e}readValueUnit(e){return e?sj.read(e):null}clone(){return new ij({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:G_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:G_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Lo.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===Lo.Stops){const e=this.stops;if(!e)return this;const t=e.map(i=>i.size).reverse(),r=e.length;for(let i=0;i<r;i++)e[i].size=t[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],xi.prototype,"cache",null),u([d({type:BI.apiValues,json:{type:BI.jsonValues,origins:{"web-map":{read:!1}},read:BI.read,write:BI.write}})],xi.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],xi.prototype,"expression",null),u([d()],xi.prototype,"index",null),u([d({type:String,readOnly:!0})],xi.prototype,"inputValueType",null),u([d({type:ske,json:{write:!0}})],xi.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],xi.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],xi.prototype,"maxSize",null),u([zt("maxSize")],xi.prototype,"castMaxSize",null),u([De("maxSize")],xi.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],xi.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],xi.prototype,"minSize",null),u([zt("minSize")],xi.prototype,"castMinSize",null),u([De("minSize")],xi.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],xi.prototype,"normalizationField",void 0),u([d({readOnly:!0})],xi.prototype,"arcadeRequired",null),u([d({type:String})],xi.prototype,"scaleBy",void 0),u([d({type:[o2],value:null,json:{write:!0}})],xi.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],xi.prototype,"target",void 0),u([d({type:String,readOnly:!0})],xi.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],xi.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],xi.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],xi.prototype,"valueExpression",void 0),u([De("valueExpression",["valueExpression","expression"])],xi.prototype,"readValueExpression",null),u([Be("web-scene","valueExpression")],xi.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],xi.prototype,"valueRepresentation",void 0),u([d({type:sj.apiValues,json:{write:sj.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],xi.prototype,"valueUnit",void 0),u([De("valueUnit")],xi.prototype,"readValueUnit",null),xi=ij=u([P("esri.renderers.visualVariables.SizeVariable")],xi);const I6=xi,yke={color:u_e,size:I6,opacity:h_e,rotation:d_e},_ke=new Vr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),vke=/^\[([^\]]+)\]$/i;let VD=class extends Te{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,r)=>{let i=null;return i=t.target===r.target?0:t.target?1:-1,i});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:i,rotationType:s}=t,n=i&&i.match(vke),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=_ke.read(a.type),c=yke[l];c||(ee.getLogger(this.declaredClass).warn(`Unknown variable type: ${l}`),r&&r.messages&&r.messages.push(new Uu("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:r})));const h=new c;return h.read(a,r),h})}writeVariables(e,t){const r=[];for(const i of e){const s=i.toJSON(t);s&&r.push(s)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],VD.prototype,"visualVariables",null),VD=u([P("esri.renderers.visualVariables.VisualVariableFactory")],VD);const bke=VD,wke={base:CP,key:"type",typeMap:{opacity:h_e,color:u_e,rotation:d_e,size:I6}},EC=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new bke}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,s){return this._vvFactory.readVariables(r,i,s)}writeVisualVariables(r,i,s,n){i[s]=this._vvFactory.writeVariables(r,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const s=this.visualVariables;return s?s.filter(n=>n.type===r&&(typeof i=="string"?n.target===i:i!==!1||!n.target)):[]}async collectVVRequiredFields(r,i){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Iu(r,i,n.field),n.normalizationField&&Iu(r,i,n.normalizationField),n.valueExpression&&(xke(n.valueExpression,r,i)||await Xl(r,i,n.valueExpression)))}};return u([d({types:[wke],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([De("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([Be("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([P("esri.renderers.mixins.VisualVariablesMixin")],t),t};function xke(e,t,r){const i=tke(e);return!!v(i)&&(Iu(t,r,i),!0)}const aA={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function Tke(e,t=aA){var a,l;if(!e)return{symbol:null};const{retainId:r=aA.retainId,ignoreDrivers:i=aA.ignoreDrivers,hasLabelingContext:s=aA.hasLabelingContext,retainCIM:n=aA.retainCIM}=t;let o=null;if(mE(e)||e instanceof wx)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new j("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():D_.fromCIMSymbol(e)}else if(e instanceof ld)o=W5.fromSimpleLineSymbol(e);else if(e instanceof Nv)o=D_.fromSimpleMarkerSymbol(e);else if(e instanceof Y5)o=D_.fromPictureMarkerSymbol(e);else if(e instanceof Dv)o=t.geometryType&&t.geometryType==="mesh"?X5.fromSimpleFillSymbol(e):gP.fromSimpleFillSymbol(e);else{if(!(e instanceof _C))return{error:new j("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?q5.fromTextSymbol(e):D_.fromTextSymbol(e)}if(r&&o&&o.type!=="cim"&&(o.id=e.id),i&&mE(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}function JF(e,t,r,i){const s=b_e(e,{},{context:i,isLabelSymbol:!1});v(s)&&(t[r]=s)}function vre(e,t,r,i){const s=b_e(e,{},{context:i,isLabelSymbol:!0});v(s)&&(t[r]=s)}function bre(e){return e instanceof yC||e instanceof wx}function b_e(e,t,r){if(E(e))return null;const{context:i,isLabelSymbol:s}=r,n=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(n==="web-scene"&&!bre(e)){const a=Tke(e,{retainCIM:!0,hasLabelingContext:s});return v(a.symbol)?a.symbol.write(t,i):(o==null||o.push(new j("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:i,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!uye(i==null?void 0:i.layer))&&bre(e)?(o==null||o.push(new j("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:i})),null):e.write(t,i)}function XTt(e,t){return i$e(e,null,t)}const CC={types:J5,json:{write:{writer:JF},origins:{"web-scene":{types:yee,write:{writer:JF},read:{reader:Pv({types:yee})}}}}},w_e={types:{base:Gc,key:"type",typeMap:{"simple-fill":uw.typeMap["simple-fill"],"picture-fill":uw.typeMap["picture-fill"],"polygon-3d":uw.typeMap["polygon-3d"]}},json:{write:{writer:JF},origins:{"web-scene":{type:gP,write:{writer:JF}}}}},BD={cast:e=>e==null||typeof e=="string"||typeof e=="number"?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}};var nj;let q0=nj=class extends fe{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new nj({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([d({type:String,json:{write:!0}})],q0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],q0.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],q0.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],q0.prototype,"maxValue",void 0),u([d(CC)],q0.prototype,"symbol",void 0),q0=nj=u([P("esri.renderers.support.ClassBreakInfo")],q0);const QF=q0;var oj;const x_e="log",zD="percent-of-total",GD="field",zI=new Vr({esriNormalizeByLog:x_e,esriNormalizeByPercentOfTotal:zD,esriNormalizeByField:GD}),Ske=Us(QF);let Jn=oj=class extends EC(My){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let i=t.minValue;return e.map(s=>{const n=new QF;return n.read(s,r),n.minValue==null&&(n.minValue=i),n.maxValue==null&&(n.maxValue=n.minValue),i=n.maxValue,n})}writeClassBreakInfos(e,t,r,i){const s=e.map(n=>n.write({},i));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[r]=s}castField(e){return e==null?e:typeof e=="function"?(ee.getLogger(this.declaredClass).error(".field: field must be a string value"),null):tP(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=this.normalizationTotal!=null;return t||r?(e=t&&GD||r&&zD||null,t&&r&&ee.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):e!==GD&&e!==zD||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let i=null;i=typeof e=="number"?new QF({minValue:e,maxValue:t,symbol:Sme(r)}):Ske(re(e)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(E(t)||E(t.arcade))&&ee.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&(E(t)||E(t.arcade))&&(r={...r,arcade:await ym()});const i=this.getBreakIndex(e,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&(E(t)||E(t.arcade)))return void ee.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(E(t)||E(t.arcade))){const s=await ym(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this.getBreakIndex(e,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((i,s)=>i+s.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new oj({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:re(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(e,t)),Xl(e,t,this.valueExpression)];Iu(e,t,this.field),Iu(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=Pt(t,{}),{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const h=l.createSyntaxTree(o);a=l.createFunction(h),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,i=this.normalizationType;let s=parseFloat(r[t]);if(i){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===x_e)s=Math.log(s)*Math.LOG10E;else if(i!==zD||n==null||isNaN(n)){if(i===GD&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}};u([d(w_e)],Jn.prototype,"backgroundFillSymbol",void 0),u([d({type:[QF]})],Jn.prototype,"classBreakInfos",void 0),u([De("classBreakInfos")],Jn.prototype,"readClassBreakInfos",null),u([Be("classBreakInfos")],Jn.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],Jn.prototype,"defaultLabel",void 0),u([d(CC)],Jn.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],Jn.prototype,"field",void 0),u([zt("field")],Jn.prototype,"castField",null),u([d({type:Boolean})],Jn.prototype,"isMaxInclusive",void 0),u([d({type:RS,json:{write:!0}})],Jn.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Jn.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],Jn.prototype,"normalizationField",void 0),u([d({type:Number,cast:e=>Ph(e),json:{write:!0}})],Jn.prototype,"normalizationTotal",void 0),u([d({type:zI.apiValues,value:null,json:{type:zI.jsonValues,read:zI.read,write:zI.write}})],Jn.prototype,"normalizationType",null),u([ft({classBreaks:"class-breaks"})],Jn.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Jn.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Jn.prototype,"valueExpressionTitle",void 0),Jn=oj=u([P("esri.renderers.ClassBreaksRenderer")],Jn);const T_e=Jn;class Eke{constructor(t,r){this._storage=new FY,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}put(t,r,i){this._storage.put(t,r,i,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const wre="esri.renderers.support.DictionaryLoader",Cke={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class eZ{constructor(t,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new Eke(100),this._dictionaryPromise=null,this.url=t,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(m){if(sn(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m];if(y&&t.attributes[y]!=null){const _=""+t.attributes[y];s[m]=_}else s[m]=""}const n=i==null?void 0:i(s,r);if(!n||typeof n!="string")return null;const o=AW(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const y=m.substr(3).split("|");if(y.length===3){const _=y[0],b=y[1];let x=y[2];if(b==="DashTemplate")x=x.split(" ").map(T=>Number(T));else if(b==="Color"){const T=new Qe(x).toRgba();x=[T[0],T[1],T[2],255*T[3]]}else x=Number(x);h.push({primitiveName:_,propertyName:b,value:x})}}else if(m.includes("|")){for(const y of m.split("|"))if(this._itemNames.has(y)){c.push(y);break}}else this._itemNames.has(m)&&c.push(m);const p=!v(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,r);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void ee.getLogger(wre).error("no valid URL!");const r=Di(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:v(t)?t.signal:null}),[{data:i}]=await Promise.all([r,ym()]);if(!i)throw this._dictionaryPromise=null,new j("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const c=this.config;for(const h in c)o[h]=c[h]}if(n.configuration)for(const c of n.configuration)o.hasOwnProperty(c.name)||(o[c.name]=c.value);const a=[];if(v(t)&&t.fields&&this.fieldMap)for(const c of this._symbolFields){const h=this.fieldMap[c],p=t.fields.filter(f=>f.name===h);p.length>0&&a.push({...p[0],name:c})}const l=lMe(s,v(t)?t.spatialReference:null,a,o).then(c=>{const h={scale:0};return(p,f)=>{var y;if(E(c))return null;const m=c.repurposeFeature({geometry:null,attributes:p});return h.scale=v(f)&&(y=f.scale)!=null?y:void 0,c.evaluate({$feature:m,$view:h})}}).catch(c=>(ee.getLogger(wre).error("Creating dictinoary expression failed:",c),null));return this._dictionaryPromise=l,l}async _cimPartsToCIMSymbol(t,r,i,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)S_e(l,a);return new fC({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(t,r){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=Di(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,r,i){if(!t||t.length===0)return null;const s={...t[0]};if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return i&&(s.callout=Cke),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}}function S_e(e,t){if(!e)return;const r=e.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const s=r[i];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&Ake(s,t)}}function Ake(e,t){const r=e.markerGraphics;if(r)for(const i of r){if(!i)continue;const s=i.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":S_e(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}var YTt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DictionaryLoader:eZ}),aj;let Nd=aj=class extends EC(My){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new eZ(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,i){i!=null&&i.origin||super.writeVisualVariables(e,t,r,i)}clone(){return new aj({config:re(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:re(this.fieldMap),url:re(this.url),visualVariables:re(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Xl(e,t,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];t.has(i)&&e.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:eZ})],Nd.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Nd.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],Nd.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Nd.prototype,"scaleExpression",void 0),u([Be("scaleExpression")],Nd.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],Nd.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],Nd.prototype,"url",void 0),u([Be("visualVariables")],Nd.prototype,"writeVisualVariables",null),Nd=aj=u([P("esri.renderers.DictionaryRenderer")],Nd);const Rke=Nd;var lj;let bg=lj=class extends fe{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(ee.getLogger(this.declaredClass).error(".field: field must be a string value"),null):tP(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new lj({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Qe,json:{type:[Number],write:!0}})],bg.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],bg.prototype,"field",void 0),u([zt("field")],bg.prototype,"castField",null),u([d({type:String,json:{write:!0}})],bg.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],bg.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],bg.prototype,"valueExpressionTitle",void 0),bg=lj=u([P("esri.renderers.support.AttributeColorInfo")],bg);const E_e=bg;var cj;let jD=cj=class extends fe{constructor(){super(...arguments),this.unit=null}clone(){return new cj({unit:this.unit})}};u([d({type:String,json:{write:!0}})],jD.prototype,"unit",void 0),jD=cj=u([P("esri.renderers.support.DotDensityLegendOptions")],jD);const Oke=jD;var uj;let hc=uj=class extends EC(My){constructor(e){super(e),this.attributes=null,this.backgroundColor=new Qe([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new ld,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new Dv({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var e,t;return(t=(e=this.attributes)==null?void 0:e.reduce((r,i)=>r+i.getAttributeHash(),""))!=null?t:""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new uj({attributes:re(this.attributes),backgroundColor:re(this.backgroundColor),dotBlendingEnabled:re(this.dotBlendingEnabled),dotShape:re(this.dotShape),dotSize:re(this.dotSize),dotValue:re(this.dotValue),legendOptions:re(this.legendOptions),outline:re(this.outline),referenceScale:re(this.referenceScale),visualVariables:re(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var t;return`${(t=this.attributes)==null?void 0:t.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){var r;await this.collectVVRequiredFields(e,t);for(const i of(r=this.attributes)!=null?r:[])i.valueExpression&&await Xl(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[E_e],json:{write:!0}})],hc.prototype,"attributes",void 0),u([d({type:Qe,json:{write:!0}})],hc.prototype,"backgroundColor",void 0),u([d({type:Boolean,json:{write:!0}})],hc.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],hc.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0}})],hc.prototype,"dotSize",void 0),u([d({type:Oke,json:{write:!0}})],hc.prototype,"legendOptions",void 0),u([d({type:ld,json:{default:null,write:!0}})],hc.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],hc.prototype,"dotValue",void 0),u([d({type:Number,json:{write:!0}})],hc.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],hc.prototype,"seed",void 0),u([ft({dotDensity:"dot-density"})],hc.prototype,"type",void 0),hc=uj=u([P("esri.renderers.DotDensityRenderer")],hc);const Mke=hc;let a2=class extends Ss(fe){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],a2.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],a2.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],a2.prototype,"title",void 0),a2=u([P("esri.renderers.support.HeatmapLegendOptions")],a2);const tZ=2.4;function Pke(e){return Qh(e*tZ)}function Ike(e){return Fo(e)/tZ}function $ke(e,t,r,i){let{color:s,ratio:n}=t,{color:o,ratio:a}=r;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=ye((i-n)/(a-n),0,1);E5(e,s.toArray(),o.toArray(),l)}function ZTt(e){const r=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return r;let i=e[0],s=e[0],n=1;const o=sr();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)i=s,s=e[n++];$ke(o,i,s,l),r.set(o,4*a)}return r}function JTt(e,t,r,i){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round(Fo(s)),l=new Float64Array(r*i);let c,h=Number.NEGATIVE_INFINITY;const p=Dke(o,n),f=new Set;for(const m of e){const y=m.getCursor();for(;y.next();){const _=y.getObjectId();if(f.has(_))continue;f.add(_);const b=y.readLegacyPointGeometry(),x=128;if(b.x<-x||b.x>=r+x||b.y<-x||b.y>i+x)continue;const T=+p(y),S=Math.max(0,Math.round(b.x)-a),C=Math.max(0,Math.round(b.y)-a),O=Math.min(i,Math.round(b.y)+a),R=Math.min(r,Math.round(b.x)+a);for(let $=C;$<O;$++)for(let I=S;I<R;I++){const U=$*r+I,V=Lke(b.x-I,b.y-$,a);c=l[U]+=V*T,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function Lke(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function QTt(e,t){return typeof e=="function"?e:e?typeof t=="string"?r=>-1*+r[e]:r=>+r[e]+t:()=>1}function Dke(e,t){return e!=null?typeof t=="string"?r=>-1*+r.readAttribute(e):r=>+r.readAttribute(e)+t:r=>1}var hj;const C_e="esri.renderers.HeatmapRenderer",Nke=ee.getLogger(C_e);function xre(e){if(e!=null){const{maxDensity:t,minDensity:r,radius:i}=e;if(t!=null||r!=null||i!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=e;return a}}return e}let Co=hj=class extends My{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new G3({ratio:0,color:new Qe("rgba(255, 140, 0, 0)")}),new G3({ratio:.75,color:new Qe("rgba(255, 140, 0, 1)")}),new G3({ratio:.9,color:new Qe("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return xre(e)}get blurRadius(){return Ike(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",Pke(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(tZ**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||al(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,hC(()=>{JB(Nke,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=xre(e),super.read(e,t)}getSymbol(){return new Nv}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await Iu(e,t,r),i&&typeof i=="string"&&await Xl(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new hj({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:re(this.colorStops),field:this.field,legendOptions:re(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:ZY,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Co.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Co.prototype,"blurRadius",null),u([d({type:[G3],json:{write:!0}})],Co.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],Co.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],Co.prototype,"fieldOffset",void 0),u([d({type:a2,json:{write:!0}})],Co.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],Co.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Co.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],Co.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Co.prototype,"minPixelIntensity",null),u([d({type:Number,cast:pi,json:{write:!0}})],Co.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],Co.prototype,"referenceScale",void 0),u([ft({heatmap:"heatmap"})],Co.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Co.prototype,"valueExpression",void 0),u([d({type:String})],Co.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],Co.prototype,"_pixelIntensityToDensity",null),Co=hj=u([P(C_e)],Co);const A_e=Co;let Nb=class extends Ss(fe){constructor(){super(...arguments),this.color=new Qe([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:Qe,json:{write:!0}})],Nb.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Nb.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Nb.prototype,"threshold",void 0),Nb=u([P("esri.renderers.support.OthersCategory")],Nb);let HD=class extends Ss(fe){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],HD.prototype,"title",void 0),HD=u([P("esri.renderers.support.PieChartLegendOptions")],HD);let su=class extends EC(Ss(My)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Qe([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Nb,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new Nv({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(v)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await Xl(e,t,r.valueExpression),r.field&&e.add(r.field)}};u([d({type:[E_e],json:{write:!0}})],su.prototype,"attributes",void 0),u([d({type:Dv,json:{default:null,write:!0}})],su.prototype,"backgroundFillSymbol",void 0),u([d({type:Qe,json:{write:!0}})],su.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],su.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],su.prototype,"holePercentage",void 0),u([d({type:Nb,json:{write:!0}})],su.prototype,"othersCategory",void 0),u([d({type:HD,json:{write:!0}})],su.prototype,"legendOptions",void 0),u([d({type:ld,json:{default:null,write:!0}})],su.prototype,"outline",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],su.prototype,"size",void 0),u([ft({pieChart:"pie-chart"})],su.prototype,"type",void 0),su=u([P("esri.renderers.PieChartRenderer")],su);const Fke=su;var dj;let eb=dj=class extends EC(My){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new dj({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:re(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],eb.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],eb.prototype,"label",void 0),u([d(CC)],eb.prototype,"symbol",void 0),u([ft({simple:"simple"})],eb.prototype,"type",void 0),eb=dj=u([P("esri.renderers.SimpleRenderer")],eb);const AE=eb,Uke=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function pj(e){return e instanceof Te}function Tre(e){return e instanceof pt?Object.keys(e.items):pj(e)?al(e).keys():e?Object.keys(e):[]}function GI(e,t){return e instanceof pt?e.items[t]:e[t]}function kke(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function q3(e){return e?e.declaredClass:null}function R_e(e,t){const r=e.diff;if(r&&typeof r=="function")return r(e,t);const i=Tre(e),s=Tre(t);if(i.length===0&&s.length===0)return;if(!i.length||!s.length||kke(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!i.includes(p)),o=i.filter(p=>!s.includes(p)),a=i.filter(p=>s.includes(p)&&GI(e,p)!==GI(t,p)).concat(n,o).sort(),l=q3(e);if(l&&Uke.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=pj(e)&&pj(t);for(const p of a){const f=GI(e,p),m=GI(t,p);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(r&&r[p]&&typeof r[p]=="function")y=r[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&q3(f)===q3(m)?R_e(f,m):{type:"complete",oldValue:f,newValue:m};v(y)&&(v(c)?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function Vke(e,t){if(E(e))return!1;const r=t.split(".");let i=e;for(const s of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const n=i.diff[s];if(!n)return!1;i=n}}return!0}function KTt(e,t){for(const r of t)if(Vke(e,r))return!0;return!1}function Bke(e,t){if(!(typeof e=="function"||typeof t=="function"||E(e)&&E(t)))return E(e)||E(t)||typeof e=="object"&&typeof t=="object"&&q3(e)!==q3(t)?{type:"complete",oldValue:e,newValue:t}:R_e(e,t)}function jI(e){if(E(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const r of t.added)if(!jI(r))return!1;for(const r of t.removed)if(!jI(r))return!1;for(const r of t.changed)if(!jI(r))return!1;return!0}case"partial":for(const t in e.diff)if(!jI(e.diff[t]))return!1;return!0}}let l2=class extends Ss(fe){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([d(BD)],l2.prototype,"value",void 0),u([d(BD)],l2.prototype,"value2",void 0),u([d(BD)],l2.prototype,"value3",void 0),l2=u([P("esri.renderers.support.UniqueValue")],l2);const OS=l2;let W0=class extends Ss(fe){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return t==="string"||t==="number"?e.map(r=>new OS({value:r})):t==="object"?e[0]instanceof OS?e:e.map(r=>new OS(r)):null}};u([d({type:String,json:{write:!0}})],W0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],W0.prototype,"label",void 0),u([d(CC)],W0.prototype,"symbol",void 0),u([d({type:[OS],json:{type:[[String]],read:{reader:e=>e?e.map(t=>new OS({value:t[0],value2:t[1],value3:t[2]})):null},write:{writer:(e,t)=>{const r=[];for(const i of e){const s=[i.value,i.value2,i.value3].filter(v).map(n=>n.toString());r.push(s)}t.values=r}}}})],W0.prototype,"values",void 0),u([zt("values")],W0.prototype,"castValues",null),W0=u([P("esri.renderers.support.UniqueValueClass")],W0);const O_e=W0;let NR=class extends Ss(fe){constructor(e){super(e),this.heading=null,this.classes=null}};u([d({type:String,json:{write:!0}})],NR.prototype,"heading",void 0),u([d({type:[O_e],json:{write:!0}})],NR.prototype,"classes",void 0),NR=u([P("esri.renderers.support.UniqueValueGroup")],NR);const fj=NR;var mj;let tb=mj=class extends fe{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new mj({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([d({type:String,json:{write:!0}})],tb.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],tb.prototype,"label",void 0),u([d(CC)],tb.prototype,"symbol",void 0),u([d(BD)],tb.prototype,"value",void 0),tb=mj=u([P("esri.renderers.support.UniqueValueInfo")],tb);const W3=tb,zke=()=>!!de("enable-feature:force-wosr"),e2t=()=>!!de("enable-feature:direct-3d-object-feature-layer-display"),t2t=()=>!!de("enable-feature:SceneLayer-editing");let $k={};async function Gke(e,t){try{return{data:(await Wke(e,t)).data,baseUrl:oIe(e),styleUrl:e}}catch(r){return Sc(r),null}}function jke(e,t,r){const i=v(t.portal)?t.portal:Uo.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${e}`;return $k[n]||($k[n]=Hke(e,i,r).then(o=>(s=o,o.fetchData())).then(o=>{var a;return{data:o,baseUrl:(a=s.itemUrl)!=null?a:"",styleName:e}})),$k[n]}function Hke(e,t,r){return t.load(r).then(()=>{const i=new jg({disableExtraQuery:!0,query:`owner:${Sre} AND type:${Ere} AND typekeywords:"${e}"`});return t.queryItems(i,r)}).then(({results:i})=>{var o;let s=null;const n=e.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===Ere&&a.owner===Sre){s=a;break}}if(!s)throw new j("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(r)})}function qke(e,t,r){return e&&v(e.styleUrl)?Gke(e.styleUrl,r):e&&v(e.styleName)?jke(e.styleName,t,r):Promise.reject(new j("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function r2t(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function i2t(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!zke()){for(const r of e.formatInfos)if(r.type==="gltf")return r.href}return e.webRef}function Wke(e,t){const r={responseType:"json",query:{f:"json"},...t};return Di(jh(e),r)}const Sre="esri_en",Ere="Style",s2t="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var FR;const M_e="esri.renderers.UniqueValueRenderer",t0=ee.getLogger(M_e),Cre="uvInfos-watcher",Are="uvGroups-watcher",Xke=",",Yke=Us(W3);function Zke(e){const{field1:t,field2:r,field3:i,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=e,a=!(!t||!r);return[{classes:(n!=null?n:[]).map(l=>{var x;const{symbol:c,label:h,value:p,description:f}=l,[m,y,_]=a?((x=p==null?void 0:p.toString())==null?void 0:x.split(s||""))||[]:[p],b=[];return(t||o)&&b.push(m),r&&b.push(y),i&&b.push(_),{symbol:c,label:h,values:[b],description:f}})}]}let Gs=FR=class extends EC(My){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,r){if(!t&&!r)return;if(!t||!r)return{type:"complete",oldValue:t,newValue:r};let i=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<r.length;n++){const o=t.find(a=>a.value===r[n].value);o?Bke(o,r[n])?(s.changed.push({type:"complete",oldValue:o,newValue:r[n]}),i=!0):s.unchanged.push({oldValue:o,newValue:r[n]}):(s.added.push(r[n]),i=!0)}for(let n=0;n<t.length;n++)r.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),i=!0);return i?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return e==null||typeof e=="function"?e:tP(e)}writeField(e,t,r,i){typeof e=="string"?t[r]=e:i&&i.messages?i.messages.push(new j("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):t0.error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,r){return r.portal||Uo.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const i=gC(t.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(e,t,r,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=Lw(e.styleUrl,i))}set uniqueValueGroups(e){this.styleOrigin?t0.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?t0.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){var i;if(this.styleOrigin)return void t0.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof e=="object"?Yke(e):new W3({value:e,symbol:Sme(t)}),(i=this.uniqueValueInfos)==null||i.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void t0.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t){for(let r=0;r<t.length;r++)if(t[r].value===e+""){delete this._valueInfoMap[e],t.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&(E(t)||E(t.arcade))&&(r={...r,arcade:await ym()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&(E(t)||E(t.arcade)))return void t0.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(E(r)||E(r.arcade))){const s=await ym(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this._getUniqueValueInfo(e,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){var t;const e=[];for(const r of(t=this.uniqueValueInfos)!=null?t:[])r.symbol&&e.push(r.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){var i;const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=(i=this.uniqueValueInfos)==null?void 0:i.reduce((s,n)=>s+n.getMeshHash(),"");return`${e}.${t}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new FR({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:re(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:re(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=re(this.uniqueValueInfos),r=re(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(re(this.styleOrigin))),Object.freeze(t),Object.freeze(r)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",r),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(e,t)),Xl(e,t,this.valueExpression)];Iu(e,t,this.field),Iu(e,t,this.field2),Iu(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return qke(this.styleOrigin,{portal:this.portal}).then(e=>{var r;const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const s=new wx({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new W3({value:i.name,symbol:s});t.push(n),this._valueInfoMap[i.name]=n}),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((r=this.uniqueValueInfos)==null?void 0:r.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",Xke)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[t.value+""]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Cre);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const r of e)t.push(se(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,s)=>{i!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(t,Cre)}}_watchUniqueValueGroups(){var t;this.removeHandles(Are);const{uniqueValueGroups:e}=this;if(e){const r=[];for(const i of e){r.push(se(()=>({classes:i.classes}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const s of(t=i.classes)!=null?t:[])r.push(se(()=>({symbol:s.symbol,values:s.values,label:s.label,description:s.description}),(n,o)=>{n!==o&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(r,Are)}}_updateInfosFromGroups(){var l;if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:r,field3:i,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!t&&!o)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!r);for(const c of n)for(const h of(l=c.classes)!=null?l:[]){const{symbol:p,label:f,values:m,description:y}=h;for(const _ of m!=null?m:[]){const{value:b,value2:x,value3:T}=_,S=[b];r&&S.push(x),i&&S.push(T);const C=a?S.join(s||""):S[0];e.push(new W3({symbol:p,label:f,value:C,description:y}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:r,valueExpression:i,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!t&&!i||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!t||!r),a=n.map(c=>{var x;const{symbol:h,label:p,value:f,description:m}=c,[y,_,b]=o?((x=f==null?void 0:f.toString())==null?void 0:x.split(s||""))||[]:[f];return new O_e({symbol:h,label:p,description:m,values:[new OS({value:y,value2:_,value3:b})]})}),l=[new fj({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=Pt(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let i;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(r[t]),s&&o.push(r[s]),n&&o.push(r[n]),i=o.join(this.fieldDelimiter||"")}else typeof t=="function"?i=t(e):t&&(i=r[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){const r=new FR(t&&t.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t&&t.portal||Uo.getDefault());const i=r.populateFromStyle();return i.catch(s=>{t0.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),i}static fromStyleUrl(e,t){const r=new FR(t&&t.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const i=r.populateFromStyle();return i.catch(s=>{t0.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),i}};u([d({readOnly:!0})],Gs.prototype,"_cache",null),u([ft({uniqueValue:"unique-value"})],Gs.prototype,"type",void 0),u([d(w_e)],Gs.prototype,"backgroundFillSymbol",void 0),u([d({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Gs.prototype,"field",null),u([zt("field")],Gs.prototype,"castField",null),u([Be("field")],Gs.prototype,"writeField",null),u([d({type:String,value:null,json:{write:!0}})],Gs.prototype,"field2",null),u([d({type:String,value:null,json:{write:!0}})],Gs.prototype,"field3",null),u([d({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],Gs.prototype,"orderByClassesEnabled",void 0),u([d({type:String,value:null,json:{write:!0}})],Gs.prototype,"valueExpression",null),u([d({type:String,json:{write:!0}})],Gs.prototype,"valueExpressionTitle",void 0),u([d({type:RS,json:{write:!0}})],Gs.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],Gs.prototype,"defaultLabel",void 0),u([d(hde({...CC},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Gs.prototype,"defaultSymbol",null),u([d({type:String,value:null,json:{write:!0}})],Gs.prototype,"fieldDelimiter",null),u([d({type:Uo,readOnly:!0})],Gs.prototype,"portal",void 0),u([De("portal",["styleName"])],Gs.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Gs.prototype,"styleOrigin",void 0),u([De("styleOrigin",["styleName","styleUrl"])],Gs.prototype,"readStyleOrigin",null),u([Be("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Gs.prototype,"writeStyleOrigin",null),u([d({type:[fj],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,r)=>(t.uniqueValueGroups||Zke(t)).map(i=>fj.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Gs.prototype,"uniqueValueGroups",null),u([d({type:[W3],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Gs.prototype,"uniqueValueInfos",null),Gs=FR=u([P(M_e)],Gs);const AP=Gs,$6={key:"type",base:My,typeMap:{heatmap:A_e,simple:AE,"unique-value":AP,"class-breaks":T_e,"dot-density":Mke,dictionary:Rke,"pie-chart":Fke},errorContext:"renderer"},Jke={key:"type",base:My,typeMap:{simple:AE,"unique-value":AP,"class-breaks":T_e,heatmap:A_e},errorContext:"renderer"},Qke=Pv({types:$6});function KF(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new Uu("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):Qke(e,t,r):null}class rZ{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(lz),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const r=new rZ,i=this._originStores[Hr.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,re(s),Hr.DEFAULTS)});for(let s=Hr.SERVICE;s<lz;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||r.set(a,re(o),s)})}return r}get(t,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(t):void 0}keys(t){const r=t==null?this._values:this._originStores[t];return r?[...r.keys()]:[]}set(t,r,i=Hr.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(t,r),!this._values.has(t)||this._propertyOriginMap.get(t)<=i){const n=this._values.get(t);return this._values.set(t,r),this._propertyOriginMap.set(t,i),n!==r}return!1}delete(t,r=Hr.USER){const i=this._originStores[r];if(!i)return;const s=i.get(t);if(i.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===r){this._values.delete(t);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(t)}revert(t,r){for(;r>0&&!this.has(t,r);)--r;const i=this._originStores[r],s=i&&i.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,r),n!==s}originOf(t){return this._propertyOriginMap.get(t)||Hr.DEFAULTS}forEach(t){this._values.forEach(t)}}const P_e=e=>{let t=class extends e{constructor(...r){super(...r);const i=al(this),s=i.store,n=new rZ;i.store=n,tpe(i,s,n)}read(r,i){ipe(this,r,i)}getAtOrigin(r,i){const s=Lk(this),n=P_(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return dF(this.originIdOf(r))}originIdOf(r){return Lk(this).originOf(r)}revert(r,i){const s=Lk(this),n=P_(i),o=al(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function Lk(e){return al(e).store}let Rre=class extends P_e(Te){};Rre=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],Rre);const Kke=e=>{let t=class extends e{constructor(...r){super(...r)}clear(r,i="user"){return Dk(this).delete(r,P_(i))}write(r={},i){return ope(this,r=r||{},i),r}setAtOrigin(r,i,s){al(this).setAtOrigin(r,i,P_(s))}removeOrigin(r){const i=Dk(this),s=P_(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),Hr.USER)}updateOrigin(r,i){const s=Dk(this),n=P_(i),o=this.get(r);for(let a=n+1;a<lz;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return t=u([P("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function Dk(e){return al(e).store}const iZ=e=>{let t=class extends Kke(P_e(e)){constructor(...r){super(...r)}};return t=u([P("esri.core.MultiOriginJSONSupport")],t),t};let gj=class extends iZ(Te){};gj=u([P("esri.core.MultiOriginJSONSupport")],gj);async function e9e(e,t){const{WhereClause:r}=await ie(()=>import("./WhereClause.7eef08f1.js").then(function(i){return i.W}),["assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js"]);return r.create(e,t)}function t9e(e,t){return v(e)?v(t)?`(${e}) AND (${t})`:e:t}var yj;let rb=yj=class extends fe{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new yj({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],rb.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],rb.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],rb.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],rb.prototype,"title",void 0),rb=yj=u([P("esri.form.ExpressionInfo")],rb);const r9e=rb;let ib=class extends fe{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],ib.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],ib.prototype,"label",void 0),u([d()],ib.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],ib.prototype,"visibilityExpression",void 0),ib=u([P("esri.form.elements.Element")],ib);const RE=ib;var _j;let qD=_j=class extends fe{constructor(e){super(e),this.type=null}clone(){return new _j({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],qD.prototype,"type",void 0),qD=_j=u([P("esri.form.elements.inputs.AttachmentInput")],qD);const i9e=qD;var vj;let sb=vj=class extends RE{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new vj({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],sb.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],sb.prototype,"editable",void 0),u([d({type:i9e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],sb.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],sb.prototype,"type",void 0),sb=vj=u([P("esri.form.elements.AttachmentElement")],sb);const Ore=sb;let WD=class extends fe{constructor(e){super(e),this.type=null}};u([d()],WD.prototype,"type",void 0),WD=u([P("esri.form.elements.inputs.Input")],WD);const AC=WD;let UR=class extends AC{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],UR.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],UR.prototype,"minLength",void 0),UR=u([P("esri.form.elements.inputs.TextInput")],UR);const sZ=UR;var bj;let XD=bj=class extends sZ{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new bj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],XD.prototype,"type",void 0),XD=bj=u([P("esri.form.elements.inputs.BarcodeScannerInput")],XD);const s9e=XD;var wj;let c2=wj=class extends AC{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new wj({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],c2.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],c2.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],c2.prototype,"type",void 0),c2=wj=u([P("esri.form.elements.inputs.ComboBoxInput")],c2);const n9e=c2;var xj;function Mre(e){return e!=null?new Date(e):null}function Pre(e){return e?e.getTime():null}let Fd=xj=class extends AC{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return Mre(t.max)}writeMax(e,t){t.max=Pre(e)}readMin(e,t){return Mre(t.min)}writeMin(e,t){t.min=Pre(e)}clone(){return new xj({includeTime:this.includeTime,max:this.max,min:this.min})}};u([d({type:Boolean,json:{write:!0}})],Fd.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],Fd.prototype,"max",void 0),u([De("max")],Fd.prototype,"readMax",null),u([Be("max")],Fd.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],Fd.prototype,"min",void 0),u([De("min")],Fd.prototype,"readMin",null),u([Be("min")],Fd.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],Fd.prototype,"type",void 0),Fd=xj=u([P("esri.form.elements.inputs.DateTimePickerInput")],Fd);const o9e=Fd;var Tj;let u2=Tj=class extends AC{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new Tj({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],u2.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],u2.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],u2.prototype,"type",void 0),u2=Tj=u([P("esri.form.elements.inputs.RadioButtonsInput")],u2);const a9e=u2;var Sj;let h2=Sj=class extends AC{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Sj({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],h2.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],h2.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],h2.prototype,"type",void 0),h2=Sj=u([P("esri.form.elements.inputs.SwitchInput")],h2);const l9e=h2;var Ej;let YD=Ej=class extends sZ{constructor(e){super(e),this.type="text-area"}clone(){return new Ej({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],YD.prototype,"type",void 0),YD=Ej=u([P("esri.form.elements.inputs.TextAreaInput")],YD);const c9e=YD;var Cj;let ZD=Cj=class extends sZ{constructor(e){super(e),this.type="text-box"}clone(){return new Cj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],ZD.prototype,"type",void 0),ZD=Cj=u([P("esri.form.elements.inputs.TextBoxInput")],ZD);const u9e=ZD,h9e={base:AC,key:"type",typeMap:{"barcode-scanner":s9e,"combo-box":n9e,"datetime-picker":o9e,"radio-buttons":a9e,switch:l9e,"text-area":c9e,"text-box":u9e}};var Aj;const I_e="esri.form.elements.FieldElement",Ire=ee.getLogger(I_e);let dh=Aj=class extends RE{constructor(e){super(e),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){var e;return JB(Ire,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),(e=this._get("editable"))!=null?e:!0}set editable(e){JB(Ire,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",e)}clone(){return new Aj({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:G0e,json:{read:{reader:UY},write:!0}})],dh.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],dh.prototype,"editable",null),u([d({type:String,json:{write:!0}})],dh.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],dh.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],dh.prototype,"hint",void 0),u([d({types:h9e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],dh.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],dh.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],dh.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],dh.prototype,"valueExpression",void 0),dh=Aj=u([P(I_e)],dh);const $re=dh;var Rj;let wg=Rj=class extends RE{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Rj({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:re(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],wg.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],wg.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],wg.prototype,"editable",void 0),u([d({type:[pX],json:{write:!0}})],wg.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],wg.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],wg.prototype,"type",void 0),wg=Rj=u([P("esri.form.elements.RelationshipElement")],wg);const Lre=wg;function $_e(e){return{typesWithGroup:{base:RE,key:"type",typeMap:{attachment:Ore,field:$re,group:e,relationship:Lre}},typesWithoutGroup:{base:RE,key:"type",typeMap:{attachment:Ore,field:$re,relationship:Lre}}}}function L_e(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>i[s.type]).map(s=>i[s.type].fromJSON(s))}function D_e(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>i[s.type]).map(s=>s.toJSON())}function N_e(e,t,r=!0){return e?e.map(i=>Op(r?t.typesWithGroup:t.typesWithoutGroup,i)):null}var Oj;let Uf=Oj=class extends RE{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return N_e(e,Nk,!1)}readElements(e,t){return L_e(t.formElements,Nk,!1)}writeElements(e,t){t.formElements=D_e(e,Nk,!1)}clone(){return new Oj({description:this.description,elements:re(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],Uf.prototype,"elements",void 0),u([zt("elements")],Uf.prototype,"castElements",null),u([De("elements",["formElements"])],Uf.prototype,"readElements",null),u([Be("elements")],Uf.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],Uf.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],Uf.prototype,"type",void 0),Uf=Oj=u([P("esri.form.elements.GroupElement")],Uf);const Nk=$_e(Uf),d9e=Uf;var Mj;const Fk=$_e(d9e);let Ud=Mj=class extends fe{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(e){return N_e(e,Fk)}readElements(e,t){return L_e(t.formElements,Fk)}writeElements(e,t){t.formElements=D_e(e,Fk)}clone(){return new Mj({description:this.description,expressionInfos:re(this.expressionInfos),elements:re(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([d({type:String,json:{write:!0}})],Ud.prototype,"description",void 0),u([d({json:{write:!0}})],Ud.prototype,"elements",void 0),u([zt("elements")],Ud.prototype,"castElements",null),u([De("elements",["formElements"])],Ud.prototype,"readElements",null),u([Be("elements")],Ud.prototype,"writeElements",null),u([d({type:[r9e],json:{write:!0}})],Ud.prototype,"expressionInfos",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Ud.prototype,"preserveFieldValuesWhenHidden",void 0),u([d({type:String,json:{write:!0}})],Ud.prototype,"title",void 0),Ud=Mj=u([P("esri.form.FormTemplate")],Ud);const p9e=Ud;async function f9e(e){const t="portalItem"in e?e:{portalItem:e},r=await ie(()=>import("./portalLayers.c475d6b2.js"),["assets/portalLayers.c475d6b2.js","assets/lazyLayerLoader.8af10eca.js","assets/layersLoader.b6701a4d.js","assets/fetchService.d8bf9569.js","assets/jsonContext.fc22b0d2.js"]);try{return await r.fromItem(t)}catch(i){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||ni.portalUrl;throw ee.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let m9e=0,Ao=class extends Vs.EventedMixin(cP(Tm)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new qr(-180,-90,180,90,Ye.WGS84),this.id=Date.now().toString(16)+"-layer-"+m9e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ye.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await ie(()=>import("./arcgisLayers.38748f41.js"),["assets/arcgisLayers.38748f41.js","assets/fetchService.d8bf9569.js","assets/lazyLayerLoader.8af10eca.js"])).fromUrl(t)}static fromPortalItem(e){return f9e(e)}initialize(){this.when().catch(e=>{var t,r;sn(e)||ee.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(r=this.id)!=null?r:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return po(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Di(e,{query:{f:"json"},responseType:"json"})).data;throw new j("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],Ao.prototype,"attributionDataUrl",void 0),u([d({type:qr})],Ao.prototype,"fullExtent",void 0),u([d({readOnly:!0})],Ao.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],Ao.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],Ao.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],Ao.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],Ao.prototype,"opacity",void 0),u([d({clonable:!1})],Ao.prototype,"parent",void 0),u([d({readOnly:!0})],Ao.prototype,"parsedUrl",null),u([d({type:Boolean})],Ao.prototype,"popupEnabled",void 0),u([d({type:Boolean})],Ao.prototype,"attributionVisible",void 0),u([d({type:Ye})],Ao.prototype,"spatialReference",void 0),u([d({type:String})],Ao.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],Ao.prototype,"type",void 0),u([d()],Ao.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],Ao.prototype,"visible",void 0),Ao=u([P("esri.layers.Layer")],Ao);const ZO=Ao;function Dre(e,t,r){if(e.hasM==null||e.hasZ)for(const i of t)for(const s of i)s.length>2&&(s[2]*=r)}function g9e(e,t,r){if(!e&&!t||!r)return;const i=Rw(r);Nre(e,r,i),Nre(t,r,i)}function Nre(e,t,r){if(e)for(const i of e)y9e(i.geometry,t,r)}function y9e(e,t,r){if(E(e)||!e.spatialReference||Pn(e.spatialReference,t))return;const i=Rw(e.spatialReference)/r;if(i!==1){if("x"in e)e.z!=null&&(e.z*=i);else if("rings"in e)Dre(e,e.rings,i);else if("paths"in e)Dre(e,e.paths,i);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=i)}}let _9e=0;const F_e="esri.layers.graphics.sources.MemorySource",Uk=ee.getLogger(F_e);let Dg=class extends Tm.LoadableMixin(fP(xx(pt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=v(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);LG(e,this.layer.spatialReference,r);const i=BY.fromJSON(r);if(!this._requiresClientGraphicMapping())return i;const s=this.layer.objectIdField;for(const n of i.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return i.geometryType=this.layer.geometryType,i}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new j("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return LG(e,this.layer.spatialReference,r),r}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(r=>({count:r.count,extent:qr.fromJSON(r.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new j("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let r=null;const i=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&i.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}g9e(r?r.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:s,deletes:i});return this.fullExtent=a,r&&r.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this._layerOrSourceGeometryType!=="mesh"||E(e))return;const r=[];for(const{geometry:i}of e)!v(i)||i.type!=="mesh"||i.hasExtent||i.loaded||r.push(i.load({signal:t}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const r of t.updateResults){if(!r.success)continue;const i=e.get(r.objectId);i!=null&&this._addIdToClientGraphic(i)}for(const r of t.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new j("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,r=new Array(e.length);let i=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!i&&v(o.geometry)&&(i=o.geometry.type),r[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:r,inferredGeometryType:i,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[t];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,t,r;return(r=(e=this.layer)==null?void 0:e.geometryType)!=null?r:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e),i=(_9e++).toString();return r?{uid:i,geometry:r.toJSON(),attributes:t}:{uid:i,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return E(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?Pp.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await Mme("MemorySourceWorker",{strategy:de("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:r,objectIdField:i,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{Uk.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:ZK.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&s,hasZ:this._layerOrSourceGeometryType==="mesh"||n,objectIdField:i,spatialReference:a?null:r&&r.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const f of h.warnings)Uk.warn(f.message,{layer:this.layer,warning:f});h.featureErrors.length&&Uk.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=ZK.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([oX({Type:Aa,ensureType:Us(Aa)})],Dg.prototype,"itemType",void 0),u([d()],Dg.prototype,"type",void 0),u([d({constructOnly:!0})],Dg.prototype,"layer",void 0),u([d({readOnly:!0})],Dg.prototype,"_workerGeometryType",null),u([d()],Dg.prototype,"sourceJSON",void 0),Dg=u([P(F_e)],Dg);function v9e(e){return"portalItem"in e}const b9e=e=>{let t=class extends e{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):v9e(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],t.prototype,"apiKey",null),t=u([P("esri.layers.mixins.APIKeyMixin")],t),t},U_e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},k_e=Object.values(U_e),V_e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${k_e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),w9e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${k_e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),x9e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function n2t(e){return!!V_e.test(e)}function RC(e){if(E(e))return null;const t=po(e),r=t.path.match(V_e)||t.path.match(w9e);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:nZ(a!==-1?s.slice(a+1):s),serverType:U_e[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function T9e(e){const t=po(e).path.match(x9e);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function nZ(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function S9e(e,t){const r=[];if(e){const i=RC(e);v(i)&&i.title&&r.push(i.title)}if(t){const i=nZ(t);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function B_e(e){if(!e)return!1;const t=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(r)||e.includes(i)||e.includes(s);return n&&o}function E9e(e,t){return e&&Hfe(Wfe(e,t))}function C9e(e){let{url:t}=e;if(!t)return{url:t};t=Wfe(t,e.logger);const r=po(t),i=RC(r.path);let s;if(v(i))i.sublayer!=null&&e.layer.layerId==null&&(s=i.sublayer),t=i.url.path;else if(e.nonStandardUrlAllowed){const n=T9e(r.path);v(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:Hfe(t),layerId:s}}function A9e(e,t,r,i,s){pv(t,i,"url",s),i.url&&e.layerId!=null&&(i.url=ku(i.url,r,e.layerId.toString()))}function o2t(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),i=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return r&&(i||s||n)}const R9e=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=RC(this.url);if(v(r)&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",E9e(r,ee.getLogger(this.declaredClass)))}};return u([d()],t.prototype,"title",null),u([d({type:String})],t.prototype,"url",null),t=u([P("esri.layers.mixins.ArcGISService")],t),t},Fre={read:{reader:DY},write:{allowNull:!0,writer:NY}},O9e=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":Fre,"portal-item":Fre}}})],t.prototype,"effect",void 0),t=u([P("esri.layers.mixins.BlendLayer")],t),t},M9e=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([P("esri.layers.mixins.CustomParametersMixin")],t),t},P9e=new Vs.EventEmitter,z_e="esri.layers.mixins.EditBusLayer",G_e=Symbol(z_e);function a2t(e){return e!=null&&typeof e=="object"&&G_e in e}const I9e=e=>{var t;let r=class extends e{constructor(...i){super(...i),this[t]=!0,this.when().then(()=>{this.own([P9e.on("edits",s=>{var h,p,f;const n="layer"in s?s.layer:null,o="layer"in s?(h=s.layer)==null?void 0:h.url:s.serviceUrl,a="layer"in s?(p=s.layer)==null?void 0:p.layerId:s.layerId,l=s.event;if(n===this||o!==this.url)return;if(a!=null&&this.layerId!=null&&a===this.layerId)return void this.emit("edits",re(l));const c=(f=l.editedFeatures)==null?void 0:f.find(({layerId:m})=>m===this.layerId);if(c){const{adds:m,updates:y,deletes:_}=c.editedFeatures,b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:m?m.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],deletedFeatures:_?_.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],updatedFeatures:y?y.map(({current:{attributes:x}})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],editedFeatures:re(l.editedFeatures),exceededTransferLimit:!1};this.emit("edits",b)}})])},()=>{})}};return t=G_e,r=u([P(z_e)],r),r};var Pj;const kk=new Vr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Vk=new Vr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let bf=Pj=class extends fe{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new cm({geometry:re(r),objectIds:re(n),spatialRelationship:i,timeExtent:re(s),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,timeExtent:i,objectIds:s,units:n,distance:o}=this;return new Pj({geometry:re(t),objectIds:re(s),spatialRelationship:r,timeExtent:re(i),where:e,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],bf.prototype,"where",void 0),u([d({types:yx,json:{write:!0}})],bf.prototype,"geometry",void 0),u([d({type:kk.apiValues,json:{name:"spatialRel",read:{reader:kk.read},write:{allowNull:!1,writer:kk.write,overridePolicy(){return{enabled:v(this.geometry)}}}}})],bf.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],bf.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],bf.prototype,"objectIds",void 0),u([d({type:Vk.apiValues,json:{read:Vk.read,write:{writer:Vk.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],bf.prototype,"units",void 0),u([d({type:Lm,json:{write:!0}})],bf.prototype,"timeExtent",void 0),bf=Pj=u([P("esri.layers.support.FeatureFilter")],bf);const $9e=bf;var Ij;const Ure={read:{reader:DY},write:{writer:NY,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},kre={read:{reader:DY},write:{writer:NY,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Vre={name:"showExcludedLabels",default:!0};let nb=Ij=class extends fe{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var i,s;const r=super.write(e,t);if(t!=null&&t.origin){if(r.filter){const n=Object.keys(r.filter);if(n.length>1||n[0]!=="where")return(i=t.messages)==null||i.push(new j("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in r)return(s=t.messages)==null||s.push(new j("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return r}clone(){return new Ij({filter:v(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:$9e,json:{write:{allowNull:!0,writer(e,t,r,i){const s=e==null?void 0:e.write({},i);s&&Object.keys(s).length!==0?ol(r,s,t):ol(r,null,t)}}}})],nb.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":Ure,"portal-item":Ure}}})],nb.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":kre,"portal-item":kre}}})],nb.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Vre,"portal-item":Vre}}})],nb.prototype,"excludedLabelsVisible",void 0),nb=Ij=u([P("esri.layers.support.FeatureEffect")],nb);const L9e=nb,Bre={write:{allowNull:!0}},D9e=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:L9e,json:{origins:{"web-map":Bre,"portal-item":Bre}}})],t.prototype,"featureEffect",void 0),t=u([P("esri.layers.mixins.FeatureEffectLayer")],t),t};function N9e(e){if(!e)return e;const{start:t,end:r}=e;return new Lm({start:v(t)?fw(t,-t.getTimezoneOffset(),"minutes"):t,end:v(r)?fw(r,-r.getTimezoneOffset(),"minutes"):r})}function F9e(e){if(!e)return e;const{start:t,end:r}=e;return new Lm({start:v(t)?fw(t,t.getTimezoneOffset(),"minutes"):t,end:v(r)?fw(r,r.getTimezoneOffset(),"minutes"):r})}var $j;let kR=$j=class extends fe{constructor(e){super(e)}async collectRequiredFields(e,t){return Xl(e,t,this.expression)}clone(){return new $j({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([d({type:String,json:{write:!0}})],kR.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],kR.prototype,"title",void 0),kR=$j=u([P("esri.layers.support.FeatureExpressionInfo")],kR);const zre=kR;function U9e(e){return!!e&&CE[e]!=null}function k9e(e){return 1/(CE[e]||1)}function V9e(){const e=Object.keys(CE);return e.sort(),e}const B9e=V9e();var Lj;const HI=Ia()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Gre=new Vr({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let xg=Lj=class extends fe{constructor(e){super(e),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,i){t[r]=e.write({},i),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):v(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new Lj({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&KCe(this.featureExpressionInfo,e.featureExpressionInfo)}};u([d({type:zre,json:{write:!0}})],xg.prototype,"featureExpressionInfo",void 0),u([De("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],xg.prototype,"readFeatureExpressionInfo",null),u([Be("featureExpressionInfo",{featureExpressionInfo:{type:zre},"featureExpression.value":{type:[0]}})],xg.prototype,"writeFeatureExpressionInfo",null),u([d({type:HI.apiValues,nonNullable:!0,json:{type:HI.jsonValues,read:HI.read,write:{writer:HI.write,isRequired:!0}}})],xg.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],xg.prototype,"offset",void 0),u([d({type:B9e,json:{type:String,read:Gre.read,write:Gre.write}})],xg.prototype,"unit",null),xg=Lj=u([P("esri.layers.support.ElevationInfo")],xg);const z9e=xg,G9e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},oZ={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},aZ={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},j9e={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:pv}}},H9e={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},q9e={value:null,type:z9e,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function l2t(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const j_e={write:!0,read:!0},Dj={type:Number,json:{origins:{"web-document":j_e,"portal-item":{write:!0}}}},W9e={...Dj,json:{...Dj.json,origins:{"web-document":{...j_e,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&r.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?hE(t.layerDefinition.drawingInfo.transparency):void 0:hE(t.drawingInfo.transparency)}}},c2t={type:Lm,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=F9e(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=N9e(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},u2t={type:qr,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const r=qr.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(r.spatialReference=Ye.fromJSON(t.spatialReference)),r}}}},read:!1}},X9e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},Y9e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},Z9e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},H_e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},jre=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Chihuahua"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class Cx extends Error{}class J9e extends Cx{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class Q9e extends Cx{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class K9e extends Cx{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class VR extends Cx{}class q_e extends Cx{constructor(t){super(`Invalid unit ${t}`)}}class Ih extends Cx{}class r0 extends Cx{constructor(){super("Zone is an abstract class")}}const it="numeric",Dp="short",Du="long",e4={year:it,month:it,day:it},W_e={year:it,month:Dp,day:it},eVe={year:it,month:Dp,day:it,weekday:Dp},X_e={year:it,month:Du,day:it},Y_e={year:it,month:Du,day:it,weekday:Du},Z_e={hour:it,minute:it},J_e={hour:it,minute:it,second:it},Q_e={hour:it,minute:it,second:it,timeZoneName:Dp},K_e={hour:it,minute:it,second:it,timeZoneName:Du},eve={hour:it,minute:it,hourCycle:"h23"},tve={hour:it,minute:it,second:it,hourCycle:"h23"},rve={hour:it,minute:it,second:it,hourCycle:"h23",timeZoneName:Dp},ive={hour:it,minute:it,second:it,hourCycle:"h23",timeZoneName:Du},sve={year:it,month:it,day:it,hour:it,minute:it},nve={year:it,month:it,day:it,hour:it,minute:it,second:it},ove={year:it,month:Dp,day:it,hour:it,minute:it},ave={year:it,month:Dp,day:it,hour:it,minute:it,second:it},tVe={year:it,month:Dp,day:it,weekday:Dp,hour:it,minute:it},lve={year:it,month:Du,day:it,hour:it,minute:it,timeZoneName:Dp},cve={year:it,month:Du,day:it,hour:it,minute:it,second:it,timeZoneName:Dp},uve={year:it,month:Du,day:it,weekday:Du,hour:it,minute:it,timeZoneName:Du},hve={year:it,month:Du,day:it,weekday:Du,hour:it,minute:it,second:it,timeZoneName:Du};class RP{get type(){throw new r0}get name(){throw new r0}get ianaName(){return this.name}get isUniversal(){throw new r0}offsetName(t,r){throw new r0}formatOffset(t,r){throw new r0}offset(t){throw new r0}equals(t){throw new r0}get isValid(){throw new r0}}let Bk=null;class L6 extends RP{static get instance(){return Bk===null&&(Bk=new L6),Bk}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return pve(t,r,i)}formatOffset(t,r){return Y3(this.offset(t),r)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let JD={};function rVe(e){return JD[e]||(JD[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),JD[e]}const iVe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function sVe(e,t){const r=e.format(t).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,h]=i;return[o,s,n,a,l,c,h]}function nVe(e,t){const r=e.formatToParts(t),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=iVe[n];n==="era"?i[a]=o:bi(a)||(i[a]=parseInt(o,10))}return i}let qI={};class _y extends RP{static create(t){return qI[t]||(qI[t]=new _y(t)),qI[t]}static resetCache(){qI={},JD={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=_y.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return pve(t,r,i,this.name)}formatOffset(t,r){return Y3(this.offset(t),r)}offset(t){const r=new Date(t);if(isNaN(r))return NaN;const i=rVe(this.name);let[s,n,o,a,l,c,h]=i.formatToParts?nVe(i,r):sVe(i,r);a==="BC"&&(s=-Math.abs(s)+1);const f=uZ({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+r;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let Hre={};function oVe(e,t={}){const r=JSON.stringify([e,t]);let i=Hre[r];return i||(i=new Intl.ListFormat(e,t),Hre[r]=i),i}let Nj={};function Fj(e,t={}){const r=JSON.stringify([e,t]);let i=Nj[r];return i||(i=new Intl.DateTimeFormat(e,t),Nj[r]=i),i}let Uj={};function aVe(e,t={}){const r=JSON.stringify([e,t]);let i=Uj[r];return i||(i=new Intl.NumberFormat(e,t),Uj[r]=i),i}let kj={};function lVe(e,t={}){const{base:r,...i}=t,s=JSON.stringify([e,i]);let n=kj[s];return n||(n=new Intl.RelativeTimeFormat(e,t),kj[s]=n),n}let BR=null;function cVe(){return BR||(BR=new Intl.DateTimeFormat().resolvedOptions().locale,BR)}function uVe(e){const t=e.indexOf("-x-");t!==-1&&(e=e.substring(0,t));const r=e.indexOf("-u-");if(r===-1)return[e];{let i,s;try{i=Fj(e).resolvedOptions(),s=e}catch{const l=e.substring(0,r);i=Fj(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=i;return[s,n,o]}}function hVe(e,t,r){return(r||t)&&(e.includes("-u-")||(e+="-u"),r&&(e+=`-ca-${r}`),t&&(e+=`-nu-${t}`)),e}function dVe(e){const t=[];for(let r=1;r<=12;r++){const i=Ar.utc(2016,r,1);t.push(e(i))}return t}function pVe(e){const t=[];for(let r=1;r<=7;r++){const i=Ar.utc(2016,11,13+r);t.push(e(i))}return t}function WI(e,t,r,i,s){const n=e.listingMode(r);return n==="error"?null:n==="en"?i(t):s(t)}function fVe(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class mVe{constructor(t,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=aVe(t,a)}}format(t){if(this.inf){const r=this.floor?Math.floor(t):t;return this.inf.format(r)}else{const r=this.floor?Math.floor(t):cZ(t,3);return oo(r,this.padTo)}}}class gVe{constructor(t,r,i){this.opts=i;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&_y.create(a).valid?(s=a,this.dt=t):(s="UTC",i.timeZoneName?this.dt=t:this.dt=t.offset===0?t:Ar.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=Fj(r,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class yVe{constructor(t,r,i){this.opts={style:"long",...i},!r&&dve()&&(this.rtf=lVe(t,i))}format(t,r){return this.rtf?this.rtf.format(t,r):LVe(r,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,r){return this.rtf?this.rtf.formatToParts(t,r):[]}}class Ws{static fromOpts(t){return Ws.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,r,i,s=!1){const n=t||so.defaultLocale,o=n||(s?"en-US":cVe()),a=r||so.defaultNumberingSystem,l=i||so.defaultOutputCalendar;return new Ws(o,a,l,n)}static resetCache(){BR=null,Nj={},Uj={},kj={}}static fromObject({locale:t,numberingSystem:r,outputCalendar:i}={}){return Ws.create(t,r,i)}constructor(t,r,i,s){const[n,o,a]=uVe(t);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=hVe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=fVe(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&r?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Ws.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,r=!1,i=!0){return WI(this,t,i,gve,()=>{const s=r?{month:t,day:"numeric"}:{month:t},n=r?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=dVe(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,r=!1,i=!0){return WI(this,t,i,vve,()=>{const s=r?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=r?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=pVe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return WI(this,void 0,t,()=>bve,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ar.utc(2016,11,13,9),Ar.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(t,r=!0){return WI(this,t,r,wve,()=>{const i={era:t};return this.eraCache[t]||(this.eraCache[t]=[Ar.utc(-40,1,1),Ar.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[t]})}extract(t,r,i){const s=this.dtFormatter(t,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(t={}){return new mVe(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,r={}){return new gVe(t,this.intl,r)}relFormatter(t={}){return new yVe(this.intl,this.isEnglish(),t)}listFormatter(t={}){return oVe(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}let zk=null;class tl extends RP{static get utcInstance(){return zk===null&&(zk=new tl(0)),zk}static instance(t){return t===0?tl.utcInstance:new tl(t)}static parseSpecifier(t){if(t){const r=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new tl(N6(r[1],r[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${Y3(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${Y3(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,r){return Y3(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class _Ve extends RP{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function T_(e,t){if(bi(e)||e===null)return t;if(e instanceof RP)return e;if(vVe(e)){const r=e.toLowerCase();return r==="default"?t:r==="local"||r==="system"?L6.instance:r==="utc"||r==="gmt"?tl.utcInstance:tl.parseSpecifier(r)||_y.create(e)}else return mw(e)?tl.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new _Ve(e)}let qre=()=>Date.now(),Wre="system",Xre=null,Yre=null,Zre=null,Jre=60,Qre;class so{static get now(){return qre}static set now(t){qre=t}static set defaultZone(t){Wre=t}static get defaultZone(){return T_(Wre,L6.instance)}static get defaultLocale(){return Xre}static set defaultLocale(t){Xre=t}static get defaultNumberingSystem(){return Yre}static set defaultNumberingSystem(t){Yre=t}static get defaultOutputCalendar(){return Zre}static set defaultOutputCalendar(t){Zre=t}static get twoDigitCutoffYear(){return Jre}static set twoDigitCutoffYear(t){Jre=t%100}static get throwOnInvalid(){return Qre}static set throwOnInvalid(t){Qre=t}static resetCaches(){Ws.resetCache(),_y.resetCache()}}function bi(e){return typeof e=="undefined"}function mw(e){return typeof e=="number"}function D6(e){return typeof e=="number"&&e%1===0}function vVe(e){return typeof e=="string"}function bVe(e){return Object.prototype.toString.call(e)==="[object Date]"}function dve(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch{return!1}}function wVe(e){return Array.isArray(e)?e:[e]}function Kre(e,t,r){if(e.length!==0)return e.reduce((i,s)=>{const n=[t(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function xVe(e,t){return t.reduce((r,i)=>(r[i]=e[i],r),{})}function OE(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Zg(e,t,r){return D6(e)&&e>=t&&e<=r}function TVe(e,t){return e-t*Math.floor(e/t)}function oo(e,t=2){const r=e<0;let i;return r?i="-"+(""+-e).padStart(t,"0"):i=(""+e).padStart(t,"0"),i}function m_(e){if(!(bi(e)||e===null||e===""))return parseInt(e,10)}function Yv(e){if(!(bi(e)||e===null||e===""))return parseFloat(e)}function lZ(e){if(!(bi(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function cZ(e,t,r=!1){const i=10**t;return(r?Math.trunc:Math.round)(e*i)/i}function OP(e){return e%4===0&&(e%100!==0||e%400===0)}function X3(e){return OP(e)?366:365}function t4(e,t){const r=TVe(t-1,12)+1,i=e+(t-r)/12;return r===2?OP(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function uZ(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function r4(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,r=e-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return t===4||i===3?53:52}function Vj(e){return e>99?e:e>so.twoDigitCutoffYear?1900+e:2e3+e}function pve(e,t,r,i=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:t,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function N6(e,t){let r=parseInt(e,10);Number.isNaN(r)&&(r=0);const i=parseInt(t,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function fve(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new Ih(`Invalid unit value ${e}`);return t}function i4(e,t){const r={};for(const i in e)if(OE(e,i)){const s=e[i];if(s==null)continue;r[t(i)]=fve(s)}return r}function Y3(e,t){const r=Math.trunc(Math.abs(e/60)),i=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${oo(r,2)}:${oo(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${oo(r,2)}${oo(i,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function F6(e){return xVe(e,["hour","minute","second","millisecond"])}const SVe=["January","February","March","April","May","June","July","August","September","October","November","December"],mve=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],EVe=["J","F","M","A","M","J","J","A","S","O","N","D"];function gve(e){switch(e){case"narrow":return[...EVe];case"short":return[...mve];case"long":return[...SVe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const yve=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],_ve=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],CVe=["M","T","W","T","F","S","S"];function vve(e){switch(e){case"narrow":return[...CVe];case"short":return[..._ve];case"long":return[...yve];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const bve=["AM","PM"],AVe=["Before Christ","Anno Domini"],RVe=["BC","AD"],OVe=["B","A"];function wve(e){switch(e){case"narrow":return[...OVe];case"short":return[...RVe];case"long":return[...AVe];default:return null}}function MVe(e){return bve[e.hour<12?0:1]}function PVe(e,t){return vve(t)[e.weekday-1]}function IVe(e,t){return gve(t)[e.month-1]}function $Ve(e,t){return wve(t)[e.year<0?0:1]}function LVe(e,t,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(r==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=i?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function eie(e,t){let r="";for(const i of e)i.literal?r+=i.val:r+=t(i.val);return r}const DVe={D:e4,DD:W_e,DDD:X_e,DDDD:Y_e,t:Z_e,tt:J_e,ttt:Q_e,tttt:K_e,T:eve,TT:tve,TTT:rve,TTTT:ive,f:sve,ff:ove,fff:lve,ffff:uve,F:nve,FF:ave,FFF:cve,FFFF:hve};class Qa{static create(t,r={}){return new Qa(t,r)}static parseFormat(t){let r=null,i="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(i.length>0&&n.push({literal:s,val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:!1,val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s,val:i}),n}static macroTokenToFormatOpts(t){return DVe[t]}constructor(t,r){this.opts=r,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTime(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTimeParts(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).formatToParts()}formatInterval(t,r={}){return this.loc.dtFormatter(t.start,{...this.opts,...r}).dtf.formatRange(t.start.toJSDate(),t.end.toJSDate())}resolvedOptions(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).resolvedOptions()}num(t,r=0){if(this.opts.forceSimple)return oo(t,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(t)}formatDateTimeFromString(t,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(t,m,y),o=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",a=()=>i?MVe(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>i?IVe(t,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>i?PVe(t,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=Qa.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(t,y):m},p=m=>i?$Ve(t,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(m)}};return eie(Qa.parseFormat(r),f)}formatDurationFromString(t,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=i(c);return h?this.num(l.get(h),c.length):c},n=Qa.parseFormat(r),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(i).filter(l=>l));return eie(n,s(a))}}class mp{constructor(t,r){this.reason=t,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const xve=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function OC(...e){const t=e.reduce((r,i)=>r+i.source,"");return RegExp(`^${t}$`)}function MC(...e){return t=>e.reduce(([r,i,s],n)=>{const[o,a,l]=n(t,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function PC(e,...t){if(e==null)return[null,null];for(const[r,i]of t){const s=r.exec(e);if(s)return i(s)}return[null,null]}function Tve(...e){return(t,r)=>{const i={};let s;for(s=0;s<e.length;s++)i[e[s]]=m_(t[r+s]);return[i,null,r+s]}}const Sve=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,NVe=`(?:${Sve.source}?(?:\\[(${xve.source})\\])?)?`,hZ=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Eve=RegExp(`${hZ.source}${NVe}`),dZ=RegExp(`(?:T${Eve.source})?`),FVe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,UVe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,kVe=/(\d{4})-?(\d{3})/,VVe=Tve("weekYear","weekNumber","weekDay"),BVe=Tve("year","ordinal"),zVe=/(\d{4})-(\d\d)-(\d\d)/,Cve=RegExp(`${hZ.source} ?(?:${Sve.source}|(${xve.source}))?`),GVe=RegExp(`(?: ${Cve.source})?`);function MS(e,t,r){const i=e[t];return bi(i)?r:m_(i)}function jVe(e,t){return[{year:MS(e,t),month:MS(e,t+1,1),day:MS(e,t+2,1)},null,t+3]}function IC(e,t){return[{hours:MS(e,t,0),minutes:MS(e,t+1,0),seconds:MS(e,t+2,0),milliseconds:lZ(e[t+3])},null,t+4]}function MP(e,t){const r=!e[t]&&!e[t+1],i=N6(e[t+1],e[t+2]),s=r?null:tl.instance(i);return[{},s,t+3]}function PP(e,t){const r=e[t]?_y.create(e[t]):null;return[{},r,t+1]}const HVe=RegExp(`^T?${hZ.source}$`),qVe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function WVe(e){const[t,r,i,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(Yv(r)),months:f(Yv(i)),weeks:f(Yv(s)),days:f(Yv(n)),hours:f(Yv(o)),minutes:f(Yv(a)),seconds:f(Yv(l),l==="-0"),milliseconds:f(lZ(c),p)}]}const XVe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function pZ(e,t,r,i,s,n,o){const a={year:t.length===2?Vj(m_(t)):m_(t),month:mve.indexOf(r)+1,day:m_(i),hour:m_(s),minute:m_(n)};return o&&(a.second=m_(o)),e&&(a.weekday=e.length>3?yve.indexOf(e)+1:_ve.indexOf(e)+1),a}const YVe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function ZVe(e){const[,t,r,i,s,n,o,a,l,c,h,p]=e,f=pZ(t,s,i,r,n,o,a);let m;return l?m=XVe[l]:c?m=0:m=N6(h,p),[f,new tl(m)]}function JVe(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const QVe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,KVe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,eBe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function tie(e){const[,t,r,i,s,n,o,a]=e;return[pZ(t,s,i,r,n,o,a),tl.utcInstance]}function tBe(e){const[,t,r,i,s,n,o,a]=e;return[pZ(t,a,r,i,s,n,o),tl.utcInstance]}const rBe=OC(FVe,dZ),iBe=OC(UVe,dZ),sBe=OC(kVe,dZ),nBe=OC(Eve),Ave=MC(jVe,IC,MP,PP),oBe=MC(VVe,IC,MP,PP),aBe=MC(BVe,IC,MP,PP),lBe=MC(IC,MP,PP);function cBe(e){return PC(e,[rBe,Ave],[iBe,oBe],[sBe,aBe],[nBe,lBe])}function uBe(e){return PC(JVe(e),[YVe,ZVe])}function hBe(e){return PC(e,[QVe,tie],[KVe,tie],[eBe,tBe])}function dBe(e){return PC(e,[qVe,WVe])}const pBe=MC(IC);function fBe(e){return PC(e,[HVe,pBe])}const mBe=OC(zVe,GVe),gBe=OC(Cve),yBe=MC(IC,MP,PP);function _Be(e){return PC(e,[mBe,Ave],[gBe,yBe])}const vBe="Invalid Duration",Rve={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},bBe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Rve},Zu=146097/400,kx=146097/4800,wBe={years:{quarters:4,months:12,weeks:Zu/7,days:Zu,hours:Zu*24,minutes:Zu*24*60,seconds:Zu*24*60*60,milliseconds:Zu*24*60*60*1e3},quarters:{months:3,weeks:Zu/28,days:Zu/4,hours:Zu*24/4,minutes:Zu*24*60/4,seconds:Zu*24*60*60/4,milliseconds:Zu*24*60*60*1e3/4},months:{weeks:kx/7,days:kx,hours:kx*24,minutes:kx*24*60,seconds:kx*24*60*60,milliseconds:kx*24*60*60*1e3},...Rve},ob=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],xBe=ob.slice(0).reverse();function i0(e,t,r=!1){const i={values:r?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new Ti(i)}function TBe(e){return e<0?Math.floor(e):Math.ceil(e)}function Ove(e,t,r,i,s){const n=e[s][r],o=t[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?TBe(o):Math.trunc(o);i[s]+=l,t[r]-=l*n}function SBe(e,t){xBe.reduce((r,i)=>bi(t[i])?r:(r&&Ove(e,t,r,t,i),i),null)}function EBe(e){const t={};for(const[r,i]of Object.entries(e))i!==0&&(t[r]=i);return t}class Ti{constructor(t){const r=t.conversionAccuracy==="longterm"||!1;let i=r?wBe:bBe;t.matrix&&(i=t.matrix),this.values=t.values,this.loc=t.loc||Ws.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(t,r){return Ti.fromObject({milliseconds:t},r)}static fromObject(t,r={}){if(t==null||typeof t!="object")throw new Ih(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new Ti({values:i4(t,Ti.normalizeUnit),loc:Ws.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(t){if(mw(t))return Ti.fromMillis(t);if(Ti.isDuration(t))return t;if(typeof t=="object")return Ti.fromObject(t);throw new Ih(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,r){const[i]=dBe(t);return i?Ti.fromObject(i,r):Ti.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,r){const[i]=fBe(t);return i?Ti.fromObject(i,r):Ti.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,r=null){if(!t)throw new Ih("need to specify a reason the Duration is invalid");const i=t instanceof mp?t:new mp(t,r);if(so.throwOnInvalid)throw new K9e(i);return new Ti({invalid:i})}static normalizeUnit(t){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!r)throw new q_e(t);return r}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Qa.create(this.loc,i).formatDurationFromString(this,t):vBe}toHuman(t={}){const r=ob.map(i=>{const s=this.values[i];return bi(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=cZ(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const r=Ti.fromDurationLike(t),i={};for(const s of ob)(OE(r.values,s)||OE(this.values,s))&&(i[s]=r.get(s)+this.get(s));return i0(this,{values:i},!0)}minus(t){if(!this.isValid)return this;const r=Ti.fromDurationLike(t);return this.plus(r.negate())}mapUnits(t){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=fve(t(this.values[i],i));return i0(this,{values:r},!0)}get(t){return this[Ti.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const r={...this.values,...i4(t,Ti.normalizeUnit)};return i0(this,{values:r})}reconfigure({locale:t,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:t,numberingSystem:r}),matrix:s,conversionAccuracy:i};return i0(this,o)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return SBe(this.matrix,t),i0(this,{values:t},!0)}rescale(){if(!this.isValid)return this;const t=EBe(this.normalize().shiftToAll().toObject());return i0(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>Ti.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of ob)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;mw(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)ob.indexOf(c)>ob.indexOf(o)&&Ove(this.matrix,s,c,r,o)}else mw(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return i0(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const t={};for(const r of Object.keys(this.values))t[r]=this.values[r]===0?0:-this.values[r];return i0(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of ob)if(!r(this.values[i],t.values[i]))return!1;return!0}}const Vx="Invalid Interval";function CBe(e,t){return!e||!e.isValid?_n.invalid("missing or invalid start"):!t||!t.isValid?_n.invalid("missing or invalid end"):t<e?_n.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class _n{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,r=null){if(!t)throw new Ih("need to specify a reason the Interval is invalid");const i=t instanceof mp?t:new mp(t,r);if(so.throwOnInvalid)throw new Q9e(i);return new _n({invalid:i})}static fromDateTimes(t,r){const i=uA(t),s=uA(r),n=CBe(i,s);return n==null?new _n({start:i,end:s}):n}static after(t,r){const i=Ti.fromDurationLike(r),s=uA(t);return _n.fromDateTimes(s,s.plus(i))}static before(t,r){const i=Ti.fromDurationLike(r),s=uA(t);return _n.fromDateTimes(s.minus(i),s)}static fromISO(t,r){const[i,s]=(t||"").split("/",2);if(i&&s){let n,o;try{n=Ar.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=Ar.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return _n.fromDateTimes(n,a);if(o){const c=Ti.fromISO(s,r);if(c.isValid)return _n.after(n,c)}else if(l){const c=Ti.fromISO(i,r);if(c.isValid)return _n.before(a,c)}}return _n.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(t),i=this.end.startOf(t);return Math.floor(i.diff(r,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:r}={}){return this.isValid?_n.fromDateTimes(t||this.s,r||this.e):this}splitAt(...t){if(!this.isValid)return[];const r=t.map(uA).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(_n.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(t){const r=Ti.fromDurationLike(t);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(_n.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const r=this.s>t.s?this.s:t.s,i=this.e<t.e?this.e:t.e;return r>=i?null:_n.fromDateTimes(r,i)}union(t){if(!this.isValid)return this;const r=this.s<t.s?this.s:t.s,i=this.e>t.e?this.e:t.e;return _n.fromDateTimes(r,i)}static merge(t){const[r,i]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(t){let r=null,i=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(_n.fromDateTimes(r,l.time)),r=null);return _n.merge(s)}difference(...t){return _n.xor([this].concat(t)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:Vx}toLocaleString(t=e4,r={}){return this.isValid?Qa.create(this.s.loc.clone(r),t).formatInterval(this):Vx}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:Vx}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Vx}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:Vx}toFormat(t,{separator:r=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${r}${this.e.toFormat(t)}`:Vx}toDuration(t,r){return this.isValid?this.e.diff(this.s,t,r):Ti.invalid(this.invalidReason)}mapEndpoints(t){return _n.fromDateTimes(t(this.s),t(this.e))}}class XI{static hasDST(t=so.defaultZone){const r=Ar.now().setZone(t).set({month:12});return!t.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(t){return _y.isValidZone(t)}static normalizeZone(t){return T_(t,so.defaultZone)}static months(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ws.create(r,i,n)).months(t)}static monthsFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Ws.create(r,i,n)).months(t,!0)}static weekdays(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Ws.create(r,i,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Ws.create(r,i,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Ws.create(t).meridiems()}static eras(t="short",{locale:r=null}={}){return Ws.create(r,null,"gregory").eras(t)}static features(){return{relative:dve()}}}function rie(e,t){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(t)-r(e);return Math.floor(Ti.fromMillis(i).as("days"))}function ABe(e,t,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const h=rie(l,c);return(h-h%7)/7}],["days",rie]],s={},n=e;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,s[l]=c(e,t),a=n.plus(s),a>t?(s[l]--,e=n.plus(s)):e=a);return[e,s,a,o]}function RBe(e,t,r,i){let[s,n,o,a]=ABe(e,t,r);const l=t-s,c=r.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=Ti.fromObject(n,i);return c.length>0?Ti.fromMillis(l,i).shiftTo(...c).plus(h):h}const fZ={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},iie={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},OBe=fZ.hanidec.replace(/[\[|\]]/g,"").split("");function MBe(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);if(e[r].search(fZ.hanidec)!==-1)t+=OBe.indexOf(e[r]);else for(const s in iie){const[n,o]=iie[s];i>=n&&i<=o&&(t+=i-n)}}return parseInt(t,10)}else return t}function yd({numberingSystem:e},t=""){return new RegExp(`${fZ[e||"latn"]}${t}`)}const PBe="missing Intl.DateTimeFormat.formatToParts support";function Fi(e,t=r=>r){return{regex:e,deser:([r])=>t(MBe(r))}}const IBe=String.fromCharCode(160),Mve=`[ ${IBe}]`,Pve=new RegExp(Mve,"g");function $Be(e){return e.replace(/\./g,"\\.?").replace(Pve,Mve)}function sie(e){return e.replace(/\./g,"").replace(Pve," ").toLowerCase()}function _d(e,t){return e===null?null:{regex:RegExp(e.map($Be).join("|")),deser:([r])=>e.findIndex(i=>sie(r)===sie(i))+t}}function nie(e,t){return{regex:e,deser:([,r,i])=>N6(r,i),groups:t}}function Gk(e){return{regex:e,deser:([t])=>t}}function LBe(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function DBe(e,t){const r=yd(t),i=yd(t,"{2}"),s=yd(t,"{3}"),n=yd(t,"{4}"),o=yd(t,"{6}"),a=yd(t,"{1,2}"),l=yd(t,"{1,3}"),c=yd(t,"{1,6}"),h=yd(t,"{1,9}"),p=yd(t,"{2,4}"),f=yd(t,"{4,6}"),m=b=>({regex:RegExp(LBe(b.val)),deser:([x])=>x,literal:!0}),_=(b=>{if(e.literal)return m(b);switch(b.val){case"G":return _d(t.eras("short",!1),0);case"GG":return _d(t.eras("long",!1),0);case"y":return Fi(c);case"yy":return Fi(p,Vj);case"yyyy":return Fi(n);case"yyyyy":return Fi(f);case"yyyyyy":return Fi(o);case"M":return Fi(a);case"MM":return Fi(i);case"MMM":return _d(t.months("short",!0,!1),1);case"MMMM":return _d(t.months("long",!0,!1),1);case"L":return Fi(a);case"LL":return Fi(i);case"LLL":return _d(t.months("short",!1,!1),1);case"LLLL":return _d(t.months("long",!1,!1),1);case"d":return Fi(a);case"dd":return Fi(i);case"o":return Fi(l);case"ooo":return Fi(s);case"HH":return Fi(i);case"H":return Fi(a);case"hh":return Fi(i);case"h":return Fi(a);case"mm":return Fi(i);case"m":return Fi(a);case"q":return Fi(a);case"qq":return Fi(i);case"s":return Fi(a);case"ss":return Fi(i);case"S":return Fi(l);case"SSS":return Fi(s);case"u":return Gk(h);case"uu":return Gk(a);case"uuu":return Fi(r);case"a":return _d(t.meridiems(),0);case"kkkk":return Fi(n);case"kk":return Fi(p,Vj);case"W":return Fi(a);case"WW":return Fi(i);case"E":case"c":return Fi(r);case"EEE":return _d(t.weekdays("short",!1,!1),1);case"EEEE":return _d(t.weekdays("long",!1,!1),1);case"ccc":return _d(t.weekdays("short",!0,!1),1);case"cccc":return _d(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return nie(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return nie(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return Gk(/[a-z_+-/]{1,256}?/i);default:return m(b)}})(e)||{invalidReason:PBe};return _.token=e,_}const NBe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function FBe(e,t){const{type:r,value:i}=e;if(r==="literal")return{literal:!0,val:i};const s=t[r];let n=NBe[r];if(typeof n=="object"&&(n=n[s]),n)return{literal:!1,val:n}}function UBe(e){return[`^${e.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,e]}function kBe(e,t,r){const i=e.match(t);if(i){const s={};let n=1;for(const o in r)if(OE(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function VBe(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return bi(e.z)||(r=_y.create(e.z)),bi(e.Z)||(r||(r=new tl(e.Z)),i=e.Z),bi(e.q)||(e.M=(e.q-1)*3+1),bi(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),bi(e.u)||(e.S=lZ(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),r,i]}let jk=null;function BBe(){return jk||(jk=Ar.fromMillis(1555555555555)),jk}function zBe(e,t){if(e.literal)return e;const r=Qa.macroTokenToFormatOpts(e.val),i=Lve(r,t);return i==null||i.includes(void 0)?e:i}function Ive(e,t){return Array.prototype.concat(...e.map(r=>zBe(r,t)))}function $ve(e,t,r){const i=Ive(Qa.parseFormat(r),e),s=i.map(o=>DBe(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:i,invalidReason:n.invalidReason};{const[o,a]=UBe(s),l=RegExp(o,"i"),[c,h]=kBe(t,l,a),[p,f,m]=h?VBe(h):[null,null,void 0];if(OE(h,"a")&&OE(h,"H"))throw new VR("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:i,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function GBe(e,t,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=$ve(e,t,r);return[i,s,n,o]}function Lve(e,t){return e?Qa.create(t,e).formatDateTimeParts(BBe()).map(s=>FBe(s,e)):null}const Dve=[0,31,59,90,120,151,181,212,243,273,304,334],Nve=[0,31,60,91,121,152,182,213,244,274,305,335];function Bh(e,t){return new mp("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function Fve(e,t,r){const i=new Date(Date.UTC(e,t-1,r));e<100&&e>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function Uve(e,t,r){return r+(OP(e)?Nve:Dve)[t-1]}function kve(e,t){const r=OP(e)?Nve:Dve,i=r.findIndex(n=>n<t),s=t-r[i];return{month:i+1,day:s}}function Bj(e){const{year:t,month:r,day:i}=e,s=Uve(t,r,i),n=Fve(t,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=r4(a)):o>r4(t)?(a=t+1,o=1):a=t,{weekYear:a,weekNumber:o,weekday:n,...F6(e)}}function oie(e){const{weekYear:t,weekNumber:r,weekday:i}=e,s=Fve(t,1,4),n=X3(t);let o=r*7+i-s-3,a;o<1?(a=t-1,o+=X3(a)):o>n?(a=t+1,o-=X3(t)):a=t;const{month:l,day:c}=kve(a,o);return{year:a,month:l,day:c,...F6(e)}}function Hk(e){const{year:t,month:r,day:i}=e,s=Uve(t,r,i);return{year:t,ordinal:s,...F6(e)}}function aie(e){const{year:t,ordinal:r}=e,{month:i,day:s}=kve(t,r);return{year:t,month:i,day:s,...F6(e)}}function jBe(e){const t=D6(e.weekYear),r=Zg(e.weekNumber,1,r4(e.weekYear)),i=Zg(e.weekday,1,7);return t?r?i?!1:Bh("weekday",e.weekday):Bh("week",e.week):Bh("weekYear",e.weekYear)}function HBe(e){const t=D6(e.year),r=Zg(e.ordinal,1,X3(e.year));return t?r?!1:Bh("ordinal",e.ordinal):Bh("year",e.year)}function Vve(e){const t=D6(e.year),r=Zg(e.month,1,12),i=Zg(e.day,1,t4(e.year,e.month));return t?r?i?!1:Bh("day",e.day):Bh("month",e.month):Bh("year",e.year)}function Bve(e){const{hour:t,minute:r,second:i,millisecond:s}=e,n=Zg(t,0,23)||t===24&&r===0&&i===0&&s===0,o=Zg(r,0,59),a=Zg(i,0,59),l=Zg(s,0,999);return n?o?a?l?!1:Bh("millisecond",s):Bh("second",i):Bh("minute",r):Bh("hour",t)}const qk="Invalid DateTime",lie=864e13;function YI(e){return new mp("unsupported zone",`the zone "${e.name}" is not supported`)}function Wk(e){return e.weekData===null&&(e.weekData=Bj(e.c)),e.weekData}function lA(e,t){const r={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new Ar({...r,...t,old:r})}function zve(e,t,r){let i=e-t*60*1e3;const s=r.offset(i);if(t===s)return[i,t];i-=(s-t)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function cie(e,t){e+=t*60*1e3;const r=new Date(e);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function QD(e,t,r){return zve(uZ(e),t,r)}function uie(e,t){const r=e.o,i=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n={...e.c,year:i,month:s,day:Math.min(e.c.day,t4(i,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7},o=Ti.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=uZ(n);let[l,c]=zve(a,r,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function cA(e,t,r,i,s,n){const{setZone:o,zone:a}=r;if(e&&Object.keys(e).length!==0){const l=t||a,c=Ar.fromObject(e,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return Ar.invalid(new mp("unparsable",`the input "${s}" can't be parsed as ${i}`))}function ZI(e,t,r=!0){return e.isValid?Qa.create(Ws.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(e,t):null}function Xk(e,t){const r=e.c.year>9999||e.c.year<0;let i="";return r&&e.c.year>=0&&(i+="+"),i+=oo(e.c.year,r?6:4),t?(i+="-",i+=oo(e.c.month),i+="-",i+=oo(e.c.day)):(i+=oo(e.c.month),i+=oo(e.c.day)),i}function hie(e,t,r,i,s,n){let o=oo(e.c.hour);return t?(o+=":",o+=oo(e.c.minute),(e.c.second!==0||!r)&&(o+=":")):o+=oo(e.c.minute),(e.c.second!==0||!r)&&(o+=oo(e.c.second),(e.c.millisecond!==0||!i)&&(o+=".",o+=oo(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=oo(Math.trunc(-e.o/60)),o+=":",o+=oo(Math.trunc(-e.o%60))):(o+="+",o+=oo(Math.trunc(e.o/60)),o+=":",o+=oo(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const Gve={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},qBe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},WBe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},jve=["year","month","day","hour","minute","second","millisecond"],XBe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],YBe=["year","ordinal","hour","minute","second","millisecond"];function die(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new q_e(e);return t}function pie(e,t){const r=T_(t.zone,so.defaultZone),i=Ws.fromObject(t),s=so.now();let n,o;if(bi(e.year))n=s;else{for(const c of jve)bi(e[c])&&(e[c]=Gve[c]);const a=Vve(e)||Bve(e);if(a)return Ar.invalid(a);const l=r.offset(s);[n,o]=QD(e,l,r)}return new Ar({ts:n,zone:r,loc:i,o})}function fie(e,t,r){const i=bi(r.round)?!0:r.round,s=(o,a)=>(o=cZ(o,i||r.calendary?0:2,!0),t.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,r.units[r.units.length-1])}function mie(e){let t={},r;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],r=Array.from(e).slice(0,e.length-1)):r=Array.from(e),[t,r]}class Ar{constructor(t){const r=t.zone||so.defaultZone;let i=t.invalid||(Number.isNaN(t.ts)?new mp("invalid input"):null)||(r.isValid?null:YI(r));this.ts=bi(t.ts)?so.now():t.ts;let s=null,n=null;if(!i)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(r))[s,n]=[t.old.c,t.old.o];else{const a=r.offset(this.ts);s=cie(this.ts,a),i=Number.isNaN(s.year)?new mp("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=t.loc||Ws.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Ar({})}static local(){const[t,r]=mie(arguments),[i,s,n,o,a,l,c]=r;return pie({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,r]=mie(arguments),[i,s,n,o,a,l,c]=r;return t.zone=tl.utcInstance,pie({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,r={}){const i=bVe(t)?t.valueOf():NaN;if(Number.isNaN(i))return Ar.invalid("invalid input");const s=T_(r.zone,so.defaultZone);return s.isValid?new Ar({ts:i,zone:s,loc:Ws.fromObject(r)}):Ar.invalid(YI(s))}static fromMillis(t,r={}){if(mw(t))return t<-lie||t>lie?Ar.invalid("Timestamp out of range"):new Ar({ts:t,zone:T_(r.zone,so.defaultZone),loc:Ws.fromObject(r)});throw new Ih(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,r={}){if(mw(t))return new Ar({ts:t*1e3,zone:T_(r.zone,so.defaultZone),loc:Ws.fromObject(r)});throw new Ih("fromSeconds requires a numerical input")}static fromObject(t,r={}){t=t||{};const i=T_(r.zone,so.defaultZone);if(!i.isValid)return Ar.invalid(YI(i));const s=so.now(),n=bi(r.specificOffset)?i.offset(s):r.specificOffset,o=i4(t,die),a=!bi(o.ordinal),l=!bi(o.year),c=!bi(o.month)||!bi(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Ws.fromObject(r);if((h||a)&&p)throw new VR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new VR("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,_,b=cie(s,n);m?(y=XBe,_=qBe,b=Bj(b)):a?(y=YBe,_=WBe,b=Hk(b)):(y=jve,_=Gve);let x=!1;for(const I of y){const U=o[I];bi(U)?x?o[I]=_[I]:o[I]=b[I]:x=!0}const T=m?jBe(o):a?HBe(o):Vve(o),S=T||Bve(o);if(S)return Ar.invalid(S);const C=m?oie(o):a?aie(o):o,[O,R]=QD(C,n,i),$=new Ar({ts:O,zone:i,o:R,loc:f});return o.weekday&&h&&t.weekday!==$.weekday?Ar.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${$.toISO()}`):$}static fromISO(t,r={}){const[i,s]=cBe(t);return cA(i,s,r,"ISO 8601",t)}static fromRFC2822(t,r={}){const[i,s]=uBe(t);return cA(i,s,r,"RFC 2822",t)}static fromHTTP(t,r={}){const[i,s]=hBe(t);return cA(i,s,r,"HTTP",r)}static fromFormat(t,r,i={}){if(bi(t)||bi(r))throw new Ih("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=Ws.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=GBe(o,t,r);return h?Ar.invalid(h):cA(a,l,i,`format ${r}`,t,c)}static fromString(t,r,i={}){return Ar.fromFormat(t,r,i)}static fromSQL(t,r={}){const[i,s]=_Be(t);return cA(i,s,r,"SQL",t)}static invalid(t,r=null){if(!t)throw new Ih("need to specify a reason the DateTime is invalid");const i=t instanceof mp?t:new mp(t,r);if(so.throwOnInvalid)throw new J9e(i);return new Ar({invalid:i})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}static parseFormatForOpts(t,r={}){const i=Lve(t,Ws.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(t,r={}){return Ive(Qa.parseFormat(t),Ws.fromObject(r)).map(s=>s.val).join("")}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Wk(this).weekYear:NaN}get weekNumber(){return this.isValid?Wk(this).weekNumber:NaN}get weekday(){return this.isValid?Wk(this).weekday:NaN}get ordinal(){return this.isValid?Hk(this.c).ordinal:NaN}get monthShort(){return this.isValid?XI.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?XI.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?XI.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?XI.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return OP(this.year)}get daysInMonth(){return t4(this.year,this.month)}get daysInYear(){return this.isValid?X3(this.year):NaN}get weeksInWeekYear(){return this.isValid?r4(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:r,numberingSystem:i,calendar:s}=Qa.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(t=0,r={}){return this.setZone(tl.instance(t),r)}toLocal(){return this.setZone(so.defaultZone)}setZone(t,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(t=T_(t,so.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(r||i){const n=t.offset(this.ts),o=this.toObject();[s]=QD(o,n,t)}return lA(this,{ts:s,zone:t})}else return Ar.invalid(YI(t))}reconfigure({locale:t,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:t,numberingSystem:r,outputCalendar:i});return lA(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const r=i4(t,die),i=!bi(r.weekYear)||!bi(r.weekNumber)||!bi(r.weekday),s=!bi(r.ordinal),n=!bi(r.year),o=!bi(r.month)||!bi(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new VR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new VR("Can't mix ordinal dates with month/day");let c;i?c=oie({...Bj(this.c),...r}):bi(r.ordinal)?(c={...this.toObject(),...r},bi(r.day)&&(c.day=Math.min(t4(c.year,c.month),c.day))):c=aie({...Hk(this.c),...r});const[h,p]=QD(c,this.o,this.zone);return lA(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const r=Ti.fromDurationLike(t);return lA(this,uie(this,r))}minus(t){if(!this.isValid)return this;const r=Ti.fromDurationLike(t).negate();return lA(this,uie(this,r))}startOf(t){if(!this.isValid)return this;const r={},i=Ti.normalizeUnit(t);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,r={}){return this.isValid?Qa.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,t):qk}toLocaleString(t=e4,r={}){return this.isValid?Qa.create(this.loc.clone(r),t).formatDateTime(this):qk}toLocaleParts(t={}){return this.isValid?Qa.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=Xk(this,o);return a+="T",a+=hie(this,o,r,i,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?Xk(this,t==="extended"):null}toISOWeekDate(){return ZI(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+hie(this,o==="extended",r,t,i,n):null}toRFC2822(){return ZI(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ZI(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Xk(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||t)&&(i&&(s+=" "),r?s+="z":t&&(s+="ZZ")),ZI(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():qk}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const r={...this.c};return t.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,r="milliseconds",i={}){if(!this.isValid||!t.isValid)return Ti.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=wVe(r).map(Ti.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=RBe(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",r={}){return this.diff(Ar.now(),t,r)}until(t){return this.isValid?_n.fromDateTimes(this,t):this}hasSame(t,r){if(!this.isValid)return!1;const i=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const r=t.base||Ar.fromObject({},{zone:this.zone}),i=t.padding?this<r?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),fie(r,this.plus(i),{...t,numeric:"always",units:s,unit:n})}toRelativeCalendar(t={}){return this.isValid?fie(t.base||Ar.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(Ar.isDateTime))throw new Ih("min requires all arguments be DateTimes");return Kre(t,r=>r.valueOf(),Math.min)}static max(...t){if(!t.every(Ar.isDateTime))throw new Ih("max requires all arguments be DateTimes");return Kre(t,r=>r.valueOf(),Math.max)}static fromFormatExplain(t,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=Ws.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return $ve(o,t,r)}static fromStringExplain(t,r,i={}){return Ar.fromFormatExplain(t,r,i)}static get DATE_SHORT(){return e4}static get DATE_MED(){return W_e}static get DATE_MED_WITH_WEEKDAY(){return eVe}static get DATE_FULL(){return X_e}static get DATE_HUGE(){return Y_e}static get TIME_SIMPLE(){return Z_e}static get TIME_WITH_SECONDS(){return J_e}static get TIME_WITH_SHORT_OFFSET(){return Q_e}static get TIME_WITH_LONG_OFFSET(){return K_e}static get TIME_24_SIMPLE(){return eve}static get TIME_24_WITH_SECONDS(){return tve}static get TIME_24_WITH_SHORT_OFFSET(){return rve}static get TIME_24_WITH_LONG_OFFSET(){return ive}static get DATETIME_SHORT(){return sve}static get DATETIME_SHORT_WITH_SECONDS(){return nve}static get DATETIME_MED(){return ove}static get DATETIME_MED_WITH_SECONDS(){return ave}static get DATETIME_MED_WITH_WEEKDAY(){return tVe}static get DATETIME_FULL(){return lve}static get DATETIME_FULL_WITH_SECONDS(){return cve}static get DATETIME_HUGE(){return uve}static get DATETIME_HUGE_WITH_SECONDS(){return hve}}function uA(e){if(Ar.isDateTime(e))return e;if(e&&e.valueOf&&mw(e.valueOf()))return Ar.fromJSDate(e);if(e&&typeof e=="object")return Ar.fromObject(e);throw new Ih(`Unknown datetime argument: ${e}, of type ${typeof e}`)}function ZBe(e,t="system"){if(!e||!jre.has(e.timeZone))return t;const r=jre.get(e.timeZone);return QBe(e.timeZone)||e.respectsDaylightSaving?r:JBe(r)}function JBe(e){const t=Ar.local().setZone(e),r=Math.min(t.set({month:1,day:1}).offset,t.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${tl.instance(-r).formatOffset(0,"narrow")}`}function QBe(e){return e.startsWith("UTC")}let X0=class extends Ss(fe){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,t){const{timeZone:r,respectsDaylightSaving:i}=t;return{timeZone:r,respectsDaylightSaving:i}}readTimeZone(e,t){return"timeZoneIANA"in t?t.timeZoneIANA:ZBe(t)}writeTimeZone(e,t){t.timeZoneIANA=e}equals(e){return!(E(e)||E(this.timeZone)||E(e.timeZone))&&this.timeZone===e.timeZone}};u([d()],X0.prototype,"legacy",void 0),u([De("legacy",["timeZone"])],X0.prototype,"readLegacy",null),u([d({type:String,nonNullable:!0})],X0.prototype,"timeZone",void 0),u([De("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],X0.prototype,"readTimeZone",null),u([Be("timeZone")],X0.prototype,"writeTimeZone",null),X0=u([P("esri.time.TimeReference")],X0);const ME=X0;let Tg=class extends Ss(fe){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};u([d()],Tg.prototype,"creatorField",void 0),u([d()],Tg.prototype,"creationDateField",void 0),u([d()],Tg.prototype,"editorField",void 0),u([d()],Tg.prototype,"editDateField",void 0),u([d()],Tg.prototype,"realm",void 0),u([d({type:ME})],Tg.prototype,"dateFieldsTimeReference",void 0),Tg=u([P("esri.layers.support.EditFieldsInfo")],Tg);const KBe=Tg;let kf=class extends Ss(fe){constructor(e){super(e)}};u([d({constructOnly:!0,json:{write:!0}})],kf.prototype,"name",void 0),u([d({constructOnly:!0,json:{write:!0}})],kf.prototype,"fields",void 0),u([d({constructOnly:!0,json:{write:!0}})],kf.prototype,"isAscending",void 0),u([d({constructOnly:!0,json:{write:!0}})],kf.prototype,"indexType",void 0),u([d({constructOnly:!0,json:{write:!0}})],kf.prototype,"isUnique",void 0),u([d({constructOnly:!0,json:{write:!0}})],kf.prototype,"description",void 0),kf=u([P("esri.layers.support.FeatureIndex")],kf);const zj=new Vr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function eze(e,t,r,i){const s=await kv(e);if(await mZ(e,t,i),!s.addAttachment)throw new j(i,"Layer source does not support addAttachment capability");return s.addAttachment(t,r)}function mZ(e,t,r){const{attributes:i}=t,{objectIdField:s}=e;return e.get("capabilities.data.supportsAttachment")?t?i?s&&i[s]?Promise.resolve():Promise.reject(new j(r,`feature is missing the identifying attribute ${s}`)):Promise.reject(new j(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new j(r,"A feature is required to add/delete/update attachments")):Promise.reject(new j(r,"this layer doesn't support attachments"))}async function tze(e,t,r,i,s){const n=await kv(e);if(await mZ(e,t,s),!n.updateAttachment)throw new j(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(t,r,i)}async function rze(e,t,r){const i=await ie(()=>import("./editingSupport.2d771d4f.js"),["assets/editingSupport.2d771d4f.js","assets/assetEditingSupport.240adbda.js"]),s=await e.load();return i.applyEdits(s,s.source,t,r)}async function ize(e,t,r,i){const s=await kv(e);if(await mZ(e,t,i),!s.deleteAttachments)throw new j(i,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(t,r)}async function sze(e,t,r){const i=(await e.load({signal:t==null?void 0:t.signal})).source;if(!i.fetchRecomputedExtents)throw new j(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(t)}async function nze(e,t,r,i){var m,y;t=mG.from(t),await e.load();const s=e.source,n=e.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new j(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:h,start:p,where:f}=t;if(!((y=n==null?void 0:n.operations)!=null&&y.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(h==null?void 0:h.length)>0||c||p||f))throw new j(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!((a==null?void 0:a.length)||(l==null?void 0:l.length)||f))throw new j(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!s.queryAttachments)throw new j(i,"Layer source does not support queryAttachments capability",t);return s.queryAttachments(t)}async function oze(e,t,r,i){var n;const s=await kv(e);if(!s.queryObjectIds)throw new j(i,"Layer source does not support queryObjectIds capability");return s.queryObjectIds((n=cm.from(t))!=null?n:e.createQuery(),r)}async function aze(e,t,r,i){var n;const s=await kv(e);if(!s.queryFeatureCount)throw new j(i,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount((n=cm.from(t))!=null?n:e.createQuery(),r)}async function lze(e,t,r,i){var n;const s=await kv(e);if(!s.queryExtent)throw new j(i,"Layer source does not support queryExtent capability");return s.queryExtent((n=cm.from(t))!=null?n:e.createQuery(),r)}async function cze(e,t,r,i){const s=await kv(e);if(!s.queryRelatedFeatures)throw new j(i,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(EE.from(t),r)}async function uze(e,t,r,i){const s=await kv(e);if(!s.queryRelatedFeaturesCount)throw new j(i,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(EE.from(t),r)}async function hze(e){const t=e.source;if(t!=null&&t.refresh)try{const{dataChanged:r,updates:i}=await t.refresh();if(v(i)&&(e.sourceJSON={...e.sourceJSON,...i},e.read(i,{origin:"service",url:e.parsedUrl})),r)return!0}catch{}if(e.definitionExpression)try{return(await e9e(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function dze(e){const t=new cm,r=e.get("capabilities.data"),i=e.get("capabilities.query");t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,i&&(t.compactGeometryEnabled=i.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),r.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:s,timeExtent:n}=e;return t.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function Hve(e){const{globalIdField:t,fields:r}=e;if(t)return t;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function qve(e){const{objectIdField:t,fields:r}=e;if(t)return t;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function pze(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}async function kv(e){return(await e.load()).source}async function fze(e,t){if(!Ci||Ci.findCredential(e))return;let r;try{const i=await dye(e,t);i&&(r=await Ci.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=v(t)?t.signal:null;await Ci.getCredential(e,{signal:i})}catch{}}async function mze(e,t){var s;const r=(s=e.parsedUrl)==null?void 0:s.path;if(!r)return;const i=e.editFieldsInfo;(e.userHasUpdateItemPrivileges||e.userHasFullEditingPrivileges&&e.capabilities.operations.supportsEditing||(i==null?void 0:i.creatorField)||(i==null?void 0:i.editorField))&&await fze(r,t)}function gze(e){var t;return!((t=e.sourceJSON)!=null&&t.isMultiServicesView)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}let d2=class extends Ss(fe){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],d2.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],d2.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:e=>fOe.read(e)||mOe.read(e)}})],d2.prototype,"units",void 0),d2=u([P("esri.layers.support.GeometryFieldsInfo")],d2);const yze=d2;var Gj;let p2=Gj=class extends fe{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new pt}clone(){return new Gj({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],p2.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],p2.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],p2.prototype,"viewAllLevelIds",void 0),p2=Gj=u([P("esri.layers.support.LayerFloorInfo")],p2);const _ze=p2,gie=new Vr({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),yie=new Vr({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let ph=class extends Ss(fe){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:gie.read,write:gie.write}})],ph.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],ph.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],ph.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],ph.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],ph.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],ph.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],ph.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],ph.prototype,"relationshipTableId",void 0),u([d({json:{read:yie.read,write:yie.write}})],ph.prototype,"role",void 0),ph=u([P("esri.layers.support.Relationship")],ph);const vze=ph,bze={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function Zt(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}function JI(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}function wze(e){var r;const t=(r=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(t!=null&&t.includes("envelopeaggregate")),centroid:!!(t!=null&&t.includes("centroidaggregate")),convexHull:!!(t!=null&&t.includes("convexhullaggregate"))}}function IP(e,t){var i;const r=(i=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:i.map(s=>s.toLowerCase());return!!(r!=null&&r.includes(t.toLowerCase()))}function Wve(e,t){return{analytics:xze(e),attachment:Tze(e),data:Sze(e),metadata:Eze(e),operations:Cze(e.capabilities,e,t),query:Aze(e,t),queryRelated:Rze(e),queryTopFeatures:Oze(e),editing:Mze(e)}}function xze(e){return{supportsCacheHint:IP(e.advancedQueryCapabilities,"queryAnalytics")}}function Tze(e){const t=e.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:IP(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:Zt(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(i=>{const s=bze[i.name];s&&(r[s]=!!i.isEnabled)}),r}function Sze(e){return{isVersioned:Zt(e,"isDataVersioned",!1),supportsAttachment:Zt(e,"hasAttachments",!1),supportsM:Zt(e,"hasM",!1),supportsZ:Zt(e,"hasZ",!1)}}function Eze(e){return{supportsAdvancedFieldProperties:Zt(e,"supportsFieldDescriptionProperty",!1)}}function Cze(e,t,r){const i=e?e.toLowerCase().split(",").map(f=>f.trim()):[],s=r?RC(r):null,n=i.includes(v(s)&&s.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!t.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const h=i.includes("changetracking"),p=t.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:Zt(t,"supportsCalculate",!1),supportsTruncate:Zt(t,"supportsTruncate",!1),supportsValidateSql:Zt(t,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:h,supportsQuery:n,supportsQueryAnalytics:Zt(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:Zt(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Zt(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Zt(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:Zt(t,"supportsExceedsLimitStatistics",!1)}}function Aze(e,t){var h;const r=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,s=e.archivingInfo,n=e.currentVersion,o=t==null?void 0:t.includes("MapServer"),a=!o||n>=de("mapserver-pbf-version-support"),l=B_e(t),c=new Set(((h=e.supportedQueryFormats)!=null?h:"").split(",").map(p=>p.toLowerCase().trim()));return{supportsStatistics:Zt(r,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Zt(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Zt(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:wze(r),supportsCentroid:Zt(r,"supportsReturningGeometryCentroid",!1),supportsDistance:Zt(r,"supportsQueryWithDistance",!1),supportsDistinct:Zt(r,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Zt(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Zt(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:Zt(r,"supportsHavingClause",!1),supportsOrderBy:Zt(r,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Zt(r,"supportsPagination",!1),supportsQuantization:Zt(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Zt(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Zt(e,"supportsReturningQueryGeometry",!1),supportsResultType:Zt(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Zt(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Zt(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Zt(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Zt(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Zt(i,"allowOthersToQuery",!0),supportsHistoricMoment:Zt(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:Zt(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:Zt(r,"supportsQueryWithCacheHint",!1)||IP(r,"query"),supportsDefaultSpatialReference:Zt(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:Zt(r,"supportsFullTextSearch",!1),maxRecordCountFactor:JI(e,"maxRecordCountFactor",void 0),maxRecordCount:JI(e,"maxRecordCount",void 0),standardMaxRecordCount:JI(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:JI(e,"tileMaxRecordCount",void 0)}}function Rze(e){const t=e.advancedQueryCapabilities,r=Zt(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Zt(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:IP(t,"queryRelated")}}function Oze(e){return{supportsCacheHint:IP(e.advancedQueryCapabilities,"queryTopFilter")}}function Mze(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Zt(e,"allowGeometryUpdates",!0),supportsGlobalId:Zt(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Zt(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Zt(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Zt(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Zt(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Zt(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Zt(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Zt(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Zt(t,"allowOthersToUpdate",!0)}}const Pze=e=>{let t=class extends e{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=Ye.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(pt.ofType(kf)),this.version=void 0}readCapabilitiesFromService(r,i){return Wve(i,this.url)}get effectiveCapabilities(){var o;const r=this.capabilities;if(!r)return null;const i=re(r),{operations:s,editing:n}=i;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),i)}readEditingInfo(r,i){const{editingInfo:s}=i;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return Hve(i)}readObjectIdFieldFromService(r,i){return qve(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=C9e({layer:this,url:r,nonStandardUrlAllowed:!0,logger:ee.getLogger(this.declaredClass)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){A9e(this,r,null,i,n)}readVersion(r,i){return pze(i)}};return u([d({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],t.prototype,"capabilities",void 0),u([De("service","capabilities")],t.prototype,"readCapabilitiesFromService",null),u([d({readOnly:!0})],t.prototype,"effectiveCapabilities",null),u([d({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),u([d({type:ME})],t.prototype,"dateFieldsTimeReference",void 0),u([d({type:Boolean})],t.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],t.prototype,"definitionExpression",void 0),u([d({readOnly:!0,type:KBe})],t.prototype,"editFieldsInfo",void 0),u([d({readOnly:!0})],t.prototype,"editingInfo",void 0),u([De("editingInfo")],t.prototype,"readEditingInfo",null),u([d((()=>{const r=re(q9e),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],t.prototype,"elevationInfo",void 0),u([d({type:_ze,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],t.prototype,"floorInfo",void 0),u([d({type:qr,json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0),u([d()],t.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:yze,json:{read:{source:"geometryProperties"}}})],t.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:zj.read}}}})],t.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasZ",void 0),u([d({readOnly:!0,type:Fv})],t.prototype,"heightModelInfo",void 0),u([d({type:Date})],t.prototype,"historicMoment",void 0),u([d({readOnly:!0})],t.prototype,"isTable",void 0),u([De("service","isTable",["type"])],t.prototype,"readIsTableFromService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],t.prototype,"layerId",void 0),u([d(Y9e)],t.prototype,"minScale",void 0),u([De("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),u([d(Z9e)],t.prototype,"maxScale",void 0),u([De("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),u([d({type:String})],t.prototype,"globalIdField",void 0),u([De("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),u([d({type:String})],t.prototype,"objectIdField",void 0),u([De("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),u([d({type:ME})],t.prototype,"preferredTimeReference",void 0),u([d({type:[vze],readOnly:!0})],t.prototype,"relationships",void 0),u([d()],t.prototype,"sourceJSON",void 0),u([d({type:Boolean})],t.prototype,"returnM",void 0),u([d({type:Boolean})],t.prototype,"returnZ",void 0),u([d({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),u([De("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),u([d({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"serviceItemId",void 0),u([d({type:Ye,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],t.prototype,"spatialReference",void 0),u([d({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],t.prototype,"subtypeField",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),u([d({readOnly:!0,json:{write:!1}})],t.prototype,"serverGens",void 0),u([d({type:pt.ofType(kf),readOnly:!0})],t.prototype,"indexes",void 0),u([d(j9e)],t.prototype,"url",null),u([Be("url")],t.prototype,"writeUrl",null),u([d({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),u([De("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),t=u([P("esri.layers.mixins.FeatureLayerBase")],t),t};let f2=class extends Ss(fe){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([d({type:String,json:{write:!0}})],f2.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],f2.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],f2.prototype,"returnType",void 0),f2=u([P("esri.layers.support.ExpressionInfo")],f2);const gZ=f2;var jj;let Sg=jj=class extends fe{constructor(e){super(e),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new jj({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:re(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([d({type:Boolean,json:{write:!0}})],Sg.prototype,"isAutoGenerated",void 0),u([d({type:String,json:{write:!0}})],Sg.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],Sg.prototype,"alias",void 0),u([d({type:String,json:{write:!0}})],Sg.prototype,"onStatisticField",void 0),u([d({type:gZ,json:{write:!0}})],Sg.prototype,"onStatisticExpression",void 0),u([d({type:String,json:{write:!0}})],Sg.prototype,"statisticType",void 0),Sg=jj=u([P("esri.layers.support.AggregateField")],Sg);const Bw=Sg;let ev=class extends fe{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],ev.prototype,"type",void 0),ev=u([P("esri.layers.support.FeatureReduction")],ev);const yZ="__begin__",_Z="__end__",Ize=new RegExp(yZ,"ig"),$ze=new RegExp(_Z,"ig"),_ie=new RegExp("^"+yZ,"i"),vie=new RegExp(_Z+"$","i"),s4='"',Lze=s4+" + ",Dze=" + "+s4;function Nze(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function Fze(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function U6(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=Nze(e.labelExpression),t.type="conventional"),t}function Uze(e){const t=U6(e);if(!t)return null;switch(t.type){case"conventional":return Hj(t.expression);case"arcade":return t.expression}return null}function kze(e){const t=U6(e);if(!t)return null;switch(t.type){case"conventional":return Bze(t.expression);case"arcade":return vZ(t.expression)}return null}function Hj(e){let t;return e?(t=mm(e,r=>yZ+'$feature["'+r+'"]'+_Z),t=_ie.test(t)?t.replace(_ie,""):s4+t,t=vie.test(t)?t.replace(vie,""):t+s4,t=t.replace(Ize,Lze).replace($ze,Dze)):t='""',t}const Vze=/^\s*\{([^}]+)\}\s*$/i;function Bze(e){const t=e==null?void 0:e.match(Vze);return t&&t[1].trim()||null}const zze=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,Gze=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,jze=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function vZ(e){if(!e)return null;let t=zze.exec(e)||Gze.exec(e);return t?t[1]||t[3]:(t=jze.exec(e),t?t[2]:null)}var qj;let Y0=qj=class extends fe{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?Hj(t.value):e}writeExpression(e,t,r){this.value!=null&&(e=Hj(this.value)),e!=null&&(t[r]=e)}clone(){return new qj({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],Y0.prototype,"expression",void 0),u([De("expression",["expression","value"])],Y0.prototype,"readExpression",null),u([Be("expression")],Y0.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Y0.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],Y0.prototype,"value",void 0),Y0=qj=u([P("esri.layers.support.LabelExpressionInfo")],Y0);const Xve=Y0,Yve=[252,146,31,255],h2t=[153,153,153,255],Hze={type:"esriSMS",style:"esriSMSCircle",size:6,color:Yve,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},qze={type:"esriSLS",style:"esriSLSSolid",width:.75,color:Yve},Wze={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},Xze={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},Yze={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},Zze={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Jze={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},d2t=Nv.fromJSON(Hze),p2t=ld.fromJSON(qze),f2t=Dv.fromJSON(Wze),Qze=_C.fromJSON(Xze);Nv.fromJSON(Yze);ld.fromJSON(Zze);Dv.fromJSON(Jze);var Wj;const QI=new Vr({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function KI(e,t,r){return{enabled:!uye(r==null?void 0:r.layer)}}function Zve(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function Kze(e){return(e==null?void 0:e.type)==="map-image"}function Jve(e){var t,r;return!!Kze(e)&&!!((r=(t=e.capabilities)==null?void 0:t.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function e7e(e){return Zve(e)||Jve(e==null?void 0:e.layer)}let mn=Wj=class extends fe{static evaluateWhere(e,t){const r=(i,s,n)=>{switch(s){case"=":return i==n;case"<>":return i!=n;case">":return i>n;case">=":return i>=n;case"<":return i<n;case"<=":return i<=n}return!1};try{if(e==null)return!0;const i=e.split(" ");if(i.length===3)return r(t[i[0]],i[1],i[2]);if(i.length===7){const s=r(t[i[0]],i[1],i[2]),n=i[3],o=r(t[i[4]],i[5],i[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=Qze,this.useCodedValues=void 0,this.where=null}readLabelExpression(e,t){const r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}writeLabelExpression(e,t,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=Fze(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=vZ(this.labelExpressionInfo.expression);i&&(e="["+i+"]")}}e!=null&&(t[r]=e)}writeLabelExpressionInfo(e,t,r,i){if(e==null&&this.labelExpression!=null&&Zve(i))e=new Xve({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(i);s.expression&&(t[r]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return U6(this)}getLabelExpressionArcade(){return Uze(this)}getLabelExpressionSingleField(){return kze(this)}hash(){return JSON.stringify(this)}clone(){return new Wj({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:re(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:re(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],mn.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:KI}}}}})],mn.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:KI}}}}})],mn.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(e,t,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&Jve(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],mn.prototype,"labelExpression",void 0),u([De("labelExpression")],mn.prototype,"readLabelExpression",null),u([Be("labelExpression")],mn.prototype,"writeLabelExpression",null),u([d({type:Xve,json:{write:{overridePolicy:(e,t,r)=>e7e(r)?{allowNull:!0}:{enabled:!1}}}})],mn.prototype,"labelExpressionInfo",void 0),u([Be("labelExpressionInfo")],mn.prototype,"writeLabelExpressionInfo",null),u([d({type:QI.apiValues,json:{type:QI.jsonValues,read:QI.read,write:QI.write}})],mn.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],mn.prototype,"labelPosition",void 0),u([d({type:Number})],mn.prototype,"maxScale",void 0),u([Be("maxScale")],mn.prototype,"writeMaxScale",null),u([d({type:Number})],mn.prototype,"minScale",void 0),u([Be("minScale")],mn.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:KI}}}}})],mn.prototype,"repeatLabel",void 0),u([d({type:Number,cast:pi,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:KI}}}}})],mn.prototype,"repeatLabelDistance",void 0),u([d({types:s$e,json:{origins:{"web-scene":{types:n$e,write:vre,default:null}},write:vre,default:null}})],mn.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],mn.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],mn.prototype,"where",void 0),mn=Wj=u([P("esri.layers.support.LabelClass")],mn);const k6=mn;var Xj;const Yk=Pv({types:J5}),t7e="esri.layers.support.FeatureReductionBinning";let Cl=Xj=class extends ev{constructor(e){super(e),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(e,t,r){const i=e.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ol(r,i,t)}readRenderer(e,t,r){var s,n;const i=(s=t.drawingInfo)==null?void 0:s.renderer;return i?(n=KF(i,t,r))!=null?n:void 0:t.defaultSymbol?t.types&&t.types.length?new AP({defaultSymbol:Yk(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map(o=>({id:o.id,symbol:Yk(o.symbol,o,r)}))}):new AE({symbol:Yk(t.defaultSymbol,t,r)}):null}clone(){return new Xj({fields:re(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:re(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:re(this.popupTemplate),renderer:re(this.renderer)})}};u([ft({binning:"binning"})],Cl.prototype,"type",void 0),u([ft({geohash:"geohash"})],Cl.prototype,"binType",void 0),u([d({type:Number,range:{min:1,max:9},json:{write:!0}})],Cl.prototype,"fixedBinLevel",void 0),u([d({type:[k6],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Cl.prototype,"labelingInfo",void 0),u([d(aZ)],Cl.prototype,"labelsVisible",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Cl.prototype,"maxScale",void 0),u([d(oZ)],Cl.prototype,"popupEnabled",void 0),u([d({type:uP,json:{name:"popupInfo",write:!0}})],Cl.prototype,"popupTemplate",void 0),u([d({type:[Bw],json:{write:!0}})],Cl.prototype,"fields",void 0),u([Be("fields")],Cl.prototype,"writeFields",null),u([d({types:$6,json:{write:{target:"drawingInfo.renderer"}}})],Cl.prototype,"renderer",void 0),u([De("renderer",["drawingInfo.renderer"])],Cl.prototype,"readRenderer",null),Cl=Xj=u([P(t7e)],Cl);const Qve=Cl;var Yj;const Zk=Pv({types:J5}),r7e="esri.layers.support.FeatureReductionCluster";function bie(e){var t;return e.type==="simple"&&!((t=e.visualVariables)!=null&&t.length)}let Qn=Yj=class extends fe{constructor(e){super(e),this.type="cluster",this.clusterRadius=pi("80px"),this.clusterMinSize=pi("12px"),this.clusterMaxSize=pi("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(e,t,r){var s,n,o;const i=(s=t.drawingInfo)==null?void 0:s.renderer;return(n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated?null:i?bie(i)?null:(o=KF(i,t,r))!=null?o:void 0:t.defaultSymbol?t.types&&t.types.length?new AP({defaultSymbol:Zk(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map(a=>({id:a.id,symbol:Zk(a.symbol,a,r)}))}):new AE({symbol:Zk(t.defaultSymbol,t,r)}):null}readSymbol(e,t,r){var s,n,o;const i=(s=t.drawingInfo)==null?void 0:s.renderer;return(n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated?null:i&&bie(i)?(o=KF(i,t,r))==null?void 0:o.symbol:null}writeSymbol(e,t,r,i){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new AE({symbol:e});t.drawingInfo={renderer:a.write({},i)}}}writeFields(e,t,r){const i=e.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ol(r,i,t)}readFields(e,t,r){return e.filter(i=>!i.isAutoGenerated).map(i=>Bw.fromJSON(i))}clone(){return new Yj({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:re(this.labelingInfo),labelsVisible:this.labelsVisible,fields:re(this.fields),maxScale:this.maxScale,renderer:re(this.renderer),symbol:re(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:re(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Qn.prototype,"type",void 0),u([d({type:Number,cast:e=>e==="auto"?e:pi(e),json:{write:!0}})],Qn.prototype,"clusterRadius",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],Qn.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:pi,json:{write:!0}})],Qn.prototype,"clusterMaxSize",void 0),u([d({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Qn.prototype,"maxScale",void 0),u([d(oZ)],Qn.prototype,"popupEnabled",void 0),u([d({type:uP,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Qn.prototype,"popupTemplate",void 0),u([d({types:$6,json:{write:{target:"drawingInfo.renderer"}}})],Qn.prototype,"renderer",void 0),u([De("renderer",["drawingInfo.renderer"])],Qn.prototype,"readRenderer",null),u([d({types:r$e})],Qn.prototype,"symbol",void 0),u([De("symbol",["drawingInfo.renderer"])],Qn.prototype,"readSymbol",null),u([Be("symbol")],Qn.prototype,"writeSymbol",null),u([d({type:[k6],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Qn.prototype,"labelingInfo",void 0),u([d(aZ)],Qn.prototype,"labelsVisible",void 0),u([d({type:[Bw],json:{write:!0}})],Qn.prototype,"fields",void 0),u([Be("fields")],Qn.prototype,"writeFields",null),u([De("fields")],Qn.prototype,"readFields",null),Qn=Yj=u([P(r7e)],Qn);const Kve=Qn;var Zj;let KD=Zj=class extends ev{constructor(e){super(e),this.type="selection"}clone(){return new Zj}};u([d({type:["selection"]})],KD.prototype,"type",void 0),KD=Zj=u([P("esri.layers.support.FeatureReductionSelection")],KD);const wie=KD,xie={key:"type",base:ev,typeMap:{cluster:Kve,binning:Qve}},i7e={types:{key:"type",base:ev,typeMap:{selection:wie,cluster:Kve,binning:Qve}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:xie},"portal-item":{types:xie},"web-scene":{types:{key:"type",base:ev,typeMap:{selection:wie}}}}}},Bx={Base64:0,Hex:1,String:2,Raw:3},PS=8,e1e=(1<<PS)-1;function j_(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function s7e(e){const t=[];for(let r=0,i=e.length*PS;r<i;r+=PS)t[r>>5]|=(e.charCodeAt(r/PS)&e1e)<<r%32;return t}function n7e(e){const t=[];for(let r=0,i=32*e.length;r<i;r+=PS)t.push(String.fromCharCode(e[r>>5]>>>r%32&e1e));return t.join("")}function o7e(e){const t="0123456789abcdef",r=[];for(let i=0,s=4*e.length;i<s;i++)r.push(t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15));return r.join("")}function a7e(e){const t="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let s=0,n=4*e.length;s<n;s+=3){const o=(e[s>>2]>>s%4*8&255)<<16|(e[s+1>>2]>>(s+1)%4*8&255)<<8|e[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*e.length?i.push(t):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function l7e(e,t){return e<<t|e>>>32-t}function V6(e,t,r,i,s,n){return j_(l7e(j_(j_(t,e),j_(i,n)),s),r)}function Da(e,t,r,i,s,n,o){return V6(t&r|~t&i,e,t,s,n,o)}function Na(e,t,r,i,s,n,o){return V6(t&i|r&~i,e,t,s,n,o)}function Fa(e,t,r,i,s,n,o){return V6(t^r^i,e,t,s,n,o)}function Ua(e,t,r,i,s,n,o){return V6(r^(t|~i),e,t,s,n,o)}function c7e(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let r=1732584193,i=-271733879,s=-1732584194,n=271733878;for(let o=0;o<e.length;o+=16){const a=r,l=i,c=s,h=n;r=Da(r,i,s,n,e[o+0],7,-680876936),n=Da(n,r,i,s,e[o+1],12,-389564586),s=Da(s,n,r,i,e[o+2],17,606105819),i=Da(i,s,n,r,e[o+3],22,-1044525330),r=Da(r,i,s,n,e[o+4],7,-176418897),n=Da(n,r,i,s,e[o+5],12,1200080426),s=Da(s,n,r,i,e[o+6],17,-1473231341),i=Da(i,s,n,r,e[o+7],22,-45705983),r=Da(r,i,s,n,e[o+8],7,1770035416),n=Da(n,r,i,s,e[o+9],12,-1958414417),s=Da(s,n,r,i,e[o+10],17,-42063),i=Da(i,s,n,r,e[o+11],22,-1990404162),r=Da(r,i,s,n,e[o+12],7,1804603682),n=Da(n,r,i,s,e[o+13],12,-40341101),s=Da(s,n,r,i,e[o+14],17,-1502002290),i=Da(i,s,n,r,e[o+15],22,1236535329),r=Na(r,i,s,n,e[o+1],5,-165796510),n=Na(n,r,i,s,e[o+6],9,-1069501632),s=Na(s,n,r,i,e[o+11],14,643717713),i=Na(i,s,n,r,e[o+0],20,-373897302),r=Na(r,i,s,n,e[o+5],5,-701558691),n=Na(n,r,i,s,e[o+10],9,38016083),s=Na(s,n,r,i,e[o+15],14,-660478335),i=Na(i,s,n,r,e[o+4],20,-405537848),r=Na(r,i,s,n,e[o+9],5,568446438),n=Na(n,r,i,s,e[o+14],9,-1019803690),s=Na(s,n,r,i,e[o+3],14,-187363961),i=Na(i,s,n,r,e[o+8],20,1163531501),r=Na(r,i,s,n,e[o+13],5,-1444681467),n=Na(n,r,i,s,e[o+2],9,-51403784),s=Na(s,n,r,i,e[o+7],14,1735328473),i=Na(i,s,n,r,e[o+12],20,-1926607734),r=Fa(r,i,s,n,e[o+5],4,-378558),n=Fa(n,r,i,s,e[o+8],11,-2022574463),s=Fa(s,n,r,i,e[o+11],16,1839030562),i=Fa(i,s,n,r,e[o+14],23,-35309556),r=Fa(r,i,s,n,e[o+1],4,-1530992060),n=Fa(n,r,i,s,e[o+4],11,1272893353),s=Fa(s,n,r,i,e[o+7],16,-155497632),i=Fa(i,s,n,r,e[o+10],23,-1094730640),r=Fa(r,i,s,n,e[o+13],4,681279174),n=Fa(n,r,i,s,e[o+0],11,-358537222),s=Fa(s,n,r,i,e[o+3],16,-722521979),i=Fa(i,s,n,r,e[o+6],23,76029189),r=Fa(r,i,s,n,e[o+9],4,-640364487),n=Fa(n,r,i,s,e[o+12],11,-421815835),s=Fa(s,n,r,i,e[o+15],16,530742520),i=Fa(i,s,n,r,e[o+2],23,-995338651),r=Ua(r,i,s,n,e[o+0],6,-198630844),n=Ua(n,r,i,s,e[o+7],10,1126891415),s=Ua(s,n,r,i,e[o+14],15,-1416354905),i=Ua(i,s,n,r,e[o+5],21,-57434055),r=Ua(r,i,s,n,e[o+12],6,1700485571),n=Ua(n,r,i,s,e[o+3],10,-1894986606),s=Ua(s,n,r,i,e[o+10],15,-1051523),i=Ua(i,s,n,r,e[o+1],21,-2054922799),r=Ua(r,i,s,n,e[o+8],6,1873313359),n=Ua(n,r,i,s,e[o+15],10,-30611744),s=Ua(s,n,r,i,e[o+6],15,-1560198380),i=Ua(i,s,n,r,e[o+13],21,1309151649),r=Ua(r,i,s,n,e[o+4],6,-145523070),n=Ua(n,r,i,s,e[o+11],10,-1120210379),s=Ua(s,n,r,i,e[o+2],15,718787259),i=Ua(i,s,n,r,e[o+9],21,-343485551),r=j_(r,a),i=j_(i,l),s=j_(s,c),n=j_(n,h)}return[r,i,s,n]}function t1e(e,t=Bx.Hex){const r=t||Bx.Base64,i=c7e(s7e(e),e.length*PS);switch(r){case Bx.Raw:return i;case Bx.Hex:return o7e(i);case Bx.String:return n7e(i);case Bx.Base64:return a7e(i)}}var Jj;let zR=Jj=class extends I6{writeLevels(e,t,r){for(const i in e){const s=this.levels[i];return void(t.stops=s)}}clone(){return new Jj({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:G_(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:G_(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:re(this.levels)})}};u([d()],zR.prototype,"levels",void 0),u([Be("levels")],zR.prototype,"writeLevels",null),zR=Jj=u([P("esri.views.2d.engine.LevelDependentSizeVariable")],zR);const u7e=ee.getLogger("esri.views.2d.layers.support.clusterUtils");de.add("esri-cluster-arcade-enabled",!0);const h7e=de("esri-cluster-arcade-enabled"),d7e=(e,t,r,i,s)=>{const n=t.clone();if(!g7e(n))return n;if(n.authoringInfo||(n.authoringInfo=new ZY),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=p7e(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=Zv(e,l.field,"avg_angle","number"):l.valueExpression&&(l.field=hA(e,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=Zv(e,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=Zv(e,l.field,"avg","number"):l.valueExpression&&(l.field=hA(e,l.valueExpression,"avg","number"),l.valueExpression=null)}),E(a)&&!f7e(o)&&s&&(o.push(m7e(r,i)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=Zv(e,o.field,"sum","number"):o.valueExpression&&(o.field=hA(e,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=Zv(e,n.field,"mode","string"):n.valueExpression&&(n.field=hA(e,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=Zv(e,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=Zv(e,n.field,"avg","number"):n.valueExpression&&(n.field=hA(e,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},p7e=e=>{for(const t of e)if(t.type==="size")return t;return null},f7e=e=>{for(const t of e)if(t.field==="cluster_count")return!0;return!1},m7e=(e,t)=>{const r=[new o2({value:0,size:0}),new o2({value:1})];if(E(t))return new I6({field:"cluster_count",stops:[...r,new o2({value:2,size:0})]});const i=Object.keys(t).reduce((s,n)=>({...s,[n]:[...r,new o2({value:Math.max(2,t[n].minValue),size:e.clusterMinSize}),new o2({value:Math.max(3,t[n].maxValue),size:e.clusterMaxSize})]}),{});return new zR({field:"cluster_count",levels:i})},g7e=e=>{const t=r=>u7e.error(new j("Unsupported-renderer",r,{renderer:e}));switch(e.type){case"unique-value":if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(e.normalizationField){const r=e.normalizationType;if(r!=="field")return t(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return t(`FeatureReductionCluster does not support renderers of type ${e.type}`),!1}if(!h7e){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function y7e(e,t,r){switch(e){case"sum":return`cluster_sum_${t}`;case"avg":case"avg_angle":return`cluster_avg_${t}`;case"mode":return`cluster_type_${t}`;case"avg_norm":{const i=r,s="field",n=t.toLowerCase()+",norm:"+s+","+i.toLowerCase();return"cluster_avg_"+t1e(n)}}}function hA(e,t,r,i){const s=t1e(t),n=r==="mode"?`cluster_type_${s}`:r==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return e.some(o=>o.name===n)||e.push(new Bw({name:n,isAutoGenerated:!0,onStatisticExpression:new gZ({expression:t,returnType:i}),statisticType:r})),n}function Zv(e,t,r,i,s){if(t==="cluster_count"||e.some(o=>o.name===t))return t;const n=y7e(r,t,s);return e.some(o=>o.name===n)||(r==="avg_norm"?e.push(new Bw({name:n,isAutoGenerated:!0,onStatisticExpression:new gZ({expression:`$feature.${t} / $feature.${s}`,returnType:i}),statisticType:"avg"})):e.push(new Bw({name:n,isAutoGenerated:!0,onStatisticField:t,statisticType:r}))),n}const _7e=e=>{let t=class extends e{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){var a,l;if((r==null?void 0:r.type)!=="cluster")return r;const i=r.clone(),s=[new Bw({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=((a=i.fields)!=null?a:[]).filter(c=>!c.isAutoGenerated);if(r.renderer&&!((l=r.renderer.authoringInfo)!=null&&l.isAutoGenerated))return i.fields=[...s,...n],i;if(r.symbol)return i.fields=[...s,...n],i.renderer=null,i;if(!this.renderer)return r;const o=d7e(s,this.renderer,r,null,!1);return i.fields=[...s,...n],i.renderer=o,i}};return u([d(i7e)],t.prototype,"featureReduction",null),t=u([P("esri.layers.mixins.FeatureReductionLayer")],t),t},v7e={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},b7e=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&B3e(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r!=null?r:"Layer"}read(r,i){i&&(i.layer=this),spe(this,r,s=>super.read(r,s),i)}write(r,i){var o,a;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=v7e[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(h=!1),!h)return(o=i.messages)==null||o.push(new j("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof j&&l.name==="web-document-write:property-required").length;return fE(s==null?void 0:s.url)?((a=i==null?void 0:i.messages)==null||a.push(new j("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([d(H_e)],t.prototype,"listMode",void 0),u([Be("listMode")],t.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([Be("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([d(Dj)],t.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([Be("title"),Be(["web-scene"],"title")],t.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([P("esri.layers.mixins.OperationalLayer")],t),t};function w7e(e){return"operationalLayerType"in e}var Qj;const Jk=new Vr({asc:"ascending",desc:"descending"});let m2=Qj=class extends fe{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Qj({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],m2.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],m2.prototype,"valueExpression",void 0),u([d({type:Jk.apiValues,json:{read:Jk.read,write:Jk.write}})],m2.prototype,"order",void 0),m2=Qj=u([P("esri.layers.support.OrderByInfo")],m2);const r1e=m2;function x7e(e,t,r){if(!e)return null;const i=e.find(n=>!!n.field);if(!i)return null;const s=new r1e;return s.read(i,r),[s]}function T7e(e,t,r,i){const s=e.find(n=>!!n.field);s&&ol(r,[s.toJSON()],t)}const S7e=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[r1e],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:x7e},write:{target:"layerDefinition.orderBy",writer:T7e}}})],t.prototype,"orderBy",void 0),t=u([P("esri.layers.mixins.OrderedLayer")],t),t};let Z0=class extends Te{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){v(e)&&Lu(e)?ee.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.url;if(E(r))throw new j("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:en(t,"signal")})}async update(e,t){return(await ie(()=>Promise.resolve().then(function(){return E3}),void 0)).addOrUpdateResource(this,"update",e,t)}hasPath(){return v(this.path)}_normalizePath(e,t){return E(e)?e:(e=e.replace(/^\/+/,""),v(t)&&Lu(e)&&(e=AX(e,t.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],Z0.prototype,"portalItem",void 0),u([d({type:String,value:null})],Z0.prototype,"path",null),u([zt("path")],Z0.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],Z0.prototype,"url",null),u([d({type:String,readOnly:!0})],Z0.prototype,"itemRelativeUrl",null),Z0=u([P("esri.portal.PortalItemResource")],Z0);const E7e=Z0;let GR=class extends Te{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],GR.prototype,"created",void 0),u([d()],GR.prototype,"rating",void 0),GR=u([P("esri.portal.PortalRating")],GR);const Qk=GR;var ab;const C7e=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),A7e=new Set(["KML","GeoJson","CSV"]);let yr=ab=class extends nP(Tm){static from(e){return KS(ab,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return e==="Feature Service"||e==="Feature Collection"?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?r="Scene Layer":e==="Video Service"?r="Video Layer":e==="Scene Package"?r="Scene Layer Package":e==="Stream Service"?r="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?r="Locator":e==="Geoenrichment Service"?r="GeoEnrichment Service":e==="Microsoft Powerpoint"?r="Microsoft PowerPoint":e==="GeoJson"?r="GeoJSON":e==="Globe Service"?r="Globe Layer":e==="Vector Tile Service"?r="Tile Layer":e==="netCDF"?r="NetCDF":e==="Map Service"?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?r=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?r="Big Data File Share":e==="Compact Tile Package"?r="Tile Package (tpkx)":e==="OGCFeatureServer"?r="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")?r="Instant App":e==="Insights Page"&&(r="Insights Report"),r}readExtent(e){return e&&e.length?new qr(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="pro report template"?"proreporttemplate":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"||e==="notebook code snippet library"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":e==="discussion"?"discussion":e==="allsource project"?"allsourceproject":e==="api key"?"apikey":"maps",s?Kr(r+s+i+".png"):null}get isLayer(){return this.type!=null&&C7e.has(this.type)}get itemPageUrl(){var t;const e=(t=this.portal)==null?void 0:t.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){var t;const e=(t=this.portal)==null?void 0:t.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){var r,i;const e=this.itemUrl,t=this.thumbnail;return e&&t&&(i=(r=this.portal)==null?void 0:r.normalizeUrl(`${e}/info/${t}?f=json`))!=null?i:null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){var i;const t=(i=this.portal)!=null?i:this.portal=Uo.getDefault(),r=t.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:v(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(s=>{this.sourceJSON=s,this.read(s)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof Qk&&(e=e.rating),e==null||isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new Qk({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:re(this.applicationProxies),avgRating:this.avgRating,categories:re(this.categories),created:re(this.created),culture:this.culture,description:this.description,extent:re(this.extent),groupCategories:re(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:re(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:re(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:re(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:re(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new ab({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const r of["tags","typeKeywords","categories"])e[r]&&(e[r]=e[r].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}async deleteRating(){await Ul(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return Ul(this.portal).request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await Ul(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return t.rating!=null?(t.created=new Date(t.created),new Qk(t)):null}fetchRelatedItems(e,t){return Ul(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},ab)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){var e;return Ul(this.portal).request((e=this.itemUrl)!=null?e:"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(e){return this.id?this.load().then(()=>Ul(this.portal).signIn()).then(()=>{const t=e&&e.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?r.query.text=t:typeof t=="object"&&(r.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new j("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new j("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:r}=this;await Ul(t).signIn();const{copyResources:i,folder:s,tags:n,title:o}=e||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!i,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await t.request(`${r}/copy`,a);return new ab({id:l,portal:t})}updateThumbnail(e){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const t=e.thumbnail,r=e.filename,i={method:"post"};if(typeof t=="string")Im(t)?i.query={data:t}:i.query={url:Ru(t)},v(r)&&(i.query.filename=r);else{const s=new FormData;v(r)?s.append("file",t,r):s.append("file",t),i.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new j("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await ie(()=>Promise.resolve().then(function(){return E3}),void 0)).fetchResources(this,e,t)}async addResource(e,t,r){const i=await ie(()=>Promise.resolve().then(function(){return E3}),void 0);return e.portalItem=this,i.addOrUpdateResource(e,"add",t,r)}async removeResource(e,t){const r=await ie(()=>Promise.resolve().then(function(){return E3}),void 0);if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new j("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r.removeResource(this,e,t)}async removeAllResources(e){return(await ie(()=>Promise.resolve().then(function(){return E3}),void 0)).removeAllResources(this,e)}resourceFromPath(e){return new E7e({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:re(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:re(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:re(this.typeKeywords),url:this.url};return ode(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new ab({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([d({type:["private","shared","org","public"]})],yr.prototype,"access",void 0),u([d()],yr.prototype,"accessInformation",void 0),u([d({type:String})],yr.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],yr.prototype,"applicationProxies",void 0),u([d()],yr.prototype,"avgRating",void 0),u([d()],yr.prototype,"categories",void 0),u([d({type:Date})],yr.prototype,"created",void 0),u([d()],yr.prototype,"culture",void 0),u([d()],yr.prototype,"description",void 0),u([d({readOnly:!0})],yr.prototype,"displayName",null),u([d({type:qr})],yr.prototype,"extent",void 0),u([De("extent")],yr.prototype,"readExtent",null),u([d()],yr.prototype,"groupCategories",void 0),u([d({readOnly:!0})],yr.prototype,"iconUrl",null),u([d()],yr.prototype,"id",void 0),u([d({readOnly:!0})],yr.prototype,"isLayer",null),u([d({type:Boolean,readOnly:!0})],yr.prototype,"isOrgItem",void 0),u([d()],yr.prototype,"itemControl",void 0),u([d({readOnly:!0})],yr.prototype,"itemPageUrl",null),u([d({readOnly:!0})],yr.prototype,"itemUrl",null),u([d()],yr.prototype,"licenseInfo",void 0),u([d({type:Date})],yr.prototype,"modified",void 0),u([d()],yr.prototype,"name",void 0),u([d()],yr.prototype,"numComments",void 0),u([d()],yr.prototype,"numRatings",void 0),u([d()],yr.prototype,"numViews",void 0),u([d()],yr.prototype,"owner",void 0),u([d()],yr.prototype,"ownerFolder",void 0),u([d({type:Uo})],yr.prototype,"portal",void 0),u([d()],yr.prototype,"screenshots",void 0),u([d()],yr.prototype,"size",void 0),u([d()],yr.prototype,"snippet",void 0),u([d()],yr.prototype,"sourceJSON",void 0),u([d({type:String})],yr.prototype,"sourceUrl",void 0),u([d({type:String})],yr.prototype,"spatialReference",void 0),u([d()],yr.prototype,"tags",void 0),u([d()],yr.prototype,"thumbnail",void 0),u([d({readOnly:!0})],yr.prototype,"thumbnailUrl",null),u([d()],yr.prototype,"title",void 0),u([d()],yr.prototype,"type",void 0),u([d()],yr.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(e,t){var r;if(A7e.has(t.type)){const i=(r=this.portal)==null?void 0:r.restUrl;e||(e=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return e}}})],yr.prototype,"url",void 0),u([d({readOnly:!0})],yr.prototype,"userItemUrl",null),yr=ab=u([P("esri.portal.PortalItem")],yr);const gw=yr;var i1e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:gw});async function R7e(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return H2(e);const r=Ye.WGS84;return await vLe(t,r),bC(e,r)}function m2t(e,t){if(!O7e(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function O7e(e,t){var r;return!!((r=e.typeKeywords)!=null&&r.includes(t))}function g2t(e,t){const r=e.typeKeywords;if(r){const i=r.indexOf(t);i>-1&&r.splice(i,1)}}async function y2t(e){const t=e.clone().normalize();let r;if(t.length>1)for(const i of t)r?i.width>r.width&&(r=i):r=i;else r=t[0];return R7e(r)}const _2t={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"};function Tie(e){var l;const{portal:t,isOrgItem:r,itemControl:i}=e,s=(l=t.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!r&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=i==="update"||i==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}const M7e=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=Ve(this.portalItem)}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new gw({id:i.itemId,portal:s&&s.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const s=await ie(()=>import("./layersLoader.b6701a4d.js"),["assets/layersLoader.b6701a4d.js","assets/fetchService.d8bf9569.js","assets/jsonContext.fc22b0d2.js"]);return cr(i),await s.load({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(s){throw sn(s)||ee.getLogger(this.declaredClass).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Sc(i),!0)))}async _setUserPrivileges(r,i){if(!ni.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Sc(s)}}async _fetchUserPrivileges(r,i){let s=this.portalItem;if(!r||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(i);const n=r===s.id;if(n&&s.portal.user)return Tie(s);let o,a;if(n)o=s.portal.url;else try{o=await dye(this.url,i)}catch(p){Sc(p)}if(!o||!ZPe(o,s.portal.url))return this._fetchFallbackUserPrivileges(i);try{const p=v(i)?i.signal:null;a=await(Ci==null?void 0:Ci.getCredential(`${o}/sharing`,{prompt:!1,signal:p}))}catch(p){Sc(p)}const l=!0,c=!1,h=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:h}};try{if(n?await s.reload():(s=new gw({id:r,portal:{url:o}}),await s.load(i)),s.portal.user)return Tie(s)}catch(p){Sc(p)}return{features:{edit:l,fullEdit:c},content:{updateItem:h}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(s){Sc(s)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?Ci==null?void 0:Ci.findCredential(this.url):null;if(!i)return!0;const s=e$.credential===i?e$.user:await this._fetchEditingUser(r);return e$.credential=i,e$.user=s,E(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var h,p,f;const i=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(i)return i;const s=Ci.findServerInfo((f=this.url)!=null?f:"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Uo.getDefault();if(o&&o.loaded&&jh(o.restUrl)===jh(n))return o.user;const a=`${n}/community/self`,l=v(r)?r.signal:null,c=await Vc(Di(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?NX.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const s=i&&i.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Uo.getDefault());return s&&n&&!zfe(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new j("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([d({type:gw})],t.prototype,"portalItem",null),u([De("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([Be("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([d({clonable:!1})],t.prototype,"resourceReferences",void 0),u([d({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),u([d({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=u([P("esri.layers.mixins.PortalLayer")],t),t},e$={credential:null,user:null};let jR=class extends Te{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([d()],jR.prototype,"updating",void 0),u([d()],jR.prototype,"status",void 0),jR=u([P("esri.layers.support.PublishingInfo")],jR);const P7e=jR,s1e="esri.layers.mixins.PublishableLayer",I7e=Symbol(s1e),$7e=e=>{var t;let r=class extends e{constructor(){super(...arguments),this[t]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const s=new P7e;return this._checkPublishingStatus(s),s}_checkPublishingStatus(i){let o=0;const a=async c=>{let h;i.updating=!0;try{h=await this.fetchPublishingStatus()}catch{h="unavailable"}h!=="published"&&h!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=h,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return t=I7e,u([d({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=u([P(s1e)],r),r},JO=new pt,Z3=new WeakMap;function L7e(e){n1e(e)&&JO.push(e)}function D7e(e){n1e(e)&&JO.includes(e)&&JO.remove(e)}function n1e(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function o1e(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:o1e(t,e%t):0}let Kk=0,t$=0;function N7e(){var t;const e=Date.now();for(const r of JO)r.refreshInterval&&e-((t=Z3.get(r))!=null?t:0)+5>=6e4*r.refreshInterval&&(Z3.set(r,e),r.refresh(e))}Nde(()=>{const e=Date.now();let t=0;for(const r of JO)t=o1e(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?Z3.get(r)||Z3.set(r,e):Z3.delete(r);if(t!==t$){if(t$=t,clearInterval(Kk),t$===0)return void(Kk=0);Kk=setInterval(N7e,t$)}});function F7e(e){return e!=null&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const U7e=e=>{let t=class extends e{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=PW(()=>this.hasDataChanged()),this.when().then(()=>{L7e(this)},()=>{})}destroy(){D7e(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){_S(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{ee.getLogger(this.declaredClass).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([d()],t.prototype,"refreshParameters",null),t=u([P("esri.layers.mixins.RefreshableLayer")],t),t},k7e=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&V7e(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([P("esri.layers.mixins.ScaleRangeLayer")],t),t};function V7e(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const a1e=Ia()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let HR=class extends Ss(fe){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return e8e(this.value,this.unit,"milliseconds")}};u([ft(a1e,{nonNullable:!0})],HR.prototype,"unit",void 0),u([d({type:Number,json:{write:!0},nonNullable:!0})],HR.prototype,"value",void 0),HR=u([P("esri.TimeInterval")],HR);const n4=HR;function Sie(e,t){return n4.fromJSON({value:e,unit:t})}let ja=class extends Ss(fe){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const r=new Date(t.timeExtent[0]),i=new Date(t.timeExtent[1]);return new Lm({start:r,end:i})}writeFullTimeExtent(e,t){e&&v(e.start)&&v(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?Sie(t.timeInterval,t.timeIntervalUnits):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?Sie(t.defaultTimeInterval,t.defaultTimeIntervalUnits):null}writeInterval(e,t){var r,i;t.timeInterval=(r=e==null?void 0:e.toJSON().value)!=null?r:null,t.timeIntervalUnits=(i=e==null?void 0:e.toJSON().unit)!=null?i:null}};u([d({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],ja.prototype,"cumulative",void 0),u([d({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],ja.prototype,"endField",void 0),u([d({type:Lm,json:{write:{enabled:!0,allowNull:!0}}})],ja.prototype,"fullTimeExtent",void 0),u([De("fullTimeExtent",["timeExtent"])],ja.prototype,"readFullTimeExtent",null),u([Be("fullTimeExtent")],ja.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],ja.prototype,"hasLiveData",void 0),u([d({type:n4,json:{write:{enabled:!0,allowNull:!0}}})],ja.prototype,"interval",void 0),u([De("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],ja.prototype,"readInterval",null),u([Be("interval")],ja.prototype,"writeInterval",null),u([d({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],ja.prototype,"startField",void 0),u([d({type:ME,json:{write:{enabled:!0,allowNull:!0}}})],ja.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],ja.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],ja.prototype,"useTime",void 0),ja=u([P("esri.layers.support.TimeInfo")],ja);const l1e=ja,B7e=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const s=i.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=a1e.fromJSON(s.timeOffsetUnits);return n&&o?new n4({value:n,unit:o}):null}set timeInfo(r){qpe(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([d({type:Lm,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([d({type:n4})],t.prototype,"timeOffset",void 0),u([De("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([d({value:null,type:l1e,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([P("esri.layers.mixins.TemporalLayer")],t),t},Eie=new Vr({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let J0=class extends Ss(fe){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],J0.prototype,"name",void 0),u([d({json:{write:!0}})],J0.prototype,"description",void 0),u([d({json:{read:Eie.read,write:Eie.write}})],J0.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],J0.prototype,"prototype",void 0),u([d({json:{write:!0}})],J0.prototype,"thumbnail",void 0),J0=u([P("esri.layers.support.FeatureTemplate")],J0);const bZ=J0;let Eg=class extends Ss(fe){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r of Object.keys(e))t[r]=UY(e[r]);return t}writeDomains(e,t){var i;const r={};for(const s of Object.keys(e))e[s]&&(r[s]=(i=e[s])==null?void 0:i.toJSON());t.domains=r}};u([d({json:{write:!0}})],Eg.prototype,"id",void 0),u([d({json:{write:!0}})],Eg.prototype,"name",void 0),u([d({json:{write:!0}})],Eg.prototype,"domains",void 0),u([De("domains")],Eg.prototype,"readDomains",null),u([Be("domains")],Eg.prototype,"writeDomains",null),u([d({type:[bZ],json:{write:!0}})],Eg.prototype,"templates",void 0),Eg=u([P("esri.layers.support.FeatureType")],Eg);const c1e=Eg;function z7e(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function Cie(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function Aie(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class G7e{constructor(t=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;this.fields=t;const r=[];for(const i of t){const s=i==null?void 0:i.name,n=Oie(i==null?void 0:i.name);if(s&&n){const o=Rie(s);this._fieldsMap.set(s,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(n,i),r.push(o),z7e(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):D5(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),Cie(i)||Aie(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)Cie(t)||Aie(t)||t.nullable||TMe(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){var i;if(!t)return;let r=this._fieldsMap.get(t);return r||(r=(i=this._fieldsMap.get(Rie(t)))!=null?i:this._normalizedFieldsMap.get(Oie(t)),r&&this._fieldsMap.set(t,r),r)}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){var i;const r=this.get(t);if(r)return(i=r.name)!=null?i:void 0}}function Rie(e){return e.trim().toLowerCase()}function Oie(e){var t,r;return(r=(t=fMe(e))==null?void 0:t.toLowerCase())!=null?r:""}function j7e(){return{fields:{type:[R6],value:null},fieldsIndex:{readOnly:!0,get(){return new G7e(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){var t;const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const r of e)((t=this.fieldsIndex)==null?void 0:t.has(r))||ee.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${r} found in outFields`,{layer:this,outFields:e});return Wpe(this.fieldsIndex,e)}}}}const e9=ee.getLogger("esri.layers.support.labelingInfo"),H7e=/\[([^\[\]]+)\]/gi;function Mie(e,t,r){return e?e.map(i=>{const s=new k6;if(s.read(i,r),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(H7e,(o,a)=>`[${q7e(a,n)}]`)}return s}):null}function q7e(e,t){if(!t)return e;const r=e.toLowerCase();for(let i=0;i<t.length;i++){const s=t[i].name;if(s.toLowerCase()===r)return s}return e}const W7e={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function v2t(e,t){const r=re(e);return r.some(i=>X7e(i,t))?[]:r}function X7e(e,t){const r=e.labelPlacement,i=W7e[t];if(!e.symbol)return e9.warn("No ILabelClass symbol specified."),!0;if(!i)return e9.error(new j("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${t}' is not supported`)),!0;if(!i.includes(r)){const s=i[0];r&&e9.warn(`Found invalid label placement type ${r} for ${t}. Defaulting to ${s}`),e.labelPlacement=s}return!1}const kd=[];function Y7e(e,t){var i,s;if(B_e((i=e.url)!=null?i:""))return!0;const{wkid:r}=t;for(const n of kd){if(((s=e.version)!=null?s:0)>=n[0])return!0;if(typeof n[1]=="function"&&(n[1]=n[1]()),n[1].has(r))return!1}return!0}kd.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),kd.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),kd.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),kd.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),kd.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=22619;t<=22621;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);return e}]),kd.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),kd.push([10.61,()=>new Set([102497])]),kd.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),kd.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),kd.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function Z7e(e,t,r){const i=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const s=await Vc(i.populateFromStyle());if(cr(r),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Uu("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t==null?void 0:t.origin)}}}const J7e=["oid","global-id"],Q7e=["oid","global-id","guid"];function K7e({displayField:e,editFieldsInfo:t,fields:r,objectIdField:i,title:s},n){if(!r)return null;const o=nGe({editFieldsInfo:t,fields:r,objectIdField:i},n);if(!o.length)return null;const a=lGe({titleBase:s,fields:r,displayField:e}),l=aGe();return new uP({title:a,content:l,fieldInfos:o})}const eGe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],tGe=(e,{editFieldsInfo:t,objectIdField:r,visibleFieldNames:i})=>i?i.has(e.name):!u1e(e.name,t)&&(!r||e.name!==r)&&!J7e.includes(e.type)&&!eGe.some(s=>s.test(e.name));function rGe(e,t){const r=e;return t&&(e=e.filter(i=>!t.includes(i.type))),e===r&&(e=e.slice()),e.sort(iGe),e}function iGe(e,t){return e.type==="oid"?-1:t.type==="oid"?1:Pie(e)?-1:Pie(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function u1e(e,t){if(!e||!t)return!1;const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=t;return[r&&r.toLowerCase(),i&&i.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function sGe(e,t){return e.editable&&!Q7e.includes(e.type)&&!u1e(e.name,t)}function nGe({editFieldsInfo:e,fields:t,objectIdField:r},i){return rGe(t!=null?t:[],(i==null?void 0:i.ignoreFieldTypes)||cGe).map(s=>new lP({fieldName:s.name,isEditable:sGe(s,e),label:s.alias,format:oGe(s),visible:tGe(s,{editFieldsInfo:e,objectIdField:r,visibleFieldNames:i==null?void 0:i.visibleFieldNames})}))}function oGe(e){switch(e.type){case"small-integer":case"integer":case"single":return new q2({digitSeparator:!0,places:0});case"double":return new q2({digitSeparator:!0,places:2});case"date":return new q2({dateFormat:"long-month-day-year"});default:return e.type==="string"&&Kpe(e.name)?new q2({digitSeparator:!0,places:0}):null}}function aGe(){return[new cE,new IO]}function lGe(e){const t=yMe(e),{titleBase:r}=e;return t?`${r}: {${t.trim()}}`:r!=null?r:""}function Pie(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"}const cGe=["geometry","blob","raster","guid","xml"],ml="FeatureLayer",h1e="esri.layers.FeatureLayer",uGe=ee.getLogger(h1e);function r$(e,t){return new j("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function Iie(e){return e&&e instanceof pt}const t9=j7e();function r9(e,t,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let _t=class extends Pze(_7e(D9e($7e(I9e(O9e(S7e(B7e(k7e(U7e(R9e(b7e(M7e(iZ(M9e(b9e(Ss(ZO))))))))))))))))){constructor(...e){super(...e),this._handles=new Jr,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Ye.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=Ve(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}load(e){var i;const t=v(e)?e.signal:null;if(((i=this.portalItem)==null?void 0:i.loaded)&&this.source)return this.addResolvingPromise(this.createGraphicsSource(t).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Sc).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(t);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new j("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>mze(this,e));return this.addResolvingPromise(r),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,Wve(t,this.url)}get createQueryVersion(){var e;return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),((e=this._get("createQueryVersion"))!=null?e:0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,r){return this._readEditingEnabled(t,!0,r)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,r,i){this._writeEditingEnabled(e,t,!0,i)}get effectiveEditingEnabled(){return gze(this)}readIsTable(e,t){var r;return(t=(r=t==null?void 0:t.layerDefinition)!=null?r:t).type==="Table"||!t.geometryType}writeIsTable(e,t,r,i){i!=null&&i.writeLayerSchema&&ol(r,e?"Table":"Feature Layer",t)}readGlobalIdField(e,t){return Hve(t.layerDefinition||t)}readObjectIdField(e,t){return qve(t.layerDefinition||t)}get parsedUrl(){const e=po(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=ku(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=ku(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){JK(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,r){var s,n;const i=(s=(t=t.layerDefinition||t).drawingInfo)==null?void 0:s.renderer;if(i){const o=(n=KF(i,t,r))!=null?n:void 0;return o||uGe.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),o}if(t.defaultSymbol)return t.types&&t.types.length?new AP({defaultSymbol:i9(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map(o=>({id:o.id,symbol:i9(o.symbol,o,r)}))}):new AE({symbol:i9(t.defaultSymbol,t,r)})}set source(e){const t=this._get("source");t!==e&&(Iie(t)&&this._resetMemorySource(t),Iie(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof pt?new Dg({layer:this,items:e}):e:null}readSource(e,t){var i;const r=BY.fromJSON(t.featureSet);return new Dg({layer:this,items:(i=r==null?void 0:r.features)!=null?i:[]})}readTemplates(e,t){const r=t.editFieldsInfo,i=r&&r.creatorField,s=r&&r.editorField;return e=e&&e.map(n=>bZ.fromJSON(n)),this._fixTemplates(e,i),this._fixTemplates(e,s),e}readTitle(e,t){var s,n;const r=(n=(s=t.layerDefinition)==null?void 0:s.name)!=null?n:t.name,i=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?S9e(this.url,r):r;let a=r;if(!a&&this.url){const l=RC(this.url);v(l)&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),nZ(a)):void 0}if(this.sublayerTitleMode==="item-title"&&i)return i}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let r=(t=t.layerDefinition||t).typeIdField;if(r&&t.fields){r=r.toLowerCase();const i=t.fields.find(s=>s.name.toLowerCase()===r);i&&(r=i.name)}return r}readTypes(e,t){e=(t=t.layerDefinition||t).types;const r=t.editFieldsInfo,i=r&&r.creatorField,s=r&&r.editorField;return e&&e.map(n=>(n=c1e.fromJSON(n),this._fixTemplates(n.templates,i),this._fixTemplates(n.templates,s),n))}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}async addAttachment(e,t){return eze(this,e,t,ml)}async updateAttachment(e,t,r){return tze(this,e,t,r,ml)}async applyEdits(e,t){return rze(this,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return K7e(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:t}=await MW(ie(()=>import("./FeatureLayerSource.2ec8d03e.js"),["assets/FeatureLayerSource.2ec8d03e.js","assets/assetEditingSupport.240adbda.js","assets/clientSideDefaults.c880334e.js","assets/QueryEngineCapabilities.ea616409.js","assets/QueryTask.8a0cd7cf.js","assets/executeForIds.2b431ace.js"]),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=dze(this);e.dynamicDataSource=this.dynamicDataSource;const t=v(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,r=t9e(this.definitionExpression,t);return e.where=r||"1=1",e}async deleteAttachments(e,t){return ize(this,e,t,ml)}async fetchRecomputedExtents(e){return sze(this,e,ml)}getFeatureType(e){const{typeIdField:t,types:r}=this;if(!t||!e)return null;const i=e.attributes?e.attributes[t]:void 0;if(i==null)return null;let s=null;return r==null||r.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===i.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const r=t&&t.feature,i=this.getFeatureType(r);if(i){const s=i.domains&&i.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,t){return nze(this,e,t,ml)}async queryFeatures(e,t){var s;const r=await this.load(),i=await r.source.queryFeatures((s=cm.from(e))!=null?s:r.createQuery(),t);if(i!=null&&i.features)for(const n of i.features)n.layer=n.sourceLayer=r;return i}async queryObjectIds(e,t){return oze(this,e,t,ml)}async queryFeatureCount(e,t){return aze(this,e,t,ml)}async queryExtent(e,t){return lze(this,e,t,ml)}async queryRelatedFeatures(e,t){return cze(this,e,t,ml)}async queryRelatedFeaturesCount(e,t){return uze(this,e,t,ml)}async queryTopFeatures(e,t){var n;const{source:r,capabilities:i}=await this.load();if(!r.queryTopFeatures||!((n=i==null?void 0:i.query)!=null&&n.supportsTopFeaturesQuery))throw new j(ml,"Layer source does not support queryTopFeatures capability");const s=await r.queryTopFeatures(FI.from(e),t);if(s!=null&&s.features)for(const o of s.features)o.layer=o.sourceLayer=this;return s}async queryTopObjectIds(e,t){const{source:r,capabilities:i}=await this.load();if(!r.queryTopObjectIds||!(i!=null&&i.query.supportsTopFeaturesQuery))throw new j(ml,"Layer source does not support queryTopObjectIds capability");return r.queryTopObjectIds(FI.from(e),t)}async queryTopFeaturesExtent(e,t){var s;const{source:r,capabilities:i}=await this.load();if(!r.queryTopExtents||!((s=i==null?void 0:i.query)!=null&&s.supportsTopFeaturesQuery))throw new j(ml,"Layer source does not support queryTopExtents capability");return r.queryTopExtents(FI.from(e),t)}async queryTopFeatureCount(e,t){var s;const{source:r,capabilities:i}=await this.load();if(!r.queryTopCount||!((s=i==null?void 0:i.query)!=null&&s.supportsTopFeaturesQuery))throw new j(ml,"Layer source does not support queryFeatureCount capability");return r.queryTopCount(FI.from(e),t)}read(e,t){const r=e.featureCollection;if(r){const i=r.layers;i&&i.length===1&&(super.read(i[0],t),r.showLegend!=null&&super.read({showLegend:r.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,t){var n,o;t={...t,origin:(n=t==null?void 0:t.origin)!=null?n:void 0,writeLayerSchema:(o=t==null?void 0:t.writeLayerSchema)!=null?o:this._hasMemorySource()};const{origin:r,layerContainerType:i,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push(r$(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(r==="web-scene"||r==="web-map"&&i!=="tables")return s==null||s.push(r$(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(r$(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&r==="web-map"&&i==="tables")return s==null||s.push(r$(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new j(ml,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var t;return!!this.loaded&&(((t=this.source)==null?void 0:t.type)==="memory"||Y7e(this,e))}async save(e){return(await ie(()=>import("./featureLayerUtils.a2eb717e.js"),["assets/featureLayerUtils.a2eb717e.js","assets/fetchService.d8bf9569.js","assets/jsonContext.fc22b0d2.js"])).save(this,e)}async saveAs(e,t){return(await ie(()=>import("./featureLayerUtils.a2eb717e.js"),["assets/featureLayerUtils.a2eb717e.js","assets/fetchService.d8bf9569.js","assets/jsonContext.fc22b0d2.js"])).saveAs(this,e,t)}_readEditingEnabled(e,t,r){var s;let i=(s=e.layerDefinition)==null?void 0:s.capabilities;return i?this._hasEditingCapability(i):(i=e.capabilities,t&&(r==null?void 0:r.origin)==="web-map"&&!this._hasMemorySource()&&i?this._hasEditingCapability(i):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,r,i){var s,n;if(!e){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";ol("layerDefinition.capabilities",o,t),r&&!(i!=null&&i.writeLayerSchema)&&(t.capabilities=o)}}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return Di(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(t=>{const r=t.data;if(r)return Array.isArray(r.layers)&&r.layers.length>0?r.layers[0].id:Array.isArray(r.tables)&&r.tables.length>0?r.tables[0].id:void 0})}async initLayerProperties(e){var t;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(t=this.portalItem)==null?void 0:t.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),JK(this.renderer,this.fieldsIndex),qpe(this.timeInfo,this.fieldsIndex),Z7e(this,{origin:"service"})}async hasDataChanged(){return hze(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var t,r,i;const e=(r=(t=this.parsedUrl)==null?void 0:t.path)!=null?r:"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((i=this.fields)==null?void 0:i.some(s=>s.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(r=>{const i=r.prototype&&r.prototype.attributes;i&&t&&delete i[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new j("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new j("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([De("service","capabilities")],_t.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],_t.prototype,"charts",void 0),u([d({readOnly:!0})],_t.prototype,"createQueryVersion",null),u([d({json:{read:{source:"layerDefinition.copyrightText"}}})],_t.prototype,"copyright",void 0),u([d({json:{read:{source:"layerDefinition.displayField"}}})],_t.prototype,"displayField",void 0),u([d({types:uw,readOnly:!0})],_t.prototype,"defaultSymbol",void 0),u([d({type:Kd})],_t.prototype,"dynamicDataSource",void 0),u([d({type:Boolean})],_t.prototype,"editingEnabled",null),u([De(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],_t.prototype,"readEditingEnabled",null),u([De("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],_t.prototype,"readEditingEnabledFromWebMap",null),u([Be(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],_t.prototype,"writeEditingEnabled",null),u([Be("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],_t.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],_t.prototype,"effectiveEditingEnabled",null),u([d({...t9.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:r9}}}}})],_t.prototype,"fields",void 0),u([d(t9.fieldsIndex)],_t.prototype,"fieldsIndex",void 0),u([d({type:p9e,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],_t.prototype,"formTemplate",void 0),u([d({json:{read:{source:"layerDefinition.extent"}}})],_t.prototype,"fullExtent",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:r9,writer(e,t,r){const i=e?zj.toJSON(e):null;i&&ol(r,i,t)}}}},read:{source:"layerDefinition.geometryType",reader:zj.read}}})],_t.prototype,"geometryType",void 0),u([d({json:{read:{source:"layerDefinition.hasM"}}})],_t.prototype,"hasM",void 0),u([d({json:{read:{source:"layerDefinition.hasZ"}}})],_t.prototype,"hasZ",void 0),u([d(X9e)],_t.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],_t.prototype,"infoFor3D",void 0),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],_t.prototype,"isTable",void 0),u([De("service","isTable",["type","geometryType"]),De("isTable",["layerDefinition.type","layerDefinition.geometryType"])],_t.prototype,"readIsTable",null),u([Be("web-map","isTable")],_t.prototype,"writeIsTable",null),u([d(aZ)],_t.prototype,"labelsVisible",void 0),u([d({type:[k6],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:Mie},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Mie},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],_t.prototype,"labelingInfo",void 0),u([d((()=>{const e=re(W9e);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,r,i){ol(i,hP(t),r)}}},e})())],_t.prototype,"opacity",void 0),u([d(H9e)],_t.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const e=re(H_e.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],_t.prototype,"listMode",void 0),u([De("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],_t.prototype,"readGlobalIdField",null),u([d({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:r9}}}}})],_t.prototype,"objectIdField",void 0),u([De("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],_t.prototype,"readObjectIdField",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],_t.prototype,"operationalLayerType",void 0),u([d(t9.outFields)],_t.prototype,"outFields",void 0),u([d({readOnly:!0})],_t.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],_t.prototype,"path",void 0),u([d(oZ)],_t.prototype,"popupEnabled",void 0),u([d({type:uP,json:{name:"popupInfo",write:!0}})],_t.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],_t.prototype,"defaultPopupTemplate",null),u([d({types:$6,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:Jke,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],_t.prototype,"renderer",null),u([De("service","renderer",["drawingInfo.renderer","defaultSymbol"]),De("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],_t.prototype,"readRenderer",null),u([d((()=>{const e=re(G9e);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],_t.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],_t.prototype,"source",null),u([zt("source")],_t.prototype,"castSource",null),u([De("portal-item","source",["featureSet"]),De("web-map","source",["featureSet"])],_t.prototype,"readSource",null),u([d({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],_t.prototype,"spatialReference",void 0),u([d({type:Number})],_t.prototype,"subtypeCode",void 0),u([d({type:[bZ]})],_t.prototype,"templates",void 0),u([De("templates",["editFieldsInfo","creatorField","editorField","templates"])],_t.prototype,"readTemplates",null),u([d({type:l1e})],_t.prototype,"timeInfo",void 0),u([d()],_t.prototype,"title",void 0),u([De("service","title",["name"]),De("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],_t.prototype,"readTitle",null),u([De("web-map","title",["layerDefinition.name","title"])],_t.prototype,"readTitleFromWebMap",null),u([d({type:String})],_t.prototype,"sublayerTitleMode",void 0),u([d({json:{read:!1}})],_t.prototype,"type",void 0),u([d({type:String})],_t.prototype,"typeIdField",void 0),u([De("service","typeIdField"),De("typeIdField",["layerDefinition.typeIdField"])],_t.prototype,"readTypeIdField",null),u([d({type:[c1e]})],_t.prototype,"types",void 0),u([De("service","types",["types"]),De("types",["layerDefinition.types"])],_t.prototype,"readTypes",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],_t.prototype,"visible",void 0),u([De("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],_t.prototype,"readVisible",null),_t=u([P(h1e)],_t);const i9=Pv({types:J5}),d1e=_t;var b2t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:d1e});const hGe=["$datastore","$map","$layer","$aggregatedfeatures"],dGe="esri.widgets.Feature.support.arcadeFeatureUtils",pGe=ee.getLogger(dGe);function fGe(e){return typeof e=="string"?bP(CY(e)):Array.isArray(e)?mGe(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?gGe(e):e}function mGe(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?bP(CY(t)):t}</li>`).join("")}</ul>`}function gGe(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const r=e.field(t);return`<tr><th>${t}</th><td>${typeof r=="string"?bP(CY(r)):r}</td></tr>`}).join("")}</table>`}function yGe({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:r,context:i,viewInfo:s,map:n,graphic:o,interceptor:a}){r.forEach(l=>{const c=l.toLowerCase(),h=s.sr,p={map:n,spatialReference:h,interceptor:a};if(c==="$map"&&(i.vars[c]=t.convertMapToFeatureSetCollection(p)),c==="$layer"&&(i.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:h,interceptor:a})),c==="$datastore"&&(i.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:h,interceptor:a})),c==="$aggregatedfeatures"){const f=o.layer,{fields:m,objectIdField:y,geometryType:_,spatialReference:b,displayField:x}=f,T=new d1e({fields:m,objectIdField:y,geometryType:_,spatialReference:b,displayField:x,...f.type==="feature"?{templates:f.templates,typeIdField:f.typeIdField,types:f.types}:null,source:e});i.vars[c]=t.convertFeatureLayerToFeatureSet({layer:T,spatialReference:b,interceptor:a})}})}function p1e(){return ie(()=>import("./arcadeUtils.24dabaae.js").then(function(e){return e.ax}),["assets/arcadeUtils.24dabaae.js","assets/arcadeTimeUtils.001f6459.js","assets/executionError.c4c51b90.js","assets/number.45471352.js","assets/hash.079e8d2d.js"])}function _Ge(e){return"createQuery"in e&&"queryFeatures"in e}async function vGe({graphic:e,view:t}){const{isAggregate:r,layer:i}=e;if(!r||!i||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(i);if(!_Ge(s))return[];const n=s.createQuery(),o=e.getObjectId();n.aggregateIds=o!=null?[o]:[];const{features:a}=await s.queryFeatures(n);return a}async function f1e({expressionInfo:e,arcadeUtils:t,interceptor:r,spatialReference:i,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=hGe.filter(m=>t.hasVariable(a,m)),[c]=await Promise.all([vGe({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:i}),p=t.createExecContext(n,h);p.interceptor=r,p.useAsync=!0,yGe({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:r});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(m=>pGe.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:e}))}async function bGe({expressionInfos:e,spatialReference:t,graphic:r,interceptor:i,map:s,view:n}){if(!e||!e.length)return{};const o=await p1e(),a={};for(const h of e)a[`expression/${h.name}`]=f1e({expressionInfo:h,arcadeUtils:o,interceptor:i,spatialReference:t,map:s,graphic:r,view:n});const l=await fo(a),c={};for(const h in l)c[h]=fGe(l[h].value);return c}const wGe=1;let nu=class extends xx(Te){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var i,s;const t=(i=this.contentElement)==null?void 0:i.type;(s=this.contentElementViewModel)==null||s.destroy();const r=t==="fields"?new v6:t==="media"?new ew:t==="text"?new YF:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=SS(this._compile,wGe,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:r,interceptor:i,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&r&&s&&n))return void this._set("contentElement",null);const l=await p1e();if(a!==this._abortController)return;const c=await f1e({arcadeUtils:l,expressionInfo:t,graphic:r,interceptor:i,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await c.castAsJsonAsync(a==null?void 0:a.signal),p=h==null?void 0:h.type,f=p==="media"?DO.fromJSON(h):p==="text"?uE.fromJSON(h):p==="fields"?cE.fromJSON(h):null;this._set("contentElement",f)},this.handles.add([se(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),kt),se(()=>[this.contentElement],()=>this._createVM(),kt)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.spatialReference)!=null?t:null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:r}=this;return e?"loading":t||r?"ready":"disabled"}get map(){var e,t;return(t=(e=this.view)==null?void 0:e.map)!=null?t:null}set map(e){this._override("map",e)}};u([d()],nu.prototype,"_abortController",void 0),u([d({type:efe})],nu.prototype,"expressionInfo",void 0),u([d({type:Aa})],nu.prototype,"graphic",void 0),u([d({readOnly:!0})],nu.prototype,"contentElement",void 0),u([d({readOnly:!0})],nu.prototype,"contentElementViewModel",void 0),u([d()],nu.prototype,"interceptor",void 0),u([d()],nu.prototype,"spatialReference",null),u([d({readOnly:!0})],nu.prototype,"state",null),u([d()],nu.prototype,"map",null),u([d()],nu.prototype,"view",void 0),nu=u([P("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],nu);const wZ=nu,i$={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let eN=class extends cl{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new wZ}initialize(){this.addHandles(se(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),kt))}destroy(){this._destroyContentWidget()}renderLoading(){return ne("div",{key:"loading-container",class:i$.loadingSpinnerContainer},ne("span",{class:this.classes(i$.iconLoading,i$.spinner)}))}render(){var t;const{state:e}=this.viewModel;return ne("div",{class:i$.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,r=t==null?void 0:t.type;this._destroyContentWidget();const i=e?r==="fields"?new D0e({viewModel:e}):r==="media"?new a_e({viewModel:e}):r==="text"?new ID({viewModel:e}):null:null;this._contentWidget=i,this.scheduleRender()}};u([d({type:wZ})],eN.prototype,"viewModel",void 0),eN=u([P("esri.widgets.Feature.FeatureExpression")],eN);const xGe=eN,s9=100;let Ki=class extends Ss(cP(xx(Te))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const t=new AbortController;this._queryAbortController=t,await _S(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const t=new AbortController;this._queryFeatureCountAbortController=t,await _S(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const t=new AbortController;this._queryPageAbortController=t,await _S(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)},this._queryThrottled=SS(this._queryController,s9,this),this._queryFeatureCountThrottled=SS(this._queryFeatureCountController,s9,this),this._queryPageThrottled=SS(this._queryPageController,s9,this),this._query=async()=>{const{_queryAbortController:t,relatedFeatures:r}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.removeAll(),r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:t==null?void 0:t.signal})))},this.handles.add([se(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),kt),se(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),se(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:r}=this,i=1,s=Math.ceil(r/t)||1;this._set("featurePage",Math.min(Math.max(e,i),s))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&(t==null?void 0:t.loaded)?e.map(r=>{const i=r.clone(),s=qO(r.field,t);return i.field=s,i}):e!=null?e:[]}get supportsCacheHint(){var e,t,r;return!!((r=(t=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:t.queryRelated)!=null&&r.supportsCacheHint)}get canQuery(){var t,r;const e=(r=(t=this.layer)==null?void 0:t.capabilities)==null?void 0:r.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e==null?void 0:e.supportsCount)&&(e==null?void 0:e.supportsPagination))}get itemDescriptionFieldName(){var e,t;return((t=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:t.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,t,r;return(r=this.objectIdField&&((t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.objectIdField]))!=null?r:null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new pt}get relatedLayer(){var i;const{layer:e,map:t,relationship:r}=this;return(e==null?void 0:e.loaded)&&t&&r&&(i=P5e(t,e,r))!=null?i:null}get relationship(){var r,i;const{relationshipId:e,layer:t}=this;return typeof e=="number"&&(i=(r=t==null?void 0:t.relationships)==null?void 0:r.find(({id:s})=>s===e))!=null?i:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new pt}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:r,canQuery:i}=this;return t?"loading":e||r?"querying":i?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(t=>!t.destroyed&&t.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:t,relationshipId:r,objectId:i,_queryFeatureCountAbortController:s,canQuery:n,supportsCacheHint:o}=this;if(await(e==null?void 0:e.load()),await(t==null?void 0:t.load()),!n||!e||!t)return void this._set("featureCount",0);const a=t.createQuery(),l=new EE({cacheHint:o,relationshipId:r,returnGeometry:!1,objectIds:[i],where:hK(a.where,void 0)}),c=await e.queryRelatedFeaturesCount(l,{signal:s==null?void 0:s.signal});this._set("featureCount",c[i]||0)}_sliceFeatures(e){const{showAllEnabled:t,displayCount:r}=this;return t?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:t,showAllEnabled:r,_queryPageAbortController:i}=this;!r||t<2||e.addMany(await this._queryRelatedFeatures({signal:i==null?void 0:i.signal}))}async _queryRelatedFeatures(e){var O;const{orderByFieldsFixedCasing:t,showAllEnabled:r,featuresPerPage:i,displayCount:s,layer:n,relationshipId:o,featurePage:a,featureCount:l,relatedLayer:c,supportsCacheHint:h}=this,{canQuery:p,objectId:f}=this;if(!p||!n||!c)return[];const m=r?((a-1)*i+l)%l:0,y=r?i:s,_=c.objectIdField,b=[...t==null?void 0:t.map(R=>R.field),_].filter(v),x=t==null?void 0:t.map(R=>`${R.field} ${R.order}`),T=c.createQuery(),S=new EE({orderByFields:x,start:m,num:y,outFields:b,cacheHint:h,relationshipId:o,returnGeometry:!1,objectIds:[f],where:hK(T.where,void 0)}),C=((O=(await n.queryRelatedFeatures(S,{signal:e==null?void 0:e.signal}))[f])==null?void 0:O.features)||[];return C.forEach(R=>{R.sourceLayer=c,R.layer=c}),C}};u([d()],Ki.prototype,"_queryAbortController",void 0),u([d()],Ki.prototype,"_queryPageAbortController",void 0),u([d()],Ki.prototype,"_queryFeatureCountAbortController",void 0),u([d({value:1})],Ki.prototype,"featurePage",null),u([d()],Ki.prototype,"featuresPerPage",void 0),u([d({readOnly:!0})],Ki.prototype,"orderByFieldsFixedCasing",null),u([d({readOnly:!0})],Ki.prototype,"supportsCacheHint",null),u([d({readOnly:!0})],Ki.prototype,"canQuery",null),u([d()],Ki.prototype,"description",void 0),u([d({readOnly:!0})],Ki.prototype,"itemDescriptionFieldName",null),u([d({value:3})],Ki.prototype,"displayCount",null),u([d({type:Aa})],Ki.prototype,"graphic",void 0),u([d()],Ki.prototype,"layer",void 0),u([d()],Ki.prototype,"map",void 0),u([d({readOnly:!0})],Ki.prototype,"objectId",null),u([d({readOnly:!0})],Ki.prototype,"objectIdField",null),u([d()],Ki.prototype,"orderByFields",void 0),u([d({readOnly:!0})],Ki.prototype,"relatedFeatures",null),u([d({readOnly:!0})],Ki.prototype,"relatedLayer",null),u([d({readOnly:!0})],Ki.prototype,"relationship",null),u([d()],Ki.prototype,"featureCount",void 0),u([d({readOnly:!0})],Ki.prototype,"relatedFeatureViewModels",null),u([d()],Ki.prototype,"relationshipId",void 0),u([d()],Ki.prototype,"showAllEnabled",void 0),u([d()],Ki.prototype,"state",null),u([d()],Ki.prototype,"title",void 0),Ki=u([P("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],Ki);const xZ=Ki,qR="esri-feature",n9=`${qR}-relationship`,Wm={base:n9,esriWidget:"esri-widget",listContainer:`${n9}__list`,listContainerQuerying:`${n9}__list--querying`,featureObserver:`${qR}__feature-observer`,stickySpinnerContainer:`${qR}__sticky-loading-container`,loadingSpinnerContainer:`${qR}__loading-container`,spinner:`${qR}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},$ie={title:!0,description:!0};let Al=class extends cl{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([r])=>{r!=null&&r.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new xZ,this.messages=null,this.messagesCommon=null,this.visibleElements={...$ie},this._increaseFeaturePage=()=>{const{state:r,showAllEnabled:i,relatedFeatures:s,featuresPerPage:n,featurePage:o}=this.viewModel;r==="ready"&&i&&s.length>=n*o&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new _6,this.addHandles([se(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),kt),se(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),dn(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([ie(()=>import("./calcite-list.201ca8d5.js"),["assets/calcite-list.201ca8d5.js","assets/interactive.5b40332c.js","assets/observers.7ede75e6.js","assets/utils3.a96d14d4.js","assets/loadable.f81dc576.js","assets/debounce.aad9914a.js","assets/t9n.3c437af8.js","assets/icon.3bedc1f6.js","assets/loader.ac3103ed.js","assets/guid.ba2965fd.js","assets/scrim.f5bc6086.js"]),ie(()=>import("./calcite-list-item.479606fc.js"),["assets/calcite-list-item.479606fc.js","assets/interactive.5b40332c.js","assets/utils3.a96d14d4.js","assets/loadable.f81dc576.js","assets/icon.3bedc1f6.js","assets/observers.7ede75e6.js"]),ie(()=>import("./calcite-icon.55d8d95f.js"),["assets/calcite-icon.55d8d95f.js","assets/icon.3bedc1f6.js","assets/observers.7ede75e6.js"]),ie(()=>import("./calcite-notice.86afdb75.js"),["assets/calcite-notice.86afdb75.js","assets/observers.7ede75e6.js","assets/loadable.f81dc576.js","assets/t9n.3c437af8.js","assets/icon.3bedc1f6.js"])])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Ve(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:r}=this.viewModel;return!e&&!!t&&(t>r||r===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:t}=this.viewModel;return Ff(t===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...$ie,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?ne("div",{key:"sticky-loader",class:Wm.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return ne("span",{class:this.classes(Wm.iconLoading,Wm.spinner)})}renderLoading(){return ne("div",{key:"loading-container",class:Wm.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return ne("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=em(this.container)?"chevron-left":"chevron-right";return ne("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var s,n,o;const{itemDescriptionFieldName:t}=this.viewModel,r=e.title;e.description=t&&((s=e.formattedAttributes)==null?void 0:s.global[t]);const i=e.state==="loading";return ne("calcite-list-item",{key:e.uid,label:i?`${(n=this.messagesCommon)==null?void 0:n.loading}\u2026`:r,description:i?"\u2026":(o=e.description)!=null?o:"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?ne("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return ne("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},ne("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return ne("div",{key:"feature-observer",class:Wm.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return ne("calcite-list",null,e.toArray().map(t=>this.renderRelatedFeature(t)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this.viewModel;return ne("div",{key:"list-container",class:this.classes(Wm.listContainer,{[Wm.listContainerQuerying]:t==="querying"})},e?this.renderList():t==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return ne("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},ne("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var t;const{state:e}=this.viewModel;return ne("div",{class:this.classes(Wm.base,Wm.esriWidget)},(t=this._featureElementInfo)==null?void 0:t.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e==null||e.forEach(r=>{this.addHandles(se(()=>[r.title,r.state],()=>this.scheduleRender(),kt),t)}),this.scheduleRender()}_setupFeatureElementInfo(){var s;const{headingLevel:e,visibleElements:t}=this,r=t.description&&this.description,i=t.title&&this.title;(s=this._featureElementInfo)==null||s.set({description:r,title:i,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this.viewModel;await Ew(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};u([d()],Al.prototype,"_relatedFeatureIntersectionObserverNode",void 0),u([d({readOnly:!0})],Al.prototype,"displayShowAllButton",null),u([d({readOnly:!0})],Al.prototype,"displayListItems",null),u([d()],Al.prototype,"description",null),u([d({readOnly:!0})],Al.prototype,"featureCountDescription",null),u([d()],Al.prototype,"headingLevel",void 0),u([d()],Al.prototype,"title",null),u([d({type:xZ})],Al.prototype,"viewModel",void 0),u([d(),il("esri/widgets/Feature/t9n/Feature")],Al.prototype,"messages",void 0),u([d(),il("esri/t9n/common")],Al.prototype,"messagesCommon",void 0),u([d()],Al.prototype,"visibleElements",void 0),u([zt("visibleElements")],Al.prototype,"castVisibleElements",null),Al=u([P("esri.widgets.Feature.FeatureRelationship")],Al);const Lie=Al;class TGe{constructor(t,r){this.preLayerQueryCallback=t,this.preRequestCallback=r,this.preLayerQueryCallback||(this.preLayerQueryCallback=i=>{}),this.preRequestCallback||(this.preLayerQueryCallback=i=>{})}}var WR;const SGe=1,Die="content-view-models",Nie="relationship-view-models",Fie={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let Ps=WR=class extends cP(Te){constructor(e){super(e),this._handles=new Jr,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=SS(this._graphicChanged,SGe,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Fie},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:r}=this;return t.type==="attachments"&&!!r.attachmentsContent||t.type==="custom"&&!!r.customContent||t.type==="fields"&&!!r.fieldsContent||t.type==="media"&&!!r.mediaContent||t.type==="text"&&!!r.textContent||t.type==="expression"&&!!r.expressionContent||t.type==="relationship"&&!!r.relationshipContent},this._handles.add(se(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),kt))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return v(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return S5e(Cte(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return T0e(this.graphic)}castAbilities(e){return{...Fie,...e}}get isTable(){var e;return((e=this._sourceLayer)==null?void 0:e.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.spatialReference)!=null?t:null}set spatialReference(e){this._override("spatialReference",e)}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const r=this.contentViewModels[e];r instanceof ew&&r.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof ew&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof ew&&t.previous()}async updateGeometry(){var o,a;const{graphic:e,spatialReference:t,_sourceLayer:r}=this;await(r==null?void 0:r.load());const i=r==null?void 0:r.objectIdField;if(!i||!e||!r)return;const s=(o=e==null?void 0:e.attributes)==null?void 0:o[i];if(s==null)return;const n=[s];if(!e.geometry){const l=(a=await O0e({layer:r,graphic:e,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:t}))==null?void 0:a.geometry;l&&(e.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(r){sn(r)||(this._error=r,ee.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:r,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,r)=>this._compileContentElement(t,r)).filter(v):typeof e=="string"?this._compileText(new uE({text:e}),0).text:e}_destroyContentViewModels(){var e,t;(e=this._handles)==null||e.remove(Nie),(t=this._handles)==null||t.remove(Die),this.contentViewModels.forEach(r=>r&&!r.destroyed&&r.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){var s;const r=(s=e==null?void 0:e.graphic)==null?void 0:s.getObjectId(),i=t==null?void 0:t.getObjectId();return v(r)&&v(i)&&r===i}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:r}){const{view:i,spatialReference:s}=this;t==null||t.filter(Boolean).forEach(n=>{e.find(o=>this._matchesFeature(o,n))||e.add(new WR({abilities:{relationshipContent:!1},map:r,view:i,spatialReference:s,graphic:n}))}),e.forEach(n=>{(t==null?void 0:t.find(a=>this._matchesFeature(n,a)))||e.remove(n)})}_setExpressionContentVM(e,t){const r=this.formattedAttributes,{contentElement:i,contentElementViewModel:s}=e,n=i==null?void 0:i.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:r}),s.set(this._createFieldsVMParams(i,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:r}),s.set(this._createMediaVMParams(i,t))),n==="text"&&s.set(this._createTextVMParams(i)))}_compileRelationship(e,t){const{displayCount:r,orderByFields:i,relationshipId:s,title:n,description:o}=e,{_sourceLayer:a,graphic:l,map:c}=this,h=new xZ({displayCount:r,graphic:l,orderByFields:i,relationshipId:s,layer:a,map:c,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[t]=h,this._handles.add(dn(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),Nie),e}_compileExpression(e,t){const{expressionInfo:r}=e,{graphic:i,map:s,spatialReference:n,view:o}=this,a=new wZ({expressionInfo:r,graphic:i,interceptor:WR.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(se(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),kt),Die),e}_compileAttachments(e,t){const{graphic:r}=this,{description:i,title:s}=e;return this.contentViewModels[t]=new RY({graphic:r,...this._compileTitleAndDesc({title:s,description:i})}),e}_compileCustom(e,t){const{graphic:r}=this,{creator:i,destroyer:s}=e;return this.contentViewModels[t]=new YF({graphic:r,creator:i,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:r,_sourceLayer:i,graphic:s,formattedAttributes:n}=this,o=s==null?void 0:s.attributes,a=this._expressionAttributes,l=n.global;return{title:Qb({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:e}),description:Qb({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:t})}}_createFieldsVMParams(e,t){var c;const r=this._effectivePopupTemplate,i=this.formattedAttributes,s={...i==null?void 0:i.global,...i==null?void 0:i.content[t]},n=(c=(e==null?void 0:e.fieldInfos)||(r==null?void 0:r.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>SY(h)||Yg(h)||s.hasOwnProperty(h)),o=r==null?void 0:r.expressionInfos,{description:a,title:l}=e;return{attributes:s,expressionInfos:o,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(e,t){const r=e.clone(),i=new v6(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=i,r.fieldInfos=i.formattedFieldInfos.slice(0),r}_createMediaVMParams(e,t){var y;const{abilities:r,graphic:i,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,h=(y=i==null?void 0:i.attributes)!=null?y:{},{description:p,mediaInfos:f,title:m}=e;return{abilities:{chartAnimation:r.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,isAggregate:i==null?void 0:i.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[t]},expressionAttributes:l,mediaInfos:f,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:m,description:p})}}_compileMedia(e,t){const r=e.clone(),i=new ew(this._createMediaVMParams(e,t));return r.mediaInfos=i.formattedMediaInfos.slice(0),this.contentViewModels[t]=i,r}_createTextVMParams(e){var n,o,a;const{graphic:t,_fieldInfoMap:r,_sourceLayer:i,_expressionAttributes:s}=this;if(e&&e.text){const l=(n=t==null?void 0:t.attributes)!=null?n:{},c=(a=(o=this.formattedAttributes)==null?void 0:o.global)!=null?a:{};e.text=Qb({attributes:l,fieldInfoMap:r,globalAttributes:c,expressionAttributes:s,layer:i,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const r=e.clone();return this.contentViewModels[t]=new YF(this._createTextVMParams(r)),r}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:r}=this;if(!e)return;const{lastEditInfoEnabled:i}=e,s=t==null?void 0:t.editFieldsInfo;return i&&s?T5e(s,r==null?void 0:r.attributes):void 0}_compileTitle(e){var a,l,c;const{_fieldInfoMap:t,_sourceLayer:r,graphic:i,_expressionAttributes:s}=this,n=(a=i==null?void 0:i.attributes)!=null?a:{},o=(c=(l=this.formattedAttributes)==null?void 0:l.global)!=null?c:{};return Qb({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:r,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;if(!t)return null;const r=e==null?void 0:e.title;return XF(r,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;if(!t)return null;const r=e==null?void 0:e.content;return XF(r,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:r,graphic:i,_effectivePopupTemplate:s}=this,n=this.map,o=this.view,a=this.spatialReference;if(t!==this._featureAbortController||!i)return;await C5e({graphic:i,popupTemplate:s,layer:r,spatialReference:a},e);const{content:{value:l},title:{value:c}}=await fo({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=await fo({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:bGe({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:a,graphic:i,map:n,interceptor:WR.interceptor,view:o})});t===this._featureAbortController&&i&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...i.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:r}){const{_effectivePopupTemplate:i,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;r.content[t]=mk({fieldInfos:i==null?void 0:i.fieldInfos,graphic:s,attributes:{...l,...e.attributes},layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:r}){if(e.fieldInfos){const{graphic:i,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;r.content[t]=mk({fieldInfos:e.fieldInfos,graphic:i,attributes:{...a,...e.attributes},layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:r,relatedInfos:i,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:mk({fieldInfos:a,graphic:r,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:i}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:r}=this;return this._queryRelatedInfos(t,Cte(r),e)}async _queryRelatedInfos(e,t,r){const{relatedInfos:i,_sourceLayer:s}=this;i.clear();const n=v(s==null?void 0:s.associatedLayer)?await(s==null?void 0:s.associatedLayer.load(r)):s;if(!n||!e)return;const o=t.filter(c=>c&&Yg(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await k8e({relatedInfos:i,layer:n},r);Object.keys(a).forEach(c=>{var f;const h=i.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await V8e({graphic:e,relatedInfos:i,layer:n},r);Object.keys(l).forEach(c=>{var h;L8e((h=l[c])==null?void 0:h.value,i.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:r}=this,i=DD(e.fieldName);if(!i)return;const{layerId:s,fieldName:n}=i;if(!s)return;const o=r.get(s.toString())||$8e(s,t);o&&(B8e({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};Ps.interceptor=new TGe(O5e,M5e),u([d()],Ps.prototype,"_error",void 0),u([d()],Ps.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],Ps.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],Ps.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],Ps.prototype,"_sourceLayer",null),u([d()],Ps.prototype,"abilities",void 0),u([zt("abilities")],Ps.prototype,"castAbilities",null),u([d({readOnly:!0})],Ps.prototype,"content",void 0),u([d({readOnly:!0})],Ps.prototype,"contentViewModels",void 0),u([d()],Ps.prototype,"description",void 0),u([d({type:Boolean})],Ps.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],Ps.prototype,"isTable",null),u([d({readOnly:!0})],Ps.prototype,"state",null),u([d({readOnly:!0})],Ps.prototype,"formattedAttributes",void 0),u([d({type:Aa,value:null})],Ps.prototype,"graphic",null),u([d({readOnly:!0})],Ps.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],Ps.prototype,"relatedInfos",void 0),u([d()],Ps.prototype,"spatialReference",null),u([d({readOnly:!0})],Ps.prototype,"title",void 0),u([d()],Ps.prototype,"map",null),u([d({readOnly:!0})],Ps.prototype,"waitingForContent",null),u([d()],Ps.prototype,"view",void 0),Ps=WR=u([P("esri.widgets.FeatureViewModel")],Ps);const TZ=Ps,ca="esri-feature",an={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:ca,container:`${ca}__size-container`,title:`${ca}__title`,main:`${ca}__main-container`,btn:`${ca}__button`,icon:`${ca}__icon`,content:`${ca}__content`,contentNode:`${ca}__content-node`,contentElement:`${ca}__content-element`,text:`${ca}__text`,lastEditedInfo:`${ca}__last-edited-info`,fields:`${ca}__fields`,fieldHeader:`${ca}__field-header`,fieldData:`${ca}__field-data`,fieldDataDate:`${ca}__field-data--date`,loadingSpinnerContainer:`${ca}__loading-container`,spinner:`${ca}__loading-spinner`},m1e=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=r=>L0e(r)&&!r.destroyed?ne("div",{class:an.contentNode,key:r},r.render()):r instanceof HTMLElement?ne("div",{class:an.contentNode,key:r,bind:r,afterCreate:this._attachToNode}):X5e(r)?ne("div",{class:an.contentNode,key:r,bind:r.domNode,afterCreate:this._attachToNode}):null}_attachToNode(r){const i=this;r.appendChild(i)}};return t=u([P("esri.widgets.Feature.ContentMixin")],t),t};var Kj;const Uie={title:!0,content:!0,lastEditedInfo:!0},kie="relationship-handles";let Ro=Kj=class extends m1e(cl){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...Uie},this.viewModel=new TZ}initialize(){this.addHandles(se(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),kt))}loadDependencies(){return ie(()=>import("./calcite-notice.86afdb75.js"),["assets/calcite-notice.86afdb75.js","assets/observers.7ede75e6.js","assets/loadable.f81dc576.js","assets/t9n.3c437af8.js","assets/icon.3bedc1f6.js"])}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...Uie,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{state:e}=this.viewModel,t=ne("div",{class:an.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return ne("div",{class:this.classes(an.base,an.esriWidget)},t)}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:r}=this;return ne("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},r.title?ne("div",{key:"error-title",slot:"title"},e.errorMessage):null,ne("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return ne("div",{key:"loading-container",class:an.loadingSpinnerContainer},ne("span",{class:this.classes(an.iconLoading,an.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?ne("div",{class:an.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?ne(OY,{level:this.headingLevel,class:an.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?ne("div",{class:an.contentNode,key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const r=this._contentWidgets[0];return!r||r.destroyed?null:ne("div",{class:an.contentNode,key:`${t}-content`},r.render())}return this.renderNodeContent(e)}renderContentElement(e,t){var i;const{visibleElements:r}=this;if(typeof r.content!="boolean"&&!((i=r.content)!=null&&i[e.type]))return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);case"relationship":return this.renderRelationship(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:r,attachmentInfos:i}=t.viewModel;return r==="loading"||i.length>0?ne("div",{key:this._buildKey("attachments-element",e),class:this.classes(an.contentElement)},t.render()):null}renderRelationship(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?ne("div",{key:this._buildKey("relationship-element",e),class:an.contentElement},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ne("div",{key:this._buildKey("expression-element",e),class:an.contentElement},t.render())}renderCustom(e,t){const{creator:r}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:r?ne("div",{key:this._buildKey("custom-element",t),class:an.contentElement},i.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ne("div",{key:this._buildKey("fields-element",e),class:an.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ne("div",{key:this._buildKey("media-element",e),class:an.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:r}=this.viewModel;if(!r||!e.lastEditedInfo)return null;const{date:i,user:s}=r,n=r.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=Ff(n,{date:i,user:s});return ne("div",{key:"edit-info-element",class:this.classes(an.lastEditedInfo,an.contentElement)},o)}renderText(e,t){const r=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:r?ne("div",{key:this._buildKey("text-element",t),class:this.classes(an.contentElement,an.text)},i.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles(kie),this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){const{flowItems:t,visibleElements:r}=this;this.addHandles([dn(()=>e,"select-record",({featureViewModel:i})=>{t&&(i.abilities={relationshipContent:!0},t.push(new Kj({flowItems:t,viewModel:i,visibleElements:r})))}),dn(()=>e,"show-all-records",()=>{if(!t)return;const{viewModel:i}=e;i.showAllEnabled=!0;const s=new Lie({visibleElements:{title:!1,description:!1},viewModel:i});this._addFeatureRelationshipHandles(s),t.push(s)})],kie)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,r=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(r))r.forEach((s,n)=>{if(s.type==="attachments"&&(this._contentWidgets[n]=new k5e({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:i[n]})),s.type==="fields"&&(this._contentWidgets[n]=new D0e({viewModel:i[n]})),s.type==="media"&&(this._contentWidgets[n]=new a_e({viewModel:i[n]})),s.type==="text"&&(this._contentWidgets[n]=new ID({viewModel:i[n]})),s.type==="custom"&&(this._contentWidgets[n]=new ID({viewModel:i[n]})),s.type==="expression"&&(this._contentWidgets[n]=new xGe({viewModel:i[n]})),s.type==="relationship"){const o=new Lie({viewModel:i[n]});this._addFeatureRelationshipHandles(o),this._contentWidgets[n]=o}},this);else{const s=i[0];s&&!s.destroyed&&(this._contentWidgets[0]=new ID({viewModel:s}))}this.scheduleRender()}};u([d()],Ro.prototype,"graphic",null),u([d()],Ro.prototype,"defaultPopupTemplateEnabled",null),u([d()],Ro.prototype,"flowItems",void 0),u([d()],Ro.prototype,"headingLevel",void 0),u([d({readOnly:!0})],Ro.prototype,"isTable",null),u([d()],Ro.prototype,"label",null),u([d(),il("esri/widgets/Feature/t9n/Feature")],Ro.prototype,"messages",void 0),u([d(),il("esri/t9n/common")],Ro.prototype,"messagesCommon",void 0),u([d(),il("esri/widgets/support/t9n/uriUtils")],Ro.prototype,"messagesURIUtils",void 0),u([d()],Ro.prototype,"spatialReference",null),u([d({readOnly:!0})],Ro.prototype,"title",null),u([d()],Ro.prototype,"visibleElements",void 0),u([zt("visibleElements")],Ro.prototype,"castVisibleElements",null),u([d()],Ro.prototype,"map",null),u([d()],Ro.prototype,"view",null),u([d({type:TZ})],Ro.prototype,"viewModel",void 0),Ro=Kj=u([P("esri.widgets.Feature")],Ro);const EGe=Ro;var g1e;const tN=Symbol("anchorHandles");let lb=class extends Vs.EventedAccessor{constructor(e){super(e),this[g1e]=new Jr,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[tN].add([oa(()=>ho(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),se(()=>this.screenLocation,(t,r)=>{v(t)&&v(r)&&this.emit("view-change")})])}destroy(){this.view=null,this[tN]=Ve(this[tN])}get screenLocation(){var i;const{location:e,view:t,screenLocationEnabled:r}=this;return r&&v(e)&&v(t)&&t.ready?(i=t.toScreen)==null?void 0:i.call(t,e):null}};g1e=tN,u([d()],lb.prototype,"location",void 0),u([d()],lb.prototype,"screenLocation",null),u([d()],lb.prototype,"screenLocationEnabled",void 0),u([d()],lb.prototype,"view",void 0),lb=u([P("esri.widgets.support.AnchorElementViewModel")],lb);const y1e=lb,CGe="esri.widgets.CompassViewModel";let rN=class extends y1e{constructor(e){super(e),this.visible=!1}};u([d()],rN.prototype,"visible",void 0),rN=u([P(CGe)],rN);const _1e=rN,o9="esri-spinner",a9={base:o9,spinnerStart:`${o9}--start`,spinnerFinish:`${o9}--finish`};let cb=class extends cl{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new _1e}initialize(){this.addHandles(se(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:t,promise:r}=e!=null?e:{};t&&(this.viewModel.location=t),this.visible=!0;const i=()=>this.hide();r&&r.catch(()=>{}).then(i)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,r=!!t,i=e&&r,s=!e&&r,n={[a9.spinnerStart]:i,[a9.spinnerFinish]:s},o=this._getPositionStyles();return ne("div",{class:this.classes(a9.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=Ew(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(E(t)||E(e))return{};const{padding:r}=t;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};u([d()],cb.prototype,"location",null),u([d()],cb.prototype,"view",null),u([d({type:_1e})],cb.prototype,"viewModel",void 0),u([d()],cb.prototype,"visible",null),cb=u([P("esri.widgets.Spinner")],cb);const AGe=cb,B6={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},tw=new pC({id:"zoom-to-feature",title:"{messages.zoom}",className:B6.iconZoom}),Vie=new pC({id:"remove-selected-feature",title:"{messages.remove}",className:B6.iconTrash}),Z2=new pC({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:B6.iconZoom}),J2=new pC({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:B6.iconBrowseClusteredFeatures}),RGe="esri.widgets.Popup.PopupViewModel",o4=ee.getLogger(RGe),OGe=e=>{const{event:t,view:r}=e,{action:i}=t,s=r&&r.popup;if(!i)return Promise.reject(new j("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new j("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=i;if(!o)return Promise.reject(new j("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new j("trigger-action:invalid-action","Action is disabled"));if(o===tw.id)return PGe(s.viewModel).catch(QB);if(o===Z2.id)return IGe(s.viewModel);if(o===J2.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===Vie.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new j(`trigger-action:${Vie.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):r.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function v1e(e){var s;const{selectedFeature:t,location:r,view:i}=e;return i?i.type==="3d"?(s=t!=null?t:r)!=null?s:null:e.get("selectedFeature.geometry")||r:null}function Fb(e){var t,r;return!!e&&e.isAggregate&&((r=(t=e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:r.type)==="cluster"}async function MGe(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const r=t.getViewForGraphic(e);if(r&&"whenGraphicBounds"in r){let i;try{i=await r.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!i||!i.boundingBox||i.boundingBox[0]===i.boundingBox[3]&&i.boundingBox[1]===i.boundingBox[4]&&i.boundingBox[2]===i.boundingBox[5]}return!0}async function PGe(e){var h;const{location:t,selectedFeature:r,view:i,zoomFactor:s}=e,n=v1e(e);if(!i||!n){const p=new j("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:i});throw o4.error(p),p}const o=i.scale/s,a=(h=e.selectedFeature)==null?void 0:h.geometry,l=a!=null?a:t,c=v(l)&&l.type==="point"&&await MGe(r,i);tw.active=!0,tw.disabled=!0;try{await e.zoomTo({target:{target:n,scale:c?o:void 0}})}catch{const f=new j("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:r});o4.error(f)}finally{tw.active=!1,tw.disabled=!1,e.zoomToLocation=null,c&&(e.location=l)}}async function IGe(e){const{selectedFeature:t,view:r}=e;if((r==null?void 0:r.type)!=="2d"){const o=new j("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r});throw o4.error(o),o}if(!t||!Fb(t)){const o=new j("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw o4.error(o),o}const[i,s]=await SZ(r,t);Z2.active=!0,Z2.disabled=!0;const{extent:n}=await i.queryExtent(s);await e.zoomTo({target:n}),Z2.active=!1,Z2.disabled=!1}async function $Ge(e){const{view:t,selectedFeature:r}=e;if(!t||!r)return;const[i,s]=await SZ(t,r),{extent:n}=await i.queryExtent(s);e.selectedClusterBoundaryFeature.geometry=n,t.graphics.add(e.selectedClusterBoundaryFeature)}async function LGe(e){var o;const{selectedFeature:t,view:r}=e;if(!r||!t)return;const[i,s]=await SZ(r,t);J2.active=!0,J2.disabled=!0;const{features:n}=await i.queryFeatures(s);J2.active=!1,J2.disabled=!1,(o=r.popup)==null||o.open({features:[t].concat(n),featureMenuOpen:!0})}async function SZ(e,t){const r=await e.whenLayerView(t.sourceLayer),i=r.createQuery(),s=t.getObjectId();return i.aggregateIds=s!=null?[s]:[],[r,i]}function DGe(e){const t=e.features.filter(r=>Fb(r));t.length&&(e.features=t)}function b1e(e){var t;if(E(e))return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return(t=e.extent)==null?void 0:t.center;default:return null}}const Dt="esri-popup",dA=`${Dt}__header`,Jv=`${Dt}--is-docked`,Ae={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:Dt,widget:"esri-widget",main:`${Dt}__main-container`,loadingContainer:`${Dt}__loading-container`,isCollapsible:`${Dt}--is-collapsible`,isCollapsed:`${Dt}--is-collapsed`,shadow:`${Dt}--shadow`,isDocked:Jv,isDockedTopLeft:`${Jv}-top-left`,isDockedTopCenter:`${Jv}-top-center`,isDockedTopRight:`${Jv}-top-right`,isDockedBottomLeft:`${Jv}-bottom-left`,isDockedBottomCenter:`${Jv}-bottom-center`,isDockedBottomRight:`${Jv}-bottom-right`,alignTopCenter:`${Dt}--aligned-top-center`,alignBottomCenter:`${Dt}--aligned-bottom-center`,alignTopLeft:`${Dt}--aligned-top-left`,alignBottomLeft:`${Dt}--aligned-bottom-left`,alignTopRight:`${Dt}--aligned-top-right`,alignBottomRight:`${Dt}--aligned-bottom-right`,isFeatureMenuOpen:`${Dt}--feature-menu-open`,isActionsMenuOpen:`${Dt}--actions-menu-open`,hasFeatureUpdated:`${Dt}--feature-updated`,header:dA,headerButtons:`${dA}-buttons`,headerContainer:`${dA}-container`,headerContainerButton:`${dA}-container--button`,headerTitle:`${dA}-title`,content:`${Dt}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${Dt}__footer`,footerHasPagination:`${Dt}__footer--has-pagination`,footerHasActions:`${Dt}__footer--has-actions`,footerHasActionsMenu:`${Dt}__footer--has-actions-menu`,button:`${Dt}__button`,buttonDisabled:`${Dt}__button--disabled`,buttonDock:`${Dt}__button--dock`,icon:`${Dt}__icon`,iconDock:`${Dt}__icon--dock-icon`,inlineActionsContainer:`${Dt}__inline-actions-container`,actionsMenuButton:`${Dt}__actions-menu-button`,actions:`${Dt}__actions`,action:`${Dt}__action`,actionImage:`${Dt}__action-image`,actionText:`${Dt}__action-text`,actionToggle:`${Dt}__action-toggle`,actionToggleOn:`${Dt}__action-toggle--on`,actionExit:`${Dt}__action--exit`,actionSelectFeature:`${Dt}__action--select-feature`,pointer:`${Dt}__pointer`,pointerDirection:`${Dt}__pointer-direction`,navigation:`${Dt}__navigation`,paginationPrevious:`${Dt}__pagination-previous`,paginationNext:`${Dt}__pagination-next`,paginationPreviousIconLTR:`${Dt}__pagination-previous-icon`,paginationPreviousIconRTL:`${Dt}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${Dt}__pagination-next-icon`,paginationNextIconRTL:`${Dt}__pagination-next-icon--rtl`,featureMenu:`${Dt}__feature-menu`,featureMenuList:`${Dt}__feature-menu-list`,featureMenuItem:`${Dt}__feature-menu-item`,featureMenuViewport:`${Dt}__feature-menu-viewport`,featureMenuHeader:`${Dt}__feature-menu-header`,featureMenuNote:`${Dt}__feature-menu-note`,featureMenuSelected:`${Dt}__feature-menu-item--selected`,featureMenuButton:`${Dt}__feature-menu-button`,featureMenuTitle:`${Dt}__feature-menu-title`,featureMenuObserver:`${Dt}__feature-menu-observer`,featureMenuLoader:`${Dt}__feature-menu-loader`,collapseButton:`${Dt}__collapse-button`,collapseIcon:`${Dt}__collapse-icon`};var zw;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(zw||(zw={}));function w1e(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function NGe(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function FGe(e,t,r,i,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function UGe(e,t){return new Float32Array(e,t,6)}function x1e(e,t,r,i){const s=t[i],n=t[i+1];e[i]=r[0]*s+r[2]*n+r[4],e[i+1]=r[1]*s+r[3]*n+r[5]}function kGe(e,t,r,i=0,s=0,n=2){const o=s||t.length/n;for(let a=i;a<o;a++)x1e(e,t,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:NGe,create:w1e,createView:UGe,fromValues:FGe,transform:x1e,transformMany:kGe},Symbol.toStringTag,{value:"Module"}));function VGe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function BGe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function zGe(e,t,r,i,s,n,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e}function T1e(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=r*n-i*s;return l?(l=1/l,e[0]=n*l,e[1]=-i*l,e[2]=-s*l,e[3]=r*l,e[4]=(s*a-n*o)*l,e[5]=(i*o-r*a)*l,e):null}function GGe(e){return e[0]*e[3]-e[1]*e[2]}function S1e(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],h=r[1],p=r[2],f=r[3],m=r[4],y=r[5];return e[0]=i*c+n*h,e[1]=s*c+o*h,e[2]=i*p+n*f,e[3]=s*p+o*f,e[4]=i*m+n*y+a,e[5]=s*m+o*y+l,e}function EZ(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(r),h=Math.cos(r);return e[0]=i*h+n*c,e[1]=s*h+o*c,e[2]=i*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function E1e(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],h=r[1];return e[0]=i*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function CZ(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],h=r[1];return e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=i*c+n*h+a,e[5]=s*c+o*h+l,e}function jGe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function HGe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function AZ(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function qGe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function WGe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function XGe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function C1e(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function YGe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function ZGe(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function JGe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function QGe(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],f=t[4],m=t[5],y=Pa();return Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=y*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=y*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=y*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const KGe=S1e,eje=C1e;Object.freeze(Object.defineProperty({__proto__:null,add:XGe,copy:VGe,determinant:GGe,equals:QGe,exactEquals:JGe,frob:WGe,fromRotation:jGe,fromScaling:HGe,fromTranslation:AZ,identity:BGe,invert:T1e,mul:KGe,multiply:S1e,multiplyScalar:YGe,multiplyScalarAndAdd:ZGe,rotate:EZ,scale:E1e,set:zGe,str:qGe,sub:eje,subtract:C1e,translate:CZ},Symbol.toStringTag,{value:"Module"}));const Bie=de("android");de("chrome")||Bie&&Bie>=4;cG();function w2t(e){return e=e||globalThis.location.hostname,rje.some(t=>(e==null?void 0:e.match(t))!=null)}function tje(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(A1e)!=null||t.match(O1e)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(R1e)!=null||t.match(M1e)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const A1e=/^devext.arcgis.com$/,R1e=/^qaext.arcgis.com$/,O1e=/^[\w-]*\.mapsdevext.arcgis.com$/,M1e=/^[\w-]*\.mapsqa.arcgis.com$/,rje=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,A1e,R1e,/^jsapps.esri.com$/,O1e,M1e];zw.size;zw.maxSize;zw.maxOutlineSize;zw.lineWidth;zw.tallSymbolWidth;function P1e(e){return e&&"opacity"in e?e.opacity*P1e(e.parent):1}async function ije(e,t){var b,x;if(!e)return;const r=e.sourceLayer,i=(b=v(t)&&t.useSourceLayer?r:e.layer)!=null?b:r,s=P1e(i);if(v(e.symbol)&&(!v(t)||t.ignoreGraphicSymbol!==!0)){const T=e.symbol.type==="web-style"?await iUe(e.symbol,{...t,cache:v(t)?t.webStyleCache:null}):e.symbol.clone();return wk(T,null,s),T}const n=(x=v(t)?t.renderer:null)!=null?x:i&&"renderer"in i?i.renderer:null;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...t,cache:v(t)?t.webStyleCache:null}):o.clone(),!(n&&"visualVariables"in n&&n.visualVariables&&n.visualVariables.length))return wk(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(E(t)||E(t.arcade))){const T={...t};T.arcade=await ym(),t=T}const a=await ie(()=>Promise.resolve().then(function(){return KY}),void 0),l=[],c=[],h=[],p=[];for(const T of n.visualVariables)switch(T.type){case"color":l.push(T);break;case"opacity":c.push(T);break;case"rotation":p.push(T);break;case"size":T.target||h.push(T)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,e,t):null,y=!!c.length&&c[c.length-1];let _=y?a.getOpacity(y,e,t):null;if(s!=null&&(_=_!=null?_*s:s),wk(o,m,_),h.length){const T=a.getAllSizes(h,e,t);await tUe(o,T)}for(const T of p)rUe(o,a.getRotationAngle(T,e,t),T.axis);return o}class vy{constructor(t,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in t){const s=t[i],n=new wde(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=kde(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const t in this._properties){const r=this._properties[t];for(const i of r.acquired)RK(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(t){const r=this._owner._get(t),i=this._properties[t];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const t in this._properties){const r=this._properties[t];let i=0;for(const s of r.acquired)RK(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}}const sje=de("mac")?"Meta":"Ctrl",z6={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)z6[e]=String.fromCharCode(e);for(let e=1;e<25;e++)z6[111+e]=`F${e}`;for(let e=65;e<91;e++)z6[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function nje(e){if(e.key!==void 0)return Mb(e);const t=z6[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function oje(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class aje{constructor(t,r=[]){this.eventType=t,this.keyModifiers=r}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=t.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}}const zie=ee.getLogger("esri.views.input.InputHandler");class zo{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const r=this._incoming[t];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?zie.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(r=>this._handleEvent(r)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof t=="string"?new aje(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new lje(n,i,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw new Error("There is already a callback registered for this outgoing InputEvent: "+t);const r=new cje(t,{onEmit:(i,s,n,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,s,n,o)},onRemove:i=>{var s;delete this._outgoing[i.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[t]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(t){var r;(r=this._manager)==null||r.setPointerCapture(t,!0)}stopCapturingPointer(t){var r;(r=this._manager)==null||r.setPointerCapture(t,!1)}refreshHasPendingInputs(){var t;(t=this._manager)==null||t.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):zie.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){var i;const r=this._incoming[t.type];if(r){for(const s of r)if(s.match.matches(t)&&((i=s.callback)==null||i.call(s,t),t.shouldStopPropagation()))break}}}class lje{constructor(t,r,i){this.match=t,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class cje{constructor(t,r){this.eventType=t,this._removed=!1,this._handler=r}emit(t,r,i){this._removed||this._handler.onEmit(this,t,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class uje extends zo{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(t){const r=t.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=t;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}}class a4{constructor(t){this._observable=new aX,this._value=t}get(){return vr(this._observable),this._value}set(t){t!==this._value&&(this._value=t,this._observable.notify())}}class hje extends zo{get multiTouchActive(){return this._multiTouchActive.get()}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new a4(!1),this._onPointerAdd=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.add(t.native.pointerId),this._update())},this._onPointerRemove=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.delete(t.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}}let wf=class extends Te{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=sje,this._latestPointerType="mouse",this._propertiesPool=new vy({latestPointerLocation:fje},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,t,r=tv.INTERNAL){if(this._nameToGroup[e])return void ee.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void ee.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const i={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=i;for(let s=i.handlers.length-1;s>=0;s--){const n=i.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(i,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(r=>{var i;r.removed=!0,(i=r.uninstallCallback)==null||i.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ee.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const i=this._handlers[r];i.priorityIndex=r,this._handlersPriority.push(i)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const i=this._handlersPriority[r];i.priorityIndex=r;let s=i.handler.hasSideEffects;if(!s){for(const n of i.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of i.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)oje(o)||t.add(o)}i.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,r){this._latestPointerType=e;const i=this._get("latestPointerLocation");if(E(i)||i.x!==t||i.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const r=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,r,i)}_updateKeyModifiers(e,t){if(!t)return;let r=!1;const i=()=>{if(!r){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,r=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(i(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(i(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new uje((e,t,r)=>this._setLatestPointer(e,t,r)),this._multiTouchHandler=new hje,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],tv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,tv.INTERNAL)}_setPointerCapture(e,t,r,i){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,n),i?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,r,i){this._emitInputEvent(0,e,t,r,i)}_emitInputEvent(e,t,r,i,s,n){const o=i!==void 0?i:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new dje(t,r,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new k7,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var t,r;const e=Ul(this._currentPropagation);for(;e.events.length>0;){const{event:i,priorityIndex:s}=e.events.pop(),n=i.data&&i.data.eventId;if(!(n!=null&&this._stoppedPropagationEventIds.has(n)))for(e.currentHandler=this._handlersPriority[s];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&((r=(t=e.currentHandler).eventCallback)==null||r.call(t,i)),i.shouldStopPropagation()){n!=null&&this._stoppedPropagationEventIds.add(n);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const t=new k7;t.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)t.push(r.events.pop());r.events=t,r.currentHandler=null}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const i of t.handler.incomingEventMatches){if(r.eventType!==i.eventType)continue;const s=r.keyModifiers.filter(n=>i.keyModifiers.includes(n));if(s.length===r.keyModifiers.length!=(s.length===i.keyModifiers.length))return r.keyModifiers.length>i.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const r of e){let i=0;for(;i<t.length&&this._compareHandlerPriority(r,t[i])>=0;)i++;t.splice(i,0,r)}return t}get debug(){const e=t=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=r};return{injectEvent:(t,r)=>{e(()=>{this._onEventReceived(t,r)})},disablePointerCapture:e}}};u([d({readOnly:!0})],wf.prototype,"hasPendingInputs",null),u([d({constructOnly:!0})],wf.prototype,"eventSource",void 0),u([d({constructOnly:!0})],wf.prototype,"recognizers",void 0),u([d()],wf.prototype,"_latestPointerType",void 0),u([d()],wf.prototype,"latestPointerType",null),u([d()],wf.prototype,"multiTouchActive",null),u([d({readOnly:!0})],wf.prototype,"latestPointerLocation",void 0),wf=u([P("esri.views.input.InputManager")],wf);class dje{constructor(t,r,i,s,n){this.type=t,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=g_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=g_.STOPPED}shouldStopPropagation(){return(this._propagationState&g_.STOPPED)!=0}async(t){this._propagationState|=g_.PAUSED;const r=(i,s)=>{this._propagationState&=~g_.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof t=="function"?t():t).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(t){return!!(this._propagationState&g_.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var g_;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(g_||(g_={}));const tv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class pje{}const fje=pje;function Gie(e){return e&&typeof e.highlight=="function"}function mje(e){return e&&typeof e.maskOccludee=="function"}function x2t(e,t,r){return E(e)||e>r&&(t===0||e<t)}function T2t(e,t){return v(e)&&e>0||v(t)&&t>0}function S2t(e){var r,i;const t=e.effectiveScaleRange;return{minScale:(r=t==null?void 0:t.minScale)!=null?r:0,maxScale:(i=t==null?void 0:t.maxScale)!=null?i:0}}const I1e=e=>{let t=class extends e{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return x5(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([d()],t.prototype,"goToOverride",void 0),u([d()],t.prototype,"view",void 0),t=u([P("esri.widgets.support.GoTo")],t),t},J3=pt.ofType({key:"type",defaultKeyValue:"button",base:k5,typeMap:{button:pC,toggle:mfe}}),gje=()=>[tw.clone()],yje=()=>[Z2.clone(),J2.clone()];let Gr=class extends I1e(y1e){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new Jr,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new J3,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Aa({symbol:new Dv({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([se(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),se(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),se(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),se(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),se(()=>this.location,e=>this._locationChange(e)),se(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),se(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),se(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),se(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>OGe({event:e,view:this.view})),oa(()=>!this.waitingForResult,()=>this._waitingForResultChange(),ri),se(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),se(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),oa(()=>!this.visible,()=>this.browseClusterEnabled=!1),se(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new J3;e.removeAll();const{actions:t,defaultActions:r,defaultPopupTemplateEnabled:i,includeDefaultActions:s,selectedFeature:n}=this,o=s?r.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(i)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){const e=this._get("defaultActions")||new J3;return e.removeAll(),e.addMany(Fb(this.selectedFeature)?yje():gje()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:r,promiseCount:i,selectedFeatureIndex:s}=this,n=i&&t.length;n&&r&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){var i,s,n;let t=e;const r=(s=(i=this.view)==null?void 0:i.spatialReference)==null?void 0:s.isWebMercator;e&&((n=e==null?void 0:e.spatialReference)==null?void 0:n.isWGS84)&&r&&(t=ey(e)),this._set("location",t)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const r=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},i=()=>this._updatePendingPromises(t);t.then(r,i)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=v1e(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new j("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:r}=this;if(!r||!e)throw new j("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return r.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:r}=t;delete t.fetchFeatures,r&&this._setFetchFeaturesPromises(t.location);const i=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of i)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){DGe(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?Fb(t)?(await $Ge(this),await LGe(this)):ee.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):ee.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(tw.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Fb(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:r}=this;r&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:r,featuresPerPage:i,featureViewModels:s}=this;if(r===null)return;const n=((r-1)*i+t)%t,o=n+i;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){const{location:t,updateLocationEnabled:r,view:i}=this;if(e&&i){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(i.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Fb(e)?void 0:(e.symbol=await ije(e),this._selectedClusterFeature=e,void i.graphics.add(this._selectedClusterFeature));!r&&t||!e.geometry?r&&!e.geometry&&this.centerAtLocation().then(()=>{var n;const s=(n=i.center)==null?void 0:n.clone();s&&(this.location=s)}):this.location=b1e(e.geometry)}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:r,promisesPerLayerView:i}=t,s=Promise.resolve(r),n=i.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:r}=this;if(Fb(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const i=r.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(i.some((h,p)=>(h&&h.graphic===n&&(a=h,i.splice(p,1)),!!a)),a)s[o]=a;else{const h=new TZ({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),i.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:r}=this;if(t.remove(e),r&&this.view){const i=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},tv.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const r=new AbortController,{signal:i}=r;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:i,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:r}=e,{view:i}=this;this._fetchFeaturesWithController(t,e).then(s=>{var c;const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(h=>h.promise)];return(c=i==null?void 0:i.popup)==null||c.open({location:a||r,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:r}=e;return r&&"layer"in r&&r.layer?r.layer:(r==null?void 0:r.type)==="map-notes"||(r==null?void 0:r.type)==="subtype-group"?r:t}_getHighlightTarget(e,t){const r=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||cye:null,i=e.attributes;return i&&r&&i[r]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:r,activeFeature:i,visible:s}=this;if(!(i&&r&&t&&s))return;const n=this._getHighlightLayer(i);if(!(n&&n instanceof ZO))return;const o=this._getLayerView(r,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&Gie(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(i,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:r,view:i,visible:s}=this;if(!(t&&i&&r&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof ZO))return;const o=this._getLayerView(i,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&Gie(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const r=e.filter(i=>!t.includes(i));this.features=t.concat(r)}};u([d()],Gr.prototype,"featurePage",void 0),u([d()],Gr.prototype,"isLoadingFeature",null),u([d({type:J3})],Gr.prototype,"actions",void 0),u([d({readOnly:!0})],Gr.prototype,"active",null),u([d()],Gr.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Gr.prototype,"allActions",null),u([d({type:Boolean})],Gr.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Gr.prototype,"autoCloseEnabled",void 0),u([d()],Gr.prototype,"autoOpenEnabled",void 0),u([d()],Gr.prototype,"browseClusterEnabled",void 0),u([d()],Gr.prototype,"content",void 0),u([d({type:J3,readOnly:!0})],Gr.prototype,"defaultActions",null),u([d({readOnly:!0})],Gr.prototype,"featureCount",null),u([d()],Gr.prototype,"features",null),u([d()],Gr.prototype,"featuresPerPage",void 0),u([d()],Gr.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Gr.prototype,"featureViewModels",void 0),u([d()],Gr.prototype,"highlightEnabled",void 0),u([d()],Gr.prototype,"includeDefaultActions",void 0),u([d({type:yt})],Gr.prototype,"location",null),u([d({readOnly:!0})],Gr.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Gr.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Gr.prototype,"waitingForResult",null),u([d({readOnly:!0})],Gr.prototype,"promiseCount",null),u([d()],Gr.prototype,"promises",null),u([d({value:null,readOnly:!0})],Gr.prototype,"selectedFeature",null),u([d({value:-1})],Gr.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Gr.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Gr.prototype,"state",null),u([d()],Gr.prototype,"title",void 0),u([d()],Gr.prototype,"updateLocationEnabled",void 0),u([d()],Gr.prototype,"view",void 0),u([d()],Gr.prototype,"visible",void 0),u([d()],Gr.prototype,"zoomFactor",void 0),u([d()],Gr.prototype,"zoomToLocation",void 0),u([d()],Gr.prototype,"centerAtLocation",null),Gr=u([P("esri.widgets.Popup.PopupViewModel")],Gr);const $1e=Gr,jie="selected-index",_je=0,Hie="popup-spinner",qie={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Wie="esri-popup";function Xm(e,t){return t===void 0?`${Wie}__${e}`:`${Wie}__${e}-${t}`}const Xie={closeButton:!0,featureNavigation:!0};let Lt=class extends m1e(cl){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Jr,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([r])=>{(r==null?void 0:r.isIntersecting)&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=SS(()=>this._displaySpinner(),_je),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new pt,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new $1e,this.visibleElements={...Xie},this._handleOpenRelatedFeature=r=>{this._openRelatedFeature(r)},this._addSelectedFeatureIndexHandle(),this.addHandles([se(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._positionContainer()),se(()=>{var r;return[(r=this.viewModel)==null?void 0:r.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),se(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},(r,i)=>{!!r!=!!i&&this.reposition()}),se(()=>{var r,i,s,n,o,a;return[(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),se(()=>this.spinnerEnabled,r=>this._spinnerEnabledChange(r)),se(()=>{var r,i;return(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.size},(r,i)=>this._updateDockEnabledForViewSize(r,i)),se(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,i)=>this._viewChange(r,i)),se(()=>{var r,i;return(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.ready},(r,i)=>this._viewReadyChange(r!=null?r:!1,i!=null?i:!1)),se(()=>{var r,i;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(i=this.viewModel)==null?void 0:i.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),se(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),se(()=>{var r,i,s,n;return[(i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),se(()=>{var r,i,s,n;return[(i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),oa(()=>!this.collapsed,()=>{var r,i;((i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),dn(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},"change",()=>this._watchActions()),se(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},()=>this._watchActions(),kt),se(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop()),dn(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),se(()=>{var r,i,s,n;return[(i=(r=this._activeFlowItemWidget)==null?void 0:r.viewModel)==null?void 0:i.state,(n=(s=this._activeFlowItemWidget)==null?void 0:s.viewModel)==null?void 0:n.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([ie(()=>import("./calcite-flow.60520aec.js"),["assets/calcite-flow.60520aec.js","assets/observers.7ede75e6.js"]),ie(()=>import("./calcite-flow-item.d60b7e7b.js"),["assets/calcite-flow-item.d60b7e7b.js","assets/interactive.5b40332c.js","assets/loadable.f81dc576.js","assets/t9n.3c437af8.js","assets/observers.7ede75e6.js","assets/guid.ba2965fd.js","assets/action.bff37f67.js","assets/icon.3bedc1f6.js","assets/loader.ac3103ed.js","assets/tooltip.02230867.js","assets/debounce.aad9914a.js","assets/scrim.f5bc6086.js"]),ie(()=>import("./calcite-action.87c0b306.js"),["assets/calcite-action.87c0b306.js","assets/action.bff37f67.js","assets/guid.ba2965fd.js","assets/interactive.5b40332c.js","assets/loadable.f81dc576.js","assets/t9n.3c437af8.js","assets/observers.7ede75e6.js","assets/icon.3bedc1f6.js","assets/loader.ac3103ed.js"]),ie(()=>import("./calcite-tooltip.09afabd3.js"),["assets/calcite-tooltip.09afabd3.js","assets/tooltip.02230867.js","assets/debounce.aad9914a.js","assets/guid.ba2965fd.js"]),ie(()=>import("./calcite-icon.55d8d95f.js"),["assets/calcite-icon.55d8d95f.js","assets/icon.3bedc1f6.js","assets/observers.7ede75e6.js"])])}destroy(){var e,t;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:t}=this;if(!e)return!!(t!=null&&t.content);const r=e.viewModel;if((r==null?void 0:r.waitingForContent)||(r==null?void 0:r.state)==="error")return!0;const i=r==null?void 0:r.content;return Array.isArray(i)?!!i.length:!!i}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||qie}set dockOptions(e){var a,l;const t={...qie},r=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.breakpoints,i={};r&&(i.width=r.xsmall,i.height=r.xsmall);const s={...t,...e},n={...t.breakpoint,...i},{breakpoint:o}=s;typeof o=="object"?s.breakpoint={...n,...o}:o&&(s.breakpoint=n),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:r,_flowItems:i}=this,{selectedFeatureViewModel:s}=this.viewModel,n={...t,title:!1};return s?(e?(e.viewModel=s,e.visibleElements=n):this._feature=new EGe({flowItems:i,headingLevel:r+1,viewModel:s,visibleElements:n}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...Xie,...e}}blur(){const{active:e}=this.viewModel;e||ee.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||ee.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(jie);const t=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,i={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(i.collapsed=!0),this.set(i),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var y,_,b,x;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:r,dividedActions:i,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=i,l=o&&a.length>1&&e,c=o&&t,h=o&&!t,p=(_=(y=this.selectedFeature)==null?void 0:y.layer)==null?void 0:_.title,f=(x=(b=this.selectedFeature)==null?void 0:b.layer)==null?void 0:x.id,m={[Ae.alignTopCenter]:s==="top-center",[Ae.alignBottomCenter]:s==="bottom-center",[Ae.alignTopLeft]:s==="top-left",[Ae.alignBottomLeft]:s==="bottom-left",[Ae.alignTopRight]:s==="top-right",[Ae.alignBottomRight]:s==="bottom-right",[Ae.isDocked]:c,[Ae.shadow]:h,[Ae.isDockedTopLeft]:n==="top-left",[Ae.isDockedTopCenter]:n==="top-center",[Ae.isDockedTopRight]:n==="top-right",[Ae.isDockedBottomLeft]:n==="bottom-left",[Ae.isDockedBottomCenter]:n==="bottom-center",[Ae.isDockedBottomRight]:n==="bottom-right",[Ae.isFeatureMenuOpen]:r,[Ae.isActionsMenuOpen]:l};return ne("div",{class:this.classes(Ae.base,m),role:"presentation","data-layer-title":p,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return ne("span",{"aria-hidden":"true",class:this.classes(Ae.icon,Ae.iconLoading,Ae.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?ne("div",{key:Xm("loading-container"),role:"presentation",class:Ae.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=em(this.container),t={[Ae.iconRightTriangleArrow]:e,[Ae.paginationPreviousIconRTL]:e,[Ae.iconLeftTriangleArrow]:!e,[Ae.paginationPreviousIconLTR]:!e};return ne("span",{"aria-hidden":"true",class:this.classes(Ae.icon,t)})}renderPreviousButton(){const{messages:e}=this;return ne("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ae.button,Ae.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=em(this.container),t={[Ae.iconLeftTriangleArrow]:e,[Ae.paginationNextIconRTL]:e,[Ae.iconRightTriangleArrow]:!e,[Ae.paginationNextIconLTR]:!e};return ne("span",{"aria-hidden":"true",class:this.classes(Ae.icon,t)})}renderNextButton(){const{messages:e}=this;return ne("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ae.button,Ae.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:r}=this,{featureCount:i,selectedFeatureIndex:s}=this.viewModel;return ne("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ae.button,Ae.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":r.menu,title:r.menu},this._getPageText(i,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),r={[Ae.iconUndock]:e,[Ae.iconDock]:!e,[Ae.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[Ae.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[Ae.iconDockToTop]:!e&&t==="top-center",[Ae.iconDockToBottom]:!e&&t==="bottom-center"};return ne("span",{"aria-hidden":"true",class:this.classes(r,Ae.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,r=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,i=e?t.undock:t.dock;return r!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?ne("div",{role:"button","aria-label":i,title:i,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ae.button,Ae.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:r,contentCollapsed:i,messagesCommon:s}=this,n={[Ae.headerContainerButton]:r},o=ne(OY,{level:this.headingLevel,class:Ae.headerTitle,innerHTML:e!=null?e:""}),a=r?ne("button",{key:`${e}--collapsible`,id:t,title:i?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ae.headerContainer,n),"aria-expanded":i?"false":"true",onclick:this._toggleCollapsed,type:"button"},o,ne("calcite-icon",{class:Ae.collapseIcon,key:"collapse-icon",icon:i?"chevron-down":"chevron-up",scale:"m"})):ne("div",{key:e!=null?e:"title",id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ae.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return ne("span",{"aria-hidden":"true",class:this.classes(Ae.icon,Ae.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?ne("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ae.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return ne("header",{class:Ae.header},this.renderTitle(),ne("div",{class:Ae.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:r,_flowItems:i}=this,{content:s}=this.viewModel,n=i.toArray(),o={[Ae.contentHasFlows]:!!n.length};return t&&!r?ne("div",{key:s!=null?s:"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(Ae.content,o)},ne("calcite-flow",{bind:this},ne("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:FF,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),n.map(a=>this.renderFlowItem(a))),n.map(a=>this.renderFlowItemTooltips(a))):null}renderFlowItem(e){var s;const{messages:t}=this,r=ZF(),i="graphic"in e&&!e.isTable;return ne("calcite-flow-item",{bind:this,class:this.classes({[Ae.calciteThemeDark]:!r,[Ae.calciteThemeLight]:r}),heading:(s=e.title)!=null?s:"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},ne("calcite-action",{class:Ae.actionExit,icon:"move-up",label:t==null?void 0:t.exitRelatedRecords,text:t==null?void 0:t.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:n=>this._storeExitRelatedRecordsAction(e,n),onclick:this._destroyFlowItemWidgets}),i?ne("calcite-action",{class:Ae.actionSelectFeature,icon:"zoom-to-object",label:t==null?void 0:t.selectFeature,text:t==null?void 0:t.selectFeature,slot:"header-actions-end",bind:this,afterCreate:n=>this._storeFeatureSelectionAction(e,n),onclick:()=>this._handleOpenRelatedFeature(e)}):null,ne("div",{class:this.classes(Ae.contentFlowItem,{[Ae.calciteThemeDark]:r,[Ae.calciteThemeLight]:!r})},e.render()))}renderFlowItemTooltips(e){const{messages:t,_exitRelatedRecordsActions:r,_featureSelectionActions:i}=this,s=ZF(),n=i.get(e);return[ne("calcite-tooltip",{class:this.classes({[Ae.calciteThemeDark]:!s,[Ae.calciteThemeLight]:s}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:t==null?void 0:t.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:r.get(e),placement:"top"},t==null?void 0:t.exitRelatedRecords),n?ne("calcite-tooltip",{class:this.classes({[Ae.calciteThemeDark]:!s,[Ae.calciteThemeLight]:s}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:t==null?void 0:t.selectFeature,overlayPositioning:"fixed",referenceElement:n,placement:"top"},t==null?void 0:t.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i,messagesCommon:s}=this,n=r?s.close:s.open,{menuActions:o}=i;return o.length?ne("div",{key:Xm("actions-menu-button"),class:this.classes(Ae.button,Ae.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":r?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},ne("span",{"aria-hidden":"true",class:Ae.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i}=this,{menuActions:s}=i;return s.length&&r?ne("ul",{id:e,role:"menu","aria-labelledby":t,key:Xm("actions"),class:Ae.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map(t=>this.renderAction({action:t,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,r=!!e.length,i=!!t.length;return r||i?ne("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":i.toString(),class:Ae.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?ne("section",{key:Xm("navigation"),class:this.classes(Ae.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:r,menuActions:i}=t,s=!!r.length,n=!!i.length,o={[Ae.footerHasPagination]:e,[Ae.footerHasActions]:s,[Ae.footerHasActionsMenu]:n};return e||s?ne("div",{key:Xm("feature-buttons"),class:this.classes(Ae.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:r}=this.viewModel,i=Ff(e.selectedFeatures,{total:t.length});return ne("section",{key:Xm("menu"),class:Ae.featureMenu},ne("strong",{class:Ae.featureMenuHeader},i),ne("nav",{bind:this,class:Ae.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:FF},this.renderFeatureMenu(),ne("div",{class:Ae.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?ne("div",{class:Ae.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:ne("div",{key:Xm("pointer"),class:Ae.pointer,role:"presentation"},ne("div",{class:this.classes(Ae.pointerDirection,Ae.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:r,titleId:i,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||r==="top-left"||r==="top-center"||r==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||r==="bottom-left"||r==="bottom-center"||r==="bottom-right",f={[Ae.shadow]:e,[Ae.isCollapsible]:n,[Ae.isCollapsed]:a};return ne("div",{class:this.classes(Ae.main,Ae.widget,f),tabIndex:l.closeButton?void 0:-1,role:"dialog","aria-labelledby":c?i:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?ne("div",{class:an.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return ne("span",{key:"text",class:Ae.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),r=this._getActionImage(e),i={[Ae.iconLoading]:e.active,[Ae.rotating]:e.active,[Ae.icon]:!!t,[Ae.actionImage]:!e.active&&!!r};return t&&(i[t]=!e.active),ne("span",{key:"icon","aria-hidden":"true",class:this.classes(Ae.icon,i),styles:this._getIconStyles(r)})}renderAction(e){const{action:t,type:r}=e,i=this._getActionTitle(t),s={[Ae.action]:t.type!=="toggle",[Ae.actionToggle]:t.type==="toggle",[Ae.actionToggleOn]:t.type==="toggle"&&t.value,[Ae.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(i)],o=r==="menu-item"?ne("li",{key:t.uid,role:"menuitem",tabIndex:0,title:i,"aria-label":i,class:this.classes(Ae.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):ne("div",{key:t.uid,role:"button",tabIndex:0,title:i,"aria-label":i,class:this.classes(Ae.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:r,messagesCommon:i}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[Ae.featureMenuSelected]:o},l=o?ne("span",{key:Xm(`feature-menu-selected-feature-${s}`),title:r.selectedFeature,"aria-label":r.selectedFeature,class:Ae.iconCheckMark}):null,c=ne("span",{innerHTML:e.title||i.untitled});return ne("li",{role:"menuitem",tabIndex:-1,key:Xm(`feature-menu-feature-${s}`),class:this.classes(a,Ae.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},ne("span",{class:Ae.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?ne("ol",{class:Ae.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(r=>!!r.graphic).map((r,i)=>this.renderFeatureMenuItem(r,i))):null}_storeFeatureSelectionAction(e,t){this._featureSelectionActions.set(e,t),this.scheduleRender()}_storeExitRelatedRecordsAction(e,t){this._exitRelatedRecordsActions.set(e,t),this.scheduleRender()}_getFlowItemDescription(e){var t;return"featureCountDescription"in e?e.featureCountDescription:(t=e.viewModel.description)!=null?t:""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,r=t==null?void 0:t.geometry;if(E(r)||E(t))return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:r});const i=b1e(r);this.open({features:[t],location:v(i)?i:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){var l;const{messages:t,selectedFeature:r,messagesCommon:i}=this,{id:s}=e,n=r==null?void 0:r.attributes,o=(l=e.title)!=null?l:"",a=s==="zoom-to-feature"?Ff(o,{messages:t}):s==="remove-selected-feature"?Ff(o,{messages:i}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?Ff(o,{messages:t}):e.title;return a&&n?Ff(a,n):a!=null?a:""}_getActionClass(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{className:i,image:s}=e,n=s||i?i:Ae.iconDefaultAction;return n&&r?Ff(n,r):n!=null?n:""}_getActionImage(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{image:i}=e;return i&&r?Ff(i,r):i!=null?i:""}_createFeatureUpdatedAnimation(){return iFe("enter",Ae.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const r=Math.round(e);return Math.max(t?r-1:r,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(r=>{this._handles.add(se(()=>[r.uid,r.active,r.className,r.disabled,r.id,r.title,r.image,r.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),r=this._getInlineActionCount(),i=r===null,s=r===0;return{inlineActions:i?t.slice(0):s?new pt:t.slice(0,r),menuActions:i?new pt:s?t.slice(0):t.slice(r)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var r,i;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((r=e.viewModel)==null?void 0:r.state)==="error"?t.errorMessage:((i=e.viewModel)==null?void 0:i.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){Mb(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){Mb(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,r=e.currentTarget["data-feature-index"];t.activeFeature=t.features[r]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=Mb(e),{_featureMenuNode:r}=this,i=e.currentTarget["data-feature-index"];if(!r)return;const s=r.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(i+1+n)%n].focus()):(e.stopPropagation(),s[(i-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=Mb(e),{_actionsMenuNode:r}=this,i=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===i);if(!r)return;const o=r.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=Mb(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:r}=this.viewModel;r&&t?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e!=null&&e.shouldFocus&&(await iE(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=se(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,r)=>this._selectedFeatureIndexUpdated(t,r));this._handles.add(e,jie)}_selectedFeatureIndexUpdated(e,t){const{featureCount:r}=this;r&&e!==t&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:r,screenLocation:i,side:s,view:n}=e;if(isNaN(r)||isNaN(t)||!n||!i)return!1;const o=n.padding;return s==="right"&&i.x+r/2>n.width-o.right||s==="left"&&i.x-r/2<o.left||s==="top"&&i.y-t<o.top||s==="bottom"&&i.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:r,_mainContainerNode:i,viewModel:s}=this,{screenLocation:n,view:o}=s;if(E(n)||!o||!r)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(S){return parseInt(S.replace(/[^-\d\.]/g,""),10)}const l=i?window.getComputedStyle(i,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=r.getBoundingClientRect(),m=f+t,y=Math.max(p,c,h)+t,_=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"right",view:o}),b=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"left",view:o}),x=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"top",view:o}),T=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"bottom",view:o});return b?x?"bottom-right":"top-right":_?x?"bottom-left":"top-left":x?T?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return em(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,r=em(this.container)?"top-left":"top-right";if(!t)return r;const i=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-i.left-i.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:t}=this.viewModel,{width:r}=this._containerNode.getBoundingClientRect(),i=this._calculatePositionStyle(t,r);i&&Object.assign(this._containerNode.style,i)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:r}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+r:e}_calculateAlignmentPosition(e,t,r,i){const{currentAlignment:s,_pointerOffsetInPx:n}=this;if(!r)return;const{padding:o}=r,a=i/2,l=r.height-t,c=r.width-e;return s==="bottom-center"?{top:t+n-o.top,left:e-a-o.left}:s==="top-left"?{bottom:l+n-o.bottom,right:c+n-o.right}:s==="bottom-left"?{top:t+n-o.top,right:c+n-o.right}:s==="top-right"?{bottom:l+n-o.bottom,left:e+n-o.left}:s==="bottom-right"?{top:t+n-o.top,left:e+n-o.left}:s==="top-center"?{bottom:l+n-o.bottom,left:e-a-o.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:r,view:i}=this;if(!i)return;if(r)return{left:"",top:"",right:"",bottom:""};if(E(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,i,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const r=this.get("viewModel.view");this._wireUpView(r)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,r){const[i,s]=e,[n,o]=t,{width:a=0,height:l=0}=r!=null?r:{};return i<=a&&n>a||i>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},i=r.left+r.right,s=r.top+r.bottom,n=[],o=[];n[0]=e[0]-i,n[1]=e[1]-s,o[0]=t[0]-i,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const r=t.active&&!e;t.screenLocationEnabled=r}_shouldDockAtCurrentViewSize(e){var a,l,c,h;const t=e.breakpoint,r=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!r)return!1;const{width:i,height:s}=r;if(isNaN(i)||isNaN(s)||!t)return!1;const n=t.hasOwnProperty("width")&&i<=((c=t.width)!=null?c:0),o=t.hasOwnProperty("height")&&s<=((h=t.height)!=null?h:0);return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Ff(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(e,Hie),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new AGe({view:e}),e.ui.add(this._spinner,{key:Hie,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:r}=this.viewModel,i=r.findIndex(n=>n.uid===t),s=r.getItemAt(i);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(i)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],Lt.prototype,"actionsMenuId",null),u([d({readOnly:!0})],Lt.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],Lt.prototype,"featureMenuId",null),u([d({readOnly:!0})],Lt.prototype,"titleId",null),u([d({readOnly:!0})],Lt.prototype,"contentId",null),u([d({readOnly:!0})],Lt.prototype,"hasContent",null),u([d({readOnly:!0})],Lt.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],Lt.prototype,"collapsible",null),u([d({readOnly:!0})],Lt.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],Lt.prototype,"contentCollapsed",null),u([d({readOnly:!0})],Lt.prototype,"dividedActions",null),u([d({readOnly:!0,dependsOn:["_flowItems.length"]})],Lt.prototype,"_activeFlowItemWidget",null),u([d()],Lt.prototype,"actions",null),u([d()],Lt.prototype,"actionsMenuOpen",null),u([d()],Lt.prototype,"alignment",void 0),u([d()],Lt.prototype,"autoCloseEnabled",null),u([d()],Lt.prototype,"autoOpenEnabled",null),u([d()],Lt.prototype,"defaultPopupTemplateEnabled",null),u([d()],Lt.prototype,"content",null),u([d()],Lt.prototype,"collapsed",void 0),u([d()],Lt.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],Lt.prototype,"currentAlignment",null),u([d({readOnly:!0})],Lt.prototype,"currentDockPosition",null),u([d()],Lt.prototype,"dockOptions",null),u([d()],Lt.prototype,"dockEnabled",void 0),u([d({readOnly:!0})],Lt.prototype,"featureCount",null),u([d()],Lt.prototype,"featureMenuOpen",void 0),u([d()],Lt.prototype,"features",null),u([d()],Lt.prototype,"goToOverride",null),u([d()],Lt.prototype,"headingLevel",void 0),u([d()],Lt.prototype,"highlightEnabled",null),u([d()],Lt.prototype,"location",null),u([d()],Lt.prototype,"label",null),u([d()],Lt.prototype,"maxInlineActions",void 0),u([d(),il("esri/widgets/Popup/t9n/Popup")],Lt.prototype,"messages",void 0),u([d(),il("esri/t9n/common")],Lt.prototype,"messagesCommon",void 0),u([d()],Lt.prototype,"promises",null),u([d({readOnly:!0})],Lt.prototype,"selectedFeature",null),u([d()],Lt.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Lt.prototype,"selectedFeatureWidget",null),u([d()],Lt.prototype,"spinnerEnabled",void 0),u([d()],Lt.prototype,"title",null),u([d()],Lt.prototype,"updateLocationEnabled",null),u([d()],Lt.prototype,"view",null),u([d({type:$1e}),z5e(["triggerAction","trigger-action"])],Lt.prototype,"viewModel",void 0),u([d()],Lt.prototype,"visible",null),u([d()],Lt.prototype,"visibleElements",void 0),u([zt("visibleElements")],Lt.prototype,"castVisibleElements",null),u([Sh()],Lt.prototype,"_close",null),u([Sh()],Lt.prototype,"_toggleDockEnabled",null),u([Sh()],Lt.prototype,"_toggleFeatureMenu",null),u([Sh()],Lt.prototype,"_toggleActionsMenu",null),u([Sh()],Lt.prototype,"_triggerAction",null),u([Sh()],Lt.prototype,"_selectFeature",null),u([Sh()],Lt.prototype,"_next",null),u([Sh()],Lt.prototype,"_previous",null),Lt=u([P("esri.widgets.Popup")],Lt);const Yie=Lt,l9=[0,0];function vje(e){var i,s;const t=(e.ownerDocument||window.document).defaultView,r=e.getBoundingClientRect();return l9[0]=r.left+((i=t==null?void 0:t.pageXOffset)!=null?i:0),l9[1]=r.top+((s=t==null?void 0:t.pageYOffset)!=null?s:0),l9}function Zie(e){e&&(Eme(e),e.parentNode&&e.parentNode.removeChild(e))}function bje(e){const t=document.createElement("div");return e.appendChild(t),t}const pA=16,s$=750,wje=512,xje=2,Tje=e=>{let t=class extends e{constructor(...r){var i;super(...r),this._freqInfo={freq:pA,time:s$},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,r.length!==0&&((i=r[0])==null?void 0:i.popup)!==void 0||(this.popup=new Yie({view:this})),this.handles.add([se(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),se(()=>this.interacting,s=>{const{surface:n}=this;n&&n.setAttribute("data-interacting",s.toString())})])}initialize(){this.handles.add(se(()=>this.ui,(r,i)=>this._handleUIChange(r,i))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Ve(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){var r;return(r=this._get("container"))!=null?r:null}set container(r){const i=this._get("container"),s=Q5(r);if(s||typeof r!="string"||ee.getLogger(this.declaredClass).error("#container",`element with id '${r}' not found`),i===s)return;const n="dom-size";if(this.handles.remove(n),this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Zie(this.root),this._set("root",null)),this.userContent&&(vee(this.userContent,i),Zie(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",vee(s,o),s.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",s.insertBefore(a,s.firstChild),this._set("root",a);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,a.appendChild(l),this._set("surface",l);const c=new ote;a.appendChild(c.surface),this._set("overlay",c),se(()=>c.needsRender,h=>{h&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=rE({render:()=>{var p;return(p=this.overlay)==null?void 0:p.render()}}):this._overlayRenderTaskHandle=zi(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(se(()=>this.size,h=>{const[p,f]=h,m="esri-view-surface--inset-outline";p>=document.body.clientWidth||f>=document.body.clientHeight?l.classList.add(m):l.classList.remove(m)},kt),n),this._set("container",s),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}set popup(r){const i=this._get("popup");i&&i!==r&&i.destroy(),this._set("popup",r)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){i&&(this.handles.remove("ui"),i.destroy()),r&&this._wireUI(r),this._set("ui",r)}_wireUI(r){this.handles.remove("ui"),r&&(r.view=this,this.handles.add([se(()=>this.root,i=>{r.container=i?bje(i):null},kt),se(()=>this.popup,(i,s)=>{const n="popup",o="manual";s&&r.remove(s,n),i&&(i.view=r.view,r.add(i,{key:n,position:o}))},kt)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=pA,r.time=s$,this.handles.add([(()=>{const i=()=>{r.freq=pA,r.time=s$};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),rE({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=pA,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?pA:Math.min(s$,n.freq*xje),!s&&n.freq>=wje&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&vje(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d()],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d({type:Yie})],t.prototype,"popup",null),u([d({type:ote})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d()],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([P("esri.views.DOMContainer")],t),t},RZ=ee.getLogger("esri.layers.support.ElevationSampler");class L1e{queryElevation(t){return D1e(t.clone(),this)}on(){return Rje}projectIfRequired(t,r){return N1e(t,r)}}class Sje extends L1e{get spatialReference(){return this.extent.spatialReference}constructor(t,r,i){super(),this.tile=t,this.noDataValue=i;const s=t.tile.extent;this.extent=V5(s,r.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this._aaExtent=s;const n=ll(r.spatialReference),o=r.lodAt(t.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(t){const r=this.projectIfRequired(t,this.spatialReference);return!E(r)&&this.containsAt(r.x,r.y)}containsAt(t,r){return B5(this._aaExtent,t,r)}elevationAt(t,r){if(!this.containsAt(t,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return RZ.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return Pt(this.tile.sample(t,r),this.noDataValue)}}class E2t extends L1e{get spatialReference(){return this.extent.spatialReference}constructor(t,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?t.map(o=>new Sje(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=V5(ur(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(t,r){for(const i of this.samplers)if(i.containsAt(t,r))return i.elevationAt(t,r);return RZ.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler`),this.noDataValue}}function D1e(e,t){const r=N1e(e,t.spatialReference);if(!r)return null;switch(e.type){case"point":Eje(e,r,t);break;case"polyline":Cje(e,r,t);break;case"multipoint":Aje(e,r,t)}return e}function N1e(e,t){if(E(e))return null;const r=e.spatialReference;if(r.equals(t))return e;const i=gx(e,t);return i||RZ.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),i}function Eje(e,t,r){e.z=r.elevationAt(t.x,t.y)}function Cje(e,t,r){Wf.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Wf.x=c[0],Wf.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(Wf.x,Wf.y)}}e.hasZ=!0}function Aje(e,t,r){Wf.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];Wf.x=o[0],Wf.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(Wf.x,Wf.y)}e.hasZ=!0}const Wf=new yt,Rje={remove(){}};var eH;let xf=eH=class extends fe{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new eH({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],xf.prototype,"cols",void 0),u([d({type:Ri,json:{write:!0}})],xf.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],xf.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],xf.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],xf.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],xf.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],xf.prototype,"scale",void 0),xf=eH=u([P("esri.layers.support.LOD")],xf);const ip=xf;class Oje{constructor(t,r,i,s,n){this.id=t,this.level=r,this.row=i,this.col=s,this.extent=n}}var Q0;const Jie=new Vr({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Oo=Q0=class extends fe{static create(e={}){const{resolutionFactor:t=1,scales:r,size:i=256,spatialReference:s=Ye.WebMercator,numLODs:n=24}=e;if(!Ta(s)){const p=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];p.push(new ip({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift(new ip({level:m,scale:f,resolution:f})),f*=2}return new Q0({dpi:96,lods:p,origin:new yt(0,0,s),size:[i,i],spatialReference:s})}const o=Z_(s),a=e.origin?new yt({x:e.origin.x,y:e.origin.y,spatialReference:s}):new yt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(ll(s)*39.37*l),h=[];if(r)for(let p=0;p<r.length;p++){const f=r[p],m=f*c;h.push(new ip({level:p,scale:f,resolution:m}))}else{let p=lpe(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(n/t);h.push(new ip({level:0,scale:p,resolution:p*c}));for(let m=1;m<f;m++){const y=p/2**t,_=y*c;h.push(new ip({level:m,scale:y,resolution:_})),p=y}}return new Q0({dpi:l,lods:h,origin:a,size:[i,i],spatialReference:s})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=Z_(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return yt.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const i=[],s=this._levelToLOD={};e&&(t=-1/0,r=1/0,e.forEach(n=>{i.push(n.scale),t=n.scale>t?n.scale:t,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("minScale",t),this._set("maxScale",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const r=Math.floor(e),i=r+1;return t[r]/(t[r]/t[i])**(e-r)}scaleToZoom(e){const t=this.scales,r=t.length-1;let i=0;for(;i<r;i++){const s=t[i],n=t[i+1];if(s<=e)return i;if(n===e)return i+1;if(s>e&&n<e)return i+Math.log(s/e)/Math.log(s/n)}return i}snapScale(e,t=.95){const r=this.scaleToZoom(e);return r%Math.floor(r)>=t?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(e,t,r,i){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=r;else if(Pn(t.spatialReference,this.spatialReference))n=t.x,o=t.y,i=r;else{const c=gx(t,this.spatialReference);if(E(c))return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new Oje(null,0,0,0,ur())),i.level=e,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(e,t=Q0.ExtrapolateOptions.NONE){let r=this.lodAt(e.level);if(!r&&t===Q0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(r=o)}if(!r)return;const i=e.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=ur()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const r=this.lodAt(t.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return e[0]=this.origin.x+t.col*s,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+s,e[3]=e[1]+n,e}lodAt(e){var t,r;return(r=(t=this._levelToLOD)==null?void 0:t[e])!=null?r:null}clone(){return Q0.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*t;r.push(new ip({level:n.level,scale:n.scale,resolution:o}))}return new Q0({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}};u([d({type:Number,json:{write:!0}})],Oo.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],Oo.prototype,"dpi",void 0),u([d({type:String,json:{read:Jie.read,write:Jie.write,origins:{"web-scene":{read:!1,write:!1}}}})],Oo.prototype,"format",void 0),u([d({readOnly:!0})],Oo.prototype,"isWrappable",null),u([d({type:yt,json:{write:!0}})],Oo.prototype,"origin",void 0),u([De("origin")],Oo.prototype,"readOrigin",null),u([d({type:[ip],value:null,json:{write:!0}})],Oo.prototype,"lods",null),u([d({readOnly:!0})],Oo.prototype,"minScale",void 0),u([d({readOnly:!0})],Oo.prototype,"maxScale",void 0),u([d({readOnly:!0})],Oo.prototype,"scales",void 0),u([d({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],Oo.prototype,"size",void 0),u([De("size",["rows","cols"])],Oo.prototype,"readSize",null),u([Be("size",{cols:{type:Ri},rows:{type:Ri}})],Oo.prototype,"writeSize",null),u([d({type:Ye,json:{write:!0}})],Oo.prototype,"spatialReference",void 0),Oo=Q0=u([P("esri.layers.support.TileInfo")],Oo),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(Oo||(Oo={}));const iN=Oo,Mje=12;class rs{constructor(t){const r=rs.checkUnsupported(t);if(v(r))throw r;const i=t;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Nw(this.spatialReference)||Om(this.spatialReference)||Mm(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new rs(this.toTileInfo())}toTileInfo(){return new iN({dpi:this.dpi,origin:new yt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,r)=>new ip({level:r,scale:t.scale,resolution:t.resolution}))})}getExtent(t,r,i,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(t,r){this._isWebMercator?(r[0]=HK(t[0]),r[1]=gF(t[1]),r[2]=HK(t[2]),r[3]=gF(t[3])):this._isGCS&&(r[0]=Gt(t[0]),r[1]=Gt(t[1]),r[2]=Gt(t[2]),r[3]=Gt(t[3]))}getExtentGeometry(t,r,i,s=new qr){return this.getExtent(t,r,i,qp),s.spatialReference=this.spatialReference,s.xmin=qp[0],s.ymin=qp[1],s.xmax=qp[2],s.ymax=qp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let r=!1;for(;this.levels.length<=t;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const r=this.levels[0].scale;return t>=r?0:Math.log(r/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof rs)){if(rs.checkUnsupported(t))return!1;t=new rs(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,t.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!gS(t.origin[0],this.origin[0],s)||!gS(t.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*Mje,gS(i,t.levels[r].resolution,s))}rootTilesInExtent(t,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(E(t)||n[0]===0||n[1]===0)return s;rs.computeRowColExtent(t,n,this.origin,qp);let o=qp[1],a=qp[3],l=qp[0],c=qp[2];const h=c-l,p=a-o;if(h*p>i){const f=Math.floor(Math.sqrt(i));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return v(r)&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,r,i,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-t[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-t[1]-n)/r[1]))}static isPowerOfTwo(t){const r=t.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!BAe(s.resolution,i/2**s.level))}static hasGapInLevels(t){const r=t.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(t){const r=t.size[1];return r===t.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(t){const r=t.origin;return t.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new j("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return E(t)?OZ():t.lods.length<1?new j("tilingscheme:generic","Tiling scheme must have at least one level"):rs.isPowerOfTwo(t)?rs.hasGapInLevels(t)?new j("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):rs.tileSizeSupported(t)?rs.hasOriginPerLODs(t)?new j("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new j("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new j("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,r){const i=t[2]-t[0],s=t[3]-t[1],n=ll(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,h=new rs(new iN({size:[a,a],origin:new yt({x:t[0]-.5*(o-i),y:t[3]+.5*(o-s)}),lods:[new ip({level:0,resolution:o/a,scale:1/(a/l*c/(o*n))})],spatialReference:r}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const r=new rs(rs.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(t),r}static makeGCSWithTileSize(t,r=256,i=16){const s=256/r,n=new rs(new iN({size:[r,r],origin:new yt({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new ip({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function OZ(){return new j("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}rs.WebMercatorAuxiliarySphereTileInfo=new iN({size:[256,256],origin:new yt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ye.WebMercator}),spatialReference:Ye.WebMercator,lods:[new ip({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),rs.WebMercatorAuxiliarySphere=rs.makeWebMercatorAuxiliarySphere(19);const qp=ur(),Q2=64,XR=512,Pje=2.5,QO=zAe(jB/10),F1e=2,U1e=ur();rs.WebMercatorAuxiliarySphere.getExtent(0,0,0,U1e);const Ije=ur([-180,-90,180,90]),$je="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Lje="Surface extent is too large for tile resolution at level 0.",Dje=3;let Nje=Dje;function tH(e){return e<4?3:Nje}let K0=class extends Vs.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=QO}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||E(e.extent)||E(e.spatialReference))return null;const t=V5(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){var e;return Pt((e=this.view.basemapTerrain)==null?void 0:e.spatialReference,Ye.WGS84)}elevationAt(e,t){var r;if(E(this.extent)||!Ya(this.extent,e,t)){const i=v(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ee.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return Pt((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return D1e(e.clone(),this)}};u([d({readOnly:!0})],K0.prototype,"demResolution",void 0),u([d({readOnly:!0})],K0.prototype,"extent",null),u([d({readOnly:!0})],K0.prototype,"noDataValue",void 0),u([d()],K0.prototype,"spatialReference",null),u([d({constructOnly:!0})],K0.prototype,"view",void 0),K0=u([P("esri.views.support.GroundViewElevationSampler")],K0);const Fje=K0;let e_=class extends Te{constructor(e){super(e),this._handles=new Jr,this.view=null,this.layerViews=new pt}initialize(){this._handles.add(oa(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Fje({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>se(()=>e.updating,()=>this._updateUpdating(),ri)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],e_.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],e_.prototype,"updating",null),u([d({constructOnly:!0})],e_.prototype,"view",void 0),u([d({type:pt,readOnly:!0})],e_.prototype,"layerViews",void 0),u([d({readOnly:!0})],e_.prototype,"suspended",null),e_=u([P("esri.views.GroundView")],e_);const Uje=e_,kje=e=>{let t=class extends e{async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:KB([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:v(s)?s.event:void 0,signal:v(s)?s.signal:void 0,defaultPopupTemplateEnabled:!!v(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(v(i)&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const s=await this.popupHitTest(r),n=s.results,o=s.mapPoint,a=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),v(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return v(r)&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([P("esri.views.PopupView")],t),t};async function MZ(e,t){return await e.load(),Vje(e,t)}async function Vje(e,t){const r=[],i=(...n)=>{for(const o of n)E(o)||(Array.isArray(o)?i(...o):pt.isCollection(o)?o.forEach(a=>i(a)):Tm.isLoadable(o)&&r.push(o))};t(i);let s=null;if(await t6e(r,async n=>{const o=await Vc(Bje(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return e}function Bje(e){return"loadAll"in e&&typeof e.loadAll=="function"}async function zje(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,r=await Rme("esri/t9n/basemaps");return r[e]||r[t]}const rH={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Kr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Kr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Kr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Kr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Kr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Kr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Kr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Kr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Kr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Kr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Kr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Kr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Kr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Kr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Kr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Kr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},Gje=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),jje=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function Hje(e){return e.layerContainerType==="basemap"?Gje:e.layerContainerType==="operational-layers"?jje:null}function qje(e,t){if(t.restrictedWebMapWriting){const r=Hje(t);return!v(r)||r.has(e.type)&&!mY(e)}return!0}function Wje(e,t){if(t)if(mY(e)){const r=eP("featureCollection.layers",t),i=r&&r[0]&&r[0].layerDefinition;i&&c9(e,i)}else e.type==="stream"?c9(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&c9(e,t)}function c9(e,t){var r,i;"maxScale"in e&&(t.maxScale=(r=mF(e.maxScale))!=null?r:void 0),"minScale"in e&&(t.minScale=(i=mF(e.minScale))!=null?i:void 0)}function Xje(e,t){var r;if(Wje(e,t),t&&("blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=(r=mF(e.opacity))!=null?r:void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts"))if(mY(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function Qie(e,t,r){if(!("write"in e)||!e.write)return r&&r.messages&&r.messages.push(new j("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(qje(e,r)){const i={};return e.write(i,r)?i:null}return v(t)&&Xje(e,t=re(t)),t}var sN;let Yje=0;const k1e="esri.Basemap";let fh=sN=class extends nP(Tm){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+Yje++,this.baseLayers=new pt,this.referenceLayers=new pt;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&ee.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.baseLayers.on("after-add",i=>t(i.item)),this.referenceLayers.on("after-add",i=>t(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(e=>{ee.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const e=this.baseLayers.removeAll();for(const i of e)i.destroy();const t=this.referenceLayers.removeAll();for(const i of t)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",gy(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const i=[];e&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=Qie(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);v(n)&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=Qie(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);v(n)&&(s.type!=="scene"&&(n.isReference=!0),i.push(n))})),t.baseMapLayers=i}set referenceLayers(e){this._set("referenceLayers",gy(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return MZ(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new sN({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=re(r);return i.url&&xm(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&xm(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r}=this;cr(e);const i=[];if(t){const s=t.context?t.context.url:null;if(i.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;i.push(zje(n).then(o=>{o&&this.read({title:o},t.context)}))}}else r&&i.push(this._loadFromItem(r,e));await Promise.all(i)}async _loadLayersFromJSON(e,t,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=i&&i.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await ie(()=>import("./layersCreator.57188091.js"),["assets/layersCreator.57188091.js","assets/lazyLayerLoader.8af10eca.js","assets/portalLayers.c475d6b2.js","assets/layersLoader.b6701a4d.js","assets/fetchService.d8bf9569.js","assets/jsonContext.fc22b0d2.js"]),a=[];if(cr(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>n==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,h=o(this.baseLayers,e.baseMapLayers.filter(f=>!c(f)),l);a.push(h);const p=o(this.referenceLayers,e.baseMapLayers.filter(c),l);a.push(p)}await fo(a)}async _loadFromItem(e,t){var n,o;const r=await e.load(t),i=await r.fetchData("json",t),s=po((n=e.itemUrl)!=null?n:"");return this._set("resourceInfo",{data:(o=i.baseMap)!=null?o:{},context:{origin:e.type==="Web Scene"?"web-scene":"web-map",portal:e.portal||Uo.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Uo.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=rH[e];if(t){if(t.deprecated){let r=null;e==="dark-gray"?r="dark-gray-vector":e==="gray"?r="gray-vector":e==="streets"?r="streets-vector":e==="topo"&&(r="topo-vector"),bde(ee.getLogger(k1e),`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return sN.fromJSON(t)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,i){this._writeBaseLayers(e,t,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:pt}},writer(e,t,r,i){this._writeBaseLayers(e,t,i)}}}}}})],fh.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],fh.prototype,"id",void 0),u([d({type:gw})],fh.prototype,"portalItem",void 0),u([d()],fh.prototype,"referenceLayers",null),u([d({readOnly:!0})],fh.prototype,"resourceInfo",void 0),u([d({type:Ye})],fh.prototype,"spatialReference",void 0),u([d()],fh.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],fh.prototype,"title",void 0),u([Be("title")],fh.prototype,"writeTitle",null),fh=sN=u([P(k1e)],fh);const PE=fh;var Zje=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:PE}),iH;let nN=iH=class extends fe{constructor(e){super(e),this.type="none"}clone(){return new iH({type:this.type})}};u([ft({none:"none",stayAbove:"stay-above"})],nN.prototype,"type",void 0),nN=iH=u([P("esri.ground.NavigationConstraint")],nN);let Is=class extends Te{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};u([d()],Is.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],Is.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],Is.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],Is.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],Is.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],Is.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],Is.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],Is.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],Is.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],Is.prototype,"SHOW_POI",void 0),u([d()],Is.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],Is.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],Is.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],Is.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],Is.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],Is.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],Is.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],Is.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],Is.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],Is.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],Is.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],Is.prototype,"LINE_WIREFRAMES",void 0),u([d()],Is.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),Is=u([P("esri.views.3d.support.DebugFlags")],Is);const Xr=new Is;var sH;let Tf=sH=class extends nP(Tm){constructor(e){super(e),this.opacity=1,this.shading=!Xr.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new pt;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&ee.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.layers.on("after-add",i=>t(i.item)),this.layers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(e=>{ee.getLogger(this.declaredClass).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",gy(e,this._get("layers")))}writeLayers(e,t,r,i){const s=[];e&&(i={...i,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const o={};oke(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new j("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return MZ(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await ie(()=>import("./ElevationQuery.22dcb413.js"),[]);cr(t);const i=new r,s=this.layers.filter(Kie).toArray();return i.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await ie(()=>import("./ElevationQuery.22dcb413.js"),[]);cr(t);const i=new r,s=this.layers.filter(Kie).toArray();return i.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:re(this.surfaceColor),navigationConstraint:re(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new sH({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}_loadLayersFromJSON(e,t,r){const i=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return ie(()=>import("./layersCreator.57188091.js"),["assets/layersCreator.57188091.js","assets/lazyLayerLoader.8af10eca.js","assets/portalLayers.c475d6b2.js","assets/layersLoader.b6701a4d.js","assets/fetchService.d8bf9569.js","assets/jsonContext.fc22b0d2.js"]).then(({populateOperationalLayers:o})=>{cr(r);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return fo(a)}).then(()=>{})}};function Jje(e){return e&&"createElevationSampler"in e}function Kie(e){return e.type==="elevation"||Jje(e)}u([d({json:{read:!1}})],Tf.prototype,"layers",null),u([Be("layers")],Tf.prototype,"writeLayers",null),u([d({readOnly:!0})],Tf.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ri,read:{reader:hE,source:"transparency"},write:{writer:(e,t)=>{t.transparency=hP(e)},target:"transparency"}}})],Tf.prototype,"opacity",void 0),u([d({type:Boolean,nonNullable:!0,json:{read:!1}})],Tf.prototype,"shading",void 0),u([d({type:Qe,json:{type:[Ri],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],Tf.prototype,"surfaceColor",void 0),u([d({type:nN,json:{write:!0}})],Tf.prototype,"navigationConstraint",void 0),Tf=sH=u([P("esri.Ground")],Tf);const KO=Tf;let g2=class extends pt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(Nde(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=v(this.getCollections)?this.getCollections():null;if(E(e))return void this.removeAll();let t=0;for(const r of e)v(r)&&(t=this._processCollection(t,r));this.splice(t,this.length)}_createNewInstance(e){return new pt(e)}_processCollection(e,t){if(!t)return e;const r=this.itemFilterFunction?this.itemFilterFunction:i=>!!i;for(const i of t)if(i){if(r(i)){const s=this.indexOf(i,e);s>=0?s!==e&&this.reorder(i,e):this.add(i,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(i);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([d()],g2.prototype,"getCollections",void 0),u([d()],g2.prototype,"getChildrenFunction",void 0),u([d()],g2.prototype,"itemFilterFunction",void 0),g2=u([P("esri.core.CollectionFlattener")],g2);const eM=g2;function Qje(e){var t,r;return!(!(e!=null&&e.loaded)||!((r=(t=pye(e))==null?void 0:t.operations)!=null&&r.supportsEditing)||"editingEnabled"in e&&!rNe(e))}const ese=ee.getLogger("esri.support.basemapUtils");function Kje(){return{}}function eHe(e){for(const t in e){const r=e[t];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete e[t]}}function PZ(e,t){let r;if(typeof e=="string"){if(!(e in rH)){const i=Object.entries(rH).filter(([s,n])=>ni.apiKey&&!n.classic||!ni.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return ese.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${i}`),null}t&&(r=t[e]),r||(r=PE.fromId(e),t&&(t[e]=r))}else r=Us(PE,e);return r!=null&&r.destroyed&&(ese.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function tHe(e,t=null){const r=PZ(e);if(!r)return null;const i=new PE({id:r.id,title:r.title,baseLayers:r.baseLayers.slice(),referenceLayers:r.referenceLayers.slice()});return t&&(i.baseLayers=tse(i.baseLayers,t.baseLayers),i.referenceLayers=tse(i.referenceLayers,t.referenceLayers)),i.load().catch(()=>{}),i.portalItem=r.portalItem,i}function tse(e,t){const r=new pt;return e.forEach(i=>{const s=t.find(n=>rHe(rse(i),rse(n)))||i;r.includes(s)?r.push(i):r.push(s)}),r}function rse(e){var t,r;return{type:e.type,url:iHe("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||!v(e.sublayers)||(t=e.sublayers)==null?void 0:t.map(i=>({id:i.id,visible:i.visible})),activeLayerId:e.type==="wmts"?(r=e.activeLayer)==null?void 0:r.id:void 0}}function rHe(e,t){if(e.type!==t.type||e.type==="scene"||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(v(e.activeLayerId)||v(t.activeLayerId))return e.activeLayerId===t.activeLayerId;if(v(e.sublayers)||v(t.sublayers)){if(E(e.sublayers)||E(t.sublayers)||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const i=e.sublayers.at(r),s=t.sublayers.at(r);if((i==null?void 0:i.id)!==(s==null?void 0:s.id)||(i==null?void 0:i.visible)!==(s==null?void 0:s.visible))return!1}}return!0}function iHe(e){return e?jh(e).replace(/^\s*https?:/i,"").toLowerCase():""}function sHe(e){return new eM({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const r=[];return"tables"in t&&r.push(t.tables),"layers"in t&&r.push(t.layers),r},itemFilterFunction:t=>{const r=t.parent;return!!r&&"tables"in r&&r.tables.includes(t)}})}const ise={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function nHe(e){let t=null;if(typeof e=="string")if(e in ise){const r=ise[e];t=new KO({resourceInfo:{data:{layers:[r]}}})}else ee.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=Us(KO,e);return t}function nH(e,t,r){let i,s;if(e)for(let n=0,o=e.length;n<o;n++){if(i=e.getItemAt(n),i[t]===r)return i;if((i==null?void 0:i.type)==="group"&&(s=nH(i.layers,t,r),s))return s}}const oHe=e=>{let t=class extends e{constructor(...r){super(...r),this.layers=new pt;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||ee.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const r=this.layers.removeAll();for(const i of r)this.layerRemoved(i),i.destroy();this.layers.destroy()}set layers(r){this._set("layers",gy(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof ZO){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else Hu(r)?r.then(n=>{this.destroyed||this.add(n,i)}):ee.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;let n=s.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(r){return nH(this.layers,"id",r)}findLayerByUid(r){return nH(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([d()],t.prototype,"layers",null),t=u([P("esri.support.LayersMixin")],t),t};function oH(e,t,r){if(e)for(let i=0,s=e.length;i<s;i++){const n=e.getItemAt(i);if(n[t]===r)return n;if((n==null?void 0:n.type)==="group"){const o=oH(n.tables,t,r);if(o)return o}}}const aHe=e=>{let t=class extends e{constructor(...r){super(...r),this.tables=new pt,this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&ee.getLogger(this.declaredClass).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",gy(r,this._get("tables")))}findTableById(r){return oH(this.tables,"id",r)}findTableByUid(r){return oH(this.tables,"uid",r)}};return u([d()],t.prototype,"tables",null),t=u([P("esri.support.TablesMixin")],t),t};let Sf=class extends aHe(oHe(Vs.EventedMixin(Te))){constructor(e){super(e),this.allLayers=new eM({getCollections:()=>{var t,r,i;return[(t=this.basemap)==null?void 0:t.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(i=this.basemap)==null?void 0:i.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=sHe(this),this.basemap=null,this.editableLayers=new eM({getCollections:()=>[this.allLayers],itemFilterFunction:Qje}),this.ground=new KO,this._basemapCache=Kje()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),eHe(this._basemapCache),this._basemapCache=null}castBasemap(e){return PZ(e,this._basemapCache)}castGround(e){const t=nHe(e);return E(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],Sf.prototype,"allLayers",void 0),u([d({readOnly:!0})],Sf.prototype,"allTables",void 0),u([d({type:PE})],Sf.prototype,"basemap",void 0),u([zt("basemap")],Sf.prototype,"castBasemap",null),u([d({readOnly:!0})],Sf.prototype,"editableLayers",void 0),u([d({type:KO,nonNullable:!0})],Sf.prototype,"ground",void 0),u([zt("ground")],Sf.prototype,"castGround",null),Sf=u([P("esri.Map")],Sf);const V1e=Sf;let Q3=class extends N3{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([oX({Type:Aa,ensureType:Us(Aa)})],Q3.prototype,"itemType",void 0),Q3=u([P("esri.support.GraphicsCollection")],Q3);let t_=class extends Te{constructor(e){super(e),this.view=null,this.baseLayerViews=new pt,this.referenceLayerViews=new pt,this._loadingHandle=se(()=>{var t,r;return(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap},t=>{t&&t.load().catch(()=>{})},kt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,r;if(this.view&&this.view.suspended)return!1;const e=(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};u([d({constructOnly:!0})],t_.prototype,"view",void 0),u([d({readOnly:!0})],t_.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],t_.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],t_.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],t_.prototype,"updating",null),t_=u([P("esri.views.BasemapView")],t_);function lHe(e){return"tryRecycleWith"in e}class cHe{constructor(t,r,i){this.layer=t,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=cv(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Ca(this._controller.signal,()=>{const s=new j("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}tryRecycle(t){if(!this.done||!this.layerView||!lHe(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let s=0;s<t.length;s++){const n=t[s];if(n.type!==r)continue;const o=this.layerView.tryRecycleWith(n,{signal:i});if(o){t.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(cr(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,h)=>Ca(this._controller.signal,()=>h(Wr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:t}),i.emit("layerview-destroy",{layer:r,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n,o;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:r,view:i}=this;this._map=i.map;try{let a,l;if(await r.load({signal:t}),"prefetchResources"in r&&await((s=r.prefetchResources)==null?void 0:s.call(r,{signal:t})),hHe(r))a=await r.createLayerView(i,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new j("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(r);cr(t),a="default"in p?new p.default({layer:r,view:i}):new p({layer:r,view:i})}const c=()=>{l=zi(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=Ca(t,c),cr(t);try{await a.when()}catch(p){throw c(),p}if(!((o=(n=this._map)==null?void 0:n.allLayers)==null?void 0:o.includes(r)))return c(),void this._deferred.reject(new j("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new j("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}}let mh=class extends Te{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new om,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const t=(r=this.view.map)==null?void 0:r.allLayers;if(t)for(const i of t)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>(E(this._workPromise)&&(this._workPromise=cv(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(hC(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var a,l,c;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),E(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,i=[],s=this.view.ready,n=h=>{if(!E(h)){for(const p of h)if(p){r.add(p);const f=this._layerLayerViewInfoMap.get(p);f&&s?f.start():f||this._recyclingInfoMap.has(p)||i.push(p),"layers"in p&&p.layers&&n(p.layers)}}};for(const h of this._rootCollectionNames)n(this.get(h));for(const[h,p]of this._layerLayerViewInfoMap)if(!r.has(h)){this._layerLayerViewInfoMap.delete(p.layer);const f=p.tryRecycle(i);f?(this._recyclingInfoMap.set(p.layer,p),f.then(()=>{this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[h,p]of this._recyclingInfoMap)r.has(h)||(this._recyclingInfoMap.delete(p.layer),p.destroy());for(const h of i)this._createLayerView(h);this._refreshCollections();const o=[(a=t==null?void 0:t.ground)==null?void 0:a.layers,(l=t==null?void 0:t.basemap)==null?void 0:l.baseLayers,(c=t==null?void 0:t.basemap)==null?void 0:c.referenceLayers,t==null?void 0:t.layers].filter(h=>!!h);r.forEach(h=>"layers"in h&&o.push(h.layers)),this.addHandles(o.map(h=>this._watchUpdatingTracking.addOnCollectionChange(()=>h,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([dn(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),se(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Ys)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,v(this._workPromise)&&(this._workPromise.reject(Wr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return v(this._workPromise)||this._watchUpdatingTracking.updating||ea(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new j("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,r){if(!e||!t)return void(t&&t.removeAll());let i=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=r,t.getItemAt(i)!==o&&t.splice(i,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),i+=1}i<t.length&&t.splice(i,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new cHe(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),r=>{var i,s;r&&(sn(r)||r.name==="cancelled:layerview-create")||ee.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${(i=e.title)!=null?i:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],mh.prototype,"_workPromise",void 0),u([d({readOnly:!0})],mh.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],mh.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],mh.prototype,"_rootCollectionNames",null),u([d()],mh.prototype,"layerViewImporter",void 0),u([d()],mh.prototype,"supportsGround",void 0),u([d({readOnly:!0})],mh.prototype,"updating",null),u([d({readOnly:!0})],mh.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],mh.prototype,"view",void 0),mh=u([P("esri.views.LayerViewManager")],mh);const uHe=mh;function hHe(e){return"createLayerView"in e&&e.createLayerView!=null}let ou=class extends Te{constructor(e){super(e),this.factor=1.5,this.offset=Kh(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],ou.prototype,"factor",void 0),u([d({nonNullable:!0})],ou.prototype,"offset",void 0),u([d()],ou.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],ou.prototype,"size",void 0),u([d()],ou.prototype,"maskUrl",void 0),u([d()],ou.prototype,"maskEnabled",void 0),u([d()],ou.prototype,"overlayUrl",void 0),u([d()],ou.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],ou.prototype,"version",null),u([d({type:Boolean})],ou.prototype,"visible",void 0),ou=u([P("esri.views.Magnifier")],ou);const B1e=ou;class dHe{constructor(){this._tasks=new Array,this._running=new a4(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask(t){for(;!t.done&&this._process(t);)t.madeProgress()}push(t,r,i){return this._running.set(!0),new Promise((s,n)=>this._tasks.push(new sse(s,n,t,r,i)))}unshift(t,r,i){return this._running.set(!0),new Promise((s,n)=>this._tasks.unshift(new sse(s,n,t,r,i)))}_process(t){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const s=zn(r.signal);if(s&&!r.abortCallback)r.reject(Wr());else{const n=s?(i=r.abortCallback)==null?void 0:i.call(r,Wr()):r.callback(t);Hu(n)?n.then(r.resolve,r.reject):r.resolve(n)}}catch(s){r.reject(s)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const t=Wr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(t);r.resolve(i)}else r.reject(t);this._tasks.length=0,this._running.set(!1)}}class sse{constructor(t,r,i,s,n){this.resolve=t,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}}let YR=class extends Te{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],YR.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],YR.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),YR=u([P("esri.views.support.DebugFlags")],YR);const pHe=new YR;var Sr;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Sr||(Sr={}));function fHe(){return new l4.Scheduler}var na,gt;(function(e){e[e.YIELD=1]="YIELD"})(na||(na={})),function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e[e.TEST_PRIO=1]="TEST_PRIO"}(gt||(gt={}));const Bf=0,nse=new Map([[gt.RESOURCE_CONTROLLER_IMMEDIATE,Bf],[gt.RESOURCE_CONTROLLER,4],[gt.SLIDE,Bf],[gt.STREAM_DATA_LOADER,Bf],[gt.ELEVATION_QUERY,Bf],[gt.TERRAIN_SURFACE,1],[gt.SURFACE_GEOMETRY_UPDATES,1],[gt.LOD_RENDERER,2],[gt.GRAPHICS_CORE,2],[gt.I3S_CONTROLLER,2],[gt.POINT_CLOUD_LAYER,2],[gt.FEATURE_TILE_FETCHER,2],[gt.OVERLAY,4],[gt.STAGE,4],[gt.GRAPHICS_DECONFLICTOR,4],[gt.FILTER_VISIBILITY,4],[gt.SCALE_VISIBILITY,4],[gt.FRUSTUM_VISIBILITY,4],[gt.CLOUDS_GENERATOR,4],[gt.POINT_OF_INTEREST_FREQUENT,6],[gt.POINT_OF_INTEREST_INFREQUENT,30],[gt.LABELER,8],[gt.FEATURE_QUERY_ENGINE,8],[gt.FEATURE_TILE_TREE,16],[gt.FEATURE_TILE_TREE_ACTIVE,Bf],[gt.ELEVATION_ALIGNMENT,12],[gt.TEXT_TEXTURE_ATLAS,12],[gt.TEXTURE_UNLOAD,12],[gt.LINE_OF_SIGHT_TOOL,16],[gt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Bf],[gt.SNAPPING,Bf],[gt.SHADOW_ACCUMULATOR,30]]);function ose(e){return nse.has(e)?nse.get(e):typeof e=="number"?e:1}const ase=6.5,lse=1,mHe=30,cse=1e3/30,use=100,hse=.9;var l4,Qv;(function(e){class t{get updating(){return this._updating.get()}_updatingChanged(){this._updating.set(this._tasks.some(n=>n.needsUpdate))}constructor(){this._updating=new a4(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Xg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Sr.INTERACTING,this._tasks=new Jt,this._runQueue=new Jt,this._load=0,this._idleStateCallbacks=new Jt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=se(()=>pHe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,kt);for(const o of Object.keys(gt))this.performanceInfo.tasks.set(gt[o],new Xg(gt[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:ase,INTERACTING_BUDGET:cse,IDLE_BUDGET:use,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),zi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=ose(n),l=new r(this,n,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new Xg(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Sr.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Sr.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Sr.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=ase,a=n.frameDuration,l=lse;switch(this.state){case Sr.IDLE:o=0,a=Math.max(use,n.frameDuration),l=mHe;break;case Sr.INTERACTING:a=Math.max(cse,n.frameDuration);case Sr.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Sr.IDLE&&a<lse&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Sr.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Sr.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return Qv.SCHEDULED;let o=Qv.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=Qv.READY:o!==Qv.READY&&(o=Qv.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*hse+n*(1-hse)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Bf&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Bf&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===na.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){ee.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,gt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(gt))this._frameTaskTimes.set(gt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}e.Scheduler=t;class r{get task(){return this._task.get()}get updating(){return this._queue.running}constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new dHe,this._handles=new Jr,this.schedulePriority=this._basePriority,this._task=new a4(v(a)?a:this._queue),this._handles.add(oa(()=>this.task.running,c=>n.taskRunningChanged(c)))}remove(){this.processQueue(Ka),this._scheduler.removeTask(this),this.schedule=IE.schedule,this.reschedule=IE.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=ose(n);this._basePriority!==Bf&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance!="undefined"?performance.now():0,this._budget=0,this._state=Sr.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=i})(l4||(l4={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(Qv||(Qv={}));const Ka=(()=>{const e=new l4.Budget;return e.enabled=!1,e})();class gHe{remove(){}processQueue(){}schedule(t,r,i){try{if(zn(r)){const s=Wr();return i?Promise.resolve(i(s)):Promise.reject(s)}return ez(t(Ka))}catch(s){return Promise.reject(s)}}reschedule(t,r,i){return this.schedule(t,r,i)}}const IE=new gHe;let K2=class extends Te{constructor(e,t){var r;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r=t==null?void 0:t.registerTask(gt.TEXTURE_UNLOAD))!=null?r:IE}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,r){const i=this.makeUid(e);let s=this._textureRequests.get(i);if(!s){const n=t();s={referenceCount:0,texture:n,textureAsync:null,abortController:null,onRemove:r},this._stage&&(this._stage.add(n),this._stage.loadImmediate(n)),this._textureRequests.set(i,s)}return s.referenceCount++,{uid:i,texture:s.texture,release:()=>this._release(i)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return v(t)?`${e}.${t}px`:e}};u([d()],K2.prototype,"_frameTask",void 0),u([d()],K2.prototype,"updating",null),K2=u([P("esri.views.3d.support.TextureCollection")],K2);var dse;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(dse||(dse={}));const z1e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],G1e={};function j1e(e){return!!G1e[e]}function yHe(e){for(const t of e)if(!j1e(t))return!1;return!0}z1e.forEach(e=>{G1e[e]=!0});class _He{constructor(t){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this._handlers.forEach(({handler:r,priority:i},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((t,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(t,r,i,s){const n=Array.isArray(t)?t:t.split(",");if(!yHe(n))return n.some(j1e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s!=null?s:tv.DEFAULT;const l=this._createUniqueGroupName(),c=new vHe(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this._handlerCounts.get(t)}_removeHandler(t,r){if(this._handlers.has(t)){this._handlers.delete(t);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}}class vHe extends zo{constructor(t,r,i,s){super(!0),this._latestDragStart=void 0,this.view=t;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:Kh(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,r){return this.view.toMap(Kh(t,r),{exclude:[]})}_wrapDrag(t){const r=t.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:h,timestamp:p}=t,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:nl(r.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:r,repeat:i,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:r,native:i}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:r,x:i,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:r,y:i,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:m}=t;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:r,data:i,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:r,state:i,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var tM,pse,fse;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(tM||(tM={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(pse||(pse={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(fse||(fse={}));function bHe(e){return[e.on("before-add",t=>{const r=t.item;if(r==null||e.includes(r))return ee.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();r.onAdd()}),e.on("after-remove",t=>{const r=t.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function aH(e){return e.visible&&e.getEditableFlag!=null&&e.getEditableFlag(tM.USER)&&e.getEditableFlag(tM.MANAGER)}function Ef(e){return Kh(e.x,e.y)}function C2t(e){return ds(e.x,e.y)}function H1e(e,t){var i;const r=(i=e instanceof HTMLElement?e:e.surface)==null?void 0:i.getBoundingClientRect();return r?Kh(t.clientX-r.left,t.clientY-r.top):Kh(0,0)}function mse(e,t){return t instanceof Event?H1e(e,t):Ef(t)}function gse(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class wHe{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,r){const i=()=>t.stopPropagation();switch(t.type){case"pointer-move":yse(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!_se(t))break;const s=Ef(t),n=this._intersect(s,t.pointerType,r.forEachTool);if(E(n))break;const o=n.manipulator,a=n.tool;!(v(o)&&v(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(t)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,t,r),v(o)&&v(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(t)&&!o.grabbing&&(this._grabbedManipulators.set(t.pointerId,{manipulator:o,tool:a,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&E(r.activeTool)&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(t.pointerId)||this._handlePointerEnd(t,r);break;case"pointer-drag":{if(!_se(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=ho(s,({manipulator:h})=>h),o=ho(s,({tool:h})=>h);if(E(n)||E(o))break;const a=Ef(t);a.x=ye(a.x,0,r.view.width),a.y=ye(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(t.pointerId);switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,r)}i();break}case"immediate-click":{const s=Ef(t),n=this._intersect(s,t.pointerType,r.forEachTool);if(xHe(t)||r.forEachTool(c=>{if((!v(n)||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),E(n))break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=t.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=Ef(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=v(n)?n.manipulator:null;if(E(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),i();break}case"double-click":{const s=Ef(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=v(n)?n.manipulator:null;if(E(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=Ef(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=v(n)?n.manipulator:null;if(E(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(t,r,i){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:Ef(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===t&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(t,r){const i=ho(this._grabbedManipulators.get(t.pointerId),({manipulator:s})=>s);E(i)||i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:Ef(t)}),this._grabbedManipulators.delete(t.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(t){let r=null;return ea(t,({manipulator:i})=>!(E(i)||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(t){this._updateCursor(),this._updateFocusedManipulatorTools(t)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),t(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=KRe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=v(o)?o.manipulator:null})}clearPointers(t,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===t&&(E(n)||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},h)=>{o(a,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(t,r,i){let s=null;return i(n=>{if(n.manipulators==null||!aH(n))return!1;const o=n.manipulators.intersect(t,r);return!E(o)&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Kh(r.x,r.y),i,r.pointerType,t)})}handleHoverEvent(t,r){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!yse(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Ef(t),t.pointerId,t.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(t,r,i,s){let n=this._intersect(t,i,s);const o=ho(this._hoveredManipulators.get(r),({manipulator:a})=>a);v(n)&&!n.manipulator.interactive&&(n=null),v(n)&&o===n.manipulator||(v(o)&&(o.hovering=!1),v(n)?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(t){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(t(null),this._revertToNullActiveTool=!1)}}function yse(e){return e==="mouse"}function _se(e){return e.pointerType!=="mouse"||e.button===0}function xHe(e){return!!e.native.shiftKey}const vse="attached",u9="tools";let Cg=class extends VO{constructor(e){super(e),this._manipulatorState=new wHe,this.tools=new pt,this.cursor=null,this._forEachTool=t=>{for(const r of this.tools.items)if(t(r))return}}initialize(){this.handles.add([this.view.on(z1e,e=>{this._handleInputEvent(e)},tv.TOOL),...bHe(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(v(e)&&!this.view.ready)return void ee.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),v(t)&&t.deactivate(),v(e)&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const i=aH(r);!E(this.activeTool)&&i||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!i)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){var e;this.view.type==="3d"?(this._set("textures",new K2(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([se(()=>{const{state:t}=this.view;return"camera"in t&&t.camera},()=>this._forEachManipulator(t=>t.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",t=>this._forEachManipulator(r=>r.onElevationChange(t))),Mp(()=>this._set("textures",Ve(this.textures)))],vse)):this.handles.add(se(()=>this.view.extent,()=>this._forEachManipulator(t=>t.onViewChange())))}detach(){v(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(vse)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:r})=>e(r,t))})}_handleInputEvent(e){let t=!1;const r={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};v(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(i=>{!t&&i.visible&&i.handleInputEvent(r)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),!t&&v(this.activeTool)&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(u9),this._forEachTool(e=>{if(e instanceof Te){const t=se(()=>[e.cursor,e.visible,e.editable],()=>{aH(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(t,u9)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],u9)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var t;(t=e.setEditableFlag)==null||t.call(e,tM.MANAGER,E(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;E(e)&&this._forEachTool(t=>!(!v(t.cursor)||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(E(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([d({constructOnly:!0,nonNullable:!0})],Cg.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],Cg.prototype,"textures",void 0),u([d({value:null})],Cg.prototype,"activeTool",null),u([d({readOnly:!0,type:pt})],Cg.prototype,"tools",void 0),u([d({readOnly:!0})],Cg.prototype,"cursor",void 0),u([d({readOnly:!0})],Cg.prototype,"updating",null),Cg=u([P("esri.views.ToolViewManager")],Cg);const THe=Cg;let y2=class extends Te{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":SHe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return EHe[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],y2.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],y2.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],y2.prototype,"axisThreshold",null),y2=u([P("esri.views.input.gamepad.GamepadInputDevice")],y2);const SHe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),EHe={standard:.15,spacemouse:.025,unknown:0},IZ=y2;let ZR=class extends Te{constructor(...e){super(...e),this.devices=new pt,this.enabledFocusMode="document"}};u([d({type:pt.ofType(IZ),readOnly:!0})],ZR.prototype,"devices",void 0),u([d({type:["document","view","none"]})],ZR.prototype,"enabledFocusMode",void 0),ZR=u([P("esri.views.input.gamepad.GamepadSettings")],ZR);const CHe=ZR;let oN=class extends Te{constructor(){super(...arguments),this.gamepad=new CHe}};u([d({readOnly:!0})],oN.prototype,"gamepad",void 0),oN=u([P("esri.views.input.Input")],oN);const AHe=oN;let r_=class extends Te{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],r_.prototype,"enabled",void 0),u([d({type:IZ})],r_.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],r_.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],r_.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],r_.prototype,"velocityFactor",void 0),r_=u([P("esri.views.navigation.gamepad.GamepadSettings")],r_);const q1e=r_;let ub=class extends Te{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new q1e,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],ub.prototype,"browserTouchPanEnabled",void 0),u([d({type:q1e,nonNullable:!0})],ub.prototype,"gamepad",void 0),u([d({type:Boolean})],ub.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],ub.prototype,"mouseWheelZoomEnabled",void 0),ub=u([P("esri.views.navigation.Navigation")],ub);const W1e=ub;function RHe(e,t){if(!e)return null;if(!lH(e))return new j("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});const r=e.heightUnit,i=Fv.deriveUnitFromSR(e,t).heightUnit;return r!==i?new j("webscene:incompatible-height-unit",`The vertical units of the scene (${r}) must match the horizontal units of the scene (${i})`,{verticalUnit:r,horizontalUnit:i}):null}function A2t(e,t,r){const i=X1e(e),s=t,n=OHe(i,s,r);if(i){const o=Fv.deriveUnitFromSR(i,e.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new j("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new j("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!MHe(e)||n===vc.Unsupported)return new j("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case vc.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new j("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case vc.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new j("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case vc.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new j("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function OHe(e,t,r){if(!lH(e)||!lH(t))return vc.Unsupported;if(e==null||t==null)return vc.Ok;if(!r&&e.heightUnit!==t.heightUnit)return vc.Units;if(e.heightModel!==t.heightModel)return vc.HeightModel;switch(e.heightModel){case"gravity-related-height":return vc.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?vc.Ok:vc.CRS;default:return vc.Unsupported}}var vc;function lH(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function MHe(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!J1e(e)}function X1e(e){var i;const t=e.url?RC(e.url):void 0;return!(((i=e.spatialReference)==null?void 0:i.vcsWkid)==null&&v(t)&&t.serverType==="ImageServer")&&Y1e(e)&&e.heightModelInfo?e.heightModelInfo:J1e(e)?Fv.deriveUnitFromSR(IHe,e.spatialReference):null}function Y1e(e){return"heightModelInfo"in e}function Z1e(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function J1e(e){return Z1e(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Q1e(e)}function PHe(e){return e.layers!=null||Q1e(e)||Z1e(e)||Y1e(e)}function Q1e(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(vc||(vc={}));const IHe=new Fv({heightModel:"gravity-related-height"});var Ge;function bse(e){return e==="global"?Ge.Global:Ge.Local}function h9(e){return e===Ge.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(Ge||(Ge={}));let cH,d9=null;async function $He(e){d9||(d9=ie(()=>Promise.resolve().then(function(){return Xht}),void 0).then(t=>cH=t)),await d9,cr(e)}async function K1e(e,t,r,i){if(!e)return null;const s=e.spatialReference;return qX()||fv(s,t)?bC(e,t):cH?cH.projectGeometry(e,t,r,i):(await Promise.race([$He(i),IF(i)]),K1e(e,t,r,i))}let es=class extends Te{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Yh(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return v(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return E(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,i,s,n;const e=(r=this.map)==null?void 0:r.call(this),t=[];return v(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(i=e==null?void 0:e.basemap)==null?void 0:i.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);v(a)&&(r=a)}if(v(r)&&r.length===1)break}if(t&&(E(r)||r.length!==1))return{updating:!0};const i=this._pickSpatialReferenceCandidate(r);return{spatialReference:v(i)?i.spatialReference:null,viewingMode:v(i)?i.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,i,s,n,o,a,l,c;if(!this.required.tileInfo)return(r=this._get("_tileInfoTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(i=this.map)==null?void 0:i.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var r,i,s,n;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))==null?void 0:r.heightModelInfo))return(i=this._get("_heightModelInfoTask"))!=null?i:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(PHe(o)){const a=X1e(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var i,s;if(this.suspended||!this.required.extent)return(i=this._get("_extentCandidatesTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,r=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(v(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)r.push({extent:c,layer:n})}return{candidates:r,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(E(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),i=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&i.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:v(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(v(this._projectExtentTask.task)&&(this._projectExtentTask.task=Yh(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:i.clone(),task:wP(async s=>{try{const n=await K1e(r.extent,i,r.layer.portalItem,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:n}}catch{if(zn(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(E(e))return t;const r=[],i=(s,n)=>v(s)?v(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=i(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return E(e)||e.length<1?v(t)?{spatialReference:t,viewingMode:null}:null:(v(t)&&e.length>1&&e.some(({spatialReference:r})=>r.equals(t))&&(e=e.filter(({spatialReference:r})=>r.equals(t))),e.length>1&&e.some(({viewingMode:r})=>r!==Ge.Local)&&(e=e.filter(({viewingMode:r})=>r!==Ge.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const r=[];for(const i of t){const s=this.getSpatialReferenceSupport({spatialReference:i,layer:e});if(v(s)){const n=v(s.constraints)?s.constraints:[{spatialReference:i,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||E(this.userSpatialReference)||o.equals(this.userSpatialReference))&&r.push({spatialReference:o,viewingMode:a})}}return r}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:r})=>t.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const i of e)if(this._collectCollection(i,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};u([d()],es.prototype,"required",void 0),u([d({constructOnly:!0})],es.prototype,"map",void 0),u([d({constructOnly:!0})],es.prototype,"getSpatialReferenceSupport",void 0),u([d()],es.prototype,"defaultSpatialReference",void 0),u([d()],es.prototype,"userSpatialReference",void 0),u([d()],es.prototype,"sourcePreloadCount",void 0),u([d()],es.prototype,"priorityCollection",void 0),u([d()],es.prototype,"requiresExtentInSpatialReference",void 0),u([d()],es.prototype,"suspended",void 0),u([d({readOnly:!0})],es.prototype,"ready",null),u([d({readOnly:!0})],es.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],es.prototype,"spatialReference",null),u([d({readOnly:!0})],es.prototype,"extent",null),u([d({readOnly:!0})],es.prototype,"heightModelInfo",null),u([d({readOnly:!0})],es.prototype,"vcsWkid",null),u([d({readOnly:!0})],es.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],es.prototype,"viewingMode",null),u([d({readOnly:!0})],es.prototype,"tileInfo",null),u([d({readOnly:!0})],es.prototype,"mapCollections",null),u([d({readOnly:!0})],es.prototype,"_allLayers",null),u([d({readOnly:!0})],es.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],es.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],es.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],es.prototype,"_extentCandidatesTask",null),u([d()],es.prototype,"_extentTask",null),u([d()],es.prototype,"_projectExtentTask",void 0),es=u([P("esri.views.support.DefaultsFromMap")],es);var aN;let Ut=aN=class extends xx(Vs.EventedMixin(fP(Te))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new eM({getCollections:()=>{var t,r,i;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new Q3,this.analyses=new TE,this.typeSpecificPreconditionsReady=!0,this.layerViews=new pt,this.magnifier=new B1e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new ME,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new AHe,this.navigation=new W1e,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new _He(this),this.persistableViewModels=new pt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(se(()=>this.preconditionsReady,t=>{var r,i;t?(this._currentSpatialReference=this.spatialReference,aN.views.add(this)):(this._currentSpatialReference=null,aN.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((r=this.toolViewManager)==null||r.detach(),v(this.analysisViewManager)&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):t&&!this.ready&&(this._startup(),v(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},ri))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,iE(()=>this.ready)))),this.basemapView=new t_({view:this}),this.layerViewManager=new uHe({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new THe({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([se(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},{sync:!0,initial:!0}),se(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),se(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([se(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(t&&!this.spatialReference&&r){if(v(e))return;const s=Mp(()=>e=Yh(e));e=wP(async n=>{try{await Ew(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}ee.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Ve(this.graphics),this.analyses=Ve(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Ve(this.analysisViewManager),this.toolViewManager=Ve(this.toolViewManager),this.layerViewManager=Ve(this.layerViewManager),this.basemapView=Ve(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ee.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var e;return(e=this.toolViewManager)==null?void 0:e.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new es({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Tm.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e!=null&&e.destroyed&&(ee.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:e}),e=null),Tm.isLoadable(e)&&e.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,r;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((r=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:r.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!Pn(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var e;return(e=this.toolViewManager)==null?void 0:e.tools}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return v(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,r;return(r=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?r:null}importLayerView(e){throw new j("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return v(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&ee.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(oa(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Ut.views=new pt,u([d()],Ut.prototype,"_userSpatialReference",void 0),u([d()],Ut.prototype,"activeTool",null),u([d({readOnly:!0})],Ut.prototype,"allLayerViews",void 0),u([d()],Ut.prototype,"groundView",void 0),u([d()],Ut.prototype,"animation",null),u([d()],Ut.prototype,"basemapView",void 0),u([d()],Ut.prototype,"center",null),u([d({readOnly:!0})],Ut.prototype,"_defaultsFromMapSettings",null),u([d()],Ut.prototype,"defaultsFromMap",null),u([d()],Ut.prototype,"fatalError",void 0),u([d({type:qr})],Ut.prototype,"extent",null),u([d(B7(Q3,"graphics"))],Ut.prototype,"graphics",void 0),u([d(B7(TE,"analyses"))],Ut.prototype,"analyses",void 0),u([d({readOnly:!0,type:Fv})],Ut.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Ut.prototype,"interacting",null),u([d({readOnly:!0})],Ut.prototype,"navigating",null),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Ut.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Ut.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:pt,readOnly:!0})],Ut.prototype,"layerViews",void 0),u([d()],Ut.prototype,"resolution",null),u([d({type:B1e})],Ut.prototype,"magnifier",void 0),u([d({value:null,type:V1e})],Ut.prototype,"map",null),u([d()],Ut.prototype,"padding",void 0),u([d({readOnly:!0})],Ut.prototype,"ready",void 0),u([d({type:Ye})],Ut.prototype,"spatialReference",null),u([d()],Ut.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Ut.prototype,"stationary",null),u([d({readOnly:!0})],Ut.prototype,"supportsGround",void 0),u([d({type:Lm})],Ut.prototype,"timeExtent",void 0),u([d({type:ME,nonNullable:!0})],Ut.prototype,"timeReference",void 0),u([d()],Ut.prototype,"tools",null),u([d()],Ut.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Ut.prototype,"type",void 0),u([d({type:Number})],Ut.prototype,"scale",void 0),u([d({readOnly:!0})],Ut.prototype,"updating",void 0),u([d({readOnly:!0})],Ut.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Ut.prototype,"initialExtent",null),u([d()],Ut.prototype,"cursor",null),u([d({readOnly:!0})],Ut.prototype,"input",void 0),u([d({type:W1e,nonNullable:!0})],Ut.prototype,"navigation",void 0),u([d()],Ut.prototype,"layerViewManager",void 0),u([d()],Ut.prototype,"analysisViewManager",void 0),u([d()],Ut.prototype,"width",void 0),u([d()],Ut.prototype,"height",void 0),u([d({readOnly:!0})],Ut.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Ut.prototype,"size",null),u([d({readOnly:!0})],Ut.prototype,"suspended",void 0),u([d({readOnly:!0})],Ut.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Ut.prototype,"persistableViewModels",void 0),u([d()],Ut.prototype,"_isValid",void 0),u([d()],Ut.prototype,"_readyCycleForced",void 0),u([d()],Ut.prototype,"_currentSpatialReference",void 0),Ut=aN=u([P("esri.views.View")],Ut);const LHe=Ut;let i_=class extends CF{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new j("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,t){t||(t=Hu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],i_.prototype,"done",null),u([d({readOnly:!0,type:String})],i_.prototype,"state",void 0),u([d()],i_.prototype,"target",void 0),i_=u([P("esri.views.ViewAnimation")],i_),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(i_||(i_={}));const $E=i_,fA=()=>ie(()=>import("./TileLayerView3D.98c834bc.js"),["assets/TileLayerView3D.98c834bc.js","assets/LayerView3D.f82aec1c.js","assets/TiledLayerView3D.5028af07.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/MapServiceLayerViewHelper.9c69d84e.js","assets/floorFilterUtils.4de71259.js","assets/sublayerUtils.537edd27.js","assets/popupUtils.d712166f.js","assets/drapedUtils.dc851d2a.js"]),wse=()=>ie(()=>import("./ElevationLayerView3D.ee60e81a.js"),["assets/ElevationLayerView3D.ee60e81a.js","assets/LayerView3D.f82aec1c.js","assets/TiledLayerView3D.5028af07.js","assets/LayerView.37a25fbb.js"]),xse={"base-dynamic":()=>ie(()=>import("./BaseDynamicLayerView3D.2fd9c296.js"),["assets/BaseDynamicLayerView3D.2fd9c296.js","assets/DynamicLayerView3D.7273954b.js","assets/LayerView3D.f82aec1c.js","assets/projectExtentUtils.8770a3e5.js","assets/ImageMaterial.03469668.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js"]),"base-elevation":wse,"base-tile":fA,"bing-maps":fA,"building-scene":()=>ie(()=>import("./BuildingSceneLayerView3D.1a43878e.js"),["assets/BuildingSceneLayerView3D.1a43878e.js","assets/BuildingGroupSublayer.a13c54e5.js","assets/BuildingComponentSublayer.5d9922a4.js","assets/capabilities.26cf9b42.js","assets/I3SIndexInfo.3514c9b5.js","assets/I3SLayerDefinitions.55b2cedc.js","assets/I3SUtil.4339bac4.js","assets/I3SBinaryReader.4d236402.js","assets/popupUtils.d712166f.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/I3SMeshView3D.c1361707.js","assets/I3SOverrides.b8d7015b.js","assets/I3SNode.9784587b.js","assets/RenderTexture.88b033d3.js","assets/FeatureLayerView3D.e8b857be.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/SceneModification.458d22a5.js","assets/persistable.91f90a51.js","assets/resourceExtension.3080d701.js","assets/SceneLayerWorker.bdfc6ad5.js","assets/I3SQueryFeatureStore.02228eac.js","assets/DefinitionExpressionSceneLayerView.cabfa289.js"]),csv:()=>ie(()=>import("./CSVLayerView3D.b36213cc.js"),["assets/CSVLayerView3D.b36213cc.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js"]),dimension:()=>ie(()=>import("./DimensionLayerView3D.2411e301.js"),["assets/DimensionLayerView3D.2411e301.js","assets/LayerView3D.f82aec1c.js","assets/LayerView.37a25fbb.js"]),elevation:wse,feature:()=>ie(()=>import("./FeatureLayerView3D.e8b857be.js"),["assets/FeatureLayerView3D.e8b857be.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js"]),geojson:()=>ie(()=>import("./GeoJSONLayerView3D.d0daaa92.js"),["assets/GeoJSONLayerView3D.d0daaa92.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js"]),graphics:()=>ie(()=>import("./GraphicsLayerView3D.5ce7c099.js"),["assets/GraphicsLayerView3D.5ce7c099.js","assets/LayerView3D.f82aec1c.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/GraphicsProcessor.86e650c7.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView.37a25fbb.js"]),group:()=>ie(()=>import("./GroupLayerView.b70d5154.js"),["assets/GroupLayerView.b70d5154.js","assets/LayerView.37a25fbb.js"]),imagery:()=>ie(()=>import("./ImageryLayerView3D.d25a0512.js"),["assets/ImageryLayerView3D.d25a0512.js","assets/DynamicLayerView3D.7273954b.js","assets/LayerView3D.f82aec1c.js","assets/projectExtentUtils.8770a3e5.js","assets/ImageMaterial.03469668.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/popupUtils.d712166f.js"]),"integrated-mesh":()=>ie(()=>import("./IntegratedMeshLayerView3D.4ab259d5.js"),["assets/IntegratedMeshLayerView3D.4ab259d5.js","assets/I3SMeshView3D.c1361707.js","assets/I3SOverrides.b8d7015b.js","assets/I3SNode.9784587b.js","assets/I3SUtil.4339bac4.js","assets/I3SBinaryReader.4d236402.js","assets/RenderTexture.88b033d3.js","assets/FeatureLayerView3D.e8b857be.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/SceneModification.458d22a5.js","assets/persistable.91f90a51.js","assets/resourceExtension.3080d701.js","assets/SceneLayerWorker.bdfc6ad5.js"]),"line-of-sight":()=>ie(()=>import("./LineOfSightLayerView3D.a2a8da9d.js"),["assets/LineOfSightLayerView3D.a2a8da9d.js","assets/LayerView3D.f82aec1c.js","assets/LayerView.37a25fbb.js"]),"map-image":()=>ie(()=>import("./MapImageLayerView3D.62442e30.js"),["assets/MapImageLayerView3D.62442e30.js","assets/DynamicLayerView3D.7273954b.js","assets/LayerView3D.f82aec1c.js","assets/projectExtentUtils.8770a3e5.js","assets/ImageMaterial.03469668.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/ExportImageParameters.2e1ebecd.js","assets/floorFilterUtils.4de71259.js","assets/sublayerUtils.537edd27.js","assets/MapServiceLayerViewHelper.9c69d84e.js","assets/popupUtils.d712166f.js","assets/drapedUtils.dc851d2a.js"]),media:()=>ie(()=>import("./MediaLayerView3D.91ad1219.js"),["assets/MediaLayerView3D.91ad1219.js","assets/MediaElementView.421b2b5a.js","assets/normalizeUtilsSync.93936df1.js","assets/LayerView3D.f82aec1c.js","assets/ImageMaterial.03469668.js","assets/LayerView.37a25fbb.js"]),"ogc-feature":()=>ie(()=>import("./OGCFeatureLayerView3D.b9661dec.js"),["assets/OGCFeatureLayerView3D.b9661dec.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js"]),"open-street-map":fA,"oriented-imagery":()=>ie(()=>import("./FeatureLayerView3D.e8b857be.js"),["assets/FeatureLayerView3D.e8b857be.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js"]),"point-cloud":()=>ie(()=>import("./PointCloudLayerView3D.4dac0eda.js").then(function(e){return e.P}),["assets/PointCloudLayerView3D.4dac0eda.js","assets/LayerView3D.f82aec1c.js","assets/I3SUtil.4339bac4.js","assets/I3SBinaryReader.4d236402.js","assets/PointCloudWorkerUtil.cc594518.js","assets/PointCloudUniqueValueRenderer.0f882fcf.js","assets/PopupSceneLayerView.ee0df44e.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js"]),voxel:()=>ie(()=>import("./VoxelLayerView3D.19cb697c.js"),["assets/VoxelLayerView3D.19cb697c.js","assets/LayerView3D.f82aec1c.js","assets/PopupSceneLayerView.ee0df44e.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js"]),route:()=>ie(()=>import("./RouteLayerView3D.f7499f4d.js"),["assets/RouteLayerView3D.f7499f4d.js","assets/Stop.e53ee85e.js","assets/LayerView3D.f82aec1c.js","assets/GraphicsProcessor.86e650c7.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/projectExtentUtils.8770a3e5.js","assets/EventedSet.ce63ca8d.js","assets/LayerView.37a25fbb.js"]),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?ie(()=>import("./SceneLayerView3D.56bc3375.js"),["assets/SceneLayerView3D.56bc3375.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/floorFilterUtils.4de71259.js","assets/I3SMeshView3D.c1361707.js","assets/I3SOverrides.b8d7015b.js","assets/I3SNode.9784587b.js","assets/I3SUtil.4339bac4.js","assets/I3SBinaryReader.4d236402.js","assets/RenderTexture.88b033d3.js","assets/FeatureLayerView3D.e8b857be.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/SceneModification.458d22a5.js","assets/persistable.91f90a51.js","assets/resourceExtension.3080d701.js","assets/SceneLayerWorker.bdfc6ad5.js","assets/SceneLayerView.f46fc411.js","assets/DefinitionExpressionSceneLayerView.cabfa289.js","assets/I3SQueryFeatureStore.02228eac.js","assets/PopupSceneLayerView.ee0df44e.js"]):ie(()=>import("./SceneLayerGraphicsView3D.d4d0e3bd.js"),["assets/SceneLayerGraphicsView3D.d4d0e3bd.js","assets/I3SOverrides.b8d7015b.js","assets/I3SNode.9784587b.js","assets/I3SUtil.4339bac4.js","assets/I3SBinaryReader.4d236402.js","assets/RenderTexture.88b033d3.js","assets/FeatureLayerView3D.e8b857be.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/SceneLayerView.f46fc411.js","assets/DefinitionExpressionSceneLayerView.cabfa289.js","assets/PopupSceneLayerView.ee0df44e.js"]),stream:()=>ie(()=>import("./StreamLayerView3D.8dd072b7.js"),["assets/StreamLayerView3D.8dd072b7.js","assets/StreamFeatureManager.36755ebd.js","assets/createConnection.19b0ad4e.js","assets/EventedSet.ce63ca8d.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/LayerView.37a25fbb.js"]),tile:fA,"imagery-tile":()=>ie(()=>import("./ImageryTileLayerView3D.c68708e1.js"),["assets/ImageryTileLayerView3D.c68708e1.js","assets/LayerView3D.f82aec1c.js","assets/TiledLayerView3D.5028af07.js","assets/rasterProjectionHelper.e8a0406f.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/drapedUtils.dc851d2a.js"]),"vector-tile":()=>ie(()=>import("./VectorTileLayerView3D.185db6bc.js"),["assets/VectorTileLayerView3D.185db6bc.js","assets/Rect.e8e4d18d.js","assets/rasterizingUtils.36482472.js","assets/StyleRepository.831f4e35.js","assets/enums.89506096.js","assets/colorUtils.31a1b5d7.js","assets/TileClipper.7b9dd3ce.js","assets/TileInfoView.0e7c4da0.js","assets/number.dcd3e86c.js","assets/GeometryUtils.6a2e733c.js","assets/LayerView3D.f82aec1c.js","assets/TiledLayerView3D.5028af07.js","assets/LayerView.37a25fbb.js"]),wcs:()=>ie(()=>import("./ImageryTileLayerView3D.c68708e1.js"),["assets/ImageryTileLayerView3D.c68708e1.js","assets/LayerView3D.f82aec1c.js","assets/TiledLayerView3D.5028af07.js","assets/rasterProjectionHelper.e8a0406f.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/drapedUtils.dc851d2a.js"]),"web-tile":fA,wfs:()=>ie(()=>import("./WFSLayerView3D.85775e68.js"),["assets/WFSLayerView3D.85775e68.js","assets/FeatureLayerViewBase3D.998c7f1b.js","assets/FeatureLikeLayerView3D.6f3f21f6.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/queryForSymbologySnapping.33ba2abf.js","assets/elevationInfoUtils.1b829c91.js","assets/hash.079e8d2d.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js","assets/floorFilterUtils.4de71259.js","assets/QueryEngine.39a3740c.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/QueryEngineCapabilities.ea616409.js","assets/FeatureStore.c6298dd3.js","assets/BoundsStore.9aa448e8.js","assets/projectExtentUtils.8770a3e5.js","assets/LayerView3D.f82aec1c.js","assets/EventedSet.ce63ca8d.js","assets/popupUtils.d712166f.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js"]),wms:()=>ie(()=>import("./WMSLayerView3D.fdf1556c.js"),["assets/WMSLayerView3D.fdf1556c.js","assets/DynamicLayerView3D.7273954b.js","assets/LayerView3D.f82aec1c.js","assets/projectExtentUtils.8770a3e5.js","assets/ImageMaterial.03469668.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js","assets/ExportWMSImageParameters.41a0f1b1.js"]),wmts:()=>ie(()=>import("./WMTSLayerView3D.bec76dd7.js"),["assets/WMTSLayerView3D.bec76dd7.js","assets/LayerView3D.f82aec1c.js","assets/TiledLayerView3D.5028af07.js","assets/LayerView.37a25fbb.js","assets/RefreshableLayerView.9d766f3c.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function DHe(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new j(`${r}:view-not-supported`,`${t} is not supported in 3D`)}const Tse={hasLayerViewModule:e=>v(xse[e.type]),importLayerView:e=>{const t=xse[e.type];if(E(t))throw DHe(e);return t(e)}},Sse="analyses-owner-handles";var eS,Ub;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(eS||(eS={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(Ub||(Ub={}));let hb=class extends VO{constructor(e){super(e),this._allAnalysisViews=new pt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Ese(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Wr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Wr()),this._attachedToViewResolver=Ese()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(E(t)||t.state.list===Ub.REMOVED)throw new j("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Sse)}_disconnectOwners(){this.handles.remove(Sse),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const i of e)this._addAnalysis(i);const t=e.on("after-add",i=>this._addAnalysis(i.item)),r=e.on("after-remove",i=>this._removeAnalysis(i.item));return{remove:()=>{t.remove(),r.remove();for(const i of e)this._removeAnalysis(i)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const r={state:{view:eS.PENDING,list:Ub.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=wP(i=>this._createAnalysisViewPromise(r,i))}else t.state.list=Ub.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=Ub.REMOVED,this._scheduleUpdate()):ee.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){v(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=hC(()=>this._update()))}_update(){this._scheduledUpdateHandle=zi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Ub.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case eS.PENDING:e.createAnalysisViewTask=Yh(e.createAnalysisViewTask);break;case eS.CREATED:v(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=Ve(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const r=e.analysis,i=r.type,s=this._analysisModules[i];if(this._creatingViewCount+=1,E(s.module))try{s.module=await this._loadAnalysisModule(i)}catch(o){throw this._creatingViewCount-=1,o}if(zn(t))throw this._creatingViewCount-=1,Wr("AnalysisView creation aborted");const n=new s.module.default({analysis:r,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(zn(t))throw this._creatingViewCount-=1,n.destroy(),Wr("AnalysisView creation aborted");return e.view=n,e.state.view=eS.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return ie(()=>import("./AreaMeasurementAnalysisView3D.2f4327db.js").then(function(t){return t.A}),["assets/AreaMeasurementAnalysisView3D.2f4327db.js","assets/analysisThemeUtils.c548859a.js","assets/Segment.b21fb86f.js","assets/LineVisualElement.98f2f691.js","assets/elevationInfoUtils.1b829c91.js","assets/geometryEngine.3391140a.js","assets/geometryEngineBase.871c2f6a.js","assets/hydrated.9342ac27.js","assets/EditGeometryOperations.1523212e.js"]);case"dimension":return ie(()=>import("./DimensionAnalysisView3D.2ce5e71d.js").then(function(t){return t.D}),["assets/DimensionAnalysisView3D.2ce5e71d.js","assets/LineVisualElement.98f2f691.js","assets/LengthDimension.712a4a98.js","assets/Segment.b21fb86f.js","assets/elevationInfoUtils.1b829c91.js","assets/analysisViewUtils.dc9a2936.js","assets/ImageMaterial.03469668.js","assets/Factory.64e9be4a.js","assets/RightAngleQuadVisualElement.e094d36b.js","assets/VisualElementResources.082d8281.js","assets/PointVisualElement.304a7905.js","assets/colorUtils.31a1b5d7.js","assets/EditGeometryOperations.1523212e.js","assets/QueryEngineResult.a34a99f5.js","assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js","assets/utils.a24099e7.js","assets/generateRendererUtils.8b94a88c.js","assets/json.5152e73f.js","assets/dehydratedFeatureComparison.d06fa8a6.js","assets/RenderTexture.88b033d3.js"]);case"direct-line-measurement":return ie(()=>import("./DirectLineMeasurementAnalysisView3D.20771679.js").then(function(t){return t.D}),["assets/DirectLineMeasurementAnalysisView3D.20771679.js","assets/analysisThemeUtils.c548859a.js","assets/Segment.b21fb86f.js","assets/LineVisualElement.98f2f691.js","assets/elevationInfoUtils.1b829c91.js","assets/geometryEngine.3391140a.js","assets/geometryEngineBase.871c2f6a.js","assets/hydrated.9342ac27.js","assets/RightAngleQuadVisualElement.e094d36b.js","assets/VisualElementResources.082d8281.js"]);case"line-of-sight":return ie(()=>import("./LineOfSightAnalysisView3D.cdee6e9d.js"),["assets/LineOfSightAnalysisView3D.cdee6e9d.js","assets/LineVisualElement.98f2f691.js","assets/LineOfSightAnalysisTarget.0b383180.js","assets/persistable.91f90a51.js","assets/resourceExtension.3080d701.js","assets/elevationInfoUtils.1b829c91.js","assets/analysisViewUtils.dc9a2936.js","assets/ImageMaterial.03469668.js","assets/PointVisualElement.304a7905.js","assets/VisualElementResources.082d8281.js"]);case"slice":return ie(()=>import("./SliceAnalysisView3D.03e1b8a6.js").then(function(t){return t.S}),["assets/SliceAnalysisView3D.03e1b8a6.js","assets/LineVisualElement.98f2f691.js","assets/persistable.91f90a51.js","assets/resourceExtension.3080d701.js","assets/BuildingComponentSublayer.5d9922a4.js","assets/capabilities.26cf9b42.js","assets/I3SIndexInfo.3514c9b5.js","assets/I3SLayerDefinitions.55b2cedc.js","assets/I3SUtil.4339bac4.js","assets/I3SBinaryReader.4d236402.js","assets/popupUtils.d712166f.js","assets/analysisViewUtils.dc9a2936.js","assets/ImageMaterial.03469668.js","assets/Factory.64e9be4a.js"])}}};function Ese(){const e=uv();return e.promise.catch(()=>{}),e}u([d()],hb.prototype,"updating",null),u([d({constructOnly:!0})],hb.prototype,"view",void 0),u([d()],hb.prototype,"_allAnalysisViews",void 0),u([d()],hb.prototype,"_creatingViewCount",void 0),hb=u([P("esri.views.3d.analysis.AnalysisViewManager3D")],hb);const NHe=hb;let Ag=class extends Te{constructor(e){super(e),this.collision=new JR,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ge.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ge.Local?this._set("altitude",e):ee.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?ye(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const r=this.tilt(e);return ye(t,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ge.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,r=p9)=>(r.min=Qo.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?OD([[4e3,Qo.max],[1e4,Gt(88)],[6e6,Gt(88)]]):()=>Qo.max;return(t,r=p9)=>(r.min=Qo.min,r.max=e(t),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?OD([[4e3,Qo.max],[5e4,Gt(88)],[6e6,Gt(88)],[2e7,Qo.min]]):OD([[3e5,Qo.max],[3e6,Gt(88)],[6e6,Gt(88)],[2e7,Qo.min]]);return(t,r=p9)=>(r.min=Qo.min,r.max=e(t),r)}};function FHe(e){return{min:-2e5,max:4*e.radius}}u([d()],Ag.prototype,"altitude",null),u([d({readOnly:!0})],Ag.prototype,"collision",void 0),u([d()],Ag.prototype,"distance",void 0),u([d({readOnly:!0})],Ag.prototype,"minimumPoiDistance",void 0),u([d()],Ag.prototype,"tilt",void 0),u([d({constructOnly:!0})],Ag.prototype,"mode",void 0),Ag=u([P("esri.views.3d.state.Constraints")],Ag);const Cse=FHe(br),Qo={min:Gt(.5),max:Gt(179.5)},p9={min:0,max:0};let JR=class extends Te{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],JR.prototype,"enabled",void 0),u([d({type:Number})],JR.prototype,"elevationMargin",void 0),JR=u([P("esri.views.3d.state.Constraints.CollisionConstraint")],JR);let tS=class extends Te{constructor(){super(...arguments),this.min=Cse.min,this.max=Cse.max}};u([d({type:Number})],tS.prototype,"min",void 0),u([d({type:Number})],tS.prototype,"max",void 0),tS=u([P("esri.views.3d.constraints.AltitudeConstraint")],tS);let Ng=class extends Te{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],Ng.prototype,"near",null),u([zt("near")],Ng.prototype,"castNear",null),u([d({type:Number,value:1e-8})],Ng.prototype,"far",null),u([zt("far")],Ng.prototype,"castFar",null),u([d({type:["auto","manual"]})],Ng.prototype,"mode",void 0),Ng=u([P("esri.views.3d.constraints.ClipDistanceConstraint")],Ng);const uH={min:nl(Qo.min),max:nl(Qo.max)};let kb=class extends Te{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ye(e,uH.min,uH.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],kb.prototype,"mode",void 0),u([d({type:Number,value:uH.max})],kb.prototype,"max",null),u([zt("max")],kb.prototype,"castMax",null),kb=u([P("esri.views.3d.constraints.TiltConstraint")],kb);let Vb=class extends Te{constructor(){super(...arguments),this.tilt=new kb,this.altitude=new tS,this.clipDistance=new Ng}};u([d({type:kb})],Vb.prototype,"tilt",void 0),u([d({type:tS})],Vb.prototype,"altitude",void 0),u([d({type:Ng})],Vb.prototype,"clipDistance",void 0),Vb=u([P("esri.views.3d.constraints.Constraints")],Vb);var hH;let gh=hH=class extends fe{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,r){t[r]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,r){e&&(t[r]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new hH(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],gh.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],gh.prototype,"date",void 0),u([De("date",["datetime"])],gh.prototype,"readDate",null),u([Be("date")],gh.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],gh.prototype,"directShadowsEnabled",void 0),u([De("directShadowsEnabled",["directShadows"])],gh.prototype,"readDirectShadowsEnabled",null),u([Be("directShadowsEnabled")],gh.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],gh.prototype,"displayUTCOffset",void 0),u([Be("displayUTCOffset")],gh.prototype,"writeDisplayUTCOffset",null),gh=hH=u([P("esri.webscene.SunLighting")],gh);const Gw=gh;var _2;let Cf=_2=class extends Vs.EventedMixin(Gw){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),r=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new _2(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const r=_2.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let i=null;v(e)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(e.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime()))));const s=_2.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(f9.target=this,f9.timezoneOffset=s,this.emit("timezone-will-change",f9)),v(e))return!!isNaN(e.getTime())||i!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new _2({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],Cf.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],Cf.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],Cf.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],Cf.prototype,"defaultDate",null),u([d({type:Date})],Cf.prototype,"date",null),Cf=_2=u([P("esri.views.3d.environment.SunLighting")],Cf),function(e){function t({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}e.calculateTimezoneOffset=t}(Cf||(Cf={}));const f9={target:null,timezoneOffset:0},s_=Cf;var dH;let QR=dH=class extends fe{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new dH(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],QR.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],QR.prototype,"directShadowsEnabled",void 0),QR=dH=u([P("esri.webscene.VirtualLighting")],QR);const $P=QR;var lN;let v2=lN=class extends Vs.EventedMixin($P){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new lN({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(e){return new lN(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([d({type:Boolean})],v2.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],v2.prototype,"waterReflectionEnabled",void 0),u([d({type:Boolean})],v2.prototype,"cameraTrackingEnabled",void 0),v2=lN=u([P("esri.views.3d.environment.VirtualLighting")],v2);const KR=v2,UHe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:s_,virtual:KR}};var pH;let K3=pH=class extends Te{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new pH({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],K3.prototype,"quality",null),K3=pH=u([P("esri.views.3d.environment.SceneViewAtmosphere")],K3);var fH;let e3=fH=class extends fe{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new fH({cloudCover:this.cloudCover})}};u([ft({sunny:"sunny"})],e3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],e3.prototype,"cloudCover",void 0),e3=fH=u([P("esri.views.3d.environment.SunnyWeather")],e3);const c4=e3;var mH;let t3=mH=class extends fe{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new mH({cloudCover:this.cloudCover})}};u([ft({cloudy:"cloudy"})],t3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],t3.prototype,"cloudCover",void 0),t3=mH=u([P("esri.views.3d.environment.CloudyWeather")],t3);const kHe=t3;var gH;let r3=gH=class extends fe{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new gH({fogStrength:this.fogStrength})}};u([ft({foggy:"foggy"})],r3.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],r3.prototype,"fogStrength",void 0),r3=gH=u([P("esri.views.3d.environment.FoggyWeather")],r3);const VHe=r3;var yH;let b2=yH=class extends fe{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new yH({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([ft({rainy:"rainy"})],b2.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b2.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b2.prototype,"precipitation",void 0),b2=yH=u([P("esri.views.3d.environment.RainyWeather")],b2);const BHe=b2;var _H;let db=_H=class extends fe{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new _H({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([ft({snowy:"snowy"})],db.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],db.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],db.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],db.prototype,"snowCover",void 0),db=_H=u([P("esri.views.3d.environment.SnowyWeather")],db);const zHe=db,$Z={key:"type",base:c4,typeMap:{sunny:c4,cloudy:kHe,rainy:BHe,snowy:zHe,foggy:VHe}},GHe=Object.keys($Z.typeMap);function jHe(e,t){return!!GHe.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const Rh=1e4,ebe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Gw,virtual:$P}};let cN=class extends fe{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],cN.prototype,"type",void 0),cN=u([P("esri.webscene.background.Background")],cN);const tbe=cN;var vH;const HHe={...Ay,nonNullable:!0};let i3=vH=class extends tbe{constructor(e){super(e),this.type="color",this.color=new Qe([0,0,0,1])}clone(){return new vH(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([ft({color:"color"},{readOnly:!0})],i3.prototype,"type",void 0),u([d(HHe)],i3.prototype,"color",void 0),i3=vH=u([P("esri.webscene.background.ColorBackground")],i3);const rbe=i3,Ase={base:tbe,key:"type",typeMap:{color:rbe}};function qHe(e){return(t,r,i)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,i),n}}}const WHe={types:Ase,json:{read:qHe(Ase),write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.isPresentation})}}};var bH;const ibe="esri.webscene.Environment",XHe=ee.getLogger(ibe),Rse=(e,t,r)=>({enabled:!r||!r.isPresentation});let n_=bH=class extends fe{constructor(e){super(e),this.lighting=new Gw,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){jHe(e==null?void 0:e.type,XHe)&&this._set("weather",e)}clone(){return new bH(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?$P.prototype.clone.call(this.lighting):Gw.prototype.clone.call(this.lighting),background:re(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:ebe,nonNullable:!0,json:{write:!0}})],n_.prototype,"lighting",void 0),u([d(WHe)],n_.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Rse}}})],n_.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Rse}}})],n_.prototype,"starsEnabled",void 0),u([d({types:$Z,nonNullable:!0,json:{write:!0},value:new c4})],n_.prototype,"weather",null),n_=bH=u([P(ibe)],n_);const LE=n_;var s3;let w2=s3=class extends LE{constructor(e){super(e),this.atmosphere=new K3,this.lighting=new s_,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new s3({...t,lighting:t.lighting?t.lighting.type==="virtual"?KR.fromWebsceneLighting(t.lighting):s_.fromWebsceneLighting(t.lighting):void 0})}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){var t,r;return e?e instanceof s_||e instanceof KR?e:e instanceof Gw?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(e):new s_({...e.cloneConstructProperties(),...(t=this.lighting)==null?void 0:t.cloneNonPersistentConstructProperties()}):e instanceof $P?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new KR({...e.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):Op(UHe,e):new s_}clone(){return new s3({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background)})}cloneWithWebsceneEnvironment(e){return new s3({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):s_.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):KR.fromWebsceneLighting(e.lighting);default:return e.lighting,s_.fromWebsceneLighting(e.lighting)}}};u([d({type:K3,json:{read:!1},nonNullable:!0})],w2.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],w2.prototype,"lighting",void 0),u([zt("lighting")],w2.prototype,"castLighting",null),w2=s3=u([P("esri.views.3d.environment.SceneViewEnvironment")],w2);const x2=w2;var Dn;(function(e){e[e.Simple=0]="Simple",e[e.Realistic=1]="Realistic",e[e.Panoramic=2]="Panoramic",e[e.None=3]="None"})(Dn||(Dn={}));function qn(e,t){return e[0]=t[0],e[1]=t[1],e}function or(e,t,r){return e[0]=t,e[1]=r,e}function ep(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Xf(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function sbe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function nbe(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function YHe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function ZHe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function JHe(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function QHe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function KHe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Ac(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function eqe(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function jw(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function u4(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function LZ(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function obe(e){const t=e[0],r=e[1];return t*t+r*r}function DZ(e,t){return e[0]=-t[0],e[1]=-t[1],e}function tqe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function rM(e,t){const r=t[0],i=t[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function vn(e,t){return e[0]*t[0]+e[1]*t[1]}function rqe(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function T2(e,t,r,i){const s=t[0],n=t[1];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e}function iqe(e,t){t=t||1;const r=2*JM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function wH(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s,e[1]=r[1]*i+r[3]*s,e}function pb(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s+r[4],e[1]=r[1]*i+r[3]*s+r[5],e}function sqe(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[3]*s+r[6],e[1]=r[1]*i+r[4]*s+r[7],e}function nqe(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[4]*s+r[12],e[1]=r[1]*i+r[5]*s+r[13],e}function oqe(e,t,r,i){const s=t[0]-r[0],n=t[1]-r[1],o=Math.sin(i),a=Math.cos(i);return e[0]=s*a-n*o+r[0],e[1]=s*o+n*a+r[1],e}function aqe(e,t){const r=e[0],i=e[1],s=t[0],n=t[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function lqe(e){return"vec2("+e[0]+", "+e[1]+")"}function abe(e,t){return e[0]===t[0]&&e[1]===t[1]}function lbe(e,t){const r=e[0],i=e[1],s=t[0],n=t[1],o=Pa();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function cqe(e,t,r,i,s){let n=t[0]-r[0],o=t[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const uqe=LZ,hqe=Xf,dqe=sbe,pqe=nbe,cbe=jw,fqe=u4,mqe=obe;Object.freeze(Object.defineProperty({__proto__:null,add:ep,angle:aqe,ceil:YHe,copy:qn,cross:rqe,dist:cbe,distance:jw,div:pqe,divide:nbe,dot:vn,equals:lbe,exactEquals:abe,floor:ZHe,inverse:tqe,len:uqe,length:LZ,lerp:T2,max:QHe,min:JHe,mul:dqe,multiply:sbe,negate:DZ,normalize:rM,projectAndScale:cqe,random:iqe,rotate:oqe,round:KHe,scale:Ac,scaleAndAdd:eqe,set:or,sqrDist:fqe,sqrLen:mqe,squaredDistance:u4,squaredLength:obe,str:lqe,sub:hqe,subtract:Xf,transformMat2:wH,transformMat2d:pb,transformMat3:sqe,transformMat4:nqe},Symbol.toStringTag,{value:"Module"}));function NZ(e){return ye((e-1e5)/(1e6-1e5),0,1)}const xH=1e4,gqe=.085,iM=1e5;class yqe{}const gi=yqe;function w(e,...t){let r="";for(let i=0;i<t.length;i++)r+=e[i]+t[i];return r+=e[e.length-1],r}(function(e){function t(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}e.int=t,e.float=r})(w||(w={}));var A;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"})(A||(A={}));var Js;function um(e,t){switch(t.textureCoordinateType){case Js.Default:return e.attributes.add(A.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(w`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Js.Compressed:return e.attributes.add(A.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(w`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Js.Atlas:return e.attributes.add(A.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(A.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(w`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:t.textureCoordinateType;case Js.None:return void e.vertex.code.add(w`void forwardTextureCoordinates() {}`);case Js.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.Compressed=3]="Compressed",e[e.COUNT=4]="COUNT"})(Js||(Js={}));function jc(e){e.code.add(w`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Gu(e){e.include(jc),e.code.add(w`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function G6(e){e.fragment.code.add(w`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var fi;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(fi||(fi={}));class Es{constructor(t,r,i,s,n=null){this.name=t,this.type=r,this.arraySize=n,this.bind={[fi.Pass]:null,[fi.Draw]:null},v(i)&&v(s)&&(this.bind[i]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class qt extends Es{constructor(t,r){super(t,"vec3",fi.Pass,(i,s,n)=>i.setUniform3fv(t,r(s,n)))}}class Pe extends Es{constructor(t,r){super(t,"float",fi.Pass,(i,s,n)=>i.setUniform1f(t,r(s,n)))}}function Py(e){e.uniforms.add(new qt("mainLightDirection",(t,r)=>r.lighting.mainLight.direction))}function Dm(e){e.uniforms.add(new qt("mainLightIntensity",(t,r)=>r.lighting.mainLight.intensity))}function _qe(e,t){t.useLegacyTerrainShading?e.uniforms.add(new Pe("lightingFixedFactor",(r,i)=>i.lighting.noonFactor*(1-i.lighting.globalFactor))):e.constants.add("lightingFixedFactor","float",0)}function h4(e,t){const r=e.fragment;Py(r),Dm(r),_qe(r,t),r.code.add(w`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}class kr extends Es{constructor(t,r){super(t,"vec2",fi.Pass,(i,s,n)=>i.setUniform2fv(t,r(s,n)))}}class fr extends Es{constructor(t,r){super(t,"vec4",fi.Pass,(i,s,n)=>i.setUniform4fv(t,r(s,n)))}}class Yi extends Es{constructor(t,r){super(t,"mat4",fi.Pass,(i,s,n)=>i.setUniformMatrix4fv(t,r(s,n)))}}const ube=ee.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class hbe{constructor(){this._includedModules=new Map}include(t,r){if(this._includedModules.has(t)){const i=this._includedModules.get(t);if(i!==r){ube.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))i[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${t[n]}`))}}else this._includedModules.set(t,r),t(this.builder,r)}}class Lr extends hbe{constructor(){super(...arguments),this.vertex=new Ose,this.fragment=new Ose,this.attributes=new wqe,this.varyings=new xqe,this.extensions=new DE,this.constants=new on}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const r=this.extensions.generateSource(t),i=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?Sqe:Tqe,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];v(a)&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];v(a)&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}}class vqe{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const r of t)this._add(r)}get(t){return this._entries.get(t)}_add(t){if(E(t))ube.error(`Trying to add null Uniform from ${new Error().stack}.`);else{if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new j(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}}generateSource(){return Array.from(this._entries.values()).map(t=>v(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class bqe{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class Ose extends hbe{constructor(){super(...arguments),this.uniforms=new vqe,this.code=new bqe,this.constants=new on}get builder(){return this}}class wqe{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(t){return t==="fragment"?[]:this._entries.map(r=>`attribute ${r[1]} ${r[0]};`)}}class xqe{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class DE{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const r=t==="vertex"?DE.ALLOWLIST_VERTEX:DE.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}}DE.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],DE.ALLOWLIST_VERTEX=[];class on{constructor(){this._entries=new Set}add(t,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=on._numberToFloatStr(i);break;case"int":s=on._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${on._numberToFloatStr(i[0])},                            ${on._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${on._numberToFloatStr(i[0])},                            ${on._numberToFloatStr(i[1])},                            ${on._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${on._numberToFloatStr(i[0])},                            ${on._numberToFloatStr(i[1])},                            ${on._numberToFloatStr(i[2])},                            ${on._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${on._numberToIntStr(i[0])},                             ${on._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${on._numberToIntStr(i[0])},                             ${on._numberToIntStr(i[1])},                             ${on._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${on._numberToIntStr(i[0])},                             ${on._numberToIntStr(i[1])},                             ${on._numberToIntStr(i[2])},                             ${on._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>on._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const Tqe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Sqe=`precision highp float;
precision highp sampler2D;`,FZ="Size",j6="InvSize";function Hh(e,t,r=!1,i=0){if(e.hasWebGL2Context){const s=w`vec2(textureSize(${t}, ${w.int(i)}))`;return r?"(1.0 / "+s+")":s}return r?t+j6:t+FZ}function rl(e,t,r,i=null,s=0){if(e.hasWebGL2Context)return w`texelFetch(${t}, ivec2(${r}), ${w.int(s)})`;let n=w`texture2D(${t}, ${r} * `;return n+=i?w`(${i}))`:w`${t+j6})`,n}var ei;(function(e){e[e.None=0]="None",e[e.Size=1]="Size",e[e.InvSize=2]="InvSize"})(ei||(ei={}));class Mt extends Es{constructor(t,r){super(t,"sampler2D",fi.Pass,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function Tp(e,t,r=ei.None){const i=[new Mt(e,t)];if(r&ei.Size){const s=e+FZ;i.push(new kr(s,(n,o)=>{const a=t(n,o);return v(a)?or(Mse,a.descriptor.width,a.descriptor.height):Zl}))}if(r&ei.InvSize){const s=e+j6;i.push(new kr(s,(n,o)=>{const a=t(n,o);return v(a)?or(Mse,1/a.descriptor.width,1/a.descriptor.height):Zl}))}return i}const Mse=Ke(),eO=Le(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),m9=3,g9=Le(m9*parseFloat(Number(65e-8).toFixed(6)),m9*parseFloat(Number(1881e-9).toFixed(6)),m9*parseFloat(Number(85e-9).toFixed(6))),Eqe=3996e-9,Cqe=Le(parseFloat(Number(eO[0]+g9[0]).toFixed(6)),parseFloat(Number(eO[1]+g9[1]).toFixed(6)),parseFloat(Number(eO[2]+g9[2]).toFixed(6)));function Aqe(e){const t=new Lr;t.attributes.add(A.POSITION,"vec2"),t.include(um,{textureCoordinateType:Js.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=t;return r.uniforms.add([new Yi("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Yi("inverseViewMatrix",(s,n)=>vC(Rqe,n.camera.viewMatrix))]),r.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add([new kr("radii",s=>s.radii),new qt("cameraPosition",(s,n)=>n.camera.eye),new fr("heightParameters",s=>s.heightParameters),new Pe("innerFadeDistance",s=>s.innerFadeDistance),new Pe("altitudeFade",s=>s.altitudeFade),new Mt("depthTex",s=>s.depthTex),new Pe("hazeStrength",s=>s.hazeStrength)]),i.constants.add("betaRayleigh","vec3",eO),i.constants.add("betaCombined","vec3",Cqe),i.constants.add("betaMie","float",Eqe),i.constants.add("scaleHeight","float",gqe*iM),Py(i),t.include(G6),e.haze&&(i.include(Gu),i.uniforms.add(new kr("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(w`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(w`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(w`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(w`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?w`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?w``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":w`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${e.haze?w`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:w`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?w`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:w`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?w`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:w`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":w`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),t}const Rqe=Ie(),Oqe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:eO,build:Aqe},Symbol.toStringTag,{value:"Module"}));class Dr{constructor(t,r){this._module=t,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var Vi,It,Ee,Em,Ot,gp,NE,at,Ni,ks,rt,Rt,bt,ze,St,$t,Za,$r,Eu,io,ps,Ir;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Vi||(Vi={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(It||(It={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ee||(Ee={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Em||(Em={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Ot||(Ot={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(gp||(gp={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(NE||(NE={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(at||(at={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(Ni||(Ni={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(ks||(ks={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(rt||(rt={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Rt||(Rt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(bt||(bt={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ze||(ze={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(St||(St={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}($t||($t={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Za||(Za={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}($r||($r={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Eu||(Eu={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(io||(io={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(ps||(ps={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Ir||(Ir={}));const y9=33984;var Gn,pu;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(Gn||(Gn={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(pu||(pu={}));const Pse=33306;var Ls,Ise,$se,Lse,d4,TH,Dse;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Ls||(Ls={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Ise||(Ise={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}($se||($se={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(Lse||(Lse={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(d4||(d4={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(TH||(TH={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Dse||(Dse={}));class Br{constructor(t,r,i){this.release=i,this.initializeConfiguration(t,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=tt(this._program),this._pipeline=this._configuration=null}reload(t){tt(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(t,r=null,i){t.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return It.TRIANGLES}getPipelineState(t,r){return this._pipeline}initializeConfiguration(t,r){}}const Or=new Map([[A.POSITION,0],[A.NORMAL,1],[A.UV0,2],[A.COLOR,3],[A.SIZE,4],[A.TANGENT,4],[A.AUXPOS1,5],[A.SYMBOLCOLOR,5],[A.AUXPOS2,6],[A.FEATUREATTRIBUTE,6],[A.INSTANCEFEATUREATTRIBUTE,6],[A.INSTANCECOLOR,7],[A.OBJECTANDLAYERIDCOLOR,7],[A.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[A.MODEL,8],[A.MODELNORMAL,12],[A.MODELORIGINHI,11],[A.MODELORIGINLO,15]]),Mqe=ee.getLogger("esri.views.webgl.checkWebGLError");function Pqe(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const dbe=!!de("enable-feature:webgl-debug");function gu(){return dbe}function SH(){return dbe}function S_(e){if(gu()){const t=e.getError();if(t){const r=Pqe(e,t),i=new Error().stack;Mqe.error(new j("webgl-error","WebGL error occured",{message:r,stack:i}))}}}class Nr{constructor(t,r,i){this._context=t,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Jt({deallocator:null}),this._glProgram=t.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(fi.Pass,this),this.bindDraw=r.generateBind(fi.Draw,this),this._fragmentUniforms=gu()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(t,r){this._glProgram.setUniform1i(t,r?1:0)}setUniform1i(t,r){this._glProgram.setUniform1i(t,r)}setUniform1f(t,r){this._glProgram.setUniform1f(t,r)}setUniform2fv(t,r){this._glProgram.setUniform2fv(t,r)}setUniform3fv(t,r){this._glProgram.setUniform3fv(t,r)}setUniform4fv(t,r){this._glProgram.setUniform4fv(t,r)}setUniformMatrix3fv(t,r){this._glProgram.setUniformMatrix3fv(t,r)}setUniformMatrix4fv(t,r){this._glProgram.setUniformMatrix4fv(t,r)}setUniform1fv(t,r){this._glProgram.setUniform1fv(t,r)}setUniform1iv(t,r){this._glProgram.setUniform1iv(t,r)}setUniform2iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform3iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform4iv(t,r){this._glProgram.setUniform4iv(t,r)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,r){if(E(r)||r.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let i=this._textures.get(t);return i==null?(i=this._allocTextureUnit(r),this._textures.set(t,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,r)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(r,t.unit)}),v(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var Oi,Hw,Ds,sy,ql,by,rv,FE,di,qw,Hg;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(Oi||(Oi={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(Hw||(Hw={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(Ds||(Ds={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(sy||(sy={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(ql||(ql={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(by||(by={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(rv||(rv={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(FE||(FE={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(di||(di={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(qw||(qw={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(Hg||(Hg={}));function Vp(e,t,r=Em.ADD,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Wn(e,t,r,i,s=Em.ADD,n=Em.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const UZ={face:gp.BACK,mode:NE.CCW},pbe={face:gp.FRONT,mode:NE.CCW},H6=e=>e===Oi.Back?UZ:e===Oi.Front?pbe:null,Jl={zNear:0,zFar:1},Qt={r:!0,g:!0,b:!0,a:!0};function Iqe(e){return Vqe.intern(e)}function $qe(e){return Bqe.intern(e)}function Lqe(e){return zqe.intern(e)}function Dqe(e){return Gqe.intern(e)}function Nqe(e){return jqe.intern(e)}function Fqe(e){return Hqe.intern(e)}function Uqe(e){return qqe.intern(e)}function kqe(e){return Wqe.intern(e)}function Vt(e){return Xqe.intern(e)}class Iy{constructor(t,r){this._makeKey=t,this._makeRef=r,this._interns=new Map}intern(t){var s;if(!t)return null;const r=this._makeKey(t),i=this._interns;return i.has(r)||i.set(r,this._makeRef(t)),(s=i.get(r))!=null?s:null}}function $y(e){return"["+e.join(",")+"]"}const Vqe=new Iy(fbe,e=>({__tag:"Blending",...e}));function fbe(e){return e?$y([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const Bqe=new Iy(mbe,e=>({__tag:"Culling",...e}));function mbe(e){return e?$y([e.face,e.mode]):null}const zqe=new Iy(gbe,e=>({__tag:"PolygonOffset",...e}));function gbe(e){return e?$y([e.factor,e.units]):null}const Gqe=new Iy(ybe,e=>({__tag:"DepthTest",...e}));function ybe(e){return e?$y([e.func]):null}const jqe=new Iy(_be,e=>({__tag:"StencilTest",...e}));function _be(e){return e?$y([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const Hqe=new Iy(vbe,e=>({__tag:"DepthWrite",...e}));function vbe(e){return e?$y([e.zNear,e.zFar]):null}const qqe=new Iy(bbe,e=>({__tag:"ColorWrite",...e}));function bbe(e){return e?$y([e.r,e.g,e.b,e.a]):null}const Wqe=new Iy(wbe,e=>({__tag:"StencilWrite",...e}));function wbe(e){return e?$y([e.mask]):null}const Xqe=new Iy(Yqe,e=>({blending:Iqe(e.blending),culling:$qe(e.culling),polygonOffset:Lqe(e.polygonOffset),depthTest:Dqe(e.depthTest),stencilTest:Nqe(e.stencilTest),depthWrite:Fqe(e.depthWrite),colorWrite:Uqe(e.colorWrite),stencilWrite:kqe(e.stencilWrite)}));function Yqe(e){return e?$y([fbe(e.blending),mbe(e.culling),gbe(e.polygonOffset),ybe(e.depthTest),_be(e.stencilTest),vbe(e.depthWrite),bbe(e.colorWrite),wbe(e.stencilWrite)]):null}class Zqe{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,r,i,s){return(i||t!==r)&&(s(t),this._pipelineInvalid=!0),t}}class Jqe extends gi{constructor(){super(...arguments),this.heightParameters=sr(),this.radii=Ke(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}}class sM extends Br{initializeProgram(t){return new Nr(t.rctx,sM.shader.get().build(this.configuration),Or)}initializePipeline(){return this.configuration.haze?Vt({blending:Wn(Ee.ONE,Ee.ZERO,Ee.ONE_MINUS_SRC_COLOR,Ee.ONE),colorWrite:Qt}):Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ni.LEQUAL},colorWrite:Qt})}}sM.shader=new Dr(Oqe,()=>ie(()=>import("./ChapmanAtmosphere.glsl.3d38a59c.js"),[]));class $a extends gi{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,r={key:this.key};for(const i of t)r[i]=this[i];return r}}function B(e={}){return(t,r)=>{var i,s;if(t._parameterNames=(i=t._parameterNames)!=null?i:[],t._parameterNames.push(r),e.constValue!=null)Object.defineProperty(t,r,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,r,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<h&p,typeof f!="number"&&typeof f!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof f)}})}}}class xbe extends $a{constructor(){super(...arguments),this.haze=!1}}u([B()],xbe.prototype,"haze",void 0);class Vo{constructor(t,r,i,s,n,o=!1,a=0){this.name=t,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new Vo(A.POSITION,3,at.FLOAT,0,12);new Vo(A.POSITION,3,at.FLOAT,0,20),new Vo(A.UV0,2,at.FLOAT,12,20);new Vo(A.POSITION,3,at.FLOAT,0,32),new Vo(A.NORMAL,3,at.FLOAT,12,32),new Vo(A.UV0,2,at.FLOAT,24,32);new Vo(A.POSITION,3,at.FLOAT,0,16),new Vo(A.COLOR,4,at.UNSIGNED_BYTE,12,16);const kZ=[new Vo(A.POSITION,2,at.FLOAT,0,8)],$C=[new Vo(A.POSITION,2,at.FLOAT,0,16),new Vo(A.UV0,2,at.FLOAT,8,16)];function Nse(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function ra(e,t){return e.vertexBuffers[t].size/Qqe(e.layout[t])}function Qqe(e){return e[0].stride}function VZ(e,t,r,i,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(r);for(const a of i){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function BZ(e,t,r,i){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(r);for(const o of i){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(Ot.ARRAY_BUFFER)}function Tbe(e){switch(e){case ze.ALPHA:case ze.LUMINANCE:case ze.RED:case ze.RED_INTEGER:case St.R8:case St.R8I:case St.R8UI:case St.R8_SNORM:case Za.STENCIL_INDEX8:return 1;case ze.LUMINANCE_ALPHA:case ze.RG:case ze.RG_INTEGER:case St.RGBA4:case St.R16F:case St.R16I:case St.R16UI:case St.RG8:case St.RG8I:case St.RG8UI:case St.RG8_SNORM:case St.RGB565:case St.RGB5_A1:case Za.DEPTH_COMPONENT16:return 2;case ze.DEPTH_COMPONENT:case ze.RGB:case ze.RGB_INTEGER:case St.RGB8:case St.RGB8I:case St.RGB8UI:case St.RGB8_SNORM:case St.SRGB8:case Za.DEPTH_COMPONENT24:return 3;case ze.DEPTH_STENCIL:case ze.RGBA:case ze.RGBA_INTEGER:case St.RGBA8:case St.R32F:case St.R11F_G11F_B10F:case St.RG16F:case St.R32I:case St.R32UI:case St.RG16I:case St.RG16UI:case St.RGBA8I:case St.RGBA8UI:case St.RGBA8_SNORM:case St.SRGB8_ALPHA8:case St.RGB9_E5:case St.RGB10_A2UI:case St.RGB10_A2:case Za.DEPTH_STENCIL:case Za.DEPTH_COMPONENT32F:case Za.DEPTH24_STENCIL8:return 4;case Za.DEPTH32F_STENCIL8:return 5;case St.RGB16F:case St.RGB16I:case St.RGB16UI:return 6;case St.RG32F:case St.RG32I:case St.RG32UI:case St.RGBA16F:case St.RGBA16I:case St.RGBA16UI:return 8;case St.RGB32F:case St.RGB32I:case St.RGB32UI:return 12;case St.RGBA32F:case St.RGBA32I:case St.RGBA32UI:return 16;case Ls.COMPRESSED_RGB_S3TC_DXT1_EXT:case Ls.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Ls.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Ls.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Ls.COMPRESSED_R11_EAC:case Ls.COMPRESSED_SIGNED_R11_EAC:case Ls.COMPRESSED_RGB8_ETC2:case Ls.COMPRESSED_SRGB8_ETC2:case Ls.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Ls.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Ls.COMPRESSED_RG11_EAC:case Ls.COMPRESSED_SIGNED_RG11_EAC:case Ls.COMPRESSED_RGBA8_ETC2_EAC:case Ls.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function Ww(e){if(E(e))return 0;if("descriptor"in e)return e.glName?Ww(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const r="hasMipmap"in e&&e.hasMipmap?1.3:1,i=e.width*e.height;return Tbe(t)*i*r}const Kv=ee.getLogger("esri.views.webgl.VertexArrayObject");let rd=class{constructor(e,t,r,i,s=null){this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(Gn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((e,t)=>e+this._buffers[t].size,v(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){var t,r,i;if(!this._context)return void((this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&Kv.warn("Leaked WebGL VAO"));if(this._glName){const s=(r=(t=this._context)==null?void 0:t.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):Kv.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const s in this._buffers)(i=this._buffers[s])==null||i.dispose(),delete this._buffers[s];this._indexBuffer=tt(this._indexBuffer)}this._context.instanceCounter.decrement(Gn.VertexArrayObject,this),this._context=Sw(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||Kv.error("Vertex buffer dictionary is empty!");const i=this._context.gl;for(const s in e){const n=e[s];n||Kv.error("Vertex buffer is uninitialized!");const o=t[s];o||Kv.error("Vertex element descriptor is empty!"),VZ(this._context,this._locations,n,o)}v(r)&&(this._context.capabilities.vao?i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:t}=this;e||Kv.error("Vertex buffer dictionary is empty!");for(const r in e){const i=e[r];i||Kv.error("Vertex buffer is uninitialized!");const s=t[r];BZ(this._context,this._locations,i,s)}v(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}};class Bp extends rd{}var vt;function Kqe(e,t,r={}){const i=Sbe(e);for(;i.length>1;){const s=p4(t,i.shift(),r);if(v(s))return s}return eWe(t,i.shift(),r)}function Sbe(e){const t=de("esri-force-webgl");if(t===vt.WEBGL1||t===vt.WEBGL2)return[t];switch(e){case"2d":return de("mac")&&de("chrome")?[vt.WEBGL1,vt.WEBGL2]:[vt.WEBGL2,vt.WEBGL1];case"3d":return[vt.WEBGL2,vt.WEBGL1]}}function eWe(e,t,r={}){if(!window.WebGLRenderingContext)return Fse(e,tWe),null;const i=p4(e,t,r);return E(i)&&Fse(e,rWe),i}function p4(e,t,r={}){const i=t===vt.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of i){try{s=e.getContext(n,r)}catch{}if(s)break}return s}function Fse(e,t){const r=e.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(vt||(vt={}));const tWe='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',rWe=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,Wp=ee.getLogger("esri.views.webgl.BufferObject");class wr{static createIndex(t,r,i){return new wr(t,Ot.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(t,r,i){return new wr(t,Ot.ARRAY_BUFFER,r,i)}static createUniform(t,r,i){if(t.type!==vt.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new wr(t,Ot.UNIFORM_BUFFER,r,i)}static createPixelPack(t,r=$r.STREAM_READ,i){if(t.type!==vt.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new wr(t,Ot.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(t,r=$r.STREAM_DRAW,i){if(t.type!==vt.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new wr(t,Ot.PIXEL_UNPACK_BUFFER,r,i)}constructor(t,r,i,s){this._context=t,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(Gn.BufferObject,this),this._glName=this._context.gl.createBuffer(),S_(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===Ot.ELEMENT_ARRAY_BUFFER?this._indexType===at.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Ot.ELEMENT_ARRAY_BUFFER||this.bufferType===Ot.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Gn.BufferObject,this),this._context=Sw(this._context)):this._glName&&Wp.warn("Leaked WebGL buffer object")}setSize(t,r=null){if(t<=0&&Wp.error("Buffer size needs to be positive!"),this.bufferType===Ot.ELEMENT_ARRAY_BUFFER&&v(r))switch(this._indexType=r,r){case at.UNSIGNED_SHORT:t*=2;break;case at.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let r=t.byteLength;this.bufferType===Ot.ELEMENT_ARRAY_BUFFER&&(xW(t)&&(r/=2,this._indexType=at.UNSIGNED_SHORT),TW(t)&&(r/=4,this._indexType=at.UNSIGNED_INT)),this._setBufferData(r,t)}_setBufferData(t,r=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;v(r)?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,t,this.usage),S_(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,r,i,s){if(!t)return;(r<0||r*t.BYTES_PER_ELEMENT>=this.byteSize)&&Wp.error("offset is out of range!"),i>=s&&Wp.error("end must be bigger than start!"),(r+(s-i))*t.BYTES_PER_ELEMENT>this.byteSize&&Wp.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===vt.WEBGL2)o.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,t,i,s-i);else{const a=i===0&&s===t.length?t:t.subarray(i,s);o.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,a)}S_(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,r=0,i,s){if(this._context.type!==vt.WEBGL2)return void Wp.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void Wp.error("Problem getting subdata: offset and length were less than zero!");const n=iWe(t)?t.BYTES_PER_ELEMENT:1;if(n*((i!=null?i:0)+(s!=null?s:0))>t.byteLength)return void Wp.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s!=null?s:0)>this.byteSize&&Wp.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Ot.COPY_READ_BUFFER),o.getBufferSubData(Ot.COPY_READ_BUFFER,r,t,i,s),this._context.unbindBuffer(Ot.COPY_READ_BUFFER)}async getSubDataAsync(t,r=0,i,s){this._context.type===vt.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,r,i,s)):Wp.error("Get buffer subdata is supported in WebGL2 only!")}}function iWe(e){return jAe(e)}const _9={target:bt.TEXTURE_2D,samplingMode:rt.LINEAR,wrapMode:Rt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},Use=4;let lt=class{constructor(e,t,r=null){this._context=e,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,e.instanceCounter.increment(Gn.Texture,this),this._descriptor={..._9,...t};for(const i in _9)this._descriptor[i]===void 0&&(this._descriptor[i]=_9[i]);if(e.type!==vt.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),e1(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===bt.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Gn.Texture,this))}release(){this.dispose()}resize(e,t){const r=this._descriptor;if(r.width!==e||r.height!==t){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=e,r.height=t,this._descriptor.target===bt.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let t=bt.TEXTURE_CUBE_MAP_POSITIVE_X;t<=bt.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(e,t){var c,h;if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),e===void 0&&(e=null);const i=this._descriptor,s=t!=null?t:i.target,n=e1(s);e===null&&(i.width=i.width||Use,i.height=i.height||Use,n&&(i.depth=(c=i.depth)!=null?c:1));const o=this._context.bindTexture(this,lt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(lt.TEXTURE_UNIT_FOR_UPDATES),lt._validateTexture(this._context,i),this._configurePixelStorage(),S_(r);const a=i.pixelFormat;let l=(h=i.internalFormat)!=null?h:this._deriveInternalFormat(a,i.dataType);if(v9(e)){let p=e.width,f=e.height;const m=1;e instanceof HTMLVideoElement&&(p=e.videoWidth,f=e.videoHeight),i.width&&i.height,n&&i.depth,i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,i.hasMipmap,p,f,m),this._texImage(s,0,l,p,f,m,e),S_(r),i.hasMipmap&&this.generateMipmap(),i.width===void 0&&(i.width=p),i.height===void 0&&(i.height=f),n&&i.depth===void 0&&(i.depth=m)}else{const{width:p,height:f,depth:m}=i;if(p==null||f==null)throw new Error("Width and height must be specified!");if(n&&m==null)throw new Error("Depth must be specified!");if(i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,i.hasMipmap,p,f,m),r.DEPTH24_STENCIL8&&l===r.DEPTH_STENCIL&&(l=r.DEPTH24_STENCIL8),uN(e)){const y=e.levels,_=kse(s,p,f,m),b=Math.min(_-1,y.length-1);v(this._context.gl2)?r.texParameteri(i.target,this._context.gl2.TEXTURE_MAX_LEVEL,b):i.hasMipmap=i.hasMipmap&&_===y.length;const x=l;if(!nWe(x))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((T,S,C,O)=>{const R=y[Math.min(T,y.length-1)];this._compressedTexImage(s,T,x,S,C,O,R)},b)}else v(e)?(this._texImage(s,0,l,p,f,m,e),S_(r),i.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((y,_,b,x)=>{this._texImage(s,y,l,_,b,x,null),S_(r)})}lt._applySamplingMode(r,this._descriptor),lt._applyWrapMode(r,this._descriptor),lt._applyAnisotropicFilteringParameters(this._context,this._descriptor),S_(r),this._context.bindTexture(o,lt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,r,i,s,n,o=0){var _;n||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,dataType:h,target:p,isImmutable:f}=l,m=(_=l.internalFormat)!=null?_:this._deriveInternalFormat(c,h);if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const y=this._context.bindTexture(this,lt.TEXTURE_UNIT_FOR_UPDATES,!0);if((t<0||r<0||i>l.width||s>l.height||t+i>l.width||r+s>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),o){if(E(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");a.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,o)}if(v9(n)?v(this._context.gl2)?this._context.gl2.texSubImage2D(p,e,t,r,i,s,c,h,n):a.texSubImage2D(p,e,t,r,c,h,n):uN(n)?a.compressedTexSubImage2D(p,e,t,r,i,s,m,n.levels[e]):a.texSubImage2D(p,e,t,r,i,s,c,h,n),o){if(E(this._context.gl2))return void console.error("Webgl2 must be enabled to use dataRowOffset!");a.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(y,lt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,t,r,i,s,n,o,a){var b;a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl2;if(E(l))throw new Error("3D textures are not supported in WebGL1");const c=this._descriptor,{pixelFormat:h,dataType:p,isImmutable:f,target:m}=c,y=(b=c.internalFormat)!=null?b:this._deriveInternalFormat(h,p);if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");e1(m)||console.warn("Attempting to set 3D texture data on a non-3D texture");const _=this._context.bindTexture(this,lt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(lt.TEXTURE_UNIT_FOR_UPDATES),(t<0||r<0||i<0||s>c.width||n>c.height||o>c.depth||t+s>c.width||r+n>c.height||i+o>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),uN(a))a=a.levels[e],l.compressedTexSubImage3D(m,e,t,r,i,s,n,o,y,a);else{const x=a;l.texSubImage3D(m,e,t,r,i,s,n,o,h,p,x)}this._context.bindTexture(_,lt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,lt._validateTexture(this._context,e)}e.samplingMode===rt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=rt.LINEAR_MIPMAP_NEAREST):e.samplingMode===rt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=rt.NEAREST_MIPMAP_NEAREST);const t=this._context.bindTexture(this,lt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(lt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(e.target),this._context.bindTexture(t,lt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,lt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(lt._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(lt._applyWrapMode(e,t),this._wrapModeDirty=!1)}_deriveInternalFormat(e,t){if(this._context.type===vt.WEBGL1)return e;switch(t){case $t.FLOAT:switch(e){case ze.RGBA:return St.RGBA32F;case ze.RGB:return St.RGB32F;default:throw new Error("Unable to derive format")}case $t.UNSIGNED_BYTE:switch(e){case ze.RGBA:return St.RGBA8;case ze.RGB:return St.RGB8}default:return e}}_configurePixelStorage(){const e=this._context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_texStorage(e,t,r,i,s,n){const o=this._context.gl2;if(E(o))throw new Error("Immutable textures are not supported in WebGL1");if(!sWe(t))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const a=r?kse(e,i,s,n):1;if(e1(e)){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");o.texStorage3D(e,a,t,i,s,n)}else o.texStorage2D(e,a,t,i,s);this._wasImmutablyAllocated=!0}_texImage(e,t,r,i,s,n,o){const a=this._context.gl;let l=null;const c=this._context.type===vt.WEBGL2,h=e1(e),{isImmutable:p,pixelFormat:f,dataType:m}=this._descriptor;if(c&&(l=a),c||!v9(o))if(p){if(v(o)){const y=o;if(h){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,t,0,0,0,i,s,n,f,m,y)}else a.texSubImage2D(e,t,0,0,i,s,f,m,y)}}else{const y=o;if(h){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");l.texImage3D(e,t,r,i,s,n,0,f,m,y)}else a.texImage2D(e,t,r,i,s,0,f,m,y)}else a.texImage2D(e,0,r,f,m,o)}_compressedTexImage(e,t,r,i,s,n,o){const a=this._context.gl;let l=null;const c=e1(e),h=this._descriptor.isImmutable;if(c){if(this._context.type!==vt.WEBGL2)throw new Error("3D textures are not supported in WebGL1");l=a}if(h){if(v(o))if(c){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,i,s,n,r,o)}else a.compressedTexSubImage2D(e,t,0,0,i,s,r,o)}else if(c){if(n==null)throw new Error("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,r,i,s,n,0,o)}else a.compressedTexImage2D(e,t,r,i,s,0,o)}_forEachMipmapLevel(e,t=1/0){let{width:r,height:i,depth:s,hasMipmap:n,target:o}=this._descriptor;const a=o===bt.TEXTURE_3D;if(r==null||i==null||a&&s==null)throw new Error("Missing texture dimensions for mipmap calculation");for(let l=0;e(l,r,i,s),n&&(r!==1||i!==1||a&&s!==1)&&!(l>=t);++l)r=Math.max(1,r>>1),i=Math.max(1,i>>1),a&&(s=Math.max(1,s>>1))}static _validateTexture(e,t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=e.type===vt.WEBGL2,i=t.width!=null&&Rp(t.width)&&t.height!=null&&Rp(t.height);r||!t.isImmutable&&!e1(t.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||i||(typeof t.wrapMode=="number"?t.wrapMode!==Rt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):t.wrapMode.s===Rt.CLAMP_TO_EDGE&&t.wrapMode.t===Rt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let r=t.samplingMode,i=t.samplingMode;r===rt.LINEAR_MIPMAP_NEAREST||r===rt.LINEAR_MIPMAP_LINEAR?(r=rt.LINEAR,t.hasMipmap||(i=rt.LINEAR)):r!==rt.NEAREST_MIPMAP_NEAREST&&r!==rt.NEAREST_MIPMAP_LINEAR||(r=rt.NEAREST,t.hasMipmap||(i=rt.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,i)}static _applyWrapMode(e,t){typeof t.wrapMode=="number"?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){var i;const r=e.capabilities.textureFilterAnisotropic;!r||e.gl.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY,(i=t.maxAnisotropy)!=null?i:1)}};function sWe(e){return e in St}function nWe(e){return e in Ls}function uN(e){return v(e)&&"type"in e&&e.type==="compressed"}function oWe(e){return v(e)&&"byteLength"in e}function v9(e){return v(e)&&!uN(e)&&!oWe(e)}function e1(e){return e===bt.TEXTURE_3D||e===bt.TEXTURE_2D_ARRAY}function kse(e,t,r,i=1){let s=Math.max(t,r);return e===bt.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}lt.TEXTURE_UNIT_FOR_UPDATES=0;function La(e,t=kZ,r=Or,i=-1,s=1){let n=null;return t===$C?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new Bp(e,r,{geometry:t},{geometry:wr.createVertex(e,$r.STATIC_DRAW,n)})}function aWe(e,t=kZ,r=Or){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new Bp(e,r,{geometry:t},{geometry:wr.createVertex(e,$r.STATIC_DRAW,i)})}const Ebe=4;function Cbe(e,t=Ebe){return new lt(e,{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,width:t,height:t})}function lWe(e,t,r=Ebe){const i=new Uint8Array(r*r*4);for(let s=0;s<i.length;s+=4)i[s+0]=255*t[0],i[s+1]=255*t[1],i[s+2]=255*t[2],i[s+3]=255*t[3];return new lt(e,{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,width:r,height:r},i)}function Abe(e){return new lt(e,{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class b9{constructor(t,r){this._view=t,this.type=Dn.Realistic,this._handles=new Jr,this._passParameters=new Jqe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=br.radius,this._fadeHaze=0,this._updateRadius(br.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([se(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),se(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const s=new xbe;s.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(sM,s),s.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(sM,s),this._vao=La(i,$C)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,r){this._fadeHaze=r,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,r,i){if(E(i))return;this._update(t.bindParameters.camera),this._passParameters.depthTex=i;const s=t.rctx.bindTechnique(r,this._passParameters,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>this._renderCommon(s,t))}_renderCommon(t,r){E(this._vao)||(r.rctx.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(It.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const t=this._view.basemapTerrain.rootTileElevationBounds.min;t!==this._rootTileElevationMin&&(this._rootTileElevationMin=t,this._lowerBoundEarthRadius=br.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(br.radius+this._view.basemapTerrain.visibleElevationBounds.min);t<this._lowerBoundEarthRadius&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,or(this._passParameters.radii,t,t+iM),this._passParameters.innerFadeDistance=2*Math.sqrt((2*t-xH)*xH)}_update(t){if(E(t))return;const r=ba(t.eye),i=Math.sqrt(r),s=r-this._passParameters.radii[1]*this._passParameters.radii[1],n=ye((i-this._passParameters.radii[0])/iM,0,1);ti(this._passParameters.heightParameters,i,r,s,n),this._passParameters.altitudeFade=NZ(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Nt(Nt(.6,1,QS(9500,10500,i-br.radius)),1,this._fadeHaze)}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}function qi(){return new Float32Array(3)}function f4(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Yr(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function Rbe(e,t){return new Float32Array(e,t,3)}function zZ(){return qi()}function Obe(){return Yr(1,1,1)}function Mbe(){return Yr(1,0,0)}function Pbe(){return Yr(0,1,0)}function Ibe(){return Yr(0,0,1)}const cWe=zZ(),uWe=Obe(),hWe=Mbe(),dWe=Pbe(),pWe=Ibe();Object.freeze(Object.defineProperty({__proto__:null,ONES:uWe,UNIT_X:hWe,UNIT_Y:dWe,UNIT_Z:pWe,ZEROS:cWe,clone:f4,create:qi,createView:Rbe,fromValues:Yr,ones:Obe,unitX:Mbe,unitY:Pbe,unitZ:Ibe,zeros:zZ},Symbol.toStringTag,{value:"Module"}));function $be(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(w`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function GZ(e,t){switch(e.include(um,t),e.fragment.code.add(w`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case Js.Default:case Js.Compressed:return void e.fragment.code.add(w`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case Js.Atlas:return e.include($be),void e.fragment.code.add(w`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case Js.None:case Js.COUNT:return}}class Nu extends Es{constructor(t,r){super(t,"vec3",fi.Draw,(i,s,n,o)=>i.setUniform3fv(t,r(s,n,o)))}}class nM extends Es{constructor(t,r){super(t,"vec2",fi.Draw,(i,s,n,o)=>i.setUniform2fv(t,r(s,n,o)))}}class LP extends Es{constructor(t,r){super(t,"sampler2D",fi.Draw,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function iv(e,t,r=ei.None){const i=[new LP(e,t)];if(r&ei.Size){const s=e+FZ;i.push(new nM(s,(n,o)=>{const a=t(n,o);return v(a)?or(Vse,a.descriptor.width,a.descriptor.height):Zl}))}if(r&ei.InvSize){const s=e+j6;i.push(new nM(s,(n,o)=>{const a=t(n,o);return v(a)?or(Vse,1/a.descriptor.width,1/a.descriptor.height):Zl}))}return i}const Vse=Ke();class Vv{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(t,r){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(t){return sy.LOADED}}class jZ extends Vv{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,r=>this._texture=r),this._acquire(t.normalTextureId,r=>this._textureNormal=r),this._acquire(t.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(t.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(t.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=Wi(this._texture),this._textureNormal=Wi(this._textureNormal),this._textureEmissive=Wi(this._textureEmissive),this._textureOcclusion=Wi(this._textureOcclusion),this._textureMetallicRoughness=Wi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?sy.LOADED:sy.LOADING}get textureBindParameters(){return new Lbe(v(this._texture)?this._texture.glTexture:null,v(this._textureNormal)?this._textureNormal.glTexture:null,v(this._textureEmissive)?this._textureEmissive.glTexture:null,v(this._textureOcclusion)?this._textureOcclusion.glTexture:null,v(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(E(this._texture)||t!==this._texture.id)&&(this._texture=Wi(this._texture),this._textureId=t,this._acquire(this._textureId,r=>this._texture=r))}_acquire(t,r){if(E(t))return void r(null);const i=this._textureRepository.acquire(t);if(Hu(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return Wi(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}}class Lbe extends gi{constructor(t=null,r=null,i=null,s=null,n=null){super(),this.texture=t,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const R2t=Yr(0,.6,.2);var ht;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.Terrain=5]="Terrain",e[e.TerrainWithWater=6]="TerrainWithWater",e[e.COUNT=7]="COUNT"})(ht||(ht={}));function HZ(e,t){const r=e.fragment,i=t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===ht.Normal&&i&&e.include(GZ,t),t.pbrMode!==ht.Schematic)if(t.pbrMode!==ht.Disabled){if(t.pbrMode===ht.Normal){r.code.add(w`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas?t.hasWebGL2Context?ei.None:ei.Size:ei.None,n=t.pbrTextureBindType;t.hasMetallicRoughnessTexture&&(r.uniforms.add(n===fi.Pass?Tp("texMetallicRoughness",o=>o.textureMetallicRoughness,s):iv("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),r.code.add(w`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(r.uniforms.add(n===fi.Pass?Tp("texEmission",o=>o.textureEmissive,s):iv("texEmission",o=>o.textureEmissive,s)),r.code.add(w`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(r.uniforms.add(n===fi.Pass?Tp("texOcclusion",o=>o.textureOcclusion,s):iv("texOcclusion",o=>o.textureOcclusion,s)),r.code.add(w`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(w`float getBakedOcclusion() { return 1.0; }`),r.uniforms.add(n===fi.Pass?[new qt("emissionFactor",o=>o.emissiveFactor),new qt("mrrFactors",o=>o.mrrFactors)]:[new Nu("emissionFactor",o=>o.emissiveFactor),new Nu("mrrFactors",o=>o.mrrFactors)]),r.code.add(w`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${i?w`vtc.uv = vuv0;`:""}
      ${t.hasMetallicRoughnessTextureTransform?w`vtc.uv = metallicRoughnessUV;`:""}
      ${t.hasMetallicRoughnessTexture?t.supportsTextureAtlas?w`
                vtc.size = ${Hh(t,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:w`applyMetallnessAndRoughness(vtc);`:""}
      ${t.hasEmissiveTextureTransform?w`vtc.uv = emissiveUV;`:""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?w`
                vtc.size = ${Hh(t,"texEmission")};
                applyEmission(vtc);`:w`applyEmission(vtc);`:""}
      ${t.hasOcclusionTextureTransform?w`vtc.uv = occlusionUV;`:""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?w`
                vtc.size = ${Hh(t,"texOcclusion")};
                applyOcclusion(vtc);`:w`applyOcclusion(vtc);`:""}
    }
  `)}}else r.code.add(w`float getBakedOcclusion() { return 1.0; }`);else r.code.add(w`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function qZ(e,t){const r=e.fragment,i=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new qt("lightingAmbientSH0",(s,n)=>ce(Bse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add([new fr("lightingAmbientSH_R",(s,n)=>ti(Ym,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new fr("lightingAmbientSH_G",(s,n)=>ti(Ym,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new fr("lightingAmbientSH_B",(s,n)=>ti(Ym,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add([new qt("lightingAmbientSH0",(s,n)=>ce(Bse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new fr("lightingAmbientSH_R1",(s,n)=>ti(Ym,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new fr("lightingAmbientSH_G1",(s,n)=>ti(Ym,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new fr("lightingAmbientSH_B1",(s,n)=>ti(Ym,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new fr("lightingAmbientSH_R2",(s,n)=>ti(Ym,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new fr("lightingAmbientSH_G2",(s,n)=>ti(Ym,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new fr("lightingAmbientSH_B2",(s,n)=>ti(Ym,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==ht.Normal&&t.pbrMode!==ht.Schematic||r.code.add(w`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Bse=M(),Ym=sr();function DP(e){e.vertex.code.add(w`const float PI = 3.141592653589793;`),e.fragment.code.add(w`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Ns,Xw;function fWe(e){return v(e)&&v(e.cubeMap)}function WZ(e){return v(e)&&!e.running}(function(e){e[e.RENDERING=0]="RENDERING",e[e.FINISHED_RENDERING=1]="FINISHED_RENDERING",e[e.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",e[e.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",e[e.FINISHED=4]="FINISHED"})(Ns||(Ns={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(Xw||(Xw={}));class mWe{constructor(){this.readChannels=Xw.RG,this.renderingStage=Ns.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=M(),this.isCameraPositionFinal=!0,this.parallax=new zse,this.parallaxNew=new zse,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:Nn.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:xc.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:_v.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===Nn.FADE_OUT||this.fadeInOut.stage===Nn.FADE_IN||this.fadeIn.stage===xc.FADE_IN||this.fadeInOutHeight.stage!==_v.FINISHED||this.renderingStage===Ns.FADING_TEXTURE_CHANNELS}}var xc,Nn,_v;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(xc||(xc={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(Nn||(Nn={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(_v||(_v={}));class zse{constructor(){this.anchorPointClouds=M(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=Ie()}}class ny extends Es{constructor(t,r){super(t,"bool",fi.Pass,(i,s,n)=>i.setUniform1b(t,r(s,n)))}}class gWe extends Es{constructor(t,r){super(t,"samplerCube",fi.Pass,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function Dbe(e){const t=e.fragment;t.uniforms.add([new Yi("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new Yi("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new qt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new qt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Pe("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Pe("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Pe("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===Nn.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Pe("crossFadeAnchorFactor",(r,i)=>ye(i.cloudsFade.crossFade.factor,0,1)),new gWe("cubeMap",(r,i)=>v(i.cloudsFade.data)&&v(i.cloudsFade.data.cubeMap)?i.cloudsFade.data.cubeMap.colorTexture:null),new ny("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new ny("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===Xw.RG),new ny("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===Ns.FADING_TEXTURE_CHANNELS)]),t.constants.add("planetRadius","float",br.radius),t.code.add(w`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(w`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(w`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Py(t),Dm(t),t.code.add(w`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(w`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),t.code.add(w`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(w`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(w`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Nm(e){e.code.add(w`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function yWe(){const e=new Lr;e.attributes.add(A.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add([new Yi("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new Yi("inverseViewMatrix",(i,s)=>vC(_We,s.camera.viewMatrix))]),t.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(Nm),r.include(jc),e.include(qZ,{pbrMode:ht.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(DP),e.include(G6),e.include(h4,{useLegacyTerrainShading:!1}),e.include(Dbe,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),r.uniforms.add([new qt("cameraPosition",(i,s)=>s.camera.eye)]),r.code.add(w`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const _We=Ie(),vWe=Object.freeze(Object.defineProperty({__proto__:null,build:yWe},Symbol.toStringTag,{value:"Module"}));class q6 extends Br{constructor(t){super(t,new $a,()=>this.destroy())}initializeProgram(t){return new Nr(t.rctx,q6.shader.get().build(),Or)}initializePipeline(){return Vt({blending:Wn(Ee.ONE,Ee.ZERO,Ee.SRC_ALPHA,Ee.ONE),depthTest:{func:Ni.LEQUAL},colorWrite:Qt})}}q6.shader=new Dr(vWe,()=>ie(()=>import("./CloudsComposition.glsl.fa685b08.js"),[]));let fb=class extends Te{constructor(e){super(e),this._technique=new q6(e),this._vao=La(e.rctx)}destroy(){this._technique=Wi(this._technique),this._vao=tt(this._vao)}render(e){const t=e.bindParameters.cloudsFade;if(E(this._vao)||E(t.data))return;if(!this._technique.compiled)return void this.requestRender();const r=e.rctx.bindTechnique(this._technique,bWe,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(It.TRIANGLE_STRIP,0,4)}};u([d({constructOnly:!0})],fb.prototype,"rctx",void 0),u([d({constructOnly:!0})],fb.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],fb.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],fb.prototype,"requestRender",void 0),fb=u([P("esri.views.3d.environment.CloudsComposition")],fb);const bWe=new gi;function id(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function wWe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function XZ(e,t,r,i,s,n,o,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function YZ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function sd(e,t){if(e===t){const r=t[1],i=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Ax(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=r*p+i*f+s*m;return y?(y=1/y,e[0]=p*y,e[1]=(-h*i+s*c)*y,e[2]=(a*i-s*o)*y,e[3]=f*y,e[4]=(h*r-s*l)*y,e[5]=(-a*r+s*n)*y,e[6]=m*y,e[7]=(-c*r+i*l)*y,e[8]=(o*r-i*n)*y,e):null}function xWe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-i*h,e[2]=i*a-s*o,e[3]=a*l-n*h,e[4]=r*h-s*l,e[5]=s*n-r*a,e[6]=n*c-o*l,e[7]=i*l-r*c,e[8]=r*o-i*n,e}function TWe(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function UE(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=r[0],m=r[1],y=r[2],_=r[3],b=r[4],x=r[5],T=r[6],S=r[7],C=r[8];return e[0]=f*i+m*o+y*c,e[1]=f*s+m*a+y*h,e[2]=f*n+m*l+y*p,e[3]=_*i+b*o+x*c,e[4]=_*s+b*a+x*h,e[5]=_*n+b*l+x*p,e[6]=T*i+S*o+C*c,e[7]=T*s+S*a+C*h,e[8]=T*n+S*l+C*p,e}function m4(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=r[0],m=r[1];return e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*i+m*o+c,e[7]=f*s+m*a+h,e[8]=f*n+m*l+p,e}function ZZ(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=Math.sin(r),m=Math.cos(r);return e[0]=m*i+f*o,e[1]=m*s+f*a,e[2]=m*n+f*l,e[3]=m*o-f*i,e[4]=m*a-f*s,e[5]=m*l-f*n,e[6]=c,e[7]=h,e[8]=p,e}function JZ(e,t,r){const i=r[0],s=r[1],n=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function SWe(e,t,r){const i=r[0],s=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function EWe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function CWe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function AWe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function RWe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function QZ(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,c=r*o,h=i*o,p=i*a,f=s*o,m=s*a,y=s*l,_=n*o,b=n*a,x=n*l;return e[0]=1-p-y,e[3]=h-x,e[6]=f+b,e[1]=h+x,e[4]=1-c-y,e[7]=m-_,e[2]=f-b,e[5]=m+_,e[8]=1-c-p,e}function Nbe(e,t){const r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=r*p+i*f+s*m;if(!y)return null;const _=1/y;return e[0]=p*_,e[1]=(-h*i+s*c)*_,e[2]=(a*i-s*o)*_,e[3]=f*_,e[4]=(h*r-s*l)*_,e[5]=(-a*r+s*n)*_,e[6]=m*_,e[7]=(-c*r+i*l)*_,e[8]=(o*r-i*n)*_,e}function kE(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],_=t[13],b=t[14],x=t[15],T=r*a-i*o,S=r*l-s*o,C=r*c-n*o,O=i*l-s*a,R=i*c-n*a,$=s*c-n*l,I=h*_-p*y,U=h*b-f*y,V=h*x-m*y,G=p*b-f*_,z=p*x-m*_,Z=f*x-m*b;let Q=T*Z-S*z+C*G+O*V-R*U+$*I;return Q?(Q=1/Q,e[0]=(a*Z-l*z+c*G)*Q,e[1]=(l*V-o*Z-c*U)*Q,e[2]=(o*z-a*V+c*I)*Q,e[3]=(s*z-i*Z-n*G)*Q,e[4]=(r*Z-s*V+n*U)*Q,e[5]=(i*V-r*z-n*I)*Q,e[6]=(_*$-b*R+x*O)*Q,e[7]=(b*C-y*$-x*S)*Q,e[8]=(y*R-_*C+x*T)*Q,e):null}function OWe(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function MWe(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function PWe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function IWe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function Fbe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function $We(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function LWe(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function DWe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function NWe(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],f=t[1],m=t[2],y=t[3],_=t[4],b=t[5],x=t[6],T=t[7],S=t[8],C=Pa();return Math.abs(r-p)<=C*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-f)<=C*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-m)<=C*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=C*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=C*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-b)<=C*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-x)<=C*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(c-T)<=C*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-S)<=C*Math.max(1,Math.abs(h),Math.abs(S))}function KZ(e){const t=Pa(),r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(r*r+n*n+l*l))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const FWe=UE,UWe=Fbe;Object.freeze(Object.defineProperty({__proto__:null,add:IWe,adjoint:xWe,copy:wWe,determinant:TWe,equals:NWe,exactEquals:DWe,frob:PWe,fromMat2d:RWe,fromMat4:id,fromQuat:QZ,fromRotation:CWe,fromScaling:AWe,fromTranslation:EWe,identity:YZ,invert:Ax,isOrthoNormal:KZ,mul:FWe,multiply:UE,multiplyScalar:$We,multiplyScalarAndAdd:LWe,normalFromMat4:kE,normalFromMat4Legacy:Nbe,projection:OWe,rotate:ZZ,scale:JZ,scaleByVec2:SWe,set:XZ,str:MWe,sub:UWe,subtract:Fbe,translate:m4,transpose:sd},Symbol.toStringTag,{value:"Module"}));var Gl;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(Gl||(Gl={}));class hN extends $a{constructor(){super(...arguments),this.steps=Gl.SIXTEEN,this.writeTextureChannels=Xw.RG}}u([B({count:Gl.COUNT})],hN.prototype,"steps",void 0),u([B({constValue:de("esri-mobile")?1024:2048})],hN.prototype,"cubeMapSize",void 0),u([B()],hN.prototype,"writeTextureChannels",void 0);class n3{constructor(t,r,i,s,n,o,a,l,c=.5){this.coverage=t,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}}const Gse=new n3([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Gl.SIXTEEN),ma={sunny:Gse,cloudy:new n3([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Gl.TWOHUNDRED,.6),rainy:new n3([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Gl.TWOHUNDRED,.4),snowy:new n3([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Gl.HUNDRED,.65),foggy:new n3([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Gl.SIXTEEN),default:Gse},Oh=de("esri-mobile")?64:128,kWe=Oh/128,Wd=Math.ceil(Math.sqrt(Oh)),sp=(Oh+2)*Wd,VWe=1e5,w9=128,BWe=sp/1560;function ud(e,t=!0){e.attributes.add(A.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(w`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?w`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class oM extends Es{constructor(t,r){super(t,"mat3",fi.Draw,(i,s,n)=>i.setUniformMatrix3fv(t,r(s,n)))}}class Ube extends gi{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=ma.default.raymarchingSteps,this.weatherTile=Ke()}}class kbe extends gi{constructor(){super(...arguments),this.viewMatrix=ns()}}function zWe(e){const t=new Lr;t.include(ud,!1);const r=t.fragment;return r.uniforms.add([new Pe("cloudRadius",i=>i.cloudRadius),new Pe("power",i=>Nt(35,120,i.absorption)),new Pe("sigmaE",i=>1+i.absorption),new Pe("density",i=>Nt(0,.3,i.density)),new Pe("cloudSize",i=>Nt(0,.02,Math.max(.01,1-i.cloudSize))),new Pe("detailSize",i=>Nt(0,.2,Math.max(.01,1-i.detailSize))),new Pe("smoothness",i=>Nt(0,.5,1-i.smoothness)),new Pe("cloudHeight",i=>Nt(0,1500,i.cloudHeight)),new Pe("coverage",i=>i.coverage),new oM("view",i=>i.viewMatrix),new Mt("cloudShapeTexture",i=>v(i.noiseTexture)?i.noiseTexture.textureAtlas:null),new kr("cloudVariables",i=>or(GWe,i.coverage,i.absorption))]),r.constants.add("halfCubeMapSize","float",.5*e.cubeMapSize),r.code.add(w`
    const int STEPS = ${e.steps===Gl.SIXTEEN?w`16`:e.steps===Gl.HUNDRED?w`100`:w`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(w`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${w.float(sp)};
      const float dataWidth = ${w.float(sp)};
      const float tileRows = ${w.float(Wd)};
      const vec3 atlasDimensions = vec3(${w.float(Oh)}, ${w.float(Oh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${w.float(kWe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${w.float(BWe)} * p) / ${w.float(sp)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),r.code.add(w`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(w`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(w`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(w`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(w`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),t}const GWe=Ke(),jWe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:kbe,CloudsPassParameters:Ube,build:zWe},Symbol.toStringTag,{value:"Module"}));class W6 extends Br{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){return new Nr(t.rctx,W6.shader.get().build(this.configuration),Or)}initializePipeline(){return Vt({blending:Vp(Ee.CONSTANT_COLOR,Ee.ONE_MINUS_CONSTANT_COLOR,Em.ADD,this.configuration.writeTextureChannels===Xw.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Ni.LEQUAL},colorWrite:Qt})}}W6.shader=new Dr(jWe,()=>ie(()=>import("./Clouds.glsl.bc831959.js"),[]));var Ou;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(Ou||(Ou={}));class EH extends $a{constructor(){super(...arguments),this.mode=Ou.Full}}u([B({count:Ou.COUNT})],EH.prototype,"mode",void 0);class Vbe extends gi{constructor(){super(...arguments),this.weatherTile=Ur(0,0)}}function HWe(e){const t=new Lr;return t.include(ud,!1),t.fragment.code.add(w`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),e.mode===Ou.Full&&t.fragment.code.add(w`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${w.float(Wd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${w.float(8)});

      float worley0 = worley(p, ${w.float(2)} * 2.0);
      float worley1 = worley(p, ${w.float(2)} * 8.0);
      float worley2 = worley(p, ${w.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${w.float(2)});
      float worley1 = worley(p, ${w.float(2)} * 2.0);
      float worley2 = worley(p, ${w.float(2)} * 4.0);
      float worley3 = worley(p, ${w.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.uniforms.add(new kr("weatherTile",r=>r.weatherTile)),t.fragment.code.add(w`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${w.float(w9)});

      // Get global coordinates of p
      p += weatherTile * ${w.float(w9)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${w.float(VWe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(w`void main() {`),e.mode===Ou.Full&&t.fragment.code.add(w`
        float padWidth = 1.0;
        float paddedSize = ${w.float(Oh)} + 2.0 * padWidth;
        float tileCount = ${w.float(Wd)} * ${w.float(Wd)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${w.float(Oh)};
          }

          if (startPadY) {
            pixel.y += ${w.float(Oh)};
          }

          if (endPadX) {
            pixel.x -= ${w.float(Oh)};
          }

          if (endPadY) {
            pixel.y -= ${w.float(Oh)};
          }

          uv = vec2(pixel.xy / ${w.float(Oh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${w.float(Oh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${w.float(Wd)} * ${w.float(Wd)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${w.float(Wd)} * ${w.float(Wd)});
        p = p_;
        p.z /= (${w.float(Wd)} * ${w.float(Wd)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(w`
      vec2 mapUV = ${w.float(w9)} * (gl_FragCoord.xy / ${w.float(sp)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===Ou.Full?w`gl_FragColor.ba = vec2(0.0, map);`:w`gl_FragColor = vec4(map);`};
    }
  `),t}const qWe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Vbe,build:HWe},Symbol.toStringTag,{value:"Module"}));class aM extends Br{initializeProgram(t){return new Nr(t.rctx,aM.shader.get().build(this.configuration),Or)}initializePipeline(){return Vt({blending:this.configuration.mode===Ou.Full?Vp(Ee.ONE,Ee.ZERO):Wn(Ee.ZERO,Ee.ONE,Ee.ONE,Ee.ZERO),depthTest:{func:Ni.ALWAYS},colorWrite:Qt})}}aM.shader=new Dr(qWe,()=>ie(()=>import("./NoiseTextureAtlas.glsl.222ee68d.js"),[]));class S2{constructor(t,r){this._context=t,this._desc=r,this.type="renderbuffer",this._context.instanceCounter.increment(Gn.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==vt.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,r=this._context.parameters.maxSamples;return t?Math.min(t,r):r}resize(t,r){const i=this._desc;if(i.width===t&&i.height===r)return;i.width=t,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Gn.Renderbuffer,this),this._context=Sw(this._context))}}class Li{constructor(t,r,i=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...r},t.instanceCounter.increment(Gn.FramebufferObject,this),v(i)){Array.isArray(i)||(i=[i]);for(let o=0;o<i.length;++o){const a=i[o],l=pu.COLOR_ATTACHMENT0+o;let c;Hse(a)?(Rg(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new lt(this._context,c))),n$(c,this._desc)):(jse(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new S2(this._context,c))),x9(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(v(s)){let o,a;if(Hse(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),Rg(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new lt(this._context,a)),n$(a,this._desc);else{jse(s)?(a=s.descriptor,o=s):(a=s,o=new S2(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:Ir.DEPTH_STENCIL_RENDER_BUFFER;l===Ir.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===Ir.DEPTH_RENDER_BUFFER||l===Ir.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=l,x9(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(Gn.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(pu.COLOR_ATTACHMENT0);return t&&Rg(t)?t:null}get colorAttachment(){return this._colorAttachments.get(pu.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){var t;return(t=this._desc.width)!=null?t:0}get height(){var t;return(t=this._desc.height)!=null?t:0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[r,i])=>t+Ww(i),0)+Ww(this.depthStencilAttachment)}getColorTexture(t){const r=this._colorAttachments.get(t);return r&&Rg(r)?r:null}attachColorTexture(t,r=pu.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(r),n$(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,r)),this._colorAttachments.set(r,t))}detachColorTexture(t=pu.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(t);if(Rg(r)){const i=r;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),i}}setColorTextureTarget(t,r=pu.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);Rg(i)&&this._framebufferTexture2D(i.glName,r,t)}attachDepthStencilTexture(t){if(E(t))return;const r=t.descriptor;r.pixelFormat!==ze.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==$t.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),n$(r,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Ir.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Ir.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,Pse)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Pse)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(E(t))return;const r=t.descriptor;if(r.internalFormat!==Za.DEPTH_STENCIL&&r.internalFormat!==Za.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),x9(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=r.internalFormat===Za.DEPTH_STENCIL?Ir.DEPTH_STENCIL_RENDER_BUFFER:Ir.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._desc.depthStencilTarget===Ir.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(io.FRAMEBUFFER,s,i.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,r=this._depthAttachment;if(r&&this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Ir.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(io.FRAMEBUFFER,i,t.RENDERBUFFER,null)}return this._depthAttachment=null,r}detachAll(){this._colorAttachments.forEach((t,r)=>this._detachColorAttachment(r)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,r,i,s,n,o,a){(t<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==bt.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||(c==null?void 0:c.width)==null||(c==null?void 0:c.height)==null||t+i>l.width||r+s>l.height||n+i>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,lt.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(lt.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(bt.TEXTURE_2D,0,n,o,t,r,i,s),h.bindTexture(p,lt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,r,i,s,n,o,a)}async readPixelsAsync(t,r,i,s,n,o,a){if(this._context.type!==vt.WEBGL2)return gu()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,r,i,s,n,o,a);const l=this._context.gl,c=wr.createPixelPack(this._context,$r.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,r,i,s,n,o,0),this._context.unbindBuffer(Ot.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,r){const i=this._desc;if(i.width!==t||i.height!==r){if(i.width=t,i.height=r,!this._initialized)return this._colorAttachments.forEach(s=>{s&&s.resize(t,r)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,r));this._colorAttachments.forEach(s=>{s&&s.resize(t,r)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,r):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,r),this._stencilAttachment&&this._stencilAttachment.resize(t,r)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=io.FRAMEBUFFER){var h,p,f,m;const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(t,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=this._context,s=r.createFramebuffer(),n=this._desc,o=(h=n.colorTarget)!=null?h:ps.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(f=n.height)!=null?f:1;if(r.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===ps.TEXTURE||o===ps.CUBEMAP)this._colorAttachments.set(pu.COLOR_ATTACHMENT0,WWe(i,n,this.descriptor.colorTarget===ps.CUBEMAP?bt.TEXTURE_CUBE_MAP:bt.TEXTURE_2D));else{const y=new S2(i,{internalFormat:St.RGBA4,width:a,height:l});this._colorAttachments.set(pu.COLOR_ATTACHMENT0,y)}this._colorAttachments.forEach((y,_)=>{y&&(Rg(y)?this._framebufferTexture2D(y.glName,_,qse(y),t):r.framebufferRenderbuffer(t,_,r.RENDERBUFFER,y.glName))});const c=(m=n.depthStencilTarget)!=null?m:Ir.NONE;switch(c){case Ir.DEPTH_RENDER_BUFFER:case Ir.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new S2(i,{internalFormat:n.depthStencilTarget===Ir.DEPTH_RENDER_BUFFER?Za.DEPTH_COMPONENT16:Za.DEPTH_STENCIL,width:a,height:l}));const y=c===Ir.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(t,y,r.RENDERBUFFER,this._depthAttachment.glName);break}case Ir.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new S2(i,{internalFormat:Za.STENCIL_INDEX8,width:a,height:l})),r.framebufferRenderbuffer(t,r.STENCIL_ATTACHMENT,r.RENDERBUFFER,this._stencilAttachment.glName);break;case Ir.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){i.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const y={target:bt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:$t.UNSIGNED_INT_24_8,samplingMode:rt.NEAREST,wrapMode:Rt.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new lt(i,y)}this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,qse(this._depthStencilTexture),t)}gu()&&r.checkFramebufferStatus(t)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,r=pu.COLOR_ATTACHMENT0,i=bt.TEXTURE_2D,s=io.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,t,n)}_detachColorAttachment(t){gu()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const r=this._context.gl,i=this._colorAttachments.get(t);return Rg(i)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(io.FRAMEBUFFER,t,r.RENDERBUFFER,null)),this._colorAttachments.delete(t),i}_disposeColorAttachments(){this._colorAttachments.forEach((t,r)=>{this._detachColorAttachment(r),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Ir.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(io.FRAMEBUFFER,r,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(io.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(Li._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;Li._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else Li._MAX_COLOR_ATTACHMENTS=1}const r=t-pu.COLOR_ATTACHMENT0;r+1>Li._MAX_COLOR_ATTACHMENTS&&ee.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${Li._MAX_COLOR_ATTACHMENTS} color attachments`)}}function Rg(e){return e!=null&&"type"in e&&e.type==="texture"}function jse(e){return e!=null&&"type"in e&&e.type==="renderbuffer"}function Hse(e){return Rg(e)||e!=null&&"pixelFormat"in e}function WWe(e,t,r){return new lt(e,{target:r,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,wrapMode:Rt.CLAMP_TO_EDGE,width:t.width,height:t.height})}function n$(e,t){e.target!==bt.TEXTURE_2D&&e.target!==bt.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function x9(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function qse(e){return e.descriptor.target===bt.TEXTURE_CUBE_MAP?bt.TEXTURE_CUBE_MAP_POSITIVE_X:bt.TEXTURE_2D}Li._MAX_COLOR_ATTACHMENTS=-1;let o3=class extends Te{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Vbe,this._frameBuffer=new Li(e.context.renderContext.rctx,{colorTarget:ps.TEXTURE,width:sp,height:sp},{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR,hasMipmap:!1,width:sp,height:sp}),this._vao=La(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return v(this._texture)?v(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Ou.WeatherMap)):v(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(Ou.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(qn(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Wi(this._fullTechniqueCached),this._weatherMapTechniqueCached=Wi(this._weatherMapTechniqueCached),this._frameBuffer=tt(this._frameBuffer),this._vao=tt(this._vao)}get _fullTechnique(){if(E(this._fullTechniqueCached)){const e=new EH;e.mode=Ou.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(aM,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(E(this._weatherMapTechniqueCached)){const e=new EH;e.mode=Ou.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(aM,e)}return this._weatherMapTechniqueCached}_render(e){if(E(this._vao)||E(this._frameBuffer))return null;const t=e===Ou.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,i=r.getViewport();r.setViewport(0,0,sp,sp),r.bindFramebuffer(this._frameBuffer);const s=r.bindTechnique(t,this._passParameters,null);return r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(i.x,i.y,i.width,i.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([d({constructOnly:!0})],o3.prototype,"context",void 0),u([d({readOnly:!0})],o3.prototype,"_techniqueRepository",null),o3=u([P("esri.views.3d.environment.NoiseTextureAtlas")],o3);function Bbe(e){e.include(Gu),e.uniforms.add([new Mt("geometryDepthTexture",(t,r)=>r.multipassGeometry.linearDepthTexture),new kr("nearFar",(t,r)=>r.camera.nearFar)]),e.code.add(w`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class XWe{constructor(){this.enabled=!1}}function ju(e,t){t.hasMultipassTerrain&&(e.fragment.include(Gu),e.fragment.uniforms.add(new Mt("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new kr("nearFar",(r,i)=>i.camera.nearFar)),e.fragment.uniforms.add(new kr("inverseViewport",(r,i)=>i.inverseViewport)),e.fragment.code.add(w`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class YWe{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function ZWe(e,t){const r=e.fragment;r.include(Gu),r.uniforms.add(new kr("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new Mt("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new Yi("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new Pe("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new Yi("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(w`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class JWe{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=Ie()}}function X6(e){return e?{ray:co(e.ray),c0:e.c0,c1:e.c1}:{ray:co(),c0:0,c1:Number.MAX_VALUE}}function QWe(e,t=X6()){return LF(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function KWe(e,t,r=X6()){const i=Me(e.vector);return Dge(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function O2t(e,t){return zbe(e,e.c0,t)}function M2t(e,t){return zbe(e,e.c1,t)}function zbe(e,t,r){return me(r,e.ray.origin,ae(r,e.ray.direction,t))}new Ry(()=>X6());function lM(e){return e?[jr(e[0]),jr(e[1]),jr(e[2]),jr(e[3]),jr(e[4]),jr(e[5])]:[jr(),jr(),jr(),jr(),jr(),jr()]}function Gbe(){return[M(),M(),M(),M(),M(),M(),M(),M()]}function g4(e,t){for(let r=0;r<vv.NUM;r++)l6(e[r],t[r])}function jbe(e,t,r,i=sXe){const s=ws(iY.get(),t,e);ko(s,s);for(let n=0;n<CH.NUM;++n){const o=Mu(rY.get(),iXe[n],s);ce(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Hbe(r,i)}function Hbe(e,t){_a(t[nt.FAR_BOTTOM_LEFT],t[nt.NEAR_BOTTOM_LEFT],t[nt.NEAR_TOP_LEFT],e[Si.LEFT]),_a(t[nt.NEAR_BOTTOM_RIGHT],t[nt.FAR_BOTTOM_RIGHT],t[nt.FAR_TOP_RIGHT],e[Si.RIGHT]),_a(t[nt.FAR_BOTTOM_LEFT],t[nt.FAR_BOTTOM_RIGHT],t[nt.NEAR_BOTTOM_RIGHT],e[Si.BOTTOM]),_a(t[nt.NEAR_TOP_LEFT],t[nt.NEAR_TOP_RIGHT],t[nt.FAR_TOP_RIGHT],e[Si.TOP]),_a(t[nt.NEAR_BOTTOM_LEFT],t[nt.NEAR_BOTTOM_RIGHT],t[nt.NEAR_TOP_RIGHT],e[Si.NEAR]),_a(t[nt.FAR_BOTTOM_RIGHT],t[nt.FAR_BOTTOM_LEFT],t[nt.FAR_TOP_LEFT],e[Si.FAR])}function H_(e,t){for(let r=0;r<vv.NUM;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function eXe(e,t){return Wbe(e,QWe(t,Xbe.get()))}function P2t(e,t){for(let r=0;r<vv.NUM;r++){const i=e[r];if(!bDe(i,t))return!1}return!0}function tXe(e,t,r){return Wbe(e,KWe(t,r,Xbe.get()))}function qbe(e,t){for(let r=0;r<vv.NUM;r++)if(Ei(e[r],t)>0)return!1;return!0}function Wbe(e,t){for(let r=0;r<vv.NUM;r++)if(!vDe(e[r],t))return!1;return!0}var Si,nt;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(Si||(Si={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(nt||(nt={}));const rXe={bottom:[nt.FAR_BOTTOM_RIGHT,nt.NEAR_BOTTOM_RIGHT,nt.NEAR_BOTTOM_LEFT,nt.FAR_BOTTOM_LEFT],near:[nt.NEAR_BOTTOM_LEFT,nt.NEAR_BOTTOM_RIGHT,nt.NEAR_TOP_RIGHT,nt.NEAR_TOP_LEFT],far:[nt.FAR_BOTTOM_RIGHT,nt.FAR_BOTTOM_LEFT,nt.FAR_TOP_LEFT,nt.FAR_TOP_RIGHT],right:[nt.NEAR_BOTTOM_RIGHT,nt.FAR_BOTTOM_RIGHT,nt.FAR_TOP_RIGHT,nt.NEAR_TOP_RIGHT],left:[nt.FAR_BOTTOM_LEFT,nt.NEAR_BOTTOM_LEFT,nt.NEAR_TOP_LEFT,nt.FAR_TOP_LEFT],top:[nt.FAR_TOP_LEFT,nt.NEAR_TOP_LEFT,nt.NEAR_TOP_RIGHT,nt.FAR_TOP_RIGHT]};var vv,CH;(function(e){e[e.NUM=6]="NUM"})(vv||(vv={})),function(e){e[e.NUM=8]="NUM"}(CH||(CH={}));const iXe=[Ht(-1,-1,-1,1),Ht(1,-1,-1,1),Ht(1,1,-1,1),Ht(-1,1,-1,1),Ht(-1,-1,1,1),Ht(1,-1,1,1),Ht(1,1,1,1),Ht(-1,1,1,1)],Xbe=new Ry(X6),sXe=Gbe();function nXe(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}function oXe(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}function aXe(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function lXe(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}var AH;let Ct=AH=class extends Te{constructor(e={}){super(e),this._center=M(),this._up=M(),this._viewUp=M(),this._viewForward=M(),this._viewRight=M(),this._ray=co(),this._viewport=Ht(0,0,1,1),this._padding=Ht(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Ur(1,1e3),this._viewDirty=!0,this._viewMatrix=Ie(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ie(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ie(),this._frustumDirty=!0,this._frustum=lM(),this._fullViewport=sr(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return ge(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Hn(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const e=uC(sr(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&vW(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[lr.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[lr.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[lr.RIGHT]+this._padding[lr.LEFT]}set fullWidth(e){this.width=e-(this._padding[lr.RIGHT]+this._padding[lr.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[lr.TOP]+this._padding[lr.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[lr.TOP]+this._padding[lr.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[lr.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[lr.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){mS(this._padding,e)||(this._viewport[0]+=e[lr.LEFT]-this._padding[lr.LEFT],this._viewport[1]+=e[lr.BOTTOM]-this._padding[lr.BOTTOM],this._viewport[2]-=e[lr.RIGHT]+e[lr.LEFT]-(this._padding[lr.RIGHT]+this._padding[lr.LEFT]),this._viewport[3]-=e[lr.TOP]+e[lr.BOTTOM]-(this._padding[lr.TOP]+this._padding[lr.BOTTOM]),cp(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(ws(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=Fme(Ie(),-i*(1+2*this._padding[lr.LEFT]/e),i*(1+2*this._padding[lr.RIGHT]/e),-r*(1+2*this._padding[lr.BOTTOM]/t),r*(1+2*this._padding[lr.TOP]/t),this.near,this.far),n=this._get("projectionMatrix");return n&&jX(n,s)?n:s}get inverseProjectionMatrix(){return ko(Ie(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||Ie()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return aXe(this._fov,this.width,this.height)}set fovX(e){this._fov=nXe(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return lXe(this._fov,this.width,this.height)}set fovY(e){this._fov=oXe(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Ai(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(ko(this._viewInverseTransposeMatrix,this.viewMatrix),kc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(e){le(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,cp(this._viewport,e.viewport),this.notifyChange("_viewport"),cp(this._padding,e.padding),this.notifyChange("_padding"),qn(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Hn(this._viewMatrix,e.viewMatrix),le(this._viewRight,e.viewRight),le(this._viewUp,e.viewUp),le(this._viewForward,e.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(g4(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Hn(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),cp(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return new AH().copyFrom(this)}equals(e){return el(this.eye,e.eye)&&el(this.center,e.center)&&el(this.up,e.up)&&mS(this._viewport,e.viewport)&&mS(this._padding,e.padding)&&abe(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(Math.abs(e.fov-this._fov)>=.001||eF(e.padding,this._padding)>=.5||eF(this.screenViewport,e.screenViewport)>=.5)return!1;lo(ua,e.eye,e.center),lo(T9,this.eye,this.center);const t=_e(ua,T9),r=GB(ua),i=GB(T9),s=5e-4;return t*t>=(1-1e-10)*r*i&&mW(e.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs(k3(this.viewForward,ge(ua,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=ds()){return e[0]=(this.padding[lr.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[lr.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[lr.LEFT]+this.width*t,e[1]=this.padding[lr.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==ar&&le(ar,e),ar[3]=1,Mu(ar,ar,this.projectionMatrix);const r=Math.abs(ar[3]);ae(ar,ar,1/r);const i=this.fullViewport;t[0]=Nt(0,i[0]+i[2],.5+.5*ar[0]),t[1]=Nt(0,i[1]+i[3],.5+.5*ar[1]),t[2]=.5*(ar[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;ar[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],ar[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],ar[2]=(2*e[2]-1)*e[3],ar[3]=e[3],this.inverseProjectionMatrix!=null&&(Mu(ar,ar,this.inverseProjectionMatrix),t[0]=ar[0],t[1]=ar[1],t[2]=ar[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,S9),this.renderToScreen(S9,t),t}projectToRenderScreen(e,t){if(ar[0]=e[0],ar[1]=e[1],ar[2]=e[2],ar[3]=1,Mu(ar,ar,this.viewProjectionMatrix),ar[3]===0)return null;ae(ar,ar,1/Math.abs(ar[3]));const r=this.fullViewport;return"x"in t?(t.x=Nt(0,r[0]+r[2],.5+.5*ar[0]),t.y=Nt(0,r[1]+r[3],.5+.5*ar[1])):(t[0]=Nt(0,r[0]+r[2],.5+.5*ar[0]),t[1]=Nt(0,r[1]+r[3],.5+.5*ar[1]),t.length>2&&(t[2]=.5*(ar[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,S9),t)}unprojectFromRenderScreen(e,t){if(ws(o$,this.projectionMatrix,this.viewMatrix),!ko(o$,o$))return null;const r=this.fullViewport;return ar[0]=2*(e[0]-r[0])/r[2]-1,ar[1]=2*(e[1]-r[1])/r[3]-1,ar[2]=2*e[2]-1,ar[3]=1,Mu(ar,ar,o$),ar[3]===0?null:(t[0]=ar[0]/ar[3],t[1]=ar[1]/ar[3],t[2]=ar[2]/ar[3],t)}constrainWindowSize(e,t,r,i){const s=e*this.pixelRatio,n=t*this.pixelRatio,o=Math.max(s-r/2,0),a=Math.max(this.fullHeight-n-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-n-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(n-i/2,0)]}computeUp(e){e===Ge.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){ge(ua,this.center,this.eye);const e=Me(this.center);e<1?(ce(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(_e(ua,this.center))>.9999*Me(ua)*e||(dt(this._up,ua,this.center),dt(this._up,this._up,ua),ve(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Cy(ua,this.eye,this.center),Math.abs(ua[2])<=.9999&&(ae(ua,ua,ua[2]),ce(this._up,-ua[0],-ua[1],1-ua[2]),ve(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,r=""){typeof e[0]=="number"&&isFinite(e[0])&&typeof e[1]=="number"&&isFinite(e[1])&&typeof e[2]=="number"&&isFinite(e[2])?el(e,t)||(le(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):ee.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(jbe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(r6(this._viewMatrix,this.eye,this.center,this.up),ce(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ce(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ce(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};u([d()],Ct.prototype,"_center",void 0),u([d()],Ct.prototype,"_up",void 0),u([d()],Ct.prototype,"_viewport",void 0),u([d()],Ct.prototype,"_padding",void 0),u([d()],Ct.prototype,"_fov",void 0),u([d()],Ct.prototype,"_nearFar",void 0),u([d()],Ct.prototype,"_pixelRatio",void 0),u([d()],Ct.prototype,"pixelRatio",null),u([d()],Ct.prototype,"eye",null),u([d()],Ct.prototype,"center",null),u([d()],Ct.prototype,"up",null),u([d({readOnly:!0})],Ct.prototype,"nearFar",null),u([d()],Ct.prototype,"near",null),u([d()],Ct.prototype,"far",null),u([d()],Ct.prototype,"viewport",null),u([d({readOnly:!0})],Ct.prototype,"screenViewport",null),u([d()],Ct.prototype,"x",null),u([d()],Ct.prototype,"y",null),u([d()],Ct.prototype,"width",null),u([d()],Ct.prototype,"height",null),u([d()],Ct.prototype,"fullWidth",null),u([d()],Ct.prototype,"fullHeight",null),u([d({readOnly:!0})],Ct.prototype,"_aspect",null),u([d()],Ct.prototype,"padding",null),u([d({readOnly:!0})],Ct.prototype,"projectionMatrix",null),u([d({readOnly:!0})],Ct.prototype,"inverseProjectionMatrix",null),u([d()],Ct.prototype,"fov",null),u([d()],Ct.prototype,"fovX",null),u([d()],Ct.prototype,"fovY",null),Ct=AH=u([P("esri.views.3d.webgl-engine.lib.Camera")],Ct);const ar=sr(),o$=Ie(),ua=M(),T9=M(),S9=ta();var lr;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(lr||(lr={}));var Se;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Se||(Se={}));var xt;(function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"})(xt||(xt={}));class eJ{constructor(t=M()){this.intensity=t}}class Ybe{constructor(t=M(),r=Le(.57735,.57735,.57735)){this.intensity=t,this.direction=r}}class y4{constructor(t=M(),r=Le(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=t,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}}class Zbe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function cXe(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function E9(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function IS(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function Jbe(e){return(e+1)*(e+1)}function uXe(e){return ye(Math.floor(Math.sqrt(e)-1),0,2)}function Qbe(e,t,r){const i=e[0],s=e[1],n=e[2],o=r||[];return o.length=Jbe(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function hXe(e,t){const r=Jbe(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function dXe(e,t){const r=uXe(t.r.length);for(const i of e)Ea(RH,i.direction),Qbe(RH,r,qg),cXe(qg,dN),E9(qg,i.intensity[0],zx),IS(t.r,zx),E9(qg,i.intensity[1],zx),IS(t.g,zx),E9(qg,i.intensity[2],zx),IS(t.b,zx);return t}function pXe(e,t){Qbe(RH,0,qg);for(const r of e)t.r[0]+=qg[0]*dN[0]*r.intensity[0]*4*Math.PI,t.g[0]+=qg[0]*dN[0]*r.intensity[1]*4*Math.PI,t.b[0]+=qg[0]*dN[0]*r.intensity[2]*4*Math.PI;return t}function fXe(e,t,r,i){hXe(t,i),ce(r.intensity,0,0,0);let s=!1;const n=mXe,o=gXe,a=yXe;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof y4&&!s?(le(r.direction,l.direction),le(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof y4||l instanceof Ybe?n.push(l):l instanceof eJ?o.push(l):l instanceof Zbe&&a.push(l);dXe(n,i),pXe(o,i);for(const l of a)IS(i.r,l.r),IS(i.g,l.g),IS(i.b,l.b)}const mXe=[],gXe=[],yXe=[],qg=[0],zx=[0],RH=M(),dN=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class Wse{constructor(){this.color=M(),this.intensity=1}}class _Xe{constructor(){this.direction=M(),this.ambient=new Wse,this.diffuse=new Wse}}const Kbe=.4;class C9{constructor(){this._shOrder=2,this._legacy=new _Xe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new Zbe,this._mainLight=new y4(M(),Le(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(t){fXe(t,this._shOrder,this._mainLight,this._sphericalHarmonics),le(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,ae(this._legacy.diffuse.color,this._mainLight.intensity,r),le(a$,this._legacy.diffuse.color),ae(a$,a$,Kbe*this.globalFactor),me(this._legacy.ambient.color,this._legacy.ambient.color,a$)}copyFrom(t){this._sphericalHarmonics.r=Array.from(t.sh.r),this._sphericalHarmonics.g=Array.from(t.sh.g),this._sphericalHarmonics.b=Array.from(t.sh.b),this._mainLight.direction=bs(t.mainLight.direction),this._mainLight.intensity=bs(t.mainLight.intensity),this._mainLight.castShadows=t.mainLight.castShadows,this._mainLight.specularStrength=t.mainLight.specularStrength,this._mainLight.environmentStrength=t.mainLight.environmentStrength,this.globalFactor=t.globalFactor,this.noonFactor=t.noonFactor}lerpLighting(t,r,i){if(rn(this._mainLight.intensity,t.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=Nt(t.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=Nt(t.mainLight.specularStrength,r.mainLight.specularStrength,i),le(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=Nt(t.globalFactor,r.globalFactor,i),this.noonFactor=Nt(t.noonFactor,r.noonFactor,i),t.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=Nt(t.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=Nt(t.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=Nt(t.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}}const a$=M();class Y6{constructor(t,r,i){this.shadowMap=t,this.ssaoHelper=r,this.slicePlane=i,this.slot=Se.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=xt.NONE,this._camera=new Ct,this._inverseViewport=Ke(),this.oldLighting=new C9,this.newLighting=new C9,this._fadedLighting=new C9,this._lighting=this.newLighting,this.ssr=new JWe,this.multipassTerrain=new YWe,this.multipassGeometry=new XWe,this.overlays=[],this.cloudsFade=new mWe}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(t){const{oldLighting:r,newLighting:i}=this;t>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,t),this._lighting=this._fadedLighting)}}let Rl=class extends Te{constructor(e){super(e),this._handles=new Jr,this._techniques=new Array,this._techniqueConfiguration=new hN,this._bindParameters=new Y6(null,null,null),this._passParameters=new Ube,this._drawParameters=new kbe,this._weatherTile=Ke(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Nt(ma.default.coverage[0],ma.default.coverage[1],.5),this.density=Nt(ma.default.density[0],ma.default.density[1],.5),this.absorption=Nt(ma.default.absorption[0],ma.default.absorption[1],.5),this.cloudSize=Nt(ma.default.cloudSize[0],ma.default.cloudSize[1],.5),this.detailSize=Nt(ma.default.detailSize[0],ma.default.detailSize[1],.5),this.smoothness=Nt(ma.default.smoothness[0],ma.default.smoothness[1],.5),this.cloudHeight=Nt(ma.default.cloudHeight[0],ma.default.cloudHeight[1],.5),this.raymarchingSteps=ma.default.raymarchingSteps,this._viewMatrix=Ie(),this._dirty=!1,this.running=!1}_getTechnique(e){const t=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=t===Xw.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=t,this._techniqueConfiguration.steps=e,this._techniques[r]=new W6({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){var n;const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;if(e==null||t==null)return;or(this._weatherTile,(e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let i=0,s=0;if(v(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&v(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+((n=this.view.environment.lighting.displayUTCOffset)!=null?n:0)),i=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+i)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),lbe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=La(this.context.renderContext.rctx);const e=Zr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(gt.CLOUDS_GENERATOR,this),se(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),kt)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Wi(e)),this._frameBufferCube=tt(this._frameBufferCube),this._techniques.length=0,this._vao=tt(this._vao),this._passParameters.noiseTexture=Ve(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Gl.SIXTEEN:return 1;case Gl.HUNDRED:return 4;case Gl.COUNT:case Gl.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(v(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new o3({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return v(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(E(this._frameBufferCube)){const t={target:bt.TEXTURE_CUBE_MAP,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new Li(this.context.renderContext.rctx,{colorTarget:ps.CUBEMAP,width:e,height:e},t)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=tt(this._frameBufferCube)}applyPreset(e,t){const r=e.median,i=s=>{const n=Nt(s[0],s[1],r);return t<.5?Nt(s[0],n,2*t):Nt(n,s[1],2*(t-.5))};this.coverage=i(e.coverage),this.density=i(e.density),this.absorption=i(e.absorption),this.cloudSize=i(e.cloudSize),this.detailSize=i(e.detailSize),this.smoothness=i(e.smoothness),this.cloudHeight=i(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(E(this._vao))return this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Ns.FINISHED_RENDERING,void e.madeProgress();this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),qn(this._passParameters.weatherTile,this._weatherTile));const t=this._getTechnique(this._passParameters.raymarchingSteps);if(!t.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return na.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Ns.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,i=r.bindTechnique(t,this._passParameters,this._bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao);const s=r.getViewport(),n=t.configuration.cubeMapSize,o=n/this._tilesPerFace,a=this._tileIndex*o;r.setViewport(0,a,n,o);const l=this._ensureFrameBufferCube(n);r.bindFramebuffer(l);const c=vXe[this._faceIndex],h=bXe[this._faceIndex];kme(this._viewMatrix,wXe,c,h),id(this._drawParameters.viewMatrix,this._viewMatrix);const p=bt.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return l.setColorTextureTarget(p),i.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Ns.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),na.YIELD}};u([d({constructOnly:!0})],Rl.prototype,"context",void 0),u([d({constructOnly:!0})],Rl.prototype,"view",void 0),u([d({constructOnly:!0})],Rl.prototype,"requestRender",void 0),u([d()],Rl.prototype,"coverage",void 0),u([d()],Rl.prototype,"density",void 0),u([d()],Rl.prototype,"absorption",void 0),u([d()],Rl.prototype,"cloudSize",void 0),u([d()],Rl.prototype,"detailSize",void 0),u([d()],Rl.prototype,"smoothness",void 0),u([d()],Rl.prototype,"cloudHeight",void 0),u([d()],Rl.prototype,"raymarchingSteps",void 0),u([d()],Rl.prototype,"running",void 0),Rl=u([P("esri.views.3d.environment.CloudsGenerator")],Rl);const vXe=[Yr(1,0,0),Yr(-1,0,0),Yr(0,1,0),Yr(0,-1,0),Yr(0,0,1)],bXe=[Yr(0,1,0),Yr(0,1,0),Yr(0,0,-1),Yr(0,0,1),Yr(0,1,0)],wXe=zZ();class tJ extends gi{constructor(){super(...arguments),this.fogColor=M(),this.hazeColor=M(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1,this.fogAmount=0,this.hazeAmount=0}}function xXe(e){const t=new Lr;t.attributes.add(A.POSITION,"vec2"),t.include(um,{textureCoordinateType:Js.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=t;return r.uniforms.add([new Yi("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Yi("inverseViewMatrix",(s,n)=>vC(TXe,n.camera.viewMatrix))]),r.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Pe("atmosphereC",s=>s.atmosphereC)),i.uniforms.add(new qt("cameraPosition",(s,n)=>n.camera.eye)),i.uniforms.add(new kr("nearFar",(s,n)=>n.camera.nearFar)),i.uniforms.add(new Mt("depthTex",s=>s.depthTexture)),i.uniforms.add(new Pe("fogStrength",s=>e.haze?s.hazeStrength:s.fogStrength)),i.uniforms.add(new Pe("fogAmount",s=>e.haze?s.hazeAmount:s.fogAmount)),i.uniforms.add(new qt("fogColor",s=>e.haze?s.hazeColor:s.fogColor)),t.include(G6),i.include(Gu),i.code.add(w`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(w`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(w`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?w`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const TXe=Ie(),ewe=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:tJ,build:xXe},Symbol.toStringTag,{value:"Module"}));class Z6 extends Br{initializeProgram(t){return new Nr(t.rctx,Z6.shader.get().build(this.configuration),Or)}initializePipeline(){return this.configuration.haze?Vt({blending:Wn(Ee.ONE,Ee.ZERO,Ee.ONE_MINUS_SRC_COLOR,Ee.ONE),colorWrite:Qt}):Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ZERO,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE),colorWrite:Qt})}}Z6.shader=new Dr(ewe,()=>ie(()=>import("./FogHaze.glsl.17d5ef31.js"),[]));class rJ extends $a{constructor(){super(...arguments),this.haze=!1}}u([B()],rJ.prototype,"haze",void 0);const SXe=.95,EXe=1;let a3=class extends Te{constructor(e){super(e),this._passParameters=new tJ;const t=e.context.renderContext.rctx;this._vao=La(t,$C),this._technique=e.context.techniqueRepository.acquire(Z6,new rJ);const r=Zr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+iM}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,t){if(this._update(e,t),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const i=e.offscreenRenderingHelper;i.renderDepthDetached(()=>{this._passParameters.depthTexture=i.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,t){const r=t.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(It.TRIANGLE_STRIP,0,4)}_update(e,t){const r=e.bindParameters.camera;ve(Xse,r.eye);const i=Math.max(0,_e(Xse,e.bindParameters.lighting.mainLight.direction)),s=t.color;ae(Yse,s,.1),rn(this._passParameters.fogColor,Yse,s,i);const n=Me(r.eye),o=n*n;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-QS(SXe*Rh,EXe*Rh,Math.abs(n-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],a3.prototype,"context",void 0),u([d({constructOnly:!0})],a3.prototype,"view",void 0),a3=u([P("esri.views.3d.environment.Fog")],a3);class CXe{constructor(){this.color=M(),this.strength=0,this.amount=0}}const Xse=M(),Yse=M();class ao extends $a{constructor(){super(...arguments),this.hasWebGL2Context=!1}}u([B({constValue:!0})],ao.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],ao.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],ao.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!1})],ao.prototype,"useLegacyTerrainShading",void 0),u([B({constValue:!1})],ao.prototype,"hasModelTransformation",void 0),u([B({constValue:fi.Pass})],ao.prototype,"pbrTextureBindType",void 0),u([B()],ao.prototype,"hasWebGL2Context",void 0);var Cm;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(Cm||(Cm={}));class iJ extends ao{constructor(){super(...arguments),this.geometry=Cm.Cone}}u([B({count:Cm.COUNT})],iJ.prototype,"geometry",void 0);var k;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.ShadowHighlight=4]="ShadowHighlight",e[e.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",e[e.Highlight=6]="Highlight",e[e.Alpha=7]="Alpha",e[e.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",e[e.COUNT=9]="COUNT"})(k||(k={}));function NP(e){e.attributes.add(A.POSITION,"vec3"),e.vertex.code.add(w`vec3 positionModel() { return position; }`)}function _4({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(w`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(w`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}class Fm extends Es{constructor(t,r){super(t,"mat3",fi.Pass,(i,s,n)=>i.setUniformMatrix3fv(t,r(s,n)))}}function $S(e,t){e.include(NP);const r=e.vertex;r.include(_4,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add([new qt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new qt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Fm("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Yi("transformProjFromView",i=>i.transformProjFromView),new oM("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Nu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Nu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)]),r.code.add(w`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(w`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?w`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:w`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new qt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(w`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(w`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class twe extends gi{constructor(){super(...arguments),this.transformWorldFromViewTH=M(),this.transformWorldFromViewTL=M(),this.transformViewFromCameraRelativeRS=ns(),this.transformProjFromView=Ie()}}class rwe extends gi{constructor(){super(...arguments),this.transformWorldFromModelRS=ns(),this.transformWorldFromModelTH=qi(),this.transformWorldFromModelTL=qi()}}function bv(e){e.varyings.add("linearDepth","float")}function Yw(e){e.vertex.uniforms.add(new kr("nearFar",(t,r)=>r.camera.nearFar))}function J6(e){e.vertex.code.add(w`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function LC(e,t){const{vertex:r}=e;switch(t.output){case k.Color:if(t.receiveShadows)return bv(e),void r.code.add(w`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case k.Depth:case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:return e.include($S,t),bv(e),Yw(e),J6(e),void r.code.add(w`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(w`void forwardLinearDepth() {}`)}function jl(e,t){if(J6(e),t.hasModelTransformation)return e.vertex.code.add(w`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void e.vertex.code.add(w`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);e.vertex.code.add(w`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(w`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class sJ extends gi{constructor(){super(...arguments),this.texV=Ke(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new iwe}}class iwe{constructor(){this.center=M(),this.v1=M(),this.v2=M()}}function AXe(e){const t=new Lr,{vertex:r,fragment:i}=t;if(Py(r),e.geometry===Cm.Underground)t.attributes.add(A.POSITION,"vec2"),t.varyings.add("color","vec4"),r.uniforms.add([new qt("cameraPosition",(s,n)=>n.camera.eye),new Pe("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)]),r.code.add(w`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(w`void main() {
gl_FragColor = color;
}`);else{t.include(jl,e),t.attributes.add(A.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===Cm.Cylinder;r.uniforms.add([new Yi("proj",(a,l)=>l.camera.projectionMatrix),new Yi("view",(a,l)=>l.camera.viewMatrix)]),s||(t.varyings.add("innerFactor","float"),r.uniforms.add(new qt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new qt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new qt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new kr("texV",a=>a.texV)),r.uniforms.add(new Pe("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(w`
		void main(void) {
      ${s?w`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:w`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${w.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${w.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Mt("tex",a=>a.texture)),s||i.uniforms.add(new Pe("altitudeFade",a=>a.altitudeFade)),i.code.add(w`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?w`gl_FragColor = atmosphereColor;`:w`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const RXe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:iwe,SimpleAtmospherePassParameters:sJ,build:AXe},Symbol.toStringTag,{value:"Module"}));class VE extends Br{initializeProgram(t){return new Nr(t.rctx,VE.shader.get().build(this.configuration),Or)}initializePipeline(){return this.configuration.geometry===Cm.Cylinder?Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),culling:UZ,depthTest:{func:Ni.LEQUAL},colorWrite:Qt}):Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ni.LEQUAL},colorWrite:Qt})}}VE.shader=new Dr(RXe,()=>ie(()=>import("./SimpleAtmosphere.glsl.eeeccd34.js"),[]));const swe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Hc(e,t=0){const r=e.stride;return e.fieldNames.filter(i=>{const s=e.fields.get(i).optional;return!(s&&s.glPadding)}).map(i=>{const s=e.fields.get(i),n=s.constructor.ElementCount,o=OXe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new Vo(i,n,o,a,r,l,t)})}function OXe(e){const t=MXe[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const MXe={u8:at.UNSIGNED_BYTE,u16:at.UNSIGNED_SHORT,u32:at.UNSIGNED_INT,i8:at.BYTE,i16:at.SHORT,i32:at.INT,f32:at.FLOAT};class nJ{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}nJ.ElementCount=9;class oJ{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}oJ.ElementCount=16;class Ly{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,r){this.typedBuffer[t*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}}Ly.ElementCount=1;class Dy{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,or(r,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t]=r[1]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Dy.ElementCount=2;class Ny{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,ce(r,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t]=r[2]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,s){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t]=s}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Ny.ElementCount=3;class Fy{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,ti(r,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t++]=r[2],this.typedBuffer[t]=r[3]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Fy.ElementCount=4;class FP extends Ly{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}static fromTypedArray(t,r){return new FP(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}FP.ElementType="f32";class nd extends Dy{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(nd,t,r)}static fromTypedArray(t,r){return new nd(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}nd.ElementType="f32";class mi extends Ny{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(mi,t,r)}static fromTypedArray(t,r){return new mi(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}mi.ElementType="f32";class Ma extends Fy{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Ma,t,r)}static fromTypedArray(t,r){return new Ma(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Ma.ElementType="f32";class Np extends nJ{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Np,t,r)}static fromTypedArray(t,r){return new Np(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Np.ElementType="f32";class BE extends nJ{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(BE,t,r)}static fromTypedArray(t,r){return new BE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}BE.ElementType="f64";class zE extends oJ{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(zE,t,r)}static fromTypedArray(t,r){return new zE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}zE.ElementType="f32";class wv extends oJ{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(wv,t,r)}static fromTypedArray(t,r){return new wv(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}wv.ElementType="f64";class GE extends Ly{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(GE,t,r)}static fromTypedArray(t,r){return new GE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}GE.ElementType="f64";class jE extends Dy{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(jE,t,r)}static fromTypedArray(t,r){return new jE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}jE.ElementType="f64";class yo extends Ny{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(yo,t,r)}static fromTypedArray(t,r){return new yo(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}yo.ElementType="f64";class Zw extends Fy{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(Zw,t,r)}static fromTypedArray(t,r){return new Zw(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Zw.ElementType="f64";class wy extends Ly{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(wy,t,r)}static fromTypedArray(t,r){return new wy(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}wy.ElementType="u8";class Jw extends Dy{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(Jw,t,r)}static fromTypedArray(t,r){return new Jw(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Jw.ElementType="u8";class xv extends Ny{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(xv,t,r)}static fromTypedArray(t,r){return new xv(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}xv.ElementType="u8";class _o extends Fy{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(_o,t,r)}static fromTypedArray(t,r){return new _o(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}_o.ElementType="u8";class Qw extends Ly{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(Qw,t,r)}static fromTypedArray(t,r){return new Qw(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Qw.ElementType="u16";class HE extends Dy{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(HE,t,r)}static fromTypedArray(t,r){return new HE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}HE.ElementType="u16";class Kw extends Ny{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(Kw,t,r)}static fromTypedArray(t,r){return new Kw(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Kw.ElementType="u16";class Tv extends Fy{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(Tv,t,r)}static fromTypedArray(t,r){return new Tv(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Tv.ElementType="u16";class ex extends Ly{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(ex,t,r)}static fromTypedArray(t,r){return new ex(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ex.ElementType="u32";class qE extends Dy{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(qE,t,r)}static fromTypedArray(t,r){return new qE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}qE.ElementType="u32";class cM extends Ny{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(cM,t,r)}static fromTypedArray(t,r){return new cM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}cM.ElementType="u32";class uM extends Fy{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(uM,t,r)}static fromTypedArray(t,r){return new uM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}uM.ElementType="u32";class WE extends Ly{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(WE,t,r)}static fromTypedArray(t,r){return new WE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}WE.ElementType="i8";class tx extends Dy{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(tx,t,r)}static fromTypedArray(t,r){return new tx(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}tx.ElementType="i8";class hM extends Ny{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(hM,t,r)}static fromTypedArray(t,r){return new hM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}hM.ElementType="i8";class dM extends Fy{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(dM,t,r)}static fromTypedArray(t,r){return new dM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}dM.ElementType="i8";class pM extends Ly{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(pM,t,r)}static fromTypedArray(t,r){return new pM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}pM.ElementType="i16";class rx extends Dy{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(rx,t,r)}static fromTypedArray(t,r){return new rx(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}rx.ElementType="i16";class fM extends Ny{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(fM,t,r)}static fromTypedArray(t,r){return new fM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}fM.ElementType="i16";class mM extends Fy{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(mM,t,r)}static fromTypedArray(t,r){return new mM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}mM.ElementType="i16";class gM extends Ly{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(gM,t,r)}static fromTypedArray(t,r){return new gM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}gM.ElementType="i32";class yM extends Dy{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(yM,t,r)}static fromTypedArray(t,r){return new yM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}yM.ElementType="i32";class _M extends Ny{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(_M,t,r)}static fromTypedArray(t,r){return new _M(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}_M.ElementType="i32";class vM extends Fy{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(vM,t,r)}static fromTypedArray(t,r){return new vM(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}vM.ElementType="i32";function nwe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function PXe(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function IXe(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function $Xe(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}class v4{constructor(t,r){this.layout=t,this.buffer=typeof r=="number"?new ArrayBuffer(r*t.stride):r;for(const i of t.fieldNames){const s=t.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,r){const i=this[t];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(t,r){return new v4(this.layout,this.buffer.slice(t*this.stride,r*this.stride))}copyFrom(t,r,i,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}}}class aJ{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,r){return this._appendField(t,nd,r),this}vec2f64(t,r){return this._appendField(t,jE,r),this}vec3f(t,r){return this._appendField(t,mi,r),this}vec3f64(t,r){return this._appendField(t,yo,r),this}vec4f(t,r){return this._appendField(t,Ma,r),this}vec4f64(t,r){return this._appendField(t,Zw,r),this}mat3f(t,r){return this._appendField(t,Np,r),this}mat3f64(t,r){return this._appendField(t,BE,r),this}mat4f(t,r){return this._appendField(t,zE,r),this}mat4f64(t,r){return this._appendField(t,wv,r),this}vec4u8(t,r){return this._appendField(t,_o,r),this}f32(t,r){return this._appendField(t,FP,r),this}f64(t,r){return this._appendField(t,GE,r),this}u8(t,r){return this._appendField(t,wy,r),this}u16(t,r){return this._appendField(t,Qw,r),this}i8(t,r){return this._appendField(t,WE,r),this}vec2i8(t,r){return this._appendField(t,tx,r),this}vec2i16(t,r){return this._appendField(t,rx,r),this}vec2u8(t,r){return this._appendField(t,Jw,r),this}vec4u16(t,r){return this._appendField(t,Tv,r),this}u32(t,r){return this._appendField(t,ex,r),this}_appendField(t,r,i){const s=r.ElementCount*nwe(r.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:r,offset:n,optional:i}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new v4(this,t)}createView(t){return new v4(this,t)}clone(){const t=new aJ;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((r,i)=>t.fields.set(i,r)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function os(){return new aJ}class Je{constructor(t,r,i=!1,s=r){this.data=t,this.size=r,this.exclusive=i,this.stride=s}}var OH;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function r(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=r,e.scale=i,e.add=s,e.subtract=n})(OH||(OH={}));var Fs;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"})(Fs||(Fs={}));function Bc(e,t=!1){return e<=fm?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function LXe(e){return length<=fm?Array.from(e):new Float64Array(e)}function qh(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}function Qs(e,t=!1){return e<=fm?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function Zse(e){return length<=fm?Array.from(e):new Float32Array(e)}function Jse(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}function DXe(e){if(e.length<fm)return Array.from(e);if(Array.isArray(e))return Float64Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return Uint16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}const ka=sr();class NXe{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function mt(e,t){if(!e){t=t||"Assertion";const r=new Error(t).stack;throw new NXe(`${t} at ${r}`)}}function Gx(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function Qse(e,t,r,i){let s,n=(r[0]-e[0])/t[0],o=(i[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-e[2])/t[2],h=(i[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function l$(e,t,r,i,s,n=Ke()){const o=(i[s]-r[s])*(t[0]-e[0])-(i[0]-r[0])*(t[s]-e[s]),a=(i[0]-r[0])*(e[s]-r[s])-(i[s]-r[s])*(e[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function Kse(e,t,r,i,s){ka[0]=e[0],ka[1]=e[1],ka[2]=e[2],ka[3]=1,Mu(ka,ka,t),s.length>2&&(s[2]=-ka[2]),Mu(ka,ka,r),mt(ka[3]!==0),s[0]=ka[0]/ka[3],s[1]=ka[1]/ka[3],s[2]=ka[2]/ka[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function FXe(e,t){return Math.log(e)/Math.log(t)}function UXe(e,t,r,i){e[12]=t,e[13]=r,e[14]=i}function owe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}class Q6{constructor(t,r,i,s){this.primitiveIndices=t,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this._children=void 0,mt(t.length>=1),mt(i.length%this._numIndexPerPrimitive==0),mt(i.length>=t.length*this._numIndexPerPrimitive),mt(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*i[this._numIndexPerPrimitive*t[0]];t1.clear(),t1.push(l);const c=Le(n[l],n[l+1],n[l+2]),h=bs(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*t[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[y+_],t1.push(l);let b=n[l];c[0]=Math.min(b,c[0]),h[0]=Math.max(b,h[0]),b=n[l+1],c[1]=Math.min(b,c[1]),h[1]=Math.max(b,h[1]),b=n[l+2],c[2]=Math.min(b,c[2]),h[2]=Math.max(b,h[2])}}this.bbMin=c,this.bbMax=h;const p=rn(M(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-c[0],h[1]-c[1]),h[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<t1.length;++m){l=t1.getItemAt(m);const y=n[l]-p[0],_=n[l+1]-p[1],b=n[l+2]-p[2],x=y*y+_*_+b*b;if(x<=f)continue;const T=Math.sqrt(x),S=.5*(T-this.radius);this.radius=this.radius+S,f=this.radius*this.radius;const C=S/T;p[0]+=y*C,p[1]+=_*C,p[2]+=b*C}this.center=p,t1.clear()}getChildren(){if(this._children||jn(this.bbMin,this.bbMax)<=1)return this._children;const t=rn(M(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],_=n[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*this.indices[p+b];const x=n[f],T=n[f+1],S=n[f+2];x<m&&(m=x),T<y&&(y=T),S<_&&(_=S)}m<t[0]&&(h|=1),y<t[1]&&(h|=2),_<t[2]&&(h|=4),i[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const h=i[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new Q6(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){t1.prune()}}const t1=new Jt({deallocator:null});class UP{constructor(){this.id=Lc()}unload(){}}function kXe(e){return e?{p0:bs(e.p0),p1:bs(e.p1),p2:bs(e.p2)}:{p0:M(),p1:M(),p2:M()}}function ene(e,t,r){const i=t[0]-e[0],s=t[1]-e[1],n=r[0]-e[0],o=r[1]-e[1];return .5*Math.abs(i*o-s*n)}function VXe(e,t,r){return ge(A9,t,e),ge(tne,r,e),Me(dt(A9,A9,tne))/2}new Ry(kp);new Ry(()=>kXe());const A9=M(),tne=M();function BXe(e,t,r){if(!e||!t)return!1;const{size:i,data:s}=e;ce(r,0,0,0),ce(Eh,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*i,c=t[a+1]*i,h=t[a+2]*i;ce(no,s[l+0],s[l+1],s[l+2]),ce(Wg,s[c+0],s[c+1],s[c+2]),ce(c$,s[h+0],s[h+1],s[h+2]);const p=VXe(no,Wg,c$);p?(me(no,no,Wg),me(no,no,c$),ae(no,no,1/3*p),me(r,r,no),n+=p):(me(Eh,Eh,no),me(Eh,Eh,Wg),me(Eh,Eh,c$),o+=3)}return(o!==0||n!==0)&&(n!==0?(ae(r,r,1/n),!0):o!==0&&(ae(r,Eh,1/o),!0))}function zXe(e,t,r){if(!e||!t)return!1;const{size:i,data:s}=e;ce(r,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*i;n!==l&&(r[0]+=s[l+0],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&ae(r,r,1/o),o>0}function GXe(e,t,r,i){if(!e)return!1;ce(i,0,0,0),ce(Eh,0,0,0);let s=0,n=0;const{size:o,data:a}=e,l=t?t.length-1:a.length/o-1,c=l+(r?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(t?t[p]:p)*o,y=(t?t[f]:f)*o;no[0]=a[m],no[1]=a[m+1],no[2]=a[m+2],Wg[0]=a[y],Wg[1]=a[y+1],Wg[2]=a[y+2],ae(no,me(no,no,Wg),.5);const _=QM(no,Wg);_>0?(me(i,i,ae(no,no,_)),s+=_):s===0&&(me(Eh,Eh,no),n++)}return s!==0?(ae(i,i,1/s),!0):n!==0&&(ae(i,Eh,1/n),!0)}const no=M(),Wg=M(),c$=M(),Eh=M();function LS(e){if(Array.isArray(e)){if(e.length<fm)return e;for(const t of e)if(t>=65536)return new Uint32Array(e);return new Uint16Array(e)}if(e.length<fm)return Array.from(e);if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}function awe(e){const t=3*e;return t<=fm?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}let y_=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const lwe=[0],DS=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function XE(e){if(e===1)return lwe;if(e<fm)return Array.from(new Uint16Array(DS.buffer,0,e));if(e<DS.length)return new Uint16Array(DS.buffer,0,e);if(e>y_.length){const t=Math.max(2*y_.length,e);y_=new Uint32Array(t);for(let r=0;r<y_.length;r++)y_[r]=r}return new Uint32Array(y_.buffer,0,e)}function I2t(e){if(e===1)return lwe;if(e<fm)return Array.from(new Uint16Array(DS.buffer,0,e));if(e<DS.length)return new Uint16Array(DS.slice(0,e));if(e>y_.length){const t=new Uint32Array(e);for(let r=0;r<t.length;r++)t[r]=r;return t}return new Uint32Array(y_.slice(0,e))}class b4{constructor(t){this.channel=t,this.id=Lc()}}function MH(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function jXe(e,t){const r=e.length;for(let i=0;i<r;++i)rS[0]=e[i],t[i]=rS[0];return t}function HXe(e,t){const r=e.length;for(let i=0;i<r;++i)rS[0]=e[i],rS[1]=e[i]-rS[0],t[i]=rS[1];return t}const rS=new Float32Array(2);function PH(e,t){return E(e)&&(e=[]),e.push(t),e}function IH(e,t){if(E(e))return null;const r=e.filter(i=>i!==t);return r.length===0?null:r}function qXe(e,t,r,i,s){u$[0]=e.get(t,0),u$[1]=e.get(t,1),u$[2]=e.get(t,2),MH(u$,r1,3),r.set(s,0,r1[0]),i.set(s,0,r1[1]),r.set(s,1,r1[2]),i.set(s,1,r1[3]),r.set(s,2,r1[4]),i.set(s,2,r1[5])}const u$=M(),r1=new Float32Array(6);class tn extends UP{constructor(t,r,i=[],s=null,n=Fs.Mesh,o=null,a=-1){super(),this.material=t,this.mapPositions=s,this.type=n,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=WXe(this._vertexAttributes),c=XE(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const h of this._vertexAttributes.keys())this._indices.set(h,c)}else for(const[l,c]of i)c&&(this._indices.set(l,LS(c)),l===A.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(t={}){const r=new tn(t.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,s)=>{i.exclusive=!1,r._vertexAttributes.set(s,i)}),this._indices.forEach((i,s)=>r._indices.set(s,i)),r._boundingInfo=this._boundingInfo,r.transformation=t.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){let r=this._vertexAttributes.get(t);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:DXe(r.data)},this._vertexAttributes.set(t,r)),r}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return E(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===Fs.Mesh?this._computeAttachmentOriginTriangles(t):this.type===Fs.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(v(this._transformation)&&Ze(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){const r=this.indices.get(A.POSITION),i=this.vertexAttributes.get(A.POSITION);return BXe(i,r,t)}_computeAttachmentOriginLines(t){const r=this.vertexAttributes.get(A.POSITION),i=this.indices.get(A.POSITION);return GXe(r,i,i&&XXe(this.material.parameters,r,i),t)}_computeAttachmentOriginPoints(t){const r=this.indices.get(A.POSITION),i=this.vertexAttributes.get(A.POSITION);return zXe(i,r,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(A.POSITION),r=this.vertexAttributes.get(A.POSITION);if(!t||t.length===0||!r)return null;const i=this.type===Fs.Mesh?3:1;mt(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const s=XE(t.length/i);return new Q6(s,i,t,r)}get transformation(){return Pt(this._transformation,Bu)}set transformation(t){this._transformation=t&&t!==Bu?vE(t):null}get shaderTransformation(){return v(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(t){this._shaderTransformer=t}get hasVolatileTransformation(){return v(this._shaderTransformer)}addHighlight(){const t=new b4(by.Highlight);return this.highlights=PH(this.highlights,t),t}removeHighlight(t){this.highlights=IH(this.highlights,t)}}function WXe(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function XXe(e,t,r){return!(!("isClosed"in e)||!e.isClosed)&&(r?r.length>2:t.data.length>6)}const jx=OH,R9=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],YXe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],ZXe=[0,0,1,0,1,1,0,1],JXe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],cwe=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)cwe[6*e+t]=e;const mb=new Array(36);for(let e=0;e<6;e++)mb[6*e+0]=0,mb[6*e+1]=1,mb[6*e+2]=2,mb[6*e+3]=2,mb[6*e+4]=3,mb[6*e+5]=0;function QXe(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=R9[i][0]*t[0],r[3*i+1]=R9[i][1]*t[1],r[3*i+2]=R9[i][2]*t[2];return new tn(e,[[A.POSITION,new Je(r,3,!0)],[A.NORMAL,new Je(YXe,3)],[A.UV0,new Je(ZXe,2)]],[[A.POSITION,JXe],[A.NORMAL,cwe],[A.UV0,mb]])}const O9=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],KXe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],eYe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],tYe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function rYe(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=O9[i][0]*t[0],r[3*i+1]=O9[i][1]*t[1],r[3*i+2]=O9[i][2]*t[2];return new tn(e,[[A.POSITION,new Je(r,3,!0)],[A.NORMAL,new Je(KXe,3)]],[[A.POSITION,eYe],[A.NORMAL,tYe]])}const pN=Yr(-.5,0,-.5),fN=Yr(.5,0,-.5),mN=Yr(0,0,.5),gN=Yr(0,.5,0),Hx=qi(),qx=qi(),NS=qi(),FS=qi(),US=qi();ge(Hx,pN,gN),ge(qx,pN,fN),dt(NS,Hx,qx),ve(NS,NS),ge(Hx,fN,gN),ge(qx,fN,mN),dt(FS,Hx,qx),ve(FS,FS),ge(Hx,mN,gN),ge(qx,mN,pN),dt(US,Hx,qx),ve(US,US);const M9=[pN,fN,mN,gN],iYe=[0,-1,0,NS[0],NS[1],NS[2],FS[0],FS[1],FS[2],US[0],US[1],US[2]],sYe=[0,1,2,3,1,0,3,2,1,3,0,2],nYe=[0,0,0,1,1,1,2,2,2,3,3,3];function oYe(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=M9[i][0]*t[0],r[3*i+1]=M9[i][1]*t[1],r[3*i+2]=M9[i][2]*t[2];return new tn(e,[[A.POSITION,new Je(r,3,!0)],[A.NORMAL,new Je(iYe,3)]],[[A.POSITION,sYe],[A.NORMAL,nYe]])}function $2t(e,t,r,i,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),h=Math.max(2,Math.floor(i)),p=(c+1)*(h+1),f=Qs(3*p),m=Qs(3*p),y=Qs(2*p),_=[];let b=0;for(let C=0;C<=h;C++){const O=[],R=C/h,$=a+R*l,I=Math.cos($);for(let U=0;U<=c;U++){const V=U/c,G=n+V*o,z=Math.cos(G)*I,Z=Math.sin($),Q=-Math.sin(G)*I;f[3*b]=z*t,f[3*b+1]=Z*t,f[3*b+2]=Q*t,m[3*b]=z,m[3*b+1]=Z,m[3*b+2]=Q,y[2*b]=V,y[2*b+1]=R,O.push(b),++b}_.push(O)}const x=new Array;for(let C=0;C<h;C++)for(let O=0;O<c;O++){const R=_[C][O],$=_[C][O+1],I=_[C+1][O+1],U=_[C+1][O];C===0?(x.push(R),x.push(I),x.push(U)):C===h-1?(x.push(R),x.push($),x.push(I)):(x.push(R),x.push($),x.push(I),x.push(I),x.push(U),x.push(R))}const T=[[A.POSITION,x],[A.NORMAL,x]],S=[[A.POSITION,new Je(f,3,!0)],[A.NORMAL,new Je(m,3,!0)]];return s.uv&&(S.push([A.UV0,new Je(y,2,!0)]),T.push([A.UV0,x])),s.offset&&(T[0][0]=A.OFFSET,S[0][0]=A.OFFSET,T.push([A.POSITION,new Array(x.length).fill(0)]),S.push([A.POSITION,new Je(Float64Array.from(s.offset),3,!0)])),new tn(e,S,T)}function aYe(e,t,r,i){const{vertexAttributes:s,indices:n}=uwe(t,r,i);return new tn(e,s,n)}function uwe(e,t,r){const i=e;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=i*(1+Math.sqrt(5))/2;s=[-i,h,0,i,h,0,-i,-h,0,i,-h,0,0,-i,h,0,i,h,0,-i,-h,0,i,-h,h,0,-i,h,0,i,-h,0,-i,-h,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)jx.scale(s,h,e/jx.length(s,h));let o={};function a(h,p){h>p&&([h,p]=[p,h]);const f=h.toString()+"."+p.toString();if(o[f])return o[f];let m=s.length;return s.length+=3,jx.add(s,3*h,s,3*p,s,m),jx.scale(s,m,e/jx.length(s,m)),m/=3,o[f]=m,m}for(let h=0;h<t;h++){const p=n.length,f=new Array(4*p);for(let m=0;m<p;m+=3){const y=n[m],_=n[m+1],b=n[m+2],x=a(y,_),T=a(_,b),S=a(b,y),C=4*m;f[C]=y,f[C+1]=x,f[C+2]=S,f[C+3]=_,f[C+4]=T,f[C+5]=x,f[C+6]=b,f[C+7]=S,f[C+8]=T,f[C+9]=x,f[C+10]=T,f[C+11]=S}n=f,o={}}const l=Zse(s);for(let h=0;h<l.length;h+=3)jx.normalize(l,h);const c=[[A.POSITION,n],[A.NORMAL,n]];return{vertexAttributes:[[A.POSITION,new Je(Zse(s),3,!0)],[A.NORMAL,new Je(l,3,!0)]],indices:c}}function $H(e,t,r,i,s,n,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],h=t?[t[0],t[1],t[2]]:[0,0,1];o=o||[0,0];const p=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],f=v(s)&&s.length===2?s:[1,1],m=[[A.POSITION,new Je(c,3,!0)],[A.NORMAL,new Je(h,3,!0)],[A.UV0,new Je(o,o.length)],[A.COLOR,new Je(p,4,!0)],[A.SIZE,new Je(f,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];m.push([A.AUXPOS1,new Je(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];m.push([A.AUXPOS2,new Je(y,4)])}return new tn(e,m,null,null,Fs.Point,l)}const lYe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function L2t(e,t=lYe){const r=new Array(12);for(let h=0;h<4;h++)for(let p=0;p<3;p++)r[3*h+p]=t[h][p];const i=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[A.POSITION,i],[A.NORMAL,n],[A.UV0,i],[A.COLOR,n]],c=[[A.POSITION,new Je(r,3,!0)],[A.NORMAL,new Je(s,3,!0)],[A.UV0,new Je(o,2,!0)],[A.COLOR,new Je(a,4,!0)]];return new tn(e,c,l)}function rne(e,t,r,i,s,n=!0,o=!0){let a=0;const l=r,c=t;let h=Yr(0,a,0),p=Yr(0,a+c,0),f=Yr(0,-1,0),m=Yr(0,1,0);s&&(a=c,p=Yr(0,0,0),h=Yr(0,a,0),f=Yr(0,1,0),m=Yr(0,-1,0));const y=[p,h],_=[f,m],b=i+2,x=Math.sqrt(c*c+l*l);if(s)for(let I=i-1;I>=0;I--){const U=I*(2*Math.PI/i),V=Yr(Math.cos(U)*l,a,Math.sin(U)*l);y.push(V);const G=Yr(c*Math.cos(U)/x,-l/x,c*Math.sin(U)/x);_.push(G)}else for(let I=0;I<i;I++){const U=I*(2*Math.PI/i),V=Yr(Math.cos(U)*l,a,Math.sin(U)*l);y.push(V);const G=Yr(c*Math.cos(U)/x,l/x,c*Math.sin(U)/x);_.push(G)}const T=new Array,S=new Array;if(n){for(let I=3;I<y.length;I++)T.push(1),T.push(I-1),T.push(I),S.push(0),S.push(0),S.push(0);T.push(y.length-1),T.push(2),T.push(1),S.push(0),S.push(0),S.push(0)}if(o){for(let I=3;I<y.length;I++)T.push(I),T.push(I-1),T.push(0),S.push(I),S.push(I-1),S.push(1);T.push(0),T.push(2),T.push(y.length-1),S.push(1),S.push(2),S.push(_.length-1)}const C=Qs(3*b);for(let I=0;I<b;I++)C[3*I]=y[I][0],C[3*I+1]=y[I][1],C[3*I+2]=y[I][2];const O=Qs(3*b);for(let I=0;I<b;I++)O[3*I]=_[I][0],O[3*I+1]=_[I][1],O[3*I+2]=_[I][2];const R=[[A.POSITION,T],[A.NORMAL,S]],$=[[A.POSITION,new Je(C,3,!0)],[A.NORMAL,new Je(O,3,!0)]];return new tn(e,$,R)}function cYe(e,t,r,i,s,n,o){const a=s?f4(s):Yr(1,0,0),l=n?f4(n):Yr(0,0,0);o=o!=null?o:!0;const c=qi();ve(c,a);const h=qi();ae(h,c,Math.abs(t));const p=qi();ae(p,h,-.5),me(p,p,l);const f=Yr(0,1,0);Math.abs(1-_e(c,f))<.2&&ce(f,0,0,1);const m=qi();dt(m,c,f),ve(m,m),dt(f,m,c);const y=2*i+(o?2:0),_=i+(o?2:0),b=Qs(3*y),x=Qs(3*_),T=Qs(2*y),S=new Array(3*i*(o?4:2)),C=new Array(3*i*(o?4:2));o&&(b[3*(y-2)+0]=p[0],b[3*(y-2)+1]=p[1],b[3*(y-2)+2]=p[2],T[2*(y-2)]=0,T[2*(y-2)+1]=0,b[3*(y-1)+0]=b[3*(y-2)+0]+h[0],b[3*(y-1)+1]=b[3*(y-2)+1]+h[1],b[3*(y-1)+2]=b[3*(y-2)+2]+h[2],T[2*(y-1)]=1,T[2*(y-1)+1]=1,x[3*(_-2)+0]=-c[0],x[3*(_-2)+1]=-c[1],x[3*(_-2)+2]=-c[2],x[3*(_-1)+0]=c[0],x[3*(_-1)+1]=c[1],x[3*(_-1)+2]=c[2]);const O=(G,z,Z)=>{S[G]=z,C[G]=Z};let R=0;const $=qi(),I=qi();for(let G=0;G<i;G++){const z=G*(2*Math.PI/i);ae($,f,Math.sin(z)),ae(I,m,Math.cos(z)),me($,$,I),x[3*G+0]=$[0],x[3*G+1]=$[1],x[3*G+2]=$[2],ae($,$,r),me($,$,p),b[3*G+0]=$[0],b[3*G+1]=$[1],b[3*G+2]=$[2],T[2*G+0]=G/i,T[2*G+1]=0,b[3*(G+i)+0]=b[3*G+0]+h[0],b[3*(G+i)+1]=b[3*G+1]+h[1],b[3*(G+i)+2]=b[3*G+2]+h[2],T[2*(G+i)+0]=G/i,T[2*G+1]=1;const Z=(G+1)%i;O(R++,G,G),O(R++,G+i,G),O(R++,Z,Z),O(R++,Z,Z),O(R++,G+i,G),O(R++,Z+i,Z)}if(o){for(let G=0;G<i;G++){const z=(G+1)%i;O(R++,y-2,_-2),O(R++,G,_-2),O(R++,z,_-2)}for(let G=0;G<i;G++){const z=(G+1)%i;O(R++,G+i,_-1),O(R++,y-1,_-1),O(R++,z+i,_-1)}}const U=[[A.POSITION,S],[A.NORMAL,C],[A.UV0,S]],V=[[A.POSITION,new Je(b,3,!0)],[A.NORMAL,new Je(x,3,!0)],[A.UV0,new Je(T,2,!0)]];return new tn(e,V,U)}function D2t(e,t,r,i,s,n,o=Yr(0,0,0)){const a=t.length,l=Qs(r.length*a*3+(6*i.length||0)),c=Qs(r.length*a*3+(i?6:0)),h=new Array,p=new Array;let f=0,m=0;const y=qi(),_=qi(),b=qi(),x=qi(),T=qi(),S=qi(),C=qi(),O=M(),R=qi(),$=qi(),I=qi(),U=qi(),V=qi(),G=jr();ce(R,0,1,0),ge(_,r[1],r[0]),ve(_,_),n?(me(O,r[0],o),ve(b,O)):ce(b,0,0,1),w4(_,b,R,R,T,b,ine),le(x,b),le(U,T);for(let F=0;F<i.length;F++)ae(S,T,i[F][0]),ae(O,b,i[F][2]),me(S,S,O),me(S,S,r[0]),l[f++]=S[0],l[f++]=S[1],l[f++]=S[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let F=0;F<s.length;F++)h.push(s[F][0]>0?s[F][0]:-s[F][0]-1+i.length),h.push(s[F][1]>0?s[F][1]:-s[F][1]-1+i.length),h.push(s[F][2]>0?s[F][2]:-s[F][2]-1+i.length),p.push(0),p.push(0),p.push(0);let z=i.length;const Z=i.length-1;for(let F=0;F<r.length;F++){let H=!1;F>0&&(le(y,_),F<r.length-1?(ge(_,r[F+1],r[F]),ve(_,_)):H=!0,me($,y,_),ve($,$),me(I,r[F-1],x),_P(r[F],$,G),Tx(G,zu(I,y),O)?(ge(O,O,r[F]),ve(b,O),dt(T,$,b),ve(T,T)):w4($,x,U,R,T,b,ine),le(x,b),le(U,T)),n&&(me(O,r[F],o),ve(V,O));for(let X=0;X<a;X++)if(ae(S,T,t[X][0]),ae(O,b,t[X][1]),me(S,S,O),ve(C,S),c[m++]=C[0],c[m++]=C[1],c[m++]=C[2],me(S,S,r[F]),l[f++]=S[0],l[f++]=S[1],l[f++]=S[2],!H){const K=(X+1)%a;h.push(z+X),h.push(z+a+X),h.push(z+K),h.push(z+K),h.push(z+a+X),h.push(z+a+K);for(let W=0;W<6;W++){const ue=h.length-6;p.push(h[ue+W]-Z)}}z+=a}const Q=r[r.length-1];for(let F=0;F<i.length;F++)ae(S,T,i[F][0]),ae(O,b,i[F][1]),me(S,S,O),me(S,S,Q),l[f++]=S[0],l[f++]=S[1],l[f++]=S[2];const te=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const q=z-a;for(let F=0;F<s.length;F++)h.push(s[F][0]>=0?z+s[F][0]:-s[F][0]-1+q),h.push(s[F][2]>=0?z+s[F][2]:-s[F][2]-1+q),h.push(s[F][1]>=0?z+s[F][1]:-s[F][1]-1+q),p.push(te),p.push(te),p.push(te);const L=[[A.POSITION,h],[A.NORMAL,p]],N=[[A.POSITION,new Je(l,3,!0)],[A.NORMAL,new Je(c,3,!0)]];return new tn(e,N,L)}function N2t(e,t,r,i){mt(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),mt(t[0].length===3,"createPolylineGeometry(): malformed vertex"),mt(r==null||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),mt(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const s=Bc(3*t.length),n=new Array(2*(t.length-1));let o=0,a=0;for(let h=0;h<t.length;h++){for(let p=0;p<3;p++)s[o++]=t[h][p];h>0&&(n[a++]=h-1,n[a++]=h)}const l=[],c=[];if(l.push([A.POSITION,n]),c.push([A.POSITION,new Je(s,3,!0)]),r){const h=Qs(3*r.length);let p=0;for(let f=0;f<t.length;f++)for(let m=0;m<3;m++)h[p++]=r[f][m];l.push([A.NORMAL,n]),c.push([A.NORMAL,new Je(h,3,!0)])}return i&&(c.push([A.COLOR,new Je(i,4)]),l.push([A.COLOR,XE(i.length/4)])),new tn(e,c,l,null,Fs.Line)}function uYe(e,t=e){const r=e.vertexAttributes,i=r.get(A.POSITION).data,s=r.get(A.NORMAL).data;if(s){const n=t.getMutableAttribute(A.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=t.getMutableAttribute(A.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}}function P9(e,t,r,i,s){return!(Math.abs(_e(t,e))>s)&&(dt(r,e,t),ve(r,r),dt(i,r,e),ve(i,i),!0)}function w4(e,t,r,i,s,n,o){return P9(e,t,s,n,o)||P9(e,r,s,n,o)||P9(e,i,s,n,o)}const ine=.99619469809;class hYe{constructor(t,r){this.type=Dn.Panoramic,this._configuration=new iJ,this._passParameters=new sJ,this._configuration.geometry=Cm.Cylinder,this._technique=r.techniqueRepository.acquire(VE,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=ra(this._vao,"geometry"),this._passParameters.texture=new lt(i,{pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR,flipped:!0,width:1,height:512},swe)}destroy(){this._passParameters.texture=tt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(t){const r=t.rctx,i=r.bindTechnique(this._technique,this._passParameters,t.bindParameters);dYe(sne,t.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",sne),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(It.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const r=uwe(1,2,!1),i=r.indices[0][1],s=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const n=s.data,o=nne.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,n[c]),a.set(l,1,n[c+1]),a.set(l,2,n[c+2])}return new Bp(t,Or,{geometry:Hc(nne)},{geometry:wr.createVertex(t,$r.STATIC_DRAW,o.buffer)})}}function dYe(e,t){Hn(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const sne=Ie(),nne=os().vec3f(A.POSITION);var xy;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(xy||(xy={}));class LH extends $a{constructor(){super(...arguments),this.type=xy.Rain}}u([B({count:xy.COUNT})],LH.prototype,"type",void 0);function pYe(e){const t=new Lr;return t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new qt("cameraPosition",(r,i)=>i.camera.eye)),t.vertex.uniforms.add(new qt("offset",(r,i)=>fYe(r,i))),t.vertex.uniforms.add(new Pe("width",r=>r.width)),t.vertex.uniforms.add(new Yi("proj",(r,i)=>i.camera.projectionMatrix)),t.vertex.uniforms.add(new Yi("view",(r,i)=>i.camera.viewMatrix)),t.vertex.uniforms.add(new Pe("time",r=>r.time)),t.varyings.add("vUv","vec2"),t.vertex.code.add(w`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===xy.Rain?w`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:w`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add([new Pe("opacity",r=>r.opacity),new qt("particleColor",(r,i)=>mYe(i,e))]),t.fragment.code.add(w`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===xy.Rain?w`d = 0.35 * smoothstep(0.5, 0.0, d);`:w`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}function fYe(e,t){const r=t.camera.eye,i=.5*e.width,s=1/e.width,n=qhe(DH,ce(DH,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return lo(n,r,ae(n,n,e.width))}function mYe(e,t){const r=t.type===xy.Rain?yYe:gYe,i=ae(DH,r,_Ye),s=e.camera.eye;ve(one,s);const n=Math.max(0,_e(one,e.lighting.mainLight.direction));return rn(i,i,r,n)}const DH=M(),one=M(),gYe=Le(1,1,1),yYe=Le(.85,.85,.85),_Ye=.7,vYe=Object.freeze(Object.defineProperty({__proto__:null,build:pYe},Symbol.toStringTag,{value:"Module"}));class bYe extends gi{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}}class bM extends Br{initializeProgram(t){return new Nr(t.rctx,bM.shader.get().build(this.configuration),yN)}initializePipeline(){return Vt({blending:Wn(Ee.ONE,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ni.LEQUAL},colorWrite:Qt})}}bM.shader=new Dr(vYe,()=>ie(()=>import("./Precipitation.glsl.8e03e0f2.js"),[]));const yN=new Map([[A.POSITION,0],[A.INSTANCEFEATUREATTRIBUTE,1]]);class hwe{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:t,fixedTime:r}){return v(r)?this._time!==r&&(this._time=r,!0):(this._time=this._time+t,t!==0)}}class wYe{constructor(t,r){this.deltaTime=t,this.fixedTime=r}}let gb=class extends Te{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new bYe,this._animation=new hwe,this._updatingTracking=new om,this._passParameters.time=0,this._passParameters.radius=Zr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Wi(this._snowTechniqueCached),this._rainTechniqueCached=Wi(this._rainTechniqueCached),this._vao=tt(this._vao),this._instanceIdBuffer=tt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(E(this._rainTechniqueCached)){const e=new LH;e.type=xy.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(bM,e)}return this._rainTechniqueCached}get _snowTechnique(){if(E(this._snowTechniqueCached)){const e=new LH;e.type=xy.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(bM,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,t,r){var a;const i=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!i.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),E(i)||E(this._vao)||E(this._instanceIdBuffer)||(v(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const n=.35;t=t<.5?Nt(0,n,2*t):Nt(n,1,2*(t-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*IW(this._animation.time)%1e5;const o=s.bindTechnique(i,this._passParameters,e.bindParameters);s.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),VZ(s,yN,this._instanceIdBuffer,ane,0),(a=s.capabilities.instancing)==null||a.drawArraysInstanced(It.TRIANGLES,0,3,this._numParticles*t),BZ(s,yN,this._instanceIdBuffer,ane)}_ensureResources(e){E(this._vao)&&(this._vao=this._createVertexArrayObject(e)),E(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let r=0;r<this._numParticles;r++)t.push(r);return wr.createVertex(e,$r.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Bp(e,yN,{geometry:Hc(xYe)},{geometry:wr.createVertex(e,$r.STATIC_DRAW,t)})}};u([d({constructOnly:!0})],gb.prototype,"context",void 0),u([d({constructOnly:!0})],gb.prototype,"view",void 0),u([d({readOnly:!0})],gb.prototype,"updating",null),u([d()],gb.prototype,"_updatingTracking",void 0),gb=u([P("esri.views.3d.environment.Precipitation")],gb);const xYe=os().vec3f(A.POSITION),ane=Hc(os().f32(A.INSTANCEFEATUREATTRIBUTE),1),TYe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),h$=128,lne=-xH,cne=0,I9=50,SYe=()=>1-511/512,EYe=OD([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class CYe{constructor(t,r){this.view=t,this.type=Dn.Simple,this._passParameters=new sJ,this._vaoCount=0,this._texV1=1,this._isMars=Om(t.spatialReference);const i=Zr(t.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+lne)/this._planetRadius,this._middleRimFactor=(this._planetRadius+cne)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=cne/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const s=r.renderContext.rctx;this._cameraChangeHandle=se(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),Ys),this._vao=this._createRibbon(s),this._vaoCount=ra(this._vao,"geometry"),this._fadeVao=La(s),this._fadeVaoCount=ra(this._fadeVao,"geometry");const n=this._isMars?TYe:swe;this._passParameters.texture=new lt(s,{pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR,flipped:!0,width:1,height:512},n);const o=new iJ;o.geometry=Cm.Cone,this._coneTechnique=this._techniqueRepository.acquire(VE,o),o.geometry=Cm.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(VE,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=tt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(t){const r=t.bindParameters.camera;this._update(r);const i=t.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,t.bindParameters),i.bindVAO(this._vao),i.drawArrays(It.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,t.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(It.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(t){const r=M(),i=this._planetRadius,s=Me(t.eye),n=s-i;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(I9,n),a=i+lne;this._passParameters.innerScale=AYe(i+o,i,a)-1,this._passParameters.altitudeFade=NZ(n),ae(r,t.eye,(i+I9)/s),une(r,t.center,t.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(t,r,t.up,this._passParameters.silhouette),c=SYe(),h=EYe(n);let p=this._texV0+c*this._texVScale,f=this._texV0+l*h*this._texVScale;if(n>I9){une(t.eye,t.center,t.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._passParameters.silhouette),y=ye((m-1.5)/(l-1.5),0,1);p=this._texV0+y*c*this._texVScale,f=this._texV0+Nt(this._texV1,l*h,y)*this._texVScale}or(this._passParameters.texV,p,f)}_createRibbon(t){const r=Qs(3+3*h$*3),i=new Uint32Array(3*h$*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<h$;o++){const a=9*o+3;r[a+0]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===h$-1?1:l+3,h=15*o;i[h+0]=l,i[h+1]=l+1,i[h+2]=c+1,i[h+3]=c+1,i[h+4]=c,i[h+5]=l,i[h+6]=l+1,i[h+7]=l+2,i[h+8]=c+2,i[h+9]=c+2,i[h+10]=c+1,i[h+11]=l+1,i[h+12]=l,i[h+13]=c,i[h+14]=0}const s=hne.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new Bp(t,Or,{geometry:Hc(hne)},{geometry:wr.createVertex(t,$r.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,r,i,s){return me(Wx,s.center,s.v2),ae(d$,Wx,this._outerRimFactor),r6($9,r,Wx,i),Kse(Wx,$9,t.projectionMatrix,t.viewport,Wx),Kse(d$,$9,t.projectionMatrix,t.viewport,d$),Ai(Wx,d$)/t.height}}function une(e,t,r,i,s){const n=Me(e),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return ae(s.center,e,a/n),dt(l,e,t),ba(l)<1&&dt(l,e,r),ae(l,l,o/Me(l)),dt(c,l,e),ae(c,c,o/Me(c)),o}const $9=Ie(),Wx=M(),d$=M();function AYe(e,t,r){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-r*r)+t*r)}const hne=os().vec3f(A.POSITION);class K6 extends Br{initializeProgram(t){return new Nr(t.rctx,K6.shader.get().build(this.configuration),Or)}initializePipeline(){return Vt({blending:Wn(Ee.ONE,Ee.ZERO,Ee.ONE_MINUS_SRC_COLOR,Ee.ONE),colorWrite:Qt})}}K6.shader=new Dr(ewe,()=>ie(()=>import("./FogHaze.glsl.17d5ef31.js"),[]));const RYe=.7,OYe=1;let l3=class extends Te{constructor(e){super(e),this._passParameters=new tJ;const t=e.context.renderContext.rctx;this._vao=La(t,$C);const r=Zr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+iM;const i=new rJ;i.haze=!0,this._hazeTechnique=e.context.techniqueRepository.acquire(K6,i)}destroy(){this._hazeTechnique.release(),this._vao.dispose()}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}render(e,t){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,t),this._passParameters.hazeAmount<=0))return;const r=this._hazeTechnique;if(!r.compiled)return void this.context.requestRender();const i=e.offscreenRenderingHelper;i.renderDepthDetached(()=>{this._passParameters.depthTexture=i.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderSimpleHaze(s,e)})}_renderSimpleHaze(e,t){const r=t.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(It.TRIANGLE_STRIP,0,4)}_update(e,t){const r=e.bindParameters.camera;ve(dne,r.eye);const i=Math.max(0,_e(dne,e.bindParameters.lighting.mainLight.direction)),s=PYe;ae(pne,s,0),rn(this._passParameters.hazeColor,pne,s,i);const n=Me(r.eye),o=n*n;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-QS(RYe*Rh,OYe*Rh,Math.abs(n-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],l3.prototype,"context",void 0),u([d({constructOnly:!0})],l3.prototype,"view",void 0),l3=u([P("esri.views.3d.environment.SimpleHaze")],l3);class MYe{constructor(){this.strength=0,this.amount=0}}const PYe=Le(.24,.44,.8),dne=M(),pne=M();function lJ(e){const t=w`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=w`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}function IYe(){const e=new Lr;return e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.COLOR,"vec4"),e.attributes.add(A.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new Yi("transform",(t,r)=>$Ye(t,r)),new fr("viewport",(t,r)=>r.camera.fullViewport),new Pe("pixelRatio",(t,r)=>r.camera.pixelRatio)]),e.include(lJ),e.vertex.code.add(w`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(w`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function $Ye(e,t){return Hn(s0,t.camera.projectionMatrix),s0[10]=24e-8-1,s0[11]=-1,s0[14]=(24e-8-2)*t.camera.near,ws(s0,s0,t.camera.viewMatrix),ws(s0,s0,e.modelMatrix)}const s0=Ie(),LYe=Object.freeze(Object.defineProperty({__proto__:null,build:IYe},Symbol.toStringTag,{value:"Module"}));class DYe extends gi{constructor(){super(...arguments),this.modelMatrix=Ie()}}class eU extends Br{constructor(t){super(t,new $a,()=>this.destroy())}initializeProgram(t){return new Nr(t.rctx,eU.shader.get().build(),Or)}initializePipeline(){return Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ni.LEQUAL},colorWrite:Qt})}}eU.shader=new Dr(LYe,()=>ie(()=>import("./Stars.glsl.4d20cd1e.js"),[]));let o_=class extends Te{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return v(this._loadDataTask)&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new DYe,this._updatingTracking=new om}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Yh(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Wi(this._technique),this._vao=tt(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),E(this._technique)||E(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const r=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(It.POINTS,0,this._numPoints)}_ensureResources(e){if(v(this._technique)||E(Xx))return;this._technique=new eU({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Xx.byteLength/fne;const t=new Float32Array(Xx,0,2*this._numPoints),r=new Uint8Array(Xx,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,i=>this._update(i),kt)}_computeDayDuration(e){const t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),i=Hn(this._renderParameter.modelMatrix,UYe);yE(i,i,-r*Math.PI),ws(i,FYe,i),yE(i,i,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,r,i){const s=mne.createBuffer(i),n=s.position,o=s.color,a=s.size;for(let l=0;l<i;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(r[l]),f=this._hexToRGB(NYe[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new Bp(e,Or,{geometry:Hc(mne)},{geometry:wr.createVertex(e,$r.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(v(Xx))return null;const e=wP(async t=>{const{data:r}=await y$e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(r),Xx=r});return e.promise.catch(t=>{sn(t)||ee.getLogger(this.declaredClass).error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new j("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/fne;if(t%1!=0||t>5e4||t<5e3)throw new j("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],o_.prototype,"view",void 0),u([d({constructOnly:!0})],o_.prototype,"requestRender",void 0),u([d({readOnly:!0})],o_.prototype,"updating",null),u([d()],o_.prototype,"_loadDataTask",void 0),u([d()],o_.prototype,"_updatingTracking",void 0),o_=u([P("esri.views.3d.environment.Stars")],o_);const NYe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],FYe=eY(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),UYe=eY(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),fne=9,mne=os().vec3f(A.POSITION).vec4u8(A.COLOR).f32(A.SIZE);let Xx=null;function kYe(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function x4(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function cJ(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>Pa()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function uJ(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1],c=r[2],h=r[3];return e[0]=i*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-i*c,e[2]=n*h+o*c+i*l-s*a,e[3]=o*h-i*a-s*l-n*c,e}function VYe(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-i*a,e}function BYe(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-n*a,e[1]=s*l+o*a,e[2]=n*l+i*a,e[3]=o*l-s*a,e}function zYe(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*a,e[1]=s*l-i*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function GYe(e,t){const r=t[0],i=t[1],s=t[2];return e[0]=r,e[1]=i,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),e}function _N(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,f,m=r[0],y=r[1],_=r[2],b=r[3];return c=s*m+n*y+o*_+a*b,c<0&&(c=-c,m=-m,y=-y,_=-_,b=-b),1-c>Pa()?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-i)*l)/h,f=Math.sin(i*l)/h):(p=1-i,f=i),e[0]=p*s+f*m,e[1]=p*n+f*y,e[2]=p*o+f*_,e[3]=p*a+f*b,e}function jYe(e){const t=JM,r=t(),i=t(),s=t(),n=Math.sqrt(1-r),o=Math.sqrt(r);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=o*Math.sin(2*Math.PI*s),e[3]=o*Math.cos(2*Math.PI*s),e}function HYe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-s*a,e[3]=n*a,e}function ix(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function dwe(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*i,i=.5/i,e[3]=(t[3*n+o]-t[3*o+n])*i,e[n]=(t[3*n+s]+t[3*s+n])*i,e[o]=(t[3*o+s]+t[3*s+o])*i}return e}function qYe(e,t,r,i){const s=.5*Math.PI/180;t*=s,r*=s,i*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),h=Math.cos(i);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function WYe(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const hJ=cp,XYe=ti,YYe=gW,ZYe=uJ,JYe=uC,QYe=tde,KYe=E5,pwe=yW,eZe=pwe,fwe=_W,tZe=fwe,dJ=ede,rZe=mS,iZe=vW;function sZe(e,t,r){const i=_e(t,r);return i<-.999999?(dt(Xp,nZe,t),_c(Xp)<1e-6&&dt(Xp,oZe,t),ve(Xp,Xp),x4(e,Xp,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(dt(Xp,t,r),e[0]=Xp[0],e[1]=Xp[1],e[2]=Xp[2],e[3]=1+i,dJ(e,e))}const Xp=M(),nZe=Le(1,0,0),oZe=Le(0,1,0);function aZe(e,t,r,i,s,n){return _N(gne,t,s,n),_N(yne,r,i,n),_N(e,gne,yne,2*n*(1-n)),e}const gne=cd(),yne=cd();function lZe(e,t,r,i){const s=cZe;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],dJ(e,dwe(e,s))}const cZe=ns();Object.freeze(Object.defineProperty({__proto__:null,add:YYe,calculateW:GYe,conjugate:ix,copy:hJ,dot:QYe,equals:iZe,exactEquals:rZe,fromEuler:qYe,fromMat3:dwe,getAxisAngle:cJ,identity:kYe,invert:HYe,len:eZe,length:pwe,lerp:KYe,mul:ZYe,multiply:uJ,normalize:dJ,random:jYe,rotateX:VYe,rotateY:BYe,rotateZ:zYe,rotationTo:sZe,scale:JYe,set:XYe,setAxes:lZe,setAxisAngle:x4,slerp:_N,sqlerp:aZe,sqrLen:tZe,squaredLength:fwe,str:WYe},Symbol.toStringTag,{value:"Module"}));function kP(e=hZe){return[e[0],e[1],e[2],e[3]]}function F2t(e,t,r=kP()){return le(r,e),r[3]=t,r}function _ne(e,t,r=kP()){return dt(r,e,t),ve(r,r),r[3]=-Yhe(e,t),r}function U2t(e,t,r=kP()){return x4(p$,e,vne(e)),x4(bne,t,vne(t)),uJ(p$,bne,p$),uZe(r,nl(cJ(r,p$)))}function k2t(e){return e}function vne(e){return Gt(e[3])}function uZe(e,t){return e[3]=t,e}const hZe=[0,0,1,0],p$=cd(),bne=cd();kP();function dZe(e,t,r){const i=e.parallax.anchorPointClouds;e.fadeIn.stage===xc.FINISHED&&(e.fadeIn.factor=0,le(i,Yf),e.fadeIn.stage=xc.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=Nn.FINISHED),e.fadeIn.stage===xc.CHANGE_ANCHOR&&e.isCameraPositionFinal&&(WZ(e.data)&&e.renderingStage!==Ns.RENDERING||e.renderingStage===Ns.FADING_TEXTURE_CHANNELS)&&(le(i,Yf),e.fadeIn.stage=xc.FADE_IN,e.startTime=t,e.renderingStage===Ns.FADING_TEXTURE_CHANNELS&&(e.renderingStage=Ns.SWITCH_CHANNELS)),e.fadeIn.factor<1&&e.fadeIn.stage===xc.FADE_IN?e.fadeIn.factor=r?ye((t-e.startTime)/(mwe*r),0,1):1:e.fadeIn.factor>=1&&e.fadeIn.stage===xc.FADE_IN&&(e.fadeIn.stage=xc.FINISHED,e.fadeIn.factor=1)}function pZe(e,t,r){const{fadeInOut:i,crossFade:s}=e;i.stage===Nn.FINISHED&&(e.startTime=t,i.factor=1,i.stage=Nn.FADE_OUT),i.factor>0&&i.stage===Nn.FADE_OUT?i.factor=r?1-ye((t-e.startTime)/(_Ze*r),0,1):0:(i.factor<=0&&i.stage===Nn.FADE_OUT&&(i.factor=0,le(e.parallax.anchorPointClouds,Yf)),i.factor<=0&&i.stage===Nn.FADE_OUT&&e.isCameraPositionFinal&&(i.factor=0,i.stage=Nn.SWITCH,e.crossFade.enabled=!1,s.factor=1),i.stage===Nn.SWITCH&&(WZ(e.data)&&e.renderingStage!==Ns.RENDERING||e.renderingStage===Ns.FADING_TEXTURE_CHANNELS)&&(e.startTime=t,i.factor=0,i.stage=Nn.FADE_IN,le(e.parallax.anchorPointClouds,Yf),e.crossFade.enabled=!1,s.factor=1,e.renderingStage===Ns.FADING_TEXTURE_CHANNELS&&(e.renderingStage=Ns.SWITCH_CHANNELS)),i.factor<1&&i.stage===Nn.FADE_IN?i.factor=r?ye((t-e.startTime)/(mwe*r),0,1):1:i.factor>=1&&i.stage===Nn.FADE_IN&&(i.stage=Nn.FINISHED,i.factor=1))}function fZe(e,t,r,i){const{crossFade:s}=e,n=e.parallax.anchorPointClouds;e.crossFade.enabled&&!i||(le(e.parallaxNew.anchorPointClouds,Yf),e.startTime=t,s.factor=0,e.crossFade.enabled=!0),s.factor<1&&e.crossFade.enabled?s.factor=r?ye((t-e.startTime)/(vZe*r),0,1):1:s.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,s.factor=1,le(n,e.parallaxNew.anchorPointClouds),e.renderingStage===Ns.FADING_TEXTURE_CHANNELS&&(e.renderingStage=Ns.SWITCH_CHANNELS))}function wne(e,t,r,i){const s=e.fadeInOutHeight,n=s.stage===_v.FINISHED?r:e.startTimeHeightFade;if(i!==0){const o=(r-n)/(bZe*i);s.factor+=t?-o:o}else s.factor=t?0:1;e.startTimeHeightFade=r,s.factor=ye(s.factor,0,1),s.stage=_v.HEIGHT_FADE}function mZe(e,t,r,i,s){e.renderingStage===Ns.FINISHED_RENDERING&&(e.renderingStage=Ns.FADING_TEXTURE_CHANNELS);const n=Me(t.eye);e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=n-br.radius>Rh?1:0),e.isCameraPositionFinal=lv(e.cameraPositionLastFrame,t.eye),ve(Yf,t.eye),ae(Yf,Yf,br.radius);const o=e.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&le(o.anchorPointClouds,Yf);const a=Me(ge(yZe,o.anchorPointClouds,Yf));let l=!0;a>e.fadeIn.distanceThresholdFactor*o.cloudsHeight||e.fadeIn.stage!==xc.FINISHED?dZe(e,i,s):a>e.fadeInOut.distanceThresholdFactor*o.cloudsHeight||e.fadeInOut.stage!==Nn.FINISHED?pZe(e,i,s):a>e.crossFade.distanceThresholdFactor*o.cloudsHeight||e.crossFade.enabled||e.renderingStage===Ns.FADING_TEXTURE_CHANNELS?fZe(e,i,s,(r!==Sr.IDLE||!WZ(e.data))&&e.renderingStage!==Ns.FADING_TEXTURE_CHANNELS):l=!1;const c=n-br.radius;if((c>1.7*Rh||c<-Rh)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(c>Rh||c<-.35*Rh)&&e.fadeInOutHeight.factor<1?wne(e,!1,i,s):c<Rh&&c>-.35*Rh&&e.fadeInOutHeight.factor>0?wne(e,!0,i,s):e.fadeInOutHeight.stage=_v.FINISHED,e.renderingStage===Ns.SWITCH_CHANNELS&&(e.readChannels=1-e.readChannels,e.renderingStage=Ns.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-br.radius*br.radius,0))/n,_ne(xne,o.anchorPointClouds,Yx),Pc(o.transform,Bu,Yx[3],Yx),l){const{parallaxNew:h}=e;_ne(xne,h.anchorPointClouds,Yx),Pc(h.transform,Bu,Yx[3],Yx)}le(e.cameraPositionLastFrame,t.eye)}function gZe(e){return e.crossFade.enabled||e.fadeInOut.stage!==Nn.FINISHED||e.fadeIn.stage!==xc.FINISHED||e.fadeInOutHeight.stage!==_v.FINISHED||e.renderingStage!==Ns.FINISHED}const xne=Le(0,0,1),Yx=kP(),Yf=M(),yZe=M(),mwe=1,_Ze=.5,vZe=1.3,bZe=1;class DC{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,r){var i;return(i=this._outer.get(t))==null?void 0:i.get(r)}set(t,r,i){const s=this._outer.get(t);s?s.set(r,i):this._outer.set(t,new Map([[r,i]]))}delete(t,r){const i=this._outer.get(t);i&&(i.delete(r),i.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((r,i)=>t(r,i))}}var qs;function Tne(e=de("enable-feature:high-quality-idle")){const t=new DC;return e&&(t.set(Sr.INTERACTING,qs.Antialiasing,!0),t.set(Sr.IDLE,qs.Antialiasing,!0),t.set(Sr.INTERACTING,qs.HighQualityTransparency,!0),t.set(Sr.IDLE,qs.HighQualityTransparency,!0),t.set(Sr.INTERACTING,qs.RealisticAtmosphere,!0),t.set(Sr.IDLE,qs.RealisticAtmosphere,!0),t.set(Sr.IDLE,qs.SSAO,!0),t.set(Sr.IDLE,qs.WaterReflection,!0),t.set(Sr.IDLE,qs.PhysicalPixelRendering,!0)),t.set(Sr.ANIMATING,qs.ShadowMapUpdate,!0),t.set(Sr.INTERACTING,qs.ShadowMapUpdate,!0),t.set(Sr.IDLE,qs.ShadowMapUpdate,!0),t.set(Sr.IDLE,qs.HighQualityVoxel,!0),t}(function(e){e[e.Antialiasing=0]="Antialiasing",e[e.HighQualityTransparency=1]="HighQualityTransparency",e[e.HighQualityVoxel=2]="HighQualityVoxel",e[e.RealisticAtmosphere=3]="RealisticAtmosphere",e[e.SSAO=4]="SSAO",e[e.WaterReflection=5]="WaterReflection",e[e.ShadowMapUpdate=6]="ShadowMapUpdate",e[e.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(qs||(qs={}));var kS;(function(e){e[e.Immediate=0]="Immediate",e[e.Faded=1]="Faded"})(kS||(kS={}));var c3;const wZe=[Se.POSTPROCESSING_ENVIRONMENT_OPAQUE,Se.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Kn=c3=class extends Te{constructor(e){super(e),this._context=null,this._atmosphere=null,this._hqAtmosphere=null,this._oldWeatherParameters=new L9,this._newWeatherParameters=new L9,this._fadedWeatherParameters=new L9,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(wZe,this)}destroy(){var e;this.removeHandles(),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return v(this._hqAtmosphere)&&this.view._stage.renderer.isFeatureEnabled(qs.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}get _atmosphereType(){return v(this.atmosphere)?this.atmosphere.type:Dn.None}get canRender(){var e;return!!((e=this.view.basemapTerrain)!=null&&e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._atmosphereType===Dn.Realistic}updateAnimation(e){return!!v(this._precipitation)&&this._precipitation.update(e)}get updating(){return v(this._stars)&&this._stars.updating||v(this._clouds)&&this._clouds.running}get weatherVisible(){return Me(this.view.state.camera.eye)-Zr(this.view.spatialReference).radius<=Rh}get _stars(){var i,s;const e=this.view,t=(s=(i=e.environment)==null?void 0:i.starsEnabled)!=null?s:!1,r=this._get("_stars");return!t||E(this._context)?(Ve(r),null):v(r)?r:new o_({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||E(this._context))return Ve(e),null;const t=this.view,r=this._context;return v(e)&&e.context===r?e:(Ve(e),new gb({context:r,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||E(this._context))return Ve(e),null;if(v(e))return e;const t=this.view,r=this._context;return Ve(e),new Rl({context:r,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||E(this._context))return Ve(e),null;const t=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Zr(this.view.spatialReference).radius;return v(e)&&e.viewingMode===t&&e.planetRadius===i?e:(Ve(e),new fb({rctx:r,viewingMode:t,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||E(this._context))return Ve(e),null;if(v(e))return e;const t=this.view,r=this._context;return new a3({context:r,view:t})}get _simpleHaze(){const e=this._get("_simpleHaze");if(!this.weatherEnabled||E(this._context))return Ve(e),null;if(v(e))return e;const t=this.view,r=this._context;return new l3({context:r,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)!=null&&t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e;const t=()=>this._setNeedsRender();this.addHandles([oa(()=>{var r;return(r=this.view)==null?void 0:r.basemapTerrain},()=>this._updateBasemapTerrain(),Ys),se(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),r=>this._updateAtmosphere(r),Ys),se(()=>this._stars,t),se(()=>this._precipitation,t),se(()=>this._clouds,()=>this._updateWeather(),kt),se(()=>this._fog,()=>this._updateFogHaze(),kt),se(()=>this._simpleHaze,()=>this._updateFogHaze(),kt),se(()=>this.view.state.mode,()=>{this._setNeedsRender()},ri),se(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),Ys),se(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Ys)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Ve(this._atmosphere),this._hqAtmosphere=Ve(this._hqAtmosphere),this._set("_stars",Ve(this._stars)),this._set("_precipitation",Ve(this._precipitation)),this._set("_clouds",Ve(this._clouds)),this._set("_cloudsComposition",Ve(this._cloudsComposition)),this._set("_fog",Ve(this._fog)),this._set("_simpleHaze",Ve(this._simpleHaze))}prepareRender(e){e.bindParameters.cloudsFade.data=fWe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(mZe(e.bindParameters.cloudsFade,e.bindParameters.camera,this.view.state.mode,e.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(e.bindParameters),e.bindParameters.cloudsFade.renderingStage===Ns.FINISHED&&v(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),e.bindParameters.cloudsFade.data=null))}render(e){if(e.output===k.Color)switch(e.bindParameters.slot){case Se.POSTPROCESSING_ENVIRONMENT_OPAQUE:v(this._stars)&&this._stars.render(e),v(this.atmosphere)&&(this.atmosphere.render(e),v(this._cloudsComposition)&&v(e.bindParameters.cloudsFade.data)&&(this.weatherVisible&&v(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),gZe(e.bindParameters.cloudsFade)&&v(this._context)&&this._context.requestRender());break;case Se.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(v(this.atmosphere)&&(this.atmosphere.renderHaze(e,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._atmosphereType!==Dn.Realistic&&v(this._simpleHaze)&&this._simpleHaze.render(e,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&v(this._fog)&&this._fog.render(e,this._weatherParameters.fog),v(this._precipitation))){const t=this.view.environment.weather;t.type!=="rainy"&&t.type!=="snowy"||this._precipitation.render(e,t.precipitation,t.type)}}}updateLightSources(e,t,r,i){if(v(this._context)){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=t,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(e),i===kS.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return E(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeatherFading(e){if(!e.weatherFading)return;const t=e.cloudsFade;return t.fadeIn.stage===xc.FADE_IN?(e.fadeLighting(t.fadeIn.factor),void this._fadeWeather(t.fadeIn.factor)):t.fadeInOut.stage===Nn.FADE_IN?(e.fadeLighting(t.fadeInOut.factor),void this._fadeWeather(t.fadeInOut.factor)):t.crossFade.enabled?(e.fadeLighting(t.crossFade.factor),void this._fadeWeather(t.crossFade.factor)):(e.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(e){const{_newWeatherParameters:t,_oldWeatherParameters:r}=this;e>=1?this._weatherParameters=t:(this._fadedWeatherParameters.lerp(r,t,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;E(e)||E(this._clouds)||(this._clouds.applyPreset(ma[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){v(this._context)&&this._context.requestRender()}_updateFogHaze(){var r,i;const e=this._weatherUpdateParameters;if(E(this._fog)||E(this._simpleHaze)||E(e)||E(this._context))return;const t=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=Nt(3e-5,.005,e.weatherAdjustment**3),le(this._newWeatherParameters.fog.color,Sne),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===Dn.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Nt(4e-6,2e-4,((r=e.effect)!=null?r:0)**3),le(this._newWeatherParameters.fog.color,xZe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Nt(4e-6,2e-4,((i=e.effect)!=null?i:0)**3),le(this._newWeatherParameters.fog.color,Sne),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===Dn.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}t.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(e){const t=this._selectAtmosphereType(e);if(v(this._atmosphere)?this._atmosphere.type===t:t===Dn.None)return;this._atmosphere=Ve(this._atmosphere),this._hqAtmosphere=Ve(this._hqAtmosphere);const r=this._getAtmosphereClass(t);r&&v(this._context)&&(this._atmosphere=new r(this.view,this._context),t===Dn.Simple&&(this._hqAtmosphere=new b9(this.view,this._context))),this._setNeedsRender(),this._updateBasemapTerrain()}_getAtmosphereClass(e){switch(e){case Dn.Realistic:return b9;case Dn.Panoramic:return hYe;case Dn.Simple:return CYe;default:case Dn.None:return null}}_selectAtmosphereType(e){const{enabled:t,quality:r,viewingMode:i}=e;return!t||Mm(this.view.spatialReference)?Dn.None:i===Ge.Local?Dn.Panoramic:v(this._context)&&r==="high"&&b9.isSupported(this._context)&&sE(this.view.spatialReference)?Dn.Realistic:Dn.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===Dn.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:e=>{Ene=c3.prototype._getAtmosphereClass,c3.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{c3.prototype._getAtmosphereClass=Ene}}}};u([d({constructOnly:!0})],Kn.prototype,"view",void 0),u([d({readOnly:!0})],Kn.prototype,"atmosphere",null),u([d({readOnly:!0})],Kn.prototype,"_atmosphereType",null),u([d({type:Boolean,readOnly:!0})],Kn.prototype,"updating",null),u([d({readOnly:!0})],Kn.prototype,"weatherVisible",null),u([d()],Kn.prototype,"_context",void 0),u([d()],Kn.prototype,"_atmosphere",void 0),u([d()],Kn.prototype,"_hqAtmosphere",void 0),u([d({readOnly:!0})],Kn.prototype,"_stars",null),u([d({readOnly:!0})],Kn.prototype,"_precipitation",null),u([d({readOnly:!0})],Kn.prototype,"_clouds",null),u([d({readOnly:!0})],Kn.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Kn.prototype,"_fog",null),u([d({readOnly:!0})],Kn.prototype,"_simpleHaze",null),u([d({readOnly:!0})],Kn.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Kn.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Kn.prototype,"_weatherUpdateParameters",null),Kn=c3=u([P("esri.views.3d.environment.EnvironmentRenderer")],Kn);class L9{constructor(){this.fog=new CXe,this.haze=new MYe}copyFrom(t){this.fog.amount=t.fog.amount,this.haze.amount=t.haze.amount,this.fog.strength=t.fog.strength,this.haze.strength=t.haze.strength,le(this.fog.color,t.fog.color)}lerp(t,r,i){this.fog.amount=Nt(t.fog.amount,r.fog.amount,i),this.haze.amount=Nt(t.haze.amount,r.haze.amount,i),this.fog.strength=Nt(t.fog.strength,r.fog.strength,i),this.haze.strength=Nt(t.haze.strength,r.haze.strength,i),rn(this.fog.color,t.fog.color,r.fog.color,i)}}const xZe=Le(.5,.5,.5),Sne=Le(1.5,1.5,1.5);let Ene;function Cne(e,t,r){if(E(t.longitude)||E(t.latitude)||E(r.longitude)||E(r.latitude))throw new Error("Invalid points: no lon/lat");return TZe(e,t.longitude,t.latitude,r.longitude,r.latitude)}function TZe(e,t,r,i,s){const n=Gt(r),o=Gt(s),a=n-o,l=Gt(t)-Gt(i),c=Math.sin(a/2),h=Math.sin(l/2),p=2*Zh(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function SZe(e,t,r){const i=t.spatialReference,s=Zr(i),n=new yt(t.x,e.y,i),o=new yt(r.x,e.y,i),a=new yt(e.x,t.y,i),l=new yt(e.x,r.y,i);return{lon:Cne(s.radius,n,o),lat:Cne(s.radius,a,l)}}function EZe(e,t,r){const i=t/r,s=Gt(e),n=Math.sin(i/2),o=Math.cos(s),a=2*Zh(Math.sqrt(n*n/(o*o)));return nl(a)}function CZe(e,t){let r=e/15;return t||(r=Math.round(r)),r}function Ane(e,t){const r=e==null?void 0:e[0];if(r==null)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=CZe(r,!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const s=t.minutes%1;return t.minutes-=s,t.seconds=Math.round(60*s),t}var Rne,One,Mne,NH={},AZe={get exports(){return NH},set exports(e){NH=e}};Rne=AZe,One=function(){var e=Math.PI,t=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f(L){return L.valueOf()/l-.5+c}function m(L){return new Date((L+.5-c)*l)}function y(L){return f(L)-h}var _=23.4397*a;function b(L,N){return n(t(L)*r(_)-i(N)*t(_),r(L))}function x(L,N){return s(t(N)*r(_)+r(N)*t(_)*t(L))}function T(L,N,F){return n(t(L),r(L)*t(N)-i(F)*r(N))}function S(L,N,F){return s(t(N)*t(F)+r(N)*r(F)*r(L))}function C(L,N){return a*(280.16+360.9856235*L)-N}function O(L){return a*(357.5291+.98560028*L)}function R(L){return a*(1.9148*t(L)+.02*t(2*L)+3e-4*t(3*L))}function $(L,N){return L+N+102.9372*a+e}function I(L,N){var F=O(L),H=$(F,R(F));return N||(N={dec:0,ra:0}),N.dec=x(H,0),N.ra=b(H,0),N}var U={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(L,N,F,H){var X=a*-F,K=a*N,W=y(L),ue=I(W,p),pe=C(W,X)-ue.ra;return H||(H={azimuth:0,altitude:0}),H.azimuth=T(pe,K,ue.dec),H.altitude=S(pe,K,ue.dec),H}},V=[[-.83,"sunrise","sunset"]];U.addTime=function(L,N,F){V.push([L,N,F])};var G=9e-4;function z(L,N){return Math.round(L-G-N/(2*e))}function Z(L,N,F){return G+(L+N)/(2*e)+F}function Q(L,N,F){return h+L+.0053*t(N)-.0069*t(2*F)}function te(L,N,F){return o((t(L)-t(N)*t(F))/(r(N)*r(F)))}function q(L){var N=a*(134.963+13.064993*L),F=a*(93.272+13.22935*L),H=a*(218.316+13.176396*L)+6.289*a*t(N),X=5.128*a*t(F),K=385001-20905*r(N);return{ra:b(H,X),dec:x(H,X),dist:K}}return U.getTimes=function(L,N,F){var H=a*-F,X=a*N,K=z(y(L),H),W=Z(0,H,K),ue=O(W),pe=R(ue),we=$(ue,pe),Ce=x(we,0),qe=Q(W,ue,we);function Ne(Kt){return Q(Z(te(Kt,X,Ce),H,K),ue,we)}function xe(Kt){var Xt=(t(Kt)-t(X)*t(Ce))/(r(X)*r(Ce));return Xt<-1?U.PolarException.MIDNIGHT_SUN:Xt>1?U.PolarException.POLAR_NIGHT:U.PolarException.NORMAL}var Fe,ke,wt,et,Ft,Wt={solarNoon:m(qe),nadir:m(qe-.5),polarException:U.PolarException.NORMAL};for(Fe=0,ke=V.length;Fe<ke;Fe+=1)Ft=qe-((et=Ne((wt=V[Fe])[0]*a))-qe),Wt[wt[1]]=m(Ft),Wt[wt[2]]=m(et);return Wt.polarException=xe(V[0][0]*a),Wt},U.getMoonPosition=function(L,N,F){var H=a*-F,X=a*N,K=y(L),W=q(K),ue=C(K,H)-W.ra,pe=S(ue,X,W.dec);return pe+=.017*a/i(pe+10.26*a/(pe+5.1*a)),{azimuth:T(ue,X,W.dec),altitude:pe,distance:W.dist}},U.getMoonFraction=function(L){var N=y(L),F=I(N),H=q(N),X=149598e3,K=o(t(F.dec)*t(H.dec)+r(F.dec)*r(H.dec)*r(F.ra-H.ra)),W=n(X*t(K),H.dist-X*r(K));return(1+r(W))/2},U},(Mne=One())!==void 0&&(Rne.exports=Mne);const sx=NH,zf={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function RZe(e,t,r,i,s,n){ce(n.ambient.color,1,1,1),n.ambient.intensity=zf.global.ambient,ce(n.direct.color,1,1,1),n.direct.intensity=zf.global.direct;const o=t[2],a=ye((Math.abs(o)-zf.local.altitude)/(zf.global.altitude-zf.local.altitude),0,1);let l;if(n.globalFactor=a,v(e)&&(l=sx.getTimes(e,t[1],t[0])),a<1){let c;if(v(e))c=DZe(e,l,i);else{const h=_we(i);c={direct:{intensity:zf.local.directAtNoon*h.direct,color:Le(1,1,1)},ambient:{intensity:zf.local.ambientAtNoon*h.ambient,color:Le(1,1,1)},timeOfDay:"early afternoon"}}rn(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Nt(c.ambient.intensity,n.ambient.intensity,a),rn(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Nt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=v(e)?LZe(e,l):1,v(e)?OZe(e,t,r,n.direct.directionToLightSource):gwe(s,r,n.direct.directionToLightSource)}function gwe(e,t,r){t===Ge.Global?ve(D9,e.eye):ce(D9,0,0,1),ae(N9,e.viewForward,-1);const i=RD(N9,D9),s=Math.max(i-2*F9,0),n=.85*s/(s+1),o=Math.max(F9,i-F9-n);Vu(Ine,-o,e.viewRight),Ze(r,N9,Ine),me(r,r,ae(NZe,e.viewRight,FZe)),ve(r,r)}function OZe(e,t,r,i){const s=$Ze,n=td(IZe);if(r===Ge.Global)sx.getPosition(e,0,0,s),ce(i,0,0,-1),gE(n,n,-s.azimuth),e6(n,n,-s.altitude),Ze(i,i,n);else{const o=zf.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ye(c,0,1),c<1?(sx.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),ce(i,0,-1,0),yE(n,n,-s.azimuth),gE(n,n,-s.altitude),Ze(i,i,n)}}function MZe(e,t){if(t===Ge.Global)return!0;const r=zf.planarDirection;return Math.abs(e)<r.localAltitude}const PZe=Le(.5773502691896258,-.5773502691896258,.5773502691896258);class ywe{constructor(){this.ambient={color:Le(1,1,1),intensity:.55},this.direct={color:Le(1,1,1),intensity:.55,directionToLightSource:bs(PZe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const IZe=Ie(),$Ze={azimuth:0,altitude:0};function LZe(e,t){const r=e.valueOf();let i,s;t.polarException===sx.PolarException.MIDNIGHT_SUN?(i=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=i+432e6):t.polarException===sx.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=i+(s-i)/2;return 1-ye(Math.abs(r-n)/432e5,0,1)}function _we(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function Pne(e,t){const r=(e[0]+e[1]+e[2])/3;for(let i=0;i<3;i++)e[i]=e[i]+(r-e[i])*t;return e}function DZe(e,t,r){const i=e.valueOf();let s,n;t.polarException===sx.PolarException.MIDNIGHT_SUN?(s=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===sx.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,_=n+p/2,b=zf.local,x=[.01,b.ambientAtNight],T=[.8,.8,1],S=[.01,.01,.01],C=[b.directAtTwilight,b.ambientAtTwilight],O=[1,.6,.5],R=[.8,.8,1],$=[.9*b.directAtNoon,b.ambientAtNoon],I=[1,.98,.98],U=[.98,.98,1],V=[b.directAtNoon,b.ambientAtNoon],G=[1,1,1],z=[1,1,1],Z=$,Q=I,te=U,q=C,L=O,N=R;let F,H,X=[0,0],K=[0,0,0],W=[0,0,0];i<f||i>_?(X=x,K=S,W=T,H="night"):i<m?(F=m-f,X=qo(i-f,F,x,C),K=qo(i-f,F,S,O),W=qo(i-f,F,T,R),H="sun rising"):i<c?(F=c-m,X=qo(i-m,F,C,$),K=qo(i-m,F,O,I),W=qo(i-m,F,R,U),H="early morning"):i<a?(F=a-c,X=qo(i-c,F,$,V),K=qo(i-c,F,I,G),W=qo(i-c,F,U,z),H="late morning"):i<h?(F=h-a,X=qo(i-a,F,V,Z),K=qo(i-a,F,G,Q),W=qo(i-a,F,z,te),H="early afternoon"):i<y?(F=y-h,X=qo(i-h,F,Z,q),K=qo(i-h,F,Q,L),W=qo(i-h,F,te,N),H="late afternoon"):i<_&&(F=_-y,X=qo(i-y,F,q,x),K=qo(i-y,F,L,S),W=qo(i-y,F,N,T),H="sun setting");let ue=0;switch(r){case"rainy":case"foggy":case"snowy":ue=.5}ue>0&&(K=Pne(K,ue),W=Pne(W,ue));const pe=Le(K[0],K[1],K[2]),we=Le(W[0],W[1],W[2]),Ce=_we(r);return{direct:{intensity:X[0]*Ce.direct,color:pe},ambient:{intensity:X[1]*Ce.ambient,color:we},timeOfDay:H}}function qo(e,t,r,i){const s=[];for(let n=0;n<r.length;n++)s[n]=(i[n]-r[n])*e/t+r[n];return s}const Ine=Ie(),D9=M(),N9=M(),NZe=M(),F9=.25,FZe=.2;let Vd=class extends Vs.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Jr,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new y4,this._ambientLight=new eJ,this._moonLight=new Ybe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,t,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(t=this._view)==null?void 0:t.state)==null?void 0:r.viewingMode)===Ge.Global&&sE(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Kn({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this._viewHandles.add([se(()=>e.environment.lighting,i=>this._updateLightingHandler(i),ri),se(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,i=>this._lightingDateHandler(i),ri),se(()=>e.stationary,()=>this._interactingStationaryHandler()),se(()=>e.environment.lighting.directShadowsEnabled,t,ri),se(()=>e.environment.lighting.ambientOcclusionEnabled,t,ri),se(()=>e.environment.lighting.waterReflectionEnabled,t,ri),se(()=>{var i;return(i=e.environment.background)==null?void 0:i.color},t,ri),se(()=>e.spatialReference,()=>this._resetReferencePosition(!0),ri),se(()=>e.environment.weather.type,()=>this._updateLighting(null,kS.Faded),ri),se(()=>this.weatherEnabled,()=>this._updateLighting(null,kS.Faded),ri),se(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Ys),se(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,i=>this._updateCameraTracking(i),Ys),se(()=>e.state.camera,r,Ys),se(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Ve(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)!=="virtual"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Nw(r)){const i=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(i))return void this._requestReferencePositionUpdate(i)}if(this._preupdateTracking(e),v(this._referencePosWGS84Comparable)){const i=Ane(this._referencePosWGS84Comparable,$ne);v(i)&&(t.autoUpdate(null,i),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,t){var s,n,o;const r=sE(this._view.spatialReference);if(r&&!Nw(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const i=e.position;return E(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=M()),r?SLe(i,this._referencePosWGS84Comparable):ce(this._referencePosWGS84Comparable,(s=i.longitude)!=null?s:0,(n=i.latitude)!=null?n:0,(o=i.z)!=null?o:0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){var r;const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=((r=t.z)!=null?r:0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,t=kS.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const i=this._referencePosWGS84Comparable,s=v(i)?UZe:kZe,n=this.weatherVisible?r.environment.weather.type:"disabled";v(i)?RZe(e,i,r.state.viewingMode,n,r.state.camera,s):r.environment.lighting.type==="virtual"&&gwe(r.state.camera,r.state.viewingMode,s.direct.directionToLightSource);const o=this._mainLight,a=s.direct;ae(o.intensity,a.color,a.intensity*Math.PI),le(o.direction,a.directionToLightSource),o.specularStrength=s.specularStrength,o.environmentStrength=s.environmentStrength;const l=this._ambientLight;ae(l.intensity,s.ambient.color,s.ambient.intensity);const c=this._moonLight;rn(c.intensity,BZe,zZe,s.globalFactor);const h=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));ae(c.intensity,c.intensity,h),le(c.direction,a.directionToLightSource),this._renderer.updateLightSources([o,l,c],s.noonFactor,s.globalFactor,t),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||E(e))return!1;const r=VZe;r.setTime((t||this._view.environment.lighting.date).getTime());const i=Ane(e,$ne);if(E(i))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===i.hours&&s.minutes===i.minutes&&s.seconds===i.seconds)return!1}else s=i;const n=r.getUTCHours()-(i.hours-s.hours),o=r.getUTCMinutes()-(i.minutes-s.minutes),a=r.getUTCSeconds()-(i.seconds-s.seconds);return r.setUTCHours(n),r.setUTCMinutes(o),r.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(r,i)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=Tu(this._referencePosWGS84Comparable,!0,s=>MZe(s[2],this._view.state.viewingMode)),r=this._view.environment.background,i=r instanceof rbe?{type:"color",color:tY(Qe.toUnitRGBA(r.color))}:{type:"color",color:Ht(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=Ew(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const s=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),i=this._referencePosUpdateTimer=Ew(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===i&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){var r;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const i=((r=this._referencePosMapCoords.z)!=null?r:0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[t[0],t[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([d({type:Boolean,readOnly:!0})],Vd.prototype,"updating",null),u([d()],Vd.prototype,"disableQueries",void 0),u([d()],Vd.prototype,"_disableWeather",void 0),u([d()],Vd.prototype,"weatherEnabled",null),u([d()],Vd.prototype,"weatherVisible",null),u([d()],Vd.prototype,"referencePositionWGS84Comparable",null),u([d()],Vd.prototype,"_renderer",void 0),u([d()],Vd.prototype,"_referencePosWGS84Comparable",void 0),Vd=u([P("esri.views.3d.environment.SceneViewEnvironmentManager")],Vd);const UZe=new ywe,kZe=new ywe,VZe=new Date,$ne={hours:0,minutes:0,seconds:0},BZe=Le(.22,.22,.33),zZe=Le(.22,.22,.22);var Bi;(function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Bi||(Bi={}));var nr;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(nr||(nr={}));var go;(function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"})(go||(go={}));function wM(e,t){return(e&t)!=0}function T4(e,t,r,i,s,n){e!==0&&(r?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):i!=null?(n.min-=Math.max(0,(t-n.min)*(1-i)),n.max+=Math.max(0,(t-n.max)*(1-i))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}const Sv={selection:Bi.NONE,interactionType:nr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:go.TUMBLE};function vwe(e,t,r,i){return t=t||e.viewForward,le(i,t),ae(i,i,Math.sign(_e(t,r))),i}function GZe(e,t,r,i){return XZe(e,t,r,qZe(i,t,r,!0))}function jZe(e,t,r,i){const s=_e(r,ge(e,i,t));return me(e,t,ae(e,r,s))}const HZe={dir:M(),len:0,clip:Ke()};function qZe(e,t,r,i){const s=HZe;return e?(r&&i&&(s.len=Ai(t,r)),le(s.dir,e)):i?(s.len=Ai(t,r),ge(s.dir,r,t),ae(s.dir,s.dir,1/s.len)):(ge(s.dir,r,t),ve(s.dir,s.dir)),s}function WZe(e,t,r){const i=_e(e,r.dir),s=-Ei(e,t);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function XZe(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!WZe(e[s],t,i))return!1;return!0}function YZe(e,t,r=Sv){const i=pJ(e,t,r);if(i===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+i,o=vwe(t,r.interactionDirection,QZe(e,t,Math.sign(i),rJe),tJe),a=le(iJe,t.viewForward),l=s.intersectInfiniteManifold(zu(t.eye,o),n,U9);return t.eye=v(l)?l:s.setAltitude(U9,n,t.eye),t.center=jZe(U9,t.eye,a,t.center),!0}function pJ(e,t,r=Sv){if(!ZZe(e,r)||!e.state.constraints.altitude)return 0;const i=KZe(e.state.constraints.altitude,eJe);JZe(e,r,i);const s=e.renderCoordsHelper.getAltitude(t.eye),n=ye(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function ZZe(e,t){const r=e.state.constraints.altitude;return!(!e.state.isGlobal||!r)&&(t.interactionType!==nr.TUMBLE||!wM(t.selection,Bi.TILT))}function JZe(e,t,r){const i=t.interactionType;if(i===nr.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=i===nr.TUMBLE||i===nr.ZOOM,c=pJ(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,T4(c,h,l,a,.05*h,r)}function QZe(e,t,r,i){return e.renderCoordsHelper.worldUpAtPosition(t.eye,i),ae(i,i,r),i}function KZe(e,t){return t.min=e.min,t.max=e.max,t}const eJe={min:0,max:0},tJe=M(),rJe=M(),iJe=M(),U9=M();function fJ(e,t,r=Sv){if(!e.state.isLocal)return 0;const i=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;f$.min=0,f$.max=i,nJe(e,r,f$);const s=mJ(e,t),n=f$.max-s;return n>=-1e-6?0:n}function sJe(e,t,r=Sv){const i=fJ(e,t,r);if(i===0)return!1;const s=e.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=mJ(e,t)+i,o=le(aJe,t.eye),a=vwe(t,r.interactionDirection,oJe(t,s.renderLocation,uJe),cJe);if(!Uv(Fge(s.renderLocation,n),zu(t.eye,a),m$))return!1;t.eye=m$;const l=ge(lJe,t.eye,o);t.center=me(m$,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,m$);return v(h)&&(t.center=h),!0}function nJe(e,t,r){const i=t.interactionType;if(i===nr.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=t;if(!o)return;const l=i===nr.ZOOM||i===nr.PAN,c=fJ(e,o),h=c===0?0:mJ(e,o);r.min=s,r.max=n,T4(c,h,l,a,.05*h,r)}function mJ(e,t){const r=e.pointsOfInterest.surfaceOrigin;return r.renderLocation?Ai(t.eye,r.renderLocation):0}function oJe(e,t,r){return Cy(r,e.eye,t)}const f$={min:0,max:0},aJe=M(),lJe=M(),cJe=M(),uJe=M(),m$=M();var ss,Bo;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(ss||(ss={}));class hJe{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Bo.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(Bo||(Bo={}));class dJe{constructor(t,r,i){this.object=t,this.geometryId=r,this.triangleNr=i}}class pJe extends dJe{constructor(t,r,i,s){super(t,r,i),this.center=v(s)?bs(s):null}}class bwe{constructor(t){this.layerUid=t}}class tU extends bwe{constructor(t,r){super(t),this.graphicUid=r}}function zp(e){return v(e)&&v(e.dist)}function Lne(e){return(t,r,i)=>(rn(Dne,t,r,i),!uY(e,Dne))}function rU(e){return zp(e)&&e.intersector===ss.OBJECT&&!!e.target}function iU(e){return zp(e)&&e.intersector===ss.HUD&&!!e.target&&"center"in e.target&&v(e.target.center)}const Dne=M();class fJe{constructor(){this._transform=Ie(),this._transformInverse=new g$({value:this._transform},ko,Ie),this._transformInverseTranspose=new g$(this._transformInverse,kc,Ie),this._transformTranspose=new g$({value:this._transform},kc,Ie),this._transformInverseRotation=new g$({value:this._transform},Nbe,ns)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Hn(this._transform,t)}multiplyTransform(t){ws(this._transform,this._transform,t)}set(t){Hn(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,r){this.setTransformMatrix(t),this.multiplyTransform(r),this._invalidateLazyTransforms()}}class g${constructor(t,r,i){this._original=t,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}class mJe{constructor(t=0){this.offset=t,this.tmpVertex=M()}applyToVertex(t,r,i){const s=t+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)n0[n]=t[0+n]+this.localOrigin[n],y$[n]=t[3+n]+this.localOrigin[n],Zx[n]=n0[n];const r=this.applyToVertex(n0[0],n0[1],n0[2]);for(let n=0;n<3;++n)t[n]=r[n],t[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)Zx[o]=(n&1<<o)==0?n0[o]:y$[o];i(Zx)}let s=0;for(let n=0;n<3;++n)n0[n]*y$[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?Zx[o]=0:Zx[o]=(n&1<<o)!=0?n0[o]:y$[o];i(Zx)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const n0=M(),y$=M(),Zx=M();class gJe{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=M(),this._mbs=pn(),this._obb={center:M(),halfSize:qi(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,r,i){const s=t,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(t){const r=t[0],i=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return t[0]-=r<0?this._totalOffset:0,t[1]-=i<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const f=Math.max(Math.abs(r),Math.abs(n)),m=Math.max(Math.abs(i),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(f*f+m*m+y*y),b=this._totalOffset/_,x=this._totalOffset/p;return t[0]+=r*(r>0?b:x),t[1]+=i*(i>0?b:x),t[2]+=s*(s>0?b:x),t[3]+=n*(n<0?b:x),t[4]+=o*(o<0?b:x),t[5]+=a*(a<0?b:x),t}applyToMbs(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this._totalOffset/r;return this._mbs[0]=t[0]+t[0]*i,this._mbs[1]=t[1]+t[1]*i,this._mbs[2]=t[2]+t[2]*i,this._mbs[3]=t[3]+t[3]*this._totalOffset/r,this._mbs}applyToObb(t){const r=t.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,bp(this._obb.halfSize,t.halfSize,t.quaternion),me(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,ge(this._obb.halfSize,this._obb.halfSize,t.center),ix(kne,t.quaternion),bp(this._obb.halfSize,this._obb.halfSize,kne),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class yJe{constructor(t=0){this.offset=t,this.sphere=pn(),this.tmpVertex=M()}applyToVertex(t,r,i){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*r+s[8]*i+s[12],o=s[1]*t+s[5]*r+s[9]*i+s[13],a=s[2]*t+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,r){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(t){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/r;return this.sphere[0]=t[0]+t[0]*i,this.sphere[1]=t[1]+t[1]*i,this.sphere[2]=t[2]+t[2]*i,this.sphere[3]=t[3]+t[3]*this.offset/r,this.sphere}}const Nne=new yJe;function FH(e){return v(e)?(Nne.offset=e,Nne):null}const Fne=new gJe;function _Je(e){return v(e)?(Fne.offset=e,Fne):null}const Une=new mJe;function vJe(e){return v(e)?(Une.offset=e,Une):null}const E_="terrain",kne=cd(),YE=1e-5;class bJe{constructor(t){this.options=new hJe,this._results=new wJe,this.transform=new fJe,this.tolerance=YE,this.verticalOffset=null,this._ray=co(),this._rayEnd=M(),this._rayBeginTransformed=M(),this._rayEndTransformed=M(),this.viewingMode=t!=null?t:Ge.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,r,i){this.resetWithRay(JLe(t,r,this._ray),i)}resetWithRay(t,r){this.camera=r,t!==this._ray&&LF(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ge.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,me(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i!=null?i:YE;const o=FH(this.verticalOffset);if(v(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();v(c)?(v(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const r=t.geometries;if(!r)return;const i=t.transformation,s=FH(this.verticalOffset);for(const n of r){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),Ze(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ze(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;v(s)&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,p,f,m,y)=>{if(c>=0){if(v(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=f?this._results.hud:this._results,b=f?x=>{const T=new pJe(t,a,p,y);x.set(ss.HUD,T,c,h,Bu,m)}:x=>x.set(ss.OBJECT,{object:t,geometryId:a,triangleNr:p},c,h,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&b(_.min),this.options.store!==Bo.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&b(_.max),this.options.store===Bo.ALL)if(f){const x=new UH(this._ray);b(x),this._results.hud.all.push(x)}else{const x=new VS(this._ray);b(x),this._results.all.push(x)}}})}}sortResults(t=this._results.all){t.sort((r,i)=>r.dist!==i.dist?Pt(r.dist,0)-Pt(i.dist,0):r.drapedLayerOrder!==i.drapedLayerOrder?Pt(r.drapedLayerOrder,Number.MAX_VALUE)-Pt(i.drapedLayerOrder,Number.MAX_VALUE):Pt(i.drapedLayerGraphicOrder,Number.MIN_VALUE)-Pt(r.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function od(e){return new bJe(e)}class wJe{constructor(){this.min=new VS(co()),this.max=new VS(co()),this.hud={min:new UH(co()),max:new UH(co()),all:new Array},this.ground=new VS(co()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class VS{get ray(){return this._ray}get distanceInRenderSpace(){return v(this.dist)?(ae(_$,this.ray.direction,this.dist),Me(_$)):null}getIntersectionPoint(t){return!!zp(this)&&(ae(_$,this.ray.direction,this.dist),me(t,this.ray.origin,_$),!0)}getTransformedNormal(t){return le(mA,this.normal),mA[3]=0,Mu(mA,mA,this.transformation),le(t,mA),ve(t,t)}constructor(t){this.intersector=ss.OBJECT,this.normal=M(),this.transformation=Ie(),this._ray=co(),this.init(t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=ss.OBJECT,LF(t,this._ray)}set(t,r,i,s,n,o,a){this.intersector=t,this.dist=i,le(this.normal,Pt(s,Hhe)),Hn(this.transformation,Pt(n,Bu)),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){LF(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,le(this.normal,t.normal),Hn(this.transformation,t.transformation)}}class UH extends VS{constructor(){super(...arguments),this.intersector=ss.HUD}}function gJ(e){return new VS(e)}const _$=M(),mA=sr();function wwe(e,t,r,i){return v(e.renderCoordsHelper.fromRenderCoords(t.eye,S4,i))&&Rfe(r,S4)}function sU(e,t){return e.elevationProvider?Pt(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function Rx(e,t,r,i){const s=e.state.camera.clone();t&&r&&i&&(s.eye=t,s.center=r,s.up=i),xJe(e,s.ray,o0)||le(o0,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(jn(s.eye,o0)<o){const a=n.collision.enabled;le(i1,s.viewForward),ae(i1,i1,o),a?s.eye=ge(S4,o0,i1):me(o0,s.eye,i1);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(ge(i1,o0,s.eye),s.eye=l.setAltitude(S4,h,s.eye),me(o0,s.eye,i1))}return s.center=o0,s}function Vne(e,t,r){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const i=sU(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,r,e.renderDataExtent,i,SJe),o=n*n;return jn(t,r)>o}function xJe(e,t,r){let i=Bne[e.viewingMode];i||(i=od(e.state.viewingMode),i.options.backfacesTerrain=!e.state.isGlobal,i.options.invisibleTerrain=!0,Bne[e.viewingMode]=i);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,i,r)||Vne(e,t.origin,r))||!(!e.renderCoordsHelper.intersectManifold(t,0,r)||Vne(e,t.origin,r))||!!s&&TJe(t,r,Zr(e.spatialReference).radius)}function TJe(e,t,r){const i=_e(e.origin,e.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return ae(t,e.direction,s/Me(e.direction)),me(t,t,e.origin),!0}const Bne={},S4=M(),o0=M(),i1=M(),SJe={near:0,far:0};function NC(e,t,r=zh.EYE){const i=e.state.constraints;if(!i.collision.enabled)return!1;const s=sU(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Me(t.eye);if(ge(v$,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(EJe,o,t.eye),r===zh.EYE_AND_CENTER)t.center=me(v$,t.eye,v$);else if(r===zh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=ae(v$,t.center,l)}return!0}var zh;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(zh||(zh={}));const v$=M(),EJe=M();function Ev(e,t,r){e.worldUpAtPosition(t,zne),ge(k9,r,t);const i=Me(k9);return i===0?0:Mn(_e(k9,zne)/i)}const zne=M(),k9=M();function xwe(e,t,r=Sv,i=!0){gA.eyeCenterDistance=0,gA.requiresTwoSteps=!1;const s=yJ(e,t,r,void 0,gA);if(s===0)return!1;switch(Vu(b$,-s,t.viewRight),r.tiltMode){case go.LOOK_AROUND:Ze(a0,t.viewForward,b$),ae(a0,a0,gA.eyeCenterDistance),t.center=me(C_,t.eye,a0);break;case go.TUMBLE:ge(a0,t.center,t.eye),Ze(a0,a0,b$),t.eye=ge(C_,t.center,a0);break;default:r.tiltMode}return t.up=Ze(C_,t.up,b$),!gA.requiresTwoSteps||!i||xwe(e,t,r,!1)}function yJ(e,t,r=Sv,i=Sv,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,DJe);return LJe(e,r,o),i.interactionType===nr.TUMBLE&&wM(i.selection,Bi.ALTITUDE)&&Twe(e,i.interactionStartCamera,o),r.tiltMode===go.LOOK_AROUND||i.tiltMode===go.LOOK_AROUND?AJe(e,t,o,s):CJe(e,t,o)}function CJe(e,t,r){const i=Ev(e.renderCoordsHelper,t.center,t.eye),s=i-ye(i,r.min,r.max);return xM(s)?s:0}function AJe(e,t,r,i){switch(i&&(i.requiresTwoSteps=!1),e.viewingMode){case"global":return OJe(e,t,r,i);case"local":return RJe(e,t,r,i)}}function RJe(e,t,r,i){const s=Ev(e.renderCoordsHelper,t.center,t.eye),n=ye(s,r.min,r.max),o=s-n;if(!xM(o))return 0;if(i){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=t.distance}return o}function OJe(e,t,r,i){const s=MJe(e,t,NJe),n=ye(s.tiltAtCenter,r.min,r.max);if(!xM(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=PJe(s),a=IJe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=$Je(s,o)),i&&(i.eyeCenterDistance=kH(s,o)),a}function MJe(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Zr(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,i,C_);return r.eyeCenterDistance=t.distance,r.centerIsOnSurface=!1,v(n)?(r.eyeCenterDistance=Ai(t.eye,n),r.tiltAtCenter=Ev(e.renderCoordsHelper,n,t.eye),r.centerIsOnSurface=!0):e.state.isLocal?r.tiltAtCenter=Ev(e.renderCoordsHelper,t.center,t.eye):(wC(o6(a6,s),t.ray,C_),r.eyeCenterDistance=Ai(t.eye,C_),r.tiltAtCenter=Mn(-_e(t.viewForward,ve(C_,C_)))),r.radius=s,r.eyeRadius=Me(t.eye),r.constraints=e.state.constraints,r}function xM(e){return Math.abs(e)>1e-9}function PJe(e){const{constraints:t,eyeCenterDistance:r,tiltAtCenter:i}=e;let s=i,n=t.clampTilt(r,i);const o=kH(e,n);if(t.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&xM(n-s);){const l=(s+n)/2,c=kH(e,l);xM(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function kH(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const r=Math.PI-ye(t,0,Math.PI),i=Zh(e.radius/e.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*e.eyeRadius}return n*e.eyeRadius}function IJe(e,t){const r=Zh(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),i=Zh(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?r-i:i-r}function $Je(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function LJe(e,t,r){if(t.interactionType===nr.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=t;if(!i)return;const{min:n,max:o}=r,a=yJ(e,i,Sv,t),l=a===0?0:Ev(e.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,t.interactionType===nr.TUMBLE?(wM(t.selection,Bi.ALTITUDE)&&Twe(e,i,r),T4(a,l,!0,s,Gne,r)):T4(a,l,!1,s,Gne,r)}function Twe(e,t,r){const i=e.state.constraints;if(e.state.isLocal||!i.altitude||!t)return;const s=ba(t.center),n=Math.sqrt(s),o=t.distance,a=Zr(e.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-Mn(p),r.max)),r.max=Math.min(r.max,Math.PI-Mn(h))}const a0=M(),b$=Ie(),C_=M(),Gne=Gt(5),DJe={min:0,max:0},NJe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},gA={eyeCenterDistance:0,requiresTwoSteps:!1};function FJe(e){return e}const nU=e=>e*e,_J=e=>1-nU(1-e),UJe=e=>e<.5?nU(2*e)/2:(_J(2*(e-.5))+1)/2,vJ=e=>e*e*e,Swe=e=>1-vJ(1-e),Ewe=e=>e<.5?vJ(2*e)/2:(Swe(2*(e-.5))+1)/2,bJ=e=>e*e*e*e,Cwe=e=>1-bJ(1-e),kJe=e=>e<.5?bJ(2*e)/2:(Cwe(2*(e-.5))+1)/2,wJ=e=>e*e*e*e*e,Awe=e=>1-wJ(1-e),VJe=e=>e<.5?wJ(2*e)/2:(Awe(2*(e-.5))+1)/2,xJ=e=>1-Math.cos(e*Math.PI/2),Rwe=e=>1-xJ(1-e),BJe=e=>e<.5?xJ(2*e)/2:(Rwe(2*(e-.5))+1)/2,TJ=e=>2**(10*(e-1)),VP=e=>1-TJ(1-e),zJe=e=>e<.5?TJ(2*e)/2:(VP(2*(e-.5))+1)/2,SJ=e=>-(Math.sqrt(1-e*e)-1),Owe=e=>1-SJ(1-e),GJe=e=>e<.5?SJ(2*e)/2:(Owe(2*(e-.5))+1)/2;function hd(e){const t=2*(e-Math.sqrt((e-1)*e)),r=t/2/e;return i=>i<r?e*i*i:t*i-t+1}function dd(e,t){return(r,i)=>r<t?t*e(r/t,i):1-e((1-r)/(1-t),i)*(1-t)}const jJe=dd(hd(1),1),HJe=dd(hd(1),0),Mwe=dd(hd(1),.5),qJe=dd(hd(2),1),WJe=dd(hd(2),0),XJe=dd(hd(2),.5),YJe=dd(hd(3),1),ZJe=dd(hd(3),0),JJe=dd(hd(3),.5),QJe=dd(hd(4),1),KJe=dd(hd(4),0),eQe=dd(hd(4),.5),tQe={linear:FJe,"in-quad":nU,"out-quad":_J,"in-out-quad":UJe,"in-coast-quad":jJe,"out-coast-quad":HJe,"in-out-coast-quad":Mwe,"in-cubic":vJ,"out-cubic":Swe,"in-out-cubic":Ewe,"in-coast-cubic":qJe,"out-coast-cubic":WJe,"in-out-coast-cubic":XJe,"in-quart":bJ,"out-quart":Cwe,"in-out-quart":kJe,"in-coast-quart":YJe,"out-coast-quart":ZJe,"in-out-coast-quart":JJe,"in-quint":wJ,"out-quint":Awe,"in-out-quint":VJe,"in-coast-quint":QJe,"out-coast-quint":KJe,"in-out-coast-quint":eQe,"in-sine":xJ,"out-sine":Rwe,"in-out-sine":BJe,"in-expo":TJ,"out-expo":VP,"in-out-expo":zJe,"in-circ":SJ,"out-circ":Owe,"in-out-circ":GJe};function Zs(e,t,r=nQe,i=t){i!==t&&i.copyFrom(t),i.computeUp(e.state.viewingMode);let s=!1;for(let a=0;a<oQe;a++){let l=0;for(const c of sQe)if(wM(r.selection,c.type)){const h=Math.abs(c.error(e,i,r));c.apply(e,i,r)&&(s=!0,l+=h)}if(l===0)break}const n=wM(r.selection,Bi.COLLISION),o=rQe(r.interactionType,e);return n&&NC(e,i,o)&&(s=!0),s&&i.computeUp(e.state.viewingMode),s}function rQe(e,t){switch(e){case nr.PAN:return zh.EYE_AND_CENTER;case nr.ASCEND:return t.state.isGlobal?zh.EYE_AND_CENTER_SCALE:zh.EYE_AND_CENTER;default:return zh.EYE}}function np(e){const t=Math.min(1,e/150);return Ewe(t)}function iQe(e,t,r){return yJ(e,t,r)*t.distance}const sQe=[{type:Bi.TILT,error:iQe,apply:xwe},{type:Bi.ALTITUDE,error:pJ,apply:YZe},{type:Bi.DISTANCE,error:fJ,apply:sJe}],nQe={selection:Bi.ALL,interactionType:nr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:go.TUMBLE},oQe=5,Xc=M(),Kl=M(),l0=M(),ha=M(),s1=M(),aQe=M(),Yc={upward:Le(0,0,1),forward:Le(0,1,0),sideway:Le(1,0,0)},jne=ns();class Hne{constructor(t=Ge.Global){this.viewingMode=t,this.center=M(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=bs(Yc.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ge.Global){const n=(Me(this.center)+Me(t.center))/2;r.pan=RD(this.center,t.center)*n}else r.pan=Ai(this.center,t.center);let i=Math.abs(t.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(t.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=t.distance,r}interpolate(t,r,i){this.viewingMode===Ge.Global?pDe(t.center,r.center,i.pan,this.center):rn(this.center,t.center,r.center,i.pan),this.distance=isFinite(r.distance)?Nt(t.distance,r.distance,i.zoom):t.distance,this.pitch=Nt(t.pitch,r.pitch,i.rotate);let s=t.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=Nt(s,n,i.rotate)}copyFrom(t){le(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,le(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const r=this._lookAtOrientation(t.center,jne);le(this.center,t.center),ge(ha,t.center,t.eye),Mc(ha,ha,r),Mc(s1,t.up,r),this.distance=Me(ha),this.distance!==0&&(ha[0]/=this.distance,ha[1]/=this.distance,ha[2]/=this.distance),this.pitch=this._eyeUpToPitch(ha),this.yaw=this._eyeUpToYaw(ha,s1),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const r=this._lookAtOrientation(this.center,jne);sd(r,r),this._axisAngleVec3(Yc.sideway,this.pitch-Math.PI/2,Yc.forward,ha),this._axisAngleVec3(Yc.upward,this.yaw,ha),this._axisAngleVec3(Yc.sideway,this.pitch-Math.PI/2,Yc.upward,s1),this._axisAngleVec3(Yc.upward,this.yaw,s1),ae(ha,ha,this.distance),Mc(ha,ha,r),Mc(s1,s1,r),t.center=this.center,t.eye=ge(ha,this.center,ha),t.up=s1}_axisAngleVec3(t,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return ae(Xc,i,n),dt(Kl,t,i),ae(Kl,Kl,o),ae(l0,t,(1-n)*_e(t,i)),me(s,me(s,Xc,Kl),l0)}_lookAtOrientation(t,r=ns()){return this._upAtLookAt(t,l0),dt(Xc,this.lookAtDirection,l0),ve(Xc,Xc),Xc[0]===0&&Xc[1]===0&&Xc[2]===0&&le(Xc,Yc.sideway),dt(Kl,l0,Xc),ve(Kl,Kl),r[0]=Xc[0],r[1]=Kl[0],r[2]=l0[0],r[3]=Xc[1],r[4]=Kl[1],r[5]=l0[1],r[6]=Xc[2],r[7]=Kl[2],r[8]=l0[2],r}_upAtLookAt(t,r){return this.viewingMode===Ge.Local?le(r,Yc.upward):ve(r,t)}_eyeUpToPitch(t){return Math.PI-RD(Yc.upward,t)}_eyeUpToYaw(t,r){const i=aQe;return Math.abs(r[2])<.5?(le(i,r),t[2]>0&&ae(i,i,-1)):le(i,t),dt(Kl,i,Yc.upward),ve(Kl,Kl),RD(Yc.sideway,Kl,Yc.upward)}}const E4={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class EJ{constructor(t){this._createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:E4.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new EJ(this._createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,r,i){this.source!==t&&this.source.copyFrom(t),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:E4.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const r=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}let lQe=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,t)=>e+t.time,0)}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,i=0;const s=this.definition;for(let n=0;n<this.segments.length;n++){const o=this.segments[n],a=o.definition;if(e<=o.time||n===this.segments.length-1){if(t=this.segmentInterpolateComponentsAt(o,o.time===0?0:e/o.time,t),s.hasPan&&!isNaN(t.pan)&&isFinite(s.compared.pan)?t.pan=(r+a.compared.pan*t.pan)/s.compared.pan:t.pan=1,s.hasRotate&&!isNaN(t.rotate)&&isFinite(s.compared.rotate)?t.rotate=(i+a.compared.rotate*t.rotate)/s.compared.rotate:t.rotate=1,s.hasZoom&&!isNaN(t.zoom)&&isFinite(a.compared.targetZoom)){const l=t.zoom*(a.compared.targetZoom-a.compared.sourceZoom)+a.compared.sourceZoom,c=this.segments[0].definition.compared.sourceZoom,h=this.segments[this.segments.length-1].definition.compared.targetZoom;t.zoom=(l-c)/(h-c)}else t.zoom=1;return t}e-=o.time,r+=a.compared.pan,i+=a.compared.rotate}}segmentInterpolateComponentsAt(e,t,r){return e.interpolateComponentsAt(t,r)}};class V9{get time(){return this._time}constructor(t){t&&this.update(t)}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,r=t.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*t.source.pixelsPerPanAtZoom(i);const n=(t.source.pixelsPerRotateAtZoom(i)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=t*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-t-r)/(i-r)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*t*this._time)-1))/(r*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,r){t=Math.min(Math.max(t,0),1);const i=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}}function cQe(e,t,r){const i=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(i);return-e.halfWindowSize*(r.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function uQe(e,t,r){const i=1/t,s=Math.log(e.compared.sourceZoom*i),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*i*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function hQe(e,t,r){const i=t-e.compared.sourceZoom,s=1/i,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(i))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function dQe(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function pQe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function fQe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function mQe(e,t,r){return-e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function gQe(e,t,r){return e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function yQe(e,t,r){return-2*e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function _Qe(e,t,r){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function vQe(e,t,r){const i=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*i*s*n*a+e.halfWindowSize*i*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function bQe(e,t,r){const i=t-e.compared.targetZoom,s=1/i,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+r.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function wQe(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function xQe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function TQe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function SQe(e){const t=Math.LN2*e.compared.pan,r=e.compared.sourceZoom-e.compared.targetZoom,i=e.halfWindowPanAtZoom(r),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*i);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-i):s*(t+i)}function EQe(e,t){let r=CQe(e,t);const i={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?dQe:cQe,a=s?pQe:uQe,l=s?fQe:hQe,c=n?wQe:_Qe,h=n?xQe:vQe,p=n?TQe:bQe,f=C=>o(e,C,i)+mQe(e,C,i)+c(e,C,i),m=C=>a(e,C,i)+gQe(e,C,i)+h(e,C,i),y=C=>l(e,C,i)+yQe(e,C,i)+p(e,C,i);let _=f(r);const b=SQe(e);let x;const T=t.maximumIterations||20,S=t.maximumDistance!=null?t.maximumDistance:1/0;for(x=0;x<T;x++){const O=(m(r)+1e-6)/y(r);if(isNaN(O)||r>=S&&O<0){if(!isFinite(S))return null;r=S,_=f(r);break}if(r-=O,r<e.compared.sourceZoom||r<e.compared.targetZoom)return null;const R=f(r);if(Math.abs(R-_)/_<=.005)break;_=R}return _>b*(1-.3)||r<e.compared.sourceZoom||r<e.compared.targetZoom?null:r}function CQe(e,t){const r=Math.max(e.compared.sourceZoom,e.compared.targetZoom),i=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return i<r?t.maximumDistance!=null?r+(t.maximumDistance-r)/2:1.5*r:t.maximumDistance?Math.min(t.maximumDistance,i):i}class AQe extends lQe{constructor(t,r){super(),this._preallocSegments=[new V9,new V9,new V9],this._ascensionSegment=null,this._descensionSegment=null,this.update(t,r)}update(t,r){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let i=null;r&&r.apex&&(i=EQe(t,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(t,r,i){return i=t.interpolateComponentsAt(r,i),t===this._ascensionSegment?i.zoom=_J(i.zoom):t===this._descensionSegment&&(i.zoom=nU(i.zoom)),i}_updateWithApex(t,r){var c;const[i,s,n]=this._preallocSegments,o=(c=r==null?void 0:r.ascensionFactor)!=null?c:.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=t,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const RQe={zoom:0,pan:0,rotate:0};let OQe=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new EJ(e),this.path=new AQe}update(e,t,r){this.definition.update(e,t,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(xde(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing?r.easing:this._time>=1e3?Mwe:VP}cameraAt(e,t){t=t||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,RQe);return t.interpolate(this.definition.source,this.definition.target,r),t}_normalizedEasing(e){const t=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(r-t)}_applyTimeSettings(e,t){const r=t.speedFactor!=null?t.speedFactor:1;t.duration!=null?e=t.duration:t.speedFactor!=null&&(e=e/r);const i=t.minDuration!=null?t.minDuration:E4.minDuration/r,s=t.maxDuration!=null?t.maxDuration:E4.maxDuration/r;return Math.min(Math.max(i,e),s)}};const MQe=M();class PQe{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(t){this.currentTime=0,this._animation=new OQe(()=>new Hne(t)),this._current=new Hne(t)}update(t,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=ge(MQe,r.center,t.center),a=Me(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),le(s.lookAtDirection,o),le(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,t.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(t,r){return this._animation.cameraAt(t,this._current),r=r||new Ct,this._current.copyToRenderCamera(r),r}step(t,r){return this.finished||(this.currentTime=this.currentTime+xde(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}}var hs;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(hs||(hs={}));let zg=class extends Te{constructor(e){super(e),this.state=hs.Ready}get active(){return this.state===hs.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=hs.Stopped,!0)}finishController(){this.state=hs.Finished}get steppingFinished(){return!1}};u([d({constructOnly:!0})],zg.prototype,"view",void 0),u([d({readOnly:!0})],zg.prototype,"active",null),u([d()],zg.prototype,"state",void 0),u([d({readOnly:!0})],zg.prototype,"isInteractive",null),zg=u([P("esri.views.3d.state.controllers.CameraController")],zg);let TM=class extends zg{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Wr()),this._asyncResult=null),this.state===hs.Finished||this.state===hs.Stopped?(x5(e),this.state===hs.Finished?e.resolve():e.reject(Wr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=hs.Running,v(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!v(this.viewAnimation)||this.state!==hs.Ready&&this.state!==hs.Running||(this.viewAnimation.state===$E.State.FINISHED?this.finish():this.viewAnimation.state===$E.State.STOPPED&&(this.state=hs.Stopped))}onControllerEnd(){v(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===hs.Finished?this.viewAnimation.finish():this.state===hs.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===hs.Finished?this._asyncResult.resolve():this._asyncResult.reject(Wr()))}finish(){this.finishController()}};TM=u([P("esri.views.3d.state.controllers.AnimationController")],TM);let Jg=class extends TM{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new PQe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new $E}get isInteractive(){return this.mode==="interaction"}begin(e,t){this._hasTarget=!0;const r=this.animationSettings(t);w$.copyFrom(this.view.state.camera);const i=od(this.view.state.viewingMode);this.intersectionHelper.intersectRay(w$.ray,i,qne)&&(w$.center=qne),this.animation.update(w$,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?tQe[e.easing]:e.easing}}};u([d({constructOnly:!0})],Jg.prototype,"mode",void 0),u([d({readOnly:!0})],Jg.prototype,"isInteractive",null),Jg=u([P("esri.views.3d.state.controllers.PointToPointAnimationController")],Jg);const w$=new Ct,qne=M();function oU(e=$Qe){return[e[0],e[1],e[2],e[3]]}function SM(e,t){return IQe(e[0],e[1],e[2],t,rY.get())}function IQe(e,t,r,i,s=oU()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function CJ(e,t,r){return dt(r,e,t),ve(r,r),r[3]=nY(e,t),r}const $Qe=[0,0,1,0];function Pwe(e,t,r){return LQe(e,e.screenToRender(t,We.get()),r)}function LQe(e,t,r){const i=qn(We.get(),t);if(i[2]=0,!e.unprojectFromRenderScreen(i,r.origin))return null;const s=qn(We.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,We.get());return E(n)?null:(ge(r.direction,n,r.origin),r)}function FC(e,t,r){return AJ(e,e.screenToRender(t,We.get()),r)}function AJ(e,t,r){le(r.origin,e.eye);const i=ce(We.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(i,We.get());return E(s)?null:(ge(r.direction,s,r.origin),r)}function RJ(e,t,r,i){const s=FC(t,r,DQe);return Uv(e,s,i)}const DQe=co();var ZE;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(ZE||(ZE={}));const Iwe=30,C4=[1,3e8],aU=80,$we=8,Lwe=200,Dwe=1508e5,Nwe=5,Fwe=50,NQe=5,FQe=10,B9=90,Ox={exclude:new Set([E_])};function yw(e,t,r){return r[0]=t[0]/(e.fullWidth/e.pixelRatio),r[1]=t[1]/(e.fullHeight/e.pixelRatio),r}function VH(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function Cv(e,t,r){const i=Vu(iY.get(),r[3],r);E(i)||Bme(i,Bu)||(ge(hi,e.eye,t),Ze(hi,hi,i),e.eye=me(hi,hi,t),ge(hi,e.center,t),Ze(hi,hi,i),e.center=me(hi,hi,t),e.up=Ze(hi,e.up,i))}function UQe(e,t,r,i){return Tx(e,Pwe(t,r,PJ),i)}function BH(e,t,r,i){return Tx(e,FC(t,r,PJ),i)}function OJ(e,t,r,i){const s=We.get();let n=1-r;ge(s,t,e.eye);const o=Me(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(ae(s,s,n),e.eye=me(hi,e.eye,s),e.center=rn(hi,e.center,t,n))}function Uwe(e,t,r){t.getScreenCenter(Wne),RJ(e,t,Wne,hi)&&(t.center=hi);const i=t.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=ae(We.get(),t.viewForward,s);t.eye=ge(hi,t.center,n)}const Wne=ds();function z9(e,t){ce(t,0,0,0);for(const r of e)me(t,t,r);ae(t,t,1/e.length)}function vN(e,t,r,i){return Math.sin(e/Me(t))*(r+i.radius)}function Xne(e,t,r,i){return vN(Math.PI/2,t,r,i)+(e-Math.PI/2)}var uo;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(uo||(uo={}));const Yne={Elevation:3e4,Angle:Gt(16)},x$={Pole:.95,Angle:Gt(18),Tilt:45},kwe=Gt(80);function Vwe(e,t,r,i,s,n){const o=M(),a=pn();let l=!0,c=!0;return e.intersectScreen(r,o,n)?a[3]=Me(o):(c=!1,t.aboveGround&&s!==ZE.Ellipsoid?a[3]=Math.max(Me(t.center),.9*i.radius):a[3]=Me(t.eye)-t.relativeElevation,s===ZE.Silhouette?EM(a,t,r,o):l=RJ(a,t,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function lU(e,t,r){return Me(e.eye)-r.radius>Yne.Elevation?uo.Horizontal:(FC(e,t,ioe),-Math.sign(e.relativeElevation)*(.5*Math.PI+nY(e.eye,ioe.direction))<Yne.Angle?uo.Vertical:uo.Horizontal)}function Bwe(e,t,r){ge(G9,r,t),e.eye=ge(hi,e.eye,G9),e.center=ge(hi,e.center,G9)}const G9=M();function EM(e,t,r,i){const s=FC(t,r,PJ);return!E(s)&&(wC(e,s,T$),Uv(e,s,i)?!(jn(T$,s.origin)<jn(i,s.origin))||(le(i,T$),!1):(ge(Jx,t.eye,t.center),ve(Jx,Jx),Hge(Jx,-_e(ve(Jx,Jx),T$),Zne),Tx(Zne,s,i),!1))}const T$=M(),Jx=M(),Zne=jr();function zwe(e,t,r,i,s,n){let o=0;if(dt(O4,e,t),ge(A$,e,t),Me(e)<=s||!i.aboveGround){dt(r,A$,i.eye);const a=_e(e,t)/(Me(e)*Me(t));if(a<.9999)o=Mn(a);else{const c=Me(dt(M(),e,t))/(Me(e)*Me(t));o=Zh(c)}const l=Math.cos(ye(dv.normalize(Gt(n)),0,kwe));o=-o-Math.max(0,Me(t)-s)/(l*s)}else ge(Jne,i.eye,i.center),dt(r,A$,Jne),o=-Me(A$)/s;return ve(r,r),ae(r,r,Me(O4)),o}const Jne=M();function Qne(e,t,r,i){let s,n;const o=Math.cos(ye(dv.normalize(Gt(i)),0,kwe));return s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Mn(t/r),n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Mn(e/r),(n-s)*r}function kQe(e,t,r,i,s,n,o,a,l,c){const h=Qne(e[2],t[2],n[3],a),p=l?Qne(e[0],t[0],n[3],180):t[0]-e[0],f=Math.sin(o)*p-Math.cos(o)*h,m=Math.cos(o)*p+Math.sin(o)*h;ve(hi,s);const y=l?f/Math.sqrt(Math.abs(n[3]**2-_e(r,hi)**2)):f/n[3],_=m/Math.sqrt(Math.abs(n[3]**2-_e(r,i)**2));or(c,y,_)}function Gwe(e,t,r,i,s,n,o,a,l,c){dt(O4,e,t),nG(n.up,n.eye,S$,E$,C$),nG([0,0,1],n.eye,oy,sv,Wwe),le(r,sv),le(i,oy),ve(r,r),ae(r,r,Me(O4)),Xee(e,ve(E$,E$),ve(C$,C$),ve(S$,S$),Kne),Xee(t,E$,C$,S$,eoe),kQe(Kne,eoe,e,oy,sv,o,a,l,c,s)}function VQe(e,t,r,i,s,n,o){Vu(A4,s,i),Vu(R4,o,n),ws(iS,A4,R4),ge(t,e,r),Ze(t,t,iS),me(t,t,r)}function jwe(e,t,r,i,s,n){Vu(A4,i,r),Vu(R4,n,s),ws(iS,A4,R4),ge(hi,e.eye,t),Ze(hi,hi,iS),e.eye=me(hi,hi,t),ge(hi,e.center,t),Ze(hi,hi,iS),e.center=me(hi,hi,t),ge(hi,e.up,t),Ze(hi,hi,iS),e.up=me(hi,hi,t)}function MJ(e,t,r,i,s,n){return(Math.abs(i)>Math.PI-x$.Angle||Math.abs(i)<x$.Angle)&&(Math.abs(e[2])<r*x$.Pole||Math.abs(t)>r)&&n.aboveGround&&s<x$.Tilt}function Hwe(e,t,r,i,s,n){if(n)CJ(r,i,toe),Cv(t,e,toe);else{const o=zwe(r,i,roe,t,e[3],s);Cv(t,e,SM(roe,o))}}function qwe(e,t,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,h;le(n1,i),R$.copyFrom(t);for(let p=0;p<a&&jn(r,n1)>l&&(c=jn(r,n1),Gwe(r,n1,sv,oy,yA,R$,e,s,n,o),jwe(R$,e,oy,yA[1],sv,yA[0]),VQe(n1,n1,e,oy,yA[1],sv,yA[0]),h=jn(r,n1),h<c||p===0);p++)t.copyFrom(R$)}function BQe(e,t,r,i,s,n,o){MJ(r,_e(t.up,r),e[3],-dv.normalize(Gt(s)),n,t)?qwe(e,t,r,i,-dv.normalize(Gt(s)),n,o):Hwe(e,t,r,i,n,o)}function zQe(e,t,r,i,s,n){const{eye:o}=e;nG([0,0,1],o,oy,sv,Wwe);const a=t.translation[0]*r.pan,l=s.mode==="zoom"?0:t.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-_e(e.center,oy)**2/Me(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(Pc(i.pan.matrix,i.pan.matrix,h,oy),i.pan.enabled=!0,s.mode){case"pan":Pc(i.pan.matrix,i.pan.matrix,p,sv),i.pan.enabled=!0;break;case"zoom":i.zoom=-t.translation[1]*r.zoom}}function GQe(e,t,r,i,s){const{eye:n,viewRight:o}=e,a=dt(We.get(),o,n),l=t.translation[0]*r.pan;switch(l!==0&&(Pc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*r.pan;c!==0&&(Pc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-t.translation[1]*r.zoom}}function jQe(e,t,r,i,s,n,o,a,l){MJ(e.center,_e(e.up,e.center),Me(e.center),-dv.normalize(Gt(n)),o,t)?zQe(t,r,i,a,l,-dv.normalize(Gt(s))):GQe(t,r,i,a,l)}const oy=M(),sv=M(),Wwe=M(),S$=M(),E$=M(),C$=M(),Kne=M(),eoe=M(),yA=Ke(),toe=oU(),A4=Ie(),R4=Ie(),iS=Ie(),n1=M(),hi=M(),A$=M(),R$=new Ct,O4=M(),roe=M(),PJ={origin:M(),direction:M()},ioe={origin:M(),direction:M()},soe=.6,j9=4,HQe=60;let M4=class extends Jg{constructor(){super(...arguments),this._zoomLocation=M(),this._tmpCamera=new Ct,this._tmpViewDir=M(),this._tmpRayDir={origin:M(),direction:M()},this._targetOnSphere=M(),this._tmpCenter=M(),this._constraintOptions={selection:Bi.ALL_EXCEPT_COLLISION,interactionType:nr.ZOOM,interactionFactor:null,interactionStartCamera:new Ct,interactionDirection:null,tiltMode:go.TUMBLE},this._sphere=pn()}initialize(){this._intersector=od(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this._constraintOptions;i&&(this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i));let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this._zoomLocation,this.view.map.ground.opacity===0?Ox:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:le(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,t,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:VP}}_updateCamera(e,t,r,i,s){const n=Zr(this.view.spatialReference),o=lU(e,i,n),a=Math.abs(this.view.camera.position.z);ve(M$,e.eye),ae(M$,M$,-1),FC(e,i,this._tmpRayDir),ve(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=ye(Math.min($we,1/Math.abs(_e(M$,this._tmpRayDir.direction)))*a,Lwe,Dwe);if(o===uo.Horizontal){let c=soe**t;this._sphere[3]=Me(r),ge(this._tmpViewDir,e.center,e.eye);const h=Math.min(Me(this._tmpViewDir),l);let p=h*c;if(c<=1&&p<j9&&(p=j9,c=p/h),Math.abs(h-p)<1e-6)return;const f=Me(e.center);if(this._sphere[3]!==f){const m=this._sphere[3]+c*(f-this._sphere[3]);e.center=ae(O$,e.center,m/f)}ae(this._tmpViewDir,this._tmpViewDir,-c),e.eye=me(O$,e.center,this._tmpViewDir),Zs(this.view,e,this._constraintOptions),jn(r,e.center)>1e-12&&RJ(this._sphere,e,i,this._targetOnSphere)&&BQe(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=soe**Math.abs(t);const h=t>0?1:-1;ge(this._tmpViewDir,r,e.eye);const p=Me(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,i[0],i[1],this.view.state.camera,HQe);let m=v(f)?f:l;m=s&&t>0?Math.min(m,p):m,ae(this._tmpRayDir.direction,this._tmpRayDir.direction,m),me(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let y=m*c;const _=Math.max(j9,1.01*e.nearFar[0]);if(t>0&&y<_&&(y=_,c=y/m),Math.abs(m-y)<1e-6)return;ae(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-c)),e.eye=me(O$,e.eye,this._tmpRayDir.direction),e.center=me(O$,e.center,this._tmpRayDir.direction)}NC(this.view,e)}};M4=u([P("esri.views.3d.state.controllers.global.ZoomStepController")],M4);const O$=M(),M$=M(),qQe=.6,WQe=4,XQe=60;let P4=class extends Jg{constructor(){super(...arguments),this._zoomLocation=M(),this._tmpCamera=new Ct,this._tmpRayDir=M(),this._tmpCenter=M(),this._constraintOptions={selection:Bi.ALL,interactionType:nr.ZOOM,interactionFactor:null,interactionStartCamera:new Ct,interactionDirection:null,tiltMode:go.TUMBLE}}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this._constraintOptions;i&&(this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i)),this._tmpCamera.copyFrom(r.camera);const s=od(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,this.view.map.ground.opacity===0?Ox:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:le(this._zoomLocation,this._tmpCamera.center);const o=qQe**e;let a=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,XQe);ge(P$,this._tmpCamera.eye,this._zoomLocation),ve(P$,P$);const l=ye(Math.min($we,1/Math.abs(_e(YQe,P$)))*Math.abs(this.view.camera.position.z),Lwe,Dwe);if(a=v(a)?a:l,a){const c=M();ge(c,this._zoomLocation,this._tmpCamera.eye),(a<Me(c)||!n)&&(ve(c,c),me(this._zoomLocation,this._tmpCamera.eye,ae(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:VP}}_updateCamera(e,t,r){ge(this._tmpRayDir,r,e.eye);const i=Me(this._tmpRayDir);let s=i*t;const n=t<=1,o=Math.max(WQe,1.01*e.nearFar[0]);s!==0&&(n&&s<o&&(s=o,t=s/i),Math.abs(i-s)<1e-6||(ae(this._tmpRayDir,this._tmpRayDir,t),e.eye=ge(noe,r,this._tmpRayDir),e.center=rn(noe,e.center,r,1-t),Zs(this.view,e,this._constraintOptions)))}};P4=u([P("esri.views.3d.state.controllers.local.ZoomStepController")],P4);const noe=M(),YQe=Le(0,0,1),P$=M();function ZQe(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function IJ(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class JQe extends zo{constructor(t,r){super(!0),this._view=t,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(t){const r=t.data;if(ZQe(r,"primary")){const i=this._view.state.isGlobal?new M4({view:this._view,mode:"animation"}):new P4({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),ds(r.x,r.y)),t.stopPropagation()}}}function QQe(e,t,r){return e===Ge.Global?new eKe(r):new KQe(t,r)}class KQe{constructor(t,r){this._elevationProvider=t,this._referenceEllipsoid=Zr(r),this._unitInMeters=ll(r,this._referenceEllipsoid.metersPerDegree)}compute(t,r,i,s,n){var S;n||(n={near:0,far:0});let o=t[2]*this._unitInMeters;const a=o,l=o-s,c=(S=this._elevationProvider)==null?void 0:S.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const h={x:(i=v(i)?i:new qr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},p=Math.max(h.x,h.y,h.z);ge(o1,r,t),Qx[0]=o1[0]>0?i.xmax:i.xmin,Qx[1]=o1[1]>0?i.ymax:i.ymin,Qx[2]=o1[2]>0?p/2:-p/2,ge(Qx,Qx,t),ve(o1,o1);const f=1.1*_e(Qx,o1)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=y*iKe*this._unitInMeters,b=y*sKe*this._unitInMeters,x=ye((o-b)/(_-b),0,1)**3,T=Math.min(Nt(m,f,x),m)*Math.max(Math.log(Math.abs(l)),1);return Xwe(Math.min(T,Math.max(34064e4,p))/this._unitInMeters,tKe,this._unitInMeters,n)}}class eKe{constructor(t){this._referenceEllipsoid=Zr(t)}compute(t,r,i,s,n){n||(n={near:0,far:0});const o=Me(t),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),h=Math.max(c,Math.abs(a)),p=Math.sqrt(h*(h+2*l)),f=o+this._referenceEllipsoid.radius;return Xwe(1.2*Nt(p,f,NZ(h)),ye(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function Xwe(e,t,r,i){const s=rKe/r;return e/t>s?(i.far=e,i.near=i.far/t):(i.near=s,i.far=i.near*t),i}const tKe=2e4,rKe=2,iKe=.001,sKe=1e-4,Qx=M(),o1=M();let bN=class extends Te{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;v(e.spatialReference)&&wwe(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>NC(this.view,e,zh.EYE_AND_CENTER))}};u([d({constructOnly:!0})],bN.prototype,"view",void 0),bN=u([P("esri.views.3d.state.ElevationCollisionConstraint")],bN);let u3=class extends Te{constructor(e){super(e),this.nearFarHeuristic=QQe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([se(()=>{var e,t,r,i;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(i=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:i.far]},()=>this._clipDistanceNearFarChanged()),se(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),se(()=>this.view.renderDataExtent,()=>this._updateNearFar(),ri),se(()=>{var e,t,r,i;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(i=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:i.max]},()=>this._updateAltitude(),ri),se(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),ri),se(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),ri),se(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),ri),se(()=>{var e,t,r,i,s,n;return[(r=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:r.type,(n=(s=(i=this.view.state)==null?void 0:i.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),ri)]),this.view.state.isLocal&&this.addHandles(se(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),kt)),this._updateNearFar(),this.view.state.viewingMode!==Ge.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new bN({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,sU(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var i,s,n;const e=(n=(s=(i=this.view.map)==null?void 0:i.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",r=this.view.state.constraints.collision;if(t!==r.enabled){r.enabled=t,t&&this._reapplyConstraints(Bi.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ge.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Gt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(nl(r))}}_updateLocalSurfaceDistance(e){if(E(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.zmax!=null&&e.zmin!=null&&(t=Math.max(t,e.zmax-e.zmin));const r=this.view.state,i=3*t/Math.atan(r.camera.fov/2);i!==r.constraints.distance&&(r.constraints.distance=i)}_reapplyConstraints(e=Bi.ALL){this.view.state.updateCamera(t=>Zs(this.view,t,{selection:e,interactionType:nr.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:go.TUMBLE}))}};u([d({constructOnly:!0})],u3.prototype,"view",void 0),u([d({readOnly:!0})],u3.prototype,"surfaceCollisionConstraint",void 0),u3=u([P("esri.views.3d.state.ConstraintsManager")],u3);class A_{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(t){this.renderCoordsHelper=t,this.frustum=lM(),this._points=Gbe(),this.lines=new Array(12),this._origin=M(),this._direction=M(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:M(),endpoint:null}}update(t){jbe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),le(this._origin,t.eye),le(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let r=0;r<this._points.length;r++)le(this._points[r],t[r]);Hbe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return H_(this.frustum,t)}intersectsRay(t){return eXe(this.frustum,t)}intersectsLineSegment(t,r){return tXe(this.frustum,t,r)}intersectsPoint(t){return qbe(this.frustum,t)}_updateLines(){const t=this._points;for(let r=0;r<4;r++){const i=r+4;H9(this.lines[r],t[r],t[i]),H9(this.lines[r+4],t[r],r===3?t[0]:t[r+1]),H9(this.lines[r+8],t[i],r===3?t[4]:t[i+1])}}}function H9(e,t,r){e.origin=t,e.endpoint=r,Cy(e.direction,t,r)}A_.planePointIndices=rXe,A_.nearFarLineIndices=[[nt.NEAR_BOTTOM_LEFT,nt.FAR_BOTTOM_LEFT],[nt.NEAR_BOTTOM_RIGHT,nt.FAR_BOTTOM_RIGHT],[nt.NEAR_TOP_RIGHT,nt.FAR_TOP_RIGHT],[nt.NEAR_TOP_LEFT,nt.FAR_TOP_LEFT]];let tO=class extends zg{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e),this._handles=new Jr}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=hs.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){v(e.spatialReference)&&!wwe(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),NC(this.view,e,zh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=hs.Stopped)})}};u([d({constructOnly:!0})],tO.prototype,"desiredCamera",null),tO=u([P("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],tO);const nKe=M(),I$=M();function $J(){return{direction:M(),up:M()}}function Ywe(e,t,r,i,s){let n=ve(nKe,e),o=_e(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(_e(t,i)),o<.99?(le(n,t),a&&ae(n,n,-1)):n=null);let l=0;if(n){ae(I$,i,_e(i,n)),ge(n,n,I$);const h=_e(n,s)/(Me(n)*Me(s));dt(I$,n,s),l=(_e(I$,i)>0?1:-1)*nl(Mn(h))}const c=nl(Mn(-_e(i,e)/Me(e)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const Zwe=Le(0,1,0),Jwe=Le(0,0,1),_A=Ie(),Zm=M(),Jm=M();function Qwe(e,t,r,i=$J()){const{direction:s,up:n}=i;return Lme(_A,-Gt(t)),gE(_A,_A,Gt(r)),Ze(s,Jwe,_A),ae(s,s,-1),Ze(n,Zwe,_A),i}function oKe(e,t,r,i){return Ywe(t,r,i,Jwe,Zwe)}function aKe(e,t,r,i){const s=Qwe(e,r,i),n=M();return ae(n,s.direction,-t),me(n,n,e),{up:s.up,eye:n,heading:r,tilt:i}}function lKe(e){return nl(e)}function cKe(e){return Gt(e)}function Kwe(e,t,r,i,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return aa(t,Zm,n),aa(t,Jm,n),Zm[0]-=r/2,Jm[0]+=r/2,Zm[1]-=i/2,Jm[1]+=i/2,mo(Zm,n,Zm,o),mo(Jm,n,Jm,o),s?(s.xmin=Zm[0],s.ymin=Zm[1],s.xmax=Jm[0],s.ymax=Jm[1],s.spatialReference=o):s=new qr(Zm[0],Zm[1],Jm[0],Jm[1],o),s}const uKe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:oKe,eyeForCenterWithHeadingTilt:aKe,eyeTiltToLookAtTilt:cKe,headingTiltToDirectionUp:Qwe,lookAtTiltToEyeTilt:lKe,toExtent:Kwe},Symbol.toStringTag,{value:"Module"})),exe=Le(0,0,1),txe=ve(M(),Le(1,1,1)),hKe=new hv(-180,180),vA=Ie(),__=M(),Kx=M();function rxe(e,t,r,i=$J()){dt(__,e,exe),_e(__,__)===0&&dt(__,e,txe),Vu(vA,-Gt(t),e),Pc(vA,vA,-Gt(r),__);const{up:s,direction:n}=i;return dt(s,__,e),ve(s,s),Ze(s,s,vA),ve(n,e),Ea(n,n),Ze(n,n,vA),i}function dKe(e,t,r,i){const s=__,n=Kx;return ve(s,e),dt(Kx,s,exe),_e(Kx,Kx)===0&&dt(Kx,s,txe),dt(n,Kx,s),Ywe(t,r,i,s,n)}function pKe(e,t,r,i){const s={eye:M(),up:null,tilt:i,heading:r},n=__;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Gt(r),l=Gt(i),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Me(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const q=m/p,L=Zh(o/q),N=Math.PI-l-L;y=q*Math.sin(N)}const _=f*o,b=o*o*(p*p),x=h*h*b,T=y-_,S=T*T,C=x*(x+S-n[1]*n[1]);if(C<0)return ae(s.eye,n,y/m),s.tilt=0,$$(s,e);const O=Math.sqrt(C),R=n[1]*T,$=x+S;let I;if(I=h>0?-O+R:O+R,Math.abs($)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):ae(s.eye,n,y/m),s.tilt=0,q9(s.eye),$$(s,e);s.eye[1]=I/$;const U=c*c*b,V=p*o,G=h*V*s.eye[1],z=s.eye[1]*s.eye[1],Z=1-z,Q=Math.sqrt(Z),te=x*z+U-2*G*Q*T+Z*S;return Math.abs(te)<1e-8?(ae(s.eye,n,y/m),s.tilt=0,q9(s.eye),$$(s,e)):(s.eye[0]=(Z*(y*n[0]-_*n[0])-V*Q*(n[0]*s.eye[1]*h+n[2]*c))/te,s.eye[2]=(Z*(y*n[2]-_*n[2])-V*Q*(n[2]*s.eye[1]*h-n[0]*c))/te,ae(s.eye,s.eye,y),q9(s.eye),$$(s,e))}function q9(e){const t=e[1];e[1]=-e[2],e[2]=t}function $$(e,t){const r=rxe(t,e.heading,e.tilt);return e.up=r.up,e}function fKe(e,t,r){const i=Me(t),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-e)),n=Zh(r/(s/Math.sin(e)));return nl(e-n)}function mKe(e,t,r){const i=Gt(e),s=Me(t);return Zh(r/(s/Math.sin(i)))+i}function ixe(e,t,r,i,s){let n,o,a,l;const c=t.latitude,h=Zr(e.spatialReference).radius,p=t.longitude,f=EZe(c,r,h)/2;n=p-f,o=p+f;const m=Gt(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(i/h/2),b=_*_;function x(S){const C=Math.PI/2;return(S=$3e.normalize(S,-C))>C&&(S=Math.PI-S),S}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+b))),l=a+i/h,a=x(a),l=x(l),l<a){const S=l;l=a,a=S}if(a=Math.max(nl(a),-90),l=Math.min(nl(l),90),o=hKe.monotonic(n,o),o-n>180){const S=(o-n-180)/2;n+=S,o-=S}const T=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:Ye.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=T):s=new qr(n,a,o,l,T),e.spatialReference&&e.spatialReference.isWebMercator&&ey(s,!1,s),s}const gKe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:dKe,eyeForCenterWithHeadingTilt:pKe,eyeTiltToLookAtTilt:mKe,headingTiltToDirectionUp:rxe,lookAtTiltToEyeTilt:fKe,toExtent:ixe},Symbol.toStringTag,{value:"Module"}));function I4(e){return e.type==="point"}class sxe{constructor(t,r=null,i=0){this.array=t,this.spatialReference=r,this.offset=i}}function nxe(e){return"array"in e}function tm(e,t,r="ground"){if(I4(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(nxe(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,Pt(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}function JE(e,t){return e!=null&&(t==null||(t===Ge.Local?!e.isGeographic||e.isWGS84||e.wkid===Uh.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===Uh.CGCS2000||e.wkid===Uh.GCSMARS2000||e.wkid===Uh.GCSMARS2000_SPHERE||e.wkid===Uh.GCSMOON2000))}const oxe=ee.getLogger("esri.views.3d.support.cameraUtils"),axe=39.37,lxe=96,zH=1,yKe=8,_Ke=5,cxe=1,ooe=M(),vKe={heading:0,tilt:0},R_=new yt,bKe=new hv(-20037508342788905e-9,20037508342788905e-9),wKe=new hv(-180,180);var ia;function BP(e){return e.spatialReference||Ye.WGS84}function UC(e){return e.viewingMode==="global"?gKe:uKe}function xKe(e,t,r,i,s){return UC(e).headingTiltToDirectionUp(t,r,i,s)}function Fg(e,t){if(E(t))return null;const r=e.renderSpatialReference,i=UC(e).headingTiltToDirectionUp,s=M();if(!aa(t.position,s,r))return null;const n=i(s,t.heading,t.tilt);ae(n.direction,n.direction,e.state.camera.distance),me(n.direction,n.direction,s);const o=Rx(e,s,n.direction,n.up);return o.fov=Gt(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(ia||(ia={}));const eT=M();function QE(e,t,r){const i=e.renderSpatialReference,s=cU(e,t.eye,t.viewForward,t.up,vKe);let n=BP(e);return mo(t.eye,i,eT,n)||(n=Ye.WGS84,mo(t.eye,i,eT,n)),E(r)?new Jh(new yt(eT,n),s.heading,s.tilt,nl(t.fov)):(r.position.x=eT[0],r.position.y=eT[1],r.position.z=eT[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=nl(t.fov),r)}function LJ(e,t,r){const i=e.state.camera,s=i.width/2/i.pixelRatio;return e.renderCoordsHelper.viewingMode===Ge.Global&&r!=null&&(t*=Math.cos(Gt(r))),t/=e.renderCoordsHelper.unitInMeters,s/(lxe*axe/t)/Math.tan(i.fovX/2)}function nx(e,t,r){const i=e.state.camera,s=t*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=lxe*axe/(n/s);return e.renderCoordsHelper.viewingMode===Ge.Global&&r!=null&&(o/=Math.cos(Gt(r))),o*=e.renderCoordsHelper.unitInMeters,o}function uxe(e,t,r,i,s,n){return hxe(e,t,LJ(e,r,t.latitude),i,s,n)}function hxe(e,t,r,i,s,n){if(_w(n)){const a=new kC(n.signal);return CM(e,i.heading,i.tilt,t,r,s,a),void a.resolver.promise.then(l=>{const c=L4(e,l,i.fov);if(!E(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=CM(e,i.heading,i.tilt,t,r,s);return L4(e,o,i.fov,n)}function cU(e,t,r,i,s){return UC(e).directionToHeadingTilt(t,r,i,s)}function TKe(e,t){var r;return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,R_,e.spatialReference)&&e.elevationProvider&&Pt(tm(e.elevationProvider,R_),0)>((r=R_.z)!=null?r:0)-cxe)}async function SKe(e,t,r){var n;if(!e.renderCoordsHelper.fromRenderCoords(t,R_,e.spatialReference)||!e.elevationProvider)return!1;const i=(n=R_.z)!=null?n:0,s=await e.elevationProvider.queryElevation(R_.x,R_.y,i,R_.spatialReference,"ground",r);return Pt(s,0)>i-cxe}async function EKe(e,t,r){var s;const i=M();if(t)if(t instanceof yt){if(aa(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null&&e.elevationProvider!=null){const n=await e.elevationProvider.queryElevation(t.x,t.y,(s=t.z)!=null?s:0,t.spatialReference,"ground",r);return v(n)&&e.renderCoordsHelper.setAltitude(i,n),i}}else le(i,t);else le(i,e.state.camera.center);return i}function CKe(e,t){const r=M();if(t&&t instanceof yt){if(aa(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null&&e.elevationProvider!=null){const i=tm(e.elevationProvider,t);v(i)&&e.renderCoordsHelper.setAltitude(r,i)}}else le(r,t||e.state.camera.center);return r}function CM(e,t,r,i,s,n,o){const a=i&&i instanceof yt?i:null;if(_w(o))return EKe(e,i,o.signal).then(c=>{GH(e,t,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=CKe(e,i);return GH(e,t,r,a,l,s,n,o)}function GH(e,t,r,i,s,n,o,a){if(E(i)){const p=e.renderSpatialReference;if(i=mv(s,p,BP(e)),E(i))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=OKe(e,t,r,s,n,o),c=(0,UC(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===ia.ADJUST&&e.viewingMode==="global"&&r>0){const p=()=>{const m=dxe(e,s,n,PKe(e,n,r,s));return o=r-m<1?ia.LOCKED:ia.ADJUST,GH(e,t,m,i,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(TKe(e,c.eye))return p();if(_w(a))return SKe(e,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:bs(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||_w(a)?{center:M(),eye:M(),up:M(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=bs(s),h.heading=c.heading,h.tilt=c.tilt,_w(a)&&a.resolver.resolve(h),h}function rO(e,t,r,i,s,n=null){let o,a,l;if(e.state.isGlobal){if(!JE(t.spatialReference,Ge.Global))return _w(n)&&n.resolver.reject(),null;const b=new yt(t.xmin,t.ymin,t.spatialReference),x=new yt(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?wKe:bKe;o=new yt({x:T.center(b.x,x.x),y:(x.y+b.y)/2,z:t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0,spatialReference:t.spatialReference});const S=Zr(t.spatialReference),C=SZe(o,b,x);a=C.lon,l=C.lat,T.diff(b.x,x.x)>T.range/2&&(a+=S.halfCircumference),a=Math.min(a,S.halfCircumference),l=Math.min(l,S.halfCircumference)}else{const b=Pt(e.renderSpatialReference,t.spatialReference);b.equals(t.spatialReference)||(t=bC(t,b)),a=t.xmax-t.xmin,l=t.ymax-t.ymin;const x=t.zmax!=null&&t.zmin!=null?(t.zmax+t.zmin)/2:void 0;o=new yt({x:t.xmin+.5*a,y:t.ymin+.5*l,z:x,spatialReference:b})}const c=t.zmax!=null&&t.zmin!=null?t.zmax-t.zmin:0,h=e.state.camera,p=1/Math.tan(h.fovX/2),f=1/Math.tan(h.fovY/2),m=1/Math.tan(h.fov/2),y=Math.max(.5*a*p,.5*l*f,.5*c*m)/zH;if(_w(n)){const b=new kC(n.signal);return CM(e,r,i,o,y,s,b),void b.resolver.promise.then(x=>{const T=L4(e,x,e.camera.fov);if(!E(T))return n.resolver.resolve(T);n.resolver.reject()},x=>n.resolver.reject(x))}const _=CM(e,r,i,o,y,s);return L4(e,_,e.camera.fov,n)}function AKe(e,t,r){const i=e.renderSpatialReference,s=mv(r,i,BP(e));if(E(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=QM(t.eye,r),l=2*a*n*zH,c=2*a*o*zH;return e.viewingMode==="global"?ixe(e,s,l,c):Kwe(e,s,l,c)}function RKe(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>yKe)return!0;const s=e.renderSpatialReference,n=BP(e),o=mv(t,s,n),a=mv(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(E(o)||E(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*i;return a.distance(o)/l>_Ke}function OKe(e,t,r,i,s,n){let o=0;return n===ia.ADJUST&&RKe(e,i,s)?(t=0,o=MKe(e,s,r,i)):o=DJ(e,i,s,r),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:r=dxe(e,i,s,o)}}const $4=.7;function MKe(e,t,r,i){const s=DJ(e,i,t,r);if(!e.state.constraints.tilt)return s;const n=e.state.constraints.tilt(t);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-$4)+n.max*$4;return Math.min(s,o)}function PKe(e,t,r,i){let s=DJ(e,i,t,r);if(!e.state.constraints.tilt)return s;const n=e.state.constraints.tilt(t);return s=Math.min(s,.5*Math.PI),n.min*(1-$4)+s*$4}function dxe(e,t,r,i){return UC(e).lookAtTiltToEyeTilt(i,t,r)}function DJ(e,t,r,i){return UC(e).eyeTiltToLookAtTilt(i,t,r)}function L4(e,t,r,i){if(E(t))return null;const s=e.renderSpatialReference,n=mv(t.eye,s,BP(e));return E(n)?null:v(i)?(i.position=n,i.heading=t.heading,i.tilt=t.tilt,i.fov=r,i):new Jh(n,t.heading,t.tilt,r)}function IKe(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(t);oxe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function pxe(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(t);oxe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function fxe(e,t){return mo(t.center,e.renderSpatialReference,ooe,Ye.WGS84),nx(e,t.distance,ooe[1])}class kC{constructor(t){this.signal=t,this.resolver=uv()}}function _w(e){return e&&"resolver"in e}const $Ke=.66;function mxe(e){return 360-BW.normalize(e)}function uU(e){return BW.normalize(360-e)}function bA(e){return v(e)&&e.resolver&&e.resolver.reject(),null}function LKe(e,t){return v(e)&&e.resolver&&e.resolver.resolve(t),t}function NJ(e,t,r,i=null){if(!t)return bA(i);const s=e.spatialReference||Ye.WGS84;if(v(t.camera)){const c=gx(t.camera.position,s);if(E(c))return bA(i);const h=t.camera.clone();return h.position=c,LKe(i,h)}if(E(t.targetGeometry))return bA(i);const n=t.get("targetGeometry.spatialReference");if(n&&!J_(n,s))return bA(i);const o=QE(e,e.state.camera);let a=ia.ADJUST;if(t.rotation!=null&&(o.heading=mxe(t.rotation),a=ia.LOCKED),r!=null&&(o.tilt=r),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?LJ(e,t.scale,c.latitude):e.state.camera.distance,hxe(e,p,h,o,a,i)}const l=t.targetGeometry.extent;return l?rO(e,l,o.heading,o.tilt,a,i):bA(i)}function DKe(e,t,r=null){return E(r)&&(r=new Uc),kJ(e,null,t.clone(),r)}async function NKe(e,t,r){const i=qKe(e,t);if(!i)throw new j("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Jh({fov:e.camera.fov}),n=new Uc({camera:s});if(i.target instanceof Uc)return a1(await kKe(e,i.target,i,r,n));if(i.target instanceof Jh)return a1(yxe(e,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof qr){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return a1(o||c?await jH(e,i,i.target.center,s,r,n):await GKe(e,i,i.target,s,r,n))}const a={boundingBox:$i(),hasZ:!1,screenSpaceObjects:[]},l=o?FKe(e,i):void 0;if(await gxe(e,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(hp(a.boundingBox,Xs),yu.x=Xs[0],yu.y=Xs[1],yu.z=Xs[2],yu.spatialReference=e.spatialReference,isFinite(yu.z)&&a.hasZ?c=wX(a.boundingBox):(yu.z=void 0,c=yPe(bX(a.boundingBox,XKe))),o||c)return a1(await jH(e,i,yu,s,r,n));const h=WKe(e,a.screenSpaceObjects);return a1(await HKe(e,i,yu,a.boundingBox,h,s,r,n))}return i.position?a1(BKe(e,i,s,n)):a1(await zKe(e,i,s,r,n))}function FJ(e,t){return t.scale==null&&t.zoom!=null?pxe(e,t.zoom):t.scale}function FKe(e,t){const r=FJ(e,t);return r?QDe(r):void 0}function UJ(e,t){let r=!1;return t.heading!=null?(e.heading=t.heading,r=!0):t.rotation!=null&&(e.heading=mxe(t.rotation),r=!0),t.tilt!=null&&(e.tilt=t.tilt,r=!0),t.fov!=null&&(e.fov=t.fov),r}function kJ(e,t,r,i){const s=e.spatialReference||Ye.WGS84;return t=v(t)?t:Fg(e,r),E(t)||(i.targetGeometry=mv(t.center,e.renderSpatialReference,s),i.scale=fxe(e,t),i.rotation=uU(r.heading),i.camera=r),i}function D4(e,t,r){var a,l;const i=()=>new j("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!t)throw i();if(!J_(t.spatialReference,e.spatialReference))throw new j("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=e.spatialReference)==null?void 0:a.wkid})`,{geometry:t});const s=[];if(!t.hasZ&&e.basemapTerrain){let c;switch(t.type){case"point":c=t;break;case"multipoint":case"polyline":c=(l=t.extent)==null?void 0:l.center;break;case"mesh":c=t.origin;break;case"extent":c=t.center;break;case"polygon":c=t.centroid}c&&v(e.basemapTerrain.spatialReference)&&J_(c,e.basemapTerrain.spatialReference)&&e.elevationProvider?Xs[2]=Pt(tm(e.elevationProvider,c),0):Xs[2]=0}(0,YKe[t.type])(t,c=>{s.push(c[0],c[1],c[2])},Xs);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(Ts(s,t.spatialReference,0,o,e.spatialReference,0,n)){t.hasZ&&(r.hasZ=!0);for(let c=0;c<o.length;c+=3)t.hasZ?(Xs[0]=o[c+0],Xs[1]=o[c+1],Xs[2]=o[c+2]):(Xs[0]=o[c+0],Xs[1]=o[c+1]),wm(r.boundingBox,Xs)}}async function UKe(e,t,r,i){const s=await Vc(e.whenViewForGraphic(t));if(s.ok===!1||E(s.value)||!("whenGraphicBounds"in s.value))return void D4(e,t.geometry,i);const n=s.value,o=await Vc(n.whenGraphicBounds(t,{minDemResolution:r}));if(o.ok===!1)return void D4(e,t.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;dE(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function gxe(e,t,r,i){var s;if(Array.isArray(t)&&t.length===2){const n=t[0],o=t[1];if(typeof n=="number"&&typeof o=="number")return yu.x=n,yu.y=o,yu.z=void 0,yu.spatialReference=(s=e.spatialReference)!=null&&s.isGeographic?e.spatialReference:Ye.WGS84,void D4(e,yu,i)}t&&typeof t.map=="function"?await fo(t.map(n=>gxe(e,n,r,i))):t instanceof Iv?D4(e,t,i):t instanceof Aa&&await UKe(e,t,r,i)}async function kKe(e,t,r,i,s){if(v(t.camera))return yxe(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=v(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=uU(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=FJ(e,r);n!=null&&(s.scale=n);const o=new kC(i);return NJ(e,s,r.tilt,o),s.camera=await o.resolver.promise,s}function yxe(e,t,r){const i=e.spatialReference,s=gx(t.position,i);return E(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,kJ(e,null,t,r))}function VKe(e,t,r,i,s,n){const o=e.renderSpatialReference;return aa(r,D$,o),aa(t,W9,o),n.targetGeometry=new yt(t),s.position=new yt(r),ge(N4,W9,D$),cU(e,D$,N4,i.up,s),n.scale=nx(e,Ai(D$,W9),n.targetGeometry.latitude),n.rotation=uU(s.heading),n.camera=s,n}async function jH(e,t,r,i,s,n){if(E(r))throw new j("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=Rx(e);if(t.position)return VKe(e,n.targetGeometry,t.position,o,i,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=ae(Xs,o.viewForward,-l);o.eye=me(Xs,o.center,c),n.scale=nx(e,l,r.latitude)}QE(e,o,i);const a=UJ(i,t)?ia.LOCKED:ia.ADJUST;if(!t.zoomFactor){const l=FJ(e,t);l==null?(aa(r,Xs,e.renderSpatialReference),qbe(o.frustum,Xs)?n.scale=nx(e,Ai(o.eye,Xs),r.latitude):n.scale=fxe(e,o)):n.scale=l;const c=new kC(s);uxe(e,n.targetGeometry,n.scale,i,a,c),n.camera=await c.resolver.promise}return n}function BKe(e,t,r,i){const s=Rx(e);return le(N4,s.viewForward),cU(e,s.eye,N4,s.up,X9),r.position=new yt(t.position),r.heading=t.heading!=null?t.heading:X9.heading,r.tilt=t.tilt!=null?t.tilt:X9.tilt,kJ(e,null,r,i)}async function zKe(e,t,r,i,s){const n=Rx(e);return jH(e,t,mv(n.center,e.renderSpatialReference,e.spatialReference),r,i,s)}async function GKe(e,t,r,i,s,n){n.targetGeometry=r.clone();const o=Rx(e);QE(e,o,i);const a=UJ(i,t)?ia.LOCKED:ia.ADJUST,l=new kC(s);return rO(e,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function jKe(e,t,r,i,s){let n=0;r.z!=null?n=r.z:e.basemapTerrain&&e.elevationProvider&&(n=tm(e.elevationProvider,r)),ce(Xs,r.x,r.y,n),$p(e.spatialReference,Xs,aoe,e.renderSpatialReference),id(L$,aoe),sd(L$,L$),$i(wA);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let b=i[_[2]];isFinite(b)||(b=n),ce(Xs,i[_[0]],i[_[1]],b),mo(Xs,e.spatialReference,Xs,e.renderSpatialReference),wm(wA,Mc(Xs,Xs,L$))}const a=_x(wA),l=Lv(wA),c=vx(wA),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function HKe(e,t,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=Rx(e),c=jKe(e,l,r,i,s);QE(e,l,n);const h=UJ(n,t)?ia.LOCKED:ia.ADJUST;a.scale=nx(e,c,a.targetGeometry.latitude);const p=new kC(o);return uxe(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function qKe(e,t){if(!t||!e.spatialReference)return null;const r={target:void 0};if("declaredClass"in t||Array.isArray(t))r.target=t;else{for(const i in t)r[i]=t[i];t.center&&!r.target&&(r.target=t.center)}return r}function a1(e){return e&&v(e.camera)&&(e.rotation=uU(e.camera.heading)),e}function WKe(e,t){const r=$Ke;if(!t.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(e.width,e.height)*2}const Xs=M(),aoe=Ie(),L$=ns(),wA=In(),XKe=ur(),N4=M(),D$=M(),W9=M(),X9={heading:0,tilt:0},yu=new yt,YKe={point(e,t,r){r[0]=e.x,r[1]=e.y,e.z!=null&&(r[2]=e.z),t(r)},polygon(e,t,r){const i=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),t(r)}},polyline(e,t,r){const i=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),t(r)}},multipoint(e,t,r){const i=e.points,s=e.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),t(r)},extent(e,t,r){e.zmin!=null&&e.zmax!=null?(t(ce(r,e.xmin,e.ymin,e.zmin)),t(ce(r,e.xmax,e.ymin,e.zmin)),t(ce(r,e.xmin,e.ymax,e.zmin)),t(ce(r,e.xmax,e.ymax,e.zmin)),t(ce(r,e.xmin,e.ymin,e.zmax)),t(ce(r,e.xmax,e.ymin,e.zmax)),t(ce(r,e.xmin,e.ymax,e.zmax)),t(ce(r,e.xmax,e.ymax,e.zmax))):(t(ce(r,e.xmin,e.ymin,r[2])),t(ce(r,e.xmax,e.ymin,r[2])),t(ce(r,e.xmin,e.ymax,r[2])),t(ce(r,e.xmax,e.ymax,r[2])))},mesh(e,t,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)t(ce(r,i[s+0],i[s+1],i[s+2]))}};class ZKe{constructor(t,r,i){this.target=t,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;v(this.options.signal)&&Ca(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(t,r){return this._promise.then(t,r)}catch(t){return this._promise.catch(t)}resolve(t){if(this.state!=="finished")return this.state="finished",this._resolveCallback(t)}reject(t){if(this.state!=="finished")return this.state="finished",this._rejectCallback(t)}abort(t=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!t&&v(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Wr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await iE(()=>this.view.ready,this._abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,NKe(this.view,this.target,this._abortController.signal).then(t=>{if(this.state==="finished")return;const r=t?this._getCameraFromViewpoint(t):null;if(!E(r))if(this.options.animate){if(E(this._animationController))return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){var n;const r=!!(this.target instanceof Uc&&this.target.camera||this.target instanceof Jh),i=t.camera;if(E(i))return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new j("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const s=Fg(this.view,i);return E(s)?(this.reject(new j("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:r}}startAnimation(t,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(E(i))return void this.reject(new j("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(t.viewpoint,"running"),!r.active||E(r.viewAnimation)||r.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;t.isFullySpecified?(s=new tO({view:this.view,desiredCamera:t.camera}),NC(this.view,t.camera,zh.EYE_AND_CENTER)):Zs(this.view,t.camera),r.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Jg&&v(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):v(r.viewAnimation)&&r.viewAnimation.target===t.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!E(this.view.state))switch(r.state){case hs.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case hs.Ready:case hs.Rejected:case hs.Running:case hs.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t=null,r=null;const i=this.view.state.cameraController;return i instanceof Jg&&(i.updateStateFromViewAnimation(),i.active&&(t=i,r=t.viewAnimation)),t!=null||(t=new Jg({view:this.view,mode:"animation"}),r=t.viewAnimation,this.view.state.switchCameraController(t))?t:(v(r)&&r.stop(),this.reject(new j("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}let gn=class extends Te{get camera(){const e=this._get("camera");if(!this.ready)return e;const t=QE(this.view,this.view.state.camera,Y9);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){var t,r;this._updatePropertyBeforeReady("camera",e)||((t=this.view.elevationProvider)==null||t.enableElevationCache(!0),this.setStateCamera(Fg(this.view,e),{applyConstraints:!1})||ee.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=QE(this.view,this.view.state.contentCamera,Y9);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=Fg(this.view,e);E(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.removeHandles(Z9),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,r=this.view.state.camera.distance**2,i=kl(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([se(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(Z9),this.test.contentCameraResetState.clear())}),se(()=>this.zoom,n=>{n!==void 0&&t!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),se(()=>this.view.state.camera,n=>{const o=jn(i,n.center);this.test.contentCameraResetState.set("camera.center",o/r),o>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],Z9),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var t;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ee.getLogger(this.declaredClass).error("#center=","Invalid center",e):ee.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e):ee.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=AKe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return v(t)?t:this._get("extent")}set extent(e){var t;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||ee.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):ee.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e):ee.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return nx(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||ee.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,r=e.pixelRatio,i=this._get("padding"),s=Math.round(t[lr.TOP]/r),n=Math.round(t[lr.RIGHT]/r),o=Math.round(t[lr.BOTTOM]/r),a=Math.round(t[lr.LEFT]/r);return i!=null&&i.top===s&&i.right===n&&i.bottom===o&&i.left===a?i:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,N$),this.view.state.updateCamera(t=>t.padding=N$))}_paddingToArray(e,t,r){e?ti(r,e.top||0,e.right||0,e.bottom||0,e.left||0):ti(r,0,0,0,0);for(let i=0;i<4;i++)r[i]=Math.round(r[i]*t)}get screenCenter(){const e=this.padding;return Kh((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?DKe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var t;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||ee.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const r=v(e.camera)?e.camera.position:e.targetGeometry,i=v(r)&&r.spatialReference;ee.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e)}else ee.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?IKe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||ee.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get _pixelRatio(){var e;return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,(e=this.view)==null?void 0:e.qualitySettings.maximumPixelRatio)}get _rasterPixelRatio(){return v(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,t,r;return(r=(t=(e=this.view)==null?void 0:e._stage)==null?void 0:t.renderer.isFeatureEnabled(qs.PhysicalPixelRendering))!=null?r:!1}get _usePhysicalPixelRenderingAny(){var t,r;const e=(r=(t=this.view)==null?void 0:t._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(qs.PhysicalPixelRendering,Sr.IDLE)||e.isFeatureEnabled(qs.PhysicalPixelRendering,Sr.INTERACTING)||e.isFeatureEnabled(qs.PhysicalPixelRendering,Sr.ANIMATING))}constructor(e){super(e),this._propertiesPool=new vy({frustum:A_},this),this._cameraSetByUser=!1,this._gotoOperation=null,this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._cameraChangeTime=0,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(t){this.viewStateManager._updatingIgnoreRenderState=t},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||v(this.renderState)}}}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([dn(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),se(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,t)=>this._cameraChangedHandler(e,t),ri)]),oa(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([rE({prepare:()=>this._prepareFrame()}),se(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(F$)}),dn(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Ve(this._propertiesPool)}init(){this.constraintsManager=new u3({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Ge.Local&&this.addHandles(oa(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(F$),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),F$)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(F$),this.constraintsManager=Ve(this.constraintsManager))}async goTo(e,t){const r={animate:!0,...t};return v(this._gotoOperation)&&this._gotoOperation.abort(r.animate),this._gotoOperation=new ZKe(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Rx(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,r=t==null?void 0:t.cameraController;r&&(t.updateCamera(i=>r.stepController(e,i)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){v(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:r,overrides:i}of QKe){const s=e.has(r),n=this._isOverridden(r);!s&&n&&t.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||n)&&i.forEach(o=>e.add(o))}return t}_setInitialView(e){if(E(e)||this._cameraSetByUser)return;if(e instanceof Jh)return void this.setStateCamera(Fg(this.view,e),{applyConstraints:!1});if(e instanceof Uc){if(e.targetGeometry instanceof qr){const s=rO(this.view,e.targetGeometry,0,.5,ia.LOCKED);return void(v(s)&&this.setStateCamera(Fg(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},i=this._viewpointToCamera(e);return void this.setStateCamera(i,r)}const t=rO(this.view,e,0,.5,ia.LOCKED);v(t)&&this.setStateCamera(Fg(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&JKe.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!E(e)&&(e instanceof Uc?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Jh?this.isCompatible(e.position):e.spatialReference&&J_(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=KKe){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,r=c0){const{heading:i,tilt:s}=this._getPreservingHeadingTilt(),n=CM(this.view,i,s,e,t,ia.ADJUST);return E(n)?null:(r.copyFrom(this.view.state.camera),r.eye=n.eye,r.center=n.center,r.up=n.up,r)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:t,tilt:r}=this._getPreservingHeadingTilt(),i=rO(this.view,e,t,r,ia.ADJUST,Y9);return i?Fg(this.view,i):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.renderLocation,i=t.location.latitude;if(i==null)return null;const s=LJ(this.view,e,i);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(pxe(this.view,e))}_viewpointToCamera(e){return Fg(this.view,NJ(this.view,e))}setStateCamera(e,t){return!(E(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{t.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),t.applyConstraints&&Zs(this.view,r)}),t.applyConstraints||(this.view.state.cameraController=new tO({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._pixelRatio,i=Math.round(e.clientWidth*r),s=Math.round(e.clientHeight*r);if(i!==0&&s!==0&&(t.width===i&&t.height===s||(t.width=i,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===i&&n.fullHeight===s&&n.pixelRatio===r||(c0.copyFrom(n),c0.pixelRatio!==r&&(this._paddingToArray(this.padding,r,N$),c0.padding=N$),c0.fullWidth=i,c0.fullHeight=s,c0.pixelRatio=r,this.view.state.camera=c0),this._updateViewState()}}_updateElevation(e){var s,n;const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=(n=(s=this.view.renderCoordsHelper)==null?void 0:s.getAltitude(e.eye))!=null?n:0,i=t?sU(this.view,e.eye):0;e.relativeElevation=r-i}_updateViewState(){v(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Sr.ANIMATING:this.view.interacting?this.view.state.mode=Sr.INTERACTING:(this.view.state.mode===Sr.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=eet?this.view.state.mode=Sr.INTERACTING:this.view.state.mode=Sr.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio,this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};u([d({type:Jh,dependsOn:["view.state.camera","ready"]})],gn.prototype,"camera",null),u([d({type:Jh,dependsOn:["view.state.contentCamera","ready"]})],gn.prototype,"contentCamera",null),u([d({type:yt})],gn.prototype,"center",null),u([d({type:qr})],gn.prototype,"extent",null),u([d({readOnly:!0})],gn.prototype,"frustum",null),u([d({readOnly:!0})],gn.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],gn.prototype,"ready",void 0),u([d({type:Number})],gn.prototype,"scale",null),u([d()],gn.prototype,"padding",null),u([d({readOnly:!0})],gn.prototype,"screenCenter",null),u([d({constructOnly:!0})],gn.prototype,"view",void 0),u([d({type:Uc})],gn.prototype,"viewpoint",null),u([d({type:Number})],gn.prototype,"zoom",null),u([d({readOnly:!0})],gn.prototype,"_pixelRatio",null),u([d({readOnly:!0})],gn.prototype,"_rasterPixelRatio",null),u([d({readOnly:!0})],gn.prototype,"_usePhysicalPixelRendering",null),u([d({readOnly:!0})],gn.prototype,"_usePhysicalPixelRenderingAny",null),u([d()],gn.prototype,"_windowDevicePixelRatio",void 0),u([d()],gn.prototype,"_devicePixelRatioOverride",void 0),gn=u([P("esri.views.3d.state.ViewStateManager")],gn);const JKe=["camera","viewpoint","extent","scale","center","zoom"],QKe=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],KKe={heading:0,tilt:0},Y9=new Jh,c0=new Ct,N$=sr(),F$="pending-initial-view",Z9="content-camera-reset",eet=300,loe=100;let rm=class extends zg{constructor(){super(...arguments),this.startCamera=new Ct,this.currentCamera=new Ct,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<loe}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=hs.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),loe),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([d({readOnly:!0})],rm.prototype,"isInteractive",null),u([d()],rm.prototype,"_lastInteraction",void 0),rm=u([P("esri.views.3d.state.controllers.InteractiveController")],rm);var bc;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(bc||(bc={}));let iO=class extends rm{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=bc.CENTER,this._rotScale=0,this._lastPoint=Ke(),this._tmpWorldUp=M(),this._tmpViewDir=M(),this._tmpRotCurPoint=Ke(),this._tmpTransf=Ie(),this._tmpAxis=M(),this._tmpPivotPoint=M(),this._pivotPos=M(),this._constraintOptions={selection:Bi.ALL,interactionType:nr.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:go.TUMBLE}}initialize(){this._rotScale=this.pivot===bc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case bc.EYE:le(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=nr.LOOK_AROUND,this._constraintOptions.tiltMode=go.LOOK_AROUND,this._constraintOptions.selection=Bi.NONE;break;case bc.CENTER:{const t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Ox:{});t||le(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=nr.TUMBLE,this._constraintOptions.tiltMode=go.TUMBLE,this._constraintOptions.selection=Bi.ALL&~Bi.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,yw(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){const r=this.startCamera,i=M();ge(i,this._pivotPos,r.eye);const s=Me(i),n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,coe);let o=Math.max(Math.min(NQe,1/Math.abs(_e(coe,r.viewForward)))*n,FQe);t&&(o=Math.min(s,o));const a=Zr(this.view.spatialReference),l=ds(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=lU(this.startCamera,l,a);let h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*B9,B9),p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,B9);(v(h)||v(p))&&(h=Pt(h,p),p=E(p)||c===uo.Horizontal?h:p,o=h>p?p:h,o=t?Math.min(o,s):o),ve(i,i),le(this._pivotPos,me(this._tmpPivotPoint,r.eye,ae(this._tmpPivotPoint,i,o)))}update(e){if(this.active){switch(this.pivot){case bc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case bc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Zs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,t,r,i){this.view.renderCoordsHelper.worldUpAtPosition(i,this._tmpWorldUp),yw(e,t,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,n=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ge(this._tmpViewDir,r,i);const o=Me(this._tmpViewDir),a=Mn(_e(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===bc.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=ye(s+a,Qo.min,Qo.max)-a,dt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===bc.CENTER&&(n=-n),Vu(this._tmpTransf,n,this._tmpWorldUp),Pc(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),Ze(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ze(J9,e.up,this._tmpTransf),me(J9,i,this._tmpViewDir),qn(this._lastPoint,this._tmpRotCurPoint),J9}};u([d()],iO.prototype,"pivot",void 0),iO=u([P("esri.views.3d.state.controllers.RotateController")],iO);const J9=M(),coe=M();class Q9 extends zo{constructor(t,r,i,s){super(!0),this._view=t,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!IJ(t.data,this.pointerAction))return;const i=ds(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new iO({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}}let HH=class extends rm{constructor(){super(...arguments),this._pickPoint=M(),this._tmpP0=Ke(),this._panAxisAngle=oU(),this._tmpRayDir=M(),this._tmpRayDirPick=M(),this._targetOnSphere=M(),this._navMode=uo.Horizontal,this._tmpRay={origin:M(),direction:M()},this.dragBeginPoint=ds(),this._normalizedAnchorPoint=Ke(),this._constraintOptions={selection:Bi.ALL_EXCEPT_COLLISION,interactionType:nr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:go.TUMBLE},this._sphere=pn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;qn(this.dragBeginPoint,e),yw(this.startCamera,e,this._normalizedAnchorPoint);const t=Zr(this.view.spatialReference),r=Vwe(this._intersectionHelper,this.startCamera,e,t,ZE.Ellipsoid,this.view.map.ground.opacity===0?Ox:{});if(this._navMode=lU(this.startCamera,e,t),this._navMode===uo.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=Pt(r.scenePickPoint,this._pickPoint),this._sphere=r.sphere;else{let i;FC(this.startCamera,e,this._tmpRay),ve(this._tmpRay.direction,this._tmpRay.direction),v(r.scenePickPoint)&&(ge(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),i=Me(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,uoe);let n=ye(Math.min(Iwe,1/Math.abs(_e(uoe,this._tmpRay.direction)))*s,C4[0],C4[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,aU);n=v(o)?o:n,n=i!=null?Math.min(n,i):n,this._hasPickPoint=!0,ae(this._tmpRay.direction,this._tmpRay.direction,n),me(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===uo.Horizontal){ge(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Me(this._tmpRayDir);yw(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let i=t*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<s&&(i=s),Math.abs(t-i)<1e-6)return;if(this._hasPickPoint&&i<t){const n=1-(1-i/t)*(1-this._sphere[3]/Me(this.currentCamera.center));this.currentCamera.center=ae(U$,this.currentCamera.center,n)}ae(this._tmpRayDir,this._tmpRayDir,-i/t),this.currentCamera.eye=me(U$,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=np(jw(this.dragBeginPoint,e)),Zs(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(EM(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),CJ(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Cv(this.currentCamera,this._sphere,this._panAxisAngle))}else{const t=Me(this._tmpRay.direction);yw(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let i=t*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<s&&(i=s),Math.abs(t-i)<1e-6)return;ae(this._tmpRayDir,this._tmpRay.direction,1-i/t),this.currentCamera.eye=me(U$,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=me(U$,this.currentCamera.center,this._tmpRayDir)}NC(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};HH=u([P("esri.views.3d.state.controllers.global.ZoomController")],HH);const U$=M(),uoe=M();let qH=class extends rm{constructor(){super(...arguments),this._tmpP=M(),this._tmpDir=M(),this._tmpN=M(),this._tmpP0=Ke(),this._tmpPoi=M(),this._tmpRayDir=M(),this.dragBeginPoint=ds(),this._normalizedAnchorPoint=Ke(),this._constraintOptions={selection:Bi.ALL,interactionType:nr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:M(),tiltMode:go.TUMBLE},this._plane=jr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;qn(this.dragBeginPoint,e),yw(this.startCamera,e,this._normalizedAnchorPoint);const t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Ox:{});ge(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Me(this._tmpDir);ve(this._tmpDir,this._tmpDir);const i=Math.abs(this.view.camera.position.z);let s=ye(Math.min(Iwe,1/Math.abs(_e(tet,this._tmpDir)))*i,C4[0],C4[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,aU);s=v(n)?n:s,s=t?Math.min(s,r):s,ae(this._tmpDir,this._tmpDir,s),me(this._tmpP,this.startCamera.eye,this._tmpDir),ge(this._tmpN,this.startCamera.eye,this.startCamera.center),ve(this._tmpN,this._tmpN),this._tmpN[1]<0&&Ea(this._tmpN,this._tmpN),_P(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;UQe(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||le(this._tmpPoi,this.currentCamera.center),yw(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);qn(this._normalizedAnchorPoint,this._tmpP0),ge(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Me(this._tmpRayDir);let i=r*(1-t);this._constraintOptions.interactionDirection&&(le(this._constraintOptions.interactionDirection,this._tmpRayDir),ae(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/r));const s=this.view.state.constraints.minimumPoiDistance;t>=0&&i<s&&(i=s,t=-(i-r)/r),Math.abs(r-i)<1e-6||(ae(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=me(l1,this.currentCamera.eye,this._tmpRayDir),rn(l1,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?l1[2]=Math.max(this.startCamera.center[2],l1[2]):l1[2]=Math.min(this.startCamera.center[2],l1[2]),this.currentCamera.center=l1,this._constraintOptions.interactionFactor=np(jw(this.dragBeginPoint,e)),Zs(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};qH=u([P("esri.views.3d.state.controllers.local.ZoomController")],qH);const l1=M(),tet=Le(0,0,1);class ret extends zo{constructor(t,r,i){super(!0),this._view=t,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!IJ(t.data,this.pointerAction))return;const i=ds(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new HH({view:this._view}):this._cameraController=new qH({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}}function vd(e){let t=e*e;return e<0&&(t*=-1),t}function hoe(e,t,r){const i=r,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=vd(s.axes[0]),i.translation[1]=vd(s.axes[1]),i.translation[2]=vd(s.buttons[7])-vd(s.buttons[6]),i.heading=vd(s.axes[2]),i.tilt=vd(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*vd(s.axes[0]),i.translation[1]=1.2*vd(s.axes[1]),i.translation[2]=2*-vd(s.axes[2]),i.heading=1.2*vd(s.axes[5]),i.tilt=1.2*vd(s.axes[3])),i.tilt*=o,ae(i.translation,i.translation,a),i}function doe(e,t){const r=t;return r.translation[0]=e[1]-e[0],r.translation[1]=e[3]-e[2],r.translation[2]=e[4]-e[5],r.heading=e[7]-e[6],r.tilt=e[8]-e[9],r.zoom=e[10]-e[11],r}function K9(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let rw=class extends rm{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Ct,this._headingStart=0,this._constraintOptions={selection:Bi.ALL,interactionType:nr.NONE,interactionStartCamera:new Ct,interactionFactor:0,interactionDirection:null,tiltMode:go.LOOK_AROUND}}handleEventGamepad(e){const t=hoe(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||K9(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,doe(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const t=doe(this._keysButtonState,this._transformation);K9(t)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(t-this._filteredSurfaceElevation)*e}stepController(e,t){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,c1),this._applyDisabledMovementTypes(c1),this._applyPan(c1.pan),this._applyRotate(c1.rotate),this._applyZoom(c1.zoom),this._applyAscend(c1.ascend),this._constraintOptions.interactionType=nr.NONE,this._constraintOptions.selection=Bi.COLLISION,Zs(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;ge(gl,t.center,t.eye),Ze(gl,gl,e.matrix),t.center=me(gl,gl,t.eye),t.up=Ze(gl,t.up,e.matrix),this._constraintOptions.interactionType=nr.LOOK_AROUND,this._constraintOptions.selection=Bi.ALL_EXCEPT_COLLISION,Zs(this.view,t,this._constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=Ze(gl,t.eye,e.matrix),t.center=Ze(gl,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Ze(gl,t.up,e.matrix)),this._constraintOptions.interactionType=nr.PAN,this._constraintOptions.selection=Bi.ALL,Zs(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=me(gl,this.currentCamera.eye,ae(We.get(),t,e)),le(xA,t),Ea(xA,xA),this._constraintOptions.interactionDirection=xA,this._constraintOptions.interactionType=nr.ZOOM,this._constraintOptions.selection=Bi.ALL_EXCEPT_COLLISION,Zs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,We.get());if(this._constraintOptions.interactionDirection=le(xA,t),this.view.state.isGlobal){const r=Me(this.currentCamera.eye),i=(r+e)/r;this.currentCamera.eye=ae(gl,this.currentCamera.eye,i),this.currentCamera.center=ae(gl,this.currentCamera.center,i)}else{const r=ae(We.get(),t,e);this.currentCamera.eye=me(gl,this.currentCamera.eye,r),this.currentCamera.center=me(gl,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=nr.ASCEND,this._constraintOptions.selection=Bi.COLLISION,Zs(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Bi.ALL_EXCEPT_COLLISION,Zs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,r){uet(r);const i=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(i,t,r):this._calculateControlTransformationGlobal(i,t,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(r,e,gl)}_calculateControlTransformationLocal(e,t,r){const{viewRight:i,viewForward:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=ce(We.get(),s[0],s[1],0);ve(a,a);const l=n.translation[0]*e.pan;if(l!==0){const y=ae(We.get(),i,l);Yl(r.pan.matrix,r.pan.matrix,y),r.pan.enabled=!0}switch(o.mode){case"pan":{const y=-n.translation[1]*e.pan;if(y!==0){const _=ae(We.get(),a,y);Yl(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}r.zoom=n.zoom*e.zoom;break}case"zoom":r.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;r.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Pc(r.rotate.matrix,r.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,We.get())),r.rotate.enabled=!0);const p=n.tilt*e.rotate,f=Ev(this.view.renderCoordsHelper,t.center,t.eye),m=ye(f+p,Qo.min,Qo.max)-f;m&&(Pc(r.rotate.matrix,r.rotate.matrix,m,i),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,r){const{eye:i,viewRight:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=dt(We.get(),s,i);ve(a,a),Ea(a,a),jQe(this.startCamera,t,n,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(c1.pan,this._tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;r.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Pc(r.rotate.matrix,r.rotate.matrix,h,this._tmpCamera.eye),r.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(Pc(r.rotate.matrix,r.rotate.matrix,f,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,r){const i=Zr(this.view.spatialReference),s=vN(Qo.min,t.origin,r,i);let n=0,o=0;const a=We.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,a)){const l=Ev(this.view.renderCoordsHelper,a,t.origin);n=vN(l,t.origin,r,i),o=vN(Qo.max,t.origin,r,i)}else{wC(o6(a6,r+i.radius),t,a);const l=Mn(-_e(t.direction,ve(a,a)));n=Xne(l,t.origin,r,i),o=Xne(Qo.max,t.origin,r,i)}return ye(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,r){const{renderCoordsHelper:i}=this.view,s=i.getAltitude(e),n=t+Math.abs(s-t);return i.setAltitude(r,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:r}=this.view,{camera:i}=this.view.state,{direction:s}=xKe(this.view,t,0,_xe,cet),n=r.intersectManifoldClosestSilhouette(zu(t,s),e,We.get()),o=Ai(t,n),a=r.intersectManifoldClosestSilhouette(zu(t,Cy(We.get(),t,i.center)),e,We.get()),l=Ai(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:r}=this.view,{camera:i,isGlobal:s}=r,n=t.intersectManifoldClosestSilhouette(i.ray,this._filteredSurfaceElevation,We.get());if(s){const o=ge(We.get(),e,n),a=Me(o);ae(o,o,1/a);const l=ve(We.get(),e),c=Mn(_e(l,o));return a*Math.sin(Math.min(set,c))}{const o=le(We.get(),e);return t.setAltitude(o,this._filteredSurfaceElevation),Ai(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:net}_computeVelocities(e){const t=this._filteredSurfaceElevation,r=t+Zr(this.view.spatialReference).radius,{camera:i,isGlobal:s}=this.view.state,n=We.get(),o=this._getPointAbsoluteSurfaceElevation(i.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=i.width/2,c=poe*i.width,h=poe*i.width,p=a*Math.tan(.5*i.fovX)/l,f=p/r,m=p/this._computeHeadingRotateRadius(n),y=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*y-y),zoom:2**(c*e/l)*a-a,rotate:ye(m*h,oet,aet)*e}}_applyDisabledMovementTypes(e){!v(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&td(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&td(e.rotate.matrix))}static activatesFor(e,t){const r=hoe(t,e.navigation.gamepad,iet);return!(t.action==="end"||K9(r))}};u([d({constructOnly:!0})],rw.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],rw.prototype,"disableMovements",void 0),rw=u([P("esri.views.3d.state.controllers.GamepadKeyboardController")],rw);const iet={translation:[0,0,0],heading:0,tilt:0,zoom:0},_xe=80,set=Gt(_xe),poe=.75,net=5,oet=Gt(30),aet=Gt(80),c1={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ie()},rotate:{enabled:!1,matrix:Ie()}},gl=M(),xA=M(),cet=$J();function uet(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,td(e.pan.matrix),e.rotate.enabled=!1,td(e.rotate.matrix)}class het extends zo{constructor(t){super(!0),this._view=t,this._watchHandles=new Jr,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([se(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},kt),se(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const r=this._view.navigation.gamepad.device;if(r&&t.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||rw.activatesFor(this._view,t.data)){if(!i){const s=new rw({view:this._view,gamepadDevice:t.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===t.data.device&&this._cameraControllerGamepad.handleEventGamepad(t.data)}}}var mc;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(mc||(mc={}));class det extends zo{constructor(t,r){super(!0),this._view=t,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ge.Local},this._keyToNumber={[r.left]:mc.LEFT,[r.right]:mc.RIGHT,[r.forward]:mc.FORWARD,[r.backward]:mc.BACKWARD,[r.up]:mc.UP,[r.down]:mc.DOWN,[r.headingLeft]:mc.HEADINGLEFT,[r.headingRight]:mc.HEADINGRIGHT,[r.tiltUp]:mc.TILTUP,[r.tiltDown]:mc.TILTDOWN,[r.zoomIn]:mc.ZOOMIN,[r.zoomOut]:mc.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this._keyToNumber[t.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new rw({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),t.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this._keyToNumber[t.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),t.stopPropagation())}}class pet extends zo{constructor(t,r){super(!0),this._view=t,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(t){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=t.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new M4({view:this._view,mode:"interaction"}):new P4({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,ds(r.x,r.y)),t.preventDefault(),t.stopPropagation()}}class F4{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let ox=class extends TM{constructor(){super(...arguments),this._beginCamera=new Ct,this._elapsedTimeSec=0,this.constraintOptions={selection:Bi.ALL,interactionType:nr.PAN,interactionFactor:0,interactionStartCamera:new Ct,interactionDirection:null,tiltMode:go.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new $E}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),Zs(this.view,t,this.constraintOptions)}};ox=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],ox);let sO=class extends ox{constructor(e){super(e),this.interactionType=nr.PAN,this._tmpPan=M()}momentumStep(e,t){const r=this.momentum.value(e);ae(this._tmpPan,this.momentum.direction,r),t.eye=ge(foe,t.eye,this._tmpPan),t.center=ge(foe,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([d({constructOnly:!0})],sO.prototype,"momentum",void 0),sO=u([P("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],sO);const foe=M(),fet=M(),k$=M();let wN=class extends ox{constructor(e){super(e),this.interactionType=nr.PAN}momentumStep(e,t){const r=this.momentum.value1(e),i=this.momentum.value2(e);le(k$,t.eye),ve(k$,k$),dt(this.momentum.axis2,k$,this.momentum.axis1),jwe(t,fet,this.momentum.axis1,r,this.momentum.axis2,i)}};u([d({constructOnly:!0})],wN.prototype,"momentum",void 0),wN=u([P("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],wN);let Bb=class extends ox{set center(e){this._set("center",bs(e))}set axis(e){this._set("axis",bs(e))}constructor(e){super(e),this.interactionType=nr.TUMBLE}momentumStep(e,t){const r=this.momentum.value(e);Cv(t,this.center,SM(this.axis,r))}};u([d({constructOnly:!0})],Bb.prototype,"momentum",void 0),u([d({constructOnly:!0})],Bb.prototype,"center",null),u([d({constructOnly:!0})],Bb.prototype,"axis",null),Bb=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Bb);let sS=class extends ox{set zoomCenter(e){this._set("zoomCenter",bs(e))}constructor(e){super(e),this.interactionType=nr.ZOOM,this.constraintOptions.interactionDirection=M()}momentumStep(e,t){const{interactionDirection:r}=this.constraintOptions;if(!r)return;le(r,t.eye);const i=this.momentum.valueDelta(0,e);OJ(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),Cy(r,t.eye,r)}};u([d({constructOnly:!0})],sS.prototype,"momentum",void 0),u([d({constructOnly:!0})],sS.prototype,"zoomCenter",null),sS=u([P("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],sS);let yb=class extends ox{set screenCenter(e){this._set("screenCenter",ds(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",bs(e))}constructor(e){super(e),this.interactionType=nr.ZOOM,this.radius=0,this._tmpSceneCenter=M(),this._tmpZoomAxisAngle=oU(),this._sphere=pn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){const r=this.momentum.valueDelta(0,e);Uwe(this._sphere,t,r),this.constraintOptions.interactionType=nr.ZOOM,Zs(this.view,t,this.constraintOptions),EM(this._sphere,t,this.screenCenter,this._tmpSceneCenter),CJ(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Cv(t,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=nr.PAN}};u([d({constructOnly:!0})],yb.prototype,"momentum",void 0),u([d({constructOnly:!0})],yb.prototype,"screenCenter",null),u([d({constructOnly:!0})],yb.prototype,"sceneCenter",null),u([d({constructOnly:!0})],yb.prototype,"radius",void 0),yb=u([P("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],yb);class op{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const r=this.computeDelta(t);this._updateDelta(r)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return this.lastValue===void 0?NaN:t-this.lastValue}_updateDelta(t){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}class hU{constructor(t,r,i){this._initialVelocity=t,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,r){const i=this.value(t);return this.value(t+r)-i}valueFromInitialVelocity(t,r){r=Math.min(r,this.duration);const i=1-this.friction;return t*(i**r-1)/Math.log(i)}}class met extends hU{constructor(t,r,i,s,n){super(t,r,i),this._sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class vxe{constructor(t=300,r=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new op(.6),this._screen=[new op(.4),new op(.4)],this._scene=[new op(.6),new op(.6),new op(.6)],this._tmpDirection=M()}add(t,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=t==null||r==null?0:Math.sqrt(t*t+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,r,i){var o,a,l;ce(this._tmpDirection,(o=this._scene[0].filteredDelta)!=null?o:0,(a=this._scene[1].filteredDelta)!=null?a:0,(l=this._scene[2].filteredDelta)!=null?l:0);const s=Me(this._tmpDirection);s>0&&ae(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new met(t,r,i,n==null?0:s/n,this._tmpDirection)}}class moe{constructor(t){this._gain=t}update(t){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const goe=1e-5;class get extends hU{constructor(t,r,i,s,n,o=0,a){super(t,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this._angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class yet{constructor(t=300,r=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=M(),this._tmpAxis2=M(),this._tmpAngles=Ke(),this._time=new op(.3),this._screen=[new op(.4),new op(.4)],this._angle1=new moe(.6),this._angle2=new moe(.6),this._axis1=M(),this._axis2=M(),this._lastScene=M()}addMomentumDirectRotation(t,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=zwe(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),ba(this._tmpAxis2)<goe?a=0:ve(this._axis1,this._tmpAxis2),this._angle1.update(a),le(this._lastScene,r)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(i)}}addMomentumPreserveHeading(t,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;Gwe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),ba(this._tmpAxis2)<goe?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ve(this._axis1,this._tmpAxis1),ve(this._axis2,this._tmpAxis2)),le(this._lastScene,r)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=t==null||r==null?null:Math.sqrt(t*t+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new get(t,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}}class bxe{constructor(t=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=t,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new op(.8),this.time=new op(.3)}add(t,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(t);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=ye(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,r,i){return new hU(t,r,i)}}class wxe extends bxe{constructor(t=3,r=.01,i=.95,s=12){super(t,r,i,s)}add(t,r){const i=this.value.lastValue;if(i!=null){let s=t-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=i+s}super.add(t,r)}}class _et extends hU{constructor(t,r,i){super(t,r,i)}value(t){const r=super.value(t);return Math.exp(r)}valueDelta(t,r){const i=super.value(t),s=super.value(t+r)-i;return Math.exp(s)}}class xxe extends bxe{constructor(t=2.5,r=.01,i=.95,s=12){super(t,r,i,s)}add(t,r){super.add(Math.log(t),r)}createMomentum(t,r,i){return new _et(t,r,i)}}let WH=class extends rm{constructor(){super(...arguments),this._smoothRotation=new F4(.05),this._rotationAxis=M(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=jr(),this._beginRadius=0,this._smoothScaling=new F4(.05),this._zoomCenterScreen=ds(),this._zoomMomentumEstimator=new xxe,this._rotationMomentumEstimator=new wxe,this._panSphericalMomentumEstimator=new yet,this._panPlanarMomentumEstimator=new vxe,this._adjustedSphere=pn(),this._tmp3d=M(),this._tmpScreenPointArray=ds(),this._beginScreenPoint=ds(),this._beginScenePoint=M(),this._screenPickPoint=ds(),this._scenePickPoint=M(),this._mode=uo.Horizontal,this._sphere=pn(),this._pointerCount=0,this._tmpInteractionDirection=M(),this._constraintOptions={selection:Bi.ALL,interactionType:nr.NONE,interactionFactor:0,interactionStartCamera:new Ct,interactionDirection:null,tiltMode:go.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var s;if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panPlanarMomentumEstimator.enabled=t,this._panSphericalMomentumEstimator.enabled=t,this._beginHeading=-dv.normalize(Gt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),qf(e.center,this._screenPickPoint),qn(this._beginScreenPoint,this._screenPickPoint);const r=Zr(this.view.spatialReference),i=Vwe(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,ZE.Silhouette,this.view.map.ground.opacity===0?Ox:{});E(i.scenePickPoint)||(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,le(this._beginScenePoint,this._scenePickPoint),this._mode=lU(this.startCamera,this._screenPickPoint,r),this._mode===uo.Vertical&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),(s=this._constraintOptions.interactionStartCamera)==null||s.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this._mode===uo.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._mode===uo.Horizontal?new yb({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new sS({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Bb({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===uo.Horizontal){const i=this._panSphericalMomentumEstimator.evaluateMomentum();if(i)return new wN({view:this.view,momentum:i})}else{const i=this._panPlanarMomentumEstimator.evaluateMomentum();if(i)return new sO({view:this.view,momentum:i})}return null}_preparePlanarPanMode(e,t){const r=Ea(this._tmp3d,this.startCamera.viewForward);_P(this._scenePickPoint,r,this._panningPlane);const i=ds(this._screenPickPoint[0],0),s=M(),n=Me(this.startCamera.eye);this._adjustedSphere[3]=n<this._sphere[3]?n-100:this._sphere[3],EM(this._adjustedSphere,this.startCamera,i,s);const o=ta();this.startCamera.projectToRenderScreen(s,o);const a=M(),l=M(),c=M();ge(a,this._scenePickPoint,this.currentCamera.eye);const h=Me(a);ve(a,a);const p=Nwe*Math.max(Math.abs(this.view.camera.position.z),Fwe),f=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,aU);let m=v(f)?f:p;m=t?Math.min(m,h):m,le(c,me(l,this.currentCamera.eye,ae(l,a,m))),this._panningPlane[3]=-_e(this._panningPlane,c),this.startCamera.center=me(l,this.startCamera.eye,ae(l,this.startCamera.viewForward,m));const y=qf(e.center,this._tmpScreenPointArray);BH(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),Uwe(this._sphere,this.currentCamera,this._smoothScaling.value),qf(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=nr.ZOOM,this._constraintOptions.interactionFactor=np(e.radius-this._beginRadius),Zs(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const t=qf(e.center,this._tmpScreenPointArray);EM(this._sphere,this.currentCamera,t,this._tmp3d),MJ(this._beginScenePoint,_e(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(qwe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Hwe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=nr.PAN,this._constraintOptions.interactionFactor=np(jw(this._screenPickPoint,t)),Zs(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ve(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Ea(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value,r=t+VH(e.angle-t),i=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=i,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),Cv(this.currentCamera,this._sphere,SM(this._rotationAxis,s)),this._constraintOptions.interactionType=nr.TUMBLE,this._constraintOptions.interactionFactor=np(e.radius*r),Zs(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const t=qf(e.center,this._tmpScreenPointArray);BH(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(Bwe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=nr.PAN,this._constraintOptions.interactionFactor=np(jw(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Zs(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),OJ(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=nr.ZOOM,this._constraintOptions.interactionFactor=np(e.radius-this._beginRadius),Zs(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){le(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Ea(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value;let r=e.angle-t;r=VH(r);const i=t+r,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Cv(this.currentCamera,this._sphere,SM(this._rotationAxis,n)),this._constraintOptions.interactionType=nr.TUMBLE,this._constraintOptions.interactionFactor=np(e.radius*n),Zs(this.view,this.currentCamera,this._constraintOptions)}};WH=u([P("esri.views.3d.state.controllers.global.PinchAndPanController")],WH);const yoe=Le(0,0,1),vet={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let XH=class extends rm{constructor(){super(...arguments),this._rotationValueSmooth=new F4(.05),this._scalingValueSmooth=new F4(.05),this._planeHorizontal=jr(),this._planeVertical=jr(),this._rotationMomentumEstimator=new wxe,this._panMomentumEstimator=new vxe(300,12,.9),this._zoomMomentumEstimator=new xxe,this._beginRadius=0,this._beginCenter=M(),this._beginAngle=0,this._tmpPoints=[],this._panMode=uo.Horizontal,this._beginCenterScreen=ds(),this._tmpCentroid3d=M(),this._tmpCentroid2d=ds(),this._tmp2d=ds(),this._pointerCount=0,this._constraintOptions={selection:Bi.ALL,interactionType:nr.NONE,interactionFactor:0,interactionStartCamera:new Ct,interactionDirection:null,tiltMode:go.TUMBLE}}begin(e){var m;if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),qf(e.center,this._beginCenterScreen),Hge(yoe,0,this._planeHorizontal);const r=M(),i=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?Ox:{}),s=M();Ea(s,this.startCamera.viewForward);const n=M();le(n,yoe);const o=_e(s,n),a=Zh(o<0?-o:o);this._panMode=a>=vet.ANGLE_THRESHOLD?uo.Horizontal:uo.Vertical;const l=Math.min(Nwe,1/Math.abs(_e(n,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),Fwe);rG(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||iG(this._planeHorizontal,this._planeHorizontal);const c=M(),h=M(),p=M();ge(c,r,this.currentCamera.eye);const f=Me(c);if(ve(c,c),this._panMode===uo.Vertical){ae(n,n,o),ge(this._planeVertical,s,n),ve(this._planeVertical,this._planeVertical),rG(this._planeVertical,this._planeVertical,r);const y=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,aU);let _=v(y)?y:l;_=i?Math.min(_,f):_,le(p,me(h,this.currentCamera.eye,ae(h,c,_))),this._planeVertical[3]=-_e(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),z9(this._tmpPoints,this._beginCenter)}else{const y=i?f:l;le(p,me(h,this.currentCamera.eye,ae(h,c,y))),this._planeHorizontal[3]=-_e(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),z9(this._tmpPoints,this._beginCenter)}(m=this._constraintOptions.interactionStartCamera)==null||m.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,r=this._panMode===uo.Horizontal?this._planeHorizontal:this._planeVertical,i=this._beginCenter;if(t){const s=this._beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=n,this._scalingValueSmooth.update(s),OJ(this.currentCamera,i,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=nr.ZOOM,this._constraintOptions.interactionFactor=np(Math.abs(e.radius-this._beginRadius)),Zs(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),z9(this._tmpPoints,this._tmpCentroid3d),qf(e.center,this._tmpCentroid2d),Bwe(this.currentCamera,i,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=nr.PAN,this._constraintOptions.interactionFactor=np(jw(this._beginCenterScreen,this._tmpCentroid2d)),Zs(this.view,this.currentCamera,this._constraintOptions),t){const s=this._planeHorizontal,n=i,o=this._rotationValueSmooth.value,a=o+VH(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp),Cv(this.currentCamera,n,SM(s,c)),this._constraintOptions.interactionType=nr.TUMBLE,this._constraintOptions.interactionFactor=np(Math.abs(e.radius*c)),Zs(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new sS({view:this.view,momentum:t,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new Bb({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const i=this._panMomentumEstimator.evaluateMomentum();return i?new sO({view:this.view,momentum:i}):null}_computePlanePoints(e,t,r,i){i.length=e.size;const s=this._tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,i[n]===void 0&&(i[n]=M()),BH(t,r,s,i[n]),n+=1}),i}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};XH=u([P("esri.views.3d.state.controllers.local.PinchAndPanController")],XH);class _oe extends zo{constructor(t,r,i){super(!0),this._view=t,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!IJ(t.data,this.pointerAction))return;const r=t.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(t.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?t.data.timestamp-this._lastTimestamp>2&&(this._controller.update(t.data),this._lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=t.timestamp;const i=this._controller.end(t.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(t){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(t.data),this._lastTimestamp=t.timestamp}_createController(){return this._view.state.isGlobal?new WH({view:this._view}):new XH({view:this._view})}}class bet extends zo{constructor(t,r){super(!0),this.view=t,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}}class Txe extends zo{constructor(t,r){super(!0),this.key=t,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class wet extends Txe{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class xet extends Txe{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class Tet extends zo{constructor(t,r=!1){super(!0),this._view=t,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(t){var s,n,o;const r=this._invert?-1:1,i=ds(0,t.data.delta*r);switch(t.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new iO({view:this._view,pivot:bc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(n=this._cameraController)==null||n.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}}function voe(e){const t=e.native;return t?{buttons:t.buttons.map(r=>r.pressed?r.value?r.value:1:0),axes:t.axes.map(r=>Aet(r,e.axisThreshold))}:{buttons:[],axes:[]}}function Eet(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let r=0;r<e.axes.length;r++)if(e.axes[r]!==t.axes[r])return!1;for(let r=0;r<e.buttons.length;r++)if(e.buttons[r]!==t.buttons[r])return!1;return!0}function Cet(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function Aet(e,t){const r=Math.abs(e);return r<t?0:Math.sign(e)*(r-t)/(1-t)}class Ret{constructor(t,r){this._element=t,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,voe(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this._callback=t}_connectGamepad(t){const r=new IZ(t);r.deviceType!=="unknown"&&(this._inputDevices[t.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=rE({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!t||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=voe(n),l=i||Cet(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Eet(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&t(s)}}_emitGamepadEvent(t,r,i){const s=this._latestUpdate[t.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[t.index]={timestamp:t.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[t.index],state:r,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let r=0;r<t.axes.length;r++)if(isNaN(t.axes[r]))return!1;return!0}}const boe=de("edge"),Oet=de("chrome"),Met=de("ff"),Pet=de("safari"),woe="esri-view-surface",tT={touchNone:`${woe}--touch-none`,touchPan:`${woe}--touch-pan`};class dU{constructor(t,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Ret(t,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource=Ve(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){var r;for(const i in this._active)if(!t||!t.has(i)){const s=this._active[i];this._element.removeEventListener(eV[i],s),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&eV[i]){const s=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(eV[i],s),this._active[i]=s}}),this._gamepadSource.hasEventListeners=(r=t==null?void 0:t.has("gamepad"))!=null?r:!1}setPointerCapture(t,r){r?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?tT.touchNone:tT.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?tT.touchPan:tT.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(tT.touchNone),this._element.classList.remove(tT.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,r){const i=H1e(this._element,t);return dU.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(t,r){const i=nje(r);i&&t==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(t,i)}_handlePointerPreventDefault(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(t,i)}_handleMouseWheel(t,r){let i=r.deltaY;switch(r.deltaMode){case 0:boe&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}boe?i*=.7:Oet||Pet?i*=.6:Met&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(t,o)}_handlePointerCaptureLost(t,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(t,r)}_handleDefault(t,r){const i={native:r};r.preventDefault(),this._callback(t,i)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}dU.test={disableSubpixelCoordinates:!1};const eV={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class Iet extends zo{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function Sxe(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function $et(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}function Let(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:Kh()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[S,C]=e,[O,R]=[C.x-S.x,C.y-S.y];return t.radius=Math.sqrt(O*O+R*R)/2,t.center.x=(S.x+C.x)/2,t.center.y=(S.y+C.y)/2,t}let r=0,i=0;for(let S=0;S<e.length;S++)r+=e[S].x,i+=e[S].y;r/=e.length,i/=e.length;const s=e.map(S=>S.x-r),n=e.map(S=>S.y-i);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let S=0;S<s.length;S++){const C=s[S],O=n[S],R=C*C,$=O*O;o+=R,a+=$,l+=C*O,c+=R*C,h+=$*O,p+=C*$,f+=O*R}const m=.5*(c+p),y=.5*(h+f),_=o*a-l*l,b=(m*a-y*l)/_,x=(o*y-l*m)/_,T=Kh(b+r,x+i);return{radius:Math.sqrt(b*b+x*x+(o+a)/e.length),center:T}}function nO(e){const{native:t}=e,{pointerId:r,button:i,pointerType:s}=t;return s==="mouse"?`${r}:${i}`:`${s}`}class Det extends zo{constructor(t){super(!1),this._navigationTouch=t,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,r,i,s){return{action:t,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:Net(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(t){const r=t.native.pointerId,i=V$(this._activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=xN(s,Exe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const r=t.native.pointerId,i=this._activePointerMap.get(r);i?i.event=t:this._addPointer(t)}_removePointer(t){const r=V$(this._activePointerMap).angle;this._activePointerMap.delete(t),this._updatePointerAngles(r)}_updatePointerAngles(t){const r=V$(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=xN(i,r)-t,i.lastAngle=xN(i,r)-t})}_emitEvent(t,r,i){const s=V$(this._activePointerMap);this._drag.emit(this._createPayload(t,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(t){const r=t.data.native.pointerId,i=t.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(t.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",t.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const r=t.data,i=r.currentEvent,s=t.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=t.data.startEvent.pointerType,this._mouseButton=t.data.startEvent.button,this._startStateModifiers=t.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}}function Exe(e){const t=[];return e.forEach(r=>{t.push(Kh(r.event.x,r.event.y))}),Let(t)}function V$(e){const t=Exe(e);let r=0;return e.forEach(i=>{let s=xN(i,t),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s,r+=s-i.initialAngle}),r/=e.size||1,{angle:r,radius:t.radius,center:t.center}}function Net(e){const t=new Map;return e.forEach((r,i)=>t.set(i,r.event)),t}function xN(e,t){const r=e.event,i=r.x-t.center.x,s=r.y-t.center.y;return Math.atan2(s,i)}var xoe;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(xoe||(xoe={}));const q_={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class Fet extends zo{constructor(t=q_.maximumDoubleClickDelay,r=q_.maximumDoubleClickDistance,i=q_.maximumDoubleTouchDelay,s=q_.maximumDoubleTouchDistance,n=R5){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimer=zi(t.doubleClickTimer))}get hasPendingInputs(){return ea(this._pointerState,t=>t.doubleClickTimer!=null)}_clearDoubleClickTimer(t,r){const i=this._pointerState.get(t);i&&(i.doubleClickTimer=zi(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const r=this._pointerState.get(t);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}_getPointerId(t){const{pointerId:r,pointerType:i,button:s}=t.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(t){const r=t.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(t);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Sxe(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(t)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(t){const r=nO(t.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(t){const{data:r}=t,{native:{pointerType:i}}=r,s=nO(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:t,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}}class Uet extends zo{constructor(t=q_.maximumDoubleClickDelay,r=q_.maximumDoubleClickDistance,i=q_.maximumDoubleTouchDelay,s=q_.maximumDoubleTouchDistance,n=R5){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=nO(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(t){const r=t.data,i=nO(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Sxe(n,t.data)>o?this._startImmediateDoubleClick(t,s):(this._immediateDoubleClick.emit(t.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,s)}}_startImmediateDoubleClick(t,r){const i=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),i)}}_removeState(t){const r=nO(t);this._pointerState.delete(r),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const TA={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class ket extends zo{constructor(t=TA.maximumClickDelay,r=TA.movementUntilMouseDrag,i=TA.movementUntilPenDrag,s=TA.movementUntilTouchDrag,n=TA.holdDelay,o=R5){super(!1),this._maximumClickDelay=t,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout=zi(t.holdTimeout)}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:t.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,r,i){return{action:t,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(t){const r=t.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):$et(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(t),s.previousEvent=r)}_getDragThreshold(t){switch(t){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){const r=t.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,r){const i=t.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&t.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}}class Vet{constructor(t){this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(t){const r=t.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(t);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(t);break;case"end":this._emitEnd(t),this._currentCount=0}this._previousEvent=t}_emitStart(t){var r,i;this._startEvent=t,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,t)&&this._callbacks.start(this._currentCount,t,this._startEvent)}_emitUpdate(t){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,t)&&this._callbacks.update(this._currentCount,t,this._startEvent)}_emitEnd(t){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,t)&&this._callbacks.end(this._currentCount,t,this._startEvent),this._startEvent=null}}class Bet extends zo{constructor(t=20,r=40){super(!1),this._threshold=t,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Vet({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(t,r){t===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=t===2?"ready":"failed"}_observeUpdate(t,r,i){if(this._state!=="failed"&&t===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(t){this._state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:b}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,b),o=Math.min(o,b);let a=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:_,y:b}of t.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,b),h=Math.min(h,b);const p=i-s,f=n-o,m=a-l,y=c-h;return Math.abs(t.center.x-r.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(t,r){let i=Math.abs(t.center.y-r.center.y);return t.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}}let Bd=class extends Te{constructor(){super(...arguments),this._handles=new Jr}destroy(){this._handles=Ve(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return!!((e=this._inputManager)!=null&&e.hasPendingInputs)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e,t;return(t=(e=this._inputManager)==null?void 0:e.multiTouchActive)!=null?t:!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Ve(this._inputManager)}connect(){const e=this.view;this._source=new dU(this.view.surface,e.input);const t=[new Uet,new ket,new Fet,new Det(this.view.navigation),new Bet],r=new wf({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new Iet],tv.INTERNAL),this._modeDragPan=new _oe(e,"primary"),this._modeDragRotate=new Q9(e,"secondary",bc.CENTER),this._modeDragZoom=new ret(e,"tertiary");const i={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new bet(e),new JQe(e),new het(e),new det(e,i.pan),new pet(e),new xet(e,i.resetTilt),new wet(e,i.resetHeading),new Q9(e,"primary",bc.EYE,[i.lookAround]),new Q9(e,"secondary",bc.CENTER,[i.lookAround]),new _oe(e,"tertiary",[i.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Tet(e)],tv.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(se(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},kt))}_updateMode(){var i;const e=this.mode,t=this.primaryDragAction,r=(i=YH.get(e))==null?void 0:i.get(t);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],Bd.prototype,"view",void 0),u([d({value:"pan"})],Bd.prototype,"primaryDragAction",null),u([d({value:"default"})],Bd.prototype,"mode",null),u([d({readOnly:!0})],Bd.prototype,"hasPendingInputs",null),u([d()],Bd.prototype,"latestPointerType",null),u([d()],Bd.prototype,"latestPointerLocation",null),u([d()],Bd.prototype,"multiTouchActive",null),u([d()],Bd.prototype,"_inputManager",void 0),Bd=u([P("esri.views.3d.input.SceneInputManager")],Bd);const YH=new Map,tV=new Map,rV=new Map;tV.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),tV.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),rV.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),rV.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),YH.set("default",tV),YH.set("pro",rV);const zet=Bd;let _u,BS,ZH=!1,JH=!1,QH=!1,KH=!1,oO=null;function Get(e,t){if(!JH||!BS)return;Cxe();const r=BS;let i=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];i+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),Axe(a,l,c,h,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+t.size,70,50),r.fillText("total numTests: "+e.accNumTests,70,30)}function jet(e){QH=Xr.DECONFLICTOR_SHOW_VISIBLE,KH=Xr.DECONFLICTOR_SHOW_INVISIBLE,ZH=QH||KH,JH=Xr.DECONFLICTOR_SHOW_GRID,oO=null,ZH||JH?oO=()=>Het(e):_u&&(_u.parentElement.removeChild(_u),_u=null)}function Cxe(){oO&&(oO(),oO=null)}function Het(e){_u==null&&(_u=document.createElement("canvas"),_u.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(_u));const{state:t}=e,{camera:r,pixelRatio:i}=t,{width:s,height:n}=r,o=s*i,a=n*i;_u.setAttribute("width",`${o}px`),_u.setAttribute("height",`${a}px`),_u.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),BS=_u.getContext("2d"),BS.clearRect(0,0,s,n),BS.font="12px Arial"}function Axe(e,t,r,i,s){Cxe();const n=_u.height,o=BS;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-r),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.closePath()}function qet(e,t){ZH&&(t&&QH||!t&&KH)&&Axe(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var Do,Rc;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(Do||(Do={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(Rc||(Rc={}));function Rxe(e,t){return new pU(e,Ixe,t)}function Wet(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=Ixe;return new pU(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:iV.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:iV.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:iV.minPixelSize},t)}function Xet(e){return Math.abs(e*e*e)}function Oxe(e,t,r){const i=r.parameters,s=r.paddingPixelsOverride;return SA.scale=Math.min(i.divisor/(t-i.offset),1),SA.factor=Xet(e),SA.minPixelSize=i.minPixelSize,SA.paddingPixels=s,SA}function Mxe(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function VJ(e,t){return Math.max(Nt(e*t.scale,e,t.factor),Mxe(e,t))}function Yet(e,t,r){const i=Oxe(e,t,r);return i.minPixelSize=0,i.paddingPixels=0,VJ(1,i)}function Toe(e,t,r,i){i.scale=Yet(e,t,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function Pxe(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,Mxe(e[1],t)/Math.max(1e-5,e[1])),1);return r[0]=e[0]*i,r[1]=e[1]*i,r}function Zet(e,t,r,i){return VJ(e,Oxe(t,r,i))}class pU{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(t,r,i,s=Jet(),n){this._viewingMode=t,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===Ge.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this._ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new pU(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=t,c=this._calculateCurvatureDependentParameters(t,r),h=this._coverageCompensation(t,r,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),_=m/Math.cos(y),b=y+a*n*h,x=(_-f*(m/Math.cos(b)))/(1-f);return i.camera.fovY=t.fovY,i.camera.distance=t.distance,i.offset=x,i.divisor=_-x,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(t,r,i=Soe){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(t,r,i=Soe){const s=this._description.curvatureDependent,n=1+t.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=ye((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return i.tiltAngle=Nt(h.tiltAngle,p.tiltAngle,c),i.scaleFallOffFactor=Nt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(t,r,i){return(t.fovY-i.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}}const Ixe={curvatureDependent:{min:{curvature:Gt(10),tiltAngle:Gt(12),scaleFallOffFactor:.5},max:{curvature:Gt(70),tiltAngle:Gt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},iV={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Jet(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const SA={scale:0,factor:0,minPixelSize:0,paddingPixels:0},Soe={tiltAngle:0,scaleFallOffFactor:0};function Qet(e){return e instanceof Float32Array&&e.length>=16}function Ket(e){return Array.isArray(e)&&e.length>=16}function ett(e){return Qet(e)||Ket(e)}function BJ(e){e.vertex.code.add(w`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(w`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(w`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(w`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(w`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(w`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(w`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function ttt(e){e.uniforms.add(new fr("screenSizePerspective",t=>$xe(t.screenSizePerspective)))}function fU(e){e.uniforms.add(new fr("screenSizePerspectiveAlignment",t=>$xe(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function $xe(e){return ti(rtt,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const rtt=sr();class Lxe extends Es{constructor(t,r){super(t,"mat4",fi.Draw,(i,s,n)=>i.setUniformMatrix4fv(t,r(s,n)))}}function Fp(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",Sa):e.uniforms.add(new Nu("cameraPosition",(r,i)=>ce(Dxe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Nc(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add([new Yi("proj",(i,s)=>s.camera.projectionMatrix),new Lxe("view",(i,s)=>Yl(Eoe,s.camera.viewMatrix,i.origin)),new Nu("localOrigin",i=>i.origin)]);const r=i=>ce(Dxe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);e.uniforms.add([new Yi("proj",(i,s)=>s.camera.projectionMatrix),new Yi("view",(i,s)=>Yl(Eoe,s.camera.viewMatrix,r(s))),new qt("localOrigin",(i,s)=>r(s))])}const Eoe=xP(),Dxe=M();function KE(e){e.uniforms.add(new Yi("viewNormal",(t,r)=>r.camera.viewInverseTransposeMatrix))}function Nxe(e,t){const r=e.vertex;t.hasVerticalOffset?(Fxe(r),t.hasScreenSizePerspective&&(e.include(BJ),fU(r),Fp(e.vertex,t)),r.code.add(w`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?w`vec3 worldNormal = normalize(worldPos + localOrigin);`:w`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?w`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:w`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(w`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const itt=sr();function Fxe(e){e.uniforms.add(new fr("verticalOffset",(t,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return ti(itt,n*a,o,i,s)}))}var fu;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(fu||(fu={}));var zl;function Uxe(e,t){e.include(BJ),e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.NORMAL,"vec3"),e.attributes.add(A.AUXPOS1,"vec4");const r=e.vertex;Nc(r,t),Fp(r,t),r.uniforms.add([new fr("viewport",(i,s)=>s.camera.fullViewport),new Pe("polygonOffset",i=>i.shaderPolygonOffset),new Pe("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new Pe("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===fu.Occluded?1:s.renderTransparentlyOccludedHUD===fu.NotOccluded?0:.75),new Mt("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&Fxe(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(w`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(w`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||KE(r),t.isDraped||(r.uniforms.add(new Pe("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(w`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===zl.Screen&&r.uniforms.add(new Pe("pixelRatio",(i,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&fU(r),r.code.add(w`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===zl.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?w`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==zl.Screen?w`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===zl.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===zl.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.code.add(w`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(zl||(zl={}));const B$=In();function kxe(e,t,r,i,s,n){if(e.visible)if(e.boundingInfo){mt(e.type===Fs.Mesh);const o=t.tolerance;Vxe(e.boundingInfo,r,i,o,s,n)}else{const o=e.indices.get(A.POSITION),a=e.vertexAttributes.get(A.POSITION);zP(r,i,0,o.length/3,o,a,void 0,s,n)}}const stt=M();function Vxe(e,t,r,i,s,n){if(E(e))return;const o=zxe(t,r,stt);if(Pfe(B$,e.bbMin),Ife(B$,e.bbMax),v(s)&&s.applyToAabb(B$),GJ(B$,t,o,i)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>ltt){const p=e.getChildren();if(p!==void 0){for(const f of p)Vxe(f,t,r,i,s,n);return}}zP(t,r,0,h,l,c,a,s,n)}}const Bxe=M();function zP(e,t,r,i,s,n,o,a,l){if(o)return ntt(e,t,r,i,s,n,o,a,l);const{data:c,stride:h}=n,p=e[0],f=e[1],m=e[2],y=t[0]-p,_=t[1]-f,b=t[2]-m;for(let x=r,T=3*r;x<i;++x){let S=h*s[T++],C=c[S++],O=c[S++],R=c[S];S=h*s[T++];let $=c[S++],I=c[S++],U=c[S];S=h*s[T++];let V=c[S++],G=c[S++],z=c[S];v(a)&&([C,O,R]=a.applyToVertex(C,O,R,x),[$,I,U]=a.applyToVertex($,I,U,x),[V,G,z]=a.applyToVertex(V,G,z,x));const Z=$-C,Q=I-O,te=U-R,q=V-C,L=G-O,N=z-R,F=_*N-L*b,H=b*q-N*y,X=y*L-q*_,K=Z*F+Q*H+te*X;if(Math.abs(K)<=Number.EPSILON)continue;const W=p-C,ue=f-O,pe=m-R,we=W*F+ue*H+pe*X;if(K>0){if(we<0||we>K)continue}else if(we>0||we<K)continue;const Ce=ue*te-Q*pe,qe=pe*Z-te*W,Ne=W*Q-Z*ue,xe=y*Ce+_*qe+b*Ne;if(K>0){if(xe<0||we+xe>K)continue}else if(xe>0||we+xe<K)continue;const Fe=(q*Ce+L*qe+N*Ne)/K;Fe>=0&&l(Fe,zJ(Z,Q,te,q,L,N,Bxe),x,!1)}}function ntt(e,t,r,i,s,n,o,a,l){const{data:c,stride:h}=n,p=e[0],f=e[1],m=e[2],y=t[0]-p,_=t[1]-f,b=t[2]-m;for(let x=r;x<i;++x){const T=o[x];let S=3*T,C=h*s[S++],O=c[C++],R=c[C++],$=c[C];C=h*s[S++];let I=c[C++],U=c[C++],V=c[C];C=h*s[S];let G=c[C++],z=c[C++],Z=c[C];v(a)&&([O,R,$]=a.applyToVertex(O,R,$,x),[I,U,V]=a.applyToVertex(I,U,V,x),[G,z,Z]=a.applyToVertex(G,z,Z,x));const Q=I-O,te=U-R,q=V-$,L=G-O,N=z-R,F=Z-$,H=_*F-N*b,X=b*L-F*y,K=y*N-L*_,W=Q*H+te*X+q*K;if(Math.abs(W)<=Number.EPSILON)continue;const ue=p-O,pe=f-R,we=m-$,Ce=ue*H+pe*X+we*K;if(W>0){if(Ce<0||Ce>W)continue}else if(Ce>0||Ce<W)continue;const qe=pe*q-te*we,Ne=we*Q-q*ue,xe=ue*te-Q*pe,Fe=y*qe+_*Ne+b*xe;if(W>0){if(Fe<0||Ce+Fe>W)continue}else if(Fe>0||Ce+Fe<W)continue;const ke=(L*qe+N*Ne+F*xe)/W;ke>=0&&l(ke,zJ(Q,te,q,L,N,F,Bxe),T,!1)}}const Coe=M(),Aoe=M();function zJ(e,t,r,i,s,n,o){return ce(Coe,e,t,r),ce(Aoe,i,s,n),dt(o,Coe,Aoe),ve(o,o),o}function zxe(e,t,r){return ce(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function GJ(e,t,r,i){return jJ(e,t,r,i,1/0)}function jJ(e,t,r,i,s){const n=(e[0]-i-t[0])*r[0],o=(e[3]+i-t[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-i-t[1])*r[1],h=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-i-t[2])*r[2],f=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function Gxe(e,t,r,i,s){let n=(r.screenLength||0)*e.pixelRatio;v(s)&&(n=Zet(n,i,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return ye(o*t,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function jxe(e,t){const r=t?jxe(t):{};for(const i in e){let s=e[i];s&&s.forEach&&(s=att(s)),s==null&&i in r||(r[i]=s)}return r}function ott(e,t){let r=!1;for(const i in t){const s=t[i];s!==void 0&&(Array.isArray(s)?e[i]===null?(e[i]=s.slice(),r=!0):bW(e[i],s)&&(r=!0):e[i]!==s&&(r=!0,e[i]=s))}return r}function att(e){const t=[];return e.forEach(r=>t.push(r)),t}const Hxe={multiply:1,ignore:2,replace:3,tint:4},ltt=1e3;class Bv extends UP{constructor(t,r){super(),this.type=Fs.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Or,this._pp0=Le(0,0,1),this._pp1=Le(0,0,0),this._parameters=jxe(t,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,r=!0){ott(this._parameters,t)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleForOutput(t.output)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleForOutput(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){v(this.repository)&&this.repository.materialChanged(this)}intersectDraped(t,r,i,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(t,r,i,this._pp0,this._pp1,n)}}class qxe extends wYe{constructor(t,r,i){super(r,i),this.camera=t}}var us;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(us||(us={}));class VC extends gi{constructor(){super(...arguments),this.renderOccluded=us.Occlude}}class Wxe{constructor(){this.factor=new Roe,this.factorAlignment=new Roe}}class Roe{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}}function V2t(e,t,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=t[e[l]],i+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[i]=c,i+=o}}function ctt(e,t,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=e.length;i*=n;for(let a=0;a<o;++a){const l=2*e[a];s[i]=t[l],s[i+1]=t[l+1],i+=n}}function Xxe(e,t,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],i+=o}}function eC(e,t,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],n[i+3]=t[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],n[i+3]=t[c+3],i+=o}}function Ooe(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride;t*=s;for(let n=0;n<r;++n)i[t]=0,i[t+1]=0,i[t+2]=0,i[t+3]=0,t+=s}function mU(e,t,r,i,s,n=1){if(!r)return void Xxe(e,t,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=e.length,c=r[0],h=r[1],p=r[2],f=r[4],m=r[5],y=r[6],_=r[8],b=r[9],x=r[10],T=r[12],S=r[13],C=r[14];s*=a;let O=0,R=0,$=0;const I=i6(r)?U=>{O=t[U]+T,R=t[U+1]+S,$=t[U+2]+C}:U=>{const V=t[U],G=t[U+1],z=t[U+2];O=c*V+f*G+_*z+T,R=h*V+m*G+b*z+S,$=p*V+y*G+x*z+C};if(n===1)for(let U=0;U<l;++U)I(3*e[U]),o[s]=O,o[s+1]=R,o[s+2]=$,s+=a;else for(let U=0;U<l;++U){I(3*e[U]);for(let V=0;V<n;++V)o[s]=O,o[s+1]=R,o[s+2]=$,s+=a}}function HJ(e,t,r,i,s,n=1){if(!r)return void Xxe(e,t,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],b=o[8],x=o[9],T=o[10],S=!HX(o),C=1e-6,O=1-C;s*=l;let R=0,$=0,I=0;const U=i6(o)?V=>{R=t[V],$=t[V+1],I=t[V+2]}:V=>{const G=t[V],z=t[V+1],Z=t[V+2];R=h*G+m*z+b*Z,$=p*G+y*z+x*Z,I=f*G+_*z+T*Z};if(n===1)if(S)for(let V=0;V<c;++V){U(3*e[V]);const G=R*R+$*$+I*I;if(G<O&&G>C){const z=1/Math.sqrt(G);a[s]=R*z,a[s+1]=$*z,a[s+2]=I*z}else a[s]=R,a[s+1]=$,a[s+2]=I;s+=l}else for(let V=0;V<c;++V)U(3*e[V]),a[s]=R,a[s+1]=$,a[s+2]=I,s+=l;else for(let V=0;V<c;++V){if(U(3*e[V]),S){const G=R*R+$*$+I*I;if(G<O&&G>C){const z=1/Math.sqrt(G);R*=z,$*=z,I*=z}}for(let G=0;G<n;++G)a[s]=R,a[s+1]=$,a[s+2]=I,s+=l}}function utt(e,t,r,i,s,n=1){if(!r)return void eC(e,t,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],_=o[6],b=o[8],x=o[9],T=o[10],S=!HX(o),C=1e-6,O=1-C;if(s*=l,n===1)for(let R=0;R<c;++R){const $=4*e[R],I=t[$],U=t[$+1],V=t[$+2],G=t[$+3];let z=h*I+m*U+b*V,Z=p*I+y*U+x*V,Q=f*I+_*U+T*V;if(S){const te=z*z+Z*Z+Q*Q;if(te<O&&te>C){const q=1/Math.sqrt(te);z*=q,Z*=q,Q*=q}}a[s]=z,a[s+1]=Z,a[s+2]=Q,a[s+3]=G,s+=l}else for(let R=0;R<c;++R){const $=4*e[R],I=t[$],U=t[$+1],V=t[$+2],G=t[$+3];let z=h*I+m*U+b*V,Z=p*I+y*U+x*V,Q=f*I+_*U+T*V;if(S){const te=z*z+Z*Z+Q*Q;if(te<O&&te>C){const q=1/Math.sqrt(te);z*=q,Z*=q,Q*=q}}for(let te=0;te<n;++te)a[s]=z,a[s+1]=Z,a[s+2]=Q,a[s+3]=G,s+=l}}function qJ(e,t,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=e.length;if(s*=a,r!==t.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}return}for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else{o[s]=t[0],o[s+1]=t[1],o[s+2]=t[2],o[s+3]=t[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),h=a/4,p=c[s/=4];s+=h;const f=l*n;for(let m=1;m<f;++m)c[s]=p,s+=h}}function Yxe(e,t,r,i,s=1){const n=t.typedBuffer,o=t.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],n[i+3]=e[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],n[i+3]=e[3],i+=o}function Zxe(e,t,r,i,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case A.POSITION:{mt(a.size===3);const c=s.getField(o,mi);mt(!!c,`No buffer view for ${o}`),c&&mU(l,a.data,r,c,n);break}case A.NORMAL:{mt(a.size===3);const c=s.getField(o,mi);mt(!!c,`No buffer view for ${o}`),c&&HJ(l,a.data,i,c,n);break}case A.UV0:{mt(a.size===2);const c=s.getField(o,nd);mt(!!c,`No buffer view for ${o}`),c&&ctt(l,a.data,c,n);break}case A.COLOR:case A.SYMBOLCOLOR:{mt(a.size===3||a.size===4);const c=s.getField(o,_o);mt(!!c,`No buffer view for ${o}`),c&&qJ(l,a.data,a.size,c,n);break}case A.TANGENT:{mt(a.size===4);const c=s.getField(o,Ma);mt(!!c,`No buffer view for ${o}`),c&&utt(l,a.data,i,c,n);break}case A.PROFILERIGHT:case A.PROFILEUP:case A.PROFILEVERTEXANDNORMAL:case A.FEATUREVALUE:{mt(a.size===4);const c=s.getField(o,Ma);mt(!!c,`No buffer view for ${o}`),c&&eC(l,a.data,c,n)}}else if(o===A.OBJECTANDLAYERIDCOLOR&&v(e.objectAndLayerIdColor)){const c=e.indices.get(A.POSITION);if(mt(!!c,`No buffer view for ${o}`),c){const h=c.length,p=s.getField(o,_o);Yxe(e.objectAndLayerIdColor,p,h,n)}}}}function AM(e,t,r=0){const i=ye(e,0,ptt);for(let s=0;s<4;s++)t[r+s]=Math.floor(256*ftt(i*htt[s]))}function WJ(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*dtt[i];return r}const htt=[1,256,65536,16777216],dtt=[1/256,1/65536,1/16777216,1/4294967296],ptt=WJ(new Uint8ClampedArray([255,255,255,255]));function ftt(e){return e-Math.floor(e)}async function Ty(e,t){const{data:r}=await Di(e,{responseType:"image",...t});return r}class XJ extends gi{constructor(){super(...arguments),this.color=Ht(1,1,1,1)}}function mtt(){const e=new Lr;return e.include(ud),e.fragment.uniforms.add([new Mt("tex",t=>t.texture),new fr("uColor",t=>t.color)]),e.fragment.code.add(w`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const gtt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:XJ,build:mtt},Symbol.toStringTag,{value:"Module"}));function ytt(){if(E(sV)){const e=t=>Kr(`esri/libs/basisu/${t}`);sV=ie(()=>import("./basis_transcoder.73b61ed2.js"),["assets/basis_transcoder.73b61ed2.js","assets/_commonjsHelpers.4421ccc9.js"]).then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(r=>(r.initializeBasis(),delete r.then,r)))}return sV}let sV;var zb;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(zb||(zb={}));let Sp=null,z$=null;async function Jxe(){return E(z$)&&(z$=ytt(),Sp=await z$),z$}function _tt(e,t){if(E(Sp))return e.byteLength;const r=new Sp.BasisFile(new Uint8Array(e)),i=Kxe(r)?Qxe(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),i}function vtt(e,t){if(E(Sp))return e.byteLength;const r=new Sp.KTX2File(new Uint8Array(e)),i=eTe(r)?Qxe(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),i}function Qxe(e,t,r,i,s){const n=Tbe(t?Ls.COMPRESSED_RGBA8_ETC2_EAC:Ls.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*i*n*o)}function Kxe(e){return e.getNumImages()>=1&&!e.isUASTC()}function eTe(e){return e.getFaces()>=1&&e.isETC1S()}async function btt(e,t,r){E(Sp)&&(Sp=await Jxe());const i=new Sp.BasisFile(new Uint8Array(r));if(!Kxe(i))return null;i.startTranscoding();const s=tTe(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function wtt(e,t,r){E(Sp)&&(Sp=await Jxe());const i=new Sp.KTX2File(new Uint8Array(r));if(!eTe(i))return null;i.startTranscoding();const s=tTe(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function tTe(e,t,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?i?[zb.ETC2_RGBA,Ls.COMPRESSED_RGBA8_ETC2_EAC]:[zb.ETC1_RGB,Ls.COMPRESSED_RGB8_ETC2]:c?i?[zb.BC3_RGBA,Ls.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[zb.BC1_RGB,Ls.COMPRESSED_RGB_S3TC_DXT1_EXT]:[zb.RGBA32,ze.RGBA],f=t.hasMipmap?r:Math.min(1,r),m=[];for(let x=0;x<f;x++)m.push(new Uint8Array(o(x,h))),a(x,h,m[x]);const y=m.length>1,_=y?rt.LINEAR_MIPMAP_LINEAR:rt.LINEAR,b={...t,samplingMode:_,hasMipmap:y,internalFormat:p,width:s,height:n};return new lt(e,b,{type:"compressed",levels:m})}const EA=ee.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),xtt=542327876,Ttt=131072,Stt=4;function YJ(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function Ett(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const Ctt=YJ("DXT1"),Att=YJ("DXT3"),Rtt=YJ("DXT5"),Ott=31,Mtt=0,Ptt=1,Itt=2,$tt=3,Ltt=4,Dtt=7,Ntt=20,Ftt=21;function Utt(e,t,r){var a;const{textureData:i,internalFormat:s,width:n,height:o}=Ul(ktt(r,(a=t.hasMipmap)!=null?a:!1));return t.samplingMode=i.levels.length>1?rt.LINEAR_MIPMAP_LINEAR:rt.LINEAR,t.hasMipmap=i.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new lt(e,t,i)}function ktt(e,t){const r=new Int32Array(e,0,Ott);if(r[Mtt]!==xtt)return EA.error("Invalid magic number in DDS header"),null;if(!(r[Ntt]&Stt))return EA.error("Unsupported format, must contain a FourCC code"),null;const i=r[Ftt];let s,n;switch(i){case Ctt:s=8,n=Ls.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Att:s=16,n=Ls.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Rtt:s=16,n=Ls.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return EA.error("Unsupported FourCC code:",Ett(i)),null}let o=1,a=r[Ltt],l=r[$tt];(3&a)==0&&(3&l)==0||(EA.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;r[Itt]&Ttt&&t!==!1&&(o=Math.max(1,r[Dtt])),o===1||Rp(a)&&Rp(l)||(EA.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=r[Ptt]+4;const y=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}class Ep extends UP{constructor(t,r){super(),this._data=t,this.type=Fs.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new Vs,this._passParameters=new XJ,this.params=r||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:Rt.REPEAT,t:Rt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||rv.STRETCH,this.estimatedTexMemRequired=Ep._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const t=this._data;E(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(fE(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const r=!t.paused;if(t.src=t.src,r&&t.autoplay){const i=()=>{t.removeEventListener("canplay",i),t.play()};t.addEventListener("canplay",i)}}}_startPreloadImageElement(t){Im(t.src)||fE(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,r){if(E(t))return 0;if(HC(t)||Ob(t))return r.encoding===Hg.KTX2_ENCODING?vtt(t,!!r.mipmap):r.encoding===Hg.BASIS_ENCODING?_tt(t,!!r.mipmap):t.byteLength;const{width:i,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?Ep._getDataDimensions(t):r;return(r.mipmap?4/3:1)*i*s*(r.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var r;return{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?rt.LINEAR_MIPMAP_LINEAR:rt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(r=this.params.maxAnisotropy)!=null?r:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,r){if(v(this._glTexture))return this._glTexture;if(v(this._loadingPromise))return this._loadingPromise;const i=this._data;return E(i)?(this._glTexture=new lt(t,this._createDescriptor(t),null),this._glTexture):typeof i=="string"?this._loadFromURL(t,r,i):i instanceof Image?this._loadFromImageElement(t,r,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(t,r,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(t,i,r):(HC(i)||Ob(i))&&this.params.encoding===Hg.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(t,i)):(HC(i)||Ob(i))&&this.params.encoding===Hg.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(t,i)):(HC(i)||Ob(i))&&this.params.encoding===Hg.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(t,i)):Ob(i)?this._loadFromPixelData(t,i):HC(i)?this._loadFromPixelData(t,new Uint8Array(i)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(t,r,i){if(!(this._data instanceof HTMLVideoElement)||E(this._glTexture)||this._data.readyState<aO.HAVE_CURRENT_DATA||i===this._data.currentTime)return i;if(v(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this._data),this._drawStretchedTexture(t,r,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this._data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(t,r){return this._glTexture=Utt(t,this._createDescriptor(t),r),this._glTexture}_loadFromKTX2(t,r){return this._loadAsync(()=>wtt(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(t,r){return this._loadAsync(()=>btt(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(t,r){mt(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(t);return i.pixelFormat=this.params.components===1?ze.LUMINANCE:this.params.components===3?ze.RGB:ze.RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new lt(t,i,r),this._glTexture}_loadFromURL(t,r,i){return this._loadAsync(async s=>{const n=await Ty(i,{signal:s});return cr(s),this._loadFromImage(t,n,r)})}_loadFromImageElement(t,r,i){return i.complete?this._loadFromImage(t,i,r):this._loadAsync(async s=>{const n=await tme(i,i.src,!1,s);return cr(s),this._loadFromImage(t,n,r)})}_loadFromVideoElement(t,r,i){return i.readyState>=aO.HAVE_CURRENT_DATA?this._loadFromImage(t,i,r):this._loadFromVideoElementAsync(t,r,i)}_loadFromVideoElementAsync(t,r,i){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{i.removeEventListener("loadeddata",l),i.removeEventListener("error",c),zi(h)},l=()=>{i.readyState>=aO.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,i,r)))},c=p=>{a(),o(p||new j("Failed to load video"))};i.addEventListener("loadeddata",l),i.addEventListener("error",c);const h=Ca(s,()=>c(Wr()))}))}_loadFromImage(t,r,i){const s=Ep._getDataDimensions(r);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?ze.RGB:ze.RGBA,!this._requiresPowerOfTwo(t,n)||Rp(s.width)&&Rp(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new lt(t,n,r),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,r,s,n,i),this._glTexture)}_loadAsync(t){const r=new AbortController;this._loadingController=r;const i=t(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}_requiresPowerOfTwo(t,r){const i=Rt.CLAMP_TO_EDGE,s=typeof r.wrapMode=="number"?r.wrapMode===i:r.wrapMode.s===i&&r.wrapMode.t===i;return t.type===vt.WEBGL1&&(r.hasMipmap||!s)}_makePowerOfTwoTexture(t,r,i,s,n){const{width:o,height:a}=i,l=JS(o),c=JS(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case rv.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new lt(t,s),h.updateData(0,0,0,o,a,r);break;case rv.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,r,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,r,i,s){const n=new lt(t,i),o=new Li(t,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},n),a=new lt(t,{target:bt.TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},r),l=La(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,r,i,s,n,o){this._passParameters.texture=n,t.bindFramebuffer(i);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height),t.bindTechnique(r,this._passParameters,null),t.bindVAO(s),t.drawArrays(It.TRIANGLE_STRIP,0,ra(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height),this._passParameters.texture=null}unload(){if(v(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:r,sourceTexture:i}=this._powerOfTwoStretchInfo;r.dispose(!0),i.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(v(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),v(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var aO;(function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(aO||(aO={}));const RM=128,ZJ=.5;function rTe(e,t=RM,r=t*ZJ,i=0){const s=Vtt(e,t,r,i);return new Ep(s,{mipmap:!1,wrap:{s:Rt.CLAMP_TO_EDGE,t:Rt.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function Vtt(e,t=RM,r=t*ZJ,i=0){switch(e){case"circle":default:return Btt(t,r);case"square":return ztt(t,r);case"cross":return jtt(t,r,i);case"x":return Htt(t,r,i);case"kite":return Gtt(t,r);case"triangle":return qtt(t,r);case"arrow":return Wtt(t,r)}}function Btt(e,t){const r=e/2-.5;return GP(e,nTe(r,r,t/2))}function ztt(e,t){return iTe(e,t,!1)}function Gtt(e,t){return iTe(e,t,!0)}function jtt(e,t,r=0){return sTe(e,t,!1,r)}function Htt(e,t,r=0){return sTe(e,t,!0,r)}function qtt(e,t){return GP(e,oTe(e/2,t,t/2))}function Wtt(e,t){const r=t,i=t/2,s=e/2,n=.8*r,o=nTe(s,(e-t)/2-n,Math.sqrt(n*n+i*i)),a=oTe(s,r,i);return GP(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function iTe(e,t,r){return r&&(t/=Math.SQRT2),GP(e,(i,s)=>{let n=i-.5*e+.25,o=.5*e-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function sTe(e,t,r,i=0){t-=i,r&&(t*=Math.SQRT2);const s=.5*t;return GP(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(r){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function nTe(e,t,r){return(i,s)=>{const n=i-e,o=s-t;return Math.sqrt(n*n+o*o)-r}}function oTe(e,t,r){const i=Math.sqrt(t*t+r*r);return(s,n)=>{const o=Math.abs(s-e)-r,a=n-e+t/2+.75,l=(t*o+r*a)/i,c=-a;return Math.max(l,c)}}function GP(e,t){const r=new Uint8Array(4*e*e);for(let i=0;i<e;i++)for(let s=0;s<e;s++){const n=s+e*i;let o=t(s,i);o=o/e+.5,AM(o,r,4*n)}return r}class B2t extends gi{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function Xtt(e,t){aTe(e,t,[new qt("slicePlaneOrigin",(r,i)=>hTe(t,r,i)),new qt("slicePlaneBasis1",(r,i)=>{var s;return U4(t,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new qt("slicePlaneBasis2",(r,i)=>{var s;return U4(t,r,i,(s=i.slicePlane)==null?void 0:s.basis2)})])}function Ks(e,t){aTe(e,t,[new Nu("slicePlaneOrigin",(r,i)=>hTe(t,r,i)),new Nu("slicePlaneBasis1",(r,i)=>{var s;return U4(t,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new Nu("slicePlaneBasis2",(r,i)=>{var s;return U4(t,r,i,(s=i.slicePlane)==null?void 0:s.basis2)})])}function aTe(e,t,r){if(!t.hasSlicePlane){const o=w`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(r),e.fragment.uniforms.add(r);const i=w`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=w`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?w`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:w`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(n)}function lTe(e,t,r){return e.instancedDoublePrecision?ce(Ytt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function cTe(e,t){return v(e)?ge(k4,t.origin,e):t.origin}function uTe(e,t,r){return e.hasSliceTranslatedView?v(t)?Yl(Ztt,r.camera.viewMatrix,t):r.camera.viewMatrix:null}function hTe(e,t,r){if(E(r.slicePlane))return Sa;const i=lTe(e,t,r),s=cTe(i,r.slicePlane),n=uTe(e,i,r);return v(n)?Ze(k4,s,n):s}function U4(e,t,r,i){if(E(i)||E(r.slicePlane))return Sa;const s=lTe(e,t,r),n=cTe(s,r.slicePlane),o=uTe(e,s,r);return v(o)?(me(CA,i,n),Ze(k4,n,o),Ze(CA,CA,o),ge(CA,CA,k4)):i}const Ytt=M(),k4=M(),CA=M(),Ztt=Ie();function gU(e,t){const r=t.output===k.ObjectAndLayerIdColor,i=t.objectAndLayerIdColorInstanced;r&&(e.varyings.add("objectAndLayerIdColorVarying","vec4"),i?e.attributes.add(A.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):e.attributes.add(A.OBJECTANDLAYERIDCOLOR,"vec4")),e.vertex.code.add(w`
     void forwardObjectAndLayerIdColor() {
      ${r?i?w`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:w`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:w``} }`),e.fragment.code.add(w`
      void outputObjectAndLayerIdColor() {
        ${r?w`gl_FragColor = objectAndLayerIdColorVarying;`:w``} }`)}function Jtt(e,t){const{vertex:r,fragment:i}=e;t.hasMultipassGeometry&&r.include(Bbe),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(w`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?w`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&i.include(Gu),t.hasMultipassTerrain&&i.uniforms.add([...Tp("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture,t.hasWebGL2Context?ei.None:ei.InvSize),new kr("nearFar",(s,n)=>n.camera.nearFar)]),i.include(jc),i.code.add(w`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?w`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${rl(t,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const Qtt=Ht(1,1,0,1),dTe=Ht(1,0,1,1);function Uy(e,t){e.fragment.uniforms.add(Tp("depthTex",(r,i)=>i.highlightDepthTexture,t.hasWebGL2Context?ei.None:ei.InvSize)),e.fragment.constants.add("occludedHighlightFlag","vec4",Qtt).add("unoccludedHighlightFlag","vec4",dTe),e.fragment.code.add(w`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${rl(t,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}class yU extends Es{constructor(t,r,i){super(t,"vec4",fi.Pass,(s,n,o)=>s.setUniform4fv(t,r(n,o)),i)}}class wa extends Es{constructor(t,r,i){super(t,"float",fi.Pass,(s,n,o)=>s.setUniform1fv(t,r(n,o)),i)}}class JJ extends VC{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Le(1,1,1),this.vvSizeMaxSize=Le(100,100,100),this.vvSizeOffset=Le(0,0,0),this.vvSizeFactor=Le(1,1,1),this.vvSizeValue=Le(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=ns()}}const Cp=8;function zS(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(A.INSTANCEFEATUREATTRIBUTE,"vec4");const r=e.vertex;t.vvSize?(r.uniforms.add(new qt("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new qt("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new qt("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new qt("vvSizeFactor",i=>i.vvSizeFactor)),r.uniforms.add(new Fm("vvSymbolRotationMatrix",i=>i.vvSymbolRotationMatrix)),r.uniforms.add(new qt("vvSymbolAnchor",i=>i.vvSymbolAnchor)),r.code.add(w`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(w`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?w`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(w`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(r.constants.add("vvColorNumber","int",Cp),t.hasVvInstancing&&r.uniforms.add([new wa("vvColorValues",i=>i.vvColorValues,Cp),new yU("vvColorColors",i=>i.vvColorColors,Cp)]),r.code.add(w`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?w`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):r.code.add(w`vec4 vvColor() { return vec4(1.0); }`)}const V4=.1,sa=.001;function Ktt(e){const t=new Lr,r=e.signedDistanceFieldEnabled;if(t.include(lJ),t.include(Uxe,e),t.include(Ks,e),e.occlusionPass)return t.include(Jtt,e),t;const{vertex:i,fragment:s}=t;t.include(BJ),s.include(jc),s.include(Nm),t.include(zS,e),t.include(gU,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),i.uniforms.add([new fr("viewport",(c,h)=>h.camera.fullViewport),new kr("screenOffset",(c,h)=>or(pTe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new kr("anchorPosition",c=>B4(c)),new fr("materialColor",c=>c.color),new Pe("pixelRatio",(c,h)=>h.camera.pixelRatio)]),r&&(i.uniforms.add(new fr("outlineColor",c=>c.outlineColor)),s.uniforms.add([new fr("outlineColor",c=>Moe(c)?c.outlineColor:am),new Pe("outlineSize",c=>Moe(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(ttt(i),fU(i)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(A.UV0,"vec2"),t.attributes.add(A.COLOR,"vec4"),t.attributes.add(A.SIZE,"vec2"),t.attributes.add(A.AUXPOS2,"vec4"),i.code.add(w`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?w`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:w`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=w`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?r?w`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:w`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:w`posProj += quadOffset;`;e.vvColor&&i.uniforms.add([new yU("vvColorColors",c=>c.vvColorColors,Cp),new wa("vvColorValues",c=>c.vvColorValues,Cp)]),i.uniforms.add(new kr("textureCoordinateScaleFactor",c=>v(c.texture)&&v(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:Ege)),i.code.add(w`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${e.output===k.ObjectAndLayerIdColor?w`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${w.float(sa)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${w.float(sa)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?w`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Mt("tex",c=>c.texture));const a=e.debugDrawLabelBorder?w`(isBorder > 0.0 ? 0.0 : ${w.float(V4)})`:w.float(V4),l=w`
    ${e.debugDrawLabelBorder?w`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?w`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${w.float(RM)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${w.float(sa)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:w`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?w`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===k.Alpha&&s.code.add(w`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===k.ObjectAndLayerIdColor&&s.code.add(w`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),e.output===k.Color&&s.code.add(w`
    void main() {
      ${l}
      ${e.transparencyPassType===xt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===k.Highlight&&(t.include(Uy,e),s.code.add(w`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?w`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function Moe(e){return e.outlineColor[3]>0&&e.outlineSize>0}function B4(e,t=pTe){return e.textureIsSignedDistanceField?ert(e.anchorPosition,e.distanceFieldBoundingBox,t):qn(t,e.anchorPosition),t}function ert(e,t,r){v(t)?or(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):or(r,0,0)}const pTe=Ke(),trt=Object.freeze(Object.defineProperty({__proto__:null,build:Ktt,calculateAnchorPosForRendering:B4},Symbol.toStringTag,{value:"Module"})),Fu=Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),rrt=Vp(Ee.ONE,Ee.ONE),fTe=Vp(Ee.ZERO,Ee.ONE_MINUS_SRC_ALPHA);function ky(e){return e===xt.FrontFace?null:e===xt.Alpha?fTe:rrt}function _U(e){return e===xt.FrontFace?Jl:null}const vU=5e5,bU={factor:-1,units:-2};function wU(e){return e?bU:null}function zv(e,t=Ni.LESS){return e===xt.NONE||e===xt.FrontFace?t:Ni.LEQUAL}class xU extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2,r.spherical=t.viewingMode===Ge.Global}initializeProgram(t){return new Nr(t.rctx,xU.shader.get().build(this.configuration),Or)}_setPipelineState(t){const r=this.configuration,i=t===xt.NONE,s=t===xt.FrontFace,n=this.configuration.hasPolygonOffset?irt:null,o=(i||s)&&r.output!==k.Highlight&&(r.depthEnabled||r.occlusionPass)?Jl:null;return Vt({blending:r.output===k.Color||r.output===k.Alpha||r.output===k.Highlight?i?srt:ky(t):null,depthTest:{func:Ni.LEQUAL},depthWrite:o,colorWrite:Qt,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?It.POINTS:It.TRIANGLES}}xU.shader=new Dr(trt,()=>ie(()=>import("./HUDMaterial.glsl.4da18b8f.js"),[]));const irt={factor:0,units:-4},srt=Vp(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA);class js extends ao{constructor(){super(...arguments),this.output=k.Color,this.screenCenterOffsetUnitsEnabled=zl.World,this.transparencyPassType=xt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}u([B({count:k.COUNT})],js.prototype,"output",void 0),u([B({count:zl.COUNT})],js.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B({count:xt.COUNT})],js.prototype,"transparencyPassType",void 0),u([B()],js.prototype,"spherical",void 0),u([B()],js.prototype,"occlusionTestEnabled",void 0),u([B()],js.prototype,"signedDistanceFieldEnabled",void 0),u([B()],js.prototype,"vvSize",void 0),u([B()],js.prototype,"vvColor",void 0),u([B()],js.prototype,"hasVerticalOffset",void 0),u([B()],js.prototype,"hasScreenSizePerspective",void 0),u([B()],js.prototype,"debugDrawLabelBorder",void 0),u([B()],js.prototype,"binaryHighlightOcclusionEnabled",void 0),u([B()],js.prototype,"hasSlicePlane",void 0),u([B()],js.prototype,"hasPolygonOffset",void 0),u([B()],js.prototype,"depthEnabled",void 0),u([B()],js.prototype,"pixelSnappingEnabled",void 0),u([B()],js.prototype,"isDraped",void 0),u([B()],js.prototype,"hasMultipassGeometry",void 0),u([B()],js.prototype,"hasMultipassTerrain",void 0),u([B()],js.prototype,"cullAboveGround",void 0),u([B()],js.prototype,"occlusionPass",void 0),u([B()],js.prototype,"objectAndLayerIdColorInstanced",void 0),u([B({constValue:!0})],js.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],js.prototype,"hasVvInstancing",void 0);class tC extends Bv{constructor(t){super(t,new frt),this._configuration=new js}getConfiguration(t,r){return this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?zl.Screen:zl.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=r.slot===Se.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(t===k.Color||t===k.Alpha),t===k.Color&&(this._configuration.debugDrawLabelBorder=!!Xr.LABELS_SHOW_BORDER),t===k.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(t,r,i,s,n,o){if(!i.options.selectionMode||!i.options.hud||!t.visible)return;const a=this.parameters;let l=1,c=1;if(id(oV,r),v(t.shaderTransformer)){const T=t.shaderTransformer($oe);l=T[0],c=T[5],art(oV)}const h=t.vertexAttributes.get(A.POSITION),p=t.vertexAttributes.get(A.SIZE),f=t.vertexAttributes.get(A.NORMAL),m=t.vertexAttributes.get(A.AUXPOS1);mt(h.size>=3);const y=i.point,_=i.camera,b=B4(a);l*=_.pixelRatio,c*=_.pixelRatio;const x=this.parameters.centerOffsetUnits==="screen";for(let T=0;T<h.data.length/h.size;T++){const S=T*h.size;ce(da,h.data[S],h.data[S+1],h.data[S+2]),Ze(da,da,r);const C=T*p.size;u0[0]=p.data[C]*l,u0[1]=p.data[C+1]*c,Ze(da,da,_.viewMatrix);const O=T*m.size;if(ce(Zc,m.data[O+0],m.data[O+1],m.data[O+2]),!x&&(da[0]+=Zc[0],da[1]+=Zc[1],Zc[2]!==0)){const $=Zc[2];ve(Zc,da),ge(da,da,ae(Zc,Zc,$))}const R=T*f.size;if(ce(AA,f.data[R],f.data[R+1],f.data[R+2]),this._normalAndViewAngle(AA,oV,_,aV),this._applyVerticalOffsetTransformationView(da,aV,_,nV),_.applyProjection(da,Va),Va[0]>-1){Va[0]=Math.floor(Va[0]),Va[1]=Math.floor(Va[1]),x&&(Zc[0]||Zc[1])&&(Va[0]+=Zc[0],Zc[1]!==0&&(Va[1]+=VJ(Zc[1],nV.factorAlignment)),_.unapplyProjection(Va,da)),Va[0]+=this.parameters.screenOffset[0],Va[1]+=this.parameters.screenOffset[1],Pxe(u0,nV.factor,u0);const $=hrt*_.pixelRatio;let I=0;if(a.textureIsSignedDistanceField&&(I=a.outlineSize*_.pixelRatio/2),y&&Poe(y,Va[0],Va[1],u0,$,I,a,b)){const U=i.ray;if(Ze(Ioe,da,ko(urt,_.viewMatrix)),Va[0]=y[0],Va[1]=y[1],_.unprojectFromRenderScreen(Va,da)){const V=M();le(V,U.direction);const G=1/Me(V);ae(V,V,G),o(Ai(U.origin,da)*G,V,-1,!0,1,Ioe)}}}}}intersectDraped(t,r,i,s,n,o){const a=t.vertexAttributes.get(A.POSITION),l=t.vertexAttributes.get(A.SIZE),c=this.parameters,h=B4(c);let p=1,f=1;if(v(t.shaderTransformer)){const y=t.shaderTransformer($oe);p=y[0],f=y[5]}p*=t.screenToWorldRatio,f*=t.screenToWorldRatio;const m=drt*t.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,b=a.data[_],x=a.data[_+1],T=y*l.size;u0[0]=l.data[T]*p,u0[1]=l.data[T+1]*f;let S=0;c.textureIsSignedDistanceField&&(S=c.outlineSize*t.screenToWorldRatio/2),Poe(s,b,x,u0,m,S,c,h)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new grt(this)}_normalAndViewAngle(t,r,i,s){return ett(r)&&(r=id(crt,r)),Mc(s.normal,t,r),Ze(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=_e(mTe,prt),s}_updateScaleInfo(t,r,i){const s=this.parameters;v(s.screenSizePerspective)?Toe(i,r,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),v(s.screenSizePerspectiveAlignment)?Toe(i,r,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,aV);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,r,i,s,n){return this._applyCenterOffsetNDC(t,r,i,s),v(n)&&le(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(t,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return le(n,t);const c=ye(Math.abs(r.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return ae(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,r,i,s){const n=Me(t),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=ae(da,r.normal,o*a);return me(s,t,l),s}_applyVerticalOffsetTransformationView(t,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Me(t);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Me(t),a=Pt(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=Gxe(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),ae(r.normal,r.normal,l),me(t,t,r.normal)}_applyCenterOffsetView(t,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==t&&le(i,t),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(ve(AA,i),me(i,i,ae(AA,AA,r[2])))),i}_applyCenterOffsetNDC(t,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&le(s,t),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(t,r,i,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&le(s,t),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(t,r){if(r===k.Color||r===k.Alpha||r===k.Highlight||r===k.ObjectAndLayerIdColor){if(t===Se.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return t===(i?Se.LABEL_MATERIAL:Se.HUD_MATERIAL)||s&&t===Se.OCCLUSION_PIXELS}return!1}createGLMaterial(t){return new nrt(t)}calculateRelativeScreenBounds(t,r,i=ur()){return ort(this.parameters,t,r,i),i[2]=i[0]+t[0],i[3]=i[1]+t[1],i}}class nrt extends jZ{constructor(t){super({...t,...t.material.parameters})}selectProgram(t){return this.ensureTechnique(xU,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}function ort(e,t,r,i=lrt){return qn(i,e.anchorPosition),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r,i}function art(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+r*r+i*i),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=r*h,e[2]=i*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function Poe(e,t,r,i,s,n,o,a){let l=t-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,h=r-s-(a[1]>0?i[1]*a[1]:0),p=h+i[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&v(f)&&(l+=i[0]*f[0],h+=i[1]*f[1],c-=i[0]*(1-f[2]),p-=i[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const nV=new Wxe,lrt=Ke(),da=M(),AA=M(),Va=sr(),mTe=M(),Ioe=M(),oV=ns(),crt=ns(),urt=Ie(),Zc=M(),aV={normal:mTe,cosAngle:0},$oe=Ie(),hrt=1,drt=2,u0=[0,0],prt=Le(0,0,1);class frt extends Lbe{constructor(){super(...arguments),this.renderOccluded=us.Occlude,this.color=Ht(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Ur(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Ht(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const gTe=os().vec3f(A.POSITION).vec3f(A.NORMAL).vec2f(A.UV0).vec4u8(A.COLOR).vec2f(A.SIZE).vec4f(A.AUXPOS1).vec4f(A.AUXPOS2),mrt=gTe.clone().vec4u8(A.OBJECTANDLAYERIDCOLOR);class grt{constructor(t){this._material=t,this.vertexBufferLayout=de("enable-feature:objectAndLayerId-rendering")?mrt:gTe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(A.POSITION).length}write(t,r,i,s,n){mU(i.indices.get(A.POSITION),i.vertexAttributes.get(A.POSITION).data,t,s.position,n,6),HJ(i.indices.get(A.NORMAL),i.vertexAttributes.get(A.NORMAL).data,r,s.normal,n,6);const o=i.vertexAttributes.get(A.UV0).data;let a,l,c,h;if(o==null||o.length<4){const x=this._material.parameters;a=0,l=0,c=x.texCoordScale[0],h=x.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],h=o[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let p=i.indices.get(A.POSITION).length,f=n;const m=s.uv0;for(let x=0;x<p;++x)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,c),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,h),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;qJ(i.indices.get(A.COLOR),i.vertexAttributes.get(A.COLOR).data,4,s.color,n,6);const y=i.indices.get(A.SIZE),_=i.vertexAttributes.get(A.SIZE).data;p=y.length;const b=s.size;f=n;for(let x=0;x<p;++x){const T=_[2*y[x]],S=_[2*y[x]+1];for(let C=0;C<6;++C)b.set(f,0,T),b.set(f,1,S),f+=1}if(i.indices.get(A.AUXPOS1)&&i.vertexAttributes.get(A.AUXPOS1)?eC(i.indices.get(A.AUXPOS1),i.vertexAttributes.get(A.AUXPOS1).data,s.auxpos1,n,6):Ooe(s.auxpos1,n,6*p),i.indices.get(A.AUXPOS2)&&i.vertexAttributes.get(A.AUXPOS2)?eC(i.indices.get(A.AUXPOS2),i.vertexAttributes.get(A.AUXPOS2).data,s.auxpos2,n,6):Ooe(s.auxpos2,n,6*p),v(i.objectAndLayerIdColor)&&i.indices.get(A.POSITION)){const x=i.indices.get(A.POSITION).length,T=s.getField(A.OBJECTANDLAYERIDCOLOR,_o);Yxe(i.objectAndLayerIdColor,T,x,n,6)}}}const Yp=M(),rT=sr(),RA=sr(),lV=M(),yrt=Ie(),_rt=pn(),cV=co(),vrt=M(),brt=ur();class wrt{constructor(){this.aabr=ur(),this.distance=0,this.culled=!1,this.visible=!1}}class xrt{constructor(t,r){this.graphics3DGraphic=t,this.slicePlaneEnabled=r,this.info={}}}var yc;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(yc||(yc={}));class yTe{constructor(){this.camera=new Ct,this.slicePlane=Oy(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),Sx(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let nS=class extends Te{get dirty(){return this._dirty}get state(){return this._state}constructor(e){super(e),this._dirty=!1,this._runningViewState=new yTe,this._state=yc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new Crt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==yc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/yc.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case yc.Idle:this._startUpdate(),e.madeProgress();case yc.Process:if(this._state=yc.Process,!this._processActiveGraphics(e))return;case yc.Sort:if(this._state=yc.Sort,!this._sortVisibleGraphics(e))return;case yc.Deconflict:if(this._state=yc.Deconflict,!this._deconflictVisibleGraphics(e))return;default:Get(this,this._visible),this._state=yc.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(r=>this.addToActiveGraphics(r)):e.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(e){if(E(e)||e.type!=="object3d")return!1;const t=e.stageObject;if((t?t.geometries.length:0)!==1)return!1;const r=t==null?void 0:t.geometries[0];return(r==null?void 0:r.material)instanceof tC}_startUpdate(){jet(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new wrt,this._active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._visible.delete(e.graphics3DGraphic.graphic.uid),Trt(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this._active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),r=vC(yrt,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?_rt:null;let s=0;for(v(i)&&(Ze(i,Sa,this._runningViewState.camera.viewMatrix),i[3]=Zr(this.view.spatialReference).radius,s=Bge(i,Sa));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const r=t.next();if(e.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===Do.LABEL;for(;!e.done;){e.madeProgress();const i=t.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!r||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),qet(n,a)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Loe(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Loe(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=Srt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(e,t,r,i){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(Do.GRAPHIC,Rc.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);ed(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(E(a)){if(a=Ort,this._getProjectionInfo(l,t,a),a.isOutsideScreen||this._isCulledBySlice(e,Yp)||v(r)&&this._isCulledByHorizon(a,r,i))return void(n.culled=!0);!Xr.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}E(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,r){const i=this._runningViewState.camera,s=e.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;Ze(Yp,a,i.viewMatrix);const l=n.vertexAttributes,c=l.get(A.NORMAL).data,h=l.get(A.AUXPOS1).data;o.applyShaderOffsetsView(Yp,c,s.transformation,h,i,r.scaleInfo,Yp),ti(rT,Yp[0],Yp[1],Yp[2],1),Mu(RA,rT,i.projectionMatrix),ae(r.positionNDC,RA,1/RA[3]),o.applyShaderOffsetsNDC(r.positionNDC,h,i,r.positionNDC,lV),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(lV[2]),r.distance=lV[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),ti(RA,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),Mu(rT,RA,t),uC(rT,rT,1/rT[3]),ce(r.positionView,Yp[0],Yp[1],Yp[2])}_isCulledByHorizon(e,t,r){return le(cV.direction,e.positionView),ce(cV.origin,0,0,0),!!Uv(t,cV,vrt)&&e.distanceWithoutPolygonOffset>r}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&uY(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(Art);Pxe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=wF(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,brt),Nt(0,n.fullWidth,.5+.5*i[0]),Nt(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Au(a),Ip(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Q_(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,r=e.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,z5(l.aabr,r.aabr)))return!0}}return!1}_initBins(e,t){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new Jt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=t/this._accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],r=Math.floor(t.aabr[0]/this._accBinsSizeX),i=Math.floor(t.aabr[2]/this._accBinsSizeX),s=Math.floor(t.aabr[1]/this._accBinsSizeY),n=Math.floor(t.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(e)}_setGraphicVisibility(e,t){const r=e.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(Rc.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===Do.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,t))}};function Trt(e,t){const r=e.graphics3DGraphic;r.destroyed||r.clearVisibilityFlag(Rc.DECONFLICTION,t)}function*Loe(e){if(Map.prototype.entries){const t=e.entries();for(let r=t.next();!r.done;r=t.next())yield r.value[1]}else yield*e.values()}function*Srt(e,t,r){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.visible=s.graphics3DGraphic.hasVisibilityFlag(Rc.DECONFLICTION,r),o.prio=s.info?s.info[r].distance:Number.MAX_VALUE}),yield;const i=t.iterableSort((s,n)=>s.visible!==n.visible?s.visible?-1:1:s.prio!==n.prio?s.prio-n.prio:s.id-n.id);for(let s=i.next();!s.done;s=i.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([d({constructOnly:!0})],nS.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],nS.prototype,"updating",null),nS=u([P("esri.views.3d.layers.graphics.Deconflictor")],nS);class Ert{}class Crt{constructor(t=null,r=null,i=null){this.active=t,this.visible=r,this.sort=i,this.sortArray=new Jt({allocator:s=>s||new Ert})}}const Art=Ke();class Rrt{constructor(){this.positionView=M(),this.positionNDC=M(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new Wxe}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const Ort=new Rrt,Mrt=2e3;let TN=class extends nS{constructor(e){super(e),this.visibilityGroup=Do.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return na.YIELD;const t=performance.now();if(e.state!==Sr.IDLE&&t-this._lastDeconfliction<Mrt)return na.YIELD;super.runTask(e),this.state===yc.Idle&&(this._lastDeconfliction=t)}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};u([d({constructOnly:!0})],TN.prototype,"parent",void 0),TN=u([P("esri.views.3d.layers.graphics.LabelDeconflictor")],TN);let eq=class extends nS{constructor(){super(...arguments),this._handles=new Jr,this._contexts=new Map,this._viewState=new yTe,this.visibilityGroup=Do.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([se(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),se(()=>{var e,t,r;return(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:r.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),se(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},kt)]),this._frameTask=this.view.resourceController.scheduler.registerTask(gt.GRAPHICS_DECONFLICTOR,this),this._labels=new TN({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const r=!(this._graphicSupportsDeconfliction(t)&&uV(e));t.setVisibilityFlag(Rc.DECONFLICTION,r,Do.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;v(e)&&rye(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=v(e)}_slicePlaneChanged(){ea(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const t=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,t,r),removeGraphic:r=>this._removeGraphic(t,r),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,r){const i=r.graphic.uid,s=new xrt(r,e.symbolCreationContext.slicePlaneEnabled);t.set(i,s),uV(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const r=t.graphic.uid,i=e.get(r);i&&(this.removeFromActiveGraphics(i),this._labels.removeFromActiveGraphics(i),e.delete(r),this.setDirty())}enabledChanged(e,t){const r=uV(e);r||Prt(e),this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(e,t){const r=e.symbolCreationContext.slicePlaneEnabled;t.forEach(i=>i.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.layers;if(!t||!t.length)return!1;for(const r of t)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const t=this._contexts.get(e);if(t)return t;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function uV(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function Prt(e){const t=e.graphics3DGraphics;t&&t.forEach(r=>r.clearVisibilityFlag(Rc.DECONFLICTION))}eq=u([P("esri.views.3d.layers.graphics.GraphicsDeconflictor")],eq);const QJ=(e,t,r)=>[t,r],rC=(e,t,r)=>[t,r,e[2]],KJ=(e,t,r)=>[t,r,e[2],e[3]];function z2t(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:v(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function Irt({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function $rt({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function _Te({scale:e,translate:t},r){return r*e[0]+t[0]}function vTe({scale:e,translate:t},r){return t[1]-r*e[1]}function bTe(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=e.scale;let o=_Te(e,r[0][0]),a=vTe(e,r[0][1]);i[0]=t(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=t(c,o,a)}return i}function wTe(e,t,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=bTe(e,t,r[s]);return i}function Lrt(e,t,r,i){return bTe(e,r?i?KJ:rC:i?rC:QJ,t)}function Drt(e,t,r,i){return wTe(e,r?i?KJ:rC:i?rC:QJ,t)}function Nrt(e,t,r,i){return wTe(e,r?i?KJ:rC:i?rC:QJ,t)}function G2t(e,t,r,i,s){return t.x=Irt(e,r.x),t.y=$rt(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function xTe(e,t,r,i,s){return v(r)&&(t.points=Lrt(e,r.points,i,s)),t}function TTe(e,t,r,i,s){return E(r)||(t.x=_Te(e,r.x),t.y=vTe(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m))),t}function STe(e,t,r,i,s){return v(r)&&(t.rings=Nrt(e,r.rings,i,s)),t}function ETe(e,t,r,i,s){return v(r)&&(t.paths=Drt(e,r.paths,i,s)),t}class j2t{constructor(t,r,i){this.uid=t,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function H2t(e){return v(e.geometry)}class q2t{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function W2t(e){var n,o;const t=Gpe.fromJSON(e.geometryType),r=Ye.fromJSON(e.spatialReference),i=e.transform,s=e.features.map(a=>{const l=Frt(a,t,r,e.objectIdFieldName),c=l.geometry;if(v(c)&&i)switch(c.type){case"point":l.geometry=TTe(i,c,c,c.hasZ,c.hasM);break;case"multipoint":l.geometry=xTe(i,c,c,!!c.hasZ,!!c.hasM);break;case"polygon":l.geometry=STe(i,c,c,!!c.hasZ,!!c.hasM);break;case"polyline":l.geometry=ETe(i,c,c,!!c.hasZ,!!c.hasM);break;case"extent":case"mesh":l.geometry=c}return l});return{geometryType:t,features:s,spatialReference:r,fields:(o=(n=e.fields)==null?void 0:n.map(a=>R6.fromJSON(a)))!=null?o:[],objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function Frt(e,t,r,i){return{uid:Lc(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:Urt(e.geometry,t,r),visible:!0}}function Urt(e,t,r){if(E(e))return null;switch(t){case"point":{const i=e;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=e;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=e;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=e;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function Vy(e,t,r,i){return{x:e,y:t,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function krt(e){if(E(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)r+=n.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32*(s.length+1);break}case"multipoint":{const r=2+(e.hasZ?1:0)+(e.hasM?1:0),i=e.points.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=lI(e.vertexAttributes.position),t+=lI(e.vertexAttributes.normal),t+=lI(e.vertexAttributes.uv),t+=lI(e.vertexAttributes.tangent)}return t}function X2t(e){let t=32;return t+=dge(e.attributes),t+=3,t+=8+krt(e.geometry),t}function Vrt(e){if(E(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function Y2t(e){if(E(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function Z2t(e,t){switch($i(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)Y8(t,e.paths[r],!!e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)Y8(t,e.rings[r],!!e.hasZ);break;case"multipoint":Y8(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function Brt(e,t){switch(ed(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)X8(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)X8(t,e.rings[r]);break;case"multipoint":X8(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function J2t(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}function CTe(e){return"declaredClass"in e}function Doe(e){return"declaredClass"in e}function zrt(e){return"declaredClass"in e}function Grt(e,t){return e?zrt(e)?e:new Aa({layer:t,sourceLayer:t,visible:e.visible,symbol:re(e.symbol),attributes:re(e.attributes),geometry:ATe(e.geometry)}):null}function ATe(e){return E(e)?null:CTe(e)?e:gm(jrt(e))}function jrt(e){const{wkid:t,wkt:r,latestWkid:i}=e.spatialReference,s={wkid:t,wkt:r,latestWkid:i};switch(e.type){case"point":{const{x:n,y:o,z:a,m:l}=e;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=e;return{rings:Noe(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=e;return{paths:Noe(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y}=e;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:h,mmin:p,mmax:f,hasZ:m,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=e;return{points:OTe(n)?RTe(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function Noe(e){return Hrt(e)?e.map(t=>RTe(t)):e}function RTe(e){return e.map(t=>Array.from(t))}function Hrt(e){for(const t of e)if(t.length!==0)return OTe(t);return!1}function OTe(e){return e.length>0&&(SW(e[0])||EW(e[0]))}function qrt(e,t){if(!e)return null;let r;if(Doe(e)){if(t==null)return e.clone();if(Doe(t))return t.copy(e)}return t!=null?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=void 0,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=Vy(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}function Q2t(e){const{wkid:t,wkt:r,latestWkid:i}=e,s={wkid:t,wkt:r,latestWkid:i};return Ye.fromJSON(s)}const hV=ee.getLogger("esri.layers.support.labelFormatUtils"),dV={type:"simple",evaluate:()=>null},Wrt={getAttribute:(e,t)=>e.field(t)};async function MTe(e,t,r){if(!e||!e.symbol||!t)return dV;const i=e.where,s=U6(e),n=i?await ie(()=>import("./WhereClause.7eef08f1.js").then(function(a){return a.W}),["assets/WhereClause.7eef08f1.js","assets/executionError.c4c51b90.js"]):null;let o;if(s.type==="arcade"){const a=await oMe(s.expression,r,t);if(E(a))return dV;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{hV.error(new j("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>vZ(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":PTe(p,h)})};if(i){let a;try{a=n.WhereClause.create(i,t)}catch(c){return hV.error(new j("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),dV}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:Wrt;try{if(a.testFeature(c,h))return l(c)}catch(p){hV.error(new j("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:p}))}return null}}return o}function PTe(e,t){if(e==null)return"";const r=t.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=e;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+e,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=e;return t.type==="date"||t.type==="esriFieldTypeDate"?i=_m(i,N5("short-date")):D5(t)&&(i=vm(+i)),i||""}var K2t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createLabelFunction:MTe,formatField:PTe});class ITe{constructor(t=null,r="center",i="center",s=null,n=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",h=0,p=0){this.verticalOffset=t,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=s,this.translation=n,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=p}}function eQ(e,t){if(e.type==="point")return h0(e,t,!1);if(CTe(e))switch(e.type){case"extent":return h0(e.center,t,!1);case"polygon":return h0(e.centroid,t,!1);case"polyline":return h0(Foe(e),t,!0);case"mesh":return h0(e.origin,t,!1)}else switch(e.type){case"extent":return h0(Xrt(e),t,!0);case"polygon":return h0(Yrt(e),t,!0);case"polyline":return h0(Foe(e),t,!0)}}function Foe(e){const t=e.paths[0];if(!t||t.length===0)return null;const r=Ape(t,Cpe(t)/2);return Vy(r[0],r[1],r[2],e.spatialReference)}function Xrt(e){return Vy(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),e.zmin!=null&&e.zmax!=null&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function Yrt(e){const t=e.rings[0];if(!t||t.length===0)return null;const r=KW(e.rings,!!e.hasZ);return Vy(r[0],r[1],r[2],e.spatialReference)}function h0(e,t,r){const i=r?e:qrt(e);return t&&e?bLe(e,i,t)?i:null:i}function eSt(e,t,r,i=0){if(e){t||(t=ur());const s=e;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),ti(t,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),t}return null}function $Te(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(A.AUXPOS1);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(e.geometries[r]))}}function lO(e,t){const r=yP(kh);return v(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),v(t)?r[3]=t:v(e)&&e.length>3&&(r[3]=e[3]),r}function tSt(e,t,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)v(e)&&e[o]!=null?n[o]=e[o]:v(r)&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return v(t)?n[3]=t:v(i)?n[3]=i:n[3]=s[3],n}function Uoe(e=Qf,t,r,i=1){const s=new Array(3);if(E(t)||E(r))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=r[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return kl(s)}function Zrt(e){return e.isPrimitive!=null}function TU(e){return z4(Zrt(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function z4(e){if(Array.isArray(e)){for(const t of e)if(!z4(t))return!1;return!0}return e==null||e>=0}function Jrt(e,t,r,i=Ie()){const s=e||0,n=t||0,o=r||0;return s!==0&&yE(i,i,-s/180*Math.PI),n!==0&&gE(i,i,n/180*Math.PI),o!==0&&e6(i,i,o/180*Math.PI),i}function tQ(e,t,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=ll(t),s=_x(e)*i,n=vx(e)*i,o=Lv(e)*(t.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function LTe(e,t,r,i,s,n,o,a,l,c,h){const p=nit[h.mode];let f,m,y=0;if(Ts(e,t,r,i,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,h),f=n,m=o):(f=i,m=s),Ts(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function BC(e,t,r,i,s){const n=(I4(e)?e.z:nxe(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const o=Pt(tm(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Pt(tm(t,e,"ground"),0),a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Pt(tm(t,e,"scene"),0),a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=Pt(tm(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function Qrt(e,t,r,i){return BC(e,t,r,i,oS),oS.z}function jP(e,t,r){return t==null||r==null?e.definedChanged:t==="on-the-ground"&&r==="on-the-ground"?e.staysOnTheGround:t===r||t!=="on-the-ground"&&r!=="on-the-ground"?xs.UPDATE:e.onTheGroundChanged}function ad(e){return e==="relative-to-ground"||e==="relative-to-scene"}function Av(e){return e!=="absolute-height"}function Krt(e,t,r,i,s){BC(t,r,s,i,oS),$Te(e,oS.verticalDistanceToGround);const n=oS.sampledElevation,o=Hn(oit,e.transformation);return G$[0]=t.x,G$[1]=t.y,G$[2]=oS.z,$p(t.spatialReference,G$,o,i.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function eit(e,t,r,i,s,n){let o=0;const a=n.spatialReference;t*=3,i*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],f=Pt(n.getElevation(c,h,p,a,"ground"),0);o+=f,r[i+0]=c,r[i+1]=h,r[i+2]=f,t+=3,i+=3}return o/s}function tit(e,t,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,i*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],_=e[t+2],b=Pt(n.getElevation(m,y,_,p,"ground"),0);l+=b,r[i+0]=m,r[i+1]=y,r[i+2]=h==null?_+b+c:b+c,t+=3,i+=3}return l/s}function rit(e,t,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,i*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],_=e[t+2],b=Pt(n.getElevation(m,y,_,p,"scene"),0);l+=b,r[i+0]=m,r[i+1]=y,r[i+2]=h==null?_+b+c:b+c,t+=3,i+=3}return l/s}function iit(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return t!==0||r!=null}function sit(e,t,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let h=0;h<s;++h){const p=e[t+0],f=e[t+1],m=e[t+2];r[i+0]=p,r[i+1]=f,r[i+2]=c==null?m+l:l,t+=3,i+=3}return 0}class HP{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var xs;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(xs||(xs={}));const nit={"absolute-height":{applyElevationAlignmentBuffer:sit,requiresAlignment:iit},"on-the-ground":{applyElevationAlignmentBuffer:eit,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:tit,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:rit,requiresAlignment:()=>!0}},oit=Ie(),oS=new HP,G$=M();function rQ(e){return v(e.mapPositions)}function DTe(e,t,r,i,s){const n=e.stageObject,o=n.geometries;let a=0;for(const l of o){if(!rQ(l))continue;const{update:c,averageGeometrySampledElevation:h}=FTe(l,t,r,i,s);a+=h,c&&n.geometryVertexAttrsUpdated(l)}return a/o.length}function OM(e,t,r,i,s){var p;const n=e.stageObject,o=t.centerPointInElevationSR;let a=0;(p=n.metadata)!=null&&p.usesVerticalDistanceToGround?(i(o,Bl),$Te(n,Bl.verticalDistanceToGround),a=Bl.sampledElevation):(i(o,Bl),t.mode!=="absolute-height"&&(a=Bl.sampledElevation));const l=Hn(ait,n.transformation),c=ce(NTe,l[12],l[13],l[14]);Xr.TESTS_DISABLE_OPTIMIZATIONS?(Vl[0]=o.x,Vl[1]=o.y,Vl[2]=Bl.z,$p(o.spatialReference,Vl,l,s.spatialReference)&&(n.transformation=l)):s.setAltitudeOfTransformation(Bl.z,l);const h=iQ/s.unitInMeters;return(Math.abs(l[12]-c[0])>=h||Math.abs(l[13]-c[1])>=h||Math.abs(l[14]-c[2])>=h)&&(n.transformation=l),a}const ait=Ie();function lit(e,t,r,i,s){const n=e.graphics3DSymbolLayer.lodRenderer;if(E(n))return 0;const o=t.centerPointInElevationSR;i(o,Bl);const a=t.mode!=="absolute-height"?Bl.sampledElevation:0,l=n.instanceData,c=e.instanceIndex,h=uit;l.getGlobalTransform(c,h);const p=ce(NTe,h[12],h[13],h[14]);Xr.TESTS_DISABLE_OPTIMIZATIONS?(Vl[0]=o.x,Vl[1]=o.y,Vl[2]=Bl.z,$p(o.spatialReference,Vl,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(Bl.z,h);const f=iQ/s.unitInMeters;return(Xr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-p[0])>=f||Math.abs(h[13]-p[1])>=f||Math.abs(h[14]-p[2])>=f)&&l.setGlobalTransform(c,h),a}function cit(e,t,r,i,s){const n=e.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,h=!1;for(const p of o){if(!rQ(p))continue;const f=p.vertexAttributes.get(A.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:y}=FTe(p,t,r,i,s);c=y,l=f,h=m}h&&n.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const iQ=.01,Vl=M(),Ju=M(),iT=M(),uit=Ie(),NTe=M(),Bl=new HP;function FTe(e,t,r,i,s){let n=!1;const o=e.shaderTransformation,a=t.requiresSampledElevationInfo;Ju[0]=o[12],Ju[1]=o[13],Ju[2]=o[14],e.invalidateBoundingInfo();const l=e.getMutableAttribute(A.POSITION),c=l.data,h=l.size,p=c.length/h,f=new sxe(e.mapPositions,r);let m=0,y=0;for(let _=0;_<p;_++){if(iT[0]=c[m],iT[1]=c[m+1],iT[2]=c[m+2],i(f,Bl),a&&(y+=Bl.sampledElevation),Xr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Bl.z,Ts(c,r,m,c,s.spatialReference,m,1),c[m]-=Ju[0],c[m+1]-=Ju[1],c[m+2]-=Ju[2],n=!0;else{Vl[0]=c[m]+Ju[0],Vl[1]=c[m+1]+Ju[1],Vl[2]=c[m+2]+Ju[2],s.setAltitude(Vl,Bl.z),c[m]=Vl[0]-Ju[0],c[m+1]=Vl[1]-Ju[1],c[m+2]=Vl[2]-Ju[2];const b=iQ/s.unitInMeters;(Math.abs(iT[0]-c[m])>=b||Math.abs(iT[1]-c[m+1])>=b||Math.abs(iT[2]-c[m+2])>=b)&&(n=!0)}m+=h,f.offset+=3}return y/=p,{update:n,averageGeometrySampledElevation:y}}const hit=ee.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function dit(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function rSt(e){const t=e&&e.expression;if(typeof t=="string"){const r=VTe(t);if(r!=null)return{cachedResult:r}}return null}async function iSt(e,t,r,i){const s=e&&e.expression;if(typeof s!="string")return null;const n=VTe(s);if(n!=null)return{cachedResult:n};const o=await ym();cr(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:t}),modules:o}}}function UTe(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function sQ(e,t){if(e!=null&&!kTe(e)){if(!t||!e.arcade)return void hit.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=ATe(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function pit(e){if(e!=null){if(kTe(e))return e.cachedResult;const t=e.arcade;let r=t==null?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof r!="number"&&(e.cachedResult=0,r=0),r}return 0}function sSt(e,t=!1){let r=e&&e.featureExpressionInfo;const i=r&&r.expression;return t||i==="0"||(r=null),r!=null?r:null}const fit={cachedResult:0};function kTe(e){return e.cachedResult!=null}function VTe(e){return e==="0"?0:null}class qu{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=k9e(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:t+i}calculateOffsetRenderUnits(t){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=pit(i)*this._metersPerElevationInfoUnit),r/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=U9e(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=Pt(t.offset,0)}updateFeatureExpressionInfoContext(t,r,i){if(E(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&v(r)&&v(i)?(this._featureExpressionInfoContext=dit(t),sQ(this._featureExpressionInfoContext,UTe(s.modules,r,i))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const r=new qu;return v(t)&&r.setFromElevationInfo(t),r}}class mit{constructor(t,r,i){this.graphic=t,this.renderingInfo=r,this.layer=i}}var ir;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(ir||(ir={}));class git{constructor(t,r,i){this.baseMaterial=t,this.edgeMaterials=r,this.properties=i}}class Um{get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}constructor(t,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(t,r){this._stageLayer=r,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=this._stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),v(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,r){if(E(this._edgeState))return;const i=koe(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this._resetEdgeObject(r),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,r){E(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!r),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this.stageObject.visible=t,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),v(this._edgeState))){const r=this._stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(t,r,i,s){if(this.elevationAligner==null)return;v(i)&&sQ(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>BC(o,t,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t.spatialReference,n,r),this._resetEdgeObject(s)}alignWithAbsoluteElevation(t,r,i){const s=(n,o)=>{o.sampledElevation=t,o.verticalDistanceToGround=0,o.z=t};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,r),this._resetEdgeObject(i)}getCenterObjectSpace(t=M()){return le(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=In()){const r=this.stageObject.boundingVolumeObjectSpace;return Pfe(t,r.min),Ife(t,r.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.transformation;t.render.origin[0]+=r[12],t.render.origin[1]+=r[13],t.render.origin[2]+=r[14],t.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Qm)&&(Ze(Qm,Qm,this.stageObject.transformation),me(t.render.origin,t.render.origin,Qm),t.render.num++)}async getProjectedBoundingBox(t,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=yit,l=wX(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];d0[0]=o[p[0]],d0[1]=o[p[1]],d0[2]=o[p[2]],Ze(d0,d0,this.stageObject.transformation),u1[3*h+0]=d0[0],u1[3*h+1]=d0[1],u1[3*h+2]=d0[2]}if(!t(u1,0,l))return null;$i(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],u1[h+p]),o[p+3]=Math.max(o[p+3],u1[h+p]);c&&i.push({location:u1.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){hp(o,Qm);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(r.useViewElevation)p=Pt(r.service.getElevation(Qm[0],Qm[1],h),0);else try{const f=tQ(o,r.service.spatialReference,r);p=Pt(await r.service.queryElevation(Qm[0],Qm[1],s,f,h),0)}catch{}Mfe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,r){t===by.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),t===by.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(E(this._edgeState))return;const r=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,t):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,r){const i=this._edgeState;if(E(i))return;const s=koe(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function koe(e){return e.isVisible()?e.parameters.transparent?ir.TRANSPARENT:ir.OPAQUE:ir.INVISIBLE}const u1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d0=M(),Qm=M(),yit=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];class BTe{constructor(t,r=null){this.labelText=r,this.elevationOffset=Pt(t,0)}}var Rn;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(Rn||(Rn={}));class nQ{constructor(t){this.schedule=t,this._abortController=null,this._loadStatus=xu.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,r){return this._loadStatus===xu.LOADED?(t&&t(),Pt(this._loader,Promise.resolve())):this._loadStatus===xu.FAILED?(r&&r(this._loadError),Pt(this._loader,Promise.resolve())):(E(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=xu.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=xu.FAILED,!sn(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(t,r).catch(()=>{}),this._loader)}abortLoad(){v(this._abortController)?this._abortController=Yh(this._abortController):this._loadStatus===xu.LOADING&&(this._loadStatus=xu.FAILED),this._loader=null}}var xu;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(xu||(xu={}));const zTe=3,tq=3,GTe=10;class jTe{constructor(t,r=null){this.geometry=t,this.textures=r}}function j$(e){const t=[];return e.levels.forEach(r=>r.components.forEach(i=>t.push(i.geometry.material))),KM(t)}function Voe(e){const t=new Array;return e.levels.forEach(r=>{r.components.forEach(i=>{v(i.textures)&&t.push(...i.textures)})}),KM(t)}function HTe(e){const t=e.components.map(r=>r.geometry);return KM(t)}function Boe(e){const t=[];return e.levels.forEach(r=>{r.components.forEach(i=>{t.push(i.geometry)})}),KM(t)}function _it(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function qTe(e,t){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&uYe(a),{components:[new jTe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>aYe(t,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>QXe(t,1));case"cone":return r(pV,i=>rne(t,1,.5,i,!1),!0);case"inverted-cone":return r(pV,i=>rne(t,1,.5,i,!0),!0);case"cylinder":return r(pV,i=>cYe(t,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>oYe(t,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>rYe(t,1),!0);default:return}}const pV=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function vit(e){return e.type==="fill"}function bit(e){return e.type==="extrude"}function wit(e){return e&&e.enabled&&(bit(e)||vit(e))&&v(e.edges)}function xit(e){return e&&e.enabled&&e.edges||null}function WTe(e,t){return Tit(xit(e),t)}function Tit(e,t){if(E(e))return null;const r=v(e.color)?tY(Qe.toUnitRGBA(e.color)):Ht(0,0,0,0),i=Fo(e.size),s=Fo(e.extensionLength);switch(e.type){case"solid":return Sit({color:r,size:i,extensionLength:s,...t});case"sketch":return Eit({color:r,size:i,extensionLength:s,...t});default:return}}function Sit(e){return{...Cit,...e,type:"solid"}}function Eit(e){return{...Ait,...e,type:"sketch"}}const Cit={color:Ht(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ir.OPAQUE,hasSlicePlane:!1},Ait={color:Ht(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:ir.OPAQUE,hasSlicePlane:!1},oQ={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function nSt(e){return e.type==="web-style"?oQ:aQ(e.symbolLayers.toArray().map(t=>XTe(e,t)))}function aQ(e){let t=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)E(a)||(t+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function oSt(e){const t=aQ(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const zoe={};function XTe(e,t){var s;const r=YTe(e,t),i=wit(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:v(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...Rit(t.resource&&t.resource.primitive||nme),memory:r};case"path":{let n=0,o=0;switch(t.profile){case"circle":n=GTe;break;case"quad":n=4;break;default:return void(t.profile,void 0)}switch((s=t.join)!=null?s:"simple"){case"round":o=zTe;break;case"miter":case"bevel":o=1;break;default:return}const a=2*n,l=n*o*2;let c=-2*l-a;switch(t.cap){case"none":break;case"butt":case"square":c+=2*(n-1);break;case"round":c+=2*(n*(tq-1)*2+n);break;default:return}return{primitivesPerFeature:c,primitivesPerCoordinate:l+a,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function YTe(e,t){const r=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?yl.EXTRUDE_EDGES:yl.EXTRUDE;case"fill":return v(t.outline)&&t.outline.size>0?yl.FILL_OUTLINE:yl.FILL;case"water":return yl.FILL;case"line":return t.join==="round"?yl.LINE_ROUND:yl.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return yl.PATH_ROUND_CIRCLE;case"quad":return yl.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return yl.PATH_MITER_CIRCLE;case"quad":return yl.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return}case"object":return r?yl.OBJECT_POINT:yl.OBJECT_POLYGON;case"icon":case"text":return r?yl.ICON_POINT:yl.ICON_POLYGON;default:return}}function Rit(e){let t=zoe[e];if(t)return t;const r=qTe(e,null);return t={primitivesPerFeature:HTe(r.levels[0]).reduce((i,s)=>i+s.indices.get(A.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},zoe[e]=t,t}const yl={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}},sT=ee.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class km extends nQ{constructor(t,r,i,s){super(i.schedule),this.symbol=t,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=sT,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new qu,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Goe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const r=this._drivenProperties,i=Goe(t);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,r,i,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&sT.warnOncePerTick(l)}_logGeometryValidationWarnings(t,r,i){const s=`${i} geometry failed to be created`;return!t.length||t.length===1&&!t[0].length?(sT.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(t)||!Array.isArray(t[0]))&&(sT.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(t,r=null,i=null){if(v(r)&&!r.includes(t.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return sT.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Oit}_defaultElevationInfoZ(){return Mit}_updateElevationContext(){v(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,r=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,r){const i=t.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=Pt(this._elevationContext.meterUnitOffset,Pt(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?fit:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,t,this._context.layer),r}prepareSymbolLayerPatch(t){}updateGeometry(t,r){return!1}onRemoveGraphic(t){}_getLayerOpacity(){var r;if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return(r=this._context.graphicsCoreOwner.fullOpacity)!=null?r:0;const t=this._context.layer.opacity;return t!=null?t:1}_getCombinedOpacity(t,r=joe){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(v(t)?i*=t.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(t,r=joe){const i=this._getCombinedOpacity(t,r);if(this._drivenProperties.color)return lO(null,i);const s=v(t)?Qe.toUnitRGB(t):Qf;return lO(s,i)}_getVertexOpacityAndColor(t,r=null){const i=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=lO(i,s);return v(r)&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return XTe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,r,i){switch(t){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==xs.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,r,i){let s=xs.UPDATE;return t.forEach(n=>{const o=r(n);if(v(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=xs.RECREATE}),s}applyRendererDiff(t,r){return Rn.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const r=this._fastUpdates.visualVariables,i=r.size?ay(r.size.field,t):0,s=r.color?ay(r.color.field,t):0,n=r.opacity?ay(r.opacity.field,t):0;return Ht(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&sT.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var r,i,s,n,o,a,l,c,h,p,f,m,y,_,b,x;return{size:(n=(s=(i=(r=this._fastUpdates)==null?void 0:r.visualVariables)==null?void 0:i.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(f=(p=(h=this._fastUpdates)==null?void 0:h.visualVariables)==null?void 0:p.opacity)==null?void 0:f.field)!=null?m:null,rotation:(x=(b=(_=(y=this._fastUpdates)==null?void 0:y.visualVariables)==null?void 0:_.rotation)==null?void 0:b.field)!=null?x:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function ay(e,t){const r=e!=null?t.attributes[e]:0;return r!=null&&isFinite(r)?r:0}function Goe(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(r=>{switch(r.type){case"color":if(t.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const Oit={mode:"on-the-ground",offset:0,unit:"meters"},Mit={mode:"absolute-height",offset:0,unit:"meters"},joe={hasIntrinsicColor:!1};class By extends UP{get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(t){Hn(this._transformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(t={}){super(),this.type=Fs.Object,this._geometries=new Array,this._transformation=Ie(),this._bvObjectSpace=new Hoe,this._bvWorldSpace=new Hoe,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new ZTe);const r=t.geometries;v(r)&&(this._geometries=Array.from(r))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){mt(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t){t.visible=this._visible,this._geometries.push(t),this._hasVolatileTransformation=this._hasVolatileTransformation||t.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:t}),this._invalidateBoundingVolume()}removeGeometry(t){const r=this._geometries.splice(t,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("objectGeometryUpdated",{object:this,geometry:t}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(t){if(this._visible!==t){this._visible=t;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new b4(by.MaskOccludee);for(const r of this._geometries)r.occludees=PH(r.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const r of this._geometries)r.occludees=IH(r.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new b4(by.Highlight);for(const r of this._geometries)r.highlights=PH(r.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const r of this._geometries)r.highlights=IH(r.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,r){return ws(r,this.transformation,t.transformation)}_getCombinedShaderTransformation(t){return ws(Ie(),this.transformation,t.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const s of this._geometries){const n=s.boundingInfo;v(n)&&(qoe(n,this._bvObjectSpace,s.shaderTransformation),qoe(n,this._bvWorldSpace,this._getCombinedShaderTransformation(s)))}rn(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),rn(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=M(),r=M(),i=Fw(this.transformation);for(const s of this._geometries){const n=s.boundingInfo;if(E(n))continue;const o=s.shaderTransformation,a=Fw(o);Ze(t,n.center,o);const l=Ai(t,this._bvObjectSpace.bounds),c=n.radius*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Ze(r,t,this.transformation);const h=Ai(r,this._bvWorldSpace.bounds),p=c*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,v(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,r){v(this._parentLayer)&&this._parentLayer.events.emit(t,r)}get test(){const t=this;return{hasGeometry:r=>t._geometries.includes(r),getGeometryIndex:r=>t._geometries.indexOf(r)}}}class ZTe{constructor(){this.min=Le(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Le(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Hoe extends ZTe{constructor(){super(...arguments),this.bounds=pn()}init(){ce(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ce(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Uge(this.bounds)}}function qoe(e,t,r){const i=e.bbMin,s=e.bbMax;if(i6(r)){const n=ce(Pit,r[12],r[13],r[14]);me(Jc,i,n),me(bd,s,n);for(let o=0;o<3;++o)t.min[o]=Math.min(t.min[o],Jc[o]),t.max[o]=Math.max(t.max[o],bd[o])}else if(Ze(Jc,i,r),el(i,s))for(let n=0;n<3;++n)t.min[n]=Math.min(t.min[n],Jc[n]),t.max[n]=Math.max(t.max[n],Jc[n]);else{Ze(bd,s,r);for(let n=0;n<3;++n)t.min[n]=Math.min(t.min[n],Jc[n],bd[n]),t.max[n]=Math.max(t.max[n],Jc[n],bd[n]);for(let n=0;n<3;++n){le(Jc,i),le(bd,s),Jc[n]=s[n],bd[n]=i[n],Ze(Jc,Jc,r),Ze(bd,bd,r);for(let o=0;o<3;++o)t.min[o]=Math.min(t.min[o],Jc[o],bd[o]),t.max[o]=Math.max(t.max[o],Jc[o],bd[o])}}}const Pit=M(),Jc=M(),bd=M();function lQ(e,t,r,i,s,n){const o=e.clippingExtent;if(aa(t,W_,e.elevationProvider.spatialReference),v(o)&&!vX(o,W_))return null;aa(t,W_,e.renderCoordsHelper.spatialReference);const a=e.localOriginFactory.getOrigin(W_),l=new By({castShadow:!1,metadata:{layerUid:e.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0}});return r.shaderTransformer=n,r.localOrigin=a,l.addGeometry(r),{object:l,sampledElevation:Krt(l,t,e.elevationProvider,e.renderCoordsHelper,i)}}function MM(e,t,r){const i=e.elevationContext,s=r.spatialReference;aa(t,W_,s),i.centerPointInElevationSR=Vy(W_[0],W_[1],t.hasZ?W_[2]:0,v(s)?s:null)}function PM(e){switch(e.type){case"point":return e;case"polygon":case"extent":return eQ(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const r=Ape(t,Cpe(t)/2);return Vy(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}const W_=M();function cQ(){return new Float32Array(2)}function Iit(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function $h(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function $it(e,t){return new Float32Array(e,t,2)}function JTe(){return cQ()}function QTe(){return $h(1,1)}function KTe(){return $h(1,0)}function e2e(){return $h(0,1)}const t2e=JTe(),r2e=QTe(),Lit=KTe(),Dit=e2e();Object.freeze(Object.defineProperty({__proto__:null,ONES:r2e,UNIT_X:Lit,UNIT_Y:Dit,ZEROS:t2e,clone:Iit,create:cQ,createView:$it,fromValues:$h,ones:QTe,unitX:KTe,unitY:e2e,zeros:JTe},Symbol.toStringTag,{value:"Module"}));function Nit(e){const t=new Lr;t.include(lJ),t.include(Uxe,e),t.include(Ks,e),t.attributes.add(A.UV0,"vec2");const{vertex:r,fragment:i}=t;return r.uniforms.add([new fr("viewport",(s,n)=>n.camera.fullViewport),new Pe("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new kr("pixelToNDC",(s,n)=>or(Xoe,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Pe("borderSize",(s,n)=>v(s.borderColor)?n.camera.pixelRatio:0),new kr("screenOffset",(s,n)=>or(Xoe,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&fU(r),r.code.add(w`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?w`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?w`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:w`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?w`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:w`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?w`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:w`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add([new fr("uColor",s=>Woe(s.color)),new fr("borderColor",s=>Woe(s.borderColor))]),e.hasMultipassGeometry&&(i.include(Bbe,e),i.uniforms.add(new kr("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(w`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?w`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:w`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function Woe(e){return v(e)?e:am}const Xoe=Ke(),Fit=Object.freeze(Object.defineProperty({__proto__:null,build:Nit},Symbol.toStringTag,{value:"Module"}));class SU extends Br{initializeConfiguration(t,r){r.spherical=t.viewingMode===Ge.Global}initializeProgram(t){return new Nr(t.rctx,SU.shader.get().build(this.configuration),Or)}setPipelineState(t){const r=t?Ni.ALWAYS:Ni.LESS;return this.configuration.depthHudEnabled?Vt({depthTest:{func:r},depthWrite:Jl}):Vt({blending:Wn(Ee.ONE,Ee.SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:Qt})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}SU.shader=new Dr(Fit,()=>ie(()=>import("./LineCallout.glsl.cb9f2986.js"),[]));class yh extends ao{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=zl.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([B({count:zl.COUNT})],yh.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B()],yh.prototype,"spherical",void 0),u([B()],yh.prototype,"occlusionTestEnabled",void 0),u([B()],yh.prototype,"hasVerticalOffset",void 0),u([B()],yh.prototype,"hasScreenSizePerspective",void 0),u([B()],yh.prototype,"depthHudEnabled",void 0),u([B()],yh.prototype,"depthHudAlignStartEnabled",void 0),u([B()],yh.prototype,"hasSlicePlane",void 0),u([B()],yh.prototype,"hasMultipassGeometry",void 0),u([B({constValue:!0})],yh.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],yh.prototype,"isDraped",void 0);class iw extends Bv{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(t){super(t,new i2e),this._configuration=new yh,this._uniqueMaterialIdentifier=iw.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(t,r){const i=(r==null?void 0:r.slot)!==Se.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?zl.Screen:zl.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(t,r){if(r===k.Color)switch(t){case Se.LINE_CALLOUTS:case Se.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return new Uit(t)}createBufferWriter(){return new Vit}validateParameters(t){const r=iw.uniqueMaterialIdentifier(t);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class Uit extends Vv{beginSlot(t){return this.ensureTechnique(SU,t)}}class i2e extends VC{constructor(){super(...arguments),this.screenOffset=Zl,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const kit=os().vec3f(A.POSITION).vec3f(A.NORMAL).vec2f(A.UV0).vec4f(A.AUXPOS1),Yoe=[$h(0,0),$h(1,0),$h(0,1),$h(1,0),$h(1,1),$h(0,1)];class Vit{constructor(){this.vertexBufferLayout=kit}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(A.POSITION).length}write(t,r,i,s,n){mU(i.indices.get(A.POSITION),i.vertexAttributes.get(A.POSITION).data,t,s.position,n,6),HJ(i.indices.get(A.NORMAL),i.vertexAttributes.get(A.NORMAL).data,r,s.normal,n,6),eC(i.indices.get(A.AUXPOS1),i.vertexAttributes.get(A.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<Yoe.length;++o)s.uv0.setVec(n+o,Yoe[o])}}class EU extends km{constructor(t,r){super(t,null,r,Git),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new iw(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const r=this._materialParameters;return r.screenOffset=t.screenOffset||Zl,r.centerOffsetUnits=t.centerOffsetUnits||"world",r}get _materialParameters(){const t=new i2e,r=this.symbol,i=r.callout;if(t.color=v(i.color)?Qe.toUnitRGBA(i.color):[0,0,0,0],t.color[3]*=this._getLayerOpacity(),t.size=Fo(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;t.verticalOffset={screenLength:Fo(o),minWorldLength:a||0,maxWorldLength:v(l)?l:1/0}}t.borderColor=v(i.border)&&v(i.border.color)?Qe.toUnitRGBA(i.border.color):null;const s=r.symbolLayers.getItemAt(0).type==="object",n=r.type==="label-3d";return t.occlusionTest=!s,t.shaderPolygonOffset=s?0:void 0,t.depthHUDAlignStart=n,t.hasSlicePlane=this._context.slicePlaneEnabled,t.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,t}_defaultElevationInfoNoZ(){return zit}createGraphics3DGraphic(t){const r=t.renderingInfo,i=t.graphic,s=this.setGraphicElevationContext(i,new qu,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!hme(l)))return null;const a=eQ(i.geometry);return E(a)?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){v(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=jP(EU.elevationModeChangeTypes,i,s);return n!==xs.UPDATE||t.forEach(o=>{const a=r(o);v(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return E(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}setGraphicElevationContext(t,r,i=0){const s=super.setGraphicElevationContext(t,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(t,r){this.setGraphicElevationContext(t,r.elevationContext,v(r.metadata)?r.metadata.elevationOffset:0),r.needsElevationUpdates=ad(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:oQ.memory}}_createVertexData(t){const{translation:r,centerOffset:i}=t,s=new Je(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),n=new Je(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[A.POSITION,s],[A.NORMAL,new Je([0,0,1],3,!0)],[A.AUXPOS1,n]]}_getOrCreateMaterial(t){const r=this._perInstanceMaterialParameters(t),i=iw.uniqueMaterialIdentifier(r);if(v(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(v(t.materialCollection)){let s=t.materialCollection.get(i);return E(s)&&(s=new iw(r),t.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new iw(r),isUnique:!0}}_createAs3DShape(t,r,i,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(i),l=new tn(a.material,this._createVertexData(i),Bit,null,Fs.Point,o),c=lQ(this._context,t,l,r,s);if(E(c))return null;const h=new Um(this,c.object,[l],a.isUnique?[a.material]:null,null,OM,r);return h.metadata=new BTe(i.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=ad(r.mode),MM(h,t,this._context.elevationProvider),h}}EU.elevationModeChangeTypes={definedChanged:xs.UPDATE,staysOnTheGround:xs.UPDATE,onTheGroundChanged:xs.RECREATE};const fV=[0],Bit=[[A.POSITION,fV],[A.NORMAL,fV],[A.AUXPOS1,fV]],zit={mode:"relative-to-ground",offset:0},Git={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class jit{constructor(t,r,i=M(),s=sr(),n=Ke(),o="world",a=0,l=null){this.renderer=t,this.symbol=r,this.translation=i,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}}class Hit extends mit{}const Zoe=ee.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function qit(e,t){if(!VX(e))return Zoe.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=Wit[e.callout.type];return r?new r(e,t):(Zoe.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const Wit={line:EU},Joe=new An(Array,e=>G5(e,$fe),null,10,5),Xit=ur();class Yit{get labelLayers(){return this._labelLayers}get extent(){return this._extent}constructor(t,r,i,s,n){this.graphic=t,this.graphics3DSymbol=r,this.layers=i,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=Zit(Do._COUNT,Rc._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++r.referenced,this._featureExpressionFeature=n?UTe(n,t,s):null;for(const o of i)v(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}initialize(t,r){this._layer=r,this._stage=t,this._forEachSymbolLayerGraphic(i=>{i.initialize(t,r),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelLayers.length=0}addLabelGraphic(t,r,i){this._labelLayers.push(t),t.initialize(r,i),t.setVisibility(this.isVisible(Do.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryLayers.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(t=!0)}),t}isVisible(t=Do.GRAPHIC,r){for(let i=0;i<=t;i++){const s=this._visibilityFlags[i];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==r)return!1}return!0}hasVisibilityFlag(t,r){return this._visibilityFlags[r][t]!=null}setVisibilityFlag(t,r,i){const s=this.isVisible(i);this._visibilityFlags[i][t]=r;const n=this.isVisible(i);if(s===n)return!1;if(i===Do.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Do.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,r=Do.GRAPHIC){return this.setVisibilityFlag(t,void 0,r)}computeExtent(t){if(!this._extent){const r=this.graphic.geometry;if(E(r))return!1;this._extent=ur(),Brt(r,this._extent);const i=r.spatialReference;if(!Pn(i,t)&&!s6(this._extent,i,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,r){return v(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===r||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,r),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=r),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,r,i){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Pp.fromExtent(s.type==="mesh"?s.extent:s)),x8e(s,r,i)}get usedMemory(){let t=dge(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(E(i))return;const s=r.type==="draped"?i.memory.draped:i.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=Vrt(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:M(),num:0},draped:{origin:Ke(),num:0}};for(const r of this.layers)E(r)||r.computeAttachmentOrigin(t);return t.render.num>1&&ae(t.render.origin,t.render.origin,1/t.render.num),t.draped.num>1&&Ac(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?$i(n.boundingBox):n.boundingBox=$i(),n.requiresDrapedElevation=!1,await b6(this.layers,async o=>{if(E(o))return;const a=o.type==="draped"?r:t,l=Joe.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&dE(n.boundingBox,l),Joe.release(l)}),bPe(n.boundingBox)||e7(bX(n.boundingBox,Xit))?n:null}needsElevationUpdates(){for(const t of this.layers)if(v(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelLayers)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(t,r,i){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(t,r,i)})}addObjectStateSet(t,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(t,r))}removeObjectState(t){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(t))}_forEachGraphicList(t,r){t.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.layers,t),this._forEachGraphicList(this._auxiliaryLayers,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelLayers,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function Zit(e,t){const r=new Array(e);for(let i=0;i<r.length;i++)r[i]=new Array(t);return r}var Qoe,Koe,eae,Rv={},Jit={get exports(){return Rv},set exports(e){Rv=e}};Qoe=Jit,Koe=function(){function e(L,N,F){F=F||2;var H,X,K,W,ue,pe,we,Ce=N&&N.length,qe=Ce?N[0]*F:L.length,Ne=t(L,0,qe,F,!0),xe=[];if(!Ne||Ne.next===Ne.prev)return xe;if(Ce&&(Ne=l(L,N,Ne,F)),L.length>80*F){H=K=L[0],X=W=L[1];for(var Fe=F;Fe<qe;Fe+=F)(ue=L[Fe])<H&&(H=ue),(pe=L[Fe+1])<X&&(X=pe),ue>K&&(K=ue),pe>W&&(W=pe);we=(we=Math.max(K-H,W-X))!==0?1/we:0}return i(Ne,xe,F,H,X,we),xe}function t(L,N,F,H,X){var K,W;if(X===q(L,N,F,H)>0)for(K=N;K<F;K+=H)W=Z(K,L[K],L[K+1],W);else for(K=F-H;K>=N;K-=H)W=Z(K,L[K],L[K+1],W);if(W&&O(W,W.next)){var ue=W.next;Q(W),W=ue}return W}function r(L,N){if(!L)return L;N||(N=L);var F,H=L;do if(F=!1,H.steiner||!O(H,H.next)&&C(H.prev,H,H.next)!==0)H=H.next;else{var X=H.prev;if(Q(H),(H=N=X)===H.next)break;F=!0}while(F||H!==N);return N}function i(L,N,F,H,X,K,W){if(L){!W&&K&&y(L,H,X,K);for(var ue,pe,we=L;L.prev!==L.next;)if(ue=L.prev,pe=L.next,K?n(L,H,X,K):s(L))N.push(ue.i/F),N.push(L.i/F),N.push(pe.i/F),Q(L),L=pe.next,we=pe.next;else if((L=pe)===we){W?W===1?i(L=o(r(L),N,F),N,F,H,X,K,2):W===2&&a(L,N,F,H,X,K):i(r(L),N,F,H,X,K,1);break}}}function s(L){var N=L.prev,F=L,H=L.next;if(C(N,F,H)>=0)return!1;for(var X=L.next.next;X!==L.prev;){if(T(N.x,N.y,F.x,F.y,H.x,H.y,X.x,X.y)&&C(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function n(L,N,F,H){var X=L.prev,K=L,W=L.next;if(C(X,K,W)>=0)return!1;for(var ue=X.x<K.x?X.x<W.x?X.x:W.x:K.x<W.x?K.x:W.x,pe=X.y<K.y?X.y<W.y?X.y:W.y:K.y<W.y?K.y:W.y,we=X.x>K.x?X.x>W.x?X.x:W.x:K.x>W.x?K.x:W.x,Ce=X.y>K.y?X.y>W.y?X.y:W.y:K.y>W.y?K.y:W.y,qe=b(ue,pe,N,F,H),Ne=b(we,Ce,N,F,H),xe=L.prevZ,Fe=L.nextZ;xe&&xe.z>=qe&&Fe&&Fe.z<=Ne;){if(xe!==L.prev&&xe!==L.next&&T(X.x,X.y,K.x,K.y,W.x,W.y,xe.x,xe.y)&&C(xe.prev,xe,xe.next)>=0||(xe=xe.prevZ,Fe!==L.prev&&Fe!==L.next&&T(X.x,X.y,K.x,K.y,W.x,W.y,Fe.x,Fe.y)&&C(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;xe&&xe.z>=qe;){if(xe!==L.prev&&xe!==L.next&&T(X.x,X.y,K.x,K.y,W.x,W.y,xe.x,xe.y)&&C(xe.prev,xe,xe.next)>=0)return!1;xe=xe.prevZ}for(;Fe&&Fe.z<=Ne;){if(Fe!==L.prev&&Fe!==L.next&&T(X.x,X.y,K.x,K.y,W.x,W.y,Fe.x,Fe.y)&&C(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function o(L,N,F){var H=L;do{var X=H.prev,K=H.next.next;!O(X,K)&&R(X,H,H.next,K)&&V(X,K)&&V(K,X)&&(N.push(X.i/F),N.push(H.i/F),N.push(K.i/F),Q(H),Q(H.next),H=L=K),H=H.next}while(H!==L);return r(H)}function a(L,N,F,H,X,K){var W=L;do{for(var ue=W.next.next;ue!==W.prev;){if(W.i!==ue.i&&S(W,ue)){var pe=z(W,ue);return W=r(W,W.next),pe=r(pe,pe.next),i(W,N,F,H,X,K),void i(pe,N,F,H,X,K)}ue=ue.next}W=W.next}while(W!==L)}function l(L,N,F,H){var X,K,W,ue=[];for(X=0,K=N.length;X<K;X++)(W=t(L,N[X]*H,X<K-1?N[X+1]*H:L.length,H,!1))===W.next&&(W.steiner=!0),ue.push(x(W));for(ue.sort(c),X=0;X<ue.length;X++)F=r(F=p(ue[X],F),F.next);return F}function c(L,N){return L.x-N.x}function h(L){if(L.next.prev===L)return L;let N=L;for(;;){const F=N.next;if(F.prev===N||F===N||F===L)break;N=F}return N}function p(L,N){var F=f(L,N);if(!F)return N;var H=z(F,L),X=r(F,F.next);let K=h(H);return r(K,K.next),X=h(X),h(N===F?X:N)}function f(L,N){var F,H=N,X=L.x,K=L.y,W=-1/0;do{if(K<=H.y&&K>=H.next.y&&H.next.y!==H.y){var ue=H.x+(K-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(ue<=X&&ue>W){if(W=ue,ue===X){if(K===H.y)return H;if(K===H.next.y)return H.next}F=H.x<H.next.x?H:H.next}}H=H.next}while(H!==N);if(!F)return null;if(X===W)return F;var pe,we=F,Ce=F.x,qe=F.y,Ne=1/0;H=F;do X>=H.x&&H.x>=Ce&&X!==H.x&&T(K<qe?X:W,K,Ce,qe,K<qe?W:X,K,H.x,H.y)&&(pe=Math.abs(K-H.y)/(X-H.x),V(H,L)&&(pe<Ne||pe===Ne&&(H.x>F.x||H.x===F.x&&m(F,H)))&&(F=H,Ne=pe)),H=H.next;while(H!==we);return F}function m(L,N){return C(L.prev,L,N.prev)<0&&C(N.next,L,L.next)<0}function y(L,N,F,H){var X=L;do X.z===null&&(X.z=b(X.x,X.y,N,F,H)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==L);X.prevZ.nextZ=null,X.prevZ=null,_(X)}function _(L){var N,F,H,X,K,W,ue,pe,we=1;do{for(F=L,L=null,K=null,W=0;F;){for(W++,H=F,ue=0,N=0;N<we&&(ue++,H=H.nextZ);N++);for(pe=we;ue>0||pe>0&&H;)ue!==0&&(pe===0||!H||F.z<=H.z)?(X=F,F=F.nextZ,ue--):(X=H,H=H.nextZ,pe--),K?K.nextZ=X:L=X,X.prevZ=K,K=X;F=H}K.nextZ=null,we*=2}while(W>1);return L}function b(L,N,F,H,X){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=32767*(L-F)*X)|L<<8))|L<<4))|L<<2))|L<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-H)*X)|N<<8))|N<<4))|N<<2))|N<<1))<<1}function x(L){var N=L,F=L;do(N.x<F.x||N.x===F.x&&N.y<F.y)&&(F=N),N=N.next;while(N!==L);return F}function T(L,N,F,H,X,K,W,ue){return(X-W)*(N-ue)-(L-W)*(K-ue)>=0&&(L-W)*(H-ue)-(F-W)*(N-ue)>=0&&(F-W)*(K-ue)-(X-W)*(H-ue)>=0}function S(L,N){return L.next.i!==N.i&&L.prev.i!==N.i&&!U(L,N)&&(V(L,N)&&V(N,L)&&G(L,N)&&(C(L.prev,L,N.prev)||C(L,N.prev,N))||O(L,N)&&C(L.prev,L,L.next)>0&&C(N.prev,N,N.next)>0)}function C(L,N,F){return(N.y-L.y)*(F.x-N.x)-(N.x-L.x)*(F.y-N.y)}function O(L,N){return L.x===N.x&&L.y===N.y}function R(L,N,F,H){var X=I(C(L,N,F)),K=I(C(L,N,H)),W=I(C(F,H,L)),ue=I(C(F,H,N));return X!==K&&W!==ue||!(X!==0||!$(L,F,N))||!(K!==0||!$(L,H,N))||!(W!==0||!$(F,L,H))||!(ue!==0||!$(F,N,H))}function $(L,N,F){return N.x<=Math.max(L.x,F.x)&&N.x>=Math.min(L.x,F.x)&&N.y<=Math.max(L.y,F.y)&&N.y>=Math.min(L.y,F.y)}function I(L){return L>0?1:L<0?-1:0}function U(L,N){var F=L;do{if(F.i!==L.i&&F.next.i!==L.i&&F.i!==N.i&&F.next.i!==N.i&&R(F,F.next,L,N))return!0;F=F.next}while(F!==L);return!1}function V(L,N){return C(L.prev,L,L.next)<0?C(L,N,L.next)>=0&&C(L,L.prev,N)>=0:C(L,N,L.prev)<0||C(L,L.next,N)<0}function G(L,N){var F=L,H=!1,X=(L.x+N.x)/2,K=(L.y+N.y)/2;do F.y>K!=F.next.y>K&&F.next.y!==F.y&&X<(F.next.x-F.x)*(K-F.y)/(F.next.y-F.y)+F.x&&(H=!H),F=F.next;while(F!==L);return H}function z(L,N){var F=new te(L.i,L.x,L.y),H=new te(N.i,N.x,N.y),X=L.next,K=N.prev;return L.next=N,N.prev=L,F.next=X,X.prev=F,H.next=F,F.prev=H,K.next=H,H.prev=K,H}function Z(L,N,F,H){var X=new te(L,N,F);return H?(X.next=H.next,X.prev=H,H.next.prev=X,H.next=X):(X.prev=X,X.next=X),X}function Q(L){L.next.prev=L.prev,L.prev.next=L.next,L.prevZ&&(L.prevZ.nextZ=L.nextZ),L.nextZ&&(L.nextZ.prevZ=L.prevZ)}function te(L,N,F){this.i=L,this.x=N,this.y=F,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function q(L,N,F,H){for(var X=0,K=N,W=F-H;K<F;K+=H)X+=(L[W]-L[K])*(L[K+1]+L[W+1]),W=K;return X}return e.deviation=function(L,N,F,H){var X=N&&N.length,K=X?N[0]*F:L.length,W=Math.abs(q(L,0,K,F));if(X)for(var ue=0,pe=N.length;ue<pe;ue++){var we=N[ue]*F,Ce=ue<pe-1?N[ue+1]*F:L.length;W-=Math.abs(q(L,we,Ce,F))}var qe=0;for(ue=0;ue<H.length;ue+=3){var Ne=H[ue]*F,xe=H[ue+1]*F,Fe=H[ue+2]*F;qe+=Math.abs((L[Ne]-L[Fe])*(L[xe+1]-L[Ne+1])-(L[Ne]-L[xe])*(L[Fe+1]-L[Ne+1]))}return W===0&&qe===0?0:Math.abs((qe-W)/W)},e.flatten=function(L){for(var N=L[0][0].length,F={vertices:[],holes:[],dimensions:N},H=0,X=0;X<L.length;X++){for(var K=0;K<L[X].length;K++)for(var W=0;W<N;W++)F.vertices.push(L[X][K][W]);X>0&&(H+=L[X-1].length,F.holes.push(H))}return F},e},(eae=Koe())!==void 0&&(Qoe.exports=eae);const CU=ee.getLogger("esri.views.3d.support.buffer.math");function qP(e,t,r){if(e.count!==t.count)return void CU.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[4],l=r[5],c=r[6],h=r[8],p=r[9],f=r[10],m=r[12],y=r[13],_=r[14],b=e.typedBuffer,x=e.typedBufferStride,T=t.typedBuffer,S=t.typedBufferStride;for(let C=0;C<i;C++){const O=C*x,R=C*S,$=T[R],I=T[R+1],U=T[R+2];b[O]=s*$+a*I+h*U+m,b[O+1]=n*$+l*I+p*U+y,b[O+2]=o*$+c*I+f*U+_}}function Ov(e,t,r){if(e.count!==t.count)return void CU.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=e.typedBuffer,y=e.typedBufferStride,_=t.typedBuffer,b=t.typedBufferStride;for(let x=0;x<i;x++){const T=x*y,S=x*b,C=_[S],O=_[S+1],R=_[S+2];m[T]=s*C+a*O+h*R,m[T+1]=n*C+l*O+p*R,m[T+2]=o*C+c*O+f*R}}function rq(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=r*o[h],s[c+1]=r*o[h+1],s[c+2]=r*o[h+2]}}function uQ(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);i[l]=y*h,i[l+1]=y*p,i[l+2]=y*f}}}function Qit(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=o[h]>>r,s[c+1]=o[h+1]>>r,s[c+2]=o[h+2]>>r}}Object.freeze(Object.defineProperty({__proto__:null,normalize:uQ,scale:rq,shiftRight:Qit,transformMat3:Ov,transformMat4:qP},Symbol.toStringTag,{value:"Module"}));function Kit(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function tae(e,t,r,i,s,n=!1){return{objectId:e,target:t,distance:r,type:"edge",start:i,end:s,draped:n}}function AU(e,t){if(!e||e.symbol)return null;const r=t&&t.renderer;return e&&v(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function est(e,t){if(v(e.symbol))return e.symbol;const r=AU(e,t);return v(r)&&r.type!=="dot-density"?r.getSymbol(e,t):null}function aSt(e,t){var a;const r=AU(e,t),i=est(e,t);if(E(i))return null;const s={renderer:r,symbol:i};if(E(r)||!("visualVariables"in r)||!r.visualVariables)return s;const n=(a=JY(r,e,t))!=null?a:[],o=["proportional","proportional","proportional"];for(const{variable:l,value:c}of n)switch(l.type){case"color":s.color=c.toRgba();break;case"size":if(l.target==="outline")s.outlineSize=c;else{const h=l.axis,p=l.useSymbolValue?"symbol-value":c;switch(h){case"width":o[0]=p;break;case"depth":o[1]=p;break;case"height":o[2]=p;break;case"width-and-depth":o[0]=o[1]=p;break;default:o[0]=o[1]=o[2]=p}}break;case"opacity":s.opacity=c;break;case"rotation":switch(l.axis){case"tilt":s.tilt=c;break;case"roll":s.roll=c;break;default:s.heading=c}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function tst(e,t){if(v(e.symbol))return e.symbol;const r=AU(e,t);return v(r)?r.getSymbolAsync(e,t):null}async function lSt(e,t){var a;const r=AU(e,t),i=await tst(e,t);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=(a=JY(r,e,t))!=null?a:[],o=["proportional","proportional","proportional"];for(const{variable:l,value:c}of n)if(l.type==="color")s.color=Qe.toUnitRGBA(c);else if(l.type==="size")if(l.target==="outline")s.outlineSize=c;else{const h=l.axis,p=l.useSymbolValue?"symbol-value":c;h==="width"?o[0]=p:h==="depth"?o[1]=p:h==="height"?o[2]=p:o[0]=o[1]=h==="width-and-depth"?p:o[2]=p}else l.type==="opacity"?s.opacity=c:l.type==="rotation"&&l.axis==="tilt"?s.tilt=c:l.type==="rotation"&&l.axis==="roll"?s.roll=c:l.type==="rotation"&&(s.heading=c);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function rst(e,t=0){const r=e[t];return typeof r=="number"&&isFinite(r)?r:null}function ist(e){for(let t=0;t<3;t++){const r=e[t];if(typeof r=="number")return isFinite(r)?r:0}return 0}function rae(e){const t=[[A.POSITION,e.indices]],r=[[A.POSITION,new Je(e.attributeData.position,3,!0)]];return v(e.attributeData.color)&&(r.push([A.COLOR,new Je(e.attributeData.color,4,!0)]),t.push([A.COLOR,new Array(e.indices.length).fill(0)])),v(e.attributeData.uvMapSpace)&&(r.push([A.UVMAPSPACE,new Je(e.attributeData.uvMapSpace,4,!0)]),t.push([A.UVMAPSPACE,e.indices])),v(e.attributeData.boundingRect)&&(r.push([A.BOUNDINGRECT,new Je(e.attributeData.boundingRect,9,!0)]),t.push([A.BOUNDINGRECT,e.indices])),new tn(e.material,r,t,e.mapPositions,Fs.Mesh,e.attributeData.objectAndLayerIdColor)}function iae(e){const t=[[A.POSITION,e.indices],[A.UV0,e.indices]],r=[[A.POSITION,new Je(e.attributeData.position,3,!0)],[A.UV0,new Je(e.attributeData.uv0,2,!0)]];return new tn(e.material,r,t,e.mapPositions)}function IM(e){switch(e.type){case"extent":if(e instanceof qr)return Pp.fromExtent(e);break;case"polygon":return e}return null}class RU{constructor(t,r,i){this.renderData=t,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}}function iq(e,t,r){var R;const i=Array.isArray(e),s=i?e.length/t:e.byteLength/(4*t),n=i?e:new Uint32Array(e,0,s*t),o=(R=r==null?void 0:r.minReduction)!=null?R:0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let h=0;if(c)for(let $=0;$<c.length-1;$++){const I=c[$+1]-c[$];I>h&&(h=I)}else h=s;const p=Math.floor(1.1*h)+1;(Zp==null||Zp.length<2*p)&&(Zp=new Uint32Array(JS(2*p)));for(let $=0;$<2*p;$++)Zp[$]=0;let f=0;const m=!!c&&!!a,y=m?l:s;let _=awe(s/3);const b=new Uint32Array(l),x=1.96;let T=o!==0?Math.ceil(4*x*x/(o*o)*o*(1-o)):y,S=1,C=c?c[1]:y;for(let $=0;$<y;$++){if($===T){const Z=1-f/$;if(Z+x*Math.sqrt(Z*(1-Z)/$)<o)return null;T*=2}if($===C){for(let Z=0;Z<2*p;Z++)Zp[Z]=0;if(a)for(let Z=c[S-1];Z<c[S];Z++)b[Z]=_[a[Z]];C=c[++S]}const I=m?a[$]:$,U=I*t,V=ost(n,U,t);let G=V%p,z=f;for(;Zp[2*G+1]!==0;){if(Zp[2*G]===V){const Z=Zp[2*G+1]-1;if(sst(n,U,Z*t,t)){z=_[Z];break}}G++,G>=p&&(G-=p)}z===f&&(Zp[2*G]=V,Zp[2*G+1]=I+1,f++),_[I]=z}if(o!==0&&1-f/s<o)return null;if(m){for(let $=c[S-1];$<b.length;$++)b[$]=_[a[$]];_=LS(b)}const O=i?new Array(f):new Uint32Array(f*t);f=0;for(let $=0;$<y;$++)_[$]===f&&(nst(n,(m?a[$]:$)*t,O,f*t,t),f++);if(a&&!m){const $=new Uint32Array(l);for(let I=0;I<$.length;I++)$[I]=_[a[I]];_=LS($)}return{buffer:Array.isArray(O)?O:O.buffer,indices:_,uniqueCount:f}}function sst(e,t,r,i){for(let s=0;s<i;s++)if(e[t+s]!==e[r+s])return!1;return!0}function nst(e,t,r,i,s){for(let n=0;n<s;n++)r[i+n]=e[t+n]}function ost(e,t,r){let i=0;for(let s=0;s<r;s++)i=e[t+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Zp=null;function cSt(e){const t=WP(e.rings,e.hasZ,Am.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=qh(t.position,3*c,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(Rv(h,p,3));r.push({position:h,faces:f}),i+=h.length,s+=f.length}const n=ast(r,i,s),o=Array.isArray(n.position)?iq(n.position,3,{originalIndices:n.faces}):iq(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function ast(e,t,r){if(e.length===1)return e[0];const i=Bc(t),s=new Uint32Array(r);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:i,faces:s}}function WP(e,t,r){const i=e.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,h=0;for(let m=0;m<i;++m)h+=e[m].length;const p=Bc(3*h);let f=0;for(let m=i-1;m>=0;m--){const y=e[m],_=r===Am.CCW_IS_HOLE&&lst(y);if(_&&i!==1)s[a++]=y;else{let b=y.length;for(let T=0;T<a;++T)b+=s[T].length;const x={index:f,pathLengths:new Array(a+1),count:b,holeIndices:new Array(a)};x.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=_?H$(y,y.length-1,-1,p,f,y.length,t):H$(y,0,1,p,f,y.length,t);for(let T=0;T<a;++T){const S=s[T];x.holeIndices[T]=f,x.pathLengths[T+1]=S.length,S.length>0&&(o[c++]={index:f,count:S.length}),f=H$(S,0,1,p,f,S.length,t)}a=0,x.count>0&&(n[l++]=x)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=H$(y,0,1,p,f,y.length,t)}return n.length=l,o.length=c,{position:p,polygons:n,outlines:o}}function H$(e,t,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,t+=r}return s/3}function lst(e){return!Rpe(e,!1,!1)}var Am;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Am||(Am={}));var cO,G4,sq;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(cO||(cO={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(G4||(G4={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(sq||(sq={}));var is,Lh,At,uO,vs,Tn,ya;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(is||(is={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Lh||(Lh={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(At||(At={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(uO||(uO={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(vs||(vs={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(Tn||(Tn={})),function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"}(ya||(ya={}));class cst{constructor(t,r){this.vec3=t,this.id=r}}function hO(e,t,r,i){return new cst(Le(e,t,r),i)}var Fl;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded",e[e.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Fl||(Fl={}));class sae{get extent(){return this._extent}constructor(t,r){this.index=t,this.renderTargets=r,this._extent=ur(),this.resolution=0,this.renderLocalOrigin=hO(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new ust,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const r=t===Fl.ColorAndWater?this.renderTargets.getTarget(vs.Color):t===Fl.Highlight?this.renderTargets.getTarget(vs.Highlight):t===Fl.ObjectAndLayerIdColor?this.renderTargets.getTarget(vs.ObjectAndLayerIdColor):this.renderTargets.getTarget(vs.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(vs.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(vs.Color):null}getNormalTexture(t){const r=t===Fl.ColorAndWater?this.renderTargets.getTarget(vs.Water):null;return r?r.getTexture():null}draw(t,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==vs.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?FE.CHANGED:FE.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[vs.Color]|+t[vs.ColorNoRasterImage]<<1|+t[vs.Highlight]<<2|+t[vs.Water]<<3|+t[vs.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const r=.001*t.range;if(this._extent[0]-r<=t.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];wF(this._extent,t.range,0,i)}if(this._extent[2]+r>=t.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];wF(this._extent,-t.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,my(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const r=this.canvasGeometries.extents[t];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===is.INNER?0:this.resolution,0,this.resolution,this.resolution)}}class ust{constructor(){this.extents=[ur(),ur(),ur()],this.numViews=0}}class s2e{constructor(t,r){this._size=cQ(),this._fbo=null,this._fbo=new Li(t,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR_MIPMAP_LINEAR,hasMipmap:r,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=tt(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,r){this._size[0]=t,this._size[1]=r,this._fbo.resize(this._size[0],this._size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){const t=this._fbo.colorTexture;t.descriptor.hasMipmap&&t.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,r;return(r=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?r:0}}class nT{constructor(t,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new s2e(t,s)}}class hst{constructor(t){this.renderTargets=[new nT(t,k.Color,vs.Color),new nT(t,k.Color,vs.ColorNoRasterImage),new nT(t,k.Highlight,vs.Highlight,!1),new nT(t,k.Normal,vs.Water),new nT(t,k.Color,vs.Occluded)],de("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new nT(t,k.ObjectAndLayerIdColor,vs.ObjectAndLayerIdColor))}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,r,i){if(t)r.lastUsed=i;else if(i-r.lastUsed>dst)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,r)=>t+r.fbo.gpuMemoryUsage,0)}}const dst=1e3;class n2e{constructor(t){this._context=t,this._perConstructorInstances=new DC,this._frameCounter=0,this._keepAliveFrameCount=nae}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(t=>t.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,r=fst){const i=r.key;let s=this._perConstructorInstances.get(t,i);if(E(s)){const n=new t(this._context,r,()=>this.release(n));s=new pst(n),this._perConstructorInstances.set(t,i,s)}return++s.refCount,s.technique}releaseAndAcquire(t,r,i){if(v(i)){if(r.key===i.key)return i;this.release(i)}return this.acquire(t,r)}release(t){if(E(t)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(t.constructor,t.key);E(r)||(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==nae&&this._perConstructorInstances.forEach((t,r)=>{t.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};t.push(s(r,i))}),await Promise.all(t)}}class pst{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const nae=-1,fst=new $a;class o2e{constructor(t,r,i,s){this._textureRepository=t,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new DC}dispose(){this._textureRepository.destroy()}acquire(t,r,i){if(this._ownMaterial(t),!t.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,t.id);if(E(s)){const n=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new mst(n),this._id2glMaterialRef.set(i,t.id,s)}return s.ref(),s.glMaterial}release(t,r){const i=this._id2glMaterialRef.get(r,t.id);v(i)&&(i.unref(),i.referenced||(tt(i.glMaterial),this._id2glMaterialRef.delete(r,t.id)))}_ownMaterial(t){v(t.repository)&&t.repository!==this&&ee.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),t.repository=this}}class mst{constructor(t){this.glMaterial=t,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,mt(this._refCnt>=0)}get referenced(){return this._refCnt>0}}const gst={orderedRepackingEnabled:!1},yst={rootOrigin:null},_st=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];class iC{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(t,r){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new $s,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),$s.clearPool(),nq[0]=null,h1.prune(),_b.prune()}add(t,r=t.length){this._objectCount+=r,this._grow(t,r);const i=$s.acquire();for(let s=0;s<r;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}$s.release(i)}remove(t,r=null){this._objectCount-=t.length;const i=$s.acquire();for(const s of t){const n=v(r)?r:wE(this._objectToBoundingSphere(s),Tst);h3(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}$s.release(i),this._shrink()}update(t,r){if(!h3(r[3])&&this._isDegenerate(t))return;const i=xst(t);this.remove(i,r),this.add(i)}forEachAlongRay(t,r,i){const s=zu(t,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(t,r,i,s){const n=zu(t,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(t){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(t),i.residents!==null&&i.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=mV(t,r),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!H_(i,f))return;const m=v_(t,r,f),y=m-f[3],_=m+f[3];y<o&&(o=y,a=_,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!H_(i,p.bounds)||(ae(Qu,c,p.halfSize),me(Qu,Qu,p.bounds),v_(t,r,Qu)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},t,r),l}forEachInDepthRange(t,r,i,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:_=>{i===iC.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};h.setRange(s);const p=v_(r,i,t),f=mV(r,i),m=mV(r,-i),y=_=>{if(!a(_))return;const b=this._objectToBoundingSphere(_),x=b,T=v_(r,i,x)-p,S=T-b[3],C=T+b[3];S>c||C<l||!H_(o,b)||n(_,h)};this._forEachNodeDepthOrdered(this._root,_=>{if(!H_(o,_.bounds)||(ae(Qu,f,_.halfSize),me(Qu,Qu,_.bounds),v_(r,i,Qu)-p>c)||(ae(Qu,m,_.halfSize),me(Qu,Qu,_.bounds),v_(r,i,Qu)-p<l))return!1;const b=_.node;return b.terminals.forAll(x=>y(x)),b.residents!==null&&b.residents.forAll(x=>y(x)),!0},r,i)}forEachNode(t){this._forEachNode(this._root,r=>t(r.node,r.bounds,r.halfSize))}forEachNeighbor(t,r){const i=ty(r),s=r,n=l=>{const c=this._objectToBoundingSphere(l),h=ty(c),p=i+h;return!(jn(c,s)-p*p<=0)||t(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=ty(l.bounds),h=i+c;if(jn(l.bounds,s)-h*h>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(t,r){return q$(r.bounds,2*-r.halfSize,vu),q$(r.bounds,2*r.halfSize,bu),Qse(t.origin,t.direction,vu,bu)}_intersectsNodeWithOffset(t,r,i){return q$(r.bounds,2*-r.halfSize,vu),q$(r.bounds,2*r.halfSize,bu),i.applyToMinMax(vu,bu),Qse(t.origin,t.direction,vu,bu)}_intersectsObject(t,r){const i=this._objectToBoundingSphere(r);return!(i[3]>0)||eG(i,t)}_intersectsObjectWithOffset(t,r,i){const s=this._objectToBoundingSphere(r);return!(s[3]>0)||eG(i.applyToBoundingSphere(s),t)}_forEachNode(t,r){let i=$s.acquire().init(t);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push($s.acquire().init(i).advance(n));$s.release(i)}}_forEachNodeDepthOrdered(t,r,i,s=iC.DepthOrder.FRONT_TO_BACK){let n=$s.acquire().init(t);const o=[n];for(wst(i,s,lae);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=lae[a];n.node.children[l]&&o.push($s.acquire().init(n).advance(l))}$s.release(n)}}_remove(t,r,i){h1.clear();const s=i.advanceTo(r,(n,o)=>{h1.push(n.node),h1.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=h1.length-2;n>=0;n-=2){const o=h1.data[n],a=h1.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let r=0;r<t.children.length;r++)if(t.children[r])return!1;return!0}_purge(t,r){return r>=0&&(t.children[r]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Jt({shrink:!0})),!0)}_add(t,r){r.advanceTo(this._objectToBoundingSphere(t))?r.node.terminals.push(t):(r.node.residents.push(t),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(t){const r=t.node.residents;t.node.residents=null;for(let i=0;i<r.length;i++){const s=$s.acquire().init(t);this._add(r.getItemAt(i),s),$s.release(s)}}_grow(t,r){if(r!==0&&(oae(t,r,i=>this._objectToBoundingSphere(i),Km),h3(Km[3])&&!this._fitsInsideTree(Km)))if(this._nodeIsEmpty(this._root.node))wE(Km,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(Km);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(Km,i):this._growRootAsSubNode(i),$s.release(i)}}_rebuildTree(t,r){le(yV,r.bounds),yV[3]=r.halfSize,oae([t,yV],2,s=>s,_V);const i=$s.acquire().init(this._root);this._root.initFrom(null,_V,_V[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),$s.release(i)}_placingRootViolatesMaxDepth(t){const r=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const r=t[3],i=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(i[l]-r),h=i[l]+r-(n[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(h/(2*o)))+1,m=2**Math.ceil(Math.log(p+f)*Math.LOG2E);s=Math.max(s,m),W$[l].min=p,W$[l].max=f}for(let l=0;l<3;l++){let c=W$[l].min,h=W$[l].max;const p=(s-(c+h))/2;c+=Math.ceil(p),h+=Math.floor(p);const f=n[l]-o-c*o*2;gV[l]=f+(h+c)*o}const a=s*o;return gV[3]=a*l2e,$s.acquire().initFrom(null,gV,a,0)}_growRootAsSubNode(t){const r=this._root.node;le(Km,this._root.bounds),Km[3]=this._root.halfSize,this._root.init(t),t.advanceTo(Km,null,!0),t.node.children=r.children,t.node.residents=r.residents,t.node.terminals=r.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&t==null;)i=s++,t=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(t){return!h3(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const r=this._root.bounds,i=this._root.halfSize;return t[3]<=i&&t[0]>=r[0]-i&&t[0]<=r[0]+i&&t[1]>=r[1]-i&&t[1]<=r[1]+i&&t[2]>=r[2]-i&&t[2]<=r[2]+i}}class $s{constructor(){this.bounds=pn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,r,i,s=this.depth){return this.node=v(t)?t:$s.createEmptyNode(),v(r)&&wE(r,this.bounds),this.halfSize=i,this.depth=s,this}increaseHalfSize(t){this.halfSize*=t,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*l2e}advance(t){let r=this.node.children[t];r||(r=$s.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;const i=a2e[t];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(t,r,i=!1){for(;;){if(this.isTerminalFor(t))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const r=this.bounds;return(r[0]<t[0]?1:0)+(r[1]<t[1]?2:0)+(r[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Jt({shrink:!0}),residents:new Jt({shrink:!0})}}static acquire(){return $s._pool.acquire()}static release(t){$s._pool.release(t)}static clearPool(){$s._pool.prune()}}function vst(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function bst(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function q$(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function oae(e,t,r,i){if(t===1){const s=r(e[0]);wE(s,i)}else{vu[0]=1/0,vu[1]=1/0,vu[2]=1/0,bu[0]=-1/0,bu[1]=-1/0,bu[2]=-1/0;for(let s=0;s<t;s++){const n=r(e[s]);h3(n[3])&&(vst(vu,n),bst(bu,n))}rn(i,vu,bu,.5),i[3]=Math.max(bu[0]-vu[0],bu[1]-vu[1],bu[2]-vu[2])/2}}function wst(e,t,r){if(!_b.length)for(let i=0;i<8;++i)_b.push({index:0,distance:0});for(let i=0;i<8;++i){const s=a2e[i];_b.data[i].index=i,_b.data[i].distance=v_(e,t,s)}_b.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=_b.data[i].index}function mV(e,t){let r,i=1/0;for(let s=0;s<8;++s){const n=v_(e,t,aae[s]);n<i&&(i=n,r=aae[s])}return r}function v_(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function h3(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}$s._pool=new An($s),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(iC||(iC={}));const a2e=[Le(-1,-1,-1),Le(1,-1,-1),Le(-1,1,-1),Le(1,1,-1),Le(-1,-1,1),Le(1,-1,1),Le(-1,1,1),Le(1,1,1)],aae=[Le(-1,-1,-1),Le(-1,-1,1),Le(-1,1,-1),Le(-1,1,1),Le(1,-1,-1),Le(1,-1,1),Le(1,1,-1),Le(1,1,1)],l2e=Math.sqrt(3),nq=[null];function xst(e){return nq[0]=e,nq}const gV=pn(),Qu=M(),vu=M(),bu=M(),h1=new Jt,Tst=pn(),Km=pn(),yV=pn(),_V=pn(),W$=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],_b=new Jt,lae=[0,0,0,0,0,0,0,0],yp=iC;var nv;(function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"})(nv||(nv={}));class c2e extends UP{get objects(){return this._objects}constructor(t,r=""){var i,s,n,o;super(),this.apiLayerUid=r,this.type=Fs.Layer,this.events=new Vs,this.sliceable=!1,this._objects=new Jt,this._objectsAdded=new Jt,this._stageHandles=new Jr,this.apiLayerUid=r,this.visible=(i=t==null?void 0:t.visible)!=null?i:!0,this.pickable=(s=t==null?void 0:t.pickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:nv.ASYNC,this._disableOctree=(o=t==null?void 0:t.disableOctree)!=null?o:!1}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const r of _st)this._stageHandles.add(this.events.on(r,i=>t.handleEvent(r,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),v(this._octree)&&this._objectsAdded.push(t)}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),v(this._octree)&&(this._objectsAdded.removeUnordered(t)||this._octree.remove([t])))}addMany(t){this._objects.pushArray(t);for(const r of t)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),v(this._octree)&&this._objectsAdded.pushArray(t)}removeMany(t){const r=new Array;if(this._objects.removeUnorderedMany(t,t.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),v(this._octree)){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){v(this._stage)&&this.updatePolicy!==nv.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,r){v(this._octree)&&!this._objectsAdded.includes(t)&&this._octree.update(t,r)}getSpatialQueryAccelerator(){return E(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new yp(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):v(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Ve(this._octree),this._objectsAdded.clear()}}function j4(e){return v(e)&&e.type===Fs.Layer}var Wh,ax;(function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"})(Wh||(Wh={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(ax||(ax={}));class Mo extends ao{constructor(){super(...arguments),this.output=k.Color,this.transparencyPassType=xt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Wh.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=ax.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([B({count:k.COUNT})],Mo.prototype,"output",void 0),u([B({count:xt.COUNT})],Mo.prototype,"transparencyPassType",void 0),u([B()],Mo.prototype,"occluder",void 0),u([B()],Mo.prototype,"hasSlicePlane",void 0),u([B()],Mo.prototype,"writeDepth",void 0),u([B({count:Wh.COUNT})],Mo.prototype,"space",void 0),u([B()],Mo.prototype,"hideOnShortSegments",void 0),u([B()],Mo.prototype,"hasCap",void 0),u([B({count:ax.COUNT})],Mo.prototype,"anchor",void 0),u([B()],Mo.prototype,"hasTip",void 0),u([B()],Mo.prototype,"vvSize",void 0),u([B()],Mo.prototype,"vvColor",void 0),u([B()],Mo.prototype,"vvOpacity",void 0),u([B()],Mo.prototype,"hasOccludees",void 0),u([B()],Mo.prototype,"hasMultipassTerrain",void 0),u([B()],Mo.prototype,"cullAboveGround",void 0),u([B({constValue:!0})],Mo.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],Mo.prototype,"hasSliceTranslatedView",void 0);const cae=8;function u2e(e,t){const r=e.vertex;r.uniforms.add(new Pe("intrinsicWidth",i=>i.width)),t.vvSize?(e.attributes.add(A.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new qt("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new qt("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new qt("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new qt("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(w`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(A.SIZE,"float"),r.code.add(w`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(A.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add([new wa("vvOpacityValues",i=>i.vvOpacityValues,cae),new wa("vvOpacityOpacities",i=>i.vvOpacityOpacities,cae)]),r.code.add(w`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(w`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(A.COLORFEATUREATTRIBUTE,"float"),r.constants.add("vvColorNumber","int",Cp),r.uniforms.add(new wa("vvColorValues",i=>i.vvColorValues,Cp)),r.uniforms.add(new yU("vvColorColors",i=>i.vvColorColors,Cp)),r.code.add(w`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(A.COLOR,"vec4"),r.code.add(w`vec4 getColor(){
return applyOpacity(color);
}`))}function Sy(e,t){switch(e.fragment.include(jc),t.output){case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(w`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case k.Depth:e.fragment.code.add(w`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}class h2e{constructor(t){this._rctx=t,this._cache=new Map}destroy(){this._cache.forEach(t=>tt(t.stippleTexture)),this._cache.clear()}_acquire(t){if(E(t))return null;const r=this._patternId(t),i=this._cache.get(r);if(i)return i.refCount++,i;const{encodedData:s,paddedPixels:n}=Est(t),o=new Sst(new lt(this._rctx,{width:n,height:1,internalFormat:ze.RGBA,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE},s));return this._cache.set(r,o),o}release(t){if(E(t))return;const r=this._patternId(t),i=this._cache.get(r);i&&(i.refCount--,i.refCount===0&&(v(i.stippleTexture)&&i.stippleTexture.dispose(),this._cache.delete(r)))}swap(t,r){const i=this._acquire(r);return this.release(t),i}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}class Sst extends gi{constructor(t){super(),this.stippleTexture=t,this.refCount=1}}function Est(e){const t=hQ(e),r=1/e.pixelRatio,i=d2e(e),s=p2e(e),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const m of t){for(let y=0;y<m;y++){const _=a*(Math.min(y,m-1-y)+.5)*r/n*.5+.5;o.push(_)}a=-a}const l=Math.round(t[0]/2),c=[...o.slice(l),...o.slice(0,l)],h=i+f2e,p=new Uint8Array(4*h);let f=4;for(const m of c)AM(m,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:h}}function hQ(e){return e.pattern.map(t=>Math.round(t*e.pixelRatio))}function d2e(e){if(E(e))return 1;const t=hQ(e);return Math.floor(t.reduce((r,i)=>r+i))}function p2e(e){return hQ(e).reduce((t,r)=>Math.max(t,r))}const f2e=2;function Cst(e){return E(e)?am:e.length===4?e:ti(Ast,e[0],e[1],e[2],1)}const Ast=sr();function m2e(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?Rst(e,t):Ost(e)}function Rst(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:i,fragment:s}=e;s.include(jc),t.draped||(Fp(i,t),i.uniforms.add(new Pe("worldToScreenPerDistanceRatio",(o,a)=>1/a.camera.perScreenPixelRatio)),i.code.add(w`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),i.code.add(w`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Pst};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(w`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(w`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),i.uniforms.add(new Pe("pixelRatio",(o,a)=>a.camera.pixelRatio)),i.code.add(w`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?w`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",f2e);const n=t.hasWebGL2Context?ei.None:ei.Size;s.uniforms.add(Tp("stipplePatternTexture",o=>o.stippleTexture,n)),s.uniforms.add([new Pe("stipplePatternSDFNormalizer",o=>Mst(o.stipplePattern)),new Pe("stipplePatternPixelSizeInv",o=>1/dQ(o))]),s.code.add(w`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${Hh(t,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),s.code.add(w`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?w`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:w`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?w`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?w`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:w`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?w`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:w`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new fr("stippleOffColor",o=>Cst(o.stippleOffColor))),s.code.add(w`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(w`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Ost(e){e.fragment.code.add(w`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function Mst(e){return v(e)?(Math.floor(.5*(p2e(e)-1))+.5)/e.pixelRatio:1}function dQ(e){const t=e.stipplePattern;return v(t)?d2e(e.stipplePattern)/t.pixelRatio:1}const Pst=w.float(.4),$M=64,pQ=$M/2,g2e=pQ/5,Ist=$M/g2e,$st=.25;function Lst(e,t){return e.fromData(`${t}-marker`,()=>rTe(t,$M,pQ,g2e))}function y2e(e,t){const r=e.vertex;e.constants.add("markerSizePerLineWidth","float",Ist),r.uniforms.add(new Pe("pixelRatio",(i,s)=>s.camera.pixelRatio)),E(r.uniforms.get("markerScale"))&&r.constants.add("markerScale","float",1),r.code.add(w`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===Wh.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Pe("perRenderPixelRatio",(i,s)=>s.camera.perRenderPixelRatio)),r.code.add(w`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var Xh;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(Xh||(Xh={}));class ts extends ao{constructor(){super(...arguments),this.output=k.Color,this.capType=Xh.BUTT,this.transparencyPassType=xt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}u([B({count:k.COUNT})],ts.prototype,"output",void 0),u([B({count:Xh.COUNT})],ts.prototype,"capType",void 0),u([B({count:xt.COUNT})],ts.prototype,"transparencyPassType",void 0),u([B()],ts.prototype,"occluder",void 0),u([B()],ts.prototype,"hasSlicePlane",void 0),u([B()],ts.prototype,"hasPolygonOffset",void 0),u([B()],ts.prototype,"writeDepth",void 0),u([B()],ts.prototype,"draped",void 0),u([B()],ts.prototype,"stippleEnabled",void 0),u([B()],ts.prototype,"stippleOffColorEnabled",void 0),u([B()],ts.prototype,"stippleScaleWithLineWidth",void 0),u([B()],ts.prototype,"stipplePreferContinuous",void 0),u([B()],ts.prototype,"roundJoins",void 0),u([B()],ts.prototype,"applyMarkerOffset",void 0),u([B()],ts.prototype,"vvSize",void 0),u([B()],ts.prototype,"vvColor",void 0),u([B()],ts.prototype,"vvOpacity",void 0),u([B()],ts.prototype,"falloffEnabled",void 0),u([B()],ts.prototype,"innerColorEnabled",void 0),u([B()],ts.prototype,"hasOccludees",void 0),u([B()],ts.prototype,"hasMultipassTerrain",void 0),u([B()],ts.prototype,"cullAboveGround",void 0),u([B()],ts.prototype,"wireframe",void 0),u([B({constValue:!0})],ts.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!0})],ts.prototype,"stippleRequiresStretchMeasure",void 0),u([B({constValue:!0})],ts.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],ts.prototype,"hasSliceTranslatedView",void 0),u([B()],ts.prototype,"objectAndLayerIdColorInstanced",void 0);const H4=1;function Dst(e){const t=new Lr,{vertex:r,fragment:i}=t,s=e.hasMultipassTerrain&&(e.output===k.Color||e.output===k.Alpha);t.include(DP),t.include(u2e,e),t.include(m2e,e);const n=e.applyMarkerOffset&&!e.draped;n&&(r.uniforms.add(new Pe("markerScale",m=>m.markerScale)),t.include(y2e,{space:Wh.World})),e.output===k.Depth&&t.include(Sy,e),t.include(gU,e),Nc(r,e),r.uniforms.add([new Yi("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new kr("nearFar",(m,y)=>y.camera.nearFar),new Pe("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new fr("viewport",(m,y)=>y.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.SUBDIVISIONFACTOR,"float"),t.attributes.add(A.UV0,"vec2"),t.attributes.add(A.AUXPOS1,"vec3"),t.attributes.add(A.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),bv(t),s&&t.varyings.add("depth","float");const o=e.capType===Xh.ROUND,a=e.stippleEnabled&&e.stippleScaleWithLineWidth||o;a&&t.varyings.add("vLineWidth","float");const l=e.stippleEnabled&&e.stippleScaleWithLineWidth;l&&t.varyings.add("vLineSizeInv","float");const c=e.innerColorEnabled||o;c&&t.varyings.add("vLineDistance","float");const h=e.stippleEnabled&&o,p=e.falloffEnabled||h;p&&t.varyings.add("vLineDistanceNorm","float"),o&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(w`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(w`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),J6(t),r.code.add(w`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new Pe("pixelRatio",(m,y)=>y.camera.pixelRatio)),r.code.add(w`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?w`vLineWidth = lineWidth;`:""}
      ${l?w`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(w`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(w`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(e.stippleEnabled||o)&&r.code.add(w`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?w`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(w`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(w`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?w`min(1.0, subdivisionFactor * ${w.float((H4+2)/(H4+1))})`:w`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(w`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=e.capType!==Xh.BUTT;return r.code.add(w`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?w`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(w`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?w`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?w`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?w`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&r.code.add(w`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new Pe("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):r.code.add(w`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(w`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(w`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(w`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Pe("stipplePatternPixelSize",m=>dQ(m))),r.code.add(w`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(w`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&t.include(ju,e),t.include(Ks,e),i.include(Nm),i.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?i.code.add(w`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&i.code.add(w`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${w.float(sa)}) {
        discard;
      }
    `),h?i.code.add(w`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${w.float(sa)}, stippleCoverage);
      `):i.code.add(w`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new fr("intrinsicColor",m=>m.color)),e.output!==k.ObjectAndLayerIdColor&&i.code.add(w`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(w`vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(i.uniforms.add(new fr("innerColor",m=>Pt(m.innerColor,m.color))),i.uniforms.add(new Pe("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),i.code.add(w`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(w`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(i.uniforms.add(new Pe("falloff",m=>m.falloff)),i.code.add(w`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(w`
    ${e.output===k.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${w.float(sa)}) {
      discard;
    }

    ${e.output===k.Alpha?w`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===k.Color?w`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===k.Color&&e.transparencyPassType===xt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===k.Highlight?w`gl_FragColor = vec4(1.0);`:""}
    ${e.output===k.Depth?w`outputDepth(linearDepth);`:""}
    ${e.output===k.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const Nst=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:H4,build:Dst},Symbol.toStringTag,{value:"Module"})),fQ={func:Ni.LESS},q4={func:Ni.ALWAYS},Rm={mask:255},_2e={mask:0},Fst=e=>({function:{func:Ni.NOTEQUAL,ref:e,mask:e},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.KEEP}}),Ust=e=>({function:{func:Ni.ALWAYS,ref:e,mask:e},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.REPLACE}}),Gv={function:{func:Ni.ALWAYS,ref:ql.OutlineVisualElementMask,mask:ql.OutlineVisualElementMask},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.ZERO}},Mv={function:{func:Ni.ALWAYS,ref:ql.OutlineVisualElementMask,mask:ql.OutlineVisualElementMask},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.REPLACE}},v2e={function:{func:Ni.EQUAL,ref:ql.OutlineVisualElementMask,mask:ql.OutlineVisualElementMask},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.KEEP}},b2e={function:{func:Ni.NOTEQUAL,ref:ql.OutlineVisualElementMask,mask:ql.OutlineVisualElementMask},operation:{fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.KEEP}},w2e=new Map([[A.POSITION,0],[A.SUBDIVISIONFACTOR,1],[A.UV0,2],[A.AUXPOS1,3],[A.AUXPOS2,4],[A.COLOR,5],[A.COLORFEATUREATTRIBUTE,5],[A.SIZE,6],[A.SIZEFEATUREATTRIBUTE,6],[A.OPACITYFEATUREATTRIBUTE,7],[A.OBJECTANDLAYERIDCOLOR,8]]);class OU extends Br{initializeProgram(t){return new Nr(t.rctx,OU.shader.get().build(this.configuration),w2e)}_makePipelineState(t,r){const i=this.configuration,s=t===xt.NONE,n=t===xt.FrontFace;return Vt({blending:i.output===k.Color||i.output===k.Alpha?s?Fu:ky(t):null,depthTest:{func:zv(t)},depthWrite:s?i.writeDepth?Jl:null:_U(t),colorWrite:Qt,stencilWrite:i.hasOccludees?Rm:null,stencilTest:i.hasOccludees?r?Mv:Gv:null,polygonOffset:s||n?i.hasPolygonOffset?uae:null:bU})}initializePipeline(){const t=this.configuration;if(t.occluder){const r=t.hasPolygonOffset?uae:null;this._occluderPipelineTransparent=Vt({blending:Fu,polygonOffset:r,depthTest:q4,depthWrite:null,colorWrite:Qt,stencilWrite:null,stencilTest:b2e}),this._occluderPipelineOpaque=Vt({blending:Fu,polygonOffset:r,depthTest:q4,depthWrite:null,colorWrite:Qt,stencilWrite:_2e,stencilTest:v2e}),this._occluderPipelineMaskWrite=Vt({blending:null,polygonOffset:r,depthTest:fQ,depthWrite:null,colorWrite:null,stencilWrite:Rm,stencilTest:Mv})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?It.LINES:It.TRIANGLE_STRIP}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===Se.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Se.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}OU.shader=new Dr(Nst,()=>ie(()=>import("./RibbonLine.glsl.d9df13f4.js"),[]));const uae={factor:0,units:-4};var gc;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(gc||(gc={}));class aS extends Bv{constructor(t){super(t,new Vst),this._configuration=new ts,this._vertexAttributeLocations=w2e,this._layout=this.createLayout()}isClosed(t,r){return T2e(this.parameters,t,r)}getConfiguration(t,r){this._configuration.output=t,this._configuration.draped=r.slot===Se.DRAPED_MATERIAL;const i=v(this.parameters.stipplePattern)&&t!==k.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&v(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!v(this.parameters.markerParameters)&&zst(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&v(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===us.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(t,r,i,s,n,o){if(!i.options.selectionMode)return;const a=t.vertexAttributes.get(A.POSITION).data,l=t.vertexAttributes.get(A.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const _=t.vertexAttributes.get(A.SIZEFEATUREATTRIBUTE).data[0];c*=ye(this.parameters.vvSizeOffset[0]+_*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const h=s[0],p=s[1],f=(c/2+4)*t.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],x=a[_+1],T=h-b,S=p-x,C=a[_+3]-b,O=a[_+4]-x,R=ye((C*T+O*S)/(C*C+O*O),0,1),$=C*R-T,I=O*R-S,U=$*$+I*I;U<m&&(m=U,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}intersect(t,r,i,s,n,o){if(!i.options.selectionMode||!t.visible)return;if(!owe(r))return void ee.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=t.vertexAttributes,l=a.get(A.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const T=a.get(A.SIZEFEATUREATTRIBUTE).data[0];c*=ye(this.parameters.vvSizeOffset[0]+T*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(A.SIZE)&&(c*=a.get(A.SIZE).data[0]);const h=i.camera,p=Gst;qn(p,i.point);const f=c*h.pixelRatio/2+4*h.pixelRatio;ce(OA[0],p[0]-f,p[1]+f,0),ce(OA[1],p[0]+f,p[1]+f,0),ce(OA[2],p[0]+f,p[1]-f,0),ce(OA[3],p[0]-f,p[1]-f,0);for(let T=0;T<4;T++)if(!h.unprojectFromRenderScreen(OA[T],eg[T]))return;_a(h.eye,eg[0],eg[1],bV),_a(h.eye,eg[1],eg[2],wV),_a(h.eye,eg[2],eg[3],xV),_a(h.eye,eg[3],eg[0],TV);let m=Number.MAX_VALUE,y=0;const _=x2e(this.parameters,a,t.indices)?l.length-2:l.length-5;for(let T=0;T<_;T+=3){_l[0]=l[T]+r[12],_l[1]=l[T+1]+r[13],_l[2]=l[T+2]+r[14];const S=(T+3)%l.length;if(vl[0]=l[S]+r[12],vl[1]=l[S+1]+r[13],vl[2]=l[S+2]+r[14],Ei(bV,_l)<0&&Ei(bV,vl)<0||Ei(wV,_l)<0&&Ei(wV,vl)<0||Ei(xV,_l)<0&&Ei(xV,vl)<0||Ei(TV,_l)<0&&Ei(TV,vl)<0)continue;if(h.projectToRenderScreen(_l,p1),h.projectToRenderScreen(vl,f1),p1[2]<0&&f1[2]>0){ge(Jp,_l,vl);const O=h.frustum,R=-Ei(O[Si.NEAR],_l)/_e(Jp,O[Si.NEAR]);ae(Jp,Jp,R),me(_l,_l,Jp),h.projectToRenderScreen(_l,p1)}else if(p1[2]>0&&f1[2]<0){ge(Jp,vl,_l);const O=h.frustum,R=-Ei(O[Si.NEAR],vl)/_e(Jp,O[Si.NEAR]);ae(Jp,Jp,R),me(vl,vl,Jp),h.projectToRenderScreen(vl,f1)}else if(p1[2]<0&&f1[2]<0)continue;p1[2]=0,f1[2]=0;const C=sY(dw(p1,f1,pae),p);C<m&&(m=C,le(hae,_l),le(dae,vl),y=T/3)}const b=i.rayBegin,x=i.rayEnd;if(m<f*f){let T=Number.MAX_VALUE;if($ge(dw(hae,dae,pae),dw(b,x,jst),d1)){ge(d1,d1,b);const S=Me(d1);ae(d1,d1,1/S),T=S/Ai(b,x)}o(T,d1,y,!1)}}createLayout(){const t=os().vec3f(A.POSITION).f32(A.SUBDIVISIONFACTOR).vec2f(A.UV0).vec3f(A.AUXPOS1).vec3f(A.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(A.SIZEFEATUREATTRIBUTE):t.f32(A.SIZE),this.parameters.vvColorEnabled?t.f32(A.COLORFEATUREATTRIBUTE):t.vec4f(A.COLOR),this.parameters.vvOpacityEnabled&&t.f32(A.OPACITYFEATUREATTRIBUTE),de("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(A.OBJECTANDLAYERIDCOLOR),t}createBufferWriter(){return new Bst(this._layout,this.parameters)}requiresSlot(t,r){return r===k.Color||r===k.Alpha||r===k.Highlight||r===k.Depth||r===k.ObjectAndLayerIdColor?t===Se.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===us.OccludeAndTransparentStencil?t===Se.OPAQUE_MATERIAL||t===Se.OCCLUDER_MATERIAL||t===Se.TRANSPARENT_OCCLUDER_MATERIAL:r===k.Color||r===k.Alpha?t===(this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Se.OPAQUE_MATERIAL:!1}createGLMaterial(t){return new kst(t)}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0),v(t.markerParameters)&&(t.markerScale=t.markerParameters.width/t.width)}}class kst extends Vv{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(t);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(OU,t)}}class Vst extends JJ{constructor(){super(...arguments),this.width=0,this.color=kh,this.join="miter",this.cap=Xh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class Bst{constructor(t,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=H4+i}}_isClosed(t){return x2e(this._parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const i=t.indices.get(A.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(t,r,i,s,n){var te;const o=Hst,a=qst,l=Wst,c=i.vertexAttributes.get(A.POSITION).data,h=i.indices&&i.indices.get(A.POSITION),p=(te=i.vertexAttributes.get(A.DISTANCETOSTART))==null?void 0:te.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSizeEnabled?m=i.vertexAttributes.get(A.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(A.SIZE)&&(f=i.vertexAttributes.get(A.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColorEnabled?_=i.vertexAttributes.get(A.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(A.COLOR)&&(y=i.vertexAttributes.get(A.COLOR).data);const b=de("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let x=0;this._parameters.vvOpacityEnabled&&(x=i.vertexAttributes.get(A.OPACITYFEATUREATTRIBUTE).data[0]);const T=c.length/3,S=new Float32Array(s.buffer),C=de("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,O=this.vertexBufferLayout.stride/4;let R=n*O;const $=R;let I=0;const U=p?(q,L,N)=>I=p[N]:(q,L,N)=>I+=Ai(q,L),V=de("enable-feature:objectAndLayerId-rendering"),G=(q,L,N,F,H,X,K)=>{if(S[R++]=L[0],S[R++]=L[1],S[R++]=L[2],S[R++]=F,S[R++]=K,S[R++]=H,S[R++]=q[0],S[R++]=q[1],S[R++]=q[2],S[R++]=N[0],S[R++]=N[1],S[R++]=N[2],this._parameters.vvSizeEnabled?S[R++]=m:S[R++]=f,this._parameters.vvColorEnabled)S[R++]=_;else{const W=Math.min(4*X,y.length-4);S[R++]=y[W],S[R++]=y[W+1],S[R++]=y[W+2],S[R++]=y[W+3]}this._parameters.vvOpacityEnabled&&(S[R++]=x),V&&(v(b)&&(C[4*R]=b[0],C[4*R+1]=b[1],C[4*R+2]=b[2],C[4*R+3]=b[3]),R++)};R+=O,ce(a,c[0],c[1],c[2]),t&&Ze(a,a,t);const z=this._isClosed(i);if(z){const q=c.length-3;ce(o,c[q],c[q+1],c[q+2]),t&&Ze(o,o,t)}else ce(l,c[3],c[4],c[5]),t&&Ze(l,l,t),G(a,a,l,1,gc.LEFT_CAP_START,0,0),G(a,a,l,1,gc.RIGHT_CAP_START,0,0),le(o,a),le(a,l);const Z=z?0:1,Q=z?T:T-1;for(let q=Z;q<Q;q++){const L=(q+1)%T*3;ce(l,c[L],c[L+1],c[L+2]),t&&Ze(l,l,t),U(o,a,q),G(o,a,l,0,gc.LEFT_JOIN_END,q,I),G(o,a,l,0,gc.RIGHT_JOIN_END,q,I);const N=this.numJoinSubdivisions;for(let F=0;F<N;++F){const H=(F+1)/(N+1);G(o,a,l,H,gc.LEFT_JOIN_END,q,I),G(o,a,l,H,gc.RIGHT_JOIN_END,q,I)}G(o,a,l,1,gc.LEFT_JOIN_START,q,I),G(o,a,l,1,gc.RIGHT_JOIN_START,q,I),le(o,a),le(a,l)}z?(ce(l,c[3],c[4],c[5]),t&&Ze(l,l,t),I=U(o,a,Q),G(o,a,l,0,gc.LEFT_JOIN_END,Z,I),G(o,a,l,0,gc.RIGHT_JOIN_END,Z,I)):(I=U(o,a,Q),G(o,a,a,0,gc.LEFT_CAP_END,Q,I),G(o,a,a,0,gc.RIGHT_CAP_END,Q,I)),vV(S,$+O,S,$,O),R=vV(S,R-O,S,R,O),this._parameters.wireframe&&this._addWireframeVertices(s,$,R,O)}_addWireframeVertices(t,r,i,s){const n=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=vV(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function vV(e,t,r,i,s){for(let n=0;n<s;n++)r[i++]=e[t++];return i}function x2e(e,t,r){return T2e(e,t.get(A.POSITION).data,r?r.get(A.POSITION):null)}function T2e(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}function zst(e){return e.anchor===ax.Tip&&e.hideOnShortSegments&&e.placement==="begin-end"&&e.worldSpace}const _l=M(),vl=M(),Jp=M(),d1=M(),Gst=M(),p1=ta(),f1=ta(),hae=M(),dae=M(),pae=kp(),jst=kp(),Hst=M(),qst=M(),Wst=M(),OA=[ta(),ta(),ta(),ta()],eg=[M(),M(),M(),M()],bV=jr(),wV=jr(),xV=jr(),TV=jr();class mQ{constructor(t){this._originSR=t,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Lc()}getOrigin(t){const r=this._origins.get(this._rootOriginId);if(r==null){const h=yst.rootOrigin;if(v(h))return this._origins.set(this._rootOriginId,hO(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(t);const p=hO(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const i=this._gridSize,s=Math.round(t[0]/i),n=Math.round(t[1]/i),o=Math.round(t[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(ge(bo,t,r.vec3),bo[0]=Math.abs(bo[0]),bo[1]=Math.abs(bo[1]),bo[2]=Math.abs(bo[2]),bo[0]<c&&bo[1]<c&&bo[2]<c){if(l){const h=Math.max(...bo);if(ge(bo,t,l.vec3),bo[0]=Math.abs(bo[0]),bo[1]=Math.abs(bo[1]),bo[2]=Math.abs(bo[2]),Math.max(...bo)<h)return l}return r}return l||(l=hO(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(t,r=Ht(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new aS({width:2,color:r}),s.add(this._material);const m=new c2e({pickable:!1}),y=new By({castShadow:!1});s.add(y),m.add(y),s.add(m),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Array,p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&a[m]?p:-p),c[3*m+1]=t[1]+(2&a[m]?p:-p),c[3*m+2]=t[2]+(4&a[m]?p:-p),m>0&&h.push(m-1,m);Ts(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new tn(this._material,[[A.POSITION,new Je(c,3,!0)]],[[A.POSITION,h]],null,Fs.Line);s.add(f),o.addGeometry(f)}get test(){const t=this;return{set gridSize(r){t._gridSize=r}}}}const bo=M();class S2e{constructor(t,r,i,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new Ct,this.output=k.Color,this.renderOccludedMask=fae,this.bindParameters=new Y6(r,i,v(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=fae}}class Xst extends S2e{constructor(t,r,i,s,n){super(t,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}}const fae=us.Occlude|us.OccludeAndTransparent|us.OccludeAndTransparentStencil;let d3=class extends Ct{constructor(){super(...arguments),this._projectionMatrix=Ie()}get projectionMatrix(){return this._projectionMatrix}};u([d()],d3.prototype,"_projectionMatrix",void 0),u([d({readOnly:!0})],d3.prototype,"projectionMatrix",null),d3=u([P("esri.views.3d.webgl-engine.lib.CascadeCamera")],d3);var sC;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(sC||(sC={}));class X${constructor(){this.camera=new d3,this.lightMat=Ie()}}class gQ{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return ti(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(t,r){this._rctx=t,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=Ie(),this._projectionViewInverse=Ie(),this._modelViewLight=Ie(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=sr(),this._cascades=[new X$,new X$,new X$,new X$],this._lastOrigin=null,this._maxTextureSize=Math.min(de("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this._maxNumCascades=ye(Math.floor(t),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&v(this._depthTexture)}getSnapshot(t){return this.enabled?this._snapshots[t]:null}get cascades(){for(let t=0;t<this._numCascades;++t)EV[t]=this._cascades[t];return EV.length=this._numCascades,EV}start(t,r,i){mt(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(i);this._computeCascadeDistances(n,s),this._setupMatrices(t,r);const{viewMatrix:o,projectionMatrix:a}=t;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,a,o,r);this._lastOrigin=null,this.clear()}finish(t){mt(this.enabled),this._rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this._lastOrigin||!el(t,this._lastOrigin)){this._lastOrigin=this._lastOrigin||M(),le(this._lastOrigin,t);for(let r=0;r<this._numCascades;++r){Yl(bae,this._cascades[r].lightMat,t);for(let i=0;i<16;++i)wae[16*r+i]=bae[i]}}return wae}takeCascadeSnapshotTo(t,r){mt(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,lt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(bt.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,lt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this._rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(Vi.COLOR_BUFFER_BIT|Vi.DEPTH_BUFFER_BIT)}_computeTextureSize(t,r){const i=.5*Math.log(t*t+r*r)*Math.LOG2E,s=.35,n=2**Math.round(i+s);return Math.min(this._maxTextureSize,2*n)}_ensureDepthTexture(){if(v(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new lt(this._rctx,t),this._fbo=new Li(this._rctx,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let r=this._snapshots[t];if(v(r)&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(t);const i={target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return r=new lt(this._rctx,i),this._snapshots[t]=r,r}_discardDepthTexture(){this._fbo=tt(this._fbo),this._depthTexture=tt(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=tt(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this._snapshots.length;++t)this._discardSnapshot(t);this._snapshots.length=0}_bindFbo(){const t=this._rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,r,i,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);mt(l<c);for(let m=0;m<8;++m){ti(mae,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=Ch[m];Mu(y,mae,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}Ea(SV,Ch[0]),n.camera.viewMatrix=Yl(Yst,this._modelViewLight,SV);for(let m=0;m<8;++m)Ze(Ch[m],Ch[m],n.camera.viewMatrix);let h=Ch[0][2],p=Ch[0][2];for(let m=1;m<8;++m)h=Math.min(h,Ch[m][2]),p=Math.max(p,Ch[m][2]);h-=200,p+=200,n.camera.near=-p,n.camera.far=-h,Kst(i,s,h,p,n.camera),ws(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureSize/2;n.camera.viewport=[t%2==0?0:f,Math.floor(t/2)===0?0:f,f,f]}_setupMatrices(t,r){ws(this._projectionView,t.projectionMatrix,t.viewMatrix),ko(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Ge.Global?t.eye:ce(SV,0,0,1);r6(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(t){let{near:r,far:i}=t;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(t,r){this._numCascades=Math.min(1+Math.floor(FXe(t/r,4)),this._maxNumCascades);const i=(t-r)/this._numCascades,s=(t/r)**(1/this._numCascades);let n=r,o=r;for(let a=0;a<this._numCascades+1;++a)this._cascadeDistances[a]=Nt(n,o,this._splitSchemeLambda),n*=s,o+=i}get gpuMemoryUsage(){var t,r;return this._snapshots.reduce((i,s)=>i+Ww(s),(r=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?r:0)}get test(){const t=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(r){t._splitSchemeLambda=r},get splitSchemeLambda(){return t._splitSchemeLambda}}}}const Yst=Ie(),mae=sr(),Ch=[];for(let e=0;e<8;++e)Ch.push(sr());const gae=Ke(),yae=Ke(),Zst=Ke(),_ae=Ke(),vae=Ke(),SV=M(),EV=[],bae=Ie(),wae=new Float32Array(64),Qc=Ke(),oT=Ke(),m1=[Ke(),Ke(),Ke(),Ke()],$n=Ke(),CV=Ke(),p0=Ke(),MA=Ke(),aT=Ke(),lT=Ke(),Y$=Ke();function Jst(e,t,r,i,s,n,o,a){or(Qc,0,0);for(let O=0;O<4;++O)ep(Qc,Qc,e[O]);Ac(Qc,Qc,.25),or(oT,0,0);for(let O=4;O<8;++O)ep(oT,oT,e[O]);Ac(oT,oT,.25),T2(m1[0],e[4],e[5],.5),T2(m1[1],e[5],e[6],.5),T2(m1[2],e[6],e[7],.5),T2(m1[3],e[7],e[4],.5);let l=0,c=u4(m1[0],Qc);for(let O=1;O<4;++O){const R=u4(m1[O],Qc);R<c&&(c=R,l=O)}Xf($n,m1[l],e[l+4]);const h=$n[0];let p,f;$n[0]=-$n[1],$n[1]=h,Xf(CV,oT,Qc),vn(CV,$n)<0&&DZ($n,$n),T2($n,$n,CV,r),rM($n,$n),p=f=vn(Xf(p0,e[0],Qc),$n);for(let O=1;O<8;++O){const R=vn(Xf(p0,e[O],Qc),$n);R<p?p=R:R>f&&(f=R)}qn(i,Qc),Ac(p0,$n,p-t),ep(i,i,p0);let m=-1,y=1,_=0,b=0;for(let O=0;O<8;++O){Xf(MA,e[O],i),rM(MA,MA);const R=$n[0]*MA[1]-$n[1]*MA[0];R>0?R>m&&(m=R,_=O):R<y&&(y=R,b=O)}Gx(m>0,"leftArea"),Gx(y<0,"rightArea"),Ac(aT,$n,p),ep(aT,aT,Qc),Ac(lT,$n,f),ep(lT,lT,Qc),Y$[0]=-$n[1],Y$[1]=$n[0];const x=l$(i,e[b],lT,ep(p0,lT,Y$),1,s),T=l$(i,e[_],lT,p0,1,n),S=l$(i,e[_],aT,ep(p0,aT,Y$),1,o),C=l$(i,e[b],aT,p0,1,a);Gx(x,"rayRay"),Gx(T,"rayRay"),Gx(S,"rayRay"),Gx(C,"rayRay")}function Cr(e,t){return 3*t+e}const xae=Ke();function ec(e,t){return or(xae,e[t],e[t+3]),xae}const bl=Ke(),st=ns();function Qst(e,t,r,i,s){Xf(bl,r,i),Ac(bl,bl,.5),st[0]=bl[0],st[1]=bl[1],st[2]=0,st[3]=bl[1],st[4]=-bl[0],st[5]=0,st[6]=bl[0]*bl[0]+bl[1]*bl[1],st[7]=bl[0]*bl[1]-bl[1]*bl[0],st[8]=1,st[Cr(0,2)]=-vn(ec(st,0),e),st[Cr(1,2)]=-vn(ec(st,1),e);let n=vn(ec(st,0),r)+st[Cr(0,2)],o=vn(ec(st,1),r)+st[Cr(1,2)],a=vn(ec(st,0),i)+st[Cr(0,2)],l=vn(ec(st,1),i)+st[Cr(1,2)];n=-(n+a)/(o+l),st[Cr(0,0)]+=st[Cr(1,0)]*n,st[Cr(0,1)]+=st[Cr(1,1)]*n,st[Cr(0,2)]+=st[Cr(1,2)]*n,n=1/(vn(ec(st,0),r)+st[Cr(0,2)]),o=1/(vn(ec(st,1),r)+st[Cr(1,2)]),st[Cr(0,0)]*=n,st[Cr(0,1)]*=n,st[Cr(0,2)]*=n,st[Cr(1,0)]*=o,st[Cr(1,1)]*=o,st[Cr(1,2)]*=o,st[Cr(2,0)]=st[Cr(1,0)],st[Cr(2,1)]=st[Cr(1,1)],st[Cr(2,2)]=st[Cr(1,2)],st[Cr(1,2)]+=1,n=vn(ec(st,1),t)+st[Cr(1,2)],o=vn(ec(st,2),t)+st[Cr(2,2)],a=vn(ec(st,1),r)+st[Cr(1,2)],l=vn(ec(st,2),r)+st[Cr(2,2)],n=-.5*(n/o+a/l),st[Cr(1,0)]+=st[Cr(2,0)]*n,st[Cr(1,1)]+=st[Cr(2,1)]*n,st[Cr(1,2)]+=st[Cr(2,2)]*n,n=vn(ec(st,1),t)+st[Cr(1,2)],o=vn(ec(st,2),t)+st[Cr(2,2)],a=-o/n,st[Cr(1,0)]*=a,st[Cr(1,1)]*=a,st[Cr(1,2)]*=a,s[0]=st[0],s[1]=st[1],s[2]=0,s[3]=st[2],s[4]=st[3],s[5]=st[4],s[6]=0,s[7]=st[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=st[6],s[13]=st[7],s[14]=0,s[15]=st[8]}function Kst(e,t,r,i,s){const n=1/Ch[0][3],o=1/Ch[4][3];mt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(Mn(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,Jst(Ch,a,l,gae,yae,Zst,_ae,vae),Qst(gae,yae,_ae,vae,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function ent(e){return zp(e)&&e.intersector===ss.TERRAIN&&!!e.target}class tnt extends tU{constructor(t,r,i){super(t,r),this.triangleNr=i}}function E2e(e){return zp(e)&&e.intersector===ss.OVERLAY&&!!e.target}class oq{constructor(){this.adds=new Jt,this.removes=new Jt,this.updates=new Jt({allocator:t=>t||new rnt,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}}class rnt{}class int{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var cs,kn;(function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"})(cs||(cs={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(kn||(kn={}));function C2e(e){const t=new Map,r=i=>{let s=t.get(i);return s||(s=new int,t.set(i,s)),s};return e.removes.forAll(i=>{AV(i)&&r(i.material).removes.push(i)}),e.adds.forAll(i=>{AV(i)&&r(i.material).adds.push(i)}),e.updates.forAll(i=>{AV(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),t}function AV(e){return e.geometry.indexCount>=1}class snt{constructor(t){this._rctx=t,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){const t=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,r=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(t,r,new Map([]))}_createIndexbuffer(){return wr.createIndex(this._rctx,$r.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Ot.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(It.POINTS,1,at.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}}class A2e{constructor(t,r){this._material=t,this._repository=r,this._map=new Map}destroy(){this._map.forEach((t,r)=>{v(t)&&this._repository.release(this._material,r)})}load(t,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(v(s)){if(s.ensureResources(t)===sy.LOADED)return s;this._repository.requestRender()}return null}}function nnt(e){const t=w`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.vertex.code.add(t)}function XP(e,t){switch(t.normalType){case oi.CompressedAttribute:e.include(nnt),e.attributes.add(A.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(w`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case oi.Attribute:e.attributes.add(A.NORMAL,"vec3"),e.vertex.code.add(w`vec3 normalModel() {
return normal;
}`);break;case oi.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(w`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:t.normalType;case oi.COUNT:case oi.Ground:}}var oi;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(oi||(oi={}));function MU(e,t){switch(t.normalType){case oi.Attribute:case oi.CompressedAttribute:e.include(XP,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new oM("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new Fm("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)]),e.vertex.code.add(w`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case oi.Ground:e.include($S,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(w`
        void forwardNormal() {
          vNormalWorld = ${t.spherical?w`normalize(vPositionWorldCameraRelative);`:w`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case oi.ScreenDerivative:e.vertex.code.add(w`void forwardNormal() {}`);break;default:t.normalType;case oi.COUNT:}}class R2e extends twe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ns()}}class O2e extends rwe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=ns(),this.toMapSpace=sr()}}class aq extends O2e{constructor(t=M()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}class zC{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(A.POSITION).length}write(t,r,i,s,n){Zxe(i,this.vertexBufferLayout,t,r,s,n)}}const ont=os().vec3f(A.POSITION),ant=os().vec3f(A.POSITION).vec2f(A.UV0),M2e=os().vec3f(A.POSITION).vec4u8(A.COLOR);os().vec3f(A.POSITION).vec4u8(A.OBJECTANDLAYERIDCOLOR);os().vec3f(A.POSITION).vec2f(A.UV0).vec4u8(A.OBJECTANDLAYERIDCOLOR);const lnt=os().vec3f(A.POSITION).vec4u8(A.COLOR).vec4u8(A.OBJECTANDLAYERIDCOLOR);class yQ extends Bv{intersect(t,r,i,s,n,o){return kxe(t,i,s,n,void 0,o)}}function cnt(e){e.fragment.code.add(w`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function unt(e){e.fragment.code.add(w`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Tae(e){e.fragment.uniforms.add(new Mt("texWaveNormal",t=>t.waveNormal)),e.fragment.uniforms.add(new Mt("texWavePerturbation",t=>t.wavePertubation)),e.fragment.uniforms.add([new fr("waveParams",t=>ti(hnt,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new kr("waveDirection",t=>or(dnt,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(cnt),e.fragment.code.add(w`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const hnt=sr(),dnt=Ke();function LM(e,t){t.spherical?e.vertex.code.add(w`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(w`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(w`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(w`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class YP extends Es{constructor(t,r){super(t,"int",fi.Pass,(i,s,n)=>i.setUniform1i(t,r(s,n)))}}class pnt extends Es{constructor(t,r,i){super(t,"mat4",fi.Draw,(s,n,o)=>s.setUniformMatrix4fv(t,r(n,o)),i)}}class fnt extends Es{constructor(t,r,i){super(t,"mat4",fi.Pass,(s,n,o)=>s.setUniformMatrix4fv(t,r(n,o)),i)}}class P2e extends gi{constructor(){super(...arguments),this.origin=M()}}function PU(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new fnt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),I2e(e,t))}function lx(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new pnt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),I2e(e,t))}function I2e(e,t){const r=e.fragment;r.include(jc),r.uniforms.add([...Tp("shadowMapTex",(i,s)=>s.shadowMap.depthTexture,t.hasWebGL2Context?ei.None:ei.Size),new YP("numCascades",(i,s)=>s.shadowMap.numCascades),new fr("cascadeDistances",(i,s)=>s.shadowMap.cascadeDistances)]),r.code.add(w`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${Hh(t,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}function mnt(e){const t=e.fragment.code;t.add(w`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(w`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(w`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function _Q(e,t){const r=e.fragment.code;e.include(DP),t.pbrMode!==ht.Normal&&t.pbrMode!==ht.Schematic&&t.pbrMode!==ht.Terrain&&t.pbrMode!==ht.TerrainWithWater||(r.add(w`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(w`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),t.pbrMode!==ht.Normal&&t.pbrMode!==ht.Schematic||(e.include(mnt),r.add(w`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(w`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(w`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(w`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function gnt(e,t){const r=e.fragment.code;e.include(DP),r.add(w`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(w`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(w`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(w`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(w`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function $2e(e,t){e.include(gnt,t),e.include(G6),e.include(unt),t.hasCloudsReflections&&e.include(Dbe,t),t.hasScreenSpaceReflections&&e.include(ZWe,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(w`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add([new Pe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Pe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)]),r.code.add(w`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&r.code.add(w`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?(r.uniforms.add([new Yi("view",(i,s)=>s.ssr.camera.viewMatrix),new Mt("lastFrameColorTexture",(i,s)=>s.ssr.lastFrameColorTexture),new Pe("fadeFactor",(i,s)=>s.ssr.fadeFactor)]),r.code.add(w`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(w`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add(w`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(w`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(w`return waterRenderedColor;
}`)}function ynt(e){const t=new Lr,{vertex:r,fragment:i}=t;Nc(r,e),t.include(jl,e),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.UV0,"vec2");const s=new fr("waterColor",n=>n.color);if(e.output===k.Color&&e.isDraped)return t.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(w`
        void main(void) {
          if (waterColor.a < ${w.float(sa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(w`void main() {
gl_FragColor = waterColor;
}`),t;switch(e.output!==k.Color&&e.output!==k.Alpha||(t.include(LM,e),t.include(LC,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(sa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===k.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(ju,e),e.output){case k.Alpha:t.include(Ks,e),i.uniforms.add(s),i.code.add(w`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case k.Color:t.include(h4,e),t.include(qZ,{pbrMode:ht.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(Tae),t.include(Ks,e),t.include(lx,e),t.include($2e,e),i.uniforms.add([s,new Pe("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")]),Fp(i,e),i.include(Nm),Py(i),Dm(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?w`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===xt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case k.Normal:t.include(LM,e),t.include(Tae,e),t.include(Ks,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(w`
        void main(void) {
          if (waterColor.a < ${w.float(sa)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Pe("timeElapsed",n=>n.timeElapsed)),i.code.add(w`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case k.Highlight:t.include(Uy,e),t.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(sa)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(Ks,e),i.code.add(w`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const _nt=Object.freeze(Object.defineProperty({__proto__:null,build:ynt},Symbol.toStringTag,{value:"Module"}));class IU extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2,r.spherical=t.viewingMode===Ge.Global,r.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new Nr(t.rctx,IU.shader.get().build(this.configuration),Or)}_setPipelineState(t){const r=this.configuration,i=t===xt.NONE,s=t===xt.FrontFace;return Vt({blending:r.output!==k.Normal&&r.output!==k.Highlight&&r.transparent?i?Fu:ky(t):null,depthTest:{func:zv(t)},depthWrite:i?r.writeDepth?Jl:null:_U(t),colorWrite:Qt,polygonOffset:i||s?null:wU(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}IU.shader=new Dr(_nt,()=>ie(()=>import("./WaterSurface.glsl.247953fb.js"),[]));class Po extends ao{constructor(){super(...arguments),this.output=k.Color,this.transparencyPassType=xt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([B({count:k.COUNT})],Po.prototype,"output",void 0),u([B({count:xt.COUNT})],Po.prototype,"transparencyPassType",void 0),u([B()],Po.prototype,"spherical",void 0),u([B()],Po.prototype,"receiveShadows",void 0),u([B()],Po.prototype,"hasSlicePlane",void 0),u([B()],Po.prototype,"transparent",void 0),u([B()],Po.prototype,"enableOffset",void 0),u([B()],Po.prototype,"writeDepth",void 0),u([B()],Po.prototype,"hasScreenSpaceReflections",void 0),u([B()],Po.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],Po.prototype,"hasCloudsReflections",void 0),u([B()],Po.prototype,"isDraped",void 0),u([B()],Po.prototype,"hasMultipassTerrain",void 0),u([B()],Po.prototype,"cullAboveGround",void 0),u([B({constValue:ht.Water})],Po.prototype,"pbrMode",void 0),u([B({constValue:!0})],Po.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!0})],Po.prototype,"highStepCount",void 0),u([B({constValue:!1})],Po.prototype,"useFillLights",void 0);class vnt extends Vv{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const r=v(t.cloudsFade.data);r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(t){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(t)}beginSlot(t){return this._output===k.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(IU,t)}}class L2e extends yQ{constructor(t){super(t,new D2e),this._configuration=new Po,this.animation=new hwe}getConfiguration(t,r){return this._configuration.output=t,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<vU,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(t){const r=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<bnt;const i=this.animation.advance(t);return this.setParameters({timeElapsed:IW(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(t,r){switch(r){case k.Normal:return t===Se.DRAPED_WATER;case k.Color:if(this.parameters.isDraped)return t===Se.DRAPED_MATERIAL;break;case k.Alpha:break;case k.Highlight:return t===Se.OPAQUE_MATERIAL||t===Se.DRAPED_MATERIAL;default:return!1}let i=Se.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===i}createGLMaterial(t){return new vnt(t)}createBufferWriter(){return new zC(ant)}}class D2e extends VC{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Ur(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Ht(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const bnt=35e3;class vQ{constructor(t=0,r=0){this.from=t,this.to=r}get numElements(){return this.to-this.from}}function Sae(e){const t=new Map;e.forAll(i=>t.set(i.from,i));let r=!0;for(;r;)r=!1,e.forEach(i=>{const s=t.get(i.to);s&&(i.to=s.to,t.delete(s.from),e.removeUnordered(s),r=!0)})}class Eae extends vQ{constructor(t,r,i){super(r,i),this.geometry=t}get isVisible(){return this.geometry.visible}get hasHighlights(){return v(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return v(this.geometry.occludees)}}class wnt{constructor(){this.first=0,this.count=0}}class xnt{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Jt({allocator:t=>t||new vQ,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=Z$(),this.drawCommandsHighlight=Z$(),this.drawCommandsOccludees=Z$(),this.drawCommandsShadowHighlightRest=Z$()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(t,r){this.deleteInstance(t),this._instances.set(t,r),this._numElements+=r.numElements}deleteInstance(t){const r=this._instances.get(t);r&&(this._numElements-=r.numElements,this._instances.delete(t))}updateInstance(t,r,i){const s=this._instances.get(t);s&&(this._numElements-=s.numElements,s.from=r,s.to=i,this._numElements+=s.numElements)}updateDrawState(t){t.isVisible?(t.hasHighlights&&(this.hasHighlights=!0),t.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(t){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),s=this.holes.front();return v(this.vao)&&this.holes.length===1&&s.to===Math.floor(this.vao.size/t)?(i.first=0,void(i.count=s.from)):(i.first=1/0,i.count=0,this._instances.forEach(n=>{i.first=Math.min(i.first,n.from),i.count=Math.max(i.count,n.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,s)=>i.from===s.from?i.to-s.to:i.from-s.from);for(const i of r)i.isVisible&&(Cae(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),Cae(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function Tnt(e){return v(e.vao)}function Z$(){return new Jt({allocator:e=>e||new wnt,deallocator:e=>e})}function Cae(e,t){const r=e.back();if(r==null){const i=e.pushNew();return i.first=t.from,void(i.count=t.numElements)}if(Snt(r,t)){const i=t.from-r.first+t.numElements;r.count=i}else{const i=e.pushNew();i.first=t.from,i.count=t.numElements}}function Snt(e,t){return e.first+e.count>=t.from}class Ent{constructor(t){this.origin=t,this.buffers=new Array}dispose(){this.buffers.forEach(t=>t.vao.dispose()),this.buffers.length=0}findBuffer(t){return this.buffers.find(r=>r.instances.has(t))}}const Cnt=$D+1;class Ant{constructor(t,r,i){this._rctx=t,this._locations=r,this._layout=i,this._cache=t.newCache(`VaoCache ${Lc()}`,Rnt)}dispose(){this._cache.destroy()}newVao(t){const r=t.toString(),i=this._cache.pop(r);if(v(i)){const n=i.pop();return i.length>0&&this._cache.put(r,i,t*i.length,Cnt),n}const s=new Bp(this._rctx,this._locations,{geometry:this._layout},{geometry:wr.createVertex(this._rctx,$r.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(t),s}deleteVao(t){if(E(t))return null;const r=t.size,i=r.toString(),s=this._cache.pop(i);return v(s)?(s.push(t),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[t],r,-1),null}}function Rnt(e,t){if(t===Bg.ALL)return void e.forEach(s=>s.dispose());const r=e.pop(),i=e.length*r.size;return r.dispose(),i}class N2e{constructor(t,r,i){this._rctx=t,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new A2e(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new Ant(t,i.vertexAttributeLocations,Hc(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new snt(this._rctx))}dispose(){var t;this._glMaterials.destroy(),this._dataByOrigin.forEach(r=>r.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(t=this._appleAmdDriverHelper)==null||t.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof L2e}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==us.Occlude}get numGeometries(){let t=0;return this._dataByOrigin.forEach(r=>t+=r.buffers.reduce((i,s)=>i+s.instances.size,0)),t}forEachGeometry(t){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(s=>t(s.geometry))))}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateDrawCommands()}_updateGeometries(t){var s;const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const n of t){const o=n.renderGeometry,a=(s=this._dataByOrigin.get(o.localOrigin.id))==null?void 0:s.findBuffer(o.id);if(E(a))return;const l=a.instances.get(o.id);if(n.updateType&(kn.GEOMETRY|kn.TRANSFORMATION)){const c=eL(r.elementCount(l.geometry.geometry)*i),h=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(o,h,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i)}n.updateType&(kn.HIGHLIGHT|kn.OCCLUDEE|kn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(t,r){var s;const i=new DC;for(const n of t){const o=n.localOrigin;if(E(o))continue;let a=i.get(o.id,null);E(a)&&(a=new Aae(o.vec3),i.set(o.id,null,a)),a.changes.push(n)}for(const n of r){const o=n.localOrigin;if(E(o))continue;const a=(s=this._dataByOrigin.get(o.id))==null?void 0:s.findBuffer(n.id);if(E(a))continue;let l=i.get(o.id,a);E(l)&&(l=new Aae(o.vec3),i.set(o.id,a,l)),l.changes.push(n)}return i}_addAndRemoveGeometries(t,r){const{_bufferWriter:i,_dataByOrigin:s}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(t,r);o.forEach((a,l)=>{const c=a.get(null),h=v(c)?c.changes:[];o.delete(l,null);let p=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),E(m))return void mt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),EO(p.buffers,m),void(p.buffers.length===0&&h.length===0&&s.delete(l));const y=m.numElements,_=m.vao.size/4,b=h.reduce((C,O)=>C+i.elementCount(O.geometry),0),x=f.changes.reduce((C,O)=>C+i.elementCount(O.geometry),0),T=Math.min((y+b-x)*n,K$),S=T>_;T>W4&&T<_/2?(f.changes.forEach(({id:C})=>m.deleteInstance(C)),m.instances.forEach(({geometry:C})=>h.push(C)),this._vaoCache.deleteVao(m.vao),EO(p.buffers,m)):S?this._applyAndRebuild(m,h,f):this._applyRemoves(m,f)}),h.length>0)for(E(p)&&(p=new Ent(c.origin),s.set(l,p)),p.buffers.forEach(f=>this._applyAdds(f,h));h.length>0;)p.buffers.push(this._applyAndRebuild(new xnt,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(t=>{t.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,ea(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(t,r,i){if(v(i))for(const y of i.changes)t.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(K$/o);let l=t.numElements;for(;r.length>0;){const y=r.pop(),_=s.elementCount(y.geometry);if(l+_>a&&l>0){r.push(y);break}l+=_;const b=new Eae(y,0,0);mt(t.instances.get(y.id)==null),t.addInstance(y.id,b)}const c=l*o,h=eL(c),p=s.vertexBufferLayout.createView(h.buffer);let f=0;t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,t.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,p,f);const b=f;f+=s.elementCount(y.geometry.geometry),t.updateInstance(_,b,f),t.updateDrawState(y)}),this._vaoCache.deleteVao(t.vao),t.vao=this._vaoCache.newVao(Oae(c)),t.vao.vertexBuffers.geometry.setSubData(h,0,0,f*o),t.holes.clear();const m=t.holes.pushNew();return m.from=f,m.to=Math.floor(t.vao.size/n),t.updateDrawCommands(n),t}_applyRemoves(t,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=t.instances.get(l);if(!c)continue;t.deleteInstance(l);const h=Qp.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const p=Qp.pushNew();p.from=c.from,p.to=c.to}Sae(Qp);const i=this._bufferWriter.vertexBufferLayout.stride/4,s=Qp.reduce((a,l)=>Math.max(a,l.numElements),0)*i,n=eL(s);n.fill(0,0,s);const o=t.vao.vertexBuffers.geometry;Qp.forAll(a=>o.setSubData(n,a.from*i,0,a.numElements*i)),t.holes.pushArray(Qp.data,Qp.length),Qp.forAll((a,l)=>Qp.data[l]=null),Qp.clear(),t.drawCommandsDirty=!0}_applyAdds(t,r){if(r.length===0)return;if(!Tnt(t))return void this._applyAndRebuild(t,r,null);const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=t.numElements,o=r.reduce((x,T)=>x+i.elementCount(T.geometry),0),a=Math.min((n+o)*s,K$),l=4*a;if(t.vao.size<Oae(K$-W4)&&l>t.vao.size)return void this._applyAndRebuild(t,r,null);Sae(t.holes);const c=new Array;for(const x of r){const T=i.elementCount(x.geometry),S=Ont(t.holes,T);c.push(S)}const h=t.vao.vertexBuffers.geometry;let p=0,f=0,m=0;const y=eL(a),_=i.vertexBufferLayout.createView(y.buffer);r.forEach((x,T)=>{const S=c[T];if(E(S))return;if(m!==S){const R=m-f;R>0&&h.setSubData(y,f*s,0,R*s),f=S,p=0}const C=i.elementCount(x.geometry);this._writeGeometry(x,_,p),p+=C,m=S+C;const O=new Eae(x,S,S+C);mt(t.instances.get(x.id)==null),t.addInstance(x.id,O),t.drawCommandsDirty=!0});const b=m-f;b>0&&h.setSubData(y,f*s,0,b*s),YAe(r,(x,T)=>E(c[T]))}_writeGeometry(t,r,i){const s=t.localOrigin.vec3;UXe(Rae,-s[0],-s[1],-s[2]);const n=ws(Mnt,Rae,t.transformation);ko(J$,n),kc(J$,J$),this._bufferWriter.write(n,J$,t.geometry,r,i)}updateAnimation(t){return this.material.update(t)}requiresSlot(t,r){return this.material.requiresSlot(t,r)}render(t,r){var c;if(!this.requiresSlot(r.slot,t))return!1;const i=t===k.Highlight||t===k.ShadowHighlight;if(i&&!this._hasHighlights)return!1;const s=t===k.ShadowExcludeHighlight,n=!(i||s),o=this._rctx;let a;const l=()=>{if(v(a))return a;const h=this._glMaterials.load(o,r.slot,t);return E(h)?null:(a=h.beginSlot(r),E(a)?null:(o.bindTechnique(a,this.material.parameters,r),a))};(c=this._appleAmdDriverHelper)==null||c.resetIndicesType();for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(i&&!p.hasHighlights)continue;const f=(i?p.drawCommandsHighlight:s&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,m=n&&p.drawCommandsOccludees||null;if((f==null?void 0:f.length)||(m==null?void 0:m.length)){const y=l();if(E(y))return!1;y.program.bindDraw(new aq(h.origin),r,this.material.parameters),y.ensureAttributeLocations(p.vao),o.bindVAO(p.vao),f!=null&&f.length&&(y.bindPipelineState(o,r.slot,!1),f.forAll(_=>o.drawArrays(y.primitiveType,_.first,_.count))),m!=null&&m.length&&(y.bindPipelineState(o,r.slot,!0),m.forAll(_=>o.drawArrays(y.primitiveType,_.first,_.count)))}}return v(a)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Aae{constructor(t){this.origin=t,this.changes=new Array}}function Ont(e,t){let r;if(!e.some(s=>!(s.numElements<t)&&(r=s,!0)))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}const Rae=Ie(),Mnt=Ie(),J$=Ie(),Qp=new Jt({allocator:e=>e||new vQ,deallocator:null}),W4=65536,Q$=4*W4,F2e=16777216,K$=F2e/4;let RV=new Float32Array(W4);function eL(e){return RV.length<e&&(RV=new Float32Array(e)),RV}function Oae(e){const t=4*e;return t<Q$?Q$:Math.max(Math.min(Math.ceil(1.5*t/Q$)*Q$,F2e),t)}let uu=class extends Te{constructor(e){super(e),this._pending=new Pnt,this._changes=new oq,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Jt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return ea(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=C2e(this._changes);let t=!1,r=!1,i=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new N2e(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,r=!0,i=!0),!o)return;const a=r||o.hasHighlights,l=i||o.hasWater;o.modify(s),r=r||a!==o.hasHighlights,i=i||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=ea(this._materialRenderers,s=>s.hasHighlights)),i&&(this._hasWater=ea(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const i=this._pending.empty;for(const s of r)this._pending.adds.add(s);i&&this.notifyChange("updating"),t===cs.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const s of e)i.has(s)?(this._pending.removed.add(s),i.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===cs.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=this._changes.updates.length===0;for(const i of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(i),s.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case kn.TRANSFORMATION:case kn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case kn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(r=>t=r.updateAnimation(e)||t),t}render(e){this._sortedMaterialRenderers.forAll(t=>{t.material.shouldRender(e)&&t.render(e.output,e.bindParameters)})}intersect(e,t,r,i,s){return this._geometries.forEach(n=>{if(i&&!i(n))return;this._intersectRenderGeometry(n,r,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,r,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,r,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push(t)}),this._sortedMaterialRenderers.sort((t,r)=>{const i=r.material.renderPriority-t.material.renderPriority;return i!==0?i:t.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,s,n){if(!e.visible)return;let o=0;i+=e.transformation[12],o=e.transformation[13],OV[0]=r[0]-i,OV[1]=r[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,OV,(a,l,c)=>{Int(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},t)}_notifyGraphicGeometryChanged(e){if(E(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const r of e){const i=r.graphicUid;v(i)&&i!==t&&(this.drapeSource.notifyGraphicGeometryChanged(i),t=i)}}_notifyGraphicVisibilityChanged(e){if(E(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const r of e){const i=r.graphicUid;v(i)&&i!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(i),t=i)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return E(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],uu.prototype,"drapeSource",void 0),u([d()],uu.prototype,"updating",null),u([d()],uu.prototype,"rctx",null),u([d()],uu.prototype,"rendererContext",void 0),u([d()],uu.prototype,"_materialRepository",null),u([d()],uu.prototype,"_localOriginFactory",null),u([d({readOnly:!0})],uu.prototype,"isEmpty",null),u([d()],uu.prototype,"_materialRenderers",void 0),u([d()],uu.prototype,"_geometries",void 0),uu=u([P("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],uu);class Pnt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function Int(e,t,r,i,s,n,o){const a=new tnt(n,o,t),l=c=>{c.set(ss.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Bo.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Bo.ALL){const c=gJ(s.ray);l(c),s.results.all.push(c)}}const OV=Ke(),MV=4;function $nt(){const e=new Lr,t=e.fragment;e.include(ud);const r=(MV+1)/2,i=1/(2*r*r);return t.include(Gu),t.uniforms.add([new Mt("depthMap",s=>s.depthTexture),new LP("tex",s=>s.colorTexture),new nM("blurSize",s=>s.blurSize),new Pe("projScale",(s,n)=>{const o=Ai(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new kr("nearFar",(s,n)=>n.camera.nearFar)]),t.code.add(w`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${w.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.code.add(w`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${w.int(MV)}; r <= ${w.int(MV)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),e}const Lnt=Object.freeze(Object.defineProperty({__proto__:null,build:$nt},Symbol.toStringTag,{value:"Module"}));class $U extends Br{initializeProgram(t){return new Nr(t.rctx,$U.shader.get().build(),Or)}initializePipeline(){return Vt({colorWrite:Qt})}}$U.shader=new Dr(Lnt,()=>ie(()=>import("./SSAOBlur.glsl.51c459be.js"),[]));const Dnt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function LU(e){e.fragment.uniforms.add(new fr("projInfo",(t,r)=>Nnt(r))),e.fragment.uniforms.add(new kr("zScale",(t,r)=>U2e(r))),e.fragment.code.add(w`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Nnt(e){const t=e.camera.projectionMatrix;return t[11]===0?ti(Mae,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):ti(Mae,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const Mae=sr();function U2e(e){return e.camera.projectionMatrix[11]===0?or(Pae,0,1):or(Pae,1,0)}const Pae=Ke(),Iae=16;function Fnt(){const e=new Lr,t=e.fragment;return e.include(ud),t.include(Gu),e.include(LU),t.uniforms.add(new Pe("radius",(r,i)=>bQ(i.camera))),t.code.add(w`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),t.code.add(w`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.uniforms.add([new kr("nearFar",(r,i)=>i.camera.nearFar),new Mt("normalMap",r=>r.normalTexture),new Mt("depthMap",r=>r.depthTexture),new kr("zScale",(r,i)=>U2e(i)),new Pe("projScale",r=>r.projScale),new Mt("rnm",r=>r.noiseTexture),new kr("rnmScale",(r,i)=>or($ae,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Pe("intensity",r=>r.intensity),new kr("screenSize",(r,i)=>or($ae,i.camera.fullWidth,i.camera.fullHeight))]),t.code.add(w`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${w.int(Iae)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${w.int(Iae)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),e}function bQ(e){return Math.max(10,20*e.computeRenderPixelSizeAtDist(Math.abs(4*e.relativeElevation)))}const $ae=Ke(),Unt=Object.freeze(Object.defineProperty({__proto__:null,build:Fnt,getRadius:bQ},Symbol.toStringTag,{value:"Module"}));class DU extends Br{initializeProgram(t){return new Nr(t.rctx,DU.shader.get().build(),Or)}initializePipeline(){return Vt({colorWrite:Qt})}}DU.shader=new Dr(Unt,()=>ie(()=>import("./SSAO.glsl.8b608132.js"),[]));class knt extends gi{constructor(){super(...arguments),this.projScale=1}}class Vnt extends knt{constructor(){super(...arguments),this.intensity=1}}class Bnt extends gi{}class znt extends Bnt{constructor(){super(...arguments),this.blurSize=Ke()}}const p3=2;class k2e{constructor(t,r,i,s){this._view=t,this._techniqueRepository=r,this._rctx=i,this._requestRender=s,this._quadVAO=null,this._passParameters=new Vnt,this._drawParameters=new znt}dispose(){this.enabled=!1,this._quadVAO=tt(this._quadVAO)}disposeOffscreenBuffers(){ho(this._ssaoFBO,t=>t.resize(0,0)),ho(this._blur0FBO,t=>t.resize(0,0)),ho(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return v(this._enableTime)}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){return v(this._blur1FBO)?this._blur1FBO.colorTexture:null}render(t,r,i,s){if(E(this._enableTime)||E(i)||E(s)||E(this._ssaoFBO)||E(this._blur0FBO)||E(this._blur1FBO))return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const n=this._rctx,o=t.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=s,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*Gnt/bQ(o)**6*l;const c=o.fullViewport,h=c[2],p=c[3],f=h/p3,m=p/p3;this._ssaoFBO.resize(h,p),this._blur0FBO.resize(f,m),this._blur1FBO.resize(f,m),E(this._quadVAO)&&(this._quadVAO=La(this._rctx)),n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,h,p),n.bindTechnique(this._ssaoTechnique,this._passParameters,t).bindDraw(this._drawParameters,t,this._passParameters),n.bindVAO(this._quadVAO);const y=ra(this._quadVAO,"geometry");n.drawArrays(It.TRIANGLE_STRIP,0,y);const _=n.bindTechnique(this._blurTechnique,this._passParameters,t);n.setViewport(0,0,f,m),n.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,or(this._drawParameters.blurSize,0,p3/p),_.bindDraw(this._drawParameters,t,this._passParameters),n.setViewport(0,0,f,m),n.drawArrays(It.TRIANGLE_STRIP,0,y),n.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,or(this._drawParameters.blurSize,p3/h,0),_.bindDraw(this._drawParameters,t,this._passParameters),n.drawArrays(It.TRIANGLE_STRIP,0,y),n.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(v(this._enableTime))return;const t={target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.LINEAR,wrapMode:Rt.CLAMP_TO_EDGE,width:0,height:0},r={colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE};this._ssaoFBO=new Li(this._rctx,r,t),this._blur0FBO=new Li(this._rctx,r,t),this._blur1FBO=new Li(this._rctx,r,t);const i=Uint8Array.from(atob(Dnt),s=>s.charCodeAt(0));this._passParameters.noiseTexture=new lt(this._rctx,{target:bt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:$t.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},i),E(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(DU)),E(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire($U)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=tt(this._passParameters.noiseTexture),this._blur1FBO=tt(this._blur1FBO),this._blur0FBO=tt(this._blur0FBO),this._ssaoFBO=tt(this._ssaoFBO)}get gpuMemoryUsage(){return(v(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(v(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(v(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const Gnt=.5;class ZP extends Br{initializeProgram(t){return new Nr(t.rctx,ZP.shader.get().build(),Or)}initializePipeline(){return this.configuration.hasAlpha?Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:Qt}):Vt({colorWrite:Qt})}}ZP.shader=new Dr(gtt,()=>ie(()=>import("./TextureOnly.glsl.e903e64b.js"),[]));class wQ extends $a{constructor(){super(...arguments),this.hasAlpha=!1}}u([B()],wQ.prototype,"hasAlpha",void 0);let zd=class extends Te{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Jr,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Jt,this._passParameters=new XJ,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new Ct,this.worldToPCSRatio=1,this.events=new Vs,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new h2e(e.renderingContext),this._shaderTechniqueRepository=new n2e({rctx:this._rctx,viewingMode:Ge.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new S2e(this._rctx,new gQ(this._rctx,this.view.state.viewingMode),new k2e(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([se(()=>t.updating,()=>this.events.emit("content-changed"),Ys),se(()=>this.spatialReference,r=>this._localOriginFactory=new mQ(r),Ys),dn(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new o2e(e.textureRepository,this._shaderTechniqueRepository,r=>{(r.renderOccluded&X4)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Se.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=Abe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=xt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new eJ(Le(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(gt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Wi(this._debugTextureTechnique),this._passParameters.texture=tt(this._passParameters.texture),this._bindParameters.highlightDepthTexture=tt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Ve(this._shaderTechniqueRepository),this._temporaryFBO=tt(this._temporaryFBO),this._quadVAO=tt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||ea(this._renderers,e=>e.updating)}get hasOverlays(){return v(this._overlays)&&v(this._overlayRenderTarget)}get gpuMemoryUsage(){return v(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,uu)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);v(i)&&i.destroy();const s=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(se(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(E(e))return;const t=this._renderers.get(e);E(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(v(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const[i,s]=this.overlays,n=i.validTargets[r.type]||!s.validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(n,r,e)||t}return t}get overlays(){return Pt(this._overlays,[])}ensureDrapeTargets(e){v(this._overlays)&&this._overlays.forEach(t=>t.hasTargetWithoutRasterImage=tD(e,r=>r.drapeTargetType===sq.WithoutRasterImage))}ensureDrapeSources(e){v(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=tD(e,r=>r.drapeSourceType===cO.Features),t.hasDrapedRasterSource=tD(e,r=>r.drapeSourceType===cO.RasterImage)})}ensureOverlays(e,t){E(this._overlays)&&(this._overlayRenderTarget=new hst(this._rctx),this._overlays=[new sae(is.INNER,this._overlayRenderTarget),new sae(is.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=tt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,t){let r=!1;for(const[i,s]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(v(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Ka,e=>e.updatePolicy===nv.SYNC)}get isEmpty(){return!Xr.OVERLAY_DRAW_DEBUG_TEXTURE&&!ea(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._renderers.forEach(r=>t=r.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,r){const i=e.canvasGeometries;if(i.numViews===0)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const s=t.output;if(this.isEmpty||s===k.Highlight&&!this.hasHighlights||s===k.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*r,this._renderContext.output=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===k.Normal?Se.DRAPED_WATER:Se.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===is.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(Vi.COLOR_BUFFER_BIT)),t.type===vs.Occluded&&(this._renderContext.renderOccludedMask=X4),Xr.OVERLAY_DRAW_DEBUG_TEXTURE&&t.type!==vs.Occluded)for(let c=0;c<i.numViews;c++)this._setViewParameters(i.extents[c],e),this._drawDebugTexture(e.resolution,Hnt[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:c,renderer:h})=>{if(t.type===vs.ColorNoRasterImage&&c.drapeSourceType===cO.RasterImage)return;const{fullOpacity:p}=c,f=v(p)&&p<1&&s===k.Color;f&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(Vi.COLOR_BUFFER_BIT));for(let m=0;m<i.numViews;m++)this._setViewParameters(i.extents[m],e),h.render(this._renderContext);f&&v(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),p,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){E(this._temporaryFBO)&&(this._temporaryFBO=new s2e(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){var n,o;let s=0;for(const a of this._renderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,r,i,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((t,r)=>{var o;const i=e.indexOf(r.layer),s=i>=0,n=this._renderers.size*((o=r.renderGroup)!=null?o:s?G4.MapLayer:G4.ViewLayer)+(s?i:0);this._sortedRenderers.push(new jnt(r,t,n))}),this._sortedRenderers.sort((t,r)=>t.index-r.index)}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],Ume(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),t6(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=ea(this._renderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=ea(this._renderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=ea(this._renderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e,t);const r=this._rctx;r.bindTechnique(this._debugTextureTechnique,this._passParameters,null),r.bindVAO(this._quadVAO),r.drawArrays(It.TRIANGLE_STRIP,0,ra(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t,r){if(ce(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*t*4);let s=0;for(let o=0;o<t;o++)for(let a=0;a<e;a++){const l=Math.floor(a/10),c=Math.floor(o/10);l<2||c<2||10*l>e-20||10*c>t-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&l&&1&c?1&a^1&o?0:255:1&l^1&c?0:128)}this._passParameters.texture=new lt(this._rctx,{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,width:e,height:t},i);const n=new wQ;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(ZP,n),this._quadVAO=La(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};u([d()],zd.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([d({autoDestroy:!0})],zd.prototype,"_shaderTechniqueRepository",void 0),u([d({autoDestroy:!0})],zd.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],zd.prototype,"view",void 0),u([d()],zd.prototype,"worldToPCSRatio",void 0),u([d()],zd.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],zd.prototype,"updating",null),u([d()],zd.prototype,"isEmpty",null),zd=u([P("esri.views.3d.terrain.OverlayRenderer")],zd);class jnt{constructor(t,r,i){this.drapeSource=t,this.renderer=r,this.index=i}}const Hnt=[[1,.5,.5],[.5,.5,1]],xQ=-2,X4=us.OccludeAndTransparent;function TQ(e,t,r,i){const s=WP(e.rings,!!e.hasZ,Am.CCW_IS_HOLE),n=Bc(s.position.length),o=LTe(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,r,i),a=o!=null;return new Xnt(s.position,n,z2e(s.polygons,s.position,n),B2e(s.outlines,s.position,n),a,o)}function V2e(e,t){const r=WP(e.rings,!1,Am.CCW_IS_HOLE),i=Ts(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=xQ;return{position:r.position,polygons:z2e(r.polygons,r.position),outlines:B2e(r.outlines,r.position),projectionSuccess:i}}function B2e(e,t,r=null){return e.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=3*s;return v(r)?new G2e(i,s,qh(t,n,o),qh(r,n,o)):new SQ(i,s,qh(t,n,o))})}function z2e(e,t,r=null){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=3*n,h=o.map(f=>f-s),p=v(r)?new qnt(s,n,qh(t,3*s,3*n),qh(r,l,c),h,a):new Wnt(s,n,qh(t,3*s,3*n),h,a);i.push(p)}return i}class SQ{constructor(t,r,i){this.index=t,this.count=r,this.position=i}}class G2e extends SQ{constructor(t,r,i,s){super(t,r,i),this.mapPositions=s}}class qnt extends G2e{constructor(t,r,i,s,n,o){super(t,r,i,s),this.holeIndices=n,this.pathLengths=o}}class Wnt extends SQ{constructor(t,r,i,s,n){super(t,r,i),this.holeIndices=s,this.pathLengths=n}}class Xnt{constructor(t,r,i,s,n,o){this.position=t,this.mapPositions=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}}function j2e(e,t){const r=e.fragment;switch(r.code.add(w`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case fs.None:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case fs.View:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case fs.WindingOrder:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case fs.COUNT:}}var fs;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(fs||(fs={}));function H2e(e){e.vertex.code.add(w`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}class Ynt extends $a{constructor(){super(...arguments),this.instancedDoublePrecision=!1}}function q2e(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(A.MODELORIGINHI,"vec3"),e.attributes.add(A.MODELORIGINLO,"vec3"),e.attributes.add(A.MODEL,"mat3"),e.attributes.add(A.MODELNORMAL,"mat3"));const r=e.vertex;t.instancedDoublePrecision&&(r.include(_4,t),r.uniforms.add(new Nu("viewOriginHi",(i,s)=>jXe(ce(tL,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),tL))),r.uniforms.add(new Nu("viewOriginLo",(i,s)=>HXe(ce(tL,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),tL)))),r.code.add(w`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(w`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?w`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(w`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===k.Normal&&(KE(r),r.code.add(w`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&r.code.add(w`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([B()],Ynt.prototype,"instancedDoublePrecision",void 0);const tL=M();var Sn;function Znt(e){switch(e){case"multiply":default:return Sn.Multiply;case"ignore":return Sn.Ignore;case"replace":return Sn.Replace;case"tint":return Sn.Tint}}function W2e(e,t,r){if(E(e)||t===Sn.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=ye(Math.round(e[3]*Y4),0,Y4),s=i===0||t===Sn.Tint?0:t===Sn.Replace?Jnt:Qnt;r[0]=ye(Math.round(e[0]*cT),0,cT),r[1]=ye(Math.round(e[1]*cT),0,cT),r[2]=ye(Math.round(e[2]*cT),0,cT),r[3]=i+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(Sn||(Sn={}));const cT=255,Y4=85,Jnt=Y4,Qnt=2*Y4;function X2e(e){e.vertex.code.add(w`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${w.int(Sn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${w.int(Sn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${w.int(Sn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${w.int(Sn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function Y2e(e,t){t.hasSymbolColors?(e.include(X2e),e.attributes.add(A.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(w`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new YP("colorMixMode",r=>Hxe[r.colorMixMode])),e.vertex.code.add(w`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Mx(e,t){t.hasVertexColors?(e.attributes.add(A.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(w`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(w`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(w`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Knt(e){e.fragment.code.add(w`
    #define discardOrAdjustAlpha(color) { if (color.a < ${w.float(sa)}) { discard; } }
  `)}class vw extends Es{constructor(t,r){super(t,"float",fi.Draw,(i,s,n)=>i.setUniform1f(t,r(s,n)))}}function bw(e,t){Z2e(e,t,new Pe("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function eot(e,t){Z2e(e,t,new vw("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function Z2e(e,t,r){const i=e.fragment;switch(t.alphaDiscardMode!==di.Mask&&t.alphaDiscardMode!==di.MaskBlend||i.uniforms.add(r),t.alphaDiscardMode){case di.Blend:return e.include(Knt);case di.Opaque:i.code.add(w`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case di.Mask:i.code.add(w`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case di.MaskBlend:e.fragment.code.add(w`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function J2e(e,t){const{vertex:r,fragment:i}=e,s=t.hasModelTransformation;s&&r.uniforms.add(new Yi("model",o=>v(o.modelTransformation)?o.modelTransformation:Bu));const n=t.hasColorTexture&&t.alphaDiscardMode!==di.Opaque;switch(t.output){case k.Depth:case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:case k.ObjectAndLayerIdColor:Nc(r,t),e.include(jl,t),e.include(um,t),e.include(zS,t),e.include(Sy,t),e.include(Ks,t),e.include(gU,t),Yw(e),e.varyings.add("depth","float"),n&&i.uniforms.add(new Mt("tex",o=>o.texture)),r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),e.include(bw,t),i.code.add(w`
          void main(void) {
            discardBySlice(vpos);
            ${n?w`
                    vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${t.output===k.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:w`outputDepth(depth);`}
          }
        `);break;case k.Normal:Nc(r,t),e.include(jl,t),e.include(XP,t),e.include(MU,t),e.include(um,t),e.include(zS,t),n&&i.uniforms.add(new Mt("tex",o=>o.texture)),e.varyings.add("vPositionView","vec3"),r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${t.normalType===oi.Attribute?w`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),e.include(Ks,t),e.include(bw,t),i.code.add(w`
          void main() {
            discardBySlice(vpos);
            ${n?w`
                    vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${t.normalType===oi.ScreenDerivative?w`
                vec3 normal = screenDerivativeNormal(vPositionView);`:w`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case k.Highlight:Nc(r,t),e.include(jl,t),e.include(um,t),e.include(zS,t),n&&i.uniforms.add(new Mt("tex",o=>o.texture)),r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),e.include(Ks,t),e.include(bw,t),e.include(Uy,t),i.code.add(w`
          void main() {
            discardBySlice(vpos);
            ${n?w`
                    vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function Q2e(e,t){const r=e.fragment;if(t.hasVertexTangents?(e.attributes.add(A.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===fs.WindingOrder?r.code.add(w`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(w`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(w`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==Js.None){e.include(GZ,t);const i=t.supportsTextureAtlas?t.hasWebGL2Context?ei.None:ei.Size:ei.None;r.uniforms.add(t.pbrTextureBindType===fi.Pass?Tp("normalTexture",s=>s.textureNormal,i):iv("normalTexture",s=>s.textureNormal,i)),r.code.add(w`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?w`vtc.size = ${Hh(t,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function JP(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add(Tp("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture,t.hasWebGL2Context?ei.None:ei.InvSize)),r.constants.add("blurSizePixelsInverse","float",1/p3),r.code.add(w`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${Hh(t,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):r.code.add(w`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function QP(e){e.constants.add("ambientBoostFactor","float",Kbe)}function GC(e){e.uniforms.add(new Pe("lightingGlobalFactor",(t,r)=>r.lighting.globalFactor))}function cx(e,t){const r=e.fragment;switch(e.include(JP,t),t.pbrMode!==ht.Disabled&&e.include(_Q,t),e.include(qZ,t),e.include(DP),r.code.add(w`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===ht.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),QP(r),GC(r),Py(r),r.code.add(w`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?w`normalize(vPosWorld)`:w`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Dm(r),r.code.add(w`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),t.pbrMode){case ht.Disabled:case ht.WaterOnIntegratedMesh:case ht.Water:e.include(h4,t),r.code.add(w`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case ht.Normal:case ht.Schematic:r.code.add(w`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(w`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?r.uniforms.add(new ny("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(w`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add([new Pe("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new Pe("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)]),r.code.add(w`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(w`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===ht.Schematic?w`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:w`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case ht.Terrain:case ht.TerrainWithWater:e.include(h4,t),r.code.add(w`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:t.pbrMode;case ht.COUNT:}}function Wl(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function K2e(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function SN(e,t,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function tot(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:K2e,create:Wl,createView:tot,fromValues:SN},Symbol.toStringTag,{value:"Module"}));function rot(e){e.vertex.uniforms.add(new Fm("colorTextureTransformMatrix",t=>v(t.colorTextureTransformMatrix)?t.colorTextureTransformMatrix:Wl())),e.varyings.add("colorUV","vec2"),e.vertex.code.add(w`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function iot(e){e.vertex.uniforms.add(new Fm("normalTextureTransformMatrix",t=>v(t.normalTextureTransformMatrix)?t.normalTextureTransformMatrix:Wl())),e.varyings.add("normalUV","vec2"),e.vertex.code.add(w`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function sot(e){e.vertex.uniforms.add(new Fm("emissiveTextureTransformMatrix",t=>v(t.emissiveTextureTransformMatrix)?t.emissiveTextureTransformMatrix:Wl())),e.varyings.add("emissiveUV","vec2"),e.vertex.code.add(w`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function not(e){e.vertex.uniforms.add(new Fm("occlusionTextureTransformMatrix",t=>v(t.occlusionTextureTransformMatrix)?t.occlusionTextureTransformMatrix:Wl())),e.varyings.add("occlusionUV","vec2"),e.vertex.code.add(w`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function oot(e){e.vertex.uniforms.add(new Fm("metallicRoughnessTextureTransformMatrix",t=>v(t.metallicRoughnessTextureTransformMatrix)?t.metallicRoughnessTextureTransformMatrix:Wl())),e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.code.add(w`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function DM(e){e.include(Nm),e.code.add(w`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${w.int(Sn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${w.int(Sn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.int(Sn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${w.int(Sn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.int(Sn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function aot(e){const t=new Lr,{vertex:r,fragment:i,varyings:s}=t;return Nc(r,e),t.include(NP),s.add("vpos","vec3"),t.include(zS,e),t.include(q2e,e),t.include(Nxe,e),e.hasColorTextureTransform&&t.include(rot),e.output!==k.Color&&e.output!==k.Alpha||(e.hasNormalTextureTransform&&t.include(iot),e.hasEmissionTextureTransform&&t.include(sot),e.hasOcclusionTextureTransform&&t.include(not),e.hasMetallicRoughnessTextureTransform&&t.include(oot),Fp(r,e),t.include(XP,e),t.include(jl,e),e.normalType===oi.Attribute&&e.offsetBackfaces&&t.include(H2e),t.include(Q2e,e),t.include(MU,e),e.instancedColor&&t.attributes.add(A.INSTANCECOLOR,"vec4"),s.add("localvpos","vec3"),t.include(um,e),t.include(LC,e),t.include(Y2e,e),t.include(Mx,e),r.uniforms.add(new fr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),e.hasMultipassTerrain&&s.add("depth","float"),e.hasModelTransformation&&r.uniforms.add(new Yi("model",n=>v(n.modelTransformation)?n.modelTransformation:Bu)),r.code.add(w`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${w.float(sa)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===oi.Attribute?w`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===oi.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${e.hasColorTextureTransform?w`forwardColorUV();`:""}
        ${e.hasNormalTextureTransform?w`forwardNormalUV();`:""}
        ${e.hasEmissionTextureTransform?w`forwardEmissiveUV();`:""}
        ${e.hasOcclusionTextureTransform?w`forwardOcclusionUV();`:""}
        ${e.hasMetallicRoughnessTextureTransform?w`forwardMetallicRoughnessUV();`:""}
      }
    `)),e.output===k.Alpha&&(t.include(Ks,e),t.include(bw,e),t.include(ju,e),i.uniforms.add([new Pe("opacity",n=>n.opacity),new Pe("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&i.uniforms.add(new Mt("tex",n=>n.texture)),i.include(DM),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?w`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?w`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===k.Color&&(t.include(Ks,e),t.include(cx,e),t.include(JP,e),t.include(bw,e),t.include(e.instancedDoublePrecision?PU:lx,e),t.include(ju,e),Fp(i,e),i.uniforms.add([r.uniforms.get("localOrigin"),new qt("ambient",n=>n.ambient),new qt("diffuse",n=>n.diffuse),new Pe("opacity",n=>n.opacity),new Pe("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&i.uniforms.add(new Mt("tex",n=>n.texture)),t.include(HZ,e),t.include(_Q,e),i.include(DM),t.include(j2e,e),QP(i),GC(i),Dm(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?w`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===oi.ScreenDerivative?w`
                vec3 normal = screenDerivativeNormal(localvpos);`:w`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===ht.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${e.receiveShadows?"readShadowMap(vpos, linearDepth)":e.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?w`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?w`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:w`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?w`normalize(posWorld);`:w`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?w`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===ht.Normal||e.pbrMode===ht.Schematic?w`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?w`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:w`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===xt.Color?w`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(J2e,e),t}const lot=Object.freeze(Object.defineProperty({__proto__:null,build:aot},Symbol.toStringTag,{value:"Module"}));class cot extends R2e{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Le(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Oi.Back,this.emissiveFactor=Le(0,0,0),this.instancedDoublePrecision=!1,this.normalType=oi.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Le(.2,.2,.2),this.diffuse=Le(.8,.8,.8),this.externalColor=Ht(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=M(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=ns(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Hw.Less,this.textureAlphaMode=di.Blend,this.textureAlphaCutoff=V4,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=us.Occlude}}class uot extends O2e{constructor(){super(...arguments),this.origin=M(),this.slicePlaneLocalOrigin=this.origin}}class KP extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2,r.spherical=t.viewingMode===Ge.Global,r.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?Js.Default:Js.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(t){return this._initializeProgram(t,KP.shader)}_initializeProgram(t,r){return new Nr(t.rctx,r.get().build(this.configuration),Or)}_convertDepthTestFunction(t){return t===Hw.Lequal?Ni.LEQUAL:Ni.LESS}_makePipeline(t,r){const i=this.configuration,s=t===xt.NONE,n=t===xt.FrontFace;return Vt({blending:i.output!==k.Color&&i.output!==k.Alpha||!i.transparent?null:s?Fu:ky(t),culling:hot(i)?H6(i.cullFace):null,depthTest:{func:zv(t,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(s||n)&&i.writeDepth?Jl:null,colorWrite:Qt,stencilWrite:i.hasOccludees?Rm:null,stencilTest:i.hasOccludees?r?Mv:Gv:null,polygonOffset:s||n?null:wU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}function hot(e){return e.cullFace!==Oi.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}KP.shader=new Dr(lot,()=>ie(()=>import("./DefaultMaterial.glsl.bd8ca147.js"),[]));class Yt extends ao{constructor(){super(...arguments),this.output=k.Color,this.alphaDiscardMode=di.Opaque,this.doubleSidedMode=fs.None,this.pbrMode=ht.Disabled,this.cullFace=Oi.None,this.transparencyPassType=xt.NONE,this.normalType=oi.Attribute,this.textureCoordinateType=Js.None,this.customDepthTest=Hw.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}}u([B({count:k.COUNT})],Yt.prototype,"output",void 0),u([B({count:di.COUNT})],Yt.prototype,"alphaDiscardMode",void 0),u([B({count:fs.COUNT})],Yt.prototype,"doubleSidedMode",void 0),u([B({count:ht.COUNT})],Yt.prototype,"pbrMode",void 0),u([B({count:Oi.COUNT})],Yt.prototype,"cullFace",void 0),u([B({count:xt.COUNT})],Yt.prototype,"transparencyPassType",void 0),u([B({count:oi.COUNT})],Yt.prototype,"normalType",void 0),u([B({count:Js.COUNT})],Yt.prototype,"textureCoordinateType",void 0),u([B({count:Hw.COUNT})],Yt.prototype,"customDepthTest",void 0),u([B()],Yt.prototype,"spherical",void 0),u([B()],Yt.prototype,"hasVertexColors",void 0),u([B()],Yt.prototype,"hasSymbolColors",void 0),u([B()],Yt.prototype,"hasVerticalOffset",void 0),u([B()],Yt.prototype,"hasSlicePlane",void 0),u([B()],Yt.prototype,"hasSliceHighlight",void 0),u([B()],Yt.prototype,"hasColorTexture",void 0),u([B()],Yt.prototype,"hasMetallicRoughnessTexture",void 0),u([B()],Yt.prototype,"hasEmissionTexture",void 0),u([B()],Yt.prototype,"hasOcclusionTexture",void 0),u([B()],Yt.prototype,"hasNormalTexture",void 0),u([B()],Yt.prototype,"hasScreenSizePerspective",void 0),u([B()],Yt.prototype,"hasVertexTangents",void 0),u([B()],Yt.prototype,"hasOccludees",void 0),u([B()],Yt.prototype,"hasMultipassTerrain",void 0),u([B()],Yt.prototype,"hasModelTransformation",void 0),u([B()],Yt.prototype,"offsetBackfaces",void 0),u([B()],Yt.prototype,"vvSize",void 0),u([B()],Yt.prototype,"vvColor",void 0),u([B()],Yt.prototype,"receiveShadows",void 0),u([B()],Yt.prototype,"receiveAmbientOcclusion",void 0),u([B()],Yt.prototype,"textureAlphaPremultiplied",void 0),u([B()],Yt.prototype,"instanced",void 0),u([B()],Yt.prototype,"instancedColor",void 0),u([B()],Yt.prototype,"objectAndLayerIdColorInstanced",void 0),u([B()],Yt.prototype,"instancedDoublePrecision",void 0),u([B()],Yt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],Yt.prototype,"writeDepth",void 0),u([B()],Yt.prototype,"transparent",void 0),u([B()],Yt.prototype,"enableOffset",void 0),u([B()],Yt.prototype,"cullAboveGround",void 0),u([B()],Yt.prototype,"snowCover",void 0),u([B()],Yt.prototype,"hasColorTextureTransform",void 0),u([B()],Yt.prototype,"hasEmissionTextureTransform",void 0),u([B()],Yt.prototype,"hasNormalTextureTransform",void 0),u([B()],Yt.prototype,"hasOcclusionTextureTransform",void 0),u([B()],Yt.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([B({constValue:!0})],Yt.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],Yt.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],Yt.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!0})],Yt.prototype,"useFillLights",void 0);function dot(e){const t=new Lr,{vertex:r,fragment:i,varyings:s}=t;return Nc(r,e),t.include(NP),s.add("vpos","vec3"),t.include(zS,e),t.include(q2e,e),t.include(Nxe,e),e.output!==k.Color&&e.output!==k.Alpha||(Fp(t.vertex,e),t.include(XP,e),t.include(jl,e),e.offsetBackfaces&&t.include(H2e),e.instancedColor&&t.attributes.add(A.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),e.hasMultipassTerrain&&s.add("depth","float"),t.include(um,e),t.include(LC,e),t.include(Y2e,e),t.include(Mx,e),r.uniforms.add(new fr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(w`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${w.float(sa)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?w`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===k.Alpha&&(t.include(Ks,e),t.include(bw,e),t.include(ju,e),i.uniforms.add([new Pe("opacity",n=>n.opacity),new Pe("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&i.uniforms.add(new Mt("tex",n=>n.texture)),i.include(DM),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?w`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?w`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===k.Color&&(t.include(Ks,e),t.include(cx,e),t.include(JP,e),t.include(bw,e),t.include(e.instancedDoublePrecision?PU:lx,e),t.include(ju,e),Fp(t.fragment,e),Py(i),QP(i),GC(i),i.uniforms.add([r.uniforms.get("localOrigin"),r.uniforms.get("view"),new qt("ambient",n=>n.ambient),new qt("diffuse",n=>n.diffuse),new Pe("opacity",n=>n.opacity),new Pe("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&i.uniforms.add(new Mt("tex",n=>n.texture)),t.include(HZ,e),t.include(_Q,e),i.include(DM),t.extensions.add("GL_OES_standard_derivatives"),Dm(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?w`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===ht.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?w`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?w`albedo = mix(albedo, vec3(1), 0.9);`:w``}
        ${w`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${e.pbrMode===ht.Normal||e.pbrMode===ht.Schematic?e.spherical?w`vec3 normalGround = normalize(vpos + localOrigin);`:w`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:w``}
        ${e.pbrMode===ht.Normal||e.pbrMode===ht.Schematic?w`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?w`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:w`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===xt.Color?w`gl_FragColor = premultiplyAlpha(gl_FragColor);`:w``}
      }
    `)),t.include(J2e,e),t}const pot=Object.freeze(Object.defineProperty({__proto__:null,build:dot},Symbol.toStringTag,{value:"Module"}));class NU extends KP{initializeConfiguration(t,r){super.initializeConfiguration(t,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=oi.Attribute,r.doubleSidedMode=fs.WindingOrder,r.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,NU.shader)}}NU.shader=new Dr(pot,()=>ie(()=>import("./RealisticTree.glsl.9f8b5b23.js"),[]));class Ey extends Bv{constructor(t){super(t,got),this.supportsEdges=!0,this._configuration=new Yt,this._vertexBufferLayout=yot(this.parameters)}isVisibleForOutput(t){return t!==k.Shadow&&t!==k.ShadowExcludeHighlight&&t!==k.ShadowHighlight||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:r,hasVertexColors:i,hasSymbolColors:s,vvColorEnabled:n}=t,o=v(r)&&r.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return i&&(o||n||s)?!!a||l:i?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,r){return this._configuration.output=t,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,v(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Oi.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=v(this.parameters.modelTransformation),t!==k.Color&&t!==k.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=fs.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?fs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?fs.WindingOrder:fs.None,this._configuration.instancedColor=v(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?ht.Schematic:ht.Normal:ht.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<vU,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(t){return v(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,r,i,s,n,o){if(v(this.parameters.verticalOffset)){const a=i.camera;ce(IV,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case Ge.Global:l=ve(Lae,IV);break;case Ge.Local:l=le(Lae,bot)}let c=0;const h=ge(wot,IV,a.eye),p=Me(h),f=ae(h,h,1/p);let m=null;this.parameters.screenSizePerspective&&(m=_e(l,f)),c+=Gxe(a,p,this.parameters.verticalOffset,m!=null?m:0,this.parameters.screenSizePerspective),ae(l,l,c),Mc(PV,l,i.transform.inverseRotation),s=ge(_ot,s,PV),n=ge(vot,n,PV)}kxe(t,i,s,n,FH(i.verticalOffset),o)}requiresSlot(t,r){return r===k.Color||r===k.Alpha||r===k.Depth||r===k.Normal||r===k.Shadow||r===k.ShadowHighlight||r===k.ShadowExcludeHighlight||r===k.Highlight||r===k.ObjectAndLayerIdColor?t===(this.parameters.transparent?this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Se.OPAQUE_MATERIAL)||t===Se.DRAPED_MATERIAL:!1}createGLMaterial(t){return new fot(t)}createBufferWriter(){return new zC(this._vertexBufferLayout)}}class fot extends jZ{constructor(t){super({...t,...t.material.parameters})}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output!==k.Color&&this._output!==k.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t));const r=this._material.parameters;this.updateTexture(r.textureId);const i=t.camera.viewInverseTransposeMatrix;return ce(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?NU:KP,t)}}class mot extends cot{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const got=new mot;function yot(e){const t=os().vec3f(A.POSITION).vec3f(A.NORMAL),r=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId;return e.hasVertexTangents&&t.vec4f(A.TANGENT),r&&t.vec2f(A.UV0),e.hasVertexColors&&t.vec4u8(A.COLOR),e.hasSymbolColors&&t.vec4u8(A.SYMBOLCOLOR),de("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(A.OBJECTANDLAYERIDCOLOR),t}const _ot=M(),vot=M(),bot=Le(0,0,1),Lae=M(),PV=M(),IV=M(),wot=M(),xot=["polygon","extent"];class Tot extends km{constructor(t,r,i,s){super(t,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=TU(this._getSymbolSize());if(a)throw new j("graphics3dextrudesymbollayer:invalid-size",a)}const t=en(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t),i=kl(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?Oi.None:Oi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new Ey(o),this._bottomMaterial=new Ey({...o,cullFace:Oi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,xot,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(r,new qu);return this._createAs3DShape(r,t.renderingInfo,i,s,r.uid)}layerOpacityChanged(t,r){const i=en(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();t.forEach(a=>{const l=r(a);v(l)&&l.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Av)}slicePlaneEnabledChanged(t,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(i=>{const s=r(i);v(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getExtrusionSize(t){var i;let r;return r=t.size&&this._drivenProperties.size?(i=rst(t.size,2))!=null?i:0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(t,r){return this._drivenPropertiesChanged(r)?Rn.Recreate_Symbol:Rn.Recreate_Graphics}async queryForSnapping(t,r,i,s){var c,h,p;const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/Rw(r),{objectId:o,target:a}=t,l=re(a);switch(l.z=((c=l.z)!=null?c:0)+n,t.type){case"edge":{const{start:f,end:m}=t,y=re(f),_=re(m);return y.z=((h=y.z)!=null?h:0)+n,_.z=((p=_.z)!=null?p:0)+n,[tae(o,l,1/0,y,_)]}case"vertex":return[Kit(o,l,1/0),tae(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,r,i,s,n){const o=IM(t.geometry);if(E(o))return null;if(o.rings.length===0||!o.rings.some(Z=>Z.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=TQ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=eQ(o);if(E(l))return null;const c=new Array,h=In(),p=Ie(),f=M(),m=this._context.renderCoordsHelper.viewingMode===Ge.Global;m||this._context.renderCoordsHelper.worldUpAtPosition(null,f),$p(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const y=Ie();ko(y,p);const _=ns();kE(_,y);const{polygons:b,mapPositions:x,position:T}=a,S=T.length/3,C=new Float64Array(3*S*6),O=new Float64Array(3*S*6),R=new Float64Array(3*S*6),$=new Float64Array(1*S*6);let I=0;for(let Z=0;Z<b.length;++Z){const Q=b[Z],te=Q.count;if(this._context.clippingExtent&&($i(h),Pu(h,Q.mapPositions),!dp(h,this._context.clippingExtent)))continue;const q=Rv(Q.mapPositions,Q.holeIndices,3);if(q.length===0)continue;const L=3*te*2+q.length,N=new Array(L),F=new Array(q.length),H=6*te,X=3*C.BYTES_PER_ELEMENT,K=new yo(C.buffer,I*X,X,(I+H)*X),W=3*O.BYTES_PER_ELEMENT,ue=new yo(O.buffer,I*W,W,(I+H)*W),pe=new Float64Array(R.buffer,3*I*R.BYTES_PER_ELEMENT,3*H),we=new Float64Array($.buffer,1*I*$.BYTES_PER_ELEMENT,1*H),Ce=this._getExtrusionSize(r);Sot(T,x,q,Q,K.typedBuffer,pe,ue.typedBuffer,we,N,F,Ce,f,m),qP(K,K,y),Ov(ue,ue,_),I+=6*te;const qe=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),Ne=new Oot(K.typedBuffer,pe,ue.typedBuffer,we);c.push(Dae(this._material,N,N.length-F.length,Ne,i,qe)),c.push(Dae(this._bottomMaterial,F,0,Ne,i,qe))}if(c.length===0)return null;const U=new By({geometries:c,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});U.transformation=p;const V=WTe(this.symbolLayer,{opacity:this._getLayerOpacity()}),G=v(V)?{baseMaterial:this._material,edgeMaterials:[V],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,z=new Um(this,U,c,null,null,Aot,s,G);return z.alignedSampledElevation=a.sampledElevation,z.needsElevationUpdates=Av(s.mode),z}}function Dae(e,t,r,i,s,n){const o=new Array(t.length).fill(0),a=[[A.POSITION,new Je(i.positions,3,!0)],[A.NORMAL,new Je(i.normals,3,!0)],[A.COLOR,new Je(s,4,!0)],[A.SIZE,new Je(i.heights,1,!0)]],l=[[A.POSITION,t],[A.NORMAL,t],[A.COLOR,o]];return new tn(e,a,l,i.elevation,Fs.Mesh,n,r)}function Sot(e,t,r,i,s,n,o,a,l,c,h,p,f){const m=r.length/3;let y=0,_=2*i.count;Eot(e,t,i.index,i.count,r,0,m,s,n,o,a,l,c,_,h,p,f);let b=2*i.count;_=0,Nae(s,n,a,o,y,i.pathLengths[0],i.count,b,l,_,h),b+=4*i.pathLengths[0],_+=2*i.pathLengths[0],y+=i.pathLengths[0];for(let x=1;x<i.pathLengths.length;++x)Nae(s,n,a,o,y,i.pathLengths[x],i.count,b,l,_,h),b+=4*i.pathLengths[x],_+=2*i.pathLengths[x],y+=i.pathLengths[x]}function Eot(e,t,r,i,s,n,o,a,l,c,h,p,f,m,y,_,b){le(wl,_);const x=y>0?1:-1;let T=3*r,S=0,C=3*S,O=i,R=3*O;for(let U=0;U<i;++U)b&&(wl[0]=e[T+0],wl[1]=e[T+1],wl[2]=e[T+2],ve(wl,wl)),a[C+0]=e[T+0],a[C+1]=e[T+1],a[C+2]=e[T+2],l[C+0]=t[T+0],l[C+1]=t[T+1],l[C+2]=t[T+2],c[C+0]=-x*wl[0],c[C+1]=-x*wl[1],c[C+2]=-x*wl[2],h[S]=0,a[R+0]=e[T+0]+y*wl[0],a[R+1]=e[T+1]+y*wl[1],a[R+2]=e[T+2]+y*wl[2],l[R+0]=t[T+0],l[R+1]=t[T+1],l[R+2]=t[T+2],c[R+0]=x*wl[0],c[R+1]=x*wl[1],c[R+2]=x*wl[2],h[O]=y,C+=3,R+=3,T+=3,S+=1,O+=1;T=3*n,C=0,R=3*m;const $=y<0?zae:Bae,I=y<0?Bae:zae;for(let U=0;U<o;++U)f[C+0]=s[T+$[0]],f[C+1]=s[T+$[1]],f[C+2]=s[T+$[2]],p[R+0]=s[T+I[0]]+i,p[R+1]=s[T+I[1]]+i,p[R+2]=s[T+I[2]]+i,C+=3,R+=3,T+=3}function rL(e,t,r,i,s,n,o){i[n]=i[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],r[n+0]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const PA=M();function Nae(e,t,r,i,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,_=a,b=a+1,x=a+2*n,T=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let S=0;S<n;++S)S===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),Cot(e,p,f,m,PA),rL(e,t,i,r,PA,_,p),rL(e,t,i,r,PA,b,f),rL(e,t,i,r,PA,x,m),rL(e,t,i,r,PA,T,y),l[c++]=_,l[c++]=x,l[c++]=T,l[c++]=_,l[c++]=T,l[c++]=b,p++,f++,m++,y++,_+=2,b+=2,x+=2,T+=2}const $V=M(),Fae=M(),Uae=M(),kae=M(),Vae=M();function Cot(e,t,r,i,s){t*=3,r*=3,i*=3,ce($V,e[t++],e[t++],e[t++]),ce(Fae,e[r++],e[r++],e[r++]),ce(Uae,e[i++],e[i++],e[i++]),ge(kae,Fae,$V),ge(Vae,Uae,$V),dt(s,Vae,kae),ve(s,s)}const uT=M();function Aot(e,t,r,i,s){const n=e.stageObject,o=n.geometries,a=o.length,l=t.mode!=="absolute-height";let c=0;const h=n.transformation,p=vC(Ie(),h);for(let f=0;f<a;f+=2){const m=o[f];if(!rQ(m))continue;const y=m.getMutableAttribute(A.POSITION).data,_=m.vertexAttributes.get(A.SIZE).data,b=new sxe(m.mapPositions),x=y.length/3;let T=0,S=!1,C=0;for(let O=0;O<x;O++){uT[0]=y[T],uT[1]=y[T+1],uT[2]=y[T+2],i(b,iL),l&&(C+=iL.sampledElevation),Xr.TESTS_DISABLE_OPTIMIZATIONS?(ce(tc,b.array[b.offset+0],b.array[b.offset+1],iL.z+_[T/3]),v(r)&&s.toRenderCoords(tc,r,tc),Ze(tc,tc,p)):(ce(tc,y[T+0],y[T+1],y[T+2]),Ze(tc,tc,h),s.setAltitude(tc,iL.z+_[T/3]),Ze(tc,tc,p)),y[T]=tc[0],y[T+1]=tc[1],y[T+2]=tc[2];const R=Rot/s.unitInMeters;(Math.abs(uT[0]-y[T])>=R||Math.abs(uT[1]-y[T+1])>=R||Math.abs(uT[2]-y[T+2])>=R)&&(S=!0),b.offset+=3,T+=3}S&&(m.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[f]),o[f+1].invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o[f+1])),c+=C/x}return c/a}const tc=M(),wl=M(),iL=new HP,Bae=[0,2,1],zae=[0,1,2],Rot=.01;class Oot{constructor(t,r,i,s){this.positions=t,this.elevation=r,this.normals=i,this.heights=s}}function Mot(e,t,r,i,s){if(E(e))return null;const n=e.referencesGeometry()&&s?Pot(t,i,s):t,o=e.repurposeFeature(n);try{return e.evaluate({...r,$feature:o})}catch(a){return ee.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const LV=new Map;function Pot(e,t,r){const{transform:i,hasZ:s,hasM:n}=r;LV.has(t)||LV.set(t,Iot(t));const o=LV.get(t)(e.geometry,i,s,n);return{...e,geometry:o}}function Iot(e){const t={};switch(e){case"esriGeometryPoint":return(r,i,s,n)=>TTe(i,t,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>STe(i,t,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>ETe(i,t,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>xTe(i,t,r,s,n);default:return ee.getLogger("esri.views.2d.support.arcadeOnDemand").error(new j("mapview-arcade",`Unable to handle geometryType: ${e}`)),r=>r}}const uSt=1.2,$ot=am;class FU{constructor(t,r,i,s){this.graphics3DSymbolLayer=t,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,cs.ADD);if(t||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,kn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,cs.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=M()){return ce(t,0,0,0)}getBoundingBoxObjectSpace(t=In()){return $i(t)}addObjectState(t,r){t===by.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.geometry.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,kn.HIGHLIGHT))}removeObjectState(t){this.renderGeometries.forEach(r=>{t.removeRenderGeometry(r)})}removeRenderGeometryObjectState(t,r){t.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,kn.HIGHLIGHT)}computeAttachmentOrigin(t){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(hT)&&(t.draped.origin[0]+=hT[0],t.draped.origin[1]+=hT[1],t.draped.num++)}async getProjectedBoundingBox(t,r,i,s,n){$i(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,Gae,i),vPe(n,Gae)}if(r){let o;hp(n,hT);const a=tQ(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(hT[0],hT[1],s,a,"ground")}catch{}v(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,r,i,s){if(this.boundingBox)G5(Kp,this.boundingBox);else{const n=t.boundingSphere,o=n[3];Kp[0]=n[0]-o,Kp[1]=n[1]-o,Kp[2]=n[2]-o,Kp[3]=n[0]+o,Kp[4]=n[1]+o,Kp[5]=n[2]+o}return r(Kp,0,2),this.calculateRelativeScreenBounds&&s.push({location:hp(Kp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),bX(Kp,i)}}const Gae=ur(),Kp=In(),hT=M();class eSe{constructor(t,r,i,s=2048){this.text=t,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const t=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(t+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(E(this._metricsCached)){const t=lq(jae,sL,sL).getContext("2d");this._setFontProperties(t,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const b=t.measureText(y),x=b.width,T=x+r;this._textWidths.push(x),this._lineWidths.push(T),o=Math.max(o,T),a=Math.max(a,b.actualBoundingBoxAscent),l=Math.max(l,b.actualBoundingBoxDescent),_===0&&(s=b),_===this._lines.length-1&&(n=b)});const c=t.font;let h=qae.get(c);if(!h){const y=t.measureText(Dot);h=new Fot(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),qae.set(c,h)}a=Math.max(a,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const p=a+l,f=this._hasBackground?s.actualBoundingBoxAscent:a,m=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new Not(a-f,l-m,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*Lot}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(E(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case ov.Left:return this._backgroundHorizontalPadding;case ov.Center:return(this.displayWidth-this._lineWidths[t])/2;case ov.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[t]}}render(t,r=0,i=0){t.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,r+p,i),this._renderLineDecoration(t,r+p,i,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,r+this._getLineXOffset(c),i),this._renderLineDecoration(t,r+p,i,this._textWidths[c]),i+=this._lineSpacing}if(Xr.TEXT_SHOW_BASELINE){t.strokeStyle=Hae,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this._baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this._lineSpacing}}if(Xr.TEXT_SHOW_BORDER&&(t.strokeStyle=Hae,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),t.stroke()}_roundedRect(t,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=ye(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(r,i+s),t.arcTo(r,i,r+s,i,s),t.lineTo(r+n-s,i),t.arcTo(r+n,i,r+n,i+s,s),t.lineTo(r+n,i+o-s),t.arcTo(r+n,i+o,r+n-s,i+o,s),t.lineTo(r+s,i+o),t.arcTo(r,i+o,r,i+o-s,s),t.closePath()):t.rect(r,i,n,o)}_renderHalo(t,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=lq(jae,Math.max(o,sL),Math.max(a,sL)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this._lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),t.globalAlpha=1}_renderHaloEmulated(t,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of tSe)this._fillText(t,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(t,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(t,r){t.font=this._parameters.fontString(r),t.textAlign="left",t.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,r,i,s){t.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(t,r,i,s){t.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(t,r,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke()}_drawBox(t,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const tSe=[];for(let t=0;t<360;t+=360/16)tSe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var ov;function lq(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(ov||(ov={}));const jae={canvas:null},Lot=.2,sL=512,Hae="rgb(255, 0, 255, 0.5)",Dot=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})();class Not{constructor(t,r,i,s,n){this.paddingTop=t,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=s,this.baselinePosition=n}}class Fot{constructor(t,r){this.actualBoundingBoxAscent=t,this.actualBoundingBoxDescent=r}}const qae=new Map,Uot=Object.freeze({left:0,center:.5,right:1}),EN=Object.freeze({"bottom-left":Ur(0,0),bottom:Ur(.5,0),"bottom-right":Ur(1,0),left:Ur(0,.5),center:Ur(.5,.5),right:Ur(1,.5),"top-left":Ur(0,1),top:Ur(.5,1),"top-right":Ur(1,1)});function rSe(e){switch(e){case"left":return ov.Left;case"right":return ov.Right;default:return ov.Center}}function Wae(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function kot(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Vot(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function Bot(e){return e==="middle"?"center":e}var va,Xae;function IA(e){return e!=null}function dT(e){return typeof e=="number"}function UU(e){return typeof e=="string"}function zot(e){return e==null||UU(e)}function En(e,t){e&&e.push(t)}function Got(e,t,r,i=Ie()){const s=e||0,n=t||0,o=r||0;return s!==0&&yE(i,i,-s/180*Math.PI),n!==0&&gE(i,i,n/180*Math.PI),o!==0&&e6(i,i,o/180*Math.PI),i}function f0(e,t,r,i,s){const n=e.minSize,o=e.maxSize;if(e.expression)return En(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=i.symbolSize[r];return t.minSize[r]=a,t.maxSize[r]=a,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=va.DefinedSize,!0}if(IA(e.field))return IA(e.stops)?e.stops.length===2&&dT(e.stops[0].size)&&dT(e.stops[1].size)?(Yae(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=va.DefinedSize,!0):(En(s,"Could not convert size info: stops only supported with 2 elements"),!1):dT(n)&&dT(o)&&IA(e.minDataValue)&&IA(e.maxDataValue)?(Yae(n,o,e.minDataValue,e.maxDataValue,t,r),t.type[r]=va.DefinedSize,!0):CE[e.valueUnit]!=null?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/CE[e.valueUnit],t.type[r]=va.DefinedSize,!0):e.valueUnit==="unknown"?(En(s,"Could not convert size info: proportional size not supported"),!1):(En(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!IA(e.field)){if(e.stops&&e.stops[0]&&dT(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=va.DefinedSize,!0;if(dT(n))return t.minSize[r]=n,t.maxSize[r]=n,t.offset[r]=n,t.factor[r]=0,t.type[r]=va.DefinedSize,!0}return En(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Yae(e,t,r,i,s,n){const o=Math.abs(i-r)>0?(t-e)/(i-r):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-r*o,s.factor[n]=o}function jot(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return En(i,"Could not convert size info: unsupported property"),null;if(!zot(e.field))return En(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return En(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[va.Undefined,va.Undefined,va.Undefined]};let s;switch(e.axis){case"width":return s=f0(e,t.size,0,r,i),s?t:null;case"height":return s=f0(e,t.size,2,r,i),s?t:null;case"depth":return s=f0(e,t.size,1,r,i),s?t:null;case"width-and-depth":return s=f0(e,t.size,0,r,i),s&&f0(e,t.size,1,r,i),s?t:null;case null:case void 0:case"all":return s=f0(e,t.size,0,r,i),s=s&&f0(e,t.size,1,r,i),s=s&&f0(e,t.size,2,r,i),s?t:null;default:return En(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}function Hot(e,t,r){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===va.DefinedSize&&(n*=t.modelSize[s],e.type[s]=va.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let i;if(e.type[0]!==va.Undefined)i=0;else if(e.type[1]!==va.Undefined)i=1;else{if(e.type[2]===va.Undefined)return En(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)e.type[s]===va.Undefined&&(e.minSize[s]=e.minSize[i],e.maxSize[s]=e.maxSize[i],e.offset[s]=e.offset[i],e.factor[s]=e.factor[i],e.type[s]=e.type[i]);return!0}function Zae(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function qot(e,t,r){if(e.normalizationField)return En(r,"Could not convert color info: unsupported property"),null;if(UU(e.field)){if(!e.stops)return En(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return En(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=e.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];t.color.values[s]=n.value,Zae(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return En(r,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,Zae(t.color.colors,s,i)}}return t}function Wot(e,t,r){if(e.normalizationField)return En(r,"Could not convert opacity info: unsupported property"),null;if(UU(e.field)){if(!e.stops)return En(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return En(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=e.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return En(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=i}}return t}function DV(e,t,r){const i=r===2&&e.rotationType==="arithmetic";t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function Xot(e,t,r){if(!UU(e.field))return En(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return En(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return DV(e,t.rotation,0),t;case"roll":return DV(e,t.rotation,1),t;case null:case void 0:case"heading":return DV(e,t.rotation,2),t;default:return En(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function iSe(e,t,r){if(!e)return null;const i=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return En(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return i?jot(c,l,t,r):l;case"color":return s?qot(c,l,r):l;case"opacity":return o?Wot(c,l,r):null;case"rotation":return n?Xot(c,l,r):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!Hot(a.size,t,r)?null:a:null}function EQ(e){return e&&e.size!=null}function NM(e,t){if(!e)return{enabled:!1};if(Xr.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const r=iSe(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:sSe(r,t),requiresShaderTransformation:EQ(r)}:{enabled:!1}}function FM(e,t,r){if(!t||!e.enabled)return!1;const i=e.visualVariables,s=iSe(t.visualVariables,r);return!!s&&!!(nL(i.size,s.size,"size")&&nL(i.color,s.color,"color")&&nL(i.rotation,s.rotation,"rotation")&&nL(i.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=sSe(s,r),e.requiresShaderTransformation=EQ(s),!0)}function nL(e,t,r){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&r==="rotation"){const i=e,s=t;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}function sSe(e,t){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=EQ(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&i&&(r.vvSizeValue=t.transformation.scale),e&&i&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=ns(),td(dO),Got(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],dO),id(r.vvSymbolRotationMatrix,dO)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}function cq(e,t,r){if(!e.vvSizeEnabled)return r;Hn(m0,r);const i=e.vvSymbolRotationMatrix;$m(dO,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),ws(m0,m0,dO);for(let s=0;s<3;++s){const n=e.vvSizeOffset[s]+t[0]*e.vvSizeFactor[s];Jae[s]=ye(n,e.vvSizeMinSize[s],e.vvSizeMaxSize[s])}return K5(m0,m0,Jae),Yl(m0,m0,e.vvSymbolAnchor),m0}function Yot(e,t,r){if(!t.vvSizeEnabled)return ce(e,1,1,1);for(let i=0;i<3;++i){const s=t.vvSizeOffset[i]+r[0]*t.vvSizeFactor[i];e[i]=ye(s,t.vvSizeMinSize[i],t.vvSizeMaxSize[i])}return e}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(va||(va={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(Xae||(Xae={}));const m0=Ie(),Jae=M(),dO=Ie();class nC{constructor(t,r={}){this.geometry=t,this.boundingSphere=sr(),this.screenToWorldRatio=1,this._transformation=Ie(),this._shaderTransformationDirty=!0,this.id=Lc(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.boundingInfo=r.boundingInfo,this.shaderTransformer=r.shaderTransformer,this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,r,i=Fw(t)){E(this.boundingInfo)||(Ze(r,this.boundingInfo.center,t),r[3]=this.boundingInfo.radius*i)}get hasShaderTransformation(){return v(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return E(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ie()),Hn(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(t){this.geometry.visible=t}}const Zot=Ie(),Qae=Le(0,0,1),Jot=16,Qot=1.5,sw=ZJ,Kot=[sw/2,sw/2,1-sw/2,1-sw/2],eat=[RM*sw,RM*sw];class UM extends km{getCachedSize(){return{size:this._getIconSize()}}constructor(t,r,i,s){super(t,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(t){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(v(i))this._prepareResourcesPrimitive(r,i);else{const s=G6e(this.symbolLayer),n=pP(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),t):await this._prepareResourcesHref(r,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=TU(this._getIconSize());if(t)throw new j("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,r=Math.round(t.size!=null?Fo(t.size):Jot);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(t){const r=this._getGraphicHash(t);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,t,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:rv.PAD};i=new Ep(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_computeSize(t,r){const i=t.width/t.height;return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(tat(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;t.verticalOffset={screenLength:Fo(i),minWorldLength:s||0,maxWorldLength:v(n)?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,r){const i=this._getOutlineSize();if(NV(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,v(this._context.sharedResources.textures)){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>rTe(r));this._texture=n.texture,this._releaseTexture=n,t.textureId=this._texture.id}t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=Kot;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/sw,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,r,i){this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(v(this._context.sharedResources.textures)){const o=await Vc(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw Sc(o.error),new j("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id}this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,r,i){const s=new fC({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await ie(()=>import("./CIMSymbolRasterizer.227eba27.js"),["assets/CIMSymbolRasterizer.227eba27.js","assets/cimAnalyzer.a67026bf.js","assets/BidiEngine.f5b8c89f.js","assets/TileClipper.7b9dd3ce.js","assets/enums.89506096.js","assets/number.dcd3e86c.js","assets/_commonjsHelpers.4421ccc9.js","assets/imageutils.dc8bb0f5.js","assets/rasterizingUtils.36482472.js"])).CIMSymbolRasterizer;cr(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await aMe(p,this._context.layer.spatialReference,n);a=(m,y,_)=>{const b=Mot(f,m,{$view:_},"esriGeometryPoint",y);return b!==null?b:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];cr(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||yIe}_getOutlineSize(){let t=0;const r=this.symbolLayer;return v(r.outline)&&r.outline.size!=null?Math.max(Fo(r.outline.size),0):(t=NV(this._getPrimitive())?Qot:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),r=this.symbolLayer,i=en(r,"outline","color");if(v(i)){const s=Qe.toUnitRGB(i),n=i.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(NV(this._getPrimitive()))return $ot;const t=E(this._getPrimitive()),r=en(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:t})}_getAnchorPos(t,r){return t==="relative"?Ur((r.x||0)+.5,.5-(r.y||0)):t in EN?EN[t]:EN.center}_createMaterialAndAddToStage(t,r){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=NM(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let i=v(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return i||(i=new tC(t),this._cimSymbolMaterials.set(Pt(t.textureId,0),i),r.add(i)),i}return this._material=new tC(t),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=Wi(this._releaseTexture)}_getScaleFactor(t,r){if(this._drivenProperties.size&&t.size){for(let i=0;i<3;i++){const s=t.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[i]=Fo(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/r;if(isFinite(+t.size[2]))return+t.size[2]/r}return 1}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),f={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(f,this._context.stage),s=[p.params.width,p.params.height]}else s=this._size,i=this._material;const n=PM(r.geometry);if(E(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=Ur(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(r,new qu);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,i,a,c,t.layer.uid):this._createAs3DShape(r,n,i,a,c,h,r.uid)}layerOpacityChanged(){const t=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:t}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=jP(UM.elevationModeChangeTypes,i,s);if(n!==xs.UPDATE)return n;const o=ad(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!FM(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Rn.Recreate_Symbol;v(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return Rn.Fast_Update}_defaultElevationInfoNoZ(){return rat}_createAs3DShape(t,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?_=>cq(this._fastUpdates.materialParameters,l,_):void 0,h=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),f=$H(i,Qae,null,s,n,iat,null,l,p),m=lQ(this._context,r,f,o,a,c);if(E(m))return null;const y=new Um(this,m.object,[f],null,null,OM,o);return y.alignedSampledElevation=m.sampledElevation,y.needsElevationUpdates=ad(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),MM(y,r,this._context.elevationProvider),y}_createAsOverlay(t,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=sr();aa(r,a,this._context.overlaySR),a[2]=xQ;const l=this._context.clippingExtent;if(v(l)&&!vX(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?_=>cq(this._fastUpdates.materialParameters,c,_):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:t.uid,layerUid:this._context.layer.uid}),f=$H(i,Qae,a,s,n,null,null,c,p),m=new nC(f,{layerUid:o,graphicUid:t.uid,shaderTransformer:h});a[3]=0,cp(m.boundingSphere,a);const y=new FU(this,[m],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,h),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(t,r){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=Ke())=>{const a=r(Zot);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=t[0]/this._symbolTextureRatio+i,n=t[1]/this._symbolTextureRatio+i;return(o=Ke())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],r=Le(t,t,t),i=Qh(1),s=t*i;return{modelSize:r,symbolSize:Le(s,s,s),unitInMeters:i,transformation:{anchor:Sa,scale:Qf,rotation:Sa}}}_getGraphicHash(t){let r="";for(const i of this._cimRequiredFields)r+=i+t.attributes[i];return r}_forEachMaterial(t){v(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return{...super.test(),material:this._material}}}function tat(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function NV(e){return!E(e)&&(e==="cross"||e==="x")}UM.PRIMITIVE_SIZE=eat,UM.elevationModeChangeTypes={definedChanged:xs.UPDATE,staysOnTheGround:xs.NONE,onTheGroundChanged:xs.RECREATE};const rat={mode:"relative-to-ground",offset:0},iat=Ht(0,0,0,1);function uq(e){switch(e){case"butt":return Xh.BUTT;case"square":return Xh.SQUARE;case"round":return Xh.ROUND;default:return null}}function sat(e){return e==="diamond"?"kite":e}function hq(e,t,r=null){const i=[],s=[],n=t.mapPositions;nat(t,s,i);const o=s[0][1].data,a=i[0][1].length,l=new Array(a).fill(0);return oat(t,s,i,l),cat(t,s,i,l),aat(t,s,i,l),lat(t,s,i,l),uat(t,s,i,l),hat(t,s,i,l),dat(t,s,i,o),new tn(e,s,i,n,Fs.Line,r)}function nat(e,t,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=e,n=pat(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?i.slice(0,i.length-3):i;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([A.POSITION,new Je(l,3,n)]),r.push([A.POSITION,a])}function oat(e,t,r,i){if(v(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([A.COLOR,new Je(Pt(s,kh),4)]),r.push([A.COLOR,i])}function aat(e,t,r,i){if(!v(e.attributeData.normal))return;const s=e.attributeData.normal;t.push([A.NORMAL,new Je(s,3)]),r.push([A.NORMAL,i])}function lat(e,t,r,i){const s=e.attributeData.colorFeature;E(s)||(t.push([A.COLORFEATUREATTRIBUTE,new Je([s],1,!0)]),r.push([A.COLOR,i]))}function cat(e,t,r,i){if(v(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([A.SIZE,new Je([Pt(s,1)],1,!0)]),r.push([A.SIZE,i])}function uat(e,t,r,i){const s=e.attributeData.sizeFeature;E(s)||(t.push([A.SIZEFEATUREATTRIBUTE,new Je([s],1,!0)]),r.push([A.SIZEFEATUREATTRIBUTE,i]))}function hat(e,t,r,i){const s=e.attributeData.opacityFeature;E(s)||(t.push([A.OPACITYFEATUREATTRIBUTE,new Je([s],1,!0)]),r.push([A.OPACITYFEATUREATTRIBUTE,i]))}function dat(e,t,r,i){if(E(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==Ge.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=Bc(i.length),n=Zr(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)XX(i,f,s,f,n);const o=i.length/3,a=Qs(o+1);let l=fat,c=mat,h=0,p=0;ce(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),ce(c,s[p++],s[p++],s[p++]),h+=cbe(l,c),a[f]=h,[l,c]=[c,l];t.push([A.DISTANCETOSTART,new Je(a,1,!0)]),r.push([A.DISTANCETOSTART,r[0][1]])}function pat(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const fat=M(),mat=M();function hSt(e,t){if(E(e)||e.length===0)return[];const r=[];return e.forEach(i=>{const s=i.length,n=Bc(3*s);i.forEach((a,l)=>{n[3*l+0]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:t},removeDuplicateStartEnd:!1};r.push(o)}),r}function gat(e,t,r,i){const s=e.type==="polygon"?Am.CCW_IS_HOLE:Am.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=WP(n,!!e.hasZ,s),l=Bc(o.length),c=LTe(o,e.spatialReference,0,l,0,o,0,o.length/3,t,r,i),h=c!=null;return{lines:h?nSe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function yat(e,t){const r=e.type==="polygon"?Am.CCW_IS_HOLE:Am.NONE,i=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=WP(i,!1,r),o=Ts(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=xQ;return{lines:o?nSe(n,s):[],projectionSuccess:o}}function nSe(e,t,r=null){const i=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=3*n;i.push({position:qh(t,3*s,3*n),mapPositions:v(r)?qh(r,o,a):void 0})}return i}function _at(e){const t=new Lr,r=e.hasMultipassTerrain&&(e.output===k.Color||e.output===k.Alpha),i=e.space===Wh.World;e.hasTip&&i&&t.extensions.add("GL_OES_standard_derivatives"),t.include(u2e,e),t.include(y2e,e),e.output===k.Depth&&t.include(Sy,e);const{vertex:s,fragment:n}=t;return n.include(jc),Nc(s,e),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.UV0,"vec2"),t.attributes.add(A.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),bv(t),r&&t.varyings.add("depth","float"),e.hasTip&&t.varyings.add("vLineWidth","float"),s.uniforms.add([new kr("nearFar",(o,a)=>a.camera.nearFar),new fr("viewport",(o,a)=>a.camera.fullViewport)]),s.code.add(w`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(w`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(t.attributes.add(A.NORMAL,"vec3"),KE(s),s.constants.add("tiltThreshold","float",.7),s.code.add(w`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(w`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(w`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${e.anchor===ax.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),e.space===Wh.Screen&&(s.uniforms.add(new Yi("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(w`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(w`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new Pe("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(w`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),s.uniforms.add(new Pe("pixelRatio",(o,a)=>a.camera.pixelRatio)),J6(t),s.code.add(w`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(e.hideOnShortSegments&&s.code.add(w`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(w`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(w`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),e.space===Wh.Screen&&s.code.add(w`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(w`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${e.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&t.include(ju,e),t.include(Ks,e),n.uniforms.add([new fr("intrinsicColor",o=>o.color),new Mt("tex",o=>o.texture)]),n.include(Nm),t.constants.add("texelSize","float",1/$M),n.code.add(w`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),e.hasTip&&(t.constants.add("relativeMarkerSize","float",pQ/$M),t.constants.add("relativeTipLineWidth","float",$st),n.code.add(w`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),t.constants.add("symbolAlphaCutoff","float",sa),n.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${e.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${e.output===k.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${e.output===k.Alpha?w`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===k.Color?w`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===k.Color&&e.transparencyPassType===xt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===k.Highlight?w`gl_FragColor = vec4(1.0);`:""}
    ${e.output===k.Depth?w`outputDepth(linearDepth);`:""}
  }
  `),t}const vat=Object.freeze(Object.defineProperty({__proto__:null,build:_at},Symbol.toStringTag,{value:"Module"})),oSe=new Map([[A.POSITION,0],[A.UV0,2],[A.AUXPOS1,3],[A.NORMAL,4],[A.COLOR,5],[A.COLORFEATUREATTRIBUTE,5],[A.SIZE,6],[A.SIZEFEATUREATTRIBUTE,6],[A.OPACITYFEATUREATTRIBUTE,7]]);class kU extends Br{initializeProgram(t){return new Nr(t.rctx,kU.shader.get().build(this.configuration),oSe)}_makePipelineState(t,r){const i=this.configuration,s=t===xt.NONE;return Vt({blending:i.output===k.Color||i.output===k.Alpha?s?Fu:ky(t):null,depthTest:{func:zv(t)},depthWrite:s?i.writeDepth?Jl:null:_U(t),colorWrite:Qt,stencilWrite:i.hasOccludees?Rm:null,stencilTest:i.hasOccludees?r?Mv:Gv:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Vt({blending:Fu,depthTest:q4,depthWrite:null,colorWrite:Qt,stencilWrite:null,stencilTest:b2e}),this._occluderPipelineOpaque=Vt({blending:Fu,depthTest:q4,depthWrite:null,colorWrite:Qt,stencilWrite:_2e,stencilTest:v2e}),this._occluderPipelineMaskWrite=Vt({blending:null,depthTest:fQ,depthWrite:null,colorWrite:null,stencilWrite:Rm,stencilTest:Mv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===Se.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Se.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}kU.shader=new Dr(vat,()=>ie(()=>import("./LineMarker.glsl.79a217e3.js"),[]));class bat extends Bv{constructor(t){super(t,new xat),this._vertexAttributeLocations=oSe,this._configuration=new Mo,this._layout=this.createLayout()}dispose(){}getConfiguration(t,r){return this._configuration.output=t,this._configuration.space=r.slot===Se.DRAPED_MATERIAL?Wh.Draped:this.parameters.worldSpace?Wh.World:Wh.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Xh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===us.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const t=os().vec3f(A.POSITION).vec2f(A.UV0).vec3f(A.AUXPOS1);return this.parameters.worldSpace&&t.vec3f(A.NORMAL),this.parameters.vvSizeEnabled?t.f32(A.SIZEFEATUREATTRIBUTE):t.f32(A.SIZE),this.parameters.vvColorEnabled?t.f32(A.COLORFEATUREATTRIBUTE):t.vec4f(A.COLOR),this.parameters.vvOpacityEnabled&&t.f32(A.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Tat(this._layout,this.parameters)}requiresSlot(t,r){return r===k.Color||r===k.Alpha||r===k.Highlight||r===k.Depth?t===Se.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===us.OccludeAndTransparentStencil?t===Se.OPAQUE_MATERIAL||t===Se.OCCLUDER_MATERIAL||t===Se.TRANSPARENT_OCCLUDER_MATERIAL:r===k.Color||r===k.Alpha?t===(this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Se.OPAQUE_MATERIAL:!1}createGLMaterial(t){return new wat(t)}}class wat extends jZ{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(kU,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class xat extends JJ{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Xh.BUTT,this.anchor=ax.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class Tat{constructor(t,r){this.vertexBufferLayout=t,this._parameters=r}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(t,r,i,s,n){const o=i.vertexAttributes.get(A.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(A.NORMAL);this._parameters.worldSpace&&v(c)&&(l=c.data);let h=1,p=0;this._parameters.vvSizeEnabled?p=i.vertexAttributes.get(A.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(A.SIZE)&&(h=i.vertexAttributes.get(A.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColorEnabled?m=i.vertexAttributes.get(A.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(A.COLOR)&&(f=i.vertexAttributes.get(A.COLOR).data);let y=0;this._parameters.vvOpacityEnabled&&(y=i.vertexAttributes.get(A.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let b=n*(this.vertexBufferLayout.stride/4);const x=(O,R,$,I)=>{if(_[b++]=O[0],_[b++]=O[1],_[b++]=O[2],_[b++]=$[0],_[b++]=$[1],_[b++]=R[0],_[b++]=R[1],_[b++]=R[2],this._parameters.worldSpace&&(_[b++]=l[0],_[b++]=l[1],_[b++]=l[2]),this._parameters.vvSizeEnabled?_[b++]=p:_[b++]=h,this._parameters.vvColorEnabled)_[b++]=m;else{const U=Math.min(4*I,f.length-4);_[b++]=f[U+0],_[b++]=f[U+1],_[b++]=f[U+2],_[b++]=f[U+3]}this._parameters.vvOpacityEnabled&&(_[b++]=y)};let T;(function(O){O[O.ASCENDING=1]="ASCENDING",O[O.DESCENDING=-1]="DESCENDING"})(T||(T={}));const S=(O,R)=>{const $=ce(Sat,o[3*O],o[3*O+1],o[3*O+2]),I=Eat;let U=O+R;do ce(I,o[3*U],o[3*U+1],o[3*U+2]),U+=R;while(lv($,I)&&U>=0&&U<a);t&&(Ze($,$,t),Ze(I,I,t)),x($,I,[-1,-1],O),x($,I,[1,-1],O),x($,I,[1,1],O),x($,I,[-1,-1],O),x($,I,[1,1],O),x($,I,[-1,1],O)},C=this._parameters.placement;C!=="begin"&&C!=="begin-end"||S(0,T.ASCENDING),C!=="end"&&C!=="begin-end"||S(a-1,T.DESCENDING)}}const Sat=M(),Eat=M(),pa={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Cat={dash:pa.dash,"dash-dot":[...pa.dash,...pa.dot],dot:pa.dot,"long-dash":pa["long-dash"],"long-dash-dot":[...pa["long-dash"],...pa.dot],"long-dash-dot-dot":[...pa["long-dash"],...pa.dot,...pa.dot],none:null,"short-dash":pa["short-dash"],"short-dash-dot":[...pa["short-dash"],...pa["short-dot"]],"short-dash-dot-dot":[...pa["short-dash"],...pa["short-dot"],...pa["short-dot"]],"short-dot":pa["short-dot"],solid:null},Aat=8;function Rat(e,t=2){return E(e)?e:{pattern:e.slice(),pixelRatio:t}}function dSt(e,t=2){return{pattern:[e,e],pixelRatio:t}}function aSe(e){return v(e)&&e.type==="style"?Oat(e.style):null}function Oat(e){return v(e)?Rat(Cat[e],Aat):null}const Mat=["polyline","polygon","extent"];class VU extends km{constructor(t,r,i,s){super(t,r,i,s)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=NM(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Qh(1))<0)throw new j("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=v(this.symbolLayer.marker)&&v(this._context.sharedResources.textures)?Lst(this._context.sharedResources.textures,sat(this.symbolLayer.marker.style)):null}_getMaterialParameters(t,r=!1){var n;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:uq(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:aSe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return ho(this.symbolLayer.material,t=>t.color)}get _markerColor(){return ho(this.symbolLayer.marker,t=>t.color)}get _lineMaterial(){return E(this._lineMaterialCached)&&(this._lineMaterialCached=new aS(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return E(this._ringMaterialCached)&&(this._ringMaterialCached=new aS(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return E(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new aS({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return E(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new aS({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return E(this._markerMaterialCached)&&v(this.symbolLayer.marker)&&v(this._markerTexture)&&(this._markerMaterialCached=new bat({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=Wi(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?Fo(ist(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?ay(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const r=Ht(1,1,1,1);return this._drivenProperties.color&&t.color&&(r[0]=t.color[0],r[1]=t.color[1],r[2]=t.color[2],t.color.length>0&&(r[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(r[3]=t.opacity),r}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?ay(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?ay(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,Mat,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new qu);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,i,r.uid)}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!FM(this._fastUpdates,r,this._vvConvertOptions))return Rn.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return Rn.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const r=t.diff.diff,i={};((n=r.size)==null?void 0:n.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=uq(Pt(r.cap.newValue,"butt")),delete r.cap);const s=this._prepareMarkerPatch(t,r);this._prepareMaterialPatch(t,r,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((t,r)=>this._updateMaterialLayerOpacity(t,r))}_forEachMaterial(t){v(this._lineMaterialCached)&&t(this._lineMaterialCached),v(this._ringMaterialCached)&&t(this._ringMaterialCached),v(this._wireframeLineMaterialCached)&&t(this._wireframeLineMaterialCached),v(this._wireframeRingMaterialCached)&&t(this._wireframeRingMaterialCached),v(this._markerMaterialCached)&&t(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(t,r=!1){const i=t.parameters.color,s=en(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=Ht(i[0],i[1],i[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=jP(VU.elevationModeChangeTypes,i,s);if(n!==xs.UPDATE)return n;const o=ad(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof qr)return Pp.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,r,i){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=In(),c=gat(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,h,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,b=y.mapPositions;if(v(this._context.clippingExtent)&&($i(l),Pu(l,b),!dp(l,this._context.clippingExtent)))continue;const x=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,t,_,b,n.type,pO.ELEVATED,i);a.push(x),Xr.LINE_WIREFRAMES&&a.push(x.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),v(this._markerMaterial)&&a.push(x.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new By({geometries:a,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),f=new Um(this,p,a,null,null,cit,r);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=ad(r.mode),f}_createGeometry(t,r,i,s,n,o,a){const l=n==="polygon",c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,h=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid});return hq(t,{overlayInfo:o===pO.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:l,mapPositions:s,attributeData:{position:i,size:h?null:this._getDrivenSize(r.renderingInfo),color:c?null:this._getDrivenColor(r.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(r.graphic),colorFeature:this._getColorFeatureAttributeData(r.graphic),opacityFeature:this._getOpacityFeatureAttributeData(r.graphic)}},p)}_createAsOverlay(t,r){const i=t.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Xr.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;v(a)&&(a.renderPriority=this._renderPriority-.001),v(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=In(),p=$i(),f=yat(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if($i(h),Pu(h,y.position),!dp(h,this._context.clippingExtent))continue;dE(p,h);const _=x=>{const T=this._createGeometry(x,t,y.position,void 0,s.type,pO.DRAPED,i.uid),S=new nC(T,{layerUid:r,graphicUid:i.uid});return c.push(S),S};if(v(l)){const x=_(l),T=this.symbolLayer.marker.placement;T!=="begin"&&T!=="begin-end"||Pu(h,y.position,0,1),T!=="end"&&T!=="begin-end"||Pu(h,y.position,y.position.length-3,1),this._updateBoundingSphere(x,h)}const b=_(o);if(this._updateBoundingSphere(b,h),Xr.LINE_WIREFRAMES){const x=_(a);this._updateBoundingSphere(x,h)}}return new FU(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,r){ti(t.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return v(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=Pt(t,Qh(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Fo(1):1:Fo(t)}_prepareMaterialPatch(t,r,i){var a;const s=r.material;if(E(s))return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,t));if(s.type==="collection")return;const n=s.type==="complete"?ho(s.newValue,l=>l.color):((a=s.diff.color)==null?void 0:a.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(yP(o),this._markerMaterialCached,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,t),delete r.material}_prepareMarkerPatch(t,r){const i=r.marker;if(E(i)||i.type!=="partial"||v(i.diff.style)||v(i.diff.placement)||v(i.diff.color)&&i.diff.color.type!=="complete")return{changed:!1,useMaterialColor:E(this._markerColor)};const s=i.diff.color;if(E(s))return delete r.marker,{changed:!1,useMaterialColor:E(this._markerColor)};const n=s.newValue;return E(n)?(delete r.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterialCached,t),delete r.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,r,i){E(r)||i.symbolLayerStatePatches.push(()=>r.setParameters({color:t}))}}var pO;VU.elevationModeChangeTypes={definedChanged:xs.RECREATE,staysOnTheGround:xs.NONE,onTheGroundChanged:xs.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(pO||(pO={}));let $A=null,Z4=!0;function FV(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(Z4)try{return new ImageData(e,t)}catch{Z4=!1}return lSe(e,t,r)}function Pat(e,t,r,i){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(Z4)try{return new ImageData(e,t,r)}catch{Z4=!1}const s=lSe(t,r,i);return s.data.set(e,0),s}function Iat(){return $A||($A=document.createElement("canvas"),$A.width=1,$A.height=1),$A}function lSe(e,t,r){return r||(r=Iat()),r.getContext("2d").createImageData(e,t)}var E2;const UV=new WeakMap;let $at=0,Af=E2=class extends fe{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,i){if(e instanceof HTMLImageElement){const s={type:"image-element",src:Lw(e.src,i),crossOrigin:e.crossOrigin};t[r]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[r]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:Lw(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=s}else if(e instanceof ImageData){const s={type:"image-data",imageData:this._encodeImageData(e)};t[r]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const r=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(r="")=>`d:${r},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(UV.has(this.data)||UV.set(this.data,++$at),t(UV.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new E2(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return Pat(r,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new E2({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new E2({data:e}):KS(E2,e)}};u([d({type:String,json:{write:pv}})],Af.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],Af.prototype,"data",null),u([Be("data")],Af.prototype,"writeData",null),u([De("data")],Af.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Af.prototype,"transparent",null),u([d({json:{write:!0}})],Af.prototype,"wrap",void 0),u([d({readOnly:!0})],Af.prototype,"contentHash",null),Af=E2=u([P("esri.geometry.support.MeshTexture")],Af);const fO=Af;var dq;let Gd=dq=class extends fe{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=v(e)?e.get(this):null;if(r)return r;const i=new dq(this.clonePropertiesWithDeduplication(t));return v(e)&&e.set(this,i),i}clonePropertiesWithDeduplication(e){return{color:v(this.color)?this.color.clone():null,colorTexture:v(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:v(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:v(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:v(this.normalTextureTransform)?this.normalTextureTransform:null}}};u([d({type:Qe,json:{write:!0}})],Gd.prototype,"color",void 0),u([d({type:fO,json:{write:!0}})],Gd.prototype,"colorTexture",void 0),u([d({type:fO,json:{write:!0}})],Gd.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],Gd.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],Gd.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],Gd.prototype,"doubleSided",void 0),u([d()],Gd.prototype,"colorTextureTransform",void 0),u([d()],Gd.prototype,"normalTextureTransform",void 0),Gd=dq=u([P("esri.geometry.support.MeshMaterial")],Gd);const CQ=Gd;var pq;let _h=pq=class extends CQ{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=v(e)?e.get(this):null;if(r)return r;const i=new pq(this.clonePropertiesWithDeduplication(t));return v(e)&&e.set(this,i),i}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:v(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:v(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:v(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null,occlusionTextureTransform:v(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:v(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:v(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};u([d({type:Qe,json:{write:!0}})],_h.prototype,"emissiveColor",void 0),u([d({type:fO,json:{write:!0}})],_h.prototype,"emissiveTexture",void 0),u([d({type:fO,json:{write:!0}})],_h.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],_h.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],_h.prototype,"roughness",void 0),u([d({type:fO,json:{write:!0}})],_h.prototype,"metallicRoughnessTexture",void 0),u([d()],_h.prototype,"occlusionTextureTransform",void 0),u([d()],_h.prototype,"emissiveTextureTransform",void 0),u([d()],_h.prototype,"metallicRoughnessTextureTransform",void 0),_h=pq=u([P("esri.geometry.support.MeshMaterialMetallicRoughness")],_h);const cSe=_h;var CN;const uSe="esri.geometry.support.MeshVertexAttributes",pT=ee.getLogger(uSe);let Ku=CN=class extends fe{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return C2(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},pT)}castPosition(e){return e&&e instanceof Float32Array&&pT.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),C2(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},pT)}castUv(e){return C2(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},pT)}castNormal(e){return C2(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},pT)}castTangent(e){return C2(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},pT)}clone(){const e={position:re(this.position),uv:re(this.uv),normal:re(this.normal),tangent:re(this.tangent),color:re(this.color)};return new CN(e)}clonePositional(){const e={position:re(this.position),normal:re(this.normal),tangent:re(this.tangent),uv:this.uv,color:this.color};return new CN(e)}};function kV(e,t,r,i){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):e}function C2(e,t,r,i,s){if(!e)return e;if(e instanceof t)return kV(e,i,t,s);for(const n of r)if(e instanceof n)return kV(new t(e),i,t,s);if(Array.isArray(e))return kV(new t(e),i,t,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function LA(e,t,r){t[r]=Lat(e)}function Lat(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}u([d({json:{write:LA}})],Ku.prototype,"color",void 0),u([zt("color")],Ku.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:LA}})],Ku.prototype,"position",void 0),u([zt("position")],Ku.prototype,"castPosition",null),u([d({json:{write:LA}})],Ku.prototype,"uv",void 0),u([zt("uv")],Ku.prototype,"castUv",null),u([d({json:{write:LA}})],Ku.prototype,"normal",void 0),u([zt("normal")],Ku.prototype,"castNormal",null),u([d({json:{write:LA}})],Ku.prototype,"tangent",void 0),u([zt("tangent")],Ku.prototype,"castTangent",null),Ku=CN=u([P(uSe)],Ku);var f3;const hSe="esri.geometry.support.MeshComponent",Dat=ee.getLogger(hSe);let Og=f3=class extends fe{static from(e){return KS(f3,e)}constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(e){return C2(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Dat)}castMaterial(e){return KS(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?cSe:CQ,e)}clone(){return new f3({faces:re(this.faces),shading:this.shading,material:re(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const r={faces:re(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new f3(r)}};u([d({json:{write:!0}})],Og.prototype,"faces",void 0),u([zt("faces")],Og.prototype,"castFaces",null),u([d({type:CQ,json:{write:!0}})],Og.prototype,"material",void 0),u([zt("material")],Og.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],Og.prototype,"shading",void 0),u([d({type:Boolean})],Og.prototype,"trustSourceNormals",void 0),Og=f3=u([P(hSe)],Og);const Nat=Og,BU=ee.getLogger("esri.geometry.support.meshUtils.normalProjection");function Fat(e,t,r,i,s){return GU(i)?(zU(ly.TO_PCPF,mi.fromTypedArray(e),yo.fromTypedArray(t),yo.fromTypedArray(r),i,mi.fromTypedArray(s)),s):(BU.error("Cannot convert spatial reference to PCPF"),s)}function pSt(e,t,r,i,s){return GU(i)?(zU(ly.FROM_PCPF,mi.fromTypedArray(e),yo.fromTypedArray(t),yo.fromTypedArray(r),i,mi.fromTypedArray(s)),s):(BU.error("Cannot convert to spatial reference from PCPF"),s)}function fSt(e,t,r){return Ts(e,t,0,r,d6(t),0,e.length/3),r}function mSt(e,t,r){return Ts(e,d6(r),0,t,r,0,e.length/3),t}function Uat(e,t,r){if(E(e))return t;const i=yo.fromTypedArray(e),s=yo.fromTypedArray(t);return qP(s,i,r),t}function kat(e,t,r){if(E(e))return t;kE(ro,r);const i=mi.fromTypedArray(e),s=mi.fromTypedArray(t);return Ov(s,i,ro),KZ(ro)||uQ(s,s),t}function Vat(e,t,r){if(E(e))return t;kE(ro,r);const i=mi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=mi.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(Ov(s,i,ro),KZ(ro)||uQ(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function Bat(e,t,r,i,s){if(!GU(i))return BU.error("Cannot convert spatial reference to PCPF"),s;zU(ly.TO_PCPF,mi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),yo.fromTypedArray(t),yo.fromTypedArray(r),i,mi.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function gSt(e,t,r,i,s){if(!GU(i))return BU.error("Cannot convert to spatial reference from PCPF"),s;zU(ly.FROM_PCPF,mi.fromTypedArray(e,16),yo.fromTypedArray(t),yo.fromTypedArray(r),i,mi.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function zU(e,t,r,i,s,n){if(!t)return;const o=r.count,a=d6(s);if(dSe(s))for(let l=0;l<o;l++)i.getVec(l,oL),t.getVec(l,ef),$p(a,oL,aL,a),id(ro,aL),e===ly.FROM_PCPF&&sd(ro,ro),Mc(ef,ef,ro),n.setVec(l,ef);else for(let l=0;l<o;l++){i.getVec(l,oL),t.getVec(l,ef),$p(a,oL,aL,a),id(ro,aL);const c=gF(r.get(l,1));let h=Math.cos(c);e===ly.TO_PCPF&&(h=1/h),ro[0]*=h,ro[1]*=h,ro[2]*=h,ro[3]*=h,ro[4]*=h,ro[5]*=h,e===ly.FROM_PCPF&&sd(ro,ro),Mc(ef,ef,ro),ve(ef,ef),n.setVec(l,ef)}return n}function GU(e){return dSe(e)||zat(e)}function dSe(e){return e.isWGS84||cpe(e)||Om(e)||Mm(e)}function zat(e){return e.isWebMercator}var ly;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(ly||(ly={}));const oL=M(),ef=M(),aL=Ie(),ro=ns();class pSe{constructor(t){this.data=t,this.type="encoded-mesh-texture",this.encoding=Hg.KTX2_ENCODING}}function ww(e){return(e==null?void 0:e.type)==="encoded-mesh-texture"}async function Gat(e){return new Promise((t,r)=>{const i=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function jat(e,t){return t===Hg.KTX2_ENCODING?new pSe(e):new Promise((r,i)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=h=>{URL.revokeObjectURL(n),i(h),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}function Zf(e){if(E(e))return null;const t=v(e.offset)?e.offset:t2e,r=v(e.rotation)?e.rotation:0,i=v(e.scale)?e.scale:r2e,s=SN(1,0,0,0,1,0,t[0],t[1],1),n=SN(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=SN(i[0],0,0,0,i[1],0,0,0,1),a=Wl();return UE(a,n,o),UE(a,s,a),a}function Hat(e){const t=new Lr,{vertex:r,fragment:i}=t;return t.include(jl,e),t.include(Mx,e),t.include(m2e,e),Nc(r,e),e.stippleEnabled&&(t.attributes.add(A.UV0,"vec2"),t.attributes.add(A.AUXPOS1,"vec3"),r.uniforms.add(new fr("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(A.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r.code.add(w`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(r.code.add(w`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?r.uniforms.add(new Pe("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(w`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(w`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?r.code.add(w`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(w`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Pe("stipplePatternPixelSize",s=>dQ(s))),r.code.add(w`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(w`}`),e.output===k.Highlight&&t.include(Uy,e),t.include(Ks,e),i.uniforms.add(new Pe("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||i.uniforms.add(new fr("constantColor",s=>s.color)),i.code.add(w`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${e.output===k.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${w.float(sa)}) {
      discard;
    }

    ${e.output===k.Color?w`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===k.Highlight?w`outputHighlight();`:""}
  }
  `),t}const qat=Object.freeze(Object.defineProperty({__proto__:null,build:Hat},Symbol.toStringTag,{value:"Module"}));class jU extends Br{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==k.Highlight}initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2}initializeProgram(t){return new Nr(t.rctx,jU.shader.get().build(this.configuration),Or)}initializePipeline(){const t=this.configuration,r=Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Vt({blending:n,depthTest:fQ,depthWrite:o,colorWrite:Qt,stencilWrite:t.hasOccludees?Rm:null,stencilTest:t.hasOccludees?s?Mv:Gv:null});return t.output===k.Color?(this._occludeePipelineState=i(!0,t.transparent||this._stippleEnabled?r:null,Jl),i(!1,t.transparent||this._stippleEnabled?r:null,Jl)):i(!1)}get primitiveType(){return It.LINES}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}jU.shader=new Dr(qat,()=>ie(()=>import("./NativeLine.glsl.398294db.js"),[]));class au extends ao{constructor(){super(...arguments),this.output=k.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([B({count:k.COUNT})],au.prototype,"output",void 0),u([B()],au.prototype,"hasSlicePlane",void 0),u([B()],au.prototype,"hasVertexColors",void 0),u([B()],au.prototype,"transparent",void 0),u([B()],au.prototype,"draped",void 0),u([B()],au.prototype,"stippleEnabled",void 0),u([B()],au.prototype,"stippleOffColorEnabled",void 0),u([B()],au.prototype,"stipplePreferContinuous",void 0),u([B()],au.prototype,"hasOccludees",void 0),u([B({constValue:!1})],au.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!1})],au.prototype,"stippleScaleWithLineWidth",void 0),u([B({constValue:!1})],au.prototype,"stippleRequiresStretchMeasure",void 0);var J4;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(J4||(J4={}));class Kae extends Bv{constructor(t){super(t,new Yat),this._configuration=new au}getConfiguration(t,r){this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===Se.DRAPED_MATERIAL;const i=v(this.parameters.stipplePattern);return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&v(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(t,r,i,s,n,o){if(!i.options.selectionMode||!t.visible)return;if(!owe(r))return void ee.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=t.vertexAttributes.get(A.POSITION).data,l=i.camera,c=Jat;qn(c,i.point);const h=2;ce(DA[0],c[0]-h,c[1]+h,0),ce(DA[1],c[0]+h,c[1]+h,0),ce(DA[2],c[0]+h,c[1]-h,0),ce(DA[3],c[0]-h,c[1]-h,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(DA[_],tg[_]))return;_a(l.eye,tg[0],tg[1],VV),_a(l.eye,tg[1],tg[2],BV),_a(l.eye,tg[2],tg[3],zV),_a(l.eye,tg[3],tg[0],GV);let p=Number.MAX_VALUE,f=0;for(let _=0;_<a.length-5;_+=3){if(Ha[0]=a[_]+r[12],Ha[1]=a[_+1]+r[13],Ha[2]=a[_+2]+r[14],qa[0]=a[_+3]+r[12],qa[1]=a[_+4]+r[13],qa[2]=a[_+5]+r[14],Ei(VV,Ha)<0&&Ei(VV,qa)<0||Ei(BV,Ha)<0&&Ei(BV,qa)<0||Ei(zV,Ha)<0&&Ei(zV,qa)<0||Ei(GV,Ha)<0&&Ei(GV,qa)<0)continue;if(l.projectToRenderScreen(Ha,y1),l.projectToRenderScreen(qa,_1),y1[2]<0&&_1[2]>0){ge(tf,Ha,qa);const x=l.frustum,T=-Ei(x[Si.NEAR],Ha)/_e(tf,x[Si.NEAR]);ae(tf,tf,T),me(Ha,Ha,tf),l.projectToRenderScreen(Ha,y1)}else if(y1[2]>0&&_1[2]<0){ge(tf,qa,Ha);const x=l.frustum,T=-Ei(x[Si.NEAR],qa)/_e(tf,x[Si.NEAR]);ae(tf,tf,T),me(qa,qa,tf),l.projectToRenderScreen(qa,_1)}else if(y1[2]<0&&_1[2]<0)continue;y1[2]=0,_1[2]=0;const b=sY(dw(y1,_1,rle),c);b<p&&(p=b,le(ele,Ha),le(tle,qa),f=_/3)}const m=i.rayBegin,y=i.rayEnd;if(p<h*h){let _=Number.MAX_VALUE;if($ge(dw(ele,tle,rle),dw(m,y,Zat),g1)){ge(g1,g1,m);const b=Me(g1);ae(g1,g1,1/b),_=b/Ai(m,y)}o(_,g1,f,!1)}}intersectDraped(t,r,i,s,n,o){if(!i.options.selectionMode)return;const a=t.vertexAttributes.get(A.POSITION).data,l=t.vertexAttributes.get(A.SIZE),c=l?l.data[0]:0,h=s[0],p=s[1],f=((c+1)/2+4)*t.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const b=a[_],x=a[_+1],T=h-b,S=p-x,C=a[_+3]-b,O=a[_+4]-x,R=ye((C*T+O*S)/(C*C+O*O),0,1),$=C*R-T,I=O*R-S,U=$*$+I*I;U<m&&(m=U,y=_/3)}m<f*f&&n(o.dist,o.normal,y,!1)}requiresSlot(t,r){return!(r!==k.Color&&r!==k.Highlight&&r!==k.ObjectAndLayerIdColor||t!==Se.OPAQUE_MATERIAL&&t!==Se.DRAPED_MATERIAL)}createGLMaterial(t){return new Wat(t)}createBufferWriter(){const t=this.parameters.hasVertexColors?M2e:ont;return E(this.parameters.stipplePattern)?new zC(t):new Xat(t.clone().vec3f(A.AUXPOS1).vec2f(A.UV0))}}class Wat extends Vv{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output===k.Color&&this._updateOccludeeState(t);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(jU,t)}}class Xat{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(A.POSITION).length}write(t,r,i,s,n){Zxe(i,this.vertexBufferLayout,t,r,s,n),this._writeAuxpos1(t,i,s,n),this._writeUV0(t,i,s,n)}_writeAuxpos1(t,r,i,s){const n=i.getField(A.AUXPOS1,mi),o=r.indices.get(A.POSITION),a=r.vertexAttributes.get(A.POSITION).data,l=t,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],_=a[m+1],b=a[m+2],x=l[0]*y+l[4]*_+l[8]*b+l[12],T=l[1]*y+l[5]*_+l[9]*b+l[13],S=l[2]*y+l[6]*_+l[10]*b+l[14];h[s]=x,h[s+1]=T,h[s+2]=S,s+=c}}_writeUV0(t,r,i,s){var S;const n=i.getField(A.UV0,nd),o=r.indices.get(A.POSITION),a=r.vertexAttributes.get(A.POSITION).data,l=(S=r.vertexAttributes.get(A.DISTANCETOSTART))==null?void 0:S.data,c=n.typedBufferStride,h=n.typedBuffer;let p=0;h[s*=c]=J4.START,h[s+1]=p,s+=c;const f=3*o[0],m=ce(Ha,a[f],a[f+1],a[f+2]);t&&Ze(m,m,t);const y=qa,_=o.length-1;let b=1;const x=l?(C,O,R)=>p=l[R]:(C,O,R)=>p+=Ai(C,O);for(let C=1;C<_;C+=2){const O=3*o[C];ce(y,a[O],a[O+1],a[O+2]),t&&Ze(y,y,t),x(m,y,b++);for(let R=0;R<2;++R)h[s]=1-R,h[s+1]=p,s+=c;le(m,y)}const T=3*o[_];ce(y,a[T],a[T+1],a[T+2]),t&&Ze(y,y,t),x(m,y,b),h[s]=J4.END,h[s+1]=p}}class Yat extends VC{constructor(){super(...arguments),this.color=kh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}}const Ha=M(),qa=M(),tf=M(),g1=M(),y1=ta(),_1=ta(),ele=M(),tle=M(),rle=kp(),Zat=kp(),Jat=M(),DA=[ta(),ta(),ta(),ta()],tg=[M(),M(),M(),M()],VV=jr(),BV=jr(),zV=jr(),GV=jr(),Qat=["mesh"];class Kat extends km{constructor(t,r,i,s){super(t,r,i,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Xr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Kae({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Kae({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,Qat,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new qu),s=t.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(t,r){const i=this._getLayerOpacity();this._materials.forEach(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=r(s);v(n)&&n.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Av)}slicePlaneEnabledChanged(t,r){return this._materials.forEach(i=>{i.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(i=>{const s=r(i);v(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(r=>r.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return E(t)?"-":t instanceof Qe?t.toHex():t.contentHash}_materialPropertiesDefault(t,r){const i=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_materialProperties(t,r,i){const s=this._materialPropertiesDefault(t,i);if(!r.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=r.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,r.material instanceof cSe){const{metallic:y,roughness:_,metallicRoughnessTexture:b,emissiveColor:x,emissiveTexture:T,occlusionTexture:S}=r.material,C=this._colorOrTextureUid(b),O=this._colorOrTextureUid(x),R=this._colorOrTextureUid(T),$=this._colorOrTextureUid(S);s.metallic=y,s.roughness=_,s.metallicRoughnessTexture=b,s.emissiveColor=x,s.emissiveTexture=T,s.occlusionTexture=S,s.colorTextureTransform=r.material.colorTextureTransform,s.normalTextureTransform=r.material.normalTextureTransform,s.emissiveTextureTransform=r.material.emissiveTextureTransform,s.occlusionTextureTransform=r.material.occlusionTextureTransform,s.metallicRoughnessTextureTransform=r.material.metallicRoughnessTextureTransform,s.uid=`${s.uid},mrm:${y},mrr:${_},mrt:${C},emuid:${O},etmuid:${R},otmuid:${$}`}return s}_setInternalColorValueParameters(t,r){r.diffuse=Qe.toUnitRGB(t),r.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const r=this._getInternalTexture(t,di.Opaque);return v(r)?r.id:null}_getInternalTexture(t,r){const i=this._getLoadableTextureResource(t);if(!i)return null;const s=`${t.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new Ep(ww(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:!ww(i)&&r!==di.Opaque,encoding:ww(i)&&v(i.encoding)?i.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const r=this._castTextureWrapIndividual(t);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return Rt.CLAMP_TO_EDGE;case"mirror":return Rt.MIRRORED_REPEAT;default:return Rt.REPEAT}}_setInternalMaterialParameters(t,r){if(v(t.color)&&this._setInternalColorValueParameters(t.color,r),v(t.colorTexture)){const i=this._getInternalTexture(t.colorTexture,r.textureAlphaMode);v(i)?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):r.textureId=void 0}v(t.normalTexture)&&(r.normalTextureId=this._getInternalTextureId(t.normalTexture)),v(t.emissiveColor)&&(r.emissiveFactor=Qe.toUnitRGB(t.emissiveColor)),v(t.emissiveTexture)&&(r.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),v(t.occlusionTexture)&&(r.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),v(t.metallicRoughnessTexture)&&(r.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture)),r.colorTextureTransformMatrix=Zf(t.colorTextureTransform),r.normalTextureTransformMatrix=Zf(t.normalTextureTransform),r.occlusionTextureTransformMatrix=Zf(t.occlusionTextureTransform),r.emissiveTextureTransformMatrix=Zf(t.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=Zf(t.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(t){const r=this._drivenProperties.color;let i=v(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(r)t.externalColor=kh;else{const s=v(this.symbolLayer.material)?this.symbolLayer.material.color:null;v(s)?t.externalColor=Qe.toUnitRGBA(s):(i=null,t.externalColor=kh)}i&&(t.colorMixMode=i),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const r=t.vertexAttributes.color;if(E(r))return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(t,r){var y,_,b;const i=(y=r.material)==null?void 0:y.color,s=(_=r.material)==null?void 0:_.colorTexture,n=(b=r.material)==null?void 0:b.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||v(i)&&i.a<1||v(s)&&s.transparent||o),l=this._materialProperties(t,r,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Sa,diffuse:Qf,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Oi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?Oi.None:Oi.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new Ey(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,r){t.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,r.alphaMode==="auto"?t.textureAlphaMode=t.transparent?di.MaskBlend:di.Opaque:t.textureAlphaMode=r.alphaMode==="opaque"?di.Opaque:r.alphaMode==="mask"?di.Mask:di.Blend}_addDebugNormals(t,r){const i=r.length,s=t.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(t.extent.width*s,t.extent.height*s,t.extent.zmax-t.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<i;m++){const y=r[m],_=y.vertexAttributes.get(A.POSITION),b=y.vertexAttributes.get(A.NORMAL),x=y.indices.get(A.POSITION),T=y.indices.get(A.NORMAL),S=_.data,C=b.data;for(let O=0;O<x.length;O++){const R=3*x[O],$=3*T[O];for(let I=0;I<3;I++)o.push(S[R+I]);for(let I=0;I<3;I++)o.push(S[R+I]+C[$+I]*n);if(a.push(a.length),a.push(a.length),O%3==0){this._calculateFaceNormal(S,x,O,gT),this._getFaceVertices(S,x,O,Wo,fT,mT),me(Wo,Wo,fT),me(Wo,Wo,mT),ae(Wo,Wo,1/3);for(let I=0;I<3;I++)l.push(Wo[I]);for(let I=0;I<3;I++)l.push(Wo[I]+gT[I]*n);c.push(c.length),c.push(c.length)}}}const h=r[0].transformation,p=new tn(this._debugVertexNormalMaterial,[[A.POSITION,new Je(o,3,!0)]],[[A.POSITION,a]],null,Fs.Line);r.push(p),p.transformation=h;const f=new tn(this._debugFaceNormalMaterial,[[A.POSITION,new Je(l,3,!0)]],[[A.POSITION,c]],null,Fs.Line);f.transformation=h,r.push(f)}_createAs3DShape(t,r,i,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(E(o))return null;const{geometries:a,objectTransformation:l}=o;Xr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a);const c=new By({geometries:a,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});c.transformation=l;const h=WTe(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=v(h)?new git(a[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new Um(this,c,a,null,null,OM,i,p);f.needsElevationUpdates=Av(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(b,x)=>BC(b,m,i,y,x);return f.alignedSampledElevation=OM(f,i,m.spatialReference,_,y),f}_getCenterPointInElevationSR(t){const r=Vy(0,0,0,v(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return Jme([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(t,r,i,s){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(t,r,i,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s)}}_createComponentNormalsSource(t,r,i,s){if(E(r))return this._createComponentNormalsFlat(t,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,gT);for(let a=0;a<3;a++){const l=3*s[o+a];Wo[0]=r[l+0],Wo[1]=r[l+1],Wo[2]=r[l+2],_e(gT,Wo)<0&&(r[l+0]=-r[l+0],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return new jV(r,s,n)}_createComponentNormalsFlat(t,r){const i=Qs(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(t,r,n,gT);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return new jV(i,s,!1)}_createComponentNormalsSmooth(t,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(t,r,o,gT);for(let l=0;l<3;l++){const c=r[o+l];let h=i[c];h||(h={normal:M(),count:0},i[c]=h),me(h.normal,h.normal,a),h.count++}}const s=Qs(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(ve(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return new jV(s,n,!1)}_getFaceVertices(t,r,i,s,n,o){const a=3*r[i+0],l=3*r[i+1],c=3*r[i+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,r,i,s){return this._getFaceVertices(t,r,i,Wo,fT,mT),ge(fT,fT,Wo),ge(mT,mT,Wo),dt(Wo,fT,mT),ve(s,Wo),s}_getOrCreateComponents(t){return Pt(t.components,elt)}_createPositionBuffer(t,r){let i=t.vertexAttributes.position;const s=r.reprojection===hu.ECEF?r.transformBeforeProject:null;if(v(s)&&(i=Uat(i,new Float64Array(i.length),s)),r.reprojection===hu.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=v(s)?i:new Float64Array(i.length);return Ts(i,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(t,r,i){let s=t.vertexAttributes.normal;if(E(s))return null;const n=i.reprojection===hu.ECEF?i.transformBeforeProject:null;if(v(n)&&(s=kat(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===hu.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=v(n)?s:new Float32Array(s.length);return Fat(s,o,r,t.spatialReference,a)}_createTangentBuffer(t,r,i){let s=t.vertexAttributes.tangent;if(E(s))return null;const n=i.reprojection===hu.ECEF?i.transformBeforeProject:null;if(v(n)&&(s=Vat(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===hu.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=v(n)?s:new Float32Array(s.length);return Bat(s,o,r,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(t),i=Znt(en(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return W2e(r,i,s),s}return null}_createBuffers(t,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(v(s)&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(v(o)&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(v(n)&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(r),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===hu.NONE&&v(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===hu.NONE&&v(a.geometryTransformation)?a.geometryTransformation:Ie()}}_computeReprojectionInfo(t){const r=v(t.transform),i=r&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===Ge.Local?hu.NONE:hu.ECEF;if(r){if(i===hu.NONE){const n=Ie();return $p(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:n,geometryTransformation:vE(t.transform.localMatrix),needsBufferCopy:!1}}const s=t6(Ie(),t.transform.origin);return ws(s,s,t.transform.localMatrix),{reprojection:i,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(t,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;lL[0]=o.x,lL[1]=o.y,lL[2]=o.z;const a=Ie();$p(t.spatialReference,lL,a,n);const l=yo.fromTypedArray(r);if(ko(ile,a),qP(l,l,ile),v(i)||v(s)){if(id(NA,a),sd(NA,NA),v(i)){const c=mi.fromTypedArray(i);Ov(c,c,NA)}if(v(s)){const c=mi.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);Ov(c,c,NA)}}return a}_validateFaces(t,r){const i=t.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,r){return r.faces?r.faces:XE(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return v(i)&&!t.spatialReference.equals(i)?(s=new Float64Array(r.length),Ts(t.vertexAttributes.position,t.spatialReference,0,s,i,0,n)):s=r,$i(HV),Pu(HV,s,0,n),!dp(HV,this._context.clippingExtent)}_createGeometryInfo(t,r,i){if(!fv(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const s=this._createBuffers(t,r);if(E(s))return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:p,geometryTransformation:f}=s,m=this._getOrCreateComponents(t),y=new Array;let _=!1;for(const b of m){if(!this._validateFaces(t,b))return null;const x=this._getOrCreateFaces(t,b);if(x.length===0)continue;const T=this._createComponentNormals(n,c,b,x);T.didFlipNormals&&(_=!0);const S=[[A.POSITION,new Je(n,3,!0)],[A.NORMAL,new Je(T.normals,3,!0)]],C=[[A.POSITION,x],[A.NORMAL,T.indices]];v(a)&&(S.push([A.COLOR,new Je(a,4,!0)]),C.push([A.COLOR,x])),v(l)&&(S.push([A.SYMBOLCOLOR,new Je(l,4,!0)]),C.push([A.SYMBOLCOLOR,new Array(x.length).fill(0)])),v(o)&&(S.push([A.UV0,new Je(o,2,!0)]),C.push([A.UV0,x])),v(h)&&(S.push([A.TANGENT,new Je(h,4,!0)]),C.push([A.TANGENT,x]));const O=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),R=this._getOrCreateMaterial(t,b),$=new tn(R,S,C,null,Fs.Mesh,O);$.transformation=f,y.push($)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:p}}}class jV{constructor(t,r,i){this.normals=t,this.indices=r,this.didFlipNormals=i}}const lL=M(),Wo=M(),fT=M(),mT=M(),gT=M(),ile=Ie(),NA=ns(),HV=In(),elt=[new Nat];var hu;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(hu||(hu={}));class tlt{constructor(t,r,i,s){this.graphics3DSymbolLayer=t,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const r=this._lodRenderer.instanceData;t!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,r,i){if(this.elevationAligner){sQ(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>BC(o,t,this.elevationContext,r,a),n=this.elevationAligner(this,this.elevationContext,t.spatialReference,s,r);v(n)&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(t=M()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,rf),Ze(t,this._lodRenderer.baseBoundingSphere.center,rf)}getBoundingBoxObjectSpace(t=In()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,rf);const r=this._lodRenderer.baseBoundingBox;$i(t);for(let i=0;i<8;++i)ce(eh,(1&i)==0?r[0]:r[3],(2&i)==0?r[1]:r[4],(4&i)==0?r[2]:r[5]),Ze(eh,eh,rf),wm(t,eh);return t}computeAttachmentOrigin(t){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,rf),t.render.origin[0]+=rf[12],t.render.origin[1]+=rf[13],t.render.origin[2]+=rf[14],t.render.num++}async getProjectedBoundingBox(t,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=rlt,l=wX(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,rf);for(let h=0;h<l;h++){const p=a[h];eh[0]=o[p[0]],eh[1]=o[p[1]],eh[2]=o[p[2]],Ze(eh,eh,rf),v1[3*h+0]=eh[0],v1[3*h+1]=eh[1],v1[3*h+2]=eh[2]}if(!t(v1,0,l))return null;$i(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],v1[h+p]),o[p+3]=Math.max(o[p+3],v1[h+p]);c&&i.push({location:v1.slice(h,h+3),screenSpaceBoundingRect:c})}if(r&&(hp(o,qV),this.elevationContext.mode!=="absolute-height")){let h;const p=tQ(o,r.service.spatialReference,r);try{h=await r.service.queryElevation(qV[0],qV[1],s,p,"ground")}catch{}v(h)&&Mfe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,r){if(t===by.Highlight){const i=new b4(t);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(t){this._highlights.forEach(r=>t.remove(r))}_addHighlightId(t){this._highlights.add(t),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const v1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],eh=M(),qV=M(),rlt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],rf=Ie();function ilt(e){const t=new Array;return e.stageResources.geometries.forEach(r=>{const i=e.stageResources.textures;t.push(new jTe(r,i))}),{components:t,minScreenSpaceRadius:Pt(e.lodThreshold,0),pivotOffset:e.pivotOffset}}function slt(e){return{levels:e.map(t=>ilt(t))}}function nlt(e,t,r){if(e.count!==t.count)return void CU.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=r[9],y=r[10],_=r[11],b=r[12],x=r[13],T=r[14],S=r[15],C=e.typedBuffer,O=e.typedBufferStride,R=t.typedBuffer,$=t.typedBufferStride;for(let I=0;I<i;I++){const U=I*O,V=I*$,G=R[V],z=R[V+1],Z=R[V+2],Q=R[V+3];C[U]=s*G+l*z+f*Z+b*Q,C[U+1]=n*G+c*z+m*Z+x*Q,C[U+2]=o*G+h*z+y*Z+T*Q,C[U+3]=a*G+p*z+_*Z+S*Q}}function fSe(e,t,r){if(e.count!==t.count)return void CU.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],h=r[6],p=r[7],f=r[8],m=e.typedBuffer,y=e.typedBufferStride,_=t.typedBuffer,b=t.typedBufferStride;for(let x=0;x<i;x++){const T=x*y,S=x*b,C=_[S],O=_[S+1],R=_[S+2],$=_[S+3];m[T]=s*C+a*O+h*R,m[T+1]=n*C+l*O+p*R,m[T+2]=o*C+c*O+f*R,m[T+3]=$}}function olt(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);i[l]=y*h,i[l+1]=y*p,i[l+2]=y*f}}}function fq(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=r*o[h],s[c+1]=r*o[h+1],s[c+2]=r*o[h+2],s[c+3]=r*o[h+3]}}function alt(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,h=l*a;s[c]=o[h]>>r,s[c+1]=o[h+1]>>r,s[c+2]=o[h+2]>>r,s[c+3]=o[h+3]>>r}}Object.freeze(Object.defineProperty({__proto__:null,normalize:olt,scale:fq,shiftRight:alt,transformMat3:fSe,transformMat4:nlt},Symbol.toStringTag,{value:"Module"}));function llt(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)i[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:llt},Symbol.toStringTag,{value:"Module"}));function clt(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)i[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:clt},Symbol.toStringTag,{value:"Module"}));function ult(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],l+=s,c+=o}function AN(e,t){const r=e.count;t||(t=new e.TypedArrayConstructor(r));for(let i=0;i<r;i++)t[i]=e.get(i);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:ult,makeDense:AN},Symbol.toStringTag,{value:"Module"}));function mSe(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],i[l+1]=n[c+1],l+=s,c+=o}function gSe(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;if(IXe(t.elementType)){const h=$Xe(t.elementType);if(PXe(t.elementType))for(let p=0;p<a;++p)i[l]=Math.max(n[c]/h,-1),i[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)i[l]=n[c]/h,i[l+1]=n[c+1]/h,l+=s,c+=o}else mSe(e,t,r);return e}function hlt(e,t,r,i){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=i==null?void 0:i.count)!=null?l:e.count;let a=((c=i==null?void 0:i.dstIndex)!=null?c:0)*n;for(let h=0;h<o;++h)s[a]=t,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:mSe,fill:hlt,normalizeIntegerBuffer:gSe},Symbol.toStringTag,{value:"Module"}));function HU(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],i[l+1]=n[c+1],i[l+2]=n[c+2],l+=s,c+=o}function dlt(e,t,r,i,s){var c,h;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:HU,fill:dlt},Symbol.toStringTag,{value:"Module"}));function ySe(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let h=0;h<a;++h)i[l]=n[c],i[l+1]=n[c+1],i[l+2]=n[c+2],i[l+3]=n[c+3],l+=s,c+=o}function _Se(e,t,r,i,s,n){var h,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(h=n==null?void 0:n.count)!=null?h:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let f=0;f<l;++f)o[c]=t,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:ySe,fill:_Se},Symbol.toStringTag,{value:"Module"}));function Gb(e,t){return new e(new ArrayBuffer(t*e.ElementCount*nwe(e.ElementType)))}class vSe{constructor(t){this._streamDataRequester=t}async loadJSON(t,r){return this._load("json",t,r)}async loadBinary(t,r){return Im(t)?(cr(r),RX(t)):this._load("binary",t,r)}async loadImage(t,r){return this._load("image",t,r)}async _load(t,r,i){if(E(this._streamDataRequester))return(await Di(r,{responseType:plt[t]})).data;const s=await Vc(this._streamDataRequester.request(r,t,i));if(s.ok===!0)return s.value;throw Sc(s.error),new j("",`Request for resource failed: ${s.error}`)}}const plt={image:"image",binary:"array-buffer",json:"json"};function flt(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}function mlt(e,t={}){return{data:e,parameters:{wrap:{s:Rt.REPEAT,t:Rt.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}let ux=class{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",r=this._context&&this._context+" ";throw new j(t+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new ux(this.major,this.minor,this._context)}static parse(e,t=""){const[r,i]=e.split("."),s=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(s))throw new j((t&&t+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!i||!i.match||!i.match(s))throw new j((t&&t+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const n=parseInt(r,10),o=parseInt(i,10);return new ux(n,o,t)}};class sle{constructor(t){this._data=t,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const t=this._offset4;return this._offset4+=1,this._dataUint32[t]}readUint8Array(t){const r=4*this._offset4;return this._offset4+=t/4,new Uint8Array(this._data,r,t)}remainingBytes(){return this._data.byteLength-4*this._offset4}}var mO,nle;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(mO||(mO={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(nle||(nle={}));const bSe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},glt={pbrMetallicRoughness:bSe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},ylt={ESRI_externalColorMixMode:"tint"},ole=(e={})=>{const t={...bSe,...e.pbrMetallicRoughness},r=_lt({...ylt,...e.extras});return{...glt,...e,pbrMetallicRoughness:t,extras:r}};function _lt(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const vlt={magFilter:rt.LINEAR,minFilter:rt.LINEAR_MIPMAP_LINEAR,wrapS:Rt.REPEAT,wrapT:Rt.REPEAT},blt=e=>({...vlt,...e});function wlt(e){let t,r;return e.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(t=s||"",r=n||"","")),{dirPart:t,filePart:r}}const cL={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class Ug{constructor(t,r,i,s){if(this._context=t,this.uri=r,this.json=i,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=wlt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new j("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new j("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new j("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(t,r,i){if(Im(r)){const o=pP(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Ug(t,r,l)}catch{}const a=RX(r);if(Ug._isGLBData(a))return this._fromGLBData(t,r,a)}if(r.endsWith(".gltf")){const o=await t.loadJSON(r,i);return new Ug(t,r,o)}const s=await t.loadBinary(r,i);if(Ug._isGLBData(s))return this._fromGLBData(t,r,s);const n=await t.loadJSON(r,i);return new Ug(t,r,n)}static _isGLBData(t){if(t==null)return!1;const r=new sle(t);return r.remainingBytes()>=4&&r.readUint32()===cL.MAGIC}static async _fromGLBData(t,r,i){const s=await Ug._parseGLBData(i);return new Ug(t,r,s.json,s.binaryData)}static async _parseGLBData(t){const r=new sle(t);if(r.remainingBytes()<12)throw new j("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),s=r.readUint32(),n=r.readUint32();if(i!==cL.MAGIC)throw new j("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(t.byteLength<n)throw new j("gltf-loader-error","GLB binary data is smaller than header specifies.");if(s!==2)throw new j("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),h=r.readUint32();if(l===0){if(h!==cL.CHUNK_TYPE_JSON)throw new j("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new j("gltf-loader-error","No JSON data found.");o=await Gat(r.readUint8Array(c))}else if(l===1){if(h!==cL.CHUNK_TYPE_BIN)throw new j("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else ee.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new j("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(t,r){const i=this.json.buffers[t];if(i.uri==null){if(this._glbBuffer==null)throw new j("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(t,r);if(s.byteLength!==i.byteLength)throw new j("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(t,r){const i=this._bufferLoaders.get(t);if(i)return i;const s=this.json.buffers[t].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(t,n),n}async getAccessor(t,r){if(!this.json.accessors)throw new j("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[t];if((i==null?void 0:i.bufferView)==null)throw new j("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[mO.MAT2,mO.MAT3,mO.MAT4])throw new j("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const s=this.json.bufferViews[i.bufferView],n=await this.getBuffer(s.buffer,r),o=Slt[i.type],a=Elt[i.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(t,r){if(t.indices==null)return;const i=await this.getAccessor(t.indices,r);if(i.isDenselyPacked)switch(i.componentType){case at.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case at.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case at.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case at.UNSIGNED_BYTE:return AN(this._wrapAccessor(wy,i));case at.UNSIGNED_SHORT:return AN(this._wrapAccessor(Qw,i));case at.UNSIGNED_INT:return AN(this._wrapAccessor(ex,i))}}async getPositionData(t,r){if(t.attributes.POSITION==null)throw new j("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(t.attributes.POSITION,r);if(i.componentType!==at.FLOAT)throw new j("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+at[i.componentType]);if(i.componentCount!==3)throw new j("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(mi,i)}async getNormalData(t,r){if(t.attributes.NORMAL==null)throw new j("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(t.attributes.NORMAL,r);if(i.componentType!==at.FLOAT)throw new j("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+at[i.componentType]);if(i.componentCount!==3)throw new j("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(mi,i)}async getTangentData(t,r){if(t.attributes.TANGENT==null)throw new j("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(t.attributes.TANGENT,r);if(i.componentType!==at.FLOAT)throw new j("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+at[i.componentType]);if(i.componentCount!==4)throw new j("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new Ma(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(t,r){if(t.attributes.TEXCOORD_0==null)throw new j("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(t.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new j("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===at.FLOAT)return this._wrapAccessor(nd,i);if(!i.normalized)throw new j("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return Clt(i)}async getVertexColors(t,r){if(t.attributes.COLOR_0==null)throw new j("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(t.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new j("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===at.FLOAT)return this._wrapAccessor(Ma,i);if(i.componentType===at.UNSIGNED_BYTE)return this._wrapAccessor(_o,i);if(i.componentType===at.UNSIGNED_SHORT)return this._wrapAccessor(Tv,i)}else if(i.componentCount===3){if(i.componentType===at.FLOAT)return this._wrapAccessor(mi,i);if(i.componentType===at.UNSIGNED_BYTE)return this._wrapAccessor(xv,i);if(i.componentType===at.UNSIGNED_SHORT)return this._wrapAccessor(Kw,i)}throw new j("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+at[i.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,r,i){var n,o,a,l,c,h,p,f,m,y;let s=t.material?this._materialCache.get(t.material):void 0;if(!s){const _=t.material!=null?ole(this.json.materials[t.material]):ole(),b=_.pbrMetallicRoughness,x=this.hasVertexColors(t),T=this.getTexture(b.baseColorTexture,r),S=this.getTexture(_.normalTexture,r),C=i?this.getTexture(_.occlusionTexture,r):void 0,O=i?this.getTexture(_.emissiveTexture,r):void 0,R=i?this.getTexture(b.metallicRoughnessTexture,r):void 0,$=t.material!=null?t.material:-1;s={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:b.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await T,normalTexture:await S,name:_.name,id:$,occlusionTexture:await C,emissiveTexture:await O,emissiveFactor:_.emissiveFactor,metallicFactor:b.metallicFactor,roughnessFactor:b.roughnessFactor,metallicRoughnessTexture:await R,hasVertexColors:x,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=b==null?void 0:b.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(h=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:h.KHR_texture_transform,emissiveTextureTransform:(f=(p=_.emissiveTexture)==null?void 0:p.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(y=(m=b==null?void 0:b.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:y.KHR_texture_transform}}return s}async getTexture(t,r){if(!t)return;if((t.texCoord||0)!==0)throw new j("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=t.index,s=this.json.textures[i],n=blt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=this._getTextureSourceId(s),a=this.json.images[o],l=await this._loadTextureImageData(i,s,r);return RW(this._textureCache,i,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>{throw new j("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:h(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:h(n.wrapT),minFilter:n.minFilter,name:a.name,id:i}})}getNodeTransform(t){if(t===void 0)return xlt;let r=this._nodeTransformCache.get(t);if(!r){const i=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?r=ws(Ie(),i,s.matrix):s.translation||s.rotation||s.scale?(r=vE(i),s.translation&&Yl(r,r,s.translation),s.rotation&&(uL[3]=cJ(uL,s.rotation),Pc(r,r,uL[3],uL)),s.scale&&K5(r,r,s.scale)):r=vE(i),this._nodeTransformCache.set(t,r)}return r}_wrapAccessor(t,r){return new t(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(t){return Ru(t,this._baseUri)}_getNodeParent(t){return this._nodeParentMap.get(t)}_checkVersionSupported(){const t=ux.parse(this.json.asset.version,"glTF");Tlt.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json;if(t.extensionsRequired&&!t.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new j("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,r)=>{t.children&&t.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(t,r,i){const s=this._textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(t,n),n}_getTextureSourceId(t){if(t.extensions!==void 0&&t.extensions.KHR_texture_basisu!==null)return t.extensions.KHR_texture_basisu.source;if(t.source!==null)return t.source;throw new j("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(t,r){const i=this._getTextureSourceId(t),s=this.json.images[i];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),r);return new pSe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),r)}if(s.bufferView==null)throw new j("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new j("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r);if(n.byteStride!=null)throw new j("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return jat(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const t=await KB(Array.from(this._bufferLoaders.values())),r=await KB(Array.from(this._textureLoaders.values()));return t.reduce((i,s)=>{var n;return i+((n=s==null?void 0:s.byteLength)!=null?n:0)},0)+r.reduce((i,s)=>i+(s?ww(s)?s.data.byteLength:s.width*s.height*4:0),0)}}const xlt=$me(Ie(),Math.PI/2),Tlt=new ux(2,0,"glTF"),uL=cd(),Slt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Elt={[at.BYTE]:1,[at.UNSIGNED_BYTE]:1,[at.SHORT]:2,[at.UNSIGNED_SHORT]:2,[at.FLOAT]:4,[at.UNSIGNED_INT]:4};function Clt(e){switch(e.componentType){case at.BYTE:return new tx(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case at.UNSIGNED_BYTE:return new Jw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case at.SHORT:return new rx(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case at.UNSIGNED_SHORT:return new HE(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case at.UNSIGNED_INT:return new qE(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case at.FLOAT:return new nd(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)}}let Alt=0;async function wSe(e,t,r={},i=!0){const s=await Ug.load(e,t,r),n="gltf_"+Alt++,o={lods:[],materials:new Map,textures:new Map,meta:Rlt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await Olt(s,async(h,p,f,m)=>{var V;const y=(V=l.get(f))!=null?V:0;l.set(f,y+1);const _=h.mode!==void 0?h.mode:It.TRIANGLES,b=_===It.TRIANGLES||_===It.TRIANGLE_STRIP||_===It.TRIANGLE_FAN?_:null;if(E(b))return void ee.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+It[_]+"). Skipping primitive.");if(!s.hasPositions(h))return void ee.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const x=s.getPositionData(h,r),T=s.getMaterial(h,r,i),S=s.hasNormals(h)?s.getNormalData(h,r):null,C=s.hasTangents(h)?s.getTangentData(h,r):null,O=s.hasTextureCoordinates(h)?s.getTextureCoordinates(h,r):null,R=s.hasVertexColors(h)?s.getVertexColors(h,r):null,$=s.getIndexData(h,r),I={transform:vE(p),attributes:{position:await x,normal:S?await S:null,texCoord0:O?await O:null,color:R?await R:null,tangent:C?await C:null},indices:await $,primitiveType:b,material:Plt(o,await T,n)};let U=null;v(o.meta)&&v(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(U=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:U},o.lods[f].parts[y]=I});for(const h of o.lods)h.parts=h.parts.filter(p=>!!p);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function Rlt(e){const t=e.json;let r=null;return t.nodes.forEach(i=>{const s=i.extras;v(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function Olt(e,t){const r=e.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),Mlt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=r.nodes[a],h=e.getNodeTransform(a);if(c.weights!=null&&ee.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=r.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function Mlt(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function Plt(e,t,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=mlt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:Ilt.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${r}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=flt({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?i(t.colorTexture):void 0,textureNormal:t.normalTexture?i(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?i(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?i(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?i(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform,metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const Ilt=[rt.LINEAR_MIPMAP_LINEAR,rt.LINEAR_MIPMAP_NEAREST];function $lt(e,t=XE){return typeof e=="number"?t(e):xW(e)||Ob(e)?new Uint32Array(e):e}function Llt(e){const t=typeof e=="number"?e:e.length;if(t<3)return[];const r=t-2,i=awe(r);if(typeof e=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];i[s++]=o,i[s++]=a,i[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];i[s++]=o,i[s++]=a,i[s++]=l}}return i}function Dlt(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof e=="number"){let s=0;for(let n=0;n<r;++n)i[s++]=0,i[s++]=n+1,i[s++]=n+2;return i}{const s=e[0];let n=e[1],o=0;for(let a=0;a<r;++a){const l=e[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}}class Nlt{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class Flt{constructor(t,r,i){this.name=t,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new Nlt,this.numberOfVertices=0}}const Mg=ee.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function xSe(e,t){var n;const r=await Ult(e,t),i=await Glt((n=r.textureDefinitions)!=null?n:{},t);let s=0;for(const o in i)if(i.hasOwnProperty(o)){const a=i[o];s+=a!=null&&a.image?a.image.width*a.image.height*4:0}return{resource:r,textures:i,size:s+pge(r)}}async function Ult(e,t){const r=v(t)&&t.streamDataRequester;if(r)return klt(e,r,t);const i=await Vc(Di(e,t));if(i.ok===!0)return i.value.data;Sc(i.error),TSe(i.error)}async function klt(e,t,r){const i=await Vc(t.request(e,"json",r));if(i.ok===!0)return i.value;Sc(i.error),TSe(i.error.details.url)}function TSe(e){throw new j("",`Request for object resource failed: ${e}`)}function Vlt(e){const t=e.params,r=t.topology;let i=!0;switch(t.vertexAttributes||(Mg.warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Mg.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Mg.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(Mg.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else Mg.warn("Indexed geometries must specify faces"),i=!1;break}default:Mg.warn(`Unsupported topology '${r}'`),i=!1}e.params.material||(Mg.warn("Geometry requires material"),i=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(Mg.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function Blt(e,t){var y;const r=new Array,i=new Array,s=new Array,n=new DC,o=e.resource,a=ux.parse(o.version||"1.0","wosr");Hlt.validate(a);const l=o.model.name,c=o.model.geometries,h=(y=o.materialDefinitions)!=null?y:{},p=e.textures;let f=0;const m=new Map;for(let _=0;_<c.length;_++){const b=c[_];if(!Vlt(b))continue;const x=jlt(b),T=b.params.vertexAttributes,S=[];for(const z in T){const Z=T[z],Q=Z.values;S.push([z,new Je(Q,Z.valuesPerElement,!0)])}const C=[];if(b.params.topology!=="PerAttributeArray"){const z=b.params.faces;for(const Z in z)C.push([Z,z[Z].values])}const O=x.texture,R=p&&p[O];if(R&&!m.has(O)){const{image:z,params:Z}=R,Q=new Ep(z,Z);i.push(Q),m.set(O,Q)}const $=m.get(O),I=$?$.id:void 0,U=x.material;let V=n.get(U,O);if(E(V)){const z=h[U.substring(U.lastIndexOf("/")+1)].params;z.transparency===1&&(z.transparency=0);const Z=R&&R.alphaChannelUsage,Q=z.transparency>0||Z==="transparency"||Z==="maskAndTransparency",te=R?SSe(R.alphaChannelUsage):void 0,q={ambient:kl(z.diffuse),diffuse:kl(z.diffuse),opacity:1-(z.transparency||0),transparent:Q,textureAlphaMode:te,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:Oi.None,colorMixMode:z.externalColorMixMode||"tint",textureAlphaPremultiplied:!!R&&!!R.params.preMultiplyAlpha};v(t)&&t.materialParamsMixin&&Object.assign(q,t.materialParamsMixin),V=new Ey(q),n.set(U,O,V)}s.push(V);const G=new tn(V,S,C);f+=C.position?C.position.length:0,r.push(G)}return{engineResources:[{name:l,stageResources:{textures:i,materials:s,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:zlt(r)}}function zlt(e){const t=$i();return e.forEach(r=>{const i=r.boundingInfo;v(i)&&(wm(t,i.bbMin),wm(t,i.bbMax))}),t}async function Glt(e,t){const r=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){Mg.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:Rt.REPEAT,t:Rt.REPEAT},preMultiplyAlpha:SSe(h)!==di.Opaque},f=v(t)&&t.disableTextures?Promise.resolve(null):Ty(l,t);r.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function SSe(e){switch(e){case"mask":return di.Mask;case"maskAndTransparency":return di.MaskBlend;case"none":return di.Opaque;default:return di.Blend}}function jlt(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const Hlt=new ux(1,2,"wosr"),yT=2.1;async function ESe(e,t){const r=CSe(tje(e));if(r.fileType==="wosr"){const p=await(t.cache?t.cache.loadWOSR(r.url,t):xSe(r.url,t)),{engineResources:f,referenceBoundingBox:m}=Blt(p,t);return{lods:f,referenceBoundingBox:m,isEsriSymbolResource:!1,isWosr:!0}}const i=await(t.cache?t.cache.loadGLTF(r.url,t,!!t.usePBR):wSe(new vSe(t.streamDataRequester),r.url,t,t.usePBR)),s=en(i.model.meta,"ESRI_proxyEllipsoid"),n=i.meta.isEsriSymbolResource&&v(s)&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,Zlt(i,s));const o=!!t.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[0,1,.2]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},l={...t.materialParamsMixin,treeRendering:n},{engineResources:c,referenceBoundingBox:h}=ASe(i,a,l,t.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:h,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function CSe(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function ASe(e,t,r,i){const s=e.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=$i();return s.lods.forEach((h,p)=>{const f=i.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&p!==i.singleLodIndex;if(f&&p!==0)return;const m=new Flt(h.name,h.lodThreshold,[0,0,0]);h.parts.forEach(y=>{const _=f?new Ey({}):qlt(s,y,m,t,r,o,a),{geometry:b,vertexCount:x}=Wlt(y,v(_)?_:new Ey({})),T=b.boundingInfo;v(T)&&p===0&&(wm(c,T.bbMin),wm(c,T.bbMax)),v(_)&&(m.stageResources.geometries.push(b),m.numberOfVertices+=x)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function qlt(e,t,r,i,s,n,o){const a=t.material+(t.attributes.normal?"_normal":"")+(t.attributes.color?"_color":"")+(t.attributes.texCoord0?"_texCoord0":"")+(t.attributes.tangent?"_tangent":""),l=e.materials.get(t.material),c=v(t.attributes.texCoord0),h=v(t.attributes.normal);if(E(l))return null;const p=Xlt(l.alphaMode);if(!n.has(a)){if(c){const C=(O,R=!1)=>{if(v(O)&&!o.has(O)){const $=e.textures.get(O);if(v($)){const I=$.data;o.set(O,new Ep(ww(I)?I.data:I,{...$.parameters,preMultiplyAlpha:!ww(I)&&R,encoding:ww(I)&&v(I.encoding)?I.encoding:void 0}))}}};C(l.textureColor,p!==di.Opaque),C(l.textureNormal),C(l.textureOcclusion),C(l.textureEmissive),C(l.textureMetallicRoughness)}const m=l.color[0]**(1/yT),y=l.color[1]**(1/yT),_=l.color[2]**(1/yT),b=l.emissiveFactor[0]**(1/yT),x=l.emissiveFactor[1]**(1/yT),T=l.emissiveFactor[2]**(1/yT),S=v(l.textureColor)&&c?o.get(l.textureColor):null;n.set(a,new Ey({...i,transparent:p===di.Blend,customDepthTest:Hw.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Oi.None:Oi.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:h?oi.Attribute:oi.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:v(S)?S.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:v(l.textureNormal)&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:v(S)&&!!S.params.preMultiplyAlpha,occlusionTextureId:v(l.textureOcclusion)&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:v(l.textureEmissive)&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:v(l.textureMetallicRoughness)&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[b,x,T],mrrFactors:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:Zf(l.colorTextureTransform),normalTextureTransformMatrix:Zf(l.normalTextureTransform),occlusionTextureTransformMatrix:Zf(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Zf(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Zf(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(r.stageResources.materials.push(f),c){const m=y=>{v(y)&&r.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function Wlt(e,t){const r=e.attributes.position.count,i=Ylt(e.indices||r,e.primitiveType),s=Gb(mi,r);qP(s,e.attributes.position,e.transform);const n=[[A.POSITION,new Je(s.typedBuffer,s.elementCount,!0)]],o=[[A.POSITION,i]];if(v(e.attributes.normal)){const a=Gb(mi,r);kE(hL,e.transform),Ov(a,e.attributes.normal,hL),n.push([A.NORMAL,new Je(a.typedBuffer,a.elementCount,!0)]),o.push([A.NORMAL,i])}if(v(e.attributes.tangent)){const a=Gb(Ma,r);kE(hL,e.transform),fSe(a,e.attributes.tangent,hL),n.push([A.TANGENT,new Je(a.typedBuffer,a.elementCount,!0)]),o.push([A.TANGENT,i])}if(v(e.attributes.texCoord0)){const a=Gb(nd,r);gSe(a,e.attributes.texCoord0),n.push([A.UV0,new Je(a.typedBuffer,a.elementCount,!0)]),o.push([A.UV0,i])}if(v(e.attributes.color)){const a=Gb(_o,r);if(e.attributes.color.elementCount===4)e.attributes.color instanceof Ma?fq(a,e.attributes.color,255):e.attributes.color instanceof _o?ySe(a,e.attributes.color):e.attributes.color instanceof Tv&&fq(a,e.attributes.color,1/256);else{_Se(a,255,255,255,255);const l=new xv(a.buffer,0,4);e.attributes.color instanceof mi?rq(l,e.attributes.color,255):e.attributes.color instanceof xv?HU(l,e.attributes.color):e.attributes.color instanceof Kw&&rq(l,e.attributes.color,1/256)}n.push([A.COLOR,new Je(a.typedBuffer,a.elementCount,!0)]),o.push([A.COLOR,i])}return{geometry:new tn(t,n,o),vertexCount:r}}const hL=ns();function Xlt(e){switch(e){case"BLEND":return di.Blend;case"MASK":return di.Mask;case"OPAQUE":case null:case void 0:return di.Opaque}}function Ylt(e,t){switch(t){case It.TRIANGLES:return $lt(e);case It.TRIANGLE_STRIP:return Llt(e);case It.TRIANGLE_FAN:return Dlt(e)}}function Zlt(e,t){for(let r=0;r<e.model.lods.length;++r){const i=e.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(E(n))return;const o=s.attributes.position,a=o.count,l=M(),c=M(),h=M(),p=Gb(_o,a),f=Gb(mi,a),m=ko(Ie(),s.transform);for(let y=0;y<a;y++){o.getVec(y,c),n.getVec(y,l),Ze(c,c,s.transform),ge(h,c,t.center),KN(h,h,t.radius);const _=h[2],b=Me(h),x=Math.min(.45+.55*b*b,1);KN(h,h,t.radius),m!==null&&Ze(h,h,m),ve(h,h),r+1!==e.model.lods.length&&e.model.lods.length>1&&rn(h,h,l,_>-1?.2:Math.min(-4*_-3.8,1)),f.setVec(y,h),p.set(y,0,255*x),p.set(y,1,255*x),p.set(y,2,255*x),p.set(y,3,255)}s.attributes.normal=f,s.attributes.color=p}}}var ySt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetch:ESe,gltfToEngineResources:ASe,parseUrl:CSe}),Hi;function Jlt(e){let t=os().mat4f64(A.LOCALTRANSFORM).mat4f64(A.GLOBALTRANSFORM).vec4f64(A.BOUNDINGSPHERE).vec3f64(A.MODELORIGIN).mat3f(A.MODEL).mat3f(A.MODELNORMAL).vec2f(A.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(A.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(A.FEATUREATTRIBUTE)),t=t.u8(A.STATE).u8(A.LODLEVEL),e.includes(A.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(A.OBJECTANDLAYERIDCOLOR)),t.alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(Hi||(Hi={}));class Qlt{constructor(t){this.localTransform=t.getField(A.LOCALTRANSFORM,wv),this.globalTransform=t.getField(A.GLOBALTRANSFORM,wv),this.modelOrigin=t.getField(A.MODELORIGIN,yo),this.model=t.getField(A.MODEL,Np),this.modelNormal=t.getField(A.MODELNORMAL,Np),this.modelScaleFactors=t.getField(A.MODELSCALEFACTORS,nd),this.boundingSphere=t.getField(A.BOUNDINGSPHERE,Zw),this.color=t.getField(A.COLOR,Ma),this.featureAttribute=t.getField(A.FEATUREATTRIBUTE,Ma),this.state=t.getField(A.STATE,wy),this.lodLevel=t.getField(A.LODLEVEL,wy),this.objectAndLayerIdColor=t.getField(A.OBJECTANDLAYERIDCOLOR,_o)}}let A2=class extends Te{constructor(e,t){super(e),this.events=new Vs,this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=Jlt(t)}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Hi.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;mt(e>=0&&e<this._capacity&&(t.get(e)&Hi.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Hi.ACTIVE)?this._setStateFlags(e,Hi.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;mt(e>=0&&e<this._capacity&&(t.get(e)&Hi.ALLOCATED)!=0,"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,r=!0){this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,r=!0){this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=g0,i=wd;t.localTransform.getMat(e,ale),t.globalTransform.getMat(e,WV);const s=ws(WV,WV,ale);ce(r,s[12],s[13],s[14]),t.modelOrigin.setVec(e,r),id(i,s),t.model.setMat(e,i);const n=hDe(g0,s);n.sort(),t.modelScaleFactors.set(e,0,n[1]),t.modelScaleFactors.set(e,1,n[2]),Ax(i,i),sd(i,i),t.modelNormal.setMat(e,i),this._setStateFlags(e,Hi.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,wd),r.modelOrigin.getVec(e,g0),t[0]=wd[0],t[1]=wd[1],t[2]=wd[2],t[3]=0,t[4]=wd[3],t[5]=wd[4],t[6]=wd[5],t[7]=0,t[8]=wd[6],t[9]=wd[7],t[10]=wd[8],t[11]=0,t[12]=g0[0],t[13]=g0[1],t[14]=g0[2],t[15]=1}applyShaderTransformation(e,t){v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){return this._view.localTransform.getMat(e,t),v(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);if(v(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(g0,this,e);t*=Math.max(r[0],r[1],r[2])}return t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);if(v(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(g0,this,e);t*=Klt(r[0],r[1],r[2])}return t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}getColor(e,t){this._view.color.getVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,Hi.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Hi.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,Hi.HIGHLIGHT,t),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Hi.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}_setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}_clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}_setStateFlag(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){const e=Math.max(ect,Math.floor(this._capacity*tct)),t=this._layout.createBuffer(e);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(r)}this._capacity=e,this._buffer=t,this._view=new Qlt(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&Hi.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};function Klt(e,t,r){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),r))}u([d({constructOnly:!0})],A2.prototype,"shaderTransformation",void 0),u([d()],A2.prototype,"_size",void 0),u([d({readOnly:!0})],A2.prototype,"size",null),A2=u([P("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],A2);const ect=1024,tct=2,g0=M(),wd=ns(),ale=Ie(),WV=Ie();class rct extends yp{constructor(t,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=pn(),this._tmpMat4=Ie(),this._instanceData=t,this._boundingSphere=r}addInstance(t){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);Ze(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*Fw(i),r.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class ict{constructor(t,r){this._worldSpaceRadius=t,this._minScreenSpaceRadii=r}selectLevel(t,r,i){const s=i.computeScreenPixelSizeAt(t),n=this._worldSpaceRadius*r/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}}class sct extends tU{constructor(t,r,i,s,n,o){super(t,r),this.layerUid=t,this.graphicUid=r,this.geometryId=i,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}}function AQ(e){return zp(e)&&e.intersector===ss.LOD&&!!e.target}class nct{constructor(t,r){const i=t.renderContext.rctx,s=r.geometry;this._materialRepository=t.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=n.allocate(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new A2e(s.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=wr.createVertex(i,$r.STATIC_DRAW,l.buffer),this.vao=new Bp(i,Or,{geometry:Hc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,t.transform.transform,t,i,s,(h,p,f,m,y)=>{if(h>=0){if(r!=null&&!r(t.rayBegin,t.rayEnd,h))return;const _=new sct(o.layerUid,o.graphicUid(n),c,f,a,l);if((t.results.min.drapedLayerOrder==null||y>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||h<t.results.min.dist)&&t.results.min.set(ss.LOD,_,h,p,t.transform.transform,y),t.options.store!==Bo.MIN&&(t.results.max.drapedLayerOrder==null||y>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||h>t.results.max.dist)&&t.results.max.set(ss.LOD,_,h,p,t.transform.transform,y),t.options.store===Bo.ALL){const b=gJ(t.results.min.ray);b.set(ss.LOD,_,h,p,t.transform.transform,y),t.results.all.push(b)}}})}}class RQ{static async create(t,r,i){const s=await Promise.allSettled(r.components.map(o=>t.controller.schedule(()=>new nct(t,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(v);if(zn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),cr(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new RQ(r.minScreenSpaceRadius,n)}constructor(t,r){this.minScreenSpaceRadius=t,this.components=r}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(t,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(E(this._boundingBox)){const t=$i();this.components.forEach(r=>{v(r.boundingInfo)&&(wm(t,r.boundingInfo.bbMin),wm(t,r.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(E(this._boundingSphere)){const t=this.boundingBox,r=M();hp(t,r),this._boundingSphere={center:r,radius:.5*Ofe(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,r)=>t+r.triangleCount,0)}}class oct{constructor(t,r,i){this._elementSize=r,this._buffer=wr.createVertex(t,$r.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,r,i,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(r-t)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,r){const i=t*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(t){const r=t*this._elementSize,i=new ArrayBuffer(r);this._array&&(t>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=t}}class act{constructor(t){this.modelOriginHi=t.getField(A.MODELORIGINHI,mi),this.modelOriginLo=t.getField(A.MODELORIGINLO,mi),this.model=t.getField(A.MODEL,Np),this.modelNormal=t.getField(A.MODELNORMAL,Np),this.color=t.getField(A.INSTANCECOLOR,Ma),this.featureAttribute=t.getField(A.INSTANCEFEATUREATTRIBUTE,Ma),this.objectAndLayerIdColor=t.getField(A.OBJECTANDLAYERIDCOLOR_INSTANCED,_o)}}class lle{constructor(t,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,r=this._tailIndex;return t>=r?t-r:t+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){mt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){mt(this._updating,"not updating"),this.size<cct*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){mt(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),mt(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){mt(this._updating,"not updating"),mt(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(cle,Math.floor(this._capacity*lct));this._resize(t)}_shrink(){const t=Math.max(cle,Math.floor(this._capacity*uct));this._resize(t)}_resize(t){if(mt(this._updating,"not updating"),t===this._capacity)return;const r=new oct(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);mt(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=r,this._view=new act(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,t),r-i):i>r?(this._buffer.copyRange(i,this._capacity,t),r>0&&this._buffer.copyRange(0,r,t,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,r){t<r?this._buffer.transferRange(t,r):t>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(t,this._capacity))}}const cle=1024,lct=2,cct=.3,uct=.5,hct=e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map(i=>i.minScreenSpaceRadius);return new ict(t,r)};let vh=class extends Te{constructor(e,t){super(e),this.type=ss.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Ct,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Se.OPAQUE_MATERIAL,Se.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new A2({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=t.registerTask(gt.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=pct(this.optionalFields),this._glInstanceBufferLayout=Hc(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach((r,i)=>{const s=this._defaultRenderInstanceData[i],n=this._highlightRenderInstanceData[i],o=s.size+n.size,a=r.triangleCount;t.push({renderedInstances:o,renderedTriangles:o*a,trianglesPerInstance:a})}),{totalInstances:e,renderedInstances:t.reduce((r,i)=>r+i.renderedInstances,0),renderedTriangles:t.reduce((r,i)=>r+i.renderedTriangles,0),levels:t}}async initializeRenderContext(e,t){this._context=e;const r=e.renderContext.rctx,i=await Promise.allSettled(this.symbol.levels.map(n=>(this._defaultRenderInstanceData.push(new lle(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new lle(r,this._instanceBufferLayout)),RQ.create(e,n,t)))),s=i.map(n=>n.status==="fulfilled"?n.value:null).filter(v);if(zn(t)||s.length!==i.length){s.forEach(n=>n.destroy()),cr(t);for(const n of i)if(n.status==="rejected")throw n.reason}this._levels=s,this._levelSelector=hct(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(t=>t.material.requiresSlot(Se.TRANSPARENT_MATERIAL,k.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(!Xr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Ka),this._needFullCycle=!1)}}render(e){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output)||(e.rctx.bindVAO(),e.output!==k.Highlight&&e.output!==k.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==k.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}intersect(e,t,r,i){if(!this.baseMaterial.isVisible()||E(this._octree))return;const s=M();ge(s,i,r);const n=o=>{this._instanceData.getCombinedModelTransform(o,dle),e.transform.set(dle),Ze(ple,r,e.transform.inverse),Ze(fle,i,e.transform.inverse);const a=this._instanceData.getState(o),l=this._instanceData.getLodLevel(o),c=this._levels.length;mt((a&Hi.ACTIVE)!=0,"invalid instance state"),mt(l>=0&&l<c,"invaid lod level"),this._levels[l].intersect(e,t,ple,fle,o,this.metadata,c)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(n):this._octree.forEachAlongRay(r,s,n)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(E(this._octreeCached)){const t=this._instanceData,r=(e=t.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new rct(t,this.baseBoundingSphere);for(let i=0;i<t.capacity;++i)r.get(i)&Hi.ACTIVE&&this._octreeCached.addInstance(i)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Ve(this._octreeCached)}_queryDepthRangeOctree(e){if(E(this._octree))return{near:1/0,far:-1/0};const t=e.viewForward,r=this._octree.findClosest(t,yp.DepthOrder.FRONT_TO_BACK,e.frustum),i=this._octree.findClosest(t,yp.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||i==null)return{near:1/0,far:-1/0};const s=e.eye,n=this._instanceData.view;n.boundingSphere.getVec(r,sf),ge(sf,sf,s);const o=_e(sf,t)-sf[3];n.boundingSphere.getVec(i,sf),ge(sf,sf,s);const a=_e(sf,t)+sf[3];return{near:Math.max(e.near,o),far:Math.min(e.far,a)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>e.startUpdateCycle()),this._highlightRenderInstanceData.forEach(e=>e.startUpdateCycle())}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:r,_levelSelector:i}=this;this._defaultRenderInstanceData.forEach(c=>c.beginUpdate()),this._highlightRenderInstanceData.forEach(c=>c.beginUpdate());const s=this._instanceData,n=s.view;let o=s.size;const a=s.capacity;let l=this._instanceIndex;for(let c=0;c<o&&!e.done;++c){l===this._cycleStartIndex&&this._startUpdateCycle();const h=n.state.get(l);let p=0;if(!(h&Hi.ALLOCATED)){l=l+1===a?0:l+1,o++;continue}const f=n.lodLevel.get(l);if(h&Hi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[f].freeTail(),h&Hi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[f].freeTail(),h&Hi.REMOVE)s.freeInstance(l);else if(h&Hi.VISIBLE){let m=0;t&&(n.modelOrigin.getVec(l,hle),m=i.selectLevel(hle,s.getCombinedMedianScaleFactor(l),r)),p=h&~(Hi.ACTIVE|Hi.TRANSFORM_CHANGED),m>=0&&(h&Hi.HIGHLIGHT?(ule(this._highlightRenderInstanceData[m],n,l),p|=Hi.HIGHLIGHT_ACTIVE):(ule(this._defaultRenderInstanceData[m],n,l),p|=Hi.DEFAULT_ACTIVE)),n.state.set(l,p),n.lodLevel.set(l,m)}else p=h&~(Hi.ACTIVE|Hi.TRANSFORM_CHANGED),n.state.set(l,p);if(v(this._octreeCached)){const m=!!(h&Hi.ACTIVE),y=!!(p&Hi.ACTIVE);!m&&y?this._octreeCached.addInstance(l):m&&!y?this._octreeCached.removeInstance(l):m&&y&&h&Hi.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(l),this._octreeCached.addInstance(l))}l=l+1===a?0:l+1,e.madeProgress()}this._instanceIndex=l,this._defaultRenderInstanceData.forEach(c=>c.endUpdate()),this._highlightRenderInstanceData.forEach(c=>c.endUpdate()),this._context.requestRender()}_renderComponents(e,t){this.levels.forEach((r,i)=>{const s=r.components.map(n=>this._beginComponent(e,t[i],n));r.components.forEach((n,o)=>this._renderComponent(e,s[o],t[i],n,i))})}_beginComponent(e,t,r){const{bindParameters:i,rctx:s,output:n}=e;if(t.size===0||!r.material.requiresSlot(i.slot,e.output))return null;const o=r.glMaterials.load(s,i.slot,n);return v(o)?o.beginSlot(i):null}_renderComponent(e,t,r,i,s){if(E(t))return;const{bindParameters:n,rctx:o}=e,a=o.bindTechnique(t,i.material.parameters,n);o.bindVAO(i.vao),t.ensureAttributeLocations(i.vao),a.bindDraw(fct,n,i.material.parameters),Xr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===k.Color&&(a.setUniform4fv("externalColor",mle[Math.min(s,mle.length-1)]),a.setUniform1i("colorMixMode",Hxe.replace));const l=o.capabilities.instancing,c=r.capacity,h=r.headIndex,p=r.tailIndex,f=r.firstIndex,m=this._glInstanceBufferLayout,y=(_,b)=>{VZ(o,Or,r.buffer,m,_),l.drawArraysInstanced(t.primitiveType,0,i.vertexCount,b-_),BZ(o,Or,r.buffer,m)};i.material.parameters.transparent&&f!=null?h>p?(mt(f>=p&&f<=h,"invalid firstIndex"),y(f,h),y(p,f)):h<p&&(f<=h?(mt(f>=0&&f<=h,"invalid firstIndex"),y(f,h),y(p,c),y(0,f)):(mt(f>=p&&f<=c,"invalid firstIndex"),y(f,c),y(0,h),y(p,f))):h>p?y(p,h):h<p&&(y(0,h),y(p,c)),o.bindVAO(null)}};function ule(e,t,r){const i=e.allocateHead();dct(t,r,e.view,i)}function dct(e,t,r,i){qXe(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}function pct(e){let t=os().vec3f(A.MODELORIGINHI).vec3f(A.MODELORIGINLO).mat3f(A.MODEL).mat3f(A.MODELNORMAL);return v(e)&&e.includes("color")&&(t=t.vec4f(A.INSTANCECOLOR)),v(e)&&e.includes("featureAttribute")&&(t=t.vec4f(A.INSTANCEFEATUREATTRIBUTE)),v(e)&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(A.OBJECTANDLAYERIDCOLOR_INSTANCED)),t}u([d({constructOnly:!0})],vh.prototype,"symbol",void 0),u([d({constructOnly:!0})],vh.prototype,"optionalFields",void 0),u([d({constructOnly:!0})],vh.prototype,"metadata",void 0),u([d({constructOnly:!0})],vh.prototype,"shaderTransformation",void 0),u([d()],vh.prototype,"_instanceData",void 0),u([d()],vh.prototype,"_cycleStartIndex",void 0),u([d({readOnly:!0})],vh.prototype,"_enableLevelSelection",null),u([d()],vh.prototype,"_updateCyclesWithStaticCamera",void 0),u([d({readOnly:!0})],vh.prototype,"running",null),vh=u([P("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],vh);const hle=M(),sf=sr(),dle=Ie(),ple=M(),fle=M(),mle=[Ht(1,0,1,1),Ht(0,0,1,1),Ht(0,1,0,1),Ht(1,1,0,1),Ht(1,0,0,1)],fct=new uot;class gle{constructor(t,r,i,s,n,o,a,l,c,h,p,f){this.lodResources=t,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=p,this.pivotOffset=f}}class mct extends km{getCachedSize(){const[t,r,i]=v(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:r,height:i}}constructor(t,r,i,s){super(t,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(t){if(!this._drivenProperties.size&&TU(this.symbolLayer))throw new Error;const r=this.symbolLayer;if(this._isPrimitive){const i=r.resource?r.resource.primitive:nme;this._resources=await this._createResourcesForPrimitive(i,t)}else this._resources=await this._createResourcesForUrl(r.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return v(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return v(this._resources)?this._resources.lodRenderer:null}_setMaterialTransparencyParams(t,r=en(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=i,t.cullFace=s?Oi.None:Oi.Back,t}async _createResourcesForPrimitive(t,r){if(!_it(t))throw new Error(`Unknown object symbol primitive: ${t}`);const i=this.symbolLayer,s=In(RPe(t)),n=kl(gI(s)),o=kl(Z8(n,i)),a=Me(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Qf,diffuse:Qf,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:T,minWorldLength:S,maxWorldLength:C}=f.verticalOffset;h.verticalOffset={screenLength:Fo(T),minWorldLength:S||0,maxWorldLength:v(C)?C:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=kh;else{const T=v(i.material)?i.material.color:null,S=v(T)?Qe.toUnitRGBA(T):kh;h.externalColor=S}this._fastUpdates=NM(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,M1)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color")),de("enable-feature:objectAndLayerId-rendering")&&(h.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const m=new Ey(h),y=qTe(t,m);if(!y)throw new Error(`Unknown object symbol primitive: ${t}`);const _=j$(y).map(T=>({opacity:1,transparent:T.parameters.transparent})),b=await this._createStageResources(y,p,r),x=await this._createLodRenderer(y,r);return new gle(y,x,b,_,n,l,c,s,o,a,p,M1)}async _createResourcesForUrl(t,r){const i=["transformation"],s={materialParamsMixin:{instanced:i,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=NM(this._context.renderer,this._fastVisualVariableConvertOptions(M1,M1,M1,M1)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color")),de("enable-feature:objectAndLayerId-rendering")&&(i.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:V,minWorldLength:G,maxWorldLength:z}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:Fo(V),minWorldLength:G||0,maxWorldLength:v(z)?z:1/0},s.materialParamsMixin.castShadows=!1}s.signal=r,s.usePBR=this._context.physicalBasedRenderingEnabled,s.skipHighLods=this._context.skipHighSymbolLods;const o=s.usePBR,a=await ESe(t,s),l=a.isEsriSymbolResource,c=a.isWosr,h=slt(a.lods);h.levels.sort((V,G)=>V.minScreenSpaceRadius-G.minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),y=en(this.symbolLayer,"material","color"),_=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),b=this.needsDrivenTransparentPass,x=j$(h),T=j$(h).map(V=>({opacity:V.parameters.opacity||1,transparent:V.parameters.transparent}));x.forEach(V=>{const G=V.parameters;V.setParameters(m);const z=G.opacity*_,Z=z<1||b||G.transparent;V.setParameters({opacity:z,transparent:Z}),p.screenSizePerspectiveEnabled&&V.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const S=a.referenceBoundingBox,C=kl(gI(S)),O=kl(h.levels[0].pivotOffset),R=kl(Z8(C,this.symbolLayer)),$=Me(R);FM(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(S,R,C,O))&&x.forEach(V=>V.setParameters(this._fastUpdates.materialParameters));const I=await this._createStageResources(h,o,r),U=await this._createLodRenderer(h,r);return new gle(h,U,I,T,C,l,c,S,R,$,o,O)}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,r,i){const s=this._context.stage,n=j$(t);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=Voe(t);s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),await s.load(o,i),cr(i);const a=Boe(t);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(t,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,dL),Hn(c,cq(this._fastUpdates.materialParameters,dL,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,dL),Yot(a,this._fastUpdates.materialParameters,dL))}:null,o=new vh({symbol:t,optionalFields:this._optionalFields,metadata:s,shaderTransformation:n},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(o),o.destroy()}),await i.addRenderPlugin(o.slots,o,r),o}_getExternalColorParameters(t){const r={};return this._drivenProperties.color?r.externalColor=kh:v(t)&&v(t.color)?r.externalColor=Qe.toUnitRGBA(t.color):(r.externalColor=kh,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;const i=PM(r.geometry);if(E(i))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new qu),n=t.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,t.layer.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(E(this._resources))return;const t=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const o=i[n],a=en(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this._isPrimitive&&o.setParameters({cullFace:h?Oi.None:Oi.Back})}}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Av)}slicePlaneEnabledChanged(){if(E(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(E(this._resources))return!0;const{stageResources:t,isWosr:r}=this._resources;for(const i of t.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!1}applyRendererDiff(t,r){if(E(this._resources))return Rn.Recreate_Symbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!FM(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return Rn.Recreate_Symbol;for(const h of i)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Rn.Fast_Update}computeComplexity(){if(E(this._resources))return super.computeComplexity();const t=this._resources.lodResources,r=HTe(t.levels[0]).reduce((n,o)=>n+o.indices.get(A.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>{var l,c;return o+((c=(l=a.data.buffer)==null?void 0:l.byteLength)!=null?c:0)},0)+Array.from(n.indices.values()).reduce((o,a)=>o+(Array.isArray(a)?12*a.length:a.buffer.byteLength),0),s=Voe(t).reduce((n,o)=>n+(o.params.encoding&&o.params.encoding==="image/ktx2"?o.estimatedTexMemRequired:o.estimatedTexMemRequired/4),0)+Boe(t).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...YTe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return v(this._resources)}_createAs3DShape(t,r,i,s,n,o){if(!this._hasLodRenderer()||E(this._resources))return null;const a=this.getFastUpdateAttrValues(t),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?lO(i.color,i.opacity):null,c=this._context.clippingExtent;if(aa(r,_T,this._context.elevationProvider.spatialReference),v(c)&&!vX(c,_T))return null;const h=this._requiresTerrainElevation(s),p=this._computeGlobalTransform(r,s,XV,pL),f=this._computeLocalTransform(this._resources,this.symbolLayer,i,yle),m=this._resources.lodRenderer.instanceData,y=m.addInstance();this._instanceIndexToGraphicUid.set(y,n),m.setLocalTransform(y,f,!1),m.setGlobalTransform(y,p),a&&m.setFeatureAttribute(y,a),l&&m.setColor(y,l),v(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&m.setObjectAndLayerIdColor(y,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const _=new tlt(this,y,lit,s);return h&&(_.alignedSampledElevation=pL.sampledElevation),_.needsElevationUpdates=Av(s.mode),MM(_,r,this._context.elevationProvider),_}_computeGlobalTransform(t,r,i,s){return BC(t,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),_T[0]=t.x,_T[1]=t.y,_T[2]=s.z,$p(t.spatialReference,_T,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(t,r,i,s){return td(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(t,i,s),this._applyAnchor(t,r,s),s}_applyObjectScale(t,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:t.symbolSize,n=Uoe(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||K5(i,i,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const r=t.diff.diff;this._preparePatchTransform(t,r),this._preparePatchColor(t,r)}updateGeometry(t,r){if(E(this._resources))return!0;const i=r&&PM(r);if(E(i))return!1;const s=this.getGeometryElevationMode(r);return t.elevationContext.mode===s&&(this._computeGlobalTransform(i,t.elevationContext,XV,pL),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=pL.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,XV,!0),MM(t,i,this._context.elevationProvider),!0)}_preparePatchTransform(t,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||E(this._resources))return;const i=(y,_,b)=>Pt(y!=null&&y.type==="complete"?y.newValue:_,b),s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),h=i(r.anchor,this.symbolLayer.anchor,void 0),p=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===xu.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=kl(Z8(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((y,_)=>{const b=this._computeLocalTransform(m,f,_,yle),x=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(x,b,!0)})}_preparePatchColor(t,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=v(s)?Qe.toUnitRGBA(s):kh;delete i.color;const o=this._resources;E(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,r,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&r))return Jrt(t.heading,t.tilt,t.roll,i)}_computeAnchor(t,r,i){const s=M();switch(i.anchor){case"center":le(s,hp(t)),Ea(s,s);break;case"top":{const n=hp(t);ce(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=hp(t);ce(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=hp(t),o=gI(t),a=i.anchorPosition,l=a?Le(a.x,a.y,a.z):Sa;S5(s,o,l),me(s,s,n),Ea(s,s);break}default:v(r)?Ea(s,r):le(s,Sa)}return s}_applyAnchor(t,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,r);s&&Yl(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,r,i,s){const n=v(t)?kl(gI(t)):Qf,o=v(t)?this._computeAnchor(t,s,this.symbolLayer):Sa,a=this._context.renderCoordsHelper.unitInMeters,l=Uoe(v(r)?r:void 0,r,i,a),c=Le(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:v(r)?r:Qf,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const _T=M(),yle=Ie(),XV=Ie(),dL=sr(),pL=new HP;function gct(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function yct(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function mq(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}function _ct(e,t){if(e===t){const r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function vct(e,t){const r=t[0],i=t[1],s=t[2],n=t[3];let o=r*n-s*i;return o?(o=1/o,e[0]=n*o,e[1]=-i*o,e[2]=-s*o,e[3]=r*o,e):null}function bct(e,t){const r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function wct(e){return e[0]*e[3]-e[2]*e[1]}function RSe(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1],c=r[2],h=r[3];return e[0]=i*a+n*l,e[1]=s*a+o*l,e[2]=i*c+n*h,e[3]=s*c+o*h,e}function xct(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=s*l+o*a,e[2]=i*-a+n*l,e[3]=s*-a+o*l,e}function Tct(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1];return e[0]=i*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function Sct(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function Ect(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function Cct(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Act(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function Rct(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function Oct(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function OSe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Mct(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Pct(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3],h=Pa();return Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=h*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function Ict(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function $ct(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}const Lct=RSe,Dct=OSe;Object.freeze(Object.defineProperty({__proto__:null,LDU:Rct,add:Oct,adjoint:bct,copy:gct,determinant:wct,equals:Pct,exactEquals:Mct,frob:Act,fromRotation:Sct,fromScaling:Ect,identity:yct,invert:vct,mul:Lct,multiply:RSe,multiplyScalar:Ict,multiplyScalarAndAdd:$ct,rotate:xct,scale:Tct,set:mq,str:Cct,sub:Dct,subtract:OSe,transpose:_ct},Symbol.toStringTag,{value:"Module"}));class Nct extends tn{constructor(t,r,i,s,n,o,a,l){super(t,r,i,null,Fs.Mesh,l),this.path=s,this.geometrySR=n,this.upVectorAlignment=o,this.stencilWidth=a}}var av;function MSe(e){return"upVectorAlignment"in e}(function(e){e[e.World=0]="World",e[e.Path=1]="Path"})(av||(av={}));function PSe(){return[1,0,0,1]}function Fct(e){return[e[0],e[1],e[2],e[3]]}function Uct(e,t,r,i){return[e,t,r,i]}function kct(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Fct,create:PSe,createView:kct,fromValues:Uct},Symbol.toStringTag,{value:"Module"}));function ISe(){return{up:M(),right:M()}}function Vct(e,t,r){Ze(e.up,t.up,r),Ze(e.right,t.right,r)}function Bct(e,t,r){or(e,_e(r,t.right),_e(r,t.up))}class zct{constructor(){this.pos=M(),this.posES=M(),this.vLeft=M(),this.vRight=M(),this.vMinSiblingLength=0,this.frame=ISe(),this.rotationFrameUp=M(),this.rotationRight=Ke(),this.rotationAngle=0,this.miterStretch=PSe(),this.maxStretchDistance=0}setFrameFromUpVector(t){le(this.frame.up,t),me(R2,this.vLeft,this.vRight),ve(R2,R2),ae(gq,this.frame.up,_e(R2,this.frame.up)),ge(mL,R2,gq),ve(mL,mL),dt(this.frame.right,mL,this.frame.up)}}class $Se{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}addVertex(t,r){return this.vertices.push(CR(t)),this.vertexNormals.push(CR(r)),this.vertices.length-1}addPole(t,r=null){return this.poles.push({position:CR(t),normal:r?CR(r):null}),this.poles.length-1}addSegment(t,r=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}translate(t,r){for(const i of this.vertices)i[0]+=t,i[1]+=r;for(const i of this.poles)i.position[0]+=t,i.position[1]+=r}}function Gct(e=20){const r=new $Se,i={v0:0,v1:0};r.addPole(Ur(0,0));for(let n=0;n<e;++n){const o=2*n*Math.PI/e,a=Math.cos(o),l=Math.sin(o),c=Ur(a*.5,l*.5),h=Ur(a,l);r.addVertex(c,h)}for(let n=0;n<e-1;++n){const o={v0:n,v1:n+1};r.addSegment(o,i)}const s={v0:e-1,v1:0};return r.addSegment(s,i),r}function jct(){const r=new $Se,i=Ur(.5*-1,.5*-1),s=Ur(.5*1,.5*-1),n=Ur(.5*1,.5*1),o=Ur(.5*-1,.5*1),a=Ur(0,-1),l=Ur(1,0),c=Ur(0,1),h=Ur(-1,0);return r.addPole(Ur(0,.5*1),c),r.addPole(Ur(0,.5*1)),r.addPole(Ur(0,.5*-1)),r.addPole(Ur(0,.5*-1),a),r.addVertex(i,a),r.addVertex(s,a),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(o,h),r.addVertex(i,h),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),r}class Hct{constructor(t){this.vertices=t,this.offset=M(),this.xform=Ie();const r=Math.floor((t.length-1)/2);le(this.offset,this.vertices[r].pos);for(const i of this.vertices)ge(i.pos,i.pos,this.offset);Yl(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length,r=this.vertices[0];r.index=0,r.vLeft=M(),ge(r.vRight,this.vertices[1].pos,r.pos);let i=Me(r.vRight);r.vMinSiblingLength=i,ve(r.vRight,r.vRight);let s=r;for(let n=1;n<t;++n){const o=this.vertices[n];if(o.index=n,o.vLeft=s.vRight,n<t-1){ge(o.vRight,this.vertices[n+1].pos,o.pos);const a=Me(o.vRight);o.vMinSiblingLength=Math.min(i,a),i=a,ve(o.vRight,o.vRight)}else le(o.vRight,o.vLeft),o.vMinSiblingLength=i;s=o}}}function qct(e,t){let r=null;const i=e.vertices.length,s=.99619469809,n=M(),o=M(),a=M(),l=M(),c=M(),h=M(),p=jr();let f=e.vertices[0];le(o,t),ce(n,0,1,0),w4(f.vRight,o,n,n,a,o,s),le(f.frame.up,o),le(f.frame.right,a),r=f;for(let m=1;m<i;++m){f=e.vertices[m],me(c,f.vLeft,f.vRight);let y=Me(c);y>0?(y=1/Math.sqrt(y),c[0]=c[0]*y,c[1]=c[1]*y,c[2]=c[2]*y):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),me(h,r.pos,r.frame.up),_P(f.pos,c,p),Tx(p,zu(h,f.vLeft),l)?(ge(l,l,f.pos),ve(o,l),dt(a,c,o),ve(a,a)):w4(c,r.frame.up,r.frame.right,n,a,o,s),le(f.frame.up,o),le(f.frame.right,a),r=f}}class Wct{numProfilesPerJoin(){return 1}extrude(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.index,t.frame,r.vertices[s],r.vertexNormals[s],!1)}}class YV{constructor(t=.8*Math.PI,r=1){this.cutoffAngle=t,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,r,i){const s=eut;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){Vu(ble,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrameUp),Vct(s,t.frame,ble);for(let o=0;o<r.vertices.length;++o)vn(r.vertices[o],t.rotationRight)*t.rotationAngle>=0?i(t.index,s,r.vertices[o],r.vertexNormals[o],!1):(wH(nw,r.vertices[o],t.miterStretch),i(t.index,t.frame,nw,r.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<r.vertices.length;++o){const a=vn(r.vertices[o],t.rotationRight)*t.rotationAngle>=0;wH(nw,r.vertices[o],t.miterStretch),i(t.index,t.frame,nw,r.vertexNormals[o],!a)}}}class OQ{rebuildConnectingProfileGeometry(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.index,t.frame,r.vertices[s],r.vertexNormals[s],0,0)}}class _le extends OQ{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class fL extends OQ{constructor(t,r=0,i=!1){super(),this.profile=t,this.profilePlaneOffset=r,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.index,t.frame,r.vertices[s],r.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,r){const i=MQ;or(i,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)r(t.index,t.frame,this.profile.vertices[n],i,this.profilePlaneOffset,s)}buildTopology(t,r){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?r(l,a,i):r(i,a,l)}}}class vle extends OQ{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let r=0;r<this.profile.numSegments;++r){const i=this.profile.vertexIndices[2*r+0],s=this.profile.vertexIndices[2*r+1];this.profile.poleIndices[i]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,r){const i=t.frame,s=.5*this.sign,n=nw,o=MQ;or(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?r(t.index,i,l.position,l.normal,s,0):r(t.index,i,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)r(t.index,i,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];Xf(n,this.profile.vertices[p],f.position),Ac(n,n,c),f.normal?(ep(n,n,f.position),r(t.index,i,n,f.normal,s*h,0)):(rM(o,n),Ac(o,o,c),ep(n,n,f.position),r(t.index,i,n,o,s*h,this.sign*h))}}}buildTopology(t,r){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=i+o,p=i+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,y=s+f*this.profile.vertices.length+a;this.flip?(r(m,p,h),r(p,m,y)):(r(h,p,m),r(y,m,p)),h=m,p=y}this.flip?(r(l,p,h),l!==c&&r(l,c,p)):(r(h,p,l),l!==c&&r(p,c,l))}}}class Xct{constructor(t,r,i,s,n,o={}){this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=r,this.path=t,this.extruder=i,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=Qs(1*this.numVerticesTotal),this.profileRightAxisData=Qs(4*this.numVerticesTotal),this.profileUpAxisData=Qs(4*this.numVerticesTotal),this.profileVertexAndNormalData=Qs(4*this.numVerticesTotal),this.originData=Qs(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,r,i,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,r,i,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}_rebuildGeometry(){const t=(i,s,n,o,a)=>this.emitVertex(i,s,n,o,a),r=(i,s,n,o,a,l)=>this.emitCapVertex(i,s,n,o,a,l);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,t);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r)}buildTopology(){const t=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,h,p)=>{n.push(c),n.push(h),n.push(p),o.push(c),o.push(h),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[h]),a.push(this.pathVertexData[p])};for(let c=0;c<r;++c){const h=this.profile.vertexIndices[2*c],p=this.profile.vertexIndices[2*c+1];for(let f=0;f<i;++f){const m=f*t+h,y=(f+1)*t+p,_=f*t+p;l(m,(f+1)*t+h,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=LS(n),this.normalIndices=LS(o),this.pathVertexIndices=LS(a)}onPathChanged(){this._rebuildGeometry()}}class LSe{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class DSe extends LSe{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=Qs(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=Qs(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let r=0;r<this.builder.numVerticesTotal;++r){let i=this.builder.pathVertexData[r];const s=i===0||i===this.builder.path.vertices.length-1;i*=3;const n=Zct;ce(n,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const o=4*r,a=gq,l=nw,c=R2,h=Qct,p=Kct;let f=0,m=0;if(ce(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),ce(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),or(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)dt(c,p,h),f=this.builder.profileRightAxisData[o+3]*t[0],m=this.builder.profileUpAxisData[o+3];else{const _=MQ,b=Jct;or(_,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const x=LZ(_);rM(_,_);const T=vn(l,_);if(Math.abs(T)>x){or(b,-_[1],_[0]);const S=vn(l,b);Ac(_,_,x*Math.sign(T)),Ac(b,b,S),ep(l,_,b)}ce(c,0,0,0)}ce(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*r+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*r+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*r+2]=n[2]+a[2]+c[2]*f;const y=nw;or(y,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*r+0]=h[0]*y[0]+p[0]*y[1]+c[0]*m,this.vertexAttributeNormal[3*r+1]=h[1]*y[0]+p[1]*y[1]+c[1]*m,this.vertexAttributeNormal[3*r+2]=h[2]*y[0]+p[2]*y[1]+c[2]*m}}createGeometryData(){const t=[[A.POSITION,this.builder.vertexIndices],[A.NORMAL,this.builder.normalIndices]],r=[[A.POSITION,new Je(this.vertexAttributePosition,3,!0)],[A.NORMAL,new Je(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;t.push([A.COLOR,new Array(i).fill(0)]),r.push([A.COLOR,new Je(this.vertexAttributeColor,4)])}return{vertexAttributes:r,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,r,i){const s=this.builder.vertexIndices,n=new Je(this.vertexAttributePosition,3),o=s.length/3;zP(t,r,0,o,s,n,void 0,void 0,i)}}class Yct extends LSe{constructor(t,r,i,s){super(t),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new DSe(t),this.vvData=Qs(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[A.POSITION,new Je(this.builder.originData,3,!0)],[A.PROFILERIGHT,new Je(this.builder.profileRightAxisData,4,!0)],[A.PROFILEUP,new Je(this.builder.profileUpAxisData,4,!0)],[A.PROFILEVERTEXANDNORMAL,new Je(this.builder.profileVertexAndNormalData,4,!0)],[A.FEATUREVALUE,new Je(this.vvData,4,!0)]],indices:[[A.POSITION,this.builder.pathVertexIndices],[A.PROFILERIGHT,this.builder.vertexIndices],[A.PROFILEUP,this.builder.vertexIndices],[A.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[A.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const Zct=M(),nw=Ke(),MQ=Ke(),Jct=Ke(),gq=M(),R2=M(),Qct=M(),Kct=M(),mL=M(),eut=ISe(),ble=Ie(),ZV=8;function tut(e,t){const r=A.FEATUREVALUE;e.attributes.add(r,"vec4");const i=e.vertex;i.code.add(w`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new kr("size",s=>s.size)),t.vvSize?(i.uniforms.add(new qt("vvSizeMinSize",s=>s.vvSizeMinSize)),i.uniforms.add(new qt("vvSizeMaxSize",s=>s.vvSizeMaxSize)),i.uniforms.add(new qt("vvSizeOffset",s=>s.vvSizeOffset)),i.uniforms.add(new qt("vvSizeFactor",s=>s.vvSizeFactor)),i.code.add(w`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(w`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",ZV),i.uniforms.add([new wa("vvOpacityValues",s=>s.vvOpacityValues,ZV),new wa("vvOpacityOpacities",s=>s.vvOpacityOpacities,ZV)]),i.code.add(w`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(w`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",Cp),i.uniforms.add([new wa("vvColorValues",s=>s.vvColorValues,Cp),new yU("vvColorColors",s=>s.vvColorColors,Cp)]),i.code.add(w`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(w`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(NP),e.attributes.add(A.PROFILERIGHT,"vec4"),e.attributes.add(A.PROFILEUP,"vec4"),e.attributes.add(A.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(w`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(w`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(w`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(w`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class rut extends JJ{constructor(){super(...arguments),this.size=Ur(1,1)}}function iut(e){const t=new Lr,{vertex:r,fragment:i}=t;switch(Nc(r,e),t.varyings.add("vpos","vec3"),t.include(tut,e),e.output!==k.Color&&e.output!==k.Alpha||(t.include(jl,e),t.include(lx,e),t.include(LC,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(w`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===k.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(ju,e),e.output){case k.Alpha:t.include(Ks,e),i.uniforms.add(new Pe("opacity",s=>s.opacity)),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case k.Color:t.include(Ks,e),t.include(cx,e),t.include(JP,e),t.include(lx,e),t.include(j2e,e),Fp(i,e),QP(i),GC(i),i.uniforms.add([r.uniforms.get("localOrigin"),new qt("ambient",s=>s.ambient),new qt("diffuse",s=>s.diffuse),new qt("specular",s=>s.specular),new Pe("opacity",s=>s.opacity)]),i.include(Nm),Dm(i),i.code.add(w`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${e.transparencyPassType===xt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case k.Depth:case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:t.include(jl,e),Yw(t),t.varyings.add("depth","float"),r.code.add(w`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(Ks,e),t.include(Sy,e),i.code.add(w`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case k.Normal:t.include(jl,e),t.include(LM,e),KE(r),t.varyings.add("vnormal","vec3"),r.code.add(w`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Ks,e),i.code.add(w`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case k.Highlight:t.include(jl,e),t.include(LM,e),t.varyings.add("vnormal","vec3"),r.code.add(w`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Ks,e),t.include(Uy,e),i.code.add(w`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const sut=Object.freeze(Object.defineProperty({__proto__:null,build:iut},Symbol.toStringTag,{value:"Module"})),NSe=new Map([[A.POSITION,0],[A.PROFILERIGHT,1],[A.PROFILEUP,2],[A.PROFILEVERTEXANDNORMAL,3],[A.FEATUREVALUE,4]]);class nut extends rut{constructor(){super(...arguments),this.ambient=Le(.2,.2,.2),this.diffuse=Le(.8,.8,.8),this.specular=Le(0,0,0),this.opacity=1}}class qU extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2,r.spherical=t.viewingMode===Ge.Global,r.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new Nr(t.rctx,qU.shader.get().build(this.configuration),NSe)}initializePipeline(){const t=this.configuration.transparencyPassType,r=this.configuration,i=t===xt.NONE,s=t===xt.FrontFace;return Vt({blending:r.output!==k.Color&&r.output!==k.Alpha||!r.transparent?null:i?Fu:ky(t),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==fs.None?pbe:null,depthTest:{func:zv(t)},depthWrite:i||s?Jl:null,colorWrite:Qt,stencilWrite:r.hasOccludees?Rm:null,stencilTest:r.hasOccludees?Gv:null,polygonOffset:i||s?null:bU})}}qU.shader=new Dr(sut,()=>ie(()=>import("./Path.glsl.da49bb9f.js"),[]));class eo extends ao{constructor(){super(...arguments),this.output=k.Color,this.doubleSidedMode=fs.None,this.transparencyPassType=xt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([B({count:k.COUNT})],eo.prototype,"output",void 0),u([B({count:fs.COUNT})],eo.prototype,"doubleSidedMode",void 0),u([B({count:xt.COUNT})],eo.prototype,"transparencyPassType",void 0),u([B()],eo.prototype,"spherical",void 0),u([B()],eo.prototype,"receiveShadows",void 0),u([B()],eo.prototype,"receiveAmbientOcclusion",void 0),u([B()],eo.prototype,"vvSize",void 0),u([B()],eo.prototype,"vvColor",void 0),u([B()],eo.prototype,"vvOpacity",void 0),u([B()],eo.prototype,"hasSlicePlane",void 0),u([B()],eo.prototype,"transparent",void 0),u([B()],eo.prototype,"hasOccludees",void 0),u([B()],eo.prototype,"hasMultipassTerrain",void 0),u([B()],eo.prototype,"cullAboveGround",void 0),u([B()],eo.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B({constValue:ht.Disabled})],eo.prototype,"pbrMode",void 0),u([B({constValue:!0})],eo.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],eo.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],eo.prototype,"useFillLights",void 0);class PQ extends Bv{constructor(t){super(t,new aut),this.supportsEdges=!0,this._vertexAttributeLocations=NSe,this._configuration=new eo,this._vertexBufferLayout=PQ.getVertexBufferLayout()}getConfiguration(t,r){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==k.Color&&t!==k.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?fs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?fs.WindingOrder:fs.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(t){return t!==k.Shadow&&t!==k.ShadowExcludeHighlight&&t!==k.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(t,r,i,s,n,o){const a=t;if(!MSe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,x=this.parameters.vvSizeFactor,T=this.parameters.vvSizeMinSize,S=this.parameters.vvSizeMaxSize,C=l.sizeAttributeValue;c[0]*=ye(b[0]+C*x[0],T[0],S[0]),c[1]*=ye(b[2]+C*x[2],T[2],S[2])}const h=Math.max(c[0],c[1]),p=t.boundingInfo;if(E(p))return void this._intersectTriangles(l,c,s,n,o);const f=$w(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),m=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];GJ(f,s,_,i.tolerance)&&this._intersectTriangles(l,c,s,n,o)}_intersectTriangles(t,r,i,s,n){t.baked.size&&t.baked.size[0]===r[0]&&t.baked.size[1]===r[1]||t.baked.bake(r),t.baked.intersect(i,s,n)}createBufferWriter(){return new zC(this._vertexBufferLayout)}requiresSlot(t,r){switch(r){case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case k.Color:case k.Alpha:case k.Depth:case k.Normal:case k.Highlight:case k.ObjectAndLayerIdColor:return t===(this.parameters.transparent?Se.TRANSPARENT_MATERIAL:Se.OPAQUE_MATERIAL)||t===Se.DRAPED_MATERIAL;default:return!1}}createGLMaterial(t){return new out(t)}static getVertexBufferLayout(){return os().vec3f(A.POSITION).vec4f(A.PROFILERIGHT).vec4f(A.PROFILEUP).vec4f(A.PROFILEVERTEXANDNORMAL).vec4f(A.FEATUREVALUE)}}class out extends Vv{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(E(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==k.Color&&this._output!==k.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(qU,t)}}class aut extends nut{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}const lut=["polyline"];class cut extends km{constructor(t,r,i,s){super(t,r,i,s),this._intrinsicSize=Ur(1,1),this._upVectorAlignment=av.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=v(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=v(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=NM(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?av.World:av.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=Gct(GTe);break;case"quad":this._profile=jct()}let n=[0,0];switch(i!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(n[0],n[1])),this.symbolLayer.join){case"round":this._extruder=new YV(0,zTe);break;case"bevel":this._extruder=new YV(0,1);break;case"miter":this._extruder=new YV(.8*Math.PI,1);break;default:this._extruder=new Wct}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new _le,this._endCap=new _le;break;case"butt":default:this._startCap=new fL(this._profile,0),this._endCap=new fL(this._profile,0,!0);break;case"square":this._startCap=new fL(this._profile,-.5),this._endCap=new fL(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new vle({profile:this._profile,flip:!1,breakNormals:m,subdivisions:tq}),this._endCap=new vle({profile:this._profile,flip:!0,breakNormals:m,subdivisions:tq});break}}const a=en(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=kl(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?Oi.None:Oi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(or(this._intrinsicSize,t,r),!z4(this._intrinsicSize[0])||!z4(this._intrinsicSize[1])))throw new j("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Ac(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m={...f,...this._fastUpdates.materialParameters,size:vge(this._intrinsicSize)};this._material=new PQ(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new Ey(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,lut,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new qu),s=t.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){const t=en(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Av)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!FM(this._fastUpdates,r,this._vvConvertOptions))return Rn.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Rn.Fast_Update}_getVertexData(t){let r=0;const i=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const f of i)r+=f.length;const l=Bc(3*r),c=Bc(3*r);let h=0;for(const f of i){s.push({index:h,numVertices:f.length});for(const m of f)l[h++]=m[0],l[h++]=m[1],l[h++]=t.hasZ?m[2]:0}let p=!0;return v(o)&&!n.equals(o)&&(p=Ts(l,n,0,l,o,0,r)),v(o)&&!o.equals(a)?Ts(l,o,0,c,a,0,r):this._copyVertices(l,0,c,0,r),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c,projectionSuccess:p,terrainElevation:0}}_copyVertices(t,r,i,s,n){r*=3,s*=3;for(let o=0;o<n;++o)i[s++]=t[r++],i[s++]=t[r++],i[s++]=t[r++]}_createAs3DShape(t,r,i,s){const n=t.geometry,o=new Array,a=n.spatialReference,l=In(),c=this._context.renderCoordsHelper;USe.spatialReference=a;const h=this._getVertexData(n);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(h.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(y=>y.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const y of h.pathVertexDataInfos){const _=y.index,b=y.numVertices;if(b<2||v(this._context.clippingExtent)&&($i(l),Pu(l,h.vertexDataES,3*_,b),!dp(l,this._context.clippingExtent)))continue;const x=[];for(let U=_;U<_+3*b;){const V=U++,G=U++,z=U++,Z=new zct;ce(Z.posES,h.vertexDataES[V],h.vertexDataES[G],h.vertexDataES[z]);const Q=Qrt(Z.posES,this._context.elevationProvider,i,c);ce(ji,h.vertexDataRS[V],h.vertexDataRS[G],h.vertexDataRS[z]),c.setAltitude(ji,Q),le(Z.pos,ji),x.push(Z)}const T=new Hct(x);FSe(T,this._upVectorAlignment,this._context.renderCoordsHelper);const S=new Xct(T,this._profile,this._extruder,this._startCap,this._endCap);let C=null;if(this._fastUpdates.enabled){const U=this._fastUpdates.visualVariables,V=U.size?ay(U.size.field,t):0,G=U.color?ay(U.color.field,t):0,z=U.opacity?ay(U.opacity.field,t):0;C=new Yct(S,V,G,z)}else{const U=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const z=r.size;U[0]*=wle(z[0],z[2]==="symbol-value"?this.symbolLayer.height||0:z[2],this.symbolLayer.width||0),U[1]*=wle(z[2],z[0]==="symbol-value"?this.symbolLayer.width||0:z[0],this.symbolLayer.height||0)}let V;this._drivenProperties.color&&(V=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(V=V?[V[0],V[1],V[2],r.opacity]:[1,1,1,r.opacity]);const G=new DSe(S);G.bake(U),V&&G.bakeVertexColors(V),C=G}const{vertexAttributes:O,indices:R}=C.createGeometryData(),$=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),I=new Nct(this._material,O,R,C,a,this._upVectorAlignment,this._stencilWidth,$);I.transformation=C.xform,o.push(I)}if(o.length===0)return null;const p={layerUid:this._context.layer.uid,graphicUid:s},f=new By({geometries:o,metadata:p}),m=new Um(this,f,o,null,null,hut,i);return m.alignedSampledElevation=h.terrainElevation,m.needsElevationUpdates=Av(i.mode),m}}function FSe(e,t,r){switch(t){default:case av.World:for(const i of e.vertices){me(ji,i.pos,e.offset),r.worldUpAtPosition(ji,ji),i.setFrameFromUpVector(ji),i.rotationFrameUp=i.frame.up,or(i.rotationRight,1,0),ae(ji,i.frame.up,_e(i.frame.up,i.vLeft)),ge(ji,i.vLeft,ji),Ea(ji,ji),ve(ji,ji),ae(y0,i.frame.up,_e(i.frame.up,i.vRight)),ge(y0,i.vRight,y0),ve(y0,y0),dt(xle,i.rotationFrameUp,i.vLeft);const s=Math.sign(_e(xle,i.vRight));if(i.rotationAngle=s*(Math.PI-Mn(_e(ji,y0))),Math.abs(i.rotationAngle)>0){const o=I8(Math.cos(.5*i.rotationAngle));mq(i.miterStretch,o-1+1,0,0,1)}const n=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(i.vMinSiblingLength/Math.cos(.5*n))}break;case av.Path:me(ji,e.vertices[0].pos,e.offset),r.worldUpAtPosition(ji,ji),qct(e,ji);for(const i of e.vertices){const s=Math.sign(_e(i.frame.right,i.vRight));dt(i.rotationFrameUp,i.vRight,i.vLeft),ae(i.rotationFrameUp,i.rotationFrameUp,s),ve(i.rotationFrameUp,i.rotationFrameUp);const n=_e(i.rotationFrameUp,i.frame.up),o=_e(i.rotationFrameUp,i.frame.right);if(ae(ji,i.frame.up,-o),ae(y0,i.frame.right,n),me(ji,ji,y0),ve(ji,ji),Bct(i.rotationRight,i.frame,ji),Ea(ji,i.vLeft),i.rotationAngle=-s*(Math.PI-Mn(_e(ji,i.vRight))),Math.abs(i.rotationAngle)>0){const l=I8(Math.cos(.5*i.rotationAngle));mq(i.miterStretch,1+(l-1)*i.rotationRight[0]*i.rotationRight[0],(l-1)*i.rotationRight[0]*i.rotationRight[1],(l-1)*i.rotationRight[0]*i.rotationRight[1],1+(l-1)*i.rotationRight[1]*i.rotationRight[1])}const a=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(i.vMinSiblingLength*I8(Math.cos(.5*a)))}}}function wle(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function uut(e,t,r,i){let s=0;for(const n of e.vertices)r(n.posES,JV),s+=JV.sampledElevation,me(ji,n.pos,e.offset),i.setAltitude(ji,JV.z),ge(n.pos,ji,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function hut(e,t,r,i,s){const n=e.stageObject,o=n.geometries;let a=0;dut.spatialReference=s.spatialReference;for(const l of o){if(!MSe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;USe.spatialReference=p,a+=uut(h,t,i,s),l.upVectorAlignment!==av.World&&FSe(h,l.upVectorAlignment,s),c.onPathChanged(),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return a/o.length}const dut=Vy(0,0,0,null),USe=Vy(0,0,0,null),ji=M(),y0=M(),xle=M(),JV=new HP;function put(e,t,r,i,s=1){if(r.isGeographic&&i===Ge.Global){const c=Bc(t.length),h=t.length,p=Zr(r);for(let f=0;f<h;f+=3)XX(t,f,c,f,p);t=c}or(wn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<t.length;c+=3)wn[0]=Math.min(wn[0],t[c]),wn[1]=Math.min(wn[1],t[c+1]);const n=wn[0]%s,o=wn[1]%s,a=wn[0]-n,l=wn[1]-o;for(let c=0;c<t.length;c+=3){const h=c/3*4;e[h]=(t[c]-a)/s,e[h+1]=(t[c+1]-l)/s,e[h+2]=a/s,e[h+3]=l/s}}function kSe(e,t,r,i,s=1){ce(b1,1,0,0),ce(w1,0,1,0),ce(bT,0,0,1),gut(QV,r),fut(r,Tle)&&mut(Tle,b1,w1,bT,i,QV),or(wn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),or(x1,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<r.length;h+=3){ce(vT,r[h],r[h+1],r[h+2]);const p=_e(b1,vT),f=_e(w1,vT);wn[0]=Math.min(wn[0],p),wn[1]=Math.min(wn[1],f),x1[0]=Math.max(x1[0],p),x1[1]=Math.max(x1[1],f)}const n=_e(bT,QV);eB(_0,wn[0],wn[1],n,b1,w1,bT),eB(T1,x1[0],wn[1],n,b1,w1,bT),eB(S1,wn[0],x1[1],n,b1,w1,bT),ge(T1,T1,_0),ae(T1,T1,.5),ge(S1,S1,_0),ae(S1,S1,.5),me(_0,_0,T1),me(_0,_0,S1);const o=wn[0]%s,a=wn[1]%s,l=wn[0]-o,c=wn[1]-a;for(let h=0;h<r.length;h+=3){ce(vT,r[h],r[h+1],r[h+2]);const p=h/3,f=4*p;e[f]=(_e(b1,vT)-l)/s,e[f+1]=(_e(w1,vT)-c)/s,e[f+2]=l/s,e[f+3]=c/s;const m=9*p;for(let y=0;y<3;y++)t[m+y]=_0[y],t[m+y+3]=T1[y],t[m+y+6]=S1[y]}}const QV=M(),vT=M(),Tle=jr(),b1=M(),w1=M(),bT=M(),wn=Ke(),x1=Ke(),_0=M(),T1=M(),S1=M();function fut(e,t){const r=e.length/3-1;return qge(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}function mut(e,t,r,i,s,n){v(s)?(s.basisMatrixAtPosition(n,nf),ce(gL,nf[0],nf[1],nf[2]),ce(yL,nf[4],nf[5],nf[6]),ce(KV,nf[8],nf[9],nf[10])):(ce(gL,1,0,0),ce(yL,0,1,0),ce(KV,0,0,1));const o=e;_e(o,KV)<0&&ae(o,o,-1),le(i,o);const a=_e(o,yL),l=_e(o,gL);Math.abs(a)<Math.abs(l)?(Wb(t,gL,o,-l),ve(t,t),dt(r,t,o),ve(r,r),ae(r,r,-1)):(Wb(r,yL,o,-a),ve(r,r),dt(t,r,o),ve(t,t))}const nf=Ie(),gL=M(),yL=M(),KV=M();function gut(e,t){ce(FA,0,0,0);for(let r=0;r<t.length-3;r+=3)FA[0]+=t[r],FA[1]+=t[r+1],FA[2]+=t[r+2];ae(e,FA,1/(t.length/3-1))}const FA=M();function eB(e,t,r,i,s,n,o){ce(e,t*s[0]+r*n[0]+i*o[0],t*s[1]+r*n[1]+i*o[1],t*s[2]+r*n[2]+i*o[2])}function yut(e){const t=new Lr,{vertex:r,fragment:i}=t,s=e.output===k.Depth,n=e.hasMultipassTerrain&&(e.output===k.Color||e.output===k.Alpha);return Nc(r,e),t.include(jl,e),t.include(Mx,e),t.include(gU,e),t.attributes.add(A.POSITION,"vec3"),t.varyings.add("vpos","vec3"),n&&t.varyings.add("depth","float"),s&&(t.include(Sy,e),Yw(t),bv(t)),r.code.add(w`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${n?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${s?w`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:w`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Ks,e),n&&t.include(ju,e),i.include(Nm),i.uniforms.add(new fr("eColor",o=>o.color)),e.output===k.Highlight&&t.include(Uy,e),i.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${e.output===k.ObjectAndLayerIdColor?w`fColor.a = 1.0;`:""}

    if (fColor.a < ${w.float(sa)}) {
      discard;
    }

    ${e.output===k.Alpha?w`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===k.Color?w`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===xt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===k.Highlight?w`outputHighlight();`:""};
    ${e.output===k.Depth?w`outputDepth(linearDepth);`:""};
    ${e.output===k.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const _ut=Object.freeze(Object.defineProperty({__proto__:null,build:yut},Symbol.toStringTag,{value:"Module"}));class WU extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2}initializeProgram(t){return new Nr(t.rctx,WU.shader.get().build(this.configuration),Or)}_createPipeline(t,r){const i=this.configuration,s=t===xt.NONE,n=t===xt.FrontFace;return Vt({blending:i.output!==k.Color&&i.output!==k.Alpha||!i.transparent?null:s?Fu:ky(t),culling:H6(i.cullFace),depthTest:{func:zv(t)},depthWrite:(s||n)&&i.writeDepth?Jl:null,colorWrite:Qt,stencilWrite:i.hasOccludees?Rm:null,stencilTest:i.hasOccludees?r?Mv:Gv:null,polygonOffset:s||n?i.polygonOffset?vut:null:wU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}WU.shader=new Dr(_ut,()=>ie(()=>import("./ColorMaterial.glsl.448ea1d9.js"),[]));const vut={factor:1,units:1};class dc extends ao{constructor(){super(...arguments),this.output=k.Color,this.cullFace=Oi.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=xt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}}u([B({count:k.COUNT})],dc.prototype,"output",void 0),u([B({count:Oi.COUNT})],dc.prototype,"cullFace",void 0),u([B()],dc.prototype,"hasSlicePlane",void 0),u([B()],dc.prototype,"hasVertexColors",void 0),u([B()],dc.prototype,"transparent",void 0),u([B()],dc.prototype,"polygonOffset",void 0),u([B()],dc.prototype,"enableOffset",void 0),u([B()],dc.prototype,"writeDepth",void 0),u([B()],dc.prototype,"hasOccludees",void 0),u([B({count:xt.COUNT})],dc.prototype,"transparencyPassType",void 0),u([B()],dc.prototype,"hasMultipassTerrain",void 0),u([B()],dc.prototype,"cullAboveGround",void 0),u([B()],dc.prototype,"objectAndLayerIdColorInstanced",void 0);class Sle extends yQ{constructor(t){super(t,new wut),this.supportsEdges=!0,this._configuration=new dc}getConfiguration(t,r){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<vU,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(t,r){return r===k.Color||r===k.Alpha||r===k.Highlight||r===k.Depth&&this.parameters.writeLinearDepth||r===k.ObjectAndLayerIdColor?t===Se.DRAPED_MATERIAL?!0:r===k.Highlight?t===Se.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Se.OPAQUE_MATERIAL):!1}createGLMaterial(t){return new but(t)}createBufferWriter(){return new zC(de("enable-feature:objectAndLayerId-rendering")?lnt:M2e)}}class but extends Vv{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(t),this.ensureTechnique(WU,t)}}class wut extends VC{constructor(){super(...arguments),this.color=am,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Oi.None,this.hasOccludees=!1}}var No;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(No||(No={}));const yq=.70710678118,Ele=yq,xut=.08715574274;function Tut(e){const t=new Lr,r=e.hasMultipassTerrain&&(e.output===k.Color||e.output===k.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:s}=t;Nc(i,e),t.include(jl,e),t.include(Mx,e),e.draped?i.uniforms.add(new Pe("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(A.BOUNDINGRECT,"mat3"),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r&&t.varyings.add("depth","float");const n=e.style===No.ForwardDiagonal||e.style===No.BackwardDiagonal||e.style===No.DiagonalCross;n&&i.code.add(w`
      const mat2 rotate45 = mat2(${w.float(yq)}, ${w.float(-Ele)},
                                 ${w.float(Ele)}, ${w.float(yq)});
    `),e.draped||(Fp(i,e),i.uniforms.add(new Pe("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),i.code.add(w`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(w`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(w`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${w.float(xut)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(w`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${n?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${n?" * rotate45":""};

      ${e.draped?"":w`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${w.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=e.output===k.Depth;return o&&(t.include(Sy,e),Yw(t),bv(t)),i.code.add(w`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?w`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:w`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Ks,e),s.include(Nm),e.draped&&s.uniforms.add(new Pe("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===k.Highlight&&t.include(Uy,e),r&&t.include(ju,e),e.output!==k.Highlight&&(s.code.add(w`
      const float lineWidth = ${w.float(e.lineWidth)};
      const float spacing = ${w.float(e.patternSpacing)};
      const float spacingINV = ${w.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||s.code.add(w`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.uniforms.add(new fr("uColor",a=>a.color)),s.code.add(w`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==k.Highlight?w`color.a *= ${Sut(e)};`:""}

      ${e.output===k.ObjectAndLayerIdColor?w`color.a = 1.0;`:""}

      if (color.a < ${w.float(sa)}) {
        discard;
      }

      ${e.output===k.Alpha?w`gl_FragColor = vec4(color.a);`:""}

      ${e.output===k.Color?w`gl_FragColor = color; ${e.transparencyPassType===xt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===k.Highlight?w`outputHighlight();`:""}
      ${e.output===k.Depth?w`outputDepth(linearDepth);`:""};
    }
  `),t}function Sut(e){function t(r){return e.draped?w`coverage(vuv.${r}, texelSize)`:w`sample(vuv.${r})`}switch(e.style){case No.ForwardDiagonal:case No.Horizontal:return t("y");case No.BackwardDiagonal:case No.Vertical:return t("x");case No.DiagonalCross:case No.Cross:return w`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const Eut=Object.freeze(Object.defineProperty({__proto__:null,build:Tut},Symbol.toStringTag,{value:"Module"}));class XU extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2}initializeProgram(t){return new Nr(t.rctx,XU.shader.get().build(this.configuration),VSe)}_setPipelineState(t,r){const i=this.configuration,s=t===xt.NONE,n=t===xt.FrontFace;return Vt({blending:i.output===k.Color||i.output===k.Alpha?s?Fu:ky(t):null,culling:H6(i.cullFace),depthTest:{func:zv(t)},depthWrite:s?i.writeDepth?Jl:null:_U(t),colorWrite:Qt,stencilWrite:i.hasOccludees?Rm:null,stencilTest:i.hasOccludees?r?Mv:Gv:null,polygonOffset:s||n?i.polygonOffset?Cut:null:wU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}XU.shader=new Dr(Eut,()=>ie(()=>import("./Pattern.glsl.0bcedad3.js"),[]));const Cut={factor:1,units:1};class Wa extends ao{constructor(){super(...arguments),this.output=k.Color,this.cullFace=Oi.None,this.transparencyPassType=xt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([B({count:k.COUNT})],Wa.prototype,"output",void 0),u([B({count:Oi.COUNT})],Wa.prototype,"cullFace",void 0),u([B({count:No.COUNT})],Wa.prototype,"style",void 0),u([B({count:xt.COUNT})],Wa.prototype,"transparencyPassType",void 0),u([B()],Wa.prototype,"hasSlicePlane",void 0),u([B()],Wa.prototype,"hasVertexColors",void 0),u([B()],Wa.prototype,"polygonOffset",void 0),u([B()],Wa.prototype,"writeDepth",void 0),u([B()],Wa.prototype,"hasOccludees",void 0),u([B()],Wa.prototype,"patternSpacing",void 0),u([B()],Wa.prototype,"lineWidth",void 0),u([B()],Wa.prototype,"enableOffset",void 0),u([B()],Wa.prototype,"draped",void 0),u([B()],Wa.prototype,"hasMultipassTerrain",void 0),u([B()],Wa.prototype,"cullAboveGround",void 0);const VSe=new Map([[A.POSITION,0],[A.COLOR,3],[A.UVMAPSPACE,4],[A.BOUNDINGRECT,5]]);class IQ extends yQ{constructor(t){super(t,new Out),this.supportsEdges=!0,this._vertexAttributeLocations=VSe,this._configuration=new Wa}getConfiguration(t,r){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<vU,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(t,r){return r===k.Color||r===k.Alpha||r===k.Highlight||r===k.Depth&&this.parameters.writeLinearDepth?t===Se.DRAPED_MATERIAL?!0:r===k.Highlight?t===Se.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(t){return new Aut(t)}createBufferWriter(){const t=os().vec3f(A.POSITION).vec4u8(A.COLOR).vec4f(A.UVMAPSPACE);return this.parameters.draped||t.mat3f(A.BOUNDINGRECT),new Rut(t)}}class Aut extends Vv{_updateParameters(t){return this.ensureTechnique(XU,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==k.Color&&this._output!==k.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class Rut extends zC{write(t,r,i,s,n){for(const o of this.vertexBufferLayout.fieldNames){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case A.POSITION:{mt(a.size===3);const c=s.getField(o,mi);c&&mU(l,a.data,t,c,n);break}case A.COLOR:{mt(a.size===3||a.size===4);const c=s.getField(o,_o);c&&qJ(l,a.data,a.size,c,n);break}case A.UVMAPSPACE:{mt(a.size===4);const c=s.getField(o,Ma);c&&eC(l,a.data,c,n);break}case A.BOUNDINGRECT:{mt(a.size===9);const c=s.getField(o,Np);c&&this.writeBoundingRect(l,a.data,t,c,n);break}}}}writeBoundingRect(t,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],f=r[p],m=r[p+1],y=r[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let _=3;_<9;++_)a[n+_]=r[p+_];n+=l}}}class Out extends VC{constructor(){super(...arguments),this.color=Ht(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Oi.None,this.hasOccludees=!1,this.style=No.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Mut(e,t,r){return Iut(Put(e),t,r)}function Put(e){return e&&e.pattern||null}function Iut(e,t,r){return v(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=Ht(0,0,0,0),t.transparent=!0),new Sle(t)):(t.style=$ut(e.style),t.draped=r.isDraped,new IQ(t)):new Sle(t)}function $ut(e){switch(e){case"horizontal":return No.Horizontal;case"vertical":return No.Vertical;case"cross":return No.Cross;case"forward-diagonal":return No.ForwardDiagonal;case"backward-diagonal":return No.BackwardDiagonal;case"diagonal-cross":return No.DiagonalCross;default:return}}function Lut(e){return e.material instanceof IQ&&!e.material.parameters.draped}function Dut(e,t){if(Lut(e)){const r=e.vertexAttributes.get(A.POSITION).data,i=e.getMutableAttribute(A.UVMAPSPACE).data,s=e.getMutableAttribute(A.BOUNDINGRECT).data;kSe(i,s,r,t)}}function Nut(e,t,r,i,s){const n=DTe(e,t,r,i,s),o=e.stageObject.geometries;for(const a of o)Dut(a,s);return n}const Fut=["polyline","polygon","extent"];class YU extends km{constructor(t,r,i,s){super(t,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(v(this._material))return;const t=en(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t);this._material=Mut(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof IQ,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(v(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const r=i=>{const s=aSe(t.pattern);return new aS({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:uq(t.patternCap||"butt")})};this._outlineMaterial=r(Fo(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return v(t)&&t.size!=null&&t.size>0&&v(t.color)&&(E(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,Fut,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(r,new qu);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}layerOpacityChanged(){if(v(this._material)){const t=this._material.parameters.color,r=en(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r);this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(v(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=jP(YU.elevationModeChangeTypes,i,s);if(n!==xs.UPDATE)return n;const o=ad(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){if(v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),v(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(t,r,i){var h;const s=IM(t.geometry);if(E(s))return null;const n=TQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new Uut(n,r,this._context.layer.uid,t.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Qs(4*a,!0),o.boundingRect=Bc(9*a,!0),kSe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new By({geometries:o.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),c=new Um(this,l,o.outGeometries,null,null,Nut,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=ad(i.mode),c}_createAs3DShapeFill(t){const r=t.renderData.polygons;for(const{position:i,mapPositions:s,holeIndices:n,index:o,count:a}of r){if(v(this._context.clippingExtent)&&($i(th),Pu(th,s),!dp(th,this._context.clippingExtent)))continue;const l=Rv(s,n,3);if(l.length===0)continue;const c=rae({material:this._material,indices:l,mapPositions:s,attributeData:{position:i,color:t.color,uvMapSpace:this._needsUV?Jse(t.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?qh(t.boundingRect,9*o,9*a):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(c)}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:s,position:n}=r[i];if(v(this._context.clippingExtent)&&($i(th),Pu(th,s),!dp(th,this._context.clippingExtent)))continue;const o=hq(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},t.objectAndLayerIdColor),a=o.vertexAttributes.get(A.POSITION);a.data===n&&(a.data=LXe(n)),t.outGeometries.push(o)}}_createAsOverlay(t,r){var a;const i=IM(t.geometry);if(E(i))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,v(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=V2e(i,this._context.overlaySR),n=new kut(s,r,this._context.layer.uid,t.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Qs(4*o,!0),put(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=$i(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new FU(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(t){const r=t.renderData.polygons;for(const{position:i,holeIndices:s,index:n,count:o}of r){const a=$i(th);if(Pu(a,i),!dp(a,this._context.clippingExtent))continue;const l=Rv(i,s,3);if(l.length===0)continue;dE(t.outBoundingBox,a);const c=rae({material:this._material,indices:l,attributeData:{position:i,color:t.color,uvMapSpace:this._needsUV?Jse(t.uvMapSpace,4*n,4*o):null,objectAndLayerIdColor:t.objectAndLayerIdColor}}),h=new nC(c,t);ti(h.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(h)}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if($i(th),Pu(th,s),!dp(th,this._context.clippingExtent))continue;dE(t.outBoundingBox,th);const n=hq(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},t.objectAndLayerIdColor),o=new nC(n,t),a=th;ti(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o)}}_getOutlineOpacity(){const t=en(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(v(t)?t.a:0)}_getOutlineColor(){const t=en(this.symbolLayer,"outline","color"),r=this._getOutlineOpacity();return lO(v(t)?Qe.toUnitRGB(t):null,r)}test(){return{...super.test(),createAsOverlay:(t,r)=>this._createAsOverlay(t,r),createAs3DShape:(t,r,i)=>this._createAs3DShape(t,r,i)}}}YU.elevationModeChangeTypes={definedChanged:xs.RECREATE,staysOnTheGround:xs.NONE,onTheGroundChanged:xs.RECREATE};const th=In();class Uut extends RU{constructor(t,r,i,s){super(t,i,s),this.color=r}}class kut extends RU{constructor(t,r,i,s){super(t,i,s),this.color=r}}class ZU{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const r=this.definition.font;return`${r.style} ${r.weight} ${t}px ${r.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()},${t[3]})`}static async fromSymbol(t,r){const i=en(t,"material","color"),s=Tu(i,am,Qe.toUnitRGBA),n=Tu(t.size,12,Fo),o=t.lineHeight,a=v(t.background)?Qe.toUnitRGBA(t.background.color):am,l={family:Tu(t.font,"sans-serif",m=>m.family),decoration:Tu(t.font,"none",m=>m.decoration),weight:Tu(t.font,"normal",m=>m.weight),style:Tu(t.font,"normal",m=>m.style)},c=t.halo,h=v(c)&&v(c.color)&&c.size>0?{size:Fo(c.size),color:Qe.toUnitRGBA(c.color)}:{size:0,color:am},p=new ZU({color:s,size:n,background:{color:a,padding:v(t.background)?[.65*n,.5*n]:[0,0],borderRadius:v(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:r}),f=p.fontString(n);try{await document.fonts.load(f)}catch{ee.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class Vut{constructor(t,r,i){this._renderer=new eSe(t,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=lq(But,this._renderer.renderedWidth,this._renderer.renderedHeight),r=t.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Ep(t,{wrap:{s:Rt.CLAMP_TO_EDGE,t:Rt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:rv.PAD})}}const But={canvas:null},zut=[0,0,1];class Gut extends km{constructor(t,r,i,s){super(t,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=TU(this.symbolLayer.size);if(t)throw new j("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await ZU.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const r=t.graphic,i=PM(r.geometry);if(E(i))return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(E(s)||s==="")return null;const n=VX(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(v(n)&&!hme(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new ITe(n,this.symbolLayer.horizontalAlignment,Bot(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,s,o)}createLabel(t,r,i,s){const n=t.graphic,o=PM(n.geometry);if(E(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(t,r,i=0){const s=super.setGraphicElevationContext(t,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,r){return Cle(t,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),xs.UPDATE}slicePlaneEnabledChanged(t,r){return Cle(t,r,i=>{for(const s of i.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}skipHighSymbolLodsChanged(){return!0}updateGraphicElevationContext(t,r){const i=r.elevationContext;this.setGraphicElevationContext(t,i,v(r.metadata)?r.metadata.elevationOffset:0),r.needsElevationUpdates=ad(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Hut}_createAs3DShape(t,r,i,s,n,o){const a=this.setGraphicElevationContext(t,new qu,s.elevationOffset),l=en(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(E(o)){const I=rSe(s.horizontalPlacement);h=new Vut(i,I,this._textRenderParameters);let U=null;if(v(this._context.sharedResources.textures)){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{v(U)&&U.release()});const V=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(E(V)||Hu(V))return p.release(),null;U=V}}const f=jut(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(v(o)?m.textureId=o.id:v(p)&&(m.textureId=p.texture.id),v(s.verticalOffset)){const{screenLength:I,minWorldLength:U,maxWorldLength:V}=s.verticalOffset;m.verticalOffset={screenLength:Fo(I),minWorldLength:U||0,maxWorldLength:v(V)?V:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:I,screenSizePerspectiveSettingsLabels:U}=this._context.sharedResources;m.screenSizePerspective=U.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=I}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,v(n)){const I=JSON.stringify(m);y=n.get(I),E(y)&&(y=new tC(m),n.add(I,y))}else y=new tC(m);const _=s.translation,b=v(h)?Ur(h.displayWidth,h.displayHeight):Zl,x=s.centerOffset,T=$H(y,zut,_,null,b,x,[0,0],null),S=lQ(this._context,r,T,a,c);if(E(S))return null;const C=new Um(this,S.object,[T],E(n)?[y]:null,p,OM,a);C.alignedSampledElevation=S.sampledElevation,C.needsElevationUpdates=ad(a.mode)||a.mode==="absolute-height";const{displayWidth:O,displayHeight:R}=v(h)?h:s;C.getScreenSize=(I=Ke())=>(I[0]=O,I[1]=R,I);const $=new BTe(s.elevationOffset,i);return C.metadata=$,MM(C,r,this._context.elevationProvider),C}}function Cle(e,t,r){e&&e.forEach(i=>{const s=t(i);v(s)&&r(s,i.graphic)})}function jut(e,t){if(t.verticalPlacement==="baseline"){const i=Uot[t.horizontalPlacement],s=v(e)?e.baselineAnchorY:0;return Ur(i,s)}const r=Vot(t.horizontalPlacement,t.verticalPlacement);return EN[r]}const Hut={mode:"relative-to-ground",offset:0},qut={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Wut=["polyline","polygon","extent"];class jf extends km{constructor(t,r,i,s){super(t,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,Wut,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new qu);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(v(this._material))return;const t=new D2e,r=this.symbolLayer.color;v(r)&&(t.color=Qe.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],i],t.transparent=i<1||this.needsDrivenTransparentPass,t.waveDirection=v(this.symbolLayer.waveDirection)?jf.headingVectorFromAngle(this.symbolLayer.waveDirection):Ur(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=qut[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new L2e(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(E(this._material))return;const t=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:i})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=jP(jf.elevationModeChangeTypes,i,s);if(n!==xs.UPDATE)return n;const o=ad(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){return v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(t,r,i){const s=IM(t.geometry);if(E(s))return null;const n=TQ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=Bc(2*o);this._createUVCoordsFromVertices(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new Xut(n,a);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new By({geometries:l.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),h=new Um(this,c,l.outGeometries,null,null,DTe,r);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=ad(r.mode),h}_createUVCoordsFromVertices(t,r,i,s){const n=ll(s);ed(v0);for(let l=0;l<i;l++)or(Ale,r[3*l],r[3*l+1]),yX(v0,Ale);uC(v0,v0,n);const o=v0[0]%jf.unitSizeOfTexture,a=v0[1]%jf.unitSizeOfTexture;_L[0]=v0[0]-o,_L[1]=v0[1]-a;for(let l=0;l<i;l++)t[2*l]=(r[3*l]*n-_L[0])/jf.unitSizeOfTexture,t[2*l+1]=(r[3*l+1]*n-_L[1])/jf.unitSizeOfTexture}_create3DShapeGeometries(t){const r=t.renderData.polygons,i=t.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of r){if(v(this._context.clippingExtent)&&($i(b0),Pu(b0,a),!dp(b0,this._context.clippingExtent)))continue;const c=Rv(a,l,3);if(c.length===0)continue;const h=qh(i,2*n,2*s),p=iae({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:h}});t.outGeometries.push(p)}}_createAsOverlay(t){const r=IM(t.geometry);if(E(r))return null;this._material.renderPriority=this._renderPriority;const i=V2e(r,this._context.overlaySR),s=i.position.length/3,n=Bc(2*s);this._createUVCoordsFromVertices(n,i.position,s,this._context.overlaySR);const o=new Yut(i,n,this._context.layer.uid,t.uid);return o.outBoundingBox=$i(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new FU(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(t){const r=t.uvCoords,i=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if($i(b0),Pu(b0,s),!dp(b0,this._context.clippingExtent))continue;dE(t.outBoundingBox,b0);const l=Rv(s,n,3);if(l.length===0)continue;const c=qh(r,2*o,2*a),h=iae({material:this._material,indices:l,attributeData:{position:s,uv0:c}}),p=new nC(h,t),f=b0;ti(p.boundingSphere,.5*(f[0]+f[3]),.5*(f[1]+f[4]),0,.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]))),t.outGeometries.push(p)}}static headingVectorFromAngle(t){const r=Ke(),i=T5(t);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}jf.unitSizeOfTexture=100,jf.elevationModeChangeTypes={definedChanged:xs.RECREATE,staysOnTheGround:xs.NONE,onTheGroundChanged:xs.RECREATE};const _L=Ke(),v0=ur(),Ale=Ke(),b0=In();class Xut extends RU{constructor(t,r){super(t,null,null),this.uvCoords=r}}class Yut extends RU{constructor(t,r,i,s){super(t,i,s),this.uvCoords=r}}function Zut(e,t,r,i){const s=Rle[e.type]&&Rle[e.type][t.type]||Jut[t.type];return s?new s(e,t,r,i):(ee.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const Jut={icon:UM,object:mct,line:VU,path:cut,fill:YU,extrude:Tot,text:Gut,water:jf},Rle={"mesh-3d":{fill:Kat}};class Qut extends nQ{set symbol(t){this._symbol=t,t.symbolLayers.forEach((r,i)=>{const s=this.symbolLayers[i];v(s)&&(s.symbol=t,s.symbolLayer=r)})}get symbol(){return this._symbol}constructor(t,r,i){super(r.schedule),this._symbol=t,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(t){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.getItemAt(n);if(o.enabled===!1)continue;vL.renderPriority=1-(1+n)/i,vL.renderPriorityStep=1/i,vL.ignoreDrivers=o._ignoreDrivers;const a=Zut(this.symbol,o,this._context,vL),l=P5(t,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await b6(this.symbolLayers,async(n,o)=>{if(v(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),cr(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const r=this.symbolLayers[t];return v(r)?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(t=>v(t)&&t.queryForSnapping)}createGraphics3DGraphic(t,r){const i=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=v(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Yit(i,r||this,s,t.layer,n)}get complexity(){return aQ(this.symbolLayers.map(t=>en(t,"complexity")))}globalPropertyChanged(t,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Um?l:null};if(v(n)&&!n.globalPropertyChanged(t,r,o))return!1}return!0}applyRendererDiff(t,r){return this.loadStatus!==xu.LOADED?Rn.Recreate_Symbol:this.symbolLayers.reduce((i,s)=>i!==Rn.Recreate_Symbol&&v(s)?Math.min(i,s.applyRendererDiff(t,r)):i,Rn.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===xu.FAILED||t.diff.type!=="partial")return;const r=t.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(E(s))return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];v(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(E(s))continue;const n=t.layers[i];if(E(n)||!s.updateGeometry(n,r))return!1}return!0}onRemoveGraphic(t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(E(i))continue;const s=t.layers[r];v(s)&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,r=0,i=0;return this.symbolLayers.forEach(s=>{E(s)||(s.loadStatus===xu.LOADING?t++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:t,slow:r,fast:i}}async queryForSnapping(t,r,i,s){const n=this.symbolLayers.filter(v).filter(a=>v(a.queryForSnapping)).map(a=>a.queryForSnapping(t,r,i,s)),o=await Promise.all(n);return cr(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)v(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const vL={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class Kut extends nQ{constructor(t,r,i){super(r),this.symbol=t,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const r=await this.symbol.fetchSymbol({signal:t});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),v(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return v(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:oQ}globalPropertyChanged(t,r){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,r)}applyRendererDiff(t,r){return v(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,r):Rn.Recreate_Symbol}prepareSymbolPatch(t){v(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,r){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,r)}onRemoveGraphic(){}getFastUpdateStatus(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){v(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function $Q(e){return e instanceof Kut?e.graphics3DSymbol:e instanceof Qut?e:null}const kM=ee.getLogger("esri.views.3d.layers.graphics.labelPlacement");function eht(e){const t=cht(e);if(E(t))return null;const r=tht(e,t);if(E(r))return null;const i=r.anchor,s=!!t.hasLabelVerticalOffset;return iht({anchor:i,verticalOffset:t.verticalOffset,screenOffset:Ke(),centerOffset:Ht(0,0,0,-1),centerOffsetUnits:"world",translation:M(),elevationOffset:0,hasLabelVerticalOffset:s},r,e)}function tht(e,t){if(t.anchor)return t;const r=e.labelClass.labelPlacement,i=_p[r],s=i||Q4(e);return r&&!i&&kM.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),rht(s,e)}function LQ(e){const t=e.graphics3DGraphic.graphics3DSymbol,r=$Q(t);return v(r)?r.symbol.symbolLayers.getItemAt(0):null}function rht(e,t){const r=t.graphics3DGraphic.graphic.geometry;if(E(r))return null;if(v(t.disablePlacement))return t.labelClass.labelPlacement?(kM.warnOncePerTick(Ole(e.placement,t.disablePlacement.logEntityDescription)),Q4(t)):e;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return kM.warnOncePerTick(Ole(e.placement,`'${i}' geometries`)),Q4(t);break;case"point":case"mesh":return e}return e}function Ole(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function Q4(e){const t=e.graphics3DGraphic.graphic.geometry;if(E(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=LQ(e);return v(r)&&r.type==="extrude"?_p["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return _p["above-center"];default:return}}function iht(e,t,r){const i=r.graphics3DGraphic.graphic.geometry;if(E(i))return null;switch(i.type){case"point":nht(e,t,r);break;case"polygon":sht(e,t,r);break;case"mesh":DQ(e,t,r.graphics3DGraphic.layers[0])}return e}function sht(e,t,r){const i=LQ(r);if(!E(i))switch(i.type){case"extrude":{const s=r.graphics3DGraphic.layers[0];v(s)?(s.getBoundingBoxObjectSpace(gO),hp(gO,e.translation),e.translation[2]=Lv(gO)/2):ce(e.translation,0,0,0),DQ(e,t,s);break}}}function nht(e,t,r){const i=LQ(r);if(E(i))return;const s=r.graphics3DGraphic.layers[0];switch(v(s)?s.getCenterObjectSpace(e.translation):ce(e.translation,0,0,0),i.type){case"icon":case"text":oht(e,t,r,s);break;case"object":DQ(e,t,s)}}function oht(e,t,r,i){const{graphics3DGraphic:s}=r,n=v(i)?i.getScreenSize():null;if(!s.isDraped&&v(n)){const o=aht(r);UA[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),UA[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=UA[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=UA[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=UA[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(_p[r.labelClass.labelPlacement]&&kM.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function aht(e,t=uht){const{graphics3DGraphic:r}=e,i=r.layers[0],s=v(i)?i.stageObject.geometries[0].material:null;if(s&&s instanceof tC){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function DQ(e,t,r){const i=v(r)?r.getBoundingBoxObjectSpace(gO):gO,s=Le(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Me(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function lht(e){return e==="above-center"}function cht(e){const t=e.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=e,s=$Q(i.graphics3DSymbol),n=ho(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=_p[t]||Q4(e);return v(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Mle(n.verticalOffset),anchor:null,normalizedOffset:null}:r&&r.hasVisibleVerticalOffset()&&(E(n)||!n.supportsCallout()||!n.verticalOffset||i.isDraped)?lht(o.placement)?{placement:"above-center",verticalOffset:Mle(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(kM.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function Mle(e){const{screenLength:t,minWorldLength:r,maxWorldLength:i}=e;return{screenLength:t,minWorldLength:r,maxWorldLength:i}}const _p={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Ple={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in Ple){const t=Ple[e],r=_p[e];t.forEach(i=>{_p[i]=r})}Object.freeze&&(Object.freeze(_p),Object.keys(_p).forEach(e=>{Object.freeze(_p[e]),Object.freeze(_p[e].normalizedOffset)}));const UA=[0,0],uht=[0,0],gO=In();class Ile{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,r){this._materials.set(t,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const tB=512,rB=4096,hht=.85,dht=.95;class pht{constructor(){this.offset={x:0,y:0},this.uvMinMax=sr()}}class fht{constructor(t,r){this.textId=t,this.textRenderer=r,this.placement=new pht,this.rendered=!1}}let m3=class extends Te{constructor(e){super(e),this.type=Fs.Texture,this.id=Lc(),this.events=new Vs,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=tt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,flipped:!0,samplingMode:rt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return v(this._glTexture)||(this._glTexture=new lt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(gt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=zi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=tt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",tB.toString()),e.setAttribute("height",tB.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=tB){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let r=Math.max(e,t);return r+=256,r=JS(r),r=Math.min(r,rB),r}_resizeAtlas(e,t){t=t||e;const r=this._atlas;r.size.width=e,r.size.height=t,v(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=kA,e.cursor.y=kA+$le,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,t=this._elementsToAddOrUpdate.size,r=this._elements.size;return this._getAtlasUsage()/r*(r+t-e)}_addAtlasElement(e,t,r,i){const s=this._atlas,{renderedWidth:n,renderedHeight:o}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,ti(e.placement.uvMinMax,e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height),s.cursor.x+=r,s.lineHeight=Math.max(s.lineHeight,i),this._elements.set(t,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const t=e.placement.offset;this._ctx.clearRect(t.x,t.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const t=this._stageObjects.get(e);if(t)return t;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const r=this._stageObjects.get(e);r&&r.delete(t)&&(t.geometries[0].vertexAttributes.get(A.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometries[0]))}_processAddition(e,t){const r=this._atlas,i=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+kA,a=n+kA+$le;if(r.cursor.x+o<r.size.width&&r.cursor.y+a<r.size.height)this._addAtlasElement(e,i,o,a),this._elementsToRender.set(i,e),this._elementsToAddOrUpdate.delete(i);else{if(!(r.cursor.y+a+r.lineHeight<r.size.height)){const l=this._getExpectedAtlasUsage(),c=l>hht&&r.size.width<rB;return c&&this._resizeAtlas(2*r.size.width,2*r.size.height),!t||!c&&l>dht&&r.size.width===rB?(this._processRemovals(),lS.OK):(this._repack(),lS.REPACK)}r.cursor.x=kA,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,i,o,a),this._elementsToRender.set(i,e),this._elementsToAddOrUpdate.delete(i)}return lS.OK}_processRemovals(){this._elementsToRemove.forEach((e,t)=>{const r=this._stageObjects.get(t);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this._stageObjects.delete(t)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,t)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(t,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const t=this._stageObjects.get(e.textId);t&&t.forEach(r=>{r.geometries[0].vertexAttributes.get(A.UV0).data=new Float32Array(e.placement.uvMinMax),r.geometries[0].vertexAttributes.get(A.SIZE).data=[e.textRenderer.displayWidth,e.textRenderer.displayHeight],r.geometryVertexAttrsUpdated(r.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(E(this._glTexture))return na.YIELD;let r=!1;if(ea(this._elementsToAddOrUpdate,(s,n)=>{const o=this._elements.get(n);if(o&&o.rendered){const a=this._stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this._elements.get(n);c.get(A.UV0).data=h.placement.uvMinMax,c.get(A.SIZE).data=[h.textRenderer.displayWidth,h.textRenderer.displayHeight],l.geometryVertexAttrsUpdated(l.geometries[0])}),this._elementsToAddOrUpdate.delete(n),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(n),t)===lS.REPACK&&(r=!0,!0)}),r)return this.runTask(Ka,!1),void e.madeProgress();let i=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),ea(this._elementsToRender,(s,n)=>(this._processRenderingRequest(s),this._elementsToRender.delete(n),i=!0,e.madeProgress(),e.done)),i&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&gst.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,t){const r=e.key;this._elementsToAddOrUpdate.has(r)||this._elementsToAddOrUpdate.set(r,new fht(r,e)),this._addStageObject(r,t),this._elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,t){const r=e.key;this._elementsToRemove.set(r,this._elements.get(r)),this._removeStageObject(r,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((r,i)=>e.push({element:r,key:i}));let t=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){t=!1;break}if(!t||this._elementsToRemove.size){e.sort((r,i)=>r.key.localeCompare(i.key)),this._elements.clear();for(const{element:r,key:i}of e)this._elements.set(i,r);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:t,_elementsToRemove:r,_atlas:i}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:r,atlas:i,resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([d({constructOnly:!0})],m3.prototype,"view",void 0),u([d({type:Boolean})],m3.prototype,"updating",void 0),m3=u([P("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],m3);const kA=2,$le=2;var lS;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(lS||(lS={}));class Lle{constructor(t,r){this.labelingContext=t,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}}class mht{constructor(t,r,i,s,n){this.labelClass=t,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}}class ght{constructor(t,r,i,s,n,o,a){this.layer=t,this.graphics3DCore=r,this.scaleVisibility=i,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=n,this.disablePlacement=o,this.active=a,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new c2e({pickable:!0,disableOctree:!0},t.uid)}}let vb=class extends Te{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Jr,this._handles.add([se(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),se(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(gt.LABELER,this)]),this._textTextureAtlas=new m3({view:this.view}),this._hudMaterialCollection=new Ile(this.view._stage),this._calloutMaterialCollection=new Ile(this.view._stage)}dispose(){this._handles=Ve(this._handles),this._textTextureAtlas=tt(this._textTextureAtlas),this._hudMaterialCollection=tt(this._hudMaterialCollection),this._calloutMaterialCollection=tt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.graphics.forEach((t,r)=>{const i=new Lle(e,t);this._labels.set(r,i),e.labelsToInitialize.set(r,i),t.setVisibilityFlag(Rc.USER_SETTING,!0,Do.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((t,r)=>{t.setVisibilityFlag(Rc.USER_SETTING,!1,Do.LABEL),this.setLabelGraphicVisibility(t,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];v(r)&&this._textTextureAtlas.addTextTexture(r,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];v(r)&&this._textTextureAtlas.removeTextTexture(r,t.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),na.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(t.active){if(!Dle(t)){if(yht(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),iB(t)){this._dirty=!0;continue}if(!Dle(t))continue}ea(t.labelsToInitialize,(r,i)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(i,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(i),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var n,o,a;const t=(n=e.labelClassAbortController)==null?void 0:n.signal;await((a=(o=e.layer).when)==null?void 0:a.call(o)),cr(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,i=r.layer,s=i.labelingInfo&&i.labelingInfo.filter(l=>!!l.symbol);!s||s.length===0||(await b6(s,async(l,c)=>{const h=l.symbol,p=$Q(r.getOrCreateGraphics3DSymbol(h));if(E(p))return void ee.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await p.load(),cr(t);let f=null;VX(h)&&h.hasVisibleCallout()&&(f=qit(h,r.symbolCreationContext),await f.load(),cr(t));const m=await Vc(MTe(l,e.layer.fieldsIndex,this.view.spatialReference));if(cr(t),m.ok===!0){const y=await this._createTextRenderParameters(p.symbol);cr(t),e.labelClassContexts[c]=new mht(l,p,f,y,m.value)}else ee.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${m.error}`)}),cr(t))}async _createLabelClassContext(e){return E(e.labelClassPromise)&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(sn(t))throw t;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?ZU.fromSymbol(t,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Yh(t),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,r,i,s){const n=new ITe(r.verticalOffset,Wae(r.anchor),kot(r.anchor),e.text,r.translation,r.elevationOffset,r.centerOffset,r.screenOffset,r.centerOffsetUnits,e.displayWidth,e.displayHeight);return w0.graphic=t,w0.renderingInfo=null,w0.layer=i,s.createLabel(w0,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,r,i,s){return w0.graphic=e,w0.layer=s,w0.renderingInfo=new jit(null,t,i.translation,i.centerOffset,i.screenOffset,i.centerOffsetUnits,i.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(w0)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0||!r.emptySymbolLabelSupported&&t.layers.length===0)return!1;let s=!1;const n=t.graphic,o=r.layer,a=bL(r.layer),l=this.view._stage;for(let c=0;c<i.length;c++){const h=e.textRenderers[c],p=e.textLabelPlacements[c];if(E(h)||E(p))continue;const f=i[c],m=f.graphics3DSymbol,y=m.symbol&&m.symbol.type==="label-3d"?m.symbol:null,_=m.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(r.elevationInfoOverride);const b=this._createTextSymbolGraphic(h,n,p,o,_);if(E(b))return!1;b._labelClass=f.labelClass,b._labelIndex=c,t.addLabelGraphic(b,l,r.stageLayer),t.setVisibilityFlag(Rc.USER_SETTING,a,Do.LABEL),t.clearVisibilityFlag(Rc.SCALE_RANGE,Do.LABEL),t.setVisibilityFlag(Rc.DECONFLICTION,!1,Do.LABEL),s=!0;const x=f.graphics3DCalloutSymbolLayer;if(x&&p.hasLabelVerticalOffset){x.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(n,y,x,p,o);v(T)&&(f.calloutSymbolLayerIndex=t.labelLayers.length,t.addLabelGraphic(T,l,r.stageLayer))}break}return r.scaleVisibility&&s&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const i=t[r._labelIndex].graphics3DSymbol.symbolLayers[0];i!=null&&i.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const t=e.labelingContext,r=t.labelClassContexts;if(!r||r.length===0)return;const i=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const x=a.needsHydrationToEvaluate()?Grt(i,t.layer):i;l=a.evaluate(x)}catch{l=null}else l=a.evaluate(i);if(E(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=((s=c.symbol)==null?void 0:s.type)==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=t.disablePlacement,y=eht({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(E(y))continue;const _=Wae(y.anchor),b=rSe(_);e.textRenderers[n]=new eSe(l,b,o.textRenderParameters),e.textLabelPlacements[n]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,t){const r=t.graphic.uid;if(e.graphics.set(r,t),e.active){const i=new Lle(e,t);this._labels.set(r,i),e.labelsToInitialize.set(r,i)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const r=t.graphic.uid,i=this._labels.get(r);e.graphics.delete(r),i&&(this._destroyGraphic(i,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of t){const i=e.graphics.get(r);i&&(this._removeGraphic(e,i),this._addGraphic(e,i))}}_globalPropertyChanged(e,t){for(const r of t.labelClassContexts){const i=new Map;t.graphics.forEach(n=>i.set(n.graphic.uid,n));const s=n=>n.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,i,s),r.graphics3DCalloutSymbolLayer){const n=o=>o.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,i,n)}}}_visibilityInfoChange(e){const t=bL(e.layer);t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((t,r)=>{const i=this._labels.get(r);i&&(this._destroyGraphic(i,r),i.visible=!1,i.rendered=!1,e.labelsToInitialize.set(r,i))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,r){const i=r&&r.emptySymbolLabelSupported||!1,s=r&&r.elevationInfoOverride||null,n=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a=new ght(o,e,t,i,s,n,bL(o));return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>bL(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const r=this._labelingContexts.indexOf(t);this._labelingContexts.splice(r,1),t.graphics.forEach(i=>this._removeGraphic(t,i)),this.view._stage.remove(t.stageLayer),this.setDirty()}setLabelGraphicVisibility(e,t){const r=e.graphic.uid,i=this._labels.get(r);i&&i.visible!==t&&(t&&!i.rendered?(this._labelsToAdd.set(r,i),this._labelsToRemove.delete(r),i.textInitialized||i.labelingContext.labelsToInitialize.set(r,i)):!t&&i.rendered&&(this._labelsToRemove.set(r,i),this._labelsToAdd.delete(r)),i.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>iB(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,r)=>t+(iB(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function iB(e){return!!e.labelClassPromise&&!!e.labelClassAbortController}function Dle(e){return e.labelClassContexts&&e.labelClassContexts.length}function yht(e){return e.labelClassContexts===null}function bL(e){var t;return e.labelsVisible===!0&&!!((t=e.labelingInfo)!=null&&t.some(r=>!!r.symbol))}u([d({constructOnly:!0})],vb.prototype,"view",void 0),u([d({constructOnly:!0})],vb.prototype,"deconflictor",void 0),u([d()],vb.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],vb.prototype,"updating",null),vb=u([P("esri.views.3d.layers.graphics.Labeler")],vb);const w0=new Hit(null,null,null);class lp{constructor(t,r,i,s=null){this.lij=[0,0,0],this.extent=ur(),this.resolution=0,this.loadPriority=0,this.measures={visibility:ga.VISIBLE_ON_SURFACE,screenRect:ur(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,r,i,s)}acquire(t,r,i,s){this.tilingScheme=s,this.id=lp.id(t,r,i),this.lij[0]=t,this.lij[1]=r,this.lij[2]=i,s.getExtent(t,r,i,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(r,i,s,this.tilingScheme),t[1].acquire(r,i+1,s,this.tilingScheme),t[2].acquire(r,i,s+1,this.tilingScheme),t[3].acquire(r,i+1,s+1,this.tilingScheme),t):[new lp(r,i,s,this.tilingScheme),new lp(r,i+1,s,this.tilingScheme),new lp(r,i,s+1,this.tilingScheme),new lp(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,my(t.measures.screenRect,this.measures.screenRect)}static id(t,r,i){return`${t}/${r}/${i}`}}var ga;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(ga||(ga={}));const BSe=.5*Math.PI,_ht=BSe/Math.PI*180;class vht{constructor(t){this._renderCoordsHelper=t.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:M(),direction:M()};for(let r=0;r<4;r++)this._extent[r]={origin:M(),direction:M(),cap:{next:null,direction:M()}},this._planes[r]=jr();this._planes[Si.NEAR]=jr(),this._planes[Si.FAR]=jr(),this._planesWithoutFar=this._planes.slice(0,5)}update(t,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(t,r,i),me(this._center.origin,n[0].origin,n[2].origin),ae(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||ae(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Cy(a.cap.direction,a.origin,l.origin),zO(a.direction,a.cap.direction,a.origin,this._planes[o]),s||ae(a.direction,a.direction,-1)}zO(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Si.NEAR]),s?iG(this._planes[Si.NEAR],this._planes[Si.FAR]):(l6(this._planes[Si.FAR],this._planes[Si.NEAR]),iG(this._planes[Si.NEAR],this._planes[Si.NEAR])),this._maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Zr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(t,r,i=!1){if(t==null)return!1;if(this._renderCoordsHelper.viewingMode===Ge.Global){const n=this._maxSpanSpatialReference.isGeographic?_ht:BSe*r;if(this._maxSpan>n)return!0;if(t.altitude!=null&&t.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!t.intersectsRay(zu(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&t.intersectsRay(zu(o.origin,o.direction))||t.intersectsLineSegment(dw(o.origin,o.cap.next,wht),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(GZe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,r,i){_X(t,xd),xd[2]=i,$p(r,xd,sB,this._renderCoordsHelper.spatialReference),ko(Nle,sB),$i(rc);for(const{x0:n,x1:o,y0:a,y1:l}of bht)for(let c=0;c<5;c++){const h=c/4;xd[0]=Nt(t[n],t[o],h),xd[1]=Nt(t[a],t[l],h),xd[2]=i,mo(xd,r,xd,this._renderCoordsHelper.spatialReference),Ze(xd,xd,Nle),wm(rc,xd)}ce(this._extent[0].origin,rc[0],rc[1],rc[2]),ce(this._extent[1].origin,rc[3],rc[1],rc[2]),ce(this._extent[2].origin,rc[3],rc[4],rc[2]),ce(this._extent[3].origin,rc[0],rc[4],rc[2]);for(let n=0;n<4;++n)Ze(this._extent[n].origin,this._extent[n].origin,sB)}_toRenderBoundingExtentLocal(t,r,i){s6(t,r,rg,this._renderCoordsHelper.spatialReference),ce(this._extent[0].origin,rg[0],rg[1],i),ce(this._extent[1].origin,rg[2],rg[1],i),ce(this._extent[2].origin,rg[2],rg[3],i),ce(this._extent[3].origin,rg[0],rg[3],i)}_toRenderBoundingExtent(t,r,i){switch(this._renderCoordsHelper.viewingMode){case Ge.Global:this._toRenderBoundingExtentGlobal(t,r,i);break;case Ge.Local:this._toRenderBoundingExtentLocal(t,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(Ei(t.planes[Si.NEAR],this._center.origin)<0&&_e(this._center.direction,t.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(Ei(t.planes[Si.NEAR],i.origin)<0&&_e(i.direction,t.direction)<0)return!0}return!1}}const bht=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],xd=M(),sB=Ie(),Nle=Ie(),rc=In(),rg=ur(),wht=kp();class xht{constructor(t){this._renderCoordsHelper=t,this._surfaceElevation=0,this._cache=new Map,this._frustum=new A_(t),this._extendedFrustum=new A_(t),this._intersector=new vht({renderCoordsHelper:t}),this._renderCoordsHelper=t}begin(t,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(t.eye)>r,this._frustum.update(t),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(t)}end(){this._cache.clear()}calculate(t){if(this._allTilesInvisible)return ga.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===Ge.Global&&t.lij[0]>=Tht&&t.lij[0]<Sht,i=this._getOrCalculateSingleTileVisibility(t,!r);return i!==ga.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(t):i}_shortenFrustumFarPlane(t){const r=A_.nearFarLineIndices,i=t.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];ge(Kc,l,a),ae(Kc,Kc,Cht),me(i[o],a,Kc)}t.updatePoints(i)}_calculateAggregatedChildrenVisibility(t){let r=ga.INVISIBLE;const i=this._cache.get(t.id);if(i!=null)return i;const s=Vle.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==ga.INVISIBLE&&(r=o,o===ga.VISIBLE_ON_SURFACE))break}return Vle.release(s),this._cache.set(t.id,r),r}_getOrCalculateSingleTileVisibility(t,r){const i=this._cache.get(t.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(t);return r&&this._cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ge.Global&&t.lij[0]<Eht?this._calculateSingleTileVisibilitySided(t,!1)===ga.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this._aboveGround)}_calculateSingleTileVisibilitySided(t,r){this._intersector.update(t.extent,t.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Zr(t.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?ga.VISIBLE_ON_SURFACE:ga.VISIBLE_WHEN_EXTENDED:ga.INVISIBLE}_updateExtendedFrustum(t){this._extendedFrustum.update(t),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(t.eye,Kc);this._aboveGround||Ea(r,r);const i=Mn(-_e(r,t.viewForward));if(this._allTilesInvisible=i>(Math.PI+t.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>t.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Kc),a){case nt.FAR_BOTTOM_LEFT:case nt.FAR_TOP_LEFT:case nt.NEAR_BOTTOM_LEFT:case nt.NEAR_TOP_LEFT:sG(this._extendedFrustum.planes[Si.LEFT],Kc,Kc);break;case nt.FAR_BOTTOM_RIGHT:case nt.FAR_TOP_RIGHT:case nt.NEAR_BOTTOM_RIGHT:case nt.NEAR_TOP_RIGHT:sG(this._extendedFrustum.planes[Si.RIGHT],Kc,Kc)}ae(Kc,Kc,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(zu(l,Kc),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),_a(n[nt.NEAR_BOTTOM_LEFT],n[nt.NEAR_BOTTOM_RIGHT],n[nt.NEAR_TOP_RIGHT],Ule),_a(n[nt.NEAR_BOTTOM_RIGHT],n[nt.NEAR_TOP_RIGHT],n[nt.NEAR_TOP_LEFT],kle),_e(Ule,kle)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[nt.NEAR_BOTTOM_LEFT],o[nt.NEAR_BOTTOM_RIGHT]]=[o[nt.NEAR_BOTTOM_RIGHT],o[nt.NEAR_BOTTOM_LEFT]]:[o[nt.NEAR_TOP_LEFT],o[nt.NEAR_TOP_RIGHT]]=[o[nt.NEAR_TOP_RIGHT],o[nt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this._surfaceElevation-Fle;return{zWithMargin:t,pointIndices:A_.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>t}}_extendedFrustumParametersBelowSurface(){const t=this._surfaceElevation+Fle;return{zWithMargin:t,pointIndices:A_.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<t}}}const Tht=2,Sht=6,Eht=12,Cht=.95,Fle=1,Kc=M(),Ule=jr(),kle=jr(),Vle=new An(Array,e=>{e.length!==4&&(e[0]=new lp,e[1]=new lp,e[2]=new lp,e[3]=new lp)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class Aht{constructor(t){this._camera=new Ct,this._focusOnMap=[0,0],this._screenRect=ur(),this._tileSize=t.tileSize,this._renderCoordsHelper=t.renderCoordsHelper,this._tilingScheme=t.tilingScheme,this._visibility=new xht(t.renderCoordsHelper)}begin(t,r,i){this._camera.copyFrom(t),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,gX(0,0,t.fullWidth,t.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(t){t.measures.visibility=this._visibility.calculate(t),t.measures.distance=gPe(t.extent,this._focusOnMap),t.measures.visibility!==ga.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const r=Rht,i=1<<r,s=t.measures.screenRect;ed(s);let n=0;const o=t.lij[0]+r,a=t.lij[1]<<r,l=t.lij[2]<<r,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<i;p++)for(let f=0;f<i;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===ga.VISIBLE_WHEN_EXTENDED?this._tileSize*Oht:this._tileSize}_computeScreenArea(t,r,i,s,n){const o=t.measures.visibility===ga.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,x0),ed(nB);for(let a=0;a<4;a++)yX(nB,x0[a]);return Q_(n,nB,n),ene(x0[0],x0[1],x0[2])+ene(x0[0],x0[2],x0[3])}_projectToScreen(t,r,i,s,n){this._tilingScheme.ensureMaxLod(t),this._tilingScheme.getExtent(t,r,i,VA),this._toRenderCoords(VA,0,3,T0[0]),this._toRenderCoords(VA,2,3,T0[1]),this._toRenderCoords(VA,2,1,T0[2]),this._toRenderCoords(VA,0,1,T0[3]),s&&(this._projectToPlane(T0,this._camera.frustum[Si.NEAR]),this._projectToPlane(T0,this._camera.frustum[Si.TOP]),this._projectToPlane(T0,this._camera.frustum[Si.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(T0[o],Ble),this._camera.renderToScreen(Ble,n[o])}_projectToPlane(t,r){for(let s=0;s<4;s++)zA[s]=Ei(r,t[s]);const i=Math.max(zA[0],zA[1],zA[2],zA[3]);if(i>0){const s=ae(BA,r,-i);for(let n=0;n<4;n++)me(t[n],t[n],s)}}_toRenderCoords(t,r,i,s){return BA[0]=t[r],BA[1]=t[i],BA[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(BA,this._tilingScheme.spatialReference,s),s}}const nB=ur(),Rht=2,Oht=5,x0=[ds(),ds(),ds(),ds()],VA=ur(),BA=M(),T0=[M(),M(),M(),M()],zA=[0,0,0,0],Ble=ta();function _St(e,t,r){if(E(e)||E(r))return!1;let i=!0;return bn[0]=e.xmin!=null?e.xmin:0,bn[1]=e.ymin!=null?e.ymin:0,bn[2]=e.zmin!=null?e.zmin:0,i=i&&Ts(bn,e.spatialReference,0,t,r,0,1),bn[0]=e.xmax!=null?e.xmax:0,bn[1]=e.ymax!=null?e.ymax:0,bn[2]=e.zmax!=null?e.zmax:0,i=i&&Ts(bn,e.spatialReference,0,t,r,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),i}function zSe(e,t,r){if(E(e)||E(r))return!1;let i=!0;return bn[0]=e.xmin!=null?e.xmin:0,bn[1]=e.ymin!=null?e.ymin:0,bn[2]=e.zmin!=null?e.zmin:0,i=i&&Ts(bn,e.spatialReference,0,bn,r,0,1),t[0]=bn[0],t[1]=bn[1],bn[0]=e.xmax!=null?e.xmax:0,bn[1]=e.ymax!=null?e.ymax:0,bn[2]=e.zmax!=null?e.zmax:0,i=i&&Ts(bn,e.spatialReference,0,bn,r,0,1),t[2]=bn[0],t[3]=bn[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),i}const bn=M();let $o=class extends Te{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(v(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void ee.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||v(t)&&e&&t.equals(e))return;const r=v(e)?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(E(this.filterExtent))return null;const e=ur();return zSe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new pt,this.tileSize=512,this._idToTile=new Map,this._handles=new Jr,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Jt}initialize(){this._handles.add([se(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),ri),se(()=>{var e,t,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),Ys)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(gt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=zi(this._frameWorker),this._handles=Ve(this._handles)}addClient(){const e=Pht();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Ka))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),v(this._frameWorker)&&(this._frameWorker.priority=gt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&v(this._frameWorker)&&(this._frameWorker.priority=gt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){var t;if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Aht({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,(t=this.cameraOnSurface.location.z)!=null?t:0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(t=>new lp(t[0],t[1],t[2],e))}_purgeHorizonTiles(e){e.sort((t,r)=>{const i=t.measures.screenRect,s=r.measures.screenRect;return i[1]+i[3]-(s[1]+s[3])}),ed(wL);for(let t=0;t<e.length;t++)if(Q_(wL,e.data[t].measures.screenRect,wL),Ip(wL)>Iht)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:t}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!z5(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==ga.INVISIBLE&&(r.measures.shouldSplit?(t.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const i of this.tiles.items)i.used=!1;const t=e.filter(i=>{const s=this._idToTile.get(i.id);return s?(s.copyMeasurementsFrom(i),s.used=!0):this._idToTile.set(i.id,i),!s}),r=this.tiles.items.filter(i=>!i.used&&(this._idToTile.delete(i.id),!0));this.tiles.removeMany(r),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===ga.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([d({constructOnly:!0})],$o.prototype,"scheduler",void 0),u([d({constructOnly:!0})],$o.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],$o.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],$o.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],$o.prototype,"focus",void 0),u([d({constructOnly:!0})],$o.prototype,"viewState",void 0),u([d({constructOnly:!0})],$o.prototype,"terrain",void 0),u([d()],$o.prototype,"tiles",void 0),u([d()],$o.prototype,"tileSize",void 0),u([d({readOnly:!0})],$o.prototype,"tilingScheme",null),u([d()],$o.prototype,"filterExtent",null),u([d({readOnly:!0})],$o.prototype,"_filterExtentRect",null),u([d({readOnly:!0})],$o.prototype,"_rootTileIds",null),u([d({value:!1})],$o.prototype,"suspended",null),u([d({readOnly:!0})],$o.prototype,"updating",null),$o=u([P("esri.views.3d.layers.support.FeatureTileTree3D")],$o);let Mht=0;function Pht(){return Mht++}const wL=ur(),Iht=10;let yn=class extends Te{constructor(){super(...arguments),this._propertiesPool=new vy({camera:Ct},this),this._lastSeenCameraProjectionValues=new Ct,this.mode=Sr.ANIMATING,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Vs,this.viewingMode=Ge.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new Ag({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new vy({camera:Ct},this)}createInitialCamera(){if(this.viewingMode===Ge.Global){const e=Zr(this.spatialReference).radius;this.camera=new Ct({eye:Le(4*e,0,0),center:Le(e,0,0),up:Le(0,0,1)})}else this.camera=new Ct({eye:Le(0,0,100),center:Le(0,0,0),up:Le(0,1,0)})}get animation(){return this.cameraController instanceof TM&&v(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==rh&&rh.copyFrom(e),rh.computeUp(this.viewingMode),this.events.emit("before-camera-change",rh);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,rh)&&(this._lastSeenCameraProjectionValues.copyFrom(rh),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),(!t||!t.equals(rh))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(rh)),this._cameraChanged=!t||!t.almostEquals(rh),this._cameraChanged)){const r=kde(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return Pt(this._contentCamera,this.camera)}set contentCamera(e){this._contentCamera=v(e)?e.clone():null}get fixedContentCamera(){return v(this._contentCamera)}get isGlobal(){return this.viewingMode===Ge.Global}get isLocal(){return this.viewingMode===Ge.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.removeHandles(zle),this.addHandles(oa(()=>e.state===hs.Finished||e.state===hs.Stopped,()=>{this._set("cameraController",null),this.updateCamera(t=>e.onControllerEnd(t))},{sync:!0,once:!0}),zle),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=hs.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==hs.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();rh.copyFrom(this._get("camera")),e(rh),this.camera=rh,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[lr.TOP]!==t.padding[lr.TOP]||e.padding[lr.RIGHT]!==t.padding[lr.RIGHT]||e.padding[lr.BOTTOM]!==t.padding[lr.BOTTOM]||e.padding[lr.LEFT]!==t.padding[lr.LEFT]}};u([d()],yn.prototype,"mode",void 0),u([d({readOnly:!0,type:$E})],yn.prototype,"animation",null),u([d({type:Ct})],yn.prototype,"camera",null),u([d({readOnly:!0})],yn.prototype,"pixelRatio",null),u([d()],yn.prototype,"rasterPixelRatio",void 0),u([d()],yn.prototype,"contentPixelRatio",void 0),u([d({})],yn.prototype,"_contentCamera",void 0),u([d({type:Ct})],yn.prototype,"contentCamera",null),u([d({readOnly:!0})],yn.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],yn.prototype,"constraints",void 0),u([d({readOnly:!0})],yn.prototype,"events",void 0),u([d({readOnly:!0})],yn.prototype,"isGlobal",null),u([d({readOnly:!0})],yn.prototype,"isLocal",null),u([d({readOnly:!0})],yn.prototype,"viewingMode",void 0),u([d({readOnly:!0})],yn.prototype,"spatialReference",void 0),u([d()],yn.prototype,"navigating",null),u([d()],yn.prototype,"stationary",null),u([d()],yn.prototype,"_cameraChanged",void 0),u([d()],yn.prototype,"cameraController",null),yn=u([P("esri.views.3d.state.ViewState")],yn);const $ht=yn,rh=new Ct,zle="ViewStateHandles";class Lht{constructor(t,r,i){this.viewingMode=t,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Jt,this._tolerance=YE,this._tmpRay=co(),this._tmpRegion=ur(),this._validateHUDIntersector=od(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(t,r,i){return this.intersectRay(this._getPickRay(t,this._tmpRay),Gle(this.viewingMode),r,i)}intersectScreenFreePointFallback(t,r,i){return this.intersectRayFreePointFallback(this._getPickRay(t,this._tmpRay),r,i)}intersectRayFreePointFallback(t,r,i){return this.intersectRay(t,Gle(this.viewingMode),r,i)||this._intersectRayFreePointLocal(t,r)}intersectRay(t,r,i,s){return r.options.selectionMode=!1,r.options.store=Bo.MIN,this.computeIntersection(t,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(t,r,i=.5,s=.5){return t.getRenderCenter(SL,i,s),SL[0]+=.0466,SL[1]-=.0123,AJ(t,SL,r)}intersectIntersectorScreen(t,r,i){this.computeIntersection(this._getPickRay(t,this._tmpRay),r,i)}intersectToolIntersectorScreen(t,r,i){const s=this._getPickRay(t,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(t,r,i){r.options.selectionMode=!0,this.computeIntersection(t,r,i);const s=r.results.min;!!this._view.basemapTerrain&&this._view.basemapTerrain.opaque||zp(s)&&s.intersector!==ss.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(t,r,i))}setTolerance(t=YE){this._tolerance=t}addIntersectionHandler(t){this._externalIntersectionHandlers.push(t),this._externalIntersectionHandlers.sort((r,i)=>r.type===ss.TERRAIN?1:i.type===ss.TERRAIN?-1:0)}removeIntersectionHandler(t){this._externalIntersectionHandlers.removeUnordered(t)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===ss.TERRAIN?1:i.type===ss.TERRAIN?-1:0)}_getPickRay(t,r){const i=this._view.state.camera;return Pwe(i,t,r)}_intersectRayFreePointLocal(t,r){return this.viewingMode!==Ge.Local||E(t)||me(r,t.origin,ve(We.get(),t.direction)),!1}intersectElevationFromScreen(t,r,i=0,s=null){return this._intersectElevation(this._getPickRay(t,this._tmpRay),r,i,s)}_intersectElevation(t,r,i=0,s=null){var T;if(E(t))return null;const n=v(r)?r.mode:"absolute-height",o=v(r)?Pt(r.offset,0):0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(t,a,TL)){const S=this._view.computeMapPointFromVec3d(TL);return(T=S.z)!=null||(S.z=0),S.z-=o,S}return null}const c=this._view.state.camera,h=We.get();c.projectToRenderScreen(t.origin,h);const p=new jle(null,this._forEachLayer),f=this._view.slicePlane,m=v(f)?Lne(f):null,y=od(this.viewingMode);y.options.store=Bo.MIN,y.options.verticalOffset=l;const _=t.origin,b=me(We.get(),_,t.direction);y.reset(_,b,c),y.point=h;const x=v(s)?"type"in s&&s.type==="graphics"?S=>{var C;return((C=S.metadata)==null?void 0:C.layerUid)!==s.uid}:S=>{var C;return((C=S.metadata)==null?void 0:C.graphicUid)!==s.uid}:null;switch(n){case"relative-to-scene":{const S=C=>{var O;return(E(x)||x(C))&&!!((O=C.metadata)!=null&&O.isElevationSource)};y.intersect(p.layers,h,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(C=>{if(C.type===ss.I3S||C.type===ss.TERRAIN){const O=C.slicePlaneEnabled?m:null;C.intersect(y,O,y.rayBegin,y.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const C=S.slicePlaneEnabled?m:null;S.intersect(y,C,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(TL)){const S=this._view.computeMapPointFromVec3d(TL);return S.z=i,S}return null}computeIntersection(t,r,i){var y;if(E(t))return;const s=this._view.state.camera,n=We.get();s.projectToRenderScreen(t.origin,n);const o=new jle(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=t.origin,l=me(We.get(),t.origin,t.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,h=v(c)?Lne(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const b=_.layerUid,x=Array.isArray(b),T=x?b:[b];x&&(r.options.filteredLayerUids=[]);let S=!1;for(const C of T)o.filterLayerUid(C)?S=!0:x&&r.options.filteredLayerUids.push(C);if(r.options.isFiltered=!S,_.isGround&&p||!r.options.isFiltered){const C=_.slicePlaneEnabled?h:null;_.intersect(r,C,a,l,n)}});const f=We.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&v(m.spatialReference)&&r.results.ground.getIntersectionPoint(f)){const _=m.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,x=We.get();this._view.renderCoordsHelper.fromRenderCoords(f,x,m.spatialReference),x[2]=Pt((y=this._view.elevationProvider)==null?void 0:y.getElevation(f[0],f[1],f[2],b,"ground"),0),_.intersect(r,x,r.results.ground,T=>o.filterRenderGeometry(T))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(t){const r=t.results.hud;my(this._tmpRegion,i7);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=x=>{const T=new Nht(x);i.projectToRenderScreen(x.target.center,T.screenPoint),T.screenPoint[0]=Math.floor(T.screenPoint[0]),T.screenPoint[1]=Math.floor(T.screenPoint[1]),s.push(T),yX(n,T.screenPoint)};t.sortResults(r.all),v(r.min.dist)&&o(r.min);for(const x of r.all)r.min.target.object!==x.target.object&&r.max.target.object!==x.target.object&&o(x);if(v(r.max.dist)&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-g3),h=Math.max(0,n[1]-g3),p=Math.min(Au(n)+2*g3,a-c),f=Math.min(Ip(n)+2*g3,l-h),m=new Uint8Array(p*f*4);this._view._stage.renderer.readHUDVisibility(c,h,p,f,m);let y=!0;const _=E(t.results.max.dist);let b=0;for(const x of s)for(const T of Dht)if(m[4*(Math.min(x.screenPoint[0]+T[0],a)-n[0]+(Math.min(x.screenPoint[1]+T[1],l)-n[1])*p)]){y&&(t.results.min.copy(x.result),y=!1),_&&t.results.max.copy(x.result),t.options.store===Bo.ALL&&t.results.all.splice(b++,0,x.result);break}}}const g3=1,Dht=(()=>{const e=[],t=g3;for(let r=-t;r<=t;r++)for(let i=-t;i<=t;i++)e.push([i+t,r+t]);return e})();class Nht{constructor(t){this.result=t,this.screenPoint=ta()}}let xL;function Gle(e){return xL&&xL.viewingMode===e||(xL=od(e)),xL}class jle{constructor(t,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(t){const{include:r,exclude:i}=this;return E(t)?r==null&&i==null:(r==null||r.has(t))&&(i==null||!i.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function Hle(e){return typeof e=="object"&&"intersect"in e}const TL=M(),SL=ta();class vSt{constructor(t,r){this.spatialReference=t,this._view=r}getElevation(t,r,i){return this._view.elevationProvider.getElevation(t,r,0,this.spatialReference,i)}async queryElevation(t,r,i,s,n){return this._view.elevationProvider.queryElevation(t,r,0,this.spatialReference,n,i,s)}}class Fht{constructor(t,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=t.registerTask(gt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,r,i,s=0){return new Promise((n,o)=>{const a={x:t,y:r,minDemResolution:s,result:{resolve:n,reject:o},signal:i};this._queries.push(a),Ca(i,()=>{wW(this._queries,a),o(Wr())})})}get running(){return this._queries.length>0}runTask(t){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(h=>h.result.reject()),void t.madeProgress();const s=r.map(h=>[h.x,h.y]),n=r.reduce((h,p)=>Math.min(h,p.minDemResolution),1/0),o=new oP({points:s,spatialReference:this.spatialReference}),a=r.length>1&&r.some(h=>!!h.signal)?new AbortController:null,l=v(a)?a.signal:r[0].signal;if(v(a)){let h=0;r.forEach(p=>Ca(p.signal,()=>{h++,p.result.reject(Wr()),h===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};i.queryElevation(o,c).then(h=>{r.forEach((p,f)=>{v(p.signal)&&p.signal.aborted?p.result.reject(Wr()):p.result.resolve(h.geometry.points[f][2])})}).catch(h=>{r.forEach(p=>p.result.reject(h))}),t.madeProgress()}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask(Ka)}}}let y3=class extends Vs.EventedMixin(Te){get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:t.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Ve(this._elevationQueryCached)}get _elevationQuery(){return E(this._elevationQueryCached)&&(this._elevationQueryCached=new Fht(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,r,i,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&r===o.z&&Pn(i,o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=EL(n,this._im,e,t,r,i,s),E(n)&&(n=EL(n,this._ground,e,t,r,i,s)),s==="scene"&&(n=EL(n,this._scene,e,t,r,i,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:r,spatialReference:i,queryContext:s,result:n}),n}queryElevation(e,t,r,i,s,n=null,o=0){const a=uv();return this._elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=EL(l,this._scene,e,t,r,i,s)),a.resolve(l)}).catch(l=>{sn(l)?a.reject(l):a.resolve(this.getElevation(e,t,r,i,s))}),a.promise}register(e,t){this._handles.set(t,t.on("elevation-change",r=>this.emit("elevation-change",r))),this._providersFromContext(e).push(t)}unregister(e){var t;this._handles.has(e)&&((t=this._handles.get(e))==null||t.remove(),this._handles.delete(e));for(const r of[this._im,this._ground,this._scene]){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function EL(e,t,r,i,s,n,o){for(const a of t){const l=a.getElevation(r,i,s,n,o);v(l)&&(e=v(e)?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],y3.prototype,"view",void 0),u([d()],y3.prototype,"spatialReference",null),y3=u([P("esri.views.3d.support.CombinedElevationProvider")],y3);class X_{static isValidProfile(t){return t in X_.profiles}static getDefaultProfile(){return de("esri-iPhone")?"low":"medium"}static apply(t,r){const i=X_.profiles[t];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}}function qle(){const e=!!de("esri-mobile"),t=!!de("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!de("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!de("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:e?1:1/0}}}X_.test={reset(){const e=qle();for(const t in e)X_.profiles[t]=e[t]}},function(e){e.profiles=qle()}(X_||(X_={}));const RN=X_;function GSe(){return new Float32Array(4)}function Uht(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Up(e,t,r,i){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function kht(e,t){return new Float32Array(e,t,4)}function jSe(){return GSe()}function HSe(){return Up(1,1,1,1)}function qSe(){return Up(1,0,0,0)}function WSe(){return Up(0,1,0,0)}function XSe(){return Up(0,0,1,0)}function YSe(){return Up(0,0,0,1)}const Vht=jSe(),Bht=HSe(),zht=qSe(),Ght=WSe(),jht=XSe(),Hht=YSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Bht,UNIT_W:Hht,UNIT_X:zht,UNIT_Y:Ght,UNIT_Z:jht,ZEROS:Vht,clone:Uht,create:GSe,createView:kht,fromValues:Up,ones:HSe,unitW:YSe,unitX:qSe,unitY:WSe,unitZ:XSe,zeros:jSe},Symbol.toStringTag,{value:"Module"}));const Wle=new Qe([0,255,255]),Xle=new Qe([0,0,0]),Yle=1,Zle=.25,Jle=.4,Qle=.2;let Rf=class extends Te{constructor(){super(...arguments),this.color=Wle.clone(),this.haloColor=null,this.haloOpacity=Yle,this.fillOpacity=Zle,this.shadowOpacity=Jle,this.shadowColor=Xle.clone(),this.shadowDifference=Qle}static toEngineOptions(e){var l,c,h,p,f,m;const t=Qe.toUnitRGBA((l=e.color)!=null?l:Wle),r=v(e.haloColor)?Qe.toUnitRGBA(e.haloColor):t,i=Qe.toUnitRGBA((c=e.shadowColor)!=null?c:Xle),s=(h=e.haloOpacity)!=null?h:Yle,n=(p=e.fillOpacity)!=null?p:Zle,o=(f=e.shadowOpacity)!=null?f:Jle,a=(m=e.shadowDifference)!=null?m:Qle;return{color:Up(t[0],t[1],t[2],t[3]),haloColor:Up(r[0],r[1],r[2],r[3]),haloOpacity:s,haloOpacityOccluded:.25*s,fillOpacity:n,fillOpacityOccluded:.25*n,shadowOpacity:o,shadowColor:Ht(i[0],i[1],i[2],i[3]),occludedShadowOpacity:o*(1-a)}}};u([d({type:Qe})],Rf.prototype,"color",void 0),u([d({type:Qe})],Rf.prototype,"haloColor",void 0),u([d()],Rf.prototype,"haloOpacity",void 0),u([d()],Rf.prototype,"fillOpacity",void 0),u([d()],Rf.prototype,"shadowOpacity",void 0),u([d({type:Qe})],Rf.prototype,"shadowColor",void 0),u([d()],Rf.prototype,"shadowDifference",void 0),Rf=u([P("esri.views.3d.support.HighlightOptions")],Rf);const _q=Rf;let bb=class extends fe{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(i=>i.toJSON()),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:dC(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([d()],bb.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],bb.prototype,"outSpatialReference",void 0),u([d()],bb.prototype,"transformation",void 0),u([d()],bb.prototype,"transformForward",void 0),bb=u([P("esri.rest.support.ProjectParameters")],bb);const NQ=bb,qht=Us(NQ);async function ZSe(e,t,r){t=qht(t);const i=VY(e),s={...i.query,f:"json",...t.toJSON()},n=t.outSpatialReference,o=dC(t.geometries[0]),a=_Ue(s,r);return Di(i.path+"/project",a).then(({data:{geometries:l}})=>H0e(l,o,n))}async function FQ(e=null,t){var s,n;if(ni.geometryServiceUrl)return ni.geometryServiceUrl;if(!e)throw new j("internal:geometry-service-url-not-configured");let r;r="portal"in e?e.portal||Uo.getDefault():e,await r.load({signal:t});const i=(n=(s=r.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!i)throw new j("internal:geometry-service-url-not-configured");return i}async function Wht(e,t,r=null,i){const s=await FQ(r,i),n=new NQ;n.geometries=[e],n.outSpatialReference=t;const o=await ZSe(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new j("internal:geometry-service-projection-failed")}var Xht=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getGeometryServiceURL:FQ,projectGeometry:Wht});class Yht{constructor(t,r){this.spatialReference=r,this.unitInMeters=ll(this.spatialReference,Zr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=FQ(t&&t.get("portalItem")).catch(()=>{throw new j("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?i=t:(i=[t],s=!1);const n=i.map(l=>l instanceof yt?l:new yt(l,this.spatialReference)),o=new NQ({geometries:n,outSpatialReference:Ye.WGS84}),a=(await ZSe(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}}let Xd=class extends Te{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([d()],Xd.prototype,"minTotalNumberOfFeatures",void 0),u([d()],Xd.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],Xd.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],Xd.prototype,"snapshotAvailable",void 0),u([d()],Xd.prototype,"polygonLodFactor",void 0),u([d()],Xd.prototype,"polylineLodFactor",void 0),u([d()],Xd.prototype,"skipHighSymbolLods",void 0),Xd=u([P("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Xd);let hm=class extends Te{constructor(){super(...arguments),this.lodFactor=1}};u([d()],hm.prototype,"lodFactor",void 0),hm=u([P("esri.views.3d.support.QualitySettings.LoDFactorSettings")],hm);let K4=class extends hm{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};K4=u([P("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],K4);let kg=class extends Te{constructor(){super(...arguments),this.object=new K4,this.point=new hm,this.integratedMesh=new hm,this.pointCloud=new hm,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:K4})],kg.prototype,"object",void 0),u([d({type:hm})],kg.prototype,"point",void 0),u([d({type:hm})],kg.prototype,"integratedMesh",void 0),u([d({type:hm})],kg.prototype,"pointCloud",void 0),u([d()],kg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),kg=u([P("esri.views.3d.support.QualitySettings.SceneServiceSettings")],kg);let b_=class extends Te{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([d()],b_.prototype,"lodBias",void 0),u([d()],b_.prototype,"angledSplitBias",void 0),u([d()],b_.prototype,"reduceTileLevelDifferences",void 0),u([d()],b_.prototype,"textureFadeDuration",void 0),b_=u([P("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],b_);let cS=class extends Te{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],cS.prototype,"pixelRatio",void 0),u([d()],cS.prototype,"maxTotalNumberOfFeatures",void 0),cS=u([P("esri.views.3d.support.QualitySettings.HeatmapSettings")],cS);let Ol=class extends Te{constructor(){super(...arguments),this.graphics3D=new Xd,this.sceneService=new kg,this.tiledSurface=new b_,this.heatmap=new cS,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};u([d({type:Xd})],Ol.prototype,"graphics3D",void 0),u([d({type:kg})],Ol.prototype,"sceneService",void 0),u([d({type:b_})],Ol.prototype,"tiledSurface",void 0),u([d({type:cS})],Ol.prototype,"heatmap",void 0),u([d()],Ol.prototype,"fadeDuration",void 0),u([d()],Ol.prototype,"antialiasingEnabled",void 0),u([d()],Ol.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],Ol.prototype,"highQualityTransparency",void 0),u([d()],Ol.prototype,"memoryLimit",void 0),u([d()],Ol.prototype,"additionalCacheMemory",void 0),u([d()],Ol.prototype,"frameRate",void 0),u([d()],Ol.prototype,"maximumPixelRatio",void 0),Ol=u([P("esri.views.3d.support.QualitySettings.QualitySettings")],Ol);const Kle=Ol;function Zht(e){return SW(e)&&e.length>=3}function Jht(e){return(EW(e)||Array.isArray(e))&&e.length>=3}function Qht(e){return Zht(e)||Jht(e)}class e5{constructor(t,r,i,s){this.viewingMode=t,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=VDe(s)}set extent(t){t&&BDe(this._coordinateSystem,t,this._coordinateSystem)}getAltitude(t){return YDe(this._coordinateSystem,t)}setAltitude(t,r,i=t){return aye(this._coordinateSystem,i,r,t)}setAltitudeOfTransformation(t,r){ZDe(this._coordinateSystem,r,t,r)}worldUpAtPosition(t,r){return HDe(this._coordinateSystem,t,r)}worldBasisAtPosition(t,r,i){return qDe(this._coordinateSystem,t,r,i)}basisMatrixAtPosition(t,r){const i=this.worldBasisAtPosition(t,Ic.X,We.get()),s=this.worldBasisAtPosition(t,Ic.Y,We.get()),n=this.worldBasisAtPosition(t,Ic.Z,We.get());return $m(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(t,r){const i=this.worldUpAtPosition(t,We.get()),s=this.worldBasisAtPosition(t,Ic.Y,We.get()),n=Nge(r,s,i);return nl(n)}intersectManifoldClosestSilhouette(t,r,i){return ck(this._coordinateSystem,r,this._tmpCoordinateSystem),XDe(this._tmpCoordinateSystem,t,i),i}intersectManifold(t,r,i){ck(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=We.get();return WDe(this._tmpCoordinateSystem,t,s)?le(i,s):null}intersectInfiniteManifold(t,r,i){if(this.viewingMode===Ge.Global)return this.intersectManifold(t,r,i);ck(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=We.get();return Tx(s.plane,t,n)?le(i,n):null}toRenderCoords(t,r,i){return I4(t)?aa(t,r,this.spatialReference):mo(t,r,i,this.spatialReference)}fromRenderCoords(t,r,i=null){return I4(r)?(v(i)&&(r.spatialReference=i),Jme(t,this.spatialReference,r)):Qht(r)?mo(t,this.spatialReference,r,i)?r:null:mv(t,this.spatialReference,r)}static create(t,r){switch(t){case Ge.Local:return new e5(Ge.Local,r,ll(r),jDe());case Ge.Global:return new e5(Ge.Global,r,1,GDe(r))}}static renderUnitScaleFactor(t,r){return ece(t)/ece(r)}}function ece(e){if(JE(e,Ge.Global))return 1;const t=lye(!1,e);return ll(t)}var Jf;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(Jf||(Jf={}));const Kht=(()=>{const e=new Array;return e[Jf.ELEVATION]=10,e[Jf.BASEMAP]=10,e[Jf.I3S_INDEX]=10,e[Jf.I3S_DATA]=10,e[Jf.SYMBOLOGY]=5,e})(),edt=30;function JSe(e){return typeof e.getUsedMemory=="function"}function tdt(e){return new Ml({view:e})}const CL=1,oB=1,rdt=.75,idt=.6,tce=1.3;let Ml=class extends Te{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new FY,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(CL),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new V6e(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<idt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(CL);else if(e)(this._memoryPredicted>1.1*oB||this._memoryUsed>oB)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/tce),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>oB)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/tce),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<rdt&&this._quality<CL){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),CL))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const r=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;v(r)&&(e+=r.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(JSe(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const i=E(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&i){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);ee.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([d({constructOnly:!0})],Ml.prototype,"view",void 0),u([d()],Ml.prototype,"maxMemory",null),u([d()],Ml.prototype,"additionalCacheMemory",null),u([d()],Ml.prototype,"memoryFactor",null),u([d()],Ml.prototype,"updating",null),u([d()],Ml.prototype,"usedMemory",null),u([d()],Ml.prototype,"_quality",void 0),u([d()],Ml.prototype,"_memoryUsed",void 0),u([d()],Ml.prototype,"_updating",void 0),u([d()],Ml.prototype,"_stableQuality",void 0),u([d()],Ml.prototype,"_maxMemory",void 0),u([d()],Ml.prototype,"_additionalCacheMemory",void 0),Ml=u([P("esri.views.3d.support.MemoryController")],Ml);class sdt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class ndt{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new odt}}class odt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class adt{constructor(t,r,i,s){this._workerFunc=t,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new ndt(n))}destroy(){this._clients.length=0}hasQuota(t){const r=this._clients[t];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(t){const r=this._clients[t.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(i,s)=>this._taskCallback(i,s))):r.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}_taskFinished(t){const r=this._clients[t.client];this._totalNumWorkers--,r.numWorkers--,r.statistics.requests++,r.statistics.size+=t.size||0,r.statistics.duration+=t.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,mt(r.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,r){t._cancelled||(this._callbackFunc(t,r),this._taskFinished(t))}getStatsForType(t){const r=this._clients[t];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const t=this;return{set workerFunc(r){t._workerFunc=r}}}}let ON=class extends Te{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,r){this._loadQueue=new adt((i,s)=>this._startLoading(i,s),(i,s)=>this._doneLoadingCB(i,s),e,t),r&&(this._frameTask=r.registerTask(gt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=zi(this._frameTask),this._tasks.forEach(e=>Yh(e.abortController)),this._loadQueue=Ve(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,r,i={}){const s=uv();s.__signal=v(i)?i.signal:null;const n=this._createOrUpdateTask(e,t,r,i,s);return Ca(i,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,r,i,s,n){const o=new udt(e,t,r,i,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){var r;EO(e.resolvers,t),t.reject(Wr()),e.resolvers.length===0&&(e.status===xh.DOWNLOADING&&(e.status=xh.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=xh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,r,i,s){const n=hdt(v(i)&&i.uid||e,t,r),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,i,t,r,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(mt(e.status===xh.DOWNLOADING),e.status=xh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();cr(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==xh.DOWNLOADED&&(t.err=t.err||Wr()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!sn(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const i of e.resolvers)if(t)sn(t)?i.reject(t):i.reject(new j("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--r;const s=r<=0?e.result:re(e.result);i.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===xh.CANCELLED)return!1;let r,i;switch(e.startTime=performance.now(),e.status=xh.DOWNLOADING,e.docType){case"binary":i="array-buffer",r=0;break;case"image":i="image";break;case"image+type":i="array-buffer";break;default:i="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=Di(e.url,{...e.options,responseType:i,timeout:r,signal:s});let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===xh.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=cdt(c);if(i="image",e.size=c.byteLength,h==="unknown")return e.request=Di(e.url,{responseType:i,timeout:r,signal:s}),void e.request.then(m=>o(m.data),a);const p=new Blob([c],{type:h}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=Di(f,{responseType:i,timeout:r,signal:s}),e.request.then(m=>o(new JU(m.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],ON.prototype,"updating",void 0),ON=u([P("esri.views.3d.support.StreamDataLoader")],ON);const ldt={numRetries:0};function cdt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class JU{constructor(t,r,i){this.image=t,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}}class udt extends sdt{constructor(t,r,i,s,n){super(s),this.url=t,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=xh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=ldt.numRetries}}function hdt(e,t,r){return`${e}:${t}:${r}`}var xh;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(xh||(xh={}));let MN=class extends Te{constructor(){super(...arguments),this.updating=!1}};function ddt(e){return new Of({view:e})}u([d({readOnly:!0})],MN.prototype,"updating",void 0),MN=u([P("esri.views.3d.support.ResourceControllerMain")],MN);let Of=class extends MN{constructor(){super(...arguments),this._immediateTask=IE,this._normalTask=IE,this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=fHe(),this._memoryController=tdt(this.view),this._streamDataLoader=new ON,this._streamDataLoader.setup(edt,Kht,this._scheduler),this.addHandles([se(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},ri),se(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=rE({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(gt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(gt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=zi(this._frameTask),this._streamDataLoader=Ve(this._streamDataLoader),this._memoryController=Ve(this._memoryController),this._scheduler=Ve(this._scheduler)}get updating(){var e,t,r;return!!(((e=this._memoryController)==null?void 0:e.updating)||((t=this._streamDataLoader)==null?void 0:t.updating)||((r=this._immediateTask)==null?void 0:r.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(r,i,s)=>t.request(r,i,e,s),get busy(){return!t.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(IW(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([d({constructOnly:!0})],Of.prototype,"view",void 0),u([d()],Of.prototype,"_scheduler",void 0),u([d()],Of.prototype,"_memoryController",void 0),u([d()],Of.prototype,"_streamDataLoader",void 0),u([d()],Of.prototype,"_immediateTask",void 0),u([d()],Of.prototype,"_normalTask",void 0),u([d({readOnly:!0})],Of.prototype,"updating",null),Of=u([P("esri.views.3d.support.ResourceControllerImpl")],Of);function pdt(e){return"performanceInfo"in e}const wT=M(),fdt=M(),ig=M(),sg=M();function mdt(e,t,r=0){const i=e.extent;if(E(i))return!1;if(r===0)return Rfe(i,t);const s=Math.min(i[2]-i[0],i[3]-i[1]);return mPe(i,t,r*s)}function AL(e,t,r,i){le(wT,r),wT[i]=t[i];const s=ge(wT,wT,t),n=ge(fdt,e,t),o=_e(n,s),a=_e(s,s);let l;l=o<=0?t:a<=o?r:me(wT,t,ae(s,s,o/a));const c=ge(wT,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function gdt(e,t,r){const i=e.extent;if(E(i))return 0;ig[0]=i[0],ig[1]=i[1],ig[2]=r,sg[0]=i[2],sg[1]=i[3],sg[2]=r;let s=1/0,n=1/0;return t[0]<ig[0]?s=AL(t,ig,sg,0):t[0]>sg[0]&&(s=AL(t,sg,ig,0)),t[1]<ig[1]?n=AL(t,ig,sg,1):t[1]>sg[1]&&(n=AL(t,sg,ig,1)),Math.min(s,n)}function ydt(e,t,r){if(E(e))return OZ();if(e.spatialReference.isGeographic&&!Nw(e.spatialReference))return new j("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=rs.checkUnsupported(e);if(v(i))return i;if(E(r))return new j("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=_dt(e,r);if(s)return s;const n=e.spatialReference;return v(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new j("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function _dt(e,t){const r=e.lods,i=r[0].resolution*2**r[0].level,s=[i*e.size[0],i*e.size[1]],n=[e.origin.x,e.origin.y],o=Cfe(t),a=ur();rs.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>Q2){const c=r[0].scale*2**r[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/i;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new j("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:Q2})}return null}const vdt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:ydt,isInsideExtent:mdt,tiltToExtentEdge:gdt},Symbol.toStringTag,{value:"Module"}));function bdt(){return!0}function wdt(){return 0}function xdt(e,t){if(E(e))return OZ();const r=e.lods.length-1,i=e.spatialReference,s=Nw(i)||Om(i)||Mm(i);if(i.isWebMercator){if(!rs.makeWebMercatorAuxiliarySphere(r).compatibleWith(e))return new j("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new j("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!rs.makeGCSWithTileSize(e.spatialReference,e.size[0],r).compatibleWith(e))return e.spatialReference.isWGS84?new j("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new j("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return v(t)&&!e.spatialReference.equals(t)?new j("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const Tdt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:xdt,isInsideExtent:bdt,tiltToExtentEdge:wdt},Symbol.toStringTag,{value:"Module"})),Sdt={[Ge.Global]:Tdt,[Ge.Local]:vdt};function Gf(e,t){e||console.warn("Terrain: "+t)}let On=!1,t5=!1;function Edt(e){t5=e,On=On||e}function Cdt(e){On=e}function Re(e,t){var r;if(On&&!e){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(t||"")+" at "+i),new Error("Assertion failed"+(t?": "+t:""))}}function vq(e){return QU(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function r5(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function QU(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function UQ(e){return(e==null?void 0:e.type)==="tile-3d"}function VM(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function QSe(e){return(e==null?void 0:e.type)==="wmts-3d"}function bq(e){return(e==null?void 0:e.type)==="elevation-3d"}function GA(e){return(e==null?void 0:e.type)==="group"}function i5(e){return e&&(UQ(e)||QSe(e)||QU(e)||VM(e))}function wq(e){return e&&(UQ(e)||QU(e)||VM(e)||QSe(e))}function BM(e){return wq(e)||bq(e)}function Adt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return v(t)&&"type"in t&&t.type==="raster-tile"}function Rdt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return v(t)&&"type"in t&&t.type==="vector-tile"}function Odt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return v(t)&&"type"in t&&t.type==="tile-texture"}function Mdt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return t instanceof HTMLImageElement||t instanceof JU||t instanceof HTMLCanvasElement||t instanceof ImageData}function GS(e){return v(e)&&"release"in e&&e.release(),null}function rce(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function kQ(e,t,r,i){return Sdt[i].checkIfTileInfoSupportedForViewSR(e,r,t)}function KU(e,t,r){let i=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=Pdt(e,t,r);i=n.tileInfo,s=n.fullExtent}else{s=r5(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=r===Ge.Local;if(r5(e))i=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!Idt(t)||$dt.force512VTL,a=e.tileInfo.spatialReference.isGeographic;i=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=e.tileInfo}return v(i)&&v(s)&&kQ(i,s,t,r)==null?{tileInfo:i,fullExtent:s}:null}function Pdt(e,t,r){const i=KDe(e);if(v(i)){if(!pt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>kQ(n.tileInfo,n.fullExtent,t,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Idt(e){return e.isWGS84||e.isWebMercator||cpe(e)||!sE(e)}const $dt={force512VTL:!1};function ice(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function ng(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function Dh(e,t,r=Ndt){return Math.abs(e-t)<r}function xq(e){return e===At.NORTH_EAST?At.SOUTH_WEST:e===At.NORTH_WEST?At.SOUTH_EAST:e===At.SOUTH_WEST?At.NORTH_EAST:At.NORTH_WEST}function s5(e){return e===At.NORTH?At.SOUTH:e===At.EAST?At.WEST:e===At.SOUTH?At.NORTH:At.EAST}function Ldt(e){return e===At.NORTH_WEST||e===At.SOUTH_WEST}function Ddt(e){return e===At.NORTH_WEST||e===At.NORTH_EAST}function sce(e){return e===At.NORTH_WEST||e===At.WEST||e===At.SOUTH_WEST}function nce(e){return e===At.NORTH_EAST||e===At.EAST||e===At.SOUTH_EAST}function oce(e){return e===At.SOUTH_EAST||e===At.SOUTH||e===At.SOUTH_WEST}function ace(e){return e===At.NORTH_EAST||e===At.NORTH||e===At.NORTH_WEST}const im=[At.NORTH,At.EAST,At.SOUTH,At.WEST],n5=[At.NORTH_EAST,At.SOUTH_EAST,At.SOUTH_WEST,At.NORTH_WEST],Ndt=1e-5;class Fdt{constructor(t,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=BM(t)?r.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),pdt(t)){const i=t.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}}class Udt{constructor(t){var i,s,n;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,v(t.resourceController)){const o=t.resourceController.memoryController;this.totalMemory=((i=o.maxMemory)!=null?i:0)*bE.MEGABYTES,this.usedMemory=Math.round(o.usedMemory*this.totalMemory),this.quality=o.memoryFactor,this.load=t.resourceController.scheduler.load}this.terrainMemory=(n=(s=t.basemapTerrain)==null?void 0:s.getUsedMemory())!=null?n:0;const r=t._stage&&t._stage.renderView&&t._stage.renderer.edgeView;this.edgesMemory=v(r)?r.usedMemory:0,t.allLayerViews.items.forEach(o=>{(JSe(o)||BM(o))&&this.layerPerformanceInfos.push(new Fdt(o,t))}),this.layerPerformanceInfos.sort((o,a)=>a.memory-o.memory)}}class kdt{constructor(t){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=t("gltf-resources",()=>{}),this._wosrMemCache=t("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(t=>t.abortController.abort()),this._wosrLoading.forEach(t=>t.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(t,r,i){const s=i?`gltfPBR:${t}`:`gltf:${t}`,n=this._gltfMemCache.get(s);return v(n)?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>wSe(new vSe(o.streamDataRequester),t,o,i),r)}loadWOSR(t,r){const i=`wosr:${t}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return v(s)?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>xSe(t,n),r)}async _loadOnce(t,r,i,s,n){cr(n);const o=Ca(n,()=>this._abortLoad(t,i));let a=t.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},t.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),t.delete(i),cr(n),l}finally{zi(o)}}_abortLoad(t,r){const i=t.get(r);v(i)&&--i.refCount>0||(t.delete(r),v(i)&&i.abortController.abort())}}class Vdt extends K2{constructor(t,r,i,s){super(r,s),this._streamDataRequester=t,this._parameters=i}async fromUrl(t,r,i){cr(i);const s=v(i)?i.signal:null,n=this.makeUid(t,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a};const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async h=>{const p=this._createTexture(t,h,r);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:n,texture:p,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}o.referenceCount++;try{return await MW(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(t,r,i){var n;const s={...this._parameters,powerOfTwoResizeMode:rv.PAD};if(qfe(t)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return s.width=r.width,s.height=r.height,new Ep(r,s)}}class Bdt{constructor(t){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=t.viewState,this._view=t.view,this._pointsOfInterest=t.pointsOfInterest,this.streamDataRequester=t.resourceController.createStreamDataRequester(Jf.SYMBOLOGY),this.objectResourceCache=new kdt((i,s)=>t.resourceController.memoryController.newCache(i,s)),this.textures=new Vdt(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:Rt.CLAMP_TO_EDGE,t:Rt.CLAMP_TO_EDGE}},t.resourceController.scheduler);const r=Zr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=Rxe(t.viewingMode,r),this.screenSizePerspectiveSettingsLabels=Wet(t.viewingMode,r)}destroy(){Ve(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return Mp();this._graphicsOwners.push(t);const r=se(()=>{var i;return(i=t.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Mp(()=>{r.remove(),EO(this._graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(t&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Jr;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([se(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,ri),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else t||(this._screenSizePerspectiveHandles=Ve(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const t=this._pointsOfInterest;RL.distance=t.centerOnSurfaceInfrequent.distance,RL.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(RL),this.screenSizePerspectiveSettingsLabels.update(RL),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}const RL={distance:0,fovY:0};class O2{constructor(t,r,i=""){this.graphics=t,this._symbol=new D_({symbolLayers:[new L_({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new bx({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(t,r){if(E(r))return;this.hide();const i=new yt({x:t[0],y:t[1],z:t[2],spatialReference:r});this._graphic=new Aa({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){v(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let O_=class extends Te{constructor(e){super(e),this.handles=new Jr}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],O_.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],O_.prototype,"surface",void 0),u([d({constructOnly:!0})],O_.prototype,"state",void 0),O_=u([P("esri.views.3d.support.PointOfInterest")],O_);const zdt=Array;let jd=class extends O_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new vy({location:yt,renderLocation:zdt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=M(),this._tmpPoint=new yt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(dn(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Ve(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Ai(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return nx(r,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var i;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),na.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const t=((i=this._tmpPoint.z)!=null?i:0)>Gdt&&this.renderCoordsHelper.viewingMode===Ge.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:t?jdt:0}).then(s=>{var n;return this._updateSurfaceAltitude((n=s.geometry.z)!=null?n:0)}).catch(s=>{sn(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,na.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(aB,this._estimatedSurfaceAltitude,this._camera.eye),el(this._get("renderLocation"),aB)||(this._set("renderLocation",le(this._propertiesPool.get("renderLocation"),aB)),this.notifyChange("renderLocation"))}};u([d({constructOnly:!0})],jd.prototype,"scheduler",void 0),u([d({constructOnly:!0})],jd.prototype,"cache",void 0),u([d({constructOnly:!0})],jd.prototype,"task",void 0),u([d({readOnly:!0})],jd.prototype,"location",null),u([d({constructOnly:!0})],jd.prototype,"map",void 0),u([d({readOnly:!0})],jd.prototype,"renderLocation",void 0),u([d({readOnly:!0})],jd.prototype,"scale",null),u([d({readOnly:!0})],jd.prototype,"updating",null),jd=u([P("esri.views.3d.support.CameraOnSurface")],jd);const aB=M(),Gdt=1e5,jdt=1e6,Hdt=Array;let Th=class extends O_{constructor(e){super(e),this._propertiesPool=new vy({location:yt,renderLocation:Hdt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=M(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=zi(this._frameWorker),this._propertiesPool=Ve(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,na.YIELD}_updateRenderLocation(){const e=Wdt;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&r&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const i=Xdt;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,i)&&(le(e,i),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Ai(this._camera.eye,e):(ae(e,this._camera.viewForward,this._get("distance")),me(e,e,this._camera.eye)),el(this._get("renderLocation"),e)||this._set("renderLocation",le(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){var i,s;const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,t))return!1;if(this.state.isGlobal){const n=Zr(this.renderCoordsHelper.spatialReference).radius,o=n+e,a=ba(r.eye),l=a<o*o,c=Ai(r.eye,t);if(l&&c>n/4){const h=o-Math.sqrt(a);return ae(t,r.viewForward,h),me(t,t,r.eye),!0}}else{const n=(i=this.surface)!=null&&i.ready?this.surface.extent:null;v(n)&&s6(n,(s=this.surface)==null?void 0:s.spatialReference,jA,this.renderCoordsHelper.spatialReference)&&(t[0]=ye(t[0],jA[0],jA[2]),t[1]=ye(t[1],jA[1],jA[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Xr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,i=Ai(r,e),s=Ai(r,t);if(Math.abs(s-i)/i>qdt)return!0}return!1}};u([d({constructOnly:!0})],Th.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Th.prototype,"task",void 0),u([d()],Th.prototype,"distance",void 0),u([d({constructOnly:!0})],Th.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Th.prototype,"location",null),u([d({readOnly:!0})],Th.prototype,"renderLocation",void 0),u([d()],Th.prototype,"updating",void 0),Th=u([P("esri.views.3d.support.CenterOnSurface")],Th);const qdt=.05,Wdt=M(),Xdt=M(),jA=ur();class Ydt{constructor(t){this._handles=new Jr,this.events=new Vs,this._contentLayerViews=t.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Ve(this._handles)}_layerViewsChanged(t){t.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),t.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",Zdt)}}const Zdt={},Jdt=Array;let Mf=class extends O_{constructor(e){super(e),this._propertiesPool=new vy({location:yt,renderLocation:Jdt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([se(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),se(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(gt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Ve(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,i=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(t,lce);const s=Math.max(0,(Math.acos(_e(lce,i.viewForward))-.5*Math.PI)*(i.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!lv(e,t)){const l=this._propertiesPool.get("renderLocation");le(l,t),this._set("renderLocation",l)}return na.YIELD}const n=1-ye(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(cce);const a=this._propertiesPool.get("renderLocation");return rn(a,t,cce,o),e&&lv(e,a)||this._set("renderLocation",a),na.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,r=t.getRenderCenter(ta());if(r[1]=t.aboveGround?t.padding[lr.BOTTOM]:t.fullHeight-t.padding[lr.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const i=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,HA)){ge(HA,HA,t.eye);const s=ve(HA,HA);if(this.renderCoordsHelper.intersectManifold(zu(t.eye,s),i,e))return e}return this.renderCoordsHelper.setAltitude(e,i,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],Mf.prototype,"_dirty",void 0),u([d({constructOnly:!0})],Mf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Mf.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],Mf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],Mf.prototype,"updating",null),u([d({readOnly:!0})],Mf.prototype,"location",null),u([d({readOnly:!0})],Mf.prototype,"renderLocation",void 0),Mf=u([P("esri.views.3d.support.pointsOfInterest.Focus")],Mf);const lce=M(),HA=M(),cce=M();let Pg=class extends Te{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=M();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Jr}initialize(){this.view.state.isLocal&&(this._handles.add([se(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),dn(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||E(this.surfaceView.extent)||E(this.surfaceView.spatialReference))return void this._set("location",null);const e=_X(this.surfaceView.extent),t=new yt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{sn(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",t)}};u([d({constructOnly:!0})],Pg.prototype,"view",void 0),u([d({constructOnly:!0})],Pg.prototype,"cache",void 0),u([d()],Pg.prototype,"surface",null),u([d()],Pg.prototype,"surfaceView",null),u([d({readOnly:!0})],Pg.prototype,"location",void 0),u([d({readOnly:!0})],Pg.prototype,"renderLocation",null),Pg=u([P("esri.views.3d.terrain.StableSurfaceCenter")],Pg);let Ig=class extends Te{constructor(e){super(e),this._tileGeometryUpdateExtent=ed(),this._tileGeometryUpdateSpatialReference=null,this.events=new Vs,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(gt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Qdt),ed(this._tileGeometryUpdateExtent),this._set("updating",!1)),na.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Q_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.contentCamera.eye,i=Kdt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,E1,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,C1,t),E1[0]<C1[0]?(i[0]=E1[0],i[2]=C1[0]):(i[0]=C1[0],i[2]=E1[0]),E1[1]<C1[1]?(i[1]=E1[1],i[3]=C1[1]):(i[1]=C1[1],i[3]=E1[1]),z5(i,e)}};u([d({constructOnly:!0})],Ig.prototype,"state",void 0),u([d({constructOnly:!0})],Ig.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],Ig.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Ig.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Ig.prototype,"surface",void 0),u([d({readOnly:!0})],Ig.prototype,"updating",void 0),Ig=u([P("esri.views.3d.support.SurfaceGeometryUpdates")],Ig);const Qdt={},E1=M(),C1=M(),Kdt=ed();let Ll=class extends Te{constructor(e){super(e),this._handles=new Jr,this._tmpRay=co(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new vy({renderPointOfView:ept},this),this.renderPointOfView=M(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:r,map:i}=this.view;this._surfaceIntersector=od(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Bo.MIN,this._contentIntersector=od(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Th({...a,task:gt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Th({...a,task:gt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Th({...a,task:gt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new jd({...a,cache:o,task:gt.POINT_OF_INTEREST_INFREQUENT,map:i})),this._set("surfaceGeometryUpdates",new Ig({...a,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Ydt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Pg({cache:o,view:this.view})),this._set("focus",new Mf({state:e,scheduler:n,surface:t,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new O2(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new O2(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new O2(l,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new O2(l,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new O2(l,"green","Focus")),this._handles.add([se(()=>e.contentCamera,h=>this._cameraChanged(h),ri),se(()=>t.extent,()=>this._updateCenterPointsOfInterest()),oa(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),ri),dn(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),dn(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),oa(()=>Xr.SHOW_POI,h=>this._setDebug(h),kt)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(t=>t.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return E(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,xT,rpt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(xT):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(E(e))return this._surfaceAltitudeAtCenter;const t=e.origin,r=me(xT,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(xT)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(xT)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,r){const i=AJ(t,e,tpt);if(E(i))return null;const s=i.origin,n=me(xT,i.origin,i.direction);return this._surfaceIntersector.resetWithRay(i,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;el(this.renderPointOfView,t)||this._set("renderPointOfView",le(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(se(()=>t.renderLocation,r=>{var i;return(i=this._debugCenters.get(t))==null?void 0:i.show(r,t.renderCoordsHelper.spatialReference)},kt),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],Ll.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],Ll.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],Ll.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],Ll.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],Ll.prototype,"focus",void 0),u([d({readOnly:!0})],Ll.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],Ll.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],Ll.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],Ll.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],Ll.prototype,"view",void 0),u([d({readOnly:!0})],Ll.prototype,"updating",null),Ll=u([P("esri.views.3d.support.PointsOfInterest")],Ll);const ept=Array,xT=M(),tpt=co(),rpt={exclude:new Set([E_])};class ipt{constructor(t){this._store=t}destroy(){this._store.destroy()}get(t){return this._store.get(t)}put(t,r){this._store.put(t,r,r.values.byteLength+256)}}class spt{constructor(t,r,i,s){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in t?(this.values=t.pixelData,this.width=t.width,this.height=t.height,this.noDataValue=t.noDataValue):(this.values=t,this.width=r,this.height=i,this.noDataValue=s)}get hasNoDataValues(){if(E(this._hasNoDataValues)){const t=this.noDataValue;this._hasNoDataValues=this.values.includes(t)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(v(this._minValue))return;const{noDataValue:t,values:r}=this;let i=1/0,s=-1/0,n=!0;for(const o of r)o===t?this._hasNoDataValues=!0:(i=o<i?o:i,s=o>s?o:s,n=!1);n?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=s>-3e38?s:0)}}class KSe{constructor(t,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=Mme(t,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>ee.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${t} worker: ${o}`))}on(t,r){const i={removed:!1,eventName:t,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Mp(()=>{i.removed=!0,wW(this._listeners,i),this._thread&&v(i.threadHandle)&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,r){return this.invokeMethod(this._mainMethod,t,r)}invokeMethod(t,r,i){if(this._thread){const s=this._transferLists[t],n=s?s(r):[];return this._thread.invoke(t,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(cr(i),this.invokeMethod(t,r,i))):Promise.reject(null)}broadcast(t,r){return this._thread?Promise.all(this._thread.broadcast(r,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,r)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(r=>{t.removed||(t.threadHandle=r)})}}class uce extends KSe{constructor(t=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,r,i){return t&&t.byteLength!==0?this.invoke({buffer:t,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(yO.forEach((t,r)=>{t===this&&yO.delete(r)}),this.destroy())}}const yO=new Map;function npt(e=null){let t=yO.get(e);return t||(v(e)?(t=new uce(r=>e.immediate.schedule(r)),yO.set(e,t)):(t=new uce,yO.set(null,t))),++t.ref,t}var Tc,hce,dce;(function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"})(Tc||(Tc={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(hce||(hce={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(dce||(dce={}));class opt{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class bSt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function wSt(e,t,r,i,s,n){const o=r-s;if(o>=0)return(t>>o)+(i-(n<<o))*(e>>o);const a=-o;return t-(n-(i<<a))*(e>>a)<<a}class xSt{constructor(t,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(t/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(t,r,i,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function apt(e,t,r,i,s,n){const o=t[i++];for(let a=0;a<o;a++){const l=new opt(n);l.xTile=t[i++],l.yTile=t[i++],l.hash=t[i++],l.priority=t[i++];const c=t[i++];for(let f=0;f<c;f++){const m=t[i++],y=t[i++],_=t[i++],b=t[i++],x=!!t[i++],T=t[i++],S=r[i++],C=r[i++],O=t[i++],R=t[i++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:b,hard:x,partIndex:T,width:O,height:R,minLod:S,maxLod:C})}const h=e[i++];for(let f=0;f<h;f++)l.textVertexRanges.push([e[i++],e[i++]]);const p=e[i++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[i++],e[i++]]);s.push(l)}return i}function TSt(e,t,r){for(const[i,s]of e.symbols)lpt(e,t,r,s,i)}function lpt(e,t,r,i,s){const n=e.layerData.get(s);if(n.type===Tc.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class e8{constructor(t,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=t,this.memoryUsed=t.byteLength;let i=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return E(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){E(this._data)||(this.doPrepareForRendering(t,this._data,this.bufferDataOffset),this._data=null)}}class cpt extends e8{constructor(t,r){super(t,r),this.type=Tc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],h=i[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){v(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),v(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),v(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.lineVertexBuffer=wr.createVertex(t,$r.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.lineIndexBuffer=wr.createIndex(t,$r.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new rd(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class upt extends e8{constructor(t,r){super(t,r),this.type=Tc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],h=i[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){v(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),v(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),v(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,v(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),v(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),v(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.fillVertexBuffer=wr.createVertex(t,$r.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.fillIndexBuffer=wr.createIndex(t,$r.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.outlineVertexBuffer=wr.createVertex(t,$r.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.outlineIndexBuffer=wr.createIndex(t,$r.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new rd(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new rd(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class hpt extends e8{constructor(t,r,i){super(t,r),this.type=Tc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],_=s[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=apt(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[r,i]of this.iconPerPageElementsMap)t+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)t+=i[1];return t/3}doDestroy(){v(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),v(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),v(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),v(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,v(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),v(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),v(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),v(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,r=this.iconOpacityBuffer;t.length>0&&t.byteLength===r.size&&r.setSubData(t,0,0,t.length);const i=this.textOpacity,s=this.textOpacityBuffer;i.length>0&&i.byteLength===s.size&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.iconVertexBuffer=wr.createVertex(t,$r.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.iconIndexBuffer=wr.createIndex(t,$r.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.textVertexBuffer=wr.createVertex(t,$r.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.textIndexBuffer=wr.createIndex(t,$r.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c,this.iconOpacityBuffer=wr.createVertex(t,$r.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=wr.createVertex(t,$r.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new rd(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new rd(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class dpt extends e8{constructor(t,r){super(t,r),this.type=Tc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){v(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),v(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),v(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.circleVertexBuffer=wr.createVertex(t,$r.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.circleIndexBuffer=wr.createIndex(t,$r.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new rd(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const SSt=!0,ESt=32,pce=200,ppt=1/de("mapview-transitions-duration");class fpt extends Vs{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){var i;if(this._stage===t)return;const r=this._stage;this._stage=t,t?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return E(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=uv(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=uv(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var t,r;(t=this._fadeInResolver)==null||t.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=t*ppt;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class Hf{static getId(t,r,i,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${r}/${i}/${s}`}constructor(t,r,i,s){this.set(t,r,i,s)}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|t<<8|i}acquire(t,r,i,s){this.set(t,r,i,s)}contains(t){const r=t.level-this.level;return r>=0&&this.row===t.row>>r&&this.col===t.col>>r&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new Hf(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,r,i,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Hf(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new Hf(t,r,i,s),new Hf(t,r,i+1,s),new Hf(t,r+1,i,s),new Hf(t,r+1,i+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}Hf.pool=new An(Hf,null,null,25,50);class mpt extends fpt{constructor(t,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Hf(t),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t){const r=this.resolution/(t.resolution*t.pixelRatio),i=this.transforms.tileMat3,[s,n]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;XZ(i,o,0,0,0,a,0,s,n,1),UE(this.transforms.dvs,t.displayViewMat3,i)}}class _O extends mpt{constructor(t,r,i,s,n,o,a,l=null){super(t,r,i,s,n,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<pce}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<pce)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let r=!1;for(const i of t)if(this.layerData.has(i)){const s=this.layerData.get(i);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Tc.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),s.destroy(),this.layerData.delete(i),this.layerCount--}v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(eEe.delete(this),_O._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let r=!1;if(t){const{bucketsWithData:i,emptyBuckets:s}=t,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===Tc.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[i,s]of this.layerData)s.type===Tc.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t){super.setTransform(t);const r=this.resolution/(t.resolution*t.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];t.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;YZ(o),m4(o,o,n),ZZ(o,o,Math.PI*t.rotation/180),JZ(o,o,[i,s,1])}_createTransforms(){return{dvs:Wl(),tileMat3:Wl(),tileUnitsToPixels:Wl()}}static _destroyRenderBuckets(t){if(!t)return;const r=new Set;t.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),t.clear()}_createRenderBuckets(t){const r=new Map,i=new Map;for(const s of t){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(t,r){let i=r.get(t);if(i)return i;switch(new Uint32Array(t)[0]){case Tc.FILL:i=new upt(t,this.styleRepository);break;case Tc.LINE:i=new cpt(t,this.styleRepository);break;case Tc.SYMBOL:i=new hpt(t,this.styleRepository,this);break;case Tc.CIRCLE:i=new dpt(t,this.styleRepository)}return r.set(t,i),i}_deleteLayerData(t){if(!this.layerData.has(t))return;const r=this.layerData.get(t);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(t),this.layerCount--}}const eEe=new Map;function gpt(){eEe.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(r=>console.log(r)),console.log("========"),e[1].forEach(r=>console.log(r))})}const CSt={value:.5,readOnly:!0},ypt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class uS{constructor(t=0,r=0){this.min=t,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class _pt{constructor(t,r){this.data=t,this.safeWidth=.99999999*(t.width-1),this.dx=(t.width-1)/(r[2]-r[0]),this.dy=(t.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}}class vpt{constructor(t,r,i){this.type="elevation",this.level=t[0],this.i=t[1],this.j=t[2],this.extent=r,this.samplerData=new _pt(i,r)}computeMinMaxValue(t,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,p=.5*QO;let f=(c-1)/o,m=(i-this.j*o)*f,y=(r-this.i*o)*f;if(f<1){const _=Math.floor(m),b=Math.floor(y),x=_+b*c,T=h[x],S=h[x+1],C=h[x+c],O=h[x+c+1];if(T+S+C+O<p){const R=m-_,$=y-b,I=AI(T,S,C,O,R,$),U=AI(T,S,C,O,R+f,$),V=AI(T,S,C,O,R,$+f),G=AI(T,S,C,O,R+f,$+f);return s.min=Math.min(I,U,V,G),s.max=Math.max(I,U,V,G),s}m=_,y=b,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let b=y;b<=y+f;b++){const x=h[_+b*c];x<p?(a=Math.min(a,x),l=Math.max(l,x)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}const bpt=.5*QO;function Xi(e,t,r){if(E(r))return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=ye(i.dy*(i.y1-t),0,s),o=ye(i.dx*(e-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.data.width,h=a*c+l,p=i.data.values,f=p[h],m=p[h+1],y=h+c,_=p[y],b=p[y+1];if(f+_+m+b<bpt){n-=a,o-=l;const x=f+(m-f)*o;return x+(_+(b-_)*o-x)*n}}return null}let bh=class extends Te{constructor(e){super(e),this._handles=new Jr}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles=Ve(this._handles)}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const r=t.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const i=tEe(r.fullExtent,this.viewSpatialReference);v(i)&&e.push(Cfe(i))}}),e}};function wpt(e,t){return e===Ge.Global?new Tq(t):new Sq(t)}u([d({readOnly:!0})],bh.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],bh.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],bh.prototype,"stencilEnabledExtents",null),u([d()],bh.prototype,"viewSpatialReference",void 0),u([d()],bh.prototype,"tilingScheme",void 0),u([d()],bh.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],bh.prototype,"layers",void 0),u([d({constructOnly:!0})],bh.prototype,"layerViews",void 0),bh=u([P("esri.views.3d.terrain.ExtentHelper")],bh);let Tq=class extends bh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?U1e:Ije}};Tq=u([P("esri.views.3d.terrain.ExtentHelperGlobal")],Tq);let Sq=class extends bh{_computeLayerViewsExtent(){const e=ed(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=tEe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);Q_(e,o,e)}});const r=e7(e)?e:null,i=this._get("layerViewsExtent");return cw(r,i)?i:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=ed();this.layers.forEach(n=>{if(n.loaded&&V3(n)){const o=KU(n,t,Ge.Local);if(E(o))return;const{tileInfo:a,fullExtent:l}=o;v(a)&&v(l)&&(r5(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&Q_(r,l,r)}}),Q_(r,this.defaultTiledLayersExtent,r);const i=e7(r)?r:null,s=this._get("tiledLayersExtent");return cw(i,s)?s:i}};function tEe(e,t){return v(e)&&!e.spatialReference.equals(t)?Xme(e,e.spatialReference,t):e}Sq=u([P("esri.views.3d.terrain.ExtentHelperLocal")],Sq);var pr;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(pr||(pr={}));const wb=[pr.ELEVATION,pr.MAP];function rEe(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const r=Object.keys(e);for(const i of r)i.search(".glsl")!==-1&&delete e[i]}}const xpt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let S0,Pl=class extends Te{get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||Xr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return v(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?Zr(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Jr,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=de("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){var t;const e=this._view;this.renderer=new zd({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=od(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",r=>{var i;return(i=e._stage)==null?void 0:i.renderer.setParameters({hasOverlayWater:r})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),se(()=>{var r,i,s;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(s=(i=e.pointsOfInterest)==null?void 0:i.centerOnSurfaceFrequent)==null?void 0:s.location]},()=>this.setPlacementDirty()),se(()=>{var r,i;return[(r=e.state)==null?void 0:r.pixelRatio,(i=e.state)==null?void 0:i.contentPixelRatio]},()=>this.setPlacementDirty(),ri),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(gt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(Ka,r,Ds.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Ds.BACKGROUND,r.pixelRatio)})]),(t=e._stage)==null||t.renderer.setParameters({renderOverlay:r=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(r),this._drawOverlayTextures(this.renderer.overlays,Ds.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this._handles=Ve(this._handles),v(S0)&&(S0.hide(),S0=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this._view.renderSpatialReference;v(e)&&v(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new hv(-20037508342787e-6,20037508342787e-6):new hv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const i=this.renderer.createDrapeSourceRenderer(e,t,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),i}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,uu)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&v(e.setDrapingExtent)&&v(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this._view.state.contentCamera,Ds.UPDATE)}_updateOverlays(e,t,r){if(!this._spatialReference)return na.YIELD;const i=this._computeOverlayResolution(t);this._computeOverlayExtents(t,i,og);const s=Au(og.inner)/Au(og.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this._updateOverlay(is.INNER,og.inner,i,1*og.pixelRatioAdjustment,og.mapUnitsPerPixel),o=this._updateOverlay(is.OUTER,og.outer,i,s*og.pixelRatioAdjustment,og.mapUnitsPerPixel);n!==Vf.EXTENT&&o!==Vf.EXTENT||(this._drapeSources.forEach(a=>this._updateDrapeSourceExtent(a)),this.surface.updateTileOverlayParams(r)),n===Vf.NONE&&o===Vf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const t=this._view.state.contentPixelRatio,r=e.fullWidth/e.pixelRatio*t,i=e.fullHeight/e.pixelRatio*t;return Math.min(JS(Math.max(r,i)+256),this._maxResolution)}_updateOverlay(e,t,r,i,s){if(this.renderer.overlays.length===0)return Vf.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=i,Tpt(t,n.extent)&&r===n.resolution)return o===s?Vf.NONE:Vf.RERENDER_ONLY;my(n.extent,t),n.resolution=r;const a=_X(n.extent);return n.renderLocalOrigin=hO(a[0],a[1],0,"OV_"+this._latestOriginId++),Vf.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[is.INNER],i=this.renderer.overlays[is.OUTER],s=e.extent;this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,i.extent)?(this._setTileOverlayData(s,is.INNER,t),this._setTileOverlayData(s,is.OUTER,t)):(this._clearTileOverlayData(is.INNER,t),this._clearTileOverlayData(is.OUTER,t))}else this._clearTileOverlayData(is.INNER,t),this._clearTileOverlayData(is.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[is.INNER],r=this.renderer.overlays[is.OUTER],i=this._pointIsInExtent(e,t.extent)?t:r;return(i.extent[2]-i.extent[0])/i.resolution}_setTileOverlayData(e,t,r){if(this.renderer.overlays.length===0)return;const i=this.renderer.overlays[t].extent,s=Au(i),n=Ip(i);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(i[0],o);const a=this._longitudeCyclical.minimalMonotonic(i[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}r.setScale(t,Au(e)/s,Ip(e)/n),r.setOffset(t,(o-i[0])/s,(e[1]-i[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){rEe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Ka)}_dispatchAnimationUpdate(e){const t=e-this._animationTimeLast;if(t>=this.surface.view._stage.renderer.animationTimestep||v(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=t/this.surface.view._stage.renderer.animationTimeDilation,i=new qxe(this._view.state.camera,r,this._view.state.forcedAnimationTime);this.renderer.updateAnimation(i)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,t,r,i){const s=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Cpt,t,r);if(E(s))return!1;const n=s.origin,o=me(OL,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([]),this._view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(i)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const i=.55,s=this._view.renderCoordsHelper.getAltitude(e.eye),n=this._view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=ye(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this._view.viewingMode==="global"){const c=OL;wC(o6(a6,Zr(this._view.spatialReference).radius+a),zu(e.eye,e.viewForward),c),ge(c,c,e.eye);const h=dv.normalize(Nge(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:i;r=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=Ht(0,h,1,0),f=Mu(p,p,e.projectionMatrix)[1],m=ye(.5+.5*f,0,1);r=m===1||m===0?.5:l?m*i:1-(1-m)*i}return!!this._intersectGroundFromView(e,.5,r,t)&&mW(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,r){const i=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=M();this._findHorizonBasedPointOfInterest(e,s)||le(s,i);const n=Math.max(.1,Ai(e.eye,s)),o=Ev(this._view.renderCoordsHelper,i,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);Xr.OVERLAY_SHOW_CENTER?(E(S0)&&(S0=new O2(this._view.graphics,"red")),S0.show(s,this._renderSR)):v(S0)&&S0.hide(),this._overlaySREqualsRenderSR||mo(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&v(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&v(this._spatialReference)?1/Zr(this._spatialReference).metersPerDegree:1,p=this._view.state.contentPixelRatio,f=e.perScreenPixelRatio/p*n*h;r.mapUnitsPerPixel=f/this._worldToPCSRatio;let m=t*f/2,y=!1,_=c?90:1/0;this._isSpherical&&v(l)&&v(this._spatialReference)&&(this._spatialReference.isWebMercator?(m/=Math.cos(gF(s[1])),_=l[3]):(y=!0,m/=Zr(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let b=1;y&&(b=1/Math.max(.2,Math.cos(Math.abs(Gt(s[1])))),m*b>180&&(b=180/m),r.mapUnitsPerPixel*=b);const x=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/x)*x);const T=m*b,S=32,C=.5*t/(S*T),O=.5*t/(S*m);s[0]=Math.round(s[0]*C)/C,s[1]=Math.round(s[1]*O)/O;const R=r.inner;R[0]=s[0]-T,R[1]=s[1]-m,R[2]=s[0]+T,R[3]=s[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(R,1/0,_);const $=r.outer;if(6*T>Au(l))my($,l);else if(a<=.25*Math.PI)$[0]=R[0]-T,$[1]=R[1]-m,$[2]=R[2]+T,$[3]=R[3]+m;else{mo(e.eye,this._renderSR,OL,this._spatialReference),Xf(A1,s,OL);let U=-Math.atan2(A1[1],A1[0])+.125*Math.PI;U<0&&(U+=2*Math.PI);const V=Math.floor(U/(.25*Math.PI));uC(A1,xpt[V],2*m),A1[0]*=b,A1[2]*=b,gW($,R,A1)}if(this._isSpherical)$[0]=this._longitudeCyclical.clamp($[0]),$[2]=this._longitudeCyclical.clamp($[2]),$[1]=Math.max($[1],-_),$[3]=Math.min($[3],_);else{const U=t7(R,l,Spt),V=t7($,l,Ept);iee(U,V)&&($[2]=$[0],$[3]=$[1])}const I=Math.abs(R[2]-R[0])/t;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,I),r.pixelRatioAdjustment=r.mapUnitsPerPixel/I}_drawOverlayTextures(e,t,r=this._view.state.contentPixelRatio){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const i=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[is.INNER],r),n=this._drawOverlay(e[is.OUTER],r);s!==FE.CHANGED&&n!==FE.CHANGED||this.surface.updateTileOverlayParams(Ds.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),i?(this.surface.requestRender(t),t===Ds.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Ds.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!E(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):z5(e,t))}_rectInsideRect(e,t){return!E(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:iee(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,i=e.y;return r>t[0]&&r<t[2]&&i>t[1]&&i<t[3]}_shiftExtentToFitBounds(e,t,r){let i=0,s=0;e[0]<-t?i=e[0]+t:e[2]>t&&(i=t-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),wF(e,i,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Ka)}}};function Tpt(e,t){const i=Xr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=i&&Math.abs(t[1]-e[1])<=i&&Math.abs(t[2]-e[2])<=i&&Math.abs(t[3]-e[3])<=i}u([d()],Pl.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],Pl.prototype,"running",null),u([d()],Pl.prototype,"_placementDirty",void 0),u([d()],Pl.prototype,"_contentUpdated",void 0),u([d()],Pl.prototype,"_isSpherical",null),u([d()],Pl.prototype,"_worldToPCSRatio",null),u([d({autoDestroy:!0})],Pl.prototype,"renderer",void 0),u([d({constructOnly:!0})],Pl.prototype,"surface",void 0),u([d()],Pl.prototype,"suspended",null),u([d()],Pl.prototype,"updating",null),u([d({type:Boolean})],Pl.prototype,"hasHighlights",null),u([d({type:Boolean})],Pl.prototype,"rendersOccluded",null),Pl=u([P("esri.views.3d.terrain.OverlayManager")],Pl);const A1=sr(),OL=M(),og={inner:ur(),outer:ur(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Spt=ur(),Ept=ur(),Cpt=co();var Vf;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(Vf||(Vf={}));class zM{constructor(t,r){this._factoryCallback=t,this._lengthCallback=r,this._pool=new Map}acquire(t){if(!zM.test.disabled){const r=this._pool.get(t);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(t)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+r+s),r}}release(t){if(zM.test.disabled)return;const r=this._lengthCallback(t);let i=this._pool.get(r);i||(i=new Jt({shrink:!0}),this._pool.set(r,i)),i.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}zM.test={disabled:!1};class Apt{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=$i(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class fce{constructor(t,r,i,s,n){this.attributes=t,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(t){return this.getAttributeIndex(t)}getAttributeIndex(t){return Re(0<=t&&t<this.count),this.index0+this.stride*t}_getVertexRaw(t,r){this.attributes.position.getVec(t,r)}_getNormalRaw(t,r){this.attributes.normalCompressed.getVec(t,r)}getVertexPos(t,r){this._getVertexRaw(this.getAttributeIndex(r),t),me(t,t,this.localOrigin)}getNormal(t,r){const i=Ke();this._getNormalRaw(this.getAttributeIndex(r),i),Ppt(t,i)}_setNormal(t,r,i,s){GM(this.attributes.normalCompressed,t,r,i,s)}_setUV(t,r,i){Fc(this.attributes.uv0,t,r,i)}setNormalFromValues(t,r,i,s){this._setNormal(this.getAttributeIndex(t),r,i,s)}setVertexFromValuesRawPositionUV(t,r,i,s,n,o){const a=this.getAttributeIndex(t);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(t,r,i,s,n,o,a,l,c){const h=this.getAttributeIndex(t);this.attributes.position.setValues(h,r,i,s),this._setUV(h,n,o),this._setNormal(h,a,l,c)}}const Rpt=os().vec3f(A.POSITION).vec2i16(A.UV0).vec2i16(A.NORMALCOMPRESSED,{glNormalized:!0}),VQ=new zM(e=>Rpt.createBuffer(e),e=>e.count);function Opt(){VQ.clear()}function iEe(e){return VQ.acquire(e)}function Mpt(e){VQ.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}function GM(e,t,r,i,s){const n=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),o=r*n,a=i*n,l=s<=0?(o>=0?1:-1)*(1-Math.abs(a)):o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(o)):a;e.setValues(t,gce(l),gce(c))}function Ppt(e,t){const r=yce(t[0]),i=yce(t[1]),s=1-Math.abs(r)-Math.abs(i);e[2]=s,s<0?(e[0]=(r>=0?1:-1)*(1-Math.abs(i)),e[1]=(i>=0?1:-1)*(1-Math.abs(r))):(e[0]=r,e[1]=i),ve(e,e)}const mce=16384;function Fc(e,t,r,i){e.setValues(t,r*mce,i*mce)}function gce(e){return ye(Math.round(32767*e),-32767,32767)}function yce(e){return ye(e/32767,-1,1)}function sl(e,t,r,i){e<i[0]?i[0]=e:e>i[3]&&(i[3]=e),t<i[1]?i[1]=t:t>i[4]&&(i[4]=t),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}class Ipt{constructor(){this.sinLonLUT=new Array(XR+1),this.cosLonLUT=new Array(XR+1),this.sinLatLUT=new Array(XR+1),this.cosLatLUT=new Array(XR+1)}update(t,r,i){const s=r[0],n=r[2];for(let o=0;o<=t;o++){const a=o/t,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}}class ML{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}}class $pt{constructor(){this.cornerNeighborData=[new ML,new ML,new ML,new ML],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}}class Lpt{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new $pt}}class jS{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Ve(this._current),this._next=Ve(this._next),this._waiting=Ve(this._waiting),this._delayed=Ve(this._delayed)}get current(){if(E(this._current))return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let t=jS.test.fadeMoment;if(v(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,cy.Immediate),this._delayed=null)),v(this._next)){t=t||performance.now();const r=this._fadeDuration,i=v(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==Tn.FADING,n=t-this._fadeStart>=r;(i||s||n)&&(Ve(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(E(this._next))return 1;const t=jS.test.fadeMoment||performance.now(),r=Math.max(0,t-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return v(this._next)||v(this._delayed)}push(t,r=cy.Immediate){this._delayed=Ve(this._delayed),this._push(t,r)}_push(t,r){if(this._isFadingEnabled||this.clear(),E(this._current))return void(this._current=t);const i=jS.test.fadeMoment||performance.now();return r!==cy.Immediate?(this._delayed=t,void(this._delayedTime=i+r)):E(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(i))):void(E(t)||(Ve(this._waiting),this._waiting=t))}get _fadeDuration(){return E(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const r=this._getFadeDuration();return t+r-t%r}get _isFadingEnabled(){return this._getFadeDuration()>0}}var cy;jS.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(cy||(cy={}));var oC;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(oC||(oC={}));class sEe{constructor(){this._queue=new Jt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=void 0}reset(t=null){this._queue.clear(),v(t)&&this._queue.pushArray(t),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const t=(r=this._last)==null?void 0:r.children;return t&&t[0]&&this._queue.pushArray(t),this._last=this._queue.pop(),this._last}}class Dpt{constructor(){this._q=new Jt}get done(){return this._q.length===0}reset(t){if(this._q.clear(),!E(t)){this._q.pushArray(t);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}}function vO(e,t,r){if(E(t)||E(t.fullExtent))return!1;const i=t.fullExtent,s=e.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale,o=t.minScale;if(o>0&&n>1.00000001*o)return!1;const a=t.maxScale;return!(a>0&&n<.99999999*a)}function uy(e,t){const r=e.lij,i=t.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function nEe(e,t,r=null){E(r)||r.length===0?e===oC.BACK_TO_FRONT?t.sort(Npt):t.sort(Fpt):t.sort((i,s)=>Upt(i,s,e,r))}function Npt(e,t){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=e.lij,s=t.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function Fpt(e,t){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=e.lij,s=t.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function oEe(e,t,r){const i=e.screenDepth,s=t.screenDepth;return i<s?-r:i>s?r:uy(e,t)}function Upt(e,t,r,i){return _ce(e,i)===_ce(t,i)?oEe(e,t,r):e?r:-r}function _ce(e,t){for(const r of t)if(e.intersectsExtent(r))return!0;return!1}function kpt(e,t){const r=e.distanceToPOI-t.distanceToPOI;if(r!==0)return r;const i=e.lij,s=t.lij;return i[0]-s[0]||i[1]-s[1]||i[2]-s[2]}function Vpt(e,t){const r=e.length;for(let i=0;i<r;++i)e.getItemAt(i).updateDistanceToPOI(t);e.sort(kpt)}function Bpt(e,t,r){let i=1,s=0,n=0;for(;e!==t;)if(i*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(t,s,n,i)}function zpt(e){for(let t=0;t<e.length;t++){const r=e[t],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function ASt(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],i=r?e:t,s=r?t:e,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}class BQ{get updating(){return!!this._tileRequested}init(t,r,i,s){this.tile=t,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,Tn.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return v(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(t,r),s=vq(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?vO:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=v(m)?m.tile.level:-1,_=!!v(m)&&y-p>=a,b=en(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const x=h.level,T=p-x,S=h.layerInfo[r][t];if(S.data&&T>=a){(!_||x>y)&&this._setUpsampleTile(h),S.dataInvalidated&&(f=h);break}if((E(b)||b.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&x<=o&&!S.data&&!S.dataMissing&&((E(f)||h.level===n||x%F1e==0||p-f.level<a)&&(f=h),T>=l))break;h=h.parent}return v(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=r)return s;i=s}return i}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,Tn.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class Gpt extends BQ{get _desiredMinLevelDelta(){throw vce}get _progressiveLevelModulo(){throw vce}dispose(){}}const vce=new Error("Abstract method called on TileAgent"),ic=new Gpt;class aEe extends BQ{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return tH(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class lEe extends BQ{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return F1e}}var xw,hx;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(xw||(xw={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(hx||(hx={}));function jpt(e,t){e.fragment.uniforms.add([new Mt("u_colormap",r=>r.u_colormap),new Pe("u_colormapOffset",r=>r.colormap.u_colormapOffset),new Pe("u_colormapMaxIndex",r=>r.colormap.u_colormapMaxIndex),new Pe("u_opacity",r=>r.common.u_opacity)]),e.fragment.code.add(w`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${rl(t,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function Hpt(e,t){e.fragment.uniforms.add(Tp("u_transformGrid",r=>r.u_transformGrid,t.hasWebGL2Context?ei.None:ei.InvSize)),e.fragment.uniforms.add(new kr("u_transformSpacing",r=>r.common.u_transformSpacing)),e.fragment.uniforms.add(new kr("u_targetImageSize",r=>r.common.u_targetImageSize)),e.fragment.code.add(w`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${rl(t,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${rl(t,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${rl(t,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${rl(t,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}class cEe extends gi{constructor(){super(...arguments),this.scale=1,this.offset=Zl}}function uEe(e){e.attributes.add(A.POSITION,"vec2"),e.attributes.add(A.UV0,"vec2"),e.vertex.uniforms.add(new Pe("scale",t=>t.scale)),e.vertex.uniforms.add(new kr("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(w`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class qpt extends cEe{constructor(t,r,i){super(),this.common=t,this.u_image=r,this.u_transformGrid=i}}function Wpt(e,t){e.include(Hpt,t),e.fragment.uniforms.add([new Mt("u_image",r=>r.u_image),new ny("u_flipY",r=>r.common.u_flipY),new ny("u_applyTransform",r=>r.common.u_applyTransform)]),e.fragment.code.add(w`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var Ue;(function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"})(Ue||(Ue={}));const Eq={normal:Ue.Normal,average:Ue.Average,lighten:Ue.Lighten,lighter:Ue.Lighter,screen:Ue.Screen,plus:Ue.Plus,"color-dodge":Ue.ColorDodge,darken:Ue.Darken,multiply:Ue.Multiply,"color-burn":Ue.ColorBurn,overlay:Ue.Overlay,"soft-light":Ue.SoftLight,"hard-light":Ue.HardLight,"vivid-light":Ue.VividLight,hue:Ue.Hue,saturation:Ue.Saturation,luminosity:Ue.Luminosity,color:Ue.Color,difference:Ue.Difference,exclusion:Ue.Exclusion,minus:Ue.Minus,invert:Ue.Invert,reflect:Ue.Reflect,"destination-over":Ue.DestinationOver,"destination-atop":Ue.DestinationAtop,"destination-in":Ue.DestinationIn,"destination-out":Ue.DestinationOut,"source-atop":Ue.SourceAtop,"source-in":Ue.SourceIn,"source-out":Ue.SourceOut,xor:Ue.Xor};function Xpt(e){return e===Ue.DestinationOver||e===Ue.DestinationAtop||e===Ue.DestinationIn||e===Ue.DestinationOut||e===Ue.SourceAtop||e===Ue.SourceIn||e===Ue.SourceOut||e===Ue.Xor}function zQ(e){e.code.add(w`
    float lineFactorAtPosition(float value) {
      float pos = value * ${w.float(257)};
      if(pos < 0.5 || pos > ${w.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function Ypt(e,t){const r=t.blendMode;r!==Ue.Normal&&(r===Ue.Reflect&&e.code.add(w`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Ue.ColorDodge&&r!==Ue.VividLight||e.code.add(w`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Ue.ColorBurn&&r!==Ue.VividLight||e.code.add(w`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Ue.Overlay&&e.code.add(w`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Ue.HardLight&&e.code.add(w`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Ue.SoftLight&&e.code.add(w`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Ue.VividLight&&e.code.add(w`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Ue.Hue&&r!==Ue.Saturation&&r!==Ue.Color&&r!==Ue.Luminosity||(e.code.add(w`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Ue.Hue&&r!==Ue.Saturation||e.code.add(w`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(w`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Ue.Multiply?w`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Average?w`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Lighten?w`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Darken?w`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Lighter?w`return vec4(cl * ol + cb * ob, ol + ob);`:r===Ue.Plus?w`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Ue.Minus?w`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Ue.Screen?w`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Difference?w`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Invert?w`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ue.DestinationOver?w`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Ue.DestinationAtop?w`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Ue.DestinationOut?w`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Ue.SourceAtop?w`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ue.SourceOut?w`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Ue.Xor?w`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Ue.DestinationIn?w`return vec4(cb * ob * ol, ol * ob);`:r===Ue.SourceIn?w`return vec4(cl * ol * ob, ol * ob);`:r===Ue.Hue?w`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Saturation?w`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Color?w`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Luminosity?w`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Exclusion?w`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Reflect?w`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.ColorDodge?w`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.ColorBurn?w`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.Overlay?w`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.SoftLight?w`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.HardLight?w`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ue.VividLight?w`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:w``}
    }
  `))}var Vn,vp,tp;(function(e){e[e.Composite=0]="Composite",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.GroupBackgroundComposite=3]="GroupBackgroundComposite",e[e.COUNT=4]="COUNT"})(Vn||(Vn={})),function(e){e[e.NotRequired=0]="NotRequired",e[e.Required=1]="Required",e[e.COUNT=2]="COUNT"}(vp||(vp={})),function(e){e[e.Off=0]="Off",e[e.On=1]="On",e[e.COUNT=2]="COUNT"}(tp||(tp={}));function hEe(e,t){const r=t.output===Vn.GridComposite,i=t.output===Vn.ColorComposite,s=t.output===Vn.GroupBackgroundComposite,n=t.output===Vn.Composite;r&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(zQ)),i&&e.fragment.uniforms.add(new qt("backgroundColor",c=>c.backgroundColor));const o=t.baseOpacityMode===vp.Required;if(o&&e.fragment.uniforms.add(new Pe("baseOpacity",c=>c.baseOpacity)),n){const c=t.hasWebGL2Context?ei.None:ei.InvSize;e.fragment.uniforms.add(Tp("fboColor",h=>h.fboTexture,c))}const a=t.blendMode!==Ue.Normal,l=t.premultipliedSource===tp.On;e.fragment.include(Ypt,t),e.fragment.code.add(w`
    vec4 getBackground(vec2 uv) {
      return ${o?w`baseOpacity *`:""} ${s?w`vec4(0.0, 0.0, 0.0, 0.0)`:i?w`vec4(backgroundColor, 1.0)`:r?w`vec4(gridColor(uv), 1.0)`:w`${rl(t,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?w`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:w`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!o||s)?w`colorLayer * opacity;`:w`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}class t8 extends qpt{constructor(t,r,i,s,n,o){super(t,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Sa,this.fboTexture=null,this.baseOpacity=1}}class Zpt extends t8{}class Jpt extends t8{}function Qpt(e){const t=new Lr;return t.include(uEe),t.include(Wpt,e),t.include(jpt,e),t.include(hEe,e),t.fragment.code.add(w`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),e.colorizerType===xw.Stretch?eft(t,e):e.colorizerType===xw.Lut?Kpt(t):e.colorizerType===xw.Hillshade&&tft(t,e),t}function Kpt(e){e.fragment.code.add(w`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function eft(e,t){e.fragment.uniforms.add([new YP("u_bandCount",i=>i.symbolizer.u_bandCount),new wa("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new wa("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new wa("u_factor",i=>i.symbolizer.u_factor,3),new Pe("u_minOutput",i=>i.symbolizer.u_minOutput),new Pe("u_maxOutput",i=>i.symbolizer.u_maxOutput),new ny("u_useGamma",i=>i.symbolizer.u_useGamma),new wa("u_gamma",i=>i.symbolizer.u_gamma,3),new wa("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Pe("u_opacity",i=>i.common.u_opacity)]),e.fragment.code.add(w`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=t.applyColormap?w`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:w`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(w`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===hx.Noop?w`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:w`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function tft(e,t){const r=e.fragment;r.uniforms.add([new Mt("u_image",s=>s.u_image),new YP("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new wa("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new wa("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new wa("u_cosZs",s=>s.symbolizer.u_cosZs,6),new wa("u_weights",s=>s.symbolizer.u_weights,6),new kr("u_factor",s=>s.symbolizer.u_factor),new Pe("u_minValue",s=>s.symbolizer.u_minValue),new Pe("u_maxValue",s=>s.symbolizer.u_maxValue),new kr("u_srcImageSize",s=>s.common.u_srcImageSize)]),r.include(Nm),r.code.add(w`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(w`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=t.applyColormap?w`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:w`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(w`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const rft=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Jpt,ColorizerStretchUniforms:Zpt,ColorizerUniforms:t8,build:Qpt},Symbol.toStringTag,{value:"Module"}));function ift(e,t,r="nearest",i=!1){var c;const s=!(i&&t.pixelType==="u8"),n=s?$t.FLOAT:$t.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===vt.WEBGL2&&s?St.RGBA32F:ze.RGBA,samplingMode:!a||r!=="bilinear"&&r!=="cubic"?rt.NEAREST:rt.LINEAR,dataType:n,wrapMode:Rt.CLAMP_TO_EDGE,flipped:!1};return new lt(e,l,o)}function sft(e,t){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=t,a=r[0]>1,l={width:a?4*n:n,height:o,target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===vt.WEBGL2?St.RGBA32F:ze.RGBA,dataType:$t.FLOAT,samplingMode:rt.NEAREST,wrapMode:Rt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*i.length);if(a&&s!=null)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new lt(e,l,c)}function bce(e,t){const r={width:t.length/4,height:1,target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,wrapMode:Rt.CLAMP_TO_EDGE,flipped:!1};return new lt(e,r,t)}function nft(e,t,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:i,u_transformSpacing:e?e.spacing:Zl,u_transformGridSize:e?e.size:Zl,u_targetImageSize:t,u_srcImageSize:r}}function oft(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function aft(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function lft(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const wce={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class cft{constructor(t,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=tt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...wce,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||wce}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){v(t)&&t.length>0?this._bandIds&&t.every((r,i)=>{var s;return!!((s=this._bandIds)!=null&&s[i])&&r===this._bandIds[i]})||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,v(this._rasterTexture)){const r=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(r==="bilinear"?rt.LINEAR:rt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=tt(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((E(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),v(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&E(this._transformGridTexture)&&(this._transformGridTexture=sft(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:r,width:i,height:s,opacity:n}=this,o=nft(r,[i,s],[this.source.width,this.source.height],n),a=oft(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?aft(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?lft(this.symbolizerParameters):null;return new t8(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(E(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(r=>v(r)?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=tt(this._rasterTexture),this._transformGridTexture=tt(this._transformGridTexture),this._colormapTexture=tt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=tt(this._rasterTexture));const s=E(r)&&E(this.bandIds)||v(r)&&v(this.bandIds)&&r.join("")===this.bandIds.join("");if(v(this._rasterTexture)&&s)return;this._rasterTexture=tt(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=ift(t,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=tt(this._colormapTexture),this._colormapTexture=bce(t,i),void(this._colormap=i)):void 0:(this._colormapTexture=bce(t,i),void(this._colormap=i)):(this._colormapTexture=tt(this._colormapTexture),void(this._colormap=null))}}class PN{constructor(){this.waitingAgents=new Jt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const r=lB.acquire();return r._init(t),r}release(){this.dispose(),IN.delete(this),lB.release(this)}dispose(){this.loadingAgent=tt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=GS(this._data)}static prune(){lB.prune(0)}_init(t){this.waitingAgents.clear(),this._data=GS(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Yh(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){v(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,r){if(t===r||E(r))this._unsetUpsampleInfo();else{if(E(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),Bpt(t,r,this._upsampleInfo)}}get data(){return this._data}set data(t){GS(this._data),this._data=t}}const lB=new An(PN,null,()=>{}),IN=new Map;function uft(){IN.size>0&&(console.log(`${IN.size} live TilePerLayerInfo allocations:`),IN.forEach(e=>console.log(e,`
`)))}class M2{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var Et;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(Et||(Et={}));const cB=M(),TT=M(),wo=M(),hft=.1;class GQ{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=ur(),this._elevationBounds=Ke(),this.layerInfo=[[],[]],this.extentInRadians=ur(),this.centerAtSeaLevel=M(),this._center=[M(),pn(),M()],this.up=pW(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=M()}static prune(){jQ.prune(0),HQ.prune(0),PN.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[ln.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var i,s;this._dirty=!1;const t=(s=(i=this.parent)==null?void 0:i.frustumVisibility)!=null?s:ya.INTERSECTS;this._frustumVisibility=t===ya.INSIDE?ya.INSIDE:t===ya.OUTSIDE?ya.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==ya.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setDirty()),t}get shouldLoad(){const t=this._surface.snapLevel;if(v(t)){const r=this.level-t;if(r===0)return!0;if(r===1)return!1}return this.isLeaf}init(t,r,i){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=Zr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[ln.MIDDLE][3]=0,this.vlevel=t?t[0]:0,r&&r.elevationBounds?qn(this._elevationBounds,r.elevationBounds):or(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of wb){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=PN.acquire(this._surface.upsampleInfoPool),s===pr.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,XR)}release(){Gf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of wb){for(const r of this.layerInfo[t])r.release();this.layerInfo[t].length=0}this._parent=null;for(let t=0;t<4;++t)this._children[t]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const t=this._cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[pr.MAP].reduce((t,r)=>t+(r instanceof _O?r.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(v(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let t=0;for(const{data:i}of this.layerInfo[pr.MAP])i instanceof _O?t+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[pr.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=Ww(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+t),this._usedMemory}getUsedMemoryForLayer(t,r){const i=this.layerInfo[t][r];return i!=null&&i.data?t===pr.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):t===pr.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof M2?Ww(t.texture):t instanceof HTMLImageElement||t instanceof JU?this._cpuImageMemorySize:t instanceof _O||t instanceof cft?t.memoryUsage:0}updateScreenDepth(t){const r=this._center[ln.MIDDLE],i=t,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(t,r,i){if(!this.visible||v(t.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(t.frustum)===ya.OUTSIDE))return Et.NONE;const s=this.level;ge(cB,this._center[ln.MIDDLE],r);let n=ba(cB),o=ln.MIDDLE;ge(TT,this._center[ln.TOP],r);const a=ba(TT);a<n&&(n=a,o=ln.TOP),ge(TT,this._center[ln.BOTTOM],r);const l=ba(TT);if(l<n&&(n=l,o=ln.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return Et.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,f=()=>{const b=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return b!==this.vlevel?(this.vlevel=b,Et.VSPLITMERGE):Et.NONE_HIT_MAXLOD};if(v(i)&&i-s===1)return s>=t.maxLod?f():Et.SPLIT;const m=_e(this.up,cB),y=this._elevationBounds[1]-this._elevationBounds[0],_=y/this.edgeLen;if(t.aboveGround&&m>0&&_<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-_>0)return Et.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,Et.VSPLITMERGE):Et.NONE;if(s>=t.maxLod)return f();if(s>6){ge(TT,this._center[o],r),ae(wo,this.up,m),ge(wo,wo,TT);const b=ba(wo);if(b>this.radius*this.radius){ae(wo,wo,this.radius/Math.sqrt(b)),me(wo,wo,this._center[o]),ge(wo,r,wo);const x=Math.min(1,(Math.abs(_e(wo,this.up))+.5*y+this._curvatureHeight)/Me(wo)),T=hft/t.angledSplitBias,S=t.fovY*c*2;if(x*(this._edgeLen/S)<T*t.relativeHeightLimit)return Et.NONE}}return Et.SPLIT}setChildren(t,r,i,s){Gf(!!(t&&r&&i&&s),"Null child passed"),this._children[0]=t,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,r;return(r=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?r:!1}load(){this.refMapData();for(const t of wb)this._createOrUpdateAgents(0,t);this.surface.renderer.loadTile(this)}unload(t){t.unloadTile(this);for(const r of wb){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==ic&&(PL(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(Et.GEOMETRY),this.resetPendingUpdate(Et.TEXTURE_NOFADING),this.resetPendingUpdate(Et.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[pr.MAP];for(const r of t)r.loadingAgent&&r.loadingAgent!==ic&&(PL(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(cw(t,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;v(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(Et.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,r){return this.layerInfo[r][t]}hasLayerData(t,r){const i=this.layerInfo[r][t];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of wb){const r=this.layerInfo[t];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==ic&&i.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(Et.SPLIT)||t!==pr.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===Et.SPLIT||t===Et.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,r,i){const s=this.layerInfo[r][t];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t),i.dataArrived(this),!0;if(s.requestPromise)return!0;Yh(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){if(this.hasLij(t))return this;const r=this._children;return r[0]?r[0].findByLij(t)||r[1].findByLij(t)||r[2].findByLij(t)||r[3].findByLij(t):null}distanceToSquared(t){return ba(ge(wo,this._center[ln.MIDDLE],t))}containsPoint(t){const r=this.extent;return t[0]>=r[0]&&t[1]>=r[1]&&t[0]<=r[2]&&t[1]<=r[3]}containsPointXY(t,r){const i=this.extent;return t>=i[0]&&r>=i[1]&&t<=i[2]&&r<=i[3]}unrequestLayerData(t,r,i){const s=this.layerInfo[r][t],n=s.waitingAgents,o=n.removeUnordered(i)!=null;Gf(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,r,i){const s=this.layerInfo[r][t];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${t} error ${i}`);const s=this.layerInfo[r][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,r){switch(t){case pr.MAP:return this._updateTexture(r);case pr.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===Tn.FADING?Et.TEXTURE_NOFADING:Et.TEXTURE_FADING),this.setPendingUpdate(t===Tn.FADING?Et.TEXTURE_FADING:Et.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Et.GEOMETRY);for(const t of this.layerInfo[pr.ELEVATION])t.pendingUpdates|=Et.GEOMETRY}invalidateLayerData(t,r){this.layerInfo[r][t].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const t=this._elevationBounds,r=t[0],i=t[1];or(t,1/0,-1/0);const s=this.layerInfo[pr.ELEVATION];let n=!0;for(const o of s)v(o.elevationBounds)&&(t[0]=Math.min(t[0],o.elevationBounds.min),t[1]=Math.max(t[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(n=!1));n&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),r===t[0]&&i===t[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const t=this._elevationBounds,r=.5*(t[0]+t[1]),i=this._center;ae(wo,this.up,r),me(i[ln.MIDDLE],this.centerAtSeaLevel,wo),ae(wo,this.up,t[0]),me(i[ln.TOP],this.centerAtSeaLevel,wo),ae(wo,this.up,t[1]),me(i[ln.BOTTOM],this.centerAtSeaLevel,wo)}findElevationBoundsForLayer(t,r){const i=this.layerInfo[pr.ELEVATION][t],s=tH(this.level),n=Math.max(this.vlevel-s,0),o=i.elevationBounds;if(v(o)&&o.level>=r&&o.level<=n)return;const a=this._surface.layerViewByIndex(t,pr.ELEVATION),l=vq(a);if(!vO(this,l,!1))return;const c=pft;let h=!1;const p=i.data;if(p&&p.level<=n){const f=i.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let f,m,y=0;for(let _=this._parent;_&&(!m||y<s)&&(y=this.vlevel-_.level,f=m||f,m=_.layerInfo[pr.ELEVATION][t].data,!(!m&&f&&_.level<=n));_=_.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,h=!0))}h&&(E(i.elevationBounds)&&(i.elevationBounds=new uS),i.elevationBounds.copyFrom(c))}modifyLayers(t,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==ic&&(PL(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:PN.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,Tn.FADING))}updateAgents(t){if(this.renderData){const r=this.layerInfo[t];for(const i of r)i.loadingAgent===ic&&(i.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of wb){const r=this._isSuspended(t);for(const i of this.layerInfo[t])i.loadingAgent&&i.loadingAgent!==ic&&(i.loadingAgent.setSuspension(r),i.loadingAgent===ic&&this.updateRenderData(t,Tn.FADING))}}removeLayerAgent(t,r){const i=this.layerInfo[r][t];i.loadingAgent&&i.loadingAgent!==ic&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(t,r){const i=this.layerInfo[r][t];i.loadingAgent=ic,!i.data&&E(i.upsampleInfo)&&this._createOrUpdateAgents(t+1,r)}_hasBlendableAncestor(t){return t.blendMode!=="normal"||xE(t.parent)&&this._hasBlendableAncestor(t.parent)}_hasBlendModes(t,r,i){var s,n,o;for(let a=t;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(i5(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||xE((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(t,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=t;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=vq(l);if(o.loadingAgent?vO(this,c,!1)?(o.loadingAgent!==ic&&o.loadingAgent.setSuspension(s),o.loadingAgent!==ic&&(a=o.loadingAgent.update())):o.dispose():vO(this,c,!1)&&(o.loadingAgent=dft(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===ic&&this.setPendingUpdate(Et.GEOMETRY):(PL(o.loadingAgent),o.loadingAgent=ic)),o.loadingAgent===ic&&this.updateRenderData(r,Tn.FADING),!this._hasBlendModes(t,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(t){const r=this.extent;return r[0]>=t[0]&&t[2]>=r[2]&&r[1]>=t[1]&&t[3]>=r[3]}intersectsExtent(t){const r=this.extent;return r[2]>=t[0]&&t[2]>=r[0]&&r[3]>=t[1]&&t[3]>=r[1]}getElevationVerticesPerSide(t){const r=this.vlevel-this.level,i=Math.max(this.level-t,tH(this.level)-r),s=ye(1+(this.maxTesselation>>i),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(t,r){if(!t)return null;const i=this.surface.rootTiles;if(v(i)){for(const s of i)if(fft(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(t,r){const i=this.lij,s=this.getNeighborLIJ(i,t);return s?mft(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(t,r){const i=t===At.NORTH_EAST?1:t===At.NORTH_WEST?0:t===At.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!r||!r(s));)s=s.children[i];return s}findNeighborCornerTileExact(t,r){var i;return((i=this.findNeighborTile(t,s=>r(s)||s.level===this.level))==null?void 0:i.findCorner(xq(t),r))||null}forAllSubtreeOnSide(t,r){const i=t===At.NORTH?[0,1]:t===At.NORTH_EAST?[1]:t===At.EAST?[1,3]:t===At.SOUTH_EAST?[3]:t===At.SOUTH?[2,3]:t===At.SOUTH_WEST?[2]:t===At.WEST?[0,2]:[0],s=n=>{const o=n.children;!r(n)&&o[0]&&i.forEach(a=>s(o[a]))};s(this)}forallNeighbors(t){n5.forEach(r=>this.findNeighborCornerTileExact(r,t)),im.forEach(r=>{var i;return(i=this.findNeighborTile(r,s=>s.level===this.level||t(s)))==null?void 0:i.forAllSubtreeOnSide(s5(r),t)})}getNeighborEdgeStartVertexIndex(t,r){if(!r)return 0;const i=this.level-r.level;if(Re(!On||i>=0),i===0)return 0;const s=2**i,n=(1&t)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,h=n?s-1-c:c;return On&&(Re(a<=l&&l<a+s),Re(0<=h&&h<s)),h}forEachLoadedNeighbor(t){const r=this.level,i=s=>s.level===r||s.isLoaded;im.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(s5(s),o=>!!o.isLoaded&&(t(o,s),!0))}),n5.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,i))==null?void 0:o.findCorner(xq(s),a=>a.isLoaded);Re(!n||Cq(this,n,s)),n!=null&&n.isLoaded&&t(n,s)})}getNeighborLIJ(t,r){const i=ace(r)?-1:oce(r)?1:0,s=sce(r)?-1:nce(r)?1:0,n=[t[0],t[1]+i,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Pa()>=this.surface.extent[1]}checkGeometryWaterproofness(){var t;t5&&(Re(this.isLoaded),(t=this.renderData)==null||t.checkGeometryWaterproofness())}shouldHaveNeighbor(t){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(ace(t)&&r[3]+s>=i[3]||oce(t)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&sce(t)&&r[0]-s<=i[0])&&!(!n&&nce(t)&&r[2]+s>=i[2])}updateDistanceToPOI(t){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2])return;le(this._lastPOI,t);const i=this._center[ln.MIDDLE],s=t[0]-i[0],n=t[1]-i[1],o=t[2]-i[2];this.distanceToPOI=s*s+n*n+o*o}}function dft(e,t,r,i){const s=r===pr.ELEVATION?HQ.acquire():jQ.acquire();return s.init(e,t,r,i),s}function PL(e){e.dispose(),e instanceof aEe?HQ.release(e):e instanceof lEe&&jQ.release(e)}const jQ=new An(lEe),HQ=new An(aEe),pft=new uS;var ln;function fft(e,t){const r=e.level,i=t[0];if(r>i)return!1;const s=i-r,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function mft(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function gft(e,t,r){if(E(e)||E(t))return!1;if(e.level===0&&t.level===0&&(e.isEastEnd&&t.isWestEnd&&r===At.EAST||e.isWestEnd&&t.isEastEnd&&r===At.WEST))return!0;const i=Math.max(1e-6*(e.extent[2]-e.extent[0]),1);switch(r){case At.NORTH:return Dh(e.extent[3],t.extent[1],i);case At.SOUTH:return Dh(e.extent[1],t.extent[3],i);case At.EAST:return Dh(e.extent[2],t.extent[0],i)||Dh(e.extent[2],-t.extent[0],i);case At.WEST:return Dh(e.extent[0],t.extent[2],i)||Dh(e.extent[0],-t.extent[2],i)}}function Cq(e,t,r){return!E(e)&&!E(t)&&t!==e&&(e.level>=t.level?xce(e,t,r):xce(t,e,xq(r)))}function xce(e,t,r){Re(e.level>=t.level);const i=Ldt(r),s=Ddt(r),n=e.extent,o=t.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=Dh(a[0],l[0],c)||e.surface.isGlobal&&Dh(a[0],-l[0],c),p=Dh(a[1],l[1],c);if(h&&p)return!0;if(e.level===t.level||!h&&!p)return Re(!1),!1;const f=h?Tce(o[1],o[3],n[1],n[3],c):Tce(o[0],o[2],n[0],n[2],c);return Re(f),f}function Tce(e,t,r,i,s=Pa()){return e-s<=r&&r<=i&&i<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(ln||(ln={}));class yft{constructor(){this._scales=Ht(-1,-1,-1,-1),this._offsets=Ht(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,r,i){this._scales[2*t]=r,this._scales[2*t+1]=i}setOffset(t,r,i){this._offsets[2*t]=r,this._offsets[2*t+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}}function _ft(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(w`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(w`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(w`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}class qQ extends R2e{constructor(){super(...arguments),this.slicePlaneLocalOrigin=M(),this.origin=this.slicePlaneLocalOrigin}}var Oc;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(Oc||(Oc={}));class vft extends qQ{constructor(){super(...arguments),this.identifier=Oc.Material,this.output=k.Color,this.transparent=!1,this.integratedMesh=!1}}class bft extends qQ{constructor(){super(...arguments),this.identifier=Oc.ShadowMap}}class wft extends qQ{constructor(){super(...arguments),this.identifier=Oc.Highlight}}class o5 extends Es{constructor(t,r){super(t,"vec4",fi.Draw,(i,s,n)=>i.setUniform4fv(t,r(s,n)))}}var hy;function xft(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add([new o5("overlayTexOffset",(s,n)=>Tft(s,n)),new o5("overlayTexScale",(s,n)=>Sft(s,n))]),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Mt("ovColorTex",(s,n)=>Aq(s,n))),dEe(e,t)}function dEe(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==ht.Water&&t.pbrMode!==ht.WaterOnIntegratedMesh&&t.pbrMode!==ht.TerrainWithWater||e.include($2e,t);const{vertex:r,fragment:i}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add(w`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(w`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(w`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(w`
    vec4 getOverlayColorTexel(vec4 texCoords) {
          vec2 texDim =  ${Hh(t,"ovColorTex")};

          vec4 color0 = ${rl(t,"ovColorTex","vec2(texCoords.x * 0.5, texCoords.y)*texDim")};
          vec4 color1 = ${rl(t,"ovColorTex","vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim")};

          bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
          bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));

          return mix(color1 * float(isValid1), color0, float(isValid0));
    }
  `),t.pbrMode!==ht.Water&&t.pbrMode!==ht.WaterOnIntegratedMesh&&t.pbrMode!==ht.TerrainWithWater||(Py(i),Dm(i),i.code.add(w`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Aq(e,t){return t.overlays.length===0?null:e.identifier===Oc.Material&&e.output===k.Color?t.overlays[is.INNER].getColorTextureNoRasterImage():e.identifier===Oc.Material&&e.output===k.ObjectAndLayerIdColor?t.overlays[is.INNER].getColorTexture(Fl.ObjectAndLayerIdColor):e.identifier===Oc.Highlight?t.overlays[is.INNER].getValidTexture(vs.Highlight):null}function Tft(e,t){for(const r of t.overlays){const{index:i,extent:s}=r;Afe(s)>0&&(HS[2*i]=e.toMapSpace[0]/Au(s)-s[0]/Au(s),HS[2*i+1]=e.toMapSpace[1]/Ip(s)-s[1]/Ip(s))}return HS}function Sft(e,t){for(const r of t.overlays){const{index:i,extent:s}=r;Afe(s)>0&&(HS[2*i]=e.toMapSpace[2]/Au(s),HS[2*i+1]=e.toMapSpace[3]/Ip(s))}return HS}(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(hy||(hy={}));const HS=sr();var sm;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(sm||(sm={}));class Eft extends gi{constructor(){super(...arguments),this.overlayOpacity=1}}function qA(e,t){e.vertex.uniforms.add([new a5("overlayTexOffset"),new a5("overlayTexScale")]),e.fragment.uniforms.add([new Pe("overlayOpacity",r=>r.overlayOpacity),new Mt("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[is.INNER].getColorTexture(r.overlaySource))]),dEe(e,t)}function Cft(e,t){const{vertex:r,fragment:i,varyings:s}=e;s.add("vtc","vec2"),r.uniforms.add(new a5("texOffsetAndScale")),i.uniforms.add(new Sce("tex")),i.uniforms.add(new uB("textureOpacities"));const n=t.textureFadingEnabled&&!t.renderOccluded;n&&(r.uniforms.add(new a5("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new Sce("texNext")),i.uniforms.add(new uB("nextTexOpacities")),i.uniforms.add(new Aft("fadeFactor")));const o=t.tileBlendInput===sm.ColorComposite,a=t.tileBlendInput===sm.GridComposite;a&&i.include(zQ),o&&i.uniforms.add(new uB("backgroundColor")),r.code.add(w`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?w`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:w``}
  }`),i.code.add(w`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?w`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?w`backgroundColor`:w`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:w`return color;`}
    }`),n?i.code.add(w`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(w`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class Aft extends Es{constructor(t){super(t,"float")}}class uB extends Es{constructor(t){super(t,"vec3")}}class a5 extends Es{constructor(t){super(t,"vec4")}}class Sce extends Es{constructor(t){super(t,"sampler2D")}}class pEe extends Eft{}function Rft(e){const t=new Lr,{vertex:r,fragment:i,varyings:s}=t;t.include(NP),t.include(XP,e),t.include(um,e);const n=()=>{t.include(LM,e),r.code.add(w`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${e.shading?w`decodeNormalTerrain(normalCompressed)`:w`getLocalUp(position, localOrigin)`};
      }
  `)};Nc(r,e),t.include(jl,e);const o=e.overlayMode!==hy.Disabled;switch(e.output){case k.Color:{t.include(Cft,e),t.include(cx,e),o&&t.include(qA,{...e,pbrMode:e.pbrMode===ht.Terrain?ht.TerrainWithWater:ht.Water});const a=e.overlayMode===hy.EnabledWithWater;a&&t.include(_ft,e),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),(e.atmosphere||e.screenSizePerspective)&&KE(r);const l=e.receiveShadows&&!e.renderOccluded;l&&t.include(LC,e),e.atmosphere&&s.add("wnormal","vec3"),e.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(w`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${a?w`forwardVertexTangent(vnormal);`:w``}

          ${e.atmosphere?w`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?w`setOverlayVTC(uv);`:""}
          ${e.tileBorders?w`forwardTextureCoordinates();`:""}

          ${e.screenSizePerspective?w`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?w`forwardLinearDepth();`:""}

        }
      `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(Ks,e),t.include(cx,e),t.include(JP,e),t.include(lx,e),Fp(i,e),QP(i),GC(i),i.uniforms.add([r.uniforms.get("localOrigin"),new qt("viewDirection",(c,h)=>ve(Ece,ce(Ece,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))]),a&&i.uniforms.add([new Mt("ovWaterTex",(c,h)=>h.overlays.length===0?null:h.overlays[is.INNER].getNormalTexture(c.overlaySource)),new Lxe("view",(c,h)=>Yl(Oft,h.camera.viewMatrix,c.origin))]),i.code.add(w`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),Py(i),Dm(i),i.code.add(w`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${e.receiveShadows&&!e.renderOccluded?"readShadowMap(vpos, linearDepth)":e.spherical&&e.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?w`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${e.invisible?w`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${e.atmosphere?w`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${e.atmosphere?w`atm + tileColor.rgb;`:w`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${e.pbrMode===ht.Terrain||e.pbrMode===ht.TerrainWithWater?w`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:w`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${a?w`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${e.screenSizePerspective?w`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${e.visualizeNormals?e.spherical?w`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:w`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${e.tileBorders?w`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case k.Depth:o&&t.include(qA,e),t.include(Sy,e),bv(t),Yw(t),r.code.add(w`
              void main(void) {
                ${o?w`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(w`
              void main() {
                ${o&&e.invisible?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case k.Shadow:case k.ShadowHighlight:case k.ShadowExcludeHighlight:t.include(Sy,e),bv(t),Yw(t),r.code.add(w`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(w`void main() {
outputDepth(linearDepth);
}`);break;case k.Normal:o&&t.include(qA,e),s.add("vnormal","vec3"),KE(r),n(),r.code.add(w`
            void main(void) {
              ${o?w`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(w`
            void main() {
              ${o&&e.invisible?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case k.Highlight:o&&t.include(qA,e),r.code.add(w`
          void main() {
            ${o?w`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),t.include(Uy,e),i.code.add(w`
          void main() {
            ${o?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return e.output===k.ObjectAndLayerIdColor&&(t.include(qA,{...e,pbrMode:ht.Disabled}),r.code.add(w`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(w`void main() {
gl_FragColor = getOverlayColorTexel(vtcOverlay);
}`)),t}const Oft=Ie(),Ece=M(),Mft=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:pEe,build:Rft},Symbol.toStringTag,{value:"Module"}));class r8 extends Br{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2,r.spherical=t.viewingMode===Ge.Global}initializeProgram(t){return new Nr(t.rctx,r8.shader.get().build(this.configuration),fEe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Vt({blending:r.renderOccluded?Vp(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA):null,culling:i?UZ:null,depthTest:r.renderOccluded?null:{func:Ni.LESS},depthWrite:r.renderOccluded?null:Jl,colorWrite:Qt,stencilTest:t?Fst(ql.IntegratedMeshMaskExcluded):null})}getPipelineState(t,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,r)}}r8.shader=new Dr(Mft,()=>ie(()=>import("./Terrain.glsl.9693af4d.js"),[]));const fEe=new Map([[A.POSITION,0],[A.UV0,1],[A.NORMALCOMPRESSED,2]]);class Pft{constructor(){this.geometryInfo=new Apt,this.intersectionData=null,this.geometryState=null,this._textureRef=new jS(()=>this.tile.surface.textureFadeDuration),this.overlay=new yft,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(t){this.clear(),this._tile=t;const r=this.geometryInfo;r.indices=null,r.vertexAttributes=null,$i(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new Lpt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(t){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(t),this._geometryStateChangedSinceLastUpdate=!1),On&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)Re(this.geometryInfo.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(t,r){var l;const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(v(c)&&(t===0&&i.extent[3]>c[3]||t===1&&i.extent[2]>c[2]||t===2&&i.extent[1]<c[1]||t===3&&i.extent[0]<c[0]))return s}const n=i.level,o=im[t];if(!r)return Re(E((l=i.surface)==null?void 0:l.rootTiles)||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const c=r,h=c.renderData.geometryState,p=n-c.level;if(Re(p>=0),p===0){const y=h.numVerticesPerSide-1;return Math.max(y,s)}const f=2**p,m=h.neighborData.edgeResolutions[(t+2)%4]/f;return Math.max(1,m)}Re(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(s5(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(Re(!c.isLeaf),!1))),a}updateNeighborData(){var a,l,c;const t=this.tile;if(!t.intersectsClippingArea)return;const r=t.renderData.geometryState.neighborData,i=h=>(h.isLoaded||h.level===t.level)&&(h==null?void 0:h.intersectsClippingArea),s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let h=0;h<4;++h){const p=t.findNeighborTile(im[h],i),f=jb(t,p),m=(l=(a=f==null?void 0:f.renderData)==null?void 0:a.geometryState.samplerDataVersion)!=null?l:-1,y=s[h],_=f!==jb(t,y),b=n[h]!==m;s[h]=p,(_||b)&&(n[h]=m,this._markEdgeDirty(h));const x=r.edgeResolutions[h],T=this._calculateEdgeResolution(h,p);Re(Rp(T)),Re(T>=1),r.edgeResolutions[h]=T,x!==T&&this._markEdgeResolutionDirty(h)}const o=r.cornerPeerNeighbors;for(let h=0;h<4;++h){const p=t.findNeighborTile(n5[h],i);o[h]=p;const f=jb(t,s[h]),m=jb(t,s[(h+1)%4]),y=jb(t,p);Td[h]=y,Td[(h+1)%4]=m,Td[(h+2)%4]=t,Td[(h+3)%4]=f,Re(Td.some(T=>(T==null?void 0:T.isLoaded)||T===t));const _=Td.reduce((T,S)=>{var C;return Math.min(T,(C=S==null?void 0:S.level)!=null?C:1/0)},1/0);Td.forEach((T,S)=>{T&&(T==null?void 0:T.level)>_&&(Td[S]=null)}),Re(Td.some(T=>(T==null?void 0:T.isLoaded)||T===t));const b=r.cornerNeighborData[h].cornerTiles,x=r.cornerNeighborData[h].cornerTileSamplerVersions;for(let T=0;T<4;++T){const S=Td[T],C=(c=S==null?void 0:S.renderData.geometryState.samplerDataVersion)!=null?c:-1,O=b[T]!==S,R=!O&&x[T]!==C;(O||R)&&(b[T]=S,x[T]=C,this._markCornerDirty(h))}Re(b.some(T=>(T==null?void 0:T.isLoaded)||T===t))}On&&Re(this.geometryState.neighborData.edgeResolutions.every(h=>h>0));for(let h=0;h<4;++h)Td[h]=null}_updateGeometry(t){if(!this.tile.intersectsClippingArea)return;On&&Re(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometryInfo.vertexAttributes,n=!i||!s||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(t)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,Mpt(this.geometryInfo),!0)}ensureTexture(t,r){return v(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),E(this._texture)&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){v(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(t){const r=1<<t;this._dirtyCorners|=r}_markEdgeDirty(t){const r=1<<t;this._dirtyEdges|=r}_markEdgeResolutionDirty(t){const r=1<<t;this._dirtyEdgeResolutions|=r,this._dirtyEdges|=r}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const t=this._getElevationInfo(),r=this.tile,i=t.samplerData?r.getElevationVerticesPerSide(t.maxTileLevel):r.getDefaultVerticesPerSide(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),t.changed&&(this._samplerDataChanged=!0,o.samplerData=t.samplerData,o.samplerDataVersion++,a=!0),dy(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface,c=l.wireframe;o.wireframe!==c&&(this._wireframeChanged=!0,o.wireframe=c,a=!0);const h=l.shading;return o.shading!==h&&(this._shadingChanged=h,o.shading=h,a=h),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(t){this.tile.createGeometry();const r=this.geometryInfo.vertexAttributes,i=this.geometryInfo.indices,s=t.gl;this._vao=new Bp(t,fEe,{geometry:Hc(r.layout)},{geometry:wr.createVertex(t,s.STATIC_DRAW,r.buffer)},wr.createIndex(t,s.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(t,r=cy.Immediate){v(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,r=this.tile.layerInfo[pr.ELEVATION],i=r.length,s=new Array(i);let n=0,o=0,a=!1;for(let h=0;h<i;h++){const p=r[h];if(v(p.upsampleInfo)){const f=p.upsampleInfo.tile,m=f.layerInfo[pr.ELEVATION][h].data,y=m&&m.samplerData;t&&t[n]===y||(a=!0),s[n++]=y,o=Math.max(o,f.lij[0])}else if(p.data){const f=this.tile.surface.layerViewByIndex(h,pr.ELEVATION);if(vO(this.tile,f.layer,!1)){const m=p.data;t&&t[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}v(t)&&t.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,s,n;const t=Tu(this.intersectionData,0,o=>o.estimatedMemoryUsage);return((i=(r=this.geometryInfo.indices)==null?void 0:r.byteLength)!=null?i:0)+((n=(s=this.geometryInfo.vertexAttributes)==null?void 0:s.byteLength)!=null?n:0)+t}get textureDescriptor(){return v(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!On)return;const t=this.tile;if(Re(t==null?void 0:t.isLoaded),!t.isLoaded||!t.intersectsClippingArea)return;const r=t.renderData;if(t.level===0)return;const i=t.surface.extent;if(v(i)&&!t.intersectsExtent(i))return;const s=im.map((l,c)=>!!v(i)&&(c<2?-1:1)*(t.extent[3-c]-i[3-c])<0),n=t.level;Re(this._dirtyCorners===0),Re(this._dirtyEdges===0),Re(this._dirtyEdgeResolutions===0),Re(!this._numVerticesPerSideChanged),Re(!this._samplerDataChanged),Re(!this._clippingAreaChanged),Re(!this._wireframeChanged);const o=n5.map(l=>{var c;return(c=t.findNeighborCornerTileExact(l,h=>!h.intersectsClippingArea||h.isLoaded||h.level===t.level))!=null?c:null}).map(l=>l!=null&&l.intersectsClippingArea?l:null),a=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=a.cornerPeerNeighbors[l],h=o[l];Re(h===c,`Tile[${t.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${h==null?void 0:h.lij}]`)}im.forEach((l,c)=>{if(s[c])return;const h=t.findNeighborTile(l,N=>(N.level===n||(N==null?void 0:N.isLoaded))&&(N==null?void 0:N.intersectsClippingArea));if(!h){const N=!t.surface.updatingRootTiles&&v(t.surface.rootTiles)&&t.surface.rootTiles.length>0&&t.shouldHaveNeighbor(l);return void Re(!N)}Re(h.isLoaded||h.level===t.level),Re(h===this.geometryState.neighborData.edgePeerNeighbors[c]);const p=n-h.level;if(!h.isLoaded)return Re(!h.isLeaf),void Re(p===0);const f=h.renderData;Re(gft(t,h,l)),Re(p>=0);const m=2**p;if(p<0)return void Re(!1);const y=r.geometryInfo,_=y.outerEdges[c],b=y.numVerticesPerSide-1,x=f.geometryInfo;if(!x)return void Re(!1);{const N=this.geometryState.neighborData.edgePeerNeighbors[c];if(N!=null&&N.isLoaded){const F=N.renderData;Re(N==N),Re(r.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===F.geometryState.samplerDataVersion),Re(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===F.geometryState.samplerDataVersion)}}const T=(c+2)%4,S=x.outerEdges[T],C=_.count-1,O=S.count-1;Re(C*m===O,`Tile[${t.lij}]:e${c},res=${C} edgeRes mismatch with Neighbor[${h.lij}]:e${T},res=${O} (expected:${C*m})`);const R=t.extent,$=l===At.NORTH||l===At.SOUTH,I=S.count-1,U=I/2**p,V=_.count-1;if(U<1)return void Re(V===1);Re(U===V),Re(Rp(U));const G=x.numVerticesPerSide-1;Re(p>0||U===Math.max(G,b));const z=t.getNeighborEdgeStartVertexIndex(c,h);Re(0<=z&&z<m);const Z=z*U;Re(0<=Z&&Z<=I-U);let Q=0,te=Z;_.getVertexPos(of,0),_.getVertexPos(af,_.count-1);const q=Ai(of,af),L=Math.max(Ift,1e-4*q);for(let N=0;N<=U;++N){_.getVertexPos(of,Q),S.getVertexPos(af,te);const F=N/U,H=$?R[0]+F*(R[2]-R[0]):l===At.WEST?R[0]:R[2],X=$?l===At.SOUTH?R[1]:R[3]:R[1]+F*(R[3]-R[1]),K=t.surface.extent;if(E(K)||B5(K,H,X)){const W=QM(of,af),ue=_c(of)-br.radius,pe=_c(af)-br.radius,we=W<L;if(!we){console.warn(`Tile edge vertex position mismatch: between [${t.lij}].edge${c}[${Q}/${_.count}] and [${h.lij}].edge${T}[${te}/${S.count}]`),v(K)&&console.warn("  surface extent= ",K," x,y=",H,",",X);const Ce=M();ge(Ce,r.localOrigin,f.localOrigin),_c(Ce)>0&&console.warn(`   localOrigins: ${r.localOrigin} vs ${f.localOrigin} d=${_c(Ce)} [${Ce}]`),(()=>{const qe=bs(of),Ne=bs(af);t.updateEdgeElevations(),h.updateEdgeElevations(),_.getVertexPos(of,Q),S.getVertexPos(af,te);const xe=M();lo(xe,of,qe),_c(xe)>0&&console.warn(`  XXX Tile[${t.lij}] edge out of date: ${qe} vs ${of} d=${_c(xe)} [${xe}]`),lo(xe,af,Ne),_c(xe)>0&&console.warn(`  XXX Neighbor[${h.lij}] edge out of date: ${Ne} vs ${af} d=${_c(xe)} [${xe}]`)})(),Re(we,`Mismatch in tile [${t.lij}].edge[${c}][${Q}/${_.count}] vs neighbor [${h.lij}].edge[${T}][${te}/${S.count}] ${ng(of)} vs ${ng(af)}  dist=${W} h(t|n|d)=${ue}|${pe}|${pe-ue}`)}if(t.surface.shading){_.getNormal(ST,Q),S.getNormal(ET,te),ve(Cce,ST),ve(Ace,ET);const Ce=_e(Cce,Ace),qe=1-Ce<.01||!1||t===h;if(!qe){const Ne=M();lo(Ne,ST,ET);const xe=()=>`Mismatch in tile edge normal ${ice(t.lij)} (${Q}/${_.count-1}) edge ${c} vs neighbor ${ice(h.lij)}  (${te}/${S.count-1}) nedge ${T} :${ng(ST)} vs ${ng(ET)}  dot = ${Ce} : ${ng(Ne)}`;console.warn("Mismatch in tile edge normal: ",xe());{t.updateEdgeElevations(),h.updateEdgeElevations();const Fe=M(),ke=M();_.getNormal(Fe,Q),S.getNormal(ke,te),lv(ST,Fe)||console.warn("Missing update in tile normal: ",ng(ST)," => ",ng(Fe)),lv(ET,ke)||console.warn("Missing update in neighbor normal: ",ng(ET)," => ",ng(ke))}Re(qe,xe())}}}Q+=1,te+=1}})}}const of=M(),af=M(),ST=M(),ET=M(),Cce=M(),Ace=M(),Ift=1,Td=[null,null,null,null];function jb(e,t){return(t==null?void 0:t.isLoaded)||t===e?t:null}const $ft=65536;function Lft(e,t){const r=e.tile,{extent:i,extentInRadians:s,surface:n}=r,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shading||dx,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(t===Lh.HAS_SOUTH_POLE||t===Lh.HAS_BOTH_POLES),y=l&&(t===Lh.HAS_NORTH_POLE||t===Lh.HAS_BOTH_POLES),_=6,b=((m?1:0)+(y?1:0))*_*(p+1),x=a.neighborData,T=x.edgeResolutions.reduce((I,U)=>I+U+1,0),S=iEe(f+b+T),C=e.geometryInfo;C.numVerticesPerSide=a.numVerticesPerSide,C.vertexAttributes=S;const O=C.boundingBox;$i(O);const R=WQ(e);hn.update(p,s,R),Dft(e),TEe(e,f),mEe(e);const $=[];if((()=>{let I=f+T;const U=o[0],V=o[1],G=o[2],z=r.ellipsoid.radius,Z=i[1],Q=i[3],te=(q,L)=>{const N=L*h;sl(-U,-V,q*z-G,O),$.push({connectedRowOffset:N,connectedOuterEdgeOffset:q===1?0:2,rowOffset:I,latitudeResolution:_});const F=_Ee(q===-1?Z:Q,z),H=q*Math.PI/2-F,X=.99*(q===1?1:-1),K=z+0,W=S.position,ue=S.uv0,pe=S.normalCompressed;for(let we=1;we<=_;++we){const Ce=F+H*(we/_),qe=Math.cos(Ce),Ne=Math.sin(Ce);for(let xe=0;xe<=p;xe++){const Fe=xe/p,ke=hn.sinLonLUT[xe],wt=hn.cosLonLUT[xe]*qe,et=ke*qe,Ft=Ne,Wt=wt*K-U,Kt=et*K-V,Xt=Ft*K-G;sl(Wt,Kt,Xt,O),W.setValues(I,Wt,Kt,Xt),Fc(ue,I,Fe,X),c&&GM(pe,I,wt,et,Ft),++I}}};m&&te(-1,0),y&&te(1,p)})(),xEe(C,a.numVerticesPerSide,$,[0,h-1],[0,h-1],a.wireframe),e.intersectionData=null,On)for(let I=0;I<4;++I)Re(C.outerEdges[I].count===x.edgeResolutions[I]+1)}function Dft(e){const t=e.tile;t.intersectsClippingArea&&(t.surface.shading||dx?Fft(e):Nft(e))}function Nft(e){const t=e.geometryState,r=t.numVerticesPerSide,i=r-2,s=r-1,n=e.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=e.tile,h=c.extent,p=h[0],f=h[2],m=h[1],y=h[3],_=c.ellipsoid.radius,b=t.samplerData,x=e.localOrigin,T=x[0],S=x[1],C=x[2],O=n.boundingBox,R=a.typedBuffer,$=a.typedBufferStride;let I=0;for(let U=1;U<=i;U++){const V=U/s,G=m*(1-V)+y*V,z=hn.sinLatLUT[U],Z=hn.cosLatLUT[U];for(let Q=1;Q<=i;Q++){const te=Q/s,q=p*(1-te)+f*te,L=hn.sinLonLUT[Q],N=hn.cosLonLUT[Q],F=_+Xi(q,G,b),H=N*Z*F-T,X=L*Z*F-S,K=z*F-C;sl(H,X,K,O);const W=I*$;R[W]=H,R[W+1]=X,R[W+2]=K,Fc(l,I,te,V),++I}}}function Fft(e){const t=e.geometryState,r=t.numVerticesPerSide,i=r-2,s=r-1,n=e.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=o.normalCompressed,h=e.tile,p=h.extent,f=p[0],m=p[2],y=p[1],_=p[3],b=h.ellipsoid.radius,x=t.samplerData,T=e.localOrigin,S=T[0],C=T[1],O=T[2],R=a.typedBuffer,$=a.typedBufferStride,I=1/s,U=n.boundingBox;let V=0;if(1<=i){const G=I,z=y*(1-G)+_*G,Z=hn.sinLatLUT[1],Q=hn.cosLatLUT[1];for(let te=1;te<=i;te++){const q=te*I,L=f*(1-q)+m*q,N=hn.sinLonLUT[te],F=hn.cosLonLUT[te],H=b+Xi(L,z,x),X=H*F*Q-S,K=H*N*Q-C,W=H*Z-O;sl(X,K,W,U);const ue=(te-1)*$;R[ue]=X,R[ue+1]=K,R[ue+2]=W,Fc(l,te-1,q,G)}}for(let G=1;G<=i;G++){const z=G*I,Z=y*(1-z)+_*z,Q=hn.sinLatLUT[G],te=hn.cosLatLUT[G],q=G+1,L=q*I,N=y*(1-L)+_*L,F=hn.sinLatLUT[q],H=hn.cosLatLUT[q],X=hn.sinLonLUT[0],K=hn.cosLonLUT[0],W=b+Xi(f,Z,x);let ue=K*te*W-S,pe=X*te*W-C,we=Q*W-O;const Ce=V*$;let qe=R[Ce],Ne=R[Ce+1],xe=R[Ce+2];for(let Fe=1;Fe<=i;Fe++){const ke=Fe*I,wt=f*(1-ke)+m*ke,et=hn.sinLonLUT[Fe],Ft=hn.cosLonLUT[Fe];let Wt=Ft*te,Kt=et*te,Xt=Q,mr=0,Qr=0,Er=0;{let Fr=0,$e=0,He=0;if(Fe<i){const zr=(V+1)*$;Fr=R[zr],$e=R[zr+1],He=R[zr+2]}else{const zr=hn.sinLonLUT[s],Tr=hn.cosLonLUT[s],Mr=b+Xi(m,Z,x);Fr=Tr*te*Mr-S,$e=zr*te*Mr-C,He=Q*Mr-O}const ct=ue,Tt=pe,jt=we;ue=qe,pe=Ne,we=xe,qe=Fr,Ne=$e,xe=He,mr=Fr-ct,Qr=$e-Tt,Er=He-jt}{let Fr=0,$e=0,He=0;if(G>1){const ct=(V-i)*$;Fr=R[ct],$e=R[ct+1],He=R[ct+2]}else{const ct=hn.sinLatLUT[0],Tt=hn.cosLatLUT[0],jt=b+Xi(wt,y,x);Fr=Ft*Tt*jt-S,$e=et*Tt*jt-C,He=ct*jt-O}{const ct=b+Xi(wt,N,x),Tt=Ft*H*ct-S,jt=et*H*ct-C,zr=F*ct-O;if(G<i){const Mi=V+i,er=Mi*$;R[er]=Tt,R[er+1]=jt,R[er+2]=zr,sl(Tt,jt,zr,U),Fc(l,Mi,ke,L)}const Tr=Fr-Tt,Mr=$e-jt,Pr=He-zr;Xt*Xt<.999&&(Wt=Er*Mr-Qr*Pr,Kt=mr*Pr-Er*Tr,Xt=Qr*Tr-mr*Mr)}}const xr=1/Math.sqrt(Wt*Wt+Kt*Kt+Xt*Xt);GM(c,V,Wt*xr,Kt*xr,Xt*xr),++V}}}function Uft(e){e.tile.intersectsClippingArea&&(mEe(e),i8(e))}function kft(e){e.tile.intersectsClippingArea&&(yEe(e),gEe(e,!0),i8(e))}function mEe(e){e.tile.intersectsClippingArea&&(yEe(e),gEe(e))}function gEe(e,t=!1){const r=e.geometryState,i=e.geometryInfo,s=r.neighborData,n=e.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],p=c[2],f=c[1],m=c[3],y=r.samplerData,_=a[0],b=a[2],x=a[1],T=a[3],S=WQ(e),C=i.boundingBox,O=e.localOrigin,R=O[0],$=O[1],I=O[2],U=n.surface.shading||dx,V=i.vertexAttributes,G=V.position,z=G.typedBuffer,Z=G.typedBufferStride,Q=V.uv0;for(let te=0;te<4;++te){const q=te===1||te===3,L=s.edgeResolutions[te];Re(Rp(L));const N=L+1,F=jb(n,s.edgePeerNeighbors[te]);if(CEe(n,F,te)){SEe(e,te,F);continue}const H=v(F);Re(!H||F.level===n.level),Re(!H||uy(n,F)<=0);const X=F==null?void 0:F.renderData,K=X==null?void 0:X.geometryState;if(On){const $e=n.surface;if(!F&&$e&&!$e.updatingRootTiles){const He=im[te],ct=n.findNeighborTile(He,Tt=>Tt.isLoaded||Tt.isLeaf||Tt.level===n.level);ct?ct.intersectsClippingArea&&(Re(!ct.isLoaded),Re(!ct.isLeaf),Re(ct.level===o)):Re(E($e==null?void 0:$e.rootTiles)||!n.shouldHaveNeighbor(He))}}const W=te===1?a[2]:a[0],ue=F==null?void 0:F.extent,pe=ue&&q?te===1?ue[0]:ue[2]:W,we=te===0?a[3]:a[1],Ce=te===1?1:0,qe=te===0?1:0,Ne=te===1?p:h,xe=te===0?m:f,Fe=Math.sin(Ne),ke=Math.cos(Ne),wt=Math.sin(xe),et=Math.cos(xe),Ft=K==null?void 0:K.samplerData,Wt=H?($e,He,ct)=>.5*(Xi($e,He,y)+Xi(ct,He,Ft)):($e,He,ct)=>Xi($e,He,y),Kt=i.outerEdges[te],Xt=t&&N>3?N-3:1,mr=v(y)&&y.some($e=>$e!=null),Qr=v(Ft)&&Ft.some($e=>$e!=null),Er=mr||Qr,xr=1/L,Fr=Kt.index0;U?(Re(!ue||Dh(ue[2]-ue[0],a[2]-a[0])),(()=>{const $e=te===1?-1:te===3?1:0,He=te===0?-1:te===2?1:0,ct=(a[2]-a[0])*xr,Tt=$e*ct,jt=He*ct,zr=q?$e*((p-h)*xr):0,Tr=q?0:He*xr,Mr=qe,Pr=q?Ne+zr:Ne,Mi=q?Math.sin(Pr):Fe,er=q?Math.cos(Pr):ke,gr=q?Ne-zr:Ne,hr=q?Math.sin(gr):Fe,ms=q?Math.cos(gr):ke,ai=q?xe:S(Mr+Tr),Zi=q?wt:Math.sin(ai),yi=q?et:Math.cos(ai),Gi=q?xe:S(Mr-Tr),gs=q?wt:Math.sin(Gi),Bs=q?et:Math.cos(Gi);let vo=0,Xn=0,Cs=0;{const li=0*xr,Go=q?W:_*(1-li)+b*li,ul=q?pe:Go,he=q?x*(1-li)+T*li:we,wi=q?Ne:h*(1-li)+p*li,pd=q?Fe:Math.sin(wi),la=q?ke:Math.cos(wi),qc=q?S(li):xe,ut=q?Math.sin(qc):wt,Ql=q?Math.cos(qc):et,as=l+Wt(Go,he,ul);vo=la*Ql*as,Xn=pd*Ql*as,Cs=ut*as}let Ji=0,Qi=0,As=0;{const li=1*xr,Go=q?W:_*(1-li)+b*li,ul=q?pe:Go,he=q?x*(1-li)+T*li:we,wi=q?Ne:h*(1-li)+p*li,pd=q?Fe:Math.sin(wi),la=q?ke:Math.cos(wi),qc=q?S(li):xe,ut=q?Math.sin(qc):wt,Ql=q?Math.cos(qc):et,as=l+Wt(Go,he,ul);Ji=la*Ql*as,Qi=pd*Ql*as,As=ut*as}for(let li=1;li<N-1;li+=Xt){let Go=0,ul=0,he=0;{const jo=(li+1)*xr,Wu=q?W:_*(1-jo)+b*jo,Xu=q?pe:Wu,ci=q?x*(1-jo)+T*jo:we,Gp=q?Ne:h*(1-jo)+p*jo,Gm=q?Fe:Math.sin(Gp),Px=q?ke:Math.cos(Gp),Hv=q?S(jo):xe,Ix=q?Math.sin(Hv):wt,qv=q?Math.cos(Hv):et,Hy=l+Wt(Wu,ci,Xu);Go=Px*qv*Hy,ul=Gm*qv*Hy,he=Ix*Hy}const wi=Go,pd=ul,la=he,qc=Ji,ut=Qi,Ql=As;Ji=wi,Qi=pd,As=la;{const jo=Fr+li,Wu=jo*Z,Xu=qc-R,ci=ut-$,Gp=Ql-I;z[Wu]=Xu,z[Wu+1]=ci,z[Wu+2]=Gp,sl(Xu,ci,Gp,C);const Gm=li*xr;Fc(Q,jo,q?Ce:Gm,q?Gm:qe)}const as=vo,jv=Xn,O8=Cs;vo=qc,Xn=ut,Cs=Ql;const hl=qc,zy=ut,Bm=Ql,tr=1/Math.sqrt(hl*hl+zy*zy+Bm*Bm),sI=Bm*tr;let zm=0,Gy=0,jy=0;if(Er&&sI*sI<.999){let jo=0,Wu=0,Xu=0;{const ci=te===0?-1:1;jo=ci*(wi-as),Wu=ci*(pd-jv),Xu=ci*(la-O8)}{const ci=li*xr,Gp=q?W:_*(1-ci)+b*ci,Gm=q?pe:Gp,Px=q?x*(1-ci)+T*ci:we,Hv=q?Ne:h*(1-ci)+p*ci,Ix=q?Fe:Math.sin(Hv),qv=q?ke:Math.cos(Hv),Hy=q?S(ci):xe,dl=q?Math.sin(Hy):wt,nI=q?Math.cos(Hy):et;let jC=hl,Y=zy,be=Bm;if(H){const Oe=l+Xi(Gm-Tt,Px-jt,Ft),dr=q?nI:Bs;jC=(q?ms:qv)*dr*Oe,Y=(q?hr:Ix)*dr*Oe,be=(q?dl:gs)*Oe}{const Oe=l+Xi(Gp+Tt,Px+jt,y),dr=q?nI:yi,Yn=(q?er:qv)*dr*Oe,Rs=(q?Mi:Ix)*dr*Oe,pl=(q?dl:Zi)*Oe;H||(jC=2*hl-Yn,Y=2*zy-Rs,be=2*Bm-pl);const qy=te===3?-1:1,lK=qy*(jC-Yn),cK=qy*(Y-Rs),uK=qy*(be-pl);zm=Xu*cK-Wu*uK,Gy=jo*uK-Xu*lK,jy=Wu*lK-jo*cK;const M8=1/Math.sqrt(zm*zm+Gy*Gy+jy*jy);zm*=M8,Gy*=M8,jy*=M8}}}else zm=hl*tr,Gy=zy*tr,jy=Bm*tr;Kt.setNormalFromValues(li,zm,Gy,jy)}})()):(()=>{for(let $e=1;$e<N-1;$e+=Xt){const He=$e*xr,ct=q?Ce:He,Tt=q?He:qe,jt=q?W:_*(1-He)+b*He,zr=q?x*(1-He)+T*He:we,Tr=q?pe:jt,Mr=q?Ne:h*(1-He)+p*He,Pr=q?Fe:Math.sin(Mr),Mi=q?ke:Math.cos(Mr),er=q?S(He):xe,gr=q?Math.sin(er):wt,hr=q?Math.cos(er):et,ms=Wt(jt,zr,Tr),ai=l+ms,Zi=Mi*hr*ai-R,yi=Pr*hr*ai-$,Gi=gr*ai-I;sl(Zi,yi,Gi,C);const gs=Fr+$e,Bs=gs*Z;z[Bs]=Zi,z[Bs+1]=yi,z[Bs+2]=Gi,Fc(Q,gs,ct,Tt)}})()}}function yEe(e){EEe(e)}function _Ee(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function Vft(e,t,r,i){return _Ee(e*(1-i)+t*i,r)}function Bft(e,t,r){return e*(1-r)+t*r}function WQ(e){const t=e.tile;if(t.surface.isWebMercator){const i=t.extent,s=t.ellipsoid.radius;return n=>Vft(i[1],i[3],s,n)}const r=t.extentInRadians;return i=>Bft(r[1],r[3],i)}function zft(e,t){const r=e.tile.extent,i=e.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=v(l)?Math.max(0,(l[0]-s)/o):0,h=v(l)?Math.max(0,(l[1]-n)/a):0,p=v(l)?Math.min(1,(l[2]-s)/o):1,f=v(l)?Math.min(1,(l[3]-n)/a):1,m=i.numVerticesPerSide,y=(m-2)**2,_=i.neighborData.edgeResolutions.reduce((S,C)=>S+C+1,0),b=iEe(y+_),x=e.geometryInfo,T=x.boundingBox;$i(T),x.numVerticesPerSide=i.numVerticesPerSide,x.vertexAttributes=b,ti(x.uvRange,c,h,p,f),Gft(e),TEe(e,y),vEe(e),xEe(x,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),e.intersectionData=null}function Gft(e){const t=e.tile;t.intersectsClippingArea&&(t.surface.shading?Hft(e):jft(e))}function jft(e){const t=e.geometryState,r=t.samplerData,i=e.tile,s=i.surface,n=e.localOrigin,o=s.isWebMercatorOnPlateeCarree,a=t.clippingArea,l=v(a)?a:s8,c=i.extent,h=c[0],p=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),x=Math.min(m,l[3]),T=n[0],S=n[1],C=n[2],O=i.ellipsoid.radius,R=i.horizontalScale,$=XQ(o,O,R),I=t.numVerticesPerSide,U=I-1,V=I-2,G=e.geometryInfo,z=G.uvRange,Z=z[0],Q=z[1],te=z[2],q=z[3],L=G.boundingBox,N=G.vertexAttributes,F=N.position,H=N.uv0;let X=0;for(let K=1;K<=V;K++){const W=K/U,ue=ye(p*(1-W)+m*W,b,x),pe=ye(W,Q,q),we=$(ue)-S;for(let Ce=1;Ce<=V;Ce++){const qe=Ce/U,Ne=ye(h*(1-qe)+f*qe,y,_),xe=ye(qe,Z,te),Fe=Ne*R-T,ke=Xi(Ne,ue,r)-C;sl(Fe,we,ke,L),F.setValues(X,Fe,we,ke),Fc(H,X,xe,pe),++X}}}function Hft(e){const t=e.tile,r=t.surface;if(!(r.shading||dx))return;const i=e.geometryState,s=i.samplerData,n=e.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=v(a)?a:s8,c=t.extent,h=c[0],p=c[1],f=c[2],m=c[3],y=Math.max(h,l[0]),_=Math.min(f,l[2]),b=Math.max(p,l[1]),x=Math.min(m,l[3]),T=t.ellipsoid.radius,S=t.horizontalScale,C=i.numVerticesPerSide,O=C-1,R=C-2,$=e.geometryInfo,I=$.vertexAttributes,U=I.position,V=I.uv0,G=I.normalCompressed,z=$.uvRange,Z=z[0],Q=z[1],te=z[2],q=z[3],L=$.boundingBox,N=n[0],F=n[1],H=n[2],X=U.typedBuffer,K=U.typedBufferStride;let W=0;const ue=ye(p,b,x),pe=o?(Math.PI/2-2*Math.atan(Math.exp(-ue/T)))*T:ue*S,we=1/O,Ce=ye(p*(1-we)+m*we,b,x);let qe=pe,Ne=o?(Math.PI/2-2*Math.atan(Math.exp(-Ce/T)))*T:Ce*S;for(let xe=1;xe<=R;xe++){const Fe=xe/O,ke=ye(p*(1-Fe)+m*Fe,b,x),wt=ye(Fe,Q,q),et=Ne,Ft=(xe-1)/O,Wt=ye(p*(1-Ft)+m*Ft,b,x),Kt=qe,Xt=(xe+1)/O,mr=ye(p*(1-Xt)+m*Xt,b,x),Qr=o?(Math.PI/2-2*Math.atan(Math.exp(-mr/T)))*T:mr*S,Er=ye(Xt,Q,q);qe=Ne,Ne=Qr;const xr=ye(h,y,_);let Fr=xr*S,$e=Xi(xr,ke,s);const He=1/O,ct=ye(He,Z,te),Tt=ye(h*(1-ct)+f*ct,y,_);let jt=ct,zr=Tt,Tr=Tt*S,Mr=Xi(Tt,ke,s);if(xe===1){const Pr=Tr-N,Mi=qe-F,er=Mr-H,gr=0*K;X[gr]=Pr,X[gr+1]=Mi,X[gr+2]=er,sl(Pr,Mi,er,L);const hr=ye(He,Z,te);Fc(V,W,hr,wt)}for(let Pr=1;Pr<=R;Pr++){const Mi=Tr,er=Mr,gr=(Pr+1)/O,hr=ye(gr,Z,te),ms=ye(h*(1-gr)+f*gr,y,_),ai=zr;zr=ms;{const Cs=W+1,Ji=Cs*K;if(xe===1||Pr===R){const Qi=ms*S,As=Xi(ms,ke,s);if(xe===1&&Pr<R){const li=Qi-N,Go=et-F,ul=As-H;X[Ji]=li,X[Ji+1]=Go,X[Ji+2]=ul,sl(li,Go,ul,L),Fc(V,Cs,hr,wt)}Tr=Qi,Mr=As}else Tr=X[Ji]+N,Mr=X[Ji+2]+H}const Zi=Tr,yi=Mr,Gi=Fr,gs=$e;Fr=Mi,$e=er;const Bs=(W-R)*K,vo=xe===1?Xi(ai,Wt,s):X[Bs+2]+H,Xn=Xi(ai,mr,s);if(xe<R){const Cs=W+R,Ji=Cs*K,Qi=Mi-N,As=Qr-F,li=Xn-H;X[Ji]=Qi,X[Ji+1]=As,X[Ji+2]=li,sl(Qi,As,li,L);const Go=jt;jt=hr,Fc(V,Cs,Go,Er)}{const Cs=Zi-Gi,Ji=Kt-Qr,Qi=Ji*(yi-gs),As=Cs*(vo-Xn),li=-Ji*Cs,Go=Qi*Qi+As*As+li*li;if(Go===0)GM(G,W,0,0,1);else{const ul=1/Math.sqrt(Go);GM(G,W,Qi*ul,As*ul,li*ul)}}++W}}}function qft(e,t){e.tile.intersectsClippingArea&&(wEe(e),bEe(e,!0),i8(e))}function Wft(e,t){e.tile.intersectsClippingArea&&(vEe(e),i8(e))}function vEe(e,t){e.tile.intersectsClippingArea&&(wEe(e),bEe(e,!1))}function bEe(e,t){const r=e.geometryState,i=r.neighborData,s=e.tile,n=s.surface,o=n.shading||dx,a=s.extent,l=r.clippingArea,c=v(l)?l:s8,h=a[0],p=a[2],f=a[1],m=a[3],y=[m>c[3],p>c[2],f<c[1],h<c[0]],_=e.geometryInfo,b=s.horizontalScale,x=XQ(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,b),T=_.boundingBox,S=_.uvRange[0],C=_.uvRange[1],O=_.uvRange[2],R=_.uvRange[3],$=Math.max(h,c[0]),I=Math.min(p,c[2]),U=Math.max(f,c[1]),V=Math.min(m,c[3]),G=e.localOrigin,z=G[0],Z=G[1],Q=G[2],te=r.samplerData;for(let q=0;q<4;++q){const L=q===1||q===3,N=i.edgeResolutions[q];Re(Rp(N));const F=N+1,H=y[q],X=jb(s,i.edgePeerNeighbors[q]);if(!H&&CEe(s,X,q)){SEe(e,q,X);continue}const K=v(X)&&!H,W=X==null?void 0:X.renderData,ue=W==null?void 0:W.geometryState;if(On&&(Re(!K||X.level===s.level),Re(!K||uy(s,X)<=0),s&&!X&&!n.updatingRootTiles)){const wt=im[q],et=s.findNeighborTile(wt,Ft=>Ft.isLoaded||Ft.isLeaf||Ft.level===s.level);n.updatingRootTiles||(et?et.intersectsClippingArea&&(Re(!et.isLoaded),Re(!et.isLeaf),Re(et.level===s.level)):Re(E(n==null?void 0:n.rootTiles)||!s.shouldHaveNeighbor(wt)))}const pe=ye(q===1?p:h,$,I),we=ye(q===0?m:f,U,V),Ce=ue==null?void 0:ue.samplerData,qe=_.outerEdges[q],Ne=t&&F>3?F-3:1,xe=ye(q===1?1:0,S,O),Fe=ye(q===0?1:0,C,R),ke=K?(wt,et)=>.5*(Xi(wt,et,Ce)+Xi(wt,et,te)):(wt,et)=>Xi(wt,et,te);if(o){const wt=(p-h)/N,et=L?q===1?wt:-wt:0,Ft=L?0:q===0?wt:-wt,Wt=-et,Kt=-Ft;let Xt=0,mr=0,Qr=0;{const $e=0/N,He=L?pe:ye(h*(1-$e)+p*$e,$,I),ct=L?ye(f*(1-$e)+m*$e,U,V):we,Tt=ke(He,ct);Xt=He*b,mr=x(ct),Qr=Tt}let Er=0,xr=0,Fr=0;{const $e=1/N,He=L?pe:ye(h*(1-$e)+p*$e,$,I),ct=L?ye(f*(1-$e)+m*$e,U,V):we,Tt=ke(He,ct);Er=He*b,xr=x(ct),Fr=Tt}for(let $e=1;$e<F-1;$e+=Ne){const He=$e/N,ct=Er,Tt=xr,jt=Fr;{const ai=L?xe:ye(He,S,O),Zi=L?ye(He,C,R):Fe,yi=ct-z,Gi=Tt-Z,gs=jt-Q;sl(ct,Gi,gs,T),qe.setVertexFromValuesRawPositionUV($e,yi,Gi,gs,ai,Zi)}{const ai=($e+1)/N,Zi=L?pe:ye(h*(1-ai)+p*ai,$,I),yi=L?ye(f*(1-ai)+m*ai,U,V):we,Gi=ke(Zi,yi);Er=Zi*b,xr=x(yi),Fr=Gi}const zr=Er,Tr=Fr,Mr=Xt,Pr=mr,Mi=Qr;Xt=ct,mr=Tt,Qr=jt;let er=0,gr=0,hr=0;if(L){const ai=xr-Tt,Zi=Tr-jt,yi=Pr-Tt,Gi=Mi-jt,gs=ye(f*(1-He)+m*He,U,V),Bs=pe+Wt,vo=Bs*b-ct,Xn=Xi(Bs,gs,te)-jt,Cs=q===3?-1:1;if(er=Cs*(-yi+ai)*Xn,gr=Cs*vo*(-Gi+Zi),hr=-Cs*vo*(-yi+ai),K){const Ji=pe+et,Qi=Ji*b-ct;er=(-yi+ai)*(Xn-(Xi(Ji,gs,Ce)-jt)),gr=(vo-Qi)*(-Gi+Zi),hr=-(vo-Qi)*(-yi+ai)}}else{const ai=zr-ct,Zi=Tr-jt,yi=Mr-ct,Gi=Mi-jt,gs=ye(h*(1-He)+p*He,$,I),Bs=we+Kt,vo=Xi(gs,Bs,te)-jt,Xn=x(Bs)-Tt,Cs=q===2?-1:1;if(er=Cs*Xn*(-Gi+Zi),gr=Cs*(-yi+ai)*vo,hr=-Cs*Xn*(-yi+ai),K){const Ji=gs,Qi=we+Ft,As=x(Qi)-Tt;er=(-Xn+As)*(-Gi+Zi),gr=(-yi+ai)*(-vo+(Xi(Ji,Qi,Ce)-jt)),hr=-(-Xn+As)*(-yi+ai)}}const ms=1/Math.sqrt(er*er+gr*gr+hr*hr);qe.setNormalFromValues($e,er*ms,gr*ms,hr*ms)}}else for(let wt=1;wt<F-1;wt+=Ne){const et=wt/N,Ft=L?pe:ye(h*(1-et)+p*et,$,I),Wt=L?ye(f*(1-et)+m*et,U,V):we,Kt=L?xe:ye(et,S,O),Xt=L?ye(et,C,R):Fe,mr=ke(Ft,Wt),Qr=Ft*b-z,Er=x(Wt)-Z,xr=mr-Q;sl(Qr,Er,xr,T),qe.setVertexFromValuesRawPositionUV(wt,Qr,Er,xr,Kt,Xt)}}}function wEe(e,t){EEe(e)}function Xft(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function Yft(e,t){return e*t}function XQ(e,t,r){return e?i=>Xft(i,t):i=>Yft(i,r)}function xEe(e,t,r,i,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,i[1])-Math.max(1,i[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=im.map((S,C)=>C===0&&s[1]<t-2||C===1&&i[1]<t-2||C===2&&s[0]>1||C===3&&i[0]>1),h=e.outerEdges.reduce((S,C,O)=>S+(c[O]?0:o-2+C.count-1),0),p=r.reduce((S,C)=>S+o*(2*(C.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+h+p)*f,y=a>=$ft?new Uint32Array(m):new Uint16Array(m);let _=0;const b=t-2,x=o-2;Re(x>=0);const T=(S,C,O,R,$,I)=>{const U=S*$,V=I[U],G=I[U+1],z=I[U+2],Z=C*$,Q=I[Z],te=I[Z+1],q=I[Z+2],L=O*$,N=I[L],F=I[L+1],H=I[L+2],X=R*$,K=I[X],W=I[X+1],ue=I[X+2];return(Q-K)*(Q-K)+(te-W)*(te-W)+(q-ue)*(q-ue)>(V-N)*(V-N)+(G-F)*(G-F)+(z-H)*(z-H)};if(n){const S=(O,R,$)=>{y[_++]=O,y[_++]=R,y[_++]=R,y[_++]=$,y[_++]=$,y[_++]=O,On&&(Re(O<a),Re(R<a),Re($<a),Re(_<=m))};(()=>{for(let O=Math.max(s[0],1)-1;O<Math.min(s[1],t-2)-1;++O){const R=O*b;for(let $=Math.max(i[0],1)-1;$<Math.min(i[1],t-2)-1;++$){const I=O*b+$,U=I+1,V=U+b,G=V-1,z=R+$,Z=z+1,Q=Z+b,te=Q-1,q=e.vertexAttributes.position.typedBuffer,L=e.vertexAttributes.position.typedBufferStride;T(z,Z,Q,te,L,q)?(S(I,U,V),S(V,G,I)):(S(I,U,G),S(G,V,U))}}})(),Re(_===3*l*f),(()=>{for(let O=0;O<4;++O){const R=_;if(c[O])continue;const $=e.outerEdges[O],I=e.innerEdges[O];let U=0,V=0;const G=$.count,z=I.count;Re(z===o-1);let Z=0;const Q=O===1||O===2?(te,q,L)=>S(te,q,L):(te,q,L)=>S(te,L,q);for(;U<G-1||V<z-1;){const te=I.getVertexIndex(V),q=$.getVertexIndex(U),L=U<G-1,N=V<z-1;L&&(!N||(L?0+o*(U+.5)/(G-1):0)<=(N?1+x*(V+.5)/(z-1):0))?(++U,On&&Re(U<G),Q(te,q,$.getVertexIndex(U)),Z++):(++V,On&&Re(V<z),Q(te,q,I.getVertexIndex(V)),Z++)}On&&(Re(U===G-1),Re(V===z-1),Re(Z===G+z-2),Re(Z===o-2+$.count-1),Re(_===R+3*Z*f))}})(),Re(_===3*(l+h)*f);const C=O=>{const R=e.outerEdges[O.connectedOuterEdgeOffset];let $=R.getVertexIndex(0),I=R.stride;for(let U=0;U<O.latitudeResolution;++U){const V=U===0?O.rowOffset:$+t;for(let G=0;G<o;G++)S($,$+1,V+G),U<O.latitudeResolution-1&&S($+1,V+G+1,V+G),$+=I;$=V,I=1}};r.forEach(C)}else{(()=>{const C=Math.max(s[0],1)-1,O=Math.min(s[1],t-2)-1,R=Math.max(i[0],1)-1,$=Math.min(i[1],t-2)-1;for(let I=C;I<O;++I){const U=I*b;for(let V=R;V<$;++V){const G=U+V,z=G+1,Z=z+b,Q=Z-1,te=e.vertexAttributes.position.typedBuffer,q=e.vertexAttributes.position.typedBufferStride;T(G,z,Z,Q,q,te)?(y[_]=G,y[_+1]=z,y[_+2]=Z,y[_+3]=Z,y[_+4]=Q,y[_+5]=G):(y[_]=G,y[_+1]=z,y[_+2]=Q,y[_+3]=Q,y[_+4]=z,y[_+5]=Z),_+=6}}})(),Re(_===3*l*f),(()=>{for(let C=0;C<4;++C){if(c[C])continue;const O=e.outerEdges[C],R=e.innerEdges[C];let $=0,I=0;const U=O.count,V=R.count;Re(V===o-1);const G=C===1||C===2,z=G?1:2,Z=G?2:1,Q=O.index0,te=O.stride,q=R.index0,L=R.stride;for(;$<U-1||I<V-1;){const N=q+I*L,F=Q+$*te,H=$<U-1,X=I<V-1,K=H&&(!X||(H?0+o*($+.5)/(U-1):0)<=(X?1+x*(I+.5)/(V-1):0));K?++$:++I;const W=K?F+te:N+L;y[_]=N,y[_+z]=F,y[_+Z]=W,_+=3}}})(),Re(_===3*(l+h)*f);const S=C=>{const O=e.outerEdges[C.connectedOuterEdgeOffset];let R=O.getVertexIndex(0),$=O.stride;for(let I=0;I<C.latitudeResolution;++I){const U=I===0?C.rowOffset:R+t;for(let V=0;V<o;V++){const G=U+V;y[_]=R,y[_+1]=R+1,y[_+2]=G,I<C.latitudeResolution-1?(y[_+3]=R+1,y[_+4]=G+1,y[_+5]=G,_+=6):_+=3,R+=$}R=U,$=1}};r.forEach(S)}Re(_===m),e.indices=y,e.indexCount=m}function TEe(e,t){const r=e.localOrigin,i=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new fce(o,r,h,p,n)}{const c=a,h=s[l]+1;i.outerEdges[l]=new fce(o,r,c,1,h),a+=h}}}function SEe(e,t,r){const i=(t+2)%4,s=e.geometryState,n=e.tile,o=s.neighborData,a=n.level-r.level,l=t===1||t===3,c=o.edgeResolutions[t];Re(Rp(c));const h=c+1,p=e.geometryInfo,f=p.boundingBox,m=p.outerEdges[t],y=p.uvRange[0],_=p.uvRange[1],b=p.uvRange[2],x=p.uvRange[3],T=ye(t===1?1:0,y,b),S=ye(t===0?1:0,_,x),C=r.renderData,O=C.geometryState,R=C.geometryInfo.outerEdges[i],$=n.getNeighborEdgeStartVertexIndex(t,r)*c,I=c*2**a;Re(O.neighborData.edgeResolutions[i]===I),Re(R.count-1===I);const U=C.localOrigin[0]-e.localOrigin[0],V=C.localOrigin[1]-e.localOrigin[1],G=C.localOrigin[2]-e.localOrigin[2],z=m.attributes,Z=m.index0,Q=m.stride,te=z.position.typedBuffer,q=z.position.typedBufferStride,L=z.normalCompressed.typedBuffer,N=z.normalCompressed.typedBufferStride,F=z.uv0,H=R.attributes,X=R.index0,K=R.stride,W=H.position.typedBuffer,ue=H.position.typedBufferStride,pe=H.normalCompressed.typedBuffer,we=H.normalCompressed.typedBufferStride;for(let Ce=1;Ce<h-1;++Ce){const qe=Z+Q*Ce,Ne=X+K*($+Ce),xe=qe*q,Fe=Ne*ue,ke=W[Fe]+U,wt=W[Fe+1]+V,et=W[Fe+2]+G;te[xe]=ke,te[xe+1]=wt,te[xe+2]=et,sl(ke,wt,et,f);const Ft=qe*N,Wt=Ne*we;L[Ft]=pe[Wt],L[Ft+1]=pe[Wt+1];const Kt=Ce/c,Xt=l?T:ye(Kt,y,b),mr=l?ye(Kt,_,x):S;Fc(F,qe,Xt,mr)}}function EEe(e){var Fe;const t=e.geometryState,r=t.neighborData,i=e.localOrigin,s=r.cornerNeighborData,n=e.geometryInfo,o=n.outerEdges,a=n.boundingBox,l=e.tile,c=((Fe=e.tile.surface.view)==null?void 0:Fe.viewingMode)==="local",h=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let m=0,y=0,_=0;const b=(ke,wt,et)=>{const Ft=p[wt===0?1:3],Wt=p[ke===0?0:2],Kt=Math.cos(Ft),Xt=Math.sin(Ft),mr=Math.sin(Wt),Qr=Math.cos(Wt),Er=h+et;m=Qr*Kt*Er,y=mr*Kt*Er,_=Xt*Er},x=c?(()=>{const ke=e.geometryState.clippingArea,wt=l.extent,et=v(ke)&&(wt[3]>ke[3]||wt[2]>ke[2]||wt[1]<ke[1]||wt[0]<ke[0]),Ft=XQ(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Wt,Kt,Xt)=>{const mr=Wt===0?Z[0]:Z[2],Qr=Kt===0?Z[1]:Z[3],Er=et?ye(mr,ke[0],ke[2]):mr,xr=et?ye(Qr,ke[1],ke[3]):Qr,Fr=Xt;m=Er*f,y=Ft(xr),_=Fr}})():b;let T=0,S=0,C=0,O=0,R=0,$=0,I=0,U=0,V=0;const G=c&&e.tile.surface.isWebMercatorOnPlateeCarree,z=(ke,wt,et,Ft,Wt)=>{let Kt=0,Xt=0,mr=0;if(c){const Qr=wt*f,Er=G?(Math.PI/2-2*Math.atan(Math.exp(-et/h)))*h:et*f;Kt=Qr-m,Xt=Er-y,mr=Ft-_}else{const Qr=WQ(ke),Er=ke.tile,xr=Er.extent,Fr=Er.extentInRadians,$e=(wt-xr[0])/(xr[2]-xr[0]),He=(et-xr[1])/(xr[3]-xr[1]),ct=Fr[0]*(1-$e)+Fr[2]*$e,Tt=Qr(He),jt=Math.cos(Tt),zr=Math.sin(Tt),Tr=Math.sin(ct),Mr=Math.cos(ct),Pr=h+Ft;Kt=Mr*jt*Pr-m,Xt=Tr*jt*Pr-y,mr=zr*Pr-_}switch(Wt){case 0:I+=Kt,U+=Xt,V+=mr;break;case 1:O-=Kt,R-=Xt,$-=mr;break;case 2:I-=Kt,U-=Xt,V-=mr;break;case 3:O+=Kt,R+=Xt,$+=mr}},Z=l.extent,Q=t.clippingArea,te=v(Q)?Q:s8,q=Z[0],L=Z[2],N=Z[1],F=Z[3],H=[F>te[3],L>te[2],N<te[1],q<te[0]],X=Math.max(q,te[0]),K=Math.min(L,te[2]),W=Math.max(N,te[1]),ue=Math.min(F,te[3]),pe=n.uvRange[0],we=n.uvRange[1],Ce=n.uvRange[2],qe=n.uvRange[3],Ne=l.surface.shading||dx,xe=ke=>{var xr,Fr;const wt=s[ke].cornerTiles;T=0,S=0,C=1;let et=1/0;for(let $e=0;$e<4;++$e)et=Math.min(et,(Fr=(xr=wt[$e])==null?void 0:xr.level)!=null?Fr:1/0);for(let $e=0;$e<4;++$e){const He=wt[$e];WA[$e]=(He==null?void 0:He.level)===et?He:null}let Ft=1,Wt=0;for(let $e=0;$e<4;++$e){const He=WA[$e];He&&(Ft=Math.max(Ft,He==null?void 0:He.renderData.geometryState.numVerticesPerSide),Wt=He.extent[2]-He.extent[0])}const Kt=Wt,Xt=Ft;Re(Xt>1);const mr=Kt/Xt;for(let $e=0;$e<4;++$e){const He=WA[($e+3)%4],ct=WA[$e%4];if(!He&&!ct)continue;const Tt=$e===0?1:$e===1?2:$e===2?3:0,jt=$e===0?2:$e===1?3:$e===2?0:1;if(He&&ct){const zr=hB[$e][0]*mr,Tr=hB[$e][1]*mr,Mr=He.extent,Pr=Mr[Tt===0||Tt===1?2:0]+zr,Mi=Mr[Tt===0||Tt===3?3:1]+Tr,er=ct.extent,gr=er[jt===0||jt===1?2:0]+zr,hr=er[jt===0||jt===3?3:1]+Tr,ms=He.renderData,ai=ct.renderData,Zi=Xi(Pr,Mi,ms.geometryState.samplerData),yi=Xi(gr,hr,ai.geometryState.samplerData);z(ms,Pr,Mi,.5*(Zi+yi),$e)}else{const zr=He!=null?He:ct,Tr=He?Tt:jt,Mr=zr.extent,Pr=hB[$e],Mi=Mr[Tr===0||Tr===1?2:0]+Pr[0]*mr,er=Mr[Tr===0||Tr===3?3:1]+Pr[1]*mr,gr=zr.renderData,hr=Xi(Mi,er,gr.geometryState.samplerData);z(gr,Mi,er,hr,$e)}}if(!c){const $e=Math.sqrt(m*m+y*y+_*_);T=m/$e,S=y/$e,C=_/$e}const Qr=Math.sqrt(O*O+R*R+$*$);O/=Qr,R/=Qr,$/=Qr;const Er=Math.sqrt(I*I+U*U+V*V);if(I/=Er,U/=Er,V/=Er,c||C*C<.999){T=$*U-R*V,S=O*V-$*I,C=R*I-O*U;const $e=1/Math.sqrt(T*T+S*S+C*C);T*=$e,S*=$e,C*=$e}};for(let ke=0;ke<4;++ke){const wt=ke,et=(ke+1)%4,Ft=ke===0||ke===1?1:0,Wt=ke===0||ke===3?1:0,Kt=ye(Ft,pe,Ce),Xt=ye(Wt,we,qe),mr=o[wt],Qr=ke===0||ke===3?mr.count-1:0,Er=o[et],xr=ke===0||ke===1?Er.count-1:0,Fr=s[ke].cornerTiles;let $e=-1;for(let Tt=0;Tt<4;++Tt){const jt=Fr[Tt];jt&&($e===-1||uy(Fr[$e],jt)>0)&&($e=Tt)}const He=$e,ct=Fr[He];if(T=0,S=0,C=1,ct!==l){const Tt=l.level-ct.level,jt=2**Tt,zr=[ct.lij[0]+Tt,ct.lij[1]*jt,ct.lij[2]*jt],Tr=[zr[1]+jt===l.lij[1],ke===0&&(He===1||He===0&&ct!==Fr[3])||ke===1&&(He===0||He===1&&ct!==Fr[2]),zr[1]===l.lij[1]+1,ke===2&&(He===3||He===2&&ct!==Fr[1])||ke===3&&(He===2||He===3&&ct!==Fr[0])],Mr=Tr.reduce((hr,ms)=>hr+(ms?1:0),0);Re(Mr===1||Mr===2);let Pr=-1,Mi=-1;const er=ct.renderData;if(Mr===1){const hr=Tr.findIndex(ai=>ai);Re(0<=hr&&hr<=3),Pr=(hr+2)%4;const ms=e.geometryState.neighborData.edgeResolutions[hr];Mi=l.getNeighborEdgeStartVertexIndex(hr,ct)*ms+ms*(hr===0&&ke===0||hr===1&&ke===0||hr===2&&ke===1||hr===3&&ke===3?1:0)}else{Re(Tr[1]||Tr[3]),Pr=Tr[1]?3:1;const hr=er.geometryState.neighborData.edgeResolutions[Pr];Mi=ke===0||ke===3?0:hr}const gr=er.geometryInfo.outerEdges[Pr];{const hr=mr.index0+Qr*mr.stride,ms=Er.index0+xr*Er.stride,ai=gr.index0+Mi*gr.stride;{const Zi=gr.attributes.position,yi=Zi.typedBuffer,Gi=ai*Zi.typedBufferStride,gs=e.localOrigin,Bs=gr.localOrigin,vo=yi[Gi]+Bs[0]-gs[0],Xn=yi[Gi+1]+Bs[1]-gs[1],Cs=yi[Gi+2]+Bs[2]-gs[2];sl(vo,Xn,Cs,a);{const Ji=mr.attributes.position,Qi=Ji.typedBuffer,As=hr*Ji.typedBufferStride;Qi[As]=vo,Qi[As+1]=Xn,Qi[As+2]=Cs}{const Ji=Er.attributes.position,Qi=Ji.typedBuffer,As=ms*Ji.typedBufferStride;Qi[As]=vo,Qi[As+1]=Xn,Qi[As+2]=Cs}}Fc(mr.attributes.uv0,hr,Kt,Xt),Fc(Er.attributes.uv0,ms,Kt,Xt);{const Zi=gr.attributes.normalCompressed.typedBuffer,yi=ai*gr.attributes.normalCompressed.typedBufferStride;{const Gi=mr.attributes.normalCompressed,gs=Gi.typedBuffer,Bs=hr*Gi.typedBufferStride;gs[Bs]=Zi[yi],gs[Bs+1]=Zi[yi+1]}{const Gi=Er.attributes.normalCompressed,gs=Gi.typedBuffer,Bs=ms*Gi.typedBufferStride;gs[Bs]=Zi[yi],gs[Bs+1]=Zi[yi+1]}}}}else{const Tt=H[wt],jt=H[et];let zr;if(Tt||jt){const Mi=ye(q*(1-Ft)+L*Ft,X,K),er=ye(N*(1-Wt)+F*Wt,W,ue),gr=t.samplerData;zr=Xi(Mi,er,gr)}else zr=Zft(Fr);x(Ft,Wt,zr),(Ne||dx)&&xe(ke);const Tr=m-i[0],Mr=y-i[1],Pr=_-i[2];sl(Tr,Mr,Pr,a),mr.setVertexFromValuesRawPositionUVNormal(Qr,Tr,Mr,Pr,Kt,Xt,T,S,C),Er.setVertexFromValuesRawPositionUVNormal(xr,Tr,Mr,Pr,Kt,Xt,T,S,C)}}for(let ke=0;ke<4;++ke)WA[ke]=null}function Zft(e){var n,o;const t=e.reduce((a,l)=>{var c;return Math.min(a,(c=l==null?void 0:l.level)!=null?c:1/0)},1/0);On&&(Re(!e[0]||!e[2]||Cq(e[0],e[2],At.SOUTH_WEST)),Re(!e[1]||!e[3]||Cq(e[1],e[3],At.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=e[a];if(l&&l.level===t){const c=a===0||a===1,h=a===0||a===3,p=l.extent,f=p[c?0:2],m=p[h?1:3],y=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;i+=Xi(f,m,y),r++}}const s=r?i/r:0;return Re(s!=null),s}function i8(e){const t=e.vao,r=e.geometryInfo.vertexAttributes.position.typedBuffer;t.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const hB=[[0,1],[1,0],[0,-1],[-1,0]],hn=new Ipt,s8=gX(-1/0,-1/0,1/0,1/0),WA=[null,null,null,null];function CEe(e,t,r){if(!t)return!1;const i=uy(e,t);return i>0||i===0&&r>=2}const dx=!0;class Jft extends GQ{get horizontalScale(){return this._horizontalScaleFactor}constructor(t,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=ur(),t!==void 0&&this.init(t,r,i)}init(t,r,i){super.init(t,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=v(s)&&jW(s)&&v(n)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const h=Le(c[0],c[1],0);mo(h,Ye.WebMercator,h,Ye.PlateCarree);const p=Le(c[2],c[3],0);mo(p,Ye.WebMercator,p,Ye.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this._extentInRenderSR,r=.5*(t[2]-t[0]),i=.5*(t[3]-t[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[ln.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(t){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let h=0;h<6;h++){const p=t[h],f=p[0],m=p[1],y=p[2],_=p[3];if(f*(f>0?i:o)+m*(m>0?s:a)+y*(y>0?n:l)+_>=0)return ya.OUTSIDE;c=c&&f*(f<0?i:o)+m*(m<0?s:a)+y*(y<0?n:l)+_<=0}return c?ya.INSIDE:ya.INTERSECTS}_aabb(){const t=this._extentInRenderSR;return TPe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,r,i,s){return IL[0]=1/r[0],IL[1]=1/r[1],IL[2]=1/r[2],jJ(this._aabb(),t,IL,i,s)}createGeometry(){zft(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){qft(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){Wft(this.renderData,this._horizontalScaleFactor)}}const IL=M();class Qft{constructor(){this.extent=sr(),this.minLevel=0,this.maxLevel=0,this.callback=null}}let $N=class extends Te{constructor(){super(...arguments),this._queries=new Jt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Jt({initialSize:30}),this._queryPool=new An(Qft)}queryVisibleLevelRange(e,t,r,i){const s=this._queryPool.acquire();cp(s.extent,e),s.minLevel=t!=null?t:-Number.MAX_VALUE,s.maxLevel=r!=null?r:Number.MAX_VALUE,s.callback=i,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const t=e.level;let r=0;for(;r<this._queriesInvPtr;){const i=this._queries.data[r],s=i.extent;t>=i.minLevel&&t<=i.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};u([d()],$N.prototype,"updating",null),$N=u([P("esri.views.3d.terrain.ScaleRangeQueries")],$N);class Kft extends GQ{get convexHull(){return this._convexHull}constructor(t,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=pn(),t!==void 0&&this.init(t,r,i)}init(t,r,i){super.init(t,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=Nt(o,l,.5),p=Nt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),$Le(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=kl(this.centerAtSeaLevel);ve(m,m),this.up=m,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const t=this._center;if(this.lij[0]===0)ce(t[ln.MIDDLE],0,0,0),ce(t[ln.TOP],0,0,0),ce(t[ln.BOTTOM],0,0,0),t[ln.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=t[ln.MIDDLE],i=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,emt(r,i,3*n));t[ln.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(t){if(!H_(t,this._boundingSphere))return ya.OUTSIDE;if(this.lij[0]<10)return ya.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<vv.NUM;n++){const o=n===Si.NEAR,a=t[n],l=a[0],c=a[1],h=a[2],p=a[3]-(o?i:0);let f=!1;for(let m=0;m<8;++m){const y=3*m;if(l*r[y+0]+c*r[y+1]+h*r[y+2]+p<0){if(f=!0,!s)break}else s=!1}if(!f)return ya.OUTSIDE}return s?ya.INSIDE:ya.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){Lft(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),On&&this._checkBVs()}_updateBoundingSphere(){const t=this._boundingSphere,r=t,i=this.elevationBounds,s=this.ellipsoid.radius,n=i[1];if(this.level===0)ce(r,0,0,0),t[3]=s+n;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];R1(Mce,a,l,s),R1(Pce,a,c,s),me(r,Mce,Pce);const h=.5*(i[0]+i[1]);ae(r,r,(s+h)/_c(r));const p=this.convexHull;let f=0;const m=(_,b)=>{const x=_[0]-p[3*b+0],T=_[1]-p[3*b+1],S=_[2]-p[3*b+2];return Math.sqrt(x*x+T*T+S*S)};for(let _=0;_<8;++_){const b=m(r,_);f=Math.max(f,b)}const y=f;t[3]=y+2}}_updateConvexHull(){const t=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,o=n&&s===Lh.HAS_NORTH_POLE,a=n&&s===Lh.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,h=t[0],p=t[2],f=a?-c:t[1],m=o?c:t[3],y=.5*(h+p),_=i[0],b=r+(l?Math.min(0,_-1):_),x=(q,L,N)=>R1(q,L,N,b),T=M(),S=M(),C=M(),O=M();x(T,h,f),x(S,h,m),x(C,p,m),x(O,p,f);const R=(q,L)=>{for(let N=0;N<3;++N)this._convexHull[3*L+N]=q[N]};R(T,0),R(S,1),R(C,2),R(O,3);const $=i[1],I=r+(l?Math.max(0,$+1):$),U=M(),V=M(),G=M();R1(V,y,m,b),R1(G,y,f,b),me(U,V,G),ve(U,U);const z=M(),Z=M(),Q=(q,L)=>{lo(Z,q,L),ve(Z,Z);const N=-_e(q,z)/_e(Z,z);Re(N>=0),ae(Z,Z,N),me(q,q,Z)};if(2**this.lij[0]>2*this.lij[1]){const q=G,L=M();dt(L,Oce,q),ve(L,L),dt(z,q,L),ve(z,z),Re(Dh(_e(z,q)/_c(q),0)),Q(T,S),Q(O,C),R(T,0),R(O,3)}else if(2**this.lij[0]!==2*this.lij[1]){const q=V,L=M();dt(L,Oce,q),ve(L,L),dt(z,L,q),ve(z,z),Q(S,T),Q(C,O),R(S,1),R(C,2)}const te=(q,L)=>{const N=I/_e(L,U);for(let F=0;F<3;++F)this._convexHull[3*q+F]=L[F]*N};te(4,T),te(5,S),te(6,C),te(7,O)}_getPatchType(){const t=this.lij[1],r=t===0,i=t===(1<<this.level)-1;return r?i?Lh.HAS_BOTH_POLES:Lh.HAS_NORTH_POLE:i?Lh.HAS_SOUTH_POLE:Lh.REGULAR}intersectsRay(t,r,i,s){const n=this._boundingSphere,o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*r[0]+c*r[1]+h*r[2])/a,f=r[0]*p-l,m=r[1]*p-c,y=r[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<Rce.length?Rce[this.level]+1:2}updateCornerElevations(){kft(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){Uft(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var ue;if(!On||this.level<=2)return;const t=this._boundingSphere,r=t[3],i=t,s=M(),n=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=n+o[0],l=1,c=0,h=this._center[ln.MIDDLE][3],p=this.convexHull,f=(pe,we)=>{for(let Ce=0;Ce<3;++Ce)pe[Ce]=p[3*we+Ce]};{const pe=M(),we=M(),Ce=M(),qe=M(),Ne=M(),xe=(Fe,ke,wt,et)=>{f(we,Fe),f(Ce,ke),f(qe,wt),lo(we,we,Ce),lo(qe,qe,Ce),dt(pe,we,qe),ve(pe,pe);const Ft=_e(pe,Ce);f(Ne,et);const Wt=_e(pe,Ne),Kt=Math.abs(Wt-Ft);Re(Dh(Kt,0),`Non coplanar ${Fe},${ke},${wt},${et} diff = ${Kt}`)};xe(0,1,2,3),xe(4,5,6,7),xe(0,1,4,5),xe(1,2,5,6),xe(2,3,6,7),xe(3,0,7,4)}const m=Bc(24),y=(pe,we,Ce)=>{const qe=4*pe;for(let Ne=0;Ne<3;++Ne)m[qe+Ne]=we[Ne];m[qe+3]=Ce},_=M(),b=M(),x=M(),T=M(),S=(pe,we,Ce,qe)=>{f(_,we),f(b,Ce),f(x,qe),lo(_,_,b),ve(_,_),lo(x,x,b),ve(x,x),dt(T,_,x),ve(T,T);const Ne=_e(T,b);y(pe,T,Ne)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const C=1,O=(pe,we,Ce,qe)=>{const Ne=4*pe;return m[Ne+0]*we+m[Ne+1]*Ce+m[Ne+2]*qe-m[Ne+3]},R=(pe,we,Ce,qe)=>O(pe,we,Ce,qe)>=-C,$=(pe,we)=>R(pe,we[0],we[1],we[2]),I=2**this.lij[0]>2*this.lij[1],U=(pe,we,Ce)=>Math.sqrt(AEe(pe,we,Ce,i[0],i[1],i[2]))<r,V=pe=>U(pe[0],pe[1],pe[2]),G=(pe,we)=>U(pe[we+0],pe[we+1],pe[we+2]),z=this.extentInRadians,Z=.5*(z[0]+z[2]),Q=z[1],te=z[3],q=M(),L=M();R1(q,Z,te,a),R1(L,Z,Q,a);const N=I?"Upper":"Lower";let F=!0;for(let pe=0;pe<6;++pe){for(let we=0;we<8;++we){const Ce=3*we,qe=R(pe,p[Ce+0],p[Ce+1],p[Ce+2]);F&&(F=qe),Re(qe,`Tile[${this.lij}] Convex hull point ${we} outside of plane ${pe}`)}Re($(pe,L),`Tile[${this.lij}] (${N}) bottom mid outside of plane ${pe}`),Re($(pe,q),`Tile[${this.lij}] (${N}) top mid outside of plane ${pe}`)}Re(F,"Not all convex hull points are inside  convex hull polyhedron"),Re(V(L),`Tile[${this.lij}] (${N}) bottom mid outside of bounding sphere`),Re(V(q),`Tile[${this.lij}] (${N}) top mid outside of bounding sphere`);for(let pe=0;pe<8;++pe){const we=G(p,3*pe);Re(we,`Tile[${this.lij}] Convex hull point ${pe} outside of bounding sphere`)}for(let pe=0;pe<6;++pe)for(let we=0;we<8;++we){const Ce=3*we;R(pe,p[Ce+0],p[Ce+1],p[Ce+2])||console.error(`Tile[${this.lij}] Convex hull point ${we} outside of plane ${pe}`)}const H=this.extentInRadians,X=Math.max(H[2]-H[0],H[3]-H[1]),K=Math.round(X*n),W=this.renderData;if(W){const pe=W.geometryInfo,we=W.localOrigin,Ce=(ue=pe.vertexAttributes)==null?void 0:ue.position;if(!Ce)return;const qe=Ce.count,Ne=M(),xe=pe.numVerticesPerSide-2,Fe=xe*xe,ke=W.geometryState.neighborData,wt=ke.edgeResolutions.reduce((et,Ft)=>et+Ft+1,0);for(let et=0;et<qe;++et){const Ft=et<Fe,Wt=!Ft&&et<Fe+wt;let Kt=!1,Xt=-1;if(Wt){let er=Fe;for(let gr=0;gr<4;++gr){const hr=ke.edgeResolutions[gr];if(et===er||et===er+hr-1){Kt=!0;break}if(er+=hr,et<er){Xt=gr;break}}}const mr=Xt,Qr=Kt,Er=Wt&&!Qr,xr=Wt?ke.edgePeerNeighbors[mr]:null,Fr=Wt&&xr&&uy(this,xr)>0,$e=Ft?"internal":Er?"edge":Qr?"corner":"pole";Ce.getVec(et,s),me(Ne,s,we);const He=_c(Ne)-n;let ct=0,Tt=!1;const jt=o[0]-He,zr=He-o[1],Tr=jt>l,Mr=zr>l,Pr=Tr||Mr,Mi=`Tile[${this.lij}].vertex[${et}]:${$e}`+(Tr?"(below)":Mr?"(above)":"")+(Fr?"(Neighbor)":"");{const er=QM(Ne,i);if(er>=r+c){const gr=er-r;Pr||(console.error(`${Mi} is out of the bounding sphere by ${gr.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${He.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(gr/r).toFixed(0)})`),Tt=!0)}}for(let er=0;er<6;++er)if(!R(er,Ne[0],Ne[1],Ne[2])){const gr=O(er,Ne[0],Ne[1],Ne[2]),hr=et%xe,ms=(et-hr)/xe;er===0&&jt||er===5&&zr||(console.error(`${Mi} (${hr},${ms})|${xe}] is out of the bounding trapezoid plane ${er} h=${Math.round(He)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(gr)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${K}`),++ct)}if(Tt||ct>0)break}}}}const Rce=[128,64,64,32,16,8,8,4];function emt(e,t,r){return AEe(e[0],e[1],e[2],t[r+0],t[r+1],t[r+2])}function AEe(e,t,r,i,s,n){const o=i-e,a=s-t,l=n-r;return o*o+a*a+l*l}const R1=(e,t,r,i)=>{const s=Math.cos(t),n=Math.sin(t),o=Math.cos(r),a=Math.sin(r);e[0]=i*o*s,e[1]=i*o*n,e[2]=i*a},Oce=[0,0,1],Mce=M(),Pce=M();class tmt{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class REe extends $a{constructor(){super(...arguments),this.blendMode=Ue.Normal}}u([B({count:Ue.COUNT})],REe.prototype,"blendMode",void 0);class hS extends REe{constructor(){super(...arguments),this.output=Vn.Composite,this.baseOpacityMode=vp.NotRequired,this.premultipliedSource=tp.Off,this.hasWebGL2Context=!1}}u([B({count:Vn.COUNT})],hS.prototype,"output",void 0),u([B({count:vp.COUNT})],hS.prototype,"baseOpacityMode",void 0),u([B()],hS.prototype,"premultipliedSource",void 0),u([B()],hS.prototype,"hasWebGL2Context",void 0);var px;function rmt(e){const t=new Lr;if(t.include(uEe),e.background===px.Only){const r=e.output===Vn.ColorComposite;return r?t.fragment.uniforms.add(new qt("backgroundColor",i=>i.backgroundColor)):(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(zQ)),t.fragment.code.add(w`
    void main() {
      gl_FragColor = vec4(${r?w`backgroundColor`:w`gridColor(uv)`}, 1.0);
    }
  `),t}return t.include(hEe,e),t.fragment.uniforms.add(new Mt("tex",r=>r.texture)),t.fragment.uniforms.add(new Pe("opacity",r=>r.opacity)),t.fragment.code.add(w`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),t}(function(e){e[e.BelowLayer=0]="BelowLayer",e[e.Only=1]="Only",e[e.COUNT=2]="COUNT"})(px||(px={}));const imt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return px},build:rmt},Symbol.toStringTag,{value:"Module"}));class smt extends cEe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Sa}}class n8 extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2}initializeProgram(t){return new Nr(t.rctx,n8.shader.get().build(this.configuration),Or)}initializePipeline(){return Vt({blending:Vp(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:Qt})}}n8.shader=new Dr(imt,()=>ie(()=>import("./BlendLayers.glsl.31016586.js"),[]));class OEe extends hS{constructor(){super(...arguments),this.background=px.BelowLayer}}u([B()],OEe.prototype,"background",void 0);class dB{constructor(t,r,i,s,n,o){this.texture=t,this.type=r,t.retain(),this.offsetAndScale=Ht(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Le(s,n,o)}destroy(){this.texture.release()}}function LN(){return[1,0,0,1,0,0]}function nmt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function omt(e,t,r,i,s,n){return[e,t,r,i,s,n]}function amt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:nmt,create:LN,createView:amt,fromValues:omt},Symbol.toStringTag,{value:"Module"}));function lmt(e){return e instanceof Float32Array&&e.length>=2}function cmt(e){return Array.isArray(e)&&e.length>=2}function pB(e){return lmt(e)||cmt(e)}const umt=96,hmt=39.37;function YQ(e,t){return t.type?or(e,t.x,t.y):qn(e,t)}function dmt(e){return ll(e)}function pmt(e,t){const r=e.targetGeometry,i=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const fmt=function(){const e=Ke();return function(t,r,i){const s=r.targetGeometry;YQ(e,s);const n=.5*o8(r);return t.xmin=e[0]-n*i[0],t.ymin=e[1]-n*i[1],t.xmax=e[0]+n*i[0],t.ymax=e[1]+n*i[1],t.spatialReference=s.spatialReference,t}}();function o8(e){return e.scale*mmt(e.targetGeometry)}function mmt(e){return v(e)&&Ta(e.spatialReference)?1/(dmt(e.spatialReference)*hmt*umt):1}function gmt(e){return T5(e.rotation)||0}const ZQ=function(){const e=Ke(),t=Ke(),r=Ke();return function(i,s,n,o,a,l){return DZ(e,s),Ac(t,n,.5*l),or(r,1/o*l,-1/o*l),AZ(i,t),a&&EZ(i,i,a),E1e(i,i,r),CZ(i,i,e),i}}(),ymt=function(){const e=Ke();return function(t,r,i,s){const n=o8(r),o=gmt(r);return YQ(e,r.targetGeometry),ZQ(t,e,i,n,o,s)}}(),_mt=function(){const e=Ke();return function(t,r,i,s){const n=o8(r);return YQ(e,r.targetGeometry),ZQ(t,e,i,n,0,s)}}();function vmt(e){const t=Z_(e);return t?t.valid[1]-t.valid[0]:0}function bmt(e,t){return Math.round(vmt(e)/t)}var Rq;const ag=[0,0];let a_=Rq=class extends fe{constructor(e){super(e),this._viewpoint2D={center:Ke(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new qr,this.id=0,this.inverseTransform=LN(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=LN(),this.transformNoRotation=LN(),this.displayMat3=Wl(),this.displayViewMat3=Wl(),this.viewMat3=Wl(),this.viewMat2d=w1e(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,r=e.targetGeometry;t.center[0]=r.x,t.center[1]=r.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=r.spatialReference}this._update()}copy(e){const t=this.size,r=this.viewpoint;return r&&t?(this.viewpoint=pmt(r,e.viewpoint),this._set("size",qn(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new Rq({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,r){return pB(t)?pb(e,t,this.inverseTransform):(ag[0]=t,ag[1]=r,pb(e,ag,this.inverseTransform))}toScreen(e,t,r){return pB(t)?pb(e,t,this.transform):(ag[0]=t,ag[1]=r,pb(e,ag,this.transform))}toScreenNoRotation(e,t,r){return pB(t)?pb(e,t,this.transformNoRotation):(ag[0]=t,ag[1]=r,pb(e,ag,this.transformNoRotation))}getScreenTransform(e,t){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return ZQ(e,r,s,t,0,i),e}_update(){const{center:e,spatialReference:t,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Uc({targetGeometry:new yt(e[0],e[1],t),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!t||!r)return;this.resolution=o8(o),this.rotation=i,this.scale=r,this.spatialReference=t,qn(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;XZ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=YZ(this.viewMat3),h=$h(n[0]/2,n[1]/2),p=$h(-n[0]/2,-n[1]/2),f=T5(i);m4(c,c,h),ZZ(c,c,f),m4(c,c,p),UE(this.displayViewMat3,this.displayMat3,c);const m=AZ(this.viewMat2d,h);return EZ(m,m,f),CZ(m,m,p),fmt(this.extent,o,n),ymt(this.transform,o,n,s),T1e(this.inverseTransform,this.transform),_mt(this.transformNoRotation,o,n,s),this.worldScreenWidth=bmt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],a_.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],a_.prototype,"pixelRatio",null),u([d({json:{write:!0}})],a_.prototype,"size",null),u([d()],a_.prototype,"spatialReference",void 0),u([d({type:Uc,json:{write:!0}})],a_.prototype,"viewpoint",null),a_=Rq=u([P("esri.views.2d.ViewState")],a_);const wmt=a_,xmt=.125;class Tmt{constructor(){this._renderParams={context:null,drawPhase:1,state:new wmt({viewpoint:new Uc({targetGeometry:new yt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(t,r,i,s,n,o,a,l,c,h){const p=o.adjustLevel(r[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(r[0]),[y,_]=o.getShift(r,a*m),b=xmt*a*m/c,x=i.transforms.dvs;x[0]=b,x[4]=-b,x[6]=-1-y-l[0]*a*2,x[7]=1+_+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,i.stage||i.attachWithContext(t),i.triangleCount=0,s.drawTile(f,i,n)}}class a8 extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2}initializeProgram(t){return new Nr(t.rctx,a8.shader.get().build(this.configuration),Or)}initializePipeline(){return Vt({blending:Vp(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:Qt})}}a8.shader=new Dr(rft,()=>ie(()=>import("./RasterColorizer.glsl.4ad7218e.js"),[]));class DN extends hS{constructor(){super(...arguments),this.colorizerType=xw.Stretch,this.stretchType=hx.Noop,this.applyColormap=!0}}u([B({count:xw.COUNT})],DN.prototype,"colorizerType",void 0),u([B({count:hx.COUNT})],DN.prototype,"stretchType",void 0),u([B()],DN.prototype,"applyColormap",void 0);class Ice{constructor(t){this._rctx=t,this._fbos=new Map}get(t){return this._getPool(t)}dispose(){this._fbos.forEach(t=>t.dispose()),this._fbos.clear()}_getPool(t){const r=this._fbos.get(t);if(r)return r;const i=new Li(this._rctx,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.DEPTH_RENDER_BUFFER,width:t,height:t});return this._fbos.set(t,i),i}}const Smt=ee.getLogger("esri.views.3d.terrain");class Emt{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new Tmt,this._bindParameters=new Y6(null,null,null),this._blendLayersTechniqueConfig=new OEe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=La(this._rctx,$C)}dispose(){this._fbos.forEach(tt),this._fbos=null,this._vtFBO=tt(this._vtFBO),this._vaoQuad=tt(this._vaoQuad),this._vectorTileHelper=tt(this._vectorTileHelper),this._backgroundTechnique=Wi(this._backgroundTechnique),this._applyOpacityTechnique=Wi(this._applyOpacityTechnique),this._blendLayersTechnique=Wi(this._blendLayersTechnique)}_getBlendLayersTechnique(t,r,i,s=tp.Off,n=px.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(n8,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,r){const i=this._getBlendLayersTechnique(Ue.Normal,r?Vn.ColorComposite:Vn.GridComposite,vp.NotRequired,tp.Off,px.Only),s=this._rctx.bindTechnique(i,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(It.TRIANGLE_STRIP,0,ra(this._vaoQuad,"geometry"))}drawGroup(t,r,i,s,n,o=tp.On){r===Vn.Composite&&(t.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),t.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,t,this._bindParameters);this._render(l)}drawRasterData(t,r,i,s,n,o=tp.Off){if(E(t.texture))return;t.fboTexture=r===Vn.GroupBackgroundComposite||s===Ue.Normal&&n===vp.NotRequired&&o===tp.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,t,this._bindParameters);this._render(l)}drawImageryTileData(t,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,pr.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;t.fboTexture=s===Ue.Normal&&n===vp.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=t.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=t.backgroundColor,c.fboTexture=t.fboTexture,c.baseOpacity=t.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(t,r,i,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return E(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new DN,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?hx.Noop:hx.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(a8,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,r,i,s,n,o,a,l,c){const h=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,pr.MAP),m=n===vp.Required||t.opacity<1||s!==Ue.Normal||r!==Vn.Composite,y=m?tp.On:tp.Off;this._getBlendLayersTechnique(s,r,n,y).bindPipelineState(h);let _=null,b=null;m?(b=this.currentFBO(i),E(this._vtFBO)&&(this._vtFBO=new Ice(this._rctx)),_=this._vtFBO.get(i),h.bindFramebuffer(_),this._clearCurrentFBO()):c&&h.clearSafe(Vi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(x){Smt.warnOnce("A render call containing vector tiles did not resolve correctly.",x)}return!v(_)||(h.bindFramebuffer(b),t.texture=_.colorTexture,t.offset=Zl,t.scale=1,this.drawRasterData(t,r,i,s,n,y),c)}copyFBOToTexture(t){const r=this._rctx,i=r.bindTexture(t.texture,lt.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;r.gl.copyTexImage2D(bt.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),r.bindTexture(i,lt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Vi.COLOR_BUFFER_BIT|Vi.DEPTH_BUFFER_BIT)}_initFBO(t,r,i){this._rctx.bindFramebuffer(t),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(t){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(t)}bind(t,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new Ice(this._rctx));this._initFBO(this._fbos[r].get(t),t,i)}_bindNextFreeBuffer(t){this._lastUsedIds.length>0?this.bind(t,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(t,this._lastCreatedBufferId))}openGroup(t){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(t)}switch(t){const r=this.currentFBO(t),i=this._current;return this._bindNextFreeBuffer(t),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(t){const r=this._current;this._bindNextFreeBuffer(t),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(t){return this._fbos[this._current].get(t)}}class Cmt{constructor(t,r,i,s){this.start=t,this.end=r,this.blendMode=i,this.opacity=s}}class Amt{constructor(t,r,i){this._rctx=t,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new smt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Emt(this._rctx,this._techniqueRepository),this._blackTex=new M2(lWe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=tt(this._composition),this._backgroundTexture=Wi(this._backgroundTexture),this._blackTex=Wi(this._blackTex)}get backgroundIsGrid(){return E(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,r){if(!t.renderData)return;const i=t.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let h=!1;l5.clear(),CT.length=0;const p=t.layerInfo[pr.MAP];let f=p.length,m=0;for(;m<p.length;m++){const b=i.layerViewByIndex(m,pr.MAP),x=b.layer.opacity;$ce[m]=x;const T=b.fullOpacity;if(Lce[m]=T,hye(b.layer)&&f>=p.length&&(f=m),i5(b)){Dce[m]=b.layer.blendMode;let C=b.layer.blendMode!=="normal";if(xE(b.layer.parent)){const O=Oq(b.layer.parent);v(O)&&O!==""&&(C=MEe(b.layer.parent)||C)}C&&(h=C,l=!1)}if(x===0&&!h){p[m].pendingUpdates&=~(Et.TEXTURE_NOFADING&Et.TEXTURE_FADING);continue}++o;const S=fB(t,m);if(S){if(p[m].pendingUpdates&=~(Et.TEXTURE_NOFADING&Et.TEXTURE_FADING),xE(b.layer.parent)){const C=Oq(b.layer.parent);v(C)&&C!==""&&PEe(b.layer.parent,m)}VM(b)?a=Math.max(a,this.tileSize*c):s===1&&T===1&&(b.isOpaque||this._dataToTexture(S)&&S.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n}}this._rctx.type===vt.WEBGL1&&(a=Rmt(a));const y=a/this.tileSize,_=m-1;this._ensureBackgroundTexture(this.tileSize),n!==0?n===1&&!h&&this._useLayerTexture(t,_,f,Lce[_])||this._composeMapLayers(t,r,_,f,$ce,Dce,a,y,!l||h,l5,h):this._useBackgroundTexture(t,o)}_ensureBackgroundTexture(t){E(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(t),this._passParameters.offset=Zl,this._passParameters.scale=1,this._passParameters.opacity=1,v(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,v(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(t,r){let i=cy.Immediate;(t.surface.view.layerViewManager.updating||r>0)&&(i=cy.Delayed);const s=t.renderData;this._backgroundTexture&&E(s.textureReference)&&(i=cy.Immediate),s.setTextureReference(v(this._backgroundTexture)?new dB(this._backgroundTexture,Tn.FADING,Nce,t.surface.baseOpacity,0,1):null,i)}_useLayerTexture(t,r,i,s){const n=r<i,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=fB(t,r);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new dB(l.sourceLayerInfo.data,Tn.FADING,l,o,a,s)),!0)}_composeMapLayers(t,r,i,s,n,o,a,l,c,h,p){this._composition.ensureBuffer(a);const f=t.surface.baseOpacity;let m=!1,y=rt.LINEAR_MIPMAP_LINEAR,_=!1,b=0;for(let S=i;S>=0;S--){const C=fB(t,S);if(!C||n[S]===0&&!p)continue;const O=S<s&&f<1&&!m;this._passParameters.baseOpacity=O?f:1;const R=this._passParameters.baseOpacity<1?vp.Required:vp.NotRequired;O&&(m=!0);let $=!1;h.forEach(G=>{G.start===S&&(CT.push(G),this._composition.openGroup(a),$=!0)});const I=b===0,U=$?Vn.GroupBackgroundComposite:c&&I?this.backgroundIsGrid?Vn.GridComposite:Vn.ColorComposite:Vn.Composite,V=Eq[o[S]];for(Rdt(C)?(this._passParameters.opacity=n[S],_=this._composition.drawVectorData(this._passParameters,U,a,V,R,C,l,this.tileSize,_)):Adt(C)?(this._passParameters.opacity=n[S],this._composition.drawImageryTileData(this._passParameters,U,a,V,R,C),this._hasNearestInterpolation(C)&&(y=rt.NEAREST)):this._dataToTexture(C)&&(this._passParameters.texture=C.sourceLayerInfo.data.texture,this._passParameters.offset=C.offset,this._passParameters.scale=C.scale,this._passParameters.opacity=n[S],this._composition.drawRasterData(this._passParameters,U,a,V,R));CT.length>0&&CT[CT.length-1].end===S;){const G=CT.pop();this._passParameters.opacity=G.opacity,this._passParameters.offset=Zl,this._passParameters.scale=1;const z=c&&I?this.backgroundIsGrid?Vn.GridComposite:Vn.ColorComposite:Vn.Composite;this._composition.drawGroup(this._passParameters,z,a,Eq[G.blendMode],R)}b++}const x=t.renderData,T=x.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(T),this._composition.unbind(),x.setTextureReference(new dB(T,r,Nce,m?1:f,0,1))}_hasNearestInterpolation(t){const r=t.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(t){if(Mdt(t)){const r=t.sourceLayerInfo;r.data=this._buildTexture(r.data),t.tile.setMemoryDirty()}return Odt(t)}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,r=rt.LINEAR_MIPMAP_LINEAR){if(E(t))return null;const i={target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:r,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")i.width=i.height=t,n=new M2(new lt(s,i));else if(t instanceof JU)i.isOpaque=t.isOpaque,n=new M2(new lt(s,i,t.image)),t.release();else try{i.width=t.width,i.height=t.height,n=new M2(new lt(s,i,t))}catch{n=new M2(Cbe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,lt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,lt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function Rmt(e){const t=JS(e),r=t*t,i=e*e;if(r===i)return e;const s=t/2;return r-i<i-s*s?t:s}function fB(e,t){eu.layerIndex=t;const r=e.layerInfo[pr.MAP][t];if(v(r.data))return or(eu.offset,0,0),eu.tile=e,eu.scale=1,eu.sourceLod=e.lij,eu.sourceLayerInfo=r,eu;const i=r.upsampleInfo;if(v(i)){const s=i.tile.layerInfo[pr.MAP][t];return eu.tile=i.tile,qn(eu.offset,i.offset),eu.scale=i.scale,eu.sourceLod=i.tile.lij,eu.sourceLayerInfo=s,eu}return null}function Oq(e){return e.get("uid")}function MEe(e){let t=e.blendMode!=="normal";return xE(e.parent)&&(t=MEe(e.parent)||t),t}function PEe(e,t){xE(e.parent)&&PEe(e.parent,t);const r=Oq(e);if(v(r)&&r!==""){const i=l5.get(r);i?i.start=t:l5.set(r,new Cmt(t,t,e.blendMode,e.opacity))}}const $ce=new Array,Lce=new Array,Dce=new Array,l5=new Map,CT=new Array,eu={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},Nce={offset:[0,0],scale:1},IEe=200,mB=40,Omt=.8,Mmt=10,_3=1e-6;function Pmt(e,t,r){const i=t,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(i[a]<l){if(s[a]<=_3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-_3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(i[a]>l){if(s[a]>=-_3)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=_3){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class Fce{constructor(t,r,i,s,n){this.aabb=t,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}}class aC{constructor(t,r,i,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=M(),this.bspNodeTree=new Array;const n=i-r,o=n<=$Ee?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=Nmt(t,r,i,s.data,s.stride),l=ye(Math.log2(n/mB),2,Mmt),c=(h,p,f)=>{const m=Lmt(o,a,h,p),y=p-h;if(y<=mB){const C=new Fce(m,void 0,0,h,p);return this.bspNodeTree.push(C),C}const{axis:_,midValue:b}=Dmt(m),x=$mt(o,a,h,p,_,b),T=(C,O)=>{if(f>l)return;const R=O-C;return R<mB||R>=Omt*y?void 0:c(C,O,f+1)},S=new Fce(m,_,b,x.next,x.mid);return this.bspNodeTree.push(S),S.leftNode=T(h,x.next),S.rightNode=T(x.mid,p),S};c(0,n,0),this.triangleVertexIndices=Fmt(o,t,r,i)}}intersectRayTriangleRange(t,r){{if(t>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],h=this._rayDirection,p=h[0],f=h[1],m=h[2];for(let y=t,_=3*t;y<r;++y){let b=i[_++]*n;const x=s[b++],T=s[b++],S=s[b];b=i[_++]*n;const C=s[b++],O=s[b++],R=s[b];b=i[_++]*n;const $=C-x,I=O-T,U=R-S,V=s[b++]-x,G=s[b++]-T,z=s[b]-S,Z=f*z-G*m,Q=m*V-z*p,te=p*G-V*f,q=$*Z+I*Q+U*te;if(Math.abs(q)<=Number.EPSILON)continue;const L=a-x,N=l-T,F=c-S,H=L*Z+N*Q+F*te;if(q>0){if(H<0||H>q)continue}else if(H>0||H<q)continue;const X=N*U-I*F,K=F*$-U*L,W=L*I-$*N,ue=p*X+f*K+m*W;if(q>0){if(ue<0||H+ue>q)continue}else if(ue>0||H+ue<q)continue;const pe=(V*X+G*K+z*W)/q;if(pe>=0){const we=this.indices[y]+this.firstTriangleIndex,Ce=zJ($,I,U,V,G,z,Imt);this._callback(pe,Ce,we,!1)}}}aC.numFacesTested+=r-t}intersectRay(t,r){aC.numFacesTested=0;const i=Le(t.r0[0],t.r0[1],t.r0[2]),s=Le(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<_3)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!Pmt(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=r,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=i;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}aC.numFacesTested=0;const Imt=M(),AT=[1/0,1/0,1/0],RT=[-1/0,-1/0,-1/0];function $mt(e,t,r,i,s,n){let o=r,a=i;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=i;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function Lmt(e,t,r,i){if(i<=r)return $w(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[r];for(let n=0;n<3;++n)AT[n]=t[s+0+n],RT[n]=t[s+3+n]}for(let s=r+1;s<i;++s){const n=6*e[s];for(let o=0;o<3;++o)AT[o]=Math.min(AT[o],t[n+0+o]),RT[o]=Math.max(RT[o],t[n+3+o])}return $w(AT[0],AT[1],AT[2],RT[0],RT[1],RT[2])}function Dmt(e){const t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2],s=t>r?t>i?0:r>i?1:2:r>i?1:i>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function Nmt(e,t,r,i,s){const n=r-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const m=i[c+f],y=i[h+f],_=i[p+f];o[6*a+f]=Math.min(m,y,_),o[6*a+3+f]=Math.max(m,y,_)}}return o}function Fmt(e,t,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=$Ee?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+r);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const $Ee=65535;class ls extends ao{constructor(){super(...arguments),this.output=k.Color,this.overlayMode=hy.Disabled,this.tileBlendInput=sm.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!Xr.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=Xr.TERRAIN_USE_LEGACY_SHADING,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=ht.Terrain}}u([B({count:k.COUNT})],ls.prototype,"output",void 0),u([B({count:hy.COUNT})],ls.prototype,"overlayMode",void 0),u([B({count:sm.COUNT})],ls.prototype,"tileBlendInput",void 0),u([B()],ls.prototype,"spherical",void 0),u([B()],ls.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],ls.prototype,"atmosphere",void 0),u([B()],ls.prototype,"receiveShadows",void 0),u([B()],ls.prototype,"hasSlicePlane",void 0),u([B()],ls.prototype,"backfaceCullingEnabled",void 0),u([B()],ls.prototype,"stencilEnabled",void 0),u([B()],ls.prototype,"textureFadingEnabled",void 0),u([B()],ls.prototype,"renderOccluded",void 0),u([B()],ls.prototype,"hasScreenSpaceReflections",void 0),u([B()],ls.prototype,"hasCloudsReflections",void 0),u([B()],ls.prototype,"shading",void 0),u([B()],ls.prototype,"useLegacyTerrainShading",void 0),u([B()],ls.prototype,"invisible",void 0),u([B()],ls.prototype,"tileBorders",void 0),u([B()],ls.prototype,"visualizeNormals",void 0),u([B()],ls.prototype,"screenSizePerspective",void 0),u([B()],ls.prototype,"receiveAmbientOcclusion",void 0),u([B({count:ht.COUNT})],ls.prototype,"pbrMode",void 0),u([B({constValue:oi.CompressedAttribute})],ls.prototype,"normalType",void 0),u([B({constValue:Js.Compressed})],ls.prototype,"textureCoordinateType",void 0),u([B({constValue:!1})],ls.prototype,"highStepCount",void 0),u([B({constValue:!1})],ls.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],ls.prototype,"useFillLights",void 0);const gB=7,Umt=10,yB=In();var Fn;(function(e){e[e.Opaque=0]="Opaque",e[e.Semitransparent=1]="Semitransparent",e[e.TransparentWithDraped=2]="TransparentWithDraped",e[e.Empty=3]="Empty"})(Fn||(Fn={}));let pc=class extends Te{get _isGlobal(){return this._stage.viewingMode===Ge.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}constructor(e){super(e),this.type=ss.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new ls,this._passParameters=new pEe,this._rctx=null,this._renderDataPool=new An(Pft),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new sEe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=Fn.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=us.Occlude}initialize(){const e=[Se.OPAQUE_TERRAIN,Se.TRANSPARENT_TERRAIN,Se.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),Opt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===Fn.TransparentWithDraped||e===Fn.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return E_}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?X4:us.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,v(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,Et.TEXTURE_FADING)}updateTileTexture(e,t){v(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,t===Et.TEXTURE_FADING?Tn.FADING:Tn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(const r of e.layerInfo[pr.ELEVATION])r.pendingUpdates&=~Et.GEOMETRY;e.resetPendingUpdate(Et.GEOMETRY);const t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const t=Umt-gB,r=Math.max(0,Math.floor((e.level-t)/gB)*gB);if(this._isGlobal&&r===0)return Sa;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Ds.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Ds.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Ds.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new Amt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=Cbe(this._rctx)}uninitializeRenderContext(){this._emptyTex=tt(this._emptyTex),this._tileRenderer=tt(this._tileRenderer)}intersect(e,t,r,i){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==Fn.Opaque)return;const s=kmt,n=Vmt;ge(s,i,r),ce(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===Bo.MIN,h=!!e.results.ground.target,p=vJe(e.verticalOffset),f=e.tolerance;let m,y=c&&v(o.dist)?o.dist:1/0;const _=x=>{const T=x.renderData;if(!(T!=null&&T.vao))return;const S=T.geometryInfo;G5(yB,S.boundingBox);const C=T.localOrigin;v(p)&&(p.localOrigin=C,p.applyToAabb(yB));const O=yB;if(OT[0]=r[0]-C[0],OT[1]=r[1]-C[1],OT[2]=r[2]-C[2],!jJ(O,OT,n,f,y))return;const R=(Q,te,q)=>{Q.set(this.type,x,te,q,Bu),y=c&&v(o.dist)?o.dist:1/0},$=(Q,te)=>{if(v(te)&&Q>=0&&(e.options.backfacesTerrain||_e(te,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(r,i,Q))){if((l.dist==null||Q<l.dist)&&R(l,Q,te),e.options.isFiltered)return;e.options.store===Bo.ALL&&(E(m)?(m=gJ(e.ray),R(m,Q,te),e.results.all.push(m)):Q<m.dist&&R(m,Q,te)),(o.dist==null||Q<o.dist)&&R(o,Q,te),e.options.store!==Bo.MIN&&(a.dist==null||Q>a.dist)&&R(a,Q,te)}},I=Bmt;ge(I,i,C);const U=S.indices,V=S.vertexAttributes,G=V.getField(A.POSITION,mi),z=new Je(G.typedBuffer,3,!1,V.stride/4),Z=S.indexCount/3;if(E(p)&&Z>IEe){const Q=x.renderData;E(Q.intersectionData)&&(Q.intersectionData=new aC(U,0,Z,z)),Q.intersectionData.intersectRay({r0:OT,r1:I},$)}else zP(OT,I,0,Z,U,z,null,p,$)},b=this._rootTiles;v(b)&&(()=>{const x=this._tileIterator;x.reset(b);const T=e.options.invisibleTerrain;for(let S=x.next();S;S=x.next())!(S.visible||T&&S.intersectsClippingArea)||!v(p)&&!S.intersectsRay(r,s,f,y)||h&&this._useStencilForTile(S)?x.skipSubtree():_(S)})()}processScaleRangeQueries(e,t){var r;if(!t.done)for(this._updatePatchGroups();e.updating&&!t.done;){e.prepare();for(const i of this._patchGroups.values())for(const s of i)v((r=s.renderData)==null?void 0:r.textureReference)&&e.queriesForTile(s);e.process(),t.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===Se.OCCLUDED_TERRAIN){if((e.renderOccludedMask&X4)==0)return null}else{const t=this.transparency===Fn.Opaque?Se.OPAQUE_TERRAIN:Se.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.output){case k.Color:return this.transparency===Fn.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=v(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?hy.Disabled:this._overlayRenderer.hasWater?hy.EnabledWithWater:hy.Enabled,this._updateTechnique(k.Color,e.bindParameters.slot===Se.OCCLUDED_TERRAIN));case k.Shadow:case k.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Shadow,!1)):null;case k.Depth:return this.transparency===Fn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Depth,!1));case k.Normal:return this.transparency===Fn.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Normal,!1));case k.ObjectAndLayerIdColor:return this.transparency===Fn.Empty?null:this._updateTechnique(k.ObjectAndLayerIdColor,!1);case k.Highlight:return this.transparency!==Fn.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(k.Highlight,!1)):null}return null}render(e,t){const r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case k.Color:{const i=e.bindParameters.slot===Se.OCCLUDED_TERRAIN?Fl.Occluded:Fl.ColorAndWater;this.transparency===Fn.Opaque?this._renderMaterialPass(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case k.Depth:case k.Normal:this._renderAuxiliaryPass(e,t,Fl.None);break;case k.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,t,Fl.Highlight);break;case k.Shadow:case k.ShadowExcludeHighlight:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,Fl.None);break;case k.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,Fl.ObjectAndLayerIdColor)}}_renderMaterialPass(e,t,r){const{rctx:i}=e;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,t,r)}_renderAuxiliaryPass(e,t,r){const i=e.rctx;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,r)}updateTileBackground(e=null){if(E(this._tileRenderer))return;const t=this._tileRenderer;let r=null;if(v(e)){const i=Qe.toUnitRGBA(e);r=Le(i[0]||0,i[1]||0,i[2]||0)}t.setBackground(r),this._allTiles.forAll(i=>t.updateTileTexture(i,Tn.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?sm.GridComposite:v(t.backgroundColor)?sm.ColorComposite:sm.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==oC.NONE){const e=Array.from(this._patchGroups.values()),t=this._stencilEnabledLayerExtents;for(const r of e)nEe(this.renderOrder,r,t);e.sort((r,i)=>oEe(r[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!E(e)){(t=e[0])==null||t.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const t=this._tileIterator;for(t.resetOne(e);!t.done;){const r=t.next(),i=r.renderData;if(!i){this._numTilesCulled++;continue}if(!r.visible){this._numTilesCulled++,t.skipSubtree();continue}const s=i.localOrigin;let n=this._patchGroups.get(s);n||(n=new Array,this._patchGroups.set(s,n)),n.push(r),(!this._highestVisibleLODTile||r.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=r),t.skipSubtree()}}_useStencilForTile(e){for(const t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,r){const i=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new aq(n),e.bindParameters,this._passParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],It.TRIANGLES,i,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,r){const i=e.bindParameters.camera,s=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=Rxe(this._stage.viewingMode,this._ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:i.fovY})}const n=this._stencilEnabledLayerExtents.length>0,o=r===Fl.Occluded;o&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",Sa),s.setUniform4fv("texOffsetAndScale",am));const a=v(this._tileRenderer)&&v(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:Sa;this._techniqueConfiguration.tileBlendInput===sm.ColorComposite&&s.setUniform3fv("backgroundColor",a);const l=this.wireframe?It.LINES:It.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const c=this._patchGroups;for(const h of c.values()){const p=h[0].renderData.localOrigin;t.program.bindDraw(new aq(p),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const f of h){const m=f.renderData,y=m.textureReference;if(!E(y)){if(!o){s.setUniform4fv("texOffsetAndScale",y.offsetAndScale),s.bindTexture("tex",y.texture.texture);const _=m.textureFadeFactor,b=_<1?m.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&v(b)&&_<1?(s.setUniform1f("fadeFactor",_),s.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),s.setUniform3fv("nextTexOpacities",b.opacities),s.bindTexture("texNext",b.texture.texture)):s.setUniform1f("fadeFactor",1),m.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,t,f,l,n,r),f.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,t,r,i,s,n){const o=r.renderData,a=o.vao,l=a.indexBuffer;if(E(l))return void(On&&console.error("Rendered tile with no indices: ",r.lij," : ",o));const c=t.program;n===Fl.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(r),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(i,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===k.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(r8,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([d({constructOnly:!0})],pc.prototype,"_overlayRenderer",void 0),u([d({constructOnly:!0})],pc.prototype,"_stage",void 0),u([d({readOnly:!0})],pc.prototype,"_isGlobal",null),u([d({constructOnly:!0})],pc.prototype,"_allTiles",void 0),u([d({constructOnly:!0})],pc.prototype,"_ellipsoidRadius",void 0),u([d({value:!1})],pc.prototype,"renderingDisabled",null),u([d()],pc.prototype,"renderPatchBorders",null),u([d()],pc.prototype,"visualizeNormals",null),u([d()],pc.prototype,"cullBackFaces",null),u([d({value:oC.FRONT_TO_BACK})],pc.prototype,"renderOrder",null),u([d()],pc.prototype,"wireframe",null),pc=u([P("esri.views.3d.terrain.TerrainRenderer")],pc);const kmt=M(),Vmt=M(),OT=M(),Bmt=M();class zmt{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let Pf=class extends Te{constructor(e){super(e),this._handles=new Jr}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(se(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Ve(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!V3(t)||t.isRejected())&&!(t.isFulfilled()&&!Gmt(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||r5(t)))),e)if(e.isResolved()){const t=KU(e,this.viewSpatialReference,this.viewingMode);if(v(t)){const r=new rs(t.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Ge.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=rs.makeWebMercatorAuxiliarySphere(t):Nw(e.spatialReference)&&(e=rs.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(se(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ge.Global){const e=this.extentHelper.viewSpatialReference,t=Nw(e)||Om(e)||Mm(e);e.isWebMercator?this.tilingScheme=rs.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=rs.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;v(e)&&!cw(e,this.extent)&&(this.tilingScheme=rs.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Gmt(e,t,r){return v(KU(e,t,r))}u([d()],Pf.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],Pf.prototype,"extent",void 0),u([d({value:!1})],Pf.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],Pf.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],Pf.prototype,"layers",void 0),u([d({constructOnly:!0})],Pf.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],Pf.prototype,"viewingMode",void 0),Pf=u([P("esri.views.3d.terrain.TilingSchemeLogic")],Pf);class jmt{constructor(){this.offset=Ke(),this.scale=0,this.tile=null}init(t,r,i,s){this.tile=t,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}let rr=class extends Vs.EventedMixin(Te){constructor(e){var t,r;super(e),this._scaleRangeQueries=new $N,this._iteratorPool=new An(sEe,i=>i.remove=()=>this._iteratorPool.release(i)),this._postorderIterator=new Dpt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new zmt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=M(),this._eyePosSurfaceSR=M(),this._splitLimits=new tmt,this._frustum=lM(),this._viewProjectionMatrix=Ie(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Jr,this._watchUpdatingTracking=new om,this._frameTask=IE,this._allTiles=new Jt,this._upsampleInfoPool=new An(jmt),this._rootTilesExtent=ur(),this.updatingProgress=0,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ye.WebMercator,this.visibleElevationBounds=new uS(1/0,-1/0),this.rootTileElevationBounds=new uS(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((r=(t=e.view)==null?void 0:t.state)!=null&&r.isLocal)}initialize(){this._lercDecoder=npt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new An(Jft):new An(Kft);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",n=>n.unloadMapData()),this._elevationQueryCache=new ipt(e.newCache("elevation-query")),this._set("overlayManager",new Pl({surface:this})),this._handles.add([se(()=>this.overlayManager.hasHighlights,n=>this._renderer.setNeedsHighlight(n)),se(()=>this.overlayManager.rendersOccluded,n=>this._renderer.setRenderOccludedOverlay(n)),se(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new pc({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Zr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([se(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Tn.UNFADED:Tn.IMMEDIATE)},Ys),se(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Tn.UNFADED:Tn.IMMEDIATE),Ys),se(()=>this.renderingDisabled,()=>{var n,o;return(o=(n=this.view)==null?void 0:n._stage)==null?void 0:o.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},ri),se(()=>this.backgroundColor,n=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(n)},Ys),se(()=>this.snapLevel,()=>this._viewChanged=!0,ri),se(()=>this.view.pointsOfInterest,n=>{this._renderer.pointsOfInterest=n,this._watchUpdatingTracking.removeAll(),n&&this._watchUpdatingTracking.add(()=>n.focus.renderLocation,()=>this._allTilesSorted=!1)}),se(()=>Xr.TERRAIN_TILE_TREE_SHOW_TILES,n=>{n&&!this._treeDebugger?ie(()=>import("./TerrainTileTree3DDebugger.e523fe78.js"),["assets/TerrainTileTree3DDebugger.e523fe78.js","assets/TileTreeDebugger.3d51e69f.js"]).then(({TerrainTileTree3DDebugger:o})=>{!this._treeDebugger&&Xr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new o({view:this.view}))}):n||(this._treeDebugger=Ve(this._treeDebugger))},kt)]);const{spatialReference:t}=this.view;this._extentHelper=wpt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:t});const r=new eM({getCollections:()=>{var n,o,a;return(a=(o=(n=this.view)==null?void 0:n.defaultsFromMap)==null?void 0:o.mapCollections)==null?void 0:a.map(({layers:l})=>l)},getChildrenFunction:n=>n&&"layers"in n?n.layers:null}),i=new Pf({layers:r,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:t});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Jf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Jf.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(gt.TERRAIN_SURFACE,this),this._handles.add([se(()=>this._extentHelper.stencilEnabledExtents,n=>this._renderer.setStencilEnabledLayerExtents(n),kt),se(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),ri),se(()=>this.extent,()=>this._updateRootTiles(),kt),this.view.on("resize",()=>this._viewChangeUpdate()),se(()=>{var a,l;const n=this.view,o=n.state;return[this._lodBias,this.lodSnapping,(l=(a=n.resourceController)==null?void 0:a.memoryController)==null?void 0:l.memoryFactor,o.camera,o.contentCamera,o.fixedContentCamera]},()=>this._viewChangeUpdate(),Ys),se(()=>{var n,o;return(o=(n=this.view.qualitySettings)==null?void 0:n.tiledSurface)==null?void 0:o.textureFadeDuration},n=>this._renderer.textureFadingEnabled=n>0,kt),se(()=>{var n;return(n=this.view.qualitySettings)==null?void 0:n.physicallyBasedRenderingEnabled},n=>this._renderer.pbrMode=n?ht.Terrain:ht.Disabled,kt),se(()=>this._userClippingExtent,()=>this._updateClippingExtent(),ri)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([se(()=>{var n;return(n=this.view)==null?void 0:n.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Wi(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Ve(this._upsampleMapCache),this._elevationQueryCache=Ve(this._elevationQueryCache);const e=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",Ve(this.tilingSchemeLogic)),e.destroy(),this._basemapLayerViewHandles.forEach((t,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Ve(this.overlayManager)),this._tilePool=Ve(this._tilePool),GQ.prune(),this._treeDebugger=Ve(this._treeDebugger),this._renderer=Ve(this._renderer),this._iteratorPool=Ve(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=Ve(this._upsampleInfoPool),gpt(),uft()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,t;if(this.lodSnapping===uO.ON){const r=this.view,i=this.tilingScheme,s=(t=(e=r.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:t.scale;if(s&&i){const n=r.state.contentCamera;let o=cU(r,n.eye,n.viewForward,n.up).tilt;o>90&&(o=180-o);const a=2*(o/90)**2,l=i.levelAtScale(s)-a;return Math.round(l)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?uO.ON:uO.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(E(t)||E(e))return null;const r=ur(),i=zSe(t,r,e)?r:null,s=this._get("extent");return cw(i,s)?s:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=t7(this.groundExtent,this._userClippingExtent,ur()),t=this._get("extent");return cw(e,t)?t:e}get groundExtent(){return v(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return v(this._rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e,t;return(t=(e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)!=null?t:!1}set velvetOverground(e){this._renderer.velvetOverground=e,this._set("velvetOverground",e)}get wireframe(){return this._renderer.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===Fn.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){var e;return(e=this.view.qualitySettings.tiledSurface.textureFadeDuration)!=null?e:0}intersect(e,t,r,i){this._renderer.intersect(e,t,r,i)}getElevation(e,t,r,i){const s=this._rootTiles;if(E(s)||!s.length||s[0].layerInfo[pr.ELEVATION].length===0)return null;const n=xl;return n[0]=e,n[1]=t,n[2]=r,mo(n,i,n,this._spatialReference)?kce(s,n[0],n[1]):(ee.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,t,r){const i=this._rootTiles,s=i?i[0].layerInfo[pr.ELEVATION].length:0;if(!E(i)&&i.length&&s!==0)for(let n=0;n<t;++n){const o=3*n;r(n,kce(i,e[o+0],e[o+1]))}else for(let n=0;n<t;++n)r(n,null)}getScale(e){if(!this.tilingScheme)return null;if(!aa(e,xl,this.spatialReference))return ee.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this._rootTiles;if(v(t)){for(const r of t)if(r!=null&&r.containsPoint(xl)){let i=r;for(;i.children[0]&&!i.rendered;){const s=i.children[0].extent;let n=0;xl[0]>s[2]&&(n+=1),xl[1]<s[1]&&(n+=2),i=i.children[n]}return this._getLodBiasCorrectedScale(i.level)}}return 1/0}getSphereElevationBounds(e,t,r,i,s){var c;if(xl[0]=e,xl[1]=t,xl[2]=r,xl[3]=i,!mo(xl,s,xl,(c=this.tilingScheme)==null?void 0:c.spatialReference))return ee.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=h=>{if(h&&ree(h.extent,xl))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),o=Math.max(o,h.elevationBounds[1]);else for(const p of h.children)a(p)},l=this._rootTiles;if(v(l))for(const h of l)a(h);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!aa(e,xl,this.spatialReference))return ee.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;xl[3]=t;let r=null;const i=n=>{if(n&&ree(n.extent,xl)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)i(a);else{const a=this._getLodBiasCorrectedScale(n.level);r=r==null?a:Math.min(r,a)}}},s=this._rootTiles;if(v(s))for(const n of s)i(n);return r}queryVisibleScaleRange(e,t,r,i){const s=t?this.tilingScheme.levelAtScale(t):0,n=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+o,n+o,i)}_evaluateTransparency(){var n,o;const e=this.baseOpacity,t=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,i=this._allSurfaceLayersTransparent()?t?Fn.Empty:Fn.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Fn.Opaque:Fn.Semitransparent,s=r!==i;return s&&(this._renderer.transparency=i,(o=(n=this.view)==null?void 0:n._stage)==null||o.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var r,i,s,n;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;Gf(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(r=this.view)==null?void 0:r.state)!=null&&i.isLocal),this.tilingScheme&&this._removeAllTiles();const t=(s=e==null?void 0:e.spatialReference)!=null?s:Ye.WebMercator;this._spatialReference=t,this._isWebMercator=!!(t!=null&&t.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&jW((n=this.view)==null?void 0:n.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,t,r,i){const s=this._tilePool.acquire();return $L[0]=e,$L[1]=t,$L[2]=r,s.init($L,i,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const r=Wmt;let i=t.rootTilesInExtent(e,r,5*Q2);if(v(this._rootTiles)){if(i.length>Q2)return void ee.getLogger(this.declaredClass).warn($je);const s=this._rootTiles.map(o=>o.lij),n=GAe(s,i,Uce);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>Uce(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,i.length>Q2&&(ee.getLogger(this.declaredClass).warn(Lje),i=t.rootTilesInExtent(e,r,Q2)),this._setRootTiles(i.map(s=>this._newRootTile(s)));cw(r,this._rootTilesExtent)||(this._rootTilesExtent=ur(r)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(t=>t.isLoaded&&t.intersectsClippingArea);e.forEach(t=>this._renderer.updateTileGeometryState(t)),e.forEach(t=>t.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(uy);const t=this.renderer;e.forEach(r=>t.updateGeometryIfNeeded(r)),e.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Et.SPLIT}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(t)&&t.setPendingUpdate(Et.SPLIT),this._loadTile(t),this._markTileToUpdate(t),this._updateRootTileElevationBounds(),t}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),v(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(Et.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(E(e))return;const t=zpt(e),r=this.visibleElevationBounds;let i=t?r.min:1/0,s=t?r.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(Et.GEOMETRY)&&this._updateTileGeometryState(l),l.setPendingUpdate(Et.RENDERDATA),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),s=Math.max(l.elevationBounds[1],s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(i)&&isFinite(s)&&(r.min!==i||r.max!==s)&&(this.visibleElevationBounds=new uS(i,s))}_updateRootTileElevationBounds(){let e=1/0,t=-1/0;const r=this._rootTiles;v(r)&&r.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),t=Math.max(t,s[1])});const i=this.rootTileElevationBounds;i.min===e&&i.max===t||(this.rootTileElevationBounds=new uS(e,t))}_updateViewDependentParameters(){const{camera:e,contentCamera:t}=this.view.state,r=Math.tan(.5*t.fovX),i=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(E(this._splitLimits.frustum)&&(this._splitLimits.frustum=lM()),g4(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,g4(this._frustum,e.frustum),ws(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),le(this._eyePosRenderSR,t.eye),mo(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(LEe(e)?this._loadChildren(e):qmt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const t=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(r=>{t.add(r)})}_updateTileTexture(e,t){const r=e.resetPendingUpdate(Et.TEXTURE_FADING)?Et.TEXTURE_FADING:!!e.resetPendingUpdate(Et.TEXTURE_NOFADING)&&Et.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,t.madeProgress())}_emitElevationUpdateEventForTiles(){const e=vB.extent;ed(e),this._pendingTilesForElevationUpdateEvent.forEach(t=>Q_(e,t.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),vB.spatialReference=this.spatialReference,this.emit("elevation-change",vB)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),this._updateElevation(e),this._updateTextures(e),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();t.reset(this._rootTiles);const r=this.snapLevel,i=this._splitLimits,s=this._eyePosRenderSR;for(;!t.done;){const n=t.next(),o=n.shouldSplit(i,s,r);if(o!==Et.SPLIT){if(n.resetPendingUpdate(Et.SPLIT)&&n.updateAgentSuspension(),o===Et.VSPLITMERGE&&n.updateAgents(pr.ELEVATION),t.skipSubtree(),!n.isLeaf){n.setPendingUpdate(Et.MERGE),n.resetPendingUpdate(Et.SPLIT);const a=this._iteratorPool.acquire();a.resetOne(n);const l=this._viewProjectionMatrix;for(let c=a.next();!a.done;c=a.next())this._updateClippingStatus(c),c.updateVisibility(),c.updateScreenDepth(l);a.remove()}}else n.resetPendingUpdate(Et.MERGE),n.isLeaf&&(n.setPendingUpdate(Et.SPLIT),t.skipSubtree()),n.rendered&&n.setPendingUpdate(Et.RENDERDATA)}t.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(Vpt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Re(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const t=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),r=(s,n)=>{!(n!=null&&n.isLoaded)||!n.intersectsClippingArea||n.level<s.level||e.has(n)||(e.add(n),t.push(n),n.renderData.updateNeighborData())};t.sort(uy);const i=t.length;for(let s=0;s<i;++s){const n=t[s];Re(n.isLoaded),Re(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o._dirtyEdgeResolutions,l=o.geometryState.neighborData;for(let c=0;c<4;++c)if(a&1<<c){const h=o.geometryState.neighborData.edgePeerNeighbors[c];h&&(h==null?void 0:h.level)>=n.level&&h.forAllSubtreeOnSide(s5(im[c]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(Re(e.has(p)||uy(n,p)<0),r(n,p),!0)),r(n,l.cornerPeerNeighbors[c]),r(n,l.cornerPeerNeighbors[(c+1)%4])}}e.clear(),this._updateTilesGeometries(t),On&&t5&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const i=this.view.state.fixedContentCamera;let s=!1;for(;!e.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{var c;if(!r&&!i&&!a.visible)return e.done;let l=a;if(a.resetPendingUpdate(Et.MERGE)){if(!t)return a.setPendingUpdate(Et.MERGE),e.done;for(;(c=l.parent)!=null&&c.resetPendingUpdate(Et.MERGE);)l=l.parent;this._mergeTile(l),n=!0,e.madeProgress()}else a.resetPendingUpdate(Et.SPLIT)&&(this._splitTile(a),n=!0,e.madeProgress());return!e.done&&l===a&&a.resetPendingUpdate(Et.RENDERDATA)&&(this._updateRenderData(a),e.madeProgress()),e.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0),o){if(!r){r=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(t=>(t.resetPendingUpdate(Et.GEOMETRY)&&(this._updateTileGeometryState(t),this._updateTileTexture(t,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Ds.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Pje}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,r=ye(e-this._lodBias,0,t.length-1),i=r-Math.floor(r);return t[Math.floor(r)].scale*(1-i)+t[Math.ceil(r)].scale*i}_removeAllTiles(){v(this._rootTiles)&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let t=!1;for(let r=0;r<4;++r)t=this._purgeTile(e.children[r])||t;return e.unsetChildren(),t}_purgeTile(e){const t=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),t}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){Gf(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,r=2*e.lij[1],i=2*e.lij[2];e.setChildren(this._createTile(t,r,i,e),this._createTile(t,r,i+1,e),this._createTile(t,r+1,i,e),this._createTile(t,r+1,i+1,e)),e.setPendingUpdate(Et.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){LL.spatialReference=this.spatialReference,LL.extent=e.extent,LL.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",LL)}_createTile(e,t,r,i){Gf(!!i,"_createTile sanity check");const s=this._acquireTile(e,t,r,i);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(Et.SPLIT),s}get shortBatches(){return this.view.state.mode!==Sr.IDLE}_mergeTile(e){Gf(!e.hasPendingUpdate(Et.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Gf(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){Gf(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(r=>this._loadTile(r)),t.forEach(r=>this._pendingTilesToUpdate.add(r)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t,t.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const t=e.children;if(t[0])for(let r=0;r<4;++r){const i=t[r];this._unloadChildren(i),this._unloadTile(i)}}_loadTile(e){e.load(),e.setPendingUpdate(Et.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,t,r){const i=new vpt(e.lij,e.extent,r);e.dataArrived(t,pr.ELEVATION,i);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}n===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=Ka){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const r=new Set;let i=-1;for(const s of this.view.allLayerViews.items)if(r.add(s.uid),BM(s)||GA(s))if(this._basemapLayerViewHandles.has(s.uid)&&!GA(s)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);v(o)&&((o<i||E(i))&&(t=!0),i=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{r.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,r;let e=((r=(t=this.view.map)==null?void 0:t.ground)==null?void 0:r.opacity)===0;for(const i of this.view.allLayerViews.items)if(wq(i)&&!hye(i.layer)&&i.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((i5(e)||GA(e))&&Xpt(Eq[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return bq(e)?pr.ELEVATION:pr.MAP}_registerTiledLayerView(e){const t=[];if((i5(e)||GA(e))&&t.push(se(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Tn.UNFADED)})),GA(e))return;const r=this._layerClassFromLayerView(e);t.push(se(()=>e.suspended,()=>this._updateTiledLayers())),t.push(se(()=>e.fullOpacity,()=>this._updateTileTextures(Tn.UNFADED))),t.push(se(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),e.on("data-changed",()=>{const i=this._getLayerIdxByUID(r,e.uid);v(i)&&this._invalidateLayerData(i,r)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let r=0;r<t.length;r++)t[r].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let r=null;e.forEach(i=>{if(!i.layer||i.suspended||!BM(i)||!i.fullExtent)return;const s=this._layerClassFromLayerView(i);if(s===pr.MAP){const n=i.displayLevelRange.maxLevel;n!==1/0&&(r===null||n>r)&&(r=n)}t[s].push(i)});for(const i of wb){const s=this._layerViews[i],n=t[i];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[i].clear();for(let h=0;h<o;h++){const p=n[h].uid;this._layerIndexByUid[i].set(p,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this._rootTiles);!h.done;)h.next().modifyLayers(c,l,i);this._layerViews[i]=n,this._restartAllAgents(i),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this._rootTiles);!t.done;){const r=t.next();r.restartAgents(e),e===pr.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(pr.MAP),e===Tn.IMMEDIATE?this.renderer.updateTileTexture(t,Et.TEXTURE_NOFADING):t.updateRenderData(pr.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,t){this._allTiles.forAll(r=>r.removeLayerAgent(e,t)),this._allTiles.forAll(r=>r.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Ds.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,r,i){const s=this.layerViewByIndex(t,r),n=s.layer;return!n.tilemapCache||VM(s)?this._requestTileData(e,r,s,i):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...i,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,cr(i),sn(o)||this._dataMissing(e,r,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,s,i),i.signal)))}_requestTileData(e,t,r,i){return t===pr.ELEVATION?bq(r)?this._requestElevationTileData(e,r,i):Promise.reject():wq(r)?this._requestMapTileData(e,r,i):Promise.reject()}_requestElevationTileData(e,t,r){++this._asyncWorkItems;const i=o=>{if(zn(r))return;const a=this._layerIndexByUid[pr.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):ee.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",pr.ELEVATION,e.lij.toString())},s=o=>{sn(o)||(this._dataMissing(e,pr.ELEVATION,t,o),this.requestUpdate())};if(rce(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:QO,signal:r.signal}).then(o=>{if(!zn(r))return this._frameTask.schedule(()=>i(o),r.signal,s);ee.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",r).then(o=>this._lercDecoder.decode(o,{noDataValue:QO},r.signal)).then(o=>{o?i(new spt(o)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,r){++this._asyncWorkItems;const i=(c,h)=>{--this._asyncWorkItems,GS(h),zn(r)||(this._dataMissing(e,pr.MAP,t,c),this.requestUpdate())},s=c=>h=>i(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),zn(r)?GS(c):this._mapTileDataArrived(e,t,c)},r.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>i(c,h));if(VM(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],r).then(n,o)}if(QU(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(n,o);if(UQ(t)&&rce(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(c=>{if(zn(r))return ee.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(Wr());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);F7e(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,r).then(n,o)}_mapTileDataArrived(e,t,r){const i=this._getLayerIdxByUID(pr.MAP,t.uid);v(i)?e.dataArrived(i,pr.MAP,r):(GS(r),ee.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,r,i){const s=this._getLayerIdxByUID(t,r.uid);v(s)?e.dataMissing(s,t,i):ee.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const r=t.level;t.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(E(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),v(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const r=this._layerClassFromLayerView(e),i=this._getLayerIdxByUID(r,e.uid);return v(i)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(r,i)),t}getTile(e){if(E(e)||E(this._rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this._rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const r=2**t[0],i=Math.floor(t[1]/r),s=Math.floor(t[2]/r);let n;if(this._rootTiles.some(o=>o.lij[1]===i&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return Gf(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{v(e._rootTiles)&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){_B.clear(),e._allTiles.forAll(r=>{r.visible&&r.rendered&&_B.push(r)});const t=_B.toArray();return nEe(e.renderOrder,t),t},lockTilingScheme(t,r){e._extentHelper.defaultTiledLayersExtent=r,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTilesWaterproofness(){if(!t5)return;const e=this._rootTiles;if(E(e))return;const t=n=>{var o,a,l;return((l=(a=(o=n==null?void 0:n.renderData)==null?void 0:o.geometryInfo)==null?void 0:a.indices)==null?void 0:l.length)>0},r=(n,o)=>{t(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},i=n=>{var o,a,l;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometryInfo&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((o=n.renderData)!=null&&o.geometryInfo)||((l=(a=n.renderData.geometryInfo.indices)==null?void 0:a.length)!=null?l:0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometryInfo),t(n)){n.checkGeometryWaterproofness();for(const c of n.children)r(c,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const c of n.children)i(c)},s=n=>{var c,h;const o=(h=(c=n.parent)==null?void 0:c.visible)!=null?h:!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const p of n.children)s(p)};for(const n of e)i(n),s(n)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var t,r,i;((i=(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.ground)==null?void 0:i.shading)!==this._shading&&this._updateShading()}_updateShading(){var t,r,i;const e=(i=(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.ground)==null?void 0:i.shading;this._shading=e,this.renderer&&(this.renderer.shading=e,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(v(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<t)return e;if(!this.isGlobal)return null;const i=(r+(r<0?t:0))%t;return[e[0],e[1],i]}enableInternalChecks(e){Cdt(e)}enableWaterproofnessChecks(e){Edt(e)}};u([d()],rr.prototype,"_renderer",void 0),u([d({constructOnly:!0})],rr.prototype,"_scaleRangeQueries",void 0),u([d()],rr.prototype,"_hasPendingUpdates",void 0),u([d()],rr.prototype,"_asyncWorkItems",void 0),u([d()],rr.prototype,"_allTilesDirty",void 0),u([d()],rr.prototype,"_allTilesSorted",void 0),u([d()],rr.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],rr.prototype,"_watchUpdatingTracking",void 0),u([d()],rr.prototype,"_frameTask",void 0),u([d({readOnly:!0})],rr.prototype,"snapLevel",null),u([d({readOnly:!0})],rr.prototype,"lodSnapping",null),u([d({constructOnly:!0})],rr.prototype,"view",void 0),u([d()],rr.prototype,"_userClippingExtent",null),u([d()],rr.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],rr.prototype,"extent",null),u([d({readOnly:!0})],rr.prototype,"groundExtent",null),u([d({readOnly:!0})],rr.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],rr.prototype,"updating",null),u([d({readOnly:!0})],rr.prototype,"running",null),u([d(ypt)],rr.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],rr.prototype,"updatingProgressValue",null),u([d()],rr.prototype,"_maxNumUpdating",void 0),u([d()],rr.prototype,"baseOpacity",null),u([d()],rr.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],rr.prototype,"overlayManager",void 0),u([d({readOnly:!0})],rr.prototype,"viewingMode",null),u([d()],rr.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],rr.prototype,"ready",null),u([d({value:oC.FRONT_TO_BACK})],rr.prototype,"renderOrder",null),u([d({readOnly:!0})],rr.prototype,"rootTiles",null),u([d()],rr.prototype,"_rootTiles",void 0),u([d({readOnly:!0})],rr.prototype,"spatialReference",null),u([d({type:Qe})],rr.prototype,"backgroundColor",null),u([d({value:!1})],rr.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],rr.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],rr.prototype,"tilingSchemeLocked",null),u([d({readOnly:!0})],rr.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],rr.prototype,"velvetOverground",null),u([d()],rr.prototype,"wireframe",null),u([d({value:!1})],rr.prototype,"suspended",null),u([d()],rr.prototype,"textureFadeDuration",null),u([d()],rr.prototype,"visibleElevationBounds",void 0),u([d()],rr.prototype,"rootTileElevationBounds",void 0),u([d()],rr.prototype,"_layerViewsDirty",void 0),u([d()],rr.prototype,"renderPatchBorders",null),u([d()],rr.prototype,"visualizeNormals",null),u([d()],rr.prototype,"renderingDisabled",null),rr=u([P("esri.views.3d.terrain.TerrainSurface")],rr);const Hmt=rr;function Uce(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function LEe(e){const t=e.children;if(!t[0])return!1;for(const r of t)if(r.shouldLoad)return!0;for(const r of t)if(LEe(r))return!0;return!1}function qmt(e){var t,r;return e.isLeaf&&((r=(t=e.parent)==null?void 0:t.shouldLoad)!=null?r:!1)}const xl=sr(),Wmt=ur(),$L=[0,0,0],_B=new Jt,vB={spatialReference:null,extent:ur(),context:"ground"},LL={spatialReference:null,extent:null,scale:0};function kce(e,t,r){var i,s;for(const n of e){if(!n.containsPointXY(t,r))continue;let o=n;for(;o&&!o.renderData;){const l=(t>o.extentMidX?1:0)+(r<o.extentMidY?2:0);o=o.children[l]}const a=(s=(i=o==null?void 0:o.renderData)==null?void 0:i.geometryState.samplerData)!=null?s:null;return Xi(t,r,a)}return null}class Xmt{constructor(t,r,i){this.operation=t,this.geometry=r,this.states=i}}let v3=class extends Te{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((i,s)=>{const n=this._ensureGeomRecord(e,s);i.forEach(({geometry:o,operation:a,states:l},c)=>{let h=!1;if(a===cs.UPDATE){const p=n.get(c);if(p){if(l&kn.TRANSFORMATION){const f=this.model.getObject(s);this.model.updateRenderGeometryTransformation(f,o,p)&&(h=!0)}h||t.updates.push({renderGeometry:p,updateType:l})}else mt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(a===cs.REMOVE||h){const p=n.get(c);p?(t.removes.push(p),n.delete(c)):a===cs.REMOVE&&mt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(a===cs.ADD||h){const p=this.model.getObject(s);if(v(p)){const f=this.model.getRenderGeometry(p,o);t.adds.push(f),n.set(c,f)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach(i=>i.forEach(s=>t.push(s)))}_objectStateChanged(e,t){for(const r of t.geometries)this._updateOrCreateDirtyRecord(t,r,null,cs.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(kn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(kn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(kn.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,cs.UPDATE,kn.GEOMETRY)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const r=e.id;for(const i of t.geometries)this._objectGeometryAdded(t,i,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const r=e.id;for(const i of t.geometries)this._objectGeometryRemoved(t,i,r)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((r,i)=>{const s=this.model.getObject(i);s&&s.hasVolativeTransformation()&&r.forEach(n=>n.shaderTransformationChanged())})}objectTransformation(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach(i=>{this._updateOrCreateDirtyRecord(e,i.geometry,t,cs.UPDATE,kn.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,cs.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,cs.REMOVE)}_updateOrCreateDirtyRecord(e,t,r,i,s=kn.NONE){r=Pt(r,this._getParentLayerId(e));const n=e.id,o=t.id,a=this._ensureDirtyRecord(r,n),l=a.get(o);if(l){const c=l.operation;c===cs.REMOVE&&i===cs.ADD&&l.states!==kn.NONE?l.operation=cs.UPDATE:c===cs.REMOVE&&i===cs.ADD||c===cs.ADD&&i===cs.REMOVE?a.delete(o):c!==cs.UPDATE||i!==cs.REMOVE&&i!==cs.UPDATE?(mt((c===cs.REMOVE||c===cs.ADD)&&i===cs.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),l.states|=s):(l.operation=i,l.states|=s)}else a.set(o,new Xmt(i,t,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}get _hasDirtyGeometryRecords(){return ea(this._dirtyGeomRecords,e=>ea(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}_getParentLayerId(e){return v(e.parentLayer)?e.parentLayer.id:$Re}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((r,i)=>{r.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=i+"."+n;const o=[];s.forEach(a=>{const l=a.operation;o[l]||(o[l]=[]),o[l].push(a.geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,r)=>t+r.size,0)},commit:t=>e._dirtyGeomRecords.forEach((r,i)=>e.commitLayer(i,t))}}};u([d({constructOnly:!0})],v3.prototype,"model",void 0),u([d()],v3.prototype,"dirty",void 0),v3=u([P("esri.views.3d.webgl-engine.lib.ModelDirtySet")],v3);const Ymt=v3;let NN=class extends Te{constructor(){super(...arguments),this.dirtySet=new Ymt({model:this}),this._content=new Map,this._originFactory=new mQ(null)}getObject(e){return this._content.get(e)}add(e){const t=e.id;mt(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),j4(e)&&this.dirtySet.layerAdded(e)}remove(e){mt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),j4(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)v(t)&&(mt(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)mt(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(r=>{r.type===e&&t(r)})}getRenderGeometry(e,t){const{shaderTransformer:r,localOrigin:i}=t,s=new nC(t,{boundingInfo:t.boundingInfo,shaderTransformer:r,castShadow:e.castShadow});return s.updateTransformation(n=>e.getCombinedStaticTransformation(t,n)),s.localOrigin=v(i)?i:this._originFactory.getOrigin(s.boundingSphere),s}updateRenderGeometryTransformation(e,t,r){if(E(e))return!1;r.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const i=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==i}getStats(){const e={},t=Array.from(this._content.values());for(let r=0;r<Fs.COUNT;++r)e[r]=t.filter(i=>i.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],NN.prototype,"dirtySet",void 0),NN=u([P("esri.views.3d.webgl-engine.parts.Model")],NN);function Zmt(){const e=new Float32Array(4);return e[3]=1,e}function DEe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Jmt(e,t,r,i){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function NEe(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:DEe,create:Zmt,createView:NEe,fromValues:Jmt},Symbol.toStringTag,{value:"Module"}));const lC=1e-6,XA=[0,0,0],DL=[0,0,0];function Qmt(e,t){const{data:r,size:i}=e,s=r.length/i;if(s<=0)return;const n=new agt(e);FN(XA,n.minProj,n.maxProj),Hb(XA,XA,.5),Nh(DL,n.maxProj,n.minProj);const o=Mq(DL),a=new lgt;a.quality=o,s<14&&(e=new Je(new Float64Array(n.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(Kmt(n,e,y,l,c,h,p,f,m,a)){case 1:return void Gce(XA,DL,t);case 2:return void ogt(e,p,t)}egt(e,y,l,c,h,p,f,m,a),FEe(e,a.b0,a.b1,a.b2,WS,XS);const _=[0,0,0];Nh(_,XS,WS),a.quality=Mq(_),a.quality<o?UEe(a.b0,a.b1,a.b2,WS,XS,_,t):Gce(XA,DL,t)}function Kmt(e,t,r,i,s,n,o,a,l,c){return tgt(e,i,s),Pq(i,s)<lC?1:(Nh(o,i,s),Zo(o,o),rgt(t,i,o,n)<lC?2:(Nh(a,s,n),Zo(a,a),Nh(l,n,i),Zo(l,l),Fh(r,a,o),Zo(r,r),xb(t,r,o,a,l,c),0))}const YA=[0,0,0],ZA=[0,0,0],ih=[0,0,0],sh=[0,0,0],nh=[0,0,0],E0=[0,0,0],C0=[0,0,0],A0=[0,0,0];function egt(e,t,r,i,s,n,o,a,l){igt(e,t,r,YA,ZA),YA[0]!==void 0&&(Nh(ih,YA,r),Zo(ih,ih),Nh(sh,YA,i),Zo(sh,sh),Nh(nh,YA,s),Zo(nh,nh),Fh(E0,sh,n),Zo(E0,E0),Fh(C0,nh,o),Zo(C0,C0),Fh(A0,ih,a),Zo(A0,A0),xb(e,E0,n,sh,ih,l),xb(e,C0,o,nh,sh,l),xb(e,A0,a,ih,nh,l)),ZA[0]!==void 0&&(Nh(ih,ZA,r),Zo(ih,ih),Nh(sh,ZA,i),Zo(sh,sh),Nh(nh,ZA,s),Zo(nh,nh),Fh(E0,sh,n),Zo(E0,E0),Fh(C0,nh,o),Zo(C0,C0),Fh(A0,ih,a),Zo(A0,A0),xb(e,E0,n,sh,ih,l),xb(e,C0,o,nh,sh,l),xb(e,A0,a,ih,nh,l))}function tgt(e,t,r){let i=Pq(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=Pq(e.maxVert[n],e.minVert[n]);o>i&&(i=o,s=n)}$c(t,e.minVert[s]),$c(r,e.maxVert[s])}const oh=[0,0,0];function rgt(e,t,r,i){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){oh[0]=s[l]-t[0],oh[1]=s[l+1]-t[1],oh[2]=s[l+2]-t[2];const c=r[0]*oh[0]+r[1]*oh[1]+r[2]*oh[2],h=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],p=oh[0]*oh[0]+oh[1]*oh[1]+oh[2]*oh[2]-c*c/h;p>o&&(o=p,a=l)}return $c(i,s,a),o}const Un=[0,0];function igt(e,t,r,i,s){ngt(e,t,Un,s,i);const n=VEe(r,t);Un[1]-lC<=n&&(i[0]=void 0),Un[0]+lC>=n&&(s[0]=void 0)}const Vce=[0,0,0],Bce=[0,0,0],zce=[0,0,0],MT=[0,0,0],PT=[0,0,0],NL=[0,0,0];function xb(e,t,r,i,s,n){if(kEe(t)<lC)return;Fh(Vce,r,t),Fh(Bce,i,t),Fh(zce,s,t),qS(e,t,Un),PT[1]=Un[0],MT[1]=Un[1],NL[1]=MT[1]-PT[1];const o=[r,i,s],a=[Vce,Bce,zce];for(let l=0;l<3;++l){qS(e,o[l],Un),PT[0]=Un[0],MT[0]=Un[1],qS(e,a[l],Un),PT[2]=Un[0],MT[2]=Un[1],NL[0]=MT[0]-PT[0],NL[2]=MT[2]-PT[2];const c=Mq(NL);c<n.quality&&($c(n.b0,o[l]),$c(n.b1,t),$c(n.b2,a[l]),n.quality=c)}}const sgt=[0,0,0];function qS(e,t,r){const{data:i,size:s}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*t[0]+i[n+1]*t[1]+i[n+2]*t[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function ngt(e,t,r,i,s){const{data:n,size:o}=e;$c(i,n),$c(s,i),r[0]=VEe(sgt,t),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<r[0]&&(r[0]=l,$c(i,n,a)),l>r[1]&&(r[1]=l,$c(s,n,a))}}function Gce(e,t,r){$c(r.center,e),Hb(r.halfSize,t,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const lg=[0,0,0],IT=[0,0,0],JA=[0,0,0],WS=[0,0,0],XS=[0,0,0],jce=[0,0,0];function ogt(e,t,r){$c(lg,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?lg[0]=0:Math.abs(t[1])>Math.abs(t[2])?lg[1]=0:lg[2]=0,kEe(lg)<lC&&(lg[0]=lg[1]=lg[2]=1),Fh(IT,t,lg),Zo(IT,IT),Fh(JA,t,IT),Zo(JA,JA),FEe(e,t,IT,JA,WS,XS),Nh(jce,XS,WS),UEe(t,IT,JA,WS,XS,jce,r)}function FEe(e,t,r,i,s,n){qS(e,t,Un),s[0]=Un[0],n[0]=Un[1],qS(e,r,Un),s[1]=Un[0],n[1]=Un[1],qS(e,i,Un),s[2]=Un[0],n[2]=Un[1]}const FL=[0,0,0],lf=[1,0,0,0,1,0,0,0,1],$T=[0,0,0];function UEe(e,t,r,i,s,n,o){lf[0]=e[0],lf[1]=e[1],lf[2]=e[2],lf[3]=t[0],lf[4]=t[1],lf[5]=t[2],lf[6]=r[0],lf[7]=r[1],lf[8]=r[2],cgt(o.quaternion,lf),FN($T,i,s),Hb($T,$T,.5),Hb(o.center,e,$T[0]),Hb(FL,t,$T[1]),FN(o.center,o.center,FL),Hb(FL,r,$T[2]),FN(o.center,o.center,FL),Hb(o.halfSize,n,.5)}const tu=7;class agt{constructor(t){this.minVert=new Array(tu),this.maxVert=new Array(tu);const r=64*tu;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,tu),i+=8*tu,this.maxProj=new Float64Array(this.buffer,i,tu),i+=8*tu;for(let l=0;l<tu;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<tu;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<tu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(tu),n=new Array(tu),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<tu;++l){let c=s[l];$c(this.minVert[l],o,c),c=n[l],$c(this.maxVert[l],o,c)}}}class lgt{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function Mq(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function FN(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function Nh(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function Hb(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function $c(e,t,r=0){e[0]=t[r+0],e[1]=t[r+1],e[2]=t[r+2]}function Fh(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2];e[0]=s*l-n*a,e[1]=n*o-i*l,e[2]=i*a-s*o}function Zo(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function kEe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function Pq(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function VEe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cgt(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(t[3*i+i]-t[3*s+s]-t[3*n+n]+1);e[i]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+i]+t[3*i+s])*o,e[n]=(t[3*n+i]+t[3*i+n])*o}}const bO=cd(),ow=M(),ugt=M(),hgt=ns();class RSt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:dW(this.buffer,56*a+0),halfSize:Rbe(this.buffer,56*a+24),quaternion:NEe(this.buffer,56*a+36)}}}function BEe(e=[0,0,0],t=[-1,-1,-1],r=cd()){return{center:bs(e),halfSize:f4(t),quaternion:DEe(r)}}function Hce(e){return BEe(e.center,e.halfSize,e.quaternion)}function OSt(e,t){le(t.center,e.center),le(t.halfSize,e.halfSize),hJ(t.quaternion,e.quaternion)}function MSt(e,t){return t=t||BEe(),Qmt(e,t),t}function Tb(e,t){const r=Ei(t,e.center),i=l8(e,t);return r>i?1:r<-i?-1:0}function PSt(e,t){t||(t=In());const r=QZ(hgt,e.quaternion),i=e.halfSize[0]*Math.abs(r[0])+e.halfSize[1]*Math.abs(r[3])+e.halfSize[2]*Math.abs(r[6]),s=e.halfSize[0]*Math.abs(r[1])+e.halfSize[1]*Math.abs(r[4])+e.halfSize[2]*Math.abs(r[7]),n=e.halfSize[0]*Math.abs(r[2])+e.halfSize[1]*Math.abs(r[5])+e.halfSize[2]*Math.abs(r[8]);return t[0]=e.center[0]-i,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+i,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function ISt(e,t){return Ei(t,e.center)-l8(e,t)}function $St(e,t){return Ei(t,e.center)+l8(e,t)}function LSt(e,t){return Tb(e,t[0])<=0&&Tb(e,t[1])<=0&&Tb(e,t[2])<=0&&Tb(e,t[3])<=0&&Tb(e,t[4])<=0&&Tb(e,t[5])<=0}function DSt(e,t,r,i=0){ix(bO,e.quaternion),ge(ow,t,e.center);const s=bp(ow,ow,bO),n=bp(ugt,r,bO);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+e.halfSize[l]-s[l])/n[l],h=(-i-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+i||s[l]<-e.halfSize[l]-i)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const r=i=>{for(let s=0;s<i.length;s++)e[t+s]=i[s];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function l8(e,t){ix(bO,e.quaternion),bp(ow,t,bO);const r=e.halfSize;return Math.abs(ow[0]*r[0])+Math.abs(ow[1]*r[1])+Math.abs(ow[2]*r[2])}function NSt(e,t){for(let r=0;r<8;++r){const i=t[r];i[0]=1&r?-e.halfSize[0]:e.halfSize[0],i[1]=2&r?-e.halfSize[1]:e.halfSize[1],i[2]=4&r?-e.halfSize[2]:e.halfSize[2],bp(i,i,e.quaternion),me(i,i,e.center)}}function dgt(e){return _c(e.halfSize)}function pgt(e,t,r,i,s){if(hJ(s.quaternion,e.quaternion),i===Ge.Global){ix(UL,e.quaternion),bp(R0,e.center,UL),zB(LT,R0),Xhe(DT,LT,e.halfSize),lo(DT,LT,DT);const n=Me(DT);me(DT,LT,e.halfSize);const o=Me(DT);if(n<r)le(s.center,e.center),ce(R0,r,r,r),me(s.halfSize,e.halfSize,R0);else{const a=o>0?1+t/o:1,l=n>0?1+r/n:1,c=(l+a)/2,h=(l-a)/2;ae(s.halfSize,LT,h),Wb(s.halfSize,s.halfSize,e.halfSize,c),ae(s.center,LT,c),Wb(s.center,s.center,e.halfSize,h),Whe(R0,R0),S5(s.center,s.center,R0),bp(s.center,s.center,s.quaternion)}}else{const n=ce(R0,0,0,1);Wb(s.center,e.center,n,(r+t)/2),ix(UL,e.quaternion),bp(n,n,UL),zB(n,n),Wb(s.halfSize,e.halfSize,n,(r-t)/2)}return s}const R0=M(),LT=M(),DT=M(),UL=cd();class fgt{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let r=0;for(let i=0;i<t.length;i+=2)r+=t[i+1];return r}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=mgt(t)}forEachComponent(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!t(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(t){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=t[n],l=t[o];r[s]=a,r[s+1]=l-a}return r}}function mgt(e){const t=new Array;if(e.length===0)return t;let r=e[0],i=1;for(let s=1;s<e.length;s++){const n=e[s];r+i===n?i+=1:(t.push(r),t.push(i),r=n,i=1)}return t.push(r),t.push(i),t}class ggt{constructor(t,r){this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=r.slice();const i=this.count;this.visibility=new fgt(i),this.materialDataBuffer=t.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return E(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return E(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return E(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((E(this.cachedHighlightRanges)||E(this.cachedDefaultRanges))&&v(this.highlightCounts)){const{highlightRanges:t,defaultRanges:r}=ygt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=r}}}function ygt(e,t,r){const i=[],s=[];let n=r.length,o=r.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}let b3=class extends Te{constructor(){super(...arguments),this.visible=YS.Hidden}};var YS;u([d({autoDestroy:!0})],b3.prototype,"renderable",void 0),u([d({autoDestroy:!0})],b3.prototype,"components",void 0),b3=u([P("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],b3),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(YS||(YS={}));function _gt(e,t,r,i){if(r>=t)return e;e==null&&(e=vgt());const s=e.isVisibleBit;let n=e.data;const o=GEe(n),a=r/o|0,l=r-o*a,c=(t-1)/o|0,h=n,p=i===s;if(!(r<h.length*o)&&p){const m=a+1,y=Math.ceil(h.length*1.5),_=c+1;let b=Math.max(m,y);b=Math.min(b,_),n=new Uint32Array(b),n.set(h)}return a<n.length&&(n[a]=wgt(n[a],l,p)),e.data=n,e}function zEe(e,t){if(e==null)return!0;const{isVisibleBit:r,data:i}=e,s=GEe(i);return t<i.length*s?bgt(r,i,t,s):!e.isVisibleBit}function vgt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function bgt(e,t,r,i){const s=r/i|0,n=r-s*i;return xgt(t[s],n)===e}function GEe(e){return e.BYTES_PER_ELEMENT*8}function wgt(e,t,r){return e&~(1<<t)|(r?1:0)<<t}function xgt(e,t){return(e&1<<t)!=0}class Tgt{constructor(t,r){this._indices=v(t.indices)?t.indices:XE(t.positions.length/3),this._positions=new mi(t.positions),this._components=r,this._componentIntersectionData=new Array(r.count)}getComponentAabb(t,r){if(v(this._perComponentAabbs)){for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*t+i];return r}return this._computePerComponentAabbs(),this.getComponentAabb(t,r)}getComponentPositions(t,r){r.indices=this._indices,r.data=this._positions.typedBuffer,r.stride=this._positions.typedBufferStride,r.startIndex=this._components.offsets[t],r.endIndex=this._components.offsets[t+1]}intersect(t,r,i,s,n,o,a){const l=new Je(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),c=this._indices,h=this._components.offsets,p=zxe(t,r,Sgt),f=t[2],m=r[2];this._components.visibility.forEachComponent(y=>{if(!zEe(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,Egt);if(v(o)){const C=o[y];v(n)?n.componentOffset=C:(t[2]=f-C,r[2]=m-C)}if(v(n)&&n.applyToAabb(_),!GJ(_,t,p,i))return!0;const b=h[y]/3,x=h[y+1]/3,T=x-b,S=(C,O,R)=>a(y,C,Mc(O,O,s),R);return E(n)&&T>IEe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new aC(this._indices,b,x,l)),this._componentIntersectionData[y].intersectRay({r0:t,r1:r},S)):zP(t,r,b,x,c,l,void 0,n,S),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const r=this._indices,i=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,_=-1/0;for(let b=l;b<c;b++){const x=r[b]*s,T=i[x],S=i[x+1],C=i[x+2];h=Math.min(h,T),p=Math.min(p,S),f=Math.min(f,C),m=Math.max(m,T),y=Math.max(y,S),_=Math.max(_,C)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=y,this._perComponentAabbs[o++]=_}}get positions(){return this._positions}get indices(){return this._indices}}const Sgt=M(),Egt=In();class Cgt{constructor(t,r,i){this.material=t,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}}class Agt{constructor(t,r,i,s){this.vao=t,this.primitiveType=r,this.parameters=i,this.indexed=s}dispose(){this.vao.dispose()}}class Rgt{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}}function Ogt(e,t){return{near:e,far:t}}function eI(e){return e?jM(e,1/0,-1/0):Ogt(1/0,-1/0)}function jM(e,t,r){return e.near=t,e.far=r,e}function cC(e,t,r=e){return t!=null&&(r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far)),r}function kL(e,t){return e.near<=t&&t<=e.far}const Iq={near:0,far:0};function Mgt(e,t){const r=eI(),{eye:i,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=v(o.offsetObb)?o.offsetObb:o.obb,l=_e(lo(lu,a.center,i),n),c=l8(a,n);if(kL(r,l-c)&&kL(r,l+c))return;const h=Dgt(a,s);if(h===-1)return;if(h===0)return cg.far=l+c,cg.near=l-c,void cC(r,cg);const p=VL.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<VL.length;o++){const a=VL.data[o];if(kL(r,a.near)&&kL(r,a.far))continue;cg.far=a.far,cg.near=1/0,Lgt(v(a.object.offsetObb)?a.object.offsetObb:a.object.obb,i,Pgt,c=>{let h=Igt;for(let p=0;p<jEe&&c.length>0;p++){if((a.mask&1<<p)==0)continue;$gt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){ce(Dl,c.data[p+0],c.data[p+1],c.data[p+2]);const f=_e(lo(Dl,Dl,i),n);cg.near=Math.min(cg.near,f)}})===0&&(cg.near=0),cC(r,cg)}return VL.length=0,r}const VL=new Jt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=Sw(e.object),e)}),cg=eI(),Dl=M(),O1=M(),Pgt=new Jt({deallocator:null}),Igt=new Jt({deallocator:null});function $gt(e,t,r){r.length=0;const i=t.length-3;bB(Dl,t,i);const s=Ei(e,Dl);s<=0&&(r.push(Dl[0]),r.push(Dl[1]),r.push(Dl[2]));let n=0,o=s;for(;n<i;n+=3){bB(O1,t,n);const a=Ei(e,O1);o*a<0&&(rn(Dl,O1,Dl,a/(a-o)),Nl(r,Dl)),a<=0&&Nl(r,O1),o=a,le(Dl,O1)}o*s<0&&(bB(O1,t,i),rn(Dl,O1,Dl,s/(s-o)),Nl(r,Dl))}function bB(e,t,r){return ce(e,t.data[r+0],t.data[r+1],t.data[r+2])}function Nl(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function Lgt(e,t,r,i){ix(Wce,e.quaternion),lo(lu,t,e.center),bp(lu,lu,Wce);const s=8*((lu[0]<-e.halfSize[0]?-1:lu[0]>e.halfSize[0]?1:0)+3*(lu[1]<-e.halfSize[1]?-1:lu[1]>e.halfSize[1]?1:0)+9*(lu[2]<-e.halfSize[2]?-1:lu[2]>e.halfSize[2]?1:0)+13),n=qce[s];if(n===0)return n;QZ(BL,e.quaternion),JZ(BL,BL,e.halfSize);const o=(a,l)=>{const c=qce[s+l+1];return ce(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Mc(a,a,BL),me(a,e.center,a)};return r.length=0,Nl(r,o(wB,0)),Nl(r,o(Xce,1)),Nl(r,o(lu,2)),Nl(r,o(Yce,3)),i(r),n===1||(r.length=0,Nl(r,wB),Nl(r,Yce),Nl(r,o(lu,4)),Nl(r,o(Zce,5)),i(r),n===2||(r.length=0,Nl(r,wB),Nl(r,Zce),Nl(r,o(lu,6)),Nl(r,Xce),i(r))),n}const qce=(()=>{const e=new Int8Array(216);let t=0;const r=i=>{for(let s=0;s<i.length;s++)e[t+s]=i[s];t+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),e})(),jEe=4;function Dgt(e,t){let r=0;for(let i=0;i<jEe;i++){const s=Tb(e,t[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const BL=ns(),Wce=cd(),lu=M(),wB=M(),Xce=M(),Yce=M(),Zce=M();class Ngt{constructor(t){this._objects=t}submit(t,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(t,r,i))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?Mgt(t,this._objects.visibleObjects):null}}function Fgt(e){const t=os().vec3f(A.POSITION);return e.normals&&t.vec2i16(A.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===Js.Default?t.vec2f(A.UV0):e.textureCoordinates===Js.Atlas&&(t.vec2f(A.UV0),t.vec4u16(A.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(A.COLOR,{glNormalized:!0}),t.alignTo(4)}class Ugt{constructor(){this.externalColor=sr(),this.externalColorMixMode=Sn.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}}class kgt extends Es{constructor(t,r){super(t,"int",fi.Draw,(i,s,n)=>i.setUniform1i(t,r(s,n)))}}var dm;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(dm||(dm={}));const JQ=429496.7296;function HEe(e,t){AM(e/JQ*.5+.5,t)}function Vgt(e,t){switch(t.componentData){case dm.Varying:return Bgt(e,t);case dm.Uniform:return zgt(e);case dm.COUNT:return;default:t.componentData}}function Bgt(e,t){const{vertex:r,fragment:i}=e;r.include(jc),r.uniforms.add(iv("componentColorTex",n=>n.componentParameters.texture.texture,t.hasWebGL2Context?ei.None:ei.Size)),e.attributes.add(A.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4");const s=t.output===k.ObjectAndLayerIdColor;s&&e.varyings.add("vObjectAndLayerIdColor","vec4"),e.include(X2e),r.constants.add("elevationScale","float",2*JQ),r.constants.add("stride","float",de("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(w`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${Hh(t,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),r.code.add(w`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${rl(t,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${rl(t,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?w`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${rl(t,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:w`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(w`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?w`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function zgt(e){const{vertex:t,fragment:r}=e;t.uniforms.add(new o5("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new kgt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(w`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(w`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var Vh;function Ggt(e,t){const r=e.vertex;switch(r.code.add(w`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case Vh.None:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Vh.Opaque:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Vh.Transparent:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Vh||(Vh={}));var pm;function FSt(e){return e&&Om(e)?pm.Mars:e&&Mm(e)?pm.Moon:pm.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(pm||(pm={}));var Cu;(function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"})(Cu||(Cu={}));class _r extends $a{constructor(){super(...arguments),this.output=k.Color,this.textureCoordinateType=Js.None,this.componentData=dm.Uniform,this.cullFace=Oi.Back,this.vertexDiscardMode=Vh.None,this.doubleSidedMode=fs.WindingOrder,this.alphaDiscardMode=di.Opaque,this.integratedMeshMode=Cu.None,this.transparencyPassType=xt.NONE,this.ellipsoidMode=pm.Earth,this.pbrMode=ht.Disabled,this.normalType=oi.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}}u([B({count:k.COUNT})],_r.prototype,"output",void 0),u([B({count:Js.COUNT})],_r.prototype,"textureCoordinateType",void 0),u([B({count:dm.COUNT})],_r.prototype,"componentData",void 0),u([B({count:Oi.COUNT})],_r.prototype,"cullFace",void 0),u([B({count:Vh.COUNT})],_r.prototype,"vertexDiscardMode",void 0),u([B({count:fs.COUNT})],_r.prototype,"doubleSidedMode",void 0),u([B({count:di.COUNT})],_r.prototype,"alphaDiscardMode",void 0),u([B({count:Cu.COUNT})],_r.prototype,"integratedMeshMode",void 0),u([B({count:xt.COUNT})],_r.prototype,"transparencyPassType",void 0),u([B({count:pm.COUNT})],_r.prototype,"ellipsoidMode",void 0),u([B({count:ht.COUNT})],_r.prototype,"pbrMode",void 0),u([B({count:oi.COUNT})],_r.prototype,"normalType",void 0),u([B()],_r.prototype,"spherical",void 0),u([B()],_r.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],_r.prototype,"hasVertexColors",void 0),u([B()],_r.prototype,"hasNormals",void 0),u([B()],_r.prototype,"hasSlicePlane",void 0),u([B()],_r.prototype,"hasBaseColorTexture",void 0),u([B()],_r.prototype,"receiveAmbientOcclusion",void 0),u([B()],_r.prototype,"receiveShadows",void 0),u([B()],_r.prototype,"blendingEnabled",void 0),u([B()],_r.prototype,"hasScreenSpaceReflections",void 0),u([B()],_r.prototype,"hasPolygonOffset",void 0),u([B()],_r.prototype,"hasMetallicRoughnessTexture",void 0),u([B()],_r.prototype,"hasEmissionTexture",void 0),u([B()],_r.prototype,"hasOcclusionTexture",void 0),u([B()],_r.prototype,"hasNormalTexture",void 0),u([B()],_r.prototype,"hasOccludees",void 0),u([B()],_r.prototype,"hasMultipassTerrain",void 0),u([B()],_r.prototype,"cullAboveGround",void 0),u([B()],_r.prototype,"useLegacyTerrainShading",void 0),u([B()],_r.prototype,"hasCloudsReflections",void 0),u([B()],_r.prototype,"snowCover",void 0),u([B()],_r.prototype,"objectAndLayerIdColor",void 0),u([B()],_r.prototype,"hasWebGL2Context",void 0),u([B({constValue:fi.Draw})],_r.prototype,"pbrTextureBindType",void 0),u([B({constValue:!0})],_r.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],_r.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],_r.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],_r.prototype,"hasVertexTangents",void 0),u([B({constValue:!0})],_r.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!1})],_r.prototype,"highStepCount",void 0),u([B({constValue:!1})],_r.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!0})],_r.prototype,"useFillLights",void 0),u([B({constValue:!1})],_r.prototype,"objectAndLayerIdColorInstanced",void 0);function Jce(e,t){e.include(Mx,t),e.fragment.include(DM);const r=e.fragment;r.uniforms.add(new o5("baseColor",i=>i.baseColor)),r.uniforms.add(new vw("objectOpacity",i=>i.objectOpacity)),t.hasVertexColors?r.code.add(w`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(w`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(w`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Qce(e,t){const r=e.fragment;switch(t.doubleSidedMode){case fs.None:r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case fs.View:e.include($S,t),r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case fs.WindingOrder:r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case fs.COUNT:}switch(t.normalType){case oi.Attribute:case oi.CompressedAttribute:e.include(MU,t),r.code.add(w`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case oi.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include($S,t),r.code.add(w`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case oi.Ground:t.spherical?(e.include($S,t),r.code.add(w`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(w`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),r.code.add(w`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case oi.COUNT:}}function jgt(e,t){const r=e.fragment;if(t.hasBaseColorTexture&&(t.output===k.Color||t.alphaDiscardMode!==di.Opaque)){e.include(GZ,t);const i=t.textureCoordinateType===Js.Atlas;r.uniforms.add(iv("baseColorTexture",s=>s.texture,i?t.hasWebGL2Context?ei.None:ei.Size:ei.None)),i?(e.include($be),r.code.add(w`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${Hh(t,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):r.code.add(w`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else r.code.add(w`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Hgt(e){const t=new Lr;t.include($S,e),t.include(MU,e),t.include(Mx,e),t.include(um,e),t.include(LC,e),t.include(Vgt,e),t.include(eot,e),t.include(Xtt,e),t.include(jgt,e),t.include(Ggt,e);const{vertex:r,fragment:i}=t;e.pbrMode!==ht.Normal&&e.pbrMode!==ht.Schematic||(t.include(HZ,e),e.hasNormalTexture&&t.include(Q2e,e));const s=e.output===k.Shadow||e.output===k.ShadowHighlight||e.output===k.ShadowExcludeHighlight;s&&e.componentData===dm.Varying?r.code.add(w`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(w`#define discardShadows(castShadows) {}`);const n=e.integratedMeshMode===Cu.ColorOverlay||e.integratedMeshMode===Cu.ColorOverlayWithWater,o=n&&e.output===k.Color&&e.pbrMode===ht.WaterOnIntegratedMesh;return n&&(t.include(cx,e),t.include(xft,e),e.spherical?r.code.add(w`
      const float invEllipsoidRadius = ${w.float(1/(e.ellipsoidMode===pm.Earth?br.radius:e.ellipsoidMode===pm.Mars?nm.radius:fy.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(w`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),r.code.add(w`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${e.output===k.ObjectAndLayerIdColor?w`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${w.float(sa)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${e.output===k.ObjectAndLayerIdColor?w`forwardObjectAndLayerIdColor();`:""}
      ${o?e.spherical?w`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:w`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?w`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===k.Alpha&&(i.include(Gu),t.include(ju,e),t.include(Jce,e),n&&i.uniforms.add(new Mt("ovColorTex",(a,l)=>Aq(a,l))),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?w`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===k.Color&&(i.include(Gu),t.include(ju,e),t.include(Jce,e),t.include(Qce,e),t.include(cx,e),e.receiveShadows?(t.include(PU,e),i.code.add(w`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(w`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new Mt("ovColorTex",(a,l)=>Aq(a,l))),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?w`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===ht.Normal||e.pbrMode===ht.Schematic?(Dm(i),i.code.add(w`
        ${e.pbrMode===ht.Normal?w`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),e.hasNormalTexture?i.code.add(w`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(w`vec3 shadingNormal = normalVertex;`),i.code.add(w`${e.spherical?w`vec3 normalGround = normalize(positionWorld());`:w`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(w`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?w`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?w` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?i.code.add(w`float shadow = evaluateShadow();`):e.spherical?(GC(i),i.code.add(w`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(w`float shadow = 0.0;`),o&&i.uniforms.add(new Mt("ovNormalTex",(a,l)=>QQ(l))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),i.code.add(w`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),i.code.add(w`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?w` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?w`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(w`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===xt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(e.output===k.Depth||s)&&(t.include(Sy,e),i.code.add(w`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===k.Normal&&(t.include(Qce,e),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===oi.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===k.ObjectAndLayerIdColor&&t.fragment.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?w`gl_FragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),e.output===k.Highlight&&(t.include(Uy,e),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?w`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function QQ(e){return e.overlays.length===0?null:e.overlays[is.INNER].getValidTexture(vs.Water)}const qgt=Object.freeze(Object.defineProperty({__proto__:null,build:Hgt,getOverlayNormalTexture:QQ},Symbol.toStringTag,{value:"Module"}));class c8 extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2,r.spherical=t.viewingMode===Ge.Global,r.doublePrecisionRequiresObfuscation=t.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(t){return new Nr(t.rctx,c8.shader.get().build(this.configuration),qEe)}_setPipelineState(t){const r=this.configuration,i=r.integratedMeshMode!==Cu.None,s=t===xt.NONE,n=t===xt.FrontFace;return Vt({blending:r.output!==k.Color&&r.output!==k.Alpha||!r.blendingEnabled?null:s?Fu:ky(t),culling:H6(r.cullFace),depthTest:{func:zv(t)},depthWrite:s||n?Jl:null,colorWrite:Qt,stencilWrite:i||r.hasOccludees?Rm:null,stencilTest:i?Ust(ql.IntegratedMeshMaskExcluded):r.hasOccludees?Gv:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:bU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}c8.shader=new Dr(qgt,()=>ie(()=>import("./ComponentShader.glsl.ba3d6ba5.js"),[]));const qEe=new Map([[A.POSITION,0],[A.NORMAL,1],[A.NORMALCOMPRESSED,1],[A.COLOR,2],[A.UV0,3],[A.UVREGION,4],[A.COMPONENTINDEX,5]]);class Wgt extends gi{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class KQ{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function ys(e={}){return(t,r)=>{var s;const i=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=i+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,r,{get(){return this[i]},set(o){const a=this[i];if(a==null)this[i]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,r,{get(){return this[i]},set(n){this[i]!==n&&(e.dispose&&this[i]&&this[i].dispose(),this[i]=n,this._setDirty())}})}}function Kce(){return(e,t)=>{var i;const r=(i=e._parameterCount)!=null?i:0;e._parameterCount=r+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(r),Object.defineProperty(e,t,{get(){return this[r]},set(s){this[r]!==s&&(this[r]=s,this._setDirty())}})}}class u8{constructor(t){this._low=qi(),this._high=qi(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const r=this._low,i=this._high;le(r,t),lo(i,t,r)}setElements(t,r,i){ce(eue,t,r,i),this.set(eue)}get(t){return me(t,this._low,this._high)}getLowScaled(t){return ae(t,this._low,1)}}const eue=M();class to extends Wgt{constructor(t,r){super(),this.toMapSpace=r,this.baseColor=Up(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Yr(1,1,.5),this.emissiveFactor=Yr(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new UN,this.componentParameters=new wO,this.textureAlphaCutoff=V4,this.alphaDiscardMode=di.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=pm.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new _r;const i=new u8(t.position),s=K2e(t.rotationScale);Ax(s,s),this.transformNormalGlobalFromModel=sd(s,s),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=Wi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return v(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return v(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return v(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return v(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=v(this.metallicRoughnessTexture),n.hasEmissionTexture=v(this.emissionTexture),n.hasOcclusionTexture=v(this.occlusionTexture),n.hasNormalTexture=v(this.normalTexture),n.transparencyPassType=r.identifier===Oc.Material&&i.transparencyPassType!=null?i.transparencyPassType:xt.NONE,n.hasMultipassTerrain=r.identifier===Oc.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===Oc.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?fs.View:fs.None,n.hasBaseColorTexture=v(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Xa.Transparent||o===Xa.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?Ygt(i)?QQ(i)?Cu.ColorOverlayWithWater:Cu.ColorOverlay:Cu.NoOverlay:Cu.None,n.useLegacyTerrainShading=this.isIntegratedMesh&&Xr.TERRAIN_USE_LEGACY_SHADING,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&E(this.baseColorTexture);if(n.pbrMode=n.integratedMeshMode===Cu.ColorOverlayWithWater?ht.WaterOnIntegratedMesh:this.usePBR?a?ht.Schematic:ht.Normal:ht.Disabled,n.normalType=n.integratedMeshMode===Cu.None?n.hasNormals?oi.CompressedAttribute:oi.ScreenDerivative:oi.Ground,n.hasSlicePlane=v(i.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,r.identifier===Oc.ShadowMap)n.output=k.Shadow,n.vertexDiscardMode=Vh.None;else if(r.identifier===Oc.Highlight)n.output=k.Highlight,n.vertexDiscardMode=Vh.None;else{switch(this._computeWhichMaterialPass()===Xa.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?Vh.Opaque:Vh.Transparent:n.vertexDiscardMode=Vh.None,n.output=r.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,r.output){case k.Color:n.receiveAmbientOcclusion=i.ssaoHelper.active,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=v(i.cloudsFade.data);break;case k.Alpha:n.hasOccludees=i.hasOccludees;break;case k.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(i)}return this._technique=t.releaseAndAcquire(c8,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return v(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Xa.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case Xa.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case Xa.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case Xa.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),Xgt(r)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==Bn.None;h&&t.shadowMap.submitDraw(this,s,a,o),v(l)&&(t.highlight.submitDraw(this,s,l,o),h&&t.highlightShadowMap.submitDraw(this,s,l,o)),h&&v(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Xa.IntegratedMesh:this.objectOpacity<1?Xa.Transparent:this.componentParameters.opaqueOverride===Bn.All?Xa.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===di.Blend||this.alphaDiscardMode===di.MaskBlend?Xa.Transparent:this.componentParameters.transparent===Bn.None?Xa.Opaque:this.componentParameters.transparent===Bn.All?Xa.Transparent:Xa.OpaqueAndTransparent}}var Xa,Bn;u([ys({vectorOps:rde})],to.prototype,"baseColor",void 0),u([ys()],to.prototype,"usePBR",void 0),u([ys()],to.prototype,"hasParametersFromSource",void 0),u([ys({vectorOps:dK})],to.prototype,"mrrFactors",void 0),u([ys({vectorOps:dK})],to.prototype,"emissiveFactor",void 0),u([ys({dispose:!0})],to.prototype,"baseColorTexture",void 0),u([ys({dispose:!0})],to.prototype,"metallicRoughnessTexture",void 0),u([ys({dispose:!0})],to.prototype,"emissionTexture",void 0),u([ys({dispose:!0})],to.prototype,"occlusionTexture",void 0),u([ys({dispose:!0})],to.prototype,"normalTexture",void 0),u([ys()],to.prototype,"objectOpacity",void 0),u([Kce()],to.prototype,"commonMaterialParameters",void 0),u([Kce()],to.prototype,"componentParameters",void 0),u([ys()],to.prototype,"textureAlphaCutoff",void 0),u([ys()],to.prototype,"alphaDiscardMode",void 0),u([ys()],to.prototype,"isIntegratedMesh",void 0),u([ys()],to.prototype,"polygonOffsetEnabled",void 0),u([ys()],to.prototype,"ellipsoidMode",void 0),u([ys()],to.prototype,"hasOccludees",void 0),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(Xa||(Xa={}));class UN extends KQ{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Oi.Back,this.hasSlicePlane=!0}}u([ys()],UN.prototype,"doubleSided",void 0),u([ys()],UN.prototype,"cullFace",void 0),u([ys()],UN.prototype,"hasSlicePlane",void 0);class wO extends KQ{constructor(){super(...arguments),this.externalColor=Ht(1,1,1,1),this.externalColorMixMode=Sn.Multiply,this.castShadows=Bn.All}get transparent(){return this.externalColor[3]<1?Bn.All:Bn.None}get opaqueOverride(){return this.externalColorMixMode===Sn.Replace&&this.externalColor[3]===1?Bn.All:Bn.None}get visible(){return this.externalColor[3]>0?Bn.All:Bn.None}get type(){return dm.Uniform}}u([ys({vectorOps:rde})],wO.prototype,"externalColor",void 0),u([ys()],wO.prototype,"externalColorMixMode",void 0),u([ys()],wO.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(Bn||(Bn={}));class w3 extends KQ{constructor(){super(...arguments),this.texture=null,this.transparent=Bn.None,this.opaqueOverride=Bn.None,this.castShadows=Bn.None}get type(){return dm.Varying}}function Xgt(e){return e.overlays.length!==0&&v(e.overlays[is.INNER].getValidTexture(vs.Highlight))}function Ygt(e){return e.overlays.length!==0&&v(e.overlays[is.INNER].getColorTextureNoRasterImage())}u([ys()],w3.prototype,"texture",void 0),u([ys()],w3.prototype,"transparent",void 0),u([ys()],w3.prototype,"opaqueOverride",void 0),u([ys()],w3.prototype,"castShadows",void 0);const c5=os().vec3f(A.POSITION).u16(A.COMPONENTINDEX).u16(A.U16PADDING),WEe=os().vec2u8(A.SIDENESS),Zgt=Hc(WEe),XEe=os().vec3f(A.POSITION0).vec3f(A.POSITION1).u16(A.COMPONENTINDEX).u8(A.VARIANTOFFSET,{glNormalized:!0}).u8(A.VARIANTSTROKE).u8(A.VARIANTEXTENSION,{glNormalized:!0}).u8(A.U8PADDING,{glPadding:!0}).u16(A.U16PADDING,{glPadding:!0}),$q=XEe.clone().vec3f(A.NORMAL),Lq=XEe.clone().vec3f(A.NORMALA).vec3f(A.NORMALB),YEe=new Map([[A.POSITION0,0],[A.POSITION1,1],[A.COMPONENTINDEX,2],[A.VARIANTOFFSET,3],[A.VARIANTSTROKE,4],[A.VARIANTEXTENSION,5],[A.NORMAL,6],[A.NORMALA,6],[A.NORMALB,7],[A.SIDENESS,8]]);function tue(e,t,r){const i=t/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(x,T)=>{x<T?s[x+1]++:n[T+1]++};for(let x=0;x<i;x++){const T=e[3*x],S=e[3*x+1],C=e[3*x+2];o(T,S),o(S,C),o(C,T)}let a=0,l=0;for(let x=0;x<r;x++){const T=s[x+1],S=n[x+1];s[x+1]=a,n[x+1]=l,a+=T,l+=S}const c=new Uint32Array(6*i),h=s[r],p=(x,T,S)=>{if(x<T){const C=s[x+1]++;c[2*C]=T,c[2*C+1]=S}else{const C=n[T+1]++;c[2*h+2*C]=x,c[2*h+2*C+1]=S}};for(let x=0;x<i;x++){const T=e[3*x],S=e[3*x+1],C=e[3*x+2];p(T,S,x),p(S,C,x),p(C,T,x)}const f=(x,T)=>{const S=2*x,C=T-x;for(let O=1;O<C;O++){const R=c[S+2*O],$=c[S+2*O+1];let I=O-1;for(;I>=0&&c[S+2*I]>R;I--)c[S+2*I+2]=c[S+2*I],c[S+2*I+3]=c[S+2*I+1];c[S+2*I+2]=R,c[S+2*I+3]=$}};for(let x=0;x<r;x++)f(s[x],s[x+1]),f(h+n[x],h+n[x+1]);const m=new Int32Array(3*i),y=(x,T)=>x===e[3*T]?0:x===e[3*T+1]?1:x===e[3*T+2]?2:-1,_=(x,T)=>{const S=y(x,T);m[3*T+S]=-1},b=(x,T,S,C)=>{const O=y(x,T);m[3*T+O]=C;const R=y(S,C);m[3*C+R]=T};for(let x=0;x<r;x++){let T=s[x];const S=s[x+1];let C=n[x];const O=n[x+1];for(;T<S&&C<O;){const R=c[2*T],$=c[2*h+2*C];R===$?(b(x,c[2*T+1],$,c[2*h+2*C+1]),T++,C++):R<$?(_(x,c[2*T+1]),T++):(_($,c[2*h+2*C+1]),C++)}for(;T<S;)_(x,c[2*T+1]),T++;for(;C<O;)_(c[2*h+2*C],c[2*h+2*C+1]),C++}return m}class ZEe{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?Qgt:Jgt}write(t,r,i){const s=this._edgeHashFunction(i);GL.seed=s;const n=GL.getIntRange(0,255),o=GL.getIntRange(0,this.settings.variants-1),a=.7,l=GL.getFloat(),c=255*(.5*Kgt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(r,i.position0),t.position1.setVec(r,i.position1),t.componentIndex.set(r,i.componentIndex),t.variantOffset.set(r,n),t.variantStroke.set(r,o),t.variantExtension.set(r,c)}trim(t,r){return t.slice(0,r)}}const eK=new Float32Array(6),u5=new Uint32Array(eK.buffer),Y_=new Uint32Array(1);function Jgt(e){const t=eK;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],Y_[0]=5381;for(let r=0;r<u5.length;r++)Y_[0]=31*Y_[0]+u5[r];return Y_[0]}function Qgt(e){const t=eK;t[0]=NT(e.position0[0]),t[1]=NT(e.position0[1]),t[2]=NT(e.position0[2]),t[3]=NT(e.position1[0]),t[4]=NT(e.position1[1]),t[5]=NT(e.position1[2]),Y_[0]=5381;for(let r=0;r<u5.length;r++)Y_[0]=31*Y_[0]+u5[r];return Y_[0]}const rue=1e4;function NT(e){return Math.round(e*rue)/rue}function Kgt(e,t){const r=e<0?-1:1;return Math.abs(e)**t*r}class h5{constructor(){this._commonWriter=new ZEe}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return $q.createBuffer(t)}write(t,r,i){this._commonWriter.write(t,r,i),me(zL,i.faceNormal0,i.faceNormal1),ve(zL,zL),t.normal.setVec(r,zL)}trim(t,r){return this._commonWriter.trim(t,r)}}h5.Layout=$q,h5.glLayout=Hc($q,1);class d5{constructor(){this._commonWriter=new ZEe}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return Lq.createBuffer(t)}write(t,r,i){this._commonWriter.write(t,r,i),t.normalA.setVec(r,i.faceNormal0),t.normalB.setVec(r,i.faceNormal1)}trim(t,r){return this._commonWriter.trim(t,r)}}d5.Layout=Lq,d5.glLayout=Hc(Lq,1);const zL=M(),GL=new Mh,Sb=-1;var p5;function eyt(e,t,r,i=oyt){const s=e.vertices.position,n=e.vertices.componentIndex,o=Gt(i.anglePlanar),a=Gt(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=Dq.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,_=nyt(e),b=syt(e),x=b.length/4,T=t.allocate(x);let S=0;const C=x,O=r.allocate(C);let R=0,$=0,I=0;const U=qAe(0,x),V=new Float32Array(x);V.forEach((te,q,L)=>{s.getVec(b[4*q+0],p),s.getVec(b[4*q+1],f),L[q]=Ai(p,f)}),U.sort((te,q)=>V[q]-V[te]);const G=new Array,z=new Array;for(let te=0;te<x;te++){const q=U[te],L=V[q],N=b[4*q+0],F=b[4*q+1],H=b[4*q+2],X=b[4*q+3],K=X===Sb;if(s.getVec(N,p),s.getVec(F,f),K)ce(m,_[3*H+0],_[3*H+1],_[3*H+2]),le(y,m),h.componentIndex=n.get(N),h.cosAngle=_e(m,y);else{if(ce(m,_[3*H+0],_[3*H+1],_[3*H+2]),ce(y,_[3*X+0],_[3*X+1],_[3*X+2]),h.componentIndex=n.get(N),h.cosAngle=_e(m,y),ryt(h,c))continue;h.cosAngle<-.9999&&le(y,m)}$+=L,I++,K||tyt(h,l)?(t.write(T,S++,h),G.push(L)):iyt(h,o)&&(r.write(O,R++,h),z.push(L))}const Z=new Float32Array(G.reverse()),Q=new Float32Array(z.reverse());return{regular:{instancesData:t.trim(T,S),lodInfo:{lengths:Z}},silhouette:{instancesData:r.trim(O,R),lodInfo:{lengths:Q}},averageEdgeLength:$/I}}function tyt(e,t){return e.cosAngle<t}function ryt(e,t){return e.cosAngle>t}function iyt(e,t){const r=Mn(e.cosAngle),i=Dq.fwd,s=Dq.ortho;return Cy(i,e.position1,e.position0),r*(_e(dt(s,e.faceNormal0,e.faceNormal1),i)>0?-1:1)>t}function syt(e){const t=e.faces.length/3,r=e.faces,i=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=i[3*a+0],c=i[3*a+1],h=i[3*a+2],p=r[3*a+0],f=r[3*a+1],m=r[3*a+2];s+=l===Sb||p<f?1:0,s+=c===Sb||f<m?1:0,s+=h===Sb||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=i[3*a+0],c=i[3*a+1],h=i[3*a+2],p=r[3*a+0],f=r[3*a+1],m=r[3*a+2];(l===Sb||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===Sb||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===Sb||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function nyt(e){const t=e.faces.length/3,r=e.vertices.position,i=e.faces,s=xB.v0,n=xB.v1,o=xB.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=i[3*l+0],h=i[3*l+1],p=i[3*l+2];r.getVec(c,s),r.getVec(h,n),r.getVec(p,o),ge(n,n,s),ge(o,o,s),dt(s,n,o),ve(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(p5||(p5={}));const Dq={edge:{position0:M(),position1:M(),faceNormal0:M(),faceNormal1:M(),componentIndex:0,cosAngle:0},ortho:M(),fwd:M()},xB={v0:M(),v1:M(),v2:M()},oyt={anglePlanar:4,angleSignificantEdge:35};function ayt(e){const t=lyt(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return iue.updateSettings(e.writerSettings),sue.updateSettings(e.writerSettings),eyt(t,iue,sue)}function lyt(e,t,r,i){if(t){const o=tue(r,i,e.count);return new cyt(r,i,o,e)}const s=iq(e.buffer,e.stride/4,{originalIndices:r,originalIndicesLength:i}),n=tue(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:c5.createView(s.buffer)}}class cyt{constructor(t,r,i,s){this.faces=t,this.facesLength=r,this.neighbors=i,this.vertices=s}}const iue=new h5,sue=new d5,USt=os().vec3f(A.POSITION0).vec3f(A.POSITION1),uyt=os().vec3f(A.POSITION0).vec3f(A.POSITION1).u16(A.COMPONENTINDEX).u16(A.U16PADDING,{glPadding:!0});class hyt{constructor(t){this._maxCount=t,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this._recycledIndices.push(t)}}class dyt{constructor(t,r=1){this._rctx=t,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0,this._texture=new lt(this._rctx,{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,wrapMode:Rt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new _o(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(t,r,i,s,n,o){const a=t*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(t,r,i,s){const n=t*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}resizeToFit(t){const r=t*this._fieldCount;if(r>=this._data.count){const i=Math.ceil((r+1)/this.textureWidth)*this.textureWidth,s=new _o(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const t=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>t*r&&this._texture.resize(t,this._data.count/t),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}}const JEe=65536;class pyt{constructor(t,r=1){this.textureBuffer=new dyt(t,r),this._indexManager=new hyt(JEe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const t=this._indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this._indexManager.release(t)}}class QEe{constructor(t,r=1){this._rctx=t,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this._buffers.forEach(t=>t.dispose()),this._buffers=[]}getBuffer(t){for(const i of this._buffers)if(i.availableCount>=t)return i;if(t>JEe)return null;const r=new pyt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const t of this._buffers)t.textureBuffer.updateTexture()}}const nue=ee.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class fyt{constructor(t,r){this._renderManager=t,this._viewingMode=r,this._objects=[new Jt,new Jt],this._renderSubmit=new Ngt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=de("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new QEe(t.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){mt(this._objects[YS.Hidden].length===0&&this._objects[YS.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const r=new b3;return r.toMapSpace=t.toMapSpace,r.transform=t.transform,r.obb=Hce(t.obb),r.components=new ggt(this._componentBufferManager,t.geometry.componentOffsets),r.renderable=this._createRenderable(t,r.components),r.intersectionGeometry=new Tgt(t.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(t){const r=t;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(t,r){const i=t;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(t){const r=t.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=jn(r,i.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,r){const i=t.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,r){const i=t;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,r){return t.components.visibility.forEachComponent(r)}getComponentCount(t){const r=t,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(t,r){const i=t,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new Ugt,c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,_=n.verticalOffsets,b=1/0,x=-1/0,T=!1,S=!1,C=0;for(let O=0;O<n.count;O++){r(O,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Sn.Replace&&l.externalColor[3]===1),y+=+l.castShadows,W2e(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[O],0,h[0],h[1],h[2],h[3]),T||(T=O>0&&C!==p[0]),C=p[0],S||(S=l.elevationOffset!==0),S&&E(_)&&(_=new Array(O).fill(0)),v(_)&&(_[O]=l.elevationOffset),b=Math.min(b,l.elevationOffset),x=Math.max(x,l.elevationOffset),HEe(l.elevationOffset,h),c.setData(a[O],1,h[0],h[1],h[2],h[3]);const R=l.objectAndLayerIdColor;v(R)&&c.setData(a[O],2,R[0],R[1],R[2],R[3]),l.pickable!==zEe(n.pickability,O)&&(n.pickability=_gt(n.pickability,n.count,O,l.pickable))}n.verticalOffsets=S?_:null,i.offsetObb=S?pgt(i.obb,b,x,this._viewingMode,v(i.offsetObb)?i.offsetObb:Hce(i.obb)):null,T||S||this._hasObjectAndLayerId?(s.componentParameters=new w3,s.componentParameters.castShadows=TB(y,n.count),s.componentParameters.transparent=TB(f,n.count),s.componentParameters.opaqueOverride=TB(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new wO,s.componentParameters.castShadows=l.castShadows?Bn.All:Bn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,r,i,s=!1){t.intersectionGeometry.getComponentAabb(r,i);const n=t,o=n.components.verticalOffsets;if(s||E(o))return i;const a=o[r];if(this._viewingMode===Ge.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=_Je(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,r,i){return t.intersectionGeometry.getComponentPositions(r,i)}intersect(t,r,i,s,n,o){const a=t;v(n)&&(n.localOrigin=a.transform.position);const l=Ax(oue,a.transform.rotationScale);lo(jL,r,a.transform.position),lo(HL,i,a.transform.position),Mc(jL,jL,l),Mc(HL,HL,l);const c=sd(oue,l);return a.intersectionGeometry.intersect(jL,HL,s,c,n,a.components.verticalOffsets,o)}addEdges(t,r,i,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(t,n.transform,{center:n.obb.center,radius:dgt(n.obb)},a,o,l,i,s)}async extractEdgeInformation(t,r,i){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:uyt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=c5.createBuffer(a.count);HU(c.position,a),Ov(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:bs(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(t,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,r,i,s){if(t&&r.allVisible())return t;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=Array.isArray(t)?new Array(n):(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const h=i[l],p=i[c];for(let f=h;f<p;f++)o[a++]=t?t[f]:f;return!0}),o}addComponentHighlight(t,r){const i=t.components;E(i.highlightCounts)&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(t,r){const i=t.components;if(E(i.highlightCounts))return void nue.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else nue.warn("Removing non-existing highlight.")}clearHighlights(t){const r=t.components;v(r.highlightCounts)&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[YS.Visible]}_createRenderable(t,r){const i=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=wr.createVertex(i,$r.STATIC_DRAW,s.vertices.data),a=ho(s.indices,_=>wr.createIndex(i,$r.STATIC_DRAW,_)),l=Hc(Fgt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const b=r.offsets[_],x=r.offsets[_+1],T=r.materialDataIndices[_];if(v(s.indices))for(let S=b;S<x;S++)c[s.indices[S]]=T;else for(let S=b;S<x;S++)c[S]=T}const h=wr.createVertex(i,$r.STATIC_DRAW,c.buffer),p=new to(t.transform,t.toMapSpace),f=new rd(i,qEe,{data:l,componentIndices:myt},{data:o,componentIndices:h},a),m=new Agt(f,It.TRIANGLES,n,v(a)),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(v(a)?a.byteSize:0)};return new Cgt(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const myt=Hc(os().u16(A.COMPONENTINDEX));function TB(e,t){return e===t?Bn.All:e===0?Bn.None:Bn.Some}const oue=Wl(),jL=M(),HL=M();class KEe extends gi{constructor(){super(...arguments),this.opacity=1}}function gyt(e){const t=new Lr;return t.include(ud),t.fragment.uniforms.add(new Mt("tex",r=>r.texture)),e.hasOpacityFactor&&t.fragment.uniforms.add(new Pe("opacity",r=>r.opacity)),t.fragment.code.add(w`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${e.hasOpacityFactor?"* opacity":""};
    }`),t}const yyt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:KEe,build:gyt},Symbol.toStringTag,{value:"Module"}));var xa;(function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"})(xa||(xa={}));class Nq extends $a{constructor(){super(...arguments),this.alphaMode=xa.None,this.hasOpacityFactor=!1}}u([B({count:xa.COUNT})],Nq.prototype,"alphaMode",void 0),u([B()],Nq.prototype,"hasOpacityFactor",void 0);class h8 extends Br{initializeProgram(t){return new Nr(t.rctx,h8.shader.get().build(this.configuration),Or)}initializePipeline(){switch(this.configuration.alphaMode){case xa.None:return Vt({colorWrite:Qt});case xa.Alpha:return Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:Qt});case xa.PremultipliedAlpha:case xa.COUNT:return Vt({blending:Vp(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:Qt})}}}h8.shader=new Dr(yyt,()=>ie(()=>import("./Compositing.glsl.95479dc1.js"),[]));class eCe extends gi{}function _yt(){const e=new Lr;return e.include(ud),e.fragment.uniforms.add(new Mt("tex",t=>t.texture)),e.fragment.code.add(w`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),e}const vyt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:eCe,build:_yt},Symbol.toStringTag,{value:"Module"}));class d8 extends Br{initializeProgram(t){return new Nr(t.rctx,d8.shader.get().build(),Or)}initializePipeline(){return Vt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}d8.shader=new Dr(vyt,()=>ie(()=>import("./HUDCompositing.glsl.761f1ad2.js"),[]));class tCe extends gi{}function byt(){const e=new Lr;return e.include(ud),e.fragment.uniforms.add([new Mt("colorTexture",t=>t.colorTexture),new Mt("alphaTexture",t=>t.alphaTexture),new Mt("frontFaceTexture",t=>t.frontFaceTexture)]),e.fragment.code.add(w`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),e}const wyt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:tCe,build:byt},Symbol.toStringTag,{value:"Module"}));class p8 extends Br{initializeProgram(t){return new Nr(t.rctx,p8.shader.get().build(),Or)}initializePipeline(){return Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:Qt})}}p8.shader=new Dr(wyt,()=>ie(()=>import("./OITCompositing.glsl.fe83f7f5.js"),[]));class rCe extends gi{constructor(){super(...arguments),this.overlayIndex=is.INNER,this.opacity=1}}function xyt(){const e=new Lr;return e.include(ud),e.fragment.uniforms.add(new Mt("tex",t=>t.texture)),e.fragment.uniforms.add(new YP("overlayIdx",t=>t.overlayIndex)),e.fragment.uniforms.add(new Pe("opacity",t=>t.opacity)),e.fragment.code.add(w`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),e}const Tyt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:rCe,build:xyt},Symbol.toStringTag,{value:"Module"}));class f8 extends Br{initializeProgram(t){return new Nr(t.rctx,f8.shader.get().build(),Or)}initializePipeline(){return Vt({blending:Vp(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:Qt})}}f8.shader=new Dr(Tyt,()=>ie(()=>import("./OverlayCompositing.glsl.f73a5657.js"),[]));class Syt{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._configuration=new Nq,this._passParameters=new KEe,this._oitParameters=new tCe,this._hudParameters=new eCe,this._overlayParameters=new rCe}destroy(){this._vao=tt(this._vao)}compositeOIT(t,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(p8);n.bindTechnique(o,this._oitParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(It.TRIANGLE_STRIP,0,ra(a,"geometry")),o.release()}compositeHUD(t,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(d8);i.bindTechnique(s,this._hudParameters,t);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(It.TRIANGLE_STRIP,0,ra(n,"geometry")),s.release()}compositeOverlay(t,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(f8);n.bindTechnique(o,this._overlayParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(It.TRIANGLE_STRIP,0,ra(a,"geometry")),o.release()}composite(t,r,i=xa.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(h8,this._configuration);n.bindTechnique(o,this._passParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(It.TRIANGLE_STRIP,0,ra(a,"geometry")),o.release()}_ensureVAO(){return E(this._vao)&&(this._vao=La(this._rctx)),this._vao}}const Eyt=1e4,Fq=100,Cyt=500,Ayt=500,Ryt=.1;function Oyt(e,t,r){return WJ(t,e)*(r[1]-r[0])+r[0]}function Myt(e,t,r){let i=0;if(!t.some(n=>(i+=n.numGeometries,i>=Eyt)))return Uyt.compute(e,t);const s=eI();return r.forAll(n=>{n.visible&&cC(s,Pyt(e,n))}),s}function Pyt(e,t){if(!t.visible)return;const r=eI(),i=t.getSpatialQueryAccelerator();return v(i)?Iyt(r,e,i):$yt(r,e,t.objects),r}function Iyt(e,t,r){const i=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.visible,a=r.objectCount;if(a<Cyt)jM(Ah,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,s,yp.DepthOrder.FRONT_TO_BACK,Ah,(l,c)=>{Uq(e,t,l),Ah.far=e.near,c.setRange(Ah)},n,o),jM(Ah,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,s,yp.DepthOrder.BACK_TO_FRONT,Ah,(l,c)=>{Uq(e,t,l),Ah.near=e.far,c.setRange(Ah)},n,o);else{const l=Math.max(Math.min(a,Ayt),Math.ceil(a*Ryt)),c=r.findClosest(s,yp.DepthOrder.FRONT_TO_BACK,n,o,l),h=r.findClosest(s,yp.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(aue(e,t,c.boundingVolumeWorldSpace.bounds),aue(e,t,h.boundingVolumeWorldSpace.bounds))}}function $yt(e,t,r){FT.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&FT.add(i)}),FT.empty||(FT.sort(t),jM(Ah,t.near,Math.min(e.near,t.far)),FT.forEachInDepthRange(Ah,yp.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<e.near&&Uq(e,t,i)}),jM(Ah,Math.max(e.far,t.near),t.far),FT.forEachInDepthRange(Ah,yp.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{e.far=Math.max(e.far,n)}))}function Uq(e,t,r){if(!r.visible||!H_(t.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=Fyt;r.geometries.forEach(n=>{ws(s,i,n.shaderTransformation);const o=Fw(s);iCe(e,t,n.boundingInfo,s,o)})}function iCe(e,t,r,i,s){if(E(r))return;Ze(Jo,r.center,i);const{eye:n,viewForward:o}=t,a=o[0]*(Jo[0]-n[0])+o[1]*(Jo[1]-n[1])+o[2]*(Jo[2]-n[2]);if(Jo[3]=r.radius*s,!(a-Jo[3]>e.near&&a+Jo[3]<e.far)&&H_(t.frustum,Jo))if(r.radius>Fq&&r.getChildren())for(const l of r.getChildren())iCe(e,t,l,i,s);else kq.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function aue(e,t,r){const i=t.eye,s=t.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];e.near=Math.min(e.near,n-r[3]),e.far=Math.max(e.far,n+r[3])}class Lyt{constructor(){this._items=new Jt({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const r=t.eye,i=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,r,i){if(r===yp.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||i(n.obj,n.near,n.far)}}}class Dyt{constructor(){this._view=Ie(),this._viewProj=Ie(),this._frustum=lM(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(t,r){this._reset(),Hn(this._view,t.viewMatrix),ws(this._viewProj,t.projectionMatrix,this._view),g4(this._frustum,t.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14];r.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;let y;m.hasShaderTransformation?(m.computeBoundingSphere(m.shaderTransformation,Jo,1),y=Jo):y=m.boundingSphere;const _=s*y[0]+n*y[1]+o*y[2]+a,b=_-y[3],x=_+y[3];this._geometries.push(m),this._near.push(-x),this._far.push(-b)}));const l=new Rgt;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,p=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[h++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[p++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(t,r,i){if(E(t))return;const s=t.center;Ze(Jo,s,r);const n=Fw(r),o=Jo[0],a=Jo[1],l=Jo[2],c=t.radius*n,h=this._frustum;if(h[0][0]*o+h[0][1]*a+h[0][2]*l+h[0][3]>c||h[1][0]*o+h[1][1]*a+h[1][2]*l+h[1][3]>c||h[2][0]*o+h[2][1]*a+h[2][2]*l+h[2][3]>c||h[3][0]*o+h[3][1]*a+h[3][2]*l+h[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=p+c;if(!(-(p-c)<2||-f>=i.near))if(-f>this._looseRange.near)i.near=-f;else{if(c>Fq){const m=t.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,r,i);return}}kq.unionDepthRangeWithAABB(i,this._viewProj,r,t.bbMin,t.bbMax)}}_includeFarBoundingInfoRec(t,r,i){if(E(t))return;let s=t.radius;const n=t.center;Ze(Jo,n,r);const o=Fw(r),a=Jo[0],l=Jo[1],c=Jo[2];s*=o;const h=this._frustum;if(h[0][0]*a+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*a+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*a+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*a+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-p<=i.far))if(-p<this._looseRange.far)i.far=-p;else{if(s>Fq){const f=t.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,r,i);return}}kq.unionDepthRangeWithAABB(i,this._viewProj,r,t.bbMin,t.bbMax)}}}class Nyt{constructor(){this._modelViewProj=Ie(),this._clipPosition=[sr(),sr(),sr(),sr(),sr(),sr(),sr(),sr()]}unionDepthRangeWithAABB(t,r,i,s,n){const o=this._modelViewProj;ws(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[SB[l][0]],h=this._clipPosition[SB[l][1]],p=this._clipPosition[SB[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const _=f[y][3];Number.isFinite(_)&&(t.near=Math.min(_,t.near),t.far=Math.max(_,t.far))}}}return a}_inside(t,r){return r===0?t[0]>=-t[3]:r===1?t[1]>=-t[3]:r===2?t[0]<=t[3]:r===3?t[1]<=t[3]:void mt(!1)}_intersect(t,r,i){let s=0;return i===0?s=(-t[3]-t[0])/(r[0]-t[0]+r[3]-t[3]):i===1?s=(-t[3]-t[1])/(r[1]-t[1]+r[3]-t[3]):i===2?s=(t[3]-t[0])/(r[0]-t[0]-r[3]+t[3]):i===3&&(s=(t[3]-t[1])/(r[1]-t[1]-r[3]+t[3])),E5(sr(),t,r,s)}_clipTriangle(t,r,i){let s=[t,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const SB=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Jo=pn(),Fyt=Ie(),Ah=eI(),FT=new Lyt,Uyt=new Dyt,kq=new Nyt;class kyt{}class Vyt extends gi{constructor(){super(...arguments),this.textures=new kyt}}function Byt(){const e=new Lr;return e.attributes.add(A.POSITION,"vec2"),e.vertex.uniforms.add(new fr("drawPosition",(t,r)=>zyt(t,r))),e.varyings.add("vUV","vec2"),e.vertex.code.add(w`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new Mt("textureInput",t=>t.textures.input)),e.fragment.uniforms.add(new Mt("textureMask",t=>t.textures.mask)),e.fragment.uniforms.add(new Mt("textureOverlay",t=>t.textures.overlay)),e.fragment.uniforms.add(new ny("maskEnabled",t=>t.magnifier.maskEnabled)),e.fragment.uniforms.add(new ny("overlayEnabled",t=>t.magnifier.overlayEnabled)),e.fragment.code.add(w`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}function zyt(e,t){const r=t.camera.pixelRatio,i=e.magnifier.offset.x*r,s=e.magnifier.offset.y*r;qf(e.magnifier.position,lue);const n=t.camera.screenToRender(lue,Gyt),o=Math.ceil(r*e.magnifier.size),a=t.camera.fullWidth,l=t.camera.fullHeight;return ti(jyt,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const lue=ds(),Gyt=yfe(),jyt=sr();async function Hyt(e){const t=ie(()=>import("./mask-svg.c5a192a7.js"),[]),r=ie(()=>import("./overlay-svg.ebd5d958.js"),[]),i=Ty((await t).default,{signal:e}),s=Ty((await r).default,{signal:e}),n={mask:await i,overlay:await s};return cr(e),n}let P2=class extends Te{constructor(){super(...arguments),this._handles=new Jr,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Vyt,this.events=new Vs,this.attributeLocations=new Map([[A.POSITION,0]]),this._tmpScreenPoint=ds(),this._tmpRenderPoint=yfe()}get updating(){return E(this._imageSources)&&v(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};v(this._magnifier)&&this._handles.add(se(()=>ho(this._magnifier,r=>r.version),t)),t()}get enabled(){return v(this._validMagnifier)}get _validMagnifier(){return v(this._magnifier)&&this._magnifier.visible&&v(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return v(this._magnifier)&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),v(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const r=this._validMagnifier;if(E(r))return;const i=t.camera.pixelRatio,s=Math.ceil(i*r.size);if(this._updateResources(e,s),E(this._resources))return;const n=this._passParameters.textures,o=Math.ceil(1/this._factor*s);n.input.resize(o,o),qf(r.position,this._tmpScreenPoint);const a=t.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),l=t.camera.fullWidth,c=t.camera.fullHeight,h=.5*o,p=.5*o;a[0]=ye(a[0],h,l-h-1),a[1]=ye(a[1],p,c-p-1);const f=Math.floor(a[0]-h),m=Math.floor(a[1]-p),y=this._resources.program;y.bindTexture("textureInput",n.input),e.gl.copyTexImage2D(n.input.descriptor.target,0,n.input.descriptor.pixelFormat,f,m,o,o,0),this._passParameters.magnifier=r,e.useProgram(y),y.bindPass(this._passParameters,t),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(It.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(E(e))return;const t=e.maskUrl,r=e.overlayUrl;!v(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),v(this._imageSources)||v(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:r,task:wP(async i=>{const s=E(t)||E(r)?Hyt(i):null,n=v(t)?Ty(t,{signal:i}):s.then(a=>a.mask),o=v(r)?Ty(r,{signal:i}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(v(this._resources)){if(this._passParameters.textures.size!==t){const i=this._createTextureResources(e,t);if(E(i))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=i}return}const r=this._createTextureResources(e,t);E(r)||(this._resources={program:this._createProgram(e),vao:La(e,kZ,this.attributeLocations,0,1),pipelineState:Vt({blending:Vp(Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Qt})},this._passParameters.textures=r)}_disposeResources(){E(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(E(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const r=new lt(e,{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR,flipped:!0,preMultiplyAlpha:!qfe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),i=new lt(e,{target:bt.TEXTURE_2D,pixelFormat:ze.ALPHA,internalFormat:ze.ALPHA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new lt(e,{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR,flipped:!1}),mask:i,overlay:r,size:t}}_createProgram(e){return new Nr(e,Byt(),this.attributeLocations)}};u([d()],P2.prototype,"_imageSources",void 0),u([d()],P2.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],P2.prototype,"updating",null),P2=u([P("esri/views/3d/webgl-engine/lib/MagnifierHelper")],P2);class qyt{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new _o(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(t,r,i,s,n,o=null,a=null,l=null){if(!(t&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:t,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(t){const r=this.getObjectAndLayerIdColorArray(t);return Ht(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(t){if(!t.layerUid||!t.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(t.layerUid);if(r===void 0)return ee.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+t.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(t.layerUid);i||(i=new Map,this._uidToRenderColor.set(t.layerUid,i));let s=i.get(t.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(t.graphicUid,s),this._colorToUID.set(s,t)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new _o(n)}getColorToObjectAndLayerIdMapping(){const t=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||ee.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):ee.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||ee.getLogger(this.declaredClass).warn("no layerId found for uid "+i.layerUid),n&&o&&t.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return t}}var HM;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(HM||(HM={}));class O0{constructor(t,r,i=HM.FrontToBack){this._rctx=t,this._techniqueRepository=r,this._sorting=i,this._draws=new Jt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,r,i,s){var o;const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=t,n.depthSquaredHint=s,n.indexType=(o=r.indexed?r.vao.indexBuffer.indexType:null)!=null?o:0}dispatch(t,r){const i=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,r,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===xt.NONE||(i.bindTechnique(l,t,r),s=l);const c=this._draws.data[a],h=c.geometry;i.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,t),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=kN.get(c.indexType);for(let y=0;y<f;y+=2){const _=p[y],b=p[y+1];i.drawElements(h.primitiveType,b,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const y=p[m],_=p[m+1];i.drawArrays(h.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===HM.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=t*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.size-i.geometry.vao.size})}get count(){return this._draws.length}}const kN=new Map;kN.set(at.UNSIGNED_BYTE,1),kN.set(at.UNSIGNED_SHORT,2),kN.set(at.UNSIGNED_INT,4);class Wyt{constructor(t,r){this.rctx=t,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new vft,this._shadowPassParameters=new bft,this._highlightPassParameters=new wft,this._systems=new Set,this._passes={materialOpaque:new O0(t,r),materialTransparent:new O0(t,r,HM.BackToFront),materialIntegratedMesh:new O0(t,r),shadowMap:new O0(t,r),highlight:new O0(t,r),highlightIntegratedMesh:new O0(t,r),highlightShadowMap:new O0(t,r),defaultShadowMap:new O0(t,r)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,t.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),this._materialPassParameters.output=t.output,t.bindParameters.slot){case Se.OPAQUE_MATERIAL:switch(t.output){case k.Color:case k.Depth:case k.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case k.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case k.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case k.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case k.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case k.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters)}return;case Se.TRANSPARENT_MATERIAL:switch(t.output){case k.Color:case k.Alpha:case k.Depth:case k.Normal:case k.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Se.INTEGRATED_MESH:switch(t.output){case k.Color:case k.Depth:case k.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case k.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters);case k.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Se.OPAQUE_MATERIAL,Se.TRANSPARENT_MATERIAL,Se.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(t);v(s)&&cC(r,s,r)}),r}_configure(t){const r=t.output===k.Shadow||t.output===k.ShadowHighlight||t.output===k.ShadowExcludeHighlight?this._shadowPassParameters:t.output===k.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,r)}_updateParameters(t,r){const i=t.bindParameters.camera,s=i.viewInverseTransposeMatrix;ce(EB,s[3],s[7],s[11]),CB.set(EB),le(r.transformWorldFromViewTH,CB.high),le(r.transformWorldFromViewTL,CB.low),le(r.slicePlaneLocalOrigin,EB),id(r.transformViewFromCameraRelativeRS,i.viewMatrix),Hn(r.transformProjFromView,i.projectionMatrix),r.identifier===Oc.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Se.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Se.INTEGRATED_MESH,sd(cue,r.transformViewFromCameraRelativeRS),Ax(r.transformNormalViewFromGlobal,cue))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const EB=M(),cue=ns(),CB=new u8;class Xyt{constructor(){this._step=due,this._dilation=1,this._firstIdleTime=0}frame(t,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,de("enable-feature:high-quality-idle")){const s=r?performance.now()-this._firstIdleTime:0;if(s>=uue+Zyt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=uue?Jyt:1}else this._dilation=1;const i=ye(t/Yyt,due,Kyt);this._step===1/0?this._step=i:this._step=this._step*hue+i*(1-hue)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}}const Yyt=.5,uue=6e4,Zyt=5e3,Jyt=10,hue=.9,Qyt=30,due=1e3/1,Kyt=1e3/Qyt,e0t=8.6,t0t=.4;function r0t(){const e=new Lr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(A.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(A.UV0,"vec2"),t.uniforms.add(new Mt("coverageTex",n=>n.coverageTexture)),i.add(w`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Mt("tex",n=>n.blurColorTexture)),r.uniforms.add(new Mt("origin",n=>n.highlightColorTexture)),r.uniforms.add(new fr("uColor",n=>n.color)),r.uniforms.add(new fr("haloColor",n=>n.haloColor)),r.uniforms.add(new fr("opacities",n=>ti(i0t,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",e0t),r.constants.add("blurSize","float",t0t),s.add(w`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const i0t=sr(),s0t=Object.freeze(Object.defineProperty({__proto__:null,build:r0t},Symbol.toStringTag,{value:"Module"}));class m8 extends Br{initializeProgram(t){return new Nr(t.rctx,m8.shader.get().build(),Or)}initializePipeline(){return Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:Qt})}}m8.shader=new Dr(s0t,()=>ie(()=>import("./HighlightApply.glsl.e3aeb6c4.js"),[]));class sCe extends gi{constructor(){super(...arguments),this.blurSize=Ke()}}function n0t(){const e=new Lr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(A.POSITION,"vec2"),e.attributes.add(A.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new Mt("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new nM("blurSize",n=>n.blurSize)),i.add(w`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new LP("tex",n=>n.blurInputTexture)),s.add(w`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const o0t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:sCe,build:n0t},Symbol.toStringTag,{value:"Module"}));class g8 extends Br{initializeProgram(t){return new Nr(t.rctx,g8.shader.get().build(),Or)}initializePipeline(){return Vt({colorWrite:Qt})}}g8.shader=new Dr(o0t,()=>ie(()=>import("./HighlightBlur.glsl.7a4edcb6.js"),[]));class nCe extends gi{constructor(){super(...arguments),this.invFramebufferDim=Ke()}}function a0t(){const e=new Lr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(A.POSITION,"vec2"),i.add(w`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new LP("tex",n=>n.inputTexture)),r.uniforms.add(new nM("invFramebufferDim",n=>n.invFramebufferDim)),s.add(w`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const l0t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:nCe,build:a0t},Symbol.toStringTag,{value:"Module"}));class y8 extends Br{initializeProgram(t){return new Nr(t.rctx,y8.shader.get().build(),Or)}initializePipeline(){return Vt({colorWrite:Qt})}}y8.shader=new Dr(l0t,()=>ie(()=>import("./HighlightDownsample.glsl.4f169703.js"),[]));class pue extends gi{constructor(){super(...arguments),this.color=Up(1,0,1,1),this.haloColor=Up(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Ht(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const c0t=32;class u0t{constructor(t,r){this._techniqueRep=t,this._rctx=r,this._viewportToRestore=sr(),this._passParameters=new pue,this._downsampleDrawParameters=new nCe,this._blurDrawParameters=new sCe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=La(this._rctx);const t={colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE,width:0,height:0},r={target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.LINEAR,wrapMode:Rt.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new Li(this._rctx,t,r),this._blur1Fbo=new Li(this._rctx,t,r),this._blurTechnique=this._techniqueRep.acquire(g8),this._downsampleTechnique=this._techniqueRep.acquire(y8),this._applyTechnique=this._techniqueRep.acquire(m8)}dispose(){if(this._blurTechnique=Wi(this._blurTechnique),this._downsampleTechnique=Wi(this._downsampleTechnique),this._applyTechnique=Wi(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=tt(this._blur0Fbo),this._blur1Fbo=tt(this._blur1Fbo)}setDefaultOptions(t){this._passParameters={...new pue,...t}}render(t,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=t.camera;cp(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(r,c0t),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(Vi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,or(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,ra(p,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(Vi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,or(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,ra(p,"geometry")),h.bindFramebuffer(i),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,ra(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:bt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:$t.UNSIGNED_SHORT_5_6_5,samplingMode:rt.LINEAR,wrapMode:Rt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Li(i,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let _=0;for(let b=0;b<l;b++)for(let x=0;x<c;x++)y[_+0]=(x-.5)*p*2-1,y[_+1]=(b-.5)*h*2-1,y[_+2]=x*p,y[_+3]=b*h,y[_+4]=(x+.5)*p*2-1,y[_+5]=(b-.5)*h*2-1,y[_+6]=x*p,y[_+7]=b*h,y[_+8]=(x-.5)*p*2-1,y[_+9]=(b+.5)*h*2-1,y[_+10]=x*p,y[_+11]=b*h,y[_+12]=(x-.5)*p*2-1,y[_+13]=(b+.5)*h*2-1,y[_+14]=x*p,y[_+15]=b*h,y[_+16]=(x+.5)*p*2-1,y[_+17]=(b-.5)*h*2-1,y[_+18]=x*p,y[_+19]=b*h,y[_+20]=(x+.5)*p*2-1,y[_+21]=(b+.5)*h*2-1,y[_+22]=x*p,y[_+23]=b*h,_+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new Bp(i,Or,{geometry:$C},{geometry:wr.createVertex(i,$r.STATIC_DRAW,y)})}}_gridComputeMipmap(t){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,t);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,or(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(It.TRIANGLE_STRIP,0,ra(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(v(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(v(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)t+=r.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}}const h0t={dataType:$t.UNSIGNED_BYTE,internalFormat:ze.RGBA},d0t={};class p0t{constructor(t){this._rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const r=t.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._depthBuffers,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(t,r){const i=t.get(r);i&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==i&&s.depthStencilAttachment!==i||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),i.dispose(),t.delete(r))}getDepthTexture(t,r){if(!this.depthTextureSupported)return null;let i=this._depthTextures.get(t.id);return!i||i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=Sw()),i||(i=new lt(this._rctx,{target:bt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:$t.UNSIGNED_INT_24_8,samplingMode:rt.NEAREST,wrapMode:Rt.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._depthTextures.set(t.id,i),this._activeTargets.add(t.id)),i}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,r){if(this.depthTextureSupported)return null;let i=this._depthBuffers.get(t.id);return i?i.descriptor.width===r.width&&i.descriptor.height===r.height||i.resize(r.width,r.height):(i=new S2(this._rctx,{internalFormat:Za.DEPTH_STENCIL,...r}),this._depthBuffers.set(t.id,i),this._activeTargets.add(t.id)),i}getColorTexture(t,r){let i=this._colorTextures.get(t.id);return i&&(i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=Sw())),i||(i=new lt(this._rctx,{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:rt.LINEAR,wrapMode:Rt.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._colorTextures.set(t.id,i),this._activeTargets.add(t.id)),i}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return{id:Lc(),...d0t,...t}}registerColorTarget(t={}){return{id:Lc(),...h0t,...t}}getFramebuffer(t,r,i){const s=this._getKey(r,i);let n=this._framebuffers.get(s);const o=this.getColorTexture(r,t);if(this.depthTextureSupported){const l=i?this.getDepthTexture(i,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=v(i)?new Li(this._rctx,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.DEPTH_STENCIL_TEXTURE},o,l):new Li(this._rctx,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},o),this._framebuffers.set(s,n),n)}const a=i?this.getDepthBuffer(i,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Li(this._rctx,{colorTarget:ps.TEXTURE,depthStencilTarget:i?Ir.DEPTH_STENCIL_RENDER_BUFFER:Ir.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,r){return`${t.id}_${r?r.id:"X"}_${t.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let t=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),t+=Ww(s))};return this._depthTextures.forEach(i),this._colorTextures.forEach(i),this._depthBuffers.forEach(i),t}}class f0t{constructor(t,r){this._rctx=t,this._compositingHelper=r,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const i=t.type===vt.WEBGL2;this._renderTargetHelper=new p0t(t);const s=this._renderTargetHelper;this._mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:$t.FLOAT,internalFormat:i?St.RGBA32F:ze.RGBA,samplingMode:rt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:rt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:i?St.RGBA4:ze.RGBA,dataType:$t.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:i?St.RGBA4:ze.RGBA,dataType:$t.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,r){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(t){t||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&t?1:0}initializeFrame(t){const r=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(Vi.COLOR_BUFFER_BIT|Vi.DEPTH_BUFFER_BIT|Vi.STENCIL_BUFFER_BIT)}composite(t){v(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,xa.None)}renderTmpAndCompositeToMain(t,r,i,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,m0t),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}renderHUDVisibility(t,r=!1){this.renderToTargets(t,this.hudVisibility,r?this.tmpDepth:this.mainDepth,g0t)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.compositeHUD(t,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(t,r,i){let s,n;switch(r){case xt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case xt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case xt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}i?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),xa.PremultipliedAlpha)}compositeOccludedOntoMain(t,r){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),xa.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(t,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Vi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}renderToFBO(t,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=Vi.COLOR_BUFFER_BIT}i&&(o|=Vi.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=Vi.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),t(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(t,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(t,s,n,o),a}bindTarget(t,r){const i=this._renderTargetHelper.getFramebuffer(this._dimensions,t,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const m0t=[0,0,0,0],g0t=[0,1,0,1];class y0t{constructor(t){this._context=t,this._renderPlugins=new Jt,this._slots=[];for(let r=0;r<Se.MAX_SLOTS;++r)this._slots[r]=[]}add(t,r,i){const s=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),Wr();this._renderPlugins.push(r);for(const o of t)this._slots[o].push(r);this._context.requestRender()},n=r.initializeRenderContext(this._context,i);if(Hu(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==t);t.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this._context.renderContext)})}updateAnimation(t){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(t)||r)}),r}render(){const t=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;t.filter(i=>{if(!i.canRender)return!1;if(_0t(i)){const s=i.prepareTechnique(this._context.renderContext);return!!s&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this._context.renderContext,r[s]))}queryDepthRange(t){const r=v0t;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(t);s&&cC(r,s,r)}}),r}get needsTransparentPass(){return this._renderPlugins.some(t=>!!t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>!!t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>!!t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this._slots[Se.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,r)=>t|r.renderOccludedFlags,0)}}function _0t(e){return"prepareTechnique"in e}const v0t={near:0,far:0};class oCe extends P2e{}const _8=255,b0t=1/_8;function w0t(e){const t=new Lr,r=t.fragment;return r.include(jc),r.include(Gu),t.include(LU),t.include(ud),t.include(PU,e),r.uniforms.add([new Mt("depthMap",i=>i.linearDepthTexture),new Yi("inverseViewMatrix",(i,s)=>ko(fue,Yl(fue,s.camera.viewMatrix,s.camera.center))),new kr("nearFar",(i,s)=>s.camera.nearFar)]),r.constants.add("sampleValue","float",b0t),r.code.add(w`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),t}const fue=Ie(),x0t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:oCe,ShadowCastMaxSamples:_8,build:w0t},Symbol.toStringTag,{value:"Module"}));var fx;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(fx||(fx={}));class Vq extends $a{constructor(){super(...arguments),this.visualization=fx.Gradient,this.bandsEnabled=!1}}u([B({count:fx.COUNT})],Vq.prototype,"visualization",void 0),u([B()],Vq.prototype,"bandsEnabled",void 0);class aCe extends gi{constructor(t){super(),this.shadowCastMap=t,this.sampleScale=0,this.opacityFromElevation=1,this.color=yP(T0t),this.bandSize=.1,this.threshold=.5}}const T0t=Ht(.01,0,.25,1);function S0t(e){const t=new Lr,r=t.fragment;r.include(jc),r.include(Gu),t.include(LU),t.include(ud);const{visualization:i,bandsEnabled:s}=e;r.constants.add("inverseSampleValue","float",_8),r.uniforms.add([new Mt("shadowCastMap",a=>a.shadowCastMap),new Pe("sampleScale",a=>a.sampleScale),new Pe("opacityFromElevation",a=>a.opacityFromElevation),new fr("uColor",a=>a.color)]);const n=i===fx.Gradient,o=i===fx.Threshold;return n&&s?r.uniforms.add(new Pe("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Pe("threshold",a=>a.threshold)),r.code.add(w`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?w`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?w`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?w`* strength`:""});
      }
    `),t}const E0t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:aCe,build:S0t},Symbol.toStringTag,{value:"Module"}));class v8 extends Br{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){return new Nr(t.rctx,v8.shader.get().build(this.configuration),Or)}initializePipeline(){return Vt({blending:Fu,colorWrite:Qt,depthTest:null,depthWrite:null})}get primitiveType(){return It.TRIANGLE_STRIP}}v8.shader=new Dr(E0t,()=>ie(()=>import("./ShadowCastVisualize.glsl.f9d79eb6.js"),[]));const C0t=4e4,A0t=5e4,lCe=1/512;let VN=class extends Te{constructor(e,t,r,i){super({}),this._techniqueRepository=e,this._rctx=t,this._data=r,this._requestRender=i,this._passParameters=new aCe(this._data.shadowCastTexture),this._techniqueConfig=new Vq,this._enabled=!1,this._vao=La(t),this._techniqueConfig.visualization=fx.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=tt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(v8,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const t=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,ra(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>lCe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;mS(e,t)||(cp(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],VN.prototype,"opacityFromElevation",null),VN=u([P("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],VN);class f5 extends $a{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}}u([B()],f5.prototype,"receiveShadows",void 0),u([B()],f5.prototype,"hasWebGL2Context",void 0);class b8 extends Br{constructor(t){super(t,new f5,()=>this.destroy())}initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2}initializeProgram(t){return new Nr(t.rctx,b8.shader.get().build(this.configuration),Or)}initializePipeline(){return Vt({blending:Wn(Ee.ONE,Ee.ONE,Ee.ONE,Ee.ONE),colorWrite:Qt,depthTest:null,depthWrite:null})}get primitiveType(){return It.TRIANGLE_STRIP}}b8.shader=new Dr(x0t,()=>ie(()=>import("./ShadowCastAccumulate.glsl.9cb66ec4.js"),[]));let Il=class extends Te{constructor(e,t,r,i,s,n){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=i,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new oCe,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=Iq,this._previewing=!1,this._handles=new Jr,this._cameraForcedForScreenshot=!1,this._bindParameters=new Y6(new gQ(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=La(e);const o={colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE,width:0,height:0},a={target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.LINEAR,wrapMode:Rt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Li(e,o,a),this._accumulationRenderer=new VN(t,e,this,n);const l=this._stage.view.resourceController.scheduler;this._handles.add([l.registerTask(gt.SHADOW_ACCUMULATOR,this),se(()=>r.renderView,c=>{this._handles.remove(mue),v(c)&&this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),mue)},Ys),se(()=>this._previewing,()=>this._requestRenderIfEnabled(),ri)])}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(E(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new b8(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==Iq&&this._opacityFromElevation>lCe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){var i;const t=this._cachedLightDirections;if(dy(t,e,lv))return;const r=Math.min(_8,e.length);t.length=r,this._sampleCount=r;for(let s=0;s<r;++s)t[s]=le((i=t[s])!=null?i:M(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,r,i){if(this._depthRange=t,this._updateCamera(r),this._bindParameters.contentCamera=i,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(R0t,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=tt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=tt(this._fbo),this._vao=tt(this._vao),this._accumulationTechniqueCached=Wi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,t){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height?0:(this._fbo.readPixels(e,t,1,1,ze.RGBA,$t.UNSIGNED_BYTE,gue),gue[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Vi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,ra(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*O0t%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-QS(C0t,A0t,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};u([d()],Il.prototype,"_progress",void 0),u([d()],Il.prototype,"_sampleCount",void 0),u([d()],Il.prototype,"_enabledInternal",void 0),u([d()],Il.prototype,"_depthRange",void 0),u([d()],Il.prototype,"_previewing",void 0),u([d()],Il.prototype,"_accumulationRenderer",void 0),u([d()],Il.prototype,"_isRefining",null),u([d()],Il.prototype,"_isActive",null),u([d()],Il.prototype,"canAccumulate",null),u([d()],Il.prototype,"_isDoneAccumulating",null),u([d()],Il.prototype,"_opacityFromElevation",null),u([d()],Il.prototype,"running",null),Il=u([P("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Il);const R0t=6,mue="renderView",O0t=104729,gue=new Uint8Array(4),yue={highlightedThreshold:.99999,selfShadowThreshold:.025};function M0t(e){const t=new Lr;t.include(lx,e);const r=t.fragment;return r.include(jc),r.include(Gu),t.include(LU),t.include(ud),r.uniforms.add([new Mt("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(sC.Default)),new Mt("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(sC.Highlight)),new Mt("depthMap",(i,s)=>s.linearDepthTexture),new Mt("highlightMap",(i,s)=>s.highlightColorTexture),new fr("uColor",i=>i.shadowColor),new kr("nearFar",(i,s)=>s.camera.nearFar),new Pe("opacity",i=>i.shadowOpacity),new Pe("occludedOpacity",i=>i.occludedShadowOpacity),new Pe("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new qt("lightingMainDirectionView",(i,s)=>ve(vue,Ze(vue,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new kr("texelSize",(i,s)=>v(s.linearDepthTexture)?or(P0t,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):Zl),new Yi("inverseViewMatrix",(i,s)=>ko(_ue,Yl(_ue,s.camera.viewMatrix,s.camera.center)))]),r.constants.add("unoccludedHighlightFlag","vec4",dTe).add("highlightedThreshold","float",yue.highlightedThreshold).add("selfShadowThreshold","float",yue.selfShadowThreshold),r.code.add(w`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(w`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),t}const _ue=Ie(),vue=M(),P0t=Ke(),I0t=Object.freeze(Object.defineProperty({__proto__:null,build:M0t},Symbol.toStringTag,{value:"Module"}));class $0t extends gi{constructor(){super(...arguments),this.shadowColor=Ht(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class w8 extends Br{constructor(t){super(t,new f5,()=>this.destroy())}initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2}initializeProgram(t){return new Nr(t.rctx,w8.shader.get().build(this.configuration),Or)}initializePipeline(){return Vt({blending:Wn(Ee.SRC_ALPHA,Ee.ONE,Ee.ONE_MINUS_SRC_ALPHA,Ee.ONE_MINUS_SRC_ALPHA),colorWrite:Qt,depthTest:null,depthWrite:null})}get primitiveType(){return It.TRIANGLE_STRIP}}w8.shader=new Dr(I0t,()=>ie(()=>import("./ShadowHighlight.glsl.e61d72fc.js"),[]));const L0t=.001953125,D0t=4e4,N0t=5e4;class F0t{constructor(t,r){this._rctx=t,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new $0t,this._drawParameters=new P2e,this._vao=La(this._rctx)}get _technique(){return E(this._techniqueCached)&&(this._techniqueCached=new w8({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(t,r){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,t).bindDraw(this._drawParameters,t,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,ra(this._vao,"geometry"))}get gpuMemoryUsage(){var t,r;return(r=(t=this._vao)==null?void 0:t.size)!=null?r:0}setDefaultOptions(t){this._passParameters={...this._passParameters,...t},this._updateMaxOpacity()}updateParameters(t,r){this._passParameters.opacityElevation=1-QS(D0t,N0t,t.relativeElevation);const i=this._viewingMode===Ge.Global?ve(bue,t.center):ce(bue,0,0,1),s=_e(i,r);this._passParameters.dayNightTerminator=QS(0,1,ye(30*s,0,1))}dispose(){this._vao=tt(this._vao),this._techniqueCached=Wi(this._techniqueCached)}get isVisible(){const{opacityElevation:t,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*t*r>=L0t}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const bue=M(),wue=Oy();class U0t{constructor(){this._plane=Oy()}get isEnabled(){return!tye(this.plane,wue)}get plane(){return this._plane}set plane(t){Sx(t||wue,this._plane)}}class k0t extends gi{}function qM(e){e.uniforms.add(new fr("resolution",t=>{const{descriptor:r}=t.colorTexture,i=r.width,s=r.height;return ti(V0t,1/i,1/s,i,s)}))}const V0t=sr(),UT={maxSearchSteps:8,maxDistanceAreaTex:16};function B0t(){const e=new Lr,{attributes:t,varyings:r,vertex:i,fragment:s}=e;return t.add(A.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),qM(i),i.code.add(w`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${w.int(UT.maxSearchSteps)} );
      }
    `),s.uniforms.add(new Mt("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new Mt("areaTexture",n=>n.areaTexture)),s.uniforms.add(new Mt("searchTexture",n=>n.searchTexture)),qM(s),s.code.add(w`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${w.int(UT.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${w.int(UT.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${w.int(UT.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${w.int(UT.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${w.int(UT.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `),e}const z0t=Object.freeze(Object.defineProperty({__proto__:null,build:B0t},Symbol.toStringTag,{value:"Module"}));class x8 extends Br{initializeProgram(t){return new Nr(t.rctx,x8.shader.get().build(),Or)}initializePipeline(){return Vt({colorWrite:Qt})}}x8.shader=new Dr(z0t,()=>ie(()=>import("./BlendWeights.glsl.63f5b121.js"),[]));function G0t(){const e=new Lr,{attributes:t,varyings:r,vertex:i,fragment:s}=e;return t.add(A.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),qM(i),i.code.add(w`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new Mt("blendWeightsTexture",n=>n.blend.colorTexture)),s.uniforms.add(new Mt("colorTexture",n=>n.colorTexture)),qM(s),s.code.add(w`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`),e}const j0t=Object.freeze(Object.defineProperty({__proto__:null,build:G0t},Symbol.toStringTag,{value:"Module"}));class T8 extends Br{initializeProgram(t){return new Nr(t.rctx,T8.shader.get().build(),Or)}initializePipeline(){return Vt({colorWrite:Qt})}}T8.shader=new Dr(j0t,()=>ie(()=>import("./Blur.glsl.51709cd4.js"),[]));const xue={threshold:.05,localConstrastAdaption:2};function H0t(){const e=new Lr,{attributes:t,varyings:r,vertex:i,fragment:s}=e;return t.add(A.POSITION,"vec2"),qM(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(w`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new Mt("colorTexture",n=>n.colorTexture)),s.code.add(w`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${w.float(xue.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${w.float(xue.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `),e}const q0t=Object.freeze(Object.defineProperty({__proto__:null,build:H0t},Symbol.toStringTag,{value:"Module"}));class S8 extends Br{initializeProgram(t){return new Nr(t.rctx,S8.shader.get().build(),Or)}initializePipeline(){return Vt({colorWrite:Qt})}}S8.shader=new Dr(q0t,()=>ie(()=>import("./EdgeDetect.glsl.7b2dd619.js"),[]));let x3=class extends Te{constructor(e,t){super({}),this._rctx=e,this._techniqueRep=t,this._passParameters=new k0t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Yh(this._abortController),this.disable()}_loadResources(e){if(v(this._abortController))return!1;if(v(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return ie(()=>import("./SmaaRenderPassData.dfb9dc82.js"),[]).then(r=>this._loadTextures(r,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return cr(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,rt.LINEAR,ze.RGB),this._loadTextureFromBase64(e.searchTexure,rt.NEAREST,ze.LUMINANCE)]).then(([r,i])=>{zn(t)?(r.dispose(),i.dispose(),cr(t)):(this._passParameters.areaTexture=r,this._passParameters.searchTexture=i)})}get updating(){return v(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new $a;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(S8,t,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(x8,t,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(T8,t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=aWe(this._rctx),this._passParameters.edges=new Li(this._rctx,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},{target:bt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.LINEAR,wrapMode:Rt.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new Li(this._rctx,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},{target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.LINEAR,wrapMode:Rt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=tt(this._vao),this._passParameters.areaTexture=tt(this._passParameters.areaTexture),this._passParameters.searchTexture=tt(this._passParameters.searchTexture),this._passParameters.blend=tt(this._passParameters.blend),this._passParameters.edges=tt(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const t=this._validPassParameters;if(E(t))return;t.colorTexture=e;const r=this._rctx,i=r.getBoundFramebufferObject(),s=e.descriptor.width,n=e.descriptor.height;r.bindVAO(this._vao),r.setViewport(0,0,s,n),t.edges.resize(s,n),r.bindFramebuffer(t.edges),r.setClearColor(0,0,0,1),r.clear(Vi.COLOR_BUFFER_BIT),r.bindTechnique(this._edgeDetectTechnique,t,null),r.drawArrays(It.TRIANGLES,0,3),t.blend.resize(s,n),r.bindFramebuffer(t.blend),r.setClearColor(0,0,1,1),r.clear(Vi.COLOR_BUFFER_BIT),r.bindTechnique(this._blendWeightsTechnique,t,null),r.drawArrays(It.TRIANGLES,0,3),r.bindFramebuffer(i),r.setClearColor(0,1,0,1),r.clear(Vi.COLOR_BUFFER_BIT),r.bindTechnique(this._blurTechnique,t,null),r.drawArrays(It.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,r){return Ty(e).then(i=>new lt(this._rctx,{pixelFormat:r,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.CLAMP_TO_EDGE,width:i.width,height:i.height,samplingMode:t},i))}};u([d()],x3.prototype,"_abortController",void 0),u([d({readOnly:!0})],x3.prototype,"updating",null),x3=u([P("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],x3);function W0t(e,t){const r=-e[0],i=-e[1],s=-e[2],n=t[3],o=t[7],a=t[11],l=t[15];t[0]+=n*r,t[1]+=n*i,t[2]+=n*s,t[4]+=o*r,t[5]+=o*i,t[6]+=o*s,t[8]+=a*r,t[9]+=a*i,t[10]+=a*s,t[12]+=l*r,t[13]+=l*i,t[14]+=l*s}function X0t(e,t){const r=e[0],i=e[1],s=e[2];t[12]+=r*t[0]+i*t[4]+s*t[8],t[13]+=r*t[1]+i*t[5]+s*t[9],t[14]+=r*t[2]+i*t[6]+s*t[10],t[14]+=r*t[3]+i*t[7]+s*t[11]}class Y0t{constructor(t){this._factory=t,this._originData=new Map}acquire(t){return this.register(this._factory.getOrigin(t))}register(t){const r=this._originData.get(t.id)||new Z0t(t);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(t){t.refCount--,t.refCount===0&&this._originData.delete(t.origin.id)}updateViewMatrices(t){this._originData.forEach(r=>{Hn(r.viewMatrix,t),X0t(r.origin.vec3,r.viewMatrix)})}}class Z0t{constructor(t){this.origin=t,this.refCount=0,this.viewMatrix=Ie()}}class J0t extends twe{constructor(t,r){super(),this.distanceFalloffFactor=t,this.transparency=r,this.transformNormalViewFromGlobal=ns()}}class Q0t extends rwe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=ns(),this.slicePlaneLocalOrigin=M(),this.transformNormalGlobalFromModel=ns()}}function K0t(e){const t=w`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const e_t=Ur(.5,-4e-4);function t_t(e,t){const r=e.vertex;r.include(K0t),r.constants.add("depthBias","vec2",e_t),r.uniforms.add(new kr("inverseViewport",(i,s)=>s.inverseViewport)),t.legacy?(r.uniforms.add(new Yi("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(w`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new Fm("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),r.uniforms.add(new Yi("transformProjFromView",i=>i.transformProjFromView)),r.code.add(w`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(w`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function r_t(e,t){const r=e.fragment;r.constants.add("coverageTestThreshold","float",.01),t.antialiasing?r.code.add(w`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(w`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function i_t(e,t){const r=e.vertex;t.silhouette?(r.code.add(w`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function s_t(e,t){const r=e.vertex;r.include(jc),r.uniforms.add(new Pe("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(w`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(iv("componentDataTex",i=>i.componentDataTexture,t.hasWebGL2Context?ei.None:ei.InvSize)),e.attributes.add(A.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*JQ),r.code.add(w`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${Hh(t,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${rl(t,"componentDataTex","colorIndex")};
      vec4 otherValue = ${rl(t,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${rl(t,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),t.legacy?r.code.add(w`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new oM("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(w`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(A.NORMALA,"vec3"),e.attributes.add(A.NORMALB,"vec3"),r.code.add(w`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(A.NORMAL,"vec3"),r.code.add(w`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?r.code.add(w`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(_4,t),r.include(_4,t),r.uniforms.add([new Fm("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new oM("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Nu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new Nu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new qt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new qt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)]),r.code.add(w`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?w`normalize(transformWorldFromModelTL + rotatedModelPosition);`:w`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Yi("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(w`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(w`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function n_t(e){return e.mode===Cn.SKETCH||e.mode===Cn.MIXED}var Cn,qb;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(Cn||(Cn={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.SILHOUETTE=1]="SILHOUETTE"}(qb||(qb={}));function tK(e,t){const r=e.vertex;switch(e.attributes.add(A.SIDENESS,"vec2"),t.mode===Cn.MIXED?r.code.add(w`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(w`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case Cn.MIXED:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Cn.SKETCH:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Cn.SOLID:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Cn.COUNT:break;default:t.mode}}function o_t(e,t){const r=e.vertex;switch(e.include(tK,t),t.mode){case Cn.SOLID:r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Cn.SKETCH:r.uniforms.add(new vw("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Cn.MIXED:r.uniforms.add(new vw("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function a_t(e,t){e.include(tK,t);const{vertex:r,fragment:i}=e;switch(n_t(t)&&(r.uniforms.add(iv("strokesTexture",s=>s.strokesTexture.texture,t.hasWebGL2Context?ei.None:ei.InvSize)),r.uniforms.add([new vw("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new vw("strokeVariants",s=>s.strokesTexture.variants)]),e.varyings.add("vStrokeUV","vec2"),i.uniforms.add([new LP("strokesTexture",s=>s.strokesTexture.texture),new vw("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)]),r.code.add(w`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${Hh(t,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),e.fragment.include(jc),i.code.add(w`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case Cn.SOLID:r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(w`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Cn.SKETCH:r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(w`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Cn.MIXED:e.varyings.add("vType","float"),r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(w`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function l_t(e){const t=new Lr,{vertex:r,fragment:i}=t;return e.legacy&&r.uniforms.add([new Tue("model"),new Tue("localView")]),t.include(t_t,e),t.include(s_t,e),t.include(o_t,e),t.include(tK,e),t.include(a_t,e),t.include(Ks,e),t.include(i_t,e),t.include(r_t,e),t.include(ju,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add([new kr("pixelToNDC",(s,n)=>or(c_t,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new fr("viewport",(s,n)=>n.camera.fullViewport),new Pe("pixelRatio",(s,n)=>n.camera.pixelRatio)]),t.attributes.add(A.POSITION0,"vec3"),t.attributes.add(A.POSITION1,"vec3"),t.attributes.add(A.VARIANTOFFSET,"float"),t.attributes.add(A.VARIANTSTROKE,"float"),t.attributes.add(A.VARIANTEXTENSION,"float"),r.code.add(w`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${e.antialiasing?w`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:w`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${e.mode===Cn.SKETCH?w`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:e.mode===Cn.MIXED?w`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(w`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),t}const c_t=Ke();class Tue extends Es{constructor(t){super(t,"mat4")}}const u_t=Object.freeze(Object.defineProperty({__proto__:null,build:l_t},Symbol.toStringTag,{value:"Module"}));class E8 extends Br{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===vt.WEBGL2}initializeProgram(t){return new Nr(t.rctx,E8.shader.get().build(this.configuration),YEe)}initializePipeline(t){return t.blendMinMax?Vt({blending:Wn(Ee.ONE,Ee.ONE,Ee.ZERO,Ee.ONE,Em.ADD,t.blendMinMax.MAX),depthTest:{func:Ni.LEQUAL},colorWrite:Qt}):Vt({depthTest:{func:Ni.LEQUAL},depthWrite:Jl,colorWrite:Qt})}}E8.shader=new Dr(u_t,()=>ie(()=>import("./EdgeShader.glsl.0ca6d8f9.js"),[]));class If extends ao{constructor(){super(...arguments),this.mode=Cn.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([B({count:Cn.COUNT})],If.prototype,"mode",void 0),u([B()],If.prototype,"hasSlicePlane",void 0),u([B()],If.prototype,"silhouette",void 0),u([B()],If.prototype,"legacy",void 0),u([B()],If.prototype,"antialiasing",void 0),u([B()],If.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],If.prototype,"hasMultipassTerrain",void 0),u([B()],If.prototype,"cullAboveGround",void 0),u([B()],If.prototype,"spherical",void 0);const h_t=8,AB=128,d_t={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},p_t={solid:Cn.SOLID,sketch:Cn.SKETCH,uber:Cn.MIXED};class xO{constructor(t,r,i){this._rctx=t,this._shaderTechniqueRepository=r,this._configuration=new If,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[ir.TRANSPARENT]:{[ir.TRANSPARENT]:new Jt,[ir.OPAQUE]:new Jt},[ir.OPAQUE]:{[ir.TRANSPARENT]:new Jt,[ir.OPAQUE]:new Jt}},this._renderablesDirty=!1,this._drawParameters=new Q0t,this._settings={...d_t,...i},this.key=xO.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Xr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=p_t[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=t.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=Wi(this._technique)}addRenderable(t){this._renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this._renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,r){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[r][ir.TRANSPARENT].forAll(t),this._sortedRenderables[r][ir.OPAQUE].forAll(t)}updateTechnique(t,r){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(E8,this._configuration,this._technique),this._technique}bindRegularEdges(t,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),t,r)}bindSilhouetteEdges(t,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),t,r)}renderRegularEdges(t,r,i,s,n){this._render(t,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(t,r,i,s,n){this._render(t,r,r.silhouette.vao,i,s,n)}_render(t,r,i,s,n,o){o>0&&(this._bindDraw(t,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(It.TRIANGLE_FAN,0,4,o))}_bindDraw(t,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(t.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),t.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new u8(r.transform.position),o=sd(Sue,Ax(Sue,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;ce(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[ir.TRANSPARENT][ir.TRANSPARENT].clear(),this._sortedRenderables[ir.TRANSPARENT][ir.OPAQUE].clear(),this._sortedRenderables[ir.OPAQUE][ir.TRANSPARENT].clear(),this._sortedRenderables[ir.OPAQUE][ir.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==ir.INVISIBLE&&r.edgeTransparency!==ir.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const t=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[ir.TRANSPARENT][ir.TRANSPARENT].sort(t),this._sortedRenderables[ir.TRANSPARENT][ir.OPAQUE].sort(t),this._sortedRenderables[ir.OPAQUE][ir.TRANSPARENT].sort(t),this._sortedRenderables[ir.OPAQUE][ir.OPAQUE].sort(t)}static getKey(t,r,i){return`edges-t:${t}:${r}:${i}`}}const Sue=Wl();function kSt(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:f_t(e.layout)}}function qL(e){return m_t(e.layout).createView(e.buffer)}function f_t(e){const t=new Array;return e.fields.forEach((r,i)=>{const s={...r,constructor:cCe(r.constructor)};t.push([i,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function m_t(e){const t=os();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(r=>t.fields.set(r[0],{...r[1],constructor:y_t(r[1].constructor)})),t}const g_t=[FP,nd,mi,Ma,Np,zE,GE,jE,yo,Zw,BE,wv,wy,Jw,xv,_o,Qw,HE,Kw,Tv,ex,qE,cM,uM,WE,tx,hM,dM,pM,rx,fM,mM,gM,yM,_M,vM];function cCe(e){return`${e.ElementType}_${e.ElementCount}`}function y_t(e){return uCe.get(e)}const uCe=new Map;g_t.forEach(e=>uCe.set(cCe(e),e));class __t extends KSe{constructor(t){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},t)}async process(t,r,i){if(i)return ayt(t);const s=await this.invoke(new RB(t),r);return this._unpackOutput(s)}async extractEdgeLocations(t,r){const i=await this.invokeMethod("extractEdgeLocations",new RB(t),r);return qL(i)}async extractComponentsEdgeLocations(t,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new RB(t),r);return qL(i)}_unpackOutput(t){return{regular:{instancesData:qL(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:qL(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}class RB{constructor(t){this.dataBuffer=t.data.buffer,this.writerSettings=t.writerSettings,this.skipDeduplicate=t.skipDeduplicate,this.indices=Array.isArray(t.indices)?t.indices:t.indices.buffer,this.indicesType=Array.isArray(t.indices)?"Array":TW(t.indices)?"Uint32Array":"Uint16Array",this.indicesLength=t.indicesLength}}function v_t(e){const r=QA.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=QA.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,h=QA.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:y}of QA.strokes){let _=m,b=y,x=p;for(let T=0;T<c;T++){T!==0&&(_=Eue(_,WM.DISTANCE),b=Eue(b,WM.PRESSURE));for(let S=0;S<QA.resolution;S++){const C=.5+(_?_[S%_.length]/a:0),O=b?b[S%b.length]:1;AM(C,s,x),AM(O,s,x+n),x+=4}x-=l*(h+1)}p+=l}const f=new lt(e,{pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:rt.LINEAR,width:r,height:r,wrapMode:Rt.REPEAT},s);return new w_t(r,a,o,h,f)}function Eue(e,t){if(!e)return null;const r=e.length/2,i=b_t*r,s=new Array(r);let n=0;const o=t===WM.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*Cue):Math.min(i,l*Cue)}return s}var WM;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(WM||(WM={}));const b_t=.1,Cue=.5;class w_t{constructor(t,r,i,s,n){this.resolution=t,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=tt(this.texture)}}const QA={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Aue(e){let t=null;for(const r of e){const i=r.type;if(x_t(r)){if(E(t))t=i;else if(t!==i)return"uber"}}return v(t)?t:"uber"}function Rue(e){let t=ir.INVISIBLE;for(const{material:r}of e)if(hCe(r)){if(r.color[3]*r.opacity<1)return ir.TRANSPARENT;t=ir.OPAQUE}return t}function Oue(e){let t=ir.INVISIBLE;for(const{material:r}of e)if(hCe(r)){switch(r.objectTransparency){case ir.TRANSPARENT:case ir.INVISIBLE:return ir.TRANSPARENT;case ir.OPAQUE:if(r.opacity<1)return ir.TRANSPARENT}t=ir.OPAQUE}return t}function hCe(e){return e.size*e.color[3]*e.opacity>0}function x_t(e){return e.size*e.color[3]>0}function Mue(e,t,r,i){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let Hd=class extends Te{constructor(e){super(e),this._updatingHandles=new om,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=M(),this._localOrigins=new Y0t(new mQ(e.renderSR))}initialize(){this._worker=new __t(this.schedule),this._componentColorManager=new QEe(this.rctx,3);const e=WEe.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this._verticesBufferObject=wr.createVertex(this.rctx,$r.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=tt(this._strokesTexture),this._componentColorManager=Ve(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=tt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,t,r,i,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new Iue(new Promise(p=>l=p),r.center,r.radius);this._perObjectData.set(e,c);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(t,c,i,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,r,i){if(this.destroyed)return void ee.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new Iue(new Promise(c=>n=c),o,ty(o));this._perObjectData.set(e,a);const l=new Array;if(r.mergeGeometries&&e.geometries.length>1&&T_t(e))l.push(this._addObjectMergedGeometries(e,a,t,r,i));else for(let c=0;c<e.geometries.length;c++){const h=e.geometries[c];h.material.supportsEdges&&l.push(this._addGeometry(e,a,h,t[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,t){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(E(r))return;const i=t instanceof Array?s=>t[s]:()=>t;r.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=i(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const t=await this._getObjectEntry(e);return v(t)?t.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,t,r,i){const s=e instanceof By,n=!!r.hasSlicePlane,o=Aue(t),a=xO.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(e));E(l)||(l.renderables.forEach(c=>{if(a!==c.rendererKey){const h=this._renderers.get(c.rendererKey),p=this._acquireRenderer(o,n,s);h.removeRenderable(c),--h.refCount,c.rendererKey=a,p.addRenderable(c)}for(let h=0;h<t.length;h++)c.components.meta[h].material=t[h];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,t){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));E(r)||(r.renderables.forEach(i=>{var n;const s=i.components.meta;for(let o=0;o<s.length;o++)i.components.meta[o].verticalOffset=(n=t==null?void 0:t[o])!=null?n:0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(e,t){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));v(r)&&(r.renderables.forEach(i=>i.visible=t),this.setNeedsRender())}removeObject(e){const t=this._perObjectData.get(e);t&&(this._perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this._perObjectData.get(e);if(!t)throw new Error("no object");return await t.loaded,t.loaded==null?null:t}render(e,t){if(E(this._componentColorManager))return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const r=e.camera.viewInverseTransposeMatrix,i=M(),s=new u8;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,h=!0;l.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,c&&p.regular&&(l.updateTechnique(e,!1),c=!1),h&&p.silhouette&&(l.updateTechnique(e,!0),h=!1))},t)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new J0t(40*n/o,t);ce(i,r[3],r[7],r[11]),s.set(i),le(a.transformWorldFromViewTH,s.high),le(a.transformWorldFromViewTL,s.low),id(a.transformViewFromCameraRelativeRS,e.camera.viewMatrix),sd(Nue,a.transformViewFromCameraRelativeRS),Ax(a.transformNormalViewFromGlobal,Nue),a.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(l=>{this._renderRegularEdges(l,e,a),this._renderSilhouetteEdges(l,e,a)})}_updateTransparency(e){const t=Rue(e.components.meta),r=Oue(e.components.meta);t===e.edgeTransparency&&r===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=r,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,r){e.getCombinedStaticTransformation(t,r);const i=v(t.localOrigin)?this._localOrigins.register(t.localOrigin):this._localOrigins.acquire(ce(this._tmpModelPosition,r[12],r[13],r[14]));return t.localOrigin=i.origin,W0t(i.origin.vec3,r),i}_updateComponentBuffer(e){const{meta:t,buffer:r}=e,i=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=ye(Math.round(n.size*h_t),0,255),l=ye(n.extensionLength,-AB,255-AB)+AB,c=n.type==="solid"?p5.SOLID:p5.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],y=255*p[2],_=255*p[3];r.textureBuffer.setData(o,0,f,m,y,_),r.textureBuffer.setData(o,1,a,l,c,h),HEe(t[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(e){if(E(this._componentColorManager))return null;const t=new Array,r=this._componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=r.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const i=new S_t(r,t);return this._updateComponentBuffer(i),i}_extractEdges(e,t,r,i,s,n=s.length){return this._worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(e,t,r,i,s){const n=c=>v(this._verticesBufferObject)?new E_t(new Bp(this.rctx,YEe,{vertices:Zgt,instances:c===qb.REGULAR?h5.glLayout:d5.glLayout},{vertices:this._verticesBufferObject,instances:wr.createVertex(this.rctx,$r.STATIC_DRAW,c===qb.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),c===qb.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,o=e.regular.lodInfo.lengths.length>0?n(qb.REGULAR):null,a=e.silhouette.lodInfo.lengths.length>0?n(qb.SILHOUETTE):null,l=(v(o)?o.vao.size:0)+(v(a)?a.vao.size:0);return new A_t(o,a,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:e.averageEdgeLength},r,Rue(t.meta),Oue(t.meta),t,i)}async _addGeometry(e,t,r,i,s,n){const o=r.vertexAttributes.get(A.POSITION),a=r.indices.get(A.POSITION),l=Ie(),c=this._computeModelTransformWithLocalOrigin(e,r,l),h=new Due(o,a,l,c);return this._addPositionData(t,h,r.edgeIndicesLength,i,s,n)}async _addPositionData(e,t,r,i,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([i]);if(E(o)||r<=0)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,f=p.data.length/p.size,m=c5.createBuffer(f);for(let b=0;b<f;b++)m.position.set(b,0,p.data[b*p.size+0]),m.position.set(b,1,p.data[b*p.size+1]),m.position.set(b,2,p.data[b*p.size+2]);Mue(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,r));if(e.loaded==null)return;const _=this._createRenderable(y,o,new C_t(l,c),a.key,!1);e.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(e,t,r,i,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(E(a))return 0;const l=Aue(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=c5.createBuffer(r.count);HU(h.position,r),Mue(a.meta,s,h.componentIndex,i);const p=!0,f=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(f,h,p,!1,i));if(t.loaded==null)return 0;const y=this._createRenderable(m,a,e,c.key,!0);return t.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,t,r,i,s){const n=new Map;let o=0,a=null,l=0;for(let x=0;x<e.geometries.length;x++){const T=e.geometries[x];if(!T.material.supportsEdges)continue;!a&&T.localOrigin&&(a=T);const S=T.vertexAttributes.get(A.POSITION);l+=S.data.length/S.size,o+=T.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let x=0;x<e.geometries.length;x++){const T=e.geometries[x];if(!T.material.supportsEdges)continue;const S=T.vertexAttributes.get(A.POSITION),C=T.indices.get(A.POSITION);let O=n.get(S.data);if(O==null){O=p.length/3;for(let R=0;R<S.data.length;R+=S.size)p.push(S.data[R+0]),p.push(S.data[R+1]),p.push(S.data[R+2]);n.set(S.data,O)}if(C)for(let R=0;R<T.edgeIndicesLength;R++)h[f++]=O+C[R]}const m=a||e.geometries[0],y=Ie(),_=this._computeModelTransformWithLocalOrigin(e,m,y);for(let x=0;x<e.geometries.length;x++)e.geometries[x].localOrigin=_.origin;const b=new Due({data:p,size:3},h,y,_);await this._updatingHandles.addPromise(this._addPositionData(t,b,h.length,r[0],i,s))}_acquireRenderer(e,t,r){const i=xO.getKey(e,t,r);let s=this._renderers.get(i);return E(this._strokesTexture)&&(this._strokesTexture=v_t(this.rctx)),s||(s=new xO(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===Ge.Global}),this._renderers.set(i,s)),++s.refCount,s}_removeRenderable(e){Pue(e.regular),Pue(e.silhouette);const t=this._renderers.get(e.rendererKey);if(t){t.removeRenderable(e),--t.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const r of e.components.meta)e.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,r=e.camera.viewForward,i=M(),s=n=>{lo(i,n.center,t);const o=_e(i,r),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,r){const i=e.bindRegularEdges(r,t),s=r.transparency,n=t.camera.perScreenPixelRatio;e.forEachRenderable(o=>{if(!$ue(o)||!o.visible)return;const a=WL(o.regular.lod.lengths,o.distanceToCamera,n);e.renderRegularEdges(i,o,r,t,a)},s)}_renderSilhouetteEdges(e,t,r){const i=e.bindSilhouetteEdges(r,t),s=r.transparency,n=t.camera.perScreenPixelRatio;e.forEachRenderable(o=>{if(!Lue(o)||!o.visible)return;const a=WL(o.silhouette.lod.lengths,o.distanceToCamera,n);e.renderSilhouetteEdges(i,o,r,t,a)},s)}get test(){return{hasRenderedPrimitives:e=>{let t=!1;const r=e.perScreenPixelRatio,i=(s,n)=>s.forEachRenderable(o=>{o.visible&&!t&&($ue(o)&&(t=WL(o.regular.lod.lengths,o.distanceToCamera,r)>0),!t&&Lue(o)&&(t=WL(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},n);return this._renderers.forEach(s=>{t||(i(s,ir.OPAQUE),i(s,ir.TRANSPARENT))}),t}}}};function Pue(e){v(e)&&(e.vao.vertexBuffers.instances.dispose(),e.vao.dispose(!1),e.vao=null)}function T_t(e){let t=null,r=null;for(let i=0;i<e.geometries.length;i++){const s=e.geometries[i];if(s.material.supportsEdges){if(t){if(!dy(t,s.transformation))return!1}else t=s.transformation;if(!r&&v(s.localOrigin))r=s;else if(r&&v(r.localOrigin)&&v(s.localOrigin)&&r.localOrigin.id!==s.localOrigin.id)return!1}}return!0}u([d({constructOnly:!0})],Hd.prototype,"rctx",void 0),u([d({constructOnly:!0})],Hd.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Hd.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],Hd.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],Hd.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],Hd.prototype,"schedule",void 0),u([d({readOnly:!0})],Hd.prototype,"_updatingHandles",void 0),u([d({readOnly:!0})],Hd.prototype,"updating",null),Hd=u([P("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Hd);class Iue{constructor(t,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class S_t{constructor(t,r){this.buffer=t,this.meta=r}}class E_t{constructor(t,r){this.vao=t,this.lod=r}}class C_t{constructor(t,r){this.modelMatrix=t,this.origin=r}}class A_t{constructor(t,r,i,s,n,o,a,l){this.regular=t,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function $ue(e){return v(e.regular)}function Lue(e){return v(e.silhouette)}function WL(e,t,r){const i=t*r,s=WAe(e,i,!0);return s===-1?i<e[0]?e.length:0:e.length-s}class Due{constructor(t,r,i,s){this.position=t,this.indices=r,this.modelTransform=i,this.origin=s}}const Nue=ns();function Vm(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}class Fue{constructor(t,r,i,s,n,o,a,l,c){this.createQuery=t,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}}let $g=!1;function R_t(e,t){if(t.disjointTimerQuery)return null;let r=e.getExtension("EXT_disjoint_timer_query_webgl2");return r&&Vm(e)?new Fue(()=>e.createQuery(),i=>{e.deleteQuery(i),$g=!1},i=>e.getQueryParameter(i,e.QUERY_RESULT_AVAILABLE),i=>e.getQueryParameter(i,e.QUERY_RESULT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>{$g||($g=!0,e.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{e.endQuery(r.TIME_ELAPSED_EXT),$g=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=e.getExtension("EXT_disjoint_timer_query"),r?new Fue(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),$g=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>{$g||($g=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),$g=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function O_t(e,t){const r=e.capabilities.disjointTimerQuery;return E(r)?null:new M_t(r,t)}class M_t{constructor(t,r){this._timer=t,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){$g||(this._currentQuery=this._queryPool.pop(),E(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(t){if(this._timer.disjoint()||E(this._currentQuery)||!this._queryResults.has(t))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(t);if(E(r))return this._queryResults.set(t,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(t,this._currentQuery),this._currentQuery=null,i}abort(){v(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){v(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(t=>{this._timer.deleteQuery(t)}),this._queryResults.forEach(t=>{E(t)||this._timer.deleteQuery(t)})}}var Ii;(function(e){e.OVERLAY="overlay",e.PREPARE="prepare",e.SHADOW_MAP="shadow map",e.LINEAR_DEPTH="linear depth",e.ACCUMULATED_SHADOWS="accumulated shadows",e.NORMALS="normals",e.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",e.SSAO="SSAO",e.OPAQUE="opaque",e.OPAQUE_EDGES="opaque edges",e.VOXEL="voxel",e.TRANSPARENT="transparent",e.TRANSPARENT_EDGES="transparent edges",e.HUD_VISIBILITY="HUD visibility",e.TRANSPARENT_TERRAIN="transparent terrain",e.ENVIRONMENT="environment",e.LASER_LINE="laser line",e.OCCLUDED="occluded",e.ANTIALIASING="antialiasing",e.HIGHLIGHTS="highlights",e.HUD="HUD",e.HUD_OCCLUDED="HUD occluded",e.FINISH="finish"})(Ii||(Ii={}));const Uue="Total";class P_t{constructor(t){this._rctx=t,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Xg(Uue),this._cpuTimeSamplers=new Map(Object.values(Ii).map(r=>[r,new Xg(r)])),this._enableGPUTimer=0,this._totalGPUTime=new Xg("GPU"),this._gpuTimeSamplers=new Map(Object.values(Ii).map(r=>[r,new Xg(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return v(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(E(this._gpuTimerPool)){const t=[...Object.values(Ii),Uue];this._gpuTimerPool=O_t(this._rctx,t)}return E(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:$W(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=tt(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),v(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(t){const r=performance.now();if(this._cpuTimeSamplers.get(t).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,v(this._gpuTimerPool)){const i=this._gpuTimerPool.stop(t);this._gpuTimeSamplers.get(t).record(i),this._gpuTimerPool.start()}}finishFrame(){if(v(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(Ii.FINISH);this._gpuTimeSamplers.get(Ii.FINISH).record(r)}const t=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+t,this._totalCPUTime.record(t),v(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}}let cu=class extends Te{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(e,t=this._state){return Pt(this._renderStateFeatures.get(t,e),!1)}setFeatureEnabled(e,t,r){this._renderStateFeatures.set(t,e,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(qs.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(qs.HighQualityTransparency)}get hasWaterReflection(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(qs.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(e,t,r,i,s,n,o,a){super({}),this._stage=e,this._materialRepository=t,this._shaderTechniqueRepository=i,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new Jt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new U0t,this._state=Sr.IDLE,this._renderStateFeatures=Tne(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=Fn.Opaque,this._waterReflectionEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Xyt,this._handles=new Jr,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new x3(this._rctx,i),a(),this._offscreen=new f0t(this._rctx,this._compositingHelper),this.performanceInfo=new P_t(this._rctx),this._shadowMap=new gQ(this._rctx,e.viewingMode),this._ssaoHelper=new k2e(e.view,i,this._rctx,a),this._highlight=new u0t(i,this._rctx),this._shadowHighlight=new F0t(this._rctx,e.viewingMode),this._shadowAccumulator=new Il(this._rctx,i,e,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,h)=>{l.shadowMap.start(l.camera,c,h),this._renderShadowCascades(k.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new Xst(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new y0t({renderContext:this._renderContext,techniqueRepository:i,textureRepository:r,materialRepository:this._materialRepository,requestRender:a,controller:e}),this.renderPassManager=new Wyt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([se(()=>this._stage.view.state.camera,()=>a(),Ys),se(()=>Xr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(ir.TRANSPARENT):()=>{},a()},kt),se(()=>this._ssaoEnabled||this.isFeatureEnabled(qs.SSAO),l=>this._ssaoHelper.enabled=l,Ys)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=zi(this._gpuTimerHandle),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=tt(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),Q6.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||v(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return E(this._edgeView)&&(this._edgeView=new Hd({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.view.resourceController.immediate.schedule(e)}),this._handles.add(se(()=>ho(this._edgeView,e=>e.updating),()=>this._requestRender(),ri)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return jX(this._bindParameters.ssr.reprojectionMatrix,Bu)}set _reprojectionMatrix(e){bW(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){const{_shadowMap:t,_bindParameters:r}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),v(e.environment)){v(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&this._ssaoEnabled!==e.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const i=e.environment.lighting.type!=="virtual";r.enableFillLights!==i&&(r.enableFillLights=i,this._requestRender())}e.background&&this._offscreen.background!==e.background&&(this._offscreen.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==e.antialiasingEnabled&&(this._antialiasingEnabled=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,t){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:s}=e;if(r.length===0&&i.length===0&&s.length===0)return;const n=C2e(e);let o=!1;n.forEach((a,l)=>{if(t.done)return;let c=this._materialRenderers.find(h=>h.material===l);E(c)&&a.adds.length>0&&(c=new N2e(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(h=>e.removes.removeUnordered(h)),a.adds.forEach(h=>e.adds.removeUnordered(h)),a.updates.forEach(h=>e.updates.removeUnordered(h)),t.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(Se.LINE_CALLOUTS_HUD_DEPTH,k.Color)||a.requiresSlot(Se.HUD_MATERIAL,k.Color)||a.requiresSlot(Se.LABEL_MATERIAL,k.Color)),this._requestRender()}updateAnimation(e){const t=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations!==t&&(this._gpuTimerHandle=t?zi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(e,t,r,i,s){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:n,contentCamera:o,mode:a}=r;this._state=a,this._renderOverlay(s),this.performanceInfo.advance(Ii.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=xt.NONE;const l=this._offscreen;l.setupRenderTarget(this.hasWaterReflection);const c=Oy(this._sliceHelper.plane);i===qw.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Ii.PREPARE);const h=this._computeDepthRange(n);this._renderShadowMap(e,n,this._bindParameters.lighting.mainLight.direction,h),this.performanceInfo.advance(Ii.SHADOW_MAP),l.initializeFrame(n),this._ensureBindParameters(n,o),this._renderLinearDepth(),this.performanceInfo.advance(Ii.LINEAR_DEPTH),this._accumulateShadows(h,n,o),this.performanceInfo.advance(Ii.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(Ii.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(Ii.SSAO),this._renderContext.output=k.Color,l.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Ii.OPAQUE);const p=this._terrainRenderingEnabled&&(this._terrainTransparency===Fn.Semitransparent||this._terrainTransparency===Fn.TransparentWithDraped),f=this._highQualityTransparency&&p;this._renderTerrainLinearDepth(f),this._setMultipassEnabled(f),this._setTerrainCulling(f),this._renderEdges(ir.OPAQUE),this.performanceInfo.advance(Ii.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(Se.VOXEL),this.performanceInfo.advance(Ii.VOXEL),this._renderHiddenTransparentEdges();const m=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;m&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Ii.TRANSPARENT),this._renderGeometryLinearDepth(f);const y=this._renderHUDVisibility(f);f||this._renderInternalSlot(Se.LINE_CALLOUTS),this.performanceInfo.advance(Ii.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(t),this.performanceInfo.advance(Ii.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(ir.TRANSPARENT,f),this.performanceInfo.advance(Ii.TRANSPARENT_EDGES),this._renderTransparentTerrain(),p&&y&&(f?this._renderLineCallouts(fu.Occluded):l.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(fu.Occluded,l.framebuffer),this.performanceInfo.advance(Ii.HUD_OCCLUDED)),this.performanceInfo.advance(Ii.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),p&&(l.compositeTransparentTerrainOntoMain(this._bindParameters),f&&(this._renderEdges(ir.OPAQUE),this.performanceInfo.advance(Ii.OPAQUE_EDGES),m&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Ii.TRANSPARENT),this._renderEdges(ir.TRANSPARENT),this.performanceInfo.advance(Ii.TRANSPARENT_EDGES))),f&&this._renderLineCallouts(fu.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),l.renderToTargets(()=>{this._renderInternalSlot(Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Se.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Se.LASERLINES)},l.currentColorTarget,l.mainDepth),this.performanceInfo.advance(Ii.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&l.renderTmpAndCompositeToMain(()=>this._renderSlot(Se.LASERLINES_CONTRAST_CONTROL),this._bindParameters,xa.PremultipliedAlpha),this.performanceInfo.advance(Ii.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(Ii.OCCLUDED);const _=i===qw.ON&&this._magnifierHelper.enabled,b=_&&E(e)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):e;this._rctx.bindFramebuffer(b);const x=this._offscreen.colorTexture;!this._renderAntiAliasing(x)&&v(x)&&this._compositingHelper.composite(this._bindParameters,x,xa.None),this.performanceInfo.advance(Ii.ANTIALIASING),this._renderHUD(fu.NotOccluded,b),this.performanceInfo.advance(Ii.HUD),this._renderHighlights(b,this._bindParameters),this.performanceInfo.advance(Ii.HIGHLIGHTS),_&&this._magnifierHelper.render(this._rctx,this._bindParameters),b!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,xa.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=c,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(e){if(v(e)&&de("enable-feature:objectAndLayerId-rendering")){const t=this._renderContext.output;this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(k.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=fu.NotOccluded,this._renderInternalSlot(Se.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=t}}finish(e){this._hasAnimations||this._animationTimestep.clear();const t=this.performanceInfo.gpuSamplingEnabled,r=e===Ds.BACKGROUND;if(r||t){const i=r?this.performanceInfo.elapsedTime:0,s=t?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(i,s);this._animationTimestep.frame(n,r)}}readDepthPixels(e,t,r){const i=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=Vi.COLOR_BUFFER_BIT|Vi.DEPTH_BUFFER_BIT|Vi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(k.Depth)}i.readPixels(t[0],t[1],t[2],t[3],ze.RGBA,$t.UNSIGNED_BYTE,r)}readHUDVisibility(e,t,r,i,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(e,t,r,i,ze.RGBA,$t.UNSIGNED_BYTE,s)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const r=this._edgeView;v(r)&&r.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,e),this._bindParameters,xa.Alpha,t)}_renderShadowMap(e,t,r,i){const s=this._shadowMap;s.enabled&&this.isFeatureEnabled(qs.ShadowMapUpdate)&&(s.start(t,r,i),this._shadowHighlight.updateParameters(t,r),this._needsShadowHighlight?(this._renderShadowCascades(k.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,sC.Highlight)),s.clear(),this._renderShadowCascades(k.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,sC.Default),this._renderGeometryAndTransparentTerrainPass(k.ShadowHighlight)})):this._renderShadowCascades(k.Shadow),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,r=i=>{}){for(const i of t.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(e),r(i)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(k.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.output;this._renderContext.output=k.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=t}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(k.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=t}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(k.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return Iq;const t=Myt(e,this._materialRenderers,this._stage.layers);return cC(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(e){this._ssaoHelper.render(this._bindParameters,e,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(Se.INTEGRATED_MESH),this._renderSlot(Se.OPAQUE_TERRAIN),this._renderInternalSlot(Se.OPAQUE_MATERIAL),this._renderSlot(Se.OPAQUE_MATERIAL),this._renderSlot(Se.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Se.TRANSPARENT_MATERIAL),this._renderSlot(Se.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Se.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let t=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,t=this._renderInternalSlot(Se.OCCLUSION_PIXELS)},e),t}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===fu.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(Se.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Se.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,xa.PremultipliedAlpha)):e===fu.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(fu.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Se.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Se.HUD_MATERIAL),this._renderInternalSlot(Se.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,t){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const r=this._highlight,i=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(k.Highlight),this._rctx.clearSafe(Vi.DEPTH_BUFFER_BIT),this._renderHUDElements(fu.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(t,e),r.render(this._bindParameters,i,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,r){this._needsShadowCast&&v(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,e,t,r)}_renderOrderIndependentTransparency(e,t){const r=s=>{this._bindParameters.transparencyPassType=s,this._offscreen.renderOITPass(()=>e(),s,t)},i=this._renderContext.output;this._renderContext.output=k.Alpha,r(xt.Alpha),this._renderContext.output=k.Color,r(xt.Color),r(xt.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=xt.NONE,this._renderContext.output=i,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;Sd.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===us.OccludeAndTransparentStencil&&(e|=n.material.renderOccluded,Sd.push(n))});const t=this._offscreen,r=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};Sd.length!==0&&(this._renderInternalSlot(Se.OCCLUDER_MATERIAL,Sd),r(.5,us.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Se.TRANSPARENT_OCCLUDER_MATERIAL,Sd),!1,!1)),Sd.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===us.OccludeAndTransparent||n.material.renderOccluded===us.Transparent||n.material.renderOccluded===us.Opaque)&&(e|=n.material.renderOccluded,Sd.push(n))});const i=this._renderPlugins.renderOccludedFlags;if(e|=i,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,i>us.Occlude&&this._renderSlot(Se.OCCLUDED_TERRAIN),this._renderInternalSlot(Se.OPAQUE_MATERIAL,Sd),this._renderInternalSlot(Se.TRANSPARENT_MATERIAL,Sd),this._renderInternalSlot(Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Sd),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=k.Color,r(.5,us.OccludeAndTransparent,()=>s(us.OccludeAndTransparent),!0,ql.OutlineVisualElementMask),r(.5,us.Transparent,()=>s(us.Transparent),!0,ql.OutlineVisualElementMask),r(1,us.Opaque,()=>s(us.Opaque),!0,ql.OutlineVisualElementMask),Sd.clear()}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&v(e))return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,t){this._needsTransparentPass=this._materialRenderers.some(r=>r.requiresSlot(Se.TRANSPARENT_MATERIAL,k.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var i;this._bindParameters.camera=e,this._bindParameters.contentCamera=t;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=(i=r.depthTexture)!=null?i:this._getFallbackDepthTexture()}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.enabled=this.hasWaterReflection,this._bindParameters.ssr.enabled){E(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Bu:(ko(Vue,this._bindParameters.camera.viewMatrix),ko(kue,this._bindParameters.camera.projectionMatrix),ws(kT,Vue,kue),ws(kT,this._renderContext.lastFrameCamera.viewMatrix,kT),ws(kT,this._renderContext.lastFrameCamera.projectionMatrix,kT),this._reprojectionMatrix=kT),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const t=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=t>0?Math.min(t,e-this._waterReflectionEnableTime)/t:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._waterReflectionEnableTime=null}_renderInternalSlot(e,t=this._materialRenderers){let r=!1;return this._bindParameters.slot=e,t.forAll(i=>{i.material.shouldRender(this._renderContext)&&i.render(this._renderContext.output,this._bindParameters)&&(r=!0)}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=Abe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,r,i,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreen)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((i=(r=this._highlight)==null?void 0:r.gpuMemoryUsage)!=null?i:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{e._renderStateFeatures=Tne()},getFramebufferTexture:t=>{switch(t){case w_.Color:return e._offscreen.colorTexture;case w_.LinearDepth:return e._offscreen.linearDepthTexture;case w_.Normals:return e._offscreen.normalTexture;case w_.ShadowMap:return e._shadowMap.depthTexture;case w_.HudVisibility:return e._offscreen.hudVisibilityTexture;case w_.Highlight:return e._offscreen.highlightTexture}}}}};var w_;u([d()],cu.prototype,"_shadowAccumulator",void 0),u([d()],cu.prototype,"_state",void 0),u([d()],cu.prototype,"_renderStateFeatures",void 0),u([d()],cu.prototype,"_antialiasingEnabled",void 0),u([d({readOnly:!0})],cu.prototype,"_antialiasing",null),u([d()],cu.prototype,"_ssaoEnabled",void 0),u([d()],cu.prototype,"_smaaPass",void 0),u([d({autoDestroy:!0})],cu.prototype,"_edgeView",void 0),u([d()],cu.prototype,"updating",null),u([d()],cu.prototype,"isCameraFinal",null),cu=u([P("esri.views.3d.webgl-engine.lib.Renderer")],cu),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(w_||(w_={}));const Sd=new Jt,kue=Ie(),Vue=Ie(),kT=Ie();class Bue{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ee.ONE,dstRGB:Ee.ZERO,srcAlpha:Ee.ONE,dstAlpha:Ee.ZERO},this.blendEquation={mode:Em.ADD,modeAlpha:Em.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=gp.BACK,this.frontFace=NE.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Ni.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:gp.FRONT_AND_BACK,func:Ni.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:gp.FRONT_AND_BACK,fail:ks.KEEP,zFail:ks.KEEP,zPass:ks.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}}class I_t{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}get information(){let t="";if(this._allocations.size>0){t+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{var s;r.set(i,((s=r.get(i))!=null?s:0)+1)}),r.forEach((i,s)=>{const n=s.split(`
`);n.shift(),n.shift(),t+=`${i}: ${n.shift()}
`,n.forEach(o=>t+=`   ${o}
`)})}return t}}const $_t={RECORD_ALLOCATIONS:!1};class L_t{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new I_t($_t.RECORD_ALLOCATIONS);this._current.length<Gn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,r){const i=++this._current[t];this._max[t]=Math.max(i,this._max[t]),this._allocations.add(r)}decrement(t,r){--this._current[t],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,r)=>t+r,0)}get resourceInformation(){let t="";if(this.total>0){t+=`Live objects:
`;for(let r=0;r<Gn.COUNT;++r){const i=this._current[r];i>0&&(t+=`${Gn[r]}: ${i}
`)}}return t+=this._allocations.information,t}}const D_t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var zue,Bq={},N_t={get exports(){return Bq},set exports(e){Bq=e}};(zue=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(N_t.exports=zue);const F_t=Bq;var Gue,zq={},U_t={get exports(){return zq},set exports(e){zq=e}};Gue=U_t,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(Gue.exports=t)}();const jue=zq;var Gq={},k_t={get exports(){return Gq},set exports(e){Gq=e}};(function(e){(function(t){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(e.exports=r)})()})(k_t);const V_t=Gq;var Ed=999,Hue=9999,OB=0,MB=1,que=2,Wue=3,Xue=4,XL=5,B_t=6,z_t=7,G_t=8,Yue=9,j_t=10,Zue=11,H_t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function q_t(){var e,t,r,i=0,s=0,n=Ed,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(z){return a=[],z!==null?_(z.replace?z.replace(/\r\n/g,`
`):z):b()};function y(z){z.length&&a.push({type:H_t[n],data:z,position:h,line:l,column:c})}function _(z){var Z;for(i=0,r=(m+=z).length;e=m[i],i<r;){switch(Z=i,n){case OB:i=O();break;case MB:i=C();break;case que:i=S();break;case Wue:i=R();break;case Xue:i=U();break;case Zue:i=I();break;case XL:i=V();break;case Hue:i=G();break;case Yue:i=T();break;case Ed:i=x()}Z!==i&&(m[Z]===`
`?(c=0,++l):++c)}return s+=i,m=m.slice(i),a}function b(z){return o.length&&y(o.join("")),n=j_t,y("(eof)"),a}function x(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+i-1,n=OB,t=e,i+1):t==="/"&&e==="/"?(h=s+i-1,n=MB,t=e,i+1):e==="#"?(n=que,h=s+i,i):/\s/.test(e)?(n=Yue,h=s+i,i):(p=/\d/.test(e),f=/[^\w_]/.test(e),h=s+i,n=p?Xue:f?Wue:Hue,i)}function T(){return/[^\s]/g.test(e)?(y(o.join("")),n=Ed,i):(o.push(e),t=e,i+1)}function S(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,i+1):(y(o.join("")),n=Ed,i)}function C(){return S()}function O(){return e==="/"&&t==="*"?(o.push(e),y(o.join("")),n=Ed,i+1):(o.push(e),t=e,i+1)}function R(){if(t==="."&&/\d/.test(e))return n=XL,i;if(t==="/"&&e==="*")return n=OB,i;if(t==="/"&&e==="/")return n=MB,i;if(e==="."&&o.length){for(;$(o););return n=XL,i}if(e===";"||e===")"||e==="("){if(o.length)for(;$(o););return y(e),n=Ed,i+1}var z=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||z){for(;$(o););return n=Ed,i}return o.push(e),t=e,i+1}function $(z){for(var Z,Q,te=0;;){if(Z=jue.indexOf(z.slice(0,z.length+te).join("")),Q=jue[Z],Z===-1){if(te--+z.length>0)continue;Q=z.slice(0,1).join("")}return y(Q),h+=Q.length,(o=o.slice(Q.length)).length}}function I(){return/[^a-fA-F0-9]/.test(e)?(y(o.join("")),n=Ed,i):(o.push(e),t=e,i+1)}function U(){return e==="."||/[eE]/.test(e)?(o.push(e),n=XL,t=e,i+1):e==="x"&&o.length===1&&o[0]==="0"?(n=Zue,o.push(e),t=e,i+1):/[^\d]/.test(e)?(y(o.join("")),n=Ed,i):(o.push(e),t=e,i+1)}function V(){return e==="f"&&(o.push(e),t=e,i+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,i+1):/[^\d]/.test(e)?(y(o.join("")),n=Ed,i):(o.push(e),t=e,i+1)}function G(){if(/[^\d\w_]/.test(e)){var z=o.join("");return n=F_t.indexOf(z)>-1?G_t:V_t.indexOf(z)>-1?z_t:B_t,y(o.join("")),n=Ed,i}return o.push(e),t=e,i+1}}function W_t(e){var t=q_t(),r=[];return r=(r=r.concat(t(e))).concat(t(null))}function X_t(e){return W_t(e)}function Y_t(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const PB=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Z_t(e,t="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===r)return o;if(o===t)return s.data="#version "+r,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function J_t(e,t){for(let r=t-1;r>=0;r--){const i=e[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function T3(e,t,r,i){i=i||r;for(const s of e)if(s.type==="ident"&&s.data===r)return i in t?t[i]++:t[i]=0,T3(e,t,i+"_"+t[i],i);return r}function dCe(e,t,r="afterVersion"){function i(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=i(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function Q_t(e,t,r,i="lowp"){dCe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function K_t(e,t,r,i,s="lowp"){dCe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function evt(e,t){let r,i,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&e.splice(r,i-r+1),s}function Jue(e,t){const r=tvt();if(v(r))return r;const i=X_t(e);if(Z_t(i,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<i.length;++l){const c=i[l];switch(c.type){case"keyword":t===Eu.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===Eu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===Eu.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=T3(i,o,"fragColor"),Q_t(i,s,"vec4")),c.data=s),t===Eu.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=evt(i,l+1),p=T3(i,o,"fragData");K_t(i,p,"vec4",h,"mediump"),c.data=p}else t===Eu.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=T3(i,o,"gl_FragDepth")),c.data=n);break;case"ident":if(D_t.includes(c.data)){if(t===Eu.VERTEX_SHADER&&J_t(i,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=T3(i,o,c.data)),c.data=a[c.data]}}}for(let l=i.length-1;l>=0;--l){const c=i[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&PB.includes(h[1].trim())){const m=i[l+1];i.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&PB.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&PB.includes(f[1].trim())&&(c.data="#if 0")}}return rvt(e,Y_t(i))}function tvt(e){return null}function rvt(e,t){return t}const ivt=4294967295;class svt{constructor(t,r,i,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===vt.WEBGL2&&(r=Jue(r,Eu.VERTEX_SHADER),i=Jue(i,Eu.FRAGMENT_SHADER)),this._vShader=Que(this._context,Eu.VERTEX_SHADER,r),this._fShader=Que(this._context,Eu.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Gn.Shader,this),SH()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),SH()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===vt.WEBGL2){const l=o;for(const[c,h]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<ivt&&l.uniformBlockBinding(a,p,h)}}this._glName=a,this._context.instanceCounter.increment(Gn.Program,this)}get glName(){return this._glName}get hasGLName(){return v(this._glName)}get compiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null||E(this.glName)?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Gn.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Gn.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&v(this.glName)&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1iv(t,r){cf(this._nameToUniform1v,t,r)&&this._context.gl.uniform1iv(this._getUniformLocation(t),r)}setUniform2iv(t,r){cf(this._nameToUniform2,t,r)&&this._context.gl.uniform2iv(this._getUniformLocation(t),r)}setUniform3iv(t,r){cf(this._nameToUniform3,t,r)&&this._context.gl.uniform3iv(this._getUniformLocation(t),r)}setUniform4iv(t,r){cf(this._nameToUniform4,t,r)&&this._context.gl.uniform4iv(this._getUniformLocation(t),r)}setUniform1f(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1fv(t,r){cf(this._nameToUniform1v,t,r)&&this._context.gl.uniform1fv(this._getUniformLocation(t),r)}setUniform2f(t,r,i){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),this._nameToUniform2.set(t,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),s[0]=r,s[1]=i)}setUniform2fv(t,r){cf(this._nameToUniform2,t,r)&&this._context.gl.uniform2fv(this._getUniformLocation(t),r)}setUniform3f(t,r,i,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,s),this._nameToUniform3[t]=[r,i,s]):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(t,r){cf(this._nameToUniform3,t,r)&&this._context.gl.uniform3fv(this._getUniformLocation(t),r)}setUniform4f(t,r,i,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,s,n),this._nameToUniform4.set(t,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(t,r){cf(this._nameToUniform4,t,r)&&this._context.gl.uniform4fv(this._getUniformLocation(t),r)}setUniformMatrix3fv(t,r,i=!1){cf(this._nameToUniformMatrix3,t,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),i,r)}setUniformMatrix4fv(t,r,i=!1){cf(this._nameToUniformMatrix4,t,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),i,r)}stop(){}}function Que(e,t,r){const i=e.gl,s=i.createShader(t);return i.shaderSource(s,r),i.compileShader(s),SH()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===Eu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(nvt(r))),s}function nvt(e){let t=2;return e.replace(/\n/g,()=>`
`+ovt(t++)+":")}function ovt(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function cf(e,t,r){const i=e.get(t);return i?bW(i,r):(e.set(t,Array.from(r)),!0)}class avt{constructor(t){this._rctx=t,this._store=new DC}dispose(){this._store.forEach(t=>t.forEach(r=>r.dispose())),this._store.clear()}acquire(t,r,i,s){const n=this._store.get(t,r);if(v(n))return n.ref(),n;const o=new svt(this._rctx,t,r,i,s);return o.ref(),this._store.set(t,r,o),o}get test(){let t=0;return this._store.forEach(r=>r.forEach(i=>t+=i.hasGLName?2:1)),{cachedWebGLObjects:t}}}class tI{constructor(){this._result=!1}dispose(){this._program=tt(this._program)}get result(){return v(this._program)&&(this._result=this._test(this._program),this.dispose()),this._result}}class lvt extends tI{constructor(t){super(),this._rctx=t,this._dummyProgram=null,this._rctx.type===vt.WEBGL2&&de("mac")&&de("chrome")&&(this._program=this._prepareProgram(),this._dummyProgram=this._prepareDummyProgram())}dispose(){var t;super.dispose(),(t=this._dummyProgram)==null||t.dispose(),this._dummyProgram=null}_test(t){const r=this._rctx;r.resetState();const i=new Li(r,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},{target:bt.TEXTURE_2D,wrapMode:Rt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,width:1,height:1}),s=wr.createIndex(this._rctx,$r.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.useProgram(this._dummyProgram),r.bindBuffer(s,Ot.ELEMENT_ARRAY_BUFFER),r.drawElements(It.POINTS,1,at.UNSIGNED_BYTE,0),r.useProgram(t),r.bindVAO(null),r.drawArrays(It.TRIANGLES,0,258);const n=new Uint8Array(4);return i.readPixels(0,0,1,1,ze.RGBA,$t.UNSIGNED_BYTE,n),i.dispose(),s.dispose(),n[0]===255}_prepareProgram(){const r=`
    precision highp float;

    varying float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${w.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`
    precision highp float;

    varying float triangleId;

    void main(void) {
      gl_FragColor = triangleId == ${w.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareDummyProgram(){const t=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,r=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(t,r,new Map([]))}}class cvt extends tI{constructor(t){super(),this._rctx=t,this._program=Kue(this._rctx,!1),this._obfuscated=Kue(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=tt(this._obfuscated)}_test(t){if(de("force-double-precision-obfuscation"))return!0;if(E(this._obfuscated))return!1;const r=this._runProgram(t),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(t){const r=this._rctx;r.resetState();const i=new Li(r,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},{target:bt.TEXTURE_2D,wrapMode:Rt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,width:1,height:1}),s=wr.createVertex(r,$r.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new rd(r,new Map([["position",0]]),{geometry:[new Vo("position",2,at.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Le(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Le(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=new Float32Array(6);MH(o,l,3);const c=new Float32Array(6);MH(a,c,3),r.useProgram(t),t.setUniform3f("u_highA",l[0],l[2],l[4]),t.setUniform3f("u_lowA",l[1],l[3],l[5]),t.setUniform3f("u_highB",c[0],c[2],c[4]),t.setUniform3f("u_lowB",c[1],c[3],c[5]),r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.bindVAO(n),r.drawArrays(It.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);i.readPixels(0,0,1,1,ze.RGBA,$t.UNSIGNED_BYTE,h),n.dispose(!1),s.dispose(),i.dispose();const p=(o[2]-a[2])/25,f=WJ(h);return Math.abs(p-f)}}function Kue(e,t){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return e.programCache.acquire(r,i,new Map([["position",0]]))}var ehe,the,jq={},uvt={get exports(){return jq},set exports(e){jq=e}};ehe=uvt,(the=function(){var e=function(_){window.console&&window.console.log&&window.console.log(_)},t=function(_){window.console&&window.console.error?window.console.error(_):e(_)},r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},i=null,s=null;function n(_){if(i==null)for(var b in i={},s={},_)typeof _[b]=="number"&&(i[_[b]]=b,s[b]=_[b])}function o(){if(i==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(_){return o(),i[_]!==void 0}function l(_){o();var b=i[_];return b!==void 0?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+_.toString(16)}function c(_,b,x,T){var S;if((S=r[_])!==void 0&&(S=S[b])!==void 0&&S[x]){if(typeof S[x]=="object"&&S[x].enumBitwiseOr!==void 0){for(var C=S[x].enumBitwiseOr,O=0,R=[],$=0;$<C.length;++$){var I=s[C[$]];(T&I)!=0&&(O|=I,R.push(l(I)))}return O===T?R.join(" | "):l(T)}return l(T)}return T===null?"null":T===void 0?"undefined":T.toString()}function h(_,b){for(var x="",T=b.length,S=0;S<T;++S)x+=(S==0?"":", ")+c(_,T,S,b[S]);return x}function p(_,b,x){_.__defineGetter__(x,function(){return b[x]}),_.__defineSetter__(x,function(T){b[x]=T})}function f(_,b,x,T){T=T||_,n(_),b=b||function(I,U,V){for(var G="",z=V.length,Z=0;Z<z;++Z)G+=(Z==0?"":", ")+c(U,z,Z,V[Z]);t("WebGL error "+l(I)+" in "+U+"("+G+")")};var S={};function C(I,U){return function(){x&&x(U,arguments);var V=I[U].apply(I,arguments),G=T.getError();return G!=0&&(S[G]=!0,b(G,U,arguments)),V}}var O={};for(var R in _)if(typeof _[R]=="function")if(R!="getExtension")O[R]=C(_,R);else{var $=C(_,R);O[R]=function(){return f($.apply(_,arguments),b,x,T)}}else p(O,_,R);return O.getError=function(){for(var I in S)if(S.hasOwnProperty(I)&&S[I])return S[I]=!1,I;return _.NO_ERROR},O}function m(_){var b=_.getParameter(_.MAX_VERTEX_ATTRIBS),x=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,x);for(var T=0;T<b;++T)_.disableVertexAttribArray(T),_.vertexAttribPointer(T,4,_.FLOAT,!1,0,0),_.vertexAttrib1f(T,0);_.deleteBuffer(x);var S=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS);for(T=0;T<S;++T)_.activeTexture(_.TEXTURE0+T),_.bindTexture(_.TEXTURE_CUBE_MAP,null),_.bindTexture(_.TEXTURE_2D,null);for(_.activeTexture(_.TEXTURE0),_.useProgram(null),_.bindBuffer(_.ARRAY_BUFFER,null),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.disable(_.BLEND),_.disable(_.CULL_FACE),_.disable(_.DEPTH_TEST),_.disable(_.DITHER),_.disable(_.SCISSOR_TEST),_.blendColor(0,0,0,0),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.ONE,_.ZERO),_.clearColor(0,0,0,0),_.clearDepth(1),_.clearStencil(-1),_.colorMask(!0,!0,!0,!0),_.cullFace(_.BACK),_.depthFunc(_.LESS),_.depthMask(!0),_.depthRange(0,1),_.frontFace(_.CCW),_.hint(_.GENERATE_MIPMAP_HINT,_.DONT_CARE),_.lineWidth(1),_.pixelStorei(_.PACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,!1),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_.UNPACK_COLORSPACE_CONVERSION_WEBGL&&_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.BROWSER_DEFAULT_WEBGL),_.polygonOffset(0,0),_.sampleCoverage(1,!1),_.scissor(0,0,_.canvas.width,_.canvas.height),_.stencilFunc(_.ALWAYS,0,4294967295),_.stencilMask(4294967295),_.stencilOp(_.KEEP,_.KEEP,_.KEEP),_.viewport(0,0,_.canvas.width,_.canvas.height),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT|_.STENCIL_BUFFER_BIT);_.getError(););}function y(_){var b,x,T=[],S=[],C={},O=1,R=!1,$=[],I=0,U=0,V=!1,G=0,z={};function Z(W){return typeof W=="function"?W:function(ue){W.handleEvent(ue)}}_.getContext=(x=_.getContext,function(){var W=x.apply(_,arguments);if(W instanceof WebGLRenderingContext){if(W!=b){if(b)throw"got different context";C=K(b=W)}return C}return W});var Q=function(W){T.push(Z(W))},te=function(W){S.push(Z(W))};function q(W){var ue=W.addEventListener;W.addEventListener=function(pe,we,Ce){switch(pe){case"webglcontextlost":Q(we);break;case"webglcontextrestored":te(we);break;default:ue.apply(W,arguments)}}}function L(){for(var W=Object.keys(z),ue=0;ue<W.length;++ue)delete z[W]}function N(){++U,R||I==U&&_.loseContext()}function F(W,ue){var pe=W[ue];return function(){if(N(),!R)return pe.apply(W,arguments)}}function H(){for(var W=0;W<$.length;++W){var ue=$[W];ue instanceof WebGLBuffer?b.deleteBuffer(ue):ue instanceof WebGLFramebuffer?b.deleteFramebuffer(ue):ue instanceof WebGLProgram?b.deleteProgram(ue):ue instanceof WebGLRenderbuffer?b.deleteRenderbuffer(ue):ue instanceof WebGLShader?b.deleteShader(ue):ue instanceof WebGLTexture&&b.deleteTexture(ue)}}function X(W){return{statusMessage:W,preventDefault:function(){V=!0}}}return q(_),_.loseContext=function(){if(!R){for(R=!0,I=0,++O;b.getError(););L(),z[b.CONTEXT_LOST_WEBGL]=!0;var W=X("context lost"),ue=T.slice();setTimeout(function(){for(var pe=0;pe<ue.length;++pe)ue[pe](W);G>=0&&setTimeout(function(){_.restoreContext()},G)},0)}},_.restoreContext=function(){R&&S.length&&setTimeout(function(){if(!V)throw"can not restore. webglcontestlost listener did not call event.preventDefault";H(),m(b),R=!1,U=0,V=!1;for(var W=S.slice(),ue=X("context restored"),pe=0;pe<W.length;++pe)W[pe](ue)},0)},_.loseContextInNCalls=function(W){if(R)throw"You can not ask a lost contet to be lost";I=U+W},_.getNumCalls=function(){return U},_.setRestoreTimeout=function(W){G=W},_;function K(W){for(var ue in W)typeof W[ue]=="function"?C[ue]=F(W,ue):p(C,W,ue);C.getError=function(){if(N(),!R)for(;xe=b.getError();)z[xe]=!0;for(var xe in z)if(z[xe])return delete z[xe],xe;return C.NO_ERROR};for(var pe=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],we=0;we<pe.length;++we){var Ce=pe[we];C[Ce]=function(xe){return function(){if(N(),R)return null;var Fe=xe.apply(W,arguments);return Fe.__webglDebugContextLostId__=O,$.push(Fe),Fe}}(W[Ce])}var qe=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(we=0;we<qe.length;++we)Ce=qe[we],C[Ce]=function(xe){return function(){return N(),R?null:xe.apply(W,arguments)}}(C[Ce]);var Ne=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(we=0;we<Ne.length;++we)Ce=Ne[we],C[Ce]=function(xe){return function(){return N(),!R&&xe.apply(W,arguments)}}(C[Ce]);return C.checkFramebufferStatus=function(xe){return function(){return N(),R?C.FRAMEBUFFER_UNSUPPORTED:xe.apply(W,arguments)}}(C.checkFramebufferStatus),C.getAttribLocation=function(xe){return function(){return N(),R?-1:xe.apply(W,arguments)}}(C.getAttribLocation),C.getVertexAttribOffset=function(xe){return function(){return N(),R?0:xe.apply(W,arguments)}}(C.getVertexAttribOffset),C.isContextLost=function(){return R},C}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:y,resetToInitialState:m}}())!==void 0&&(ehe.exports=the);class hvt extends tI{constructor(t){var s,n,o,a,l;if(super(),this._rctx=t,!t.gl)return;if(t.type===vt.WEBGL1)return void(this._result=!(!((s=t.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=t.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!(((o=t.capabilities.textureFloat)==null?void 0:o.textureFloat)&&((a=t.capabilities.colorBufferFloat)==null?void 0:a.textureFloat)&&((l=t.capabilities.colorBufferFloat)==null?void 0:l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=t.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(t){const r=this._rctx,i=new Li(r,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},{target:bt.TEXTURE_2D,wrapMode:Rt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:$t.FLOAT,internalFormat:St.RGBA32F,samplingMode:rt.NEAREST,width:1,height:1}),s=wr.createVertex(r,$r.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new rd(r,new Map([["a_pos",0]]),{geometry:[new Vo("a_pos",2,at.UNSIGNED_SHORT,0,4)]},{geometry:s});r.useProgram(t);const o=r.getBoundFramebufferObject(),{x:a,y:l,width:c,height:h}=r.getViewport();r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.bindVAO(n),r.drawArrays(It.TRIANGLE_STRIP,0,4);const p=Vt({blending:fTe});r.setPipelineState(p),r.drawArrays(It.TRIANGLE_STRIP,0,4),jq.init(r);const f=r.gl.getError();return r.setViewport(a,l,c,h),r.bindFramebuffer(o),n.dispose(!1),s.dispose(),i.dispose(),f!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}}class dvt extends tI{constructor(t){super(),this._rctx=t;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=t.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(t){const r=this._rctx,i=new Li(r,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},{target:bt.TEXTURE_2D,wrapMode:Rt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,width:1,height:1}),s=new Uint8Array(4),n=wr.createVertex(r,$r.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new rd(r,new Map([["a_position",0]]),{geometry:[new Vo("a_position",2,at.SHORT,0,4)]},{geometry:n});r.useProgram(t);const a=new lt(r,{target:bt.TEXTURE_2D,wrapMode:Rt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));t.setUniform1i("u_texture",0),r.bindTexture(a,0);const l=r.getBoundFramebufferObject();r.bindFramebuffer(i),r.useProgram(t);const{x:c,y:h,width:p,height:f}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(It.TRIANGLE_STRIP,0,4),r.setViewport(c,h,p,f),i.readPixels(0,0,1,1,ze.RGBA,$t.UNSIGNED_BYTE,s),o.dispose(!1),n.dispose(),i.dispose();const m=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return m&&ee.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),r.bindFramebuffer(l),m}}new Vo("a_pos",2,at.BYTE,0,2);new Vo("a_pos",2,at.BYTE,0,4),new Vo("a_tex",2,at.BYTE,2,4);const pvt={geometry:[new Vo("a_pos",2,at.UNSIGNED_SHORT,0,4)]};class fvt extends tI{constructor(t){super(),this._rctx=t,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=t.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(t){const r=this._rctx;if(!r.gl)return t.dispose(),!0;const i=new Li(r,{colorTarget:ps.TEXTURE,depthStencilTarget:Ir.NONE},{target:bt.TEXTURE_2D,wrapMode:Rt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,samplingMode:rt.NEAREST,width:1,height:1}),s=wr.createVertex(r,$r.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new rd(r,new Map([["a_pos",0]]),pvt,{geometry:s}),o=new lt(r,{dataType:$t.UNSIGNED_BYTE,pixelFormat:ze.RGBA,preMultiplyAlpha:!1,wrapMode:Rt.CLAMP_TO_EDGE,samplingMode:rt.LINEAR},this._image);r.useProgram(t),r.bindTexture(o,0),t.setUniform1i("u_texture",0);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=r.getViewport();r.bindFramebuffer(i),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(Vi.COLOR_BUFFER_BIT),r.bindVAO(n),r.drawArrays(It.TRIANGLE_STRIP,0,4);const f=new Uint8Array(4);return i.readPixels(0,0,1,1,ze.RGBA,$t.UNSIGNED_BYTE,f),n.dispose(!1),s.dispose(),i.dispose(),o.dispose(),r.setViewport(l,c,h,p),r.bindFramebuffer(a),f[0]!==255}}class mvt{constructor(t){this.rctx=t,this.floatBufferBlend=new hvt(t),this.svgPremultipliesAlpha=new fvt(t),this.doublePrecisionRequiresObfuscation=new cvt(t),this.ignoresSamplerPrecision=new dvt(t),this.drawArraysRequiresIndicesTypeReset=new lvt(t)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}}function gvt(e,t){if(t.disjointTimerQuery)return null;if(Vm(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const r=e.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function yvt(e){if(Vm(e))return e;const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function _vt(e,t){if(t.compressedTextureETC)return null;const r=e.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function vvt(e,t){if(t.compressedTextureS3TC)return null;const r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function bvt(e,t){if(Vm(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function wvt(e,t){if(t.textureFilterAnisotropic)return null;const r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function xvt(e,t){if(Vm(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const r=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function Tvt(e,t){if(Vm(e)){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function KA(e,t,r,i,s){if(i&&Vm(e))return!0;if(t[r])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function Svt(e,t){if(!Vm(e)||t.textureNorm16)return null;const r=e.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function Evt(e,t){const r=t.loseContext&&e.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function Cvt(e,t){if(Vm(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const r=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}class Avt{constructor(t,r){this._gl=t,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=gvt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=yvt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=Cvt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=_vt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=vvt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=wvt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=R_t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=xvt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=Tvt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=bvt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=KA(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=KA(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=KA(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=KA(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=Evt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=Svt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=KA(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}let Rvt=class{constructor(e,t){this.gl=e,this.instanceCounter=new L_t,this.programCache=new avt(this),this._state=new Bue,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=Vm(e)?vt.WEBGL2:vt.WEBGL1,this._loadExtensions(),this.configure(t)}get gl2(){return this.type===vt.WEBGL1?null:this.gl}configure(e){this._capabilities=new Avt(this.gl,e),this._parameters=this._loadParameters(e);const t=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Bue,this._state.viewport={x:t[0],y:t[1],width:t[2],height:t[3]},this._stateTracker=new Zqe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const i=r.color;this.setBlendColor(i.r,i.g,i.b,i.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const i=r.function;this.setStencilFunction(i.func,i.ref,i.mask);const s=r.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),tt(this._driverTest),this._driverTest=new mvt(this)}dispose(){tt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Ot.ARRAY_BUFFER),this.unbindBuffer(Ot.ELEMENT_ARRAY_BUFFER),this.type===vt.WEBGL2&&(this.unbindBuffer(Ot.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Ot.PIXEL_PACK_BUFFER),this.unbindBuffer(Ot.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Ot.COPY_READ_BUFFER),this.unbindBuffer(Ot.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,gu()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,t){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;t>=0&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,t,r,i){e===this._state.blendColor.r&&t===this._state.blendColor.g&&r===this._state.blendColor.b&&i===this._state.blendColor.a||(this.gl.blendColor(e,t,r,i),this._state.blendColor.r=e,this._state.blendColor.g=t,this._state.blendColor.b=r,this._state.blendColor.a=i,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._state.blendFunction.srcRGB&&t===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,t),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,r,i){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===t&&this._state.blendFunction.dstAlpha===i||(this.gl.blendFuncSeparate(e,t,r,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,r,i){this._state.colorMask.r===e&&this._state.colorMask.g===t&&this._state.colorMask.b===r&&this._state.colorMask.a===i||(this.gl.colorMask(e,t,r,i),this._state.colorMask.r=e,this._state.colorMask.g=t,this._state.colorMask.b=r,this._state.colorMask.a=i,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,r,i){this._state.clearColor.r===e&&this._state.clearColor.g===t&&this._state.clearColor.b===r&&this._state.clearColor.a===i||(this.gl.clearColor(e,t,r,i),this._state.clearColor.r=e,this._state.clearColor.g=t,this._state.clearColor.b=r,this._state.clearColor.a=i)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===t||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,t,r,i){this._state.scissorRect.x===e&&this._state.scissorRect.y===t&&this._state.scissorRect.width===r&&this._state.scissorRect.height===i||(this.gl.scissor(e,t,r,i),this._state.scissorRect.x=e,this._state.scissorRect.y=t,this._state.scissorRect.width=r,this._state.scissorRect.height=i)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===t||(this.gl.depthRange(e,t),this._state.depthRange.zNear=e,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,t,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===t&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._state.stencilFunction.face=gp.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,r,i){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFuncSeparate(e,t,r,i),this._state.stencilFunction.face=e,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,r){this._state.stencilOperation.face===gp.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===t&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._state.stencilOperation.face=gp.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,r,i){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOpSeparate(e,t,r,i),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const r=this._state.activeTexture;return e>=0&&(t||e!==this._state.activeTexture)&&(this.gl.activeTexture(y9+e),this._state.activeTexture=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(e&Vi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Vi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Vi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,r){if(gu()&&(this._numOfDrawCalls++,this._numOfTriangles+=rhe(e,r)),this.gl.drawArrays(e,t,r),gu()){const i=Nse(this);i&&console.error("drawArrays:",i)}}drawElements(e,t,r,i){var s;if(gu()&&(this._numOfDrawCalls++,this._numOfTriangles+=rhe(e,t)),this.gl.drawElements(e,t,r,i),gu()){const n=Nse(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},h={mode:e,count:t,type:r,offset:i},p=(s=ho(a,y=>y.size))!=null?s:0,f=i+t,m=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${n}${m}`,{args:h,vao:c})}}}logInfo(){gu()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){gu()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,t,r,i){r=Math.max(Math.round(r),1),i=Math.max(Math.round(i),1);const s=this._state.viewport;s.x===e&&s.y===t&&s.width===r&&s.height===i||(s.x=e,s.y=t,s.width=r,s.height=i,this.gl.viewport(e,t,r,i))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var t,r;this._state.program!==e&&((t=this._state.program)==null||t.stop(),this._state.program=e,this.gl.useProgram((r=e==null?void 0:e.glName)!=null?r:null))}bindTexture(e,t,r=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const i=this._state.textureUnitMap[t];return E(e)||e.glName==null?(v(i)&&(this.setActiveTexture(t,r),this.gl.bindTexture(i.descriptor.target,null)),this._state.textureUnitMap[t]=null,i):r||i!==e?(this.setActiveTexture(t,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[t]=e,i):(e.isDirty&&(this.setActiveTexture(t,r),e.applyChanges()),i)}unbindTexture(e){if(!E(e))for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===e&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(e,t=!1){if(t||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(E(e))return this.gl.bindFramebuffer(io.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(io.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,t,r=!1){const i=t===io.READ_FRAMEBUFFER,s=i?this._state.readFramebuffer:this._state.drawFramebuffer;(r||s!==e)&&(E(e)?this.gl.bindFramebuffer(t,null):e.initializeAndBind(t),i?this._state.readFramebuffer=Pt(e,null):this._state.drawFramebuffer=Pt(e,null))}blitFramebuffer(e,t,r=0,i=0,s=e.width,n=e.height,o=0,a=0,l=t.width,c=t.height,h=Vi.COLOR_BUFFER_BIT,p=rt.NEAREST){this.bindFramebufferSeparate(e,io.READ_FRAMEBUFFER),this.bindFramebufferSeparate(t,io.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,i,s,n,o,a,l,c,h,p)}bindBuffer(e,t){if(e)switch(t!=null||(t=e.bufferType),t){case Ot.ARRAY_BUFFER:this._state.vertexBuffer=sc(this.gl,e,t,this._state.vertexBuffer);break;case Ot.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=sc(this.gl,e,t,this._state.indexBuffer);break;case Ot.UNIFORM_BUFFER:this._state.uniformBuffer=sc(this.gl,e,t,this._state.uniformBuffer);break;case Ot.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=sc(this.gl,e,t,this._state.pixelPackBuffer);break;case Ot.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=sc(this.gl,e,t,this._state.pixelUnpackBuffer);break;case Ot.COPY_READ_BUFFER:this._state.copyReadBuffer=sc(this.gl,e,t,this._state.copyReadBuffer);break;case Ot.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=sc(this.gl,e,t,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,t){if(t>=this.parameters.maxUniformBufferBindings||t<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let i=r[t];return E(i)&&(i={buffer:null,offset:0,size:0},r[t]=i),i}bindBufferBase(e,t,r){const i=this._getBufferBinding(e,t);E(i)||i.buffer===r&&i.offset===0&&i.size===0||(this.gl.bindBufferBase(e,t,r?r.glName:null),i.buffer=r,i.offset=0,i.size=0)}bindBufferRange(e,t,r,i,s){const n=this._getBufferBinding(e,t);if(!E(n)&&!(n.buffer===r&&n.offset===i&&n.size===s)){if(i%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,t,r.glName,i,s),n.buffer=r,n.offset=i,n.size=s}}bindUBO(e,t,r,i){E(t)?this.bindBufferBase(Ot.UNIFORM_BUFFER,e,null):(gu()&&(i!=null?i:t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),r!==void 0&&i!==void 0?this.bindBufferRange(Ot.UNIFORM_BUFFER,e,t.buffer,r,i):this.bindBufferBase(Ot.UNIFORM_BUFFER,e,t.buffer))}unbindUBO(e){for(let t=0,r=this._state.uniformBufferBindingPoints.length;t<r;t++){const i=this._state.uniformBufferBindingPoints[t];v(i)&&i.buffer===e.buffer&&this.bindBufferBase(Ot.UNIFORM_BUFFER,t,null)}}unbindBuffer(e){switch(e){case Ot.ARRAY_BUFFER:this._state.vertexBuffer=sc(this.gl,null,e,this._state.vertexBuffer);break;case Ot.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=sc(this.gl,null,e,this._state.indexBuffer);break;case Ot.UNIFORM_BUFFER:this._state.uniformBuffer=sc(this.gl,null,e,this._state.uniformBuffer);break;case Ot.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=sc(this.gl,null,e,this._state.pixelPackBuffer);break;case Ot.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=sc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Ot.COPY_READ_BUFFER:this._state.copyReadBuffer=sc(this.gl,null,e,this._state.copyReadBuffer);break;case Ot.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=sc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){E(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=10){const t=this.gl,r=t.fenceSync(TH.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let i;this.instanceCounter.increment(Gn.Sync,r),t.flush();do await Ew(e),i=t.clientWaitSync(r,0,0);while(i===d4.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Gn.Sync,r),t.deleteSync(r),i===d4.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=io.FRAMEBUFFER){return e===io.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Ot.ARRAY_BUFFER),this.unbindBuffer(Ot.ELEMENT_ARRAY_BUFFER),this.type===vt.WEBGL2&&(this.unbindBuffer(Ot.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Ot.PIXEL_PACK_BUFFER),this.unbindBuffer(Ot.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Ot.COPY_READ_BUFFER),this.unbindBuffer(Ot.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Ee.ONE,Ee.ZERO),this.setBlendEquation(Em.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(gp.BACK),this.setFrontFace(NE.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Ni.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Ni.ALWAYS,0,0),this.setStencilOp(ks.KEEP,ks.KEEP,ks.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,n,o,a,l,c;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:t,gl2:r}=this;for(let h=0;h<this.parameters.maxVertexAttributes;h++)t.disableVertexAttribArray(h);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(Ot.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(Ot.ELEMENT_ARRAY_BUFFER,null),v(r)){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(Ot.UNIFORM_BUFFER,null);for(let h=0;h<this._parameters.maxUniformBufferBindings;h++){const p=this._state.uniformBufferBindingPoints[h];if(v(p)){const{buffer:f,offset:m,size:y}=p;f!==null?m===0&&y===0?r.bindBufferBase(Ot.UNIFORM_BUFFER,h,f.glName):r.bindBufferRange(Ot.UNIFORM_BUFFER,h,f.glName,m,y):r.bindBufferBase(Ot.UNIFORM_BUFFER,h,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(Ot.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(Ot.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(Ot.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(Ot.COPY_WRITE_BUFFER,null),r.bindFramebuffer(io.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(io.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(pu.COLOR_ATTACHMENT0)),r.bindFramebuffer(io.DRAW_FRAMEBUFFER,(n=(s=this._state.drawFramebuffer)==null?void 0:s.glName)!=null?n:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(io.FRAMEBUFFER,(a=(o=this._state.drawFramebuffer)==null?void 0:o.glName)!=null?a:null);if(e&&this._state.vertexArrayObject){const h=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(h)}t.useProgram((c=(l=this._state.program)==null?void 0:l.glName)!=null?c:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let h=0;h<this.parameters.maxTextureImageUnits;h++){t.activeTexture(y9+h),t.bindTexture(bt.TEXTURE_2D,null),t.bindTexture(bt.TEXTURE_CUBE_MAP,null),this.type===vt.WEBGL2&&(t.bindTexture(bt.TEXTURE_3D,null),t.bindTexture(bt.TEXTURE_2D_ARRAY,null));const p=this._state.textureUnitMap[h];v(p)&&t.bindTexture(p.descriptor.target,p.glName)}t.activeTexture(y9+this._state.activeTexture);const i=this._state.viewport;t.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.type===vt.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){var o;const t=this.capabilities.textureFilterAnisotropic,r=(o=e.maxAnisotropy)!=null?o:1/0,i=this.type===vt.WEBGL2,s=this.gl,n={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:t?Math.min(this.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:i?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:i?s.getParameter(s.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:i?s.getParameter(s.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:i?s.getParameter(s.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:i?s.getParameter(s.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:i?s.getParameter(s.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:i?s.getParameter(s.MAX_SAMPLES):1};return lt.TEXTURE_UNIT_FOR_UPDATES=n.maxTextureImageUnits-1,n}};function sc(e,t,r,i){return t?i!==t&&e.bindBuffer(r,t.glName):e.bindBuffer(r,null),t}function rhe(e,t){switch(e){case It.POINTS:return 2*t;case It.TRIANGLES:return t/3;case It.TRIANGLE_STRIP:case It.TRIANGLE_FAN:return t-2;default:return 0}}class Ovt extends Rvt{constructor(t,r,i){super(t,r),this.newCache=i,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(t,r,i,s){return this.useProgram(t.program),t.bindPipelineState(this,i==null?void 0:i.slot,!!s),t.program.bindPass(r,i),t.program}get test(){return this.programCache.test}}let I2=class extends Te{constructor(e,t,r){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Vs,this._frameTask=e.view.resourceController.scheduler.registerTask(gt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Fs.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return E(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(ZP,new wQ)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),Pt(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const r=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)}),e&&this.events.emit("changed",Ds.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(E(t))return mt(t!==void 0),null;const r=t.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),i=new Mvt(e,()=>{this._frameTask.schedule(()=>{i.isUnreferenced&&t.unload()})});return this._textures.set(e,i),i.ref(),v(t.glTexture)?(this._updateGLTexture(i,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i):(this._loadingCount++,i.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,i.loadingPromise=null,this._updateGLTexture(i,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i),o=a=>(this._loadingCount--,i.loadingPromise=null,sn(a)||ee.getLogger(this.declaredClass).error(a),null);return Hu(s)?s.then(n,o):n(s)}),i.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",Ds.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],I2.prototype,"_loadingCount",void 0),u([d()],I2.prototype,"_frameTask",void 0),u([d()],I2.prototype,"updating",null),I2=u([P("esri.views.3d.webgl-engine.lib.TextureRepository")],I2);class Mvt{constructor(t,r){this.id=t,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(ee.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}let S3=class extends Te{constructor(){super(...arguments),this._passParameters=new Pvt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=tt(this._passParameters.waveNormal),this._passParameters.wavePertubation=tt(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return sy.LOADING;if(v(this._passParameters.waveNormal)&&v(this._passParameters.wavePertubation))return sy.LOADED;const t={target:bt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:$t.UNSIGNED_BYTE,wrapMode:Rt.REPEAT,samplingMode:rt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,Ty(Kr("esri/images/materials/water/normals.jpg")).then(r=>this._passParameters.waveNormal=new lt(e,{...t,width:r.width,height:r.height},r)).catch(r=>ee.getLogger(this.declaredClass).error("Failed to load water material normal texture.",r)).finally(()=>--this._loading),++this._loading,Ty(Kr("esri/images/materials/water/perturbation.jpg")).then(r=>this._passParameters.wavePertubation=new lt(e,{...t,width:r.width,height:r.height},r)).catch(r=>ee.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",r)).finally(()=>--this._loading),sy.LOADING}};u([d()],S3.prototype,"_loading",void 0),u([d({type:Boolean,readOnly:!0})],S3.prototype,"updating",null),S3=u([P("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],S3);class Pvt extends gi{}const ihe=2048,Ivt=1.5,$vt=8;function Lvt(e,t){const{format:r,quality:i,rotation:s,disableDecorations:n}=e||{},o=rK(e,t.padding),a=Bvt(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=Vvt(e,a),h=jvt(r),p=Yvt[h];return{format:h,quality:ye(i!=null?i:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function Dvt(e,t){const r=Lvt(e,t),i=r.area,s=r.width/i.width,n=rK(r,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],m=r.ignoreBackground,y=r.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function IB(e,t,r){const{ctx:i,canvas:s}=pCe(e,r),n=i.getImageData(0,0,e.width,e.height),o=Fvt(s,t);return fCe(s),{dataUrl:o,data:n}}function $B(e,t){const{ctx:r,canvas:i}=pCe(e,t),s=r.getImageData(0,0,e.width,e.height);return fCe(i),s}function pCe(e,t){const r=Nvt();t.premultipliedAlpha&&qvt(e),r.width=e.width,r.height=e.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(e,0,0),t.flipY&&Hvt(i),{ctx:i,canvas:r}}function fCe(e){e.width=0,e.height=0}function Nvt(){return E(LB)&&(LB=document.createElement("canvas")),LB}let LB=null;function Fvt(e,t){const r=Wvt[t.format],i=t.quality/100;return e.toDataURL(r,i)}function Uvt(e,t,r,i=0,s=0,n=e.width-i,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,f=n/c,m=o/h,y=Math.ceil(f/2),_=Math.ceil(m/2),b=e.width;for(let x=0;x<h;x++)for(let T=0;T<c;T++){const S=4*(T+(a?h-x-1:x)*c);let C=0,O=0,R=0,$=0,I=0,U=0;const V=(x+.5)*m;for(let G=Math.floor(x*m);G<(x+1)*m;G++){const z=Math.abs(V-(G+.5))/_,Z=(T+.5)*f,Q=z*z;for(let te=Math.floor(T*f);te<(T+1)*f;te++){const q=Math.abs(Z-(te+.5))/y,L=Math.sqrt(Q+q*q);if(L>=1)continue;let N=2*L*L*L-3*L*L+1;const F=4*(i+te+(s+G)*b);U+=N*l[F+3],O+=N,!r&&l[F+3]<255&&(N=N*l[F+3]/255),R+=N*l[F],$+=N*l[F+1],I+=N*l[F+2],C+=N}}p[S]=R/C,p[S+1]=$/C,p[S+2]=I/C,p[S+3]=U/O}return t}function kvt(e,t,r){if(!t)return e;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=e,a=rK(e,r),l=a.left+a.right,c=a.top+a.bottom,h=i-l,p=s-c,f=Math.min($vt,Math.min((ihe-l)/h,(ihe-c)/p));return f<Ivt?e:{...e,framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:s}}}function Vvt(e,t){if(!e)return t;const r=e.width,i=e.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return t;const s=t.width/t.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function Bvt(e,t){const r={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(r.x=Math.floor(e.area.x)),e.area.y!=null&&(r.y=Math.floor(e.area.y));const i=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(r.width=t.width-r.x,r.height=t.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return zvt(Gvt(r,e),t)}function zvt(e,t){const r=Math.floor(Math.max(e.x,0)),i=Math.floor(Math.max(e.y,0)),s={x:r,y:i,width:Math.floor(Math.min(e.width,t.width-r)),height:Math.floor(Math.min(e.height,t.height-i))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function Gvt(e,t){if(!t||t.width==null||t.height==null)return e;const r=t.width/t.height,i=e.width/e.height;if(i===r)return e;if(i<r){const n=Math.floor(e.height*r);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/r);return e.y-=(s-e.height)/2,e.height=s,e}function rK(e,t){return!t||e&&e.ignorePadding?Zvt:t}function jvt(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return Xvt}}function Hvt(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function qvt(e){const t=e.data,r=t.length;for(let i=0;i<r;i+=4){const s=t[i+3];if(s!==255&&s>0){const n=255/s;t[i+0]=t[i+0]*n,t[i+1]=t[i+1]*n,t[i+2]=t[i+2]*n}}}const Wvt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},she=98,Xvt="png",Yvt={png:100,jpg:she,jpeg:she},Zvt={top:0,right:0,bottom:0,left:0};class Jvt{constructor(t,r){this.viewCamera=t,this.frameHasDecorations=r}}class Qvt{constructor(t,r,i,s){this._rctx=t,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(t){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Ds.BACKGROUND);const r=uv();return this._screenshotQueue.push({settings:t,resolver:r}),r.promise}update(t,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio},n=this._renderScreenshot(t,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,r,i){t.width=r.width,t.height=r.height;const s=t.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(t,r),s.restore(),r}_readbackScreenshot(t,r){return t.resample?this._readbackScreenshotResampled({...t,resample:t.resample},r):this._readbackScreenshotImmediate(t,r)}_readbackScreenshotResampled(t,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=FV(i,s,a);this._rctx.gl.readPixels(0,0,i,s,ze.RGBA,at.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...t,region:void 0});const c=FV(n.width,n.height,a);return Uvt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,r){const{framebufferHeight:i,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=FV(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,ze.RGBA,at.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,r,i){let s=null,n=null;const o=t.viewCamera,{framebufferWidth:a,framebufferHeight:l}=r;let c=!1;const h=r.disableDecorations&&t.frameHasDecorations,p=a!==o.fullWidth||l!==o.fullHeight,f=r.ignorePadding&&o.pixelRatio!==r.pixelRatio,m=p||h||f||r.objectAndLayerIdColor;if(r.objectAndLayerIdColor&&(n=new Li(this._rctx,{width:a,height:l,colorTarget:ps.TEXTURE,depthStencilTarget:Ir.DEPTH_STENCIL_RENDER_BUFFER})),m){const x=o.clone();if(r.ignorePadding){const C=yP(x.padding);for(let O=0;O<4;O++)C[O]=Math.round(C[O]/x.pixelRatio*r.pixelRatio);x.padding=C}x.fullWidth=a,x.fullHeight=l,x.pixelRatio=r.pixelRatio;const T=o.fovX-x.fovX,S=o.fovY-x.fovY;T<0&&T<S?x.fovX=o.fovX:S<0&&S<T&&(x.fovY=o.fovY),this._forceCameraHook(x),c=!0,s=new Li(this._rctx,{width:x.fullWidth,height:x.fullHeight,colorTarget:ps.TEXTURE,depthStencilTarget:Ir.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(s,n,x,r.disableDecorations?qw.OFF:qw.ON,i),this._disposeOffscreenBuffers()}const y=()=>{this._rctx.bindFramebuffer(null),tt(s)},_=this._readbackScreenshot(r,y);y();let b=null;if(r.objectAndLayerIdColor){const x=()=>{this._rctx.bindFramebuffer(null),tt(n)};this._rctx.bindFramebuffer(n),b=this._readbackScreenshot(r,x),this._rctx.bindFramebuffer(null),x()}if(m&&!this._rctx.contextAttributes.alpha)for(let x=3;x<_.data.length;x+=4)_.data[x]=255;if(b&&!this._rctx.contextAttributes.alpha)for(let x=3;x<b.data.length;x+=4)b.data[x]=255;return c&&this._forceCameraHook(o),[_,b]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}let Io=class extends Te{constructor(e){super({}),this.events=new Vs,this.waterTextureRepository=new S3,this._magnifierHelper=new P2,this.objectAndLayerIdRenderHelper=de("enable-feature:objectAndLayerId-rendering")?new qyt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),se(()=>{var r;return(r=this.waterTextureRepository)==null?void 0:r.updating},()=>this.requestRender(),kt),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new h2e(this._rctx),this._shaderTechniqueRepository=new n2e({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new I2(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",r=>this.requestRender(r)),this._materialRepository=new o2e(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new Syt(this._rctx,this._shaderTechniqueRepository),this.renderer=new cu(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,r=>this.requestRender(r));const t={renderScene:(r,i,s,n,o)=>this.renderer.render(r,i,{camera:s,contentCamera:s,mode:Sr.IDLE},n,o),requestRenderScene:r=>this.requestRender(r),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(r,i)=>e.options.screenshot.renderOverlay(r,i)};this._screenshotManager=new Qvt(this._rctx,t,r=>this.events.emit("force-camera-for-screenshot",r),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=zi(this._frameTask),this._shaderTechniqueRepository=Ve(this._shaderTechniqueRepository)}get performanceInfo(){const e=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=Ds.UPDATE){this._needsRender=!0,e===Ds.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(t=>t[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,t,r,i,s,n=s){const o=i.constrainWindowSize(t,r,s*i.pixelRatio,n*i.pixelRatio),a=this._ensureDepthBuffer(o);this.renderer.readDepthPixels(i,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=Oyt(4*c,a,i.nearFar);l>h&&h!==i.nearFar[0]&&h!==i.nearFar[1]&&(l=h)}if(v(e)){const c=e.pickDepth(t*i.pixelRatio,r*i.pixelRatio,i);v(c)&&l>c&&c!==i.nearFar[0]&&c!==i.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(E(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}async reloadShaders(){rEe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const t=e.view.state;let r=!1,i=Ds.BACKGROUND,s=!1;const n={preRender:({time:o})=>{r=this.updating,i=this._needsUpdate?Ds.UPDATE:Ds.BACKGROUND,e.commitSyncLayers();const a=o-this._lastAnimationUpdate;if(a>this.renderer.animationTimestep||v(t.forcedAnimationTime)||r||this._needsRender){const l=a/this.renderer.animationTimeDilation,c=new qxe(t.camera,l,t.forcedAnimationTime);this.renderer.updateAnimation(c)&&this.requestRender(Ds.BACKGROUND),this._lastAnimationUpdate=o}},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,t,qw.ON,o),s=!0,a&&this.renderer.hasWaterReflection&&(this.requestRender(Ds.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{const a=new Jvt(t.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(a,o)},finish:()=>{s&&(this.renderer.finish(t.mode===Sr.IDLE?i:Ds.UPDATE),s=!1)}};this._frameTask=rE(n)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},i=Kqe("3d",this._canvas,r);if(E(i)){const n=de("esri-force-webgl");ee.getLogger(this.declaredClass).error(n)}else this._rctx=this._newRenderingContext(i,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&ee.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&de("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},i=(s,n)=>t.view.resourceController.memoryController.newCache(s,n);return new Ovt(e,r,i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return v(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return E(this._componentObjectCollection)&&(this._componentObjectCollection=new fyt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],Io.prototype,"updating",null),u([d({autoDestroy:!0})],Io.prototype,"_rctx",void 0),u([d({autoDestroy:!0})],Io.prototype,"_container",void 0),u([d({autoDestroy:!0})],Io.prototype,"_canvas",void 0),u([d({autoDestroy:!0})],Io.prototype,"_stippleTextureRepository",void 0),u([d({autoDestroy:!0})],Io.prototype,"waterTextureRepository",void 0),u([d({autoDestroy:!0})],Io.prototype,"_magnifierHelper",void 0),u([d({readOnly:!0})],Io.prototype,"objectAndLayerIdRenderHelper",void 0),u([d({autoDestroy:!0})],Io.prototype,"_textureRepository",void 0),u([d({autoDestroy:!0})],Io.prototype,"_compositingHelper",void 0),u([d({autoDestroy:!0,readOnly:!0})],Io.prototype,"renderer",void 0),u([d({autoDestroy:!0})],Io.prototype,"_screenshotManager",void 0),u([d()],Io.prototype,"componentObjectCollection",null),u([d({autoDestroy:!0})],Io.prototype,"_componentObjectCollection",void 0),u([d()],Io.prototype,"_needsUpdate",void 0),u([d()],Io.prototype,"_needsWaterReflectionUpdate",void 0),Io=u([P("esri.views.3d.webgl-engine.parts.RenderView")],Io);let fc=class extends Te{constructor(e){super(e),this._handles=new Jr,this._model=new NN,this._layers=new Jt,this._asyncChangeSet=new oq,this._syncChangeSet=new oq,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Io(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(gt.STAGE,this),this._handles.add(this._frameTask)}destroy(){this._handles.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),j4(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){E(e)||(this.renderView.requestRender(),this._model.remove(e),j4(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){v(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){v(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e,t){E(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(r=>E(r.glTexture)).map(r=>this.schedule(()=>this._model.has(r)?r.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),t)))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const t=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const i=this._layerSyncSet.has(r.id)||r.updatePolicy===nv.SYNC,s=i?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(r.id,s),this._layerSyncSet.delete(r.id),s.empty||(this.renderer.modify(s,i?Ka:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Ka),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==nv.ASYNC||(t.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===nv.SYNC)&&(e.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Ka),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Ka),this.renderView.requestRender())}schedule(e,t){return this._frameTask.schedule(e,t)}reschedule(e,t){return this._frameTask.reschedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Ka))}addRenderPlugin(e,t,r){const i=this.renderer.renderPlugins.add(e,t,r),s=()=>{Hle(t)&&this.view.sceneIntersectionHelper.addIntersectionHandler(t)};if(Hu(i))return i.then(s);s()}removeRenderPlugin(e){Hle(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(r=>r.type===t).length,model:e._model}}};fc.DebugSettings={endFrameContentValidation:!1},u([d({constructOnly:!0})],fc.prototype,"view",void 0),u([d({constructOnly:!0})],fc.prototype,"options",void 0),u([d({readOnly:!0})],fc.prototype,"viewingMode",null),u([d({constructOnly:!0})],fc.prototype,"container",void 0),u([d({constructOnly:!0})],fc.prototype,"_handles",void 0),u([d({readOnly:!0})],fc.prototype,"updating",null),u([d({constructOnly:!0})],fc.prototype,"_model",void 0),u([d({autoDestroy:!0})],fc.prototype,"renderView",void 0),u([d({readOnly:!0})],fc.prototype,"renderer",null),u([d({readOnly:!0})],fc.prototype,"running",null),fc=u([P("esri.views.3d.webgl-engine.Stage")],fc);class VSt extends tU{constructor(t,r,i,s){super(r,i),this.point=t,this.createGraphic=s}}function mCe(e){return zp(e)&&e.intersector===ss.PCL&&!!e.target}class BSt extends bwe{constructor(t,r,i,s,n){super(t),this.layerUid=t,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=s,this.triangleNr=n}}class zSt extends tU{constructor(t,r,i){super(r,null),this.point=t,this.createVoxelGraphic=i}}function C8(e){return zp(e)&&e.intersector===ss.I3S&&!!e.target}function gCe(e){return zp(e)&&e.intersector===ss.VOXEL&&!!e.target}function nhe(e,t){var r,i;return rU(e)||iU(e)?XM((r=e.target)==null?void 0:r.object.metadata,t):ent(e)?(i=t.map)==null?void 0:i.ground:mCe(e)||C8(e)||E2e(e)||gCe(e)?XM(e.target,t):null}function GSt(e,t){const r=Hq(e,t);return v(r)&&r.type==="graphic"?r.graphic:null}function Hq(e,t){var r;if(E(e))return null;if(rU(e)||iU(e))return ohe((r=e.target)==null?void 0:r.object.metadata,t);if(mCe(e)){const i=e.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(gCe(e)){const i=e.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return E2e(e)||AQ(e)?ohe(e.target,t):C8(e)?Kvt(e.target,t):null}function ohe(e,t){if(E(e)||E(e.graphicUid))return null;const r=XM(e,t);if(E(r))return null;if(r===t.graphics)return E(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const i=t.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||E(e.graphicUid)?null:"getHit"in i?i.getHit(e.graphicUid):null}function Kvt(e,t){const r=XM(e,t);if(E(r))return null;const i=t.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?t1t(i.getGraphicFromIntersectorTarget(e)):null}function e1t(e,t){const r=XM(e,t);if(E(r))return null;const i=t.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(e):null}function t1t(e){return v(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function XM(e,t){return!e||E(e.layerUid)?null:v(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function jSt(e,t){if(rU(e)||iU(e))return ty(e.target.object.boundingVolumeWorldSpace.bounds);if(AQ(e)){Nme(YL,e.transformation);const r=Math.max(YL[0],YL[1],YL[2]);return e.target.baseBoundingSphere.radius*r}return C8(e)?ho(e1t(e.target,t),r=>.5*Ofe(r)):null}function HSt(e){return!rU(e)&&!iU(e)&&(AQ(e)?e.target.numLodLevels>1:!!C8(e))}const YL=M();async function r1t(e,t){var o;if(e.type==="2d")return e.hitTest(t);const r=await e.hitTest(t);if(r.results.length===0)return r;const i=r.results[0],s=((o=i.distance)!=null?o:0)*(1+i1t),n=r.results.findIndex(a=>{var l;return((l=a.distance)!=null?l:0)>s});return n!==-1&&(r.results=r.results.slice(0,n)),r}const i1t=.05;let DB,NB;function s1t(e){const t=Sbe(e);for(;t.length>1;){const r=ahe(t.shift());if(r.available)return r}return ahe(t.shift())}function ahe(e){switch(e){case vt.WEBGL1:return n1t();case vt.WEBGL2:return o1t()}}function n1t(){return DB||(DB=c1t()),DB}function o1t(){return NB||(NB=u1t()),NB}class yCe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class a1t extends yCe{constructor(){super(...arguments),this.type=vt.WEBGL1}}class l1t extends yCe{constructor(){super(...arguments),this.type=vt.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function _Ce(e,t){var n;if(e===vt.WEBGL1&&typeof WebGLRenderingContext=="undefined"||e===vt.WEBGL2&&typeof WebGL2RenderingContext=="undefined")return null;const r=document.createElement("canvas");if(!r)return null;let i=p4(r,e,{failIfMajorPerformanceCaveat:!0});if(E(i)&&(i=p4(r,e),v(i)&&(t.majorPerformanceCaveat=!0)),E(i))return i;if(e===vt.WEBGL1){const o=(n=i.getParameter(i.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),i}function c1t(){const e=new a1t,t=_Ce(vt.WEBGL1,e);return E(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function u1t(){const e=new l1t,t=_Ce(vt.WEBGL2,e);return E(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function h1t(e){const t=s1t(e);if(!t.available)return new j("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new j("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new j("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new j("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===vt.WEBGL1){if(!t.supportsElementIndexUint)return new j("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new j("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new j("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function d1t(e){return e&&"nodeType"in e}function p1t(e){return e&&typeof e.render=="function"}const lhe={component:"esri-component"};let Eb=class extends Te{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(lhe.component),t&&t.classList.remove(lhe.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||d1t(e)?(this._set("widget",null),Q5(e)):(p1t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],Eb.prototype,"id",null),u([d()],Eb.prototype,"node",null),u([zt("node")],Eb.prototype,"castNode",null),u([d({readOnly:!0})],Eb.prototype,"widget",void 0),Eb=u([P("esri.views.ui.Component")],Eb);const BN=Eb,f1t={left:0,top:0,bottom:0,right:0},vCe={bottom:30,top:15,right:15,left:15},FB="manual",ug="esri-ui",Tl={ui:ug,corner:`${ug}-corner`,innerContainer:`${ug}-inner-container`,manualContainer:`${ug}-manual-container`,cornerContainer:`${ug}-corner-container`,topLeft:`${ug}-top-left`,topRight:`${ug}-top-right`,bottomLeft:`${ug}-bottom-left`,bottomRight:`${ug}-bottom-right`};function m1t(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function UB(e){const t=e,r=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(r===null||r===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function kB(e,{top:t,bottom:r,left:i,right:s}){e.style.top=t,e.style.bottom=r,e.style.left=i,e.style.right=s}let $f=class extends Vs.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=Gh(),this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&kB(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&kB(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([se(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,kt),se(()=>this.padding,this._applyUIPadding,kt),se(()=>[this.container,this._locale],([e,t])=>{e&&e.setAttribute("lang",t)},kt),rfe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(Tl.ui),q5e(e),this._attachContainers(e)),t&&(t.classList.remove(Tl.ui),kB(t,{top:"",bottom:"",left:"",right:""}),Eme(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.top+t.bottom;return Math.max(e-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...vCe,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.left+t.right;return Math.max(e-r,0)}add(e,t){let r,i;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=UB(e);s&&({index:r,position:t,component:e,key:i}=s),t&&typeof t=="object"&&({index:r,key:i,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,i)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(i=>this.remove(i,t));const r=this._find(e);if(r){const i=this._componentToKey;if(i.has(e)&&i.get(e)!==t)return;const s=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,r)=>t.concat(r)):(e=e||FB)===FB?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(Tl.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let r;const i=UB(e)||UB(t);if(i&&(r=i.index,t=i.position,e=i.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:r})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,r,i){e instanceof BN||(e=new BN({node:e})),this._place({component:e,position:t,index:r}),this._components.push(e),i&&this._componentToKey.set(e,i)}_find(e){return e?e instanceof BN?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||f1t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Tl.innerContainer),e.classList.add(Tl.cornerContainer);const t=document.createElement("div");t.classList.add(Tl.innerContainer),t.classList.add(Tl.manualContainer);const r=document.createElement("div");r.classList.add(Tl.topLeft),r.classList.add(Tl.corner),e.appendChild(r);const i=document.createElement("div");i.classList.add(Tl.topRight),i.classList.add(Tl.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(Tl.bottomLeft),s.classList.add(Tl.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Tl.bottomRight),n.classList.add(Tl.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=em();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":s,"bottom-right":n,"top-leading":o?i:r,"top-trailing":o?r:i,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,r=e.position||FB,i=e.index,s=this._positionNameToContainerLookup[r],n=i!=null&&i>-1;if(m1t(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(i===0)return void(s.firstChild?_ee(t.node,s.firstChild):s.appendChild(t.node));i>=o.length?s.appendChild(t.node):_ee(t.node,o[i])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,r=null;return this._components.some(i=>(t=i===e,t&&(r=i),t)),r}_findById(e){let t,r=null;return this._components.some(i=>(t=i.id===e,t&&(r=i),t)),r}_findByNode(e){let t,r=null;return this._components.some(i=>(t=i.node===e,t&&(r=i),t)),r}};u([d()],$f.prototype,"_locale",void 0),u([d()],$f.prototype,"container",null),u([d()],$f.prototype,"height",null),u([d({value:vCe})],$f.prototype,"padding",null),u([zt("padding")],$f.prototype,"castPadding",null),u([d()],$f.prototype,"view",void 0),u([d()],$f.prototype,"width",null),$f=u([P("esri.views.ui.UI")],$f);const g1t=$f;function che(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function y1t(e,t){return e.length!==t.length||e.some((r,i)=>r.text!==t[i].text)}function ZL(e,t,r){!r||!t||e.find(i=>i.layerView===t&&i.text===r)||e.push({text:r,layerView:t})}function _1t(e){return e.type==="bing-maps"}const M0=[];let $2=class extends VO{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new pt,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>se(()=>{var s;return[i.suspended,(s=i.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([dn(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),oa(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,t=e==null?void 0:e.allLayerViews;M0.length=0,e&&t?(t.forEach(r=>{var n;if(r.suspended||!((n=r.layer)!=null&&n.attributionVisible))return;const i=r.layer;if(che(i,"user"))return void ZL(M0,r,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(r)){const o=this._fetchedAttributionData.get(r);return void(o?ZL(M0,r,this._getDynamicAttribution(o,e,i)):che(i)&&ZL(M0,r,i.copyright))}return void this._fetchAttributionData(r)}const s=i.get("portalItem.accessInformation");ZL(M0,r,s||i.copyright)}),y1t(this.items,M0)&&(this.items.removeAll(),this.items.addMany(M0)),M0.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Vc(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=t.ok?this._createContributionIndex(t.value,_1t(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,t){const r=e.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ye.WGS84},f={extent:ey(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)i[m]=i[m]||[],i[m].push(f)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(e,t,r){var c,h,p;const{extent:i,scale:s}=t;let n=(h=(c=r.tileInfo)==null?void 0:c.scaleToZoom(s))!=null?h:0;if(n=Math.min((p=e.maxKey)!=null?p:0,Math.round(n)),!i||n==null||n<=-1)return"";const o=e[n],a=gx(i.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(f=>{const m=f.id,y=!l[m]&&a&&f.extent&&JW(f.extent,a);return y&&(l[m]=!0),y}).sort((f,m)=>m.score-f.score||f.objectId-m.objectId).map(f=>f.attribution).join(", "):""}};u([d({readOnly:!0,type:pt})],$2.prototype,"items",void 0),u([d({readOnly:!0})],$2.prototype,"state",null),u([d()],$2.prototype,"view",void 0),$2=u([P("esri.widgets.Attribution.AttributionViewModel")],$2);const bCe=$2,VT="esri-attribution",P0={base:`${VT} esri-widget`,poweredBy:`${VT}__powered-by`,sources:`${VT}__sources`,open:`${VT}--open`,sourcesOpen:`${VT}__sources--open`,link:`${VT}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let $l=class extends cl{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:i})=>this._checkSourceTextOverflow(i))),this.iconClass=P0.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new bCe}initialize(){this.addHandles(dn(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[P0.open]:this._isOpen};return ne("div",{bind:this,class:this.classes(P0.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return ne("div",{class:P0.poweredBy},"Powered by"," ",ne("a",{class:P0.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,r=t?"0":"",{attributionText:i}=this,s={[P0.sourcesOpen]:e,[P0.interactive]:t};return ne("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(P0.sources,s),innerHTML:i,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:r,clientWidth:i,scrollWidth:s}=e,n=s>i,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],$l.prototype,"_isOpen",void 0),u([d()],$l.prototype,"_isInteractive",null),u([d()],$l.prototype,"_attributionTextOverflowed",void 0),u([d()],$l.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],$l.prototype,"attributionText",null),u([d()],$l.prototype,"iconClass",void 0),u([d()],$l.prototype,"itemDelimiter",void 0),u([d()],$l.prototype,"label",null),u([d(),il("esri/widgets/Attribution/t9n/Attribution")],$l.prototype,"messages",void 0),u([d()],$l.prototype,"view",null),u([d({type:bCe})],$l.prototype,"viewModel",void 0),u([Sh()],$l.prototype,"_toggleState",null),$l=u([P("esri.widgets.Attribution")],$l);const v1t=$l,b1t="esri.widgets.CompassViewModel";let Cb=class extends I1e(Te){constructor(e){super(e),this._handles=new Jr,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(se(()=>this.view,this._updateRotationWatcher,kt))}destroy(){zi(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var t;if(!this.get("view.ready"))return;const e={};((t=this.view)==null?void 0:t.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?se(()=>e==null?void 0:e.rotation,this._updateForRotation,kt):se(()=>e==null?void 0:e.camera,this._updateForCamera,kt))}};u([d({readOnly:!0})],Cb.prototype,"canShowNorth",null),u([d()],Cb.prototype,"orientation",void 0),u([d({readOnly:!0})],Cb.prototype,"state",null),u([d()],Cb.prototype,"view",void 0),Cb=u([P(b1t)],Cb);const wCe=Cb,I0={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Lf=class extends cl{constructor(e,t){super(e,t),this.iconClass=I0.widgetIcon,this.messages=null,this.viewModel=new wCe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,r=t==="disabled",i=(t==="rotation"?"rotation":"compass")=="compass",s=r?-1:0,n={[I0.disabled]:r,[I0.interactive]:!r},o={[I0.northIcon]:i,[I0.rotationIcon]:!i},{messages:a}=this;return ne("div",{bind:this,class:this.classes(I0.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},ne("span",{"aria-hidden":"true",class:this.classes(I0.icon,o),styles:this._toRotationTransform(e)}),ne("span",{class:I0.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([d()],Lf.prototype,"goToOverride",null),u([d()],Lf.prototype,"iconClass",void 0),u([d()],Lf.prototype,"label",null),u([d(),il("esri/widgets/Compass/t9n/Compass")],Lf.prototype,"messages",void 0),u([d()],Lf.prototype,"view",null),u([d({type:wCe})],Lf.prototype,"viewModel",void 0),u([Sh()],Lf.prototype,"_reset",null),Lf=u([P("esri.widgets.Compass")],Lf);const w1t=Lf,BT="esri-navigation-toggle",ah={base:`${BT} esri-widget`,button:`${BT}__button esri-widget--button`,activeButton:`${BT}__button--active`,panButton:`${BT}__button--pan`,rotateButton:`${BT}__button--rotate`,isLayoutHorizontal:`${BT}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let L2=class extends Te{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(oa(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],L2.prototype,"state",null),u([d()],L2.prototype,"navigationMode",void 0),u([d()],L2.prototype,"view",void 0),L2=u([P("esri.widgets.NavigationToggleViewModel")],L2);const xCe=L2;let Df=class extends cl{constructor(e,t){super(e,t),this.iconClass=ah.widgetIcon,this.messages=null,this.viewModel=new xCe}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",r={[ah.disabled]:e,[ah.isLayoutHorizontal]:this.layout==="horizontal"},i={[ah.activeButton]:t},s={[ah.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return ne("div",{bind:this,class:this.classes(ah.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},ne("div",{class:this.classes(ah.button,ah.panButton,i)},ne("span",{class:ah.panIcon})),ne("div",{class:this.classes(ah.button,ah.rotateButton,s)},ne("span",{class:ah.rotationIcon})))}_toggle(){this.toggle()}};u([d()],Df.prototype,"iconClass",void 0),u([d()],Df.prototype,"label",null),u([d({value:"vertical"})],Df.prototype,"layout",null),u([d(),il("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Df.prototype,"messages",void 0),u([d()],Df.prototype,"view",null),u([d({type:xCe})],Df.prototype,"viewModel",void 0),u([Sh()],Df.prototype,"_toggle",null),Df=u([P("esri.widgets.NavigationToggle")],Df);const x1t=Df,eR={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let l_=class extends cl{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[eR.disabled]:!this.enabled,[eR.interactive]:this.enabled},r={[this.iconClass]:!!this.iconClass};return ne("div",{bind:this,class:this.classes(eR.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},ne("span",{"aria-hidden":"true",role:"presentation",class:this.classes(eR.icon,r)}),ne("span",{class:eR.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],l_.prototype,"action",void 0),u([d()],l_.prototype,"enabled",void 0),u([d()],l_.prototype,"iconClass",void 0),u([d()],l_.prototype,"title",void 0),u([Sh()],l_.prototype,"_triggerAction",null),l_=u([P("esri.widgets.IconButton")],l_);const uhe=l_;let D2=class extends Te{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([d({readOnly:!0})],D2.prototype,"canZoomIn",null),u([d({readOnly:!0})],D2.prototype,"canZoomOut",null),u([d()],D2.prototype,"view",void 0),D2=u([P("esri.widgets.Zoom.ZoomConditions2D")],D2);const T1t=D2;let N2=class extends Te{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([d({readOnly:!0})],N2.prototype,"canZoomIn",null),u([d({readOnly:!0})],N2.prototype,"canZoomOut",null),u([d()],N2.prototype,"view",void 0),N2=u([P("esri.widgets.Zoom.ZoomConditions3D")],N2);const S1t=N2;let c_=class extends Te{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return v(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return v(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new T1t({view:e}):e.type==="3d"&&(this._zoomConditions=new S1t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():_S(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():_S(e.goTo({zoomFactor:.5}))}};u([d()],c_.prototype,"_zoomConditions",void 0),u([d()],c_.prototype,"canZoomIn",null),u([d()],c_.prototype,"canZoomOut",null),u([d({readOnly:!0})],c_.prototype,"state",null),u([d()],c_.prototype,"view",null),c_=u([P("esri.widgets.Zoom.ZoomViewModel")],c_);const TCe=c_,tR={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let Lg=class extends cl{constructor(e,t){super(e,t),this.iconClass=tR.widgetIcon,this.messages=null,this.viewModel=new TCe}initialize(){this._zoomInButton=new uhe({action:this.zoomIn.bind(this),iconClass:tR.zoomInIcon}),this._zoomOutButton=new uhe({action:this.zoomOut.bind(this),iconClass:tR.zoomOutIcon})}destroy(){this._zoomInButton=Ve(this._zoomInButton),this._zoomOutButton=Ve(this._zoomOutButton)}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,t={[tR.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:i}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=i;const{zoomIn:s,zoomOut:n}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=n,ne("div",{class:this.classes(tR.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],Lg.prototype,"iconClass",void 0),u([d()],Lg.prototype,"label",null),u([d({value:"vertical"})],Lg.prototype,"layout",null),u([d(),il("esri/widgets/Zoom/t9n/Zoom")],Lg.prototype,"messages",void 0),u([d()],Lg.prototype,"view",null),u([d({type:TCe})],Lg.prototype,"viewModel",void 0),Lg=u([P("esri.widgets.Zoom")],Lg);const E1t=Lg;function C1t(e){return e&&e.view!==void 0}let zN=class extends g1t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this.addHandles([se(()=>this.components,this._componentsWatcher.bind(this),kt),se(()=>this.view,this._updateViewAwareWidgets.bind(this),kt)])}_add(e,t,r,i){let s=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;s=this._createComponent(e)}super._add(s,t,r,i)}_removeComponents(e){e.forEach(t=>{const r=this._find(t);r&&(this.remove(r),r.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const r=this._find(t),i=r&&r.widget;C1t(i)&&(i.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.constructed&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new BN({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new v1t({view:this.view})}_createCompass(){return new w1t({view:this.view})}_createNavigationToggle(){return new x1t({view:this.view})}_createZoom(){return new E1t({view:this.view})}};u([d()],zN.prototype,"components",void 0),zN=u([P("esri.views.ui.DefaultUI")],zN);const A1t=zN;let GN=class extends A1t{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],GN.prototype,"components",void 0),GN=u([P("esri.views.ui.3d.DefaultUI3D")],GN);const SCe=GN;let ot=class extends sNe(Tje(kje(LHe))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._lostWebGLContextHandle=null,this._resolveWhenReady=[],this._propertiesPool=new vy({slicePlane:Xge},this),this._resourceController=ddt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new eq({view:this}),this.labeler=new vb({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new TE,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Vb,this.environmentManager=new Vd,this.floors=new pt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new NHe({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new $ht,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new SCe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new _q,this.voxelWasm=null,this.voxelWasmPromise=null,V$e(),e&&e.environment||(this._defaults.environment=new x2,this.environment=this._defaults.environment);const t=(r=null)=>{v(r)&&r.type===vi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.handles.add([dn(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>t(r),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),se(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new zet({view:this}),this.stateManager=new gn({view:this})}initialize(){this.groundView=new Uje({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(dn(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},kt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},kt),this.updatingHandles.add(()=>{var t;return(t=this.qualitySettings.frameRate)!=null?t:0},t=>RRe(t>0?1e3/Math.ceil(t):0),kt),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,Ys),this.updatingHandles.add(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Ys),this.handles.add(se(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),ri))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Ve(this.sharedSymbolResources),this._set("labeler",Ve(this.labeler)),this._set("deconflictor",Ve(this.deconflictor)),this._resourceController=Ve(this._resourceController),this._set("stateManager",Ve(this.stateManager)),this._set("inputManager",Ve(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",Ve(this.environmentManager)),this.groundView=Ve(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}get animation(){var e;return(e=this.state)==null?void 0:e.animation}get camera(){var e;return(e=this.stateManager)==null?void 0:e.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){var e;return(e=this.stateManager)==null?void 0:e.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get center(){var e;return(e=this.stateManager)==null?void 0:e.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){var t;if(this.viewingMode==="global")return null;let e=this._userClippingArea||("clippingArea"in this.map?(t=this.map)==null?void 0:t.clippingArea:void 0);return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||E(e)?(this._clippingArea=null,null):e instanceof qr?this.spatialReference&&(e=JL(e,this.spatialReference),E(e))?(ee.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),E(e.intersection(this._groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(ee.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&v(e)?ee.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Ge.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return E(t)||E(e)||t.spatialReference.equals(e)?t:JL(t,e)}get dataExtent(){let e=this._groundAndLayersExtent;const t=this.spatialReference||Ye.WGS84,r=JL(this.clippingArea,t);v(r)&&(e=v(e)?e.intersection(r):r);const i=this._get("dataExtent");return v(e)&&e.equals(i)?i:e}get _groundAndLayersExtent(){var n,o;const e=this.spatialReference||Ye.WGS84;let t;const r=a=>{const l=JL(a,e);E(l)||(v(t)?t.union(l):t=l.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const a=i.groundExtent;r(new qr({xmin:a[0],ymin:a[1],zmin:0,xmax:a[2],ymax:a[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const a=l=>{!v(l.fullExtent)||l.type==="graphics"&&l.internal||r(l.fullExtent)};this.map.allLayers.forEach(l=>a(l))}if(E(t))return null;t.hasZ?(t.zmin=Math.min(0,(n=t.zmin)!=null?n:0),t.zmax=Math.max(0,(o=t.zmax)!=null?o:0)):(t.zmin=0,t.zmax=0);const s=this._get("_groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof x2?e:e instanceof LE?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):x2.fromWebsceneEnvironment(e):Us(x2,e):new x2}get extent(){var e;return(e=this.stateManager)==null?void 0:e.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){var e;return(e=this.stateManager)==null?void 0:e.screenCenter}get frustum(){var e;return(e=this.stateManager)==null?void 0:e.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||v(this.activeTool)&&this.activeTool.visible}get stationary(){return!this.animation&&!this.resizing&&(E(this.state)||this.state.stationary)}get navigating(){var e,t;return(t=(e=this.state)==null?void 0:e.navigating)!=null?t:!1}get padding(){var e;return(e=this.stateManager)==null?void 0:e.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){RN.isValidProfile(e)&&(RN.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||RN.getDefaultProfile()}set slicePlane(e){if(v(this._stage)&&this._stage.renderer.setParameters({slicePlane:e}),E(e))return void this._set("slicePlane",null);const t=this._propertiesPool.get("slicePlane");Sx(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?JDe(this.scale,this.spatialReference):0}get scale(){var e;return(e=this.stateManager)==null?void 0:e.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?Fv.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var s,n,o;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,r=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(t=!0,a.suspended||BM(a))return;++r,e+=a.updatingProgress}}else++r});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])v(a)&&a.updating&&(r+=.1,e+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])v(a)&&a.updating&&(++r,e+=a.updatingProgress);const i=this.stateManager.test.updatingIgnoreRenderState?Sr.IDLE:this.state.mode;if(t=!!(t||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i!==Sr.IDLE||this._createGraphicsViewController||((s=this.inputManager)==null?void 0:s.hasPendingInputs)||((o=(n=this.map)==null?void 0:n.allLayers)==null?void 0:o.some(a=>!a.isFulfilled()))),t?(this._numUpdating=Math.max(r,this._numUpdating),e+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const a=performance.now();if(e<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-l)+e*l}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?a:0}return t}get viewingMode(){var r;const e=this._predeterminedViewingMode;if(v(e))return h9(e);const t=this.spatialReference;return t?v((r=this.defaultsFromMap)==null?void 0:r.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?h9(this.defaultsFromMap.viewingMode):JE(t,Ge.Global)?"global":"local":"global"}set viewingMode(e){this.ready?ee.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){var e;return(e=this.stateManager)==null?void 0:e.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get zoom(){return this.stateManager.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get resourceController(){return this._resourceController}get performanceInfo(){return new Udt(this)}on(e,t,r,i){return this.viewEvents.on(e,t,r,i)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return ee.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,i=v(r.graphics)&&(v(r.graphics.include)||v(r.graphics.exclude)),s=gse(e)?mse(this,e):e,n=qf(s);r.enableDraped=r.include&&!r.include.has(E_)||r.exclude&&r.exclude.has(E_);const o=this.sceneIntersectionHelper,a=od(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?Bo.ALL:Bo.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=Hq(l,this);if(E(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return ee.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=Pt(e.z==null?tm(this.elevationProvider,e):null,0);return aa(e,zT,this.renderSpatialReference,t),this.state.camera.projectToScreen(zT,VB),Kh(VB[0],VB[1])}pixelSizeAt(e){return this.ready?e?(aa(e,zT,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(zT)):0:(ee.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return ee.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=gse(e)?mse(this,e):e,i=ds(r.x,r.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=od(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=Bo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=nhe(a,this),c=v(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:zp(a)?a.distanceInRenderSpace:0,layer:c}};return Xr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:r}=await r1t(this,e);let i=null;return!(t.length===0||Math.abs(Pt(t[0].distance,0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:t,screenPoint:e,mapPoint:i}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(E(e.parent))throw new j("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return IB(r,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return $B(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(t);return[$B(r[0],this._pixelFormat()),$B(r[1],this._pixelFormat())]}_completeSettings(e){const t=Dvt(e,this);return t.pixelRatio/=this.state.pixelRatio,kvt(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e),takeScreenshotWithObjectAndLayerId:e=>this._takeScreenshotWithObjectAndLayerId(e)}}async takeScreenshotWithObjectAndLayerId(e){if(!de("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(t),i=IB(r[0],t,this._pixelFormat()),s=this._completeSettings(e);return s.format="png",[i,IB(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(E(this._stage.renderView.objectAndLayerIdRenderHelper))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return Tse.importLayerView(e)}hasLayerViewModule(e){return Tse.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,r,i;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=h1t(this.type);const t=de("safari");if(t&&t<9&&(e=new j("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:t})),v(e))throw ee.getLogger(this.declaredClass).warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,r;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(r=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?r:null;return v(e)?bse(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const r=this._predeterminedViewingMode;if(v(r))return this._validateSpatialReferenceForViewingMode(e,t,r)?{constraints:this._makeSpatialReferenceConstraints(e,t,r)}:null;const i=this._validateSpatialReferenceForViewingMode(e,t,Ge.Local),s=this._validateSpatialReferenceForViewingMode(e,t,Ge.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:i?{constraints:this._makeSpatialReferenceConstraints(e,t,Ge.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Ge.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,r){return!!JE(e,r)&&(!!E(t)||!!Zee(t)||(!V3(t)||!E(KU(t,e,r)))&&(!Yee(t)||r!==Ge.Global))}_makeSpatialReferenceConstraints(e,t,r){if(E(t))return[{spatialReference:e,viewingMode:r}];const i=e.isWebMercator,s=e.isWGS84;return Zee(t)&&(i||s)?!s||r===Ge.Local||kQ(t.tileInfo,t.fullExtent,e,Ge.Global)===null?[{spatialReference:e,viewingMode:r},{spatialReference:Ye.WebMercator,viewingMode:r}]:[{spatialReference:i?Ye.WGS84:Ye.WebMercator,viewingMode:r}]:V3(t)||Yee(t)||!i&&!s?V3(t)&&i&&r!==Ge.Global?[{spatialReference:e,viewingMode:r},{spatialReference:Ye.WGS84,viewingMode:Ge.Local}]:[{spatialReference:e,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:i?Ye.WGS84:Ye.WebMercator,viewingMode:r}]}_validateSpatialReference(e){const t=v(this.getSpatialReferenceSupport({spatialReference:e})),r=this._predeterminedViewingMode;return t||(v(r)?ee.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${h9(r)} viewing mode.`):e.isGeographic&&ee.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let r=this.spatialReference||Ye.WGS84;return mo(e,this.renderSpatialReference,e,r)||(r=Ye.WGS84,mo(e,this.renderSpatialReference,e,r)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=r):t=new yt(e,r),t}trackGraphicState(e){if(!e.graphic)return ee.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let r=null,i=!1;const s=n=>{var o;!i&&v(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(e))};return v(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,v(r)&&(r.remove(),r=null)}}}highlight(e){if(Array.isArray(e))return eE(e.map(r=>this.highlight(r)));if(pt.isCollection(e))return eE(e.toArray().map(r=>this.highlight(r)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Mp()}maskOccludee(e){if(!e)return ee.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let r=null,i=!1;const s=n=>{!i&&v(n)&&mje(n)&&(r=n.maskOccludee(e))};return v(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,v(r)&&(r.remove(),r=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){v(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await iE(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new j("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(r,i))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,TO.INCLUDE),r=this._externalToInternalRenderItems(e.exclude,TO.EXCLUDE);return{include:t.layerUids,exclude:r.layerUids,graphics:{include:t.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(zT)?(t=this.computeMapPointFromVec3d(zT,t),e.intersector===ss.TERRAIN&&this.basemapTerrain&&(t.z=Pt(tm(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const r=new Array;let i=null;for(let s=0;s<e.length;s++){const n=e[s],o=nhe(n,this);if(v(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=Hq(n,this);if(E(a))continue;if(a.type==="graphic"){if(E(i)&&s!==e.length-1&&(i=new Set),v(i)){const h=this._getGraphicFilterUid(a.graphic);if(i.has(h))continue;i.add(h)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(e){var s,n;const t=e.sourceLayer,r=e.layer,i=t&&"objectIdField"in t?t:r&&"objectIdField"in r?r:t;if(i){const o=(s=i.objectIdField)!=null?s:cye,a=(n=e.attributes)==null?void 0:n[o];if(a)return`o-${i.id}-${a}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const r=this._getGraphicFilterUid(t);return E(e)||(E(e.include)||e.include.has(r))&&(E(e.exclude)||!e.exclude.has(r))}_externalToInternalRenderItems(e,t,r={layerUids:void 0,graphicUids:void 0}){if(!e)return r;if(e instanceof Aa)R1t(r,this._getGraphicFilterUid(e)),t===TO.INCLUDE&&(v(this.graphicsView)&&e.layer===this?rR(r,this.graphicsView.processor.layer.id):e.layer&&rR(r,e.layer.uid));else if(az(e))for(const i of e)i===this.graphics&&v(this.graphicsView)?rR(r,this.graphicsView.processor.layer.id):i===this.map.ground?rR(r,E_):this._externalToInternalRenderItems(i,t,r);else"uid"in e&&rR(r,e.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new Hmt({view:this})),this._set("elevationProvider",new y3({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Ll({view:this})),this._set("featureTiles",new $o({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var r;const t=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const i=v(this.basemapTerrain.extent)&&v(this.basemapTerrain.spatialReference)?bC(V5(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;v(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Xr.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ie(()=>import("./FeatureTileTree3DDebugger.69607674.js"),["assets/FeatureTileTree3DDebugger.69607674.js","assets/TileTreeDebugger.3d51e69f.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&Xr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):t||!this._featureTreeDebugger||Xr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Ys),this.updatingHandles.add(()=>this.clippingArea,e,Ys),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Ys)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Yht(this.map,e));const t=this.state.isGlobal,r=lye(t,e);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",e5.create(this.state.viewingMode,r)),t||this.handles.add(se(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const s=this.renderCoordsHelper.spatialReference;v(i)&&(i[0]!==0||i[1]!==0||i[2]!==0||i[3]!==0)&&s6(i,this.basemapTerrain.spatialReference,hhe,s)&&(this.renderCoordsHelper.extent=hhe)},ri),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(YE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){v(e)&&e.type===vi.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(se(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),ri),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const r=e.getContext("2d");return r.putImageData(t,0,0),this.overlay.renderCanvas(e),r.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},t=new Lht(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",t);const r=Q5(this.surface);this._stage=new fc({view:this,options:e,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=rP(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new j("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),kt),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),kt),se(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,Ys),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()})],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:_q.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(YE/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Ve(this._stage),this._lostWebGLContextHandle=zi(this._lostWebGLContextHandle),this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Bdt({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await ie(()=>import("./GraphicsView3D.b7638d41.js"),["assets/GraphicsView3D.b7638d41.js","assets/GraphicsProcessor.86e650c7.js","assets/Graphics3DObjectStates.e4779363.js","assets/optimizedFeatureQueryEngineAdapter.199b2146.js","assets/centroid.bdcfdd86.js","assets/PooledRBush.438dec3d.js","assets/quickselect.2c5f2780.js"])).default;cr(e),await iE(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),v(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=bse(this.viewingMode);if(e===Ge.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(dn(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(E_);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(E_);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultHitTestOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return E(this.voxelWasm)?(E(this.voxelWasmPromise)&&(this.voxelWasmPromise=ie(()=>import("./VoxelWasmPerSceneView.e3a65c89.js"),[]).then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){v(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function rR(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function R1t(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function JL(e,t){return v(e)&&fv(e.spatialReference,t)?bC(e,t):null}var TO;ot.type="3d",u([d()],ot.prototype,"_userClippingArea",void 0),u([d()],ot.prototype,"_resourceController",void 0),u([d()],ot.prototype,"_stage",void 0),u([d({readOnly:!0})],ot.prototype,"deconflictor",void 0),u([d({readOnly:!0})],ot.prototype,"labeler",void 0),u([d(B7(TE,"analyses"))],ot.prototype,"analyses",void 0),u([d({type:$E,readOnly:!0})],ot.prototype,"animation",null),u([d({readOnly:!0})],ot.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],ot.prototype,"elevationProvider",void 0),u([d()],ot.prototype,"camera",null),u([d({type:Jh})],ot.prototype,"contentCamera",null),u([d({readOnly:!0})],ot.prototype,"canvas",void 0),u([d({type:yt})],ot.prototype,"center",null),u([d({type:qr})],ot.prototype,"clippingArea",null),u([d({type:Vb})],ot.prototype,"constraints",void 0),u([d({type:qr,readOnly:!0})],ot.prototype,"renderDataExtent",null),u([d({type:qr,readOnly:!0})],ot.prototype,"dataExtent",null),u([d({type:qr,readOnly:!0})],ot.prototype,"_groundAndLayersExtent",null),u([d({value:null,type:x2})],ot.prototype,"environment",null),u([zt("environment")],ot.prototype,"castEnvironment",null),u([d({readOnly:!0})],ot.prototype,"environmentManager",void 0),u([d({type:qr})],ot.prototype,"extent",null),u([d()],ot.prototype,"floors",void 0),u([d()],ot.prototype,"screenCenter",null),u([d()],ot.prototype,"frustum",null),u([d({type:Number,readOnly:!0})],ot.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],ot.prototype,"graphicsView",void 0),u([d({readOnly:!0})],ot.prototype,"analysisViewManager",void 0),u([d()],ot.prototype,"groundView",void 0),u([d({type:Boolean})],ot.prototype,"initialExtentRequired",null),u([d()],ot.prototype,"_defaultsFromMapSettings",null),u([d()],ot.prototype,"interacting",null),u([d()],ot.prototype,"stationary",null),u([d()],ot.prototype,"navigating",null),u([d()],ot.prototype,"map",void 0),u([d({readOnly:!0})],ot.prototype,"mapCoordsHelper",void 0),u([d()],ot.prototype,"padding",null),u([d({type:Ll,readOnly:!0})],ot.prototype,"pointsOfInterest",void 0),u([d({type:$o,readOnly:!0})],ot.prototype,"featureTiles",void 0),u([d()],ot.prototype,"_featureTreeDebugger",void 0),u([d({type:Boolean})],ot.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],ot.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],ot.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],ot.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],ot.prototype,"state",void 0),u([d({readOnly:!0})],ot.prototype,"inputManager",void 0),u([d({readOnly:!0})],ot.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],ot.prototype,"qualityProfile",null),u([d({type:Kle,get(){let e=this._get("qualitySettings");return e||(e=new Kle,RN.apply(this.qualityProfile,e)),e}})],ot.prototype,"qualitySettings",void 0),u([d()],ot.prototype,"slicePlane",null),u([d({readOnly:!0})],ot.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],ot.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],ot.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],ot.prototype,"resolution",null),u([d({type:Number})],ot.prototype,"scale",null),u([d()],ot.prototype,"heightModelInfo",null),u([d()],ot.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],ot.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],ot.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],ot.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],ot.prototype,"type",void 0),u([d({type:SCe})],ot.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating","state.mode"]})],ot.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],ot.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],ot.prototype,"viewingMode",null),u([d({type:Uc})],ot.prototype,"viewpoint",null),u([d({type:Number})],ot.prototype,"zoom",null),u([d({type:_q})],ot.prototype,"highlightOptions",void 0),ot=u([P("esri.views.SceneView")],ot),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(TO||(TO={}));const zT=M(),VB=ds(),hhe=ur(),O1t=ot;function M1t(e){return e&&"getAtOrigin"in e&&"originOf"in e}function dhe(e){e&&e.writtenProperties&&e.writtenProperties.forEach(({target:t,propName:r,newOrigin:i})=>{M1t(t)&&i&&t.originOf(r)!==i&&t.updateOrigin(r,i)})}let u_=class extends fe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([d({type:String,json:{write:!0}})],u_.prototype,"facilityIdField",void 0),u([d({type:String,json:{write:!0}})],u_.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],u_.prototype,"nameField",void 0),u([d({type:String,json:{write:!0}})],u_.prototype,"siteIdField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],u_.prototype,"sublayerId",void 0),u_=u([P("esri.layers.support.FacilityLayerInfo")],u_);const P1t=u_;let qd=class extends fe{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};u([d({type:String,json:{write:!0}})],qd.prototype,"facilityIdField",void 0),u([d({type:String,json:{write:!0}})],qd.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],qd.prototype,"levelIdField",void 0),u([d({type:String,json:{write:!0}})],qd.prototype,"levelNumberField",void 0),u([d({type:String,json:{write:!0}})],qd.prototype,"longNameField",void 0),u([d({type:String,json:{write:!0}})],qd.prototype,"shortNameField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],qd.prototype,"sublayerId",void 0),u([d({type:String,json:{write:!0}})],qd.prototype,"verticalOrderField",void 0),qd=u([P("esri.layers.support.LevelLayerInfo")],qd);const I1t=qd;let Ab=class extends fe{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};u([d({type:String,json:{write:!0}})],Ab.prototype,"layerId",void 0),u([d({type:String,json:{write:!0}})],Ab.prototype,"nameField",void 0),u([d({type:String,json:{write:!0}})],Ab.prototype,"siteIdField",void 0),u([d({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Ab.prototype,"sublayerId",void 0),Ab=u([P("esri.layers.support.SiteLayerInfo")],Ab);const $1t=Ab;let F2=class extends fe{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};u([d({type:I1t,json:{write:!0}})],F2.prototype,"levelLayer",void 0),u([d({type:P1t,json:{write:!0}})],F2.prototype,"facilityLayer",void 0),u([d({type:$1t,json:{write:!0}})],F2.prototype,"siteLayer",void 0),F2=u([P("esri.support.MapFloorInfo")],F2);const L1t=F2,D1t="webscene:failed-to-copy-embedded-resources",N1t="webscene:schema-validation";function F1t(){return new j(D1t,"Copying of embedded resources is currently not supported")}function U1t(e){return new j(N1t,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})}async function k1t(e,t={},r){await e.load(r);const i=ku(e.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=t,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:e.apiKey},signal:en(r,"signal")},c=await e.portal.request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:f})=>({created:new Date(h),size:p,resource:e.resourceFromPath(f)}))}}async function V1t(e,t,r,i){if(!e.hasPath())throw new j(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(i);const n=ku(s.userItemUrl,t==="add"?"addResources":"updateResources"),[o,a]=ECe(e.path),l=await CCe(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),v(i)&&i.compress&&c.append("compress","true"),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),v(i)&&i.access&&c.append("access",i.access),await s.portal.request(n,{method:"post",body:c,signal:en(i,"signal")}),e}async function B1t(e,t,r){if(!t.hasPath())throw new j("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const i=ku(e.userItemUrl,"removeResources");await e.portal.request(i,{method:"post",query:{resource:t.path},signal:en(r,"signal")}),t.portalItem=null}async function z1t(e,t){await e.load(t);const r=ku(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:en(t,"signal")})}function ECe(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function iK(e){const[t,r]=G1t(e),[i,s]=ECe(t);return[i,s,r]}function G1t(e){const t=hIe(e);return E(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function CCe(e){return e instanceof Blob?e:(await Di(e.url,{responseType:"blob"})).data}function j1t(e,t){if(!e.hasPath())return null;const[r,,i]=iK(e.path);return e.portalItem.resourceFromPath(ku(r,t+i))}function ACe(e,t){if(!e.hasPath())return null;const[r,,i]=iK(e.path);return e.portalItem.resourceFromPath(ku(r,t+i))}var E3=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",addOrUpdateResource:V1t,contentToBlob:CCe,fetchResources:k1t,getSiblingOfSameType:j1t,getSiblingOfSameTypeI:ACe,removeAllResources:z1t,removeResource:B1t,splitPrefixFileNameAndExtension:iK});async function phe(e,t,r){if(!t||!t.resources)return;const i=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{i.delete(c),e.paths.push(c)});for(const c of t.resources.toUpdate)if(i.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:p,finish:f,error:m}=c,y=ACe(h,kye());e.paths.push(y.path),o.push(fhe({resource:y,content:p,compress:c.compress,finish:f,error:m},r))}else e.paths.push(c.resource.path),o.push(H1t(c,r)),n.add(c.resource.path);for(const c of t.resources.toAdd)o.push(fhe(c,r)),e.paths.push(c.resource.path);if(i.forEach(c=>{if(t.portalItem){const h=t.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}}),o.length===0)return;const a=await fo(o);cr(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new j("save:resources","Failed to save one or more resources",{errors:l})}async function fhe(e,t){var s,n;const r={...v(t)?t:{},compress:e.compress},i=await Vc(e.resource.portalItem.addResource(e.resource,e.content,r));if(i.ok!==!0)throw(s=e.error)==null||s.call(e,i.error),i.error;(n=e.finish)==null||n.call(e,e.resource)}async function H1t(e,t){var i,s;const r=await Vc(e.resource.update(e.content,t));if(r.ok!==!0)throw(i=e.error)==null||i.call(e,r.error),r.error;(s=e.finish)==null||s.call(e,e.resource)}const q1t={width:600,height:400},QL=1.5;function W1t(e,t){t=t||q1t;let{width:r,height:i}=t;const s=r/i;return s<QL?i=r/QL:s>QL&&(r=i*QL),r>e.width&&(i*=e.width/r,r=e.width),i>e.height&&(r*=e.height/i,i=e.height),{width:Math.round(r),height:Math.round(i)}}function mhe(e){return{enabled:!!(e!=null&&e.length)}}var qq;let U2=qq=class extends fe{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new qq({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([d({type:Boolean,json:{write:!0}})],U2.prototype,"exactMatch",void 0),u([d({type:String,json:{write:!0}})],U2.prototype,"name",void 0),u([ft(kY)],U2.prototype,"type",void 0),U2=qq=u([P("esri.webdoc.applicationProperties.SearchLayerField")],U2);const X1t=U2;var Wq;let k2=Wq=class extends fe{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new Wq(re({field:this.field,id:this.id,subLayer:this.subLayer}))}};u([d({type:X1t,json:{write:{isRequired:!0}}})],k2.prototype,"field",void 0),u([d({type:String,json:{write:{isRequired:!0}}})],k2.prototype,"id",void 0),u([d({type:Ri,json:{write:!0}})],k2.prototype,"subLayer",void 0),k2=Wq=u([P("esri.webdoc.applicationProperties.SearchLayer")],k2);const Y1t=k2;var Xq;let V2=Xq=class extends fe{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new Xq({exactMatch:this.exactMatch,type:this.type,name:this.name})}};u([d({type:Boolean,json:{write:!0}})],V2.prototype,"exactMatch",void 0),u([d({type:String,json:{write:!0}})],V2.prototype,"name",void 0),u([ft(kY)],V2.prototype,"type",void 0),V2=Xq=u([P("esri.webdoc.applicationProperties.SearchTableField")],V2);const Z1t=V2;var Yq;let C3=Yq=class extends fe{constructor(e){super(e),this.field=null,this.id=null}clone(){return new Yq(re({field:this.field,id:this.id}))}};u([d({type:Z1t,json:{write:{isRequired:!0}}})],C3.prototype,"field",void 0),u([d({type:String,json:{write:{isRequired:!0}}})],C3.prototype,"id",void 0),C3=Yq=u([P("esri.webdoc.applicationProperties.SearchTable")],C3);const J1t=C3;var Zq;const RCe=pt.ofType(Y1t),OCe=pt.ofType(J1t);let Nf=Zq=class extends fe{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new RCe,this.tables=new OCe}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,r){t[r]=!e}clone(){return new Zq(re({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};u([d({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Nf.prototype,"addressSearchEnabled",void 0),u([De("addressSearchEnabled")],Nf.prototype,"readAddressSearchEnabled",null),u([Be("addressSearchEnabled")],Nf.prototype,"writeAddressSearchEnabled",null),u([d({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Nf.prototype,"enabled",void 0),u([d({type:String,json:{write:!0}})],Nf.prototype,"hintText",void 0),u([d({type:RCe,json:{write:{overridePolicy:mhe},origins:{"web-scene":{write:{isRequired:!0}}}}})],Nf.prototype,"layers",void 0),u([d({type:OCe,json:{read:!0,write:{overridePolicy:mhe}}})],Nf.prototype,"tables",void 0),Nf=Zq=u([P("esri.webdoc.applicationProperties.Search")],Nf);const Q1t=Nf;var Jq;let jN=Jq=class extends fe{constructor(e){super(e),this.search=null}clone(){return new Jq(re({search:this.search}))}};u([d({type:Q1t,json:{write:!0}})],jN.prototype,"search",void 0),jN=Jq=u([P("esri.webdoc.applicationProperties.Viewing")],jN);const K1t=jN;var Qq;let HN=Qq=class extends fe{constructor(e){super(e),this.viewing=null}clone(){return new Qq({viewing:this.viewing?this.viewing.clone():null})}};u([d({type:K1t,json:{write:!0}})],HN.prototype,"viewing",void 0),HN=Qq=u([P("esri.webscene.ApplicationProperties")],HN);const ebt=HN;var Kq;let Rb=Kq=class extends fe{constructor(e){super(e),this.environment=new LE,this.spatialReference=null,this.viewpoint=null}set viewingMode(e){this._set("viewingMode",e)}clone(){return new Kq({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};u([d({type:LE,json:{write:{isRequired:!0}}})],Rb.prototype,"environment",void 0),u([d({type:Ye})],Rb.prototype,"spatialReference",void 0),u([d({type:["local","global"]})],Rb.prototype,"viewingMode",null),u([d({type:Uc,json:{write:{isRequired:!0}}})],Rb.prototype,"viewpoint",void 0),Rb=Kq=u([P("esri.webscene.InitialViewProperties")],Rb);const m5=Rb;var eW;let Qg=eW=class extends fe{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new eW({url:this.url})}};u([d({type:String,json:{write:{isRequired:!0}}})],Qg.prototype,"url",void 0),Qg=eW=u([P("esri.webdoc.support.SlideThumbnail")],Qg);var tW;let qN=tW=class extends fe{constructor(){super(...arguments),this.text=""}clone(){return new tW({text:this.text})}};u([d({type:String,json:{write:!0}})],qN.prototype,"text",void 0),qN=tW=u([P("esri.webscene.support.Description")],qN);const WN=qN;var rW;let dS=rW=class extends fe{constructor(){super(...arguments),this.lighting=new Gw,this.weather=new c4}clone(){return new rW({lighting:re(this.lighting),weather:re(this.weather)})}};u([d({types:ebe,json:{write:!0}})],dS.prototype,"lighting",void 0),u([d({types:$Z,json:{write:!0}})],dS.prototype,"weather",void 0),dS=rW=u([P("esri.webscene.Environment")],dS);var XN;let YN=XN=class extends fe{constructor(){super(...arguments),this.opacity=null}clone(){return new XN({opacity:this.opacity})}cloneAndApplyTo(e){return this.opacity==null||((e=e!=null?e.clone():new KO).opacity=this.opacity),e}static fromGround(e){return new XN({opacity:e.opacity})}};u([d({type:Number,json:{type:Ri,read:{reader:hE,source:"transparency"},write:{writer:(e,t)=>{t.transparency=hP(e)},target:"transparency"}}})],YN.prototype,"opacity",void 0),YN=XN=u([P("esri.webscene.support.SlideGround")],YN);const MCe=YN;var iW;let pS=iW=class extends fe{constructor(e){super(e),this.id="",this.sublayerIds=null}clone(){return new iW({id:this.id,sublayerIds:re(this.sublayerIds)})}};u([d({type:String,json:{write:!0}})],pS.prototype,"id",void 0),u([d({type:[Ri],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],pS.prototype,"sublayerIds",void 0),pS=iW=u([P("esri.webscene.support.SlideVisibleLayer")],pS);var sW;let ZN=sW=class extends fe{constructor(){super(...arguments),this.text=""}clone(){return new sW({text:this.text})}};u([d({type:String,json:{write:{isRequired:!0}}})],ZN.prototype,"text",void 0),ZN=sW=u([P("esri.webscene.support.Title")],ZN);const SO=ZN;let tbt=0;const nW=pt.ofType(pS);let fa=class extends fe{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+tbt++,this.title=new SO,this.description=new WN,this.thumbnail=new Qg,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new dS,this.visibleLayers=new nW}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=Ve(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new SO({text:e}):Us(SO,e)}castDescription(e){return typeof e=="string"?new WN({text:e}):Us(WN,e)}castThumbnail(e){return typeof e=="string"?new Qg({url:e}):Us(Qg,e)}castBasemap(e){return PZ(e)}set visibleLayers(e){this._set("visibleLayers",gy(e,this._get("visibleLayers"),nW))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(t=>{if(typeof t=="string")return{id:t};if(t instanceof ZO){const r=ghe(t);return{id:t.id,sublayerIds:r}}return t.id?{id:t.id,sublayerIds:"sublayerIds"in t?t.sublayerIds:void 0}:(ee.getLogger(this.declaredClass).warn('Invalid visible layer, expected { id }, Layer or "id"'),t)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})}_updateVisibleLayersFrom(e){const t=[];return fo(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(i=>{if(i.visible){const s=ghe(r);t.push(new pS({id:i.layer.id,sublayerIds:s}))}})).toArray()).then(()=>{this.visibleLayers.removeAll(),this.visibleLayers.addMany(t)})}updateFrom(e,t){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...t&&t.screenshot};return e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?$P.prototype.clone.apply(e.environment.lighting):Gw.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?MCe.fromGround(e.map.ground):null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(r)).then(i=>(this.thumbnail=new Qg({url:i.dataUrl}),this))}async applyTo(e,t){v(this._applyToController)&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const i=P5(t,()=>r==null?void 0:r.abort()),s=e.resourceController.scheduler.registerTask(gt.SLIDE);let n=!1;const o={animate:!0,...t,signal:this._applyToController.signal},a=async()=>{await Promise.all([s.schedule(()=>n=this._setViewpointOfInterest(e,o)),s.schedule(()=>this._applyBasemap(e,o),o.signal)]),await Promise.all([s.schedule(()=>this._applyLayerVisibility(e),o.signal),s.schedule(()=>this._applyGround(e),o.signal),s.schedule(()=>this._applyViewpoint(e,o),o.signal)]),await s.schedule(()=>e.environment.weather=this.environment.weather.clone())},l=await Vc(e.addUpdatingPromise(a()));if(n&&(e.contentCamera=null),s.remove(),this._applyToController===r&&(this._applyToController=null),r=null,i==null||i.remove(),l.ok===!1)throw l.error;return this}async _applyBasemap(e,t){if(this.basemap){try{await this.basemap.load(t)}catch(r){if(sn(r))throw r}e.map.basemap=tHe(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const t=new pt;return this._collectLayers(e,t),this._collectLayers(e.ground,t),t}_collectLayers(e,t){e.layers.forEach(r=>{w7e(r)&&(t.add(r),"layers"in r&&this._collectLayers(r,t))})}_applyLayerVisibility(e){!this.visibleLayers||this._getLayers(e.map).forEach(t=>{const r=this.visibleLayers.find(n=>n.id===t.id);t.visible=r!=null;const i=r&&r.sublayerIds,s=PCe(t);i&&s&&s.forEach(n=>n.visible=i.includes(n.id))})}_setViewpointOfInterest(e,t){if(e.state.fixedContentCamera||!this.viewpoint||(t==null?void 0:t.ignoreViewpoint)||!(t!=null&&t.useDestinationCamera))return!1;const r=NJ(e,this.viewpoint);return e.contentCamera=r,v(r)}async _applyViewpoint(e,t){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!t.ignoreViewpoint){if(v(this.viewpoint.camera)&&(this.viewpoint.camera.fov=e.camera.fov),t.animate&&this.get("environment.lighting.date"))return this._animateToLighting(e,t);t.animate&&(e.environment.applyLighting(this.environment.lighting.clone()),await e.goTo(this.viewpoint,t)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,t){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,t).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(i=>{throw E(e.animation)&&this._applyCachedCameraTrackingEnabled(e),i}).finally(()=>{zi(r)})}_applyCachedCameraTrackingEnabled(e){v(e.environment.cachedCameraTrackingEnabled)&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,t,r){return e.setTime(t),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,t,r){const i=new Date(t.date.toString()),[s,n]=this._getTime(i),[o,a]=this._getTime(r.date),l=rbt(n,a),c=e.renderCoordsHelper,h=M();c.toRenderCoords(e.camera.position,h);const p=M(),f=M();v(this.viewpoint.camera)&&c.toRenderCoords(this.viewpoint.camera.position,p);const m=new Date;return oa(()=>e.camera,y=>{c.toRenderCoords(y.position,f);const _=jn(h,f),b=jn(p,f);let x=0;_+b!==0&&(x=_/(_+b));const T=s+(o-s)*x,S=ibt(n,l*x);t.date=this._setTime(m,T,S)})}static createFrom(e,t){return new this().updateFrom(e,t)}};function PCe(e){if(e.type==="building-scene"||e.type==="map-image")return e.allSublayers.toArray()}function ghe(e){const t=PCe(e);if(t)return t.filter(r=>r.visible).map(r=>r.id)}u([d({type:String,json:{write:{isRequired:!0}}})],fa.prototype,"id",void 0),u([d({type:SO,json:{default:()=>new SO({text:""}),write:{isRequired:!0}}})],fa.prototype,"title",void 0),u([zt("title")],fa.prototype,"castTitle",null),u([d({type:WN,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.text)})}}})],fa.prototype,"description",void 0),u([zt("description")],fa.prototype,"castDescription",null),u([d({type:Qg,json:{default:()=>new Qg({url:""}),write:{isRequired:!0}}})],fa.prototype,"thumbnail",void 0),u([zt("thumbnail")],fa.prototype,"castThumbnail",null),u([d({type:Uc,nonNullable:!0,json:{write:{isRequired:!0}}})],fa.prototype,"viewpoint",void 0),u([d({type:PE,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],fa.prototype,"basemap",void 0),u([zt("basemap")],fa.prototype,"castBasemap",null),u([d({type:MCe,json:{write:!0}})],fa.prototype,"ground",void 0),u([d({type:nW,json:{write:{isRequired:!0}}})],fa.prototype,"visibleLayers",null),u([zt("visibleLayers")],fa.prototype,"castVisibleLayers",null),u([d({type:dS,json:{write:!0}})],fa.prototype,"environment",void 0),fa=u([P("esri.webscene.Slide")],fa);const oW=86400,yhe=43200;function rbt(e,t){let r=t-e;return r>yhe&&(r-=oW),r<-yhe&&(r+=oW),r}function ibt(e,t){return dDe(e+t,oW)}const sbt=fa,aW=pt.ofType(sbt);let JN=class extends fe{constructor(e){super(e),this.slides=new aW}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(t=>!!t.viewpoint)),this._set("slides",gy(e,this._get("slides"),aW))}clone(){return new this.constructor({slides:this.slides.clone()})}};u([d({type:aW,nonNullable:!0,json:{write:!0}}),zt($X)],JN.prototype,"slides",null),JN=u([P("esri.webscene.Presentation")],JN);const ICe=JN;var lW;let B2=lW=class extends fe{constructor(e){super(e)}clone(){return new lW({name:this.name,path:this.path,title:this.title})}};u([d({type:String,json:{write:!0}})],B2.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],B2.prototype,"path",void 0),u([d({type:String,json:{write:!0}})],B2.prototype,"title",void 0),B2=lW=u([P("esri.webscene.TransportationNetwork")],B2);const nbt=B2;class g5 extends ux{constructor(t,r){super(t,r,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}let obt=null;function abt(){return obt}const Tw=new g5(1,30),lbt=()=>{const t=[],r=Tw.major;for(let i=8;i<=Tw.minor;i++)t.push(`${r}.${i}`);return t},BB="Web Scene",KL="ViewingMode-Local";let _i=class extends Tm.LoadableMixin(fP(iZ(V1e))){constructor(e){super(e),this._layersIdGCTimeoutId=void 0,this._handles=new Jr,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new ICe,this.initialViewProperties=new m5,this.portalItem=null,this.resourceInfo=null,this._debouncedSaveOperations=PW(async(t,r,i)=>{switch(t){case fS.SAVE:return this._saveImpl(r);case fS.SAVE_AS:return this._saveAsImpl(i,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{ee.getLogger(this.declaredClass).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(t){return void this.addResolvingPromise(Promise.reject(t))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this._handles.destroy(),this.presentation&&this.presentation.destroy();const e=this.portalItem;this.portalItem=null,e==null||e.destroy()}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,r,i){const s={...i,layerContainerType:"operational-layers"},n=e.map(o=>this.verifyWriteLayer(o,i)?o.write({},s):null).filter(o=>!!o);t[r]=n.toArray()}verifyWriteLayer(e,t){return"write"in e||(t&&t.messages&&t.messages.push(new j("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1)}readSourceVersion(e,t){const[r,i]=t.version.split(".");return new g5(parseInt(r,10),parseInt(i,10))}writeSourceVersion(e,t,r){t[r]=`${Tw.major}.${Tw.minor}`}get thumbnailUrl(){var e,t;return(t=(e=this.portalItem)==null?void 0:e.thumbnailUrl)!=null?t:null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=LX}writeGround(e,t,r,i){t[r]=e?e.write({},i):{transparency:0,layers:[]}}readInitialViewProperties(e,t){const r={};return t.initialState&&t.initialState.environment&&(r.environment=LE.fromJSON(t.initialState.environment)),t.spatialReference?r.spatialReference=Ye.fromJSON(t.spatialReference):r.spatialReference=Ye.WebMercator,r.viewingMode=t.viewingMode||"global",t.initialState&&t.initialState.viewpoint&&(r.viewpoint=Uc.fromJSON(t.initialState.viewpoint)),new m5(r)}get spatialReference(){var e,t;return(t=(e=this.initialViewProperties)==null?void 0:e.spatialReference)!=null?t:Ye.WebMercator}get viewingMode(){var e,t;return(t=(e=this.initialViewProperties)==null?void 0:e.viewingMode)!=null?t:"global"}load(e){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}loadAll(){return MZ(this,e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map(r=>r.basemap))})}read(e,t){var s;t={...t,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,i=this._isAuthoringAppSetByUser;if(spe(this,e,n=>super.read(e,n),t),i||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&((s=this.sourceVersion)==null?void 0:s.supportsVisibleElevationLayersInSlides)){const n=e.baseMap.elevationLayers.map(c=>({id:c.id})),o=this.presentation.slides,a=(c,h)=>c.visibleLayers.some(p=>p.id===h),l=n.filter(c=>!o.some(h=>a(h,c.id)));o.forEach(c=>{c.visibleLayers.addMany(l)})}}_writeBasemapElevationLayers(e){const t=e.ground&&e.ground.layers;!e.baseMap&&t&&t.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=re(t))}write(e,t){var s,n;if(this.loadStatus!=="loaded"){const o=new j("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw ee.getLogger(this.declaredClass).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),o}this._runLayersIdGC();const r=!(t!=null&&t.messages);t={messages:[],...t,origin:"web-scene"};const i=super.write(e,t);if(r){const o=(n=(s=t.messages)==null?void 0:s.filter(a=>a.name==="web-document-write:property-required"))!=null?n:[];if(o.length){const a=new j("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:o});throw ee.getLogger(this.declaredClass).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",o),a}}return this._writeBasemapElevationLayers(i),i}async save(e){return this._debouncedSaveOperations(fS.SAVE,e)}async _saveImpl(e){var s,n;if(!this.portalItem)throw ee.getLogger(this.declaredClass).error("save(): requires the .portalItem property to be set"),await Promise.resolve(),new j("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(((s=this.portalItem)==null?void 0:s.type)!==BB)throw await Promise.resolve(),new j("webscene:portal-item-wrong-type",`Portal item needs to have type "${BB}"`);const t=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl?po(this.portalItem.itemUrl):null,messages:[],portal:(n=this.portalItem.portal)!=null?n:Uo.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),i=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(i,r,e),this._updateTypeKeywords(this.portalItem),await this.portalItem.update({data:i}),await phe(this._resourceReferences,r,null),dhe(r),t&&await t,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this._debouncedSaveOperations(fS.SAVE_AS,t,e)}async _saveAsImpl(e,t){var l;let r=gw.from(e);r||(ee.getLogger(this.declaredClass).error("saveAs(portalItem): requires a portal item parameter"),await Promise.reject(new j("webscene:portal-item-required","saveAs requires a portal item to save to"))),r.id&&(r=r.clone(),r.id=null);const i=r.portal||Uo.getDefault();await this._ensureLoadBeforeSave(),r.type=BB,r.portal=i;const s=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:i,portalItem:r,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),n=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(n,s,t);const o=this.thumbnailUrl,a=!this._isOverridden("thumbnailUrl");return this._updateTypeKeywords(r),await i.signIn(),await((l=i.user)==null?void 0:l.addItem({item:r,folder:t&&t.folder,data:n})),await phe(this._resourceReferences,s,null),this.portalItem=r,gj.prototype.read.call(this,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl&&po(r.itemUrl)}),dhe(s),o&&(this.thumbnailUrl=a?PX(o,"w","8192"):o),s.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){var e;this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,t,r,i=!1){var l,c;if(!sE(this.spatialReference))return Promise.reject(new j("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,n=(c=(l=t.messages)==null?void 0:l.filter(h=>h.type==="error").map(h=>new j(h.name,h.message,h.details)))!=null?c:[];t.blockedRelativeUrls&&(n=n.concat(t.blockedRelativeUrls.map(h=>new j("url:unsupported",`Relative url '${h}' is not supported in Web Scene`)))),r&&r.ignoreUnsupported&&(n=n.filter(h=>h.name!=="layer:unsupported"&&h.name!=="symbol:unsupported"&&h.name!=="symbol-layer:unsupported"&&h.name!=="property:unsupported"&&h.name!=="url:unsupported"&&h.name!=="scenemodification:unsupported")),r!=null&&r.requiredPropertyChecksDisabled&&(n=n.filter(h=>h.name!=="web-document-write:property-required"));const o=!!(r!=null&&r.strictSchemaValidationEnabled),a=abt();return s=o&&a?a().then(h=>{const p=h.validate(e);if(p.length>0){const f=`webscene did not validate:
${p.join(`
`)}`;ee.getLogger(this.declaredClass).error(`${i?"saveAs":"save"}(): ${f}`)}return p.map(f=>new j("webscene:schema-validation",f))}).then(h=>{if(h.length>0)throw U1t(h.concat(n));return n}):Promise.resolve(n),s.then(h=>{if(h.length>0)throw new j("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:h})})}_verifySaveAs(e,t,r){return this.canNotSaveAs(t)?Promise.reject(F1t()):this._verifySave(e,t,r,!0)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},t);return this._verifySaveAs(r,t,e)}canNotSaveAs(e){var t,r,i;return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),((i=(r=(t=e.verifyItemRelativeUrls)==null?void 0:t.writtenUrls)==null?void 0:r.length)!=null?i:0)>0}async updateFrom(e,t={}){const r=this._updateFrom(e,t);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,t={}){var r;if(await e.whenReady(),!t.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=LE.prototype.clone.apply(e.environment)),!t.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,v(e.clippingArea)?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const i of e.allLayerViews){const s="visible";s in i&&s in i.layer&&i._isOverridden(s)&&(i.layer[s]=i[s])}(t.thumbnailExcluded===!1||t.thumbnailExcluded==null&&!t.viewpointExcluded)&&await this._updateFromThumbnail(e,(r=t.thumbnailSize)!=null?r:void 0)}async _updateFromThumbnail(e,t){const r=W1t(e,t),i=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=i.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,t){const r=this._validateJSON(e);return this.read(r,t),this._loadFromJSON(r,t)}_extractOperationalLayers(e){var s;const t=[];if(!((s=this.sourceVersion)!=null&&s.supportsGround)&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const n of e.baseMap.elevationLayers)t.push(n);const r=[],i=n=>{var o;return n.layers&&(n.layers=n.layers.filter(i)),n.layerType!=="ArcGISTiledElevationServiceLayer"||((o=this.sourceVersion)!=null&&o.supportsGround||r.push(n),!1)};return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(i):[],operationalElevationLayers:r,basemapElevationLayers:t}}_loadFromJSON(e,t){const r=new pt;return this._validateSpatialReference().then(()=>this._validateHeightModelInfo()).then(()=>ie(()=>import("./layersCreator.57188091.js"),["assets/layersCreator.57188091.js","assets/lazyLayerLoader.8af10eca.js","assets/portalLayers.c475d6b2.js","assets/layersLoader.b6701a4d.js","assets/fetchService.d8bf9569.js","assets/jsonContext.fc22b0d2.js"])).then(({populateOperationalLayers:i})=>{const{operationalLayers:s,operationalElevationLayers:n,basemapElevationLayers:o}=this._extractOperationalLayers(e),a=[],l={context:{...t,layerContainerType:"operational-layers"}};if(this.portalItem&&(l.context.portal=this.portalItem.portal||Uo.getDefault()),o.length>0){const c={...l,context:{...l.context,layerContainerType:"ground"}};c.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(i(this.ground.layers,o,c))}if(n.length>0){const c={...l,context:{...l.context,layerContainerType:"ground"}};c.defaultLayerType="ArcGISTiledElevationServiceLayer",a.push(i(r,n,c))}return s&&s.length>0&&a.push(i(this.layers,s,l)),fo(a).then(()=>{})}).then(()=>this._loadObjectsWithLayers()).then(()=>{this.ground.layers.addMany(r)})}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[];for(const t of this.allLayers.items)if("beforeSave"in t&&typeof t.beforeSave=="function"){const r=t.beforeSave();r&&e.push(r)}await fo(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(t=>{t.basemap&&e.push(t.basemap.load())}),await fo(e)}async _loadFromItem(e){var i;if(await e.load().catch(s=>{throw new j("webscene:load-portal-item","Failed to load portal item",{error:s})}),e.type!=="Web Scene")throw new j("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const r={origin:"web-scene",url:po(e.itemUrl),portal:e.portal||Uo.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(t,r),this._resourceReferences={portalItem:e,paths:(i=r.readResourcePaths)!=null?i:[]}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!JE(t,Ge.Global))return Promise.reject(new j("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=a=>!a||fv(a,t)}else{if(!JE(t,Ge.Local))return Promise.reject(new j("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=a=>!a||a.equals(t)}const i=a=>{var l,c,h;return(h=(l=a==null?void 0:a.camera)==null?void 0:l.position.spatialReference)!=null?h:(c=a==null?void 0:a.targetGeometry)==null?void 0:c.spatialReference},s=e.viewpoint,n=i(s);if(n&&!r(n))return Promise.reject(new j("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:n,sceneSpatialReference:t,viewingMode:e.viewingMode}));const o=this.presentation.slides.find(a=>!r(i(a.viewpoint)));if(o){const a=i(o.viewpoint);return Promise.reject(new j("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:a,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=RHe(this.heightModelInfo,e);return t?Promise.reject(t):Promise.resolve()}_validateJSON(e){const t=g5.parse(e.version||"","webscene");return Tw.validate(t),e.version=`${t.major}.${t.minor}`,t.major===1&&t.minor<=2&&(e.spatialReference=Ye.WebMercator.toJSON()),e}_updateTypeKeywords(e){this.initialViewProperties.viewingMode==="local"?e.typeKeywords?e.typeKeywords.includes(KL)||e.typeKeywords.push(KL):e.typeKeywords=[KL]:this.initialViewProperties.viewingMode==="global"&&e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(t=>t!==KL)),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((t,r,i)=>i.indexOf(t)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||Ye.WebMercator}get _verifyItemRelativeRootPath(){var e;return(e=this.portalItem)!=null&&e.itemUrl?po(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,t=i=>this.allLayers.some(s=>s.id===i);e&&e.layers&&(e.layers=e.layers.filter(i=>t(i.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(i=>{i.visibleLayers&&(i.visibleLayers=i.visibleLayers.filter(s=>t(s.id)))})}static fromJSON(e){if(!e)throw new j("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};var fS;_i.version=`${Tw.major}.${Tw.minor}`,u([d({type:ebt,json:{write:!0}})],_i.prototype,"applicationProperties",void 0),u([d({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],_i.prototype,"basemap",void 0),u([d({type:qr,json:{read:{source:"clippingArea.geometry",reader:gm},write:{target:"clippingArea.geometry"}}})],_i.prototype,"clippingArea",void 0),u([Be("clippingArea")],_i.prototype,"writeClippingArea",null),u([d({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],_i.prototype,"clippingEnabled",void 0),u([De("clippingEnabled",["clippingArea"])],_i.prototype,"readClippingEnabled",null),u([Be("clippingEnabled")],_i.prototype,"writeClippingEnabled",null),u([d({type:L1t,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],_i.prototype,"floorInfo",void 0),u([d({type:Fv,json:{write:!0}})],_i.prototype,"heightModelInfo",void 0),u([d({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],_i.prototype,"layers",void 0),u([Be("layers")],_i.prototype,"writeLayers",null),u([d({readOnly:!0,type:g5,json:{type:lbt(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],_i.prototype,"sourceVersion",void 0),u([De("sourceVersion",["version"])],_i.prototype,"readSourceVersion",null),u([Be("sourceVersion")],_i.prototype,"writeSourceVersion",null),u([d({json:{read:!1,write:!1}})],_i.prototype,"tables",void 0),u([d()],_i.prototype,"thumbnailUrl",null),u([d({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],_i.prototype,"authoringApp",null),u([Be("authoringApp")],_i.prototype,"writeAuthoringApp",null),u([d({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],_i.prototype,"authoringAppVersion",null),u([Be("authoringAppVersion")],_i.prototype,"writeAuthoringAppVersion",null),u([d({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],_i.prototype,"ground",void 0),u([Be("ground")],_i.prototype,"writeGround",null),u([d({type:pt.ofType(nbt),json:{write:!0}})],_i.prototype,"transportationNetworks",void 0),u([d({type:ICe,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,r,i)=>{if(e.slides&&e.slides.length>0){const s={...i,isPresentation:!0};t.presentation=e.write({},s)}}}}})],_i.prototype,"presentation",void 0),u([d({type:m5,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new m5({viewingMode:"global",spatialReference:Ye.WebMercator})}})],_i.prototype,"initialViewProperties",void 0),u([De("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],_i.prototype,"readInitialViewProperties",null),u([d({type:Ye,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],_i.prototype,"spatialReference",null),u([d({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],_i.prototype,"viewingMode",null),u([d({type:gw})],_i.prototype,"portalItem",void 0),u([d()],_i.prototype,"resourceInfo",void 0),_i=u([P("esri.WebScene")],_i),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(fS||(fS={}));const cbt=_i;const si={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let z2,$Ce,A8,LCe=!1,y5=!1,sK=!1,wu=!1,_he=null,cW=!1;const rI=typeof window!="undefined"?window:{};si.cssVarShim&&rI.CSS;const Ap=rI.document||{head:{}},ubt=rI.HTMLElement||class{},zc={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,r,i)=>e.addEventListener(t,r,i),rel:(e,t,r,i)=>e.removeEventListener(t,r,i),ce:(e,t)=>new CustomEvent(e,t)},_5=si.shadowDomShim&&si.shadowDom?(()=>(Ap.head.attachShadow+"").indexOf("[native")>-1)():!0,hbt=(()=>{let e=!1;try{Ap.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),dbt=e=>Promise.resolve(e),pbt=si.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,DCe=(e,t,r,i)=>{r&&r.map(([s,n,o])=>{const a=mbt(e,s),l=fbt(t,o),c=gbt(s);zc.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>zc.rel(a,n,l,c))})},fbt=(e,t)=>r=>{try{si.lazyLoad||e.$hostElement$[t](r)}catch(i){iI(i)}},mbt=(e,t)=>t&4?Ap:t&8?rI:t&16?Ap.body:e,gbt=e=>hbt?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,vhe="http://www.w3.org/1999/xlink",mx=(e,t="")=>()=>{},bhe=new WeakMap,ybt=(e,t,r)=>{let i=w5.get(e);pbt&&r?(i=i||new CSSStyleSheet,i.replace(t)):i=t,w5.set(e,i)},_bt=(e,t,r,i)=>{let s=NCe(t,r),n=w5.get(s);if(e=e.nodeType===11?e:Ap,n)if(typeof n=="string"){e=e.head||e;let o=bhe.get(e),a;o||bhe.set(e,o=new Set),o.has(s)||(a=Ap.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},vbt=e=>{const t=e.$cmpMeta$,r=e.$hostElement$,i=t.$flags$,s=mx("attachStyles",t.$tagName$),n=_bt(_5&&r.shadowRoot?r.shadowRoot:r.getRootNode(),t,e.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},NCe=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),bbt=e=>Xbt.map(t=>t(e)).find(t=>!!t),whe={},wbt="http://www.w3.org/2000/svg",xbt="http://www.w3.org/1999/xhtml",Tbt=e=>e!=null,nK=e=>(e=typeof e,e==="object"||e==="function"),wh=(e,t,...r)=>{let i=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let f=0;f<p.length;f++)i=p[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof e!="function"&&!nK(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?v5(null,i):i),a=o)};if(c(r),t&&(si.isDev&&e==="input"&&Cbt(t),si.vdomKey&&t.key&&(s=t.key),si.slotRelocation&&t.name&&(n=t.name),si.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(si.isDev&&l.some(UCe)&&qbt(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),si.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,Sbt);const h=v5(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),si.vdomKey&&(h.$key$=s),si.slotRelocation&&(h.$name$=n),h},v5=(e,t)=>{const r={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return si.vdomAttribute&&(r.$attrs$=null),si.vdomKey&&(r.$key$=null),si.slotRelocation&&(r.$name$=null),r},FCe={},UCe=e=>e&&e.$tag$===FCe,Sbt={forEach:(e,t)=>e.map(xhe).forEach(t),map:(e,t)=>e.map(xhe).map(t).map(Ebt)},xhe=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),Ebt=e=>{if(typeof e.vtag=="function"){const r=Object.assign({},e.vattrs);return e.vkey&&(r.key=e.vkey),e.vname&&(r.name=e.vname),wh(e.vtag,r,...e.vchildren||[])}const t=v5(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},Cbt=e=>{const t=Object.keys(e),r=t.indexOf("value");if(r===-1)return;const i=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(r<i||r<s||r<n||r<o)&&Wbt('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},The=(e,t,r,i,s,n)=>{if(r!==i){let o=Ahe(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=She(r),h=She(i);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?e.style.setProperty(l,i[l]):e.style[l]=i[l])}else if(t!=="key")if(t==="ref")i&&i(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Ahe(rI,a)?t=a.slice(2):t=a[2]+t.slice(3),r&&zc.rel(e,t,r,!1),i&&zc.ael(e,t,i,!1);else{const l=nK(i);if((o||l&&i!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=i;else{let h=i==null?"":i;t==="list"?o=!1:(r==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),i==null||i===!1?(i!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(vhe,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?e.setAttributeNS(vhe,t,i):e.setAttribute(t,i))}}},Abt=/\s/,She=e=>e?e.split(Abt):[],kCe=(e,t,r,i)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||whe,o=t.$attrs$||whe;for(i in n)i in o||The(s,i,n[i],void 0,r,t.$flags$);for(i in o)The(s,i,n[i],o[i],r,t.$flags$)},b5=(e,t,r,i)=>{let s=t.$children$[r],n=0,o,a,l;if(LCe||(sK=!0,s.$tag$==="slot"&&(z2&&i.classList.add(z2+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Ap.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Ap.createTextNode("");else{if(wu||(wu=s.$tag$==="svg"),o=s.$elm$=Ap.createElementNS(wu?wbt:xbt,s.$flags$&2?"slot-fb":s.$tag$),wu&&s.$tag$==="foreignObject"&&(wu=!1),kCe(null,s,wu),Tbt(z2)&&o["s-si"]!==z2&&o.classList.add(o["s-si"]=z2),s.$children$)for(n=0;n<s.$children$.length;++n)a=b5(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?wu=!1:o.tagName==="foreignObject"&&(wu=!0)}return o["s-hn"]=A8,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=$Ce,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[r],l&&l.$tag$===s.$tag$&&e.$elm$&&YM(e.$elm$,!1)),o},YM=(e,t)=>{zc.$flags$|=1;const r=e.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==A8&&s["s-ol"]&&(zCe(s).insertBefore(s,oK(s)),s["s-ol"].remove(),s["s-ol"]=void 0,sK=!0),t&&YM(s,t)}zc.$flags$&=-2},VCe=(e,t,r,i,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===A8&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=b5(null,r,s,e),a&&(i[s].$elm$=a,o.insertBefore(a,oK(t))))},BCe=(e,t,r,i,s)=>{for(;t<=r;++t)(i=e[t])&&(s=i.$elm$,HCe(i),y5=!0,s["s-ol"]?s["s-ol"].remove():YM(s,!0),s.remove())},Rbt=(e,t,r,i)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=i.length-1,f=i[0],m=i[p],y,_;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=i[++n];else if(m==null)m=i[--p];else if(eD(c,f))G2(c,f),c=t[++s],f=i[++n];else if(eD(h,m))G2(h,m),h=t[--l],m=i[--p];else if(eD(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&YM(c.$elm$.parentNode,!1),G2(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=i[--p];else if(eD(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&YM(h.$elm$.parentNode,!1),G2(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=i[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(_=t[o],_.$tag$!==f.$tag$?y=b5(t&&t[n],r,o,e):(G2(_,f),t[o]=void 0,y=_.$elm$),f=i[++n]):(y=b5(t&&t[n],r,n,e),f=i[++n]),y&&zCe(c.$elm$).insertBefore(y,oK(c.$elm$))}s>l?VCe(e,i[p+1]==null?null:i[p+1].$elm$,r,i,n,p):n>p&&BCe(t,s,l)},eD=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,oK=e=>e&&e["s-ol"]||e,zCe=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,G2=(e,t)=>{const r=t.$elm$=e.$elm$,i=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(wu=n==="svg"?!0:n==="foreignObject"?!1:wu,n==="slot"||kCe(e,t,wu),i!==null&&s!==null?Rbt(r,i,t,s):s!==null?(e.$text$!==null&&(r.textContent=""),VCe(r,null,t,s,0,s.length-1)):i!==null&&BCe(i,0,i.length-1),wu&&n==="svg"&&(wu=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(r.data=o)},GCe=e=>{let t=e.childNodes,r,i,s,n,o,a;for(i=0,s=t.length;i<s;i++)if(r=t[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){r.hidden=!0;break}}GCe(r)}},ap=[],jCe=e=>{let t,r,i,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(r=t["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=t["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==t["s-hn"]&&(Ehe(r,s)?(n=ap.find(h=>h.$nodeToRelocate$===r),y5=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=t:ap.push({$slotRefNode$:t,$nodeToRelocate$:r}),r["s-sr"]&&ap.map(h=>{Ehe(h.$nodeToRelocate$,r["s-sn"])&&(n=ap.find(p=>p.$nodeToRelocate$===r),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):ap.some(h=>h.$nodeToRelocate$===r)||ap.push({$nodeToRelocate$:r}));t.nodeType===1&&jCe(t)}},Ehe=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",HCe=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(HCe)},Obt=(e,t)=>{const r=e.$hostElement$,i=e.$cmpMeta$,s=e.$vnode$||v5(null,null),n=UCe(t)?t:wh(null,null,t);A8=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,z2=r["s-sc"],$Ce=r["s-cr"],LCe=_5&&(i.$flags$&1)!==0,y5=!1,G2(s,n);{if(zc.$flags$|=1,sK){jCe(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<ap.length;f++)o=ap[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Ap.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<ap.length;f++)if(o=ap[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}y5&&GCe(n.$elm$),zc.$flags$&=-2,ap.length=0}},Mbt=(e,t)=>{},qCe=(e,t)=>(e.$flags$|=16,Mbt(e,e.$ancestorComponent$),Jbt(()=>Pbt(e,t))),Pbt=(e,t)=>{const r=e.$hostElement$,i=mx("scheduleUpdate",e.$cmpMeta$.$tagName$),s=r;let n;return t?n=ZS(s,"componentWillLoad"):n=ZS(s,"componentWillUpdate"),n=Che(n,()=>ZS(s,"componentWillRender")),i(),Che(n,()=>Ibt(e,s,t))},Ibt=async(e,t,r)=>{const i=e.$hostElement$,s=mx("update",e.$cmpMeta$.$tagName$);i["s-rc"],r&&vbt(e);const n=mx("render",e.$cmpMeta$.$tagName$);$bt(e,t,i),n(),s(),Lbt(e)},$bt=(e,t,r)=>{try{_he=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(si.hasRenderFn||si.reflect)&&(si.vdomRender||si.reflect)&&(si.hydrateServerSide||Obt(e,t))}catch(a){iI(a,e.$hostElement$)}return _he=null,null},Lbt=e=>{const t=e.$cmpMeta$.$tagName$,r=e.$hostElement$,i=mx("postUpdate",t),s=r;e.$ancestorComponent$,ZS(s,"componentDidRender"),e.$flags$&64?(ZS(s,"componentDidUpdate"),i()):(e.$flags$|=64,ZS(s,"componentDidLoad"),i())},ZS=(e,t,r)=>{if(e&&e[t])try{return e[t](r)}catch(i){iI(i)}},Che=(e,t)=>e&&e.then?e.then(t):t(),Dbt=(e,t)=>e!=null&&!nK(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,Nbt=(e,t)=>R8(e).$instanceValues$.get(t),Fbt=(e,t,r,i)=>{const s=R8(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;r=Dbt(r,i.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(t,r);{if(i.$watchers$&&a&128){const p=i.$watchers$[t];p&&p.map(f=>{try{l[f](r,o,t)}catch(m){iI(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,t)===!1)return;qCe(s,!1)}}}},Ubt=(e,t,r)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const i=Object.entries(t.$members$),s=e.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return Nbt(this,n)},set(a){Fbt(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){zc.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},kbt=async(e,t,r,i,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=bbt(e)]);const a=NCe(r,t.$modeName$);if(!w5.has(a)){const l=mx("registerStyles",r.$tagName$);ybt(a,o,!!(r.$flags$&1)),l()}}t.$ancestorComponent$,(()=>qCe(t,!0))()},Vbt=e=>{},Bbt=e=>{if((zc.$flags$&1)===0){const t=R8(e),r=t.$cmpMeta$,i=mx("connectedCallback",r.$tagName$);t.$flags$&1?(DCe(e,t,r.$listeners$),Vbt(t.$lazyInstance$)):(t.$flags$|=1,r.$flags$&12&&zbt(e),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),kbt(e,t,r)),i()}},zbt=e=>{const t=e["s-cr"]=Ap.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},Gbt=e=>{if((zc.$flags$&1)===0){const t=R8(e);t.$rmListeners$&&(t.$rmListeners$.map(r=>r()),t.$rmListeners$=void 0)}},jbt=(e,t)=>{const r={$flags$:t[0],$tagName$:t[1]};si.member&&(r.$members$=t[2]),si.hostListener&&(r.$listeners$=t[3]),si.watchCallback&&(r.$watchers$=e.$watchers$),si.reflect&&(r.$attrsToReflect$=[]),si.shadowDom&&!_5&&r.$flags$&1&&(r.$flags$|=8);const i=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){Hbt(this,r)},connectedCallback(){Bbt(this),si.connectedCallback&&i&&i.call(this)},disconnectedCallback(){Gbt(this),si.disconnectedCallback&&s&&s.call(this)},__attachShadow(){_5?si.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=r.$tagName$,Ubt(e,r)},WCe=new WeakMap,R8=e=>WCe.get(e),Hbt=(e,t)=>{const r={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return si.isDev&&(r.$renderCount$=0),si.method&&si.lazyLoad&&(r.$onInstancePromise$=new Promise(i=>r.$onInstanceResolve$=i)),si.asyncLoading&&(r.$onReadyPromise$=new Promise(i=>r.$onReadyResolve$=i),e["s-p"]=[],e["s-rc"]=[]),DCe(e,r,t.$listeners$),WCe.set(e,r)},Ahe=(e,t)=>t in e,iI=(e,t)=>(0,console.error)(e,t),XCe=si.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],qbt=(...e)=>console.error(...XCe,...e),Wbt=(...e)=>console.warn(...XCe,...e),w5=new Map,Xbt=[],Rhe=[],YCe=[],Ybt=(e,t)=>r=>{e.push(r),cW||(cW=!0,t&&zc.$flags$&4?Zbt(uW):zc.raf(uW))},Ohe=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(r){iI(r)}e.length=0},uW=()=>{Ohe(Rhe),Ohe(YCe),(cW=Rhe.length>0)&&zc.raf(uW)},Zbt=e=>dbt().then(e),Jbt=Ybt(YCe,!0);si.isDev,si.isTesting;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */function Qbt(e){return e.map(t=>{let r="";for(let i=0;i<t;i++)r+=((1+Math.random())*65536|0).toString(16).substring(1);return r}).join("-")}const Kbt=()=>Qbt([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.82
 */const ewt='@charset "UTF-8";@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{position:relative;margin-left:auto;margin-right:auto;display:none;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;padding-top:4rem;padding-bottom:4rem;opacity:1;min-height:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;-webkit-transform:scale(1, 1);transform:scale(1, 1);animation:loader-color-shift 6s alternate-reverse infinite linear}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-top:0px;padding-bottom:0px}:host{display:none}:host([active]){display:-ms-flexbox;display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-top:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);width:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;width:var(--calcite-loader-size);height:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svg{position:absolute;top:0px;left:0px;-webkit-transform-origin:center;transform-origin:center;overflow:visible;width:var(--calcite-loader-size);height:var(--calcite-loader-size);-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:loader-clockwise;animation-name:loader-clockwise}@supports (display: grid){.loader__svg--1{-webkit-animation-name:loader-offset-1;animation-name:loader-offset-1}.loader__svg--2{-webkit-animation-name:loader-offset-2;animation-name:loader-offset-2}.loader__svg--3{-webkit-animation-name:loader-offset-3;animation-name:loader-offset-3}}:host([type=determinate]){-webkit-animation:none;animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svg--3{-webkit-animation:none;animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;-webkit-transform:rotate(-90deg);transform:rotate(-90deg);-webkit-transition:all var(--calcite-internal-animation-timing-fast) linear;transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;-webkit-animation:none;animation:none;stroke:currentColor;stroke-width:2;padding-top:0px;padding-bottom:0px;height:var(--calcite-loader-size-inline);min-height:var(--calcite-loader-size-inline);width:var(--calcite-loader-size-inline);-webkit-margin-end:calc(var(--calcite-loader-size-inline) * 0.5);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([active][inline]){display:inline-block}:host([inline]) .loader__svgs{top:0px;left:0px;margin:0px;width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444% 139.6262222222%;-webkit-animation-duration:0.72s;animation-duration:0.72s}@-webkit-keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}.loader__svg--2{stroke-dasharray:55.8504888889% 139.6262222222%;-webkit-animation-duration:0.96s;animation-duration:0.96s}@-webkit-keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}.loader__svg--3{stroke-dasharray:13.9626222222% 139.6262222222%;-webkit-animation-duration:1.16s;animation-duration:1.16s}@-webkit-keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@-webkit-keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@-webkit-keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}',twt=jbt(class extends ubt{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.active=!1,this.inline=!1,this.scale="m",this.value=0,this.text="",this.noPadding=!1}render(){const{el:e,inline:t,label:r,scale:i,text:s,type:n,value:o}=this,a=e.id||Kbt(),l=.45,c=t?this.getInlineSize(i):this.getSize(i),h=c*l,p=`0 0 ${c} ${c}`,f=n==="determinate",m=2*h*Math.PI,y=o/100*m,_=m-y,b=Math.floor(o),x={"aria-valuenow":b,"aria-valuemin":0,"aria-valuemax":100,complete:b===100},T={r:h,cx:c/2,cy:c/2},S={"stroke-dasharray":`${y} ${_}`};return wh(FCe,Object.assign({"aria-label":r,id:a,role:"progressbar"},f?x:{}),wh("div",{class:"loader__svgs"},wh("svg",{class:"loader__svg loader__svg--1",viewBox:p},wh("circle",Object.assign({},T))),wh("svg",{class:"loader__svg loader__svg--2",viewBox:p},wh("circle",Object.assign({},T))),wh("svg",Object.assign({class:"loader__svg loader__svg--3",viewBox:p},f?{style:S}:{}),wh("circle",Object.assign({},T)))),s&&wh("div",{class:"loader__text"},s),f&&wh("div",{class:"loader__percentage"},o))}getSize(e){return{s:32,m:56,l:80}[e]}getInlineSize(e){return{s:12,m:16,l:20}[e]}get el(){return this}static get style(){return ewt}},[1,"calcite-loader",{active:[516],inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1],noPadding:[4,"no-padding"]}]);function rwt(){if(typeof customElements=="undefined")return;["calcite-loader"].forEach(t=>{switch(t){case"calcite-loader":customElements.get(t)||customElements.define(t,twt);break}})}rwt();const ZM=new cbt({portalItem:{id:"91b46c2b162c48dba264b2190e1dbcff"}}),aK=new O1t({container:"viewDiv",map:ZM,qualityProfile:"high"});ZM.when().then(()=>{ZM.ground.surfaceColor=new Qe([220,220,220])});ZM.loadAll().then(()=>{const e=ZM.presentation.slides;e.getItemAt(Math.floor(Math.random()*e.length)).applyTo(aK,{animate:!1})});iE(()=>!aK.updating).then(()=>{var t;const e=document.getElementById("loader");(t=e==null?void 0:e.parentElement)==null||t.removeChild(e)});window.view=aK;export{Vs as $,lSt as A,ZO as B,nv as C,Grt as D,by as E,cm as F,pt as G,Ys as H,Mp as I,eSt as J,uSt as K,j as L,Tke as M,aA as N,d2t as O,W5 as P,p2t as Q,gP as R,Dv as S,f2t as T,ri as U,X5 as V,dP as W,Yve as X,nPe as Y,h2t as Z,In as _,Ve as a,q5 as a$,J2t as a0,bLe as a1,Hl as a2,Sm as a3,Qut as a4,qit as a5,Vc as a6,cr as a7,jit as a8,wW as a9,oa as aA,dn as aB,Ka as aC,gt as aD,zi as aE,c2e as aF,fo as aG,ea as aH,na as aI,bwt as aJ,cv as aK,en as aL,hp as aM,iE as aN,ce as aO,mo as aP,me as aQ,ae as aR,yt as aS,xu as aT,jI as aU,Z2t as aV,Pn as aW,Nee as aX,tt as aY,H2t as aZ,mit as a_,de as aa,pxt as ab,od as ac,Bo as ad,Rw as ae,k9e as af,Pt as ag,ee as ah,$i as ai,bX as aj,le as ak,wm as al,ed as am,M as an,oSt as ao,nSt as ap,vy as aq,qr as ar,IE as as,Jt as at,Rc as au,Do as av,vSt as aw,mQ as ax,sSt as ay,iSt as az,P as b,yx as b$,fv as b0,wx as b1,Kut as b2,eQ as b3,ym as b4,AP as b5,Rn as b6,hC as b7,ur as b8,zSe as b9,e5 as bA,Ge as bB,lye as bC,A_ as bD,qs as bE,Ai as bF,gJ as bG,zSt as bH,Z7e as bI,gw as bJ,O7e as bK,Zxt as bL,Uo as bM,n2t as bN,po as bO,up as bP,oP as bQ,PHe as bR,A2t as bS,ypt as bT,CSt as bU,kQ as bV,xx as bW,fP as bX,dC as bY,Yxt as bZ,t9e as b_,fxt as ba,Ts as bb,s6 as bc,x2t as bd,my as be,Afe as bf,Q_ as bg,iee as bh,Rfe as bi,vht as bj,Zr as bk,cwt as bl,HB as bm,sde as bn,ie as bo,Kr as bp,k as bq,Se as br,ss as bs,vt as bt,Ni as bu,gp as bv,ks as bw,Di as bx,nt as by,Si as bz,om as c,ao as c$,gm as c0,Ye as c1,Lm as c2,fe as c3,KS as c4,De as c5,Be as c6,ZK as c7,VY as c8,W0e as c9,cs as cA,Ep as cB,Rt as cC,is as cD,nC as cE,T2t as cF,t7 as cG,gx as cH,Wht as cI,Lr as cJ,Nc as cK,jl as cL,kr as cM,Ege as cN,w as cO,Ks as cP,ju as cQ,Mt as cR,Pe as cS,V4 as cT,Nm as cU,xt as cV,Vp as cW,Ee as cX,B as cY,Oi as cZ,Dr as c_,vUe as ca,_Ue as cb,PW as cc,Nv as cd,RW as ce,ll as cf,JDe as cg,Zwt as ch,Wpe as ci,Hr as cj,Au as ck,Ip as cl,L2t as cm,z5 as cn,Bc as co,Qs as cp,tn as cq,A as cr,Je as cs,cw as ct,b6 as cu,Xr as cv,Yh as cw,Ca as cx,zn as cy,Wr as cz,Te as d,d1e as d$,Br as d0,Nr as d1,Or as d2,Vt as d3,ky as d4,H6 as d5,zv as d6,Jl as d7,_U as d8,Qt as d9,Zmt as dA,BEe as dB,WAe as dC,fwt as dD,KAe as dE,eRe as dF,ho as dG,d6 as dH,Znt as dI,jW as dJ,hJ as dK,QZ as dL,MSt as dM,NSt as dN,uJ as dO,ix as dP,lo as dQ,bp as dR,ko as dS,ns as dT,Ze as dU,yX as dV,gj as dW,Ri as dX,l2t as dY,Tm as dZ,G7e as d_,Rm as da,Mv as db,Gv as dc,wU as dd,yQ as de,vU as df,zC as dg,ant as dh,jZ as di,VC as dj,Tit as dk,Sn as dl,yP as dm,Hwt as dn,NMe as dp,$9e as dq,ywt as dr,KB as ds,uv as dt,eE as du,Uu as dv,Vje as dw,$p as dx,Ie as dy,Sit as dz,u as e,re as e$,K7e as e0,z9e as e1,Jke as e2,oZ as e3,uP as e4,ft as e5,Vr as e6,j7e as e7,_wt as e8,Ar as e9,ws as eA,X$e as eB,id as eC,Wl as eD,$xt as eE,Ht as eF,Js as eG,Ixt as eH,ti as eI,yC as eJ,ir as eK,m_e as eL,g_e as eM,tSt as eN,ge as eO,LXe as eP,L5 as eQ,IF as eR,bC as eS,gX as eT,X8 as eU,OO as eV,Aw as eW,ye as eX,br as eY,BY as eZ,sr as e_,G5 as ea,see as eb,Pu as ec,$fe as ed,Mc as ee,Vy as ef,KSe as eg,Ul as eh,EO as ei,rE as ej,Q$e as ek,_Je as el,DSt as em,BSt as en,bE as eo,bL as ep,Jxe as eq,Hc as er,Fgt as es,cye as et,VLe as eu,HC as ev,Oxt as ew,Hce as ex,YS as ey,vE as ez,D_ as f,Fu as f$,tY as f0,Me as f1,Hg as f2,FSt as f3,R2t as f4,Rp as f5,di as f6,ETt as f7,Ru as f8,P5 as f9,hge as fA,Mxt as fB,kge as fC,Vrt as fD,X2t as fE,Cfe as fF,cxt as fG,gwt as fH,ASt as fI,oxt as fJ,V5 as fK,i8e as fL,Y2t as fM,rs as fN,pye as fO,Z0e as fP,B_e as fQ,Gpe as fR,Sc as fS,wP as fT,Twt as fU,tke as fV,WTt as fW,J_ as fX,ud as fY,Knt as fZ,gi as f_,Swt as fa,lM as fb,qu as fc,rSt as fd,jbe as fe,cp as ff,Qrt as fg,pgt as fh,LSt as fi,H_ as fj,tDe as fk,jn as fl,_e as fm,ba as fn,Jf as fo,dHe as fp,bse as fq,ree as fr,S2t as fs,edt as ft,e2t as fu,t2t as fv,MW as fw,STt as fx,vm as fy,uge as fz,Aa as g,xxt as g$,It as g0,uu as g1,ps as g2,Ir as g3,bt as g4,Li as g5,La as g6,ze as g7,$t as g8,rt as g9,EOe as gA,IOe as gB,lw as gC,s_e as gD,jpe as gE,JW as gF,Nwt as gG,Ta as gH,FY as gI,V6e as gJ,dE as gK,x8e as gL,zwt as gM,jde as gN,IX as gO,Lw as gP,FO as gQ,M1t as gR,P_ as gS,Lu as gT,fIe as gU,fE as gV,$5 as gW,mIe as gX,kye as gY,ku as gZ,hIe as g_,lt as ga,Wi as gb,Vi as gc,ra as gd,Em as ge,os as gf,Bv as gg,or as gh,u4 as gi,Vv as gj,mU as gk,V2t as gl,Ke as gm,St as gn,dge as go,Lxt as gp,Fo as gq,ZTt as gr,D5 as gs,LTt as gt,nwt as gu,aa as gv,xQ as gw,Fs as gx,kn as gy,CTt as gz,kt as h,RSt as h$,Hu as h0,j2 as h1,O3 as h2,Dee as h3,vLe as h4,BTt as h5,ere as h6,GTt as h7,jwt as h8,nX as h9,PO as hA,Iu as hB,DMe as hC,ATe as hD,vi as hE,tD as hF,BC as hG,HP as hH,zTt as hI,$X as hJ,gy as hK,sq as hL,xwt as hM,rv as hN,Rxt as hO,Z_ as hP,NI as hQ,sX as hR,iX as hS,j0e as hT,kwt as hU,Kb as hV,OSt as hW,PSt as hX,hxt as hY,wPe as hZ,Tb as h_,lpe as ha,Z3e as hb,$Tt as hc,t_e as hd,i_e as he,K0e as hf,B6e as hg,tae as hh,Kit as hi,Qwt as hj,z2t as hk,Bpe as hl,UOe as hm,Vwt as hn,R6 as ho,fm as hp,SP as hq,ZUe as hr,W2t as hs,L9e as ht,c2t as hu,Jwt as hv,qwt as hw,Xwt as hx,Wwt as hy,Ywt as hz,E as i,K2e as i$,b4 as i0,mxt as i1,B2t as i2,Lxe as i3,t6 as i4,Yi as i5,nM as i6,Nu as i7,jB as i8,Yw as i9,e6e as iA,dt as iB,ve as iC,eM as iD,Ss as iE,uw as iF,py as iG,I5 as iH,qX as iI,qme as iJ,bOe as iK,J8 as iL,Ew as iM,cft as iN,s1t as iO,G7 as iP,Hs as iQ,z7 as iR,H7 as iS,PF as iT,yLe as iU,pw as iV,Mme as iW,QB as iX,Hf as iY,xSt as iZ,ESt as i_,J6 as ia,jc as ib,Uy as ic,Vo as id,at as ie,jr as ig,Ea as ih,Mfe as ii,ISt as ij,$St as ik,vX as il,JLe as im,Bp as io,wr as ip,$r as iq,VSt as ir,_St as is,V0e as it,MR as iu,Hge as iv,f4 as iw,lI as ix,Ia as iy,RS as iz,bx as j,hSt as j$,pce as j0,wSt as j1,TSt as j2,bSt as j3,iN as j4,_O as j5,$D as j6,SN as j7,Up as j8,uwt as j9,_Le as jA,fr as jB,Wn as jC,Ur as jD,us as jE,qn as jF,mS as jG,dSt as jH,rfe as jI,hwt as jJ,xn as jK,Iwt as jL,Pwt as jM,gpe as jN,fpe as jO,Rme as jP,Axt as jQ,Cxt as jR,Ext as jS,Xf as jT,rM as jU,ta as jV,ni as jW,Hn as jX,By as jY,aS as jZ,Sa as j_,rd as ja,cQ as jb,$h as jc,hce as jd,Idt as je,$dt as jf,An as jg,AM as jh,KDe as ji,ELe as jj,Hxt as jk,SLe as jl,Rv as jm,Nw as jn,Ic as jo,Pxt as jp,zxt as jq,Gxt as jr,jw as js,mz as jt,LS as ju,ene as jv,Gt as jw,tm as jx,kDe as jy,Xxt as jz,Nt as k,swt as k$,hq as k0,Lwt as k1,pz as k2,y6 as k3,xTt as k4,TTt as k5,bTt as k6,wTt as k7,Kh as k8,ds as k9,k3 as kA,l6 as kB,qxt as kC,Wge as kD,Wxt as kE,oqe as kF,cqe as kG,$wt as kH,Mwt as kI,Owt as kJ,Wb as kK,Vu as kL,mW as kM,qrt as kN,fse as kO,pse as kP,Ist as kQ,N2t as kR,BW as kS,el as kT,td as kU,K5 as kV,nl as kW,X6 as kX,kp as kY,co as kZ,Uht as k_,ep as ka,Ac as kb,DZ as kc,LZ as kd,yfe as ke,rn as kf,We as kg,bs as kh,jxt as ki,pDe as kj,T2 as kk,vge as kl,lbe as km,Le as kn,kl as ko,lv as kp,E5 as kq,vW as kr,dy as ks,eqe as kt,vn as ku,obe as kv,Cy as kw,nY as kx,_P as ky,Ei as kz,Qe as l,pn as l$,dw as l0,QWe as l1,P2t as l2,O2t as l3,M2t as l4,kxt as l5,nxt as l6,tv as l7,G4 as l8,LTe as l9,ZX as lA,Kme as lB,Fp as lC,KE as lD,qt as lE,sa as lF,bU as lG,kxe as lH,Zxe as lI,mt as lJ,mi as lK,dxt as lL,Sle as lM,Kae as lN,iY as lO,tM as lP,nP as lQ,kK as lR,zt as lS,Ph as lT,Dxt as lU,E_ as lV,Gu as lW,LU as lX,Yl as lY,$a as lZ,Mu as l_,$2t as la,gS as lb,hqe as lc,CR as ld,GB as le,Pa as lf,tE as lg,_S as lh,CW as li,C2t as lj,R5 as lk,bat as ll,Lst as lm,ax as ln,am as lo,Ct as lp,$W as lq,Q2t as lr,qf as ls,Pwe as lt,Tx as lu,sY as lv,ixt as lw,Vxt as lx,lxt as ly,$m as lz,_C as m,Hze as m$,jxe as m0,Fxt as m1,ott as m2,zu as m3,YLe as m4,rTe as m5,tC as m6,JS as m7,$H as m8,ZJ as m9,u6 as mA,sZe as mB,Nxt as mC,D2t as mD,rne as mE,Sx as mF,j$e as mG,R9e as mH,b7e as mI,M7e as mJ,iZ as mK,npt as mL,spt as mM,NO as mN,Fv as mO,j9e as mP,mwt as mQ,Eke as mR,Cwt as mS,Oje as mT,G2t as mU,Y3e as mV,QTt as mW,Lke as mX,fMe as mY,TMe as mZ,wxt as m_,dwt as ma,KCe as mb,Bxt as mc,C8 as md,LF as me,ent as mf,GSt as mg,HSt as mh,jSt as mi,QM as mj,axt as mk,M1 as ml,dse as mm,Ef as mn,aY as mo,zO as mp,yE as mq,sxt as mr,LQe as ms,lY as mt,Lme as mu,gE as mv,Nge as mw,Oy as mx,$De as my,yy as mz,iwt as n,VTt as n$,qze as n0,Wze as n1,Gh as n2,c5 as n3,ayt as n4,kSt as n5,lyt as n6,eyt as n7,USt as n8,uyt as n9,kTt as nA,UTt as nB,PTt as nC,AW as nD,kY as nE,T8e as nF,n_e as nG,NTt as nH,DTt as nI,Kwt as nJ,ext as nK,txt as nL,zAe as nM,q2t as nN,tre as nO,j2t as nP,Lc as nQ,WUe as nR,Vke as nS,aMe as nT,xPe as nU,MUe as nV,jTt as nW,BUe as nX,jte as nY,x5 as nZ,JUe as n_,kP as na,x4 as nb,vne as nc,k2t as nd,Z$e as ne,yo as nf,qP as ng,jX as nh,Bu as ni,HU as nj,Bme as nk,cd as nl,mSt as nm,kE as nn,Ov as no,pSt as np,gSt as nq,fSt as nr,Fat as ns,Bat as nt,Uat as nu,kat as nv,Vat as nw,ITt as nx,OTt as ny,RTt as nz,KK as o,yTt as o$,m$e as o0,KTt as o1,k7 as o2,Mh as o3,Ek as o4,Ck as o5,owt as o6,awt as o7,Tu as o8,ATt as o9,cl as oA,ne as oB,Ff as oC,FF as oD,L0e as oE,Ci as oF,ode as oG,wS as oH,Vfe as oI,_xt as oJ,rP as oK,FPe as oL,jh as oM,H5 as oN,eP as oO,Txt as oP,rTt as oQ,sTt as oR,zye as oS,Qxt as oT,pTt as oU,O4e as oV,A4e as oW,oTt as oX,aTt as oY,lTt as oZ,eTt as o_,lwt as oa,Ec as ob,_y as oc,RP as od,tl as oe,ZBe as of,FTt as og,O6 as oh,Yr as oi,qi as oj,N_ as ok,Z8e as ol,J8e as om,rDe as on,yp as oo,Uxt as op,cDe as oq,KRe as or,Awt as os,tIe as ot,pE as ou,MX as ov,SSt as ow,Tc as ox,dce as oy,il as oz,VO as p,eCe as p$,tTt as p0,fTt as p1,hTt as p2,OFe as p3,vTt as p4,iTt as p5,cTt as p6,M4e as p7,dTt as p8,Kxt as p9,uTt as pA,nTt as pB,_Tt as pC,eO as pD,Aqe as pE,yWe as pF,kbe as pG,Ube as pH,zWe as pI,tJ as pJ,xXe as pK,iwe as pL,sJ as pM,AXe as pN,pYe as pO,IYe as pP,Ktt as pQ,B4 as pR,Nit as pS,XJ as pT,mtt as pU,px as pV,rmt as pW,Hgt as pX,QQ as pY,KEe as pZ,gyt as p_,_pt as pa,E2t as pb,Wke as pc,r2t as pd,XTt as pe,oIe as pf,qke as pg,gC as ph,i2t as pi,w2t as pj,tje as pk,mE as pl,D3 as pm,A7 as pn,s2t as po,gTt as pp,mTt as pq,Iv as pr,Rpe as ps,LX as pt,zfe as pu,G_ as pv,pEe as pw,Rft as px,RC as py,T9e as pz,cO as q,l_t as q$,_yt as q0,tCe as q1,byt as q2,rCe as q3,xyt as q4,gI as q5,Z8 as q6,RPe as q7,Vbe as q8,HWe as q9,sCe as qA,n0t as qB,nCe as qC,a0t as qD,oCe as qE,_8 as qF,w0t as qG,M0t as qH,B0t as qI,G0t as qJ,H0t as qK,g9e as qL,ol as qM,Kd as qN,o8e as qO,MTt as qP,dhe as qQ,mY as qR,m2t as qS,GAe as qT,Jxt as qU,y2t as qV,g2t as qW,_2t as qX,ynt as qY,aCe as qZ,S0t as q_,Ewt as qa,W2 as qb,Ope as qc,eX as qd,kOe as qe,Fwt as qf,KW as qg,Uwt as qh,Bwt as qi,Qh as qj,Mot as qk,aP as ql,Im as qm,pP as qn,aot as qo,dot as qp,$nt as qq,Fnt as qr,bQ as qs,Jpt as qt,Zpt as qu,t8 as qv,Qpt as qw,H4 as qx,Dst as qy,r0t as qz,v as r,y_e as r$,a2t as r0,P9e as r1,rNe as r2,_at as r3,Hat as r4,iut as r5,Tut as r6,yut as r7,O9e as r8,k7e as r9,H9e as rA,Dj as rB,$6 as rC,G9e as rD,bZ as rE,c1e as rF,Gc as rG,ld as rH,Y5 as rI,aHe as rJ,oHe as rK,sHe as rL,Qie as rM,al as rN,I6 as rO,mOe as rP,fOe as rQ,Dwt as rR,Sk as rS,f3e as rT,Y7e as rU,EC as rV,ZY as rW,d_e as rX,tUe as rY,gke as rZ,rUe as r_,U7e as ra,ip as rb,_fe as rc,b9e as rd,MZ as re,u2t as rf,q9e as rg,X9e as rh,S9e as ri,nZ as rj,C9e as rk,A9e as rl,phe as rm,pv as rn,pi as ro,gLe as rp,S7e as rq,M9e as rr,_7e as rs,D9e as rt,B7e as ru,JK as rv,qpe as rw,aZ as rx,k6 as ry,Mie as rz,cP as s,lze as s$,T_e as s0,QF as s1,wwt as s2,l_e as s3,W3 as s4,E9e as s5,Gwt as s6,Us as s7,vwt as s8,$w as s9,Hfe as sA,hK as sB,KF as sC,I9e as sD,ev as sE,wie as sF,hE as sG,AE as sH,Z9e as sI,Y9e as sJ,Pv as sK,J5 as sL,UY as sM,dze as sN,p9e as sO,My as sP,Pze as sQ,mze as sR,gze as sS,eze as sT,tze as sU,rze as sV,ize as sW,sze as sX,nze as sY,oze as sZ,aze as s_,uxt as sa,ME as sb,ux as sc,Wve as sd,OW as se,r2 as sf,mG as sg,v2t as sh,_ze as si,dF as sj,Q3 as sk,B7 as sl,i7 as sm,sd as sn,XZ as so,UE as sp,xWe as sq,ULe as sr,Ax as ss,T5 as st,rxt as su,vxt as sv,ROe as sw,xm as sx,mm as sy,pfe as sz,Jr as t,Gb as t$,cze as t0,uze as t1,hze as t2,l1e as t3,QAe as t4,wp as t5,gxt as t6,nee as t7,Zfe as t8,nAe as t9,Zze as tA,Jze as tB,t1e as tC,Bx as tD,EE as tE,AX as tF,Ku as tG,Nat as tH,U2t as tI,F2t as tJ,cSt as tK,X0e as tL,Sxt as tM,e5e as tN,FI as tO,LG as tP,rZe as tQ,BLe as tR,kLe as tS,Qf as tT,cSe as tU,ww as tV,qYe as tW,bxt as tX,vSe as tY,wSe as tZ,fO as t_,KN as ta,S5 as tb,W9e as tc,o2t as td,yxt as te,B3e as tf,wK as tg,D as th,Rwt as ti,Zge as tj,ODe as tk,ga as tl,a4 as tm,pHe as tn,__t as to,JTt as tp,jGe as tq,w1e as tr,S1e as ts,pb as tt,CZ as tu,EZ as tv,kGe as tw,HTt as tx,AZ as ty,Yze as tz,Bke as u,Ma as u0,_o as u1,nd as u2,yT as u3,pwt as u4,uQ as u5,dlt as u6,fSe as u7,olt as u8,_Se as u9,gSe as ua,hlt as ub,fq as uc,ySe as ud,Tv as ue,alt as uf,xv as ug,rq as uh,Kw as ui,Qit as uj,Dlt as uk,Llt as ul,$lt as um,I2t as un,FIe as uo,qTt as up,KY as uq,YTt as ur,b2t as us,K2t as ut,ySt as uu,Pp as v,sn as w,se as x,d as y,aSt as z};
